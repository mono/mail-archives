<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] detect-sc not marking methods that	make	internal calls?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20detect-sc%20not%20marking%20methods%0A%20that%09make%09internal%20calls%3F&In-Reply-To=4A3EA1D6.9010104%40lucasmeijer.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000509.html">
   <LINK REL="Next"  HREF="000506.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] detect-sc not marking methods that	make	internal calls?</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20detect-sc%20not%20marking%20methods%0A%20that%09make%09internal%20calls%3F&In-Reply-To=4A3EA1D6.9010104%40lucasmeijer.com"
       TITLE="[Moonlight-list] detect-sc not marking methods that	make	internal calls?">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Mon Jun 22 09:08:30 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000509.html">[Moonlight-list] detect-sc not marking methods that make	internal calls?
</A></li>
        <LI>Next message: <A HREF="000506.html">[Moonlight-list] reflection of private members.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#510">[ date ]</a>
              <a href="thread.html#510">[ thread ]</a>
              <a href="subject.html#510">[ subject ]</a>
              <a href="author.html#510">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 2009-06-21 at 23:10 +0200, Lucas Meijer wrote:
&gt;<i> Hey Sebastien,
</I>&gt;<i> 
</I>&gt;<i> Thanks for all the info.
</I>&gt;<i> &gt; &#65279;That would be wrong, but you're right that icalls are a bit special.
</I>&gt;<i> &gt; The main point is detect-sc cannot generalize them, like p/invokes can
</I>&gt;<i> &gt; be.
</I>&gt;<i> &gt;   
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i> &gt; Here a counter-example (Math.cs) why:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [MethodImplAttribute (MethodImplOptions.InternalCall)]
</I>&gt;<i> &gt; public extern static double Floor (double d);
</I>&gt;<i> Do I summarize correctly if I say that there are icalls that can do no 
</I>&gt;<i> harm, and icalls that can, so we cannot
</I>&gt;<i> just mark them as SecurityCritical. (because of the ones that can do no 
</I>&gt;<i> harm like Math.Floor). ?
</I>
Yes, that's close enough. &quot;can do no harm&quot; -&gt; &quot;should do no harm&quot; ;-)

&gt;<i> Wouldn't it be easier from an audit perspective if all icalls are by 
</I>&gt;<i> default considered SecurityCritical, unless
</I>&gt;<i> manually specified [Transparent] (like for Math.Floor).
</I>
No, that's definitively not easier.

&gt;<i>    Maybe it's a 
</I>&gt;<i> bit annoying adding those attributes manually,
</I>
That's one (big) reason for not being easier (both annoying and error
prone ;-) but it also means that:

* in the mean time you get non-functional class libraries to continue
the development of moonlight. This push this &quot;feature&quot; on the top of the
priority list, while it can otherwise wait the audit stage;

* you cannot apply [SecurityTransparent] anywhere but at the
assembly-level (i.e. not on methods). Which is useless since this is the
default in SL ;-). Of course you can leave them unmarked (at least as
long as the runtime don't treat them specially);

* the Mono runtime and BCL is a continuously moving target (new icalls,
removed icalls, modified icalls). We would need to repeat the above
steps each time we update from Mono HEAD.

* even &quot;safe&quot; icalls (the one that should do no harm) needs to be
audited, unlike other transparent code.

Like I said it's definitively not easier ;-)


Now marking them all [SecuritySafeCritical] has the advantages of:

* Keeping Moonlight functional (with security enabled);

* Adding all icalls to the audit list (even if they are to be audited
separately or, at least, differently than the managed code). Removed (or
unused, linker-wise) icalls will be removed from the list when
regenerated;

* Making the runtime refuse to run them unless marked as critical.
Meaning we'll catch any new icalls (MAE) even if the list was not
regenerated;

The more you make me think about this the more convinced I am about the
advantages of doing this the SSC way ;-)

&gt;<i> however, it also seems like quite a error prone taks to take all icalls 
</I>&gt;<i> that can do harm,  and make sure that they're
</I>&gt;<i> really really only being called from securitycritical code. (now, and in 
</I>&gt;<i> the future)
</I>
Sure, but how does that differs from what's _already_ needed for
moonlight ? e.g. p/invokes, unsafe code...

Finding what's being called (or not) and from where (and its context) is
not hard (and already done in our tooling). icalls (unless they call
back into managed code) are no different.

Saying that the audit is error prone is true, which is why the tools are
made to ensure we can focus our attention on the right places (the SSC
stuff). Having icalls does not change, much*, that and does not make it
more (or less) error-prone.

Also I fail to see (unless you did no want to imply that?) how does this
differ from what you suggested above ? Because the above will work only
if we do the same thing *earlier* and continue doing it afterward.

Thanks
Sebastien

* the audit itself is different (icalls versus managed code) but the
initial and subsequent detections are not.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000509.html">[Moonlight-list] detect-sc not marking methods that make	internal calls?
</A></li>
	<LI>Next message: <A HREF="000506.html">[Moonlight-list] reflection of private members.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#510">[ date ]</a>
              <a href="thread.html#510">[ thread ]</a>
              <a href="subject.html#510">[ subject ]</a>
              <a href="author.html#510">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
