<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] Impossibly high fps on bubblemark
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Impossibly%20high%20fps%20on%20bubblemark&In-Reply-To=1226348037.5483.22.camel%40limestone">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000155.html">
   <LINK REL="Next"  HREF="000157.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] Impossibly high fps on bubblemark</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Impossibly%20high%20fps%20on%20bubblemark&In-Reply-To=1226348037.5483.22.camel%40limestone"
       TITLE="[Moonlight-list] Impossibly high fps on bubblemark">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Mon Nov 10 15:32:35 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000155.html">[Moonlight-list] Impossibly high fps on bubblemark
</A></li>
        <LI>Next message: <A HREF="000157.html">[Moonlight-list] trunk development
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#156">[ date ]</a>
              <a href="thread.html#156">[ thread ]</a>
              <a href="subject.html#156">[ subject ]</a>
              <a href="author.html#156">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2008-11-10 at 15:13 -0500, Geoff Norton wrote:
&gt;<i> On Mon, 2008-11-10 at 15:06 -0500, Sebastien Pouliot wrote:
</I>&gt;<i> &gt; Hello Larry,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Paolo reported a few times having problems with bubblemark. Last time
</I>&gt;<i> &gt; (October 17th) a few of us did some investigation on IRC* and Paolo
</I>&gt;<i> &gt; tracked the problem back to r106256.
</I>&gt;<i> 
</I>&gt;<i> Its worth noting that while reporting 50,000 odd FPS, it wasn't
</I>&gt;<i> rendering at all.  Correct paolo?
</I>
Logs are better than (at least my) memory (a bit edited to remove other
simultaneous discussions)

Oct 17 09:44:50 &lt;lupus&gt;	do you ever test with this? <A HREF="http://www.craftymind.com/guimark/">http://www.craftymind.com/guimark/</A>
Oct 17 09:45:08 &lt;lupus&gt;	moonlight is 10x slower than flash and 5x slower than dhtml
Oct 17 09:57:24 &lt;spouliot&gt;	lupus: this is consistent with SL (5x versus flash, 2.5 times versus DHTML) - making ML 2 times slower than SL
Oct 17 09:58:03 &lt;spouliot&gt;	from what I see this morning bubblemark seems, at least, 2 times slower than it was so something regressed (or my box is going crazy)
Oct 17 10:00:08 &lt;spouliot&gt;	I get 20-24 fps in bubblemark, using the image backend I get 53-56 fps
Oct 17 10:00:55 &lt;spouliot&gt;	MOONLIGHT_OVERRIDES=&quot;backend=image&quot; firefox <A HREF="http://www.bubblemark.com/wpfe.htm">http://www.bubblemark.com/wpfe.htm</A>
Oct 17 10:01:02 &lt;lupus&gt;	bubblemark still doesn't work here:/
Oct 17 10:01:32 &lt;spouliot&gt;	ouch - does using the image backend helps ?
Oct 17 10:01:42 &lt;spouliot&gt;	on bubblemark or on guimark ?
Oct 17 10:02:03 &lt;lupus&gt;	the image backend doesn't help bubblemark
Oct 17 10:02:18 &lt;lupus&gt;	moonlight prints it's doing something stupid like 63L fps
Oct 17 10:02:27 &lt;lupus&gt;	but actually the balls don't move
Oct 17 10:03:53 &lt;spouliot&gt;	iirc that race bug was closed a while ago - did it regress recently ?
Oct 17 10:04:26 &lt;lupus&gt;	the image backend on guimark doesn't seem to help at all, possibly making things worse
Oct 17 10:04:41 &lt;lupus&gt;	my moonlight is from yesterday
Oct 17 10:05:09 &lt;lupus&gt;	I haven't seen bublemark work in months
Oct 17 10:05:38 &lt;lupus&gt;	at asome point the alsa backend was broken and fixed (sprawl started working again for me after the fix I think you mention)
Oct 17 10:06:28 &lt;spouliot&gt;	oh, I might have confused the bug being about bubblemark, while it was sprawl
Oct 17 10:06:39 &lt;kangaroo&gt;	morn
Oct 17 10:07:37 &lt;lupus&gt;	well, at the time I reported that both seemed to go into an ininite loop in the same way
Oct 17 10:07:56 &lt;kangaroo&gt;	lupus: what video hardware do you have?
Oct 17 10:08:11 &lt;kangaroo&gt;	and which drivers?
...
Oct 17 10:10:58 &lt;lupus&gt;	kangaroo: I have intel 965GM
Oct 17 10:13:00 &lt;kangaroo&gt;	hrmm moonbuilder tarballhost is down
Oct 17 10:13:01 &lt;kangaroo&gt;	fixing
Oct 17 10:14:00 &lt;kangaroo&gt;	ok moonbuilder should be fixed on the next run
Oct 17 10:14:06 &lt;kangaroo&gt;	lupus: hrmm..
Oct 17 10:14:21 &lt;kangaroo&gt;	so after the double render_cb fix that number isn't unreasonable for a bubblemark fps
Oct 17 10:14:25 &lt;kangaroo&gt;	of course it should be moving :)
Oct 17 10:14:56 &lt;kangaroo&gt;	do you mean the statusbar fps or the one in the bubblemark?
Oct 17 10:15:26 &lt;lupus&gt;	I mistyped the L, it's 63k fps, which is completely unreasonable
Oct 17 10:15:54 &lt;lupus&gt;	it's the statusbasr fps
Oct 17 10:16:13 &lt;lupus&gt;	the other one doesn't even update

Oct 17 10:16:50 *	lewin1 (~<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">lewing at cpe-70-113-54-154.austin.res.rr.com</A>) has joined #moonlight
Oct 17 10:16:52 &lt;kangaroo&gt;	I suggest github.com
Oct 17 10:17:03 &lt;kangaroo&gt;	lupus: 63 _THOUSAND_ fps?
Oct 17 10:17:03 *	ankit9 (~<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">ankit at 122.167.78.44</A>) has joined #moonlight
Oct 17 10:17:05 &lt;kangaroo&gt;	thats not right :)
Oct 17 10:17:20 &lt;rolf&gt;	heh, I was thinking more of like moon/test/builder/ :)
Oct 17 10:17:41 &lt;kangaroo&gt;	rolf: nah, dont clutter the moon sources with it
Oct 17 10:17:48 &lt;kangaroo&gt;	ifyou want to do that put it in our svn as moonbuilder
Oct 17 10:18:05 &lt;rolf&gt;	yeah, I guess that's best
Oct 17 10:18:15 &lt;kangaroo&gt;	otherwise every time we patch the builder, it rebuilds moon
Oct 17 10:18:21 &lt;kangaroo&gt;	and all kinds of other icky stuff
Oct 17 10:18:26 &lt;rolf&gt;	heh :)
Oct 17 10:19:22 &lt;lupus&gt;	yes, it's a completely broken fps (just updated to svn, too)
Oct 17 10:19:41 &lt;kangaroo&gt;	lupus: something is obviously going wrong in the init for bubblemark for you.
Oct 17 10:19:43 &lt;kangaroo&gt;	Do other sites work?
Oct 17 10:20:13 &lt;kangaroo&gt;	can you set a breakpoint on Surface::render_cb (EventObject *sender, EventArgs *calldata, gpointer closure)
Oct 17 10:20:14 &lt;lupus&gt;	I tested a few and they seem to work (though they are very slow)
Oct 17 10:20:21 &lt;kangaroo&gt;	and see if its getting called?
Oct 17 10:21:05 &lt;lupus&gt;	Can't find member of namespace, class, struct, or union named &quot;Surface::render_cb&quot;
Oct 17 10:21:53 &lt;kangaroo&gt;	lemme get you the file.cpp:# on svn
Oct 17 10:22:26 &lt;kangaroo&gt;	runtime.cpp:896
Oct 17 10:23:45 &lt;rolf&gt;	we should also cleanup our tests in test/xaml/drtlist.xml, I get ~60 failures now
Oct 17 10:23:52 &lt;kangaroo&gt;	nod
Oct 17 10:24:05 &lt;lupus&gt;	it does get hit
Oct 17 10:25:06 &lt;lupus&gt;	calldata is always NULL, if that matters
Oct 17 10:25:39 &lt;lupus&gt;	s-&gt;IsAnythingDirty () is false
Oct 17 10:25:44 &lt;rolf&gt;	if nobody minds, I'll mark those as knownfailure
Oct 17 10:25:51 &lt;lupus&gt;	as is s-&gt;expose_handoff
Oct 17 10:27:40 &lt;kangaroo&gt;	yeah we dont use the calldata in the renderc
Oct 17 10:27:44 &lt;kangaroo&gt;	render_cb
Oct 17 10:28:29 &lt;kangaroo&gt;	but if nothing is dirty and you never have an expose handoff something is wrong
Oct 17 10:28:29 &lt;kangaroo&gt;	lewin1: ?
Oct 17 10:28:46 &lt;kangaroo&gt;	you recently resorted our dirty pass right?
Oct 17 10:29:00 &lt;kangaroo&gt;	lupus: firefox3?
Oct 17 10:29:19 &lt;lupus&gt;	this is not recent, this has been going on for months
Oct 17 10:29:23 &lt;lupus&gt;	it's firefox2
Oct 17 10:30:10 &lt;kangaroo&gt;	I'm just trying to think thru whats different in your case
Oct 17 10:30:13 &lt;kangaroo&gt;	ff2 is a possibility
Oct 17 10:32:02 &lt;kangaroo&gt;	don't think we do much ff2 testing anymore
Oct 17 10:32:09 &lt;kangaroo&gt;	fer_: ?
Oct 17 10:32:27 &lt;fer_&gt;	yeah, maybe I'm the only one ;)
Oct 17 10:32:55 &lt;kangaroo&gt;	can you check bubblemark in ff2+trunk ?
Oct 17 10:35:30 &lt;fer_&gt;	it works fine here
Oct 17 10:35:58 &lt;fer_&gt;	although app fps and ff fps are a little bit out of sync
Oct 17 10:36:29 &lt;kangaroo&gt;	thats normal
Oct 17 10:36:36 &lt;kangaroo&gt;	neither of them are really fps
Oct 17 10:43:14 &lt;lewin1&gt;	kangaroo: what is the problem?
Oct 17 10:44:06 &lt;kangaroo&gt;	lewin1: lupus isn't getting any rendering in bubblemark
Oct 17 10:44:14 &lt;kangaroo&gt;	but it appears its been happning for months
Oct 17 10:44:22 &lt;kangaroo&gt;	10:36 &lt;@lupus&gt; s-&gt;IsAnythingDirty () is false
Oct 17 10:44:23 &lt;kangaroo&gt;	10:36 &lt;@lupus&gt; as is s-&gt;expose_handoff
Oct 17 10:44:25 &lt;kangaroo&gt;	in the render_Cb
Oct 17 10:44:30 &lt;kangaroo&gt;	but other sites work for him
Oct 17 10:44:36 &lt;kangaroo&gt;	I'm stumped as to what could be causing that
Oct 17 10:44:42 &lt;lewin1&gt;	that doesn't make much sense :)
Oct 17 10:44:48 &lt;kangaroo&gt;	yeah
Oct 17 10:44:59 &lt;kangaroo&gt;	and he's getting 64000 fps reported in the status bar from our render_cb
Oct 17 10:45:00 &lt;kangaroo&gt;	heh
Oct 17 10:45:06 &lt;lewin1&gt;	haha
Oct 17 10:45:22 &lt;kangaroo&gt;	I didn't even think we could tick that fast :)
Oct 17 10:50:39 &lt;lewin1&gt;	on the good side I'm getting ~50fps on bubblemark now
Oct 17 10:50:48 &lt;fer_&gt;	yeah, me too
...
Oct 17 10:57:01 &lt;lupus&gt;	it won't be as funny when other users will hit the same bug... :)
Oct 17 10:58:41 &lt;lewin1&gt;	lupus: render_cb is firing but nothing is in the dirty list?
Oct 17 10:59:32 &lt;lupus&gt;	yep, at least that call returns false in the few times I checked it in gdb
Oct 17 11:00:01 &lt;jeff_&gt;	sounds like it got connected multiple times then
Oct 17 11:00:13 &lt;kangaroo&gt;	jeff_: which, the render_cb?
Oct 17 11:00:19 &lt;jeff_&gt;	yea
Oct 17 11:00:26 &lt;kangaroo&gt;	I thought we fixed that
Oct 17 11:00:32 &lt;kangaroo&gt;	I think its something else
Oct 17 11:00:35 &lt;kangaroo&gt;	if its always false for him
Oct 17 11:01:19 &lt;lewin1&gt;	and it isn't a new thing?
Oct 17 11:01:28 &lt;kangaroo&gt;	lewin1: he said he's been seeing this for months
Oct 17 11:01:32 &lt;kangaroo&gt;	in bubblemark
Oct 17 11:01:46 &lt;kangaroo&gt;	lupus: have you tried bmark in a new profile?
Oct 17 11:01:54 &lt;kangaroo&gt;	maybe something in firefox is cached weird/confuseD?
Oct 17 11:02:31 &lt;kangaroo&gt;	rolf: btw; you saw my logo changes?
Oct 17 11:02:53 &lt;lewin1&gt;	I wonder if ff2 is getting in a loop on the js side somehow
Oct 17 11:03:15 &lt;kangaroo&gt;	lewin1: fer tested ff2 and it worked
Oct 17 11:04:09 &lt;lewin1&gt;	firebug installe?
Oct 17 11:04:23 &lt;kangaroo&gt;	oh good point
Oct 17 11:04:29 &lt;kangaroo&gt;	fer_/paolo??
Oct 17 11:04:55 &lt;fer_&gt;	yeah, latest
Oct 17 11:04:57 &lt;lupus&gt;	with a neew profile the balls move a little bit more, I'm getting 1 fps
Oct 17 11:05:09 &lt;kangaroo&gt;	fer_: you have firebug installed?
Oct 17 11:05:11 &lt;lewin1&gt;	haha
Oct 17 11:05:30 &lt;lupus&gt;	58 k fps now
Oct 17 11:05:37 &lt;fer_&gt;	lupus, new ff profile?
Oct 17 11:05:41 &lt;lewin1&gt;	I need a new mono to build head?
Oct 17 11:05:51 &lt;kangaroo&gt;	lewin1: head of moon?
Oct 17 11:05:58 &lt;lewin1&gt;	yeha
Oct 17 11:06:03 &lt;lupus&gt;	fer_: yes, started firefox -P ...
Oct 17 11:06:08 &lt;kangaroo&gt;	lupus: do you have firebug installed?
Oct 17 11:06:32 &lt;fer_&gt;	mine is recent too, because last week I was not able to update to latest firebug version on ff2, so I just nuked the old profile
Oct 17 11:06:45 &lt;lupus&gt;	I have, though it doesn't seem to be active with the new profile
Oct 17 11:06:56 &lt;kangaroo&gt;	bizarre
Oct 17 11:07:28 &lt;lewin1&gt;	and there is no stale moonloader in a different prefix or anything
Oct 17 11:07:46 &lt;lupus&gt;	confirmed, it's active in the default profile, that is likely what makes the change from 0 fps to 1 fps
Oct 17 11:08:13 &lt;kangaroo&gt;	yeah, theres another possibility, you dont have any erroneous libmoon*.so's kicking around possibly getting loaded?
Oct 17 11:08:20 &lt;lupus&gt;	II changed the version in configure.ac to make sure I was loading the latest version
Oct 17 11:08:26 &lt;kangaroo&gt;	rolf__: ping
Oct 17 11:08:49 &lt;rolf__&gt;	Kal-EL_, pong
Oct 17 11:08:50 &lt;kangaroo&gt;	lupus: and you did a make test-plugin too to make sure plugin and lib are in sync (we really need to strong version those bits)
Oct 17 11:08:51 &lt;rolf__&gt;	err
Oct 17 11:08:54 &lt;rolf__&gt;	kangaroo, pong
Oct 17 11:08:58 &lt;kangaroo&gt;	rolf__: did you put in the new moon logo or was that bockie?
Oct 17 11:09:04 &lt;kangaroo&gt;	did you see the change I made last night?
Oct 17 11:09:06 &lt;rolf__&gt;	I put in the new logo
Oct 17 11:09:26 &lt;kangaroo&gt;	rolf__: I changed it lats night to center intstead of tile
Oct 17 11:09:32 &lt;rolf__&gt;	yeah (the code only :)
Oct 17 11:09:34 &lt;lupus&gt;	I always do make install and make test-plugin
Oct 17 11:09:37 &lt;kangaroo&gt;	but it looks like I have a off-by-one problem on the left and bottom
Oct 17 11:09:46 &lt;kangaroo&gt;	I wanna know if its in the src image or my math
Oct 17 11:09:49 &lt;kangaroo&gt;	can you take a quick peek?
Oct 17 11:09:53 &lt;rolf__&gt;	sure
Oct 17 11:09:55 &lt;kangaroo&gt;	thanks
...
Oct 17 11:12:37 &lt;kangaroo&gt;	lupus: can you try to force using the gettimeofday clock instead of the MONOTONIC one in clock.cpp
Oct 17 11:12:41 &lt;kangaroo&gt;	and see if that changes anything?
Oct 17 11:13:00 &lt;lupus&gt;	I checked and there is no stale libmoonloader.so either
Oct 17 11:13:01 &lt;lupus&gt;	ok
Oct 17 11:14:23 &lt;rolf__&gt;	kangaroo, did you scale the logo too?
Oct 17 11:14:44 &lt;kangaroo&gt;	rolf__: nope
Oct 17 11:14:50 &lt;kangaroo&gt;	that happens somewhere else
Oct 17 11:14:50 &lt;rolf__&gt;	ah, that might be the site
Oct 17 11:14:51 &lt;lupus&gt;	kangaroo: that takes me up to 66k fps, improvement! :)
Oct 17 11:15:00 &lt;kangaroo&gt;	rolf__: it is
Oct 17 11:15:02 &lt;kangaroo&gt;	c9 shows it unscaled
Oct 17 11:15:13 &lt;kangaroo&gt;	its just a benefit that scaled shows what I'm talking about more :)
Oct 17 11:15:30 &lt;kangaroo&gt;	lupus: do you have ff3?
Oct 17 11:15:56 &lt;kangaroo&gt;	and if so, can you try it in a profile there?
Oct 17 11:16:16 &lt;lupus&gt;	I don't have ff3
Oct 17 11:16:27 &lt;lupus&gt;	I can check if it can be installed in parallel
Oct 17 11:17:45 &lt;miguel_&gt;	lupus, it can be installed in parallel
Oct 17 11:17:54 &lt;kangaroo&gt;	lupus: they can be parallel installed, just make sure you give it its own profile
Oct 17 11:17:55 &lt;miguel_&gt;	But ou need to get it from mozilla.org
Oct 17 11:17:59 &lt;kangaroo&gt;	otherwise badthings(tm) start happening
Oct 17 11:18:05 &lt;kangaroo&gt;	miguel_: I think debian has parallel packages for both
Oct 17 11:18:40 &lt;lupus&gt;	anyway, it's unlikely ff3 would fix anything
Oct 17 11:18:41 &lt;rolf__&gt;	eog doesn't have a black background, so it's kinda hard to say :|
Oct 17 11:19:00 &lt;kangaroo&gt;	lupus: agreed, but your entire situation is full of unlikely
Oct 17 11:19:58 &lt;rolf__&gt;	ah, looks like top and right line of pixels are duplicated
Oct 17 11:20:11 &lt;lupus&gt;	well, the alsa issue was also unlikely, but it was a bug in moonlight's alsa code:)
Oct 17 11:21:15 &lt;rolf__&gt;	bugs are always unlikely :)
Oct 17 11:21:31 &lt;kangaroo&gt;	lupus: :D
...
Oct 17 11:31:46 &lt;lupus&gt;	so moonlight from jan, 1st works fine
Oct 17 11:31:59 &lt;lupus&gt;	it won't be easy to bisect because of the alsa breakage
Oct 17 11:39:55 &lt;kangaroo&gt;	what was your alsa breakage?
...
Oct 17 11:46:29 &lt;kangaroo&gt;	lewin1: are you updating mono on your 32-bit or 64-bit box?
Oct 17 11:46:37 &lt;lewin1&gt;	32
Oct 17 11:47:11 &lt;kangaroo&gt;	k
...
Oct 17 12:13:56 &lt;lupus&gt;	kangaroo: the alsa breakage was some kind of infinite loop
...
Oct 17 13:08:39 &lt;lupus&gt;	and the winner is... larry
Oct 17 13:08:57 &lt;lupus&gt;	lewin1: please check r106256
Oct 17 13:09:13 &lt;lupus&gt;	the uielement.cpp change
Oct 17 13:09:29 &lt;lupus&gt;	ironically done to improve bubblemark:)
Oct 17 13:09:43 &lt;lupus&gt;	if I undo that bubblemark works fine here
Oct 17 13:11:41 &lt;kangaroo&gt;	lupus: thanks a lot for bisecting that
Oct 17 13:28:46 &lt;lupus&gt;	lewin1: <A HREF="http://monoport.com/37777">http://monoport.com/37777</A>
Oct 17 13:29:09 &lt;lupus&gt;	the change forward-ported that fixes bubble mark on trunk for me
Oct 17 13:30:06 &lt;lupus&gt;	could anyone who has a working bubblemark try that patch and see if there is any speed difference with/without it
Oct 17 13:30:09 &lt;kangaroo&gt;	lupus: are you building with system cairo?
Oct 17 13:32:00 &lt;lupus&gt;	I'm not using system cairo
Oct 17 13:33:17 &lt;kangaroo&gt;	lupus: without that change I get 48-53fps (as reported by bubblemark not moon)
Oct 17 13:34:46 &lt;kangaroo&gt;	putting the save/restore back in, I drop to 37-40fps
Oct 17 13:34:54 &lt;kangaroo&gt;	so about 80% of the original perf
Oct 17 13:35:37 &lt;spouliot&gt;	lupus: doing a restore after the clip does not sounds like a good idea
Oct 17 13:36:09 &lt;kangaroo&gt;	spouliot: the code that paolo put in used to be there
Oct 17 13:36:13 &lt;lupus&gt;	spouliot: that's what the code did before
Oct 17 13:36:25 &lt;kangaroo&gt;	lewing removed it as an (seemingly valid) optimization
Oct 17 13:36:36 *	ankit9 has quit (Read error: 131 (Connection reset by peer))
Oct 17 13:36:41 &lt;kangaroo&gt;	of course the fact that it breaks bmark for paolo is ..weird..
Oct 17 13:37:06 &lt;lupus&gt;	kangaroo: I get a 6300% speedup, so I win:)
Oct 17 13:37:07 *	ankit9 (~<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">ankit at 122.171.16.103</A>) has joined #moonlight
Oct 17 13:38:26 &lt;spouliot&gt;	hmm... doing a restore should be resetting the clip to the one existing before save
Oct 17 13:39:43 &lt;kangaroo&gt;	maybe the clipping path is wrong on paolos box?
Oct 17 13:39:50 &lt;kangaroo&gt;	and its clipping everything out of the draw?
Oct 17 13:39:57 &lt;kangaroo&gt;	which is what makes his render tick go nuts
Oct 17 13:40:04 &lt;kangaroo&gt;	because bubblemark tries to render as fast as it can?
Oct 17 13:42:23 *	toshok (~<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">toshok at adsl-76-200-189-80.dsl.pltn13.sbcglobal.net</A>) has joined #moonlight
Oct 17 13:42:23 &lt;kangaroo&gt;	no that doesn't make sense
...
Oct 17 13:43:41 &lt;spouliot&gt;	kangaroo, lupus: commenting that whole lock of code does not affect bubblemark - well it does make it faster to me
Oct 17 13:43:41 &lt;kangaroo&gt;	(KeyDown)N3 / (KeyDown)PgDn
Oct 17 13:43:44 &lt;toshok&gt;	&#65279;(KeyDown)PgD
Oct 17 13:43:46 &lt;toshok&gt;	n
Oct 17 13:43:49 &lt;spouliot&gt;	s/lock/block
Oct 17 13:43:57 &lt;toshok&gt;	how are you running the tests?
Oct 17 13:43:58 &lt;toshok&gt;	in a vm?
Oct 17 13:44:01 &lt;kangaroo&gt;	spouliot: you're like me
Oct 17 13:44:04 &lt;kangaroo&gt;	toshok: chroot jail
Oct 17 13:44:06 &lt;kangaroo&gt;	in Xvfb
Oct 17 13:44:16 &lt;kangaroo&gt;	spouliot: you have bubblemark working without that codepath :)
Oct 17 13:44:22 &lt;toshok&gt;	how are you setting numlock in xvfb?
Oct 17 13:44:30 &lt;toshok&gt;	server command line arg?
Oct 17 13:44:31 &lt;spouliot&gt;	kangaroo: my point being that the save|restore does the same thing as commenting - except for the performance gain ;-)
Oct 17 13:44:44 &lt;kangaroo&gt;	spouliot: nod
Oct 17 13:44:46 &lt;kangaroo&gt;	toshok: I'm not
Oct 17 13:44:54 &lt;kangaroo&gt;	doesn't it read from my keyboard?
Oct 17 13:44:57 &lt;toshok&gt;	no
Oct 17 13:45:02 &lt;kangaroo&gt;	well thats lame
Oct 17 13:45:11 &lt;kangaroo&gt;	suggestions?
Oct 17 13:45:26 &lt;toshok&gt;	looking at command line args now, there's no way to set it on there
Oct 17 13:46:10 &lt;kangaroo&gt;	should we just change the test to not require numlock?
Oct 17 13:46:11 &lt;toshok&gt;	we could just assume that it's off and have shocker send a numlock keypress as the first thing it does
Oct 17 13:46:38 &lt;kangaroo&gt;	that would work too
Oct 17 13:46:42 &lt;toshok&gt;	does anyone know xkb well enough to query the modifier state?
Oct 17 13:46:58 &lt;toshok&gt;	afaik there's no way to ask X if a key is down, modifier or not
Oct 17 13:49:23 &lt;kangaroo&gt;	not that I'm aware of
Oct 17 13:49:33 &lt;kangaroo&gt;	but I am not an xkb-monk by any stretch of the imagination
Oct 17 13:49:37 &lt;lupus&gt;	spouliot: <A HREF="http://monoport.com/37778">http://monoport.com/37778</A>
Oct 17 13:49:58 &lt;lupus&gt;	spouliot: that makes bubblemark work for me as well, without the save/restore
Oct 17 13:52:06 &lt;kangaroo&gt;	lupus: can you dump the Rect for me?
Oct 17 13:52:11 &lt;toshok&gt;	kangaroo: sec, i have a fix i think
Oct 17 13:52:34 &lt;lupus&gt;	the rect is already unused with the above patch
Oct 17 13:52:40 &lt;spouliot&gt;	lupus: the more agressive <A HREF="http://monoport.com/37779">http://monoport.com/37779</A> works for me too - but that would break other stuff, like the previous patches
Oct 17 13:52:55 &lt;kangaroo&gt;	lupus: yes
Oct 17 13:52:58 &lt;kangaroo&gt;	and if you put the rect in
Oct 17 13:53:01 &lt;kangaroo&gt;	it stops working
Oct 17 13:53:01 &lt;kangaroo&gt;	?
Oct 17 13:53:08 &lt;kangaroo&gt;	the r.Draw call
Oct 17 13:53:14 &lt;kangaroo&gt;	no?
Oct 17 13:53:15 &lt;lupus&gt;	spouliot: well, I was supposing region.Draw() actually did something:)
Oct 17 13:53:29 &lt;lupus&gt;	spouliot: what does break with my change (removing the clips)
Oct 17 13:53:38 &lt;toshok&gt;	kangaroo: k, if you update the test harness it *should* work
Oct 17 13:54:08 &lt;kangaroo&gt;	toshok: moonbuild should do it automagically if you commited
Oct 17 13:54:14 &lt;toshok&gt;	k
Oct 17 13:55:14 &lt;spouliot&gt;	lupus: lewin1 could probably answer that quickly, I'm running the test suite now (with everything commented).
Oct 17 13:56:00 &lt;lupus&gt;	kangaroo: it's the rect.Draw/clip that causes the slowdown
Oct 17 13:56:49 &lt;lupus&gt;	well, slowdown is an understatement, let's say nearly complete halt:)
Oct 17 13:57:41 *	spouliot thinks the right term is &quot;near optimal slowdown&quot; ;-)
Oct 17 13:57:52 &lt;kangaroo&gt;	lupus: yeah
Oct 17 13:58:00 &lt;kangaroo&gt;	so I want to know what the coords of the rect are :)
Oct 17 13:58:08 &lt;toshok&gt;	that's strange
Oct 17 13:58:15 &lt;toshok&gt;	because unless the rect is enormous, it should speed it up
Oct 17 13:58:19 &lt;kangaroo&gt;	toshok: exactly
Oct 17 13:58:29 &lt;toshok&gt;	the rect (and the clip) determine the size of the temporary surface cairo creates
Oct 17 14:00:41 &lt;lupus&gt;	x: 152.000000 y: 198.000000 width: 44.000000 height: 45.000000
Oct 17 14:00:56 &lt;lupus&gt;	that's the last one that happens before it 'halts'
Oct 17 14:01:19 &lt;lupus&gt;	there are a few dozen per iteration and they all look normal
Oct 17 14:02:09 &lt;kangaroo&gt;	that makes no sense :(
...
Oct 17 14:08:46 &lt;lupus&gt;	note: sometimes, if I run in gdb and ctrl-c when it halts, and continue, the rendering speedups to normal speed
Oct 17 14:08:48 &lt;kangaroo&gt;	of course we cheated by just marking 177 as K :)
Oct 17 14:09:11 &lt;kangaroo&gt;	lupus: sounds like some sort of weird race condition that you're getting into
Oct 17 14:09:23 &lt;kangaroo&gt;	 / out of
Oct 17 14:09:43 &lt;lupus&gt;	yes, except it's not me, but moonlight:)
Oct 17 14:09:56 &lt;kangaroo&gt;	well, I meant you as in on your machine since none of us see it :(
...
Oct 17 14:12:12 &lt;lupus&gt;	anyway, I need to go, if you guys come up with a better fix for me to try let me know
Oct 17 14:12:16 &lt;kangaroo&gt;	you can run multiple threads
Oct 17 14:12:18 &lt;kangaroo&gt;	lupus: willdo
Oct 17 14:12:27 &lt;kangaroo&gt;	lupus: thanks for debugging
...
Oct 17 14:36:27 &lt;spouliot&gt;	lupus: funny, in a strange not comical way, but that block of code does not seems to affect any DRT test
...
Oct 17 14:50:08 &lt;lupus&gt;	spouliot: good, chop, chop, chop:)
Oct 17 14:52:23 &lt;spouliot&gt;	lupus: I'll leet larry do the actual chop-ing - because I'm still convinced there's a reason behind it :)
Oct 17 14:53:12 &lt;kangaroo&gt;	well the huge comment is probably indicative of what it was designed to do :)


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000155.html">[Moonlight-list] Impossibly high fps on bubblemark
</A></li>
	<LI>Next message: <A HREF="000157.html">[Moonlight-list] trunk development
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#156">[ date ]</a>
              <a href="thread.html#156">[ thread ]</a>
              <a href="subject.html#156">[ subject ]</a>
              <a href="author.html#156">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
