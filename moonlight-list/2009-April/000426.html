<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] Fwd: Adding some [InternalsVisibleTo] in moonlight	assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Fwd%3A%20Adding%20some%20%5BInternalsVisibleTo%5D%20in%20moonlight%0A%09assemblies&In-Reply-To=e7253e5b0904161059j35000d95hdb2d2b07d09be235%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000420.html">
   <LINK REL="Next"  HREF="000427.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] Fwd: Adding some [InternalsVisibleTo] in moonlight	assemblies</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Fwd%3A%20Adding%20some%20%5BInternalsVisibleTo%5D%20in%20moonlight%0A%09assemblies&In-Reply-To=e7253e5b0904161059j35000d95hdb2d2b07d09be235%40mail.gmail.com"
       TITLE="[Moonlight-list] Fwd: Adding some [InternalsVisibleTo] in moonlight	assemblies">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Thu Apr 16 13:59:51 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000420.html">[Moonlight-list] Where to get the alpha
</A></li>
        <LI>Next message: <A HREF="000427.html">[Moonlight-list] patch to simulate bold &amp; italics for Glyphs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#426">[ date ]</a>
              <a href="thread.html#426">[ thread ]</a>
              <a href="subject.html#426">[ subject ]</a>
              <a href="author.html#426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>oops, attachment was too big. See the lines starting with &quot;[check]&quot; in
<A HREF="http://sublimeintervention.com:8123/GetFile.aspx?id=3854835">http://sublimeintervention.com:8123/GetFile.aspx?id=3854835</A> to see the
entries

On Thu, 2009-04-16 at 13:59 -0400, Sebastien Pouliot wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I don't know if people notice the extra &quot;[check]&quot; output while
</I>&gt;<i> building moonlight (see attached file). JB re-activated this about two
</I>&gt;<i> weeks ago, just before doing on vacations. This is a list of problems,
</I>&gt;<i> actually accessibility checks, that the tuner is reporting after
</I>&gt;<i> &quot;internalizing&quot; the Moonlight assemblies (to match MS SL2 API).
</I>&gt;<i> 
</I>&gt;<i> This is causing problems to some assemblies (like
</I>&gt;<i> Mono.CompilerServices.SymbolWriter.dll, used indirectly by the DLR).
</I>&gt;<i> How did it work before ? Well the Mono JIT does not check
</I>&gt;<i> accessibility (the compilers does that) and the verifier, once
</I>&gt;<i> enabled, had a bug wrt this. So it took a while (and the extra checks
</I>&gt;<i> in coreclr ;-) to find out.
</I>&gt;<i> 
</I>&gt;<i> The quick way to solve most of those issues is to add some
</I>&gt;<i> [InternalsVisibleTo] between the Moonlight assemblies (just like MS
</I>&gt;<i> does according to gui-compare). I don't like [InternalsVisibleTo],
</I>&gt;<i> never had and likely never will (except for unit testing) however this
</I>&gt;<i> is the only solution that does not involve re-writing existing code
</I>&gt;<i> and/or applying a bunch of #if NET_2_1 into mcs/class, which would be
</I>&gt;<i> IMO much worse.
</I>&gt;<i>  
</I>&gt;<i> So unless someone has a better idea I'll be adding the new
</I>&gt;<i> [InternalsVisibleTo] shortly in SVN.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> Sebastien
</I>&gt;<i> 
</I>&gt;<i> p.s. small side bonus we can use this to reduce code duplication, e.g
</I>&gt;<i> mscorlib.dll non-generic collections are copied (well referenced) in 3
</I>&gt;<i> other assemblies, which adds an extra 60kb of code.
</I>&gt;<i> 
</I>&gt;<i> p.p.s. security wise using [InternalsVisibleTo] is easier to track,
</I>&gt;<i> statically, than using reflection. It's also not a problem as long as
</I>&gt;<i> we're not opening the platform code internals to non-platform
</I>&gt;<i> (application) assemblies.
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000420.html">[Moonlight-list] Where to get the alpha
</A></li>
	<LI>Next message: <A HREF="000427.html">[Moonlight-list] patch to simulate bold &amp; italics for Glyphs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#426">[ date ]</a>
              <a href="thread.html#426">[ thread ]</a>
              <a href="subject.html#426">[ subject ]</a>
              <a href="author.html#426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
