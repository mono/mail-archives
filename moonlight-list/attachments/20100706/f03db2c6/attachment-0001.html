<tt>
I&nbsp;didn&amp;#39;t&nbsp;do&nbsp;*any*&nbsp;cleanup,&nbsp;I&nbsp;just&nbsp;wanted&nbsp;to&nbsp;get&nbsp;this&nbsp;out&nbsp;so&nbsp;that&nbsp;we&nbsp;could&nbsp;start&nbsp;talking&nbsp;about&nbsp;it.&nbsp; I&amp;#39;ll&nbsp;see&nbsp;if&nbsp;I&nbsp;can&nbsp;remember&nbsp;the&nbsp;salient&nbsp;bits.&lt;br&gt;&lt;br&gt;&lt;ol&gt;&lt;li&gt;In&nbsp;unmanaged&nbsp;code,&nbsp;EnsureManagedRef&nbsp;is&nbsp;called&nbsp;on&nbsp;all&nbsp;objects&nbsp;which&nbsp;have&nbsp;a&nbsp;managed&nbsp;peer&nbsp;defined&nbsp;so&nbsp;that&nbsp;the&nbsp;managed&nbsp;object&nbsp;is&nbsp;created. &nbsp;To&nbsp;ensure&nbsp;this&nbsp;was&nbsp;happening,&nbsp;I&nbsp;made&nbsp;all&nbsp;the&nbsp;ctors&nbsp;protected&nbsp;and&nbsp;made&nbsp;two&nbsp;factory&nbsp;classes&nbsp;(MoonUnmanagedFactory&nbsp;and&nbsp;MoonManagedFactory). &nbsp;MoonUnmanagedFactory&nbsp;creates&nbsp;the&nbsp;object&nbsp;and&nbsp;calls&nbsp;EnsureManagedRef&nbsp;on&nbsp;it. &nbsp;MoonManagedFactory&nbsp;doesn&amp;#39;t&nbsp;call&nbsp;EnsureManagedRef,&nbsp;since&nbsp;the&nbsp;call&nbsp;is&nbsp;already&nbsp;coming&nbsp;from&nbsp;the&nbsp;managed&nbsp;ctor. &nbsp;I&amp;#39;m&nbsp;not&nbsp;attached&nbsp;to&nbsp;the&nbsp;factory&nbsp;idea&nbsp;(it&nbsp;was&nbsp;mostly&nbsp;just&nbsp;done&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;finding&nbsp;ctor&nbsp;usage&nbsp;in&nbsp;unmanaged&nbsp;land).&lt;br&gt;<br>
&lt;/li&gt;&lt;li&gt;the&nbsp;managed&nbsp;peers&nbsp;register&nbsp;two&nbsp;delegates&nbsp;with&nbsp;unmanaged&nbsp;(AddStrongRef&nbsp;and&nbsp;ClearStrongRef). &nbsp;these&nbsp;let&nbsp;unmanaged&nbsp;code&nbsp;communicate&nbsp;to&nbsp;managed&nbsp;that&nbsp;the&nbsp;managed&nbsp;peer&nbsp;should&nbsp;take&nbsp;out&nbsp;a&nbsp;ref&nbsp;on&nbsp;the&nbsp;given&nbsp;object. &nbsp;The&nbsp;unmanaged&nbsp;code&nbsp;for&nbsp;the&nbsp;most&nbsp;part&nbsp;uses&nbsp;the&nbsp;MOON_SET_FIELD&nbsp;and&nbsp;MOON_CLEAR_FIELD&nbsp;macros,&nbsp;since&nbsp;those&nbsp;register&nbsp;a&nbsp;DestroyedEvent&nbsp;handler&nbsp;in&nbsp;unmanaged&nbsp;land&nbsp;to&nbsp;clear&nbsp;the&nbsp;pointer&nbsp;when&nbsp;the&nbsp;managed&nbsp;GC&nbsp;destroys&nbsp;the&nbsp;referent.&lt;/li&gt;<br>
&lt;li&gt;managed&nbsp;Collections&nbsp;use&nbsp;a&nbsp;CollectionChangedEvent&nbsp;handler&nbsp;to&nbsp;maintain&nbsp;a&nbsp;mirror&nbsp;of&nbsp;the&nbsp;unmanaged&nbsp;list. &nbsp;this&nbsp;means&nbsp;that&nbsp;all&nbsp;read&nbsp;access&nbsp;(either&nbsp;random&nbsp;access&nbsp;or&nbsp;using&nbsp;enumerators)&nbsp;happens&nbsp;entirely&nbsp;in&nbsp;managed&nbsp;code.&lt;/li&gt;&lt;li&gt;<br>
local&nbsp;and&nbsp;autocreated&nbsp;Values&nbsp;present&nbsp;some&nbsp;wrinkles,&nbsp;in&nbsp;that&nbsp;normally&nbsp;the&nbsp;Value&nbsp;would&nbsp;hold&nbsp;a&nbsp;ref&nbsp;to&nbsp;the&nbsp;DO*. &nbsp;A&nbsp;flag&nbsp;is&nbsp;added&nbsp;telling&nbsp;Value&nbsp;whether&nbsp;or&nbsp;not&nbsp;it&nbsp;should&nbsp;unref&nbsp;when&nbsp;destroyed,&nbsp;and&nbsp;we&nbsp;explicitly&nbsp;unref&nbsp;the&nbsp;DO*&nbsp;-&nbsp;and&nbsp;call&nbsp;AddStrongRef&nbsp;-&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;set&nbsp;on&nbsp;a&nbsp;parent&nbsp;DO.&lt;/li&gt;<br>
&lt;li&gt;AddStrongRef&nbsp;can&nbsp;receive&nbsp;a&nbsp;name&nbsp;from&nbsp;unmanaged. &nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;to&nbsp;store&nbsp;the&nbsp;strong&nbsp;managed&nbsp;ref&nbsp;in&nbsp;instance&nbsp;fields&nbsp;instead&nbsp;of&nbsp;in&nbsp;the&nbsp;general&nbsp;dictionary. &nbsp;Deployment.AddStrongRef&nbsp;does&nbsp;that&nbsp;to&nbsp;maintain&nbsp;its&nbsp;Surface&nbsp;property. &nbsp;This&nbsp;is&nbsp;another&nbsp;example&nbsp;of&nbsp;moving&nbsp;the&nbsp;getter&nbsp;completely&nbsp;to&nbsp;managed&nbsp;code&nbsp;-&nbsp;this&nbsp;accessor&nbsp;used&nbsp;to&nbsp;call&nbsp;a&nbsp;pinvoke&nbsp;to&nbsp;get&nbsp;the&nbsp;surface&nbsp;reference.&lt;/li&gt;<br>
&lt;/ol&gt;I&amp;#39;m&nbsp;sure&nbsp;there&amp;#39;s&nbsp;more..&nbsp;I&amp;#39;ll&nbsp;comment&nbsp;more&nbsp;as&nbsp;I&nbsp;remember&nbsp;(or&nbsp;as&nbsp;questions&nbsp;are&nbsp;raised&nbsp;:)&lt;br&gt;&lt;br&gt;chris&lt;br&gt;<br>

</tt>
