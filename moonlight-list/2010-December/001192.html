<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] patch for ClientHttp implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20patch%20for%20ClientHttp%20implementation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001191.html">
   <LINK REL="Next"  HREF="001193.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] patch for ClientHttp implementation</H1>
    <B>Keenan Forbes</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20patch%20for%20ClientHttp%20implementation&In-Reply-To="
       TITLE="[Moonlight-list] patch for ClientHttp implementation">keenan.forbes at ni.com
       </A><BR>
    <I>Thu Dec 16 15:44:24 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001191.html">[Moonlight-list] Mono Class Status,	IsolatedStorageFile.IsEnabled
</A></li>
        <LI>Next message: <A HREF="001193.html">[Moonlight-list] patch for ClientHttp implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1192">[ date ]</a>
              <a href="thread.html#1192">[ thread ]</a>
              <a href="subject.html#1192">[ subject ]</a>
              <a href="author.html#1192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi-
        I'm not sure if this is the proper forum to submit patches... if 
not, just let me know.

I tracked down a problem in the ClientHttp implementation where it 
appeared to be receiving empty responses. Turns out that when the CopyTo 
is performed on the response stream to a MemoryStream that resulting 
stream is never set back to the beginning. The BrowserHttp implementation 
has an explicit Seek in the GetResponseStream, but the ClientHttp was 
missing that. The following patch fixes the problem:

--- a/class/System.Windows/System.Net.Browser/ClientHttpWebResponse.cs
+++ b/class/System.Windows/System.Net.Browser/ClientHttpWebResponse.cs
@@ -159,6 +159,7 @@ namespace System.Net.Browser {
 
                public override Stream GetResponseStream ()
                {
+                       stream.Seek (0, SeekOrigin.Begin);
                        return stream;
                }

An alternative would be to put the Seek() where the MemoryStream is 
initially created, but it seems better to be consistent with the 
BrowserHttp implementation.

Once bug 659791 (<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=659791">https://bugzilla.novell.com/show_bug.cgi?id=659791</A>) is 
fixed, the xap file attached to it will demonstrate the problem. To test 
this patch I just put in a temporary workaround to avoid the bug (the fix 
is a little more complicated). In that testcase, if you switch ClientHttp 
to BrowserHttp you can see the differing behavior.


Also, I had a quick question: Is there any good way to debug moonlight 
applications (like remotely via Dev Studio like for Mono apps)? I was able 
to debug the C portion of moonlight with gdb, but to track down anything 
in the C# I just started dumping Console.WriteLine's all over the place in 
the mono/moonlight code -- which is pretty tedious ;-)

Thanx,

--Keenan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/moonlight-list/attachments/20101216/77e4372c/attachment.html">http://lists.ximian.com/pipermail/moonlight-list/attachments/20101216/77e4372c/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001191.html">[Moonlight-list] Mono Class Status,	IsolatedStorageFile.IsEnabled
</A></li>
	<LI>Next message: <A HREF="001193.html">[Moonlight-list] patch for ClientHttp implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1192">[ date ]</a>
              <a href="thread.html#1192">[ thread ]</a>
              <a href="subject.html#1192">[ subject ]</a>
              <a href="author.html#1192">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
