<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] Remaining work for the Moonlight 4 SDK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Remaining%20work%20for%20the%20Moonlight%204%20SDK&In-Reply-To=BANLkTikZD3BzNrpywO%2B0T8OA-UsSHQZ0bA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001305.html">
   <LINK REL="Next"  HREF="001313.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] Remaining work for the Moonlight 4 SDK</H1>
    <B>Alan</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Remaining%20work%20for%20the%20Moonlight%204%20SDK&In-Reply-To=BANLkTikZD3BzNrpywO%2B0T8OA-UsSHQZ0bA%40mail.gmail.com"
       TITLE="[Moonlight-list] Remaining work for the Moonlight 4 SDK">alan.mcgovern at gmail.com
       </A><BR>
    <I>Mon May 23 09:02:47 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001305.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
        <LI>Next message: <A HREF="001313.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1312">[ date ]</a>
              <a href="thread.html#1312">[ thread ]</a>
              <a href="subject.html#1312">[ subject ]</a>
              <a href="author.html#1312">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Aaaand another issue or two :)

moonlight-desktop has a bit of a problem when it comes to loading
assemblies. The traditional way to load an assembly in a
Moonlight/Silverlight application is to add it to your AppManifest.xaml
file. When the application starts up, all assemblies referenced in the
AppManifest are loaded. If they are core assemblies like System.Windows,
they are loaded automatically by the plugin from the private 'gac' the
plugin has. If they're in the XAP file they are loaded from the directory
where the XAP was decompressed to and finally if they're ExternalParts
assemblies they are downloaded from a remote location to a temporary
directory and loaded from there. This way the assemblies are already loaded
and usable when you start parsing xaml so when the xaml parser sees types
like &quot;sdk:GridSplitter&quot; it already has the correct assembly loaded and can
find the correct type and instantiate it.

The problem with moonlight-desktop is two-fold. First we never parse the
AppManifest.xaml file. Secondly even if we parse it to figure out what
assemblies we have to load, there is no xap containing the SDK assemblies so
we can't load them and end up throwing an AssemblyNotFound exception at
startup. This is because moonlight cannot load the assembly from the GAC
using just the name &quot;System.Windows.Controls.dll&quot;.

We have three possible solutions for this that I can think of.
1) As there are a limited number of assemblies which can be accessed in this
way (just the 6 or so SDK assemblies), then we can potentially hardcode in
specific support for loading these from the GAC when they are detected in a
moonlight-desktop application.

2) Ask people to always copy SDK assemblies locally when compiling their
application. This is already what happens when you build a regular
silverlight/moonlight application.

3) Bundle desktop applications as a regular xap file just like web
applications.

Some distros may not like the idea of applications bundling these SDK
assemblies so maybe providing a mechanism to load the SDK assemblies from
the GAC would be the best option. It would also make it easier to roll out
fixes to moonlight-desktop applications as if there was a bug in an SDK
assembly a simple update of that package would roll the fix out to every
desktop app using the assembly. If they all bundled the assemblies they
would have to be updated individually. This would make option 1 preferable.

Does anyone have any preferences on how to fix or work around this issue?

Alan

On Fri, May 20, 2011 at 7:26 PM, Alan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">alan.mcgovern at gmail.com</A>&gt; wrote:

&gt;<i> Hey,
</I>&gt;<i>
</I>&gt;<i> It'd be trivial to put a dependency in the packages to ensure that if
</I>&gt;<i> you install moonlight-desktop-devel or moonlight-web-devel that you
</I>&gt;<i> also install the debugger enabled moonlight-developer-plugin instead
</I>&gt;<i> of the regular moonlight-plugin. However if it isn't a security issue
</I>&gt;<i> or anything, we can trivially have everything debugger enabled. I'd
</I>&gt;<i> prefer just debugger enabling all our builds but I don't know if
</I>&gt;<i> there'd be an unexpected and unwelcome consequences from that :)
</I>&gt;<i>
</I>&gt;<i> Alan
</I>&gt;<i>
</I>&gt;<i> On Fri, May 20, 2011 at 6:28 PM, Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">miguel at xamarin.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt; &gt;1) Debug support
</I>&gt;<i> &gt;&gt; &gt;Issue: The section of code which initiates SDB is only compiled in
</I>&gt;<i> &gt;&gt; &gt;builds which define the DEBUG symbol. This means that regular release
</I>&gt;<i> &gt;&gt; &gt;builds cannot have a debugger attached. Do we want all our release
</I>&gt;<i> &gt;&gt; &gt;builds to be debuggable or do we want to have a separate 'Developer'
</I>&gt;<i> &gt;&gt; &gt;runtime which has debug support enabled.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;Solution: We can either enable debug support in release builds
</I>&gt;<i> &gt;&gt; &gt;(security issue?) or have a separate moonlight-developer-plugin which
</I>&gt;<i> &gt;&gt; &gt;will collide with/replace the regular moonlight-plugin.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I would like to have debugging available on every build;  If we do not do
</I>&gt;<i> &gt; this, in practice, only 2-3 individuals in the whole planet will be able
</I>&gt;<i> to
</I>&gt;<i> &gt; endure the necessary steps necessary to get Moonlight running on their
</I>&gt;<i> &gt; system to enable debugging.
</I>&gt;<i> &gt; So the fewer steps necessary, the better.
</I>&gt;<i> &gt; Miguel
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/moonlight-list/attachments/20110523/6c89b3ba/attachment.html">http://lists.ximian.com/pipermail/moonlight-list/attachments/20110523/6c89b3ba/attachment.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001305.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
	<LI>Next message: <A HREF="001313.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1312">[ date ]</a>
              <a href="thread.html#1312">[ thread ]</a>
              <a href="subject.html#1312">[ subject ]</a>
              <a href="author.html#1312">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
