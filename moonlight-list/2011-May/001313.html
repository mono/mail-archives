<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] Remaining work for the Moonlight 4 SDK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Remaining%20work%20for%20the%20Moonlight%204%20SDK&In-Reply-To=BANLkTin9OF6znWNUqtsGPMpWN2P7oez7Dw%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001312.html">
   <LINK REL="Next"  HREF="001315.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] Remaining work for the Moonlight 4 SDK</H1>
    <B>Ian Norton</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Remaining%20work%20for%20the%20Moonlight%204%20SDK&In-Reply-To=BANLkTin9OF6znWNUqtsGPMpWN2P7oez7Dw%40mail.gmail.com"
       TITLE="[Moonlight-list] Remaining work for the Moonlight 4 SDK">ian.norton-badrul at thales-esecurity.com
       </A><BR>
    <I>Mon May 23 09:25:49 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001312.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
        <LI>Next message: <A HREF="001315.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1313">[ date ]</a>
              <a href="thread.html#1313">[ thread ]</a>
              <a href="subject.html#1313">[ subject ]</a>
              <a href="author.html#1313">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alan,

On Mon, May 23, 2011 at 02:02:47PM +0100, Alan wrote:
&gt;<i> Aaaand another issue or two :)
</I>
That is fantastic, I can now load the controls I want via a new xmlns in the
xaml which is a huge step forward.  :D
 
&gt;<i> moonlight-desktop has a bit of a problem when it comes to loading assemblies. The traditional way to load an assembly in a Moonlight/Silverlight application is to add it to your AppManifest.xaml file. When the application starts up, all assemblies referenced in the AppManifest are loaded. If they are core assemblies like System.Windows, they are loaded automatically by the plugin from the private 'gac' the plugin has. If they're in the XAP file they are loaded from the directory where the XAP was decompressed to and finally if they're ExternalParts assemblies they are downloaded from a remote location to a temporary directory and loaded from there. This way the assemblies are already loaded and usable when you start parsing xaml so when the xaml parser sees types like &quot;sdk:GridSplitter&quot; it already has the correct assembly loaded and can find the correct type and instantiate it.
</I>&gt;<i> 
</I>&gt;<i> The problem with moonlight-desktop is two-fold. First we never parse the AppManifest.xaml file. Secondly even if we parse it to figure out what assemblies we have to load, there is no xap containing the SDK assemblies so we can't load them and end up throwing an AssemblyNotFound exception at startup. This is because moonlight cannot load the assembly from the GAC using just the name &quot;System.Windows.Controls.dll&quot;.
</I>
Would it be possible for a desktop app to provide a list of AssemblyParts to
moonlight?

&gt;<i> We have three possible solutions for this that I can think of.
</I>&gt;<i> 1) As there are a limited number of assemblies which can be accessed in this way (just the 6 or so SDK assemblies), then we can potentially hardcode in specific support for loading these from the GAC when they are detected in a moonlight-desktop application.
</I>
Hard-coding to a select few also won't help those who want to write thier own
control libraries.
 
&gt;<i> 2) Ask people to always copy SDK assemblies locally when compiling their application. This is already what happens when you build a regular silverlight/moonlight application.
</I>&gt;<i> 
</I>&gt;<i> 3) Bundle desktop applications as a regular xap file just like web applications.
</I>
Don't much like this, like you say, it makes updates hard and distribution a
little strange.

&gt;<i> Some distros may not like the idea of applications bundling these SDK assemblies so maybe providing a mechanism to load the SDK assemblies from the GAC would be the best option. It would also make it easier to roll out fixes to moonlight-desktop applications as if there was a bug in an SDK assembly a simple update of that package would roll the fix out to every desktop app using the assembly. If they all bundled the assemblies they would have to be updated individually. This would make option 1 preferable.
</I>&gt;<i> 
</I>&gt;<i> Does anyone have any preferences on how to fix or work around this issue?
</I>
I was expecting tgat an xmlns include of the form of
'clr-namespace:foo;assembly=foo.dll' to load foo.dll from the local program 
directory or the gac when run as a desktop app (rather just the xap dir in an
OOb app). Would it be possible to supply a callback to the xaml parser for
assembly resolution/loading?

What I would ultimately like is for the desktop profile apps to not require any 
appmanifest at all, One of my programs is xamlpreviewer (basically xamlpad for 
mono). So I won't know all of the assemblies ahead of time.  Before your patch
I could omit the appmanifest file altogether but just not use new xmlns
entries.

Fantasting work btw! :)

Ian
 

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001312.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
	<LI>Next message: <A HREF="001315.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1313">[ date ]</a>
              <a href="thread.html#1313">[ thread ]</a>
              <a href="subject.html#1313">[ subject ]</a>
              <a href="author.html#1313">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
