<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] Remaining work for the Moonlight 4 SDK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Remaining%20work%20for%20the%20Moonlight%204%20SDK&In-Reply-To=BANLkTi%3D1%2BPChwZrepyi1862Zu%2B2jWhfqzQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001315.html">
   <LINK REL="Next"  HREF="001319.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] Remaining work for the Moonlight 4 SDK</H1>
    <B>Ian Norton</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Remaining%20work%20for%20the%20Moonlight%204%20SDK&In-Reply-To=BANLkTi%3D1%2BPChwZrepyi1862Zu%2B2jWhfqzQ%40mail.gmail.com"
       TITLE="[Moonlight-list] Remaining work for the Moonlight 4 SDK">ian.norton-badrul at thales-esecurity.com
       </A><BR>
    <I>Wed May 25 15:14:02 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001315.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
        <LI>Next message: <A HREF="001319.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1318">[ date ]</a>
              <a href="thread.html#1318">[ thread ]</a>
              <a href="subject.html#1318">[ subject ]</a>
              <a href="author.html#1318">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, May 23, 2011 at 03:44:49PM +0100, Alan wrote:
&gt;<i> &gt; &gt; Some distros may not like the idea of applications bundling these SDK
</I>&gt;<i> &gt; &gt; assemblies so maybe providing a mechanism to load the SDK assemblies from
</I>&gt;<i> &gt; &gt; the GAC would be the best option. It would also make it easier to roll out
</I>&gt;<i> &gt; &gt; fixes to moonlight-desktop applications as if there was a bug in an SDK
</I>&gt;<i> &gt; &gt; assembly a simple update of that package would roll the fix out to every
</I>&gt;<i> &gt; &gt; desktop app using the assembly. If they all bundled the assemblies they
</I>&gt;<i> &gt; &gt; would have to be updated individually. This would make option 1
</I>&gt;<i> &gt; &gt; preferable.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Does anyone have any preferences on how to fix or work around this issue?
</I> 
&gt;<i> &gt; I was expecting tgat an xmlns include of the form of
</I>&gt;<i> &gt; 'clr-namespace:foo;assembly=foo.dll' to load foo.dll from the local program
</I>&gt;<i> &gt; directory or the gac when run as a desktop app (rather just the xap dir in an
</I>&gt;<i> &gt; OOb app). Would it be possible to supply a callback to the xaml parser for
</I>&gt;<i> &gt; assembly resolution/loading?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What I would ultimately like is for the desktop profile apps to not require any
</I>&gt;<i> &gt; appmanifest at all, One of my programs is xamlpreviewer (basically xamlpad for
</I>&gt;<i> &gt; mono). So I won't know all of the assemblies ahead of time.  Before your patch
</I>&gt;<i> &gt; I could omit the appmanifest file altogether but just not use new xmlns
</I>&gt;<i> &gt; entries.
</I>&gt;<i> 
</I>&gt;<i> In order to load an assembly from the GAC we need to know the full name of
</I>&gt;<i> the assembly, i.e. the name in the form &quot;System.Windows.Controls,
</I>&gt;<i> Version=2.0.5.0, Culture=neutral, PublicKeyToken=0738eb9f132ed756&quot;. The xaml
</I>&gt;<i> used should be identical between web and desktop cases so the simplest
</I>&gt;<i> solution is probably to augment the AppManifest.xaml file to add an
</I>&gt;<i> additional entry which maps filename to assembly fullname. Something like:
</I>&gt;<i> 
</I>&gt;<i> &lt;Assembly FileName=&quot;System.Windows.Controls.dll&quot;
</I>&gt;<i> FullName=&quot;System.Windows.Controls, Version=2.0.5.0, Culture=neutral,
</I>&gt;<i> PublicKeyToken=0738eb9f132ed756&quot; /&gt;
</I>&gt;<i> 
</I>&gt;<i> Without that mapping it's not possible to load up arbitrary assemblies in the
</I>&gt;<i> desktop case. This is likely to be an issue if you're loading arbitrary
</I>&gt;<i> assemblies at runtime and trying to use types from those assemblies via xaml.
</I>&gt;<i> To do this the runtime will have to be informed of any new filename to
</I>&gt;<i> assembly mappings in the dynamically loaded assembly/xaml. I should look into
</I>&gt;<i> how WPF handles this kind of thing.
</I>
I have taken a quick fork of moon to try this out, For desktop apps I've
allowed pre-loading a list of assemblies ( it's up to the caller how they load
them, gac loading or LoadFromFile etc ) <A HREF="https://github.com/inorton/moon.">https://github.com/inorton/moon.</A>

I've not quite figured the nicest API to do this, but I've been able to
trivially use 'xmlns:foo=&quot;clr-namespace:Whatever.Class&quot;' in xaml. If I've
supplied a list of assemblies before the xaml is loaded (with my changes) then
everything seems to work.

This doesnt load the appmanifest for desktop mode. (Though in doing this the
#define for 'built for desktop' doesn't seem that clear ( #if !NET_2_1 ? )

Best Regards

Ian


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001315.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
	<LI>Next message: <A HREF="001319.html">[Moonlight-list] Remaining work for the Moonlight 4 SDK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1318">[ date ]</a>
              <a href="thread.html#1318">[ thread ]</a>
              <a href="subject.html#1318">[ subject ]</a>
              <a href="author.html#1318">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
