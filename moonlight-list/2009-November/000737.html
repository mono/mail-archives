<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] initial bitmap caching
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20initial%20bitmap%20caching&In-Reply-To=1258508119.1067.82.camel%40opensuse-gnome.nomad">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000731.html">
   <LINK REL="Next"  HREF="000732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] initial bitmap caching</H1>
    <B>Larry Ewing</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20initial%20bitmap%20caching&In-Reply-To=1258508119.1067.82.camel%40opensuse-gnome.nomad"
       TITLE="[Moonlight-list] initial bitmap caching">lewing at gmail.com
       </A><BR>
    <I>Wed Nov 18 11:37:19 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000731.html">[Moonlight-list] initial bitmap caching
</A></li>
        <LI>Next message: <A HREF="000732.html">[Moonlight-list] Video on demand player NPO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#737">[ date ]</a>
              <a href="thread.html#737">[ thread ]</a>
              <a href="subject.html#737">[ subject ]</a>
              <a href="author.html#737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Nov 17, 2009 at 7:35 PM, David Reveman &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">davidr at novell.com</A>&gt; wrote:
&gt;<i> not sure I understand the xaml parsing code completely yet. the attached
</I>&gt;<i> patch to xaml.cpp (moon-cache-mode-from-str.diff) is required to parse
</I>&gt;<i> the &quot;CacheMode&quot; property as a none XAML property element. works but i
</I>&gt;<i> don't know if this is the appropriate way to solve this..
</I>&gt;<i>
</I>&gt;<i> moon-bitmap-cache.diff is some initial code that implements bitmap
</I>&gt;<i> caching. likely not exactly what we want to use but it works ok and
</I>&gt;<i> gives about 100% performance improvement to a simple test like
</I>&gt;<i> bubblemark.com. it's completely broken in the sense that it doesn't
</I>&gt;<i> invalidate the bitmap cache as the sub-hierarchy of a uielement changes.
</I>&gt;<i> there seems to be a lot of unnecessary invalidation taking place right
</I>&gt;<i> now which makes the bitmap cache useless and that needs to be resolved
</I>&gt;<i> first..
</I>&gt;<i>
</I>
We're definitely invalidating too much right now much it of because of
how the rendering system had to change between moonlight 1 and 2.  I
haven't yet had time to go back and clean things up but there should
be some low hanging fruit.

&gt;<i> another problem in the patch is the ugly handling of the LayoutClip.
</I>&gt;<i> this is because the layout clip is not passed top-down through the
</I>&gt;<i> hierarchy during rendering but instead fetched bottom-up, which prevents
</I>&gt;<i> the bitmap caching code from properly making adjustments to the layout.
</I>
Yeah the bottom up fetch is an artifact of trying to figure out how it
is supposed to work in Silverlight.  You should be able to carry the
layout clip down as part of the render pass but be aware that it has a
separate coordinate space from the global render transform so you'll
need to keep track of it separately.  It accumulates the layout
transform only as you go down the tree and is then applied in the
child's coordinate space.  The bottom up fetch is near the top of my
list of things to fix so if you have questions or would rather work on
something else let me know.

&gt;<i> i'm currently working on fixing the invalidation and layout clipping
</I>&gt;<i> problems as they are crucial to implementing other features like
</I>&gt;<i> perspective transformations and pixel shaders. ideas and recommendations
</I>&gt;<i> are of course much appreciated.
</I>&gt;<i>
</I>
My only advice here is that you don't have to wait to get the
invalidation logic sorted out before putting the broader features even
if it is required for them to be useful in practice.  Debugging
invalidations is something many eyes can help on and is often easier
to follow and bisect regressions if done incrementally in the tree.
Great to see some progress on this stuff.

--Larry
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000731.html">[Moonlight-list] initial bitmap caching
</A></li>
	<LI>Next message: <A HREF="000732.html">[Moonlight-list] Video on demand player NPO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#737">[ date ]</a>
              <a href="thread.html#737">[ thread ]</a>
              <a href="subject.html#737">[ subject ]</a>
              <a href="author.html#737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
