<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] [PATCH] Removal of MOON_A11Y_INTERNAL_HACK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20%5BPATCH%5D%20Removal%20of%20MOON_A11Y_INTERNAL_HACK&In-Reply-To=1259587785.24801.18.camel%40mizar.home">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000759.html">
   <LINK REL="Next"  HREF="000762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] [PATCH] Removal of MOON_A11Y_INTERNAL_HACK</H1>
    <B>&quot;Andr&#233;s G. Aragoneses&quot;</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20%5BPATCH%5D%20Removal%20of%20MOON_A11Y_INTERNAL_HACK&In-Reply-To=1259587785.24801.18.camel%40mizar.home"
       TITLE="[Moonlight-list] [PATCH] Removal of MOON_A11Y_INTERNAL_HACK">knocte at gmail.com
       </A><BR>
    <I>Mon Nov 30 19:08:06 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000759.html">[Moonlight-list] [PATCH] Removal of MOON_A11Y_INTERNAL_HACK
</A></li>
        <LI>Next message: <A HREF="000762.html">[Moonlight-list] [PATCH] Removal of MOON_A11Y_INTERNAL_HACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#761">[ date ]</a>
              <a href="thread.html#761">[ thread ]</a>
              <a href="subject.html#761">[ subject ]</a>
              <a href="author.html#761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
To summarize, the requested revisions to backport are:

* r146790+r146791
* r147098+r147107
* r147111

Thanks.


Sebastien Pouliot escribi&#243;:
&gt;<i> Hello Andr&#233;s,
</I>&gt;<i> 
</I>&gt;<i> On Mon, 2009-11-30 at 13:56 -0500, &quot;Andr&#233;s G. Aragoneses&quot; wrote:
</I>&gt;&gt;<i> Sebastien Pouliot escribi&#243;:
</I>&gt;&gt;&gt;<i> On Wed, 2009-11-25 at 09:58 -0500, &quot;Andr&#233;s G. Aragoneses&quot; wrote:
</I>&gt;&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Sebastien Pouliot escribi&#243;:
</I>&gt;&gt;&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> The only extra thing worth mentioning is that today MoonAtkBridge works
</I>&gt;&gt;&gt;&gt;&gt;<i> only with the XPI (i.e. it won't be considered platform code otherwise,
</I>&gt;&gt;&gt;&gt;&gt;<i> so it just won't be able to work). Now that's likely not a big issue for
</I>&gt;&gt;&gt;&gt;&gt;<i> most users - at least until some distro begin to ship their own
</I>&gt;&gt;&gt;&gt;&gt;<i> packages. 
</I>&gt;&gt;&gt;&gt;<i> I think we'll work to get the non-XPI initialization at some point, but
</I>&gt;&gt;&gt;&gt;<i> it's not a priority for the first release.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Except it also means that no moonlight developers will be using it &quot;day
</I>&gt;&gt;&gt;&gt;&gt;<i> to day&quot;, like when running most of the tests. Which in turns means that
</I>&gt;&gt;&gt;&gt;&gt;<i> any breaking change will go unnoticed... until someone in a11y
</I>&gt;&gt;&gt;&gt;&gt;<i> finds/report the issue. But that's a limitation I have no problem living
</I>&gt;&gt;&gt;&gt;&gt;<i> with ;-)
</I>&gt;&gt;&gt;&gt;<i> It's a limitation that was present as well when we did the work on
</I>&gt;&gt;&gt;&gt;<i> Windows.Forms
</I>&gt;&gt;&gt;<i> Yep, same limitation but a very different context. We're running
</I>&gt;&gt;&gt;<i> untrusted code in the plugin so crashes in any fully-trusted code, like
</I>&gt;&gt;&gt;<i> MoonAtkBrigde, is way more problematic than a (fully-trusted) MFW-based
</I>&gt;&gt;&gt;<i> app is.
</I>&gt;&gt;<i> You mean crashes in MoonAtkBridge could open security back doors?
</I>&gt;<i> 
</I>&gt;<i> Yes, crashes occurring in platform(managed)/plugin(unmanaged) code can
</I>&gt;<i> lead to exploits driven by application(untrusted/managed) code. As such
</I>&gt;<i> you cannot compare MoonAtkBridge to what is provided for MWF.
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i>  (or are you telling me any of the people in the Mono team
</I>&gt;&gt;&gt;&gt;<i> enabled accessibility to run the tests? ;)
</I>&gt;&gt;&gt;<i> Can't say for others - but I admit I never used it (not that I worked
</I>&gt;&gt;&gt;<i> on, or used much, MWF myself ;-).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Anyway, we have a pretty competent QA team and our automated-test suites
</I>&gt;&gt;&gt;&gt;<i> are run in a continious integration system (if you need more info, ask
</I>&gt;&gt;&gt;&gt;<i> Stephen Shaw) all the time.
</I>&gt;&gt;&gt;<i> I have no doubt it's tested. However I can't recall many reports that
</I>&gt;&gt;&gt;<i> detected Moonlight's own, full or partial, build failures (but it's
</I>&gt;&gt;&gt;<i> entirely possible I could have missed them).
</I>&gt;&gt;<i> We have detected them sometimes, but didn't announce in the channel
</I>&gt;&gt;<i> because we thought you got already buildbot infrastructure to detect
</I>&gt;&gt;<i> them as well.
</I>&gt;<i> 
</I>&gt;<i> Heh, that's exactly my point below :)
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> Now I'm pretty sure some failures have make it impossible to run a11y
</I>&gt;&gt;&gt;<i> tests (generally because our own could not execute). That makes me
</I>&gt;&gt;&gt;<i> wonder how long it would take to catch a moonlight bug affecting *only*
</I>&gt;&gt;&gt;<i> a11y...
</I>&gt;<i> 
</I>&gt;<i> ^^^ I now wonder even more ;-)
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> But like I said &quot;that's a limitation I have no problem living with&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Some comments on the patch itself...
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> On Tue, 2009-11-24 at 20:55 -0500, &quot;Andr&#233;s G. Aragoneses&quot; wrote:
</I>&gt;&gt;&gt;&gt;<i> &lt;snip/&gt;
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Index: class/Moon.Windows.Desktop/Makefile.am
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> ===================================================================
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> --- class/Moon.Windows.Desktop/Makefile.am      (revisi&#243;n: 146453)
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> +++ class/Moon.Windows.Desktop/Makefile.am      (copia de trabajo)
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> @@ -17,12 +17,6 @@
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  CSCFLAGS = /codepage:65001 -d:SANITY -d:NET_1_1 -d:NET_2_0
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -d:MOONLIGHT -debug+ -noconfig -r:System -r:System.Core -r:System.Xml
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -d:AGCLR -unsafe
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -## this hack will be dropped once we get this working:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -##
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://www.mono-project.com/Moonlight/SecurityStatus#Assembly_Loading">http://www.mono-project.com/Moonlight/SecurityStatus#Assembly_Loading</A>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -if MOON_A11Y_INTERNAL_HACK
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -CSCFLAGS += -define:MOON_A11Y_INTERNAL_HACK
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -endif
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  GMCS = MONO_PATH=&quot;../lib/moonlight:$$MONO_PATH&quot; gmcs $(CSCFLAGS)
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -lib:../lib/moonlight -d:NET_3_0
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  GACUTIL = gacutil /gacdir $(DESTDIR)$(prefix)/lib /root
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> $(DESTDIR)$(prefix)/lib
</I>&gt;&gt;&gt;&gt;&gt;<i> Was that a copy/paste of another assembly ? (I don't think the variable
</I>&gt;&gt;&gt;&gt;&gt;<i> is used inside this directory) or is A11Y meant to be supported on the
</I>&gt;&gt;&gt;&gt;&gt;<i> desktop (without firefox) ?
</I>&gt;&gt;&gt;&gt;<i> No, we're not testing a11y for now out of the browser, so I guess the
</I>&gt;&gt;&gt;&gt;<i> inclusion of those lines in that Makefile.am was a mistake.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Index: class/System.Windows/Assembly/AssemblyInfo.cs
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> ===================================================================
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> --- class/System.Windows/Assembly/AssemblyInfo.cs       (revisi&#243;n:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> 146453)
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> +++ class/System.Windows/Assembly/AssemblyInfo.cs       (copia de
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> trabajo)
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> @@ -101,6 +101,4 @@
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  [assembly: InternalsVisibleTo (&quot;System.Windows.Browser,
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> PublicKey=002400000480000094000000060200000024000052534131000400000100010079159977d2d03a8e6bea7a2e74e8d1afcc93e8851974952bb480a12c9134474d04062447c37e0e68c080536fcf3c3fbe2ff9c979ce998475e506e8ce82dd5b0f350dc10e93bf2eeecf874b24770c5081dbea7447fddafa277b22de47d6ffea449674a4f9fccf84d15069089380284dbdd35f46cdff12a1bd78e4ef0065d016df&quot;)]
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  [assembly: InternalsVisibleTo (&quot;Moonlight.Gtk,
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> PublicKey=002400000480000094000000060200000024000052534131000400001100000005E62DA51722818A2ADC73D5CE64289260012A442031582E808F5C290EF155F10AB93441F92A7A59736D3481245ED4E0E864F5E1ACCADD217D53EE0263E6E3852FE94AB6B708984C6C69BA79F40A0896E1FFF820B7C55D4968C8F41CAE2AABC136B16B8AF83D013946CE190BC03C2A6C8DE8C0CB135ED656F46BF9A2D03E8188&quot;)]
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  #endif
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -#if MOON_A11Y_INTERNAL_HACK
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>  [assembly: InternalsVisibleTo (&quot;MoonAtkBridge,
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> PublicKey=00240000048000009400000006020000002400005253413100040000110000004bb98b1af6c1df0df8c02c380e116b7a7f0c8c827aecfccddc6e29b7c754cd608b49dfcef4df9699ad182e50f66afa4e68dabc7b6aeeec0aa4719a5f8e0aae8c193080a706adc3443a8356b1f254142034995532ac176398e12a30f6a74a119a89ac47672c9ae24d7e90de686557166e3b873cd707884431a0451d9d6f7fe795&quot;)]
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> -#endif
</I>&gt;&gt;&gt;&gt;&gt;<i> Like previous. If this is for firefox *only* then it should be inside
</I>&gt;&gt;&gt;&gt;&gt;<i> the NET_2_1 define (and not present for NET_3_0).
</I>&gt;&gt;&gt;&gt;<i> We may be interested in providing a11y in the desktop at some point, but
</I>&gt;&gt;&gt;&gt;<i> for now I'll use the NET_2_1 define.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Index: class/System.Windows/Makefile.am
</I>&gt;&gt;&gt;&gt;&gt;<i> Great work BTW. I'm glad to see this going on the &quot;by default&quot; road :-)
</I>&gt;&gt;&gt;&gt;<i> Thanks! So, can the patch go in with your comments addressed?
</I>&gt;&gt;&gt;<i> Yes, you can commit on HEAD when* everything builds and test fine
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;<i> Sebastien
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> *afaik it should not work, otherwise I have another bug to fix ;-)
</I>&gt;&gt;<i> What do you mean? It's working for me with r146453 and my patches.
</I>&gt;&gt;<i> Should I wait to commit until you fix that bug? 
</I>&gt;<i> 
</I>&gt;<i> No. Update to moon HEAD and if this works (all the build + moon-unit
</I>&gt;<i> tests for you locally) then it's my own bug, so please commit. I'll
</I>&gt;<i> check the bot results and fix my bug.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Sebastien
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Moonlight-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">Moonlight-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">http://lists.ximian.com/mailman/listinfo/moonlight-list</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000759.html">[Moonlight-list] [PATCH] Removal of MOON_A11Y_INTERNAL_HACK
</A></li>
	<LI>Next message: <A HREF="000762.html">[Moonlight-list] [PATCH] Removal of MOON_A11Y_INTERNAL_HACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#761">[ date ]</a>
              <a href="thread.html#761">[ thread ]</a>
              <a href="subject.html#761">[ subject ]</a>
              <a href="author.html#761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
