<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] Strange KeyEventArgs Key &amp; PlatformKeyCode values
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Strange%20KeyEventArgs%20Key%20%26%20PlatformKeyCode%20values&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000873.html">
   <LINK REL="Next"  HREF="000878.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] Strange KeyEventArgs Key &amp; PlatformKeyCode values</H1>
    <B>monofool</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20Strange%20KeyEventArgs%20Key%20%26%20PlatformKeyCode%20values&In-Reply-To="
       TITLE="[Moonlight-list] Strange KeyEventArgs Key &amp; PlatformKeyCode values">sean at jellyfish.co.nz
       </A><BR>
    <I>Fri Feb  5 16:04:39 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000873.html">[Moonlight-list] Chrome and FF3.6 support on trunk
</A></li>
        <LI>Next message: <A HREF="000878.html">[Moonlight-list] Strange KeyEventArgs Key &amp; PlatformKeyCode values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#875">[ date ]</a>
              <a href="thread.html#875">[ thread ]</a>
              <a href="subject.html#875">[ subject ]</a>
              <a href="author.html#875">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I downloaded the Mono 2.6.1 VMware image to test the portability of my Apple
IIe emulator, Virtu (<A HREF="http://virtu.codeplex.com/">http://virtu.codeplex.com/</A>), to Moonlight and hence
Linux. I built the project that targets Silverlight 3 (on Windows) and then
dropped the output folder onto the VM and opened the TestPage. It was
awesome to see the binary portability 'just worked' as I had hoped! ;)

However, I've hit a problem adding support for the 'OEM' keys in the
keyboard event handlers. Basically, the values for these keys are not
portable in Silverlight - the KeyEventArgs.Key is usually Key.Unknown (see
below) so you need to interpret the KeyEventArgs.PlatformKeyCode for each
Environment.OSVersion.Platform. The values I'm seeing do not behave the same
way as on Windows and Mac OS X, so I was wondering if it was a problem with
the Linux keyboard configuration, or maybe even a bug in Moonlight?

So given a standard US keyboard layout
(<A HREF="http://en.wikipedia.org/wiki/Template:Keyboard">http://en.wikipedia.org/wiki/Template:Keyboard</A>), ignoring everything except
the main keys
(<A HREF="http://en.wikipedia.org/wiki/File:KB_United_States-NoAltGr.svg">http://en.wikipedia.org/wiki/File:KB_United_States-NoAltGr.svg</A>), scanning
from top left to bottom right I press the following OEM keys: `-=[]\;',./
which when shifted should generate ~_+{}|:&quot;&lt;&gt;? instead. Hopefully that makes
sense.

The following shows the values I get from the Silverlight key event handlers
on Windows:

KeyPressed     KeyEventArgs.Key       KeyEventArgs.PlatformKeyCode

`              Key.Unknown (0xFF)     0xC0
-              Key.Unknown (0xFF)     0xBD
=              Key.Unknown (0xFF)     0xBB
[              Key.Unknown (0xFF)     0xDB
]              Key.Unknown (0xFF)     0xDD
\              Key.Unknown (0xFF)     0xDC
;              Key.Unknown (0xFF)     0xBA
'              Key.Unknown (0xFF)     0xDE
,              Key.Unknown (0xFF)     0xBC
.              Key.Unknown (0xFF)     0xBE
/              Key.Unknown (0xFF)     0xBF
Shift ` (~)    Key.Unknown (0xFF)     0xC0
Shift - (_)    Key.Unknown (0xFF)     0xBD
Shift = (+)    Key.Unknown (0xFF)     0xBB
Shift [ ({)    Key.Unknown (0xFF)     0xDB
Shift ] (})    Key.Unknown (0xFF)     0xDD
Shift \ (|)    Key.Unknown (0xFF)     0xDC
Shift ; (:)    Key.Unknown (0xFF)     0xBA
Shift ' (&quot;)    Key.Unknown (0xFF)     0xDE
Shift , (&lt;)    Key.Unknown (0xFF)     0xBC
Shift . (&gt;)    Key.Unknown (0xFF)     0xBE
Shift / (?)    Key.Unknown (0xFF)     0xBF

Note that the behaviour is consistent. The KeyEventArgs.Key is always
Key.Unknown and the KeyEventArgs.PlatformKeyCode is always the same given
the same KeyPressed - regardless of whether or not Shift is being pressed.

The following shows the values I get from the Silverlight key event handlers
on Linux (specifically the Mono 2.6.1 VMware image):

KeyPressed     KeyEventArgs.Key       KeyEventArgs.PlatformKeyCode

`              Key.Unknown  (0xFF)    0x31
-              Key.Subtract (0x50)    0x14
=              Key.Add      (0x4F)    0x15
[              Key.Unknown  (0xFF)    0x22
]              Key.Unknown  (0xFF)    0x23
\              Key.Unknown  (0xFF)    0x33
;              Key.Unknown  (0xFF)    0x2F
'              Key.Unknown  (0xFF)    0x30
,              Key.Unknown  (0xFF)    0x3B
.              Key.Decimal  (0x51)    0x3C
/              Key.Divide   (0x52)    0x3D
Shift ` (~)    Key.Unknown  (0xFF)    0x31
Shift - (_)    Key.Subtract (0x50)    0x14
Shift = (+)    Key.Add      (0x4F)    0x15
Shift [ ({)    Key.Unknown  (0xFF)    0x22
Shift ] (})    Key.Unknown  (0xFF)    0x23
Shift \ (|)    Key.Unknown  (0xFF)    0x33
Shift ; (:)    Key.Unknown  (0xFF)    0x2F
Shift ' (&quot;)    Key.Unknown  (0xFF)    0x30
Shift , (&lt;)    Key.Unknown  (0xFF)    0x3B
Shift . (&gt;)    Key.Unknown  (0xFF)    0x3C
Shift / (?)    Key.Unknown  (0xFF)    0x3D

Note the inconsistent behaviour. The KeyEventArgs.Key is usually
Key.Unknown, but sometimes returns a 'portable' value for the -=./ keys. I
say sometimes because when Shift is being pressed then the ./ keys revert to
the same behaviour as Windows and return Key.Unknown instead.

But the main problem are the -= keys because they never return Key.Unknown.
My understanding is they should also be returning Key.Unknown because they
are OEM keys (which can be Shifted) and do not represent the numeric keypad
keys (which cannot be Shifted). This is stands out as a problem to me
because it goes against the grain and makes it trickier than it should be to
write portable code, hence my pondering if it was a problem with the Linux
keyboard configuration, or maybe even a bug in Moonlight?
-- 
View this message in context: <A HREF="http://old.nabble.com/Strange-KeyEventArgs-Key---PlatformKeyCode-values-tp27473905p27473905.html">http://old.nabble.com/Strange-KeyEventArgs-Key---PlatformKeyCode-values-tp27473905p27473905.html</A>
Sent from the Moonlight mailing list archive at Nabble.com.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000873.html">[Moonlight-list] Chrome and FF3.6 support on trunk
</A></li>
	<LI>Next message: <A HREF="000878.html">[Moonlight-list] Strange KeyEventArgs Key &amp; PlatformKeyCode values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#875">[ date ]</a>
              <a href="thread.html#875">[ thread ]</a>
              <a href="subject.html#875">[ subject ]</a>
              <a href="author.html#875">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
