<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-list] System.BadImageFormatException (due	to	Invalid	MS-DOSwatermark)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20System.BadImageFormatException%20%28due%0A%09to%09Invalid%09MS-DOSwatermark%29&In-Reply-To=159658606-1282087707-cardhu_decombobulator_blackberry.rim.net-1140202374-%40bda2862.bisx.prod.on.blackberry">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001117.html">
   <LINK REL="Next"  HREF="001120.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-list] System.BadImageFormatException (due	to	Invalid	MS-DOSwatermark)</H1>
    <B>Rolf Bjarne Kvinge</B> 
    <A HREF="mailto:moonlight-list%40lists.ximian.com?Subject=%5BMoonlight-list%5D%20System.BadImageFormatException%20%28due%0A%09to%09Invalid%09MS-DOSwatermark%29&In-Reply-To=159658606-1282087707-cardhu_decombobulator_blackberry.rim.net-1140202374-%40bda2862.bisx.prod.on.blackberry"
       TITLE="[Moonlight-list] System.BadImageFormatException (due	to	Invalid	MS-DOSwatermark)">rolflists at ya.com
       </A><BR>
    <I>Wed Aug 18 05:15:39 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001117.html">[Moonlight-list] System.BadImageFormatException (due to	Invalid	MS-DOSwatermark)
</A></li>
        <LI>Next message: <A HREF="001120.html">[Moonlight-list] System.BadImageFormatException (due	to	Invalid	MS-DOSwatermark)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1119">[ date ]</a>
              <a href="thread.html#1119">[ thread ]</a>
              <a href="subject.html#1119">[ subject ]</a>
              <a href="author.html#1119">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

 

The problem is that there are several ways obfuscation can be done, in short
words good ways and bad ways. The good way modify your assemblies, but still
leave them compliant to the specifications, the bad way modifies your
assemblies so that they don&#146;t comply with specifications anymore (they rely
on undocumented features in Silverlight / Microsoft&#146;s assembly loader to
work).

 

We are trying to make non-compliant obfuscated assemblies work with
Moonlight, but we need test cases (in your case it looks like it should be
easy to create a test case: just create a sample Silverlight application in
Visual Studio, and obfuscate it).

 

Rolf

 

From: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">moonlight-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">moonlight-list-bounces at lists.ximian.com</A>] On Behalf Of kleb
Sent: mi&#233;rcoles, 18 de agosto de 2010 1:29
To: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">moonlight-list at lists.ximian.com</A>
Subject: Re: [Moonlight-list] System.BadImageFormatException (due to Invalid
MS-DOSwatermark)

 

Hello Rolf,
Yes they are obfuscated (we do that for release builds). The external DLLs
reported in the trace are not obfuscated (being Microsoft DLLs mostly). I
guess from your response you don't think those DLLs are the problem. Is
obfuscation disallowed for Moonlight?

David

(Via BlackBerry)

  _____  

From: &quot;Rolf Bjarne Kvinge [via Mono]&quot; &lt;[hidden email]&gt; 

Date: Tue, 17 Aug 2010 15:39:47 -0700 (PDT)

To: kleb&lt;[hidden email]&gt;

Subject: Re: System.BadImageFormatException (due to Invalid MS-DOS
watermark)

 

Hi, 

Are the assemblies or your project obfuscated? 

If not, we'll probably need a link to the application to try it out 
ourselves. 

Rolf 


&gt;<i>-----Original Message----- 
</I>&gt;<i>From: [hidden email] [mailto:moonlight-list- 
</I>&gt;<i>[hidden email]] On Behalf Of kleb 
</I>&gt;<i>Sent: martes, 17 de agosto de 2010 18:19 
</I>&gt;<i>To: [hidden email] 
</I>&gt;<i>Subject: [Moonlight-list] System.BadImageFormatException (due to Invalid 
</I>&gt;<i>MS-DOS watermark) 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>Hello. We're trying to smoke-test our application with Moonlight and 
</I>&gt;<i>getting 
</I>&gt;<i>nowhere. The Moonlight trace indicates that all of the Microsoft toolkit 
</I>&gt;<i>DLLs are unloadable. The message implies the DLLs are somehow corrupt, yet 
</I>&gt;<i>they are simply signed, managed DLLs provided by Microsoft. Can anybody 
</I>&gt;<i>suggest what might be going on here? Environment is pretty &quot;stock&quot;, a clean
</I>
&gt;<i>OpenSUSE 11.3 install, Firefox 3.6.6 and Moonlight preview 2.99.0.8. I've 
</I>&gt;<i>tried both 32-bit and 64-bit platforms as well, doesn't seem to be related 
</I>&gt;<i>to the CORFlags in the assemblies. 
</I>&gt;<i> 
</I>&gt;<i>Trace from MOON_TRACE: 
</I>&gt;<i>*** nss-shared-helper: Shared database disabled (set NSS_USE_SHARED_DB to 
</I>&gt;<i>enable). 
</I>&gt;<i>Attempting to load libmoonloaderxpi 
</I>&gt;<i>Moonlight: no audio capture service available 
</I>&gt;<i>Moonlight: Installing signal handlers for crash reporting. 
</I>&gt;<i>Moonlight: Enabling MONO_DEBUG=keep-delegates,reverse-pinvoke-exceptions 
</I>&gt;<i>and 
</I>&gt;<i>MOONLIGHT_ENABLE_CONSOLE=1 
</I>&gt;<i>Setting trace options to: N:x 
</I>&gt;<i>Using the ff3 bridge 
</I>&gt;<i>Moonlight: Plugin AppDomain Creation: OK 
</I>&gt;<i>Moonlight: setting option emulatekeycodes to 0 
</I>&gt;<i>Moonlight: setting option clipping to 0 
</I>&gt;<i>Moonlight: setting option bbox to 0 
</I>&gt;<i>Moonlight: setting option textbox to 0 
</I>&gt;<i>Moonlight: setting option occlusion-culling to 1 
</I>&gt;<i>Moonlight: setting option cache to 0 
</I>&gt;<i>Moonlight: setting option backend to 1 
</I>&gt;<i>Moonlight: setting option keepmedia to 0 
</I>&gt;<i>Moonlight: setting option effects to 1 
</I>&gt;<i>Moonlight: setting option projections to 1 
</I>&gt;<i>Moonlight: setting option curlbridge to 0 
</I>&gt;<i>Moonlight: setting option ooblauncher to 0 
</I>&gt;<i>Attempting To Load ExternalPart SharpZipLib.zip 
</I>&gt;<i>Attempting To Load ExternalPart SLVisifire.Charts.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.ComponentModel.DataAnnotations.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Json.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Windows.Controls.Data.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Windows.Controls.Data.Input.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Windows.Controls.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Windows.Controls.Input.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Windows.Controls.Input.Toolkit.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Windows.Controls.Toolkit.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Windows.Data.zip 
</I>&gt;<i>Attempting To Load ExternalPart System.Xml.Serialization.zip 
</I>&gt;<i>Could not load image data-0x7efff81e7000 due to Invalid MS-DOS watermark 
</I>&gt;<i>Could not load image data-0x7effd92b3000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8cd9710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>[0x7effd8eda710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd8915000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8cd9710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd8915000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8eda710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd894c000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8eda710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd8954000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8cd9710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd895f000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8eda710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd8298000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8cd9710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd8953000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8eda710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd8298000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8eda710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd8298000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8cd9710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load image data-0x7effd816c000 due to Invalid MS-DOS watermark 
</I>&gt;<i>[0x7effd8eda710:] EXCEPTION handling: System.BadImageFormatException: 
</I>&gt;<i>Could not load file or assembly 'System.ComponentModel.DataAnnotations, 
</I>&gt;<i>Version=2.0.5.0, Culture=neutral, PublicKeyToken=ddd0da4d3e678217' or one 
</I>&gt;<i>of 
</I>&gt;<i>its dependencies. 
</I>&gt;<i>[0x7f000e0ec720:] EXCEPTION handling: System.TypeLoadException: Could not 
</I>&gt;<i>load type 'System.Windows.Controls.DataGrid' from assembly 
</I>&gt;<i>'System.Windows.Controls.Data, Version=2.0.5.0, Culture=neutral, 
</I>&gt;<i>PublicKeyToken=31bf3856ad364e35'. 
</I>&gt;<i>[0x7f000e0ec720:] EXCEPTION handling: System.TypeLoadException: Could not 
</I>&gt;<i>load type 'System.Windows.Controls.DataGrid' from assembly 
</I>&gt;<i>'System.Windows.Controls.Data, Version=2.0.5.0, Culture=neutral, 
</I>&gt;<i>PublicKeyToken=31bf3856ad364e35'. 
</I>&gt;<i>[0x7f000e0ec720:] EXCEPTION handling: 
</I>&gt;<i>System.Reflection.TargetInvocationException: Exception has been thrown by 
</I>&gt;<i>the target of an invocation. 
</I>&gt;<i>ManagedXamlLoader::SetProperty (139637301052256, , 139637300377712, 
</I>&gt;<i>TargetType, 139637300377664) threw an exception: Exception has been thrown 
</I>&gt;<i>by the target of an invocation.. 
</I>&gt;<i>System.Reflection.TargetInvocationException: Exception has been thrown by 
</I>&gt;<i>the target of an invocation. ---&gt; System.TypeLoadException: Could not load 
</I>&gt;<i>type 'System.Windows.Controls.DataGrid' from assembly 
</I>&gt;<i>'System.Windows.Controls.Data, Version=2.0.5.0, Culture=neutral, 
</I>&gt;<i>PublicKeyToken=31bf3856ad364e35'. 
</I>&gt;<i>  at (wrapper managed-to-native) 
</I>&gt;<i>System.MonoCustomAttrs:GetCustomAttributesInternal 
</I>&gt;<i>(System.Reflection.ICustomAttributeProvider,System.Type,bool) 
</I>&gt;<i>  at System.MonoCustomAttrs.GetCustomAttributesBase 
</I>&gt;<i>(ICustomAttributeProvider obj, System.Type attributeType) [0x00000] in 
</I>&gt;<i>&lt;filename unknown&gt;:0 
</I>&gt;<i>  at System.MonoCustomAttrs.GetCustomAttributes (ICustomAttributeProvider 
</I>&gt;<i>obj, System.Type attributeType, Boolean inherit) [0x00000] in &lt;filename 
</I>&gt;<i>unknown&gt;:0 
</I>&gt;<i>  at System.MonoType.GetCustomAttributes (System.Type attributeType, 
</I>&gt;<i>Boolean 
</I>&gt;<i>inherit) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.Types.GetContentPropertyName (System.Type t) [0x00000] in 
</I>&gt;<i>&lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.Types.RegisterType (System.Type type, Mono.ManagedType parent, 
</I>&gt;<i>Mono.ManagedType[] interfaces) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.Types.Find (System.Type type) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.Types.TypeToKind (System.Type type) [0x00000] in &lt;filename 
</I>&gt;<i>unknown&gt;:0 
</I>&gt;<i>  at Mono.Value.FromObject (System.Object v, Boolean box_value_types) 
</I>&gt;<i>[0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.NativeDependencyObjectHelper.SetValue 
</I>&gt;<i>(INativeDependencyObjectWrapper wrapper, System.Windows.DependencyProperty 
</I>&gt;<i>dp, System.Object value) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at System.Windows.DependencyObject.SetValueImpl 
</I>&gt;<i>(System.Windows.DependencyProperty dp, System.Object value) [0x00000] in 
</I>&gt;<i>&lt;filename unknown&gt;:0 
</I>&gt;<i>  --- End of inner exception stack trace --- 
</I>&gt;<i>  at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags 
</I>&gt;<i>invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, 
</I>&gt;<i>System.Globalization.CultureInfo culture) [0x00000] in &lt;filename unknown&gt;:0
</I>
&gt;<i>  at System.Reflection.MonoProperty.SetValue (System.Object obj, 
</I>&gt;<i>System.Object value, BindingFlags invokeAttr, System.Reflection.Binder 
</I>&gt;<i>binder, System.Object[] index, System.Globalization.CultureInfo culture) 
</I>&gt;<i>[0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at System.Reflection.PropertyInfo.SetValue (System.Object obj, 
</I>&gt;<i>System.Object value, System.Object[] index) [0x00000] in &lt;filename 
</I>&gt;<i>unknown&gt;:0 
</I>&gt;<i>  at Mono.Xaml.ManagedXamlLoader.SetValue (Mono.Xaml.XamlCallbackData* 
</I>&gt;<i>data, 
</I>&gt;<i>IntPtr target_data, System.Reflection.PropertyInfo pi, System.Object 
</I>&gt;<i>target, 
</I>&gt;<i>System.Object value) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.Xaml.ManagedXamlLoader.SetPropertyFromValue 
</I>&gt;<i>(Mono.Xaml.XamlCallbackData* data, System.Object target, IntPtr 
</I>&gt;<i>target_data, 
</I>&gt;<i>Mono.Value* target_parent_ptr, System.Reflection.PropertyInfo pi, 
</I>&gt;<i>Mono.Value* value_ptr, IntPtr value_data, System.String&amp; error) [0x00000] 
</I>&gt;<i>in 
</I>&gt;<i>&lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.Xaml.ManagedXamlLoader.TrySetPropertyReflection 
</I>&gt;<i>(Mono.Xaml.XamlCallbackData* data, System.String xmlns, System.Object 
</I>&gt;<i>target, IntPtr target_data, Mono.Value* target_parent_ptr, System.String 
</I>&gt;<i>type_name, System.String name, Mono.Value* value_ptr, IntPtr value_data, 
</I>&gt;<i>System.String&amp; error) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>  at Mono.Xaml.ManagedXamlLoader.SetProperty (Mono.Xaml.XamlCallbackData* 
</I>&gt;<i>data, System.String xmlns, Mono.Value* target_ptr, IntPtr target_data, 
</I>&gt;<i>Mono.Value* target_parent_ptr, System.String prop_xmlns, System.String 
</I>&gt;<i>name, 
</I>&gt;<i>Mono.Value* value_ptr, IntPtr value_data) [0x00000] in &lt;filename unknown&gt;:0
</I>
&gt;<i>  at Mono.Xaml.ManagedXamlLoader.cb_set_property 
</I>&gt;<i>(Mono.Xaml.XamlCallbackData* data, System.String xmlns, Mono.Value* target,
</I>
&gt;<i>IntPtr target_data, Mono.Value* target_parent, System.String prop_xmlns, 
</I>&gt;<i>System.String name, Mono.Value* value_ptr, IntPtr value_data, 
</I>&gt;<i>Mono.MoonError&amp; error) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>Moonlight: ErrorEventArgs created with message: 'Exception has been thrown 
</I>&gt;<i>by the target of an invocation.' 
</I>&gt;<i>Could not parse element Style, attribute (null), error: Exception has been 
</I>&gt;<i>thrown by the target of an invocation. 
</I>&gt;<i>[0x7f000e0ec720:] EXCEPTION handling: 
</I>&gt;<i>System.Windows.Markup.XamlParseException: Exception has been thrown by the 
</I>&gt;<i>target of an invocation. 
</I>&gt;<i>[0x7f000e0ec720:] EXCEPTION handling: 
</I>&gt;<i>System.Reflection.TargetInvocationException: Exception has been thrown by 
</I>&gt;<i>the target of an invocation. 
</I>&gt;<i>Moonlight: ErrorEventArgs created with message: 'Error while creating the 
</I>&gt;<i>instance of type XXXYYYZZZ.Client.UI.App.App' 
</I>&gt;<i> 
</I>&gt;<i>-- 
</I>&gt;<i>View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/System-">http://mono.1490590.n4.nabble.com/System-</A>
</I>&lt;<A HREF="http://mono.1490590.n4.nabble.com/System-?by-user=t&amp;by-user=t">http://mono.1490590.n4.nabble.com/System-?by-user=t&amp;by-user=t</A>&gt; 
&gt;<i>BadImageFormatException-due-to-Invalid-MS-DOS-watermark- 
</I>&gt;<i>tp2328609p2328609.html 
</I>&gt;<i>Sent from the Moonlight mailing list archive at Nabble.com. 
</I>&gt;<i>_______________________________________________ 
</I>&gt;<i>Moonlight-list mailing list 
</I>&gt;<i>[hidden email] 
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">http://lists.ximian.com/mailman/listinfo/moonlight-list</A>
</I>
_______________________________________________ 
Moonlight-list mailing list 
[hidden email] 
<A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-list">http://lists.ximian.com/mailman/listinfo/moonlight-list</A>



  _____  

View message @
<A HREF="http://mono.1490590.n4.nabble.com/System-BadImageFormatException-due-to-Inva">http://mono.1490590.n4.nabble.com/System-BadImageFormatException-due-to-Inva</A>
lid-MS-DOS-watermark-tp2328609p2329134.html
&lt;<A HREF="http://mono.1490590.n4.nabble.com/System-BadImageFormatException-due-to-Inv">http://mono.1490590.n4.nabble.com/System-BadImageFormatException-due-to-Inv</A>
alid-MS-DOS-watermark-tp2328609p2329134.html?by-user=t&gt;  
To unsubscribe from System.BadImageFormatException (due to Invalid MS-DOS
watermark), click here. 

 

  _____  

View this message in context: Re: System.BadImageFormatException (due to
Invalid MS-DOSwatermark)
&lt;<A HREF="http://mono.1490590.n4.nabble.com/System-BadImageFormatException-due-to-Inv">http://mono.1490590.n4.nabble.com/System-BadImageFormatException-due-to-Inv</A>
alid-MS-DOS-watermark-tp2328609p2329168.html&gt; 
Sent from the Moonlight mailing list archive
&lt;<A HREF="http://mono.1490590.n4.nabble.com/Moonlight-f1549426.html">http://mono.1490590.n4.nabble.com/Moonlight-f1549426.html</A>&gt;  at Nabble.com.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/moonlight-list/attachments/20100818/37c915ee/attachment-0001.html">http://lists.ximian.com/pipermail/moonlight-list/attachments/20100818/37c915ee/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001117.html">[Moonlight-list] System.BadImageFormatException (due to	Invalid	MS-DOSwatermark)
</A></li>
	<LI>Next message: <A HREF="001120.html">[Moonlight-list] System.BadImageFormatException (due	to	Invalid	MS-DOSwatermark)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1119">[ date ]</a>
              <a href="thread.html#1119">[ thread ]</a>
              <a href="subject.html#1119">[ subject ]</a>
              <a href="author.html#1119">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-list">More information about the Moonlight-list
mailing list</a><br>
</body></html>
