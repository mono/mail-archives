<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] drawontouch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20drawontouch&In-Reply-To=%3CCACWcBb%3DPNrQH-d6Wp9yNSH%2BF%2B9xJo8cQZ2nsD%3DM-581nfdznFQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007796.html">
   <LINK REL="Next"  HREF="007799.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] drawontouch</H1>
    <B>Tomasz Cielecki</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20drawontouch&In-Reply-To=%3CCACWcBb%3DPNrQH-d6Wp9yNSH%2BF%2B9xJo8cQZ2nsD%3DM-581nfdznFQ%40mail.gmail.com%3E"
       TITLE="[MonoTouch] drawontouch">tomasz at ostebaronen.dk
       </A><BR>
    <I>Thu Feb  2 14:57:45 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="007796.html">[MonoTouch] drawontouch
</A></li>
        <LI>Next message: <A HREF="007799.html">[MonoTouch] App passed review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7797">[ date ]</a>
              <a href="thread.html#7797">[ thread ]</a>
              <a href="subject.html#7797">[ subject ]</a>
              <a href="author.html#7797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This could very well be problems with the limited amount of memory on
the iPhone, as you create a new ImageContext every time you have a
touch event it probably does not dispose of the old items fast enough,
flooding the memory quickly and running low.

A better approach could be to draw on a layer and save that onto the
image when done with all the annotations, instead of drawing directly
to the image.


On Thu, Feb 2, 2012 at 11:52 AM, Richard &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">richard at richdotnet.nl</A>&gt; wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> i am using drawontouch to make some annotations on a picture.
</I>&gt;<i> when i make short movements (drawing small lines for instance by making
</I>&gt;<i> short contact with the screen) it all works fine. But when i want to make a
</I>&gt;<i> long line and move across the screen
</I>&gt;<i> my app just crashes.
</I>&gt;<i>
</I>&gt;<i> anyone know what this could be?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> private void drawOnTouch(object data)
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;UITouch touch = data as UITouch;
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;if (null != touch)
</I>&gt;<i> &#160; &#160;{
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160;UIGraphics.BeginImageContext(this.Image == null ? this.Frame.Size :
</I>&gt;<i> this.Image.Size);
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160;using (CGContext cont = UIGraphics.GetCurrentContext())
</I>&gt;<i> &#160; &#160; &#160; &#160;{
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;if (this.Image != null)
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;{
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.TranslateCTM(0f, this.Image.Size.Height);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.ScaleCTM(1.0f, -1.0f);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.DrawImage(new RectangleF(0f,0f,this.Image.Size.Width,
</I>&gt;<i> this.Image.Size.Height), this.Image.CGImage);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.ScaleCTM(1.0f, -1.0f);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.TranslateCTM(0f, -this.Image.Size.Height);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;} //end if
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;PointF lastLocation = touch.PreviousLocationInView(this);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;PointF pt = touch.LocationInView(this);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;using (CGPath path = new CGPath())
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;{
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.SetLineCap(CGLineCap.Round);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.SetLineWidth(3);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.SetRGBStrokeColor(0, 2, 3, 1);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;path.MoveToPoint(lastLocation.X, lastLocation.Y);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;path.AddLines(new PointF[] { new PointF(lastLocation.X,
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;lastLocation.Y),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;new PointF(pt.X, pt.Y) });
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;path.CloseSubpath();
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.AddPath(path);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;cont.DrawPath(CGPathDrawingMode.FillStroke);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;this.Image = UIGraphics.GetImageFromCurrentImageContext();
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;}//end using path
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160;}//end using cont
</I>&gt;<i> &#160; &#160; &#160; &#160;UIGraphics.EndImageContext();
</I>&gt;<i> &#160; &#160; &#160; &#160;this.SetNeedsDisplay();
</I>&gt;<i>
</I>&gt;<i> &#160; &#160;}//end if
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> }//end void drawOnTouch
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://monotouch.2284126.n4.nabble.com/drawontouch-tp4351088p4351088.html">http://monotouch.2284126.n4.nabble.com/drawontouch-tp4351088p4351088.html</A>
</I>&gt;<i> Sent from the MonoTouch mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>


-- 
Med Venlig Hilsen / With Best Regards
Tomasz Cielecki
<A HREF="http://ostebaronen.dk">http://ostebaronen.dk</A>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007796.html">[MonoTouch] drawontouch
</A></li>
	<LI>Next message: <A HREF="007799.html">[MonoTouch] App passed review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7797">[ date ]</a>
              <a href="thread.html#7797">[ thread ]</a>
              <a href="subject.html#7797">[ subject ]</a>
              <a href="author.html#7797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
