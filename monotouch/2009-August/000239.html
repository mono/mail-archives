<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Is System.Net.WebClient supported?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Is%20System.Net.WebClient%20supported%3F&In-Reply-To=75970ce0908102331m504962efocdc2de8284ab2574%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000276.html">
   <LINK REL="Next"  HREF="000240.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Is System.Net.WebClient supported?</H1>
    <B>Terry Westley</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Is%20System.Net.WebClient%20supported%3F&In-Reply-To=75970ce0908102331m504962efocdc2de8284ab2574%40mail.gmail.com"
       TITLE="[MonoTouch] Is System.Net.WebClient supported?">monotouch at sabonrai.com
       </A><BR>
    <I>Tue Aug 11 02:43:09 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000276.html">[MonoTouch] Windows System
</A></li>
        <LI>Next message: <A HREF="000240.html">[MonoTouch] Is System.Net.WebClient supported?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#239">[ date ]</a>
              <a href="thread.html#239">[ thread ]</a>
              <a href="subject.html#239">[ subject ]</a>
              <a href="author.html#239">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I hate Objective-C and I love MonoTouch!

Now for what's got me stumped: I want to fetch and parse some XML from a
REST web service that requires a query parameter. I don't know how to fetch
it, given that:
 - HttpWebRequest gets a TypeInitializationException
 - WebClient gets a WebException, and
 - There is no NSUrlConnection for loading an NSUrlRequest

The problems with these have been described here before. What am I doing
wrong or what haven't I tried yet? Thanks.

Here's a sample of what I've tried so far:

using System;
using System.Drawing;
using System.IO;
using System.Net;

using MonoTouch.Foundation;
using MonoTouch.UIKit;

namespace MT_GoogleQuery
{
    public class Application
    {
        static void Main (string[] args)
        {
            UIApplication.Main (args, null, &quot;AppController&quot;);
        }
    }

    [Register (&quot;AppController&quot;)]
    public class AppController : UIApplicationDelegate
    {
        UIWindow window;

        public override bool FinishedLaunching (UIApplication app,
NSDictionary options)
        {
            // Create the main view controller
            var vc = new MainViewController ();

            // Create the main window and add main view controller as a
subview
            window = new UIWindow (UIScreen.MainScreen.Bounds);
            window.AddSubview(vc.View);

            window.MakeKeyAndVisible ();
            return true;
        }

        // This method is required in iPhoneOS 3.0
        public override void OnActivated (UIApplication application)
        {
        }
    }

    [Register]
    public class MainViewController : UIViewController
    {
        private UITextView textView;

        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            textView = new UITextView (new RectangleF (
                0, 0, this.View.Frame.Width, this.View.Frame.Height));
            textView.Editable = false;
            this.View.AddSubview (textView);

            string url = &quot;<A HREF="http://www.google.com/search?q=nsurlrequest&quot;;">http://www.google.com/search?q=nsurlrequest&quot;;</A>
            Uri uri = new Uri (url);

            // HttpWebRequest
            try {
                HttpWebRequest request = (HttpWebRequest)WebRequest.Create
(uri);
                request.Method = &quot;GET&quot;;
            }
            catch (TypeInitializationException ex) {
                Console.WriteLine (ex);
                textView.Text += ex.ToString ();
            }

            // WebClient
            try {
                StreamReader sr = new StreamReader (new WebClient
().OpenRead (uri));
                sr.Close ();
            }
            catch (WebException ex) {
                Console.WriteLine (ex);
                textView.Text += ex.ToString ();
            }

            // NSUrlRequest, but there is no NSUrlConnection
            NSUrlRequest nsUrlRequest = NSUrlRequest.FromUrl (new NSUrl
(url));

        }
    }
}

On Thu, Aug 6, 2009 at 10:35 PM, Michael Bluestein &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">mike.bluestein at gmail.com</A>
&gt;<i> wrote:
</I>
&gt;<i> thanks
</I>&gt;<i>
</I>&gt;<i> On Aug 6, 2009, at 10:13 PM, Geoff Norton &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">gnorton at novell.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> NSURLRequest does work (look at web.cs in monocatalog)
</I>&gt;<i> -g
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 6-Aug-09, at 6:29 PM, Mike Bluestein wrote:
</I>&gt;<i>
</I>&gt;<i> Glad to hear this is fixed in the next drop. You guys are quick!
</I>&gt;<i> As far as NSMutableURLRequest goes,
</I>&gt;<i> I don't see it anywhere in monotouch. I do see NSURLRequest though. Also,
</I>&gt;<i> NSURLConnection, which is what you use to submit the request, doesn't look
</I>&gt;<i> like it's included either. Are these supported?
</I>&gt;<i>
</I>&gt;<i> On Thu, Aug 6, 2009 at 5:03 PM, Romulo Mendivil &lt; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">wammy21 at gmail.com</A>&gt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">wammy21 at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Per Jonathan Pryor's sample:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> using(var reader = new StreamReader(
</I>&gt;&gt;<i>  new WebClient().OpenRead(new Uri(&quot;&lt;<A HREF="http://www.mono-project.com/Main_Page">http://www.mono-project.com/Main_Page</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://www.mono-project.com/Main_Page&quot;">http://www.mono-project.com/Main_Page&quot;</A>))))
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> Console.Write(reader.ReadToEnd());
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Gives:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Unhandled Exception: System.Net.WebException: An error occurred performing
</I>&gt;&gt;<i> a WebClient request. ---&gt; System.TypeInitializationException: An exception
</I>&gt;&gt;<i> was thrown by the type initializer for System.Net.WebRequest ---&gt;
</I>&gt;&gt;<i> System.MissingMethodException: Method not found: 'Default constructor not
</I>&gt;&gt;<i> found...ctor() of System.Net.HttpRequestCreator'.
</I>&gt;&gt;<i>   at System.Activator.CreateInstance (System.Type type, Boolean nonPublic)
</I>&gt;&gt;<i> [0x00000]
</I>&gt;&gt;<i>   at System.Net.WebRequest.AddPrefix (System.String prefix, System.Type
</I>&gt;&gt;<i> type) [0x00000]
</I>&gt;&gt;<i>   at System.Net.WebRequest..cctor () [0x00000]
</I>&gt;&gt;<i>   --- End of inner exception stack trace ---
</I>&gt;&gt;<i>   at System.Net.WebClient.SetupRequest (System.Uri uri) [0x00000]
</I>&gt;&gt;<i>   at System.Net.WebClient.OpenRead (System.Uri address) [0x00000]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have not been able to add -nolink to mtouch command per my previous
</I>&gt;&gt;<i> message.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Aug 6, 2009, at 1:49 PM, Geoff Norton wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We have figured out the problems with this, and it will be fixed in the
</I>&gt;&gt;<i> next release.  For now you can do
</I>&gt;&gt;<i> wc.OpenRead (new Uri (&quot;http.....&quot;));
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> as a workaround
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -g
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 6-Aug-09, at 3:10 PM, Mike Bluestein wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here's a snippet of code
</I>&gt;&gt;<i>  WebClient wc = new WebClient ();
</I>&gt;&gt;<i>  string result;
</I>&gt;&gt;<i>  using(StreamReader rdr = new StreamReader (wc.OpenRead(&quot;&lt;<A HREF="http://www.mono-project.com/Main_Page">http://www.mono-project.com/Main_Page</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://www.mono-project.com/Main_Page&quot;">http://www.mono-project.com/Main_Page&quot;</A>)))
</I>&gt;&gt;<i>  {
</I>&gt;&gt;<i>     result = rdr.ReadToEnd ();
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> that results in this error
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Unhandled Exception: System.MethodAccessException: Method
</I>&gt;&gt;<i> `System.Text.StringBuilder:AppendFormat (string,object,object)' is
</I>&gt;&gt;<i> inaccessible from method `System.Net.WebClient:GetQueryString (bool)'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   at System.Net.WebClient.MakeUri (System.String path) [0x00000]
</I>&gt;&gt;<i>   at System.Net.WebClient.CreateUri (System.String address) [0x00000]
</I>&gt;&gt;<i>   at System.Net.WebClient.OpenRead (System.String address) [0x00000]
</I>&gt;&gt;<i>   at (wrapper remoting-invoke-with-check) System.Net.WebClient:OpenRead
</I>&gt;&gt;<i> (string) .
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> MonoTouch mailing list
</I>&gt;&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;&gt;<i>  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> MonoTouch mailing list
</I>&gt;&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;&gt;<i>  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monotouch/attachments/20090811/e5a4029c/attachment-0001.html">http://lists.ximian.com/mailman/private/monotouch/attachments/20090811/e5a4029c/attachment-0001.html</A> 
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000276.html">[MonoTouch] Windows System
</A></li>
	<LI>Next message: <A HREF="000240.html">[MonoTouch] Is System.Net.WebClient supported?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#239">[ date ]</a>
              <a href="thread.html#239">[ thread ]</a>
              <a href="subject.html#239">[ subject ]</a>
              <a href="author.html#239">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
