<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Sprite rendering perf (initial results)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Sprite%20rendering%20perf%20%28initial%20results%29&In-Reply-To=005101ca1942%2404071770%240c154650%24%40net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000219.html">
   <LINK REL="Next"  HREF="000236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Sprite rendering perf (initial results)</H1>
    <B>Christian Beaumont</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Sprite%20rendering%20perf%20%28initial%20results%29&In-Reply-To=005101ca1942%2404071770%240c154650%24%40net"
       TITLE="[MonoTouch] Sprite rendering perf (initial results)">chris at foundation42.org
       </A><BR>
    <I>Sun Aug  9 19:48:42 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000219.html">[MonoTouch] RES:  Sprite rendering perf (initial results)
</A></li>
        <LI>Next message: <A HREF="000236.html">[MonoTouch] Sprite rendering perf (initial results)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#220">[ date ]</a>
              <a href="thread.html#220">[ thread ]</a>
              <a href="subject.html#220">[ subject ]</a>
              <a href="author.html#220">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

A couple of other people pm'd me asking for it too.  I hadn't really thought
about releasing it publicly just to avoid support issues but if it helps
someone I'm fine with it.

Give me a couple of days to tidy it up and see if I can fix this texture
load crash problem.

cheers,
-chris

2009/8/9 Jos&#233; Antonio Leal de Farias &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">jalf at sharpgames.net</A>&gt;

&gt;<i>  Hi Chris,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I&#8217;m working in exact same thing here, but without your resultsL My goal is
</I>&gt;<i> port the XNA framework to MonoToutch (2D stuff first), in the same way we
</I>&gt;<i> did with SilverLight ( <A HREF="http://www.codeplex.com/silversprite">http://www.codeplex.com/silversprite</A> ). Could you
</I>&gt;<i> please send to me your code to check how you done this?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Jalf.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *De:* <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch-bounces at lists.ximian.com</A> [mailto:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch-bounces at lists.ximian.com</A>] *Em nome de *Christian Beaumont
</I>&gt;<i> *Enviada em:* s&#225;bado, 8 de agosto de 2009 14:39
</I>&gt;<i> *Para:* <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>
</I>&gt;<i> *Assunto:* [MonoTouch] Sprite rendering perf (initial results)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hey,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A couple of hours ago I just got my managed sprite rendering system (and
</I>&gt;<i> particle systems) working.  Since then I've been testing performance and I'm
</I>&gt;<i> really quite pleased!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This sprite renderer takes care of rendering batches of sprites fairly
</I>&gt;<i> efficiently with no managed allocation in most cases.  Each sprite may be
</I>&gt;<i> individually scaled, rotated or translated and you may also set the color
</I>&gt;<i> (either of the whole sprite or individual vertices to allow gradient
</I>&gt;<i> blends). Also the sprites can be animated from a sprite sheet.  The particle
</I>&gt;<i> systems sit on top of the sprite renderer and animate the position, color,
</I>&gt;<i> alpha etc over time.   The sprites are rendered using an index buffer,
</I>&gt;<i> calling glDrawElements to render a set of textured quads (not point
</I>&gt;<i> sprites).  BTW, for my specific case DrawElements is quite a bit faster than
</I>&gt;<i> DrawArray (although I understand that other people have contrary information
</I>&gt;<i> for static geometry).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Anyway, I'm only telling you this to give you an idea that it's a real
</I>&gt;<i> world piece of code not just a test.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I've tested varying numbers of sprites and varying sprite sizes with
</I>&gt;<i> different blending modes and texturing disabled/enabled.  Although I don't
</I>&gt;<i> yet have a scientific breakdown of the figures I will say that the numbers
</I>&gt;<i> are quite promising.  So far I've tried from 50-500 particles and from 10x10
</I>&gt;<i> to 100x100 sprites with a bunch of different combinations.  Currently I'm
</I>&gt;<i> seeing no issues with 200 particles all rotating and moving with alpha
</I>&gt;<i> blends at 100x100 which I think is pretty good.  I'm running on the old
</I>&gt;<i> series iPhone hardware, so expect a lot more with the new hardware.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Going beyond 200 is also quite possible however for that I do start to see
</I>&gt;<i> some slow downs.  If the particles aren't allowed to overlap it's quite okay
</I>&gt;<i> but if there are a lot of overlaps the GPU has to work pretty hard, and with
</I>&gt;<i> alpha blending turned on the overdraw really does hurt perf a lot.  Going
</I>&gt;<i> beyond 500 particles I also start seeing application related perf issues.
</I>&gt;<i>  Probably this is the large numbers of Sin/Cos I'm doing at the moment when
</I>&gt;<i> updating the vertex buffer.  I have some ideas to improve that though so
</I>&gt;<i> this might improve.  Also this really is the first test and there are quite
</I>&gt;<i> a few more tweaks I can make.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I didn't really see any GC hiccups and this was a very nice surprise.  To
</I>&gt;<i> be honest I was kind of worrying about this the most.  Certainly with &lt;200
</I>&gt;<i> particles running at 30fps I don't notice any GC delays at all.  I don't
</I>&gt;<i> allocate anything myself in the main loop and the number of objects I keep
</I>&gt;<i> around is very low so this seems to be a good strategy.  I'll try and keep
</I>&gt;<i> it this way!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> While I was working on the renderer I did come across a pointer arithmetic
</I>&gt;<i> bug in mono (when using unsafe).  I'll try and get a simple test case
</I>&gt;<i> together and send it over.  There is an easy workaround so it's not a
</I>&gt;<i> show-stopper.   Also for some reason my project won't show
</I>&gt;<i> Console.WriteLine() messages when running in the simulator - no idea why
</I>&gt;<i> that is because I have another project I made earlier that shows them just
</I>&gt;<i> fine.  Finally, I'm currently seeing a crash in my app on the actual device.
</I>&gt;<i>  This occurs after a few seconds of running but strangely only after I load
</I>&gt;<i> a texture.  I'm guessing I'm doing something stupid because I ripped the
</I>&gt;<i> code to load the texture right out of the GLPaint sample and that works
</I>&gt;<i> fine.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The only thing I might wish were better is the startup time on the device.
</I>&gt;<i>  Currently on my iPhone it takes around 6 seconds to boot my fairly trivial
</I>&gt;<i> app.  As I said I do have the old, slow model but it would be nice if it
</I>&gt;<i> could be improved some.  If there isn't much to be done might I suggest that
</I>&gt;<i> you allow a way to set a startup image that is displayed as soon as the app
</I>&gt;<i> is launched.  I'd be more than happy to display a static image while the app
</I>&gt;<i> boots but staring at a black screen is a bit off-putting.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Assuming people are interested, I'll try and keep you posted on further
</I>&gt;<i> results as I get them.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In summary, I'm more than happy with the runtime performance at this stage.
</I>&gt;<i>  It is more than sufficient for my 2D game and I can easily see MonoTouch
</I>&gt;<i> handling pretty advanced real time games (especially on the newer hardware).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Great job guys!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> cheers,
</I>&gt;<i>
</I>&gt;<i> -chris
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monotouch/attachments/20090809/d6febb14/attachment.html">http://lists.ximian.com/mailman/private/monotouch/attachments/20090809/d6febb14/attachment.html</A> 
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000219.html">[MonoTouch] RES:  Sprite rendering perf (initial results)
</A></li>
	<LI>Next message: <A HREF="000236.html">[MonoTouch] Sprite rendering perf (initial results)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#220">[ date ]</a>
              <a href="thread.html#220">[ thread ]</a>
              <a href="subject.html#220">[ subject ]</a>
              <a href="author.html#220">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
