<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Sprite rendering perf (initial results)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Sprite%20rendering%20perf%20%28initial%20results%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000190.html">
   <LINK REL="Next"  HREF="000196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Sprite rendering perf (initial results)</H1>
    <B>Christian Beaumont</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Sprite%20rendering%20perf%20%28initial%20results%29&In-Reply-To="
       TITLE="[MonoTouch] Sprite rendering perf (initial results)">chris at foundation42.org
       </A><BR>
    <I>Sat Aug  8 13:38:45 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000190.html">[MonoTouch] OpenTK math functions in different namespace
</A></li>
        <LI>Next message: <A HREF="000196.html">[MonoTouch] Sprite rendering perf (initial results)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#192">[ date ]</a>
              <a href="thread.html#192">[ thread ]</a>
              <a href="subject.html#192">[ subject ]</a>
              <a href="author.html#192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

A couple of hours ago I just got my managed sprite rendering system (and
particle systems) working.  Since then I've been testing performance and I'm
really quite pleased!

This sprite renderer takes care of rendering batches of sprites fairly
efficiently with no managed allocation in most cases.  Each sprite may be
individually scaled, rotated or translated and you may also set the color
(either of the whole sprite or individual vertices to allow gradient
blends). Also the sprites can be animated from a sprite sheet.  The particle
systems sit on top of the sprite renderer and animate the position, color,
alpha etc over time.   The sprites are rendered using an index buffer,
calling glDrawElements to render a set of textured quads (not point
sprites).  BTW, for my specific case DrawElements is quite a bit faster than
DrawArray (although I understand that other people have contrary information
for static geometry).

Anyway, I'm only telling you this to give you an idea that it's a real world
piece of code not just a test.

I've tested varying numbers of sprites and varying sprite sizes with
different blending modes and texturing disabled/enabled.  Although I don't
yet have a scientific breakdown of the figures I will say that the numbers
are quite promising.  So far I've tried from 50-500 particles and from 10x10
to 100x100 sprites with a bunch of different combinations.  Currently I'm
seeing no issues with 200 particles all rotating and moving with alpha
blends at 100x100 which I think is pretty good.  I'm running on the old
series iPhone hardware, so expect a lot more with the new hardware.

Going beyond 200 is also quite possible however for that I do start to see
some slow downs.  If the particles aren't allowed to overlap it's quite okay
but if there are a lot of overlaps the GPU has to work pretty hard, and with
alpha blending turned on the overdraw really does hurt perf a lot.  Going
beyond 500 particles I also start seeing application related perf issues.
 Probably this is the large numbers of Sin/Cos I'm doing at the moment when
updating the vertex buffer.  I have some ideas to improve that though so
this might improve.  Also this really is the first test and there are quite
a few more tweaks I can make.

I didn't really see any GC hiccups and this was a very nice surprise.  To be
honest I was kind of worrying about this the most.  Certainly with &lt;200
particles running at 30fps I don't notice any GC delays at all.  I don't
allocate anything myself in the main loop and the number of objects I keep
around is very low so this seems to be a good strategy.  I'll try and keep
it this way!

While I was working on the renderer I did come across a pointer arithmetic
bug in mono (when using unsafe).  I'll try and get a simple test case
together and send it over.  There is an easy workaround so it's not a
show-stopper.   Also for some reason my project won't show
Console.WriteLine() messages when running in the simulator - no idea why
that is because I have another project I made earlier that shows them just
fine.  Finally, I'm currently seeing a crash in my app on the actual device.
 This occurs after a few seconds of running but strangely only after I load
a texture.  I'm guessing I'm doing something stupid because I ripped the
code to load the texture right out of the GLPaint sample and that works
fine.

The only thing I might wish were better is the startup time on the device.
 Currently on my iPhone it takes around 6 seconds to boot my fairly trivial
app.  As I said I do have the old, slow model but it would be nice if it
could be improved some.  If there isn't much to be done might I suggest that
you allow a way to set a startup image that is displayed as soon as the app
is launched.  I'd be more than happy to display a static image while the app
boots but staring at a black screen is a bit off-putting.

Assuming people are interested, I'll try and keep you posted on further
results as I get them.

In summary, I'm more than happy with the runtime performance at this stage.
 It is more than sufficient for my 2D game and I can easily see MonoTouch
handling pretty advanced real time games (especially on the newer hardware).

Great job guys!

cheers,
-chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monotouch/attachments/20090808/39a8fd36/attachment.html">http://lists.ximian.com/mailman/private/monotouch/attachments/20090808/39a8fd36/attachment.html</A> 
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000190.html">[MonoTouch] OpenTK math functions in different namespace
</A></li>
	<LI>Next message: <A HREF="000196.html">[MonoTouch] Sprite rendering perf (initial results)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#192">[ date ]</a>
              <a href="thread.html#192">[ thread ]</a>
              <a href="subject.html#192">[ subject ]</a>
              <a href="author.html#192">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
