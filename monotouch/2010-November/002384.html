<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Trouble binding with delegates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Trouble%20binding%20with%20delegates&In-Reply-To=AANLkTi%3DPQE6fKpu9byz1LN00gqLOpsQS4hUwjirMFSDA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002383.html">
   <LINK REL="Next"  HREF="002386.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Trouble binding with delegates</H1>
    <B>David Moles</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Trouble%20binding%20with%20delegates&In-Reply-To=AANLkTi%3DPQE6fKpu9byz1LN00gqLOpsQS4hUwjirMFSDA%40mail.gmail.com"
       TITLE="[MonoTouch] Trouble binding with delegates">davidmoles at thegogame.com
       </A><BR>
    <I>Fri Nov 12 15:57:35 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002383.html">[MonoTouch] Trouble binding with delegates
</A></li>
        <LI>Next message: <A HREF="002386.html">[MonoTouch] Trouble binding with delegates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2384">[ date ]</a>
              <a href="thread.html#2384">[ thread ]</a>
              <a href="subject.html#2384">[ subject ]</a>
              <a href="author.html#2384">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Possibly related to bug #552982? I tried adding -noregistrar to my
build arguments, per this forum discussion:
<A HREF="http://forums.monotouch.net/yaf_postst98_Linker-failure-when-using-btouch-generated-RedLaserdll.aspx">http://forums.monotouch.net/yaf_postst98_Linker-failure-when-using-btouch-generated-RedLaserdll.aspx</A>
-- but that was pure cargo cult on my part, and it didn't work: I got
&quot;Cannot bundle unregistered option &#8216;-o&#8217;&quot;.

Here's the generated code, if anyone has any guesses. If someone could
even point me to some good docs on P/Invoke etc., that'd be good -- I
think I can follow what's going on in the generated code here, but I'm
at a loss to improve on it.

	[Register(&quot;AVUtils&quot;)]
	public partial class AVUtils : NSObject {
		static IntPtr selDubAudioWithTrackOutputToHandleSuccessHandleFailure
= Selector.GetHandle
(&quot;dubAudio:withTrack:outputTo:handleSuccess:handleFailure:&quot;);

		static IntPtr class_ptr = Class.GetHandle (&quot;AVUtils&quot;);

		public override IntPtr ClassHandle { get { return class_ptr; } }

		[Export (&quot;init&quot;)]
		public AVUtils () : base (NSObjectFlag.Empty)
		{
			IsDirectBinding = GetType ().Assembly ==
GoGame.iOS.AV.Messaging.this_assembly;
			if (IsDirectBinding) {
				Handle = MonoTouch.ObjCRuntime.Messaging.IntPtr_objc_msgSend
(this.Handle, Selector.Init);
			} else {
				Handle = MonoTouch.ObjCRuntime.Messaging.IntPtr_objc_msgSendSuper
(this.SuperHandle, Selector.Init);
			}
		}

		[Export (&quot;initWithCoder:&quot;)]
		public AVUtils (NSCoder coder) : base (NSObjectFlag.Empty)
		{
			IsDirectBinding = GetType ().Assembly ==
GoGame.iOS.AV.Messaging.this_assembly;
			if (IsDirectBinding) {
				Handle = MonoTouch.ObjCRuntime.Messaging.IntPtr_objc_msgSend_IntPtr
(this.Handle, Selector.InitWithCoder, coder.Handle);
			} else {
				Handle = MonoTouch.ObjCRuntime.Messaging.IntPtr_objc_msgSendSuper_IntPtr
(this.SuperHandle, Selector.InitWithCoder, coder.Handle);
			}
		}

		public AVUtils (NSObjectFlag t) : base (t) {}

		public AVUtils (IntPtr handle) : base (handle) {}

		[Export (&quot;dubAudio:withTrack:outputTo:handleSuccess:handleFailure:&quot;)]
		public unsafe static void DubAudio (NSUrl videoUrl, NSUrl audioUrl,
NSUrl newUrl, Action handleSuccess, Action&lt;NSError&gt; handleFailure)
		{
			if (videoUrl == null)
				throw new ArgumentNullException (&quot;videoUrl&quot;);
			if (audioUrl == null)
				throw new ArgumentNullException (&quot;audioUrl&quot;);
			if (newUrl == null)
				throw new ArgumentNullException (&quot;newUrl&quot;);
			if (handleSuccess == null)
				throw new ArgumentNullException (&quot;handleSuccess&quot;);
			if (handleFailure == null)
				throw new ArgumentNullException (&quot;handleFailure&quot;);
			BlockLiteral *block_ptr_handleSuccess;
			BlockLiteral block_handleSuccess;
			block_handleSuccess = new BlockLiteral ();
			block_ptr_handleSuccess = &amp;block_handleSuccess;
			block_handleSuccess.SetupBlock (static_InnerHandleSuccess, handleSuccess);
			BlockLiteral *block_ptr_handleFailure;
			BlockLiteral block_handleFailure;
			block_handleFailure = new BlockLiteral ();
			block_ptr_handleFailure = &amp;block_handleFailure;
			block_handleFailure.SetupBlock (static_InnerHandleFailure, handleFailure);

			GoGame.iOS.AV.Messaging.void_objc_msgSend_IntPtr_IntPtr_IntPtr_IntPtr_IntPtr
(class_ptr, selDubAudioWithTrackOutputToHandleSuccessHandleFailure,
videoUrl.Handle, audioUrl.Handle, newUrl.Handle, (IntPtr)
block_ptr_handleSuccess, (IntPtr) block_ptr_handleFailure);
						block_ptr_handleSuccess-&gt;CleanupBlock ();
			block_ptr_handleFailure-&gt;CleanupBlock ();

		}

	internal delegate void InnerHandleSuccess (IntPtr block);
	static InnerHandleSuccess static_InnerHandleSuccess = new
InnerHandleSuccess (TrampolineHandleSuccess);
	[MonoPInvokeCallback (typeof (InnerHandleSuccess))]
	static unsafe void TrampolineHandleSuccess (IntPtr block) {
		var descriptor = (BlockLiteral *) block;
		var del = (Action) (descriptor-&gt;global_handle != IntPtr.Zero ?
GCHandle.FromIntPtr (descriptor-&gt;global_handle).Target :
GCHandle.FromIntPtr (descriptor-&gt;local_handle).Target);
		del ();
	}
	
	internal delegate void InnerHandleFailure (IntPtr block, IntPtr err);
	static InnerHandleFailure static_InnerHandleFailure = new
InnerHandleFailure (TrampolineHandleFailure);
	[MonoPInvokeCallback (typeof (InnerHandleFailure))]
	static unsafe void TrampolineHandleFailure (IntPtr block, IntPtr err) {
		var descriptor = (BlockLiteral *) block;
		var del = (Action&lt;NSError&gt;) (descriptor-&gt;global_handle !=
IntPtr.Zero ? GCHandle.FromIntPtr (descriptor-&gt;global_handle).Target :
GCHandle.FromIntPtr (descriptor-&gt;local_handle).Target);
		del ((MonoTouch.Foundation.NSError) Runtime.GetNSObject (err));
	}
	
	} /* class AVUtils */



-- 
David Moles
<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">davidmoles at thegogame.com</A>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002383.html">[MonoTouch] Trouble binding with delegates
</A></li>
	<LI>Next message: <A HREF="002386.html">[MonoTouch] Trouble binding with delegates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2384">[ date ]</a>
              <a href="thread.html#2384">[ thread ]</a>
              <a href="subject.html#2384">[ subject ]</a>
              <a href="author.html#2384">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
