<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] NSAutoreleaseNoPool error messages when using	threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20NSAutoreleaseNoPool%20error%20messages%20when%20using%0A%09threads&In-Reply-To=75970ce0910120653o377f934eja2755e929e9b4eba%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001401.html">
   <LINK REL="Next"  HREF="001403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] NSAutoreleaseNoPool error messages when using	threads</H1>
    <B>Ed Anuff</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20NSAutoreleaseNoPool%20error%20messages%20when%20using%0A%09threads&In-Reply-To=75970ce0910120653o377f934eja2755e929e9b4eba%40mail.gmail.com"
       TITLE="[MonoTouch] NSAutoreleaseNoPool error messages when using	threads">ed at anuff.com
       </A><BR>
    <I>Mon Oct 12 11:27:01 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001401.html">[MonoTouch] NSAutoreleaseNoPool error messages when using	threads
</A></li>
        <LI>Next message: <A HREF="001403.html">[MonoTouch] NSAutoreleaseNoPool error messages when using	threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1402">[ date ]</a>
              <a href="thread.html#1402">[ thread ]</a>
              <a href="subject.html#1402">[ subject ]</a>
              <a href="author.html#1402">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Possibly, although the idea here is not to halt the main tread while
loading images from the net.  I've worked around it by putting this at
the start of the thread code:

				NSAutoreleasePool pool = new NSAutoreleasePool();

According to the Apple docs, I'd have to do this at the start of a
thread I was creating in Obj-C, but this is the first time I've had to
worry about memory management with MonoTouch.

Ed

On Mon, Oct 12, 2009 at 6:53 AM, Terry Westley &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at sabonrai.com</A>&gt; wrote:
&gt;<i> You could be doing something that needs to be performed on the main UI
</I>&gt;<i> thread. If so, look into NSObject.InvokeOnMainThread and
</I>&gt;<i> NSObject.BeginInvokeOnMainThread.
</I>&gt;<i>
</I>&gt;<i> --Terry
</I>&gt;<i>
</I>&gt;<i> On Mon, Oct 12, 2009 at 3:19 AM, Ed Anuff &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">ed at anuff.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm getting a lot of the following messages when I create a thread and
</I>&gt;&gt;<i> create some objects inside of it that aren't used outside of the
</I>&gt;&gt;<i> thread:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 009-10-12 00:10:57.977 TouchClient[79105:4a03] ***
</I>&gt;&gt;<i> _NSAutoreleaseNoPool(): Object 0x4966790 of class NSURL autoreleased
</I>&gt;&gt;<i> with no pool in place - just leaking
</I>&gt;&gt;<i> Stack: (0x62a6bf 0x58be62 0x5cb8a1 0x8ef58ce 0x8ef52da 0x8ef4d2e
</I>&gt;&gt;<i> 0x4dd0490 0xca9d 0x1568d4 0x18fd8b 0x1c43c6 0x1eea08 0x96926f39
</I>&gt;&gt;<i> 0x96926dbe)
</I>&gt;&gt;<i> 2009-10-12 00:10:57.979 TouchClient[79105:4a03] ***
</I>&gt;&gt;<i> _NSAutoreleaseNoPool(): Object 0x4abb80 of class NSCFString
</I>&gt;&gt;<i> autoreleased with no pool in place - just leaking
</I>&gt;&gt;<i> Stack: (0x62a6bf 0x58be62 0x5d8b0a 0x5e2f24 0x5e2ee8 0x8ef58ce
</I>&gt;&gt;<i> 0x8ef5bdc 0x8ef4d3c 0x4dd0490 0xca9d 0x1568d4 0x18fd8b 0x1c43c6
</I>&gt;&gt;<i> 0x1eea08 0x96926f39 0x96926dbe)
</I>&gt;&gt;<i> 2009-10-12 00:10:57.980 TouchClient[79105:4a03] ***
</I>&gt;&gt;<i> _NSAutoreleaseNoPool(): Object 0x4abb80 of class NSCFString
</I>&gt;&gt;<i> autoreleased with no pool in place - just leaking
</I>&gt;&gt;<i> Stack: (0x62a6bf 0x58be62 0x5d8b1c 0x5e2f24 0x5e2ee8 0x8ef58ce
</I>&gt;&gt;<i> 0x8ef5bdc 0x8ef4d3c 0x4dd0490 0xca9d 0x1568d4 0x18fd8b 0x1c43c6
</I>&gt;&gt;<i> 0x1eea08 0x96926f39 0x96926dbe)
</I>&gt;&gt;<i> 2009-10-12 00:10:57.981 TouchClient[79105:4a03] ***
</I>&gt;&gt;<i> _NSAutoreleaseNoPool(): Object 0x495dab0 of class NSCFString
</I>&gt;&gt;<i> autoreleased with no pool in place - just leaking
</I>&gt;&gt;<i> Stack: (0x62a6bf 0x58be62 0x6866e4 0x6126b9 0x5e2fda 0x5e2ee8
</I>&gt;&gt;<i> 0x8ef58ce 0x8ef5bdc 0x8ef4d3c 0x4dd0490 0xca9d 0x1568d4 0x18fd8b
</I>&gt;&gt;<i> 0x1c43c6 0x1eea08 0x96926f39 0x96926dbe)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's very simple code, basically retreiving some images. &#160;I tried
</I>&gt;&gt;<i> null-ing out the allocated objects to see if that helped.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;public void CacheImage(string image_url, CacheImageCallback
</I>&gt;&gt;<i> callback) {
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;string file_path = GetPathForImageUrl(image_url);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Thread thread = new Thread(new
</I>&gt;&gt;<i> ThreadStart(delegate() {
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;NSData data = null;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;NSUrl url = null;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (!File.Exists(file_path)) {
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;url = NSUrl.FromString(image_url);
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;data = NSData.FromUrl(url);
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (data != null) {
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;NSError err = null;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (data.Save(file_path,
</I>&gt;&gt;<i> false, out err)) {
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Logger.Info(&quot;Image
</I>&gt;&gt;<i> &quot; + image_url + &quot; saved to &quot; + file_path);
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (callback !=
</I>&gt;&gt;<i> null) callback(image_url);
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;else {
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;else {
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (callback != null)
</I>&gt;&gt;<i> callback(image_url);
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;data = null;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;url = null;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}));
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;thread.IsBackground = true;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;thread.Start();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> MonoTouch mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001401.html">[MonoTouch] NSAutoreleaseNoPool error messages when using	threads
</A></li>
	<LI>Next message: <A HREF="001403.html">[MonoTouch] NSAutoreleaseNoPool error messages when using	threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1402">[ date ]</a>
              <a href="thread.html#1402">[ thread ]</a>
              <a href="subject.html#1402">[ subject ]</a>
              <a href="author.html#1402">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
