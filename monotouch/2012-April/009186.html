<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] btouch Binding of Blocks? (I know its in the docs, but having a little trouble)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20btouch%20Binding%20of%20Blocks%3F%20%28I%20know%20its%20in%20the%20docs%2C%0A%20but%20having%20a%20little%20trouble%29&In-Reply-To=%3CCAKY9aZjiGQLXJxQ%3DSa40Lheb1X%3DpN2O%2BAwv4eBbNLYu23p7Z-Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009161.html">
   <LINK REL="Next"  HREF="009191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] btouch Binding of Blocks? (I know its in the docs, but having a little trouble)</H1>
    <B>Dermot O Sullivan</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20btouch%20Binding%20of%20Blocks%3F%20%28I%20know%20its%20in%20the%20docs%2C%0A%20but%20having%20a%20little%20trouble%29&In-Reply-To=%3CCAKY9aZjiGQLXJxQ%3DSa40Lheb1X%3DpN2O%2BAwv4eBbNLYu23p7Z-Q%40mail.gmail.com%3E"
       TITLE="[MonoTouch] btouch Binding of Blocks? (I know its in the docs, but having a little trouble)">me at dermotos.com
       </A><BR>
    <I>Mon Apr 16 10:28:17 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009161.html">[MonoTouch] btouch Binding of Blocks? (I know its in the docs, but having a little trouble)
</A></li>
        <LI>Next message: <A HREF="009191.html">[MonoTouch] btouch Binding of Blocks? (I know its in the docs, but having a little trouble)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9186">[ date ]</a>
              <a href="thread.html#9186">[ thread ]</a>
              <a href="subject.html#9186">[ subject ]</a>
              <a href="author.html#9186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jeff,

I really appreciate you taking the time to clarify that. I think im almost
there, but still cant quite get it to work.
I have bound the blocks as you described (see the ApiDefinition.cs file
contents below).

When I build this project as is, I get  Bump3Binding.dll file that is
23.1MB. So far so good.
I attempt to use this in my project, everything I need seems to be coming
up in intellisense, but when I build, I get an error stating:

*ld: symbol(s) not found for architecture i386*
*collect2: ld returned 1 exit status*
*
*
*mtouch exited with code 1*
*
*
*(full build output available here: <A HREF="http://pastebin.com/Hj2DZt0L">http://pastebin.com/Hj2DZt0L</A> )*
*
*
I imagine this is something to do with the building of the actual library,
or more specifically, the linking with its required libraries, which are
described in the bump api documentation like so:

*Ensure that your target is linked against libBump.a, CFNetwork.framework,
CoreLocation.framework, and AudioToolbox.framework.*
*
*
So if I go back to my Binding project and change the linkswith.cs file
from:

[assembly: LinkWith (&quot;libBump.a&quot;, LinkTarget.ArmV7 | LinkTarget.ArmV6 |
LinkTarget.Simulator, ForceLoad = true )]

to

[assembly: LinkWith (&quot;libBump.a&quot;, LinkTarget.ArmV7 | LinkTarget.ArmV6 |
LinkTarget.Simulator, ForceLoad = true, Frameworks = &quot;CFNetwork
CoreLocation AudioToolbox&quot; )]


then I get &quot;Build Successful&quot; but the dll is only 3.0KB and isn't a valid
dll file.


Any tips on where I might be going wrong?




ApiDefinition.cs file: (full file available here:
<A HREF="http://pastebin.com/bFh3csSf">http://pastebin.com/bFh3csSf</A> )

namespace Bump3Binding
{

delegate void BumpEventBlock(BumpEvent evt);
delegate void BumpMatchBlock(ulong proposedChannelID);
.
.
.

[BaseType (typeof (NSObject))]
interface BumpClient{

[Export(&quot;BumpEventBlock:&quot;)]
void BumpEvent(BumpEventBlock evt);

[Export(&quot;BumpEventBlock:&quot;)]
void BumpMatchBlock(ulong proposedChannelID);
.
.
.


}







On Sat, Apr 14, 2012 at 12:45 AM, Jeff Stedfast &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">jeff at xamarin.com</A>&gt; wrote:

&gt;<i> Hi Dermot,
</I>&gt;<i>
</I>&gt;<i> Let me try to better explain how blocks are bound...
</I>&gt;<i>
</I>&gt;<i> On Thu, Apr 12, 2012 at 10:22 PM, dermotos &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">me at dermotos.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Im trying to bind the latest version of the bump api (version 3).
</I>&gt;&gt;<i> This version uses blocks as callbacks when events occur.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The header file, located here:
</I>&gt;&gt;<i> <A HREF="https://github.com/bumptech/bump-api-ios/blob/master/libBump/BumpClient.h">https://github.com/bumptech/bump-api-ios/blob/master/libBump/BumpClient.h</A>
</I>&gt;&gt;<i> defines the blocks like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /* called after a Bump or No Match is detected. */
</I>&gt;&gt;<i> typedef void (^BumpEventBlock)(bump_event event);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /* called after a Match has occurred. */
</I>&gt;&gt;<i> typedef void (^BumpMatchBlock)(BumpChannelID proposedChannelID);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /* called after both parties to a Match have confirmed the proposed
</I>&gt;&gt;<i> Channel
</I>&gt;&gt;<i> */
</I>&gt;&gt;<i> typedef void (^BumpChannelConfirmedBlock)(BumpChannelID channelID);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How do I bind these?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The documentation on this describes how to bind a block like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - (void) enumerateObjectsUsingBlock:(void (^)(id obj, BOOL *stop) block
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Think of the above as a method definition (named
</I>&gt;<i> enumerateObjectsUsingBlock) that takes as a parameter an anonymous delegate.
</I>&gt;<i>
</I>&gt;<i> Anonymous &quot;Block&quot; syntax is: &lt;return-type&gt; (^) (&lt;parameter-list&gt;)
</I>&gt;<i> &lt;callback-name&gt;
</I>&gt;<i>
</I>&gt;<i> In this case &quot;block&quot; is the callback-name token. This is just the variable
</I>&gt;<i> name of the delegate.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> // This declares the callback signature for the block:
</I>&gt;&gt;<i> delegate void NSSetEnumerator (NSObject obj, ref bool stop)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What the author of the documentation did here was to separate the block
</I>&gt;<i> from the method definition so that he could name it.
</I>&gt;<i>
</I>&gt;<i> The above C# delegate maps to: void (^) (id obj, bool *stop);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> // Later, inside your definition, do this:
</I>&gt;&gt;<i> [Export (&quot;enumerateObjectUsingBlock:&quot;)]
</I>&gt;&gt;<i> void Enumerate (NSSetEnumerator enum)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> I cant really follow this for the bump binding.
</I>&gt;&gt;<i> Does typedef affect how I bind this?
</I>&gt;&gt;<i> Do I need to somehow declare BumpChannelConfirmedBlock as a type? how
</I>&gt;&gt;<i> about
</I>&gt;&gt;<i> BumpChannelID?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> BumpChannelIID is defined as: typedef unsigned long long BumpChannelID;
</I>&gt;<i>
</I>&gt;<i> In C#, this would be UInt64 or ulong.
</I>&gt;<i>
</I>&gt;<i>  So, if we are to bind the following ObjC blocks;
</I>&gt;<i>
</I>&gt;<i> /* called after a Bump or No Match is detected. */
</I>&gt;<i> typedef void (^BumpEventBlock)(bump_event event);
</I>&gt;<i>
</I>&gt;<i> /* called after a Match has occurred. */
</I>&gt;<i> typedef void (^BumpMatchBlock)(BumpChannelID proposedChannelID);
</I>&gt;<i>
</I>&gt;<i> /* called after both parties to a Match have confirmed the proposed Channel
</I>&gt;<i> */
</I>&gt;<i> typedef void (^BumpChannelConfirmedBlock)(BumpChannelID channelID);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is what they would look like in C#:
</I>&gt;<i>
</I>&gt;<i> delegate void BumpEventBlock (bump_event event);
</I>&gt;<i> delegate void BumpMatchBlock (ulong proposedChannelID);
</I>&gt;<i> delegate void BumpChannelConfirmedBlock (ulong channelID);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> How do I know to bind them like this? Well, here's what *I* do:
</I>&gt;<i>
</I>&gt;<i> I look at the ObjC definition:
</I>&gt;<i>
</I>&gt;<i> typedef void (^BumpMatchBlock) (BumpChannelID proposedChannelID);
</I>&gt;<i>
</I>&gt;<i> In ObjC, like C and even C#, all typedef does is alias a type. Function
</I>&gt;<i> pointers in C and Blocks in ObjC need to be typedef'd if you are going to
</I>&gt;<i> use them like &quot;named delegates&quot; (as opposed to anonymous delegates).
</I>&gt;<i>
</I>&gt;<i> So, our revised syntax for named blocks is this:
</I>&gt;<i>
</I>&gt;<i> typedef &lt;return-type&gt; (^&lt;delegate-name&gt;) (&lt;parameter-list&gt;);
</I>&gt;<i>
</I>&gt;<i> Pretty straight forward now, right?
</I>&gt;<i>
</I>&gt;<i> Now it's easy to just do substitution and we get:
</I>&gt;<i>
</I>&gt;<i> delegate void BumpMatchBlock (BumpChannelID proposedChannelId);
</I>&gt;<i>
</I>&gt;<i> Since BumpChannelID maps to a ulong in C#, we can do that substitution and
</I>&gt;<i> we end up with:
</I>&gt;<i>
</I>&gt;<i> delegate void BumpMatchBlock (ulong proposedChannelID);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hope that helps clear things up,
</I>&gt;<i>
</I>&gt;<i> Jeff
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20120416/69065bfd/attachment.html">http://lists.ximian.com/pipermail/monotouch/attachments/20120416/69065bfd/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009161.html">[MonoTouch] btouch Binding of Blocks? (I know its in the docs, but having a little trouble)
</A></li>
	<LI>Next message: <A HREF="009191.html">[MonoTouch] btouch Binding of Blocks? (I know its in the docs, but having a little trouble)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9186">[ date ]</a>
              <a href="thread.html#9186">[ thread ]</a>
              <a href="subject.html#9186">[ subject ]</a>
              <a href="author.html#9186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
