<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] SharpZipLib performances
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20SharpZipLib%20performances&In-Reply-To=%3CCAAG_%2BO72L335_b4fCSypnMf0LYuyivbwUMTvP7%3DC%2BiV91ghMig%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009149.html">
   <LINK REL="Next"  HREF="009152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] SharpZipLib performances</H1>
    <B>Craig Dunn</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20SharpZipLib%20performances&In-Reply-To=%3CCAAG_%2BO72L335_b4fCSypnMf0LYuyivbwUMTvP7%3DC%2BiV91ghMig%40mail.gmail.com%3E"
       TITLE="[MonoTouch] SharpZipLib performances">craig.dunn at conceptdevelopment.net
       </A><BR>
    <I>Fri Apr 13 09:16:01 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009149.html">[MonoTouch] SharpZipLib performances
</A></li>
        <LI>Next message: <A HREF="009152.html">[MonoTouch] SharpZipLib performances
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9150">[ date ]</a>
              <a href="thread.html#9150">[ thread ]</a>
              <a href="subject.html#9150">[ subject ]</a>
              <a href="author.html#9150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>a-ha! context :) for the record, I have used SharpZipLib to decompress
200-500Mb *downloads* (post-install), which makes a lot of sense for
certain applications (say, a magazine reader).


I don't think you are getting much value from ZIPping something you ship in
the IPA. As previously mentioned, the IPA's contents will be unpacked into
the app home directory on the device: so if you've compressed it, uses
200Mb (but you need to unzip) and if you don't it's obviously taking up the
full 700Mb - PLUS another 700mb when you've decompressed it into a
read/write file location.
The problem of 3 mins to unzip seems to override any other consideration
tho' - if your app doesn't start-up and be usable quickly, the app's size
doesn't really matter so much? So i'd definitely consider just bundling the
full-size file... anyway, your call :-)


Now, regardless of what you decide there, you also need to know this: do
NOT put the 700Mb sqlite file in /Documents/ as Apple will reject your app
within seconds of it hitting the approval process! How do I know this? I
followed exactly the same pattern (copy out a pre-built file from the
bundle into /Documents/ - and it was only 2.3Mb!!). Also - there is that
plist property that lets users access /Documents/ from within iTunes... you
may not have it enabled *now*, but if you wanted to in a future version of
your app, you'll be 'screwed' if your main database is located there too...

Why does it get rejected immediately? It violates the *iOS Data Storage
Guidelines*
<A HREF="https://developer.apple.com/icloud/documentation/data-storage/">https://developer.apple.com/icloud/documentation/data-storage/</A>
Point #1 - your data is &quot;not&quot; user-generated, and it &quot;can&quot; be re-created
from the bundle.
You might then continue reading Point #2, and think you should put your
sqlite file in &lt;Application_Home&gt;/Library/Caches/ BUT there is a process
called 'Cleaning &lt;<A HREF="http://www.marco.org/2011/10/13/ios5-caches-cleaning">http://www.marco.org/2011/10/13/ios5-caches-cleaning</A>&gt;'
whereby iOS will (under extremely low storage situations) delete the
contents of /Caches/ without asking!

The solution I've gone for (and which I think is what Apple approves of) is
storing the file in &lt;Application_Home&gt;/Library/ (or in a subfolder that you
create there, but NOT /Caches/) AND following Point #4 whereby you mark the
file with SetSkipBackupAttribute().
So what does this mean?
Your 700Mb file is safe from being deleted, is in a location that will
never be exposed to the user, and is read-write. Good, right? HOWEVER it
also won't be backed-up (not to an iTunes PC nor to iCloud).
That's fine - unless your user deletes and restores your app, or buys a new
device and does a backup/restore to move everything from the old hardware
to the new... your app (with prefs and whatever was in /Documents/) will be
copied across - but your 700Mb read-write sqlite database won't be!
In your FinishedLaunching you are probably doing a 'check' to see if the
database has already been moved (and moving/uncompressing if required) -
the trick is to decouple this from any data that _is_ backed-up (so don't
store a flag in userprefs, or in a file) -- because the flag that says
'sqlite file is loaded' would be backed-up and restored, but the file
itself wouldn't be (ugh, confusing eh? i'm only explaining all this 'cause
i made the mistake myself, thinking a boolean prefs-check was faster than a
System.IO.File.Exists). I think the physical file-exists check is safest
(open to other suggestions tho). if it doesn't exist, unpack from the
bundle all-over-again...
also, don't store any user-generated data in that same 700Mb sqlite. Any
user-entered data should be in a separate sqlite that DOES get backed-up
(too bad about FK dependencies) unless you want to get into an
approval-argument with Apple...


clear as mud? hope it makes some sense... after two rejections my app did
finally get approved with SetSkipBackupAttribute used. but if Apple was
concerned about my 2.3Mb file, they're sure to raise an eyebrow at 700Mb!
let me know if you have questions/need clarification ;-)

HTH
cd





On Fri, Apr 13, 2012 at 6:10 PM, johnHolmes &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">francesco.colombo at gmail.com</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> Nic Wise wrote
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Keep in mind that the file that is downloaded to the users device -
</I>&gt;<i> &gt; .ipa - is a ZIP file already, so you will not benefit from double
</I>&gt;<i> &gt; compression. If you need to keep them all together,then try using
</I>&gt;<i> &gt; store, see what the size of the resulting .ipa is, and the speed
</I>&gt;<i> &gt; difference.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Good point. I'll try to explain why I need to compress the file prior to
</I>&gt;<i> the
</I>&gt;<i> .ipa.
</I>&gt;<i>
</I>&gt;<i> The file is a sqlite db. It's uncompressed size is ~700mb. I need
</I>&gt;<i> read/write
</I>&gt;<i> permission on that file. If I'm not wrong, all &quot;content&quot; file stored in the
</I>&gt;<i> bundle is read only, so i need, once the application is installed, to copy
</I>&gt;<i> the original db to a writable folder. A good candidate seems to be the
</I>&gt;<i> /Document folder. At this point the user will have 2 copy of the file, one
</I>&gt;<i> compressed and one uncompressed, readable and writable, in the /Document
</I>&gt;<i> folder. I know it's not good to have rendundant 200mb of data but I haven't
</I>&gt;<i> found any alternative to this.
</I>&gt;<i>
</I>&gt;<i> Any suggestion?
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://monotouch.2284126.n4.nabble.com/SharpZipLib-performances-tp4553235p4554119.html">http://monotouch.2284126.n4.nabble.com/SharpZipLib-performances-tp4553235p4554119.html</A>
</I>&gt;<i> Sent from the MonoTouch mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20120413/078b56db/attachment-0001.html">http://lists.ximian.com/pipermail/monotouch/attachments/20120413/078b56db/attachment-0001.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009149.html">[MonoTouch] SharpZipLib performances
</A></li>
	<LI>Next message: <A HREF="009152.html">[MonoTouch] SharpZipLib performances
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9150">[ date ]</a>
              <a href="thread.html#9150">[ thread ]</a>
              <a href="subject.html#9150">[ subject ]</a>
              <a href="author.html#9150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
