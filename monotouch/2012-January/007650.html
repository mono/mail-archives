<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Possible AudioSession::Initialize issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Possible%20AudioSession%3A%3AInitialize%20issue&In-Reply-To=%3CCAPgStFgBAH1ca-1E_ZdN3j416D9ysaX1npNuaqGbXQ0H7gCVJA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007692.html">
   <LINK REL="Next"  HREF="007651.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Possible AudioSession::Initialize issue</H1>
    <B>Jackson Harper</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Possible%20AudioSession%3A%3AInitialize%20issue&In-Reply-To=%3CCAPgStFgBAH1ca-1E_ZdN3j416D9ysaX1npNuaqGbXQ0H7gCVJA%40mail.gmail.com%3E"
       TITLE="[MonoTouch] Possible AudioSession::Initialize issue">jacksonh at gmail.com
       </A><BR>
    <I>Thu Jan 26 03:05:53 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="007692.html">[MonoTouch] BUG: exception	'NSInvalidUnarchiveOperationException',	reason: 'Could not instantiate class named MKMapView' - solution wire	it up to an instance variable
</A></li>
        <LI>Next message: <A HREF="007651.html">[MonoTouch] Previous version of MonoDevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7650">[ date ]</a>
              <a href="thread.html#7650">[ thread ]</a>
              <a href="subject.html#7650">[ subject ]</a>
              <a href="author.html#7650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am seeing occasional exceptions with this code:

AudioSession.Initialize ();

AudioSession.Category = AudioSessionCategory.PlayAndRecord;


The exception is:

MonoTouch.AudioToolbox.AudioSessionException: AudioSession.Initialize has
not been called
at MonoTouch.AudioToolbox.AudioSession.SetInt (AudioSessionProperty
property, Int32 val) [0x00000] in &lt;filename unknown&gt;:0
at MonoTouch.AudioToolbox.AudioSession.set_Category (AudioSessionCategory
value) [0x00000] in &lt;filename unknown&gt;:0


This happens very infrequently, but it is usually after the app has been
backgrounded and then reopened.

Looking at the IL for AudioSession::Initialize it looks like MT sets an
initialized flag and doesn't call the underlying AudioSessionInitialize
function if thats been set, so basically every time you call
AudioSession::Initialize after the first time you call it, its a noop.  I
can't find anything in the AudioSession docs that say you should call
AudioSessionInitialize when the app is woken up, but based on that
exception, I think you need to.  In my most recent crash report the app was
backgrounded for three hours, so its not surprising that it would somehow
&quot;lose&quot; its Audio Session, but that initialized flag will still be set.

I think the best solution might be to always call AudioSessionInitialize
(it will return an error code if the session is already initialized) and
bail before doing the MT specific setup if its already initialized.

I can file this as a bug if you'd like, I just posted to the list because
I'm still not 100% an AudioSessionInitialize call should be needed.

Jackson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20120125/7fba789f/attachment.html">http://lists.ximian.com/pipermail/monotouch/attachments/20120125/7fba789f/attachment.html</A>&gt;
</PRE>








































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007692.html">[MonoTouch] BUG: exception	'NSInvalidUnarchiveOperationException',	reason: 'Could not instantiate class named MKMapView' - solution wire	it up to an instance variable
</A></li>
	<LI>Next message: <A HREF="007651.html">[MonoTouch] Previous version of MonoDevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7650">[ date ]</a>
              <a href="thread.html#7650">[ thread ]</a>
              <a href="subject.html#7650">[ subject ]</a>
              <a href="author.html#7650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
