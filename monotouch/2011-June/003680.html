<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] LINQ to Objects causes JIT Exception on device
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20LINQ%20to%20Objects%20causes%20JIT%20Exception%20on%20device&In-Reply-To=11432584-6BDB-486F-B03C-752664D4554E%40me.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003677.html">
   <LINK REL="Next"  HREF="003681.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] LINQ to Objects causes JIT Exception on device</H1>
    <B>Brian Schuth</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20LINQ%20to%20Objects%20causes%20JIT%20Exception%20on%20device&In-Reply-To=11432584-6BDB-486F-B03C-752664D4554E%40me.com"
       TITLE="[MonoTouch] LINQ to Objects causes JIT Exception on device">brian at alphce.com
       </A><BR>
    <I>Thu Jun 23 17:01:18 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003677.html">[MonoTouch] LINQ to Objects causes JIT Exception on device
</A></li>
        <LI>Next message: <A HREF="003681.html">[MonoTouch] LINQ to Objects causes JIT Exception on device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3680">[ date ]</a>
              <a href="thread.html#3680">[ thread ]</a>
              <a href="subject.html#3680">[ subject ]</a>
              <a href="author.html#3680">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks; I was thinking I might need to do something like this, but it's not
clear that there's anyway I can. The message refers to
&quot;&lt;ToLookup`2&gt;m__13&lt;TestGeneric.ActivitiesItem,
int&gt; (TestGeneric.ActivitiesItem)'&quot; as the offending item, which looks to me
like some internally generated type &lt;ToLookup`2&gt; being referred to.  If I
unroll the linq and just do something like the below to achieve the same
result, the unrolled version works fine, but the LINQ version still crashes
with the same message:

List&lt;EnteredItem&gt; entered = new List&lt;EnteredItem&gt;();
foreach (ItemResponse ri in _responses) {
foreach(ActivitiesItem ai in Items) {
if (ri.ItemId == ai.ID &amp;&amp; ri.IsSkippedBool == false) {
EnteredItem result = new EnteredItem(ai.Slope, ri.Choice);
entered.Add(result);
}
}
}
}

Alas, I think I need to unroll my failing LINQ statements if I want to make
any progress. Happily, most of them look like syntactic sugar for the above,
rather than any serious leveraging of LINQ features.

If anyone else can confirm that the example I wrote dies on their iPad 2
while succeeding on their iPhone, I'd feel comfortable just writing this off
to a Monotouch bug and accepting my fate... Thanks.

bjs

On Thu, Jun 23, 2011 at 4:14 PM, pmacko [via MonoTouch] &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">ml-node+3620899-250058166-244237 at n4.nabble.com</A>&gt; wrote:

&gt;<i> I put something this in my last project to get around jit issues. Chucked
</I>&gt;<i> it into the app delegate and called it during application loaded just to
</I>&gt;<i> make sure the linker 'got' it.
</I>&gt;<i>
</I>&gt;<i> private void MonoTouchForcedCompilationHacks()
</I>&gt;<i> {
</I>&gt;<i> {
</I>&gt;<i> var hack1 = new UIInterfaceOrientation[0];
</I>&gt;<i>
</I>&gt;<i> if(!((ICollection&lt;UIInterfaceOrientation&gt;)hack1).Contains(UIInterfaceOrientation.PortraitUpsideDown))
</I>&gt;<i> {
</I>&gt;<i> AppState.DebugWriteLine(&quot; JIT-avoidance&quot;);
</I>&gt;<i> _hackCount++;
</I>&gt;<i> }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> (repeat for other classes that caused JIT grief)
</I>&gt;<i>
</I>&gt;<i> string x = string.Format(&quot;Hack Count: {0}&quot;, _hackCount);
</I>&gt;<i> AppState.DebugWriteLine(x);
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Jun 23, 2011, at 3:59 PM, Brian Schuth wrote:
</I>&gt;<i>
</I>&gt;<i> Well, it was worth a try, but no, it still happens. Thanks.
</I>&gt;<i>
</I>&gt;<i> bjs
</I>&gt;<i>
</I>&gt;<i> On Thu, Jun 23, 2011 at 3:50 PM, gorhal [via MonoTouch] &lt;&lt;a
</I>&gt;<i> href=&quot;x-<A HREF="msg://60/user/SendEmail.jtp?type=node&amp;amp;node=3620857&amp;amp;i=0&quot;">msg://60/user/SendEmail.jtp?type=node&amp;amp;node=3620857&amp;amp;i=0&quot;</A>
</I>&gt;<i> target=&quot;_top&quot; rel=&quot;nofollow&quot; link=&quot;external&quot;&gt;[hidden email]&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi there
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sometimes I have had some strange behaviours/crashes because of a
</I>&gt;&gt;<i> breakpoint... I know it sounds weird, but try to remove all your breakpoints
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /goran
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Skickat fr&#229;n min iPhone
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 23 jun 2011 kl. 18:46 skrev Brian Schuth &lt;[hidden email]&lt;<A HREF="http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=0">http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=0</A>&gt;
</I>&gt;&gt;<i> &gt;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm writing an iPad app that uses pre-existing C# libraries to drive the
</I>&gt;&gt;<i> logic (which is why we are using MonoTouch). On the simulator all is well,
</I>&gt;&gt;<i> but on the device a use of LINQ for objects is causing a JIT crash.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've looked at the MonoTouch limitations, and I can understand how certain
</I>&gt;&gt;<i> uses of generics can hide function calls from the linker, but I'm not
</I>&gt;&gt;<i> sophisticated enough to know why the following crashes:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> // ActivitiesItem in this test is a very simple object with two int
</I>&gt;&gt;<i> properties, ID and Slope, which
</I>&gt;&gt;<i> // are set by the constructor
</I>&gt;&gt;<i> List&lt;ActivitiesItem&gt; Items = new List&lt;ActivitiesItem&gt;();
</I>&gt;&gt;<i> Items.Add(new ActivitiesItem(1, 1));
</I>&gt;&gt;<i> Items.Add(new ActivitiesItem(2, 2));
</I>&gt;&gt;<i> Items.Add(new ActivitiesItem(3, 3));
</I>&gt;&gt;<i>  // ItemResponse is another simple object with two int properties, ItemId
</I>&gt;&gt;<i> and Choice, and
</I>&gt;&gt;<i> // one bool property, IsSkippedBool, which are set via the constructor.
</I>&gt;&gt;<i> List&lt;ItemResponse&gt; _responses = new List&lt;ItemResponse&gt;();
</I>&gt;&gt;<i> _responses.Add(new ItemResponse(1, 10, true));
</I>&gt;&gt;<i> _responses.Add(new ItemResponse(3, 20, false));
</I>&gt;&gt;<i>  IEnumerable&lt;EnteredItem&gt; responseItems = from r in _responses
</I>&gt;&gt;<i>              join i in Items on r.ItemId equals i.ID
</I>&gt;&gt;<i>             where r.IsSkippedBool == false
</I>&gt;&gt;<i>             select new EnteredItem(i.Slope, r.Choice);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> int count = responseItems.Count();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The program crashes on the invocation of the last line, but in the
</I>&gt;&gt;<i> debugger that line causes execution to jump to the &quot;join&quot; line in the LINQ
</I>&gt;&gt;<i> statement. Stepping through, I reach the accessor for ActivitiesItem.ID,
</I>&gt;&gt;<i> then after clicking that I get:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Attempting to JIT compile method 'System.Linq.Enumerable:
</I>&gt;&gt;<i> &lt;ToLookup`2&gt;m__13&lt;TestGeneric.ActivitiesItem, int&gt;
</I>&gt;&gt;<i> (TestGeneric.ActivitiesItem)' while running with --aot-only
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If LINQ doesn't work in MonoTouch, I'm going to be a fairly unhappy man
</I>&gt;&gt;<i> this afternoon...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> bjs
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Brian Schuth
</I>&gt;&gt;<i> ALPHCE, Inc.
</I>&gt;&gt;<i> Eastport, ME
</I>&gt;&gt;<i> &lt;a href=&quot;tel:%2B1%20207%20370%202430&quot; value=&quot;+12073702430&quot;
</I>&gt;&gt;<i> target=&quot;_blank&quot;&gt;+1 207 370 2430
</I>&gt;&gt;<i> [hidden email] &lt;<A HREF="http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=1">http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=1</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  _______________________________________________
</I>&gt;&gt;<i> MonoTouch mailing list
</I>&gt;&gt;<i> [hidden email] &lt;<A HREF="http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=2">http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=2</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> MonoTouch mailing list
</I>&gt;&gt;<i> [hidden email] &lt;<A HREF="http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=3">http://user/SendEmail.jtp?type=node&amp;node=3620831&amp;i=3</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------
</I>&gt;&gt;<i>  If you reply to this email, your message will be added to the discussion
</I>&gt;&gt;<i> below:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3620831.html">http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3620831.html</A>
</I>&gt;&gt;<i>  To start a new topic under MonoTouch, email &lt;a
</I>&gt;&gt;<i> href=&quot;x-<A HREF="msg://60/user/SendEmail.jtp?type=node&amp;amp;node=3620857&amp;amp;i=1&quot;">msg://60/user/SendEmail.jtp?type=node&amp;amp;node=3620857&amp;amp;i=1&quot;</A>
</I>&gt;&gt;<i> target=&quot;_top&quot; rel=&quot;nofollow&quot; link=&quot;external&quot;&gt;[hidden email]
</I>&gt;&gt;<i> To unsubscribe from MonoTouch, &lt;a href=&quot;x-<A HREF="msg://60/&quot;">msg://60/&quot;</A> target=&quot;_blank&quot;
</I>&gt;&gt;<i> rel=&quot;nofollow&quot; link=&quot;external&quot;&gt;click here.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Brian Schuth
</I>&gt;<i> ALPHCE, Inc.
</I>&gt;<i> Eastport, ME
</I>&gt;<i> +1 207 370 2430
</I>&gt;<i> &lt;a href=&quot;x-<A HREF="msg://60/user/SendEmail.jtp?type=node&amp;amp;node=3620857&amp;amp;i=2&quot;">msg://60/user/SendEmail.jtp?type=node&amp;amp;node=3620857&amp;amp;i=2&quot;</A>
</I>&gt;<i> target=&quot;_top&quot; rel=&quot;nofollow&quot; link=&quot;external&quot;&gt;[hidden email]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i> View this message in context: Re: LINQ to Objects causes JIT Exception on
</I>&gt;<i> device&lt;<A HREF="http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3620857.html">http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3620857.html</A>&gt;
</I>&gt;<i> Sent from the MonoTouch mailing list archive&lt;<A HREF="http://monotouch.2284126.n4.nabble.com/">http://monotouch.2284126.n4.nabble.com/</A>&gt;at
</I>&gt;<i> Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> [hidden email] &lt;<A HREF="http://user/SendEmail.jtp?type=node&amp;node=3620899&amp;i=0">http://user/SendEmail.jtp?type=node&amp;node=3620899&amp;i=0</A>&gt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> [hidden email] &lt;<A HREF="http://user/SendEmail.jtp?type=node&amp;node=3620899&amp;i=1">http://user/SendEmail.jtp?type=node&amp;node=3620899&amp;i=1</A>&gt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>  If you reply to this email, your message will be added to the discussion
</I>&gt;<i> below:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3620899.html">http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3620899.html</A>
</I>&gt;<i>  To start a new topic under MonoTouch, email
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">ml-node+3346893-429347289-244237 at n4.nabble.com</A>
</I>&gt;<i> To unsubscribe from MonoTouch, click here&lt;<A HREF="http://monotouch.2284126.n4.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=3346893&amp;code=YnJpYW5AYWxwaGNlLmNvbXwzMzQ2ODkzfDU2ODcyMzk0Ng==">http://monotouch.2284126.n4.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=3346893&amp;code=YnJpYW5AYWxwaGNlLmNvbXwzMzQ2ODkzfDU2ODcyMzk0Ng==</A>&gt;.
</I>&gt;<i>
</I>&gt;<i>
</I>


-- 
Brian Schuth
ALPHCE, Inc.
Eastport, ME
+1 207 370 2430
<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">brian at alphce.com</A>


--
View this message in context: <A HREF="http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3621030.html">http://monotouch.2284126.n4.nabble.com/LINQ-to-Objects-causes-JIT-Exception-on-device-tp3620411p3621030.html</A>
Sent from the MonoTouch mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20110623/9e08e20b/attachment-0001.html">http://lists.ximian.com/pipermail/monotouch/attachments/20110623/9e08e20b/attachment-0001.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003677.html">[MonoTouch] LINQ to Objects causes JIT Exception on device
</A></li>
	<LI>Next message: <A HREF="003681.html">[MonoTouch] LINQ to Objects causes JIT Exception on device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3680">[ date ]</a>
              <a href="thread.html#3680">[ thread ]</a>
              <a href="subject.html#3680">[ subject ]</a>
              <a href="author.html#3680">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
