<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Anyone%20knows%20a%20workaround%20for%20bug%20in%20Sqlite%20on%20iPad%0A%20-%20or%20tell%20me%20what%20I%20am%20doing%20wrong.&In-Reply-To=CA1647A4.9B0B%25karl%40e-magesolutions.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003575.html">
   <LINK REL="Next"  HREF="003558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.</H1>
    <B>Anders Kj&#230;rgaard Hansen</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Anyone%20knows%20a%20workaround%20for%20bug%20in%20Sqlite%20on%20iPad%0A%20-%20or%20tell%20me%20what%20I%20am%20doing%20wrong.&In-Reply-To=CA1647A4.9B0B%25karl%40e-magesolutions.com"
       TITLE="[MonoTouch] Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.">Anders.Kjaergaard.Hansen at logimatic.dk
       </A><BR>
    <I>Fri Jun 10 04:00:43 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003575.html">[MonoTouch] SPAM-LOW: Re: Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.
</A></li>
        <LI>Next message: <A HREF="003558.html">[MonoTouch] Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3571">[ date ]</a>
              <a href="thread.html#3571">[ thread ]</a>
              <a href="subject.html#3571">[ subject ]</a>
              <a href="author.html#3571">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Karl

I have attached a small sample solution that illustrates my problem.

I will during the day try and elaborate with this, and try to figure out some conclusion for myself.

It contains two important classes:
Main.cs - in the FinishedLaunching method I instantiate my DbController, and calls it a thousand times with 1000 inserts, roughly 20 times I do select as well. In the current state in the attached project, I do all this on the main thread - and it still fails.
I have furthermore created code for two BackgroundWorkers to illustrate the threaded issue. It seems to fail more often on the threaded version - but that doesn't matter. It fails singlethreaded as well.

The other class is the DbController. I have tried to take some of what I like from the Android approach, with versioning. So it have constructor, initialize and update methods. That should matter much though for the sample - just left it in from my original app.

It then have the two methods to insert and select, and some general methods to handle nonquery, reader and scalar executes.

In this code some have been tried, and commented out to ensure &quot;single thread access&quot; when it runs multithreaded - not with much effect though.

I would be very happy if you can spare some few minutes to look at the source and maybe run the sample - and verify that the same appears at your end.

And furthermore it would of course be nice if you could see what I am doing wrong in my DbController.

Best regards
/Anders

From: <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch-bounces at lists.ximian.com</A>] On Behalf Of Karl Heinz Brehme Arredondo
Sent: 9. juni 2011 14:56
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>
Subject: Re: [MonoTouch] Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.

I'm using that since January and do not have any unesplicable issue. Can you put a sample of code and query?

The only issue that I had was trying to put sqlite functions inside database but it's no possible on iOS because this genertes dynamic code, unsuported on iOS.

But I use ADO.NET objects SqliteConnection, SqliteDataReader and SqliteCommand, to ExecuteNonQuery and ExecuteReader and do not had any problem yet. The database have more that 40 tables, many of them with a few records and some of then with 1000 records, all dynamically downloaded from server and tables created on the fly, commanded by server.

Sqlite is a bit simpler and limited than I like but appear to be reliable. But as Sqlite is limited, SQL Mobile 2005 (Windows Mobile) also is limited but with same C# code between SQL Mobile 2005 and Sqlite on iOS and Android things runs OK here...

Karl

From: Anders Kj&#230;rgaard Hansen &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">Anders.Kjaergaard.Hansen at logimatic.dk</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">Anders.Kjaergaard.Hansen at logimatic.dk</A>&gt;&gt;
Date: Thu, 9 Jun 2011 09:46:15 +0200
To: &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>&gt;&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>&gt;&gt;
Subject: [MonoTouch] Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.

Hi,

I am developing an iPad application, and is using the Sqlite database for data storage (Mono.Data.Sqlite)

Sometimes my queries fail and the ipad app crashes. No exceptions, it just crashes.

The stacktrace I get is similar to the one described in this bug report <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=696025.">https://bugzilla.novell.com/show_bug.cgi?id=696025.</A>

To sum up the important lines of the stacktrace is:
  at (wrapper managed-to-native) Mono.Data.Sqlite.UnsafeNativeMethods.sqlite3_prepare (intptr,intptr,int,intptr&amp;,intptr&amp;) &lt;IL 0x0002a, 0xffffffff&gt;
  at Mono.Data.Sqlite.SQLite3.Prepare (Mono.Data.Sqlite.SqliteConnection,string,Mono.Data.Sqlite.SqliteStatement,uint,string&amp;) [0x00044] in
      /Developer/MonoTouch/Source/mono/mcs/class/Mono.Data.Sqlite/Mono.Data.Sqlite_2.0/SQLite3.cs:258
  at Mono.Data.Sqlite.SqliteCommand.BuildNextCommand () [0x00019] in
      /Developer/MonoTouch/Source/mono/mcs/class/Mono.Data.Sqlite/Mono.Data.Sqlite_2.0/SQLiteCommand.cs:230
 ...
  at Mono.Data.Sqlite.SqliteCommand.ExecuteNonQuery () [0x00000] in
      /Developer/MonoTouch/Source/mono/mcs/class/Mono.Data.Sqlite/Mono.Data.Sqlite_2.0/SQLiteCommand.cs:568
  at MYAPP.db.DbController.ExecuteNonQuery (Mono.Data.Sqlite.SqliteCommand) [0x00027] in
      /Users/MYUSERNAME/Code/PRODUCT/trunk/IPAD_APP/IPAD_APP/db/DbController.cs:773
  at MYAPP.db.DbController.SaveInspectionJobHistory (PRODUCT.ServiceApi.InspectionJobHistory) [0x00274] in
      /Users/MYUSERNAME/Code/PRODUCT/trunk/IPAD_APP/IPAD_APP/db/DbController.cs:360

I have tried to ensure that my app only executes one sql statement at a time, but the issue still appears. It also seems random if the bug occurs in ExecuteNonQuery or ExecuteReader statements.

Does anyone know why this appears, and more importantly, does anyone have some hints at what I am doing wrong that can cause this to appear.

We are getting close to launching the app, and I am considering changing the datastore to something else if I don't feel confident with the Sqlite implementation in MonoTouch.

Best regards
/Anders


_______________________________________________ MonoTouch mailing list <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20110610/e1e0e2a8/attachment-0001.html">http://lists.ximian.com/pipermail/monotouch/attachments/20110610/e1e0e2a8/attachment-0001.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: DbThreadingTest.zip
Type: application/x-zip-compressed
Size: 9062 bytes
Desc: DbThreadingTest.zip
Url : <A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20110610/e1e0e2a8/attachment-0001.bin">http://lists.ximian.com/pipermail/monotouch/attachments/20110610/e1e0e2a8/attachment-0001.bin</A> 
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003575.html">[MonoTouch] SPAM-LOW: Re: Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.
</A></li>
	<LI>Next message: <A HREF="003558.html">[MonoTouch] Anyone knows a workaround for bug in Sqlite on iPad - or tell me what I am doing wrong.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3571">[ date ]</a>
              <a href="thread.html#3571">[ thread ]</a>
              <a href="subject.html#3571">[ subject ]</a>
              <a href="author.html#3571">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
