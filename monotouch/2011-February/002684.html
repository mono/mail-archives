<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Problem of binding custom obj-c library.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Problem%20of%20binding%20custom%20obj-c%20library.&In-Reply-To=AANLkTi%3Doixgfu-hKDnbBaQHH4kVw9ZA5E%3Dz1mU6TWPK5%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002682.html">
   <LINK REL="Next"  HREF="002685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Problem of binding custom obj-c library.</H1>
    <B>Jeffrey Zhao</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Problem%20of%20binding%20custom%20obj-c%20library.&In-Reply-To=AANLkTi%3Doixgfu-hKDnbBaQHH4kVw9ZA5E%3Dz1mU6TWPK5%40mail.gmail.com"
       TITLE="[MonoTouch] Problem of binding custom obj-c library.">jeffz at live.com
       </A><BR>
    <I>Mon Feb 21 12:51:05 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002682.html">[MonoTouch] Problem of binding custom obj-c library.
</A></li>
        <LI>Next message: <A HREF="002685.html">[MonoTouch] Fatal error: Got a SIGSEGV while executing native code.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2684">[ date ]</a>
              <a href="thread.html#2684">[ thread ]</a>
              <a href="subject.html#2684">[ subject ]</a>
              <a href="author.html#2684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It seems that the MyOpenApiDelegate instance should be referenced by OpenApi - if the argument would be used as a callback, so it shouldn&#8217;t be garbage collected.

Or it&#8217;s just the special behavior of MonoTouch?


Jeffrey Zhao
Blog: <A HREF="http://blog.zhaojie.me/">http://blog.zhaojie.me/</A>
Twitter: @jeffz_cn

From: Duane Wandless 
Sent: Tuesday, February 22, 2011 12:05 AM
To: Jeffrey Zhao 
Cc: Geoff Norton ; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">gnorton.novell at gmail.com</A> ; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A> 
Subject: Re: [MonoTouch] Problem of binding custom obj-c library.

In the build output the error was this:
ld: file not found: /Users/inote/Dropbox/projects/MT-OA/MT-OA/OpenAPI.a
collect2: ld returned 1 exit status


That is from the text you attached to this email thread.  Looking for the OpenAPI.a file it was in the ${ProjectDir}/lib folder.  So I modified the extra arguments to include &quot;-force_load ${ProjectDir}/lib/OpenAPI.a&quot;.  Fixing that showed the error that the lSDOCertification library was misspelled.  Fixing those allowed it to compile.  


As you had the button click the MyOpenApiDelegate was being garbage collected.  To avoid that you create a class variable.  That is a common problem people run into.  Not sure about the other usages in your code.  Sometimes the simulator will not crash with this issue immediately and on device will.  Just watch out for variables that will be garbage collected.


Duane

On Mon, Feb 21, 2011 at 10:41 AM, Jeffrey Zhao &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">jeffz at live.com</A>&gt; wrote:

  What stupid mistakes I&#8217;ve made! How do you figure out the problem, by reading the build output or simply checking the extra arguments one character by another? I have to say the output is just some text do not make any sense to me...

  Now the code works in simulator, thank you very much. And now I&#8217;ve another question &#8211; why MyOpenApiDelegate has to be a class variable? That occurs to me that I&#8217;ve a lot of delegates or controllers or something declared as local variables. It seems working fine in simulator and device. Any problem with that?

  Jeffrey Zhao
  Blog: <A HREF="http://blog.zhaojie.me/">http://blog.zhaojie.me/</A>
  Twitter: <A HREF="http://twitter.com/jeffz_cn">http://twitter.com/jeffz_cn</A>

  From: Duane Wandless 
  Sent: Monday, February 21, 2011 8:14 PM
  To: Jeffrey Zhao 
  Cc: Geoff Norton ; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">gnorton.novell at gmail.com</A> ; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A> 
  Subject: Re: [MonoTouch] Problem of binding custom obj-c library.

  There are a couple of problems.  Your extra arguments are incorrect.  You misspelled SDOCertification.  The libraries are in a different folder than what is specified by extra arguments.  Here is a fixed extra arguments: 

  -v -v -v -gcc_flags &quot;-L${ProjectDir}/lib -lSDOCertification 
  -framework CFNetwork -framework MobileCoreServices -framework CoreTelephony -force_load ${ProjectDir}/lib/OpenAPI.a&quot; 

  Modified your Main.cs.  The MyOpenApiDelegate object needs to be a class variable.

  // The name AppDelegate is referenced in the MainWindow.xib file.
  public partial class AppDelegate : UIApplicationDelegate
  {
  MyOpenApiDelegate del;
  // This method is invoked when the application has loaded its UI and its ready to run
  public override bool FinishedLaunching (UIApplication app, NSDictionary options)
  {
  // If you have defined a view, add it here:
  // window.AddSubview (navigationController.View);
  window.MakeKeyAndVisible ();
  this.m_btnHello.TouchUpInside += delegate {
  var openApi = new OpenAPI();
  del = new MyOpenApiDelegate(); 
  openApi.StartOA(del);
  };
  return true;
  }

  Modified your binding file.  The OpenApiDelegate is the Model.

  [BaseType (typeof (NSObject))]
  [Model]
  interface OpenApiDelegate
  {
  [Export(&quot;onSuccess:result:&quot;)]
  [Abstract]
  void OnSuccess(int result, NSDictionary paraDic);
  [Export(&quot;onFail:result:&quot;)]
  [Abstract]
  void OnFail(int optType, NSDictionary paraDic);
  }
  [BaseType(typeof(NSObject))]
  interface OpenAPI
  {
  [Export(&quot;startOAWithDelegate:&quot;)]
  void StartOA(OpenApiDelegate d);
  }

  When I run it in the simulator the Success popup occurs.
  Best of luck.
  Duane

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20110222/8b52a7bd/attachment.html">http://lists.ximian.com/pipermail/monotouch/attachments/20110222/8b52a7bd/attachment.html</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002682.html">[MonoTouch] Problem of binding custom obj-c library.
</A></li>
	<LI>Next message: <A HREF="002685.html">[MonoTouch] Fatal error: Got a SIGSEGV while executing native code.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2684">[ date ]</a>
              <a href="thread.html#2684">[ thread ]</a>
              <a href="subject.html#2684">[ subject ]</a>
              <a href="author.html#2684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
