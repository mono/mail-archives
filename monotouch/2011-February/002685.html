<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Fatal error: Got a SIGSEGV while executing native code.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Fatal%20error%3A%20Got%20a%20SIGSEGV%20while%20executing%20native%20code.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002684.html">
   <LINK REL="Next"  HREF="002686.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Fatal error: Got a SIGSEGV while executing native code.</H1>
    <B>Jeffrey Zhao</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Fatal%20error%3A%20Got%20a%20SIGSEGV%20while%20executing%20native%20code.&In-Reply-To="
       TITLE="[MonoTouch] Fatal error: Got a SIGSEGV while executing native code.">jeffz at live.com
       </A><BR>
    <I>Mon Feb 21 22:42:07 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002684.html">[MonoTouch] Problem of binding custom obj-c library.
</A></li>
        <LI>Next message: <A HREF="002686.html">[MonoTouch] Size of MT app executable
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2685">[ date ]</a>
              <a href="thread.html#2685">[ thread ]</a>
              <a href="subject.html#2685">[ subject ]</a>
              <a href="author.html#2685">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

I&#161;&#175;m binding a obj-c library in MonoTouch. But one of the API causes an error says:

=================================================================
Got a SIGSEGV while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries
used by your application.
=================================================================

The complete error message is too large so I put it here: <A HREF="https://docs.google.com/document/pub?id=1X0291lBugLhIsGkiVKm9fKiMN3FXB8IdmiaG5tCTD3U">https://docs.google.com/document/pub?id=1X0291lBugLhIsGkiVKm9fKiMN3FXB8IdmiaG5tCTD3U</A>

I found something in the web: <A HREF="http://www.mono-project.com/Interop_with_Native_Libraries#Strings_as_Return_Values.">http://www.mono-project.com/Interop_with_Native_Libraries#Strings_as_Return_Values.</A> It seems the problem is caused by an unexpect-freed String object. In the assembly generated by mtouch, I found the following details of the error method:

public void Login(string username, string password, bool isAutoLogin, OpenApiDelegate del) {
    // argument check

    NSString V_0 = new NSString(username);
    NSString V_1 = new NSString(password);

    if (this.IsDirectBinding) {
        Messaging.void_objc_xxx...
    } else {
        Messaging.void_objc_xxx...
    }

    V_0.Dispose();
    V_1.Dispose();
}

Is that caused by the string disposed at the end of the method? The Login method would print some log which shows the communication to the server is successful with the result I need, but the error occurred when calling-back to the local code.

The method below can be used normally in obj-c project:

(void)login:(NSString*)acnt password:(NSString*)pwd isAutoLogin:(BOOL)autoLogin withDelegate:(id&lt;OpenAPIDelegate&gt;)delegate;

And here&#161;&#175;s what I did for binding:

[BaseType (typeof (NSObject))]
[Model]
interface OpenApiDelegate
{
    [Export(&quot;onSuccess:result:&quot;)]
    [Abstract]
    void OnSuccess(int result, NSDictionary paraDic);
    
    [Export(&quot;onFail:result:&quot;)]
    [Abstract]
    void OnFail(int optType, NSDictionary paraDic);
}

// binding to OpenAPI class. btw, how do use another name?
[BaseType(typeof(NSObject))]
interface OpenAPI
{
    [Export(&quot;startOAWithDelegate:&quot;)]
    void StartOA(OpenApiDelegate d);
    
    [Export(&quot;login:password:isAutoLogin:withDelegate:&quot;)]
    void Login(string username, string password, bool isAutoLogin, OpenApiDelegate del);
}

BTW, the StartOA method without using string as the argument works fine.

Jeffrey Zhao
Blog: <A HREF="http://blog.zhaojie.me/">http://blog.zhaojie.me/</A>
Twitter: <A HREF="http://twitter.com/jeffz_cn">http://twitter.com/jeffz_cn</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20110222/78f47d8d/attachment.html">http://lists.ximian.com/pipermail/monotouch/attachments/20110222/78f47d8d/attachment.html</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002684.html">[MonoTouch] Problem of binding custom obj-c library.
</A></li>
	<LI>Next message: <A HREF="002686.html">[MonoTouch] Size of MT app executable
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2685">[ date ]</a>
              <a href="thread.html#2685">[ thread ]</a>
              <a href="subject.html#2685">[ subject ]</a>
              <a href="author.html#2685">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
