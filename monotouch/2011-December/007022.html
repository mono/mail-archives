<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Still IntPtr Constructor issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Still%20IntPtr%20Constructor%20issues&In-Reply-To=675EC6EA-E953-467F-B6CA-4C685A162514%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007010.html">
   <LINK REL="Next"  HREF="007031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Still IntPtr Constructor issues</H1>
    <B>Rolf Bjarne Kvinge</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Still%20IntPtr%20Constructor%20issues&In-Reply-To=675EC6EA-E953-467F-B6CA-4C685A162514%40gmail.com"
       TITLE="[MonoTouch] Still IntPtr Constructor issues">rolf at xamarin.com
       </A><BR>
    <I>Thu Dec  8 16:19:43 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="007010.html">[MonoTouch] Still IntPtr Constructor issues
</A></li>
        <LI>Next message: <A HREF="007031.html">[MonoTouch] Still IntPtr Constructor issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7022">[ date ]</a>
              <a href="thread.html#7022">[ thread ]</a>
              <a href="subject.html#7022">[ subject ]</a>
              <a href="author.html#7022">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ren&#233;,

On Thu, Dec 8, 2011 at 5:40 PM, Ren&#233; Ruppert &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">rene.ruppert at googlemail.com</A>&gt;wrote:

&gt;<i> Thanks for this detailed answer. Is there a list of cases that show when I
</I>&gt;<i> will have to keep explicit refs? You should know best where things can go
</I>&gt;<i> wrong.
</I>&gt;<i>
</I>
Unfortunately it's not possible to have an exhaustive list of cases, since
the iOS API is quite big. As a general rule you need to keep explicit
references to framework objects (instances of framework types you haven't
subclassed, for instance UITableViewCell). In some cases MonoTouch will add
that explicit reference for you (it depends on the API, sometimes we can't
add explicit references because of how the API is bound, in some cases
because we don't know when we'd have to clear that explicit reference). In
any case issues tend to show themselves pretty quickly in the simulator
(since we've made the GC very aggressive there exactly to catch issues like
these), and you'll usually be able to tell at least the type of the object
that's been freed (that's the exception about the IntPtr ctor).

Please announce once you have that document ready that explains the
&gt;<i> changes. Miguel said you are working on a concept that will fix all of
</I>&gt;<i> these problems. Is this the same topic?
</I>&gt;<i>
</I>
Yes, it is.


&gt;<i> As for releasing the references: if the view that is using the cells is
</I>&gt;<i> managed by a controller, is my assumption correct that I do not need to
</I>&gt;<i> release them explicitly if I hold them in the view itself? I mean, if the
</I>&gt;<i> view is unloaded it should get GC'd together with the cells.
</I>&gt;<i>
</I>
If you have a (managed) list of cells in a view, and that view is freed by
the GC, then the list (and its items) will be freed too (note that the fact
that a view is unloaded doesn't necessarily mean that the view can be
collected from the GC's point of view (even though that's generally true),
you might have a reference to the view somewhere else - what you can do
though is to clear the list of cells in the ViewDidUnload method).

Best regards,
Rolf


&gt;<i>
</I>&gt;<i> Gr&#252;&#223;e, Ren&#233;
</I>&gt;<i>
</I>&gt;<i> Am 08.12.2011 um 16:56 schrieb Rolf Bjarne Kvinge &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">rolf at xamarin.com</A>&gt;:
</I>&gt;<i>
</I>&gt;<i> On Thu, Dec 8, 2011 at 1:52 AM, Rene Ruppert &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">rene.ruppert at googlemail.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> But isn't that then,like Miguel said, an issue of Monotouch? Shouldn't it
</I>&gt;&gt;<i> keep a reference?
</I>&gt;&gt;<i> I have not seen a single MT example so far tat keeps explicit references
</I>&gt;&gt;<i> to table view cells. Are they all wrong?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It's actually quite a tricky subject, we've tried a lot of possible
</I>&gt;<i> solutions and we've come to the conclusion that it's virtually impossible
</I>&gt;<i> to make it perfect (which is that managed code should not need to hold
</I>&gt;<i> objects alive manually and at the same time no objects should be leaked).
</I>&gt;<i> We have improved some scenarios (included in the current v5.1.1 beta, but
</I>&gt;<i> it has to be enabled manually), and we're working on documentation
</I>&gt;<i> explaining exactly what has been improved.
</I>&gt;<i>
</I>&gt;<i> Returning to your particular problem: in theory it should work if you
</I>&gt;<i> subclass UITableViewCell (which you do) - in which case the object is kept
</I>&gt;<i> alive while native code has a ref. Unfortunately objc might not keep a ref
</I>&gt;<i> in all cases (for instance look at assign setter semantics here:
</I>&gt;<i> <A HREF="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Chapters/ocProperties.html#//apple_ref/doc/uid/TP30001163-CH17-SW2">http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Chapters/ocProperties.html#//apple_ref/doc/uid/TP30001163-CH17-SW2</A>),
</I>&gt;<i> which I suspect is what's happening to you. It is however hard to find the
</I>&gt;<i> exact cause without a sample we can run ourselves.
</I>&gt;<i>
</I>&gt;<i> Keeping an explicit ref to table view cells is a pretty easy workaround
</I>&gt;<i> (and it doesn't suffer from the undefined behavior adding the IntPtr ctor
</I>&gt;<i> would have). The problem is of course to know when to remove the explicit
</I>&gt;<i> ref - but in my experience you don't end up with that many table view cell
</I>&gt;<i> instances if you reuse them (and just release the explicit ref when the
</I>&gt;<i> corresponding view is unloaded).
</I>&gt;<i>
</I>&gt;<i> I hope this helps,
</I>&gt;<i> Rolf
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20111208/0bfbb526/attachment-0001.html">http://lists.ximian.com/pipermail/monotouch/attachments/20111208/0bfbb526/attachment-0001.html</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007010.html">[MonoTouch] Still IntPtr Constructor issues
</A></li>
	<LI>Next message: <A HREF="007031.html">[MonoTouch] Still IntPtr Constructor issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7022">[ date ]</a>
              <a href="thread.html#7022">[ thread ]</a>
              <a href="subject.html#7022">[ subject ]</a>
              <a href="author.html#7022">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
