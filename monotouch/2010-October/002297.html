<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Monotouch Bug in UTF7 encoding ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Monotouch%20Bug%20in%20UTF7%20encoding%20%3F&In-Reply-To=C8D00A5B.2ED02%25mike%40ie.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002296.html">
   <LINK REL="Next"  HREF="002298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Monotouch Bug in UTF7 encoding ?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Monotouch%20Bug%20in%20UTF7%20encoding%20%3F&In-Reply-To=C8D00A5B.2ED02%25mike%40ie.com"
       TITLE="[MonoTouch] Monotouch Bug in UTF7 encoding ?">jonpryor at vt.edu
       </A><BR>
    <I>Mon Oct  4 22:15:17 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002296.html">[MonoTouch] Monotouch Bug in UTF7 encoding ?
</A></li>
        <LI>Next message: <A HREF="002298.html">[MonoTouch] MonoTouch.CoreAnimation.CAAnimation.CurrentMediaTime()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2297">[ date ]</a>
              <a href="thread.html#2297">[ thread ]</a>
              <a href="subject.html#2297">[ subject ]</a>
              <a href="author.html#2297">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So after being unsufficiently lazy, I can conclude that both are valid
UTF-7 sequences.

Consider RFC2152 [0], which states:

        Also as a special case, the sequence &quot;+-&quot; may be used to encode
        the character &quot;+&quot;. A &quot;+&quot; character followed immediately by any
        character other than members of set B or &quot;-&quot; is an ill-formed
        sequence.

So, to briefly elide through most of the RFC, the regex
[A-Za-z0-9'(),-./:?] is passed through unchanged.  From your original
string of:

        Hash=&quot;+Cgwxu

the only part that doesn't match that regex is:

        =&quot;+

There are *two* ways to encode this: encode the entire run of three
characters as a Base-64 encoded quantity, which is what Microsoft does,
resulting in &quot;+AD1AIgAr-&quot;.

The alternate approach is to instead encode the two character run `=&quot;`
into a Base-64 encoded quantity, then encode the trailing '+' as &quot;+-&quot; as
the RFC allows, which is what Mono does, resulting in &quot;+AD1AIg-+-&quot;.

The point is that both of these are equally valid and supported by the
standard, so there is no bug here.

 - Jon

[0] <A HREF="http://tools.ietf.org/html/rfc2152">http://tools.ietf.org/html/rfc2152</A>

On Mon, 2010-10-04 at 22:48 +0100, Mike Warriner wrote:
&gt;<i> 
</I>&gt;<i> Oops &#8211; sorry guys, wrong list...
</I>&gt;<i> 
</I>&gt;<i> On 04/10/2010 22:46, &quot;Mike Warriner&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">mike at ie.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>         I think there is a bug in the UTF7 encoding &#8211; the following
</I>&gt;<i>         code gives a different byte output on a Windows machine (.net
</I>&gt;<i>         4, Win7, x64) compared to on the simulator.
</I>&gt;<i>         
</I>&gt;<i>         (Character 11 is different)
</I>&gt;<i>         
</I>&gt;<i>         Any thoughts on whether this is a bug, or by design?
</I>&gt;<i>         
</I>&gt;<i>         Thanks,
</I>&gt;<i>         
</I>&gt;<i>         Mike
</I>&gt;<i>         
</I>&gt;<i>                     string xyzzy = &quot;Hash=\&quot;+Cgwxu&quot;;
</I>&gt;<i>                     byte[] b = Encoding.UTF7.GetBytes(xyzzy);
</I>&gt;<i>                     for (int i = 0; i &lt; b.Length; i++)
</I>&gt;<i>                     {
</I>&gt;<i>                         Console.WriteLine(&quot;I = &quot; + i + &quot; = &quot; + b[i]+&quot;
</I>&gt;<i>         '&quot;+(char)b[i]+&quot;'&quot;);
</I>&gt;<i>                     }
</I>&gt;<i>         
</I>&gt;<i>         WINDOWS OUTPUT:
</I>&gt;<i>         
</I>&gt;<i>         I = 0 = 72 'H'
</I>&gt;<i>         I = 1 = 97 'a'
</I>&gt;<i>         I = 2 = 115 's'
</I>&gt;<i>         I = 3 = 104 'h'
</I>&gt;<i>         I = 4 = 43 '+'
</I>&gt;<i>         I = 5 = 65 'A'
</I>&gt;<i>         I = 6 = 68 'D'
</I>&gt;<i>         I = 7 = 48 '0'
</I>&gt;<i>         I = 8 = 65 'A'
</I>&gt;<i>         I = 9 = 73 'I'
</I>&gt;<i>         I = 10 = 103 'g'
</I>&gt;<i>         I = 11 = 65 'A'
</I>&gt;<i>         I = 12 = 114 'r'
</I>&gt;<i>         I = 13 = 45 '-'
</I>&gt;<i>         I = 14 = 67 'C'
</I>&gt;<i>         I = 15 = 103 'g'
</I>&gt;<i>         I = 16 = 119 'w'
</I>&gt;<i>         I = 17 = 120 'x'
</I>&gt;<i>         I = 18 = 117 'u'
</I>&gt;<i>         
</I>&gt;<i>         IPHONE SIMULATOR OUTPUT
</I>&gt;<i>         
</I>&gt;<i>         I = 0 = 72 'H'
</I>&gt;<i>         I = 1 = 97 'a'
</I>&gt;<i>         I = 2 = 115 's'
</I>&gt;<i>         I = 3 = 104 'h'
</I>&gt;<i>         I = 4 = 43 '+'
</I>&gt;<i>         I = 5 = 65 'A'
</I>&gt;<i>         I = 6 = 68 'D'
</I>&gt;<i>         I = 7 = 48 '0'
</I>&gt;<i>         I = 8 = 65 'A'
</I>&gt;<i>         I = 9 = 73 'I'
</I>&gt;<i>         I = 10 = 103 'g'
</I>&gt;<i>         I = 11 = 45 '-'
</I>&gt;<i>         I = 12 = 43 '+'
</I>&gt;<i>         I = 13 = 45 '-'
</I>&gt;<i>         I = 14 = 67 'C'
</I>&gt;<i>         I = 15 = 103 'g'
</I>&gt;<i>         I = 16 = 119 'w'
</I>&gt;<i>         I = 17 = 120 'x'
</I>&gt;<i>         I = 18 = 117 'u' 
</I>&gt;<i>         _____________________________________________________________________
</I>&gt;<i>         This email and any files transmitted with it are confidential
</I>&gt;<i>         and are intended solely for the use of the individual or
</I>&gt;<i>         entity to whom they are addressed. This communication
</I>&gt;<i>         represents the originator's personal views and opinions, which
</I>&gt;<i>         do not necessarily reflect those of Intelligent Environments
</I>&gt;<i>         Europe Ltd (IE). 
</I>&gt;<i>         If you are not the original recipient or the person
</I>&gt;<i>         responsible for delivering the email to the intended
</I>&gt;<i>         recipient, be advised that you have received this email in
</I>&gt;<i>         error, and that any use, dissemination, forwarding, printing,
</I>&gt;<i>         or copying of this email is strictly prohibited. If you have
</I>&gt;<i>         received this email in error, please immediately notify
</I>&gt;<i>         <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">Support at ie.com.</A>
</I>&gt;<i>         
</I>&gt;<i>         IE is the trading name of Intelligent Environments Europe Ltd,
</I>&gt;<i>         a wholly owned subsidiary of Parseq plc.
</I>&gt;<i>         
</I>&gt;<i>         Intelligent Environments Europe Ltd is a company registered in
</I>&gt;<i>         England. The company's registered office is Riverview House,
</I>&gt;<i>         20 Old Bridge Street, Kingston upon Thames, Surrey KT1 4BU.
</I>&gt;<i>         Its registered number is 1862322.
</I>&gt;<i>         
</I>&gt;<i>         Intelligent Environments Europe Ltd is a VAT registered
</I>&gt;<i>         company - GB 602 8062 72
</I>&gt;<i>         
</I>&gt;<i>         _____________________________________________________________________
</I>&gt;<i>         This e-mail has been scanned for viruses by Verizon Business
</I>&gt;<i>         Internet Managed Scanning Services - powered by MessageLabs.
</I>&gt;<i>         For further information visit <A HREF="http://www.mci.com">http://www.mci.com</A>
</I>&gt;<i>         
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> mike warriner
</I>&gt;<i> ie. chief technology officer
</I>&gt;<i> 
</I>&gt;<i> t: +44 20 8614 9888
</I>&gt;<i> e: <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">mike at ie.com</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">mike at ie.com</A>&gt; 
</I>&gt;<i> www.ie.com &lt;<A HREF="http://www.ie.com/">http://www.ie.com/</A>&gt; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _____________________________________________________________________
</I>&gt;<i> This email and any files transmitted with it are confidential and are
</I>&gt;<i> intended solely for the use of the individual or entity to whom they
</I>&gt;<i> are addressed. This communication represents the originator's personal
</I>&gt;<i> views and opinions, which do not necessarily reflect those of
</I>&gt;<i> Intelligent Environments Europe Ltd (IE). 
</I>&gt;<i> If you are not the original recipient or the person responsible for
</I>&gt;<i> delivering the email to the intended recipient, be advised that you
</I>&gt;<i> have received this email in error, and that any use, dissemination,
</I>&gt;<i> forwarding, printing, or copying of this email is strictly prohibited.
</I>&gt;<i> If you have received this email in error, please immediately notify
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">Support at ie.com.</A>
</I>&gt;<i> 
</I>&gt;<i> IE is the trading name of Intelligent Environments Europe Ltd, a
</I>&gt;<i> wholly owned subsidiary of Parseq plc.
</I>&gt;<i> 
</I>&gt;<i> Intelligent Environments Europe Ltd is a company registered in
</I>&gt;<i> England. The company's registered office is Riverview House, 20 Old
</I>&gt;<i> Bridge Street, Kingston upon Thames, Surrey KT1 4BU. Its registered
</I>&gt;<i> number is 1862322.
</I>&gt;<i> 
</I>&gt;<i> Intelligent Environments Europe Ltd is a VAT registered company - GB
</I>&gt;<i> 602 8062 72
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002296.html">[MonoTouch] Monotouch Bug in UTF7 encoding ?
</A></li>
	<LI>Next message: <A HREF="002298.html">[MonoTouch] MonoTouch.CoreAnimation.CAAnimation.CurrentMediaTime()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2297">[ date ]</a>
              <a href="thread.html#2297">[ thread ]</a>
              <a href="subject.html#2297">[ subject ]</a>
              <a href="author.html#2297">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
