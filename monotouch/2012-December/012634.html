<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] CGImage draw on MTD-OwnerdrawElement context
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20CGImage%20draw%20on%20MTD-OwnerdrawElement%20context&In-Reply-To=%3CCACp3Zk2wE%3Da_Ja49cCdPcVJbSKYjTNKcb798%2ByohccFV%3DrxPWw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012632.html">
   <LINK REL="Next"  HREF="012635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] CGImage draw on MTD-OwnerdrawElement context</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20CGImage%20draw%20on%20MTD-OwnerdrawElement%20context&In-Reply-To=%3CCACp3Zk2wE%3Da_Ja49cCdPcVJbSKYjTNKcb798%2ByohccFV%3DrxPWw%40mail.gmail.com%3E"
       TITLE="[MonoTouch] CGImage draw on MTD-OwnerdrawElement context">sebastien at xamarin.com
       </A><BR>
    <I>Thu Dec 27 15:09:50 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="012632.html">[MonoTouch] CGImage draw on MTD-OwnerdrawElement context
</A></li>
        <LI>Next message: <A HREF="012635.html">[MonoTouch] UICollectionView
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12634">[ date ]</a>
              <a href="thread.html#12634">[ thread ]</a>
              <a href="subject.html#12634">[ subject ]</a>
              <a href="author.html#12634">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Benedikt,

UIKit and CoreGraphics coordinates system are not identical [1]. You
can easily convert between them by translating and scaling the current
transform [2].

Happy Holidays,
Sebastien

[1] <A HREF="http://stackoverflow.com/q/10408786/220643">http://stackoverflow.com/q/10408786/220643</A>
[2] <A HREF="http://stackoverflow.com/a/5716548/220643">http://stackoverflow.com/a/5716548/220643</A>

On Thu, Dec 27, 2012 at 3:00 AM, Benedikt H&#252;bschen
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">benedikt.huebschen at systemiya.de</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I have a problem drawing downloaded png's on a context in a OwnerDrawn
</I>&gt;<i> Element from MonoTouch.Dialog&#8230;
</I>&gt;<i> Every &quot;&#167;$%&amp;/()= image will be drawn rotated and i don't know why.. Showing
</I>&gt;<i> the image in a webview displays them correct&#8230;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> public class SampleOwnerDrawnElement : OwnerDrawnElement
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> public string imagefile;
</I>&gt;<i>
</I>&gt;<i> UIImage XY;
</I>&gt;<i>
</I>&gt;<i> int maxWidth  = (int)(UIScreen.MainScreen.Bounds.Width-10);
</I>&gt;<i>
</I>&gt;<i> int maxHeight = (int)(UIScreen.MainScreen.Bounds.Width);
</I>&gt;<i>
</I>&gt;<i> int imgWidth = 0;
</I>&gt;<i>
</I>&gt;<i> int imgHeight = 0;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> public override float Height (RectangleF bounds)
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> return imgHeight / UIScreen.MainScreen.Scale ;
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> public SampleOwnerDrawnElement (System.Json.JsonValue JS) :
</I>&gt;<i> base(UITableViewCellStyle.Default, &quot;sampleOwnerDrawnElement&quot;)
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> string text = (string)JS [&quot;link&quot;];
</I>&gt;<i>
</I>&gt;<i> string url = BASEURL + (string)JS [&quot;img1&quot;] + &quot;.png&quot;;
</I>&gt;<i>
</I>&gt;<i> int width = JS [&quot;img1data&quot;] [&quot;0&quot;];
</I>&gt;<i>
</I>&gt;<i> int height = JS [&quot;img1data&quot;] [&quot;1&quot;];
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> var cur_width = width;
</I>&gt;<i>
</I>&gt;<i> double ratio = (int)(maxWidth * UIScreen.MainScreen.Scale) /
</I>&gt;<i> (cur_width*UIScreen.MainScreen.Scale);
</I>&gt;<i>
</I>&gt;<i> imgHeight = (int)(((int)(height*UIScreen.MainScreen.Scale)) * ratio);
</I>&gt;<i>
</I>&gt;<i> imgWidth = (int)(maxWidth * UIScreen.MainScreen.Scale);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> maxHeight = (int)(imgHeight / UIScreen.MainScreen.Scale);
</I>&gt;<i>
</I>&gt;<i> if (!(System.IO.File.Exists (System.Environment.GetFolderPath
</I>&gt;<i> (System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
</I>&gt;<i> System.IO.Path.GetFileName (url)))) {
</I>&gt;<i>
</I>&gt;<i> System.Net.WebClient WLL = new System.Net.WebClient();
</I>&gt;<i>
</I>&gt;<i> WLL.DownloadFileCompleted += delegate(object sender,
</I>&gt;<i> System.ComponentModel.AsyncCompletedEventArgs e) {
</I>&gt;<i>
</I>&gt;<i> XY = UIImage.FromFile (System.Environment.GetFolderPath
</I>&gt;<i> (System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
</I>&gt;<i> System.IO.Path.GetFileName (url));
</I>&gt;<i>
</I>&gt;<i> } ;
</I>&gt;<i>
</I>&gt;<i> WLL.DownloadFileAsync(new Uri(url),System.Environment.GetFolderPath
</I>&gt;<i> (System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
</I>&gt;<i> System.IO.Path.GetFileName (url));
</I>&gt;<i>
</I>&gt;<i> }  else {
</I>&gt;<i>
</I>&gt;<i> XY = UIImage.FromFile (System.Environment.GetFolderPath
</I>&gt;<i> (System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
</I>&gt;<i> System.IO.Path.GetFileName (url));
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> this.Text = text;
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> public string Text
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> get;set;
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> public override void Draw (RectangleF bounds, CGContext context, UIView
</I>&gt;<i> view)
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> UIColor color = UIColor.FromPatternImage (UIImage.FromBundle
</I>&gt;<i> (&quot;images/back.png&quot;));
</I>&gt;<i>
</I>&gt;<i> color.SetFill ();
</I>&gt;<i>
</I>&gt;<i> context.FillRect (bounds);
</I>&gt;<i>
</I>&gt;<i> bounds = new RectangleF (5, 5, maxWidth,maxHeight);
</I>&gt;<i>
</I>&gt;<i> UIColor.White.SetFill ();
</I>&gt;<i>
</I>&gt;<i> context.FillRect (bounds);
</I>&gt;<i>
</I>&gt;<i> int aXBound = 0;
</I>&gt;<i>
</I>&gt;<i> if (!( XY==null) ) {
</I>&gt;<i>
</I>&gt;<i> UIImage x;
</I>&gt;<i>
</I>&gt;<i> if(XY.CGImage.Width&lt;=maxWidth) {
</I>&gt;<i>
</I>&gt;<i> x=XY;
</I>&gt;<i>
</I>&gt;<i> aXBound = (int)((maxWidth/2) - (XY.CGImage.Width/2));
</I>&gt;<i>
</I>&gt;<i> }  else {
</I>&gt;<i>
</I>&gt;<i> ImageResizer mX = new ImageResizer(XY);
</I>&gt;<i>
</I>&gt;<i> mX.RatioResizeToWidth(maxWidth*UIScreen.MainScreen.Scale);
</I>&gt;<i>
</I>&gt;<i> x=mX.ModifiedImage;
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> context.DrawImage(new
</I>&gt;<i> RectangleF(5+aXBound,5,x.CGImage.Width/UIScreen.MainScreen.Scale,x.CGImage.Height/UIScreen.MainScreen.Scale),x.CGImage);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> UIColor.FromRGBA (0,0,0,215).SetFill ();
</I>&gt;<i>
</I>&gt;<i> context.FillRect (new RectangleF(6,maxHeight-39,maxWidth-2,38));
</I>&gt;<i>
</I>&gt;<i> UIColor.White.SetColor();
</I>&gt;<i>
</I>&gt;<i> view.DrawString(this.Text, new RectangleF(10,maxHeight-35,maxWidth,40),
</I>&gt;<i> UIFont.BoldSystemFontOfSize(14.0f), UILineBreakMode.TailTruncation);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> XY is an UIImage that will be downloaded when the element is created (if
</I>&gt;<i> it's not already downloaded and stored locally, the cell is just white with
</I>&gt;<i> a small black box containing the product-name)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks in advance,
</I>&gt;<i>
</I>&gt;<i> Benedikt
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012632.html">[MonoTouch] CGImage draw on MTD-OwnerdrawElement context
</A></li>
	<LI>Next message: <A HREF="012635.html">[MonoTouch] UICollectionView
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12634">[ date ]</a>
              <a href="thread.html#12634">[ thread ]</a>
              <a href="subject.html#12634">[ subject ]</a>
              <a href="author.html#12634">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
