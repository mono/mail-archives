<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] CGImage draw on MTD-OwnerdrawElement context
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20CGImage%20draw%20on%20MTD-OwnerdrawElement%20context&In-Reply-To=%3CCD01BE94.18085%25benedikt.huebschen%40systemiya.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012642.html">
   <LINK REL="Next"  HREF="012634.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] CGImage draw on MTD-OwnerdrawElement context</H1>
    <B>Benedikt H&#252;bschen</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20CGImage%20draw%20on%20MTD-OwnerdrawElement%20context&In-Reply-To=%3CCD01BE94.18085%25benedikt.huebschen%40systemiya.de%3E"
       TITLE="[MonoTouch] CGImage draw on MTD-OwnerdrawElement context">benedikt.huebschen at systemiya.de
       </A><BR>
    <I>Thu Dec 27 08:00:04 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="012642.html">[MonoTouch] UISplitViewController - Landscape Master View Controller smaller
</A></li>
        <LI>Next message: <A HREF="012634.html">[MonoTouch] CGImage draw on MTD-OwnerdrawElement context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12632">[ date ]</a>
              <a href="thread.html#12632">[ thread ]</a>
              <a href="subject.html#12632">[ subject ]</a>
              <a href="author.html#12632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have a problem drawing downloaded png's on a context in a OwnerDrawn
Element from MonoTouch.Dialog&#138;
Every &quot;&#167;$%&amp;/()= image will be drawn rotated and i don't know why.. Showing
the image in a webview displays them correct&#138;.


public class SampleOwnerDrawnElement : OwnerDrawnElement

{

public string imagefile;

UIImage XY;

int maxWidth  = (int)(UIScreen.MainScreen.Bounds.Width-10);

int maxHeight = (int)(UIScreen.MainScreen.Bounds.Width);

int imgWidth = 0;

int imgHeight = 0;



public override float Height (RectangleF bounds)

{

return imgHeight / UIScreen.MainScreen.Scale ;

}



public SampleOwnerDrawnElement (System.Json.JsonValue JS) :
base(UITableViewCellStyle.Default, &quot;sampleOwnerDrawnElement&quot;)

{

string text = (string)JS [&quot;link&quot;];

string url = BASEURL + (string)JS [&quot;img1&quot;] + &quot;.png&quot;;

int width = JS [&quot;img1data&quot;] [&quot;0&quot;];

int height = JS [&quot;img1data&quot;] [&quot;1&quot;];





var cur_width = width;

double ratio = (int)(maxWidth * UIScreen.MainScreen.Scale) /
(cur_width*UIScreen.MainScreen.Scale);

imgHeight = (int)(((int)(height*UIScreen.MainScreen.Scale)) * ratio);

imgWidth = (int)(maxWidth * UIScreen.MainScreen.Scale);



maxHeight = (int)(imgHeight / UIScreen.MainScreen.Scale);

if (!(System.IO.File.Exists (System.Environment.GetFolderPath
(System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
System.IO.Path.GetFileName (url)))) {

System.Net.WebClient WLL = new System.Net.WebClient();

WLL.DownloadFileCompleted += delegate(object sender,
System.ComponentModel.AsyncCompletedEventArgs e) {

XY = UIImage.FromFile (System.Environment.GetFolderPath
(System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
System.IO.Path.GetFileName (url));

} ;

WLL.DownloadFileAsync(new Uri(url),System.Environment.GetFolderPath
(System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
System.IO.Path.GetFileName (url));

}  else {

XY = UIImage.FromFile (System.Environment.GetFolderPath
(System.Environment.SpecialFolder.MyDocuments)+  &quot;/news/&quot; +
System.IO.Path.GetFileName (url));

}

this.Text = text;

}

public string Text

{

get;set;    

}

public override void Draw (RectangleF bounds, CGContext context, UIView
view)

{

UIColor color = UIColor.FromPatternImage (UIImage.FromBundle
(&quot;images/back.png&quot;));

color.SetFill ();

context.FillRect (bounds);

bounds = new RectangleF (5, 5, maxWidth,maxHeight);

UIColor.White.SetFill ();

context.FillRect (bounds);

int aXBound = 0;

if (!( XY==null) ) {

UIImage x;

if(XY.CGImage.Width&lt;=maxWidth) {

x=XY;

aXBound = (int)((maxWidth/2) - (XY.CGImage.Width/2));

}  else {

ImageResizer mX = new ImageResizer(XY);

mX.RatioResizeToWidth(maxWidth*UIScreen.MainScreen.Scale);

x=mX.ModifiedImage;

}

context.DrawImage(new
RectangleF(5+aXBound,5,x.CGImage.Width/UIScreen.MainScreen.Scale,x.CGImage.H
eight/UIScreen.MainScreen.Scale),x.CGImage);

}

UIColor.FromRGBA (0,0,0,215).SetFill ();

context.FillRect (new RectangleF(6,maxHeight-39,maxWidth-2,38));

UIColor.White.SetColor();

view.DrawString(this.Text, new RectangleF(10,maxHeight-35,maxWidth,40),
UIFont.BoldSystemFontOfSize(14.0f), UILineBreakMode.TailTruncation);

}

}





XY is an UIImage that will be downloaded when the element is created (if
it's not already downloaded and stored locally, the cell is just white with
a small black box containing the product-name)



Thanks in advance,

Benedikt


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monotouch/attachments/20121227/09befafc/attachment.html">http://lists.ximian.com/pipermail/monotouch/attachments/20121227/09befafc/attachment.html</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012642.html">[MonoTouch] UISplitViewController - Landscape Master View Controller smaller
</A></li>
	<LI>Next message: <A HREF="012634.html">[MonoTouch] CGImage draw on MTD-OwnerdrawElement context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12632">[ date ]</a>
              <a href="thread.html#12632">[ thread ]</a>
              <a href="subject.html#12632">[ subject ]</a>
              <a href="author.html#12632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
