<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Native code issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Native%20code%20issue&In-Reply-To=1317243033688-3853257.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005375.html">
   <LINK REL="Next"  HREF="005379.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Native code issue</H1>
    <B>Conway Wieler</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20Native%20code%20issue&In-Reply-To=1317243033688-3853257.post%40n4.nabble.com"
       TITLE="[MonoTouch] Native code issue">conway.wieler at librestream.com
       </A><BR>
    <I>Wed Sep 28 18:13:47 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="005375.html">[MonoTouch] Native code issue
</A></li>
        <LI>Next message: <A HREF="005379.html">[MonoTouch] Native code issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5377">[ date ]</a>
              <a href="thread.html#5377">[ thread ]</a>
              <a href="subject.html#5377">[ subject ]</a>
              <a href="author.html#5377">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Walt,
If you have the ability to rebuild the native lib, you might want to try to rebuild it without Thumb instruction support (&quot;Compile For Thumb&quot;==NO in xcode build settings). We had a similar series of bizarre crashes and failures until we turned off Thumb support. I've seen a few places on the net (like <A HREF="http://stackoverflow.com/questions/4565488/how-do-i-add-a-library-compiled-in-xcode-into-monotouch-so-that-it-works-for-both">http://stackoverflow.com/questions/4565488/how-do-i-add-a-library-compiled-in-xcode-into-monotouch-so-that-it-works-for-both</A> and <A HREF="http://stackoverflow.com/questions/5934121/application-with-static-library-runs-on-simulator-but-not-on-actual-device">http://stackoverflow.com/questions/5934121/application-with-static-library-runs-on-simulator-but-not-on-actual-device</A>) that suggest Thumb should be disabled for linking with MonoTouch.
Hope this helps!
Conway

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch-bounces at lists.ximian.com</A>] On Behalf Of retlaW
Sent: September 28, 2011 3:51 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>
Subject: [MonoTouch] Native code issue

Hi Everyone.

I am attempting to use the Wahoo Fitness lib to access their hardware ANT+
dongle.

Now for the lib itself there are some instructions for XCode.  One is that
the info.plist needs Supported external accessory protocols, Value:
com.momentumoftechnology.fisica and the other was that the Other Linker
Flags key in the Linker section of the project settings needs to have this
added :  -lstdc++ -all_load.

I have added these to the -gcc_flags and have added -cxx as shown here :
 -cxx -gcc_flags &quot;-L${ProjectDir}/Lib -lWFConnector  -framework
ExternalAccessory  -force_load ${ProjectDir}/Lib/libWFConnector.a   -lstdc++
-all_load &quot;

I have mapped the lib using btouch and included the dll into the solution as
well.

I have 2 test apps that use the lib.  One is a real test with a few
projects, and the other is a stripped down version with no other projects
included. I have also created the equivalent ObjC version of the stripped
down app in XCode and that works as expected (so the lib itself should be
fine).

For both apps when linking &quot;the SDK assemblies only&quot; both will give me a
SIGSEGV of :

Native stacktrace:

	0   WFConnTest                          0x001c1378
mono_handle_native_sigsegv + 412
	1   WFConnTest                          0x00191390
mono_sigsegv_signal_handler + 360
	2   libsystem_c.dylib                   0x33f1453d _sigtramp + 48
	3   libobjc.A.dylib                     0x37d34e71 objc_setProperty_non_gc
+ 144

=================================================================
Got a SIGSEGV while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries 
used by your application.
=================================================================


For the Larger of the 2 apps if I &quot;don't link&quot; I get this error in the
debugger:

System.NullReferenceException has been thrown
Object reference not set to an instance of an object.

Then in the window it has :
at MonoTouch.ObjCRuntime.Method.RegisterTrampolines(IntPtr one, IntPtr two,
...IntPtr nine)[0x00000] in &lt;filename unknown&gt;:0

For the smaller app when I &quot;dont link&quot;, even in debug mode it crashes and
just closes the connection to the debugger with no output.

I have searched around and will continue to do so , but at this point any
guidance, web references, books etc that may help me in being able to
resolve this would be greatly appreciated.


Thank in advance,


Walt




--
View this message in context: <A HREF="http://monotouch.2284126.n4.nabble.com/Native-code-issue-tp3853257p3853257.html">http://monotouch.2284126.n4.nabble.com/Native-code-issue-tp3853257p3853257.html</A>
Sent from the MonoTouch mailing list archive at Nabble.com.
_______________________________________________
MonoTouch mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005375.html">[MonoTouch] Native code issue
</A></li>
	<LI>Next message: <A HREF="005379.html">[MonoTouch] Native code issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5377">[ date ]</a>
              <a href="thread.html#5377">[ thread ]</a>
              <a href="subject.html#5377">[ subject ]</a>
              <a href="author.html#5377">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
