<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Serious strange problems with Sockets/TcpClient
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Serious%20strange%20problems%20with%20Sockets/TcpClient&In-Reply-To=%3C1336046017813-4605780.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009446.html">
   <LINK REL="Next"  HREF="009473.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Serious strange problems with Sockets/TcpClient</H1>
    <B>dermotos</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Serious%20strange%20problems%20with%20Sockets/TcpClient&In-Reply-To=%3C1336046017813-4605780.post%40n4.nabble.com%3E"
       TITLE="[MonoTouch] Serious strange problems with Sockets/TcpClient">me at dermotos.com
       </A><BR>
    <I>Thu May  3 11:53:37 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009446.html">[MonoTouch] MT.Dialog change in Changed event
</A></li>
        <LI>Next message: <A HREF="009473.html">[MonoTouch] Serious strange problems with Sockets/TcpClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9449">[ date ]</a>
              <a href="thread.html#9449">[ thread ]</a>
              <a href="subject.html#9449">[ subject ]</a>
              <a href="author.html#9449">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, after re-writing my network code/socket handling code completely, using
raw sockets with the new event based Async approach (SendAsync,
ReceiveAsync, SocketAsyncEventArgs etc...), testing extensively on test
PC/Windows apps then moving to my app this problem is STILL happening!

So I moved the network code to a test iOS app, and the problem disappeared.
Im now pretty sure the problem is to do with the Threadpool. As the Async
events from the sockets call back in a new Threadpool thread, I guess they
are stuck waiting for a free thread. WHen one becomes available, its used to
receive the data, which my app quickly processes and the same thread is used
again and again to get the remaining data. This would explain why suddenly
all the receives come in one after each other.

Ive tried increasing the thread count, but it still happens now and then. Is
there a hard limit on the thread count that is limited, regardless of whats
set in ThreadPool.SetMaxThreads()?

Does the internal processes in code such as the Socket.ReceiveAsync() etc..
comsume threadpool threads?

Also, is there any easy way to keep an eye on my thread count other than the
thread window in monotouch? I seem to have about 13 threads running when the
problem occurs. A lot of them have no current location though, so I dont
know where they are or what they're doing.

Any help appreciated! Thanks.

--
View this message in context: <A HREF="http://monotouch.2284126.n4.nabble.com/Serious-strange-problems-with-Sockets-TcpClient-tp4595780p4605780.html">http://monotouch.2284126.n4.nabble.com/Serious-strange-problems-with-Sockets-TcpClient-tp4595780p4605780.html</A>
Sent from the MonoTouch mailing list archive at Nabble.com.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009446.html">[MonoTouch] MT.Dialog change in Changed event
</A></li>
	<LI>Next message: <A HREF="009473.html">[MonoTouch] Serious strange problems with Sockets/TcpClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9449">[ date ]</a>
              <a href="thread.html#9449">[ thread ]</a>
              <a href="subject.html#9449">[ subject ]</a>
              <a href="author.html#9449">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
