<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Odd SSL error - any ideas?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Odd%20SSL%20error%20-%20any%20ideas%3F&In-Reply-To=%3CCACp3Zk0UmsAYai2bj41ksPrLojdMM65KTJ0wCMtt-ce7r%3DqdUw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009814.html">
   <LINK REL="Next"  HREF="009816.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Odd SSL error - any ideas?</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Odd%20SSL%20error%20-%20any%20ideas%3F&In-Reply-To=%3CCACp3Zk0UmsAYai2bj41ksPrLojdMM65KTJ0wCMtt-ce7r%3DqdUw%40mail.gmail.com%3E"
       TITLE="[MonoTouch] Odd SSL error - any ideas?">sebastien at xamarin.com
       </A><BR>
    <I>Mon May 28 12:52:42 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009814.html">[MonoTouch] Odd SSL error - any ideas?
</A></li>
        <LI>Next message: <A HREF="009816.html">[MonoTouch] Odd SSL error - any ideas?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9815">[ date ]</a>
              <a href="thread.html#9815">[ thread ]</a>
              <a href="subject.html#9815">[ subject ]</a>
              <a href="author.html#9815">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Nic,

On Mon, May 28, 2012 at 8:30 AM, Nic Wise &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">nicw at fastchicken.co.nz</A>&gt; wrote:
&gt;<i> This is a bit of an oddball one, and not one I can reproduce.
</I>&gt;<i>
</I>&gt;<i> 20120528/113316: URL: <A HREF="https://bbsc.freeagent.com/verify">https://bbsc.freeagent.com/verify</A>
</I>&gt;<i> 20120528/113317: Ex in Verify: Error getting response stream (Write:
</I>&gt;<i> The authentication or decryption has failed.): SendFailure
</I>&gt;<i> 20120528/113317: Exception: System.Net.WebException: Error getting
</I>&gt;<i> response stream (Write: The authentication or decryption has failed.):
</I>&gt;<i> SendFailure ---&gt; System.IO.IOException: The authentication or
</I>&gt;<i> decryption has failed. ---&gt; Mono.Security.Protocol.Tls.TlsException:
</I>&gt;<i> The authentication or decryption has failed.
</I>&gt;<i> &#160;at Mono.Security.Protocol.Tls.RecordProtocol.ReadRecordBuffer (Int32
</I>&gt;<i> contentType, System.IO.Stream record) [0x00000] in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i> &#160;at Mono.Security.Protocol.Tls.RecordProtocol.InternalReceiveRecordCallback
</I>&gt;<i> (IAsyncResult asyncResult) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;--- End of inner exception stack trace ---
</I>&gt;<i> &#160;at Mono.Security.Protocol.Tls.SslStreamBase.AsyncHandshakeCallback
</I>&gt;<i> (IAsyncResult asyncResult) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;--- End of inner exception stack trace ---
</I>&gt;<i> &#160;at System.Net.HttpWebRequest.EndGetResponse (IAsyncResult
</I>&gt;<i> asyncResult) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.HttpWebRequest.GetResponse () [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.WebClient.GetWebResponse (System.Net.WebRequest
</I>&gt;<i> request) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.WebClient.ReadAll (System.Net.WebRequest request,
</I>&gt;<i> System.Object userToken) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.WebClient.DownloadDataCore (System.Uri address,
</I>&gt;<i> System.Object userToken) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> 20120528/113317: StackTrace: &#160; at
</I>&gt;<i> System.Net.HttpWebRequest.EndGetResponse (IAsyncResult asyncResult)
</I>&gt;<i> [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.HttpWebRequest.GetResponse () [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.WebClient.GetWebResponse (System.Net.WebRequest
</I>&gt;<i> request) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.WebClient.ReadAll (System.Net.WebRequest request,
</I>&gt;<i> System.Object userToken) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &#160;at System.Net.WebClient.DownloadDataCore (System.Uri address,
</I>&gt;<i> System.Object userToken) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> 20120528/113317: In complete. success is False
</I>&gt;<i>
</I>&gt;<i> The user said that all/most other traffic was flowing well. He's on
</I>&gt;<i> the same carrier (in the same city) as me, and a lot of other people.
</I>&gt;<i>
</I>&gt;<i> I'm using the &quot;accept all SSL certs&quot; thing, if that helps:
</I>&gt;<i>
</I>&gt;<i> ServicePointManager.ServerCertificateValidationCallback = (sender,
</I>&gt;<i> cert, chain, ssl) =&gt; &#160;true;
</I>
You should not - but the exception points to transmission, i.e. well
after the certificates validations.

&gt;<i> Any thoughts? Anywhere to look? I think this is using an older version
</I>&gt;<i> of MonoTouch,
</I>
SSL/TLS are, by design, difficult to debug since they don't tell you
much about what (or when) things fails. That makes attacks harder and
debugging (near) impossible.

Now at the stage this occurs we know that SSL negotiation was done.
IOW client/server decided on a common cipher suite, certificate were
accepted... and that the request was sent.

(More likely) a network glitch. SSL/TLS ensure integrity of the data.
One single bad bit will result in an error - and since the internal
state becomes invalid the whole SSL session must be restarted (i.e.
there's no low-level try it again). If this is not something that can
be duplicated again then it's a likely culprit.

(Unlikely) the server asked for a renegotiation. That can occurs (it's
optional) after a large amount of data was sent. It's very uncommon*
(for HTTPS) so it's less tested than the general code (but bugs were
fixed years ago and not reported again). If that's the case then it
should be possible to duplicate the same issue with the same web site
(same server configuration).

* it's more common in long sessions, e.g. with a database, than for HTTPS

&gt;<i> before the recent crypto changes that Sebastian blogged
</I>&gt;<i> about.
</I>
The recent changes should not affect how SSL/TLS behave. It should be
faster (I/O are predominant in this case so it might not show off a
lot) but not different. More than 2000 test cases were ported to
ensure this :-).

Sebastien
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009814.html">[MonoTouch] Odd SSL error - any ideas?
</A></li>
	<LI>Next message: <A HREF="009816.html">[MonoTouch] Odd SSL error - any ideas?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9815">[ date ]</a>
              <a href="thread.html#9815">[ thread ]</a>
              <a href="subject.html#9815">[ subject ]</a>
              <a href="author.html#9815">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
