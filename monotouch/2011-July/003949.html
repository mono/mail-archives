<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] System.MissingMethodException: No constructor found for MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20System.MissingMethodException%3A%20No%20constructor%20found%0A%20for%0A%20MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate%3A%3A.ctor%28System.IntPtr%29&In-Reply-To=CAE_cBdgf5BJr24HWY0GDJFFPGGUoQY%2BpH01Md%3DhTe%3Djpd%2BvUgw%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003947.html">
   <LINK REL="Next"  HREF="003951.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] System.MissingMethodException: No constructor found for MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)</H1>
    <B>Tom Fanning</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=%5BMonoTouch%5D%20System.MissingMethodException%3A%20No%20constructor%20found%0A%20for%0A%20MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate%3A%3A.ctor%28System.IntPtr%29&In-Reply-To=CAE_cBdgf5BJr24HWY0GDJFFPGGUoQY%2BpH01Md%3DhTe%3Djpd%2BvUgw%40mail.gmail.com"
       TITLE="[MonoTouch] System.MissingMethodException: No constructor found for MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)">ml at tomfanning.eu
       </A><BR>
    <I>Tue Jul 19 06:28:12 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003947.html">[MonoTouch] System.MissingMethodException: No constructor found for MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)
</A></li>
        <LI>Next message: <A HREF="003951.html">[MonoTouch] System.MissingMethodException: No constructor found	for	MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3949">[ date ]</a>
              <a href="thread.html#3949">[ thread ]</a>
              <a href="subject.html#3949">[ subject ]</a>
              <a href="author.html#3949">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Okay, I think I've got this reliable - at least it's not crashed with
150+ button pushes on my last few goes.

For reference

The AudioSession code is required to get volume control working.
Without that, my volume buttons change the ringer volume, not the
media volume.

I have to call AudioSession.SetActive(true); every time I create an
AVAudioPlayer, otherwise I risk an AudioSessionException with message
&quot;Application Audio Session is not active&quot;.

I removed the anonymous method from FinishedPlaying, and instead do
the following.

I have a class-scoped List&lt;AVAudioPlayer&gt; called toDispose.

On button press:

{
    // call Play on a freshly instantiated AVAudioPlayer ap:
    var ap = AVAudioPlayer.FromUrl(url, out err);
    ap.Play();

    // next I check to see if toDispose has a bunch of AVAudioPlayers
piled up, and if so, dispose all but the last couple in the list (my
samples are only 0.15 seconds long so it's unlikely I'll dispose one
that's currently playing this way)
    // code snipped for brevity

    // add the current AVAudioPlayer to the list of players to keep track of
    toDispose.Add(ap);
}

then finally in ViewWillDisappear() I dispose any remaining
AVAudioPlayers in toDispose, and remove the disposed player from the
list.

Horrible but stable with many short samples being played, unlike the
sample code on the MonoTouch website.

Thanks for the suggestions.
Tom

On Tue, Jul 19, 2011 at 1:07 AM, David Moles &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">davidmoles at thegogame.com</A>&gt; wrote:
&gt;<i> FWIW, I'm using AVAudioPlayer.FromUrl() and it works for me. I'm not
</I>&gt;<i> disposing on FinishedPlaying, though, I've got separate code that calls Stop
</I>&gt;<i> and then Dispose. I'm also not using AudioSession at all.
</I>&gt;<i> Note though that I'm still on MT 3.2.x, if that makes a difference.
</I>&gt;<i>
</I>&gt;<i> On Mon, Jul 18, 2011 at 3:18 PM, Tom Fanning &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">ml at tomfanning.eu</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Weird one this.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In a ViewController I call the following code in ViewDidLoad():
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> AudioSession.Initialize();
</I>&gt;&gt;<i> AudioSession.Category = AudioSessionCategory.MediaPlayback;
</I>&gt;&gt;<i> AudioSession.SetActive(true);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then in response to some button presses I do:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> NSError err;
</I>&gt;&gt;<i> var ap = AVAudioPlayer.FromUrl(new NSUrl(&quot;mysound.caf&quot;), out err);
</I>&gt;&gt;<i> ap.FinishedPlaying += delegate { ap.Dispose(); };
</I>&gt;&gt;<i> ap.Play();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And this works great, pretty responsive etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Except sometimes, seemingly randomly, I get the following unhandled
</I>&gt;&gt;<i> exception in release mode on the device (iPhone 3GS):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> System.MissingMethodException: No constructor found for
</I>&gt;&gt;<i> MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any ideas? Google comes up blank for that specific missing constructor.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks
</I>&gt;&gt;<i> Tom
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Tom Fanning
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> MonoTouch mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> David Moles
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">davidmoles at thegogame.com</A>
</I>&gt;<i>
</I>


-- 
Tom Fanning
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003947.html">[MonoTouch] System.MissingMethodException: No constructor found for MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)
</A></li>
	<LI>Next message: <A HREF="003951.html">[MonoTouch] System.MissingMethodException: No constructor found	for	MonoTouch.AVFoundation.InternalAVAudioPlayerDelegate::.ctor(System.IntPtr)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3949">[ date ]</a>
              <a href="thread.html#3949">[ thread ]</a>
              <a href="subject.html#3949">[ subject ]</a>
              <a href="author.html#3949">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
