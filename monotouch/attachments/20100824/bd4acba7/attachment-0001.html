<tt>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;TITLE&gt;Re:&nbsp;[MonoTouch]&nbsp;Running&nbsp;a&nbsp;web&nbsp;server&nbsp;on&nbsp;the&nbsp;iPhone&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;Whoops!&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;8/24/10&nbsp;8:27&nbsp;PM,&nbsp;&amp;quot;Ruben&nbsp;Lopez&amp;quot;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;rlopezxl@gmail.com&quot;&gt;rlopezxl@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;Hey&nbsp;you&nbsp;didn't&nbsp;CC&nbsp;the&nbsp;list,&nbsp;might&nbsp;want&nbsp;to&nbsp;resend&nbsp;because&nbsp;this&nbsp;is&nbsp;a&nbsp;good&nbsp;example.&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;Tue,&nbsp;Aug&nbsp;24,&nbsp;2010&nbsp;at&nbsp;3:42&nbsp;PM,&nbsp;Tim&nbsp;Scott&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;tscott@lunaversesoftware.com&quot;&gt;tscott@lunaversesoftware.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;I&nbsp;followed&nbsp;Ruben&amp;#8217;s&nbsp;example&nbsp;when&nbsp;building&nbsp;the&nbsp;web&nbsp;server&nbsp;into&nbsp;my&nbsp;app.&nbsp; My&nbsp;use&nbsp;of&nbsp;a&nbsp;web&nbsp;servicer&nbsp;is&nbsp;quite&nbsp;basuc&nbsp;&amp;#8212;&nbsp;the&nbsp;user&nbsp;just&nbsp;enters&nbsp;an&nbsp;address&nbsp;in&nbsp;any&nbsp;browser&nbsp;on&nbsp;the&nbsp;same&nbsp;network&nbsp;as&nbsp;the&nbsp;Iphone,&nbsp;and&nbsp;down&nbsp;comes&nbsp;a&nbsp;text&nbsp;file.&nbsp;  My&nbsp;HttpServer&nbsp;code&nbsp;is&nbsp;not&nbsp;cleanly&nbsp;separated&nbsp;from&nbsp;my&nbsp;app&nbsp;functionaility,&nbsp;but&nbsp;I&nbsp;cut&nbsp;out&nbsp;the&nbsp;most&nbsp;relevant&nbsp;parts&nbsp;to&nbsp;share.&nbsp; From&nbsp;this&nbsp;you&nbsp;can&nbsp;see&nbsp;how&nbsp;to&nbsp;do&nbsp;it.&nbsp; The&nbsp;trickiest&nbsp;part&nbsp;was&nbsp;figuring&nbsp;out&nbsp;how&nbsp;to&nbsp;find&nbsp;an&nbsp;available&nbsp;port.&nbsp; Obj-C&nbsp;has&nbsp;a&nbsp;way&nbsp;to&nbsp;ask&nbsp;the&nbsp;OS,&nbsp;but&nbsp;I&nbsp;did&nbsp;not&nbsp;find&nbsp;that&nbsp;in&nbsp;MonoTouch.&lt;BR&gt;<br>
&lt;BR&gt;<br>
private&nbsp;HttpListener&nbsp;listener;&lt;BR&gt;<br>
&lt;BR&gt;<br>
public&nbsp;void&nbsp;Start()&lt;BR&gt;<br>
{&lt;BR&gt;<br>
       StartNewHttpListener&nbsp;();&lt;BR&gt;<br>
       Listen&nbsp;();&lt;BR&gt;<br>
}&lt;BR&gt;<br>
&lt;BR&gt;<br>
private&nbsp;void&nbsp;StartNewHttpListener&nbsp;()&lt;BR&gt;<br>
{&lt;BR&gt;<br>
#if&nbsp;SIM&lt;BR&gt;<br>
    var&nbsp;localAddress&nbsp;=&nbsp;IPAddress.Parse&nbsp;(&amp;quot;127.0.0.1&amp;quot;);&lt;BR&gt;<br>
#else&lt;BR&gt;<br>
    var&nbsp;hostName&nbsp;=&nbsp;Dns.GetHostName&nbsp;()&nbsp;+&nbsp;&amp;quot;.local&amp;quot;;&lt;BR&gt;<br>
    var&nbsp;hostEntry&nbsp;=&nbsp;Dns.GetHostEntry(hostName);&lt;BR&gt;<br>
    var&nbsp;localAddress&nbsp;=&nbsp;hostEntry.AddressList.Where(x&nbsp;=&amp;gt;&nbsp;x.AddressFamily&nbsp;==&nbsp;AddressFamily.InterNetwork).First();&lt;BR&gt;<br>
#endif&lt;BR&gt;<br>
&lt;BR&gt;<br>
    for&nbsp;(int&nbsp;port&nbsp;=&nbsp;54400;&nbsp;port&nbsp;&amp;lt;&nbsp;65535;&nbsp;port++)&nbsp;&lt;BR&gt;<br>
    {&lt;BR&gt;<br>
        listener&nbsp;=&nbsp;new&nbsp;HttpListener&nbsp;();&lt;BR&gt;<br>
        url&nbsp;=&nbsp;string.Format&nbsp;(&amp;quot;&lt;a&nbsp;href=&quot;http://{0}:{1}/&quot;&gt;http://{0}:{1}/&lt;/a&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://%7B0%7D%3A%7B1%7D/&quot;&gt;http://%7B0%7D%3A%7B1%7D/&lt;/a&gt;&amp;gt;&nbsp;&amp;quot;,&nbsp;localAddress,&nbsp;port);&lt;BR&gt;<br>
        listener.Prefixes.Add&nbsp;(url);&lt;BR&gt;<br>
        try&nbsp;&lt;BR&gt;<br>
        {&lt;BR&gt;<br>
            listener.Start&nbsp;();&lt;BR&gt;<br>
            break;&lt;BR&gt;<br>
        }&nbsp;&lt;BR&gt;<br>
        catch&nbsp;{&nbsp;   }&lt;BR&gt;<br>
    }&lt;BR&gt;<br>
}&lt;BR&gt;<br>
&lt;BR&gt;<br>
private&nbsp;void&nbsp;Listen&nbsp;()&lt;BR&gt;<br>
{&lt;BR&gt;<br>
    var&nbsp;result&nbsp;=&nbsp;listener.BeginGetContext&nbsp;(new&nbsp;AsyncCallback&nbsp;(OnRequestReceived),&nbsp;listener);&lt;BR&gt;<br>
}&lt;BR&gt;<br>
&lt;BR&gt;<br>
private&nbsp;void&nbsp;OnRequestReceived&nbsp;(IAsyncResult&nbsp;result)&lt;BR&gt;<br>
{&lt;BR&gt;<br>
    if&nbsp;(listener&nbsp;==&nbsp;null)&nbsp;&lt;BR&gt;<br>
    {&lt;BR&gt;<br>
        return;&lt;BR&gt;<br>
    }&lt;BR&gt;<br>
    var&nbsp;context&nbsp;=&nbsp;((HttpListener)result.AsyncState).EndGetContext&nbsp;(result);&lt;BR&gt;<br>
    controller.InvokeOnMainThread&nbsp;(delegate&nbsp;&lt;BR&gt;<br>
    {&lt;BR&gt;<br>
        SendResponse&nbsp;(context);&lt;BR&gt;<br>
    });&lt;BR&gt;<br>
    Listen&nbsp;();&lt;BR&gt;<br>
}&lt;BR&gt;<br>
&lt;BR&gt;<br>
private&nbsp;void&nbsp;SendResponse&nbsp;(HttpListenerContext&nbsp;context)&lt;BR&gt;<br>
{&lt;BR&gt;<br>
    var&nbsp;response&nbsp;=&nbsp;context.Response;&lt;BR&gt;<br>
    var&nbsp;content&nbsp;=&nbsp;GetContent();&lt;BR&gt;<br>
    var&nbsp;buffer&nbsp;=&nbsp;Encoding.UTF8.GetBytes&nbsp;(content);&lt;BR&gt;<br>
    response.ContentLength64&nbsp;=&nbsp;buffer.Length;&lt;BR&gt;<br>
    response.ContentType&nbsp;=&nbsp;&amp;quot;text/tsv&amp;quot;;&lt;BR&gt;<br>
    response.AddHeader&nbsp;(&amp;quot;Content-disposition&amp;quot;,&nbsp;&amp;quot;attachment;&nbsp;filename=\&amp;quot;&amp;quot;&nbsp;+&nbsp;GetExportFileName&nbsp;()&nbsp;+&nbsp;&amp;quot;\&amp;quot;&amp;quot;);&lt;BR&gt;<br>
    response.OutputStream.Write&nbsp;(buffer,&nbsp;0,&nbsp;buffer.Length);&nbsp;   &lt;BR&gt;<br>
    response.OutputStream.Close&nbsp;();&lt;BR&gt;<br>
&lt;BR&gt;<br>
}&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;8/24/10&nbsp;4:58&nbsp;PM,&nbsp;&amp;quot;Ruben&nbsp;Lopez&amp;quot;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;rlopezxl@gmail.com&quot;&gt;rlopezxl@gmail.com&lt;/a&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://rlopezxl@gmail.com&quot;&gt;http://rlopezxl@gmail.com&lt;/a&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;wrote:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;It's&nbsp;possible&nbsp;using&nbsp;HttpListener:&nbsp;&lt;a&nbsp;href=&quot;http://rlopezxl.com/2010/08/18/monotouch-simple-web-server/&quot;&gt;http://rlopezxl.com/2010/08/18/monotouch-simple-web-server/&lt;/a&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;Tue,&nbsp;Aug&nbsp;24,&nbsp;2010&nbsp;at&nbsp;2:21&nbsp;PM,&nbsp;Nic&nbsp;Wise&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;nicw@fastchicken.co.nz&quot;&gt;nicw@fastchicken.co.nz&lt;/a&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://nicw@fastchicken.co.nz&quot;&gt;http://nicw@fastchicken.co.nz&lt;/a&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;wrote:&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;Anyone&nbsp;got&nbsp;working&nbsp;-&nbsp;or&nbsp;tried&nbsp;to&nbsp;get&nbsp;working&nbsp;-&nbsp;a&nbsp;web&nbsp;server&nbsp;on&nbsp;the&nbsp;iPhone?&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;dont&nbsp;need&nbsp;anything&nbsp;as&nbsp;complex&nbsp;as&nbsp;MVC,&nbsp;but&nbsp;I'd&nbsp;rather&nbsp;not&nbsp;have&nbsp;to&lt;BR&gt;<br>
start&nbsp;with&nbsp;Listen(port=80)&nbsp;etc.&nbsp;:)&lt;BR&gt;<br>
&lt;BR&gt;<br>
Most&nbsp;of&nbsp;it&nbsp;is&nbsp;going&nbsp;to&nbsp;be&nbsp;basic&nbsp;REST&nbsp;(for&nbsp;doing&nbsp;an&nbsp;admin&nbsp;interface,&nbsp;so&lt;BR&gt;<br>
the&nbsp;UI&nbsp;is&nbsp;all&nbsp;JS+CSS),&nbsp;but....&nbsp;anyone&nbsp;done&nbsp;it?&lt;BR&gt;<br>
&lt;BR&gt;<br>
Ta&lt;BR&gt;<br>
&lt;BR&gt;<br>
N&lt;BR&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#888888&quot;&gt;&lt;BR&gt;<br>
--&lt;BR&gt;<br>
Nic&nbsp;Wise&lt;BR&gt;<br>
t. &nbsp;+44&nbsp;7788&nbsp;592806&nbsp;|&nbsp;@fastchicken&nbsp;|&nbsp;&lt;a&nbsp;href=&quot;http://www.linkedin.com/in/nicwise&quot;&gt;http://www.linkedin.com/in/nicwise&lt;/a&gt;&lt;BR&gt;<br>
b.&nbsp;&lt;a&nbsp;href=&quot;http://www.fastchicken.co.nz/&quot;&gt;http://www.fastchicken.co.nz/&lt;/a&gt;&nbsp;|&nbsp;&lt;a&nbsp;href=&quot;http://www.flickr.com/photos/nicwise&quot;&gt;http://www.flickr.com/photos/nicwise&lt;/a&gt;&lt;BR&gt;<br>
_______________________________________________&lt;BR&gt;<br>
MonoTouch&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;MonoTouch@lists.ximian.com&quot;&gt;MonoTouch@lists.ximian.com&lt;/a&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://MonoTouch@lists.ximian.com&quot;&gt;http://MonoTouch@lists.ximian.com&lt;/a&gt;&amp;gt;&nbsp;&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/monotouch&quot;&gt;http://lists.ximian.com/mailman/listinfo/monotouch&lt;/a&gt;&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;HR&nbsp;ALIGN=CENTER&nbsp;SIZE=&quot;3&quot;&nbsp;WIDTH=&quot;95%&quot;&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;FONT&nbsp;SIZE=&quot;2&quot;&gt;&lt;FONT&nbsp;FACE=&quot;Consolas,&nbsp;Courier&nbsp;New,&nbsp;Courier&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:12pt'&gt;_______________________________________________&lt;BR&gt;<br>
MonoTouch&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;MonoTouch@lists.ximian.com&quot;&gt;MonoTouch@lists.ximian.com&lt;/a&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;http://MonoTouch@lists.ximian.com&quot;&gt;http://MonoTouch@lists.ximian.com&lt;/a&gt;&amp;gt;&nbsp;&lt;BR&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/monotouch&quot;&gt;http://lists.ximian.com/mailman/listinfo/monotouch&lt;/a&gt;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/BLOCKQUOTE&gt;&lt;/BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/BLOCKQUOTE&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>
<br>

</tt>
