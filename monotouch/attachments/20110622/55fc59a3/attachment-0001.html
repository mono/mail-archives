<tt>
&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&nbsp;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&nbsp;&quot;&gt;I&nbsp;see&nbsp;in&nbsp;the&nbsp;archives&nbsp;that&nbsp;folks&nbsp;have&nbsp;had&nbsp;some&nbsp;problems&nbsp;with&nbsp;crashes&nbsp;in&nbsp;Mono.Data.Sqlite,&nbsp;and&nbsp;I&nbsp;just&nbsp;ran&nbsp;into&nbsp;the&nbsp;same&nbsp;problem&nbsp;today.&nbsp;I&nbsp;had&nbsp;a&nbsp;routine&nbsp;that&nbsp;loads&nbsp;up&nbsp;a&nbsp;lot&nbsp;of&nbsp;objects&nbsp;from&nbsp;the&nbsp;database,&nbsp;and&nbsp;it&nbsp;would&nbsp;intermittently&nbsp;crash&nbsp;at&nbsp;different&nbsp;places&nbsp;in&nbsp;the&nbsp;loading&nbsp;process,&nbsp;not&nbsp;always&nbsp;in&nbsp;the&nbsp;same&nbsp;place.&nbsp;It&nbsp;died&nbsp;inside&nbsp;Mono.Data.Sqlite&nbsp;with &lt;span&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;font-size:&nbsp;medium;&nbsp;&quot;&gt;Mono.Data.Sqlite.SQLite3.Prepare&nbsp;&lt;/span&gt;as&nbsp;the&nbsp;offending&nbsp;statement.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Since&nbsp;the&nbsp;error&nbsp;was&nbsp;intermittent,&nbsp;I&nbsp;can&amp;#39;t&nbsp;tell&nbsp;you&nbsp;with&nbsp;100%&nbsp;certainty&nbsp;that&nbsp;it&amp;#39;s&nbsp;entirely&nbsp;gone,&nbsp;but&nbsp;it&nbsp;used&nbsp;to&nbsp;crash&nbsp;8&nbsp;times&nbsp;out&nbsp;of&nbsp;10,&nbsp;and&nbsp;it&nbsp;has&nbsp;not&nbsp;crashed&nbsp;at&nbsp;all&nbsp;since&nbsp;I&nbsp;took&nbsp;the&nbsp;following&nbsp;steps.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;First,&nbsp;I&nbsp;just&nbsp;tried&nbsp;to&nbsp;avoid&nbsp;using&nbsp;calls&nbsp;to&nbsp;the&nbsp;DB&nbsp;any&nbsp;more&nbsp;than&nbsp;I&nbsp;had&nbsp;to.&nbsp;The&nbsp;app&nbsp;had&nbsp;a&nbsp;loading&nbsp;loop&nbsp;in&nbsp;one&nbsp;place&nbsp;where&nbsp;it&nbsp;executed&nbsp;the&nbsp;same&nbsp;simple&nbsp;query&nbsp;about&nbsp;200&nbsp;times.&nbsp;Although&nbsp;a&nbsp;little&nbsp;ugly,&nbsp;the&nbsp;repeated&nbsp;queries&nbsp;no&nbsp;unpleasant&nbsp;performance&nbsp;impact;&nbsp;but,&nbsp;changing&nbsp;it&nbsp;so&nbsp;that&nbsp;I&nbsp;got&nbsp;only&nbsp;one&nbsp;big&nbsp;query&nbsp;and&nbsp;dealt&nbsp;with&nbsp;it&nbsp;in&nbsp;memory&nbsp;reduced&nbsp;the&nbsp;crashes&nbsp;by&nbsp;a&nbsp;bit&nbsp;(from&nbsp;every&nbsp;single&nbsp;time&nbsp;I&nbsp;ran&nbsp;the&nbsp;app&nbsp;to&nbsp;once-in-a-while-it-works!).&nbsp;And,&nbsp;of&nbsp;course,&nbsp;it&amp;#39;s&nbsp;much&nbsp;more&nbsp;elegant&nbsp;now&nbsp;:).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Second,&nbsp;I&nbsp;avoided&nbsp;reusing&nbsp;connections.&nbsp;In&nbsp;another&nbsp;place,&nbsp;the&nbsp;code&nbsp;had&nbsp;been&nbsp;loading&nbsp;up&nbsp;objects&nbsp;one&nbsp;row&nbsp;at&nbsp;a&nbsp;time,&nbsp;then&nbsp;issuing&nbsp;a&nbsp;second&nbsp;query&nbsp;to&nbsp;pull&nbsp;in&nbsp;some&nbsp;child&nbsp;objects,&nbsp;sort&nbsp;of&nbsp;like&nbsp;this&nbsp;(obviously&nbsp;simplified&nbsp;and&nbsp;pseudo;&nbsp;there&nbsp;were&nbsp;LOTS&nbsp;of&nbsp;child&nbsp;collections):&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt;void&nbsp;LoadWidgets()&nbsp;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp;SqliteConnection&nbsp;conn&nbsp;=&nbsp;new&nbsp;SqliteConnection(str);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp;while&nbsp;(reader.Read()&nbsp;)&nbsp;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp; &nbsp;Widget&nbsp;w&nbsp;=&nbsp;new&nbsp;Widget();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp; &nbsp;//&nbsp;do&nbsp;some&nbsp;stuff&nbsp;to&nbsp;make&nbsp;my&nbsp;new&nbsp;widget&nbsp;object&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp; &nbsp;IList&amp;lt;WidgetKids&amp;gt;&nbsp;children&nbsp;=&nbsp;GetChildren(conn,&nbsp;w.UniqueId);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp; ....&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt;}&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt;IList&amp;lt;WidgetKids&amp;gt;&nbsp;GetChildren(SqliteConnection&nbsp;c,&nbsp;int&nbsp;id)&nbsp;{ &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp;//&nbsp;uses&nbsp;the&nbsp;passed&nbsp;in&nbsp;connection&nbsp;to&nbsp;create&nbsp;another&nbsp;reader,&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt; &nbsp;//&nbsp;make&nbsp;up&nbsp;WidgetKids,&nbsp;and&nbsp;return&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;courier&nbsp;new&amp;#39;,&nbsp;monospace&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;the&nbsp;intent&nbsp;of&nbsp;the&nbsp;code&nbsp;was&nbsp;to&nbsp;avoid&nbsp;creating&nbsp;multiple&nbsp;connections&nbsp;at&nbsp;the&nbsp;same&nbsp;time,&nbsp;but&nbsp;apparently&nbsp;given&nbsp;the&nbsp;state&nbsp;of&nbsp;Mono.Data.Sqlite,&nbsp;having&nbsp;two&nbsp;readers&nbsp;open&nbsp;on&nbsp;the&nbsp;same&nbsp;connection&nbsp;can&nbsp;also&nbsp;be&nbsp;bad.&nbsp;Once&nbsp;I&nbsp;removed&nbsp;this&nbsp;and&nbsp;made&nbsp;it&nbsp;so&nbsp;that&nbsp;only&nbsp;one&nbsp;connection&nbsp;and&nbsp;one&nbsp;reader&nbsp;were&nbsp;ever&nbsp;open&nbsp;at&nbsp;one&nbsp;time,&nbsp;the&nbsp;crashes&nbsp;stopped.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Note&nbsp;that&nbsp;(unless&nbsp;the&nbsp;OS&nbsp;is&nbsp;&amp;#39;helping&nbsp;me&nbsp;out&amp;#39;),&nbsp;there&amp;#39;s&nbsp;no&nbsp;multithreading&nbsp;going&nbsp;on&nbsp;here,&nbsp;which&nbsp;is&nbsp;a&nbsp;sure&nbsp;path&nbsp;to&nbsp;pain&nbsp;in&nbsp;Sqlite;&nbsp;but&nbsp;something&nbsp;quasi-concurrent&nbsp;may&nbsp;be&nbsp;happening&nbsp;under&nbsp;the&nbsp;hood.&lt;/div&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;relatively&nbsp;new&nbsp;to&nbsp;this;&nbsp;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;if&nbsp;the&nbsp;reuse&nbsp;of&nbsp;connections&nbsp;above&nbsp;is&nbsp;generally&nbsp;deprecated.&nbsp;But&nbsp;this&nbsp;code&nbsp;was&nbsp;running&nbsp;on&nbsp;Windows&nbsp;and&nbsp;Ubuntu&nbsp;under&nbsp;some&nbsp;fairly&nbsp;intense&nbsp;tests&nbsp;and&nbsp;never&nbsp;failed;&nbsp;but&nbsp;Monotouch/iPad&nbsp;was&nbsp;never&nbsp;happy.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hope&nbsp;this&nbsp;helps&nbsp;someone&nbsp;along&nbsp;the&nbsp;way...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;bjs&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&gt;Brian&nbsp;Schuth&lt;/div&gt;&lt;div&gt;ALPHCE,&nbsp;Inc.&lt;/div&gt;&lt;div&gt;Eastport,&nbsp;ME&lt;/div&gt;&lt;div&gt;+1&nbsp;207&nbsp;370&nbsp;2430&lt;/div&gt;&lt;div&gt;<br>
&lt;a&nbsp;href=&quot;/user/SendEmail.jtp?type=node&amp;node=3616537&amp;i=0&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;[hidden&nbsp;email]&lt;/a&gt;&lt;/div&gt;&lt;br&gt;<br>
<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>
&lt;br/&gt;&lt;hr&nbsp;align=&quot;left&quot;&nbsp;width=&quot;300&quot;&nbsp;/&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://monotouch.2284126.n4.nabble.com/My-experience-solving-I-hope-Mono-Data-Sqlite-crash-problem-tp3616537p3616537.html&quot;&gt;My&nbsp;experience&nbsp;solving&nbsp;(I&nbsp;hope!)&nbsp;Mono.Data.Sqlite&nbsp;crash&nbsp;problem&lt;/a&gt;&lt;br/&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://monotouch.2284126.n4.nabble.com/&quot;&gt;MonoTouch&nbsp;mailing&nbsp;list&nbsp;archive&lt;/a&gt;&nbsp;at&nbsp;Nabble.com.&lt;br/&gt;
</tt>
