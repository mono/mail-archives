<tt>
&lt;div&gt;Hello,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;I&amp;#39;m&nbsp;still&nbsp;stuck&nbsp;with&nbsp;this.&nbsp;Any&nbsp;suggestions?&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;got&nbsp;me&nbsp;started&nbsp;was&nbsp;these&nbsp;Objective-C&nbsp;implementations:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;a&nbsp;href=&quot;http://blog.tapsquare.com/post/803301658/ipod-library-access&quot;&gt;http://blog.tapsquare.com/post/803301658/ipod-library-access&lt;/a&gt;&lt;/li&gt;<br>
&lt;li&gt;&lt;a&nbsp;href=&quot;http://www.subfurther.com/blog/?p=1103&quot;&gt;http://www.subfurther.com/blog/?p=1103&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Mikkel&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Dec&nbsp;3,&nbsp;2010&nbsp;at&nbsp;12:40,&nbsp;Mikkel&nbsp;Lønow&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mloenow@gmail.com&quot;&gt;mloenow@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;having&nbsp;trouble&nbsp;with&nbsp;AVAssetExportSession. I&nbsp;want&nbsp;to&nbsp;copy&nbsp;music&nbsp;tracks&nbsp;from&nbsp;the&nbsp;iPod&nbsp;Library&nbsp;for&nbsp;further&nbsp;processing.&nbsp;Of&nbsp;course,&nbsp;this&nbsp;isn&amp;#39;t&nbsp;possible&nbsp;in&nbsp;the&nbsp;simulator&nbsp;so&nbsp;I&nbsp;&amp;quot;emulate&amp;quot;&nbsp;the&nbsp;library&nbsp;selection&nbsp;part&nbsp;with&nbsp;a&nbsp;static&nbsp;file.&nbsp;Here&nbsp;is&nbsp;my&nbsp;code:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;private&nbsp;AVAssetExportSession&nbsp;_assetExportSession;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;var&nbsp;path&nbsp;=&nbsp;Environment.GetFolderPath(Environment.SpecialFolder.Personal)&nbsp;+&nbsp;&amp;quot;/ImOnFire.m4a&amp;quot;;&lt;/div&gt;<br>
<br>
&lt;div&gt;Console.WriteLine(path);&lt;/div&gt;&lt;div&gt;var assetURL&nbsp;= NSUrl.FromFilename(path);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;NSObject[]&nbsp;values&nbsp;=&nbsp;new&nbsp;NSObject[]&nbsp;{ new&nbsp;NSString(&amp;quot;YES&amp;quot;) };&lt;/div&gt;<br>
<br>
&lt;div&gt;NSObject[]&nbsp;keys&nbsp;=&nbsp;new&nbsp;NSObject[]&nbsp;{ AVUrlAsset.PreferPreciseDurationAndTimingKey };&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;var&nbsp;options&nbsp;=&nbsp;NSDictionary.FromObjectsAndKeys(values,&nbsp;keys);&lt;/div&gt;<br>
<br>
&lt;div&gt;var&nbsp;asset&nbsp;=&nbsp;AVUrlAsset.FromUrl(assetURL,&nbsp;options);&lt;/div&gt;&lt;div&gt;_var&nbsp;assetExportSession&nbsp;=&nbsp;new&nbsp;AVAssetExportSession(asset,&nbsp;AVAssetExportSession.PresetPassthrough);&lt;/div&gt;&lt;div&gt;_assetExportSession.OutputUrl&nbsp;=&nbsp;NSUrl.FromFilename(Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.Personal),&nbsp;&amp;quot;../tmp/&amp;quot;&nbsp;+&nbsp;Guid.NewGuid().ToString()&nbsp;+&nbsp;&amp;quot;.m4a&amp;quot;));&lt;/div&gt;<br>
<br>
&lt;div&gt;_assetExportSession.OutputFileType&nbsp;=&nbsp;AVFileType.AppleM4A;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;_assetExportSession.ExportAsynchronously((NSError&nbsp;error)&nbsp;=&amp;gt;&nbsp;{&lt;/div&gt;&lt;div&gt;<br>
  &nbsp; //Console.WriteLine(error.ToString());&lt;/div&gt;&lt;div&gt;  &nbsp; switch&nbsp;(_assetExportSession.Status)&nbsp;{&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp; case&nbsp;AVAssetExportSessionStatus.Exporting:&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp;   &nbsp; Console.WriteLine(&amp;quot;Exporting:&nbsp;&amp;quot;&nbsp;+&nbsp;_assetExportSession.Progress);&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; break;&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp; case&nbsp;AVAssetExportSessionStatus.Completed:&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; Console.WriteLine(&amp;quot;Completed&amp;quot;);&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp;   &nbsp; break;&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp; case&nbsp;AVAssetExportSessionStatus.Cancelled:&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; Console.WriteLine(&amp;quot;Cancelled&amp;quot;);&lt;/div&gt;<br>
&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; break;&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp; case&nbsp;AVAssetExportSessionStatus.Failed:&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp;   &nbsp; Console.WriteLine(&amp;quot;Failed&amp;quot;);&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; break;&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp; case&nbsp;AVAssetExportSessionStatus.Unknown:&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; Console.WriteLine(&amp;quot;Unknown&amp;quot;);&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp;   &nbsp; break;&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp; case&nbsp;AVAssetExportSessionStatus.Waiting:&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp;   &nbsp; Console.WriteLine(&amp;quot;Waiting&amp;quot;);&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; break;&lt;/div&gt;&lt;div&gt;<br>
  &nbsp;   &nbsp; default:&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; Console.WriteLine(&amp;quot;Default&amp;quot;);&lt;/div&gt;&lt;div&gt;  &nbsp;   &nbsp;   &nbsp; break;&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; }&lt;/div&gt;&lt;div&gt;});&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;works&nbsp;with&nbsp;AppleM4A,&nbsp;but&nbsp;it&nbsp;still&nbsp;throws&nbsp;an&nbsp;exception&nbsp;(and&nbsp;gets&nbsp;a&nbsp;SIGSEGV):&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;System.NullReferenceException&nbsp;has&nbsp;been&nbsp;thrown&lt;/div&gt;&lt;div&gt;&amp;quot;Object&nbsp;reference&nbsp;not&nbsp;set&nbsp;to&nbsp;an&nbsp;instance&nbsp;of&nbsp;an&nbsp;object&amp;quot;&lt;/div&gt;&lt;div&gt;&lt;div&gt;  at&nbsp;(wrapper&nbsp;managed-to-native)&nbsp;MonoTouch.ObjCRuntime.Messaging.intptr_objc_msgSend&nbsp;(intptr,intptr)&nbsp;&amp;lt;0x00004&amp;gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;  at&nbsp;(wrapper&nbsp;managed-to-native)&nbsp;MonoTouch.ObjCRuntime.Messaging.intptr_objc_msgSend&nbsp;(intptr,intptr)&nbsp;&amp;lt;0x00004&amp;gt;&lt;/div&gt;&lt;div&gt;  at&nbsp;MonoTouch.ObjCRuntime.Runtime.GetNSObject&nbsp;(intptr)&nbsp;[0x0001f]&nbsp;in&nbsp;/Users/plasma/Source/iphone/monotouch/ObjCRuntime/Runtime.cs:200&lt;/div&gt;<br>
<br>
&lt;div&gt;  at&nbsp;MonoTouch.AVFoundation.AVAssetExportSession.TrampolineAVErrorHandler&nbsp;(intptr,intptr)&nbsp;[0x0004d]&nbsp;in&nbsp;/Users/plasma/Source/iphone/monotouch/AVFoundation/AVAssetExportSession.g.cs:515&lt;/div&gt;&lt;div&gt;  at&nbsp;(wrapper&nbsp;native-to-managed)&nbsp;MonoTouch.AVFoundation.AVAssetExportSession.TrampolineAVErrorHandler&nbsp;(intptr,intptr)&nbsp;&amp;lt;IL&nbsp;0x00018,&nbsp;0x0008d&amp;gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;trying&nbsp;with&nbsp;a&nbsp;MP3&nbsp;file&nbsp;in&nbsp;a&nbsp;MOV-container&nbsp;(OutputFileType&nbsp;= AVFileType.QuickTimeMovie)&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;throw&nbsp;an&nbsp;exception&nbsp;but&nbsp;doesn&amp;#39;t&nbsp;copy&nbsp;the&nbsp;track&nbsp;either&nbsp;(it&nbsp;produces&nbsp;0&nbsp;KB&nbsp;files).&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;seems&nbsp;like ExportAsynchronously&amp;#39;s&nbsp;completion&nbsp;block&nbsp;never&nbsp;gets&nbsp;fired&nbsp;-&nbsp;it&nbsp;could&nbsp;be&nbsp;related?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Furthermore,&nbsp;AVUrlAsset.FromUrl(assetURL,&nbsp;null)&nbsp;(no&nbsp;options)&nbsp;also&nbsp;throws&nbsp;an&nbsp;exception&nbsp;-&nbsp;I&amp;#39;ve&nbsp;seen&nbsp;Objective-C&nbsp;do&nbsp;this.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;help&nbsp;is&nbsp;greatly&nbsp;appreciated!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kind&nbsp;regards,&lt;/div&gt;&lt;div&gt;Mikkel&lt;/div&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
