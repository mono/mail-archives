<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;tried&nbsp;your&nbsp;projects,&nbsp;and&nbsp;got&nbsp;somewhat&nbsp;different&nbsp;results&nbsp;(on&nbsp;an&nbsp;iPad2).&lt;br&gt;&lt;br&gt;Objective-C&nbsp;implementation:&nbsp;0,296s&lt;br&gt;MonoTouch&nbsp;(release&nbsp;mode):&nbsp;0,677s&lt;br&gt;MonoTouch&nbsp;(release&nbsp;mode,&nbsp;with&nbsp;LLVM&nbsp;enabled):&nbsp;0,397&lt;br&gt;&lt;br&gt;<br>
So&nbsp;just&nbsp;MonoTouch&nbsp;release&nbsp;mode&nbsp;is&nbsp;2.3x&nbsp;times&nbsp;slower,&nbsp;but&nbsp;once&nbsp;you&nbsp;enable&nbsp;LLVM,&nbsp;this&nbsp;goes&nbsp;down&nbsp;to&nbsp;1.34x&nbsp;slower.&lt;br&gt;&lt;br&gt;I&nbsp;also&nbsp;noticed&nbsp;that&nbsp;BitmapContext.FillRect&nbsp;is&nbsp;called&nbsp;a&nbsp;lot&nbsp;(39635&nbsp;times),&nbsp;so&nbsp;I&nbsp;commented&nbsp;it&nbsp;out&nbsp;and&nbsp;now&nbsp;I&nbsp;get&nbsp;these&nbsp;timings:&lt;br&gt;<br>
Objective-C&nbsp;implementation:&nbsp;0,224s&lt;br&gt;MonoTouch&nbsp;(LLVM&nbsp;enabled):&nbsp;0,293s&lt;br&gt;&lt;br&gt;So&nbsp;just&nbsp;calling&nbsp;FillRect&nbsp;39635&nbsp;times&nbsp;takes&nbsp;0,072s&nbsp;in&nbsp;ObjC&nbsp;and&nbsp;0,104s&nbsp;with&nbsp;MonoTouch&nbsp;-&nbsp;the&nbsp;discrepancy&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;the&nbsp;MonoTouch&nbsp;version&nbsp;obviously&nbsp;has&nbsp;to&nbsp;do&nbsp;more&nbsp;work&nbsp;(it&nbsp;has&nbsp;to&nbsp;do&nbsp;a&nbsp;managed-to-native&nbsp;transition&nbsp;(and&nbsp;back&nbsp;again)).&nbsp;So&nbsp;now&nbsp;MonoTouch&nbsp;is&nbsp;1.31x&nbsp;slower.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;point&nbsp;is&nbsp;that&nbsp;LLVM&nbsp;mode&nbsp;is&nbsp;exactly&nbsp;for&nbsp;this&nbsp;kind&nbsp;of&nbsp;cpu&nbsp;intensitive&nbsp;tasks,&nbsp;since&nbsp;our&nbsp;jit&nbsp;doesn&#39;t&nbsp;generate&nbsp;as&nbsp;optimized&nbsp;code&nbsp;as&nbsp;the&nbsp;LLVM&nbsp;one&nbsp;can.&lt;br&gt;&lt;br&gt;Now&nbsp;I&nbsp;started&nbsp;looking&nbsp;a&nbsp;bit&nbsp;deeper,&nbsp;and&nbsp;realized&nbsp;that&nbsp;the&nbsp;loop&nbsp;in&nbsp;IsInMandelbrotSet&nbsp;loops&nbsp;100&nbsp;times&nbsp;in&nbsp;the&nbsp;MonoTouch&nbsp;version&nbsp;and&nbsp;only&nbsp;50&nbsp;times&nbsp;in&nbsp;the&nbsp;ObjC&nbsp;version.&nbsp;Redoing&nbsp;the&nbsp;tests&nbsp;in&nbsp;MonoTouch,&nbsp;but&nbsp;this&nbsp;time&nbsp;only&nbsp;looping&nbsp;50&nbsp;times,&nbsp;I&nbsp;get&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;MonoTouch&nbsp;(LLVM&nbsp;enabled):&nbsp;0,290s.&lt;br&gt;&lt;br&gt;&lt;div&gt;Yes,&nbsp;that&#39;s&nbsp;correct.&nbsp;The&nbsp;MonoTouch&nbsp;(with&nbsp;LLVM)&nbsp;version&nbsp;is&nbsp;actually&nbsp;1%&nbsp;&lt;strong&gt;faster&lt;/strong&gt;&nbsp;than&nbsp;the&nbsp;ObjectiveC&nbsp;version&nbsp;with&nbsp;identical&nbsp;code.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
And&nbsp;as&nbsp;shown&nbsp;this&nbsp;difference&nbsp;can&nbsp;probably&nbsp;be&nbsp;increased&nbsp;(by&nbsp;not&nbsp;calling&nbsp;FillRect&nbsp;40k&nbsp;times,&nbsp;but&nbsp;perhaps&nbsp;manually&nbsp;create&nbsp;the&nbsp;bitmap&nbsp;in&nbsp;managed&nbsp;memory&nbsp;and&nbsp;then&nbsp;draw&nbsp;the&nbsp;bitmap&nbsp;with&nbsp;one&nbsp;call&nbsp;-&nbsp;this&nbsp;change&nbsp;would&nbsp;likely&nbsp;benefit&nbsp;both&nbsp;implementations,&nbsp;but&nbsp;it&nbsp;would&nbsp;benefit&nbsp;MonoTouch&nbsp;most).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;this&nbsp;helps&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Rolf&lt;/div&gt;&lt;br&gt;On&nbsp;Wed,&nbsp;Feb&nbsp;15,&nbsp;2012&nbsp;at&nbsp;10:14&nbsp;AM,&nbsp;RoyCornelissen&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:royc@infosupport.com&quot;&gt;royc@infosupport.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&lt;br&gt;&gt;&nbsp;Just&nbsp;as&nbsp;a&nbsp;little&nbsp;exercise&nbsp;I&nbsp;decided&nbsp;to&nbsp;try&nbsp;out&nbsp;a&nbsp;Mandelbrot&nbsp;test&nbsp;in&lt;br&gt;&gt;&nbsp;MonoTouch&nbsp;just&nbsp;to&nbsp;have&nbsp;a&nbsp;look&nbsp;at&nbsp;performance.&nbsp;I&nbsp;took&nbsp;this&nbsp;Objective-C&lt;br&gt;&gt;&nbsp;implementation&nbsp; &lt;a&nbsp;href=&quot;https://github.com/ddeville/Mandelbrot-set-on-iPhone&quot;&gt;https://github.com/ddeville/Mandelbrot-set-on-iPhone&lt;/a&gt;&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;GitHub&nbsp; as&nbsp;a&nbsp;basis&nbsp;and&nbsp;ported&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;view&nbsp;1-to-1&nbsp;to&lt;br&gt;&gt;&nbsp;MonoTouch.&nbsp;Because&nbsp;of&nbsp;some&nbsp;differences&nbsp;in&nbsp;API&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;code&nbsp;is&nbsp;100%&lt;br&gt;&gt;&nbsp;the&nbsp;same,&nbsp;and&nbsp;I&#39;m&nbsp;no&nbsp;CoreGraphics&nbsp;expert,&nbsp;but&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;know&nbsp;this&nbsp;looks&lt;br&gt;<br>
&gt;&nbsp;OK.&nbsp;The&nbsp;MonoTouch&nbsp;implementation&nbsp;can&nbsp;be&nbsp;found&nbsp;here&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://dl.dropbox.com/u/1135505/MonobrotSet.zip&quot;&gt;http://dl.dropbox.com/u/1135505/MonobrotSet.zip&lt;/a&gt;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;Now&nbsp;when&nbsp;I&nbsp;run&nbsp;this&nbsp;on&nbsp;my&nbsp;iPhone,&nbsp;the&nbsp;MonoTouch&nbsp;version&nbsp;is&nbsp;2.8&nbsp;times&nbsp;slower&lt;br&gt;<br>
&gt;&nbsp;than&nbsp;the&nbsp;Objective-C&nbsp;version,&nbsp;specifically&nbsp;the&nbsp;part&nbsp;where&nbsp;the&nbsp;Mandelbrot&nbsp;Set&lt;br&gt;&gt;&nbsp;is&nbsp;drawn&nbsp;in&nbsp;the&nbsp;bitmap.&nbsp;Objective-C&nbsp;takes&nbsp;~0.99&nbsp;seconds,&nbsp;MonoTouch&nbsp;~2.8&lt;br&gt;&gt;&nbsp;seconds.&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;Can&nbsp;anyone&nbsp;help&nbsp;explain&nbsp;where&nbsp;the&nbsp;overhead&nbsp;is&nbsp;coming&nbsp;from?&nbsp;Is&nbsp;there&nbsp;anything&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;could&nbsp;have&nbsp;done&nbsp;to&nbsp;make&nbsp;this&nbsp;faster&nbsp;given&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;in&lt;br&gt;&gt;&nbsp;Objective-C?&nbsp;I&#39;m&nbsp;not&nbsp;looking&nbsp;for&nbsp;a&nbsp;faster&nbsp;Mandelbrot&nbsp;algorithm&nbsp;but&nbsp;merely&lt;br&gt;&gt;&nbsp;trying&nbsp;to&nbsp;explain&nbsp;what&nbsp;is&nbsp;making&nbsp;the&nbsp;big&nbsp;difference.&nbsp;Or&nbsp;did&nbsp;I&nbsp;make&nbsp;a&nbsp;mistake&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;translating&nbsp;the&nbsp;Objective-C&nbsp;code&nbsp;to&nbsp;MonoTouch?&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;Here&#39;s&nbsp;the&nbsp;C#&nbsp;code&nbsp;that&nbsp;does&nbsp;the&nbsp;work,&nbsp;I&nbsp;tried&nbsp;to&nbsp;stay&nbsp;as&nbsp;close&nbsp;as&nbsp;possible&lt;br&gt;&gt;&nbsp;to&nbsp;the&nbsp;Objective-C&nbsp;implementation&nbsp;of&nbsp;the&nbsp;view&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://github.com/ddeville/Mandelbrot-set-on-iPhone/blob/master/Classes/MandelbrotView.m&quot;&gt;https://github.com/ddeville/Mandelbrot-set-on-iPhone/blob/master/Classes/MandelbrotView.m&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;(link)&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; [Register(&quot;MandelbrotView&quot;)]&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; public&nbsp;class&nbsp;MandelbrotView:&nbsp;UIView&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private&nbsp;const&nbsp;int&nbsp;MANDELBROT_STEPS&nbsp;=&nbsp;50;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public&nbsp;MandelbrotView&nbsp;()&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Initialize();&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public&nbsp;MandelbrotView(IntPtr&nbsp;handle):&nbsp;base&nbsp;(handle)&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Initialize();&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; public&nbsp;override&nbsp;void&nbsp;Draw&nbsp;(System.Drawing.RectangleF&nbsp;rect)&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DateTime&nbsp;reference&nbsp;=&nbsp;DateTime.Now;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;get&nbsp;an&nbsp;image&nbsp;representation&nbsp;of&nbsp;the&nbsp;bitmap&nbsp;context&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var&nbsp;image&nbsp;=&nbsp;_bitmapContext.ToImage();&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;draw&nbsp;the&nbsp;image&nbsp;in&nbsp;the&nbsp;current&nbsp;context&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var&nbsp;context&nbsp;=&nbsp;UIGraphics.GetCurrentContext();&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; context.DrawImage(rect,&nbsp;image);&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;release&nbsp;the&nbsp;image&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.Dispose();&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Console.WriteLine(&quot;draw&nbsp;rect&nbsp;duration&nbsp;=&nbsp;{0}&quot;,&nbsp;(DateTime.Now&nbsp;-&lt;br&gt;<br>
&gt;&nbsp;reference).TotalMilliseconds&nbsp;/&nbsp;1000);&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private&nbsp;CGBitmapContext&nbsp;_bitmapContext;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private&nbsp;void&nbsp;Initialize&nbsp;()&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Console.WriteLine(&quot;MonoTouch&nbsp;Mandelbrot&nbsp;implementation&quot;);&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var&nbsp;reference&nbsp;=&nbsp;DateTime.Now;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;instantiate&nbsp;the&nbsp;bitmap&nbsp;context&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _bitmapContext&nbsp;=&nbsp;CreateCustomBitmapContextWithSize(new&nbsp;SizeF(480.0f,&lt;br&gt;&gt;&nbsp;320.0f));&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Console.WriteLine(&quot;bitmap&nbsp;context&nbsp;creation&nbsp;duration&nbsp;=&nbsp;{0}&quot;,&nbsp;(DateTime.Now&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;reference).TotalMilliseconds&nbsp;/&nbsp;1000);&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reference&nbsp;=&nbsp;DateTime.Now;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;draw&nbsp;the&nbsp;Mandelbrot&nbsp;Set&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var&nbsp;center&nbsp;=&nbsp; new&nbsp;PointF(this.Center.Y,&nbsp;this.Center.X);&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DrawMandelbrot(center,&nbsp;1);&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Console.WriteLine(&quot;drawing&nbsp;mandelbrot&nbsp;in&nbsp;bitmap&nbsp;duration&nbsp;=&nbsp;{0}&quot;,&lt;br&gt;&gt;&nbsp;(DateTime.Now&nbsp;-&nbsp;reference).TotalMilliseconds&nbsp;/&nbsp;1000);&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private&nbsp;CGBitmapContext&nbsp;CreateCustomBitmapContextWithSize(SizeF&nbsp;size)&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CGBitmapContext&nbsp;context&nbsp;=&nbsp;null&nbsp;;&lt;br&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var&nbsp;bitmapBytesPerRow&nbsp;=&nbsp;(size.Width&nbsp;*&nbsp;4)&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bitmapBytesPerRow&nbsp;+=&nbsp;(16&nbsp;-&nbsp;bitmapBytesPerRow%16)%16&nbsp;;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var&nbsp;bitmapByteCount&nbsp;=&nbsp;(bitmapBytesPerRow&nbsp;*&nbsp;size.Height)&nbsp;;&lt;br&gt;<br>
&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CGColorSpace&nbsp;colorSpace&nbsp;=&nbsp;CGColorSpace.CreateDeviceRGB();&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var&nbsp;bitmapData&nbsp;=&nbsp;new&nbsp;byte[(int)&nbsp;bitmapByteCount];&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; context&nbsp;=&nbsp;new&nbsp;CGBitmapContext(bitmapData,&nbsp;(int)&nbsp;size.Width,&nbsp;(int)&lt;br&gt;<br>
&gt;&nbsp;size.Height,&nbsp;8,&nbsp;(int)&nbsp;bitmapBytesPerRow,&nbsp;colorSpace,&lt;br&gt;&gt;&nbsp;CGBitmapFlags.PremultipliedLast);&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;(context&nbsp;==&nbsp;null)&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bitmapData&nbsp;=&nbsp;null;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Console.WriteLine(&quot;Context&nbsp;not&nbsp;created!&quot;);&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;null;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;context;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private&nbsp;void&nbsp;DrawMandelbrot(PointF&nbsp;center,&nbsp;float&nbsp;zoom)&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _bitmapContext.SetAllowsAntialiasing(false);&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _bitmapContext.SetRGBFillColor(0.0f,&nbsp;0.0f,&nbsp;0.0f,&nbsp;1.0f);&lt;br&gt;<br>
&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;re;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;im;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;mapping&nbsp;the&nbsp;bounding&nbsp;box&nbsp;to&nbsp;pixels&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;zoom&nbsp;1&nbsp;has&nbsp;to&nbsp;be&nbsp;between&nbsp;-2&nbsp;and&nbsp;1&nbsp;and&nbsp;-1&nbsp;to&nbsp;1&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;any&nbsp;additional&nbsp;zoom&nbsp;divides&nbsp;these&nbsp;by&nbsp;the&nbsp;zoom&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;loop&nbsp;through&nbsp;every&nbsp;pixel&nbsp;of&nbsp;the&nbsp;frame...&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0&nbsp;;&nbsp;i&nbsp;&lt;&nbsp;480&nbsp;;&nbsp;i++)&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;j&nbsp;=&nbsp;0&nbsp;;&nbsp;j&nbsp;&lt;&nbsp;320&nbsp;;&nbsp;j++)&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; re&nbsp;=&nbsp;(((float)i&nbsp;-&nbsp;1.33f&nbsp;*&nbsp;center.X)/160)&nbsp;;&nbsp; &nbsp; &nbsp; //&nbsp;-2&nbsp;to&nbsp;1&nbsp; &nbsp; &nbsp; -&nbsp; &nbsp; &nbsp; &nbsp;screen&nbsp;width&nbsp; =&lt;br&gt;<br>
&gt;&nbsp;480&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; im&nbsp;=&nbsp;(((float)j&nbsp;-&nbsp;1.00f&nbsp;*&nbsp;center.Y)/160)&nbsp;;&nbsp; &nbsp; &nbsp; //&nbsp;-1&nbsp;to&nbsp;1&nbsp; &nbsp; &nbsp; -&nbsp; &nbsp; &nbsp; &nbsp;screen&nbsp;height&nbsp;=&lt;br&gt;&gt;&nbsp;320&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; re&nbsp;/=&nbsp;zoom&nbsp;;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; im&nbsp;/=&nbsp;zoom&nbsp;;&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;(IsInMandelbrotSet(re,&nbsp;im))&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _bitmapContext.FillRect(new&nbsp;RectangleF(i,&nbsp;j,&nbsp;1.0f,&nbsp;1.0f));&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; private&nbsp;bool&nbsp;IsInMandelbrotSet(float&nbsp;re,&nbsp;float&nbsp;im)&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;x&nbsp;=&nbsp;0&nbsp;;&nbsp; &nbsp;float&nbsp;nx&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;y&nbsp;=&nbsp;0&nbsp;;&nbsp; &nbsp;float&nbsp;ny&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool&nbsp;fl&nbsp;=&nbsp;true;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(int&nbsp;i&nbsp;=&nbsp;0&nbsp;;&nbsp;i&nbsp;&lt;&nbsp;MANDELBROT_STEPS&nbsp;;&nbsp;i++)&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;We&nbsp;calculate&nbsp;the&nbsp;real&nbsp;part&nbsp;of&nbsp;the&nbsp;sequence&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nx&nbsp;=&nbsp;x*x&nbsp;-&nbsp;y*y&nbsp;+&nbsp;re&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;We&nbsp;calculate&nbsp;the&nbsp;imaginary&nbsp;part&nbsp;of&nbsp;the&nbsp;sequence&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ny&nbsp;=&nbsp;2*x*y&nbsp;+&nbsp;im&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;We&nbsp;compute&nbsp;the&nbsp;magnitude&nbsp;at&nbsp;each&nbsp;step&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;We&nbsp;check&nbsp;if&nbsp;it&#39;s&nbsp;greater&nbsp;than&nbsp;2&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if((nx*nx&nbsp;+&nbsp;ny*ny)&nbsp;&gt;&nbsp;4)&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fl&nbsp;=&nbsp;false&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x&nbsp;=&nbsp;nx&nbsp;;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y&nbsp;=&nbsp;ny&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;fl&nbsp;;&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;Thanks,&nbsp;Roy&lt;br&gt;&gt;&lt;br&gt;&gt;&nbsp;--&lt;br&gt;<br>
&gt;&nbsp;View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://monotouch.2284126.n4.nabble.com/Why-is-the-MonoTouch-version-of-this-Mandelbrot-Set-test-2-8-times-slower-tp4389869p4389869.html&quot;&gt;http://monotouch.2284126.n4.nabble.com/Why-is-the-MonoTouch-version-of-this-Mandelbrot-Set-test-2-8-times-slower-tp4389869p4389869.html&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;Sent&nbsp;from&nbsp;the&nbsp;MonoTouch&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;&gt;&nbsp;MonoTouch&nbsp;mailing&nbsp;list&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:MonoTouch@lists.ximian.com&quot;&gt;MonoTouch@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/monotouch&quot;&gt;http://lists.ximian.com/mailman/listinfo/monotouch&lt;/a&gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
