<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] When to implement Foo(IntPtr) constructors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20When%20to%20implement%20Foo%28IntPtr%29%20constructors&In-Reply-To=%3CCANfFwGTAetAVp6E0fuOQyNDG5YXbPTOwKCa7yrz9JMsnP0XVmA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010981.html">
   <LINK REL="Next"  HREF="010996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] When to implement Foo(IntPtr) constructors</H1>
    <B>Nic Wise</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20When%20to%20implement%20Foo%28IntPtr%29%20constructors&In-Reply-To=%3CCANfFwGTAetAVp6E0fuOQyNDG5YXbPTOwKCa7yrz9JMsnP0XVmA%40mail.gmail.com%3E"
       TITLE="[MonoTouch] When to implement Foo(IntPtr) constructors">nicw at fastchicken.co.nz
       </A><BR>
    <I>Mon Jul 30 21:05:54 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010981.html">[MonoTouch] When to implement Foo(IntPtr) constructors
</A></li>
        <LI>Next message: <A HREF="010996.html">[MonoTouch] When to implement Foo(IntPtr) constructors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10983">[ date ]</a>
              <a href="thread.html#10983">[ thread ]</a>
              <a href="subject.html#10983">[ subject ]</a>
              <a href="author.html#10983">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Adam

If you have a reproducible case, make a bugzilla bug with it
(bugzilla.xamarin.com) and email <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">support at xamarin</A> with a reference to
it. They can then assign it to the right person to have a look at.

Thanks

Nic



On Mon, Jul 30, 2012 at 2:26 PM, Adam Kemp &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">adam.kemp at ni.com</A>&gt; wrote:
&gt;<i> Thanks for the response, Nic. That explanation makes sense to me, but it
</I>&gt;<i> doesn't really answer why in this particular case the MonoTouch runtime
</I>&gt;<i> wants to resurrect the managed object. I am in fact releasing my last
</I>&gt;<i> reference to that object, but that is because I really am completely done
</I>&gt;<i> with it. It should actually be leaving memory. That is, when that managed
</I>&gt;<i> reference goes away the unmanaged reference should leave memory as well.
</I>&gt;<i>
</I>&gt;<i> What's happening in this case is that the UIViewController base class
</I>&gt;<i> subscribes to a notification for low memory warnings. I am releasing my
</I>&gt;<i> last managed reference to this view controller in my own handler for low
</I>&gt;<i> memory warnings (in a different view controller), but something (perhaps
</I>&gt;<i> an autorelease call?) is keeping the view controller I want to go away to
</I>&gt;<i> stay in memory long enough to want to handle that low memory notification.
</I>&gt;<i> This is the behavior that I can reproduce in a test project. However, in
</I>&gt;<i> my test project I can only get it to reproduce if I override ViewDidUnload
</I>&gt;<i> or DidReceiveMemoryWarning in the view controller that I want to go away.
</I>&gt;<i> In my real project I didn't implement either one of those, and yet it is
</I>&gt;<i> being resurrected anyway. As I said, the only method I override in this
</I>&gt;<i> view controller class is ViewDidLoad, and that method is not being called.
</I>&gt;<i> Why would the runtime try to reconstruct the managed object if it's not
</I>&gt;<i> needed by anything? If I could get some kind of hint in the debugger about
</I>&gt;<i> why it's being reconstructed then that would help.
</I>&gt;<i>
</I>&gt;<i> My main concern is that in this case if I can't release the reference to
</I>&gt;<i> this view controller here then I'm not sure where I could safely release
</I>&gt;<i> it. The view controller is no longer on screen. It shouldn't be referenced
</I>&gt;<i> by anything else. There's no reason I can think of that it shouldn't be
</I>&gt;<i> safe to allow it to leave memory at this point. I'd like to get to the
</I>&gt;<i> bottom of why it is being resurrected.
</I>&gt;<i> --
</I>&gt;<i> Adam Kemp
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">adam.kemp at ni.com</A>
</I>&gt;<i> (512) 683-6058
</I>&gt;<i>
</I>&gt;<i> Nic Wise &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">nicw at fastchicken.co.nz</A>&gt; wrote on 07/30/2012 01:01:26 PM:
</I>&gt;<i>
</I>&gt;&gt;<i> From: Nic Wise &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">nicw at fastchicken.co.nz</A>&gt;
</I>&gt;&gt;<i> To: Adam Kemp &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">adam.kemp at ni.com</A>&gt;
</I>&gt;&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">monotouch at lists.ximian.com</A>, Sebastien Pouliot
</I>&gt;&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">sebastien at xamarin.com</A>&gt;, Rolf Bjarne Kvinge &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">rolf at xamarin.com</A>&gt;
</I>&gt;&gt;<i> Date: 07/30/2012 01:01 PM
</I>&gt;&gt;<i> Subject: Re: [MonoTouch] When to implement Foo(IntPtr) constructors
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi Adam
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You really need a reply from Rolf or Sebastian, but they are in Boston
</I>&gt;&gt;<i> at the moment at the (annual?) company meetup. I've CCed them, but I
</I>&gt;&gt;<i> dont know how much spare time they have this week.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So, just so this doesn't drop off the bottom of the list, this SO item
</I>&gt;&gt;<i> from Miguel explains it well:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://stackoverflow.com/questions/5623223/no-constructor-found-for-">http://stackoverflow.com/questions/5623223/no-constructor-found-for-</A>
</I>&gt;&gt;<i> viewcontroller-ctorsystem-intptr
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I suspect that it might be a case where you need to keep a reference
</I>&gt;&gt;<i> to the object in a class-local variable, rather than a method-local
</I>&gt;&gt;<i> one or just assigning it to a (obj-c?) object.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've never really implemented them, tho maybe I should :). I used to
</I>&gt;&gt;<i> have the same exceptions as this, but I've not seen it in live debug
</I>&gt;&gt;<i> logs for ages - it's possible that the GC got fixed (or improved)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Drop the list an email back if that doesn't answer your question
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Nic
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, Jul 27, 2012 at 8:10 PM, Adam Kemp &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">adam.kemp at ni.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; I'm hitting a crash when receiving memory warnings in some situations.
</I>&gt;<i> In
</I>&gt;&gt;<i> &gt; one view controller (A) we are handling the memory warning by calling
</I>&gt;&gt;<i> &gt; Dispose() on another view controller (B) which is no longer necessary.
</I>&gt;&gt;<i> &gt; Unfortunately, something later on during the process of the (native)
</I>&gt;&gt;<i> &gt; memory warning handling code is trying to call a method in view
</I>&gt;<i> controller
</I>&gt;&gt;<i> &gt; B, and it's trying to construct a managed object to do so. This causes
</I>&gt;<i> an
</I>&gt;&gt;<i> &gt; exception because I don't have a constructor which takes an IntPtr so
</I>&gt;<i> the
</I>&gt;&gt;<i> &gt; runtime can't construct the managed object.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I know that if implementing the IntPtr constructor the crash doesn't
</I>&gt;&gt;<i> &gt; occur. I also know that it goes away if I remove the call to Dispose,
</I>&gt;<i> but
</I>&gt;&gt;<i> &gt; I don't think that's a guaranteed fix since the object could still be
</I>&gt;&gt;<i> &gt; GCed. I'm looking for the &quot;right&quot; fix, but I have several unanswered
</I>&gt;&gt;<i> &gt; questions about what is going on that I need to find an answer to in
</I>&gt;<i> order
</I>&gt;&gt;<i> &gt; to find it.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; The first question is what method is being called on view controller
</I>&gt;<i> B,
</I>&gt;&gt;<i> &gt; and why is it wanting a managed object to call that method? I don't
</I>&gt;<i> have
</I>&gt;&gt;<i> &gt; an override for DidReceiveMemoryWarning or ViewDidUnload. In fact, the
</I>&gt;&gt;<i> &gt; only override in that view controller (which inherits directly from
</I>&gt;&gt;<i> &gt; UITableViewController) is ViewDidLoad. The exception tells me
</I>&gt;<i> &quot;Selector
</I>&gt;&gt;<i> &gt; invoked from objective-c on a managed object (0xB9E72D0) that has been
</I>&gt;&gt;<i> &gt; GC'ed&quot;, but it won't tell me which selector was invoked. In a simpler
</I>&gt;<i> test
</I>&gt;&gt;<i> &gt; case that I created I could only reproduce the crash if I overrode
</I>&gt;<i> either
</I>&gt;&gt;<i> &gt; DidReceiveMemoryWarning or ViewDidUnload, but in my full application I
</I>&gt;<i> get
</I>&gt;&gt;<i> &gt; the crash even though I haven't implemented either. I don't understand
</I>&gt;&gt;<i> &gt; why. Is there a trick to figuring out which method is being invoked
</I>&gt;<i> when
</I>&gt;&gt;<i> &gt; this exception occurs?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; The second question is what are the rules for when we are expected to
</I>&gt;&gt;<i> &gt; implement the IntPtr constructor for classes that inherit from
</I>&gt;<i> NSObject? I
</I>&gt;&gt;<i> &gt; don't want to blindly add it to every class, especially since in some
</I>&gt;&gt;<i> &gt; cases it probably can't be implemented in a sane way at all (the
</I>&gt;<i> Dispose
</I>&gt;&gt;<i> &gt; method might have released resources that you can't get back without
</I>&gt;&gt;<i> &gt; arguments from a real constructor). Is there some rule for this? Does
</I>&gt;<i> my
</I>&gt;&gt;<i> &gt; situation fit that rule?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Thanks.
</I>&gt;&gt;<i> &gt; --
</I>&gt;&gt;<i> &gt; Adam Kemp
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">adam.kemp at ni.com</A>
</I>&gt;&gt;<i> &gt; (512) 683-6058
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; MonoTouch mailing list
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at lists.ximian.com</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Nic Wise
</I>&gt;&gt;<i> t.  +44 7788 592 806 | @fastchicken | <A HREF="http://www.linkedin.com/in/nicwise">http://www.linkedin.com/in/nicwise</A>
</I>&gt;&gt;<i> b. <A HREF="http://www.fastchicken.co.nz/">http://www.fastchicken.co.nz/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> mobileAgent (for FreeAgent): get your accounts in your pocket.
</I>&gt;&gt;<i> <A HREF="http://goo.gl/IuBU">http://goo.gl/IuBU</A>
</I>&gt;&gt;<i> Trip Wallet: Keep track of your budget on the go: <A HREF="http://goo.gl/ePhKa">http://goo.gl/ePhKa</A>
</I>&gt;&gt;<i> Earnest: Self-employed? Track your business expenses and income.
</I>&gt;&gt;<i> <A HREF="http://earnestapp.com">http://earnestapp.com</A>
</I>&gt;&gt;<i> Nearest Bus: find when the next bus is coming to your stop. <A HREF="http://">http://</A>
</I>&gt;&gt;<i> goo.gl/Vcz1p
</I>&gt;&gt;<i> London Bike App: Find the nearest Boris Bike, and get riding!
</I>&gt;&gt;<i> <A HREF="http://goo.gl/Icp2">http://goo.gl/Icp2</A>
</I>&gt;<i>
</I>


-- 
Nic Wise
t.  +44 7788 592 806 | @fastchicken | <A HREF="http://www.linkedin.com/in/nicwise">http://www.linkedin.com/in/nicwise</A>
b. <A HREF="http://www.fastchicken.co.nz/">http://www.fastchicken.co.nz/</A>

mobileAgent (for FreeAgent): get your accounts in your pocket.
<A HREF="http://goo.gl/IuBU">http://goo.gl/IuBU</A>
Trip Wallet: Keep track of your budget on the go: <A HREF="http://goo.gl/ePhKa">http://goo.gl/ePhKa</A>
Earnest: Self-employed? Track your business expenses and income.
<A HREF="http://earnestapp.com">http://earnestapp.com</A>
Nearest Bus: find when the next bus is coming to your stop. <A HREF="http://goo.gl/Vcz1p">http://goo.gl/Vcz1p</A>
London Bike App: Find the nearest Boris Bike, and get riding! <A HREF="http://goo.gl/Icp2">http://goo.gl/Icp2</A>
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010981.html">[MonoTouch] When to implement Foo(IntPtr) constructors
</A></li>
	<LI>Next message: <A HREF="010996.html">[MonoTouch] When to implement Foo(IntPtr) constructors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10983">[ date ]</a>
              <a href="thread.html#10983">[ thread ]</a>
              <a href="subject.html#10983">[ subject ]</a>
              <a href="author.html#10983">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
