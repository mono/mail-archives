<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] Correct way to cache and restore a UIViewController
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Correct%20way%20to%20cache%20and%20restore%20a%20UIViewController&In-Reply-To=%3C1340289138483-4655521.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010247.html">
   <LINK REL="Next"  HREF="010248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] Correct way to cache and restore a UIViewController</H1>
    <B>victoria</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20Correct%20way%20to%20cache%20and%20restore%20a%20UIViewController&In-Reply-To=%3C1340289138483-4655521.post%40n4.nabble.com%3E"
       TITLE="[MonoTouch] Correct way to cache and restore a UIViewController">iminurbase at hotmail.com
       </A><BR>
    <I>Thu Jun 21 14:32:18 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010247.html">[MonoTouch] Correct way to cache and restore a UIViewController
</A></li>
        <LI>Next message: <A HREF="010248.html">[MonoTouch] ERROR Build as Release &lt;smiley image=&quot;smiley_argh.gif&quot;/&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10253">[ date ]</a>
              <a href="thread.html#10253">[ thread ]</a>
              <a href="subject.html#10253">[ subject ]</a>
              <a href="author.html#10253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Tomasz Cielecki wrote
&gt;<i> 
</I>&gt;<i> I guess this should work, but mind that your app might run out of
</I>&gt;<i> memory if you cache a lot of views in the memory. Also keep in mind
</I>&gt;<i> that while the application is in suspended mode iOS may purge the
</I>&gt;<i> memory of the application and you will have to reload the views
</I>&gt;<i> anyways.
</I>&gt;<i> 
</I>
Ah, well aware of that! I simplified it a little bit, in reality the cache
Get method works something like this

public static T Get&lt;T&gt;() where T : class, new()
{
    string key = typeof(T).ToString();
    T data = null;

    if (CachedViews.ContainsKey(key))
        data = CachedViews[key] as T;
    
    if (data == null)  // not in cache or eaten by a grue
   {
       data = new T();
       CachedViews[key] = data;
   }

   return data;
}

so...
var controller = ViewControllerCache.Get&lt;MyFantasticView&gt;();

...would give me MyFantasticView if it's in the cache, or a new instance if
it's not. And that made me feel very smart for a few minutes. It all starts
to fall apart if I save a viewcontroller in the cache and then push it onto
the navigator later, deeper down the navigation hierarchy. 


Tomasz Cielecki wrote
&gt;<i> 
</I>&gt;<i> The normal approach is as you said yourself to create the view when
</I>&gt;<i> needed and dispose of it when it is not needed anymore. I am not sure
</I>&gt;<i> what the time consuming part of your views are, but usually my views
</I>&gt;<i> load instantly and the loading of the data to be put into the views is
</I>&gt;<i> what consumes most of the time.
</I>&gt;<i> 
</I>&gt;<i> So maybe a better approach to this could be to save the state of the
</I>&gt;<i> data in the view rather than the view itself. If it is really the view
</I>&gt;<i> that is taking that much time to load, then try to see if it can be
</I>&gt;<i> optimized.
</I>&gt;<i> 
</I>
Hmm, that's an idea worth exploring. For some reason I can't quite get the
profiling tools to work so I'm stuck with adding stopwatches here and there,
making it somewhat tricky to figure out what's really slowing down the
transitions. And it's not like it's unbearable, but having just a single
second delay between views really make the whole experience so much worse.

Xamarin people: Please give us a guide on how to best optimize our apps ;-)



On Thu, Jun 21, 2012 at 1:11 PM, victoria &lt;iminurbase@&gt; wrote:
&gt;<i> Dear list,
</I>&gt;<i>
</I>&gt;<i> Short version: What's the correct way to load a UIViewController when the
</I>&gt;<i> application starts, and then restore it (much) later?
</I>&gt;<i>
</I>&gt;<i> *
</I>&gt;<i>
</I>&gt;<i> I found creating UIViewControllers with somewhat complex Views to be a
</I>&gt;<i> fairly expensive operation, so instead of just creating and pushing them
</I>&gt;<i> onto the Navigator when needed, I had the idea to load all heavy views
</I>&gt;<i> into
</I>&gt;<i> a simple object cache when the app starts (with a nice loading screen),
</I>&gt;<i> and
</I>&gt;<i> then push/pop them at will while keeping them in memory. It works
</I>&gt;<i> something
</I>&gt;<i> like this:
</I>&gt;<i>
</I>&gt;<i> 1 AppStartUp
</I>&gt;<i> |--- cache[&quot;finalView&quot;] = new ComplexViewController();
</I>&gt;<i> |--- push Menu A onto the navigator
</I>&gt;<i> |
</I>&gt;<i> 2 Menu A Controller
</I>&gt;<i> | --- user makes some kind of selection
</I>&gt;<i> | --- (cache[&quot;finalView&quot;] as
</I>&gt;<i> ComplexViewController).UpdateViewWithSelectionFromMenuA()
</I>&gt;<i> |--- &#160;push Menu B onto the navigator
</I>&gt;<i> |
</I>&gt;<i> 3 Menu B Controller
</I>&gt;<i> | --- user makes some kind of selection
</I>&gt;<i> | --- (cache[&quot;finalView&quot;] as
</I>&gt;<i> ComplexViewController).UpdateViewWithSelectionFromMenuB()
</I>&gt;<i> |--- &#160;push cache[&quot;finalView&quot;] onto the navigator
</I>&gt;<i> |
</I>&gt;<i> 4 ComplexViewController
</I>&gt;<i> | --- OMG Ponies!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This method at first seemed to work great, and made the transition between
</I>&gt;<i> Menu B and ComplexViewController *a lot* smoother. However, things started
</I>&gt;<i> to fall apart recently with stuff going missing from the views in the
</I>&gt;<i> cache.
</I>&gt;<i> So, I started adding lots of SetNeedsDisplay() in their ViewWillAppear
</I>&gt;<i> methods, and this somewhat worked - except for UITables. And some custom
</I>&gt;<i> controls. I'm fairly certain I've gone down the wrong path here, so are
</I>&gt;<i> there any best practices for doing what I'm trying to accomplish?
</I>&gt;<i>
</I>&gt;<i> Any help or hints would be much appreciated!
</I>&gt;<i>
</I>&gt;<i> / V
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://monotouch.2284126.n4.nabble.com/Correct-way-to-cache-and-restore-a-UIViewController-tp4655514.html">http://monotouch.2284126.n4.nabble.com/Correct-way-to-cache-and-restore-a-UIViewController-tp4655514.html</A>
</I>&gt;<i> Sent from the MonoTouch mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> MonoTouch mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at .ximian</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>
</I>


-- 
Med Venlig Hilsen / With Best Regards
Tomasz Cielecki
<A HREF="http://ostebaronen.dk">http://ostebaronen.dk</A>
_______________________________________________
MonoTouch mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">MonoTouch at .ximian</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/monotouch">http://lists.ximian.com/mailman/listinfo/monotouch</A>



--
View this message in context: <A HREF="http://monotouch.2284126.n4.nabble.com/Correct-way-to-cache-and-restore-a-UIViewController-tp4655514p4655521.html">http://monotouch.2284126.n4.nabble.com/Correct-way-to-cache-and-restore-a-UIViewController-tp4655514p4655521.html</A>
Sent from the MonoTouch mailing list archive at Nabble.com.
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010247.html">[MonoTouch] Correct way to cache and restore a UIViewController
</A></li>
	<LI>Next message: <A HREF="010248.html">[MonoTouch] ERROR Build as Release &lt;smiley image=&quot;smiley_argh.gif&quot;/&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10253">[ date ]</a>
              <a href="thread.html#10253">[ thread ]</a>
              <a href="subject.html#10253">[ subject ]</a>
              <a href="author.html#10253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
