<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoTouch] MonoTouch with Sqlite Critical Scenario Help Needed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20MonoTouch%20with%20Sqlite%20Critical%20Scenario%20Help%20Needed&In-Reply-To=%3C1340948721506-4655652.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010388.html">
   <LINK REL="Next"  HREF="010425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoTouch] MonoTouch with Sqlite Critical Scenario Help Needed</H1>
    <B>proindigo</B> 
    <A HREF="mailto:monotouch%40lists.ximian.com?Subject=Re%3A%20%5BMonoTouch%5D%20MonoTouch%20with%20Sqlite%20Critical%20Scenario%20Help%20Needed&In-Reply-To=%3C1340948721506-4655652.post%40n4.nabble.com%3E"
       TITLE="[MonoTouch] MonoTouch with Sqlite Critical Scenario Help Needed">pro_indigo at live.com
       </A><BR>
    <I>Fri Jun 29 05:45:21 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010388.html">[MonoTouch] MonoTouch with Sqlite Critical Scenario Help Needed
</A></li>
        <LI>Next message: <A HREF="010425.html">[MonoTouch] MonoTouch with Sqlite Critical Scenario Help Needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10422">[ date ]</a>
              <a href="thread.html#10422">[ thread ]</a>
              <a href="subject.html#10422">[ subject ]</a>
              <a href="author.html#10422">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well just incorporate some checking logic so that the spurious file creation
can be prevented. Working fine now. App. is checking if the directory and
file pre-exists and if not, proceeds to create them. But I am having issues
inserting data into table. The exception I am getting is --&gt; No connection
associated with this command. . First let me post the code block for
DBHandler.cs. Here is the code block.

using System;
using System.IO;
using System.Drawing;
using System.Data;
using Mono.Data.Tds;
using Mono.Data.Sqlite;
using System.Xml;
using System.Xml.XPath;
using System.Xml.Linq;
using System.Linq;
using System.Linq.Expressions;
using MonoTouch.Foundation;
using MonoTouch.UIKit;

namespace ASTONAPP
{
	public class DBHandler
	{
		SqliteConnection sconn;
		SqliteCommand scmd;
		string pathtowrite;
		string filepath;
		string dirName;
		string dbFile;
		string db;
		string dbConn;
		public DBHandler ()
		{
		}

		public void SetDBConstants ()
		{
			pathtowrite = System.Environment.GetFolderPath
(System.Environment.SpecialFolder.Personal);
			dirName = Path.Combine (pathtowrite, &quot;ASTON Repository&quot;);
			filepath=Path.Combine (dirName, &quot;BLL_User.xml&quot;);
			dbFile = &quot;ASTON_DB_V1.db3&quot;;
			db = Path.Combine (dirName, dbFile);
			dbConn = String.Format (&quot;Data Source={0}&quot;, db);
			sconn=new SqliteConnection();
			scmd=new SqliteCommand();

		}
		
		public void CreateDBConnection ()
		{
			try 
			{
				this.SetDBConstants ();
				bool flag1=Directory.Exists (dirName);
				bool flag2=File.Exists (db);
				if(flag1)
				{
					if(flag2)
					{
						return;
					}
					else
					{
						SqliteConnection.CreateFile (db);
					}
				}
				else
				{
					Directory.CreateDirectory (dirName);
					SqliteConnection.CreateFile (db);
				}
				sconn.Open ();
			}  
			catch (Exception exp) 
			{
				throw exp;
			}
		}

		public void CloseDBConnection ()
		{
			sconn.Close ();
		}
		public void InitializeDatabase()
		{

			this.CreateDBConnection ();
		}


		public void InitializeClientData ()
		{
			try 
			{
				this.CreateDBConnection();
				XmlDocument xmldoc = new XmlDocument ();
				xmldoc.Load (filepath);
				XmlNamespaceManager nmsmgr = new XmlNamespaceManager (xmldoc.NameTable);
				nmsmgr.AddNamespace (&quot;nmspc&quot;, &quot;<A HREF="http://tempuri.org/">http://tempuri.org/</A>&quot;);
				XmlNode xmlnl1 = xmldoc.SelectSingleNode (&quot;//nmspc:ClientUserID&quot;,
nmsmgr);
				XmlNode xmlnl2 = xmldoc.SelectSingleNode (&quot;//nmspc:UserName&quot;, nmsmgr);
				XmlNode xmlnl3 = xmldoc.SelectSingleNode (&quot;//nmspc:DiyCode&quot;, nmsmgr);
				XmlNode xmlnl4 = xmldoc.SelectSingleNode (&quot;//nmspc:DiyPassword&quot;,
nmsmgr);
				XmlNode xmlnl5 = xmldoc.SelectSingleNode (&quot;//nmspc:Address&quot;, nmsmgr);
				XmlNode xmlnl6 = xmldoc.SelectSingleNode (&quot;//nmspc:City&quot;, nmsmgr);
				XmlNode xmlnl7 = xmldoc.SelectSingleNode (&quot;//nmspc:State&quot;, nmsmgr);
				XmlNode xmlnl8 = xmldoc.SelectSingleNode (&quot;//nmspc:Country&quot;, nmsmgr);
				XmlNode xmlnl9 = xmldoc.SelectSingleNode (&quot;//nmspc:PostCode&quot;, nmsmgr);
				XmlNode xmlnl10 = xmldoc.SelectSingleNode (&quot;//nmspc:Email&quot;, nmsmgr);
				XmlNode xmlnl11 = xmldoc.SelectSingleNode (&quot;//nmspc:Phone1&quot;, nmsmgr);
				XmlNode xmlnl12 = xmldoc.SelectSingleNode (&quot;//nmspc:Phone2&quot;, nmsmgr);
				XmlNode xmlnl13 = xmldoc.SelectSingleNode (&quot;//nmspc:IsAssessor&quot;,
nmsmgr);
				XmlNode xmlnl14 = xmldoc.SelectSingleNode (&quot;//nmspc:ClientID&quot;, nmsmgr);
				XmlNode xmlnl15 = xmldoc.SelectSingleNode (&quot;//nmspc:ModifiedBy&quot;,
nmsmgr);
				XmlNode xmlnl16 = xmldoc.SelectSingleNode (&quot;//nmspc:CreatedBy&quot;, nmsmgr);
				XmlNode xmlnl17 = xmldoc.SelectSingleNode (&quot;//nmspc:IsDeleted&quot;, nmsmgr);
				int ClientUserId = Convert.ToInt32 (xmlnl1.InnerText.ToString ());
				string UserName = xmlnl2.InnerText.ToString ();
				string DiyCode = xmlnl3.InnerText.ToString ();
				string DiyPassword = xmlnl4.InnerText.ToString ();
				string Address = xmlnl5.InnerText.ToString ();
				string City = xmlnl6.InnerText.ToString ();
				string State = xmlnl7.InnerText.ToString ();
				string Country = xmlnl8.InnerText.ToString ();
				string PostCode = xmlnl9.InnerText.ToString ();
				string Email = xmlnl10.InnerText.ToString ();
				string Phone1 = xmlnl11.InnerText.ToString ();
				string Phone2 = xmlnl12.InnerText.ToString ();
				string IsAssessor = xmlnl13.InnerText.ToString ();
				int ClientID = Convert.ToInt32 (xmlnl14.InnerText.ToString ());
				int ModifiedBy = Convert.ToInt32 (xmlnl15.InnerText.ToString ());
				int CreatedBy = Convert.ToInt32 (xmlnl16.InnerText.ToString ());
				string IsAdmin = xmlnl17.InnerText.ToString ();
				string[] sql1 = new string[]{&quot;CREATE  TABLE  IF NOT EXISTS
ClientInfo('ClientOfflineID' INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL ,
&quot; +
					&quot;'ClientUserID' INTEGER, 'UserName' TEXT, 'DiyCode' TEXT, 'DiyPassword'
TEXT, 'Address' TEXT, 'City' TEXT, 'State' TEXT, 'Country' TEXT, &quot; +
					&quot;'PostCode' TEXT, 'Email' TEXT, 'Phone1' TEXT, 'Phone2' TEXT,
'IsAssessor' TEXT, 'ClientID' INTEGER, 'ModifiedBy' TEXT, 'CreatedBy' TEXT,
'IsAdmin' TEXT)&quot;,
				String.Format (&quot;insert into ClientInfo(ClientUserID, UserName, DiyCode,
DiyPassword, Address, City, State, &quot; +
					&quot;Country, PostCode, Email, Phone1, Phone2, IsAssessor, ClientID,
ModifiedBy, CreatedBy, IsAdmin) &quot; +
					&quot;values('{0}', '{1}', '{2}', '{3}', '{4}', '{5}', '{6}', '{7}', '{8}',
'{9}', '{10}', '{11}', '{12}', '{13}', &quot; +
					&quot;'{14}', '{15}', '{16}')&quot;, ClientUserId, UserName, DiyCode,
DiyPassword, Address, City, State, Country, 
							               PostCode, Email, Phone1, Phone2, IsAssessor, ClientID,
ModifiedBy, CreatedBy, IsAdmin)
			} ;
				foreach (string s in sql1) 
				{
					using (var c=sconn.CreateCommand ()) 
					{
						scmd.CommandText = s;
						scmd.CommandType = CommandType.Text;
						scmd.ExecuteNonQuery ();
						this.CloseDBConnection ();
					}
					UIAlertView uv=new UIAlertView(&quot;Notification&quot;, &quot;Client Data Inserted
Successfully&quot;, null, &quot;OK&quot;, null);
					uv.Show ();
				
				}
				UIAlertView uav=new UIAlertView(&quot;Notification&quot;, &quot;&quot;+ClientUserId.ToString
()+&quot;, &quot;+Email.ToString ()+&quot;, &quot;+UserName.ToString ()+&quot;,
&quot;+DiyPassword.ToString ()+&quot;&quot;, null, &quot;OK&quot;, null);
				uav.Show ();
			}
			catch(Exception exp)
			{
				UIAlertView uv=new UIAlertView(&quot;Notification&quot;, &quot;Unexpected Database
Error! &quot;+exp.GetBaseException ().ToString ()+&quot;&quot;, null, &quot;OK&quot;, null);
				uv.Show ();
			}
			//this.CloseDBConnection ();

		}
		public DataSet CheckForData (string strsql)
		{
			DataSet ds = new DataSet ();
			this.CreateDBConnection ();
			sconn.ConnectionString=dbConn;
			scmd.Connection=sconn;
			scmd.CommandText=strsql;
			scmd.CommandType=CommandType.Text;
			SqliteDataAdapter sda=new SqliteDataAdapter(scmd);
			sda.Fill (ds);
			this.CloseDBConnection ();
			return ds;


		}

	}
}

Now I am calling the function InitializeClientData like this --&gt;
objdbh.InitializeClientData(); where objdbh is an instance of DBHandler.cs.
But when I am using breakpoints I noticed that the debugger isn't entering
the block for InitializeClientData AT ALL!!! When I expanded the quick view
for the above line and expanded the sconn properties node, I found out that
ConnectionString =&quot;&quot; and DataSource=null.!!
Strange!! I understand there must be some loophole in the coding logic that
I am using, but I can't seem to pinpoint it. It may be that the code is
facing ambiguity due to multiple connection objects with same name and as
such throwing an exception.

Look forward to receiving some help on this.

Many Thanks.




--
View this message in context: <A HREF="http://monotouch.2284126.n4.nabble.com/MonoTouch-with-Sqlite-Critical-Scenario-Help-Needed-tp4655574p4655652.html">http://monotouch.2284126.n4.nabble.com/MonoTouch-with-Sqlite-Critical-Scenario-Help-Needed-tp4655574p4655652.html</A>
Sent from the MonoTouch mailing list archive at Nabble.com.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010388.html">[MonoTouch] MonoTouch with Sqlite Critical Scenario Help Needed
</A></li>
	<LI>Next message: <A HREF="010425.html">[MonoTouch] MonoTouch with Sqlite Critical Scenario Help Needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10422">[ date ]</a>
              <a href="thread.html#10422">[ thread ]</a>
              <a href="subject.html#10422">[ subject ]</a>
              <a href="author.html#10422">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monotouch">More information about the MonoTouch
mailing list</a><br>
</body></html>
