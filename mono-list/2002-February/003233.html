<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] RE: System.TimeZone
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:AjayKumar.Dwivedi%40dresdner-bank.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003242.html">
   <LINK REL="Next"  HREF="003237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] RE: System.TimeZone
   </H1>
    <B>Dwivedi , Ajay Kumar
    </B> 
    <A HREF="mailto:AjayKumar.Dwivedi%40dresdner-bank.com"
       TITLE="[Mono-list] RE: System.TimeZone">AjayKumar.Dwivedi@dresdner-bank.com
       </A><BR>
    <I>Sun, 17 Feb 2002 10:58:40 -0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="003242.html">[Mono-list] Convert.ToInt16 (string value, int fromBase) and
 friends
</A></li>
        <LI> Next message: <A HREF="003237.html">[Mono-list] RE: System.TimeZone
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3233">[ date ]</a>
              <a href="thread.html#3233">[ thread ]</a>
              <a href="subject.html#3233">[ subject ]</a>
              <a href="author.html#3233">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_000_01C1B7A2.0E94C3E0
Content-Type: text/plain


&gt;<i> I've been reading this portion of your patch for the past few days
</I>&gt;<i> trying to understand it. There must something that I'm not 
</I>&gt;<i> understanding
</I>&gt;<i> -- why does which hemisphere matter here? If timezone X in the north
</I>&gt;<i> starts DST from November to March, and April to August in the south,
</I>&gt;<i> then wouldn't the DaylightTime TimeSpan be different? 
</I>
	Precisely. Both the DaylightTime will be different. But the problem
lies with the fact that DaylightTime corresponds to a given year (for
example
we call GetDaylightChanges (int year)). So both Start and End of
DaylightTime
are in the same year. The following example makes it clear:

	TimeZone tz = TimeZone.CurrentTimeZone;
	System.Console.WriteLine(&quot;DAYLIGHT NAME : &quot;+ tz.DaylightName);
	DaylightTime dt = tz.GetDaylightChanges(2002);
	System.Console.WriteLine(&quot;START : &quot;+ dt.Start);
	System.Console.WriteLine(&quot;END   : &quot;+ dt.End);

The sample results for 3 different TimeZones are:
1. No Daylight Saving:
	DAYLIGHT NAME : India Standard Time
	START : 01/01/0001 00:00:00
	END   : 01/01/0001 00:00:00
2. Northern Hemisphere
	DAYLIGHT NAME : Vladivostok Daylight Time
	START : 31/03/2002 02:00:00
	END   : 27/10/2002 03:00:00
3. Southern Hemisphere
	DAYLIGHT NAME : New Zealand Daylight Time
	START : 06/10/2002 02:00:00
	END   : 17/03/2002 02:00:00

	Note that for the Northern Hemisphere, START &lt; END
while START &gt; END for the Southern Hemisphere. This is because
the DST period is Oct to Mar in South. So DST ends in March
and Starts in October.

&gt;<i>Why do these following checks here:
</I>&gt;<i> 
</I>&gt;<i>     if (daylightTimes.Start.Ticks &lt; time.Ticks &amp;&amp; 
</I>&gt;<i>         daylightTimes.End.Ticks &gt; time.Ticks)
</I>&gt;<i>     
</I>&gt;<i>     if (daylightTimes.Start.Ticks &gt; daylightTimes.End.Ticks)
</I>&gt;<i> 
</I>	As explained above, time falls in DST if it lies between
Start and End when End &gt; Start, and if it falls outside End and Start
when Start &gt; End.

&gt;<i> I would think this is the responsibility of the internal 
</I>&gt;<i> CurrentTimeZone
</I>&gt;<i> class to return &quot;correct&quot; TimeSpans? (actually, this might be quite
</I>&gt;<i> difficult...)
</I>
	The DaylightTime is defined as &quot;period during the year when the time
is 
advanced, usually by an hour, to take advantage of the extended daylight
hours&quot;
	Thus DaylightTime cannot start with say Oct 2001 and End in March
2002.
ie it can't span across years.

&gt;<i> There's also a check for:
</I>&gt;<i> 
</I>&gt;<i>     if (time.Year == daylightTimes.Start.Year &amp;&amp; 
</I>&gt;<i>         time.Year == daylightTimes.End.Year)
</I>&gt;<i>     
</I>&gt;<i> At first, I thought this should be a good check, but then it 
</I>&gt;<i> seems like
</I>&gt;<i> the only way to get a DaylightTime object is to call 
</I>&gt;<i> GetDaylightChanges
</I>&gt;<i> (int year). So there shouldn't be a case where daylightTimes and time
</I>&gt;<i> mismatches, right? Hmm, and I just thought of this, couldn't the
</I>&gt;<i> TimeSpan of DST span across a year -- it starts November 2001 and ends
</I>&gt;<i> March 2002, for example.
</I>	No, it can't span across years as explained above.
The logic behind the DST code for southern hemisphere is :
	if(Start &gt; End)	// Southern Hemisphere.
	if(time does not lie between End and start)
		return true;
All this seems good, but there is a problem. Suppose I pass a DateTime of
1st Jan 2000, and a DaylightTime corresponding to 2002, then it will return
true;
Hence the check for the year.

	Hope I it a little clear :)

Happy Hacking,
Ajay kumar Dwivedi,

PS: MS implementation also has the flaw for the southern hemisphere. Try
running the
attached code with NewZealand Timezone (GMT +12) Auckland, Wellington and
you'll
find that IsDaylightSavingTime returns all false throughout the year
althought daylight
saving is on. This must be result of using the if(time &gt; Start and time &lt;
End), 

--
#!!!	If anything can go wrong, _FIX_ it. (To hell with MURPHY)
							Dwivedi, Ajay kumar 



------_=_NextPart_000_01C1B7A2.0E94C3E0
Content-Type: application/octet-stream;
	name=&quot;Class1.cs&quot;
Content-Disposition: attachment;
	filename=&quot;Class1.cs&quot;

using System;
using System.Globalization;

namespace TestProject
{
	/// &lt;summary&gt;
	/// Summary description for Class1.
	/// &lt;/summary&gt;
	public class Class1 
	{

		public Class1()
		{}

		static void Main(string[] args)
		{
			TimeZone tz = TimeZone.CurrentTimeZone;
			System.Console.WriteLine(&quot;DAYLIGHT NAME : &quot;+ tz.DaylightName);
			System.Console.WriteLine(&quot;STANDARD NAME : &quot;+ tz.StandardName);
			DaylightTime dt = tz.GetDaylightChanges(2002);
			System.Console.WriteLine(&quot;START : &quot;+ dt.Start);
			System.Console.WriteLine(&quot;END   : &quot;+ dt.End);
			System.Console.WriteLine(&quot;DELTA : &quot;+ dt.Delta);
			System.Console.WriteLine(&quot; &quot;+ tz.IsDaylightSavingTime(new DateTime(2002,1,1)));
			System.Console.WriteLine(&quot; &quot;+ tz.IsDaylightSavingTime(new DateTime(2002,3,1)));
			System.Console.WriteLine(&quot; &quot;+ tz.IsDaylightSavingTime(new DateTime(2002,5,1)));
			System.Console.WriteLine(&quot; &quot;+ tz.IsDaylightSavingTime(new DateTime(2002,7,1)));
			System.Console.WriteLine(&quot; &quot;+ tz.IsDaylightSavingTime(new DateTime(2002,9,1)));
			System.Console.WriteLine(&quot; &quot;+ tz.IsDaylightSavingTime(new DateTime(2002,11,1)));
		}
	}
}

------_=_NextPart_000_01C1B7A2.0E94C3E0--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003242.html">[Mono-list] Convert.ToInt16 (string value, int fromBase) and
 friends
</A></li>
	<LI> Next message: <A HREF="003237.html">[Mono-list] RE: System.TimeZone
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3233">[ date ]</a>
              <a href="thread.html#3233">[ thread ]</a>
              <a href="subject.html#3233">[ subject ]</a>
              <a href="author.html#3233">[ author ]</a>
         </LI>
       </UL>
</body></html>
