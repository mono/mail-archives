<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: Qt C# bindings and a simple HelloWorld
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Richard_Dale%40tipitina.demon.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002941.html">
   <LINK REL="Next"  HREF="002942.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: Qt C# bindings and a simple HelloWorld
   </H1>
    <B>Richard Dale
    </B> 
    <A HREF="mailto:Richard_Dale%40tipitina.demon.co.uk"
       TITLE="[Mono-list] Re: Qt C# bindings and a simple HelloWorld">Richard_Dale@tipitina.demon.co.uk
       </A><BR>
    <I>Tue, 5 Feb 2002 10:25:08 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="002941.html">[Mono-list] Enormous diffs
</A></li>
        <LI> Next message: <A HREF="002942.html">[Mono-list] Contributing classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2937">[ date ]</a>
              <a href="thread.html#2937">[ thread ]</a>
              <a href="subject.html#2937">[ subject ]</a>
              <a href="author.html#2937">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tuesday 05 February 2002 2:04 am, Adam Treat wrote:
&gt;<i> So I've been mucking about for a bit with some c-sharp bindings to the
</I>&gt;<i> qt-toolkit.  I've been successful with a generic helloworld program.  I
</I>&gt;<i> think I am ready to begin generating some bindings in earnest after a few
</I>&gt;<i> problems are solved:
</I>&gt;<i>
</I>&gt;<i> 1.  Not sure how to handle Slots and Signals.  (biggest problem) ;)
</I>You need some kind of reflection/runtime metadata to do this - it has to be 
possible to query whether an instance implements a method/slot, and if so to 
call it. Then you need two C++ proxy classes to handle emitting signals and 
calling slots - eg CSSignal and CSSlot. 

&gt;<i> 2.  I have been using the qtc bindings from kde3 in the pinvoke statements.
</I>&gt;<i> I would like to stop using the libqtc library and just dllimport from libqt
</I>&gt;<i> but the name mangling (see
</I>&gt;<i> <A HREF="http://www.delorie.com/gnu/docs/gcc/gxxint_15.html">http://www.delorie.com/gnu/docs/gcc/gxxint_15.html</A>) is going to have to be
</I>&gt;<i> accounted for.  Thinking about writing a tool that will automatically
</I>&gt;<i> mangle the dllimport statement.  ie:
</I>&gt;<i>
</I>&gt;<i> 	From:
</I>&gt;<i> 	[DllImport(&quot;libqtc.so.1.0.0&quot;)]
</I>&gt;<i> 	public static extern Object qt_new_QApplication(int argc, string[] argv);
</I>&gt;<i>
</I>&gt;<i> 	To:
</I>&gt;<i> 	[DllImport(&quot;libqt.so.2&quot;)]
</I>&gt;<i> 	public static extern Object __12QApplicationRiPPc(int argc, string[]
</I>&gt;<i> argv);
</I>This would be a similar problem to deriving the JNI function names for java, 
in the kalyptus tool. See the perl function cplusplusToJNISignature() in 
kalyptus/kalyptusCxxToJava.pm.

&gt;<i> 3.  I don't know how to use kalyptus (don't know perl) and I am a frankly
</I>&gt;<i> little frightened to go in that direction...  Thinking about using the kdoc
</I>&gt;<i> html output and generating the bindings from that, similar to what the
</I>&gt;<i> intel guys did with the ECMA documentation to c# stubs...  Richard, Miguel,
</I>&gt;<i> Mike do you have some suggestions on the best way to proceed?
</I>kalyptus is derived from kdoc - I started by hacking the html output exactly 
as you describe. It uses the same parser down to the method level, but adds 
argument level parsing and a 'typemap' to map Qt C++ data types onto C ones 
(and then from C types onto any other language type system).

&gt;<i> Well tell me what you think.
</I>C# is so similar to Java that it shouldn't be a problem - I had to look twice 
at the example below to spot the difference! I would copy 
kalyptusCxxToJava.pm to kalyptusCxxToCS.pm, add a '-fcs' option to kalyptus 
and start hacking..

&gt;<i>
</I>&gt;<i> P.S.  I am primarly a java programmer, with little experience in qt, c++,
</I>&gt;<i> or c.  This is an exercise to hopefully do something useful and allow me to
</I>&gt;<i> learn a little so feel free to offer up some pointers ;)
</I>If you start by adapting the QtJava bindings, rather than starting from 
scratch it shouldn't be so hard. Mostly you have to write a lot of conversion 
functions to convert between C# string, collections, dates etc and the C++ 
equivalents. Have a look at these source files in QtJava - pretty much 
everything else is 'autogenerated' - it will give you an idea of how much 
work is involved.

JavaSlot.cpp
JavaSlot.h
        C++ proxies for Java signals and slots

QtSupport.cpp
QtSupport.h
        C++ static methods for running the library in conjunction with 
'qtjava.java'

qtjava.java
        A Java class with static methods for running the library, and to keep 
track of C++ -&gt; Java instance mapping.

qtjava.cpp
        Some native code methods to help the 'run the library' Java class 
'qtjava.java'

Invocation.java
        Utility class containing methods to invoke Qt event handlers and slots

-- Richard


&gt;<i> // qt_HelloWorld.cs - qt-csharp Hello World
</I>&gt;<i>
</I>&gt;<i> namespace QtSamples {
</I>&gt;<i>
</I>&gt;<i> 	using Qt;
</I>&gt;<i> 	using System;
</I>&gt;<i>
</I>&gt;<i> 	public class qt_HelloWorld {
</I>&gt;<i>
</I>&gt;<i> 		public static int Main (string[] args)
</I>&gt;<i> 		{
</I>&gt;<i>
</I>&gt;<i> 			QApplication a = new QApplication(args);
</I>&gt;<i> 			QPushButton hello = new QPushButton(&quot;Hello world!&quot;, 0);
</I>&gt;<i> 			hello.resize(100, 30);
</I>&gt;<i> 			a.setMainWidget(hello);
</I>&gt;<i> 			hello.show();
</I>&gt;<i> 			return a.exec();
</I>&gt;<i>
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002941.html">[Mono-list] Enormous diffs
</A></li>
	<LI> Next message: <A HREF="002942.html">[Mono-list] Contributing classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2937">[ date ]</a>
              <a href="thread.html#2937">[ thread ]</a>
              <a href="subject.html#2937">[ subject ]</a>
              <a href="author.html#2937">[ author ]</a>
         </LI>
       </UL>
</body></html>
