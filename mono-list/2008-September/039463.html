<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] re f cursor issue in oracle stored procedure	invoked from mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20re%20f%20cursor%20issue%20in%20oracle%20stored%20procedure%0A%09invoked%20from%20mono&In-Reply-To=19271280.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039461.html">
   <LINK REL="Next"  HREF="039467.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] re f cursor issue in oracle stored procedure	invoked from mono</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20re%20f%20cursor%20issue%20in%20oracle%20stored%20procedure%0A%09invoked%20from%20mono&In-Reply-To=19271280.post%40talk.nabble.com"
       TITLE="[Mono-list] re f cursor issue in oracle stored procedure	invoked from mono">monodanmorg at yahoo.com
       </A><BR>
    <I>Tue Sep  2 19:45:25 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="039461.html">[Mono-list] re f cursor issue in oracle stored procedure	invoked from mono
</A></li>
        <LI>Next message: <A HREF="039467.html">[Mono-list] re f cursor issue in oracle stored procedure invoked from mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39463">[ date ]</a>
              <a href="thread.html#39463">[ thread ]</a>
              <a href="subject.html#39463">[ subject ]</a>
              <a href="author.html#39463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>DbDataAdapter uses ExecuteReader and the returned reader to populate the data table.  If you try your example with ExecuteReader and then try to get the data reader from the parameter, it will fail because you will have DBNull.Value.  At least this is what you get on .net 2.0.

My advice is to use ExecuteNonQuery(), then get the data reader from the parameter.  Then manually load a data table.  

Here is an example that works for me on .net 2.0 and mono:

// test.cs
// gmcs test.cs /r:System.Data.dll /r:System.Data.OracleClient.dll
using System;
using System.Data;
using System.Data.Common;
using System.Data.OracleClient;

public class test
{
    public static void Main(string[] args)
    {
        Console.WriteLine(&quot;Start.&quot;);
        OracleConnection con = new OracleConnection(&quot;Data source=testdb;user id=someuser;password=somepass&quot;);
        con.Open();
        OracleCommand cmdSp = con.CreateCommand();
        cmdSp.CommandText = &quot;BEGIN\n SP_TEST_REF_CURSOR(:crsdata); \nEND;\n&quot;;
        DataSet ds = new DataSet();
        OracleParameter oprCursor = new OracleParameter(&quot;crsdata&quot;, OracleType.Cursor);
        oprCursor.Direction = ParameterDirection.Output;
        cmdSp.Parameters.Add(oprCursor);
        
	cmdSp.ExecuteNonQuery();
        
	OracleDataReader reader = (OracleDataReader)oprCursor.Value;

	Console.WriteLine(&quot;Build DataSet from reader that holds a REF CURSOR&quot;);        

	DataTable schema = reader.GetSchemaTable();
        DataTable newTable = new DataTable();
        if (reader.FieldCount &gt; 0)
        {
            foreach (DataRow row in schema.Rows)
            {
                string columnName = row[&quot;ColumnName&quot;].ToString();
                Type columnType = (Type)row[&quot;DataType&quot;];
                newTable.Columns.Add(columnName, columnType);
            }
            while (reader.Read())
            {
                object[] values = new object[newTable.Columns.Count];
                reader.GetValues(values);
                newTable.Rows.Add(values);
            }
        }

        reader.Close();

	Console.WriteLine(&quot;Add DataTable to DataSet&quot;);
	ds.Tables.Add(newTable);

	Console.WriteLine(&quot;Show Result&quot;);
        Console.WriteLine(&quot;Columns in DataTable&quot;);
        foreach (DataColumn column in ds.Tables[0].Columns)
        {
            Console.WriteLine(&quot;  ColumnName: &quot; + column.ColumnName);
            Console.WriteLine(&quot;      DataType: &quot; + column.DataType.ToString());
        }
        Console.WriteLine(&quot;Rows in DataTable&quot;);
        foreach (DataRow row in ds.Tables[0].Rows)
        {
            for (int c = 0; c &lt; ds.Tables[0].Columns.Count; c++)
            {
                Console.WriteLine(&quot;Column &quot; + c.ToString());
                if (row[c].Equals(DBNull.Value))
                    Console.WriteLine(&quot;     Value is DBNull.Value&quot;);
                else
                {
                    Console.WriteLine(&quot;     Value: &quot; + row[c].ToString());
                    Console.WriteLine(&quot;     Value Type: &quot; + row[c].GetType().ToString());
                }
            }
        }

        con.Close();
        con = null;
        Console.WriteLine(&quot;Success!&quot;);
    }
}






--- On Tue, 9/2/08, sumesh0710 &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">sumeshjose at gmail.com</A>&gt; wrote:

&gt;<i> From: sumesh0710 &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">sumeshjose at gmail.com</A>&gt;
</I>&gt;<i> Subject: [Mono-list] re f cursor issue in oracle stored procedure invoked from mono
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;<i> Date: Tuesday, September 2, 2008, 10:27 AM
</I>&gt;<i> Hi,
</I>&gt;<i> OS - Linux Version 2.6.9-42.0.0.0.1( Red hat version
</I>&gt;<i> 3.4.6-3.1)
</I>&gt;<i> Oracle - 9.2.0
</I>&gt;<i> mono - 1.2.4
</I>&gt;<i> 
</I>&gt;<i> I have a simple procedure which has a ref cursor as
</I>&gt;<i> parameter as follows.
</I>&gt;<i> 
</I>&gt;<i> CREATE OR REPLACE PROCEDURE
</I>&gt;<i> &quot;DARSTRAN&quot;.&quot;TEST&quot; (crsdata out
</I>&gt;<i> sys_refcursor)
</I>&gt;<i> as
</I>&gt;<i> 
</I>&gt;<i> BEGIN
</I>&gt;<i> open crsdata for select sysdate from dual;
</I>&gt;<i> END;
</I>&gt;<i> 
</I>&gt;<i> If i execute this from proc from sql plus. It works fine.
</I>&gt;<i> Also in windows
</I>&gt;<i> OS, if i call from an application developed in vb.net it
</I>&gt;<i> will work. But same
</I>&gt;<i> code executed in mono in Linux OS shows below error while
</I>&gt;<i> filling into
</I>&gt;<i> dataset.
</I>&gt;<i> ora- 01403: no data found.
</I>&gt;<i> 
</I>&gt;<i> Code used is
</I>&gt;<i> 
</I>&gt;<i> cmdSp = New OracleCommand(&quot;test&quot;, con)
</I>&gt;<i> cmdSp.CommandType = CommandType.StoredProcedure
</I>&gt;<i> ds = New DataSet
</I>&gt;<i> oprCursor = New OracleParameter(&quot;crsdata&quot;,
</I>&gt;<i> OracleType.Cursor)
</I>&gt;<i> oprCursor.Direction = ParameterDirection.Output
</I>&gt;<i> cmdSp.Parameters.Add(oprCursor)
</I>&gt;<i> dasp = New OracleDataAdapter(cmdSp)
</I>&gt;<i> dasp.Fill(ds)
</I>&gt;<i> 
</I>&gt;<i> If i execute above SP from linux sql plus, also it works
</I>&gt;<i> ok.
</I>&gt;<i> 
</I>&gt;<i> Is there any workaround to solve this problem?
</I>&gt;<i> -- 
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://www.nabble.com/ref-cursor-issue-in-oracle-stored-procedure-invoked-from-mono-tp19271280p19271280.html">http://www.nabble.com/ref-cursor-issue-in-oracle-stored-procedure-invoked-from-mono-tp19271280p19271280.html</A>
</I>&gt;<i> Sent from the Mono - General mailing list archive at
</I>&gt;<i> Nabble.com.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>

      
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039461.html">[Mono-list] re f cursor issue in oracle stored procedure	invoked from mono
</A></li>
	<LI>Next message: <A HREF="039467.html">[Mono-list] re f cursor issue in oracle stored procedure invoked from mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39463">[ date ]</a>
              <a href="thread.html#39463">[ thread ]</a>
              <a href="subject.html#39463">[ subject ]</a>
              <a href="author.html#39463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
