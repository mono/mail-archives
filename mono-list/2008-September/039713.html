<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Once more about Mono on PowerPC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Once%20more%20about%20Mono%20on%20PowerPC&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039712.html">
   <LINK REL="Next"  HREF="039716.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Once more about Mono on PowerPC</H1>
    <B>Yury Serdyuk</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Once%20more%20about%20Mono%20on%20PowerPC&In-Reply-To="
       TITLE="[Mono-list] Once more about Mono on PowerPC">Yury at serdyuk.botik.ru
       </A><BR>
    <I>Tue Sep 23 15:51:52 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="039712.html">[Mono-list] Mono 2.0 LINUX Download
</A></li>
        <LI>Next message: <A HREF="039716.html">[Mono-list]  session_end doesn't work / not fired
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39713">[ date ]</a>
              <a href="thread.html#39713">[ thread ]</a>
              <a href="subject.html#39713">[ subject ]</a>
              <a href="author.html#39713">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi !

I have proceed further trying to locate a critical place where Mono is 
crashed on PowerPC
( see <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=414845">https://bugzilla.novell.com/show_bug.cgi?id=414845</A>).

Critical code is ( expr3.cs file extracted from the expression.cs)

 &gt;using System;
 &gt;
 &gt;        //
 &gt;        //   Unary implements unary expressions.
 &gt;        //
 &gt;        public class Unary { //   : Expression {
 &gt;
 &gt;                void TryReduceConstant ( )
 &gt;                {
 &gt;                  ulong  long_constant = 9223372036854775808;
 &gt;                }
 &gt;
 &gt;        }
 &gt;
An attempt to compile given code through mono-wrapper gives

 &gt;MONO_PATH=&quot;/home/user002/mono-112691/mcs/class/lib/monolite:$MONO_PATH&quot;
 &gt;/home/user002/mono-112691/runtime/mono-wrapper
 &gt;/home/user002/mono-112691/mcs/class/lib/monolite/mcs.exe -v expr3.cs
 &gt;** Message: Unknown errno: Success
 &gt;
 &gt;System.IO.IOException: Win32 IO returned ERROR_GEN_FAILURE. Path: expr3.cs
 &gt;  at System.IO.FileStream.ReadData (IntPtr handle, System.Byte[] buf, 
Int32
 &gt;offset, Int32 count) [0x00000]
 &gt;  at System.IO.FileStream.ReadInternal (System.Byte[] dest, Int32 
offset, Int32
 &gt;count) [0x00000]
 &gt;  at System.IO.FileStream.Read (System.Byte[] array, Int32 offset, 
Int32 count)
 &gt;[0x00000]
 &gt;  at System.IO.StreamReader.ReadBuffer () [0x00000]
 &gt;  at System.IO.StreamReader.Read (System.Char[] buffer, Int32 index, Int32
 &gt;count) [0x00000]
 &gt;  at Mono.CSharp.SeekableStreamReader.ReadBuffer () [0x00000]
 &gt;  at Mono.CSharp.SeekableStreamReader.Read () [0x00000]
 &gt;  at Mono.CSharp.Tokenizer.get_char () [0x00000]
 &gt;  at Mono.CSharp.Tokenizer.xtoken () [0x00000]
 &gt;  at Mono.CSharp.Tokenizer.token () [0x00000]
 &gt;  at Mono.CSharp.CSharpParser.yyparse (yyInput yyLex) [0x00000]
 &gt;  at Mono.CSharp.CSharpParser.parse () [0x00000] ** Message: Unknown 
errno:
 &gt;Unknown error 897
 &gt;
( I have tried Mono 2.0 RC1 and various versions from the SVN).

Further, I have found that the problem lies in the file_read function 
from the io.c module.
Particularly, after inserting debug printing as

&gt;<i> do {  printf ( &quot;numbytes = %d\n&quot;, numbytes );
</I>&gt;<i>         ret = read (fd, buffer, numbytes);
</I>&gt;<i>         printf ( &quot;fd = %d  ret = %d errno = %d\n&quot;, fd, ret, errno );
</I>&gt;<i>     } while (ret == -1 &amp;&amp; errno == EINTR &amp;&amp;
</I>&gt;<i>          !_wapi_thread_cur_apc_pending());
</I>&gt;<i>
</I>&gt;<i>     if(ret==-1) {
</I>&gt;<i>         gint err = errno;
</I>&gt;<i>
</I>&gt;<i> #ifdef DEBUG
</I>&gt;<i>         g_message(&quot;%s: read of handle %p error: %s&quot;, __func__,
</I>&gt;<i>               handle, strerror(err));
</I>&gt;<i> #endif
</I>
 I got:

&gt;<i> [<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">user002 at cell8i</A> expression]$ 
</I>&gt;<i> MONO_PATH=&quot;/home/user002/mono-2.0/mcs/class/lib/monolite:$MONO_PATH&quot; 
</I>&gt;<i> /home/user002/mono-2.0/runtime/mono-wrapper  
</I>&gt;<i> /home/user002/mono-2.0/mcs/class/lib/monolite/mcs.exe -v expr3.cs
</I>&gt;<i> numbytes = 1024
</I>&gt;<i> fd = 4  ret = 640   errno =2
</I>&gt;<i> numbytes = 1024
</I>&gt;<i> fd = 4  ret = -1   errno =0
</I>&gt;<i> ** Message: file_read: read of handle 0x4 error: No space left on device
</I>&gt;<i> expr3.cs(32,1): error CS8025: Parsing error** Message: Unknown errno: 
</I>&gt;<i> Identifier removed
</I>&gt;<i>
</I>&gt;<i> expr3.cs(32,1): error CS8025: Parsing error** Message: Unknown errno: 
</I>&gt;<i> Identifier removed
</I>&gt;<i>
</I>&gt;<i> System.IO.IOException: Disk full. Path expr3.cs
</I>&gt;<i>   at System.IO.FileStream.ReadData (IntPtr handle, System.Byte[] buf, 
</I>&gt;<i> Int32 offset, Int32 count) [0x00000]
</I>&gt;<i>   at System.IO.FileStream.ReadInternal (System.Byte[] dest, Int32 
</I>&gt;<i> offset, Int32 count) [0x00000]
</I>
Interestingly, that for different versions of Mono the error mesages are 
different and arbitrary:

&gt;<i> [<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">user002 at cell8i</A> expression]$ 
</I>&gt;<i> MONO_PATH=&quot;/home/user002/mono-113797/mcs/class/lib/monolite:$MONO_PATH&quot; 
</I>&gt;<i> /home/user002/mono-113797/runtime/mono-wrapper  
</I>&gt;<i> /home/user002/mono-113797/mcs/class/lib/monolite/mcs.exe -v expr3.cs
</I>&gt;<i> fd = 4   ret = 640   errno = 2
</I>&gt;<i> fd = 4   ret = -1   errno = 0
</I>&gt;<i> ** Message: file_read: read of handle 0x4 error: Read-only file system
</I>&gt;<i> System.UnauthorizedAccessException: Access to the path &quot;expr3.cs&quot; is 
</I>&gt;<i> denied.
</I>
Finally, on x86 architecture the above code run as follows:

&gt;<i> [<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">serdyuk at skif</A> expression]$ 
</I>&gt;<i> MONO_PATH=&quot;/home/serdyuk/mono-2.0/mcs/class/lib/monolite:$MONO_PATH&quot; 
</I>&gt;<i> /home/serdyuk/mono-2.0/runtime/mono-wrapper  
</I>&gt;<i> /home/serdyuk/mono-2.0/mcs/class/lib/monolite/mcs.exe -v expr3.cs
</I>&gt;<i> numbytes = 1024
</I>&gt;<i> fd = 7  ret = 640 errno = 2
</I>&gt;<i> numbytes = 1024
</I>&gt;<i> fd = 7  ret = 0 errno = 2
</I>&gt;<i> numbytes = 1024
</I>&gt;<i> fd = 7  ret = 0 errno = 2
</I>&gt;<i> expr3.cs(23,26): warning CS0219: The variable `long_constant' is 
</I>&gt;<i> assigned but its value is never used
</I>
We are in need of Mono on PowerPC very keen.
Please help.

Yury





</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039712.html">[Mono-list] Mono 2.0 LINUX Download
</A></li>
	<LI>Next message: <A HREF="039716.html">[Mono-list]  session_end doesn't work / not fired
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39713">[ date ]</a>
              <a href="thread.html#39713">[ thread ]</a>
              <a href="subject.html#39713">[ subject ]</a>
              <a href="author.html#39713">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
