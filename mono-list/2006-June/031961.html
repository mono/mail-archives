<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] TCPListener problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20TCPListener%20problem&In-Reply-To=001801c694c0%247b9a9dc0%246901a8c0%40leelaptop">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031955.html">
   <LINK REL="Next"  HREF="031962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] TCPListener problem</H1>
    <B>Lee</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20TCPListener%20problem&In-Reply-To=001801c694c0%247b9a9dc0%246901a8c0%40leelaptop"
       TITLE="[Mono-list] TCPListener problem">lee at datatrakpos.com
       </A><BR>
    <I>Wed Jun 21 10:47:59 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="031955.html">[Mono-list] TCPListener problem
</A></li>
        <LI>Next message: <A HREF="031962.html">[Mono-list] TCPListener problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31961">[ date ]</a>
              <a href="thread.html#31961">[ thread ]</a>
              <a href="subject.html#31961">[ subject ]</a>
              <a href="author.html#31961">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> 

Hello, 

I have done what Martin suggested which was the following:

Specifically use localhost 127.0.0.1 as the local address and check netstat.
It appears that the socket does not start because it is not showing up in
netstat.

As I mentioned in a prior post, I have placed logging routines at various
points in the code:

OnStart event
OnStop event
Beginning of the StartServ() method

When I used:
SockServer = new TcpListener(IPAddress.Any, port);

Both the OnStart and OnStop events were firing without the socket server
listing.

When I changed to:
IPAddress addr = IPAddress.Parse(&quot;127.0.0.1&quot;);
SockServer = new TcpListener(addr, port);
...only the OnStart event appears to fire.

Again, If I run the socket server (both in and out of VS IDE) on Windows the
server works fine with no problems.  Could it be that there is a difference
in the implementation of sockets namespace in Mono has a difference that I
need to account for?

Thanks again,

Lee


&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi, I have written a prototype TCPListerner service.  It 
</I>&gt;<i> works fine on my local XP dev box (isn't that always the 
</I>&gt;<i> case), but not on the linux box.  
</I>&gt;<i> 
</I>&gt;<i> I started the service with:
</I>&gt;<i> 
</I>&gt;<i> $ Mono-service myservice.exe
</I>&gt;<i> 
</I>&gt;<i> Checked with ps and ps -eaf and it says that its running.  So 
</I>&gt;<i> at this point, I'm not sure if it's the linux box or 
</I>&gt;<i> something in my code that does not run well in mono.
</I>&gt;<i> 
</I>&gt;<i> Is there anything in particular I should try?  I have 
</I>&gt;<i> attached the code that starts the service below.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Lee
</I>&gt;<i> 
</I>&gt;<i> protected override void OnStart(string[] args) { 
</I>&gt;<i> System.Threading.Thread thread = new System.Threading.Thread(
</I>&gt;<i>   new System.Threading.ThreadStart(this.StartServe));
</I>&gt;<i> thread.Start();
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> private void StartServe()
</I>&gt;<i>     {
</I>&gt;<i>       TcpListener SockServer = null;
</I>&gt;<i>       try
</I>&gt;<i>       {
</I>&gt;<i> 
</I>&gt;<i>         // Setup socket server
</I>&gt;<i>         Int32 port = 4567;
</I>&gt;<i>         SockServer = new TcpListener(IPAddress.Any, port);
</I>&gt;<i>         SockServer.Start();
</I>&gt;<i>         
</I>&gt;<i>         // create buffer to read data
</I>&gt;<i>         Byte[] bytes = new Byte[256];
</I>&gt;<i>         string data = null;
</I>&gt;<i> 
</I>&gt;<i>         while (true)
</I>&gt;<i>         {
</I>&gt;<i>           // check to see if request is pending
</I>&gt;<i>           if (SockServer.Pending())
</I>&gt;<i>           {
</I>&gt;<i>             TcpClient client = SockServer.AcceptTcpClient();
</I>&gt;<i> 
</I>&gt;<i>             data = null;
</I>&gt;<i> 
</I>&gt;<i>             NetworkStream stream = client.GetStream();
</I>&gt;<i> 
</I>&gt;<i>             int i;
</I>&gt;<i> 
</I>&gt;<i>             // flag for loop
</I>&gt;<i>             bool Alldone = false;
</I>&gt;<i>             // End of Transmission character 
</I>&gt;<i>             char theChar = '\u0004';
</I>&gt;<i>             string ch = theChar.ToString();
</I>&gt;<i> 
</I>&gt;<i>             while (!Alldone)
</I>&gt;<i>             {
</I>&gt;<i>               i = stream.Read(bytes, 0, bytes.Length);
</I>&gt;<i>               // translate stream to string data;
</I>&gt;<i>               data += System.Text.Encoding.ASCII.GetString(bytes);
</I>&gt;<i>               if ((data.Contains(ch)) || (i == 0))
</I>&gt;<i>                 Alldone = true;
</I>&gt;<i>             }
</I>&gt;<i> 
</I>&gt;<i>             int POS = data.IndexOf(ch);
</I>&gt;<i>             data = data.Substring(0, POS);
</I>&gt;<i>             // strip off EOT character
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>             // create requestprocessing object here and hand off
</I>&gt;<i>             RequestHandler handler = new RequestHandler(data);
</I>&gt;<i>             string response = handler.ProcessRequest() + ch;
</I>&gt;<i> 
</I>&gt;<i>             // send back result
</I>&gt;<i>             byte[] ret = 
</I>&gt;<i> System.Text.Encoding.ASCII.GetBytes(response);
</I>&gt;<i>             stream.Write(ret, 0, ret.Length);
</I>&gt;<i> 
</I>&gt;<i>           }
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>       }
</I>&gt;<i>       catch (SocketException e)
</I>&gt;<i>       {
</I>&gt;<i>       }
</I>&gt;<i>       finally
</I>&gt;<i>       {
</I>&gt;<i>         SockServer.Stop();
</I>&gt;<i>       }
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A> 
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031955.html">[Mono-list] TCPListener problem
</A></li>
	<LI>Next message: <A HREF="031962.html">[Mono-list] TCPListener problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31961">[ date ]</a>
              <a href="thread.html#31961">[ thread ]</a>
              <a href="subject.html#31961">[ subject ]</a>
              <a href="author.html#31961">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
