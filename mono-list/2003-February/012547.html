<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] advanced .Net remoting: serialization formatter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lluis%40ideary.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="012476.html">
   <LINK REL="Next"  HREF="012477.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] advanced .Net remoting: serialization formatter
   </H1>
    <B>Lluis Sanchez
    </B> 
    <A HREF="mailto:lluis%40ideary.com"
       TITLE="[Mono-list] advanced .Net remoting: serialization formatter">lluis@ideary.com
       </A><BR>
    <I>Thu, 27 Feb 2003 00:47:44 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="012476.html">[Mono-list] advanced .Net remoting: serialization formatter
</A></li>
        <LI> Next message: <A HREF="012477.html">[Mono-list] problems with SerializationBinder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12547">[ date ]</a>
              <a href="thread.html#12547">[ thread ]</a>
              <a href="subject.html#12547">[ subject ]</a>
              <a href="author.html#12547">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

&gt;<i> I have one other question:
</I>&gt;<i>
</I>&gt;<i> Is there a way of installing standard serialization translation formatter
</I>to
&gt;<i> a give channel?
</I>
Yes, you can implement your own remoting formatter sink and use it in any
channel. You could do something like this:

MyClientFormatterSink clientFormatter = new MyClientFormatterSink();
MyServerFormatterSink serverFormatter = new MyServerFormatterSink();
TcpChannel ch = new TcpChannel(null, clientFormatter, serverFormatter);
ChannelServices.RegisterChannel (ch);

You can also do it using config files.

&gt;<i> What I want is the following:
</I>&gt;<i> System.Drawing.Image for instance is derived from MashalByRefObject, but
</I>&gt;<i> when a proxy version of an image is used (like
</I>Save(stream,ImageFormat.Jpeg)
&gt;<i> or similar) the serialization fails.  Image is not marked as serializable,
</I>&gt;<i> but it would be very easy to do:
</I>&gt;<i>
</I>&gt;<i> public static byte[] ImageToStream(Image image)
</I>&gt;<i> {
</I>&gt;<i> MemoryStream s = new MemoryStream();
</I>&gt;<i> image.Save(s,ImageFormat.Jpeg);
</I>&gt;<i> s.Close();
</I>&gt;<i> return s.GetBuffer();
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> public static Image StreamToImage(byte[] image)
</I>&gt;<i> {
</I>&gt;<i> return Image.FromStream(new MemoryStream(image));
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> But the problem is that I might have a structure like:
</I>&gt;<i> class ServerSide : MarshalByRefObject
</I>&gt;<i> {
</I>&gt;<i> public void Method(Image image) { ... }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> When I call from the client:
</I>&gt;<i>
</I>&gt;<i> ServerSide s = Activation.GetObject(...) as ServerSide;
</I>&gt;<i> s.Method(Image.FromFile(&quot;/tmp/test.gif&quot;));
</I>&gt;<i>
</I>&gt;<i> I would like the formatter to kick in, and automatically serialize the
</I>image
&gt;<i> to a byte[] and de-serialize back.  Is that possible on a channel
</I>formatter
&gt;<i> level, so that I don't have to change the method signature?
</I>&gt;<i>
</I>&gt;<i> This applied for other objects like object[], Hashtable, and others that
</I>&gt;<i> could be serialized very easily in general purpose code.
</I>
The serialization infrastructure is very flexible and allows you to make
such custom serializations. However, if you want to use it with remoting,
you'll need to write your own formatter sink, because there is no way to
customize the behavior of the serialization formatter that is used by the
standard binary and soap formatter sinks.

The best way of customizing Image serialization, is to use a serialization
surrogate. You need to create a class that implements
ISerializationSurrogate, which has two methods: GetObjectData and
SetObjectData. Those methods would serialize/deserialize the image as you
want. Then create and instance of SurrogateSelector and register your
surrogate using the Image type. You also need to chain an instance of
RemotingSurrogateSelector to your selector (by calling ChainSelector), which
does the marshalling of MarshalByRefObjects. Finally, assign the selector to
the formatter.

You should look at the implementation of BinaryClientFormatterSink. It will
give you more ideas.

Regards,
Lluis.

&gt;<i>
</I>&gt;<i> - URS C. MUFF
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="012476.html">[Mono-list] advanced .Net remoting: serialization formatter
</A></li>
	<LI> Next message: <A HREF="012477.html">[Mono-list] problems with SerializationBinder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12547">[ date ]</a>
              <a href="thread.html#12547">[ thread ]</a>
              <a href="subject.html#12547">[ subject ]</a>
              <a href="author.html#12547">[ author ]</a>
         </LI>
       </UL>
</body></html>
