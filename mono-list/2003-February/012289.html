<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] problems with SerializationBinder
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:ishpal.singh%40aeye.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="012287.html">
   <LINK REL="Next"  HREF="012291.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] problems with SerializationBinder
   </H1>
    <B>Ishpal Singh
    </B> 
    <A HREF="mailto:ishpal.singh%40aeye.net"
       TITLE="[Mono-list] problems with SerializationBinder">ishpal.singh@aeye.net
       </A><BR>
    <I>Tue, 18 Feb 2003 22:39:57 -0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="012287.html">[Mono-list] MySql and Mono Problems
</A></li>
        <LI> Next message: <A HREF="012291.html">[Mono-list] problems with SerializationBinder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12289">[ date ]</a>
              <a href="thread.html#12289">[ thread ]</a>
              <a href="subject.html#12289">[ subject ]</a>
              <a href="author.html#12289">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys,

A brief report reagrding the BinaryFormatter/Serialization which can be
helpful to you guys.
Thought I'd mail the bug (if I am not doing anything wrong :)). It might
help a few.

I am trying to work with the deserialization with mono.
Passing a structure from a windows application running dotNet to the linux
box running mono and try to recover the same object on the linux machine.
It seems to transfer the data fine, but then it checks for the header of the
serialized structure and finds the assembly name in which the structure was
originally serialized.
Now, since the two applications are different, the assembly names are also
obviously different and so while deserializing it complains for the assembly
names. (refer <A HREF="http://msdn.microsoft.com/msdnmag/issues/02/09/net/">http://msdn.microsoft.com/msdnmag/issues/02/09/net/</A> )
To work around I wrote another class called the
'AssmNameChangeDeserializationBinder'. The purpose of this binder is to
replace the assembly name when it reaches the other application.
It works fine if both the applications are on windows, but fails if one of
the application is on MONO. MONO doesnt seem to invoke this class to change
the assembly name while deserializing.
I think this needs to be fixed.

-----------------------------------------------
using System;
namespace cmsStruct
{
	[Serializable()]
	public struct test
	{
		public int a;
		public string b;
	}
}
-----------------------------------------------

MemoryStream ms = new MemoryStream(b);
BinaryFormatter bf1 = new BinaryFormatter();
ms.Position = 0;
bf1.Binder = new AssmNameChangeDeserializationBinder();

cmsStruct.test t = (cmsStruct.test) bf1.Deserialize(ms);

--------------------------------------------------------------------

sealed class AssmNameChangeDeserializationBinder :
System.Runtime.Serialization.SerializationBinder
		{
			public override Type BindToType( string assemblyName, string typeName)
			{

				Console.WriteLine(&quot;in Bind to type...&quot;);

				Type typeToDeserialize = null;

				// For each assemblyName/typeName that you wish to deserialize
				// to a different type, set typeToCreate to the desired type
				String assemVer1 = &quot;TransferStructData, Version=1.0.0.0, &quot; +
					&quot;Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;;
				String typeVer1 = &quot;cmsStruct.test&quot;;

				Console.WriteLine(&quot;assemblyName={0}&quot;, assemblyName);

				if (assemblyName.IndexOf( &quot;TransferStructData&quot;) != -1)// &amp;&amp; typeName ==
typeVer1)
				{
					assemblyName = assemblyName.Replace(&quot;TransferStructData&quot;,
&quot;dotNetServer&quot;);
				}

				// To return the type, do this:
				typeToDeserialize = Type.GetType(String.Format(&quot;{0}, {1}&quot;,
					typeName, assemblyName));

				return typeToDeserialize;
			}
		}


------------------------------------------------------------------

WORAROUND TO GET IT GOING ON MONO
---------------------------------
I had to change the name of the assembly while serializing the structure,
after inheriting it from ISerializable as the following code shows.
The code with following structure to transfer data works on both windows and
mono.
And no need to use the Binder to chahge the name of the Assembly at the time
of deserialization.

using System;
using System.IO;
using System.Runtime.Serialization;

namespace cmsStruct
{
	[Serializable()]
	public struct test : ISerializable
	{
		public int a;
		public string b;

		//Deserialization constructor.
		public test (SerializationInfo info, StreamingContext context)
		{
			a = (int)info.GetValue(&quot;a&quot;, typeof(int));
			b = (String)info.GetValue(&quot;b&quot;, typeof(string));
		}


		public void GetObjectData(SerializationInfo info, StreamingContext
context)
		{
			info.AddValue(&quot;a&quot;, a);
			info.AddValue(&quot;b&quot;, b);
			info.AssemblyName = &quot;dotNetServer&quot;;
		}
	}
}
-------------------------------------


Please let me know incase someone needs some more information or if I am
creating confusions.


Best Regards,
Ishpal Singh.

System Analyst
R&amp;D
Aeye Ltd

Information contained in this email is confidential and is intended only
for the recipient. (c) Aeye Ltd, Aeye.biz, 2003.


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="012287.html">[Mono-list] MySql and Mono Problems
</A></li>
	<LI> Next message: <A HREF="012291.html">[Mono-list] problems with SerializationBinder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12289">[ date ]</a>
              <a href="thread.html#12289">[ thread ]</a>
              <a href="subject.html#12289">[ subject ]</a>
              <a href="author.html#12289">[ author ]</a>
         </LI>
       </UL>
</body></html>
