<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Bi-directional remoting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lluis%40ideary.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="012373.html">
   <LINK REL="Next"  HREF="012377.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Bi-directional remoting
   </H1>
    <B>Lluis Sanchez
    </B> 
    <A HREF="mailto:lluis%40ideary.com"
       TITLE="[Mono-list] Bi-directional remoting">lluis@ideary.com
       </A><BR>
    <I>Fri, 21 Feb 2003 19:50:58 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="012373.html">[Mono-list] Bi-directional remoting
</A></li>
        <LI> Next message: <A HREF="012377.html">[Mono-list] Bi-directional remoting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12374">[ date ]</a>
              <a href="thread.html#12374">[ thread ]</a>
              <a href="subject.html#12374">[ subject ]</a>
              <a href="author.html#12374">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bi-directional remotingHi,

In the client configuration file change &lt;channel ref=&quot;tcp&quot;&gt; to &lt;channel
ref=&quot;tcp&quot; port=&quot;0&quot;&gt;.
This will create a tcp listener in the client (however, in mono
configuration files don't work yet).

Lluis.

----- Original Message -----
From: Urs Muff
To: '<A HREF="mailto:mono-list@lists.ximian.com">mono-list@lists.ximian.com</A>'
Sent: Friday, February 21, 2003 7:26 PM
Subject: [Mono-list] Bi-directional remoting


How would you create such a bi-directional channel?  All the samples I used
so far are only server-client, but not the other way around.
I have a delegate that I want to implement on the client side.  The class
implementing the callback sits on the client (of course).
I even use the common abstract pattern described by a Microsoft KB article,
but still no luck.
Debug output:
ASP.Net Server starting
Server.Do start
An unhandled exception of type 'System.Runtime.Remoting.RemotingException'
occurred in mscorlib.dll
Additional information: This remoting proxy has no channel sink which means
either the server has no registered server channels that are listening, or
this application has no suitable client channel to talk to the server.


Here is the sample code:


CommonLib: [both server and client have access]
-----------------------------------------------
using System;
using System.Runtime.Remoting;
public delegate void BaseEventHandler(object sender,RemoteEventArgs e);
[Serializable]
public class RemoteEventArgs : EventArgs
{
        public static new RemoteEventArgs Empty = new RemoteEventArgs();
}
public abstract class RemoteCallback : MarshalByRefObject
{
        [System.Runtime.Remoting.Messaging.OneWay]
        public void Callback(object sender,RemoteEventArgs e)
        {
                CallbackImpl(sender,e);
        }
        protected abstract void CallbackImpl(object sender,RemoteEventArgs
e);
}
public interface IServer
{
        event BaseEventHandler Evt;
        void Do();
}


ASP.Net Server:
--------------------------------------------
class S : MarshalByRefObject, IServer
{
        public event BaseEventHandler Evt;
        public void Do()
        {
                System.Diagnostics.Debug.WriteLine(&quot;Server.Do start&quot;);
                if (Evt != null) Evt(this,RemoteEventArgs.Empty);
                System.Diagnostics.Debug.WriteLine(&quot;Server.Do end&quot;);
        }
}
public class Service1 : System.Web.Services.WebService
{
        ... // standard web service stuff (autogenerated)
        static bool Init = false;
        [WebMethod]
        public void StartUp()
        {
                if (!Init)
                {
                        RemotingConfiguration.Configure(&quot;/Server.config&quot;);
                        Init = true;
                }
                System.Diagnostics.Debug.WriteLine(&quot;ASP.Net Server
starting&quot;);
        }
}
&lt;configuration&gt;
  &lt;system.runtime.remoting&gt;
    &lt;application&gt;
      &lt;service&gt;
        &lt;wellknown
           mode=&quot;Singleton&quot;
           type=&quot;S, Server&quot;
           objectUri=&quot;S&quot;
        /&gt;
      &lt;/service&gt;
      &lt;channels&gt;
        &lt;channel ref=&quot;tcp&quot; port=&quot;8085&quot;&gt;
          &lt;serverProviders&gt;
                &lt;formatter ref=&quot;binary&quot;/&gt;
          &lt;/serverProviders&gt;
        &lt;/channel&gt;
      &lt;/channels&gt;
    &lt;/application&gt;
  &lt;/system.runtime.remoting&gt;
&lt;/configuration&gt;
Client:
--------------------------------------------
using System;
using System.Runtime.Remoting;
public class Test
{
        static void Main()
        {
                RemotingConfiguration.Configure(&quot;../../Client.config&quot;);

                new Client.localhost.Service1().StartUp();
                IServer s =
Activator.GetObject(typeof(IServer),&quot;<A HREF="tcp://localhost:8085/S"">tcp://localhost:8085/S&quot;</A>) as IServer;
                s.Evt += new BaseEventHandler(
                        new ClientChangedCallback().Callback);
                s.Do();
                System.Diagnostics.Debug.WriteLine(&quot;I never get here&quot;);
        }
}
public class ClientChangedCallback : RemoteCallback
{
        protected override void CallbackImpl(object sender,RemoteEventArgs
e)
        {
                System.Diagnostics.Debug.WriteLine(&quot;And of course I never
get here&quot;);
        }
}
&lt;configuration&gt;
  &lt;system.runtime.remoting&gt;
     &lt;application&gt;
        &lt;channels&gt;
           &lt;channel ref=&quot;tcp&quot;&gt;
              &lt;clientProviders&gt;
                 &lt;formatter ref=&quot;binary&quot;/&gt;
              &lt;/clientProviders&gt;
           &lt;/channel&gt;
        &lt;/channels&gt;
     &lt;/application&gt;
  &lt;/system.runtime.remoting&gt;
&lt;/configuration&gt;


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="012373.html">[Mono-list] Bi-directional remoting
</A></li>
	<LI> Next message: <A HREF="012377.html">[Mono-list] Bi-directional remoting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12374">[ date ]</a>
              <a href="thread.html#12374">[ thread ]</a>
              <a href="subject.html#12374">[ subject ]</a>
              <a href="author.html#12374">[ author ]</a>
         </LI>
       </UL>
</body></html>
