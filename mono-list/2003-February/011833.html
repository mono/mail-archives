<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Compile error with current cvs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gonzalo%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="011831.html">
   <LINK REL="Next"  HREF="011800.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Compile error with current cvs
   </H1>
    <B>Gonzalo Paniagua Javier
    </B> 
    <A HREF="mailto:gonzalo%40ximian.com"
       TITLE="[Mono-list] Compile error with current cvs">gonzalo@ximian.com
       </A><BR>
    <I>03 Feb 2003 17:15:35 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="011831.html">[Mono-list] Compile error with current cvs
</A></li>
        <LI> Next message: <A HREF="011800.html">[Mono-list] Starting xsp at bootup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11833">[ date ]</a>
              <a href="thread.html#11833">[ thread ]</a>
              <a href="subject.html#11833">[ subject ]</a>
              <a href="author.html#11833">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>El lun, 03-02-2003 a las 16:17, Lluis Sanchez escribió:
&gt;<i> configure:6525:
</I>&gt;<i> gcc -mno-cygwin -E -I/home/Lluis/install/include -DGC_WIN32_THREADS -DWIN32_
</I>&gt;<i> THREADS conftest.c &gt;/dev/null 2&gt;conftest.out
</I>&gt;<i> In file included from configure:6521:
</I>&gt;<i> /home/Lluis/install/include/gc/gc.h:61:1: warning: &quot;GC_WIN32_THREADS&quot;
</I>&gt;<i> redefined
</I>&gt;<i> conftest.c:1:1: warning: this is the location of the previous definition
</I>&gt;<i> configure: failed program was:
</I>&gt;<i> #line 6520 &quot;configure&quot;
</I>&gt;<i> #include &quot;confdefs.h&quot;
</I>&gt;<i> #include &lt;gc/gc.h&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> This problem can be solved by commenting the #define GC_WIN32_THREADS in
</I>&gt;<i> gc.h. Then, it compiles.
</I>&gt;<i> 
</I>&gt;<i> On the other hand, the script autogen.sh does not select the stable version
</I>&gt;<i> of autoconf, so when it is not executed through mono-build-w32.sh, it uses
</I>&gt;<i> the devel version to generate the configure script. This script does not
</I>&gt;<i> fail to detect gc.h as far as CPPFLAGS is set to my install/include
</I>&gt;<i> directory. However, the libtool script generated by this configure script is
</I>&gt;<i> unable to link the jit, since it generates all those &quot;undefined reference&quot;
</I>&gt;<i> errors.
</I>&gt;<i> 
</I>&gt;<i> So to compile using autogen.h I had to include this in the script:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> CPPFLAGS=&quot;$CPPFLAGS -I/home/Lluis/install/include&quot;
</I>&gt;<i> LDFLAGS=&quot;$LDFLAGS -L/home/Lluis/install/lib&quot;
</I>&gt;<i> export CPPFLAGS
</I>&gt;<i> export LDFLAGS
</I>&gt;<i> 
</I>&gt;<i> if [ ! -z &quot;${AUTO_STABLE}&quot; -o -e /usr/autotool/stable ]; then
</I>&gt;<i> export AUTO_STABLE=${AUTO_STABLE:-/usr/autotool/stable}
</I>&gt;<i> export AUTO_DEVEL=${AUTO_STABLE}
</I>&gt;<i> fi
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Well, I've been able to compile and install... and now I get this when error
</I>&gt;<i> when running mono:
</I>&gt;<i> 
</I>&gt;<i> ** ERROR **: file jit.c: line 4101 (mono_get_lmf_addr): should not be
</I>&gt;<i> reached
</I>&gt;<i> 
</I>&gt;<i> But that's another problem ...
</I>
This is the problem that I fixed when I added -DWIN32_THREADS. Sometimes
(i didn't investigate further) the GC_API #define wasn't being defined
properly (lacked dllimport) because WIN32_THREADS was not always defined
(!?). This causes a SIGSEGV when mono runtime accesses GC variables such
as GC_finalize_on_demand.

If we fix the problem without using -DWIN32_THREADS... Can you check if
defining _DLL and removing WIN32_THREADS work?

Btw, I'm using gc6.1 headers and dll and didn't run into the problems
you have.

-Gonzalo



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="011831.html">[Mono-list] Compile error with current cvs
</A></li>
	<LI> Next message: <A HREF="011800.html">[Mono-list] Starting xsp at bootup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11833">[ date ]</a>
              <a href="thread.html#11833">[ thread ]</a>
              <a href="subject.html#11833">[ subject ]</a>
              <a href="author.html#11833">[ author ]</a>
         </LI>
       </UL>
</body></html>
