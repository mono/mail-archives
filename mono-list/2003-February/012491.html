<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] DbDataAdapter.Fill patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:avd%40openlinksw.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="012490.html">
   <LINK REL="Next"  HREF="012461.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] DbDataAdapter.Fill patch
   </H1>
    <B>Aleksey Demakov
    </B> 
    <A HREF="mailto:avd%40openlinksw.com"
       TITLE="[Mono-list] DbDataAdapter.Fill patch">avd@openlinksw.com
       </A><BR>
    <I>Wed, 26 Feb 2003 05:28:25 +0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="012490.html">[Mono-list] DbDataAdapter.Fill patch
</A></li>
        <LI> Next message: <A HREF="012461.html">[Mono-list] DbDataAdapter Fill When Schema Exists (DbDataAdapter.FillSchema)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12491">[ date ]</a>
              <a href="thread.html#12491">[ thread ]</a>
              <a href="subject.html#12491">[ subject ]</a>
              <a href="author.html#12491">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.
--------------000207040100090700010406
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

Oops, sorry, first time I sent wrong files.

--------------000207040100090700010406
Content-Type: text/plain;
 name=&quot;u.cs&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;u.cs&quot;

using System;
using System.Data;
using System.Data.SqlClient;

public class Test
{
	static SqlConnection conn = new SqlConnection(&quot;server=(local);Trusted_Connection=yes;database=northwind&quot;);
	static SqlDataAdapter da1 = new SqlDataAdapter(&quot;select * from foo&quot;, conn);
	static SqlDataAdapter da2 = new SqlDataAdapter(&quot;select * from bar&quot;, conn);
	static SqlDataAdapter da3 = new SqlDataAdapter(&quot;select * from baz&quot;, conn);
	static DataSet ds = new DataSet();

	public static void Main ()
	{
		conn.Open ();
		Create ();

		SqlCommandBuilder b1 = new SqlCommandBuilder (da1);
		da1.RowUpdating += new SqlRowUpdatingEventHandler (RowUpdatingHandler);
		da1.MissingSchemaAction = MissingSchemaAction.AddWithKey;
		da1.Fill (ds, &quot;Foo&quot;);
		ds.Tables[&quot;Foo&quot;].Rows[0][&quot;FooData&quot;] = &quot;foo2&quot;;

		SqlCommandBuilder b2 = new SqlCommandBuilder (da2);
		da2.RowUpdating += new SqlRowUpdatingEventHandler (RowUpdatingHandler);
		da2.MissingSchemaAction = MissingSchemaAction.AddWithKey;
		da2.Fill (ds, &quot;Bar&quot;);
		ds.Tables[&quot;Bar&quot;].Rows[0][&quot;BarData&quot;] = &quot;bar2&quot;;

		try {
			Console.WriteLine (&quot;Calling da1.Update() without table parameter.&quot;);
			da1.Update (ds);
			Console.WriteLine (&quot;Ok.&quot;);
		} catch (Exception e) {
			Console.WriteLine (&quot;Caught an exception: &quot;);
			Console.WriteLine (e);
		}
		try 
		{
			Console.WriteLine (&quot;Calling da2.Update() without table parameter.&quot;);
			da2.Update (ds);
			Console.WriteLine (&quot;Ok.&quot;);
		} 
		catch (Exception e) 
		{
			Console.WriteLine (&quot;Caught an exception: &quot;);
			Console.WriteLine (e);
		}
		try 
		{
			Console.WriteLine (&quot;Calling da1.Update() with table name parameter.&quot;);
			da1.Update (ds, &quot;Foo&quot;);
			Console.WriteLine (&quot;Ok.&quot;);
		} catch (Exception e) {
			Console.WriteLine (&quot;Caught an exception: &quot;);
			Console.WriteLine (e);
		}
		try 
		{
			Console.WriteLine (&quot;Calling da2.Update() with table name parameter.&quot;);
			da2.Update (ds, &quot;Bar&quot;);
			Console.WriteLine (&quot;Ok.&quot;);
		} catch (Exception e) {
			Console.WriteLine (&quot;Caught an exception: &quot;);
			Console.WriteLine (e);
		}

		Console.WriteLine (&quot;Once again. Fill a table with the default name.&quot;);
		SqlCommandBuilder b3 = new SqlCommandBuilder (da3);
		da3.RowUpdating += new SqlRowUpdatingEventHandler (RowUpdatingHandler);
		da3.MissingSchemaAction = MissingSchemaAction.AddWithKey;
		da3.Fill (ds);
		ds.Tables[&quot;Table&quot;].Rows[0][&quot;BazData&quot;] = &quot;baz2&quot;;

		try {
			Console.WriteLine (&quot;Calling da1.Update() without table parameter.&quot;);
			da1.Update (ds);
			Console.WriteLine (&quot;Ok.&quot;);
		} catch (Exception e) {
			Console.WriteLine (&quot;Caught an exception: &quot;);
			Console.WriteLine (e);
		}
		try 
		{
			Console.WriteLine (&quot;Calling da2.Update() without table parameter.&quot;);
			da2.Update (ds);
			Console.WriteLine (&quot;Ok.&quot;);
		} catch (Exception e) {
			Console.WriteLine (&quot;Caught an exception: &quot;);
			Console.WriteLine (e);
		}
		try 
		{
			Console.WriteLine (&quot;Calling da3.Update() without table parameter.&quot;);
			da3.Update (ds);
			Console.WriteLine (&quot;Ok.&quot;);
		} catch (Exception e) {
			Console.WriteLine (&quot;Caught an exception: &quot;);
			Console.WriteLine (e);
		}
	}

	private static void Create ()
	{
		SqlCommand cmd = new SqlCommand ();
		cmd.Connection = conn;

		try
		{
			cmd.CommandText = &quot;drop table foo&quot;;
			cmd.ExecuteNonQuery ();
		}
		catch (Exception)
		{
		}
		try
		{
			cmd.CommandText = &quot;drop table bar&quot;;
			cmd.ExecuteNonQuery ();
		}
		catch (Exception)
		{
		}
		try
		{
			cmd.CommandText = &quot;drop table baz&quot;;
			cmd.ExecuteNonQuery ();
		}
		catch (Exception)
		{
		}

		cmd.CommandText = &quot;create table foo (FooId int primary key, FooData varchar (100))&quot;;
		cmd.ExecuteNonQuery ();
		cmd.CommandText = &quot;insert into foo values (1, 'foo1')&quot;;
		cmd.ExecuteNonQuery ();

		cmd.CommandText = &quot;create table bar (BarId int primary key, BarData varchar (100))&quot;;
		cmd.ExecuteNonQuery ();
		cmd.CommandText = &quot;insert into bar values (1, 'bar1')&quot;;
		cmd.ExecuteNonQuery ();

		cmd.CommandText = &quot;create table baz (BazId int primary key, BazData varchar (100))&quot;;
		cmd.ExecuteNonQuery ();
		cmd.CommandText = &quot;insert into baz values (1, 'baz1')&quot;;
		cmd.ExecuteNonQuery ();

		cmd.Dispose ();
	}

	private static void RowUpdatingHandler (object sender, SqlRowUpdatingEventArgs e)
	{
		Console.WriteLine (&quot;Updating with command: {0}&quot;, e.Command.CommandText);
	}
}

--------------000207040100090700010406
Content-Type: text/plain;
 name=&quot;out&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;out&quot;

Calling da1.Update() without table parameter.
Caught an exception: 
System.InvalidOperationException: Update unable to find TableMapping['Table'] or DataTable 'Table'.
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet, String srcTable)
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet)
   at Test.Main()
Calling da2.Update() without table parameter.
Caught an exception: 
System.InvalidOperationException: Update unable to find TableMapping['Table'] or DataTable 'Table'.
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet, String srcTable)
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet)
   at Test.Main()
Calling da1.Update() with table name parameter.
Updating with command: UPDATE foo SET FooData = @p1 WHERE ( (FooId = @p2) AND ((FooData IS NULL AND @p3 IS NULL) OR (FooData = @p4)) )
Ok.
Calling da2.Update() with table name parameter.
Updating with command: UPDATE bar SET BarData = @p1 WHERE ( (BarId = @p2) AND ((BarData IS NULL AND @p3 IS NULL) OR (BarData = @p4)) )
Ok.
Once again. Fill a table with the default name.
Calling da1.Update() without table parameter.
Caught an exception: 
System.NullReferenceException: Object reference not set to an instance of an object.
   at Test.RowUpdatingHandler(Object sender, SqlRowUpdatingEventArgs e)
   at System.Data.SqlClient.SqlRowUpdatingEventHandler.Invoke(Object sender, SqlRowUpdatingEventArgs e)
   at System.Data.SqlClient.SqlDataAdapter.OnRowUpdating(RowUpdatingEventArgs value)
   at System.Data.Common.DbDataAdapter.Update(DataRow[] dataRows, DataTableMapping tableMapping)
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet, String srcTable)
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet)
   at Test.Main()
Calling da2.Update() without table parameter.
Caught an exception: 
System.NullReferenceException: Object reference not set to an instance of an object.
   at Test.RowUpdatingHandler(Object sender, SqlRowUpdatingEventArgs e)
   at System.Data.SqlClient.SqlRowUpdatingEventHandler.Invoke(Object sender, SqlRowUpdatingEventArgs e)
   at System.Data.SqlClient.SqlDataAdapter.OnRowUpdating(RowUpdatingEventArgs value)
   at System.Data.Common.DbDataAdapter.Update(DataRow[] dataRows, DataTableMapping tableMapping)
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet, String srcTable)
   at System.Data.Common.DbDataAdapter.Update(DataSet dataSet)
   at Test.Main()
Calling da3.Update() without table parameter.
Updating with command: UPDATE baz SET BazData = @p1 WHERE ( (BazId = @p2) AND ((BazData IS NULL AND @p3 IS NULL) OR (BazData = @p4)) )
Ok.

--------------000207040100090700010406--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="012490.html">[Mono-list] DbDataAdapter.Fill patch
</A></li>
	<LI> Next message: <A HREF="012461.html">[Mono-list] DbDataAdapter Fill When Schema Exists (DbDataAdapter.FillSchema)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12491">[ date ]</a>
              <a href="thread.html#12491">[ thread ]</a>
              <a href="subject.html#12491">[ subject ]</a>
              <a href="author.html#12491">[ author ]</a>
         </LI>
       </UL>
</body></html>
