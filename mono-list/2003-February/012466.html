<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] DbDataAdapter.Fill patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:avd%40openlinksw.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="012456.html">
   <LINK REL="Next"  HREF="012459.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] DbDataAdapter.Fill patch
   </H1>
    <B>Aleksey Demakov
    </B> 
    <A HREF="mailto:avd%40openlinksw.com"
       TITLE="[Mono-list] DbDataAdapter.Fill patch">avd@openlinksw.com
       </A><BR>
    <I>Tue, 25 Feb 2003 15:24:56 +0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="012456.html">[Mono-list] DbDataAdapter.Fill patch
</A></li>
        <LI> Next message: <A HREF="012459.html">[Mono-list] DbDataAdapter.Fill patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12466">[ date ]</a>
              <a href="thread.html#12466">[ thread ]</a>
              <a href="subject.html#12466">[ subject ]</a>
              <a href="author.html#12466">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So what's wrong with it? I think that a DataAdapter at one time
should update only one table. It's absolutely wrong to iterate
through all the tables in the DataSet because the DataAdapter
contains only one set of update commands while different tables
require different commands.

Regards,
Aleksey

Alan Tam wrote:
&gt;<i> The bottom half of the patch has been applied. Thank you.
</I>&gt;<i> 
</I>&gt;<i> For the upper half, we may need more discussion. As far as I've observed, the
</I>&gt;<i> patch changes the code to simulate Microsoft behavior, which seems to be a
</I>&gt;<i> wrong behavior. I wonder if we should follow suit.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Alan
</I>&gt;<i> 
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i> From: &quot;Aleksey Demakov&quot; &lt;<A HREF="mailto:avd@openlinksw.com">avd@openlinksw.com</A>&gt;
</I>&gt;<i> To: &lt;<A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>&gt;
</I>&gt;<i> Sent: Wednesday, January 22, 2003 4:37 AM
</I>&gt;<i> Subject: [Mono-list] DbDataAdapter.Fill patch
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I've found that the DbDataAdapter.Update (DataTable dataTable)
</I>&gt;&gt;<i>and Update (DataSet dataSet, string sourceTable) methods
</I>&gt;&gt;<i>iterate through all tables of the given dataSet and try
</I>&gt;&gt;<i>to update them with this DataAdapter. I believe that
</I>&gt;&gt;<i>this is incorrect.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>The dataSet can contain multiple DataTables which are
</I>&gt;&gt;<i>Filled using different DataAdapters with different
</I>&gt;&gt;<i>select/insert/delete/update commans. Consequently
</I>&gt;&gt;<i>one DataAdapter cannot be be able to perform all the
</I>&gt;&gt;<i>needed updates.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Unfortunately, the .NET docs are silent about this
</I>&gt;&gt;<i>issue. But I believe that DbDataAdapter.Update methods
</I>&gt;&gt;<i>should be symmetric to Fill methods. So as Fill (DataSet)
</I>&gt;&gt;<i>method fills only one DataSet table with default
</I>&gt;&gt;<i>name &quot;Table&quot;, the Update (DataSet) method should
</I>&gt;&gt;<i>only update default table. And Update (DataSet, string)
</I>&gt;&gt;<i>method should only update the specified table.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>The attached patch fixes also another problem.
</I>&gt;&gt;<i>The original code might pass a null DataTableMapping
</I>&gt;&gt;<i>value which is then used to create a RowUpdatingEventArgs
</I>&gt;&gt;<i>instance. So RowUpdatingEvent handler (for instance
</I>&gt;&gt;<i>CommandBuilder) could get null DataTableMapping which
</I>&gt;&gt;<i>might be unexpected. The patch makes sure that a non-null
</I>&gt;&gt;<i>DataTableMapping is passed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Regards,
</I>&gt;&gt;<i>Aleksey
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -------------------------------------------------------------------------------
</I>&gt;<i> -
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>Index: DbDataAdapter.cs
</I>&gt;&gt;<i>===================================================================
</I>&gt;&gt;<i>RCS file: /mono/mcs/class/System.Data/System.Data.Common/DbDataAdapter.cs,v
</I>&gt;&gt;<i>retrieving revision 1.21
</I>&gt;&gt;<i>diff -u -r1.21 DbDataAdapter.cs
</I>&gt;&gt;<i>--- DbDataAdapter.cs 12 Nov 2002 13:47:37 -0000 1.21
</I>&gt;&gt;<i>+++ DbDataAdapter.cs 21 Jan 2003 10:05:50 -0000
</I>&gt;&gt;<i>@@ -356,10 +356,7 @@
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  public override int Update (DataSet dataSet)
</I>&gt;&gt;<i>  {
</I>&gt;&gt;<i>- int result = 0;
</I>&gt;&gt;<i>- foreach (DataTable table in dataSet.Tables)
</I>&gt;&gt;<i>- result += Update (table);
</I>&gt;&gt;<i>- return result;
</I>&gt;&gt;<i>+ return Update (dataSet, &quot;Table&quot;);
</I>&gt;&gt;<i>  }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  public int Update (DataTable dataTable)
</I>&gt;&gt;<i>@@ -447,11 +444,16 @@
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  public int Update (DataSet dataSet, string sourceTable)
</I>&gt;&gt;<i>  {
</I>&gt;&gt;<i>- int result = 0;
</I>&gt;&gt;<i>- DataTableMapping tableMapping = TableMappings [sourceTable];
</I>&gt;&gt;<i>- foreach (DataTable dataTable in dataSet.Tables)
</I>&gt;&gt;<i>- result += Update (dataTable, tableMapping);
</I>&gt;&gt;<i>- return result;
</I>&gt;&gt;<i>+ MissingMappingAction mappingAction = MissingMappingAction;
</I>&gt;&gt;<i>+ if (mappingAction == MissingMappingAction.Ignore)
</I>&gt;&gt;<i>+ mappingAction = MissingMappingAction.Error;
</I>&gt;&gt;<i>+ DataTableMapping tableMapping =
</I>&gt;<i> 
</I>&gt;<i> DataTableMappingCollection.GetTableMappingBySchemaAction (TableMappings,
</I>&gt;<i> sourceTable, sourceTable, mappingAction);
</I>&gt;<i> 
</I>&gt;&gt;<i>+
</I>&gt;&gt;<i>+ DataTable dataTable = dataSet.Tables[tableMapping.DataSetTable];
</I>&gt;&gt;<i>+ if (dataTable == null)
</I>&gt;&gt;<i>+     throw new ArgumentException (&quot;sourceTable&quot;);
</I>&gt;&gt;<i>+
</I>&gt;&gt;<i>+ return Update (dataTable, tableMapping);
</I>&gt;&gt;<i>  }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  protected virtual void OnFillError (FillErrorEventArgs value)
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="012456.html">[Mono-list] DbDataAdapter.Fill patch
</A></li>
	<LI> Next message: <A HREF="012459.html">[Mono-list] DbDataAdapter.Fill patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12466">[ date ]</a>
              <a href="thread.html#12466">[ thread ]</a>
              <a href="subject.html#12466">[ subject ]</a>
              <a href="author.html#12466">[ author ]</a>
         </LI>
       </UL>
</body></html>
