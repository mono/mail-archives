<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Bug in XmlSerializer and tiny bugfix
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:efeingold%40mn.rr.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="012369.html">
   <LINK REL="Next"  HREF="012360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Bug in XmlSerializer and tiny bugfix
   </H1>
    <B>Elan Feingold
    </B> 
    <A HREF="mailto:efeingold%40mn.rr.com"
       TITLE="[Mono-list] Bug in XmlSerializer and tiny bugfix">efeingold@mn.rr.com
       </A><BR>
    <I>Thu, 20 Feb 2003 19:49:14 -0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="012369.html">[Mono-list] VB Code and compiler
</A></li>
        <LI> Next message: <A HREF="012360.html">[Mono-list] c# serialization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12359">[ date ]</a>
              <a href="thread.html#12359">[ thread ]</a>
              <a href="subject.html#12359">[ subject ]</a>
              <a href="author.html#12359">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_0092_01C2D919.25E01F10
Content-Type: text/plain;
	charset=&quot;us-ascii&quot;
Content-Transfer-Encoding: 7bit

Hi,

I'm not sure why, but XmlSerializer.Serialize(Stream stream, object o)
is broken and produces garbage. Attached is a file that demonstrates the
problem.

In contrast, using XmlSerializer.Serialize(TextWriter textWriter, object
o) works fine.

I poked around for a little bit, but failed to turn up anything obvious,
proving the fact that I'm a newbie to the project.

I did fix one bug to the Serializer for Enum types. I added the
following code to XmlSerializer.cs and verified that the output matched
the output under .NET.

Best regards,

-elan

*** 558,564 ****
                        }
                        else if (type.IsEnum)
                        {
!                               // FIXME
                        }
                        else
                        { //Complex Type
--- 558,564 ----
                        }
                        else if (type.IsEnum)
                        {
!                 writer.WriteString(GetXmlValue(value));
                        }
                        else
                        { //Complex Type

------=_NextPart_000_0092_01C2D919.25E01F10
Content-Type: text/plain;
	name=&quot;test.cs&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;test.cs&quot;

using System;=0A=
using System.IO;=0A=
using System.Xml;=0A=
using System.Xml.Serialization;=0A=
using System.Text;=0A=
=0A=
// Items in the shopping list=0A=
public class Item =0A=
{=0A=
    public RequestType Type;=0A=
    public Guid RequestId;=0A=
    public bool KeepAlive;=0A=
    public string Trove;=0A=
    public string Data;=0A=
=0A=
    public enum RequestType { List, Get }=0A=
=0A=
    public Item() {}=0A=
    public Item(RequestType type,=0A=
                Guid        requestId,=0A=
                bool        keepAlive,=0A=
                string      trove,=0A=
                string      data) =0A=
    {=0A=
        Type =3D type;=0A=
        RequestId =3D requestId;=0A=
        KeepAlive =3D keepAlive;=0A=
        Trove =3D trove;=0A=
        Data =3D data;=0A=
    }=0A=
}=0A=
=0A=
public class MainClass=0A=
{=0A=
    static void Main ()=0A=
    {=0A=
        Item item =3D new Item(Item.RequestType.List, =0A=
                             Guid.NewGuid(), =0A=
                             true, =0A=
                             &quot;Trove-1&quot;, =0A=
                             &quot;blah&quot;);=0A=
        =0A=
        // Serialization=0A=
        XmlSerializer s =3D new XmlSerializer(typeof(Item));=0A=
        =0A=
        // This doesn't work!=0A=
        MemoryStream mem =3D new MemoryStream();=0A=
        s.Serialize(mem, item);=0A=
        Console.WriteLine(&quot;The data: {0}&quot;, =
Encoding.ASCII.GetString(mem.ToArray()));=0A=
=0A=
        // This works!=0A=
        StringWriter w =3D new StringWriter();=0A=
        s.Serialize(w, item);=0A=
        Console.WriteLine(&quot;The data: {0}&quot;, =
w.GetStringBuilder().ToString());=0A=
        =0A=
        // Deserialization -- NOT IMPLEMENTED.=0A=
        //Item newItem;=0A=
        //TextReader r =3D new StreamReader( &quot;item.xml&quot; );=0A=
        //newItem =3D (Item)s.Deserialize(r);=0A=
        //r.Close();=0A=
    }=0A=
}=0A=

------=_NextPart_000_0092_01C2D919.25E01F10--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="012369.html">[Mono-list] VB Code and compiler
</A></li>
	<LI> Next message: <A HREF="012360.html">[Mono-list] c# serialization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12359">[ date ]</a>
              <a href="thread.html#12359">[ thread ]</a>
              <a href="subject.html#12359">[ subject ]</a>
              <a href="author.html#12359">[ author ]</a>
         </LI>
       </UL>
</body></html>
