<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] -- Math.cs --
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:yoros%40wanadoo.es">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="011804.html">
   <LINK REL="Next"  HREF="011782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] -- Math.cs --
   </H1>
    <B>yoros@wanadoo.es
    </B> 
    <A HREF="mailto:yoros%40wanadoo.es"
       TITLE="[Mono-list] -- Math.cs --">yoros@wanadoo.es
       </A><BR>
    <I>Sun, 2 Feb 2003 01:28:30 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="011804.html">[Mono-list] mod_mono permission denied
</A></li>
        <LI> Next message: <A HREF="011782.html">[Mono-list] Future of JIT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11772">[ date ]</a>
              <a href="thread.html#11772">[ thread ]</a>
              <a href="subject.html#11772">[ subject ]</a>
              <a href="author.html#11772">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--J/dobhs11T7y2rNN
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit


Hi,

I have a great, great problem with the last Math.cs I sent, forget it,
please. Please get this one.

Thank you, and sorry, again.

    Pedro

-- 
Pedro Martinez Juliá
\  <A HREF="mailto:yoros@terra.es">yoros@terra.es</A>
)|    <A HREF="mailto:yoros@wanadoo.es">yoros@wanadoo.es</A>
/        <A HREF="http://yoros.cjb.net">http://yoros.cjb.net</A>
Socio HispaLinux #311
Usuario Linux #275438 - <A HREF="http://counter.li.org">http://counter.li.org</A>
GnuPG public information:  pub  1024D/74F1D3AC
Key fingerprint = 8431 7B47 D2B4 5A46 5F8E  534F 588B E285 74F1 D3AC

--J/dobhs11T7y2rNN
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: attachment; filename=&quot;Math.cs.patch&quot;
Content-Transfer-Encoding: 8bit

Index: Math.cs
===================================================================
RCS file: /mono/mcs/class/corlib/System/Math.cs,v
retrieving revision 1.15
diff -u -p -r1.15 Math.cs
--- Math.cs	24 Jan 2003 16:10:01 -0000	1.15
+++ Math.cs	2 Feb 2003 00:25:24 -0000
@@ -4,8 +4,10 @@
 // Author:
 //   Bob Smith (<A HREF="mailto:bob@thestuff.net">bob@thestuff.net</A>)
 //   Dan Lewis (<A HREF="mailto:dihlewis@yahoo.co.uk">dihlewis@yahoo.co.uk</A>)
+//   Pedro Martínez Juliá (<A HREF="mailto:yoros@wanadoo.es">yoros@wanadoo.es</A>)
 //
 // (C) 2001 Bob Smith.  <A HREF="http://www.thestuff.net">http://www.thestuff.net</A>
+// Copyright (C) 2003 Pedro Martínez Juliá &lt;<A HREF="mailto:yoros@wanadoo.es">yoros@wanadoo.es</A>&gt;
 //
 
 using System;
@@ -62,37 +64,16 @@ namespace System
 
                 public static double Ceiling(double a)
                 {
-			if (Double.IsNaN(a)){
-				return Double.NaN;
-			}
-
-			if (Double.IsNegativeInfinity(a)){
-				return Double.NegativeInfinity;
-			}
-
-			if (Double.IsPositiveInfinity(a)){
-				return Double.PositiveInfinity;
-			}
-
-			double b = (double)((long)a);
-                        return (b &lt; a)? b+1: b;
-                }
-                public static double Floor(double d) {
-			if (Double.IsNaN(d)){
-				return Double.NaN;
-			}
-
-			if (Double.IsNegativeInfinity(d)){
-				return Double.NegativeInfinity;
-			}
-
-			if (Double.IsPositiveInfinity(d)){
-				return Double.PositiveInfinity;
-			}
-
-			double b = (double)((long)d);
-			return (d &lt; 0 &amp;&amp; d != b) ? --b : b;
+                        double result = Floor(a);
+                        if (result != a) {
+                                result++;
+                        }
+                        return result;
                 }
+
+                [MethodImplAttribute (MethodImplOptions.InternalCall)]
+                public extern static double Floor (double value);
+
                 public static double IEEERemainder(double x, double y)
                 {
                         double r;
@@ -215,44 +196,16 @@ namespace System
 
                 public static decimal Round(decimal d)
                 {
-                        decimal r = (decimal)((long)d);
-                        decimal a = Abs (d - r);
-                        if (a &gt; .5M) return (r &gt;= 0 ? ++r : --r);
-                        else if (a &lt;.5M) return r;
-                        else
-                        {
-                                if (r%2 == 0) return r;
-                                else return ++r;
-                        }
+                        return Decimal.Round(d, 0);
                 }
                 public static decimal Round(decimal d, int decimals)
                 {
-                        long p = 1;
-                        int c;
-                        decimal retval = d;
-                        if (decimals &lt; 0 || decimals &gt; 15)
-                                throw new ArgumentOutOfRangeException(Locale.GetText (
-					&quot;Value is too small or too big.&quot;));
-                        else if (decimals == 0)
-                                return Math.Round(d);
-                        for (c=0; c&lt;decimals; c++) p*=10;
-                        retval*=p;
-                        retval=Math.Round(retval);
-                        retval/=p;
-                        return retval;
-                }
-                public static double Round(double d)
-                {
-                        double r = (double)((long)d);
-                        double a = Abs (d - r);
-                        if (a &gt; .5) return (r &gt;= 0 ? ++r : --r);
-                        else if (a &lt;.5) return r;
-                        else
-                        {
-                                if (r%2 == 0) return r;
-                                else return ++r;
-                        }
+                        return Decimal.Round(d, decimals);
                 }
+
+                [MethodImplAttribute (MethodImplOptions.InternalCall)]
+                public extern static double Round(double d);
+
                 public static double Round(double value, int digits) {
                         long p = 1;
                         int c;
@@ -262,7 +215,7 @@ namespace System
 					&quot;Value is too small or too big.&quot;));
                         else if (digits == 0)
                                 return Math.Round(value);
-                        for (c=0; c&lt;digits; c++) p*=10;
+                        p = (long) Math.Pow(10, digits);
                         retval*=p;
                         retval=Math.Round(retval);
                         retval/=p;
@@ -275,11 +228,15 @@ namespace System
                 }
                 public static int Sign(double value)
                 {
+                        if (Double.IsNaN(value))
+                                throw new ArithmeticException(&quot;NAN&quot;);
                         if (value &gt; 0) return 1;
                         return (value == 0)? 0: -1;
                 }
                 public static int Sign(float value)
                 {
+                        if (Single.IsNaN(value))
+                                throw new ArithmeticException(&quot;NAN&quot;);
                         if (value &gt; 0) return 1;
                         return (value == 0)? 0: -1;
                 }

--J/dobhs11T7y2rNN--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="011804.html">[Mono-list] mod_mono permission denied
</A></li>
	<LI> Next message: <A HREF="011782.html">[Mono-list] Future of JIT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11772">[ date ]</a>
              <a href="thread.html#11772">[ thread ]</a>
              <a href="subject.html#11772">[ subject ]</a>
              <a href="author.html#11772">[ author ]</a>
         </LI>
       </UL>
</body></html>
