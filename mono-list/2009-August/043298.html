<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] GLib Critical Error at attemting to embed Mono (and other minor troubles).
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20GLib%20Critical%20Error%20at%20attemting%20to%20embed%20Mono%20%28and%0A%20other%20minor%20troubles%29.&In-Reply-To=25108056.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043288.html">
   <LINK REL="Next"  HREF="043299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] GLib Critical Error at attemting to embed Mono (and other minor troubles).</H1>
    <B>Lucyberad</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20GLib%20Critical%20Error%20at%20attemting%20to%20embed%20Mono%20%28and%0A%20other%20minor%20troubles%29.&In-Reply-To=25108056.post%40talk.nabble.com"
       TITLE="[Mono-list] GLib Critical Error at attemting to embed Mono (and other minor troubles).">Lucyberad at gmail.com
       </A><BR>
    <I>Mon Aug 24 07:04:18 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="043288.html">[Mono-list] GLib Critical Error at attemting to embed Mono (and other minor troubles).
</A></li>
        <LI>Next message: <A HREF="043299.html">[Mono-list] GLib Critical Error at attemting to embed Mono (and other minor troubles).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43298">[ date ]</a>
              <a href="thread.html#43298">[ thread ]</a>
              <a href="subject.html#43298">[ subject ]</a>
              <a href="author.html#43298">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I've made some further test. This time on Unix system (fresh install with
mono --version producing 2.4.2.3).
After checking my helloworld.exe is launching well (which is the case),
updating all path: mono_set_dirs(&quot;/usr/etc&quot;, &quot;usr/lib&quot;) and my const char*
file.
I launch it and it produce the following output:

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">lucyberad at VMBuntu</A>:~/Desktop/mono test$ g++ main.cpp `pkg-config --cflags
--libs mono`
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">lucyberad at VMBuntu</A>:~/Desktop/mono test$ ./a.out
(process:20855): GLib-CRITICAL **: g_path_is_absolute: assertion `file_name
!= NULL' failed

(process:20855): GLib-CRITICAL **: g_path_get_basename: assertion `file_name
!= NULL' failed
Stacktrace:


Native stacktrace:

    /usr/lib/libmono.so.0 [0xb7dfd162]
    /usr/lib/libmono.so.0 [0xb7e1db03]
    [0xb800a410]
    /usr/lib/libmono.so.0(mono_jit_exec+0x62) [0xb7de8882]
    ./a.out(main+0xe6) [0x8048bb6]
    /lib/tls/i686/cmov/libc.so.6(__libc_start_main+0xe5) [0xb7a37775]
    ./a.out [0x80489e1]

Debug info from gdb:

[Thread debugging using libthread_db enabled]
[New Thread 0xb79ed6f0 (LWP 20855)]
[New Thread 0xb7357b90 (LWP 20857)]
[New Thread 0xb737bb90 (LWP 20856)]
0xb800a422 in __kernel_vsyscall ()
  3 Thread 0xb737bb90 (LWP 20856)  0xb800a422 in __kernel_vsyscall ()
  2 Thread 0xb7357b90 (LWP 20857)  0xb800a422 in __kernel_vsyscall ()
  1 Thread 0xb79ed6f0 (LWP 20855)  0xb800a422 in __kernel_vsyscall ()

Thread 3 (Thread 0xb737bb90 (LWP 20856)):
#0  0xb800a422 in __kernel_vsyscall ()
#1  0xb7d7d8f6 in nanosleep () from /lib/tls/i686/cmov/libpthread.so.0
#2  0xb7ef2ce8 in ?? () from /usr/lib/libmono.so.0
#3  0xb7d764ff in start_thread () from /lib/tls/i686/cmov/libpthread.so.0
#4  0xb7b0549e in clone () from /lib/tls/i686/cmov/libc.so.6

Thread 2 (Thread 0xb7357b90 (LWP 20857)):
#0  0xb800a422 in __kernel_vsyscall ()
#1  0xb7d7a0e5 in pthread_cond_wait@@GLIBC_2.3.2 ()
   from /lib/tls/i686/cmov/libpthread.so.0
#2  0xb7ef6017 in ?? () from /usr/lib/libmono.so.0
#3  0xb7ef8c04 in ?? () from /usr/lib/libmono.so.0
#4  0xb7ef8c6c in ?? () from /usr/lib/libmono.so.0
#5  0xb7f13512 in ?? () from /usr/lib/libmono.so.0
#6  0xb7e72e3e in ?? () from /usr/lib/libmono.so.0
#7  0xb7e97ebf in ?? () from /usr/lib/libmono.so.0
#8  0xb7f0edc6 in ?? () from /usr/lib/libmono.so.0
#9  0xb7f33007 in ?? () from /usr/lib/libmono.so.0
#10 0xb7d764ff in start_thread () from /lib/tls/i686/cmov/libpthread.so.0
#11 0xb7b0549e in clone () from /lib/tls/i686/cmov/libc.so.6

Thread 1 (Thread 0xb79ed6f0 (LWP 20855)):
#0  0xb800a422 in __kernel_vsyscall ()
#1  0xb7d7d0fb in read () from /lib/tls/i686/cmov/libpthread.so.0
#2  0xb7dfd29e in ?? () from /usr/lib/libmono.so.0
#3  0xb7e1db03 in ?? () from /usr/lib/libmono.so.0
#4  &lt;signal handler called&gt;
#5  0xb7e564e3 in mono_runtime_run_main () from /usr/lib/libmono.so.0
#6  0xb7de8882 in mono_jit_exec () from /usr/lib/libmono.so.0
#7  0x08048bb6 in main ()
#0  0xb800a422 in __kernel_vsyscall ()

=================================================================
Got a SIGSEGV while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries
used by your application.
=================================================================

Abandon
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">lucyberad at VMBuntu</A>:~/Desktop/mono test$ 


I hope this will help.
Lucyberad


Lucyberad wrote:
&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Lucyberad wrote:
</I>&gt;&gt;&gt;<i> I got an assertion error on mono_jit_exec. The console output an error
</I>&gt;&gt;&gt;<i> from
</I>&gt;&gt;&gt;<i> Glib:
</I>&gt;&gt;&gt;<i> <A HREF="http://www.nabble.com/file/p25093790/visual_mono_glib_asssertion_error.png">http://www.nabble.com/file/p25093790/visual_mono_glib_asssertion_error.png</A> 
</I>&gt;&gt;&gt;<i> (right-click: show image to view it fullsize)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Are you calling mono_set_dirs ()? If yes, post the code.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> More than this errors, I had many troubles at embeding Mono.
</I>&gt;&gt;&gt;<i> The first is about linking to a library:
</I>&gt;&gt;&gt;<i> mono_domain_assembly_open(domain,
</I>&gt;&gt;&gt;<i> file) don't work if the mscorlib.dll library file is not located to
</I>&gt;&gt;&gt;<i> &quot;../lib/mono/1.0/mscorlib.dll&quot; (relative to the main exe). I made a copy
</I>&gt;&gt;&gt;<i> of
</I>&gt;&gt;&gt;<i> this dll to the path but I don't know how to put it on the same folder
</I>&gt;&gt;&gt;<i> than
</I>&gt;&gt;&gt;<i> the exe (or use this dll as static). In fact, I don't really know what
</I>&gt;&gt;&gt;<i> to do
</I>&gt;&gt;&gt;<i> with this dll. If my memory is good, it's the main dll of .NET langage.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The assembly must be placed in $libdir/mono/x.x/, where $libdir
</I>&gt;&gt;<i> is the directory you've passed to mono_set_dirs ().
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> No, I don't call mono_set_dirs(). The result console in screenshot is the
</I>&gt;<i> code you see in VC behind (with mono_set_dirs commented).
</I>&gt;<i> I've un-comment mono_set_dirs to this:
</I>&gt;<i> mono_set_dirs(&quot;C:\\Program Files (x86)\\Mono-2.4.2.3\\lib\\&quot;, &quot;C:\\Program
</I>&gt;<i> Files (x86)\\Mono-2.4.2.3\\etc\\&quot;);
</I>&gt;<i> and it don't works better than before (always glib error) but this time I
</I>&gt;<i> don't need to care about mscorlib.dll. If I understand well, it tells
</I>&gt;<i> where to find mscorlib.dll. So, to release the app I need to move each
</I>&gt;<i> asked dll to a subfolder (and keep directory hierarchy) with
</I>&gt;<i> mono_set_dirs(&quot;./lib&quot;, &quot;./etc&quot;) where '.' is in fact the current folder
</I>&gt;<i> (working directory)?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> The second is about understanding why compiler can't recognize
</I>&gt;&gt;&gt;<i> mono_config_parse() but I finally found it in mono-config.h (which is
</I>&gt;&gt;&gt;<i> not
</I>&gt;&gt;&gt;<i> shown 
</I>&gt;&gt;&gt;<i> <A HREF="http://anonsvn.mono-project.com/viewvc/trunk/mono/samples/embed/teste.c?&amp;view=markup">http://anonsvn.mono-project.com/viewvc/trunk/mono/samples/embed/teste.c?&amp;view=markup</A>
</I>&gt;&gt;&gt;<i> in sample ). 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> So this is solved.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> It is, but I mention it to say that the sample is not up-to-date and
</I>&gt;<i> compilable.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> The third is why is mscorlib.dll in &quot;mono/1.0/&quot;. Does it means I try to
</I>&gt;&gt;&gt;<i> embed Mono1.0 instead of 2.0 (or 2.4)?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yes. This is because you've compiled the assembly with mcs. If you
</I>&gt;&gt;<i> want .NET 2.0, you must use gmcs.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Ok, I didn't know. (for people looking for more information, I found this
</I>&gt;<i> wiki thread talking about it:  <A HREF="http://www.mono-project.com/CSharp_Compiler">http://www.mono-project.com/CSharp_Compiler</A>
</I>&gt;<i> <A HREF="http://www.mono-project.com/CSharp_Compiler">http://www.mono-project.com/CSharp_Compiler</A> ).
</I>&gt;<i> I've compiled with gmcs (because I plan to use C# 3.0 or 3.5
</I>&gt;<i> implementation) and GLib error is still here.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> The last is why the path of my file must be absolute and not relative?
</I>&gt;&gt;&gt;<i> If I
</I>&gt;&gt;&gt;<i> do relative, the assembly var is = 0. Can't I just call with
</I>&gt;&gt;&gt;<i> &quot;helloworld.exe&quot; (or &quot;./helloworld.exe&quot;)?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I don't understand this sentence. You seem to be speaking about
</I>&gt;&gt;<i> some source code you didn't share with us.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Robert
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Sorry, i'm not an english native-speaker.
</I>&gt;<i> So, I mean why Mono don't handle relative path? As you see on the
</I>&gt;<i> screenshot
</I>&gt;<i> (<A HREF="http://www.nabble.com/file/p25093790/visual_mono_glib_asssertion_error.png">http://www.nabble.com/file/p25093790/visual_mono_glib_asssertion_error.png</A>),
</I>&gt;<i> I give the path of my file in absolute way:
</I>&gt;<i> const char* file = &quot;C:\\Users\\Lucyberad\\Documents\\Visual Studio
</I>&gt;<i> 2008\\OtherProject\\SandboxMono\\Builds\\Debug\\helloworld.exe&quot;;
</I>&gt;<i> I want to do:
</I>&gt;<i> const char* file = &quot;helloworld.exe&quot;; or const char* file =
</I>&gt;<i> &quot;./helloworld.exe&quot;;
</I>&gt;<i> This allow me to make the program runnable on an other computer than mine.
</I>&gt;<i> I'll make a &quot;trick&quot; which transform a relative path into an absolute path
</I>&gt;<i> but I'm suprised that there is no relative path allowed as input in Mono
</I>&gt;<i> Path (mono_set_dirs() or mono_domain_assembly_open()).
</I>&gt;<i> I'm not sure if it's more about C++ than Mono.
</I>&gt;<i> Probably it will no longer be a problem for me because I plan to use AOT
</I>&gt;<i> and use Bundles (I don't know yet exactly how it works, but I actually
</I>&gt;<i> focus on making a simple helloworld working on embed app).
</I>&gt;<i> 
</I>&gt;<i> -----------------------
</I>&gt;<i> 
</I>&gt;<i> More info on GLib error (maybe it will help): The only link I made is to
</I>&gt;<i> mono.lib, created from mono.dll with mono.def file. I've made a copy of
</I>&gt;<i> mono.dll, libgthread-2.0-0.dll &amp; libglib-2.0-0.dll into the working
</I>&gt;<i> directory.
</I>&gt;<i> 
</I>&gt;<i> I attached to this thread the 
</I>&gt;<i> <A HREF="http://www.nabble.com/file/p25108056/main.cpp">http://www.nabble.com/file/p25108056/main.cpp</A> main.cpp  file.
</I>&gt;<i> 
</I>&gt;<i> Thanks for help,
</I>&gt;<i> Lucyberad.
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://www.nabble.com/GLib-Critical-Error-at-attemting-to-embed-Mono-%28and-other-minor-troubles%29.-tp25093790p25114083.html">http://www.nabble.com/GLib-Critical-Error-at-attemting-to-embed-Mono-%28and-other-minor-troubles%29.-tp25093790p25114083.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043288.html">[Mono-list] GLib Critical Error at attemting to embed Mono (and other minor troubles).
</A></li>
	<LI>Next message: <A HREF="043299.html">[Mono-list] GLib Critical Error at attemting to embed Mono (and other minor troubles).
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43298">[ date ]</a>
              <a href="thread.html#43298">[ thread ]</a>
              <a href="subject.html#43298">[ subject ]</a>
              <a href="author.html#43298">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
