<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] gc handles not thread safe?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20gc%20handles%20not%20thread%20safe%3F&In-Reply-To=%3CCABJreosUAG6z6GroXEyfejfbKLhng6RazZi03tNewFtVbZ3bEg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="050395.html">
   <LINK REL="Next"  HREF="050393.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] gc handles not thread safe?</H1>
    <B>Chris Ochs</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20gc%20handles%20not%20thread%20safe%3F&In-Reply-To=%3CCABJreosUAG6z6GroXEyfejfbKLhng6RazZi03tNewFtVbZ3bEg%40mail.gmail.com%3E"
       TITLE="[Mono-list] gc handles not thread safe?">chris at ochsnet.com
       </A><BR>
    <I>Thu Oct 17 02:56:50 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="050395.html">[Mono-list] Embedded Mono and using HtmlTextWriter
</A></li>
        <LI>Next message: <A HREF="050393.html">[Mono-list] gc handles not thread safe?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50392">[ date ]</a>
              <a href="thread.html#50392">[ thread ]</a>
              <a href="subject.html#50392">[ subject ]</a>
              <a href="author.html#50392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm embedding mono in a java app and when using gchandles it's obvious that
memory is getting stomped on somehow.  When I don't use gc handles, or just
use gc handles within a single thread, everything is fine.

The same gc handle is never accessed concurrently from different threads,
although I do pass them around to different threads.

Reading/writing memory streams triggers the problem regularly, it usually
segfaults in BlockCopy with various errors about the stream not containing
the expected data, or sometimes division by zero.

I'm fairly sure the code that handles threading is not at fault, I'm using
Akka which has a well established concurrency model I don't explicitly
create any threads myself.

FYI I see this in mono 2 and the latest mono 3 from master.

Is there another technique I can use to keep a MonoObject around and keep
the gc from collecting it without using gc handles?   I was thinking of
just having a thread safe dictionary in C# that keeps references to these
objects, and just make all my calls into managed code via static methods
that can get the object and call methods on it in C#.

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20131016/c8daabe8/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20131016/c8daabe8/attachment.html</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="050395.html">[Mono-list] Embedded Mono and using HtmlTextWriter
</A></li>
	<LI>Next message: <A HREF="050393.html">[Mono-list] gc handles not thread safe?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50392">[ date ]</a>
              <a href="thread.html#50392">[ thread ]</a>
              <a href="subject.html#50392">[ subject ]</a>
              <a href="author.html#50392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
