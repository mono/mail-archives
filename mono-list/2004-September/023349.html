<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Label stops updating during System.Timers.Timer callbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Jimmy%20Do%20%3Ccrispyleaves%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="023474.html">
   <LINK REL="Next"  HREF="023353.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Label stops updating during System.Timers.Timer callbacks
   </H1>
    <B>Jimmy Do
    </B> 
    <A HREF="mailto:Jimmy%20Do%20%3Ccrispyleaves%40gmail.com%3E"
       TITLE="[Mono-list] Label stops updating during System.Timers.Timer callbacks">Jimmy Do &lt;crispyleaves@gmail.com&gt;
       </A><BR>
    <I>Tue, 21 Sep 2004 16:28:40 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="023474.html">[Mono-list] Re: [Gtk-sharp-list] Brazilian Gtk# developers?
</A></li>
        <LI> Next message: <A HREF="023353.html">[Mono-list] Re: Visual Studio Addin for Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23349">[ date ]</a>
              <a href="thread.html#23349">[ thread ]</a>
              <a href="subject.html#23349">[ subject ]</a>
              <a href="author.html#23349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ah, I see. I hadn't considered that. Some have suggested using
Gtk.Timeout instead of System.Timers.Timer so I'll look into that
instead.

Thanks!

Just curious though...in what situation can we use a
System.Timers.Timer with a GUI widget? Only with WinForms?


Jimmy


On Tue, 21 Sep 2004 19:25:13 +0200, Chris Turchin &lt;<A HREF="mailto:chris@turchin.net">chris@turchin.net</A>&gt; wrote:
&gt;<i> I think this is because the gui in gtk apps must be updated by the main
</I>&gt;<i> thread and the timer call is probably happening elsewhere, but you'd
</I>&gt;<i> best wait for a more authorative response from someone who really knows
</I>&gt;<i> gtk...
</I>&gt;<i> 
</I>&gt;<i> from the FAQ (<A HREF="http://gtk-sharp.sourceforge.net/faq.html">http://gtk-sharp.sourceforge.net/faq.html</A>):
</I>&gt;<i> 
</I>&gt;<i> 3.5  Why does my multithreaded app hang?
</I>&gt;<i> Gtk# is not threadsafe. Neither is System.Windows.Forms. Gtk+ is &quot;thread
</I>&gt;<i> aware&quot; and provides a mechanism for locking and unlocking the UI
</I>&gt;<i> updates, but you are still responsible for ensuring that all updates to
</I>&gt;<i> the GUI come from the main thread where you called Run (). Gtk# provides
</I>&gt;<i> a helper class called ThreadNotify to assist in the context switch from
</I>&gt;<i> different threads to the GUI thread. In addition, using an Idle handler
</I>&gt;<i> or a GLib.TimeoutHandler with a very short interval will ensure the
</I>&gt;<i> context switch.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, 2004-09-21 at 08:53 -0700, Jimmy Do wrote:
</I>&gt;<i> &gt; Hi everyone,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I was just experimenting with System.Timers.Timer in Mono and found
</I>&gt;<i> &gt; something strange happening. First, I created a window with a Label in
</I>&gt;<i> &gt; it. Then I setup a Timer to go off every second. In the
</I>&gt;<i> &gt; ElapsedEventHandler callback, I set the label's text equal to a
</I>&gt;<i> &gt; counter that I increment every time the callback is invoked. The
</I>&gt;<i> &gt; application works for a little bit and I see the label counting up
</I>&gt;<i> &gt; from 1, but the label eventually stops updating. Strangely, some debug
</I>&gt;<i> &gt; output with Console.WriteLine shows that the callback is still being
</I>&gt;<i> &gt; invoked.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The label usually stops updating after I *drag the parent window
</I>&gt;<i> &gt; around the screen*. After it stops updating, if you drag a second
</I>&gt;<i> &gt; window on top of the label and then move the window away, the label
</I>&gt;<i> &gt; will not redraw and you'll be left with an empty parent window.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Some info about my setup:
</I>&gt;<i> &gt; Mono 1.0.1
</I>&gt;<i> &gt; MonoDevelop 0.5
</I>&gt;<i> &gt; Fedora Core 2
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Here's the code:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; //////////////////////
</I>&gt;<i> &gt; // Main.cs
</I>&gt;<i> &gt; //////////////////////
</I>&gt;<i> &gt; using System;
</I>&gt;<i> &gt; using Gtk;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; class TimerApp
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt;       public static void Main(string[] args)
</I>&gt;<i> &gt;       {
</I>&gt;<i> &gt;               Application.Init();
</I>&gt;<i> &gt;               new TimerWindow();
</I>&gt;<i> &gt;               Application.Run();
</I>&gt;<i> &gt;       }
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; //////////////////////////////
</I>&gt;<i> &gt; // TimerWindow.cs
</I>&gt;<i> &gt; //////////////////////////////
</I>&gt;<i> &gt; using System;
</I>&gt;<i> &gt; using System.Timers;
</I>&gt;<i> &gt; using Gtk;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; public class TimerWindow : Window
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;       public TimerWindow() : base(&quot;TimerWindow&quot;)
</I>&gt;<i> &gt;       {
</I>&gt;<i> &gt;               this.DeleteEvent += new DeleteEventHandler(OnWindowDelete);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               VBox vbox = new VBox();
</I>&gt;<i> &gt;               myCountLabel = new Label(&quot;-&quot;);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               vbox.PackStart(new Label(&quot;The number below will count up:&quot;));
</I>&gt;<i> &gt;               vbox.PackStart(myCountLabel);
</I>&gt;<i> &gt;               this.Add(vbox);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               myCounter = 0;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               Timer timer = new Timer();
</I>&gt;<i> &gt;               timer.Interval = 500;
</I>&gt;<i> &gt;               timer.Elapsed += new ElapsedEventHandler(OnTimeElapsed);
</I>&gt;<i> &gt;               timer.Start();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               this.ShowAll();
</I>&gt;<i> &gt;       }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;       private void OnWindowDelete(object o, DeleteEventArgs args)
</I>&gt;<i> &gt;       {
</I>&gt;<i> &gt;               Application.Quit();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;       }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;       private void OnTimeElapsed(object o, ElapsedEventArgs args)
</I>&gt;<i> &gt;       {
</I>&gt;<i> &gt;               myCounter++;
</I>&gt;<i> &gt;               myCountLabel.Text = myCounter.ToString();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               Console.WriteLine(myCounter.ToString());
</I>&gt;<i> &gt;       }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;       private int myCounter;
</I>&gt;<i> &gt;       private Label myCountLabel;
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks for any help!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Jimmy
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> --
</I>&gt;<i> Chris Turchin &lt;<A HREF="mailto:chris@turchin.net">chris@turchin.net</A>&gt;
</I>&gt;<i> 
</I>&gt;<i>
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="023474.html">[Mono-list] Re: [Gtk-sharp-list] Brazilian Gtk# developers?
</A></li>
	<LI> Next message: <A HREF="023353.html">[Mono-list] Re: Visual Studio Addin for Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23349">[ date ]</a>
              <a href="thread.html#23349">[ thread ]</a>
              <a href="subject.html#23349">[ subject ]</a>
              <a href="author.html#23349">[ author ]</a>
         </LI>
       </UL>
</body></html>
