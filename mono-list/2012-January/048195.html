<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] dot issues with system.net.mail.smtpclient
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20dot%20issues%20with%20system.net.mail.smtpclient&In-Reply-To=%3C1327938760.22579.11.camel%40DMICT-LNX-PH%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048194.html">
   <LINK REL="Next"  HREF="048196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] dot issues with system.net.mail.smtpclient</H1>
    <B>Peter Hagen</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20dot%20issues%20with%20system.net.mail.smtpclient&In-Reply-To=%3C1327938760.22579.11.camel%40DMICT-LNX-PH%3E"
       TITLE="[Mono-list] dot issues with system.net.mail.smtpclient">peter at wingsofdeath.net
       </A><BR>
    <I>Mon Jan 30 15:52:40 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="048194.html">[Mono-list] What happened to Monologue?
</A></li>
        <LI>Next message: <A HREF="048196.html">[Mono-list] Xbuild fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48195">[ date ]</a>
              <a href="thread.html#48195">[ thread ]</a>
              <a href="subject.html#48195">[ subject ]</a>
              <a href="author.html#48195">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

Today I finally found my problem that occurs with sending my mailings.
To be brief, I send emails with alternativeview's containing one with
html and one with plain text. The html has links to images, and while it
mostly goes well, it sometimes fails. After checking the sources of
those emails, I discovered that a line, starting with a dot, is not
escaped with a dot. As an example here a part of the html:

/tr&gt;&lt;tr id=3D&quot;row1&quot;&gt;&lt;td width=3D&quot;50px&quot; nowrap=3D&quot;on&quot; align=3D&quot;center&quot;
valig=
n=3D&quot;middle&quot;&gt;&lt;a
href=3D&quot;<A HREF="http://www.wingsofdeath.net/content/16,18329">http://www.wingsofdeath.net/content/16,18329</A>&quot;&gt;&lt;img =
src=3D&quot;<A HREF="http://www.wingsofdeath.net/cache/56178e3b58687a9e048d72ec93219b8b/2=">http://www.wingsofdeath.net/cache/56178e3b58687a9e048d72ec93219b8b/2=</A>
20120126095140.45x45.image001.jpg&quot; border=3D&quot;0&quot; /&gt;

this is how its being received by the client. The filename should be:

2.20120126095140.45x45.image001.jpg

the dot falls incidentally on the first character. I checked the output
of mono to the mailserver with wireshark, and there the dot is visible.
While looking for the answer, I found out that Postfix (the mailserver I
use) states that every line starting with a dot, should be escaped with
a dot. Then I looked into the Mono code (2.10.6 &amp; 8) and found the
following code (mcs/build/System/System.Net.Mail/SmtpClient.cs):

private void SendData (string data)
{
	if (String.IsNullOrEmpty (data)) {
		writer.Write(&quot;\r\n&quot;);
		writer.Flush();
		return;
	}

	StringReader sr = new StringReader (data);
	string line;
	bool escapeDots = deliveryMethod == SmtpDeliveryMethod.Network;
	while ((line = sr.ReadLine ()) != null) {
		CheckCancellation ();

		if (escapeDots) {
			int i;
			for (i = 0; i &lt; line.Length; i++) {
				if (line[i] != '.')
					break;
			}
			if (i &gt; 0 &amp;&amp; i == line.Length) {
				line += &quot;.&quot;;
			}
		}
		writer.Write (line);
		writer.Write (&quot;\r\n&quot;);
	}
	writer.Flush ();
}


Escaping with this works if there is only a single dot, but when there
is a line starting with a dot, it wont escape it. So, is this a bug, or
is this to be compatible with .Net (4)? And if this is not a bug, is
there a (known Mono) way to get around this, without implementing
another mail library? 

Cheers 

Peter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20120130/c9be5bd2/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20120130/c9be5bd2/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048194.html">[Mono-list] What happened to Monologue?
</A></li>
	<LI>Next message: <A HREF="048196.html">[Mono-list] Xbuild fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48195">[ date ]</a>
              <a href="thread.html#48195">[ thread ]</a>
              <a href="subject.html#48195">[ subject ]</a>
              <a href="author.html#48195">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
