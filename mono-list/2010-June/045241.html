<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Serializable object with Non-Serializable Fields	-- &gt; SerializationException
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%0A%20%3D%3Futf-8%3Fq%3FSerializable_object_with_Non-Serializable_F%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fields%3D09--_%3D3E_SerializationException%3F%3D&In-Reply-To=hu5jq9%24u7o%241%40dough.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="045240.html">
   <LINK REL="Next"  HREF="045244.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Serializable object with Non-Serializable Fields	-- &gt; SerializationException</H1>
    <B>Jacek Ru&#380;yczka</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%0A%20%3D%3Futf-8%3Fq%3FSerializable_object_with_Non-Serializable_F%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fields%3D09--_%3D3E_SerializationException%3F%3D&In-Reply-To=hu5jq9%24u7o%241%40dough.gmane.org"
       TITLE="[Mono-list] Serializable object with Non-Serializable Fields	-- &gt; SerializationException">stacheldraht at interia.pl
       </A><BR>
    <I>Wed Jun  2 09:23:43 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="045240.html">[Mono-list] Serializable object with Non-Serializable Fields	--&gt; SerializationException
</A></li>
        <LI>Next message: <A HREF="045244.html">[Mono-list] Serializable object with Non-Serializable Fields --	&gt; SerializationException
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45241">[ date ]</a>
              <a href="thread.html#45241">[ thread ]</a>
              <a href="subject.html#45241">[ subject ]</a>
              <a href="author.html#45241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Am Mittwoch 02 Juni 2010 14:46:07 schrieb Robert Jordan:
&gt;<i> Where are you setting this property? How is DBConnectionHandler
</I>&gt;<i> implemented.
</I>&gt;<i> 
</I>This is the DBConnectionHandler:


using System;
using System.Data;
using System.Data.SqlTypes;
using Npgsql;

namespace iwawi.batchjobs
{
	
	/// &lt;summary&gt;
	/// The database connection handler used for batch jobs.
	/// &lt;/summary&gt;
	public class DBConnectionHandler : ICloneable
	{
		public        readonly int    status   = 0;
		public static readonly string language = &quot;DE&quot;;
		
		private IDbConnection conn;
		private DateTime      loginDate;
		private string        connectionString;
		private short         workstationID;
		private short         departmentID;
		private int           personID;
		private string        userName;
		private string        dbHostName;
		private string        dbInstanceName;
		private string        dbVersion;
		private string []     dbparams;
		
		private static ushort seq   = 1;
		private        ushort myseq = 1;
		
		/// &lt;summary&gt;
		/// Constructor
		/// &lt;/summary&gt;
		///&lt;param name=&quot;dbparams&quot;&gt;Connection parameters&lt;/param&gt;
		public DBConnectionHandler(String [] dbparams)
		{
			String hostname = &quot;&quot;;
			this.dbparams = dbparams;
			connectionString = &quot;Server=&quot; + dbparams [0]
				+ &quot;; Port=&quot; + dbparams [1] +
				&quot;; Database=&quot; + dbparams [2]
				+ &quot;; User ID=&quot; + dbparams [3] +
				&quot;; Password=&quot; + dbparams [4] +
				&quot;; Encoding=UNICODE; Sslmode=Prefer; SSL=True&quot;;

			    this.dbHostName = dbparams [0] + &quot;:&quot; + dbparams [1];
				this.dbInstanceName = dbparams [2];
				this.userName = dbparams [3];
			
			try {
				conn = new NpgsqlConnection (connectionString);
				hostname = Environment.GetEnvironmentVariable(&quot;HOSTNAME&quot;);
				if (hostname == null) hostname = 
Environment.GetEnvironmentVariable(&quot;COMPUTERNAME&quot;);
				
				hostname = hostname.ToLower();
				conn.Open();
				
				IDbCommand workstationCommand = conn.CreateCommand();
				workstationCommand.CommandText =
					&quot;select workstation_id from workstations where lower (hostname) = \'&quot;
					+ hostname + &quot;\' and not_in_use = false;&quot;;
				IDataReader reader = workstationCommand.ExecuteReader();
				reader.Read();				
				workstationID = (Int16) reader [&quot;workstation_id&quot;];
				reader.Close();
				workstationCommand.Dispose();

				this.status = 2;
				
				IDbCommand userCommand = conn.CreateCommand();
				userCommand.CommandText =
					&quot;select person_id, fk_department_id, now() as login_date, &quot; + 
					&quot;substring(version() for (position (',' in version())) - 1) as 
db_version&quot;
					+ &quot; from employees where username = \'&quot;
					+ dbparams [3] + &quot;\' and is_inactive = false;&quot;;
				reader = userCommand.ExecuteReader();
				reader.Read();				
				personID = (Int32) reader [&quot;person_id&quot;];
				departmentID = (Int16) reader [&quot;fk_department_id&quot;];
				loginDate = (DateTime) reader [&quot;login_date&quot;];
				dbVersion = (String) reader [&quot;db_version&quot;];
				reader.Close();
				userCommand.Dispose();
				
				this.status = 1;
				myseq = seq;
				seq++;
			}
			catch (NpgsqlException ex) {
				this.status = -1;
				Console.WriteLine(ex.Message);
				Console.WriteLine(ex.StackTrace);
			}
			
			/* If your client has not been registered in the &quot;workstations&quot; table, THIS 
will happen. */
			catch (InvalidOperationException ex) {
				String messageString;
				if (status == 2) {
					messageString = &quot;Sie als Benutzer &#187;&quot; + dbparams [3] + &quot;&#171; sind nicht f&#252;r 
den Zugriff auf iWAWI freigeschaltet.\n&quot;
					+ &quot;Bitte wenden Sie sich an Ihren Systemadministrator.&quot;;
				}
				else {
					messageString = &quot;Ihr PC &#187;&quot; + hostname + &quot;&#171; ist nicht f&#252;r den Zugriff auf 
iWAWI freigeschaltet.\n&quot;
					+ &quot;Bitte wenden Sie sich an Ihren Systemadministrator.&quot;;
				}

				this.status = -1;
				Console.WriteLine(messageString);
			}
		}
		
		/// &lt;summary&gt;
		/// Returns a ready-to-use database command object.
		/// &lt;/summary&gt;
		/// &lt;returns&gt;
		/// A &lt;see cref=&quot;IDbCommand&quot;/&gt;
		/// &lt;/returns&gt;
		public IDbCommand CreateCommand ()
		{
			return this.conn.CreateCommand();
		}
		
		/// &lt;summary&gt;
		/// Creates a data adapter object containing the SQL statement given.
		/// &lt;/summary&gt;
		/// &lt;param name=&quot;commandText&quot;&gt;
		/// The SQL statement &lt;see cref=&quot;System.String&quot;/&gt;.
		/// &lt;/param&gt;
		/// &lt;returns&gt;
		/// The ready-to-use &lt;see cref=&quot;IDataAdapter&quot;/&gt;.
		/// &lt;/returns&gt;
		public IDataAdapter CreateDataAdapter (string commandText)
		{
			return new NpgsqlDataAdapter(commandText, (NpgsqlConnection) this.conn);
		}
	}
}

This class, BTW, is set right after the PrintReceipt constructor has been 
called.

&gt;<i> Marking a class as [Serializable] and inheriting from MarshalByRefObject
</I>&gt;<i> at the same time is usually a sign that you've got remoting wrong.
</I>&gt;<i> 
</I>I must admit that I got the skeleton of my class from some tutorial long time 
ago. But when I remove [Serializable], the PrintReceipt objects isn't created 
at all. And I suppose to know why: Right before the end of the code I define a 
callback event, so that PrintReceipt can call his &quot;master&quot; once it's ready.

&gt;<i> A class is either a MarshalByRefObject and it does not
</I>&gt;<i> leave its AppDomain or [Serializable] which means that
</I>&gt;<i> it will leave the AppDomain in its serialization form.
</I>&gt;<i> 
</I>The intention is that PrintReceipt will &quot;live&quot; on a remote server (it's a 
SingleCall object), and the client just requests its creation.

Kind regards
Jacek Ru&#380;yczka

----------------------------------------------------------------------
Wakacyjna przygoda czeka! Zgarnij nagrody za 18 000zl!
Sprawdz &gt;&gt;&gt; <A HREF="http://linkint.pl/f2721">http://linkint.pl/f2721</A>

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="045240.html">[Mono-list] Serializable object with Non-Serializable Fields	--&gt; SerializationException
</A></li>
	<LI>Next message: <A HREF="045244.html">[Mono-list] Serializable object with Non-Serializable Fields --	&gt; SerializationException
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45241">[ date ]</a>
              <a href="thread.html#45241">[ thread ]</a>
              <a href="subject.html#45241">[ subject ]</a>
              <a href="author.html#45241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
