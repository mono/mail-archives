<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] ASP.NET CheckBoxList Control
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20ASP.NET%20CheckBoxList%20Control&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034901.html">
   <LINK REL="Next"  HREF="034900.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] ASP.NET CheckBoxList Control</H1>
    <B>John Anderson</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20ASP.NET%20CheckBoxList%20Control&In-Reply-To="
       TITLE="[Mono-list] ASP.NET CheckBoxList Control">sontek at gmail.com
       </A><BR>
    <I>Tue Apr 17 17:50:27 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="034901.html">[Mono-list] [mono-list]DLL Import errors
</A></li>
        <LI>Next message: <A HREF="034900.html">[Mono-list] Mono bindings to OpenOffice.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34898">[ date ]</a>
              <a href="thread.html#34898">[ thread ]</a>
              <a href="subject.html#34898">[ subject ]</a>
              <a href="author.html#34898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey, I'm trying to implement my own CheckBoxList control based off of
mono's.  But for some reason my LoadPostData method doesn't get fired, can
anyone see anything wrong?

using System.Collections.Generic;
using System.Collections.Specialized;
using System.ComponentModel;
using System.Security.Permissions;
using System.Web.UI.WebControls;
using System.Web.UI;
using System;
using System.Text;
using System.IO;
namespace Orchid.Web.Controls
{
    /// &lt;summary&gt; A checkboxlist control that uses ajax callbacks for
sorting&lt;/summary&gt;
    public class SortableCheckBoxList : ListControl, INamingContainer,
IPostBackDataHandler
    {
        private CheckBox checkBox;
        public SortableCheckBoxList()
        {
            checkBox = new CheckBox();
            Controls.Add(checkBox);
        }
        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);
            for (int count = 0; count &lt; Items.Count; count++)
            {
                if (Items[count].Selected)
                {
                    checkBox.ID = String.Format(&quot;chk_item_{0}&quot;,
count.ToString());
                    Page.RegisterRequiresPostBack(checkBox);
                }
            }
        }
        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);
            string sortId = String.Format(&quot;{0}[]&quot;, ID);
            if (Page.Request.Form[sortId] != null &amp;&amp; !Page.IsPostBack)
            {
                string[] sortedItems = Page.Request.Form[sortId].Split(',');
                SortedItems = new int[sortedItems.Length];
                for (int count = 0; count &lt; sortedItems.Length; count++)
                    SortedItems[count] = int.Parse(sortedItems[count]);
            }
        }
        public int[] SortedItems
        {
            get { return (int[])Page.Session[this.ID + &quot;SortedItems&quot;]; }
            set { Page.Session[this.ID + &quot;SortedItems&quot;] = value; }
        }
        protected override void Render(HtmlTextWriter writer)
        {
            if (Items == null || Items.Count == 0)
                return;
            writer.AddAttribute(HtmlTextWriterAttribute.Id, ID);
            writer.AddAttribute(HtmlTextWriterAttribute.Class, CssClass);
            writer.RenderBeginTag(HtmlTextWriterTag.Ul);

            if (SortedItems == null)
            {
                for (int itemIndex = 0; itemIndex &lt; Items.Count;
itemIndex++)
                {
                    RenderListItem(itemIndex, writer);
                }
            }
            else
            {
                foreach (int itemIndex in SortedItems)
                {
                    RenderListItem(itemIndex, writer);
                }
            }
            writer.RenderEndTag();
            StringBuilder sb = new StringBuilder();

            string ajaxCallBack = String.Format(&quot;function() {{ new
Ajax.Request('{0}?ajaxAction={2}{3}',{{asynchronous:true, parameters:
Sortable.serialize('{1}')}})}}&quot;,
                                                 Path.GetFileName(
Page.Request.PhysicalPath), ID, new Random().Next(), GetQueryString());
            sb.AppendLine(String.Format(&quot;Sortable.create('{0}',
{{onUpdate:{1}, asynchronous:true, dropOnEmpty:true,constraint:
false,overlap:'horizonal'}});&quot;,
                                        ID, ajaxCallBack));
            Page.ClientScript.RegisterStartupScript(this.Page.GetType(),
&quot;draggable&quot;, sb.ToString(), true);
        }
        private string GetQueryString()
        {
            int count = Page.Request.QueryString.Count;
            if (count &gt; 0)
            {
                StringBuilder queryString = new StringBuilder();
                for (int index = 0; index &lt; count; index++)
                {
                    queryString.AppendFormat(&quot;&amp;{0}={1}&quot;,
Page.Request.QueryString.Keys[index], Page.Request.QueryString[index]);
                }
                return queryString.ToString();
            }
            return string.Empty;
        }
        private void RenderListItem(int index, HtmlTextWriter writer)
        {
            ListItem item = Items[index];
            writer.AddAttribute(HtmlTextWriterAttribute.Id,
String.Format(&quot;item_{0}&quot;,
index));
            writer.RenderBeginTag(HtmlTextWriterTag.Li);
            checkBox.ID = String.Format(&quot;chk_item_{0}&quot;, index.ToString());
            checkBox.Text = item.Text;
            checkBox.AutoPostBack = AutoPostBack;
            checkBox.Enabled = Enabled;
            checkBox.ValidationGroup = ValidationGroup;
            checkBox.CausesValidation = CausesValidation;
            checkBox.Checked = item.Selected;
            checkBox.RenderControl(writer);
            writer.RenderEndTag();
        }

        #region IPostBackDataHandler Members

        public bool LoadPostData(string postDataKey, NameValueCollection
postCollection)
        {
            EnsureDataBound();
            int checkboxIndex = -1;

            try
            {
                string id = postDataKey.Substring(ClientID.Length + 1);
                if (Char.IsDigit(id[0]))
                    checkboxIndex = Int32.Parse(id);
            }
            catch
            {
                return false;
            }
            if (checkboxIndex == -1)
                return false;

            string val = postCollection[postDataKey];
            bool isChecked = val == &quot;on&quot;;
            ListItem item = Items[checkboxIndex];
            if (item.Selected != isChecked)
            {
                item.Selected = isChecked;
                return true;
            }
            return false;
        }

        public void RaisePostDataChangedEvent()
        {
            if (CausesValidation)
                Page.Validate(ValidationGroup);
            OnSelectedIndexChanged(EventArgs.Empty);

        }

        #endregion
    }
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070417/f4feefe5/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20070417/f4feefe5/attachment-0001.html</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034901.html">[Mono-list] [mono-list]DLL Import errors
</A></li>
	<LI>Next message: <A HREF="034900.html">[Mono-list] Mono bindings to OpenOffice.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34898">[ date ]</a>
              <a href="thread.html#34898">[ thread ]</a>
              <a href="subject.html#34898">[ subject ]</a>
              <a href="author.html#34898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
