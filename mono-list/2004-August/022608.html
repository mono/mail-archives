<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Custom marshalling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mathpup%40mylinuxisp.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="022625.html">
   <LINK REL="Next"  HREF="022615.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Custom marshalling
   </H1>
    <B>Marcus
    </B> 
    <A HREF="mailto:mathpup%40mylinuxisp.com"
       TITLE="[Mono-list] Custom marshalling">mathpup@mylinuxisp.com
       </A><BR>
    <I>Fri, 6 Aug 2004 00:46:07 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="022625.html">[Mono-list] 500 errors with mod_mono
</A></li>
        <LI> Next message: <A HREF="022615.html">[Mono-list] ./libs/libmod_mono.so is not a DSO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22608">[ date ]</a>
              <a href="thread.html#22608">[ thread ]</a>
              <a href="subject.html#22608">[ subject ]</a>
              <a href="author.html#22608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Unfortunately, UnmanagedMarshal.DefineCustom is a Mono-only class and not part 
of .NET. The normal .NET mechanism is to create a custom attribute using 
CustomAttributeBuilder to obtain an instance of MarshalAsAttribute with the 
custom marshaler specified. That does not seem to work under Mono.

It is possible to implement custom marshalers without having to use 
reflection, as long as you know what what types you want to marshal to what 
at compile time. 

public class MyMarshal: ICustomMarshaler {...}

private static extern void PrintObject(
 [MarshalAs( UnmanagedType.CustomMarshaler, MarshalTypeRef =
        typeof(MyMarshal ) )] object o );

On Sunday 25 July 2004 5:12 pm, Alan Jenkins wrote:
&gt;<i> As far as I can tell, Mono supports custom marshalling outside of function
</I>&gt;<i> calls (like PInvoke),  - ie using Marshal.StructToPtr and PtrToStruct, but
</I>&gt;<i> you have to use UnmanagedMarshal.DefineCustom, which would involve
</I>&gt;<i> reflection of some sort - possibly creating your class with custom
</I>&gt;<i> marshalled fields by reflection.
</I>&gt;<i>
</I>&gt;<i> Does UnmanagedMarshal.DefineCustom work?
</I>&gt;<i> Is it efficient (as far as custom marshalling can be)?
</I>&gt;<i> Is it supported (or undocumented and likely to disappear/break)?
</I>&gt;<i>
</I>&gt;<i> Would it be (technically) possible to access its functionality through an
</I>&gt;<i> attribute, in the same way that non-custom marshalling is done?
</I>&gt;<i> Is this likely to happen?
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="022625.html">[Mono-list] 500 errors with mod_mono
</A></li>
	<LI> Next message: <A HREF="022615.html">[Mono-list] ./libs/libmod_mono.so is not a DSO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22608">[ date ]</a>
              <a href="thread.html#22608">[ thread ]</a>
              <a href="subject.html#22608">[ subject ]</a>
              <a href="author.html#22608">[ author ]</a>
         </LI>
       </UL>
</body></html>
