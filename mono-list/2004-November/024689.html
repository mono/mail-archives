<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Calling back from unmanaged code to managed code.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024666.html">
   <LINK REL="Next"  HREF="024668.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Calling back from unmanaged code to managed code.
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Calling back from unmanaged code to managed code.">lupus@ximian.com
       </A><BR>
    <I>Tue, 30 Nov 2004 12:12:49 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="024666.html">[Mono-list] Calling back from unmanaged code to managed code.
</A></li>
        <LI> Next message: <A HREF="024668.html">[Mono-list] Getting list of IPAddress available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24689">[ date ]</a>
              <a href="thread.html#24689">[ thread ]</a>
              <a href="subject.html#24689">[ subject ]</a>
              <a href="author.html#24689">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/29/04 Francis Brosnan Blázquez wrote:
&gt;<i> I'm trying to make the c# binding for some set of libraries which, in
</I>&gt;<i> sort, makes petitions to a remote server without blocking the caller. In
</I>&gt;<i> this context, the caller must suply a handler to manage the server
</I>&gt;<i> response.
</I>&gt;<i> 
</I>&gt;<i> Later, when server response arrives, these libraries initiate a thread
</I>&gt;<i> and execute on it the Caller's handler. 
</I>&gt;<i> 
</I>&gt;<i> The binding works fine until unmanaged code invoke the caller's handler
</I>&gt;<i> inside the newly thread create.
</I>&gt;<i> 
</I>&gt;<i> I've made a litle test to show more presiselly what I'm trying to do.
</I>&gt;<i> The follwing file is the unmanaged pice of code that has two ways to
</I>&gt;<i> notify the caller throught its handler: 1) by creating a new thread, 2)
</I>&gt;<i> by using the actual caller's thread.
</I>[...]
&gt;<i> When I execute this test I get the following:
</I>&gt;<i> 
</I>&gt;<i> ----
</I>&gt;<i> $ ./Callback.exe
</I>&gt;<i> Test init..
</I>&gt;<i> Recieved call on unmanaged side..
</I>&gt;<i> Calling back to managed side..
</I>&gt;<i> Recieved callback on managed side
</I>&gt;<i>   Values: 2 and some text
</I>&gt;<i> Calling back finished..
</I>&gt;<i> Recieved call on unmanaged side..
</I>&gt;<i> Calling back to managed side..
</I>&gt;<i> 
</I>&gt;<i> ** ERROR **: file mini.c: line 6558 (mono_get_lmf_addr): should not be
</I>&gt;<i> reached
</I>
We could easily remove this assert and instead add the code to setup
the thread to execute managed code. This won't solve the whole issue,
though: the GC needs to know about the thread and its stack limits or
it won't work correctly.
There is also the issue of deciding which application domain should be set
for the new thread. We should probably add a call to a function that does
all this setup to the wrapper methods used to go from unmanaged to
managed code.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024666.html">[Mono-list] Calling back from unmanaged code to managed code.
</A></li>
	<LI> Next message: <A HREF="024668.html">[Mono-list] Getting list of IPAddress available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24689">[ date ]</a>
              <a href="thread.html#24689">[ thread ]</a>
              <a href="subject.html#24689">[ subject ]</a>
              <a href="author.html#24689">[ author ]</a>
         </LI>
       </UL>
</body></html>
