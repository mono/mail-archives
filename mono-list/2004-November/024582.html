<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] C#/Mono Serial port communication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lists%40jonepet.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024581.html">
   <LINK REL="Next"  HREF="024584.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] C#/Mono Serial port communication
   </H1>
    <B>Jon-Eirik Pettersen
    </B> 
    <A HREF="mailto:lists%40jonepet.net"
       TITLE="[Mono-list] C#/Mono Serial port communication">lists@jonepet.net
       </A><BR>
    <I>Wed, 24 Nov 2004 23:30:44 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="024581.html">[Mono-list] C#/Mono Serial port communication
</A></li>
        <LI> Next message: <A HREF="024584.html">[Mono-list] C#/Mono Serial port communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24582">[ date ]</a>
              <a href="thread.html#24582">[ thread ]</a>
              <a href="subject.html#24582">[ subject ]</a>
              <a href="author.html#24582">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gonzalo Paniagua Javier wrote:
&gt;<i> On Wed, 2004-11-24 at 22:22 +0100, Jon-Eirik Pettersen wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>I don't think I have enough information to do it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>It says the stream is seek-able because it thinks it is a normal file it 
</I>&gt;&gt;<i>is opening, but seeking do not seems to work on devices.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The bug is exactly that. The runtime should figure out whether the file
</I>&gt;<i> is seekable or not.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>But if I send the data  directly to the FileStream using the 
</I>&gt;&gt;<i>Write-function it works, but I have problems reading the data from the 
</I>&gt;&gt;<i>stream.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Try using the stream in the file attached.
</I>&gt;<i> 
</I>&gt;<i> -Gonzalo
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> using System.IO;
</I>&gt;<i> 
</I>&gt;<i> class NoSeekStream : FileStream {
</I>&gt;<i> 	public NoSeekStream (string name, FileMode mode, FileAccess access)
</I>&gt;<i> 		: base (name, mode, access)
</I>&gt;<i> 	{
</I>&gt;<i> 	}
</I>&gt;<i> 
</I>&gt;<i> 	public override bool CanSeek {
</I>&gt;<i> 		get { return false; }
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i> 
</I>
I have made a buggy application that is able to send data (if I send 
ATZxxxxxxxx I can see in the other end that it works), but it is not 
able to receive data:

using System;
using System.Text;
using System.IO;
using System.Threading;
using System.Collections;

namespace serialchattest {
   class serialchattest {
     static string device = &quot;/dev/rfcomm0&quot;;
     static ArrayList rbuf = new ArrayList();
     static FileStream fs = null;
     static StreamReader sr = null;

     static void SendCommand(string cmd) {
       try {
         string data = cmd + &quot;\r\n&quot;;
         byte[] bt = Encoding.UTF8.GetBytes(data);
         fs.Write(bt, (int) fs.Position, bt.Length);
         sr.ReadLine();
       } catch (Exception) {} finally {}
     }

     static void ReadResponse() {
       string data = null;
       while ((data = sr.ReadLine()) != null) {
         rbuf.Add(data);
       }
     }

     static string GetResponse() {
       try {
         if (rbuf.Count &gt; 0) {
           string ret = (string) rbuf[0];
           rbuf.RemoveAt(0);
           return ret;
         } else {
           return null;
         }
       } catch (Exception) { return null; } finally {}
     }

     static void Main() {
       fs = new FileStream(device, FileMode.Open, FileAccess.ReadWrite, 
0, 1024, true);
       sr = new StreamReader(fs);
       SendCommand(&quot;AT&quot;);
       string res = null;
       ReadResponse();
       while ((res = GetResponse()) != null) {
         Console.WriteLine(res);
       }
     }
   }
}

The result is:


Unhandled Exception: System.NullReferenceException: Object reference not 
set to an instance of an object

Unhandled Exception: System.NullReferenceException: Object reference not 
set to an instance of an object

Unhandled Exception: System.NullReferenceException: Object reference not 
set to an instance of an object

Unhandled Exception: System.NullReferenceException: Object reference not 
set to an instance of an object
 


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024581.html">[Mono-list] C#/Mono Serial port communication
</A></li>
	<LI> Next message: <A HREF="024584.html">[Mono-list] C#/Mono Serial port communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24582">[ date ]</a>
              <a href="thread.html#24582">[ thread ]</a>
              <a href="subject.html#24582">[ subject ]</a>
              <a href="author.html#24582">[ author ]</a>
         </LI>
       </UL>
</body></html>
