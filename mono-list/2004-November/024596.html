<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mod_mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:reply.to.the.list.iam.suscribed%40notexists.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024589.html">
   <LINK REL="Next"  HREF="024600.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mod_mono
   </H1>
    <B>Gonzalo Paniagua Javier
    </B> 
    <A HREF="mailto:reply.to.the.list.iam.suscribed%40notexists.ximian.com"
       TITLE="[Mono-list] mod_mono">reply.to.the.list.iam.suscribed@notexists.ximian.com
       </A><BR>
    <I>Wed, 24 Nov 2004 21:08:36 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="024589.html">[Mono-list] mod_mono
</A></li>
        <LI> Next message: <A HREF="024600.html">[Mono-list] mod_mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24596">[ date ]</a>
              <a href="thread.html#24596">[ thread ]</a>
              <a href="subject.html#24596">[ subject ]</a>
              <a href="author.html#24596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2004-11-24 at 15:39 -0800, Darren Martz wrote:
&gt;<i> Gonzalo,
</I>&gt;<i>  
</I>&gt;<i> I have been looking over the mod_mono source and have a few thoughts. Before
</I>&gt;<i> you read on, please don't take offence to anything I write that may
</I>&gt;<i> accidentally offend... I am just trying to help.
</I>
Heh. Let's see ;-).

&gt;<i> 
</I>&gt;<i> It seems the way to create a separate mod-mono-server process per
</I>&gt;<i> &quot;MonoApplication&quot; is to change the MonoUnixSocket value to a unique address,
</I>&gt;<i> or use unique MonoListenAddress/MonoListenPort values. On Linux a unique
</I>&gt;<i> .wapi directory is also necessary using the MonoWapiDir statement.
</I>
There's other alternative that works for other apache models than
prefork: running mod-mono-server by yourself. This way you only have to
tell the module not to fork (MonoRunXSP false) and you can set its own
user, .wapi dir, etc. You'll want to start/stop this 'daemon' when
apache starts/stops (the --terminate option was added recently to
mod-mono-server so that you can shutdown gracefully a running
mod-mono-server).

Other advantages of this way of managing applications is that you don't
need to restart mod-mono-server if you've changed unrelated stuff in the
apache configuration.

&gt;<i> Pooling MonoApplications into one or more mod-mono-server processes is not
</I>&gt;<i> an obvious outcome of MonoUnixSocket and MonoWapiDir. The MonoWapiDir only
</I>&gt;<i> makes sense to people working on XSP and mono, and the MonoUnixSocket is not
</I>&gt;<i> likely to be relevant in a Windows environment - assuming a port to Windows.
</I>
Angel Marin is working on it and is using the TCP socket, not the unix
socket which, btw, is available from certain version of the windows API,
but not likely to be used in Angel's port.

&gt;<i> 
</I>&gt;<i> What if we combined all of that into something a bit more direct, something
</I>&gt;<i> like the following entries:
</I>&gt;<i> 
</I>&gt;<i> 	MonoGroup $GroupName
</I>&gt;<i> 	MonoTemp /tmp/mod_mono/
</I>&gt;<i> 
</I>&gt;<i> [the notation of $GroupName indicates to replace with your own groupname
</I>&gt;<i> such as &quot;nGallery&quot;]
</I>&gt;<i> 
</I>&gt;<i> The MonoTemp sets a generic temp directory where both the .wapi directory
</I>&gt;<i> and the mod-mono-server socket exist. That is the equivalent of writing the
</I>&gt;<i> following with today's syntax:
</I>&gt;<i> 
</I>&gt;<i> 	MonoUnixSocket /tmp/$GroupName/mod-mono-server
</I>&gt;<i> 	MonoWapiDir /tmp/$GroupName/.wapi
</I>&gt;<i> 
</I>&gt;<i> So why consider changing the syntax? The entries are completely unique to
</I>&gt;<i> Linux requiring a new set of commands for a Win32 port. The outcome of using
</I>&gt;<i> these commands is to control unique processes of mod-mono-server regardless
</I>&gt;<i> of the host platform. This is our way of controlling groups of
</I>&gt;<i> MonoApplications/mod-mono-server processes, what I'll refer to as
</I>&gt;<i> &quot;application pools&quot;. A common syntax that supports application pools across
</I>&gt;<i> multiple platforms seems logical/ideal.
</I>
I still like more the setup I said above. Have you tried running apache
using the MPM worker thread model? You'll see it failing miserably to
spawn mod-mono-server because of how apache manages processes.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Due to bug #50049 we apparently need to create a unique mod-mono-server
</I>&gt;<i> process per MonoApplication.
</I>
Right :(

&gt;<i> 
</I>&gt;<i> On Linux this means the mod-mono-server file and the .wapi directory always
</I>&gt;<i> reside in the same [sub]directory. Maybe that is a problem for a few, but I
</I>
You can use MonoWapiDir on a per-location basis.

&gt;<i> understand others are already doing it manually. Others have created scripts
</I>&gt;<i> to cleanup the .wapi and mod-mono-server reminisce when apache is
</I>&gt;<i> reloaded/stopped - something mod_mono could do in the terminate_xsp
</I>&gt;<i> function.
</I>
Depending on the setup, there might be other instances of mono running
and using the same directory, so this is not an option.

&gt;<i> 
</I>&gt;<i> Porting mod_mono to Windows *could* mean that MonoTemp is ignored (or used
</I>&gt;<i> for something else) and MonoGroup translates into a named pipe called
</I>&gt;<i> &quot;//./pipe/mod-mono/$GroupName&quot;, or shared-memory name, or something like
</I>&gt;<i> that. That means the syntax/documentation could remain constant between
</I>&gt;<i> Unix/Linux/Mac/Windows but allow for an OS optimized implementation.
</I>
You can modify the temporary directory in web.config. In fact I just
replied to someone else wrt that. The answer is:
&lt;configuration&gt;
        &lt;system.web&gt;
                &lt;compilation tempDirectory=&quot;/blah/blah&quot; /&gt;
        &lt;/system.web&gt;
&lt;/configuration&gt;

But, really, you normally don't care about where the system places the
temp files it creates.

&gt;<i> 
</I>&gt;<i> My interest in this? Coming from the windows C/C++ world I'd like to see an
</I>&gt;<i> alternative on Windows for asp.net and am considering writing the port
</I>&gt;<i> myself if nobody else is up to the challenge. That would help many
</I>&gt;<i> businesses wanting to move away from IIS but towards Asp.Net that are not
</I>&gt;<i> ready to commit to a Linux platform.
</I>
As I said, Angel Marin is porting mod_mono to windows.

After reading your email I found no offense at all, but someone really
interested and motivated in using our work ;-).

Lemme know if there's something wrong with the alternative approach that
I proposed (that requires no changes in the code, but a couple of
scripts).

Thanks for your time.

-Gonzalo





</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024589.html">[Mono-list] mod_mono
</A></li>
	<LI> Next message: <A HREF="024600.html">[Mono-list] mod_mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24596">[ date ]</a>
              <a href="thread.html#24596">[ thread ]</a>
              <a href="subject.html#24596">[ subject ]</a>
              <a href="author.html#24596">[ author ]</a>
         </LI>
       </UL>
</body></html>
