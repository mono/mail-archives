<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mod_mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:steve%40cityhost.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024600.html">
   <LINK REL="Next"  HREF="024647.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mod_mono
   </H1>
    <B>Steve Deobald
    </B> 
    <A HREF="mailto:steve%40cityhost.ca"
       TITLE="[Mono-list] mod_mono">steve@cityhost.ca
       </A><BR>
    <I>Thu, 25 Nov 2004 02:32:45 -0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="024600.html">[Mono-list] mod_mono
</A></li>
        <LI> Next message: <A HREF="024647.html">[Mono-list] mod_mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24602">[ date ]</a>
              <a href="thread.html#24602">[ thread ]</a>
              <a href="subject.html#24602">[ subject ]</a>
              <a href="author.html#24602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Darren, Gonz, Joseph, everyone,

While we're on the topic, I figured I'd query Gonzalo on an issue the
br-mono.org guys have been having recently. I'm hosting them with the
#50049 workaround, as I am a few people, but their development is pretty
heavy. It seems that when they update assemblies on the server their
socket needs a kick (delete &amp; re-create) before the server will
recognize a new assembly was uploaded. No one else has really noticed
this since the sockets get recreated on a pretty regular basis
anyway. :)

I've recently noticed this myself when doing some small ASP.net work for
gotmono.net. I've got all my ASP.net folks set up with a web interface
now to restart their own socket, but this isn't terribly convenient.
[Aside: I'll be releasing the code for this little web script, amongst
others, very soon. I'd like to get everything cleaned up first. Just in
case anyone else is interested.]

I'm wondering - where should I start looking to resolve this problem? Is
it mod_mono's job or XSP's to recognize an assembly has changed? If we
can come to an agreement about how to implement Darren's suggestions
this seems like something that would work right alongside. Unless I'm
way off track.

Thanks!

-- 
Steve Deobald
cityhost.ca


On Wed, 2004-24-11 at 22:13 -0800, Darren Martz wrote:
&gt;<i> &gt; There's other alternative that works for other apache models than
</I>&gt;<i> &gt; prefork: running mod-mono-server by yourself. This way you 
</I>&gt;<i> &gt; only have to tell the module not to fork (MonoRunXSP false) 
</I>&gt;<i> &gt; and you can set its own user, .wapi dir, etc. You'll want to 
</I>&gt;<i> &gt; start/stop this 'daemon' when apache starts/stops (the 
</I>&gt;<i> &gt; --terminate option was added recently to mod-mono-server so 
</I>&gt;<i> &gt; that you can shutdown gracefully a running mod-mono-server).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Other advantages of this way of managing applications is that 
</I>&gt;<i> &gt; you don't need to restart mod-mono-server if you've changed 
</I>&gt;<i> &gt; unrelated stuff in the apache configuration.
</I>&gt;<i> 
</I>&gt;<i> Having a balance between an easy to use configuration and a super-flexible
</I>&gt;<i> configuration is certainly ideal. 
</I>&gt;<i> 
</I>&gt;<i> What you describe certainly allows a fair amount of control over the server
</I>&gt;<i> process. Bringing the more advanced features such as multiple processes to
</I>&gt;<i> the &quot;easy to use&quot; side could only advance mod_mono's reputation.
</I>&gt;<i> 
</I>&gt;<i> Right now the admin is required to manually create a directory per
</I>&gt;<i> application and add supporting MonoUnixSocket/MonoWapiDir entries to the
</I>&gt;<i> config file. The config entries are basic to write, but the manual creation
</I>&gt;<i> of  unique directories requires manual intervention. If mod_mono were to
</I>&gt;<i> auto-create the unique sub-folders on demand, it would be far simpler to
</I>&gt;<i> configure multiple applications. Take the following for a lengthy example:
</I>&gt;<i> 
</I>&gt;<i> &lt;Location /TestA&gt;
</I>&gt;<i> 	MonoGroup MyAppOne
</I>&gt;<i> 	MonoApplication /TestA:/var/www/TestA/
</I>&gt;<i> &lt;/Location&gt;
</I>&gt;<i> 
</I>&gt;<i> &lt;Location /TestB&gt;
</I>&gt;<i> 	MonoGroup MyAppOne
</I>&gt;<i> 	MonoApplication /TestB:/var/www/TestB/
</I>&gt;<i> &lt;/Location&gt;
</I>&gt;<i> 
</I>&gt;<i> &lt;Location /TestC&gt;
</I>&gt;<i> 	MonoGroup MyAppTwo
</I>&gt;<i> 	MonoApplication /TestC:/var/www/TestC/
</I>&gt;<i> &lt;/Location&gt;
</I>&gt;<i> 
</I>&gt;<i> &lt;Location /TestD&gt;
</I>&gt;<i> 	MonoApplication /TestD:/var/www/TestD/
</I>&gt;<i> &lt;/Location&gt;
</I>&gt;<i> 
</I>&gt;<i> &lt;Location&gt; /TestE&gt;
</I>&gt;<i> 	MonoUseXSP False
</I>&gt;<i> 	MonoUnixSocket /tmp/mycustom/mod_mono_server
</I>&gt;<i> 	MonoWapiDir /tmp/mycustom/
</I>&gt;<i> 	MonoApplication /TestE:/var/www/TestE/
</I>&gt;<i> &lt;/Location&gt;
</I>&gt;<i> 
</I>&gt;<i> Given the above five mono applications, on Linux the following directories
</I>&gt;<i> would be created:
</I>&gt;<i> 
</I>&gt;<i> # apps TestA and TestB would use the following
</I>&gt;<i> /tmp/mod_mono/MyAppOne/.wapi
</I>&gt;<i> /tmp/mod_mono/MyAppOne/mod_mono_server
</I>&gt;<i> 
</I>&gt;<i> # app TestC would use the following
</I>&gt;<i> /tmp/mod_mono/MyAppTwo/.wapi
</I>&gt;<i> /tmp/mod_mono/MyAppTwo/mod_mono_server
</I>&gt;<i> 
</I>&gt;<i> # app TestD would use the following
</I>&gt;<i> /tmp/mod_mono/Default/.wapi
</I>&gt;<i> /tmp/mod_mono/Default/mod_mono_server
</I>&gt;<i> 
</I>&gt;<i> The user would be responsible to create the /tmp/mod_mono/ directory, but
</I>&gt;<i> the remaining sub-directories would be generated by the module. Powerful and
</I>&gt;<i> easy to use. The TestE example would be completely controlled externally as
</I>&gt;<i> you described.
</I>&gt;<i> 
</I>&gt;<i> On Windows that would instead create the following named pipes (same config
</I>&gt;<i> file):
</I>&gt;<i> 
</I>&gt;<i> //./mod_mono/MyAppOne
</I>&gt;<i> //./mod_mono/MyAppTwo
</I>&gt;<i> //./mod_mono/Default
</I>&gt;<i> 
</I>&gt;<i> The TestE example on Windows would not work cause the MonoUnixSocket would
</I>&gt;<i> not likely be ported.
</I>&gt;<i>  
</I>&gt;<i> &gt; Angel Marin is working on it and is using the TCP socket, not 
</I>&gt;<i> &gt; the unix socket which, btw, is available from certain version 
</I>&gt;<i> &gt; of the windows API, but not likely to be used in Angel's port.
</I>&gt;<i> 
</I>&gt;<i> Due to the large performance differences between named-pipes and sockets in
</I>&gt;<i> Windows, I strongly suggest investigating a different approach. In my
</I>&gt;<i> experience, when the client and the server reside on the same box, pipes
</I>&gt;<i> have a huge performance gain over sockets any day. Take SQL Server for
</I>&gt;<i> instance, do a test between pipes and sockets and witness the results for
</I>&gt;<i> yourself.
</I>&gt;<i>  
</I>&gt;<i> &gt; I still like more the setup I said above. Have you tried 
</I>&gt;<i> &gt; running apache using the MPM worker thread model? You'll see 
</I>&gt;<i> &gt; it failing miserably to spawn mod-mono-server because of how 
</I>&gt;<i> &gt; apache manages processes.
</I>&gt;<i> 
</I>&gt;<i> What goes wrong with the MPM with processes? I still have a lot to learn on
</I>&gt;<i> the Linux side of coding. The code appears to attempt a connection to the
</I>&gt;<i> mod-mono-server each request. With multiple worker threads it would seem
</I>&gt;<i> that each thread tries to connect and goes from there. I could certainly see
</I>&gt;<i> a conflict if the server was not running or was overloaded.
</I>&gt;<i> 
</I>&gt;<i> It seems like some form of process-pool logic could be of value here.
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> &gt; Depending on the setup, there might be other instances of 
</I>&gt;<i> &gt; mono running and using the same directory, so this is not an option.
</I>&gt;<i> 
</I>&gt;<i> I can see this being a problem for default directory setups. However, for
</I>&gt;<i> the MonoGroup &quot;unique&quot; sub-directories described in the above example, this
</I>&gt;<i> would not be a problem. 
</I>&gt;<i> 
</I>&gt;<i> The nice part is it's the best of both worlds - fully automatic and fully
</I>&gt;<i> controllable.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024600.html">[Mono-list] mod_mono
</A></li>
	<LI> Next message: <A HREF="024647.html">[Mono-list] mod_mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24602">[ date ]</a>
              <a href="thread.html#24602">[ thread ]</a>
              <a href="subject.html#24602">[ subject ]</a>
              <a href="author.html#24602">[ author ]</a>
         </LI>
       </UL>
</body></html>
