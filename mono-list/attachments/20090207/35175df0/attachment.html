<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;found&nbsp;the&nbsp;issue.&nbsp;Turns&nbsp;out&nbsp;that&nbsp;&lt;a&nbsp;href=&quot;http://MS.NET&quot;&gt;MS.NET&lt;/a&gt;&nbsp;is&nbsp;hitting&nbsp;the&nbsp;boehm&nbsp;&amp;quot;Embarrassing&nbsp;Failure&nbsp;Scenario&amp;quot;,&nbsp;in&nbsp;particular&nbsp;part&nbsp;3:&nbsp;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;style=&quot;margin-left:&nbsp;40px;&quot;&gt;The&nbsp;problem&nbsp;is&nbsp;not&nbsp;limited&nbsp;to&nbsp;what&nbsp;is&nbsp;normally&nbsp;referred&nbsp;to&nbsp;as&nbsp;&amp;quot;conservative&amp;quot;&nbsp;garbage&nbsp;collection.&nbsp;&lt;b&gt;It&nbsp;could&nbsp;also&nbsp;be&nbsp;caused&nbsp;by&nbsp;having&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;accidentally&nbsp;trace&nbsp;from&nbsp;a&nbsp;dead&nbsp;compiler-generated&nbsp;variable&lt;/b&gt;,&nbsp;or&nbsp;by&nbsp;promoting&nbsp;a&nbsp;queue&nbsp;element&nbsp;to&nbsp;a&nbsp;generation&nbsp;that&nbsp;is&nbsp;effectively&nbsp;not&nbsp;collected.&nbsp;This&nbsp;data&nbsp;structure&nbsp;is&nbsp;safe&nbsp;only&nbsp;with&nbsp;a&nbsp;system&nbsp;that&nbsp;is&nbsp;carefully&nbsp;designed&nbsp;to&nbsp;prevent&nbsp;any&nbsp;form&nbsp;of&nbsp;extra&nbsp;space&nbsp;retention&nbsp;(cf.&nbsp;[Appel?]).&nbsp;&lt;br&gt;<br>
&lt;/div&gt;&lt;br&gt;If&nbsp;you&nbsp;compile&nbsp;the&nbsp;code&nbsp;without&nbsp;optimisations,&nbsp;it&nbsp;leaks&nbsp;indefinitely.&nbsp;If&nbsp;you&nbsp;compile&nbsp;with&nbsp;optimisations,&nbsp;the&nbsp;compiler&nbsp;generated&nbsp;variable&nbsp;is&nbsp;being&nbsp;optimised&nbsp;away&nbsp;and&nbsp;so&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;leak.&nbsp;So,&nbsp;as&nbsp;was&nbsp;stated&nbsp;before&nbsp;and&nbsp;as&nbsp;is&nbsp;stated&nbsp;in&nbsp;the&nbsp;boehm&nbsp;docs,&nbsp;this&nbsp;issue&nbsp;is&nbsp;*not*&nbsp;limited&nbsp;to&nbsp;conservative&nbsp;garbage&nbsp;collectors.&lt;br&gt;<br>
&lt;br&gt;It&nbsp;looks&nbsp;like&nbsp;mono&nbsp;could&nbsp;*probably*&nbsp;avoid&nbsp;the&nbsp;issue&nbsp;if&nbsp;it&amp;#39;s&nbsp;optimisation&nbsp;pass&nbsp;was&nbsp;able&nbsp;to&nbsp;nuke&nbsp;the&nbsp;same&nbsp;dead&nbsp;variable.&nbsp;It&amp;#39;d&nbsp;be&nbsp;interesting&nbsp;to&nbsp;compare&nbsp;the&nbsp;IL&nbsp;of&nbsp;the&nbsp;version&nbsp;which&nbsp;does&nbsp;not&nbsp;leak&nbsp;under&nbsp;mono&nbsp;with&nbsp;the&nbsp;version&nbsp;that&nbsp;does&nbsp;leak&nbsp;and&nbsp;see&nbsp;what&nbsp;the&nbsp;difference&nbsp;is.&lt;br&gt;<br>
&lt;br&gt;Alan.&lt;br&gt;&lt;br&gt;On&nbsp;Sat,&nbsp;Feb&nbsp;7,&nbsp;2009&nbsp;at&nbsp;2:00&nbsp;PM,&nbsp;Jon&nbsp;Harrop&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jon@ffconsultancy.com&quot;&gt;jon@ffconsultancy.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;On&nbsp;Saturday&nbsp;07&nbsp;February&nbsp;2009&nbsp;13:47:01&nbsp;you&nbsp;wrote:&lt;br&gt;&amp;gt;&amp;gt;&nbsp;Well,&nbsp;the&nbsp;code&nbsp;you&nbsp;pasted&nbsp;in&nbsp;your&nbsp;email&nbsp;is&nbsp;definitely&nbsp;leaking&nbsp;on&nbsp;my&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp;system&nbsp;under&nbsp;&lt;a&nbsp;href=&quot;http://MS.NET&quot;&gt;MS.NET&lt;/a&gt;&nbsp;3.5&nbsp;x86.&nbsp;Did&nbsp;you&nbsp;paste&nbsp;the&nbsp;wrong&nbsp;code&nbsp;in&nbsp;your&lt;br&gt;&amp;gt;&amp;gt;&nbsp;email?&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;No,&nbsp;I&nbsp;pasted&nbsp;the&nbsp;correct&nbsp;code&nbsp;in&nbsp;my&nbsp;e-mail&nbsp;and&nbsp;I&nbsp;compiled&nbsp;it&nbsp;with&nbsp;MS&nbsp;Visual&nbsp;C#&lt;br&gt;&amp;gt;&nbsp;2008&nbsp;Express&nbsp;to&nbsp;run&nbsp;it&nbsp;on&nbsp;.NET.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;&amp;gt;&nbsp;However,&nbsp;I&nbsp;just&nbsp;noticed&nbsp;that&nbsp;Mono&nbsp;only&nbsp;leaks&nbsp;if&nbsp;the&nbsp;code&nbsp;is&nbsp;compiled&nbsp;using&lt;br&gt;&amp;gt;&nbsp;Mono&amp;#39;s&nbsp;C#&nbsp;compiler&nbsp;and&nbsp;*not*&nbsp;if&nbsp;you&nbsp;give&nbsp;Mono&nbsp;the&nbsp;assembly&nbsp;produced&nbsp;by&nbsp;MS&lt;br&gt;&amp;gt;&nbsp;Visual&nbsp;C#.&nbsp;Perhaps&nbsp;you&nbsp;did&nbsp;the&nbsp;opposite&nbsp;and&nbsp;tried&nbsp;to&nbsp;run&nbsp;the&nbsp;output&nbsp;of&nbsp;Mono&amp;#39;s&lt;br&gt;<br>
&amp;gt;&nbsp;C#&nbsp;compiler&nbsp;under&nbsp;.NET&nbsp;without&nbsp;recompiling&nbsp;the&nbsp;C#&nbsp;source&nbsp;code&nbsp;using&nbsp;MS&amp;#39;&lt;br&gt;&amp;gt;&nbsp;tools?&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;--&lt;br&gt;&amp;gt;&nbsp;Dr&nbsp;Jon&nbsp;Harrop,&nbsp;Flying&nbsp;Frog&nbsp;Consultancy&nbsp;Ltd.&lt;br&gt;&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://www.ffconsultancy.com/?e&quot;&gt;http://www.ffconsultancy.com/?e&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
