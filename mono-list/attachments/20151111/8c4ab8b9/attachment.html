<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;How&nbsp;does&nbsp;it&nbsp;crash?&nbsp;Did&nbsp;you&nbsp;try&nbsp;debugging&nbsp;it?&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;invocation&nbsp;looks&nbsp;ok.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Nov&nbsp;11,&nbsp;2015&nbsp;at&nbsp;3:03&nbsp;PM,&nbsp;Core_Code&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:julian@corecode.at&quot;&nbsp;target=&quot;_blank&quot;&gt;julian@corecode.at&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;hello,&lt;br&gt;<br>
&lt;br&gt;<br>
we&nbsp;are&nbsp;currently&nbsp;embedding&nbsp;Mono&nbsp;to&nbsp;use&nbsp;a&nbsp;C#&nbsp;DLL,&nbsp;which&nbsp;works&nbsp;fine.&lt;br&gt;<br>
&lt;br&gt;<br>
we&nbsp;are&nbsp;using&nbsp;mono_runtime_invoke()&nbsp;to&nbsp;invoke&nbsp;a&nbsp;class&nbsp;method&nbsp;and&nbsp;are&lt;br&gt;<br>
obtaining&nbsp;the&nbsp;resulting&nbsp;object&nbsp;just&nbsp;fine.&lt;br&gt;<br>
&lt;br&gt;<br>
however,&nbsp;for&nbsp;performance&nbsp;reasons&nbsp;we&#39;d&nbsp;like&nbsp;to&nbsp;switch&nbsp;to&nbsp;using&nbsp;the&nbsp;&#39;unmanaged&lt;br&gt;<br>
thunks&#39;,&nbsp;which&nbsp;we&nbsp;did&nbsp;not&nbsp;get&nbsp;to&nbsp;work.&nbsp;our&nbsp;call&nbsp;differes&nbsp;from&nbsp;the&nbsp;example&nbsp;in&lt;br&gt;<br>
the&nbsp;&#39;embedding&nbsp;mono&#39;&nbsp;docs&nbsp;by&nbsp;the&nbsp;parameters&nbsp;and&nbsp;the&nbsp;fact&nbsp;that&nbsp;we&nbsp;are&nbsp;calling&lt;br&gt;<br>
a&nbsp;class&nbsp;method.&nbsp;however&nbsp;we&nbsp;try,&nbsp;just&nbsp;different&nbsp;crashes.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
the&nbsp;function&nbsp;we&nbsp;have&nbsp;to&nbsp;call&nbsp;has&nbsp;this&nbsp;prototype:&lt;br&gt;<br>
public&nbsp;static&nbsp;string&nbsp;ParseToJSON(string&nbsp;input)&lt;br&gt;<br>
&lt;br&gt;<br>
which&nbsp;seems&nbsp;to&nbsp;translate&nbsp;to&nbsp;a&nbsp;mono&nbsp;method&nbsp;description&nbsp;of&lt;br&gt;<br>
XLParser.ExcelFormulaParser:ParseToJSON&nbsp;(string)&lt;br&gt;<br>
&lt;br&gt;<br>
we&nbsp;have&nbsp;no&nbsp;problem&nbsp;using&nbsp;mono_runtime_invoke()&nbsp;to&nbsp;call&nbsp;it&nbsp;exactly&nbsp;like&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
MonoAssembly&nbsp;*assembly&nbsp;=&nbsp;mono_domain_assembly_open(domain,&lt;br&gt;<br>
&quot;/path/to/XLParser.dll&quot;);&lt;br&gt;<br>
MonoImage&nbsp;*image&nbsp;=&nbsp;mono_assembly_get_image(assembly);&lt;br&gt;<br>
MonoClass&nbsp;*classHandle&nbsp;=&nbsp;mono_class_from_name(image,&nbsp;&quot;XLParser&quot;,&lt;br&gt;<br>
&quot;ExcelFormulaParser&quot;);&lt;br&gt;<br>
const&nbsp;char&nbsp;*descAsString&nbsp;=&nbsp;&quot;XLParser.ExcelFormulaParser:ParseToJSON&lt;br&gt;<br>
(string)&quot;;&lt;br&gt;<br>
MonoMethodDesc&nbsp;*description&nbsp;=&nbsp;mono_method_desc_new(descAsString,&nbsp;0);&lt;br&gt;<br>
method&nbsp;=&nbsp;mono_method_desc_search_in_class(description,&nbsp;classHandle);&lt;br&gt;<br>
void&nbsp;*args[1]&nbsp;=&nbsp;{mono_string_new&nbsp;(domain,&nbsp;&quot;A+B&quot;)};&lt;br&gt;<br>
MonoObject&nbsp;*resultObject&nbsp;=&nbsp;mono_runtime_invoke(method,&nbsp;NULL,&nbsp;args,&nbsp;NULL);&lt;br&gt;<br>
MonoString&nbsp;*resultString&nbsp;=&nbsp;mono_object_to_string(resultObject,&nbsp;NULL);&lt;br&gt;<br>
char&nbsp;*resultCString&nbsp;=&nbsp;mono_string_to_utf8(resultString);&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
now&nbsp;we&nbsp;are&nbsp;trying&nbsp;the&nbsp;thunk&nbsp;method:&lt;br&gt;<br>
&lt;br&gt;<br>
typedef&nbsp;MonoObject*&nbsp;(*ParseToJSON)&nbsp;(MonoString&nbsp;*obj1,MonoString&nbsp;*obj2);&lt;br&gt;<br>
ParseToJSON&nbsp;func&nbsp;=&nbsp;mono_method_get_unmanaged_thunk(method);&lt;br&gt;<br>
MonoString&nbsp;*s&nbsp;=&nbsp;mono_string_new&nbsp;(domain,&nbsp;&quot;A+B&quot;);&lt;br&gt;<br>
MonoObject&nbsp;*result&nbsp;=&nbsp;func(s,NULL);&lt;br&gt;<br>
MonoString&nbsp;*resultstring&nbsp;=&nbsp;mono_object_to_string(result,&nbsp;NULL);&lt;br&gt;<br>
char&nbsp;*str&nbsp;=&nbsp;mono_string_to_utf8(resultstring);&lt;br&gt;<br>
&lt;br&gt;<br>
but&nbsp;it&nbsp;crashes&nbsp;-&nbsp;any&nbsp;idea&nbsp;how&nbsp;to&nbsp;call&nbsp;a&nbsp;class&nbsp;method&nbsp;via&nbsp;thunks?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/embedding-moving-from-mono-runtime-invoke-to-mono-method-get-unmanaged-thunk-or-how-to-call-class-me-tp4666935.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mono.1490590.n4.nabble.com/embedding-moving-from-mono-runtime-invoke-to-mono-method-get-unmanaged-thunk-or-how-to-call-class-me-tp4666935.html&lt;/a&gt;&lt;br&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;General&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-list&nbsp;maillist &nbsp;- &nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
