<tt>
<br>
Hi.<br>
&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
I&nbsp;own&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://opentools.homeip.net/dev-tools-for-upnp&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;Developer&nbsp;Tools&nbsp;for&nbsp;UPnP&nbsp;Technologies&lt;/a&gt;,&nbsp;I&nbsp;widely&nbsp;used&nbsp;set&nbsp;of&nbsp;tools&nbsp;for&nbsp;building&nbsp;and&nbsp;debugging&nbsp;UPnP&nbsp;related&nbsp;software.&nbsp;I&nbsp;have&nbsp;gotten&nbsp;many&nbsp;requests&nbsp;to&nbsp;run&nbsp;the&nbsp;tools&nbsp;on&nbsp;MONO&nbsp;and&nbsp;have&nbsp;gotten&nbsp;rid&nbsp;of&nbsp;all&nbsp;the&nbsp;C/C++&nbsp;native&nbsp;code&nbsp;and&nbsp;so&nbsp;far,&nbsp;it's&nbsp;working&nbsp;except&nbsp;for&nbsp;one&nbsp;problem:&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
I&nbsp;need&nbsp;to&nbsp;bind&nbsp;to&nbsp;UDP&nbsp;port&nbsp;1900&nbsp;non-exclusively&nbsp;to&nbsp;receive&nbsp;SSDP&nbsp;multicast&nbsp;traffic.&nbsp;I&nbsp;use&nbsp;Ubuntu&nbsp;10.04,&nbsp;MONO&nbsp;2.4.4&nbsp;and&nbsp;I&nbsp;get&nbsp;a&nbsp;&quot;SocketException:&nbsp;Protocol&nbsp;Option&nbsp;not&nbsp;supported&quot;&nbsp;when&nbsp;trying&nbsp;to&nbsp;set&nbsp;UdpClient's&nbsp;ExclusiveAddressUse&nbsp;property.&nbsp;Are&nbsp;there&nbsp;any&nbsp;alternatives?&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
I&nbsp;am&nbsp;also&nbsp;trying&nbsp;to&nbsp;find&nbsp;precedents&nbsp;for&nbsp;UPnP&nbsp;work&nbsp;on&nbsp;MONO.&nbsp;My&nbsp;multicast&nbsp;socket&nbsp;setup&nbsp;code&nbsp;below&nbsp;(Apache&nbsp;2.0&nbsp;license).&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
Thanks,&lt;br&nbsp;/&gt;<br>
Ylian&lt;br&nbsp;/&gt;<br>
&lt;a&nbsp;href=&quot;http://opentools.homeip.net/&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;opentools.homeip.net&lt;/a&gt;&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;code&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;UPnPMulticastSniffer&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;delegate&nbsp;void&nbsp;PacketHandler(object&nbsp;sender,&nbsp;string&nbsp;Packet,&nbsp;IPEndPoint&nbsp;Local,&nbsp;IPEndPoint&nbsp;From);&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;event&nbsp;PacketHandler&nbsp;OnPacket;&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;UdpClient&nbsp;client&nbsp;=&nbsp;null;&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;UPnPMulticastSniffer(IPEndPoint&nbsp;local)&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;=&nbsp;new&nbsp;UdpClient(local.AddressFamily);&lt;br&nbsp;/&gt;<br>
&lt;b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.ExclusiveAddressUse&nbsp;=&nbsp;false;&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.Client.SetSocketOption(SocketOptionLevel.Socket,&nbsp;SocketOptionName.ExclusiveAddressUse,&nbsp;false);&lt;br&nbsp;/&gt;&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.Client.SetSocketOption(SocketOptionLevel.Socket,&nbsp;SocketOptionName.ReuseAddress,&nbsp;true);&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.EnableBroadcast&nbsp;=&nbsp;true;&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.Client.Bind(local);&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(local.AddressFamily&nbsp;==&nbsp;AddressFamily.InterNetwork)&nbsp;&lt;br&nbsp;/&gt;client.JoinMulticastGroup(IPAddress.Parse(&quot;239.255.255.250&quot;),&nbsp;local.Address);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(local.AddressFamily&nbsp;==&nbsp;AddressFamily.InterNetworkV6)&nbsp;&lt;br&nbsp;/&gt;client.JoinMulticastGroup((int)local.Address.ScopeId,&nbsp;IPAddress.Parse(&quot;FF02::C&quot;));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.BeginReceive(new&nbsp;AsyncCallback(OnReceiveSink),&nbsp;null);&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;OnReceiveSink(IAsyncResult&nbsp;ar)&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPEndPoint&nbsp;ep&nbsp;=&nbsp;null;&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;buf&nbsp;=&nbsp;null;&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{&nbsp;buf&nbsp;=&nbsp;client.EndReceive(ar,&nbsp;ref&nbsp;ep);&nbsp;}&nbsp;catch&nbsp;(Exception)&nbsp;{&nbsp;}&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buf&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;OnPacket&nbsp;!=&nbsp;null)&nbsp;OnPacket(this,&nbsp;UTF8Encoding.UTF8.GetString(buf,&nbsp;0,&nbsp;&lt;br&nbsp;/&gt;buf.Length),&nbsp;(IPEndPoint)client.Client.LocalEndPoint,&nbsp;ep);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{&nbsp;client.BeginReceive(new&nbsp;AsyncCallback(OnReceiveSink),&nbsp;null);&nbsp;}&nbsp;catch&nbsp;(Exception)&nbsp;{&nbsp;}&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;Dispose()&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(client&nbsp;==&nbsp;null)&nbsp;return;&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.Close();&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;=&nbsp;null;&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&nbsp;/&gt;<br>
&lt;/code&gt;<br>
<br>
&lt;br&gt;&lt;hr&nbsp;align=&quot;left&quot;&nbsp;width=&quot;300&quot;&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/Porting-UPnP-Tools-to-MONO-Socket-ExclusiveAddressUse-problem-tp2173013p2173013.html&quot;&gt;Porting&nbsp;UPnP&nbsp;Tools&nbsp;to&nbsp;MONO&nbsp;-&nbsp;Socket&nbsp;&quot;ExclusiveAddressUse&quot;&nbsp;problem&lt;/a&gt;&lt;br&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/Mono-General-f1490591.html&quot;&gt;Mono&nbsp;-&nbsp;General&nbsp;mailing&nbsp;list&nbsp;archive&lt;/a&gt;&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>

</tt>
