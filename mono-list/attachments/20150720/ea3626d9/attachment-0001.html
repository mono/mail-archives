<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hey&nbsp;guys,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;looking&nbsp;for&nbsp;a&nbsp;mono&nbsp;expert&nbsp;on&nbsp;the&nbsp;managed&nbsp;threading&nbsp;system,&nbsp;hopefully&nbsp;you&nbsp;can&nbsp;give&nbsp;me&nbsp;a&nbsp;pointer&nbsp;to&nbsp;where&nbsp;to&nbsp;look.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;a&nbsp;couple&nbsp;of&nbsp;my&nbsp;users&nbsp;experience&nbsp;is&nbsp;that&nbsp;since&nbsp;linux&nbsp;kernel&nbsp;4.1&nbsp;mono&nbsp;crashes&nbsp;in&nbsp;a&nbsp;reproducible&nbsp;manner.&nbsp;(Using&nbsp;test&nbsp;case&nbsp;bug-18026&nbsp;in&nbsp;a&nbsp;loop,&nbsp;which&nbsp;is&nbsp;a&nbsp;threadpool&nbsp;stress-test)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;similar&nbsp;problem&nbsp;occurred&nbsp;in&nbsp;3.13.0&nbsp;but&nbsp;that&nbsp;was&nbsp;fixed&nbsp;by&nbsp;backporting&nbsp;some&nbsp;commits&nbsp;in&nbsp;the&nbsp;ubuntu&nbsp;kernel.&nbsp;(See &lt;a&nbsp;href=&quot;https://bugzilla.xamarin.com/show_bug.cgi?id=29212&quot;&gt;https://bugzilla.xamarin.com/show_bug.cgi?id=29212&lt;/a&gt;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Initially&nbsp;I&nbsp;believed&nbsp;that&nbsp;in&nbsp;4.1&nbsp;those&nbsp;commits&nbsp;were&nbsp;reverted,&nbsp;but&nbsp;tests&nbsp;indicated&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;cause.&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;did&nbsp;a&nbsp;full&nbsp;bisect&nbsp;on&nbsp;linux&nbsp;4.0-4.1&nbsp;on&nbsp;a&nbsp;64-bit&nbsp;Ubuntu&nbsp;14.04.2&nbsp;Virtualbox.&nbsp;(~13&nbsp;compiles&nbsp;of&nbsp;the&nbsp;kernel,&nbsp;took&nbsp;a&nbsp;couple&nbsp;of&nbsp;days)&lt;/div&gt;&lt;div&gt;And&nbsp;it&nbsp;ended&nbsp;up&nbsp;on &lt;a&nbsp;href=&quot;https://github.com/torvalds/linux/commit/c70e1b475f37f07ab7181ad28458666d59aae634&quot;&gt;https://github.com/torvalds/linux/commit/c70e1b475f37f07ab7181ad28458666d59aae634&lt;/a&gt;.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;seems&nbsp;to&nbsp;cause&nbsp;NullReferenceException&nbsp;and&nbsp;possibly&nbsp;native&nbsp;SIGSEGVs&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;places.&nbsp;(I&nbsp;can&nbsp;dump&nbsp;some&nbsp;stacktraces&nbsp;if&nbsp;desired,&nbsp;but&nbsp;I&nbsp;suspect&nbsp;that&nbsp;won&#39;t&nbsp;be&nbsp;helpful&nbsp;coz&nbsp;the&nbsp;corruption&nbsp;is&nbsp;likely&nbsp;caused&nbsp;elsewhere.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;me&nbsp;it&nbsp;seems&nbsp;impossible&nbsp;that&nbsp;reading&nbsp;the&nbsp;tsc&nbsp;in&nbsp;any&nbsp;way&nbsp;could&nbsp;result&nbsp;in&nbsp;the&nbsp;nullrefs.&nbsp;So&nbsp;my&nbsp;guess&nbsp;would&nbsp;it&nbsp;a&nbsp;side-effect&nbsp;of&nbsp;the&nbsp;memory&nbsp;barrier.&nbsp;From&nbsp;what&nbsp;I&nbsp;understand&nbsp;from&nbsp;the&nbsp;commit,&nbsp;the&nbsp;&#39;mfence+lfence&#39;&nbsp;changed&nbsp;to&nbsp;&#39;mfence&nbsp;or&nbsp;lfence&#39;&nbsp;(depending&nbsp;on&nbsp;what&nbsp;the&nbsp;cpu&nbsp;supports)&nbsp;and&nbsp;mfrence=lfence+sfence&nbsp;(not&nbsp;entirely&nbsp;true,&nbsp;but&nbsp;close),&nbsp;so&nbsp;I&nbsp;have&nbsp;no&nbsp;idea&nbsp;what&nbsp;the&nbsp;heck&nbsp;is&nbsp;going&nbsp;on&nbsp;there.&lt;/div&gt;&lt;div&gt;But&nbsp;if&nbsp;I&nbsp;would&nbsp;venture&nbsp;an&nbsp;guess&nbsp;that&nbsp;somewhere,&nbsp;indirectly,&nbsp;mono&nbsp;unknowingly&nbsp;relies&nbsp;on&nbsp;that&nbsp;barrier&nbsp;to&nbsp;be&nbsp;there.&lt;/div&gt;&lt;div&gt;Theoretically&nbsp;it&nbsp;still&nbsp;means&nbsp;other&nbsp;native&nbsp;apps&nbsp;could&nbsp;experience&nbsp;the&nbsp;same&nbsp;problem,&nbsp;but&nbsp;I&nbsp;would&#39;ve&nbsp;expected&nbsp;reports&nbsp;about&nbsp;that&nbsp;already.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;experience&nbsp;in&nbsp;these&nbsp;matters&nbsp;is&nbsp;pretty&nbsp;much&nbsp;non-existent.&nbsp;But&nbsp;dumping&nbsp;issues&nbsp;on&nbsp;devs&nbsp;is&nbsp;the&nbsp;least&nbsp;productive&nbsp;way&nbsp;to&nbsp;get&nbsp;them&nbsp;fixed,&nbsp;so&nbsp;I&nbsp;try&nbsp;to&nbsp;investigate&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;can.&nbsp;Especially&nbsp;since&nbsp;it&nbsp;involves&nbsp;an&nbsp;issue&nbsp;that&nbsp;could&nbsp;be&nbsp;caused&nbsp;by&nbsp;either&nbsp;mono&nbsp;or&nbsp;the&nbsp;kernel.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;my&nbsp;question&nbsp;is:&nbsp;Is&nbsp;there&nbsp;a&nbsp;likely&nbsp;candidate&nbsp;in&nbsp;mono&nbsp;where&nbsp;it&nbsp;uses&nbsp;the&nbsp;tsc&nbsp;(possibly&nbsp;for&nbsp;profiling)&nbsp;where&nbsp;the&nbsp;changed&nbsp;barrier&nbsp;could&nbsp;cause&nbsp;this&nbsp;odd&nbsp;behavior?&nbsp;And&nbsp;obviously,&nbsp;is&nbsp;there&nbsp;anything&nbsp;in&nbsp;particular&nbsp;I&nbsp;could&nbsp;try&nbsp;to&nbsp;narrow&nbsp;this&nbsp;down&nbsp;further?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Almost&nbsp;forgot,&nbsp;but&nbsp;I&nbsp;did&nbsp;the&nbsp;bisect&nbsp;using&nbsp;mono&nbsp;4.0.2.5,&nbsp;but&nbsp;I&nbsp;tested&nbsp;the&nbsp;nightly&nbsp;version&nbsp;as&nbsp;well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;time.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Taloth&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
