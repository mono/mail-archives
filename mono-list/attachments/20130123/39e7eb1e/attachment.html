<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Dear&nbsp;Mono&nbsp;experts,&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;in&nbsp;the&nbsp;process&nbsp;of&nbsp;moving&nbsp;an&nbsp;email&nbsp;newsletter&nbsp;service&nbsp;from&nbsp;a&nbsp;Windows&nbsp;server&nbsp;running&nbsp;Microsoft.NET&nbsp;4.5&nbsp;to&nbsp;a&nbsp;Linux&nbsp;server&nbsp;running&nbsp;Mono&nbsp;3.0.3.&nbsp;The&nbsp;service&nbsp;uses&nbsp;Amazon&#39;s&nbsp;&quot;Simple&nbsp;Email&nbsp;Service&quot;&nbsp;(SES)&nbsp;to&nbsp;deliver&nbsp;the&nbsp;emails,&nbsp;via&nbsp;the&nbsp;official&nbsp;.NET&nbsp;SDK&nbsp;(wrapping&nbsp;a&nbsp;REST&nbsp;interface)&nbsp;[1].&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;While&nbsp;sending&nbsp;emails&nbsp;via&nbsp;SES&nbsp;sequentially&nbsp;from&nbsp;Mono&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;slightly&nbsp;faster&nbsp;than&nbsp;Microsoft.NET&nbsp;using&nbsp;similar&nbsp;hardware,&nbsp;I&nbsp;am&nbsp;running&nbsp;into&nbsp;serious&nbsp;performance&nbsp;trouble&nbsp;when&nbsp;attempting&nbsp;to&nbsp;deliver&nbsp;multiple&nbsp;mails&nbsp;in&nbsp;parallel.&nbsp;I&nbsp;have&nbsp;experimented&nbsp;a&nbsp;bit&nbsp;and&nbsp;drawn&nbsp;a&nbsp;chart&nbsp;[2]&nbsp;showing&nbsp;the&nbsp;time&nbsp;required&nbsp;to&nbsp;send&nbsp;128&nbsp;emails&nbsp;on&nbsp;both&nbsp;platforms&nbsp;using&nbsp;a&nbsp;varying&nbsp;number&nbsp;of&nbsp;threads.&nbsp;As&nbsp;you&nbsp;can&nbsp;see,&nbsp;performance&nbsp;on&nbsp;Mono&nbsp;degrades&nbsp;rapidly&nbsp;after&nbsp;8&nbsp;threads,&nbsp;and&nbsp;with&nbsp;128&nbsp;threads&nbsp;I&nbsp;get&nbsp;only&nbsp;HTTP&nbsp;timeouts&nbsp;–&nbsp;not&nbsp;a&nbsp;single&nbsp;email&nbsp;is&nbsp;delivered.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Profiling&nbsp;via&nbsp;console&nbsp;output,&nbsp;it&nbsp;turns&nbsp;out&nbsp;that&nbsp;the&nbsp;first&nbsp;&quot;batch&quot;&nbsp;of&nbsp;mails&nbsp;is&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;slowdown.&nbsp;With&nbsp;two&nbsp;threads,&nbsp;sending&nbsp;one&nbsp;email&nbsp;in&nbsp;each,&nbsp;both&nbsp;threads&nbsp;finish&nbsp;in&nbsp;around&nbsp;2200&nbsp;ms.&nbsp;With&nbsp;four&nbsp;threads,&nbsp;sending&nbsp;one&nbsp;email&nbsp;in&nbsp;each,&nbsp;they&nbsp;all&nbsp;finish&nbsp;in&nbsp;around&nbsp;4400&nbsp;ms.&nbsp;Eight&nbsp;threads,&nbsp;around&nbsp;8800&nbsp;ms,&nbsp;etc.&nbsp;It&nbsp;seems&nbsp;as&nbsp;if&nbsp;the&nbsp;web&nbsp;service,&nbsp;while&nbsp;spawned simultaneously, are&nbsp;run&nbsp;sequentially&nbsp;and&nbsp;are&nbsp;required&nbsp;to&nbsp;wait&nbsp;for&nbsp;one&nbsp;another&nbsp;before&nbsp;returning.&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;ideas&nbsp;what&nbsp;might&nbsp;be&nbsp;triggering&nbsp;this&nbsp;behavior?&nbsp;The&nbsp;source&nbsp;code&nbsp;for&nbsp;the&nbsp;Amazon&nbsp;SDK&nbsp;is&nbsp;available&nbsp;on&nbsp;GitHub&nbsp;[3],&nbsp;but&nbsp;I&nbsp;have&nbsp;not&nbsp;been&nbsp;able&nbsp;to&nbsp;pinpoint&nbsp;anything&nbsp;suspiciously.&nbsp;Maybe&nbsp;the&nbsp;use&nbsp;of&nbsp;the&nbsp;async&nbsp;methods&nbsp;on&nbsp;HttpWebRequest?&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jørn&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[1]:&nbsp;&lt;a&nbsp;href=&quot;http://aws.amazon.com/sdkfornet/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://aws.amazon.com/sdkfornet/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;[2]:&nbsp;&lt;a&nbsp;href=&quot;http://i.stack.imgur.com/tiuDg.png&quot;&nbsp;target=&quot;_blank&quot;&gt;http://i.stack.imgur.com/tiuDg.png&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;[3]:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/aws/aws-sdk-net&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/aws/aws-sdk-net&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
