<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Ahh,&nbsp;delegates!&nbsp; Those&nbsp;are&nbsp;even&nbsp;better&nbsp;than&nbsp;thunks,&nbsp;because&nbsp;I&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;pass&nbsp;the&nbsp;MonoObject&nbsp;in&nbsp;too.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Unfortunately,&nbsp;I&nbsp;can&#39;t&nbsp;get&nbsp;those&nbsp;to&nbsp;work&nbsp;at&nbsp;all.&nbsp; To&nbsp;my&nbsp;method&nbsp;called&nbsp;by&nbsp;C#&nbsp;to&nbsp;register&nbsp;the&nbsp;managed&nbsp;object,&nbsp;I&nbsp;added&nbsp;a&nbsp;parameter&nbsp;that&nbsp;takes&nbsp;a&nbsp;delegate.&nbsp; In&nbsp;C#,&nbsp;I&nbsp;call&nbsp;it&nbsp;like&nbsp;this:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;var&nbsp;mc&nbsp;=&nbsp;new&nbsp;MainClass();&lt;/div&gt;&lt;div&gt;native_RegisterObject(mc,&nbsp;mc.Add);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;the&nbsp;C++&nbsp;side,&nbsp;I&nbsp;have&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;typedef&nbsp;float&nbsp;(*MonoAddFunc)(float,&nbsp;float);&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;void&nbsp;native_RegisterObject(MonoObject&nbsp;*mobj,&nbsp;MonoAddFunc&nbsp;delegate)&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;g_mobj&nbsp;=&nbsp;mobj;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;g_delegate&nbsp;=&nbsp;delegate;&lt;/div&gt;<br>
&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;the&nbsp;debugger,&nbsp;delegate&nbsp;is&nbsp;a&nbsp;non-zero&nbsp;number.&nbsp; I&nbsp;was&nbsp;using&nbsp;native_RegisterObject&nbsp;as&nbsp;an&nbsp;internal&nbsp;call,&nbsp;but&nbsp;I&nbsp;noticed&nbsp;in&nbsp;your&nbsp;code&nbsp;here&nbsp;you&nbsp;had&nbsp;&quot;DllImport(...)&quot;&nbsp;inside&nbsp;your&nbsp;C#&nbsp;for&nbsp;calling&nbsp;the&nbsp;native&nbsp;method.&nbsp; I&nbsp;read&nbsp;more&nbsp;in&nbsp;the&nbsp;documentation&nbsp;that&nbsp;the&nbsp;difference&nbsp;between&nbsp;P/Invoke&nbsp;and&nbsp;internal&nbsp;calls&nbsp;is&nbsp;that&nbsp;P/Invoke&nbsp;does&nbsp;more&nbsp;marshaling,&nbsp;which&nbsp;is&nbsp;seems&nbsp;like&nbsp;I&nbsp;need&nbsp;in&nbsp;this&nbsp;case&nbsp;to&nbsp;marshal&nbsp;the&nbsp;delegate&nbsp;into&nbsp;a&nbsp;C++&nbsp;function&nbsp;pointer.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;when&nbsp;I&nbsp;run&nbsp;that,&nbsp;I&nbsp;get&nbsp;an&nbsp;EntryPointNotFound&nbsp;exception.&nbsp; I&nbsp;put&nbsp;an&nbsp;extern&nbsp;&quot;C&quot;&nbsp;block&nbsp;around&nbsp;my&nbsp;native_RegisterObject,&nbsp;but&nbsp;that&nbsp;didn&#39;t&nbsp;help.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;C#,&nbsp;this&nbsp;is&nbsp;how&nbsp;I&nbsp;declare&nbsp;the&nbsp;native&nbsp;function:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;private&nbsp;delegate&nbsp;float&nbsp;AddDelegate(float&nbsp;a,&nbsp;float&nbsp;b);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[DllImport(&quot;__Internal&quot;,&nbsp;EntryPoint=&quot;native_registerObject&quot;)]&lt;/div&gt;&lt;div&gt;private&nbsp;static&nbsp;extern&nbsp;void&nbsp;native_registerObject(MainClass&nbsp;instance,&nbsp;AddDelegate&nbsp;add);&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;then&nbsp;I&nbsp;call&nbsp;that&nbsp;as&nbsp;above.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;I&nbsp;use&nbsp;internal&nbsp;calls&nbsp;for&nbsp;registering&nbsp;a&nbsp;delegate?&nbsp; If&nbsp;not,&nbsp;how&nbsp;do&nbsp;I&nbsp;expose&nbsp;my&nbsp;native&nbsp;functions&nbsp;such&nbsp;that&nbsp;the&nbsp;runtime&nbsp;can&nbsp;find&nbsp;them&nbsp;in&nbsp;the&nbsp;image&nbsp;that&#39;s&nbsp;running?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;you&nbsp;help,&nbsp;Robert!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Tom&lt;/div&gt;&lt;/div&gt;<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&lt;br/&gt;&lt;hr&nbsp;align=&quot;left&quot;&nbsp;width=&quot;300&quot;&nbsp;/&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/NullReferenceException-when-calling-thunk-tp4658230p4658247.html&quot;&gt;Re:&nbsp;NullReferenceException&nbsp;when&nbsp;calling&nbsp;thunk&lt;/a&gt;&lt;br/&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/Mono-General-f1490591.html&quot;&gt;Mono&nbsp;-&nbsp;General&nbsp;mailing&nbsp;list&nbsp;archive&lt;/a&gt;&nbsp;at&nbsp;Nabble.com.&lt;br/&gt;
</tt>
