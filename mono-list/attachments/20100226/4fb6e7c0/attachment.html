<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Feb&nbsp;26,&nbsp;2010&nbsp;at&nbsp;5:53&nbsp;PM,&nbsp;JCKodel&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jckodel@gmail.com&quot;&gt;jckodel@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;br&gt;<br>
First&nbsp;of&nbsp;all,&nbsp;this&nbsp;is&nbsp;NOT&nbsp;a&nbsp;&amp;quot;native&nbsp;MS&nbsp;.net&nbsp;framework&nbsp;is&nbsp;better&amp;quot;&nbsp;e-mail.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;want&nbsp;to&nbsp;build&nbsp;a&nbsp;huge&nbsp;cross-platform&nbsp;system,&nbsp;and&nbsp;I&amp;#39;m&nbsp;a&nbsp;.net&nbsp;programmer&lt;br&gt;<br>
since,&nbsp;well,&nbsp;ever&nbsp;=)&nbsp;so&nbsp;making&nbsp;something&nbsp;in&nbsp;.net&nbsp;running&nbsp;on&nbsp;all&nbsp;major&lt;br&gt;<br>
platforms&nbsp;would&nbsp;be&nbsp;heaven&nbsp;for&nbsp;me&nbsp;=)&nbsp;(not&nbsp;really&nbsp;many&nbsp;good&nbsp;results&nbsp;with&nbsp;Adobe&lt;br&gt;<br>
AIR,&nbsp;RealBasic,&nbsp;Lazaro,&nbsp;etc.)&lt;br&gt;<br>
&lt;br&gt;<br>
So,&nbsp;I&nbsp;run&nbsp;a&nbsp;very&nbsp;dumb&nbsp;and&nbsp;simple&nbsp;test&nbsp;to&nbsp;check&nbsp;out&nbsp;if&nbsp;there&nbsp;were&nbsp;some&lt;br&gt;<br>
performance&nbsp;issue&nbsp;with&nbsp;mono.&nbsp;I&amp;#39;m&nbsp;using&nbsp;the&nbsp;latest&nbsp;stable&nbsp;release&nbsp;on&nbsp;both&lt;br&gt;<br>
Windows&nbsp;and&nbsp;Linux&nbsp;machines&nbsp;(didn&amp;#39;t&nbsp;tested&nbsp;on&nbsp;Mac&nbsp;yet)&nbsp;and&nbsp;I&amp;#39;m&nbsp;getting&nbsp;a&nbsp;10x&lt;br&gt;<br>
slower&nbsp;results&nbsp;for&nbsp;mono&nbsp;=(&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;tests&nbsp;are&nbsp;very&nbsp;simple,&nbsp;although&nbsp;the&nbsp;code&nbsp;itself&nbsp;is&nbsp;not&nbsp;well&nbsp;written&lt;br&gt;<br>
(that&nbsp;was&nbsp;made&nbsp;on&nbsp;purpose).&nbsp;I&nbsp;know&nbsp;I&nbsp;can&nbsp;do&nbsp;the&nbsp;math&nbsp;way&nbsp;better&nbsp;and&nbsp;using&lt;br&gt;<br>
some&nbsp;other&nbsp;constructs&nbsp;on&nbsp;strings&nbsp;that&nbsp;are&nbsp;waaaay&nbsp;faster&nbsp;than&nbsp;raw&nbsp;strings.&lt;br&gt;<br>
The&nbsp;point&nbsp;is&nbsp;to&nbsp;force&nbsp;the&nbsp;memory&nbsp;manipulation,&nbsp;type&nbsp;converters&nbsp;and&nbsp;float&lt;br&gt;<br>
point&nbsp;calculations.&lt;br&gt;<br>
&lt;br&gt;<br>
So,&nbsp;am&nbsp;I&nbsp;doing&nbsp;something&nbsp;wrong&nbsp;(in&nbsp;the&nbsp;sense&nbsp;of&nbsp;mono&nbsp;configuration&nbsp;or&lt;br&gt;<br>
options),&nbsp;or&nbsp;there&nbsp;is&nbsp;any&nbsp;tips&nbsp;that&nbsp;I&nbsp;should&nbsp;be&nbsp;aware&nbsp;of&nbsp;to,&nbsp;at&nbsp;least,&nbsp;bring&lt;br&gt;<br>
this&nbsp;difference&nbsp;for,&nbsp;say,&nbsp;2x&nbsp;slower?&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;source&nbsp;code&nbsp;for&nbsp;test&nbsp;is&nbsp;simple:&lt;br&gt;<br>
&lt;br&gt;<br>
First,&nbsp;some&nbsp;stupid&nbsp;Math&nbsp;calculations:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;ct&nbsp;=&nbsp;0;&nbsp;ct&nbsp;&amp;lt;&nbsp;1000000;&nbsp;ct++)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; decimal&nbsp;d&nbsp;=&nbsp;Convert.ToDecimal(Math.Pow(ct,&nbsp;4));&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d&nbsp;=&nbsp;Convert.ToDecimal(Math.Sqrt(Convert.ToDouble(d))&nbsp;*&nbsp;4&nbsp;*&lt;br&gt;<br>
Math.Atan(Convert.ToDouble(ct)));&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;<br>
&lt;br&gt;<br>
Then&nbsp;some&nbsp;memory&nbsp;play&nbsp;with&nbsp;raw&nbsp;strings:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;ct&nbsp;=&nbsp;0;&nbsp;ct&nbsp;&amp;lt;&nbsp;100000;&nbsp;ct++)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp;foo&nbsp;=&nbsp;&amp;quot;foo&amp;quot;;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;x&nbsp;=&nbsp;1;&nbsp;x&nbsp;&amp;lt;&nbsp;10;&nbsp;x++)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foo&nbsp;+=&nbsp;&amp;quot;&nbsp;&amp;quot;&nbsp;+&nbsp;x.ToString(&amp;quot;X2&amp;quot;)&nbsp;+&nbsp;foo;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp;bar&nbsp;=&nbsp;foo;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foo&nbsp;+=&nbsp;bar;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;results:&lt;br&gt;<br>
&lt;br&gt;<br>
Each&nbsp;test&nbsp;was&nbsp;done&nbsp;3&nbsp;times&nbsp;in&nbsp;a&nbsp;row.&nbsp;The&nbsp;numbers&nbsp;are&nbsp;milliseconds&nbsp;(lower,&lt;br&gt;<br>
better):&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;the&nbsp;executable&nbsp;generated&nbsp;by&nbsp;MonoDevelop,&nbsp;in&nbsp;Release&nbsp;configuration,&lt;br&gt;<br>
running&nbsp;on&nbsp;a&nbsp;Windows&nbsp;7&nbsp;Console:&lt;br&gt;<br>
&lt;br&gt;<br>
Math:&nbsp;535&lt;br&gt;<br>
Strings:&nbsp;2.038&lt;br&gt;<br>
Math:&nbsp;530&lt;br&gt;<br>
Strings:&nbsp;1.962&lt;br&gt;<br>
Math:&nbsp;530&lt;br&gt;<br>
Strings:&nbsp;1.963&lt;br&gt;<br>
&lt;br&gt;<br>
Using&nbsp;the&nbsp;mono.exe&nbsp;running&nbsp;the&nbsp;same&nbsp;executable&nbsp;above:&lt;br&gt;<br>
Math:&nbsp;6.875&lt;br&gt;<br>
String:&nbsp;6.206&lt;br&gt;<br>
Math:&nbsp;6.840&lt;br&gt;<br>
String:&nbsp;6.114&lt;br&gt;<br>
Math:&nbsp;6.857&lt;br&gt;<br>
String:&nbsp;6.116&lt;br&gt;<br>
&lt;br&gt;<br>
Running&nbsp;the&nbsp;same&nbsp;executable&nbsp;above&nbsp;using&nbsp;./Benchmark.exe&nbsp;on&nbsp;a&nbsp;Ubuntu&nbsp;terminal&lt;br&gt;<br>
running&nbsp;on&nbsp;a&nbsp;VirtualBox&nbsp;VM&nbsp;(not&nbsp;quite&nbsp;sure&nbsp;which&nbsp;mono&nbsp;version&nbsp;I&amp;#39;m&nbsp;running&nbsp;on&lt;br&gt;<br>
this&nbsp;machine,&nbsp;anyway,&nbsp;is&nbsp;a&nbsp;VM&nbsp;and&nbsp;is&nbsp;running&nbsp;faster&nbsp;than&nbsp;mono.exe&nbsp;on&nbsp;native&lt;br&gt;<br>
Windows):&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;There&nbsp;are&nbsp;a&nbsp;few&nbsp;things&nbsp;to&nbsp;notice.&nbsp;A&nbsp;virtualized&nbsp;machine&nbsp;will&nbsp;perform&nbsp;significantly&nbsp;slower,&nbsp;specially&lt;br&gt;for&nbsp;CPU&nbsp;intensive&nbsp;workloads.&nbsp;You&nbsp;should&nbsp;try&nbsp;our&nbsp;live&nbsp;CD&nbsp;to&nbsp;get&nbsp;better&nbsp;numbers.&lt;br&gt;&lt;br&gt;Mono&nbsp;runs&nbsp;faster&nbsp;on&nbsp;linux&nbsp;than&nbsp;windows,&nbsp;but&nbsp;the&nbsp;virtualization&nbsp;has&nbsp;it&amp;#39;s&nbsp;costs.&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;To&nbsp;find&nbsp;our&nbsp;which&nbsp;version&nbsp;of&nbsp;mono&nbsp;you&amp;#39;re&nbsp;running&nbsp;use&nbsp;&amp;quot;mono&nbsp;--version&amp;quot;&nbsp;on&nbsp;the&nbsp;console.&nbsp;Since&nbsp;you&amp;#39;re&lt;br&gt;using&nbsp;what&nbsp;comes&nbsp;with&nbsp;ubuntu&nbsp;it&amp;#39;s&nbsp;most&nbsp;likely&nbsp;2.4.&nbsp;The&nbsp;2.6&nbsp;release&nbsp;has&nbsp;some&nbsp;performance&nbsp;improvements.&lt;br&gt;<br>
&lt;br&gt;Now&nbsp;about&nbsp;your&nbsp;benchmark&nbsp;in&nbsp;particular.&nbsp;Mono&nbsp;has&nbsp;a&nbsp;significantly&nbsp;worse&nbsp;GC,&nbsp;so&nbsp;any&nbsp;micro-benchmark&lt;br&gt;that&nbsp;stress&nbsp;this&nbsp;will&nbsp;show&nbsp;some&nbsp;significant&nbsp;performance &nbsp;degradation.&nbsp;We&nbsp;are&nbsp;working&nbsp;on&nbsp;replacing&nbsp;it&nbsp;with&lt;br&gt;a&nbsp;generational&nbsp;copying&nbsp;collection&nbsp;(read&nbsp;very&nbsp;fast),&nbsp;but&nbsp;it&nbsp;won&amp;#39;t&nbsp;be&nbsp;ready&nbsp;any&nbsp;time&nbsp;soon.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;other&nbsp;point&nbsp;is&nbsp;that&nbsp;you&nbsp;didn&amp;#39;t&nbsp;mention&nbsp;if&nbsp;you&nbsp;were&nbsp;testing&nbsp;under&nbsp;32&nbsp;or&nbsp;64bits.&nbsp;Mono&nbsp;32bits&nbsp;has&nbsp;a&nbsp;slower&lt;br&gt;FP&nbsp;implementation&nbsp;which&nbsp;shows&nbsp;up&nbsp;pretty&nbsp;badly.&nbsp;This&nbsp;is&nbsp;something&nbsp;that&nbsp;will&nbsp;eventually&nbsp;be&nbsp;fixed.&lt;br&gt;&lt;br&gt;<br>
Mono&nbsp;on&nbsp;real&nbsp;workloads&nbsp;is&nbsp;not&nbsp;10x&nbsp;slower&nbsp;than&nbsp;MS,&nbsp;it&nbsp;comes&nbsp;to&nbsp;be&nbsp;10-40%&nbsp;slower&nbsp;on&nbsp;things&nbsp;like&nbsp;&lt;a&nbsp;href=&quot;http://asp.net&quot;&gt;asp.net&lt;/a&gt;.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
