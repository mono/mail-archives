<tt>
You&nbsp;should&nbsp;init&nbsp;the&nbsp;runtime&nbsp;only&nbsp;once.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Apr&nbsp;18,&nbsp;2009&nbsp;at&nbsp;3:32&nbsp;PM,&nbsp;fozzie&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:david_aiken@yahoo.com&quot;&gt;david_aiken@yahoo.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;br&gt;<br>
hi&nbsp;all..&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;m&nbsp;embedding&nbsp;mono&nbsp;in&nbsp;a&nbsp;Vista&nbsp;application&nbsp;which&nbsp;accesses&nbsp;multiple&lt;br&gt;<br>
assemblies.&nbsp;For&nbsp;each&nbsp;assembly&nbsp;i&nbsp;call&nbsp;mono_jit_init,&nbsp;make&nbsp;the&nbsp;calls,&nbsp;then&lt;br&gt;<br>
mono_jit_cleanup.&nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;on&nbsp;the&nbsp;second&nbsp;call&nbsp;to&nbsp;mono_jit_init&lt;br&gt;<br>
there&nbsp;is&nbsp;a&nbsp;crash&nbsp;in&nbsp;...\mono\mini\mini-x86.c(611):&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;(!func)&nbsp;{&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptr&nbsp;=&nbsp;mono_global_codeman_reserve&nbsp;(sizeof&nbsp;(cpuid_impl));&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcpy&nbsp;(ptr,&nbsp;cpuid_impl,&nbsp;sizeof&nbsp;(cpuid_impl));&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; func&nbsp;=&nbsp;(CpuidFunc)ptr;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; func&nbsp;(id,&nbsp;p_eax,&nbsp;p_ebx,&nbsp;p_ecx,&nbsp;p_edx);&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;mono_global_codeman_reserve&nbsp;returns&nbsp;a&nbsp;bad&nbsp;pointer.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;get&nbsp;the&nbsp;same&nbsp;behavior&nbsp;if&nbsp;i&nbsp;make&nbsp;the&nbsp;following&nbsp;modification&nbsp;to&nbsp;the&nbsp;teste.c&lt;br&gt;<br>
embedded&nbsp;sample:&lt;br&gt;<br>
&lt;br&gt;<br>
...&lt;br&gt;<br>
&nbsp; &nbsp; mono_config_parse&nbsp;(NULL);&lt;br&gt;<br>
&nbsp; &nbsp; for(i=0;i&amp;lt;10;i++)&lt;br&gt;<br>
&nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; domain&nbsp;=&nbsp;mono_jit_init&nbsp;(file);&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mono_add_internal_call&nbsp;(&amp;quot;MonoEmbed::gimme&amp;quot;,&nbsp;gimme);&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; main_function&nbsp;(domain,&nbsp;file,&nbsp;argc&nbsp;-&nbsp;1,&nbsp;argv&nbsp;+&nbsp;1);&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retval&nbsp;=&nbsp;mono_environment_exitcode_get&nbsp;();&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mono_jit_cleanup&nbsp;(domain);&lt;br&gt;<br>
&nbsp; &nbsp; }&lt;br&gt;<br>
&nbsp; &nbsp; return&nbsp;retval;&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
Here&nbsp;i&nbsp;get&nbsp;a&nbsp;crash&nbsp;the&nbsp;second&nbsp;time&nbsp;mono_jit_init&nbsp;is&nbsp;called.&lt;br&gt;<br>
&lt;br&gt;<br>
Am&nbsp;i&nbsp;doing&nbsp;something&nbsp;wrong?&nbsp;If&nbsp;not,&nbsp;is&nbsp;there&nbsp;a&nbsp;workaround&nbsp;that&nbsp;i&nbsp;can&nbsp;use?&lt;br&gt;<br>
&lt;br&gt;<br>
thanks!&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://www.nabble.com/mono_jit_init-and-mono_jit_cleanup-tp23115883p23115883.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.nabble.com/mono_jit_init-and-mono_jit_cleanup-tp23115883p23115883.html&lt;/a&gt;&lt;br&gt;<br>
<br>
Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;General&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-list&nbsp;maillist&nbsp; -&nbsp; &lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
