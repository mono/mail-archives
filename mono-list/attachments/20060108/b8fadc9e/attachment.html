<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#333333&quot;&gt;<br>
Peng,&nbsp;Hao&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid20060106164859.33766.qmail@web60411.mail.yahoo.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hi,&nbsp;<br>
<br>
Anyone&nbsp;has&nbsp;any&nbsp;suggestions&nbsp;to&nbsp;improve&nbsp;asp.net<br>
applications&nbsp;scalability&nbsp;running&nbsp;Apache/Mono?<br>
<br>
I&nbsp;have&nbsp;an&nbsp;application&nbsp;to&nbsp;migrate&nbsp;to&nbsp;Linux.&nbsp;I'm&nbsp;using<br>
RHEL&nbsp;4&nbsp;AS&nbsp;i386/mono&nbsp;1.1.10/mod-mono&nbsp;1.1.10/apache<br>
2.0.52.&nbsp;<br>
The&nbsp;hardware&nbsp;is&nbsp;PII&nbsp;400&nbsp;/&nbsp;256M.&nbsp;(delibrately&nbsp;used&nbsp;this<br>
low&nbsp;spec&nbsp;machine&nbsp;to&nbsp;force&nbsp;the&nbsp;application<br>
optimisation)<br>
<br>
I&nbsp;use&nbsp;VS.NET&nbsp;application&nbsp;centre&nbsp;test&nbsp;to&nbsp;simulate&nbsp;50<br>
users&nbsp;cocurrantly&nbsp;accessing&nbsp;the&nbsp;asp.net&nbsp;app,&nbsp;but&nbsp;it<br>
constantly&nbsp;fails&nbsp;after&nbsp;10&nbsp;mins&nbsp;or&nbsp;so.&nbsp;With&nbsp;a&nbsp;small<br>
user&nbsp;load&nbsp;(2-5)&nbsp;the&nbsp;application&nbsp;runs&nbsp;perfectly.<br>
At&nbsp;the&nbsp;failing&nbsp;point,&nbsp;I&nbsp;found&nbsp;out&nbsp;mono&nbsp;processes&nbsp;are<br>
spawn&nbsp;(using&nbsp;ps&nbsp;aux&nbsp;|&nbsp;grep&nbsp;mono).&nbsp;Two&nbsp;of&nbsp;them&nbsp;are&nbsp;in<br>
the&nbsp;Ssl&nbsp;(Interruptible&nbsp;sleep)&nbsp;state&nbsp;and&nbsp;the&nbsp;others&nbsp;are<br>
Z&nbsp;(zombies).&nbsp;The&nbsp;parent&nbsp;process&nbsp;of&nbsp;the&nbsp;zombie&nbsp;ones&nbsp;is<br>
one&nbsp;of&nbsp;the&nbsp;Ssl<br>
<br>
I&nbsp;also&nbsp;found&nbsp;that&nbsp;the&nbsp;unix&nbsp;sockets&nbsp;mod_mono_server&nbsp;is<br>
using&nbsp;are&nbsp;also&nbsp;abnormal&nbsp;(using&nbsp;netstat&nbsp;an&nbsp;|&nbsp;grep<br>
mono).&nbsp;About&nbsp;50&nbsp;sockets&nbsp;are&nbsp;connected&nbsp;but&nbsp;all&nbsp;the<br>
others&nbsp;are&nbsp;trying&nbsp;to&nbsp;connect&nbsp;to&nbsp;somewhere&nbsp;but&nbsp;for&nbsp;some<br>
reason&nbsp;they&nbsp;are&nbsp;hanging&nbsp;there&nbsp;eventually.<br>
<br>
When&nbsp;MonoMaxMemory&nbsp;directive&nbsp;is&nbsp;applied&nbsp;in&nbsp;httpd.conf,<br>
the&nbsp;problem&nbsp;is&nbsp;solved.&nbsp;The&nbsp;application&nbsp;runs&nbsp;under&nbsp;50<br>
users&nbsp;for&nbsp;8&nbsp;hours&nbsp;without&nbsp;any&nbsp;problem.&nbsp;But&nbsp;it&nbsp;is&nbsp;not<br>
an&nbsp;ultimate&nbsp;solution&nbsp;as&nbsp;the&nbsp;mono&nbsp;server&nbsp;process&nbsp;will<br>
be&nbsp;killed&nbsp;so&nbsp;the&nbsp;site&nbsp;user&nbsp;will&nbsp;still&nbsp;experience&nbsp;some<br>
server&nbsp;down&nbsp;time.<br>
<br>
It&nbsp;is&nbsp;a&nbsp;complex&nbsp;application,&nbsp;and&nbsp;I&nbsp;don't&nbsp;know&nbsp;where<br>
exactly&nbsp;the&nbsp;problem&nbsp;is.&nbsp;So&nbsp;I&nbsp;can't&nbsp;post&nbsp;any&nbsp;source<br>
code.&nbsp;Does&nbsp;anyone&nbsp;have&nbsp;any&nbsp;general&nbsp;guideline&nbsp;as&nbsp;for<br>
the&nbsp;mono&nbsp;scalability?&nbsp;I&nbsp;saw&nbsp;in&nbsp;various&nbsp;forums&nbsp;that&nbsp;the<br>
Garbage&nbsp;Collector&nbsp;is&nbsp;a&nbsp;bit&nbsp;problematic&nbsp;in&nbsp;Mono&nbsp;(or<br>
Linux&nbsp;in&nbsp;general)&nbsp;but&nbsp;I&nbsp;don't&nbsp;know&nbsp;whether&nbsp;it&nbsp;is&nbsp;true.<br>
If&nbsp;it's&nbsp;true,&nbsp;is&nbsp;there&nbsp;any&nbsp;improvement&nbsp;that&nbsp;I&nbsp;could&nbsp;do<br>
non-programmatically?&nbsp;Is&nbsp;there&nbsp;any&nbsp;managed-code<br>
improvement&nbsp;particularly&nbsp;needed&nbsp;for&nbsp;Mono?&nbsp;<br>
<br>
I&nbsp;know&nbsp;without&nbsp;the&nbsp;source&nbsp;code&nbsp;it's&nbsp;a&nbsp;bit&nbsp;difficult&nbsp;to<br>
tell.&nbsp;But&nbsp;ANY&nbsp;suggestions&nbsp;(including&nbsp;how&nbsp;to&nbsp;precisely<br>
locate&nbsp;the&nbsp;problematic&nbsp;code&nbsp;section,&nbsp;any&nbsp;profiler&nbsp;to<br>
monitor&nbsp;the&nbsp;mono&nbsp;runtime&nbsp;for&nbsp;asp.net)&nbsp;will&nbsp;be&nbsp;greatly<br>
appreciated.<br>
<br>
Thanks&nbsp;very&nbsp;much<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
If&nbsp;you&nbsp;can&nbsp;narrow&nbsp;down&nbsp;the&nbsp;offending&nbsp;code&nbsp;maybe&nbsp;or&nbsp;give&nbsp;some&nbsp;exact<br>
details&nbsp;that&nbsp;would&nbsp;start&nbsp;to&nbsp;give&nbsp;us&nbsp;a&nbsp;clue..&nbsp;Create&nbsp;a&nbsp;test&nbsp;case&nbsp;and&nbsp;we<br>
have&nbsp;something&nbsp;solid&nbsp;while&nbsp;you&nbsp;don't&nbsp;have&nbsp;to&amp;nbsp;&nbsp;give&nbsp;us&nbsp;your&nbsp;application..&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;me&nbsp;I&nbsp;have&nbsp;seen&nbsp;both&nbsp;sides&nbsp;of&nbsp;this&nbsp;story,&nbsp;but&nbsp;the&nbsp;bottom&nbsp;line&nbsp;is<br>
mostly&nbsp;application&nbsp;design..&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;one&nbsp;project&nbsp;I'm&nbsp;working&nbsp;on&nbsp;to&nbsp;improve&nbsp;that&nbsp;is&nbsp;average<br>
complexity&nbsp;and&nbsp;I&nbsp;can't&nbsp;get&nbsp;5&nbsp;concurrent&nbsp;users&nbsp;and&nbsp;more&nbsp;than&nbsp;20&nbsp;pages<br>
per&nbsp;second..&nbsp;One&nbsp;the&nbsp;other&nbsp;hand&nbsp;I&nbsp;have&nbsp;a&nbsp;complex&nbsp;app&nbsp;we&nbsp;built&nbsp;for&nbsp;a<br>
customer&nbsp;and&nbsp;ported&nbsp;that&nbsp;can&nbsp;easily&nbsp;do&nbsp;about&nbsp;20x&nbsp;that&nbsp;with&nbsp;no&nbsp;issues&nbsp;on<br>
the&nbsp;same&nbsp;server&nbsp;with&nbsp;consistent&nbsp;sub&nbsp;second&nbsp;rendering..&nbsp;(btw..&nbsp;the<br>
server&nbsp;specs&nbsp;aren't&nbsp;anything&nbsp;impressive&nbsp;either..)&lt;br&gt;<br>
&lt;br&gt;<br>
Take&nbsp;a&nbsp;look&nbsp;at&nbsp;caching&nbsp;data&nbsp;and&nbsp;output..&amp;nbsp;&nbsp;That's&nbsp;a&nbsp;big&nbsp;one&nbsp;either&nbsp;in<br>
Mono&nbsp;or&nbsp;MS&nbsp;.Net.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
&lt;br&gt;<br>
C.&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
