<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;replied&nbsp;to&nbsp;jmalcom&nbsp;about&nbsp;a&nbsp;week&nbsp;ago&nbsp;but&nbsp;forgot&nbsp;to&nbsp;cc&nbsp;the&nbsp;list.&nbsp;Seeing&nbsp;as&nbsp;no-one&nbsp;else&nbsp;replied&nbsp;to&nbsp;my&nbsp;original&nbsp;post,&nbsp;would&nbsp;it&nbsp;please&nbsp;be&nbsp;at&nbsp;all&nbsp;possible&nbsp;for&nbsp;someone&nbsp;to&nbsp;suggest&nbsp;somewhere&nbsp;else&nbsp;I&nbsp;might&nbsp;try&nbsp;asking?&nbsp;I&nbsp;just&nbsp;want&nbsp;to&nbsp;understand&nbsp;exactly&nbsp;what&nbsp;makes&nbsp;the&nbsp;difference&nbsp;between&nbsp;a&nbsp;tail-call&nbsp;that&nbsp;Mono&nbsp;can&nbsp;eliminate&nbsp;and&nbsp;one&nbsp;it&nbsp;cannot.&nbsp;Many&nbsp;thanks.&lt;br&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;----------&nbsp;Forwarded&nbsp;message&nbsp;----------&lt;br&gt;From:&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;mono&nbsp;user&lt;/b&gt;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:monouser22@gmail.com&quot;&gt;monouser22@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&lt;br&gt;<br>
Date:&nbsp;Sat,&nbsp;Sep&nbsp;21,&nbsp;2013&nbsp;at&nbsp;5:24&nbsp;AM&lt;br&gt;Subject:&nbsp;Re:&nbsp;[Mono-list]&nbsp;Tail&nbsp;calls&lt;br&gt;To:&nbsp;jmalcolm&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:malcolm.justin@gmail.com&quot;&gt;malcolm.justin@gmail.com&lt;/a&gt;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Many&nbsp;thanks&nbsp;for&nbsp;replying.&nbsp;There&nbsp;are&nbsp;four&nbsp;tail&nbsp;calls.&nbsp;i)&nbsp;k&nbsp;[]&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;mapk,&nbsp;ii)&nbsp;mapk&nbsp;f&nbsp;...&nbsp;on&nbsp;the&nbsp;second&nbsp;line&nbsp;of&nbsp;mapk,&nbsp;iii)&nbsp;the&nbsp;call&nbsp;to&nbsp;f&nbsp;passed&nbsp;to&nbsp;the&nbsp;second&nbsp;call&nbsp;to&nbsp;mapk,&nbsp;and&nbsp;iv)&nbsp;the&nbsp;nested&nbsp;call&nbsp;to&nbsp;k&nbsp;also&nbsp;on&nbsp;the&nbsp;second&nbsp;line&nbsp;of&nbsp;mapk.&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;I&nbsp;take&nbsp;it&nbsp;you&nbsp;imply&nbsp;that&nbsp;the&nbsp;code&nbsp;is&nbsp;meant&nbsp;to&nbsp;run&nbsp;out&nbsp;of&nbsp;stack&nbsp;because&nbsp;it&nbsp;is&nbsp;broken.&nbsp;That&nbsp;would&nbsp;in&nbsp;many&nbsp;ways&nbsp;be&nbsp;by&nbsp;far&nbsp;the&nbsp;best&nbsp;outcome&nbsp;from&nbsp;my&nbsp;point&nbsp;of&nbsp;view.&nbsp;But&nbsp;here&nbsp;is&nbsp;a&nbsp;transcript&nbsp;that&nbsp;shows&nbsp;it&nbsp;works&nbsp;fine&nbsp;under&nbsp;.net&nbsp;and&nbsp;f#&nbsp;3.0.&nbsp;I&nbsp;wonder&nbsp;if&nbsp;you&nbsp;turned&nbsp;tail&nbsp;calls&nbsp;on&nbsp;when&nbsp;compiling?&lt;br&gt;<br>
<br>
&lt;br&gt;$&nbsp;&quot;c:/Program&nbsp;Files&nbsp;(x86)/Microsoft&nbsp;SDKs/F#/3.0/Framework/v4.0/Fsc.exe&quot;&nbsp;--tailcalls+&nbsp;test.fs<br>
&lt;br&gt;Microsoft&nbsp;(R)&nbsp;F#&nbsp;Compiler&nbsp;version&nbsp;11.0.50727.1<br>
&lt;br&gt;Copyright&nbsp;(c)&nbsp;Microsoft&nbsp;Corporation.&nbsp;All&nbsp;Rights&nbsp;Reserved.<br>
&lt;br&gt; &lt;br&gt;Administrator@lab&nbsp;~<br>
&lt;br&gt;$&nbsp;./test.exe<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;1<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;2<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;4<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;8<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;16<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;32<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;64<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;128<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;256<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;512<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;1024<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;2048<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;4096<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;8192<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;16384<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;32768<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;65536<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;131072<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;262144<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;524288<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;1048576<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;2097152<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;4194304<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;8388608<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;16777216<br>
&lt;br&gt;Testing&nbsp;depth&nbsp;33554432<br>
&lt;br&gt; &lt;br&gt;Administrator@lab&nbsp;~<br>
&lt;br&gt;$&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Sep&nbsp;20,&nbsp;2013&nbsp;at&nbsp;4:56&nbsp;AM,&nbsp;jmalcolm&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:malcolm.justin@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;malcolm.justin@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;mono&nbsp;user&nbsp;wrote&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&gt;&nbsp;I&nbsp;wondered&nbsp;if&nbsp;it&nbsp;would&nbsp;be&nbsp;possible&nbsp;to&nbsp;have&nbsp;some&nbsp;advice&nbsp;on&nbsp;how&nbsp;tail&lt;br&gt;<br>
&gt;&nbsp;recursion&nbsp;elimination&nbsp;works&nbsp;in&nbsp;Mono.&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;understand&nbsp;under&lt;br&gt;<br>
&gt;&nbsp;what&nbsp;circumstances&nbsp;Mono&nbsp;can&nbsp;do&nbsp;a&nbsp;tail&nbsp;recursive&nbsp;call&nbsp;without&nbsp;leaving&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;caller&nbsp;on&nbsp;the&nbsp;stack,&nbsp;and&nbsp;when&nbsp;it&nbsp;cannot.&nbsp;I&nbsp;am&nbsp;afraid&nbsp;I&nbsp;could&nbsp;not&lt;br&gt;<br>
&gt;&nbsp;find&nbsp;this&nbsp;information&nbsp;anywhere,&nbsp;though&nbsp;I&nbsp;did&nbsp;not&nbsp;try&nbsp;reading&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;sources.&nbsp;Many&nbsp;thanks&nbsp;in&nbsp;advance.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;a&nbsp;large&nbsp;F#&nbsp;project&nbsp;that&nbsp;I&nbsp;want&nbsp;to&nbsp;run&nbsp;under&nbsp;Mono,&nbsp;and&nbsp;was&lt;br&gt;<br>
&gt;&nbsp;pleased&nbsp;to&nbsp;see&nbsp;that&nbsp;all&nbsp;1500+&nbsp;unit&nbsp;tests&nbsp;passed&nbsp;the&nbsp;first&nbsp;time&nbsp;under&lt;br&gt;<br>
&gt;&nbsp;3.2.1.&nbsp;However,&nbsp;my&nbsp;code&nbsp;runs&nbsp;out&nbsp;of&nbsp;stack&nbsp;once&nbsp;applied&nbsp;to&nbsp;non-trivial&lt;br&gt;<br>
&gt;&nbsp;input,&nbsp;even&nbsp;when&nbsp;I&nbsp;allocate&nbsp;a&nbsp;gigabyte&nbsp;of&nbsp;stack.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Here&nbsp;is&nbsp;a&nbsp;cut-down&nbsp;example&nbsp;that&nbsp;started&nbsp;its&nbsp;life&nbsp;as&nbsp;a&nbsp;much&nbsp;larger&nbsp;fold&lt;br&gt;<br>
&gt;&nbsp;(which&nbsp;would&nbsp;be&nbsp;prohibitively&nbsp;expensive&nbsp;to&nbsp;rewrite&nbsp;in&nbsp;imperative&lt;br&gt;<br>
&gt;&nbsp;style).&nbsp;Under&nbsp;.net&nbsp;it&nbsp;runs&nbsp;to&nbsp;completion,&nbsp;whereas&nbsp;under&nbsp;Mono&nbsp;it&nbsp;dies&lt;br&gt;<br>
&gt;&nbsp;after&nbsp;i&nbsp;reaches&nbsp;17.&nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;of&nbsp;rewriting&nbsp;the&nbsp;map&nbsp;so&nbsp;that&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;would&nbsp;not&nbsp;leave&nbsp;anything&nbsp;on&nbsp;the&nbsp;stack&nbsp;when&nbsp;evaluating&nbsp;f?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;[I&nbsp;cannot&nbsp;just&nbsp;use&nbsp;List.map&nbsp;because&nbsp;it&nbsp;stays&nbsp;on&nbsp;the&nbsp;stack&nbsp;while&lt;br&gt;<br>
&gt;&nbsp;applying&nbsp;f,&nbsp;and&nbsp;so&nbsp;would&nbsp;cause&nbsp;an&nbsp;overflow&nbsp;e.g.&nbsp;if&nbsp;given&nbsp;a&nbsp;function&lt;br&gt;<br>
&gt;&nbsp;that&nbsp;uses&nbsp;the&nbsp;same&nbsp;call&nbsp;to&nbsp;map&nbsp;again&nbsp;over&nbsp;and&nbsp;over&nbsp;as&nbsp;it&nbsp;descends&nbsp;down&lt;br&gt;<br>
&gt;&nbsp;a&nbsp;data&nbsp;structure.]&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;fsharpc&nbsp;--tailcalls+&nbsp;tailtest.fs&lt;br&gt;<br>
&gt;&nbsp;mono&nbsp;--optimize=tailc&nbsp;tailtest.exe&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; let&nbsp;rec&nbsp;mapk&nbsp;f&nbsp;xs&nbsp;k&nbsp;=&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; match&nbsp;xs&nbsp;with&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; []&nbsp;-&gt;&nbsp;k&nbsp;[]&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp;x::xs&nbsp;-&gt;&nbsp;mapk&nbsp;f&nbsp;xs&nbsp;(fun&nbsp;xs&#39;&nbsp;-&gt;&nbsp;f&nbsp;x&nbsp;(fun&nbsp;x&#39;&nbsp;-&gt;&nbsp;(x&#39;&nbsp;::&nbsp;xs&#39;)&nbsp;|&gt;&nbsp;k))&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; let&nbsp;test_tail&nbsp;n&nbsp;=&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; printf&nbsp;&quot;Testing&nbsp;depth&nbsp;%u\n&quot;&nbsp;n&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; let&nbsp;xs&nbsp;=&nbsp;[1..n]&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; let&nbsp;expected&nbsp;=&nbsp;List.map&nbsp;(fun&nbsp;x&nbsp;-&gt;&nbsp;x&nbsp;+&nbsp;1)&nbsp;xs&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; let&nbsp;actual&nbsp;=&nbsp;mapk&nbsp;(fun&nbsp;x&nbsp;k&nbsp;-&gt;&nbsp;k&nbsp;(x&nbsp;+&nbsp;1))&nbsp;xs&nbsp;id&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;expected&nbsp;&lt;&gt;&nbsp;actual&nbsp;then&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; failwithf&nbsp;&quot;Something&nbsp;went&nbsp;badly&nbsp;wrong&quot;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; for&nbsp;i=0&nbsp;to&nbsp;25&nbsp;do&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; test_tail&nbsp;(1&lt;&lt;&amp;lt;i)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;Mono-list&nbsp;maillist&nbsp; -&nbsp; &amp;lt;email&amp;gt;Mono-list@.ximian&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;do&nbsp;not&nbsp;know&nbsp;F#&nbsp;so&nbsp;I&nbsp;must&nbsp;just&nbsp;be&nbsp;missing&nbsp;it&nbsp;but&nbsp;I&nbsp;do&nbsp;not&nbsp;even&nbsp;see&nbsp;the&nbsp;tail&lt;br&gt;<br>
call&nbsp;in&nbsp;there.&lt;br&gt;<br>
&lt;br&gt;<br>
Regardless,&nbsp;I&nbsp;just&nbsp;wanted&nbsp;to&nbsp;throw&nbsp;out&nbsp;there&nbsp;that&nbsp;it&nbsp;fails&nbsp;for&nbsp;me&nbsp;under&nbsp;.NET&lt;br&gt;<br>
as&nbsp;well.&nbsp;It&nbsp;only&nbsp;gets&nbsp;to&nbsp;13&nbsp;before&nbsp;I&nbsp;get&nbsp;a&nbsp;StackOverflow.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/Tail-calls-tp4660875p4660934.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mono.1490590.n4.nabble.com/Tail-calls-tp4660875p4660934.html&lt;/a&gt;&lt;br&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;General&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-list&nbsp;maillist&nbsp; -&nbsp; &lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
