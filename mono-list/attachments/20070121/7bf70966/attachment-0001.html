<tt>
Heya,&lt;br&gt;&lt;br&gt;I&nbsp;was&nbsp;away&nbsp;on&nbsp;holidays,&nbsp;so&nbsp;i&nbsp;only&nbsp;got&nbsp;the&nbsp;bug&nbsp;report&nbsp;now.&lt;br&gt;&lt;br&gt;I&nbsp;created&nbsp;a&nbsp;file&nbsp;which&nbsp;was&nbsp;over&nbsp;int.MaxValue&nbsp;bytes&nbsp;in&nbsp;length&nbsp;and&nbsp;used&nbsp;that&nbsp;to&nbsp;test&nbsp;the&nbsp;monotorrent&nbsp;code.&nbsp;I&nbsp;came&nbsp;across&nbsp;a&nbsp;few&nbsp;places&nbsp;where&nbsp;i&nbsp;was&nbsp;getting&nbsp;int&nbsp;overflows&nbsp;and&nbsp;commited&nbsp;fixes&nbsp;to&nbsp;SVN.&nbsp;Everything&nbsp;should&nbsp;be&nbsp;ok&nbsp;now&nbsp;(fingers&nbsp;crossed&nbsp;;)&nbsp;).<br>
&lt;br&gt;&lt;br&gt;Let&nbsp;me&nbsp;know&nbsp;how&nbsp;you&nbsp;get&nbsp;on.&lt;br&gt;&lt;br&gt;Alan.&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;1/16/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Will&nbsp;Murnane&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:will.murnane@gmail.com&quot;&gt;will.murnane@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:<br>
&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;I&amp;#39;m&nbsp;writing&nbsp;a&nbsp;BitTorrent&nbsp;client&nbsp;using&nbsp;the&nbsp;bitsharp&nbsp;library,&nbsp;and&nbsp;I&lt;br&gt;encountered&nbsp;an&nbsp;error&nbsp;with&nbsp;a&nbsp;torrent&nbsp;that&nbsp;has&nbsp;total&nbsp;file&nbsp;size&nbsp;&amp;gt;&nbsp;4GB.<br>
&lt;br&gt;The&nbsp;problem&nbsp;occurs&nbsp;on&nbsp;line&nbsp;124&nbsp;of&nbsp;PieceMessage.cs:&lt;br&gt;&lt;br&gt;long&nbsp;pieceOffset&nbsp;=&nbsp;this.startOffset&nbsp;+&nbsp;this.PieceIndex&nbsp;*&lt;br&gt;this.fileManager.PieceLength;&lt;br&gt;&lt;br&gt;this.PieceIndex&nbsp;and&nbsp;this.fileManager.PieceLength&nbsp;are&nbsp;both&nbsp;32-bit&nbsp;ints;<br>
&lt;br&gt;when&nbsp;they&amp;#39;re&nbsp;multiplied&nbsp;an&nbsp;overflow&nbsp;can&nbsp;result,&nbsp;and&nbsp;pass&nbsp;an&lt;br&gt;(overflowed)&nbsp;negative&nbsp;value&nbsp;to&nbsp;FileManager.Read.&amp;nbsp;&amp;nbsp;My&nbsp;suggestion&nbsp;is&nbsp;to&lt;br&gt;cast&nbsp;one&nbsp;of&nbsp;them&nbsp;to&nbsp;long&nbsp;before&nbsp;the&nbsp;multiply&nbsp;is&nbsp;performed:&lt;br&gt;&lt;br&gt;long&nbsp;pieceOffset&nbsp;=&nbsp;<br>
this.startOffset&nbsp;+&nbsp;(long)this.PieceIndex&nbsp;*&lt;br&gt;this.fileManager.PieceLength;&lt;br&gt;&lt;br&gt;That&nbsp;should&nbsp;fix&nbsp;the&nbsp;problem.&amp;nbsp;&amp;nbsp;Here&amp;#39;s&nbsp;a&nbsp;screenshot&nbsp;of&nbsp;the&nbsp;debugger&lt;br&gt;helping&nbsp;me&nbsp;find&nbsp;the&nbsp;problem:&lt;br&gt;&lt;a&nbsp;href=&quot;http://will.incorrige.us/torrent-error.png&quot;&gt;<br>
http://will.incorrige.us/torrent-error.png&lt;/a&gt;&lt;br&gt;&lt;br&gt;Last,&nbsp;thanks&nbsp;for&nbsp;the&nbsp;cool&nbsp;library!&amp;nbsp;&amp;nbsp;I&nbsp;was&nbsp;afraid&nbsp;I&amp;#39;d&nbsp;have&nbsp;to&nbsp;write&nbsp;my&lt;br&gt;own&nbsp;bittorrent&nbsp;library&nbsp;to&nbsp;get&nbsp;this&nbsp;working,&nbsp;but&nbsp;bitsharp&nbsp;is&nbsp;working&lt;br&gt;(mostly&nbsp;:-P)&nbsp;nicely.<br>
&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Will&lt;br&gt;_______________________________________________&lt;br&gt;Mono-list&nbsp;maillist&amp;nbsp;&amp;nbsp;-&amp;nbsp;&amp;nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&gt;<br>
http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
