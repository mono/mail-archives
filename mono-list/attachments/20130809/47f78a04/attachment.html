<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;I&nbsp;ran&nbsp;into&nbsp;an&nbsp;issue&nbsp;several&nbsp;months&nbsp;back&nbsp;where&nbsp;my&nbsp;code&nbsp;could&nbsp;not&nbsp;find&nbsp;ConnectionStrings&nbsp;while&nbsp;running&nbsp;my&nbsp;code&nbsp;in&nbsp;NUnit&nbsp;under&nbsp;mono,&nbsp;however,&nbsp;I&nbsp;was&nbsp;having&nbsp;trouble&nbsp;making&nbsp;a&nbsp;simple&nbsp;reproducible&nbsp;test&nbsp;case.&nbsp;&nbsp;Now&nbsp;I&nbsp;have&nbsp;one,&nbsp;and&nbsp;I&nbsp;suspect&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;an&nbsp;NUnit&nbsp;issue,&nbsp;as&nbsp;the&nbsp;same&nbsp;thing&nbsp;happens&nbsp;under&nbsp;xUnit.&nbsp;&nbsp;Rather,&nbsp;I'm&nbsp;guessing&nbsp;that&nbsp;this&nbsp;has&nbsp;to&nbsp;do&nbsp;with&nbsp;how&nbsp;the&nbsp;AppDomain&nbsp;in&nbsp;mono&nbsp;resolves&nbsp;configuration&nbsp;file&nbsp;locations&nbsp;in&nbsp;shadow&nbsp;copied&nbsp;assemblies&nbsp;like&nbsp;those&nbsp;used&nbsp;by&nbsp;unit&nbsp;testing&nbsp;frameworks.&lt;br&gt;&lt;br&gt;My&nbsp;simple&nbsp;test&nbsp;is&nbsp;below.&nbsp;&nbsp;The&nbsp;first&nbsp;test&nbsp;will&nbsp;succeed,&nbsp;but&nbsp;the&nbsp;second&nbsp;one&nbsp;will&nbsp;fail&nbsp;only&nbsp;under&nbsp;mono&nbsp;(tried&nbsp;versions&nbsp;2.10.8.1,&nbsp;3.0.2,&nbsp;3.1.2,&nbsp;and&nbsp;3.2.0).&nbsp;Under&nbsp;&lt;a&nbsp;href=&quot;http://ms.net/&quot;&gt;MS.NET&lt;/a&gt;,&nbsp;both&nbsp;will&nbsp;succeed.&nbsp;&nbsp;The&nbsp;only&nbsp;difference&nbsp;in&nbsp;the&nbsp;first&nbsp;and&nbsp;the&nbsp;second&nbsp;test&nbsp;is&nbsp;that&nbsp;the&nbsp;second&nbsp;test&nbsp;uses&nbsp;HttpUtility&nbsp;from&nbsp;System.Web,&nbsp;and&nbsp;when&nbsp;this&nbsp;happens,&nbsp;the&nbsp;ConfigurationManager.ConnectionStrings&nbsp;changes&nbsp;to&nbsp;the&nbsp;default&nbsp;one&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://asp.net/&quot;&gt;ASP.NET&lt;/a&gt;,&nbsp;containing&nbsp;a&nbsp;LocalSqlServer&nbsp;(SQLEXPRESS)&nbsp;and&nbsp;LocalSqliteServer.&lt;br&gt;&lt;br&gt;Is&nbsp;anyone&nbsp;able&nbsp;to&nbsp;explain&nbsp;why&nbsp;this&nbsp;would&nbsp;happen&nbsp;only&nbsp;in&nbsp;the&nbsp;AppDomains&nbsp;as&nbsp;created&nbsp;by&nbsp;unit&nbsp;testing&nbsp;frameworks?&nbsp;&nbsp;Any&nbsp;known&nbsp;workarounds&nbsp;for&nbsp;this&nbsp;to&nbsp;keep&nbsp;it&nbsp;from&nbsp;loading&nbsp;a&nbsp;different&nbsp;config?&lt;br&gt;&lt;br&gt;###&nbsp;TestCode.cs&nbsp;###&lt;br&gt;&lt;br&gt;using&nbsp;System;&lt;br&gt;using&nbsp;System.Configuration;&lt;br&gt;using&nbsp;NUnit.Framework;&lt;br&gt;&lt;br&gt;namespace&nbsp;TestHarness&lt;br&gt;{&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;[TestFixture]&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;public&nbsp;class&nbsp;MyClass&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;{&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;[Test]&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;public&nbsp;void&nbsp;TestSomeCode1()&nbsp;{&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;var&nbsp;connStr&nbsp;=&nbsp;ConfigurationManager.ConnectionStrings[&quot;mystr&quot;];&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;Assert.IsNotNull&nbsp;(connStr);&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;}&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;[Test]&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;public&nbsp;void&nbsp;TestSomeCode2()&nbsp;{&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;System.Web.HttpUtility.ParseQueryString&nbsp;(&quot;&lt;a&nbsp;href=&quot;http://foo.bz/?bar=fu&quot;&gt;http://foo.bz?bar=fu&lt;/a&gt;&quot;);&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;var&nbsp;connStr&nbsp;=&nbsp;ConfigurationManager.ConnectionStrings[&quot;mystr&quot;];&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;Assert.IsNotNull&nbsp;(connStr);&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;}&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;}&lt;br&gt;}&lt;br&gt;&lt;br&gt;###&nbsp;App.config&nbsp;###&lt;br&gt;&lt;br&gt;&lt;configuration&gt;&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;connectionStrings&gt;&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&lt;/span&gt;&lt;add&nbsp;name=&quot;mystr&quot;&nbsp;connectionString=&quot;&lt;a&nbsp;href=&quot;mailto:test@whatever.net&quot;&gt;test@whatever.net&lt;/a&gt;&quot;&nbsp;/&gt;&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;/connectionStrings&gt;&lt;br&gt;&lt;/configuration&gt;&lt;br&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
