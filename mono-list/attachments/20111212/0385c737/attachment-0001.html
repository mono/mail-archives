<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;12,&nbsp;2011&nbsp;at&nbsp;7:46&nbsp;AM,&nbsp;Simon&nbsp;Lindgren&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon.n.lindgren@gmail.com&quot;&gt;simon.n.lindgren@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Your&nbsp;test&nbsp;program&nbsp;does&nbsp;not&nbsp;fit&nbsp;your&nbsp;description&nbsp;very&nbsp;well,&nbsp;only&nbsp;creating&lt;br&gt;<br>
10000&nbsp;objects&nbsp;and&nbsp;that&nbsp;Unit&nbsp;being&nbsp;of&nbsp;~4MB&nbsp;size&nbsp;instead&nbsp;of&nbsp;100B.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;could&nbsp;only&nbsp;test&nbsp;up&nbsp;to&nbsp;4GB&nbsp;of&nbsp;memory&nbsp;since&nbsp;that&nbsp;is&nbsp;the&nbsp;limit&nbsp;of&nbsp;the&lt;br&gt;<br>
mono&nbsp;in&nbsp;the&nbsp;Fedora&nbsp;16&nbsp;repos,&nbsp;but&nbsp;for&nbsp;me&nbsp;the&nbsp;run&nbsp;time&nbsp;seems&nbsp;to&nbsp;scale&lt;br&gt;<br>
linearly&nbsp;with&nbsp;growing&nbsp;length&nbsp;of&nbsp;the&nbsp;Unit&nbsp;array.&nbsp;My&nbsp;adapted&nbsp;test&nbsp;code&lt;br&gt;<br>
(with&nbsp;much&nbsp;smaller&nbsp;object&nbsp;size&nbsp;to&nbsp;exaggerate&nbsp;object&nbsp;construction):&lt;br&gt;<br>
&lt;br&gt;<br>
using&nbsp;System;&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;Test&nbsp;{&lt;br&gt;<br>
&nbsp; static&nbsp;Unit[]&nbsp;units&nbsp;=&nbsp;new&nbsp;Unit[50000000];&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&nbsp; static&nbsp;public&nbsp;void&nbsp;Main&nbsp;()&nbsp;{&lt;br&gt;<br>
&lt;/div&gt;&nbsp; &nbsp; for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;units.Length;&nbsp;i++)&nbsp;units[i]&nbsp;=&nbsp;new&nbsp;Unit();&lt;br&gt;<br>
&nbsp; &nbsp; Console.WriteLine(&amp;quot;Now&nbsp;having&nbsp;&amp;quot;&nbsp;+&nbsp;units.Length&nbsp;+&nbsp;&amp;quot;&nbsp;units.&nbsp;&amp;quot;&nbsp;+&nbsp;(GC.GetTotalMemory(false)&nbsp;/&nbsp;1000000).ToString()&nbsp;+&nbsp;&amp;quot;&nbsp;MB&amp;quot;);&lt;br&gt;<br>
&nbsp; }&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;Unit&nbsp;{&lt;br&gt;<br>
&nbsp; int[]&nbsp;dummy&nbsp;=&nbsp;new&nbsp;int[1];&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
time&nbsp;mono&nbsp;--gc=sgen&nbsp;memtest.exe&lt;br&gt;<br>
Now&nbsp;having&nbsp;50000000&nbsp;units.&nbsp;3612&nbsp;MB&lt;br&gt;<br>
mono&nbsp;--gc=sgen&nbsp;memtest.exe&nbsp; 11,98s&nbsp;user&nbsp;0,93s&nbsp;system&nbsp;179%&nbsp;cpu&nbsp;7,214&nbsp;total&lt;br&gt;<br>
&lt;br&gt;<br>
An&nbsp;observation:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;tel:3612000000&quot;&nbsp;value=&quot;+13612000000&quot;&gt;3612000000&lt;/a&gt; bytes&nbsp;/&nbsp;50000000&nbsp;objects&nbsp;=&nbsp;72&nbsp;bytes/object&lt;br&gt;<br>
72&nbsp;bytes&nbsp;-&nbsp;20&nbsp;bytes&nbsp;=&nbsp;52&nbsp;bytes&nbsp;overhead&nbsp;in&nbsp;object&nbsp;instance&nbsp;storage.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Your&nbsp;numbers&nbsp;need&nbsp;some&nbsp;polishing.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;First,&nbsp;an&nbsp;object&nbsp;has&nbsp;a&nbsp;2&nbsp;words&nbsp;header,&nbsp;so&nbsp;16&nbsp;bytes&nbsp;on&nbsp;64bits&nbsp;systems.&lt;/div&gt;<br>
&lt;div&gt;Then&nbsp;array,&nbsp;they&nbsp;have&nbsp;4&nbsp;words&nbsp;header,&nbsp;so&nbsp;32&nbsp;bytes&nbsp;on&nbsp;64bits&nbsp;systems.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Let&amp;#39;s&nbsp;measure&nbsp;what&nbsp;the&nbsp;expected&nbsp;size&nbsp;would&nbsp;be:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;Unit:&nbsp;24&nbsp;bytes:&nbsp;16&nbsp;bytes&nbsp;header&nbsp;+&nbsp;8&nbsp;of&nbsp;the&nbsp;dummy&nbsp;field&lt;/div&gt;<br>
&lt;div&gt;new&nbsp;int[1]:&nbsp;40&nbsp;bytes:&nbsp;32&nbsp;for&nbsp;the&nbsp;header&nbsp;+&nbsp;4&nbsp;of&nbsp;the&nbsp;one&nbsp;element&nbsp;+&nbsp;4&nbsp;padding&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Unit[]&nbsp;array.&nbsp;Each&nbsp;slot&nbsp;takes&nbsp;8&nbsp;bytes.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Summing&nbsp;up:&nbsp;24&nbsp;+&nbsp;40&nbsp;+&nbsp;8&nbsp;=&nbsp;72&nbsp;bytes.&nbsp;Which&nbsp;is&nbsp;pretty&nbsp;much&nbsp;what&nbsp;you&nbsp;found&lt;/div&gt;<br>
&lt;div&gt;out&nbsp;experimentally.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Besides&nbsp;that,&nbsp;your&nbsp;72&nbsp;-&nbsp;20&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;<br>

</tt>
