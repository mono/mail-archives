<tt>
This&nbsp;sounds&nbsp;like&nbsp;it&#39;d&nbsp;be&nbsp;pretty&nbsp;handy&nbsp;for&nbsp;quite&nbsp;a&nbsp;few&nbsp;users&nbsp;:)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;might&nbsp;be&nbsp;worth&nbsp;posting&nbsp;this&nbsp;to&nbsp;the&nbsp;mono-devel&nbsp;mailing&nbsp;list&nbsp;as&nbsp;well.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Dec&nbsp;9,&nbsp;2012&nbsp;at&nbsp;3:36&nbsp;PM,&nbsp;João&nbsp;Matos&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:ripzonetriton@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;ripzonetriton@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;Hi.&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;So&nbsp;I&#39;ve&nbsp;been&nbsp;working&nbsp;for&nbsp;a&nbsp;bit&nbsp;on&nbsp;a&nbsp;C++/CLI&nbsp;compiler&nbsp;and&nbsp;I&nbsp;think&nbsp;it&#39;s&nbsp;came&nbsp;along&nbsp;enough&nbsp;that&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;announce&nbsp;it.&lt;/div&gt;<br>
<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
I&nbsp;started&nbsp;it&nbsp;because&nbsp;of&nbsp;the&nbsp;need&nbsp;to&nbsp;interop&nbsp;with&nbsp;existing&nbsp;C/C++&nbsp;native&nbsp;code.&nbsp;I&nbsp;first&nbsp;tried&nbsp;extending&nbsp;Cxxi&nbsp;for&nbsp;a&nbsp;bit,&nbsp;but&nbsp;found&nbsp;some&nbsp;problems&nbsp;that&nbsp;cannot&nbsp;be&nbsp;solved&nbsp;with&nbsp;the&nbsp;approach&nbsp;of&nbsp;generating&nbsp;IL&nbsp;code&nbsp;at&nbsp;runtime.&nbsp;So&nbsp;I&nbsp;tried&nbsp;Microsoft&#39;s&nbsp;implementation&nbsp;C++/CLI&nbsp;and&nbsp;found&nbsp;it&nbsp;is&nbsp;a&nbsp;pretty&nbsp;nice&nbsp;extension&nbsp;of&nbsp;C++&nbsp;that&nbsp;makes&nbsp;it&nbsp;play&nbsp;nice&nbsp;on&nbsp;.NET&nbsp;and&nbsp;started&nbsp;implementing.&nbsp;Since&nbsp;there&nbsp;is&nbsp;nothing&nbsp;like&nbsp;it&nbsp;for&nbsp;Mono&nbsp;(at&nbsp;least&nbsp;publicly),&nbsp;I&nbsp;started&nbsp;working&nbsp;on&nbsp;a&nbsp;new&nbsp;implementation&nbsp;of&nbsp;it&nbsp;above&nbsp;the&nbsp;Clang&nbsp;and&nbsp;LLVM&nbsp;platforms.&lt;/div&gt;<br>
<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
The&nbsp;frontend&nbsp;(Clang)&nbsp;was&nbsp;extended&nbsp;to&nbsp;support&nbsp;the&nbsp;Ecma&nbsp;372&nbsp;(C++/CLI&nbsp;standard)&nbsp;additions&nbsp;to&nbsp;the&nbsp;type&nbsp;system,&nbsp;expressions&nbsp;and&nbsp;declarations,&nbsp;like&nbsp;handles,&nbsp;tracking&nbsp;references,&nbsp;CLI&nbsp;arrays,&nbsp;CLI&nbsp;properties&nbsp;and&nbsp;CLI&nbsp;generics.&nbsp;It&nbsp;then&nbsp;uses&nbsp;Cecil&nbsp;to&nbsp;import&nbsp;the&nbsp;metadata&nbsp;from&nbsp;DLLs&nbsp;that&nbsp;are&nbsp;introduced&nbsp;in&nbsp;the&nbsp;translation&nbsp;unit&nbsp;via&nbsp;#using.&lt;/div&gt;<br>
<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(80,0,80);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
LLVM&nbsp;was&nbsp;also&nbsp;extended&nbsp;with&nbsp;a&nbsp;CIL&nbsp;backend&nbsp;based&nbsp;on&nbsp;the&nbsp;old&nbsp;MSIL&nbsp;LLVM&nbsp;backend.&nbsp;The&nbsp;old&nbsp;backend&nbsp;had&nbsp;some&nbsp;problems&nbsp;and&nbsp;had&nbsp;to&nbsp;be&nbsp;updated&nbsp;to&nbsp;compile&nbsp;with&nbsp;the&nbsp;new&nbsp;LLVM&nbsp;interfaces.&nbsp;It&nbsp;also&nbsp;only&nbsp;generated&nbsp;IL&nbsp;code&nbsp;from&nbsp;native&nbsp;code&nbsp;and&nbsp;had&nbsp;no&nbsp;support&nbsp;for&nbsp;calling&nbsp;.NET&nbsp;types.&nbsp;I&nbsp;later&nbsp;found&nbsp;out&nbsp;LLVM&nbsp;is&nbsp;not&nbsp;really&nbsp;that&nbsp;suited&nbsp;to&nbsp;an&nbsp;higher-level&nbsp;assembly&nbsp;language&nbsp;like&nbsp;IL&nbsp;so&nbsp;I&nbsp;also&nbsp;had&nbsp;to&nbsp;modify&nbsp;and&nbsp;extend&nbsp;Clang&#39;s&nbsp;IR&nbsp;gen&nbsp;to&nbsp;send&nbsp;some&nbsp;bits&nbsp;as&nbsp;metadata&nbsp;(LLVM&nbsp;does&nbsp;not&nbsp;have&nbsp;signedness&nbsp;support&nbsp;on&nbsp;its&nbsp;integer&nbsp;types,&nbsp;for&nbsp;instance).&nbsp;The&nbsp;backend&nbsp;at&nbsp;the&nbsp;moment&nbsp;generates&nbsp;ILasm&nbsp;text&nbsp;code&nbsp;that&nbsp;is&nbsp;assembled&nbsp;externally,&nbsp;but&nbsp;long&nbsp;term&nbsp;I&#39;d&nbsp;really&nbsp;like&nbsp;to&nbsp;emit&nbsp;IL&nbsp;directly&nbsp;via&nbsp;Cecil.&lt;/div&gt;<br>
<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
Here&nbsp;are&nbsp;some&nbsp;use&nbsp;cases&nbsp;where&nbsp;it&nbsp;might&nbsp;be&nbsp;useful:&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; 1.&nbsp;Calling&nbsp;.NET&nbsp;libraries&nbsp;from&nbsp;native&nbsp;C++&nbsp;(via&nbsp;calls&nbsp;to&nbsp;the&nbsp;Mono&nbsp;runtime&nbsp;for&nbsp;invocations)&lt;/div&gt;<br>
<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; 2.&nbsp;Compiling&nbsp;existing&nbsp;C++&nbsp;code&nbsp;to&nbsp;CIL&nbsp;code&nbsp;(of&nbsp;course&nbsp;you&nbsp;can&nbsp;also&nbsp;call&nbsp;.NET&nbsp;code&nbsp;in&nbsp;this&nbsp;case)&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
<br>
 3.&nbsp;Introducing&nbsp;new&nbsp;.NET&nbsp;types&nbsp;via&nbsp;pure&nbsp;CIL&nbsp;C++&nbsp;code&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; 4.&nbsp;Calling&nbsp;native&nbsp;libraries&nbsp;from&nbsp;.NET&nbsp;types&nbsp;(seamless&nbsp;interop)&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
At&nbsp;the&nbsp;moment&nbsp;only&nbsp;use&nbsp;case&nbsp;2.&nbsp;is&nbsp;implemented&nbsp;and&nbsp;fully&nbsp;functional,&nbsp;though&nbsp;I&nbsp;am&nbsp;starting&nbsp;to&nbsp;work&nbsp;on&nbsp;the&nbsp;other&nbsp;use&nbsp;cases.&nbsp;1.&nbsp;is&nbsp;especially&nbsp;important&nbsp;for&nbsp;bootstrapping&nbsp;on&nbsp;Linux&nbsp;(see&nbsp;below).&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;Implemented&nbsp;CLI&nbsp;features:&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 +&nbsp;Handles&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; +&nbsp;Ref&nbsp;classes&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 +&nbsp;Value&nbsp;classes&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; +&nbsp;Properties&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 +&nbsp;Indexers&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; +&nbsp;Generics&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 +&nbsp;Arrays&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; +&nbsp;Parameter&nbsp;arrays&nbsp;(variadics)&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 +&nbsp;Attributes&nbsp;(WIP)&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
Missing&nbsp;CLI&nbsp;features:&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; -&nbsp;Exceptions&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 -&nbsp;Delegates&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; -&nbsp;Events&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 -&nbsp;Static&nbsp;Constructors&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
So&nbsp;you&nbsp;can&nbsp;that&nbsp;there&nbsp;are&nbsp;still&nbsp;quite&nbsp;a&nbsp;bit&nbsp;of&nbsp;things&nbsp;left&nbsp;to&nbsp;implement&nbsp;and&nbsp;some&nbsp;that&nbsp;are&nbsp;implemented&nbsp;need&nbsp;some&nbsp;love:&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt; - Diagnostics&nbsp;and&nbsp;error&nbsp;handling&nbsp;needs&nbsp;a&nbsp;bit&nbsp;of&nbsp;work&nbsp;to&nbsp;be&nbsp;robust.&nbsp;It&nbsp;has&nbsp;not&nbsp;been&nbsp;tested&nbsp;that&nbsp;much&nbsp;yet.&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 -&nbsp;The&nbsp;generated&nbsp;code&nbsp;is&nbsp;really&nbsp;crap&nbsp;at&nbsp;the&nbsp;moment,&nbsp;LLVM&nbsp;is&nbsp;not&nbsp;that&nbsp;well&nbsp;suited&nbsp;to&nbsp;generate&nbsp;code&nbsp;for&nbsp;stack&nbsp;machines,&nbsp;but&nbsp;there&nbsp;are&nbsp;papers&nbsp;out&nbsp;there&nbsp;with&nbsp;stack&nbsp;optimization&nbsp;strategies&nbsp;that&nbsp;can&nbsp;be&nbsp;implemented&nbsp;to&nbsp;improve&nbsp;on&nbsp;this&nbsp;front.&lt;/div&gt;<br>
<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; -&nbsp;The&nbsp;compiler&nbsp;still&nbsp;has&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;bootstrapping&nbsp;problem,&nbsp;as&nbsp;it&nbsp;uses&nbsp;the&nbsp;existing&nbsp;MS&nbsp;C++/CLI&nbsp;to&nbsp;bootstrap. I&nbsp;don&#39;t&nbsp;expect&nbsp;this&nbsp;to&nbsp;be&nbsp;a&nbsp;big&nbsp;problem,&nbsp;since&nbsp;once&nbsp;Mono&nbsp;code-gen&nbsp;mode&nbsp;is&nbsp;added&nbsp;you&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;call&nbsp;existing&nbsp;.NET&nbsp;libraries&nbsp;from&nbsp;native&nbsp;code&nbsp;(instead&nbsp;of&nbsp;generating&nbsp;IL)&nbsp;and&nbsp;it&nbsp;should&nbsp;work&nbsp;well&nbsp;on&nbsp;Linux&nbsp;too.&lt;/div&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
 -&nbsp;It&nbsp;needs&nbsp;a&nbsp;linker&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;compile&nbsp;multiple&nbsp;C++&nbsp;translation&nbsp;units&nbsp;into&nbsp;just&nbsp;one&nbsp;.NET&nbsp;DLL.&nbsp;The&nbsp;strategy&nbsp;here&nbsp;is&nbsp;not&nbsp;fully&nbsp;clear&nbsp;to&nbsp;me,&nbsp;but&nbsp;I&nbsp;was&nbsp;thinking&nbsp;on&nbsp;using&nbsp;the&nbsp;newly-developed&nbsp;LLVM&nbsp;linker&nbsp;(lld)&nbsp;to&nbsp;do&nbsp;it,&nbsp;since&nbsp;it&nbsp;seems&nbsp;the&nbsp;best&nbsp;way&nbsp;forward.&nbsp;Another&nbsp;option&nbsp;would&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;il-repack.&lt;/div&gt;<br>
<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
Somebody&nbsp;interested&nbsp;in&nbsp;helping&nbsp;out?&nbsp;Or&nbsp;maybe&nbsp;in&nbsp;sponsoring&nbsp;some&nbsp;features?&nbsp;There&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;work&nbsp;left&nbsp;to&nbsp;do&nbsp;:)&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;Code&nbsp;is&nbsp;up&nbsp;at &lt;a&nbsp;href=&quot;https://github.com/tritao/clang&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/tritao/clang&lt;/a&gt;.&nbsp;There&nbsp;is&nbsp;still&nbsp;quite&nbsp;a&nbsp;bit&nbsp;of&nbsp;code&nbsp;left&nbsp;to&nbsp;commit&nbsp;so&nbsp;don&#39;t&nbsp;try&nbsp;to&nbsp;compile&nbsp;it&nbsp;yet.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;code&nbsp;should&nbsp;be&nbsp;up&nbsp;in&nbsp;a&nbsp;day&nbsp;or&nbsp;two,&nbsp;along&nbsp;with&nbsp;instructions&nbsp;on&nbsp;how&nbsp;to&nbsp;compile&nbsp;it.&lt;/div&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-size:13px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;João&nbsp;Matos&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Mono-list&nbsp;maillist&nbsp; -&nbsp; &lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
