<tt>
&lt;HTML&gt;&lt;BODY&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-khtml-nbsp-mode:&nbsp;space;&nbsp;-khtml-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;DIV&gt;Hello&nbsp;Miguel,&lt;/DIV&gt;&lt;BR&gt;&lt;DIV&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;Earlier&nbsp;I&nbsp;was&nbsp;told&nbsp;not&nbsp;to&nbsp;monitor&nbsp;an&nbsp;SMB&nbsp;share&nbsp;because&nbsp;it&nbsp;were&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;implemented&nbsp;using&nbsp;a&nbsp;polling&nbsp;approach&nbsp;for&nbsp;remote&nbsp;shares&nbsp;so&nbsp;instead&nbsp;I&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;connected&nbsp;a&nbsp;Windows&nbsp;drive&nbsp;to&nbsp;an&nbsp;OS&nbsp;X&nbsp;SMB&nbsp;share,&nbsp;monitoring&nbsp;the&nbsp;local&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;changes&nbsp;there.&nbsp;However&nbsp;the&nbsp;same&nbsp;results&nbsp;occurred&nbsp;last&nbsp;time&nbsp;I&nbsp;checked&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;running&nbsp;the&nbsp;DOS&nbsp;app&nbsp;locally&nbsp;on&nbsp;OS&nbsp;X,&nbsp;so&nbsp;without&nbsp;any&nbsp;SMB&nbsp;in&nbsp;between,&nbsp;so&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;that&nbsp;the&nbsp;latter&nbsp;probably&nbsp;isn't&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;problem...&nbsp;Also,&nbsp;the&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;same&nbsp;issue&nbsp;occurs&nbsp;when&nbsp;my&nbsp;Mono&nbsp;application&nbsp;performs&nbsp;the&nbsp;changes&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;itself,&nbsp;so&nbsp;I&nbsp;doubt&nbsp;it's&nbsp;an&nbsp;issue&nbsp;with&nbsp;the&nbsp;DOS&nbsp;application&nbsp;performing&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;the&nbsp;changes.&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;min-height:&nbsp;14px;&nbsp;&quot;&gt;&lt;BR&gt;&lt;/DIV&gt;&nbsp;&lt;/BLOCKQUOTE&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;min-height:&nbsp;14px;&nbsp;&quot;&gt;&lt;BR&gt;&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;Mono&nbsp;has&nbsp;a&nbsp;special&nbsp;driver&nbsp;for&nbsp;OSX&nbsp;to&nbsp;handle&nbsp;this&nbsp;(it&nbsp;uses&nbsp;kqueue).&lt;SPAN&nbsp;class=&quot;Apple-converted-space&quot;&gt; &lt;/SPAN&gt;&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;min-height:&nbsp;14px;&nbsp;&quot;&gt;&lt;BR&gt;&lt;/DIV&gt;&lt;DIV&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;The&nbsp;source&nbsp;code&nbsp;is&nbsp;in&nbsp;mono/mono/metadata/filewatcher.c&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;Unfortunately&nbsp;there&nbsp;was&nbsp;no&nbsp;code&nbsp;such&nbsp;as&nbsp;#ifdef&nbsp;MACOSX&nbsp;in&nbsp;there&nbsp;;-)&nbsp;so&nbsp;thanks&nbsp;for&nbsp;this&nbsp;hint.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;FileSystemWatcher.cs&nbsp;gives&nbsp;me&nbsp;no&nbsp;hint&nbsp;on&nbsp;why&nbsp;get_MangledFilter&nbsp;might&nbsp;have&nbsp;crashed&nbsp;(it's&nbsp;all&nbsp;managed&nbsp;code)&nbsp;but&nbsp;then&nbsp;again&nbsp;I&nbsp;haven't&nbsp;seen&nbsp;this&nbsp;crash&nbsp;for&nbsp;a&nbsp;while&nbsp;now.&lt;/DIV&gt;&lt;/DIV&gt;&lt;BR&gt;&lt;DIV&gt;I&nbsp;don't&nbsp;know&nbsp;kqueue&nbsp;so&nbsp;...&nbsp;KeventWatcher.cs&nbsp;is&nbsp;not&nbsp;fundamentally&nbsp;wrong&nbsp;and&nbsp;there&nbsp;appears&nbsp;to&nbsp;be&nbsp;no&nbsp;way&nbsp;of&nbsp;enabling&nbsp;debug&nbsp;output.&nbsp;There&nbsp;are&nbsp;however&nbsp;a&nbsp;number&nbsp;of&nbsp;undocumented&nbsp;magic&nbsp;numbers&nbsp;specified&nbsp;as&nbsp;flags&nbsp;in&nbsp;StartMonitoringDirectory:&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;ev.filter&nbsp;=&nbsp;-4&nbsp;sets&nbsp;the&nbsp;filter&nbsp;to&nbsp;EVFILT_VNODE.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;Then,&nbsp;ev.flags&nbsp;and&nbsp;ev.fflags&nbsp;appear&nbsp;to&nbsp;use&nbsp;decimal&nbsp;flags&nbsp;while&nbsp;in&nbsp;my&nbsp;header&nbsp;files&nbsp;they&nbsp;are&nbsp;declared&nbsp;as&nbsp;hexadecimals!&nbsp;Especially&nbsp;20&nbsp;as&nbsp;opposed&nbsp;to&nbsp;0x20&nbsp;(EV_CLEAR&nbsp;and&nbsp;NOTE_RENAME).&nbsp;Might&nbsp;the&nbsp;incorrect&nbsp;clear&nbsp;flag&nbsp;(&quot;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#683821&quot;&nbsp;face=&quot;Monaco&quot;&nbsp;size=&quot;2&quot;&gt;&lt;SPAN&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;10px;&quot;&gt;clear&nbsp;event&nbsp;state&nbsp;after&nbsp;reporting&lt;/SPAN&gt;&lt;/FONT&gt;&quot;)&nbsp;explain&nbsp;why&nbsp;sometimes&nbsp;after&nbsp;some&nbsp;seconds&nbsp;delay&nbsp;I&nbsp;got&nbsp;a&nbsp;notification&nbsp;and&nbsp;afterwards&nbsp;none?&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;The&nbsp;polling&nbsp;thread&nbsp;(Monitor)&nbsp;sleeps&nbsp;for&nbsp;500&nbsp;ms&nbsp;so&nbsp;still&nbsp;wouldn't&nbsp;explain&nbsp;the&nbsp;long&nbsp;initial&nbsp;delay&nbsp;of&nbsp;&amp;gt;5&nbsp;s&nbsp;unless&nbsp;kqueue&nbsp;were&nbsp;so&nbsp;slow...&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;Also,&nbsp;error&nbsp;handling&nbsp;is&nbsp;missing&nbsp;in&nbsp;some&nbsp;places... For&nbsp;example,&nbsp;if&nbsp;no&nbsp;file&nbsp;descriptor&nbsp;can&nbsp;be&nbsp;obtained&nbsp;it&nbsp;is&nbsp;silently&nbsp;ignored&nbsp;just&nbsp;as&nbsp;for&nbsp;exceptions&nbsp;in&nbsp;foreach.&lt;/DIV&gt;&lt;DIV&gt;More&nbsp;severely,&nbsp;kevent()&nbsp;returns&nbsp;as&nbsp;errors&nbsp;EV_EOF=0x8000&nbsp;and&nbsp;EV_ERROR=0x4000&nbsp;yet&nbsp;the&nbsp;code&nbsp;only&nbsp;checks&nbsp;if&nbsp;kevent()&nbsp;&amp;gt;&nbsp;0&nbsp;but&nbsp;in&nbsp;that&nbsp;case&nbsp;always&nbsp;stops&nbsp;monitoring&nbsp;(closing&nbsp;the&nbsp;file),&nbsp;restarts&nbsp;it&nbsp;(opening&nbsp;a&nbsp;new&nbsp;file&nbsp;descriptor)&nbsp;and&nbsp;processes&nbsp;the&nbsp;event&nbsp;-&nbsp;reads&nbsp;like&nbsp;a&nbsp;dirty&nbsp;hack...&nbsp;but&nbsp;then&nbsp;again&nbsp;I&nbsp;have&nbsp;no&nbsp;experience&nbsp;with&nbsp;kqueue&nbsp;so&nbsp;I&nbsp;can't&nbsp;tell.&nbsp;Geoff,&nbsp;is&nbsp;this&nbsp;a&nbsp;workaround&nbsp;that&nbsp;would&nbsp;be&nbsp;obsoleted&nbsp;by&nbsp;changing&nbsp;the&nbsp;flags?&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;And&nbsp;finally:&nbsp;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;compile&nbsp;only&nbsp;System.dll&nbsp;from&nbsp;SVN&nbsp;and&nbsp;copy&nbsp;it&nbsp;into&nbsp;an&nbsp;existing&nbsp;Mono.framework&nbsp;1.2&nbsp;instead&nbsp;of&nbsp;compiling&nbsp;a&nbsp;separate&nbsp;runtime?&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;Andreas&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;
</tt>
