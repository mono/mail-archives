<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/3.24.1.1&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
On&nbsp;Tue,&nbsp;2009-04-21&nbsp;at&nbsp;18:08&nbsp;+0200,&nbsp;Andreas&nbsp;Heertsch&nbsp;wrote:<br>
&lt;BLOCKQUOTE&nbsp;TYPE=CITE&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;try&nbsp;to&nbsp;port&nbsp;libusb&nbsp;via&nbsp;LibUsbDotNet&nbsp;to&nbsp;Linux/OSX.&nbsp;The&nbsp;authors&nbsp;from&nbsp;libusb&nbsp;wrote&nbsp;structures&nbsp;with&nbsp;PATH_MAX&nbsp;as&nbsp;field&nbsp;lenght.&nbsp;So&nbsp;I&nbsp;have&nbsp;to&nbsp;integrate&nbsp;this&nbsp;malformed&nbsp;code.&nbsp;:(&lt;BR&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
You're&nbsp;screwed.&lt;BR&gt;<br>
&lt;BR&gt;<br>
The&nbsp;problem&nbsp;is&nbsp;that&nbsp;the&nbsp;array&nbsp;is&nbsp;inline:<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;PRE&gt;<br>
struct&nbsp;usb_device&nbsp;{<br>
&amp;nbsp;&nbsp;struct&nbsp;usb_device&nbsp;*next,&nbsp;*prev;<br>
<br>
&amp;nbsp;&nbsp;char&nbsp;filename[PATH_MAX&nbsp;+&nbsp;1];<br>
&amp;nbsp;&nbsp;/*&nbsp;...&nbsp;*/<br>
};<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
There&nbsp;are&nbsp;really&nbsp;only&nbsp;two&nbsp;ways&nbsp;to&nbsp;easily&nbsp;deal&nbsp;with&nbsp;this&nbsp;in&nbsp;C#&nbsp;[0],&nbsp;by&nbsp;using&nbsp;[MarshalAs]:<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;PRE&gt;<br>
struct&nbsp;UsbDevice&nbsp;{<br>
&amp;nbsp;&nbsp;[MarshalAs(UnmanagedType.ByValArray,&nbsp;SizeConst=???)]<br>
&amp;nbsp;&nbsp;public&nbsp;byte[]&nbsp;filename;<br>
&amp;nbsp;&nbsp;//&nbsp;...<br>
}<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
or&nbsp;by&nbsp;using&nbsp;&lt;TT&gt;fixed&lt;/TT&gt;&nbsp;arrays:<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;PRE&gt;<br>
unsafe&nbsp;struct&nbsp;UsbDevice&nbsp;{<br>
&amp;nbsp;&nbsp;public&nbsp;fixed&nbsp;byte&nbsp;filename[???];<br>
}<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
Both&nbsp;of&nbsp;these&nbsp;require&nbsp;&lt;I&gt;compile-time&lt;/I&gt;&nbsp;constant&nbsp;values,&nbsp;which&nbsp;&lt;TT&gt;Syscall.pathconf()&lt;/TT&gt;&nbsp;&lt;I&gt;cannot&lt;/I&gt;&nbsp;provide.&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;think&nbsp;in&nbsp;this&nbsp;case&nbsp;the&nbsp;only&nbsp;viable&nbsp;solution&nbsp;is&nbsp;a&nbsp;&lt;TT&gt;MonoPosixHelper&lt;/TT&gt;-style&nbsp;wrapper&nbsp;which&nbsp;exposes&nbsp;C#-friendly&nbsp;structures&nbsp;and&nbsp;functions,&nbsp;e.g.<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;PRE&gt;<br>
/*&nbsp;C&nbsp;*/<br>
struct&nbsp;ManagedUsbDevice&nbsp;{<br>
&amp;nbsp;&nbsp;void*&nbsp;next;<br>
&amp;nbsp;&nbsp;void*&nbsp;prev;<br>
&amp;nbsp;&nbsp;char*&nbsp;filename;<br>
&amp;nbsp;&nbsp;void*&nbsp;bus;<br>
&amp;nbsp;&nbsp;/*&nbsp;...&nbsp;*/<br>
};<br>
<br>
int&nbsp;UsbHelper_ToManagedUsbDevice(struct&nbsp;usb_device&nbsp;*from,&nbsp;struct&nbsp;ManagedUsbDevice&nbsp;*to);<br>
int&nbsp;UsbHelper_FromManagedUsbDevice(struct&nbsp;ManagedUsbDevice&nbsp;*from,&nbsp;struct&nbsp;usb_device&nbsp;*to);<br>
&lt;/PRE&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
Alternatively,&nbsp;forget&nbsp;structure&nbsp;compatibility&nbsp;from&nbsp;C#&nbsp;and&nbsp;just&nbsp;expose&nbsp;IntPtr&nbsp;to&nbsp;the&nbsp;C#&nbsp;code,&nbsp;and&nbsp;write&nbsp;a&nbsp;set&nbsp;of&nbsp;accessor&nbsp;functions&nbsp;which&nbsp;return&nbsp;struct&nbsp;fields.&lt;BR&gt;<br>
&lt;BR&gt;<br>
&nbsp;-&nbsp;Jon&lt;BR&gt;<br>
&lt;BR&gt;<br>
[0]&nbsp;&lt;A&nbsp;HREF=&quot;http://www.mono-project.com/Dllimport#Arrays_Embedded_Within_Structures&quot;&gt;http://www.mono-project.com/Dllimport#Arrays_Embedded_Within_Structures&lt;/A&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
