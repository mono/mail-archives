<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;having&nbsp;troubles&nbsp;getting&nbsp;my&nbsp;application&nbsp;to&nbsp;use&nbsp;an&nbsp;existing&nbsp;socket&nbsp;handle. &nbsp;The&nbsp;application&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;work&nbsp;with&nbsp;passes&nbsp;an&nbsp;integer&nbsp;(ie&nbsp;27)&nbsp;to&nbsp;my&nbsp;application&nbsp;via&nbsp;the&nbsp;command-line. &nbsp;So&nbsp;I&nbsp;populate&nbsp;a&nbsp;SocketInformation&nbsp;structure&nbsp;with&nbsp;that&nbsp;integer&nbsp;as&nbsp;the&nbsp;socket&nbsp;handle,&nbsp;then&nbsp;use&nbsp;that&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;Socket. &nbsp;For&nbsp;example:&lt;br&gt;<br>
&lt;br&gt;SocketInformation&nbsp;SI&nbsp;=&nbsp;new&nbsp;SocketInformation();&lt;br&gt;SI.Options&nbsp;=&nbsp;SocketInformationOptions.Connected;&lt;br&gt;SI.ProtocolInformation&nbsp;=&nbsp;new&nbsp;byte[24];&lt;br&gt;//&nbsp;Bunch&nbsp;of&nbsp;code&nbsp;to&nbsp;populate&nbsp;SI.ProtocolInformation&lt;br&gt;Socket&nbsp;S&nbsp;=&nbsp;new&nbsp;Socket(SI);&lt;br&gt;<br>
S.Send(new&nbsp;byte[]&nbsp;{&nbsp;65,&nbsp;66,&nbsp;67,&nbsp;68&nbsp;});&lt;br&gt;&lt;br&gt;When&nbsp;I&nbsp;call&nbsp;S.Send(),&nbsp;an&nbsp;exception&nbsp;is&nbsp;thrown&nbsp;with&nbsp;&quot;The&nbsp;descriptor&nbsp;is&nbsp;not&nbsp;a&nbsp;socket&quot;&nbsp;as&nbsp;the&nbsp;message.&lt;br&gt;&lt;br&gt;So&nbsp;I&nbsp;thought&nbsp;maybe&nbsp;I&nbsp;was&nbsp;populating&nbsp;the&nbsp;SocketInformation&nbsp;wrong,&nbsp;but&nbsp;when&nbsp;I&nbsp;inspect&nbsp;the&nbsp;properties&nbsp;of&nbsp;the&nbsp;created&nbsp;Socket&nbsp;all&nbsp;looks&nbsp;good&nbsp;to&nbsp;me,&nbsp;and&nbsp;if&nbsp;I&nbsp;replace&nbsp;the&nbsp;call&nbsp;to&nbsp;S.Send()&nbsp;with&nbsp;this&nbsp;it&nbsp;works&nbsp;fine:&lt;br&gt;<br>
&lt;br&gt;send(S.Handle,&nbsp;new&nbsp;byte[]&nbsp;{&nbsp;65,&nbsp;66,&nbsp;67,&nbsp;68&nbsp;},&nbsp;4,&nbsp;SocketFlags.None);&lt;br&gt;&lt;br&gt;Where&nbsp;send()&nbsp;is&nbsp;defined&nbsp;as:&lt;br&gt;&lt;br&gt;[DllImport(&quot;libc&quot;)]&lt;br&gt;private&nbsp;extern&nbsp;static&nbsp;int&nbsp;send(IntPtr&nbsp;sock,&nbsp;byte[]&nbsp;buf,&nbsp;int&nbsp;count,&nbsp;SocketFlags&nbsp;flags);&lt;br&gt;<br>
&lt;br&gt;Digging&nbsp;into&nbsp;things&nbsp;it&nbsp;looks&nbsp;like&nbsp;S.Send()&nbsp;will&nbsp;call&nbsp;Send_internal(),&nbsp;which&nbsp;will&nbsp;in&nbsp;turn&nbsp;call&nbsp;_wapi_send().&nbsp;This&nbsp;is&nbsp;where&nbsp;the&nbsp;call&nbsp;to&nbsp;send()&nbsp;is&nbsp;ultimately&nbsp;made,&nbsp;but&nbsp;before&nbsp;that&nbsp;this&nbsp;happens:&lt;br&gt;&lt;br&gt;if&nbsp;(_wapi_handle_type&nbsp;(handle)&nbsp;!=&nbsp;WAPI_HANDLE_SOCKET)&nbsp;{&lt;br&gt;<br>
   &nbsp;WSASetLastError&nbsp;(WSAENOTSOCK);&lt;br&gt;   &nbsp;return(SOCKET_ERROR);&lt;br&gt;}&lt;br&gt;&lt;br&gt;Is&nbsp;this&nbsp;possibly&nbsp;where&nbsp;my&nbsp;problem&nbsp;is&nbsp;coming&nbsp;from? &nbsp;If&nbsp;so,&nbsp;any&nbsp;way&nbsp;around&nbsp;it&nbsp;(aside&nbsp;from&nbsp;giving&nbsp;up&nbsp;the&nbsp;managed&nbsp;Socket&nbsp;class&nbsp;and&nbsp;pinvoking&nbsp;all&nbsp;the&nbsp;socket&nbsp;i/o)?&lt;br&gt;<br>
&lt;br&gt;Thanks,&lt;br&gt;Rick&lt;br&gt;&lt;/div&gt;<br>

</tt>
