/* passing union members to C from C# */
/* compile with: gcc -shared -o libunion.so union.c */
#include <stdio.h>

struct foo {
	void *p;
	union {
		char a;
		struct _bar {
			short d;
			long e;
		} b;
		int c;
	} u;
};

#define min(a, b) ((a) < (b) ? (a) : (b))

void
print_foo (struct foo* f)
{
	int i;
	unsigned char *d = (unsigned char *) f;
	for (i = 0; i < sizeof(*f); i += 8) {
		int n = (min (i+8, sizeof(*f)))%8;
		if (n == 0) n = 8;
		int j;
		for (j = 0; j < n; ++j) {
			printf ("%02x", d [i+j]);
		}
		printf ("\n");
	}
}

int
main (int argc, char **argv)
{
	struct foo f = {};
	f.p = (void*) 0x42;
	f.u.c = 0xdeadbeef;
	printf ("sizeof(struct foo)=%i\n", sizeof(f));
	print_foo (&f);
}

