<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Jan&nbsp;30,&nbsp;2010&nbsp;at&nbsp;12:54&nbsp;AM,&nbsp;Jon&nbsp;Harrop&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jon@ffconsultancy.com&quot;&gt;jon@ffconsultancy.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Saturday&nbsp;30&nbsp;January&nbsp;2010&nbsp;00:20:11&nbsp;Jonathan&nbsp;Shore&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;On&nbsp;Jan&nbsp;29,&nbsp;2010,&nbsp;at&nbsp;7:19&nbsp;PM,&nbsp;Jon&nbsp;Harrop&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&amp;gt;&nbsp;Jon,&nbsp;I&nbsp;saw&nbsp;your&nbsp;post&nbsp;about&nbsp;that&nbsp;on&nbsp;your&nbsp;blog&nbsp;some&nbsp;time&nbsp;ago.&nbsp; &nbsp;Someone&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&amp;gt;&nbsp;familiar&nbsp;with&nbsp;Mono&nbsp;claimed&nbsp;otherwise,&nbsp;was&nbsp;therefore&nbsp;uncertain&nbsp;as&nbsp;to&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&amp;gt;&nbsp;whether&nbsp;was&nbsp;addressed&nbsp;or&nbsp;not.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;You&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;verify&nbsp;my&nbsp;results&nbsp;easily:&nbsp;just&nbsp;run&nbsp;the&nbsp;8-line&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;example&nbsp;F#&nbsp;program&nbsp;I&nbsp;gave&nbsp;and&nbsp;Mono&nbsp;will&nbsp;stack&nbsp;overflow.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&amp;gt;&nbsp;I&nbsp;can&nbsp;live&nbsp;some&nbsp;some&nbsp;inefficiency&nbsp;in&nbsp;tail&nbsp;calls&nbsp;provided&nbsp;one&nbsp;does&nbsp;not&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&amp;gt;&nbsp;get&nbsp;stack&nbsp;overflow&nbsp;or&nbsp;some&nbsp;other&nbsp;fatal&nbsp;issue.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;TCO&nbsp;is&nbsp;broken&nbsp;on&nbsp;Mono,&nbsp;not&nbsp;merely&nbsp;inefficient.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;As&nbsp;I&nbsp;have&nbsp;no&nbsp;familiarity&nbsp;with&nbsp;the&nbsp;Mono&nbsp;VM&nbsp;code,&nbsp;no&nbsp;idea&nbsp;what&nbsp;it&nbsp;would&nbsp;take&lt;br&gt;<br>
&amp;gt;&nbsp;to&nbsp;fix&nbsp;this.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;There&nbsp;are&nbsp;many&nbsp;different&nbsp;solutions.&nbsp;The&nbsp;simplest&nbsp;would&nbsp;be&nbsp;to&nbsp;use&nbsp;LLVM&amp;#39;s&nbsp;fast&lt;br&gt;<br>
calling&nbsp;convention&nbsp;and&nbsp;tail&nbsp;calls&nbsp;as&nbsp;HLVM&nbsp;does.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Implementing&nbsp;proper&nbsp;TCO&nbsp;in&nbsp;mono&nbsp;requires&nbsp;2&nbsp;things.&nbsp;First&nbsp;is&nbsp;to&nbsp;change&nbsp;the&nbsp;managed&nbsp;calling&nbsp;convention&nbsp;to&lt;/div&gt;&lt;div&gt;have&nbsp;the&nbsp;caller&nbsp;pop&nbsp;its&nbsp;arguments.&nbsp;Then&nbsp;to&nbsp;lift&nbsp;any&nbsp;other&nbsp;few&nbsp;minor&nbsp;restrictions.&nbsp;Well&nbsp;probably&nbsp;have&nbsp;similar&lt;/div&gt;<br>
&lt;div&gt;restrictions&nbsp;as&nbsp;MS&amp;#39;s,&nbsp;such&nbsp;as&nbsp;no&nbsp;TCO&nbsp;on&nbsp;synchronized&nbsp;method.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
<br>
&amp;gt;&nbsp;&amp;gt;&amp;gt;&nbsp;There&nbsp;is&nbsp;just&nbsp;so&nbsp;much&nbsp;momentum&nbsp;and&nbsp;available&nbsp;libraries&nbsp;on&nbsp;the&nbsp;two&nbsp;major&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&amp;gt;&nbsp;VMs&nbsp;(CLR&nbsp;and&nbsp;JVM),&nbsp;that&nbsp;would&nbsp;be&nbsp;a&nbsp;huge&nbsp;risk&nbsp;for&nbsp;me&nbsp;at&nbsp;the&nbsp;moment.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;I&nbsp;was&nbsp;actually&nbsp;disappointed&nbsp;with&nbsp;.NET&amp;#39;s&nbsp;libraries&nbsp;in&nbsp;the&nbsp;context&nbsp;of&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;technical&nbsp;computing.&nbsp;I&nbsp;felt&nbsp;OCaml&nbsp;had&nbsp;better&nbsp;libraries&nbsp;and&nbsp;it&nbsp;turns&nbsp;out&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;that&nbsp;.NET&nbsp;was&nbsp;about&nbsp;as&nbsp;popular&nbsp;for&nbsp;technical&nbsp;computing&nbsp;as&nbsp;OCaml&nbsp;was&nbsp;when&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;I&nbsp;started.&nbsp;The&nbsp;main&nbsp;exception&nbsp;is&nbsp;WPF&nbsp;but&nbsp;you&nbsp;don&amp;#39;t&nbsp;get&nbsp;that&nbsp;with&nbsp;Mono.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;guess&nbsp;it&nbsp;depends&nbsp;where&nbsp;you&nbsp;come&nbsp;from.&nbsp; First&nbsp;I&amp;#39;ll&nbsp;have&nbsp;to&nbsp;be&nbsp;honest&nbsp;and&lt;br&gt;<br>
&amp;gt;&nbsp;say&nbsp;that&nbsp;I&nbsp;am&nbsp;new&nbsp;to&nbsp;Ocaml.&nbsp; &nbsp; My&nbsp;FP&nbsp;background&nbsp;is&nbsp;Scheme&nbsp;and&nbsp;some&nbsp;dabbling&lt;br&gt;<br>
&amp;gt;&nbsp;in&nbsp;Haskell.&nbsp; &nbsp; I&nbsp;had&nbsp;heard&nbsp;from&nbsp;real-world&nbsp;users&nbsp;of&nbsp;Ocaml&nbsp;(such&nbsp;as&nbsp;the&nbsp;Jane&lt;br&gt;<br>
&amp;gt;&nbsp;Street&nbsp;capital&nbsp;guys),&nbsp;that&nbsp;the&nbsp;depth&nbsp;of&nbsp;libraries&nbsp;for&nbsp;Ocaml&nbsp;is&nbsp;pretty&lt;br&gt;<br>
&amp;gt;&nbsp;shallow.&nbsp; &nbsp; They&amp;#39;ve&nbsp;invested&nbsp;some&nbsp;years&nbsp;into&nbsp;building&nbsp;that&nbsp;up,&nbsp;but&nbsp;is&lt;br&gt;<br>
&amp;gt;&nbsp;private&nbsp;work&nbsp;largely.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Now&nbsp;if&nbsp;we&nbsp;are&nbsp;talking&nbsp;about&nbsp;numerical&nbsp;stuff,&nbsp;then&nbsp;yes,&nbsp;there&nbsp;is&nbsp;not&nbsp;much&lt;br&gt;<br>
&amp;gt;&nbsp;publicly&nbsp;available&nbsp;on&nbsp;either&nbsp;the&nbsp;CLR&nbsp;or&nbsp;JVM.&nbsp; &nbsp; I&nbsp;was&nbsp;more&nbsp;referring&nbsp;to&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;tech&nbsp;libraries&nbsp;rather&nbsp;than&nbsp;scientific.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Yes.&nbsp;Technical&nbsp;libraries&nbsp;(e.g.&nbsp;graphing)&nbsp;are&nbsp;far&nbsp;more&nbsp;advanced&nbsp;on&nbsp;.NET.&nbsp;I&nbsp;was&lt;br&gt;<br>
referring&nbsp;only&nbsp;to&nbsp;numerical&nbsp;libraries&nbsp;like&nbsp;BLAS,&nbsp;LAPACK,&nbsp;FFTW&nbsp;and&nbsp;GSL.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;is&nbsp;a&nbsp;not&nbsp;very&nbsp;usually&nbsp;explored&nbsp;bit&nbsp;of&nbsp;hidden&nbsp;performance&nbsp;in&nbsp;.NET&nbsp;which&nbsp;is&lt;/div&gt;&lt;div&gt;runtime&nbsp;code&nbsp;generation.&nbsp;It&nbsp;is&nbsp;trivial&nbsp;to&nbsp;produce&nbsp;code&nbsp;that&nbsp;does&nbsp;runtime&nbsp;algorithm&lt;/div&gt;<br>
&lt;div&gt;specialization.&nbsp;You&nbsp;can&nbsp;even&nbsp;do&nbsp;most&nbsp;of&nbsp;it&nbsp;at&nbsp;high&nbsp;level&nbsp;in&nbsp;C#&nbsp;using&nbsp;expression&nbsp;trees.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Will&nbsp;or&nbsp;does&nbsp;HLVM&nbsp;support&nbsp;the&nbsp;F#&nbsp;dialect&nbsp;of&nbsp;Ocaml&nbsp;as&nbsp;well?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;HLVM&nbsp;is&nbsp;designed&nbsp;to&nbsp;be&nbsp;a&nbsp;language&nbsp;agnostic&nbsp;VM&nbsp;so&nbsp;it&nbsp;could&nbsp;support&nbsp;either&nbsp;in&lt;br&gt;<br>
theory.&nbsp;In&nbsp;practice,&nbsp;I&nbsp;will&nbsp;probably&nbsp;create&nbsp;a&nbsp;new&nbsp;language&nbsp;and&nbsp;any&nbsp;others&lt;br&gt;<br>
will&nbsp;be&nbsp;ports&nbsp;done&nbsp;by&nbsp;other&nbsp;people.&nbsp;Currently,&nbsp;both&nbsp;OCaml&nbsp;and&nbsp;F#&nbsp;box&nbsp;tuples&lt;br&gt;<br>
which&nbsp;would&nbsp;be&nbsp;a&nbsp;disaster&nbsp;on&nbsp;HLVM&nbsp;because&nbsp;my&nbsp;GC&nbsp;is&nbsp;not&nbsp;optimized&nbsp;for&lt;br&gt;<br>
short-lived&nbsp;values.&nbsp;Objectively,&nbsp;F#&nbsp;should&nbsp;not&nbsp;box&nbsp;tuples&nbsp;either.&nbsp;In&nbsp;fact,&nbsp;if&lt;br&gt;<br>
Mono&nbsp;implemented&nbsp;TCO&nbsp;and&nbsp;structs&nbsp;correctly&nbsp;and&nbsp;its&nbsp;own&nbsp;F#&nbsp;then&nbsp;it&nbsp;could&nbsp;unbox&lt;br&gt;<br>
tuples&nbsp;and&nbsp;would&nbsp;see&nbsp;huge&nbsp;performance&nbsp;improvements&nbsp;as&nbsp;a&nbsp;consequence.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&amp;#39;s&nbsp;wrong&nbsp;with&nbsp;the&nbsp;way&nbsp;mono&nbsp;implement&nbsp;structs?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;By&nbsp;the&nbsp;way,&nbsp;guys,&nbsp;the&nbsp;mono&nbsp;community&nbsp;is&nbsp;very&nbsp;welcoming&nbsp;to&nbsp;both&nbsp;external&nbsp;contribution&lt;/div&gt;<br>
&lt;div&gt;and&nbsp;feedback.&nbsp;So&nbsp;if&nbsp;you&nbsp;guys&nbsp;make&nbsp;a&nbsp;compelling&nbsp;case&nbsp;for&nbsp;TCO,&nbsp;maybe&nbsp;Miguel&nbsp;can&nbsp;get&lt;/div&gt;&lt;div&gt;someone&nbsp;to&nbsp;have&nbsp;it&nbsp;fixed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Rodrigo&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
