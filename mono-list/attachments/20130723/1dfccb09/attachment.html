<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;I&nbsp;had&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;mono_object_to_string&nbsp;implementation&nbsp;and&nbsp;it&nbsp;may&nbsp;need&nbsp;to&nbsp;be&nbsp;updated&nbsp;to&nbsp;support&nbsp;value&nbsp;types.&nbsp;It&nbsp;relies&nbsp;on&nbsp;mono_runtime_invoke&nbsp;which&nbsp;expects&nbsp;value&nbsp;types&nbsp;to&nbsp;be&nbsp;passed&nbsp;as&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;value&nbsp;type,&nbsp;not&nbsp;as&nbsp;a&nbsp;MonoObject&nbsp;pointer.&nbsp;I&nbsp;believe&nbsp;it&nbsp;could&nbsp;be&nbsp;fixed&nbsp;as&nbsp;follows.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;MonoString&nbsp;*&lt;br&gt;mono_object_to_string&nbsp;(MonoObject&nbsp;*obj,&nbsp;MonoObject&nbsp;**exc)&lt;br&gt;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;MonoMethod&nbsp;*to_string&nbsp;=&nbsp;NULL;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;MonoMethod&nbsp;*method;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;g_assert&nbsp;(obj);&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!to_string)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to_string&nbsp;=&nbsp;mono_class_get_method_from_name_flags&nbsp;(mono_get_object_class&nbsp;(),&nbsp;&quot;ToString&quot;,&nbsp;0,&nbsp;METHOD_ATTRIBUTE_VIRTUAL&nbsp;|&nbsp;METHOD_ATTRIBUTE_PUBLIC);&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;method&nbsp;=&nbsp;mono_object_get_virtual_method&nbsp;(obj,&nbsp;to_string);&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Unbox&nbsp;value&nbsp;type&nbsp;if&nbsp;needed&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;*target&nbsp;=&nbsp;obj;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(mono_class_is_valuetype&nbsp;(mono_method_get_class&nbsp;(method)))&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;mono_object_unbox(obj);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(MonoString&nbsp;*)&nbsp;mono_runtime_invoke&nbsp;(method,&nbsp;target,&nbsp;NULL,&nbsp;exc);&lt;br&gt;}&lt;/font&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Jul&nbsp;23,&nbsp;2013,&nbsp;at&nbsp;4:06&nbsp;PM,&nbsp;Aaron&nbsp;Oneal&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:aaron.oneal@spicypixel.com&quot;&gt;aaron.oneal@spicypixel.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;I&nbsp;ran&nbsp;the&nbsp;simple&nbsp;boxing&nbsp;test&nbsp;below&nbsp;on&nbsp;Mono&nbsp;2.10.12&nbsp;and&nbsp;3.1.2&nbsp;and&nbsp;don't&nbsp;understand&nbsp;why&nbsp;the&nbsp;ToString&nbsp;results&nbsp;on&nbsp;the&nbsp;boxed&nbsp;object&nbsp;do&nbsp;not&nbsp;match&nbsp;the&nbsp;unboxed&nbsp;value.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;can&nbsp;also&nbsp;pass&nbsp;the&nbsp;MonoObject&nbsp;into&nbsp;mono_runtime_invoke&nbsp;to&nbsp;have&nbsp;a&nbsp;C#&nbsp;method&nbsp;on&nbsp;the&nbsp;other&nbsp;side&nbsp;call&nbsp;ToString&nbsp;and&nbsp;it&nbsp;shows&nbsp;the&nbsp;correct&nbsp;value.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;a&nbsp;known&nbsp;issue&nbsp;with&nbsp;mono_object_to_string&nbsp;or&nbsp;am&nbsp;I&nbsp;doing&nbsp;something&nbsp;incorrectly?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;Int&nbsp;Marshalling&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;int32_t&nbsp;v&nbsp;=&nbsp;10;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;printf(&quot;original&nbsp;value&nbsp;=&nbsp;%d\n&quot;,&nbsp;v);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;MonoObject&nbsp;*obj&nbsp;=&nbsp;mono_value_box(mono_domain_get(),&nbsp;mono_get_int32_class(),&nbsp;&amp;v);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;MonoString&nbsp;*obj_string&nbsp;=&nbsp;mono_object_to_string(obj,&nbsp;NULL);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;char&nbsp;*obj_string_utf8&nbsp;=&nbsp;mono_string_to_utf8(obj_string);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;printf(&quot;boxed&nbsp;value&nbsp;=&nbsp;%s\n&quot;,&nbsp;obj_string_utf8);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;g_free(obj_string_utf8);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;v&nbsp;=&nbsp;*(int32_t*)mono_object_unbox(obj);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;printf(&quot;unboxed&nbsp;value&nbsp;=&nbsp;%d\n&quot;,&nbsp;v);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;Output&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;original&nbsp;value&nbsp;=&nbsp;10&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;boxed&nbsp;value&nbsp;=&nbsp;85441552&nbsp;&nbsp;&nbsp;&lt;--&nbsp;Huh?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;unboxed&nbsp;value&nbsp;=&nbsp;10&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;Bool&nbsp;Marshalling&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;int8_t&nbsp;b&nbsp;=&nbsp;0;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;printf(&quot;original&nbsp;value&nbsp;=&nbsp;%d\n&quot;,&nbsp;b);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;obj&nbsp;=&nbsp;mono_value_box(mono_domain_get(),&nbsp;mono_get_boolean_class(),&nbsp;&amp;b);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;obj_string&nbsp;=&nbsp;mono_object_to_string(obj,&nbsp;NULL);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;obj_string_utf8&nbsp;=&nbsp;mono_string_to_utf8(obj_string);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;printf(&quot;boxed&nbsp;value&nbsp;=&nbsp;%s\n&quot;,&nbsp;obj_string_utf8);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;g_free(obj_string_utf8);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;b&nbsp;=&nbsp;*(int8_t*)mono_object_unbox(obj);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;printf(&quot;unboxed&nbsp;value&nbsp;=&nbsp;%d\n&quot;,&nbsp;b);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;Output&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;original&nbsp;value&nbsp;=&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;boxed&nbsp;value&nbsp;=&nbsp;True&nbsp;&nbsp;&nbsp;&lt;--&nbsp;0&nbsp;==&nbsp;True&nbsp;?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&gt;//&nbsp;unboxed&nbsp;value&nbsp;=&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;Mono-list&nbsp;maillist&nbsp;&nbsp;-&nbsp;&nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
