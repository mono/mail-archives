<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Did&nbsp;you&nbsp;attach&nbsp;the&nbsp;thread&nbsp;before&nbsp;calling&nbsp;into&nbsp;the&nbsp;mono&nbsp;runtime?&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Apr&nbsp;12,&nbsp;2013&nbsp;at&nbsp;8:00&nbsp;PM,&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:Jean-Michel.Perraud@csiro.au&quot;&nbsp;target=&quot;_blank&quot;&gt;Jean-Michel.Perraud@csiro.au&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;trying&nbsp;to&nbsp;flush&nbsp;out&nbsp;bugs&nbsp;in&nbsp;an&nbsp;application&nbsp;with&nbsp;Mono&nbsp;(3.0.6)&nbsp;embedded.&nbsp;Improving&nbsp;on&nbsp;the&nbsp;Linux&nbsp;front,&nbsp;an&nbsp;issue&nbsp;on&nbsp;Windows&nbsp;is&nbsp;now&nbsp;baffling&nbsp;me.&nbsp;The&nbsp;issue&nbsp;seems&nbsp;deep&nbsp;in&nbsp;JIT&nbsp;exec&nbsp;code&nbsp;but&nbsp;has&nbsp;got&nbsp;to&nbsp;be&nbsp;because&nbsp;of&nbsp;my&nbsp;code.&lt;br&gt;<br>
<br>
I&nbsp;tried&nbsp;to&nbsp;condense&nbsp;the&nbsp;diagnosis&nbsp;with&nbsp;the&nbsp;(visual&nbsp;studio)&nbsp;native&nbsp;stack&nbsp;trace&nbsp;(I&nbsp;could&nbsp;not&nbsp;get&nbsp;the&nbsp;managed&nbsp;part&nbsp;from&nbsp;MonoDevelop&nbsp;yet).&nbsp;I&#39;d&nbsp;highly&nbsp;appreciate&nbsp;the&nbsp;informed&nbsp;guess&nbsp;of&nbsp;a&nbsp;guru&nbsp;to&nbsp;suggest&nbsp;where&nbsp;to&nbsp;look&nbsp;to&nbsp;fix&nbsp;it.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Regards.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;high&nbsp;level&nbsp;call&nbsp;(in&nbsp;the&nbsp;R&nbsp;language)&nbsp;is&nbsp;like:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;callStaticMethod(&nbsp;&quot;SomeNamespace.AClassName&quot;,&nbsp;&quot;TheStaticMethod&quot;,&nbsp;&quot;SomeString&quot;,&nbsp;&quot;AnotherString&quot;&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;main&nbsp;C&nbsp;code&nbsp;for&nbsp;preparing&nbsp;the&nbsp;CLR&nbsp;method&nbsp;call&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;MonoMethod&nbsp;*&nbsp;methodCallStaticMethod&nbsp;=&nbsp;rclr_mono_get_method(&nbsp;spTypeClrFacade,&nbsp;&quot;CallStaticMethodMono&quot;,&nbsp;3);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;void**&nbsp;static_mparams&nbsp;=&nbsp;(void**)malloc(3*sizeof(void*));&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;MonoArray*&nbsp;methParams&nbsp;=&nbsp;create_array_object(params,&nbsp;paramCount);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;static_mparams[0]&nbsp;=&nbsp;create_mono_string(ns_qualified_typename);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;static_mparams[1]&nbsp;=&nbsp;create_mono_string(methodName);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;static_mparams[2]&nbsp;=&nbsp;methParams;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;result&nbsp;=&nbsp;mono_runtime_invoke&nbsp;(methodCallStaticMethod,&nbsp;NULL,&nbsp;static_mparams,&nbsp;&amp;exception);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;calling&nbsp;the&nbsp;C#&nbsp;method:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;public&nbsp;static&nbsp;object&nbsp;CallStaticMethodMono(string&nbsp;typename,&nbsp;string&nbsp;methodName,&nbsp;object[]&nbsp;arguments)&lt;br&gt;<br>
&lt;br&gt;<br>
further&nbsp;in&nbsp;the&nbsp;stack&nbsp;strace,&nbsp;in:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;icall.c&nbsp;:&nbsp;ves_icall_System_Reflection_Assembly_GetExecutingAssembly&nbsp;(void)&lt;br&gt;<br>
the&nbsp;following&nbsp;line&nbsp;returns&nbsp;dest&nbsp;as&nbsp;a&nbsp;NULL&nbsp;pointer,&nbsp;which&nbsp;looks&nbsp;like&nbsp;a&nbsp;very&nbsp;unexpected&nbsp;condition&nbsp;hence&nbsp;the&nbsp;crash.&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;mono_stack_walk_no_il&nbsp;(get_executing,&nbsp;&amp;dest);&lt;br&gt;<br>
It&nbsp;seems&nbsp;that&nbsp;the&nbsp;root&nbsp;cause&nbsp;is&nbsp;in&nbsp;the&nbsp;function:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;mono_walk_stack_full:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while&nbsp;(MONO_CONTEXT_GET_SP&nbsp;(&amp;ctx)&nbsp;&lt;&nbsp;jit_tls-&gt;end_of_stack)&lt;br&gt;<br>
which&nbsp;is&nbsp;already&nbsp;false&nbsp;at&nbsp;the&nbsp;first&nbsp;iteration,&nbsp;hence&nbsp;&#39;dest&#39;&nbsp;remains&nbsp;NULL.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-list&nbsp;maillist&nbsp; -&nbsp; &lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
