<tt>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;the&nbsp;following&nbsp;in&nbsp;my&nbsp;Global.asax.cs:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;void&nbsp;Application_PreRequestHandlerExecute(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; {&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HttpApplication&nbsp;app&nbsp;=&nbsp;sender&nbsp;as&nbsp;HttpApplication;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp;acceptEncoding&nbsp;=&nbsp;app.Request.Headers[&amp;quot;Accept-Encoding&amp;quot;];&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Stream&nbsp;prevUncompressedStream&nbsp;=&nbsp;app.Response.Filter;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; app.Response.Charset&nbsp;=&nbsp;&amp;quot;utf-8&amp;quot;;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string&nbsp;acceptEncoding&nbsp;=&nbsp;acceptEncoding.ToLower();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;(acceptEncoding.Contains(&amp;quot;deflate&amp;quot;))&lt;/div&gt;<br>
<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp;deflate&nbsp;is&nbsp;21-41%&nbsp;faster!&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; app.Response.Filter&nbsp;=&nbsp;new&nbsp;DeflateStream(prevUncompressedStream,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CompressionMode.Compress);&lt;/div&gt;<br>
<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; app.Response.AppendHeader(&amp;quot;Content-Encoding&amp;quot;,&nbsp;&amp;quot;deflate&amp;quot;);&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;/div&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;serve&nbsp;static&nbsp;UTF-8&nbsp;files&nbsp;like&nbsp;CSS&nbsp;or&nbsp;JS&nbsp;files&nbsp;via&nbsp;xsp2+mono2.4&nbsp;on&nbsp;Vista64,&nbsp; &nbsp;the&nbsp;following&nbsp;bytes&nbsp;are&nbsp;written&nbsp;before&nbsp;my&nbsp;original&nbsp;content:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;000000000&nbsp; 02&nbsp;00&nbsp;00&nbsp;00&nbsp;FF&nbsp;FF&nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&amp;#39;s&nbsp;a&nbsp;mono-only&nbsp;issue&nbsp;(on&nbsp;IIS/WebDev&nbsp;it&amp;#39;s&nbsp;fine),&nbsp;if&nbsp;I&nbsp;disable&nbsp;compression,&nbsp;it&nbsp;works&nbsp;on&nbsp;mono&nbsp;too. &lt;/div&gt;&lt;div&gt;My&nbsp;files&nbsp;are&nbsp;in&nbsp;UTF-8,&nbsp;however&nbsp;the&nbsp;app.Response.Filter&nbsp;stream&nbsp;is&nbsp;UTF-8&nbsp;too.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;Headers&nbsp;sent:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Date&lt;pre&nbsp;class=&quot;&quot;&gt;Wed,&nbsp;13&nbsp;May&nbsp;2009&nbsp;13:47:07&nbsp;GMT&lt;/pre&gt;Server&lt;pre&nbsp;class=&quot;&quot;&gt;Mono.WebServer2/&lt;a&nbsp;href=&quot;http://0.2.0.0&quot;&gt;0.2.0.0&lt;/a&gt;&nbsp;Win32NT&lt;/pre&gt;Content-Encoding&lt;pre&nbsp;class=&quot;&quot;&gt;<br>
<br>
deflate&lt;/pre&gt;Vary&lt;pre&nbsp;class=&quot;&quot;&gt;Content-Encoding&lt;/pre&gt;Last-Modified&lt;pre&nbsp;class=&quot;&quot;&gt;Fri,&nbsp;01&nbsp;May&nbsp;2009&nbsp;20:01:43&nbsp;GMT&lt;/pre&gt;X-AspNet-Version&lt;pre&nbsp;class=&quot;&quot;&gt;2.0.50727&lt;/pre&gt;Content-Length&lt;pre&nbsp;class=&quot;&quot;&gt;1463&lt;/pre&gt;Cache-Control&lt;pre&nbsp;class=&quot;&quot;&gt;<br>
<br>
private&lt;/pre&gt;Content-Type&lt;pre&nbsp;class=&quot;&quot;&gt;text/css;&nbsp;charset=utf-8&lt;/pre&gt;Keep-Alive&lt;pre&nbsp;class=&quot;&quot;&gt;timeout=15,&nbsp;max=99&lt;/pre&gt;Connection&lt;pre&nbsp;class=&quot;&quot;&gt;Keep-Alive&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;hints?&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;üdvözlettel&lt;br&gt;with&nbsp;regards&lt;br&gt;&lt;br&gt;Kardos&nbsp;Bálint&lt;br&gt;_______________________________________&lt;br&gt;&lt;a&nbsp;href=&quot;http://skaelede.hu&quot;&gt;http://skaelede.hu&lt;/a&gt;&nbsp;10&nbsp;(0xA)&nbsp;év&nbsp;a&nbsp;magyar&nbsp;weben&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
