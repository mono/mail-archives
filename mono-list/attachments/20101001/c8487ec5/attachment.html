<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Koush,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;Nice,&nbsp;can&nbsp;you&nbsp;please&nbsp;confirm&nbsp;on&nbsp;the&nbsp;list&nbsp;that&nbsp;you're&nbsp;willing&nbsp;to&nbsp;contribute&nbsp;this&nbsp;patch&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;MIT/X11&nbsp;license?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-g&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;2010-09-30,&nbsp;at&nbsp;12:26&nbsp;AM,&nbsp;Koushik&nbsp;Dutta&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Here&nbsp;is&nbsp;the&nbsp;fix&nbsp;for&nbsp;the&nbsp;following&nbsp;bug:&lt;br&gt;&lt;a&nbsp;href=&quot;https://bugzilla.novell.com/show_bug.cgi?id=633454&quot;&gt;https://bugzilla.novell.com/show_bug.cgi?id=633454&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;underlying&nbsp;problem&nbsp;is&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;Android's&nbsp;libc,&nbsp;where&nbsp;after&nbsp;a&nbsp;process&nbsp;forks,&nbsp;the&nbsp;kernel&nbsp;id&nbsp;of&nbsp;the&nbsp;forked&nbsp;thread&nbsp;is&nbsp;not&nbsp;changed&nbsp;to&nbsp;reflect&nbsp;the&nbsp;new&nbsp;child&nbsp;thread.&nbsp;The&nbsp;pthread&nbsp;kernel&nbsp;id&nbsp;still&nbsp;points&nbsp;to&nbsp;the&nbsp;kernel&nbsp;id&nbsp;of&nbsp;the&nbsp;parent&nbsp;process:&nbsp;zygote.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;bug&nbsp;breaks&nbsp;all&nbsp;multithread&nbsp;monodroid&nbsp;apps&nbsp;(as&nbsp;well&nbsp;as&nbsp;my&nbsp;mono&nbsp;on&nbsp;Android&nbsp;port),&nbsp;as&nbsp;Garbage&nbsp;Collection&nbsp;fails&nbsp;and&nbsp;the&nbsp;process&nbsp;hangs.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;fix/workaround&nbsp;for&nbsp;the&nbsp;bug&nbsp;in&nbsp;Android&nbsp;is&nbsp;as&nbsp;follows:&lt;br&gt;<br>
The&nbsp;GC_Thread&nbsp;structure&nbsp;on&nbsp;Android&nbsp;has&nbsp;a&nbsp;new&nbsp;&quot;kernel_id&quot;&nbsp;member.&nbsp;When&nbsp;GC_new_thread&nbsp;is&nbsp;called,&nbsp;the&nbsp;kernel&nbsp;id&nbsp;is&nbsp;also&nbsp;retrieved&nbsp;and&nbsp;stored&nbsp;with&nbsp;gettid.&nbsp;When&nbsp;the&nbsp;world&nbsp;needs&nbsp;to&nbsp;be&nbsp;stopped/started,&nbsp;a&nbsp;new&nbsp;function&nbsp;android_thread_kill&nbsp;is&nbsp;called,&nbsp;which&nbsp;is&nbsp;a&nbsp;reimplementation&nbsp;of&nbsp;Android's&nbsp;pthread_kill.&nbsp;Instead,&nbsp;which&nbsp;takes&nbsp;the&nbsp;correct&nbsp;kernel&nbsp;id,&nbsp;rather&nbsp;than&nbsp;the&nbsp;potentially&nbsp;hosed&nbsp;pthread.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;attached&nbsp;a&nbsp;patch&nbsp;file,&nbsp;as&nbsp;well&nbsp;as&nbsp;committed&nbsp;to&nbsp;my&nbsp;fork&nbsp;of&nbsp;mono&nbsp;on&nbsp;Github:&lt;/div&gt;&lt;a&nbsp;href=&quot;http://github.com/koush/mono/commit/414aff5598a2dea618741bea714fa8dd1baf0d52&quot;&gt;http://github.com/koush/mono/commit/414aff5598a2dea618741bea714fa8dd1baf0d52&lt;/a&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;span&gt;&amp;lt;pthread_android.patch&amp;gt;&lt;/span&gt;_______________________________________________&lt;br&gt;Mono-list&nbsp;maillist&nbsp;&amp;nbsp;-&nbsp;&amp;nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
