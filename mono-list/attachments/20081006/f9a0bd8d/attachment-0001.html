<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Markus,&lt;br&gt;&lt;br&gt;Your&nbsp;code&nbsp;works&nbsp;by&nbsp;pure&nbsp;luck&nbsp;as&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;respect&nbsp;the&nbsp;ABI&nbsp;of&nbsp;neither&nbsp;platforms.&lt;br&gt;&lt;br&gt;If&nbsp;you&nbsp;really&nbsp;want&nbsp;to&nbsp;follow&nbsp;this&nbsp;path,&nbsp;make&nbsp;sure&nbsp;you&nbsp;first&nbsp;undestand&nbsp;the&nbsp;ABI&nbsp;used&nbsp;by&nbsp;your&nbsp;platform&nbsp;and&nbsp;generate&lt;br&gt;<br>
code&nbsp;that&nbsp;follows&nbsp;it.&lt;br&gt;&lt;br&gt;For&nbsp;example,&nbsp;your&nbsp;code&nbsp;uses&nbsp;ebx,&nbsp;a&nbsp;callee&nbsp;saved&nbsp;reg,&nbsp;without&nbsp;saving&nbsp;it&nbsp;at&nbsp;prologue&nbsp;and&nbsp;restoring&nbsp;at&nbsp;epilogue.&lt;br&gt;&lt;br&gt;You&nbsp;can&nbsp;start&nbsp;by&nbsp;taking&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;wikipedia&nbsp;entry&nbsp;&lt;a&nbsp;href=&quot;http://en.wikipedia.org/wiki/Application_binary_interface&quot;&gt;http://en.wikipedia.org/wiki/Application_binary_interface&lt;/a&gt;&nbsp;and&nbsp;then&lt;br&gt;<br>
dig&nbsp;further&nbsp;in&nbsp;the&nbsp;calling&nbsp;convention&nbsp;part&nbsp;of&nbsp;it&nbsp;-&nbsp;this&nbsp;is&nbsp;specially&nbsp;important&nbsp;for&nbsp;windows.&lt;br&gt;&lt;br&gt;Good&nbsp;luck,&lt;br&gt;Rodrigo&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Oct&nbsp;6,&nbsp;2008&nbsp;at&nbsp;6:59&nbsp;PM,&nbsp;Markus&nbsp;Johnsson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:markus.johnsson.84@gmail.com&quot;&gt;markus.johnsson.84@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ve&nbsp;been&nbsp;experimenting&nbsp;with&nbsp;x86&nbsp;assembly&nbsp;coding&nbsp;and&nbsp;execution&nbsp;from&nbsp;within&nbsp;C#,&nbsp;and&nbsp;was&nbsp;happy&nbsp;to&nbsp;get&nbsp;some&nbsp;code&nbsp;(see&nbsp;below)&nbsp;to&nbsp;work.&nbsp;However,&nbsp;when&nbsp;I&nbsp;tried&nbsp;it&nbsp;on&nbsp;Windows&nbsp;and&nbsp;.NET&nbsp;it&nbsp;failed&nbsp;with&nbsp;an&nbsp;AccessViolationException.&nbsp;Should&nbsp;I&nbsp;expect&nbsp;it&nbsp;to&nbsp;fail&nbsp;on&nbsp;mono&nbsp;too&nbsp;in&nbsp;a&nbsp;future&nbsp;release?&nbsp;Is&nbsp;there&nbsp;a&nbsp;better&nbsp;way&nbsp;to&nbsp;do&nbsp;this&nbsp;(i.e.&nbsp;executing&nbsp;x86&nbsp;code&nbsp;without&nbsp;using&nbsp;a&nbsp;C&nbsp;library)?&amp;nbsp;Using&nbsp;mono&nbsp;the&nbsp;code&nbsp;below&nbsp;compiles&nbsp;and&nbsp;runs&nbsp;fine&nbsp;on&nbsp;both&nbsp;Windows&nbsp;(mono&nbsp;2.0)&nbsp;and&nbsp;Linux&nbsp;(mono&nbsp;svn).&amp;nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cheers&amp;nbsp;&lt;/div&gt;&lt;div&gt;Markus&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;using&nbsp;System;&lt;/div&gt;&lt;div&gt;using&nbsp;System.Text;&lt;/div&gt;&lt;div&gt;using&nbsp;System.Runtime.InteropServices;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;X86AssemblyExec&nbsp;{&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;[UnmanagedFunctionPointer(CallingConvention.Cdecl)]&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;private&nbsp;delegate&nbsp;int&nbsp;TheDelegate();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;public&nbsp;static&nbsp;void&nbsp;Main(string[]&nbsp;args)&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;x86&nbsp;assembly:&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;mov&nbsp;eax&nbsp;8&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;B8&nbsp;08&nbsp;00&nbsp;00&nbsp;00&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;mov&nbsp;ebx&nbsp;9&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;BB&nbsp;09&nbsp;00&nbsp;00&nbsp;00&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;add&nbsp;eax&nbsp;ebx&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;01&nbsp;d8&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;ret&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;C3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;opcode&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;byte&nbsp;[]&nbsp;code&nbsp;=&nbsp;new&nbsp;byte[14];&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[0]&nbsp;=&nbsp;(byte)&nbsp;0xB8;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[1]&nbsp;=&nbsp;(byte)&nbsp;0x08;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[2]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[3]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[4]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[5]&nbsp;=&nbsp;(byte)&nbsp;0xBB;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[6]&nbsp;=&nbsp;(byte)&nbsp;0x09;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[7]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[8]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[9]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[10]&nbsp;=&nbsp;(byte)0x01;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[11]&nbsp;=&nbsp;(byte)0xd8;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[12]&nbsp;=&nbsp;(byte)0xC3;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[13]&nbsp;=&nbsp;0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;unsafe&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;fixed&nbsp;(void&nbsp;*ptr&nbsp;=&nbsp;code)&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;create&nbsp;the&nbsp;delegate&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;TheDelegate&nbsp;del&nbsp;=&nbsp;(TheDelegate)&nbsp;Marshal.GetDelegateForFunctionPointer(&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;new&nbsp;IntPtr(ptr),&nbsp;typeof(TheDelegate));&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;call&nbsp;the&nbsp;function&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;int&nbsp;x&nbsp;=&nbsp;del();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;outputs&nbsp;17&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Console.WriteLine(x);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Mono-list&nbsp;maillist&nbsp;&amp;nbsp;-&nbsp;&amp;nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-list@lists.ximian.com&quot;&gt;Mono-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
