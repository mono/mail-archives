<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ve&nbsp;been&nbsp;experimenting&nbsp;with&nbsp;x86&nbsp;assembly&nbsp;coding&nbsp;and&nbsp;execution&nbsp;from&nbsp;within&nbsp;C#,&nbsp;and&nbsp;was&nbsp;happy&nbsp;to&nbsp;get&nbsp;some&nbsp;code&nbsp;(see&nbsp;below)&nbsp;to&nbsp;work.&nbsp;However,&nbsp;when&nbsp;I&nbsp;tried&nbsp;it&nbsp;on&nbsp;Windows&nbsp;and&nbsp;.NET&nbsp;it&nbsp;failed&nbsp;with&nbsp;an&nbsp;AccessViolationException.&nbsp;Should&nbsp;I&nbsp;expect&nbsp;it&nbsp;to&nbsp;fail&nbsp;on&nbsp;mono&nbsp;too&nbsp;in&nbsp;a&nbsp;future&nbsp;release?&nbsp;Is&nbsp;there&nbsp;a&nbsp;better&nbsp;way&nbsp;to&nbsp;do&nbsp;this&nbsp;(i.e.&nbsp;executing&nbsp;x86&nbsp;code&nbsp;without&nbsp;using&nbsp;a&nbsp;C&nbsp;library)?&amp;nbsp;Using&nbsp;mono&nbsp;the&nbsp;code&nbsp;below&nbsp;compiles&nbsp;and&nbsp;runs&nbsp;fine&nbsp;on&nbsp;both&nbsp;Windows&nbsp;(mono&nbsp;2.0)&nbsp;and&nbsp;Linux&nbsp;(mono&nbsp;svn).&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cheers&amp;nbsp;&lt;/div&gt;&lt;div&gt;Markus&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;using&nbsp;System;&lt;/div&gt;&lt;div&gt;using&nbsp;System.Text;&lt;/div&gt;&lt;div&gt;using&nbsp;System.Runtime.InteropServices;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;X86AssemblyExec&nbsp;{&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;[UnmanagedFunctionPointer(CallingConvention.Cdecl)]&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;private&nbsp;delegate&nbsp;int&nbsp;TheDelegate();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;public&nbsp;static&nbsp;void&nbsp;Main(string[]&nbsp;args)&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;x86&nbsp;assembly:&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;mov&nbsp;eax&nbsp;8&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;B8&nbsp;08&nbsp;00&nbsp;00&nbsp;00&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;mov&nbsp;ebx&nbsp;9&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;BB&nbsp;09&nbsp;00&nbsp;00&nbsp;00&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;add&nbsp;eax&nbsp;ebx&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;01&nbsp;d8&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;ret&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;C3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;opcode&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;byte&nbsp;[]&nbsp;code&nbsp;=&nbsp;new&nbsp;byte[14];&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[0]&nbsp;=&nbsp;(byte)&nbsp;0xB8;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[1]&nbsp;=&nbsp;(byte)&nbsp;0x08;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[2]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[3]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[4]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[5]&nbsp;=&nbsp;(byte)&nbsp;0xBB;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[6]&nbsp;=&nbsp;(byte)&nbsp;0x09;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[7]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[8]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[9]&nbsp;=&nbsp;(byte)&nbsp;0x00;&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[10]&nbsp;=&nbsp;(byte)0x01;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[11]&nbsp;=&nbsp;(byte)0xd8;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[12]&nbsp;=&nbsp;(byte)0xC3;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;code[13]&nbsp;=&nbsp;0;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;unsafe&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;fixed&nbsp;(void&nbsp;*ptr&nbsp;=&nbsp;code)&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;create&nbsp;the&nbsp;delegate&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;TheDelegate&nbsp;del&nbsp;=&nbsp;(TheDelegate)&nbsp;Marshal.GetDelegateForFunctionPointer(&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;new&nbsp;IntPtr(ptr),&nbsp;typeof(TheDelegate));&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;call&nbsp;the&nbsp;function&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;int&nbsp;x&nbsp;=&nbsp;del();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;//&nbsp;outputs&nbsp;17&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Console.WriteLine(x);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
