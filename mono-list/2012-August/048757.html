<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Missing .ctor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Missing%20.ctor&In-Reply-To=%3CAA39B58515613A418F5CEB3FDF6396250901AA45%40MTLEXC03.eidos.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048786.html">
   <LINK REL="Next"  HREF="048758.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Missing .ctor</H1>
    <B>Francois Schelling</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Missing%20.ctor&In-Reply-To=%3CAA39B58515613A418F5CEB3FDF6396250901AA45%40MTLEXC03.eidos.com%3E"
       TITLE="[Mono-list] Missing .ctor">fschelling at square-enix-montreal.com
       </A><BR>
    <I>Tue Aug  7 20:32:42 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="048786.html">[Mono-list] Mono &amp; Command Line
</A></li>
        <LI>Next message: <A HREF="048758.html">[Mono-list] Missing .ctor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48757">[ date ]</a>
              <a href="thread.html#48757">[ thread ]</a>
              <a href="subject.html#48757">[ subject ]</a>
              <a href="author.html#48757">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm new with Mono and I'm having a problem to get my project running.  I've created a C++ console application in which I would like to embed a C# dll.  I'm able to open my C# dll but once I try to invoke a function on my C# object, I got the following error:

Missing method .ctor in assembly D:\projects\monoscripting\monoscripting\monoscript.dll, type System.Runtime.Versioning.TargetFrameworkAttribute
Can't find custom attr constructor image: D:\projects\monoscripting\monoscripting\monoscript.dll mtoken: 0x0a00000d

I'm using Mono 2.10.8 with Visual Studio 2010.

My CS class look like this :

class ScriptTest
{
public ScriptTest() { }

void TestMe()
{
	Console.WriteLine(&quot;Hello %f\n&quot;, m_Test);
}

public float m_Test = 0;
}

My C++ main() looks like this:

int main(int argc, char* argv[])
{
	mono_set_dirs(&quot;mono/lib&quot;, &quot;mono/etc&quot;); 
	MonoDomain* domain = mono_jit_init(&quot;monoscripting.exe&quot;);

	MonoAssembly* assembly;
	assembly = mono_domain_assembly_open (domain, &quot;monoscript.dll&quot;);
	if (!assembly)
	{
		return 1;
	}

	mono_config_parse(NULL);

	MonoImage* image = mono_assembly_get_image( assembly );
	if (!image)
	{
		return 1;
	}

	const char* ns = &quot;monoscript&quot;;
	const char* name = &quot;ScriptTest&quot;;
	MonoClass* klass = mono_class_from_name (image, ns, name);
	if (!klass)
	{
		return 1;
	}
	
	// Create a new instance of the class.
	MonoObject* object = mono_object_new( domain, klass );

	// Get the constructor of the class.
	MonoMethod* constructorMethod = mono_class_get_method_from_name( klass, &quot;.ctor&quot;, 0);
	MonoObject* pException = NULL;
	mono_runtime_invoke (constructorMethod, object, NULL, &amp;pException);

...
}

I've added the following code to see the content of my class and the constructor seems to be there:

void* iter = NULL;
while ((method = mono_class_get_methods (klass, &amp;iter)))
{
	printf(mono_method_get_name(method));
	printf(&quot;\n&quot;);
}

Give me the following output:

.ctor
TestMe

Anyone have a idea to solve my problem?

Thanks!
__________________________________________________
Francois Schelling
Senior Programmer
Square Enix Montr&#233;al 







______________________________________________________________________
This email has been scanned by the MessageLabs
______________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20120807/83bff89c/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20120807/83bff89c/attachment-0001.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048786.html">[Mono-list] Mono &amp; Command Line
</A></li>
	<LI>Next message: <A HREF="048758.html">[Mono-list] Missing .ctor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48757">[ date ]</a>
              <a href="thread.html#48757">[ thread ]</a>
              <a href="subject.html#48757">[ subject ]</a>
              <a href="author.html#48757">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
