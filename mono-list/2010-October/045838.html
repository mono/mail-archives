<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] numerical performance comparison [C++ vs JVM vs	Mono]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20numerical%20performance%20comparison%20%5BC%2B%2B%20vs%20JVM%20vs%0A%09Mono%5D&In-Reply-To=47997FDB-D8B9-49CA-92FF-5A81B0D6EB80%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="045836.html">
   <LINK REL="Next"  HREF="045839.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] numerical performance comparison [C++ vs JVM vs	Mono]</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20numerical%20performance%20comparison%20%5BC%2B%2B%20vs%20JVM%20vs%0A%09Mono%5D&In-Reply-To=47997FDB-D8B9-49CA-92FF-5A81B0D6EB80%40gmail.com"
       TITLE="[Mono-list] numerical performance comparison [C++ vs JVM vs	Mono]">kumpera at gmail.com
       </A><BR>
    <I>Mon Oct  4 16:53:52 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="045836.html">[Mono-list] numerical performance comparison [C++ vs JVM vs Mono]
</A></li>
        <LI>Next message: <A HREF="045839.html">[Mono-list] Command Line Options on Windows and Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45838">[ date ]</a>
              <a href="thread.html#45838">[ thread ]</a>
              <a href="subject.html#45838">[ subject ]</a>
              <a href="author.html#45838">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jonathan,

Mono 64bits uses the x87 square root instruction which is far from optimal
since it requires 2 stores and 1 load.
Zoltan, is it possible to switch to SQRTSD?

And, yes, mono does have some issues with register allocation. It's
something that will be worked on in the mid term thou.




On Mon, Oct 4, 2010 at 11:43 AM, Jonathan Shore &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">jonathan.shore at gmail.com</A>&gt;wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I am looking forward to moving all of my code from Java / C++ to F# / C# in
</I>&gt;<i> the very near future.   I took the nbody code from the language shootout and
</I>&gt;<i> ran with 500 million iterations (much more than used in the shootout to
</I>&gt;<i> provide a fair comparison) on ubuntu server on a core i7 920 box.
</I>&gt;<i>
</I>&gt;<i> I used:
</I>&gt;<i>
</I>&gt;<i> - C++ (g++ -O3 with various MMX related flags as done in the shootout)
</I>&gt;<i> - Java 7  -server
</I>&gt;<i> - Mono 2.4.4, compiling with -optimize:+
</I>&gt;<i>
</I>&gt;<i> I had the following results in seconds:
</I>&gt;<i>
</I>&gt;<i> 1.  C++:                98 seconds
</I>&gt;<i> 2.  JVM:                126 seconds,  a 28% performance gap against C++
</I>&gt;<i> 3.  Mono:       191 seconds,  a 50% performance gap with the JVM
</I>&gt;<i>
</I>&gt;<i> Because the nbody problem uses sqrt for the euclidean distance in each
</I>&gt;<i> loop, thought that maybe the discrepancy might be more related to the
</I>&gt;<i> implementation of Sqrt().
</I>&gt;<i>
</I>&gt;<i> I implemented a (very poor) numerical algorithm as a substitute for the
</I>&gt;<i> sqrt() function in each implementation to provide an apples-to-apples
</I>&gt;<i> comparison.    The new numbers became:
</I>&gt;<i>
</I>&gt;<i> 1.  C++:                517 seconds
</I>&gt;<i> 2.  JVM:                527 seconds
</I>&gt;<i> 3  Mono:                223 seconds (wow, a surprise here)
</I>&gt;<i>
</I>&gt;<i> I noticed that the Mono runtime libraries use an internal implementation of
</I>&gt;<i> Sqrt() that seems to resolve to an Op Code.   I am wondering, ultimately,
</I>&gt;<i> what implementation this maps to?   Clearly the Sqrt implementation in Mono
</I>&gt;<i> is 2x as slow (or access through the layers is 2x as slow) as the libc
</I>&gt;<i> implementation.
</I>&gt;<i>
</I>&gt;<i> I do mostly numerical work, so concerned about sqrt as well as other
</I>&gt;<i> fundamental functions in this regard.   Are these custom implementations in
</I>&gt;<i> assembler for each arch?    Would it be reasonable to try to map these to
</I>&gt;<i> the existing libc library when available?
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Jonathan Shore
</I>&gt;<i> Systematic Trading Group
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20101004/f43bc105/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20101004/f43bc105/attachment.html</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="045836.html">[Mono-list] numerical performance comparison [C++ vs JVM vs Mono]
</A></li>
	<LI>Next message: <A HREF="045839.html">[Mono-list] Command Line Options on Windows and Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45838">[ date ]</a>
              <a href="thread.html#45838">[ thread ]</a>
              <a href="subject.html#45838">[ subject ]</a>
              <a href="author.html#45838">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
