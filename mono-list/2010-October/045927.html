<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Problem with DateTime class from C code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Problem%20with%20DateTime%20class%20from%20C%20code&In-Reply-To=i9u862%248ub%241%40dough.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="045926.html">
   <LINK REL="Next"  HREF="045929.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Problem with DateTime class from C code</H1>
    <B>Fede</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Problem%20with%20DateTime%20class%20from%20C%20code&In-Reply-To=i9u862%248ub%241%40dough.gmane.org"
       TITLE="[Mono-list] Problem with DateTime class from C code">federico.omoto at gmail.com
       </A><BR>
    <I>Sat Oct 23 13:18:13 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="045926.html">[Mono-list] Problem with DateTime class from C code
</A></li>
        <LI>Next message: <A HREF="045929.html">[Mono-list] Problem with DateTime class from C code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45927">[ date ]</a>
              <a href="thread.html#45927">[ thread ]</a>
              <a href="subject.html#45927">[ subject ]</a>
              <a href="author.html#45927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Robert, thank you for your answer!

I've tried calling the default ctor using mono_runtime_object_init() on the
DateTime instance but I get an assertion:

ERROR:object.c:95:mono_runtime_object_init: assertion failed: (method)
Stacktrace:


Native stacktrace:

    /usr/lib64/libmono.so.0() [0x370d6a1e5a]
    /lib64/libpthread.so.0() [0x383ea0f440]
    /lib64/libc.so.6(gsignal+0x35) [0x383e2329a5]
    /lib64/libc.so.6(abort+0x175) [0x383e234185]
    /lib64/libglib-2.0.so.0(g_assertion_message+0x144) [0x383fe61ea4]
    /lib64/libglib-2.0.so.0() [0x383fe62450]
    /usr/lib64/libmono.so.0(mono_object_get_virtual_method+0) [0x370d770cc0]
    ./test-invoke() [0x401edc]
    /lib64/libc.so.6(__libc_start_main+0xfd) [0x383e21ec5d]
    ./test-datetime() [0x401569]

I've also tried calling the inherited ctor from ValueType on the DateTime
instance but it makes no difference (the ToString method returns: 1/1/0001
12:00:03 AM).

Sorry for not commenting on this in my first email, I had tried that before
without success, so I thought I was doing something wrong or not doing
something (perhaps ValueTypes are special objects and have to do something
more than just calling the default ctor?).


Thank you again and any tips on this are more than welcome :)


Federico Omoto



On Sat, Oct 23, 2010 at 5:59 AM, Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">robertj at gmx.net</A>&gt; wrote:

&gt;<i> On 23.10.2010 07:12, Fede wrote:
</I>&gt;<i> &gt; Hi!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've a problem when instantiating a DateTime class from C code and
</I>&gt;<i> invoking
</I>&gt;<i> &gt; the ToString() method.
</I>&gt;<i> &gt; The code I've is as follows:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; class = mono_class_from_name(mono_get_corlib(), &quot;System&quot;, &quot;DateTime&quot;);
</I>&gt;<i> &gt; object = mono_object_new(domain, class);
</I>&gt;<i> &gt; method = mono_class_get_method_from_name(class, &quot;ToString&quot;, 0);
</I>&gt;<i> &gt; string = (MonoString*)mono_runtime_invoke(method, object, NULL, NULL);
</I>&gt;<i> &gt; printf(&quot;%s\n&quot;, mono_string_to_utf8(string));
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It ouputs: 1/1/0001 12:00:03 AM
</I>&gt;<i> &gt; when the same C# code (Console.WriteLine(new DateTime().ToString()))
</I>&gt;<i> &gt; outputs: 1/1/0001 12:00:00 AM
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What am I doing wrong?
</I>&gt;<i>
</I>&gt;<i> You're not invoking a constructor on the DateTime instance.
</I>&gt;<i> Assuming you want the default ctor, you can invoke it with:
</I>&gt;<i>
</I>&gt;<i> mono_runtime_object_init (object);
</I>&gt;<i>
</I>&gt;<i> Other non-default ctors need to be mono_runtime_invoked like
</I>&gt;<i> any other method.
</I>&gt;<i>
</I>&gt;<i> RObert
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20101023/b5aa32c5/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20101023/b5aa32c5/attachment-0001.html</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="045926.html">[Mono-list] Problem with DateTime class from C code
</A></li>
	<LI>Next message: <A HREF="045929.html">[Mono-list] Problem with DateTime class from C code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45927">[ date ]</a>
              <a href="thread.html#45927">[ thread ]</a>
              <a href="subject.html#45927">[ subject ]</a>
              <a href="author.html#45927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
