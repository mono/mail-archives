<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] numerical performance comparison [C++ vs JVM vs Mono]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20numerical%20performance%20comparison%20%5BC%2B%2B%20vs%20JVM%20vs%0A%20Mono%5D&In-Reply-To=47997FDB-D8B9-49CA-92FF-5A81B0D6EB80%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="045834.html">
   <LINK REL="Next"  HREF="045838.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] numerical performance comparison [C++ vs JVM vs Mono]</H1>
    <B>ted leslie</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20numerical%20performance%20comparison%20%5BC%2B%2B%20vs%20JVM%20vs%0A%20Mono%5D&In-Reply-To=47997FDB-D8B9-49CA-92FF-5A81B0D6EB80%40gmail.com"
       TITLE="[Mono-list] numerical performance comparison [C++ vs JVM vs Mono]">tleslie at tcn.net
       </A><BR>
    <I>Mon Oct  4 13:13:07 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="045834.html">[Mono-list] numerical performance comparison [C++ vs JVM vs Mono]
</A></li>
        <LI>Next message: <A HREF="045838.html">[Mono-list] numerical performance comparison [C++ vs JVM vs	Mono]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45836">[ date ]</a>
              <a href="thread.html#45836">[ thread ]</a>
              <a href="subject.html#45836">[ subject ]</a>
              <a href="author.html#45836">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>i did the exact same thing, and dumped the assembly generated by c and c# on nbody,
in addition to the sqrt issue, which i believe is pre and post a SSEn, where mono isn't as uptodate
on full use of SSEn , the other issue was, mono did a few sets of unnecessary register transfer,
as compared to the assembly generated by C. With these two issues resolved, the 
benchmark would have match on time. I am not even sure mono's older sqrt call was the majority of the diff
in the mark, I believe it was the unnecessary reg. trans.

you will also notice in that bench mark game, many of the C versions (most recent version of given benchmark),
often are not even solutions that can even be compared, I think there is even one that is threaded solution
in the winner, and mono uses single thread. Really, that &quot;game&quot; is way more to do with people making better
and better algos for a given language solution, then it is a comparison of language. Having said that,
it seems to me, given my comparison of the assembly code of a few, that aside from obvious issues of
array boundary checks and so on for safety, the main issue of performance kill (for mono) appears to be
non optimal use of registers, with to much unnecessary transfer/setup. This however is only most noticeable
in these huge loops, with for many people using  mono, isn't an issue. Another issue i noticed is that
in the latest SSE4.? there is 16 registers to use, but I see Mono shuffling within 8 (i think, if i remember
correctly). Oddly enough I didn't see gnu gcc using the available 16 either.

tl

On Mon, 4 Oct 2010 10:43:18 -0400
Jonathan Shore &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">jonathan.shore at gmail.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am looking forward to moving all of my code from Java / C++ to F# / C# in the very near future.   I took the nbody code from the language shootout and ran with 500 million iterations (much more than used in the shootout to provide a fair comparison) on ubuntu server on a core i7 920 box.
</I>&gt;<i> 
</I>&gt;<i> I used:
</I>&gt;<i> 
</I>&gt;<i> - C++ (g++ -O3 with various MMX related flags as done in the shootout)
</I>&gt;<i> - Java 7  -server
</I>&gt;<i> - Mono 2.4.4, compiling with -optimize:+
</I>&gt;<i> 
</I>&gt;<i> I had the following results in seconds:
</I>&gt;<i> 
</I>&gt;<i> 1.  C++: 		98 seconds
</I>&gt;<i> 2.  JVM:		126 seconds,  a 28% performance gap against C++
</I>&gt;<i> 3.  Mono:	191 seconds,  a 50% performance gap with the JVM
</I>&gt;<i> 
</I>&gt;<i> Because the nbody problem uses sqrt for the euclidean distance in each loop, thought that maybe the discrepancy might be more related to the implementation of Sqrt().
</I>&gt;<i> 
</I>&gt;<i> I implemented a (very poor) numerical algorithm as a substitute for the sqrt() function in each implementation to provide an apples-to-apples comparison.    The new numbers became:
</I>&gt;<i> 
</I>&gt;<i> 1.  C++:		517 seconds
</I>&gt;<i> 2.  JVM:		527 seconds
</I>&gt;<i> 3  Mono:		223 seconds (wow, a surprise here)
</I>&gt;<i> 
</I>&gt;<i> I noticed that the Mono runtime libraries use an internal implementation of Sqrt() that seems to resolve to an Op Code.   I am wondering, ultimately, what implementation this maps to?   Clearly the Sqrt implementation in Mono is 2x as slow (or access through the layers is 2x as slow) as the libc implementation.   
</I>&gt;<i> 
</I>&gt;<i> I do mostly numerical work, so concerned about sqrt as well as other fundamental functions in this regard.   Are these custom implementations in assembler for each arch?    Would it be reasonable to try to map these to the existing libc library when available?
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Jonathan Shore
</I>&gt;<i> Systematic Trading Group
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>

-- 
ted leslie &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">tleslie at tcn.net</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="045834.html">[Mono-list] numerical performance comparison [C++ vs JVM vs Mono]
</A></li>
	<LI>Next message: <A HREF="045838.html">[Mono-list] numerical performance comparison [C++ vs JVM vs	Mono]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45836">[ date ]</a>
              <a href="thread.html#45836">[ thread ]</a>
              <a href="subject.html#45836">[ subject ]</a>
              <a href="author.html#45836">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
