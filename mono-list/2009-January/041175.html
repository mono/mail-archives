<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Memory leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Memory%20leak&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041173.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Memory leak</H1>
    <B>Jon Harrop</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Memory%20leak&In-Reply-To="
       TITLE="[Mono-list] Memory leak">jon at ffconsultancy.com
       </A><BR>
    <I>Sat Jan 31 22:22:02 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041173.html">[Mono-list] IronPython at PyCon 2009
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41175">[ date ]</a>
              <a href="thread.html#41175">[ thread ]</a>
              <a href="subject.html#41175">[ subject ]</a>
              <a href="author.html#41175">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Boehm's documentation about the GC used in Mono says that memory consumption 
is &quot;unbounded&quot;, meaning that the VM may leak indefinitely until the computer 
runs out of memory. Based upon Boehm's description of the problem, I thought 
it would be interesting to try to devise a program that leaks indefinitely 
and I came up with the following (F#):

type 'a cell = { content: 'a; mutable next: 'a cell option }

do
  let mutable tail = None
  if tail = None then
    let cell = { content = [||]; next = None }
    cell.next &lt;- Some cell
    tail &lt;- Some cell
  while true do
    let tail' = Option.get tail
    let cell = Some { content = [|1.;2.;3.;4.|]; next = tail'.next }
    tail'.next &lt;- cell
    tail &lt;- cell
    let tail' = Option.get tail
    tail'.next &lt;- (Option.get tail'.next).next

This code creates a queue represented by a cyclic list and repeatedly adds and 
takes one element at a time (so there are always either 1 or 2 elements in 
the queue). Running on Mono 2.2, this program leaks, consuming all 4Gb of my 
memory in only 60 seconds.

I have rewritten the code in many different forms, using separate functions, 
altering the scopes of variables, making &quot;tail&quot; immutable and Mono 2.2 always 
leaks until the program dies. So it appears that a broad class of programs 
are leaking.

I understand that Mono's new garbage collector has been delayed until Mono 2.9 
but someone else mentioned that even this new GC will still not be accurate 
and, therefore, is likely to leak memory indefinitely as well. Is that 
correct?

-- 
Dr Jon Harrop, Flying Frog Consultancy Ltd.
<A HREF="http://www.ffconsultancy.com/?e">http://www.ffconsultancy.com/?e</A>
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041173.html">[Mono-list] IronPython at PyCon 2009
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41175">[ date ]</a>
              <a href="thread.html#41175">[ thread ]</a>
              <a href="subject.html#41175">[ subject ]</a>
              <a href="author.html#41175">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
