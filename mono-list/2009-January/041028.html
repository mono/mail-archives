<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono and .Net Floating Point Inconsistencies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20and%20.Net%20Floating%20Point%20Inconsistencies&In-Reply-To=21445881.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041018.html">
   <LINK REL="Next"  HREF="041053.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono and .Net Floating Point Inconsistencies</H1>
    <B>russell.kay at realtimeworlds.com</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20and%20.Net%20Floating%20Point%20Inconsistencies&In-Reply-To=21445881.post%40talk.nabble.com"
       TITLE="[Mono-list] Mono and .Net Floating Point Inconsistencies">russell.kay at realtimeworlds.com
       </A><BR>
    <I>Fri Jan 16 11:24:05 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041018.html">[Mono-list] Mono and .Net Floating Point Inconsistencies
</A></li>
        <LI>Next message: <A HREF="041053.html">[Mono-list] Mono and .Net Floating Point Inconsistencies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41028">[ date ]</a>
              <a href="thread.html#41028">[ thread ]</a>
              <a href="subject.html#41028">[ subject ]</a>
              <a href="author.html#41028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If they are running under different architectures[*] then you will
definitely see difference in floating point arithmetic.

i.e. 32 bit x86 code uses the Floating Point Unit to do all the float
and double calculations, 64 bit x64 code uses SIMD to do all the
floating point and double calculations.

This leads to differences across architectures, so if you were checking
mono x86 against mono x86 there should be little that is divergent,
however if you are using .NET x86 against mono x86 there may well be
differences because of libraries that are implemented differently (to
different accuracies).

If you need them all to be the same you would be best to add traces to
the code to track down where things start to diverge and I would suspect
any library functions until you convince yourself that they are not the
source of any problem.

Also some optimisations may well change the ordering of floating point
code which may change the result in subtle ways.

Basically it is a bad idea to rely on absolute accuracy across machines
(even between intel cpus of different generations) in a network
situation, you have to relax the requirement for accuracy and go for
something that &quot;is good enough&quot;.

Game programmers have been living with this for quite some time now.

Russell

[*] You will also see differences with CPUs from different manufacturers
(intel or amd) and with CPUs of different generations (Pentium4 agains
Core2Duo).

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] On Behalf Of ddambro
Sent: 13 January 2009 22:29
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
Subject: Re: [Mono-list] Mono and .Net Floating Point Inconsistencies




kuse wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ddambro wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I have a floating point heavy simulation written in C# that I am
</I>&gt;&gt;<i> interested in running in Linux.  The simulator runs fine in mono, but
</I>&gt;&gt;<i> I've noticed that when I take the same binary and run it with the
</I>same
&gt;&gt;<i> inputs it produces different outputs if it is run on mono and .Net.
</I>From
&gt;&gt;<i> I can tell, these inconsistencies are the result of slight
</I>differences in
&gt;&gt;<i> the floating point calculations.  It is important to my experiments
</I>that
&gt;&gt;<i> an arbitrary machine (running .Net or mono) can reproduce the same
</I>&gt;&gt;<i> results as another arbitrary machine.  Thus, I am curious as to if
</I>this
&gt;&gt;<i> is a known issue and if there is any way to force .Net and mono to
</I>&gt;&gt;<i> produce the same output with respect to floating point calculations.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> David
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Provide a simple test case so other people can test it and try to find
</I>&gt;<i> whats causing this.
</I>&gt;<i> 
</I>&gt;<i> 
</I>
Unfortunately, the program in question is fairly large, complex, and
multi-threaded, so it's difficult to pinpoint the exact section of code
where the two begin to diverge.  I'll keep looking and will certainly
post
an example if I find one.  For now though, are there any known
conditions
that cause these inconsistencies?  I make use of many functions in
System.Math, and do some double to float casting, could either of these
lead
to my problems?
-- 
View this message in context:
<A HREF="http://www.nabble.com/Mono-and-.Net-Floating-Point-Inconsistencies-tp214">http://www.nabble.com/Mono-and-.Net-Floating-Point-Inconsistencies-tp214</A>
28695p21445881.html
Sent from the Mono - General mailing list archive at Nabble.com.

_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>

____________________________________________________________________
This email has been scanned by the MessageLabs Email Security System

____________________________________________________________________
DISCLAIMER

This message and any attachments contain privileged and confidential information intended for the use of the addressee named above. If you are not the intended recipient of this message, you are hereby notified that any use, dissemination, distribution or reproduction of this message is prohibited. Please note that we cannot guarantee that this message or any attachment is virus free or that it has not been intercepted and amended. The views of the author may not necessarily reflect those of Realtime Worlds Ltd.

 

Realtime Worlds Ltd is registered in Scotland, number 225628. Registered Office: 152 West Marketgait, Dundee, DD1 1NJ.
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041018.html">[Mono-list] Mono and .Net Floating Point Inconsistencies
</A></li>
	<LI>Next message: <A HREF="041053.html">[Mono-list] Mono and .Net Floating Point Inconsistencies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41028">[ date ]</a>
              <a href="thread.html#41028">[ thread ]</a>
              <a href="subject.html#41028">[ subject ]</a>
              <a href="author.html#41028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
