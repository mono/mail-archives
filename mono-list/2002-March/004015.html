<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] FileStream weirdness
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:dihlewis%40yahoo.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <LINK REL="Previous"  HREF="004011.html">
   <LINK REL="Next"  HREF="004023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] FileStream weirdness
   </H1>
    <B>Dan Lewis
    </B> 
    <A HREF="mailto:dihlewis%40yahoo.co.uk"
       TITLE="[Mono-list] FileStream weirdness">dihlewis@yahoo.co.uk
       </A><BR>
    <I>Mon, 11 Mar 2002 16:28:51 +0000 (GMT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="004011.html">[Mono-list] control flow graph support in monograph
</A></li>
        <LI> Next message: <A HREF="004023.html">[Mono-list] Re: LCC and CIL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4015">[ date ]</a>
              <a href="thread.html#4015">[ thread ]</a>
              <a href="subject.html#4015">[ subject ]</a>
              <a href="author.html#4015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--0-79791208-1015864131=:57944
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Content-Disposition: inline

Hi all,

I added buffering to the System.IO.FileStream class, and I'm trying write some
decent tests for it at the moment. The program below creates a 64k random data
file, then uses FileStream to read it. It throws a load of random seeks and
contiguous/discontiguous reads at the stream.

When you run it using the Microsoft VM, it will first create a data file called
test.dat. Here's portion of an od dump from that file:

  od -Ax -tx1 test.dat

  009110 2d e0 24 a5 71 01 99 c4 1d f1 66 8a dd d8 f1 1d
  009120 e9 46 67 20 79 98 72 e8 ec 11 63 e1 4d 91 b3 d2

In particular note that starting at 0x9115, we have 01 99 c4 ...

If you run the program, it will seek to that address and dump 100 bytes:

  fstest.exe

  Seeking to 0x9115
  Position is now 9115
  Read 100 bytes:
  01 99 c4 1d f1 66 8a ...

So far so good. Now try running with the --confuse option, which does some
random seeks and reads beforehand:

  fstest.exe --confuse

  Seeking to 0x9115
  Position is now 9115
  Read 100 bytes:
  0e a5 22 da 56 4d 86 ...

Not the answer I was expecting. I really need a second pair of eyes to look at
this program -- is it me or is this an MS library bug?

Thanks,
  Dan.


__________________________________________________
Do You Yahoo!?
Everything you'll ever need on one web page
from News and Sport to Email and Music Charts
<A HREF="http://uk.my.yahoo.com">http://uk.my.yahoo.com</A>
--0-79791208-1015864131=:57944
Content-Type: application/octet-stream; name=&quot;fstest.cs&quot;
Content-Transfer-Encoding: base64
Content-Description: fstest.cs
Content-Disposition: attachment; filename=&quot;fstest.cs&quot;

dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLklPOw0KDQpwdWJsaWMgY2xh
c3MgRmlsZVN0cmVhbVRlc3Qgew0KCXB1YmxpYyBzdGF0aWMgdm9pZCBNYWlu
IChzdHJpbmcgW10gYXJncykgew0KCQlkYXRhID0gbmV3IGJ5dGUgWzY1NTM2
XTsNCgkJYnVmID0gbmV3IGJ5dGUgW2RhdGEuTGVuZ3RoXTsNCg0KCQkvLyBn
ZW5lcmF0ZSBkYXRhDQoNCgkJcm5kID0gbmV3IFJhbmRvbSAoMTIzNDUpOw0K
CQlybmQuTmV4dEJ5dGVzIChkYXRhKTsNCgkNCgkJc3RyaW5nIGZpbGVuYW1l
ID0gInRlc3QuZGF0IjsNCg0KCQkvLyB3cml0ZSBkYXRhIHRvIGZpbGUNCg0K
CQlmaWxlID0gbmV3IEZpbGVTdHJlYW0gKGZpbGVuYW1lLCBGaWxlTW9kZS5D
cmVhdGUpOw0KCQlmaWxlLldyaXRlIChkYXRhLCAwLCBkYXRhLkxlbmd0aCk7
DQoJCWZpbGUuRmx1c2ggKCk7DQoJCWZpbGUuQ2xvc2UgKCk7DQoNCgkJLy8g
cmVhZCBmaWxlDQoNCgkJZmlsZSA9IG5ldyBGaWxlU3RyZWFtIChmaWxlbmFt
ZSwgRmlsZU1vZGUuT3BlbiwgRmlsZUFjY2Vzcy5SZWFkKTsNCg0KCQlpZiAo
YXJncy5MZW5ndGggPiAwICYmIGFyZ3MgWzBdID09ICItLWNvbmZ1c2UiKQ0K
CQkJQ29uZnVzZSAoKTsNCg0KCQlDb25zb2xlLldyaXRlTGluZSAoIlNlZWtp
bmcgdG8gMHg5MTE1Iik7DQoJCWZpbGUuU2VlayAoMHg5MTE1LCBTZWVrT3Jp
Z2luLkJlZ2luKTsNCgkJQ29uc29sZS5Xcml0ZUxpbmUgKCJQb3NpdGlvbiBp
cyBub3cgezA6eDJ9IiwgZmlsZS5Qb3NpdGlvbik7DQoNCgkJaW50IG4gPSBm
aWxlLlJlYWQgKGJ1ZiwgMCwgMTAwKTsNCgkJQ29uc29sZS5Xcml0ZUxpbmUg
KCJSZWFkIHswfSBieXRlczoiLCBuKTsNCgkJZm9yIChpbnQgayA9IDA7IGsg
PCAxMDA7ICsrIGspDQoJCQlDb25zb2xlLldyaXRlICgiezA6eDJ9ICIsIGJ1
ZiBba10pOw0KCQkNCgkJQ29uc29sZS5Xcml0ZUxpbmUgKCk7DQoJCWZpbGUu
Q2xvc2UgKCk7DQoJfQ0KDQoJcHJpdmF0ZSBzdGF0aWMgRmlsZVN0cmVhbSBm
aWxlOw0KCXByaXZhdGUgc3RhdGljIGJ5dGUgW10gYnVmLCBkYXRhOw0KCXBy
aXZhdGUgc3RhdGljIFJhbmRvbSBybmQ7DQoNCglwcml2YXRlIHN0YXRpYyB2
b2lkIENvbmZ1c2UgKCkgew0KCQlmb3IgKGludCBpID0gMDsgaSA8IDk3OyAr
KyBpKSB7DQoJCQlpbnQgYmxvY2tzID0gcm5kLk5leHQgKDEsIDUpOw0KDQoJ
CQkvLyBwb3NzaWJseSBzZWVrDQoNCgkJCWludCBzdGFydDsNCgkJCWlmIChy
bmQuTmV4dCAoMTAwKSA+IDYwKSB7DQoJCQkJc3RhcnQgPSBybmQuTmV4dCAo
KGludCkgZmlsZS5MZW5ndGgpOw0KCQkJCWZpbGUuU2VlayAoc3RhcnQsIFNl
ZWtPcmlnaW4uQmVnaW4pOw0KCQkJCUNvbnNvbGUuV3JpdGVMaW5lICgiU2Vl
a2luZyB0byB7MH0uIiwgc3RhcnQpOw0KCQkJfQ0KDQoJCQlzdGFydCA9IChp
bnQpZmlsZS5Qb3NpdGlvbjsNCg0KCQkJLy8gcmVhZCBmcm9tIGZpbGUNCgkJ
CQ0KCQkJQ29uc29sZS5Xcml0ZUxpbmUgKCJ7Mn06IFJlYWRpbmcgezB9IGJs
b2NrcyBhdCB7MTp4NH0uIiwgYmxvY2tzLCBzdGFydCwgaSk7DQoJCQlpbnQg
Y29waWVkID0gMDsNCgkJCWZvciAoaW50IGogPSAwOyBqIDwgYmxvY2tzOyAr
KyBqKSB7DQoJCQkJaW50IGNvdW50ID0gcm5kLk5leHQgKDUxMik7DQoJCQkJ
Y29waWVkICs9IGZpbGUuUmVhZCAoYnVmLCBjb3BpZWQsIGNvdW50KTsNCgkJ
CX0NCg0KCQkJLy8gY2hlY2sgYWdhaW5zdCBkYXRhDQoNCgkJCWZvciAoaW50
IGogPSAwOyBqIDwgY29waWVkOyArKyBqKSB7DQoJCQkJaWYgKGJ1ZiBbal0g
IT0gZGF0YSBbc3RhcnQgKyBqXSkNCgkJCQkJQ29uc29sZS5Xcml0ZUxpbmUg
KCJNaXNtYXRjaCBhdCB7MDp4NH06IHsxOngyfSAhPSB7Mjp4Mn0uIiwgc3Rh
cnQgKyBqLCBidWYgW2pdLCBkYXRhIFtzdGFydCArIGpdKTsNCgkJCX0NCgkJ
fQ0KCX0NCn0NCg==

--0-79791208-1015864131=:57944--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="004011.html">[Mono-list] control flow graph support in monograph
</A></li>
	<LI> Next message: <A HREF="004023.html">[Mono-list] Re: LCC and CIL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4015">[ date ]</a>
              <a href="thread.html#4015">[ thread ]</a>
              <a href="subject.html#4015">[ subject ]</a>
              <a href="author.html#4015">[ author ]</a>
         </LI>
       </UL>
</body></html>
