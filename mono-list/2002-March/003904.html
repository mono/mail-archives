<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mcs compiles on linux. Now what?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003890.html">
   <LINK REL="Next"  HREF="003914.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mcs compiles on linux. Now what?
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] mcs compiles on linux. Now what?">lupus@ximian.com
       </A><BR>
    <I>Fri, 8 Mar 2002 16:06:07 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="003890.html">[Mono-list] mcs compiles on linux. Now what?
</A></li>
        <LI> Next message: <A HREF="003914.html">[Mono-list] mcs compiles on linux. Now what?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3904">[ date ]</a>
              <a href="thread.html#3904">[ thread ]</a>
              <a href="subject.html#3904">[ subject ]</a>
              <a href="author.html#3904">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/08/02 Dan Lewis wrote:
&gt;<i> Is there any way to find out how much of this is spent in the lexer? MCS uses a
</I>&gt;<i> custom lexer, and in particular uses a hashtable lookup to recognize keywords.
</I>&gt;<i> 
</I>&gt;<i> String.GetHashCode() is computed in C# at the moment. It should definitely have
</I>&gt;<i> an icall (btw I'm not saying that icalls are the way to make things faster --
</I>&gt;<i> but it's such a fundamental operation). Also it is not cached, although strings
</I>&gt;<i> are supposed to be immutable, right? Perhaps change it to:
</I>&gt;<i> 
</I>&gt;<i>   public override int GetHashCode () {
</I>&gt;<i>           if (!is_hashed) {
</I>&gt;<i>                   // compute hash_code
</I>&gt;<i>                   is_hashed = true;
</I>&gt;<i>           }
</I>&gt;<i> 
</I>&gt;<i>           return hash_code;
</I>&gt;<i>   }
</I>&gt;<i> 
</I>&gt;<i> This may/may not make any difference. As ever, profiling's your best weapon :)
</I>
String.GetHashCode() accounts for 1.3% of the total time spent compiling,
so its not an obvious candidate for optimizations:-)

Here is some relevant data:
Method name                                           Total (ms)  Calls
Mono.CSharp.Driver::ProcessFile(1)                    214055      28
Mono.CSharp.Driver::parse(1)                          214051      28
Mono.CSharp.CSharpParser::parse(0)                    214008      28
Mono.CSharp.CSharpParser::yyparse(1)                  214007      28
Mono.CSharp.Tokenizer::token(0)                       163886  161657
Mono.CSharp.Tokenizer::xtoken(0)                      163273  161657
Mono.CSharp.Tokenizer::peekChar(0)                     25279  888884
Mono.CSharp.Tokenizer::is_number(1)                    24166   19362
Mono.CSharp.Tokenizer::getChar(0)                      17076  888825
Mono.CSharp.Tokenizer::decimal_digits(1)               13687   19335
Mono.CSharp.Tokenizer::is_punct(2)                      7934  290123
Mono.CSharp.Tokenizer::advance(0)                       4676  161685
Mono.CSharp.Tokenizer::is_keyword(1)                    4247   56199
Mono.CSharp.Tokenizer::handle_preprocessing_directive(0)    2216     410
Mono.CSharp.Tokenizer::get_cmd_arg(2)                   2081     410
Mono.CSharp.Tokenizer::is_identifier_part_character(1)    1960  355818
Mono.CSharp.Tokenizer::escape(1)                        1544   49420
Mono.CSharp.Tokenizer::adjust_int(1)                    1430   19327
Mono.CSharp.Tokenizer::GetKeyword(1)                     980   16811

System.Text.StringBuilder::Append(1)                   77733  453475
System.Char::IsLetter(1)                                1400  734049
System.Char::IsDigit(1)                                  731  444015

So it looks like StringBuilder::Append() gets a huge chunk and next to
it are IO functions and many small functions that add up. I'd need to
add call graph info to have more precise data, but this should give an
idea.

&gt;<i> In general custom lexers are slower than machine generated ones. I did some
</I>&gt;<i> work a long time ago on porting a fast lexer generator to C# -- I could dig it
</I>&gt;<i> up if there's need for it.
</I>
This is miguel's call.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003890.html">[Mono-list] mcs compiles on linux. Now what?
</A></li>
	<LI> Next message: <A HREF="003914.html">[Mono-list] mcs compiles on linux. Now what?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3904">[ date ]</a>
              <a href="thread.html#3904">[ thread ]</a>
              <a href="subject.html#3904">[ subject ]</a>
              <a href="author.html#3904">[ author ]</a>
         </LI>
       </UL>
</body></html>
