<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] patch for monodis
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:ndrochak%40gol.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003850.html">
   <LINK REL="Next"  HREF="003855.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] patch for monodis
   </H1>
    <B>Nick Drochak
    </B> 
    <A HREF="mailto:ndrochak%40gol.com"
       TITLE="[Mono-list] patch for monodis">ndrochak@gol.com
       </A><BR>
    <I>08 Mar 2002 00:12:09 +0900</I>
    <P><UL>
        <LI> Previous message: <A HREF="003850.html">[Mono-list] ODBC Access
</A></li>
        <LI> Next message: <A HREF="003855.html">[Mono-list] patch for monodis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3844">[ date ]</a>
              <a href="thread.html#3844">[ thread ]</a>
              <a href="subject.html#3844">[ subject ]</a>
              <a href="author.html#3844">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's a patch for monodis.  It adds a new option, --mscorlib that makes
monodis behave as it used to.  That is, putting &quot;mscorlib&quot; in for the
assembly name of any assembly not named &quot;corlib&quot;.

Without the new switch, monodis just puts the assembly name, whatever it
happens to be.

If these changes are ok, I can commit.

Nick D.

Index: get.c
===================================================================
RCS file: /cvs/public/mono/mono/dis/get.c,v
retrieving revision 1.33
diff -u -r1.33 get.c
--- get.c	2002/02/18 11:02:20	1.33
+++ get.c	2002/03/07 11:16:34
@@ -17,6 +17,8 @@
 #include &quot;get.h&quot;
 #include &lt;mono/metadata/class.h&gt;
 
+extern gboolean substitute_with_mscorlib_p;
+
 char *
 get_typedef (MonoImage *m, int idx)
 {
@@ -507,7 +509,7 @@
 		return g_strdup (&quot;Unknown&quot;);
 	if (m != c-&gt;image) {
 		/* we cheat */
-		if (!strcmp (&quot;corlib&quot;, c-&gt;image-&gt;assembly_name))
+		if (substitute_with_mscorlib_p &amp;&amp; !strcmp (&quot;corlib&quot;,
c-&gt;image-&gt;assembly_name))
 			assemblyref = g_strdup_printf (&quot;[%s]&quot;, &quot;mscorlib&quot;);
 		else
 			assemblyref = g_strdup_printf (&quot;[%s]&quot;, c-&gt;image-&gt;assembly_name);
Index: main.c
===================================================================
RCS file: /cvs/public/mono/mono/dis/main.c,v
retrieving revision 1.54
diff -u -r1.54 main.c
--- main.c	2002/03/05 13:27:52	1.54
+++ main.c	2002/03/07 11:16:35
@@ -30,6 +30,8 @@
 /* True if you want to get a dump of the header data */
 gboolean dump_header_data_p = FALSE;
 
+gboolean substitute_with_mscorlib_p = FALSE;
+
 int dump_table = -1;
 
 static void
@@ -854,7 +856,7 @@
 static void
 usage (void)
 {
-	GString *args = g_string_new (&quot;[--help] &quot;);
+	GString *args = g_string_new (&quot;[--help] [--mscorlib] &quot;);
 	int i;
 	
 	for (i = 0; table_list [i].name != NULL; i++){
@@ -882,6 +884,10 @@
 				usage ();
 			else if (argv [i][1] == 'd')
 				dump_header_data_p = TRUE;
+			else if (strcmp (argv [i], &quot;--mscorlib&quot;) == 0) {
+				substitute_with_mscorlib_p = TRUE;
+				i++;
+			}
 			else if (strcmp (argv [i], &quot;--help&quot;) == 0)
 				usage ();
 			for (j = 0; table_list [j].name != NULL; j++) {




</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003850.html">[Mono-list] ODBC Access
</A></li>
	<LI> Next message: <A HREF="003855.html">[Mono-list] patch for monodis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3844">[ date ]</a>
              <a href="thread.html#3844">[ thread ]</a>
              <a href="subject.html#3844">[ subject ]</a>
              <a href="author.html#3844">[ author ]</a>
         </LI>
       </UL>
</body></html>
