<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Array.cs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003812.html">
   <LINK REL="Next"  HREF="003798.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Array.cs
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Array.cs">lupus@ximian.com
       </A><BR>
    <I>Wed, 6 Mar 2002 12:09:42 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="003812.html">[Mono-list] Re: Embedded Mono queries
</A></li>
        <LI> Next message: <A HREF="003798.html">[Mono-list] Array.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3792">[ date ]</a>
              <a href="thread.html#3792">[ thread ]</a>
              <a href="subject.html#3792">[ subject ]</a>
              <a href="author.html#3792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/06/02 Martin Baulig wrote:
&gt;<i> &gt; Can you post some info about what kind of changes to the array code
</I>&gt;<i> &gt; you want to do?
</I>&gt;<i> 
</I>&gt;<i> well, several things which are now all in CVS:
</I>
My reason for asking information was to see the changes _before_ they
went in cvs. I hope I don't sound like a prick, but any change to
fundamental classes most likely bites me before anyone else, because I
routinely run the most complex C# app (mcs) with our class library.
Excuse me if I'm a little paranoid with changes to Array.
And while a simple bug added may not appear in the test suite or
may be lost in the noise of hundreds of errors, it is likely to show up
when running large or complex programs (ie I can't compile).

One problem is that the test suite needs to be changed to be more
fine-grained: a single test method contains many subtests and if the
first fails, the others are not run. This needs to be fixed.

&gt;<i> 2.) Rewrote the Array:Copy implementation so that it can now copy multi-
</I>&gt;<i>     dimensional arrays.
</I>&gt;<i> 
</I>&gt;<i>     I'm also planning to implement this directly in C so that it can use
</I>&gt;<i>     memcpy() whenever possible.
</I>
See icall.c:ves_icall_System_Array_FastCopy().

&gt;<i> 6.) Made sure that all tests in the test suite pass.
</I>
Several Array test fail for me here after updating to cvs (though they
likely failed before as well).

I haven't checked the other stuff, but this chunk got my attention
instantly:

&gt;<i> RCS file: /cvs/public/mcs/class/corlib/System/Array.cs,v
</I>&gt;<i> retrieving revision 1.20
</I>&gt;<i> retrieving revision 1.21
</I>&gt;<i> diff -u -d -r1.20 -r1.21
</I>&gt;<i> @@ -602,7 +646,7 @@
</I>&gt;<i>  			// but that's how the microsoft runtime does it.
</I>&gt;<i>  			if (this.Rank &gt; 1)
</I>&gt;<i>  				throw new RankException ();
</I>&gt;<i> -			if (index + this.GetLength(0) &gt; array.GetLength(0))
</I>&gt;<i> +			if (index &gt;= array.GetLength(0))
</I>&gt;<i>  				throw new ArgumentException ();
</I>&gt;<i>  			if (array.Rank &gt; 1)
</I>&gt;<i>  				throw new RankException ();
</I>
This is in Array.CopyTo (). Here is the history of this line in the last
few changes:

1.19         (martin   01-Mar-02): 			if (index &gt;= array.GetLength(0))
1.20         (lupus    04-Mar-02): 			if (index + this.GetLength(0) &gt; array.GetLength(0))
1.21         (martin   05-Mar-02): 			if (index &gt;= array.GetLength(0))

I.e. I changed that line a couple of days ago, because it broke the
compiler and you changed it back (broking the compiler again).
Please, tell me what test case your change fixes that mine wouldn't.
Here is the test that your change breaks, instead.

using System;

namespace Test {
        public class Test {
                public static int Main () {
                        int[] src = new int [0];
                        int[] dest = new int [0];
                        src.CopyTo (dest, 0);
                        return 0;
                }
        }
}

Thanks,
lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003812.html">[Mono-list] Re: Embedded Mono queries
</A></li>
	<LI> Next message: <A HREF="003798.html">[Mono-list] Array.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3792">[ date ]</a>
              <a href="thread.html#3792">[ thread ]</a>
              <a href="subject.html#3792">[ subject ]</a>
              <a href="author.html#3792">[ author ]</a>
         </LI>
       </UL>
</body></html>
