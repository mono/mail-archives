<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mcs compiles on linux. Now what?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:serge%40wildwestsoftware.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003946.html">
   <LINK REL="Next"  HREF="003873.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mcs compiles on linux. Now what?
   </H1>
    <B>Serge
    </B> 
    <A HREF="mailto:serge%40wildwestsoftware.com"
       TITLE="[Mono-list] mcs compiles on linux. Now what?">serge@wildwestsoftware.com
       </A><BR>
    <I>Fri, 8 Mar 2002 14:36:34 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="003946.html">[Mono-list] mcs compiles on linux. Now what?
</A></li>
        <LI> Next message: <A HREF="003873.html">[Mono-list] Hello from HDNUG! Call for speakers/members
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3893">[ date ]</a>
              <a href="thread.html#3893">[ thread ]</a>
              <a href="subject.html#3893">[ subject ]</a>
              <a href="author.html#3893">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I forgot to post this to the list last night.
There is a small bug in Hashtable that has some major consequences.
In some cases it allocates much more memory than expected, for example
resizing to 1115 will allocate 240101 slots, supposed to be 1237.
In other cases it allocates significantly less memory,
resizing to 400000 will allocate 400009, expected 540217.
Surely has some influence on memory usage ;-)
The fix is below.

Sergey


Index: Hashtable.cs
===================================================================
RCS file: /cvs/public/mcs/class/corlib/System.Collections/Hashtable.cs,v
retrieving revision 1.10
diff -u -r1.10 Hashtable.cs
--- Hashtable.cs 2002/02/07 17:33:38 1.10
+++ Hashtable.cs 2002/03/07 18:20:12
@@ -676,7 +676,7 @@

   private static int ToPrime (int x)
   {
-   for (int i = x/ALLOC_GRAIN; i &lt; primeTbl.Length; i++) {
+   for (int i = 0; i &lt; primeTbl.Length; i++) {
     if (x &lt;= primeTbl [i])
      return primeTbl [i];
    }








</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003946.html">[Mono-list] mcs compiles on linux. Now what?
</A></li>
	<LI> Next message: <A HREF="003873.html">[Mono-list] Hello from HDNUG! Call for speakers/members
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3893">[ date ]</a>
              <a href="thread.html#3893">[ thread ]</a>
              <a href="subject.html#3893">[ subject ]</a>
              <a href="author.html#3893">[ author ]</a>
         </LI>
       </UL>
</body></html>
