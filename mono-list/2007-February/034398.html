<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] screen capturing in mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20screen%20capturing%20in%20mono&In-Reply-To=7d157d580702281127h6895d80fqc4d3d92a848158b4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034397.html">
   <LINK REL="Next"  HREF="034400.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] screen capturing in mono</H1>
    <B>Abe Gillespie</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20screen%20capturing%20in%20mono&In-Reply-To=7d157d580702281127h6895d80fqc4d3d92a848158b4%40mail.gmail.com"
       TITLE="[Mono-list] screen capturing in mono">abe.gillespie at gmail.com
       </A><BR>
    <I>Wed Feb 28 14:57:14 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="034397.html">[Mono-list] screen capturing in mono
</A></li>
        <LI>Next message: <A HREF="034400.html">[Mono-list] screen capturing in mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34398">[ date ]</a>
              <a href="thread.html#34398">[ thread ]</a>
              <a href="subject.html#34398">[ subject ]</a>
              <a href="author.html#34398">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It looks like you're just taking the image and resizing it to show in
the dialog.  You really should not have to go into native OS libraries
to do so.  Does this site help?

<A HREF="http://www.peterprovost.org/archive/2003/05/29/516.aspx">http://www.peterprovost.org/archive/2003/05/29/516.aspx</A>

-Abe

On 2/28/07, Eric Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">eric at rengeo.com</A>&gt; wrote:
&gt;<i> I'm not too sure how to get a Bitmap object from a graphics object.  From
</I>&gt;<i> all I've read, I just hear that you have to deal with device contexts.  I'm
</I>&gt;<i> not too familiar with it, but BitBlt seems to be the way to do that.  What
</I>&gt;<i> would I need to do to get that bitmap created with what appears in the
</I>&gt;<i> control using 100% .NET so it can run in mono?  Here's a snippet of code.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [System.Runtime.InteropServices.DllImportAttribute(&quot;gdi32.dll&quot;)]
</I>&gt;<i>         private static extern bool BitBlt(
</I>&gt;<i>             IntPtr hdcDest, // handle to destination DC
</I>&gt;<i>             int nXDest,  // x-coord of destination upper-left corner
</I>&gt;<i>             int nYDest,  // y-coord of destination upper-left corner
</I>&gt;<i>             int nWidth,  // width of destination rectangle
</I>&gt;<i>             int nHeight, // height of destination rectangle
</I>&gt;<i>             IntPtr hdcSrc,  // handle to source DC
</I>&gt;<i>             int nXSrc,   // x-coordinate of source upper-left corner
</I>&gt;<i>             int nYSrc,   // y-coordinate of source upper-left corner
</I>&gt;<i>             System.Int32 dwRop  // raster operation code
</I>&gt;<i>             );
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         public static Bitmap PerformCapture(Control c, int maxWidth, int
</I>&gt;<i> maxHeight)
</I>&gt;<i>         {
</I>&gt;<i>             try
</I>&gt;<i>             {
</I>&gt;<i>                 int w = c.ClientRectangle.Width;
</I>&gt;<i>                 int h = c.ClientRectangle.Height;
</I>&gt;<i>
</I>&gt;<i>                 w = System.Math.Min(w, maxWidth);
</I>&gt;<i>                 h = System.Math.Min(w, maxHeight);
</I>&gt;<i>
</I>&gt;<i>                 System.Drawing.Graphics g1 =
</I>&gt;<i> c.CreateGraphics();//this.CreateGraphics();
</I>&gt;<i>                 Bitmap MyImage = new Bitmap(w, h, g1);
</I>&gt;<i>                 System.Drawing.Graphics g2 =
</I>&gt;<i> System.Drawing.Graphics.FromImage(MyImage);
</I>&gt;<i>                 IntPtr dc1 = g1.GetHdc();
</I>&gt;<i>                 IntPtr dc2 = g2.GetHdc();
</I>&gt;<i>                 BitBlt(dc2, 0, 0, w, h, dc1, 0, 0, 13369376);
</I>&gt;<i>                 g1.ReleaseHdc(dc1);
</I>&gt;<i>                 g2.ReleaseHdc(dc2);
</I>&gt;<i>
</I>&gt;<i> //Separate dialog to display the image.  If I comment out the BitBlt code,
</I>&gt;<i> it just appears blank.
</I>&gt;<i>                 Library.Windows.Dialogs.ScreenCaptureDlg
</I>&gt;<i> dlg = new
</I>&gt;<i> Library.Windows.Dialogs.ScreenCaptureDlg(MyImage);
</I>&gt;<i>                 dlg.ShowDialog();
</I>&gt;<i>
</I>&gt;<i>                 return MyImage;
</I>&gt;<i>             }
</I>&gt;<i>             catch(Exception error)
</I>&gt;<i>             {
</I>&gt;<i> //our exception handling library.
</I>&gt;<i>                 Library.Common.ErrMsg.Err( error );
</I>&gt;<i>                 throw error;
</I>&gt;<i>
</I>&gt;<i>             }
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 2/28/07, Abe Gillespie &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">abe.gillespie at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Are you P/Invoking for performance?  Why not just use the GDI .Net API?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -Abe
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 2/28/07, Eric Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">eric at rengeo.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; Hi all,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Is there a good way to capture screens or something similar in mono?  In
</I>&gt;<i> our
</I>&gt;<i> &gt; &gt; .NET application, we have custom controls, and we basically create a
</I>&gt;<i> &gt; &gt; graphics object from it, make a new bitmap, then do a bitblt to get it
</I>&gt;<i> into
</I>&gt;<i> &gt; &gt; the bitmap.  This requires a P/Invoke into gdi32.dll , which obviously
</I>&gt;<i> blows
</I>&gt;<i> &gt; &gt; up in mono.  Is there a good way to do this using mono?  Some other
</I>&gt;<i> library
</I>&gt;<i> &gt; &gt; maybe?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I've tried installing wine and using the gdi32.dll.so that comes with
</I>&gt;<i> it,
</I>&gt;<i> &gt; &gt; but I don't know if I'm using it correctly or not.  It can find the
</I>&gt;<i> library,
</I>&gt;<i> &gt; &gt; but it gives a SIGSEGV while trying to execute the bitblt operation.
</I>&gt;<i> Seemed
</I>&gt;<i> &gt; &gt; like kind of a hack, and I didn't really expect it to work...  Do I need
</I>&gt;<i> &gt; &gt; other libraries along with the gdi32.dll.so ?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Any advice is appreciated.  Thanks.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Eric Morgan
</I>&gt;<i> &gt; &gt; Renegade Geophysics
</I>&gt;<i> &gt; &gt; 303-661-0400, x2
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034397.html">[Mono-list] screen capturing in mono
</A></li>
	<LI>Next message: <A HREF="034400.html">[Mono-list] screen capturing in mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34398">[ date ]</a>
              <a href="thread.html#34398">[ thread ]</a>
              <a href="subject.html#34398">[ subject ]</a>
              <a href="author.html#34398">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
