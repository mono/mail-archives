<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: mono-service
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Re%3A%20mono-service&In-Reply-To=53AEF422659DC842BB7E631E27BBF41FCE7AA3%40mailll01.internal.uwic.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029262.html">
   <LINK REL="Next"  HREF="029264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: mono-service</H1>
    <B>Elliott Draper</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Re%3A%20mono-service&In-Reply-To=53AEF422659DC842BB7E631E27BBF41FCE7AA3%40mailll01.internal.uwic.ac.uk"
       TITLE="[Mono-list] Re: mono-service">el at eldiablo.co.uk
       </A><BR>
    <I>Tue Nov  1 11:35:49 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="029262.html">[Mono-list] Re: mono-service
</A></li>
        <LI>Next message: <A HREF="029264.html">[Mono-list] Re: mono-service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29266">[ date ]</a>
              <a href="thread.html#29266">[ thread ]</a>
              <a href="subject.html#29266">[ subject ]</a>
              <a href="author.html#29266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bradley, Peter wrote:

&gt;<i>Sorry Elliott,
</I>&gt;<i>
</I>&gt;<i>I'm not sure what you're saying here.  Given the documentation I quoted, are you saying that under Mono it is necessary to use:
</I>&gt;<i>
</I>&gt;<i>RemotingConfiguration.Configure(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);
</I>&gt;<i>
</I>&gt;<i>if I want to use the same code on both Mono and Windows?
</I>&gt;<i>  
</I>&gt;<i>
</I>I'm not saying it's *necessary*, simply that it seems the easiest and 
most portable solution to me. It's one line of code, and then it should 
work under both Mono and .Net without issue. You can move the service 
around to your heart's content - so long as the &quot;application.exe.config&quot; 
resides in the same directory as the executable, it'll work.

&gt;<i>Or are you saying the documentation is wrong and that a simple absolute path will do the trick - despite what the books say ;) - under both systems?
</I>&gt;<i>  
</I>&gt;<i>
</I>Well I'd hate to go out and say &quot;it's wrong&quot;, but certainly some of the 
advice seems a little funky, and like Rob mentioned in his post, the 
putting of the remoting config into &quot;system32&quot; seems a little weird. 
Could it just be that these are books referring to the .Net framework 
v1.0, and maybe these are things that have been revised in v1.1 perhaps?

&gt;<i>I haven't tried using an absolute path for the app.config file of a Windows service (as opposed to a server or an ordinary executable), for the reasons I gave: but if you're convinced it works then I'll give it a go.
</I>&gt;<i>  
</I>&gt;<i>
</I>I'd give the above line a shot; it's one line of code, where's the harm 
in that? ;-)

&gt;<i>Cheers
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Peter
</I>&gt;<i>  
</I>&gt;<i>
</I>-= El =-

&gt;<i>-----Original Message-----
</I>&gt;<i>From: Elliott Draper [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">el at eldiablo.co.uk</A>] 
</I>&gt;<i>Sent: 01 November 2005 13:49
</I>&gt;<i>To: Bradley, Peter
</I>&gt;<i>Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;<i>Subject: Re: [Mono-list] Re: mono-service
</I>&gt;<i>
</I>&gt;<i>Bradley, Peter wrote:
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>I wonder if I might be forgiven for responding to myself in order to ask one (hopefully final) question about mono-service?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Following the discussion here, I checked out some Windows services I've written and everything seems fine except for one thing.  The services I write are to host remote objects.  As a matter of policy we configure .NET remoting using configuration files.  Therefore host services contain a call to RemotingConfiguration.Configure(&quot;config.file.name&quot;).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Under Windows, the config file must be copied to the WINDOWS\System32 (or WINNT\System32) directory for it to be found by the service.  Where should the config file be located under Mono in order for the daemon to find it?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>You don't have to place the config files in System32 for them to be 
</I>&gt;<i>found, you can give a full path to the call to 
</I>&gt;<i>RemotingConfiguration.Configure. I find the easiest way is to stick your 
</I>&gt;<i>remoting config in with any other configuration you might have within an 
</I>&gt;<i>application configuration file (&quot;$assemblyname.config&quot;). Are you 
</I>&gt;<i>familiar with these? Just in case...
</I>&gt;<i>    If using Visual Studio, you can add a new &quot;Application Configuration 
</I>&gt;<i>file&quot; to your project (app.config), and place all config in there. At 
</I>&gt;<i>compile time, a built-in build event will take care of copying this file 
</I>&gt;<i>to your &quot;bin&quot; directory, and re-naming it &quot;$assemblyname.config&quot;, for 
</I>&gt;<i>example, &quot;myservice.exe.config&quot;.
</I>&gt;<i>    If your not using Visual Studio, then you can manage the config file 
</I>&gt;<i>however you want, however it needs to end up in the same directory as 
</I>&gt;<i>your executable, named the same as your executable but with &quot;.config&quot; on 
</I>&gt;<i>the end, e.g. &quot;myservice.exe.config&quot;. I tend to have an App.config in 
</I>&gt;<i>the root of my executables project, and I get NAnt to copy the file over 
</I>&gt;<i>to my &quot;bin&quot; directory and re-name it at compile time, just like VS.
</I>&gt;<i>
</I>&gt;<i>Either way, once you have your correctly named configuration file 
</I>&gt;<i>residing within the same directory as your executable, your call to 
</I>&gt;<i>RemotingConfiguration.Configure becomes nice and easy:
</I>&gt;<i>
</I>&gt;<i>    
</I>&gt;<i>RemotingConfiguration.Configure(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);
</I>&gt;<i>
</I>&gt;<i>This grabs the full path of the configuration file from the current app 
</I>&gt;<i>domain, and should load your remoting configuration without problems. 
</I>&gt;<i>You can then move the service around without issue, providing that the 
</I>&gt;<i>config file stays with the executable ;-)
</I>&gt;<i>
</I>&gt;<i>AFAIK this works just as well on Mono as it does on .Net.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Thanks for your patience.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Peter
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>Hope that helps!
</I>&gt;<i>
</I>&gt;<i>-= El =-
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>-----Original Message-----
</I>&gt;&gt;<i>From: J&#246;rg Rosenkranz [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">joergr at voelcker.com</A>] 
</I>&gt;&gt;<i>Sent: 01 November 2005 12:52
</I>&gt;&gt;<i>To: Bradley, Peter; Robert Jordan; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;&gt;<i>Subject: RE: [Mono-list] Re: mono-service
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Hi Peter,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>-----Original Message-----
</I>&gt;&gt;&gt;<i>From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A> 
</I>&gt;&gt;&gt;<i>[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] On Behalf Of 
</I>&gt;&gt;&gt;<i>Bradley, Peter
</I>&gt;&gt;&gt;<i>Sent: Tuesday, November 01, 2005 1:26 PM
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>My post was not intended as a criticism of the man page, and I'm very
</I>&gt;&gt;&gt;<i>sorry if it appeared to be so.  Perhaps I should have been 
</I>&gt;&gt;&gt;<i>clearer, but
</I>&gt;&gt;&gt;<i>what I was really saying that what (I think) is needed is a HowTo.
</I>&gt;&gt;&gt;<i>   
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>Yes I think this is true. There needs to be something in the Wiki.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>To answer some of your questions:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Does the process to be run as a daemon have to inherit from
</I>&gt;&gt;&gt;<i>System.ServiceProcess.ServiceBase?  Does it guarantee that the
</I>&gt;&gt;&gt;<i>OnStart(), OnStop(), OnPause(), and OnContinue() methods get called as
</I>&gt;&gt;&gt;<i>appropriate?  
</I>&gt;&gt;&gt;<i>   
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>The service has to be implemented according to the MS docs:
</I>&gt;&gt;<i><A HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclasstopic.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclasstopic.asp</A>
</I>&gt;&gt;<i>and
</I>&gt;&gt;<i><A HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclassruntopic1.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclassruntopic1.asp</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Short: It needs to be inherited from ServiceBase and it needs to call 
</I>&gt;&gt;<i>ServiceBase.Run in it's Main method.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>What does one have to do make the service start 
</I>&gt;&gt;&gt;<i>up at boot
</I>&gt;&gt;&gt;<i>time and run without a user logged in?  (Your script is a 
</I>&gt;&gt;&gt;<i>great help in
</I>&gt;&gt;&gt;<i>that regard.  Thanks).  What user does the service run as?  
</I>&gt;&gt;&gt;<i>   
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>It runs as the user you are starting mono-service with. You
</I>&gt;&gt;<i>are responsible for switching the user in the start script.
</I>&gt;&gt;<i>Examples of start scripts should be in the Wiki/Doc/etc. too.
</I>&gt;&gt;<i>Maybe that's tootoo distribution specific to put it into SVN?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>What changes
</I>&gt;&gt;&gt;<i>(if any) are required to assemblies written as Windows 
</I>&gt;&gt;&gt;<i>services to make
</I>&gt;&gt;&gt;<i>sure they can run as daemons?
</I>&gt;&gt;&gt;<i>   
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>There are no changes needed if the assemblies are written
</I>&gt;&gt;<i>with the normal portability rules in mind. Mono-service 
</I>&gt;&gt;<i>should mimic the behaviour of MS' implementation as close 
</I>&gt;&gt;<i>as possible.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>The OP obviously has trouble getting the OnStart() method 
</I>&gt;&gt;&gt;<i>running.  The
</I>&gt;&gt;&gt;<i>reason why might be contained in the answers to the questions I make
</I>&gt;&gt;&gt;<i>above.
</I>&gt;&gt;&gt;<i>   
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>Yes :-)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>I'm perfectly happy to put my money where my mouth is as far as
</I>&gt;&gt;&gt;<i>producing a HowTo is concerned.  Once I've got a daemon 
</I>&gt;&gt;&gt;<i>running, I'll be
</I>&gt;&gt;&gt;<i>only too happy to explain how it was done.  But I may need my hand
</I>&gt;&gt;&gt;<i>holding a little in the meantime :)
</I>&gt;&gt;&gt;<i>   
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>The man page is very basic and contains only information about 
</I>&gt;&gt;<i>handling of services. There should be an article about implementation
</I>&gt;&gt;<i>of services too. I would be happy if you write a howto down.
</I>&gt;&gt;<i>Please ask if you have any questions.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Joerg.
</I>&gt;&gt;<i>_______________________________________________
</I>&gt;&gt;<i>Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>_______________________________________________
</I>&gt;&gt;<i>Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029262.html">[Mono-list] Re: mono-service
</A></li>
	<LI>Next message: <A HREF="029264.html">[Mono-list] Re: mono-service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29266">[ date ]</a>
              <a href="thread.html#29266">[ thread ]</a>
              <a href="subject.html#29266">[ subject ]</a>
              <a href="author.html#29266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
