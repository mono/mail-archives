<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: mono-service
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Re%3A%20mono-service&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029258.html">
   <LINK REL="Next"  HREF="029263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: mono-service</H1>
    <B>Bradley, Peter</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Re%3A%20mono-service&In-Reply-To="
       TITLE="[Mono-list] Re: mono-service">PBradley at uwic.ac.uk
       </A><BR>
    <I>Tue Nov  1 09:07:59 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="029258.html">[Mono-list] Re: mono-service
</A></li>
        <LI>Next message: <A HREF="029263.html">[Mono-list] Re: mono-service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29261">[ date ]</a>
              <a href="thread.html#29261">[ thread ]</a>
              <a href="subject.html#29261">[ subject ]</a>
              <a href="author.html#29261">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Elliott,

What you say is true for Console servers in Windows and for normal executable assemblies, but not - according to the documentation I have read - for Services.  Here is the relevant quotation from David Conger, &quot;Remoting with C# and .NET&quot;, (2003), Wiley, pp209-210:

&quot;Next, the OnStart() method calls RemotingConfiguration.Configure() to publish the [remote object] ... as a remote object ... The startup directory for any Windows Service is:

&lt;OS drive&gt;:&lt;OS Dir&gt;\system32

Where &lt;OS Drive&gt; and &lt;OS Dir&gt; is the drive letter and directory where your operating system is installed ... The configuration file for remote object servers must be placed in the startup directory for Windows Services.  Therefore, on my computer, I had to put the [application].exe.config file ... in the C:\WINNT\system32 directory.&quot;

Ingo Rammer, &quot;Advanced .NET Remoting in VB.NET&quot;, (2002), Apress, p115 says:

&quot;When using configuration files with Windows services, those files have to be placed in &lt;%WINDIR%&gt;\System32 (normally c:\winnt\system32) to be readable by the application, as this is the service's startup directory.&quot;

Other published sources say the same thing.  Are you sure this is not the case?

In fairness, Rammer does give a way of using the application's installation directory by using code like this:

RemotingConfiguration.Configure(
	AppDomain.CurrentDomain.SetupInformation.ConfigurationFile)

I haven't tried that though, and I'd rather not if I don't have to because I don't understand it :(

Cheers


Peter

-----Original Message-----
From: Elliott Draper [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">el at eldiablo.co.uk</A>] 
Sent: 01 November 2005 13:49
To: Bradley, Peter
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
Subject: Re: [Mono-list] Re: mono-service

Bradley, Peter wrote:

&gt;<i>I wonder if I might be forgiven for responding to myself in order to ask one (hopefully final) question about mono-service?
</I>&gt;<i>
</I>&gt;<i>Following the discussion here, I checked out some Windows services I've written and everything seems fine except for one thing.  The services I write are to host remote objects.  As a matter of policy we configure .NET remoting using configuration files.  Therefore host services contain a call to RemotingConfiguration.Configure(&quot;config.file.name&quot;).
</I>&gt;<i>
</I>&gt;<i>Under Windows, the config file must be copied to the WINDOWS\System32 (or WINNT\System32) directory for it to be found by the service.  Where should the config file be located under Mono in order for the daemon to find it?
</I>&gt;<i>  
</I>&gt;<i>
</I>You don't have to place the config files in System32 for them to be 
found, you can give a full path to the call to 
RemotingConfiguration.Configure. I find the easiest way is to stick your 
remoting config in with any other configuration you might have within an 
application configuration file (&quot;$assemblyname.config&quot;). Are you 
familiar with these? Just in case...
    If using Visual Studio, you can add a new &quot;Application Configuration 
file&quot; to your project (app.config), and place all config in there. At 
compile time, a built-in build event will take care of copying this file 
to your &quot;bin&quot; directory, and re-naming it &quot;$assemblyname.config&quot;, for 
example, &quot;myservice.exe.config&quot;.
    If your not using Visual Studio, then you can manage the config file 
however you want, however it needs to end up in the same directory as 
your executable, named the same as your executable but with &quot;.config&quot; on 
the end, e.g. &quot;myservice.exe.config&quot;. I tend to have an App.config in 
the root of my executables project, and I get NAnt to copy the file over 
to my &quot;bin&quot; directory and re-name it at compile time, just like VS.

Either way, once you have your correctly named configuration file 
residing within the same directory as your executable, your call to 
RemotingConfiguration.Configure becomes nice and easy:

    
RemotingConfiguration.Configure(AppDomain.CurrentDomain.SetupInformation.ConfigurationFile);

This grabs the full path of the configuration file from the current app 
domain, and should load your remoting configuration without problems. 
You can then move the service around without issue, providing that the 
config file stays with the executable ;-)

AFAIK this works just as well on Mono as it does on .Net.

&gt;<i>Thanks for your patience.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Peter
</I>&gt;<i>  
</I>&gt;<i>
</I>Hope that helps!

-= El =-

&gt;<i>
</I>&gt;<i>-----Original Message-----
</I>&gt;<i>From: J&#246;rg Rosenkranz [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">joergr at voelcker.com</A>] 
</I>&gt;<i>Sent: 01 November 2005 12:52
</I>&gt;<i>To: Bradley, Peter; Robert Jordan; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;<i>Subject: RE: [Mono-list] Re: mono-service
</I>&gt;<i>
</I>&gt;<i>Hi Peter,
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>-----Original Message-----
</I>&gt;&gt;<i>From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A> 
</I>&gt;&gt;<i>[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] On Behalf Of 
</I>&gt;&gt;<i>Bradley, Peter
</I>&gt;&gt;<i>Sent: Tuesday, November 01, 2005 1:26 PM
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>My post was not intended as a criticism of the man page, and I'm very
</I>&gt;&gt;<i>sorry if it appeared to be so.  Perhaps I should have been 
</I>&gt;&gt;<i>clearer, but
</I>&gt;&gt;<i>what I was really saying that what (I think) is needed is a HowTo.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Yes I think this is true. There needs to be something in the Wiki.
</I>&gt;<i>
</I>&gt;<i>To answer some of your questions:
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Does the process to be run as a daemon have to inherit from
</I>&gt;&gt;<i>System.ServiceProcess.ServiceBase?  Does it guarantee that the
</I>&gt;&gt;<i>OnStart(), OnStop(), OnPause(), and OnContinue() methods get called as
</I>&gt;&gt;<i>appropriate?  
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>The service has to be implemented according to the MS docs:
</I>&gt;<i><A HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclasstopic.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclasstopic.asp</A>
</I>&gt;<i>and
</I>&gt;<i><A HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclassruntopic1.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemserviceprocessservicebaseclassruntopic1.asp</A>
</I>&gt;<i>
</I>&gt;<i>Short: It needs to be inherited from ServiceBase and it needs to call 
</I>&gt;<i>ServiceBase.Run in it's Main method.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>What does one have to do make the service start 
</I>&gt;&gt;<i>up at boot
</I>&gt;&gt;<i>time and run without a user logged in?  (Your script is a 
</I>&gt;&gt;<i>great help in
</I>&gt;&gt;<i>that regard.  Thanks).  What user does the service run as?  
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>It runs as the user you are starting mono-service with. You
</I>&gt;<i>are responsible for switching the user in the start script.
</I>&gt;<i>Examples of start scripts should be in the Wiki/Doc/etc. too.
</I>&gt;<i>Maybe that's tootoo distribution specific to put it into SVN?
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>What changes
</I>&gt;&gt;<i>(if any) are required to assemblies written as Windows 
</I>&gt;&gt;<i>services to make
</I>&gt;&gt;<i>sure they can run as daemons?
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>There are no changes needed if the assemblies are written
</I>&gt;<i>with the normal portability rules in mind. Mono-service 
</I>&gt;<i>should mimic the behaviour of MS' implementation as close 
</I>&gt;<i>as possible.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>The OP obviously has trouble getting the OnStart() method 
</I>&gt;&gt;<i>running.  The
</I>&gt;&gt;<i>reason why might be contained in the answers to the questions I make
</I>&gt;&gt;<i>above.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Yes :-)
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>I'm perfectly happy to put my money where my mouth is as far as
</I>&gt;&gt;<i>producing a HowTo is concerned.  Once I've got a daemon 
</I>&gt;&gt;<i>running, I'll be
</I>&gt;&gt;<i>only too happy to explain how it was done.  But I may need my hand
</I>&gt;&gt;<i>holding a little in the meantime :)
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>The man page is very basic and contains only information about 
</I>&gt;<i>handling of services. There should be an article about implementation
</I>&gt;<i>of services too. I would be happy if you write a howto down.
</I>&gt;<i>Please ask if you have any questions.
</I>&gt;<i>
</I>&gt;<i>Joerg.
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>  
</I>&gt;<i>
</I>
_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029258.html">[Mono-list] Re: mono-service
</A></li>
	<LI>Next message: <A HREF="029263.html">[Mono-list] Re: mono-service
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29261">[ date ]</a>
              <a href="thread.html#29261">[ thread ]</a>
              <a href="subject.html#29261">[ subject ]</a>
              <a href="author.html#29261">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
