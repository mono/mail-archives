<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] XML deserialization - HELP!!!!!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20XML%20deserialization%20-%20HELP%21%21%21%21%21&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="045207.html">
   <LINK REL="Next"  HREF="045191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] XML deserialization - HELP!!!!!</H1>
    <B>Paul</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20XML%20deserialization%20-%20HELP%21%21%21%21%21&In-Reply-To="
       TITLE="[Mono-list] XML deserialization - HELP!!!!!">paul at all-the-johnsons.co.uk
       </A><BR>
    <I>Mon May 24 18:21:09 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="045207.html">[Mono-list] Building Mono on Windows
</A></li>
        <LI>Next message: <A HREF="045191.html">[Mono-list] Mono.Addins 0.5 released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45186">[ date ]</a>
              <a href="thread.html#45186">[ thread ]</a>
              <a href="subject.html#45186">[ subject ]</a>
              <a href="author.html#45186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

As part of a much larger project, I'm doing a simple proof of concept
work. Basically, the code I have loads in an XML file and generates a
winform on the fly.

The code is at a very early stage, but I've hit a problem. It compiles,
it runs, it just completely fails to load in the XML file (well,
something happens, but not what I'm after which should be a winform
generated based on the XML file.

Current code looks like this

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Windows.Forms;
using System.IO;
using System.Collections;
using System.Xml;
using System.Xml.Serialization;

namespace form_from_xml 
{
    public class xmlhandler : Form
    {
        public void loaddesign()
        {
            FormData f;
            f = null;

            try
            {
                string path_env =
Path.GetDirectoryName(Application.ExecutablePath) +
Path.DirectorySeparatorChar;
                XmlSerializer s = new XmlSerializer(typeof(FormData));
                TextReader r = new StreamReader(path_env +
&quot;designer-test.xml&quot;);
                f = (FormData)s.Deserialize(r);
                r.Close();
            }
            catch (System.IO.FileNotFoundException)
            {
                MessageBox.Show(&quot;Unable to find the form file&quot;, &quot;File
not found&quot;, MessageBoxButtons.OK);
            }
            catch (System.InvalidOperationException e)
            {
                MessageBox.Show(e.ToString(), &quot;Error&quot;,
MessageBoxButtons.OK);
            }
            winformgen wf = new winformgen();
            wf.makeform(f);
		}
    }

    public class winformgen : Form
    {
        public void makeform(FormData f)
        {
            Form form1 = new Form();
            Label label1 = new Label();
            label1.Text = f.elements[0].text;
            label1.Location = new Point(f.elements[0].xpos,
f.elements[0].ypos);
            form1.FormBorderStyle = FormBorderStyle.FixedDialog;
            form1.MaximizeBox = false;
            form1.MinimizeBox = false;
            form1.StartPosition = FormStartPosition.CenterScreen;
            form1.Controls.Add(label1);
            form1.Width = f.elements[0].winxs;
            form1.Height = f.elements[0].winys;
            form1.ShowDialog();
        }
    }

    [XmlRoot(&quot;Forms&quot;)]
    public class FormData
    {
        private ArrayList formData;

        public FormData()
        {
            formData = new ArrayList();
        }


        [XmlElement(&quot;Element&quot;)]
        public Elements[] elements
        {
            get
            {
                Elements[] elements = new Elements[formData.Count];
                formData.CopyTo(elements);
                return elements;
            }
            set
            {
                if (value == null)
                   return;
                Elements[] elements = (Elements[])value;
                formData.Clear();
                foreach (Elements element in elements)
                    formData.Add(element);
            }
        }	    
    }
 
    public class Elements
    {
        [XmlAttribute(&quot;formname&quot;)]
        public string name;
        [XmlAttribute(&quot;winxsize&quot;)]
        public int winxs;
        [XmlAttribute(&quot;winysize&quot;)]
        public int winys;
        [XmlAttribute(&quot;type&quot;)]
        public string type;
        [XmlAttribute(&quot;xpos&quot;)]
        public int xpos;
        [XmlAttribute(&quot;ypos&quot;)]
        public int ypos;
        [XmlAttribute(&quot;externaldata&quot;)]
        public bool external;
        [XmlAttribute(&quot;externalplace&quot;)]
        public string externalplace;
        [XmlAttribute(&quot;text&quot;)]
        public string text;
        [XmlAttribute(&quot;questions&quot;)]
        public bool questions;
        [XmlAttribute(&quot;questiontype&quot;)]
        public string qtype;
        [XmlAttribute(&quot;numberqs&quot;)]
        public int numberqs;
        [XmlAttribute(&quot;answerfile&quot;)]
        public string ansfile;
        [XmlAttribute(&quot;backlink&quot;)]
        public int backlink;
        [XmlAttribute(&quot;forwardlink&quot;)]
        public int forwardlink;

        public Elements()
        {
        }

        public Elements(string fn, int wx, int wy, string t, int x, int
y, bool ext, string extpl, string te, bool q, 
            string qt, int num, string ans, int back, int end)
        {
            name = fn;
            winxs = wx;
            winys = wy;
            type = t;
            xpos = x;
            ypos = y;
            external = ext;
            externalplace = extpl;
            text = te;
            questions = q;
            qtype = qt;
            numberqs = num;
            ansfile = ans;
            backlink = back;
            forwardlink = end;
        }
    }
}

With the XML file

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Forms&gt;
	&lt;Element&gt;
		&lt;formname&gt;Test Window&lt;/formname&gt;
		&lt;winxsize&gt;300&lt;/winxsize&gt;
		&lt;winysize&gt;500&lt;/winysize&gt;
		&lt;type&gt;Label&lt;/type&gt;
		&lt;xpos&gt;100&lt;/xpos&gt;
		&lt;ypos&gt;100&lt;/ypos&gt;
		&lt;externaldata&gt;true&lt;/externaldata&gt;
		&lt;externalplace&gt;none&lt;/externalplace&gt;
		&lt;text&gt;Hello world!&lt;/text&gt;
		&lt;questions&gt;true&lt;/questions&gt;
		&lt;questiontype&gt;none&lt;/questiontype&gt;
		&lt;numberqs&gt;0&lt;/numberqs&gt;
		&lt;answerfile&gt;none&lt;/answerfile&gt;
		&lt;backlink&gt;999&lt;/backlink&gt;
		&lt;forwardlink&gt;999&lt;/forwardlink&gt;
	&lt;/Element&gt;
&lt;/Forms&gt;

(to get it to work, a quick winform button which generates a new
instance of xmlhandler then call the new instance)

I can't for the life of me see why it's not reading in. The only thing I
can think of is that there is a problem in the XML file somewhere...

Any help would be greatly appreciated :-)

TTFN

Paul
-- 
Biggles was quietly reading his favourite book when Algy burst through
the door. Distracted for a moment, Biggles surveyed what had happened
and turned a page. &quot;Algy old man&quot; he said, clearing his throat, &quot;use the
handle next time...&quot; - Taken from &quot;Biggles combs his Hair&quot;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20100524/724b9f4f/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-list/attachments/20100524/724b9f4f/attachment-0001.bin</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="045207.html">[Mono-list] Building Mono on Windows
</A></li>
	<LI>Next message: <A HREF="045191.html">[Mono-list] Mono.Addins 0.5 released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45186">[ date ]</a>
              <a href="thread.html#45186">[ thread ]</a>
              <a href="subject.html#45186">[ subject ]</a>
              <a href="author.html#45186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
