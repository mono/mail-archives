<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono and IO Performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20and%20IO%20Performance&In-Reply-To=1301331257778-3412393.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="046776.html">
   <LINK REL="Next"  HREF="046786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono and IO Performance</H1>
    <B>Gonzalo Paniagua Javier</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20and%20IO%20Performance&In-Reply-To=1301331257778-3412393.post%40n4.nabble.com"
       TITLE="[Mono-list] Mono and IO Performance">gonzalo.mono at gmail.com
       </A><BR>
    <I>Mon Mar 28 23:52:24 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="046776.html">[Mono-list] Mono and IO Performance
</A></li>
        <LI>Next message: <A HREF="046786.html">[Mono-list] Mono and IO Performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46783">[ date ]</a>
              <a href="thread.html#46783">[ thread ]</a>
              <a href="subject.html#46783">[ subject ]</a>
              <a href="author.html#46783">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2011-03-28 at 09:54 -0700, Julien wrote:
&gt;<i> I&#8217;m comparing.Net and mono runtimes for server applications that are socket
</I>&gt;<i> bound. The performance penalty for mono is significant and I would like some
</I>&gt;<i> advice from more experienced users.
</I>&gt;<i> 
</I>&gt;<i> My scenario is the following : 
</I>&gt;<i> I&#8217;m trying to dequeue messages from a socket and dispatch them locally. On
</I>&gt;<i> windows/.net, I can handle between 8k and 9k msg/second in release mode. The
</I>&gt;<i> same application under windows/mono (with&#8212;gc=sgen) handles between 1.5k and
</I>&gt;<i> 3.5K msg/second. Under ubuntu/mono, it handles between 2K and 4k msg/second. 
</I>&gt;<i> 
</I>&gt;<i> In order to find the bottleneck, I did a profiling under linux. Here are the
</I>&gt;<i> GC Summary : 
</I>&gt;<i> 	GC resizes: 0
</I>&gt;<i> 	Max heap size: 0
</I>&gt;<i> 	Object moves: 108499
</I>&gt;<i> 	Gen0 collections: 134, max time: 10185us, total time: 257995us, average:
</I>&gt;<i> 1925us
</I>&gt;<i> 	Gen1 collections: 4, max time: 8366us, total time: 27318us, average: 6829us
</I>&gt;<i> 	GC handles weak: created: 35, destroyed: 0, max: 35
</I>&gt;<i> 	GC handles normal: created: 2, destroyed: 0, max: 2
</I>&gt;<i> 
</I>&gt;<i> And the first few lines of the method call summary, sorted by self :
</I>&gt;<i> 414671   414671      99881 (wrapper managed-to-native)
</I>&gt;<i> System.Threading.Monitor:Monitor_wait (object,int)
</I>&gt;<i>   397184   396993      76558 (wrapper managed-to-native)
</I>&gt;<i> System.IO.InotifyWatcher:ReadFromFD (intptr,byte[],intptr)
</I>&gt;<i>   275720   275720         11 (wrapper managed-to-native)
</I>
The above line means that you are using FileSystemWatcher in your tests.
This is not pure socket IO. Anyway, I'll take a look at that
ReadFromFD() and see if we can reduce memory use or do something to make
it faster.


&gt;<i> System.Net.Sockets.Socket:Receive_internal
</I>&gt;<i> (intptr,byte[],int,int,System.Net.Sockets.SocketFlags,int&amp;)
</I>&gt;<i>   114162   114162         26 (wrapper managed-to-native)
</I>
Why are you not using SocketAsyncEventArgs+ReceiveAsync()? Or at least
socket.BeginReceive...

-Gonzalo


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="046776.html">[Mono-list] Mono and IO Performance
</A></li>
	<LI>Next message: <A HREF="046786.html">[Mono-list] Mono and IO Performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46783">[ date ]</a>
              <a href="thread.html#46783">[ thread ]</a>
              <a href="subject.html#46783">[ subject ]</a>
              <a href="author.html#46783">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
