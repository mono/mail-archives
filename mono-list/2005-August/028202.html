<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono Database Documentation and Examples
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20Database%20Documentation%20and%20Examples&In-Reply-To=20050817204344.41207.qmail%40web34003.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028196.html">
   <LINK REL="Next"  HREF="028209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono Database Documentation and Examples</H1>
    <B>Joe Audette</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20Database%20Documentation%20and%20Examples&In-Reply-To=20050817204344.41207.qmail%40web34003.mail.mud.yahoo.com"
       TITLE="[Mono-list] Mono Database Documentation and Examples">joe_audette at yahoo.com
       </A><BR>
    <I>Wed Aug 17 19:50:44 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="028196.html">[Mono-list] Mono Database Documentation and Examples
</A></li>
        <LI>Next message: <A HREF="028209.html">[Mono-list] Mono Database Documentation and Examples
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28202">[ date ]</a>
              <a href="thread.html#28202">[ thread ]</a>
              <a href="subject.html#28202">[ subject ]</a>
              <a href="author.html#28202">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Daniel,

The code you are seeking is really just C# code
nothing really specific to mono per se.

In my mojoportal web site framework I am supporting MS
SQL, MySQL (using the MySQL Connector for .NET), and
PostgreSQL (using npgsql) and have plenty of good code
I'd be happy to share. You can download the source at
<A HREF="http://forge.novell.com/modules/xfmod/project/?mojoportal">http://forge.novell.com/modules/xfmod/project/?mojoportal</A>
and find out more about the project at
<A HREF="http://mojoportal.com">http://mojoportal.com</A> 

Each layer has a helper class that simplifies the
standard ADO.NET code, ie SQLHelper, MySQLHelper
npgSQLHelper

The npgSqlHelper class was written by Joseph Hill for
mojoportal, I suggested he push it upstream to the
npgsql project but not sure whether he did, I'm not
using the very newest npgsql code yet.

Here is sample CRUD code for npgsl using the helper
class and stored procedures

public static int Role_Create(
			int SiteID,
			string RoleName)
		{
			NpgsqlConnection Connection = GetConnection();
			NpgsqlParameter[] arParams = new
NpgsqlParameter[2];
		
if(ConfigurationSettings.AppSettings.Get(&quot;CachePostgreSQLParameters&quot;).ToLower()
 == &quot;true&quot;)
			{
				arParams =
NpgsqlHelperParameterCache.GetSpParameterSet(ConfigurationSettings.AppSettings.Get(&quot;PostgreSQLConnectionString&quot;),
					&quot;mp_roles_insert(:siteid,:rolename)&quot;);

				arParams[0].Value = SiteID;
				arParams[1].Value = RoleName;
			}
			else
			{
				arParams[0] = new NpgsqlParameter(&quot;siteid&quot;,
NpgsqlTypes.NpgsqlDbType.Integer);
				arParams[0].Direction = ParameterDirection.Input;
				arParams[0].Value = SiteID;
			
				arParams[1] = new NpgsqlParameter(&quot;rolename&quot;,
NpgsqlTypes.NpgsqlDbType.Text,50);
				arParams[1].Direction = ParameterDirection.Input;
				arParams[1].Value = RoleName;
			}
			
			try
			{
				int newID =
Convert.ToInt32(NpgsqlHelper.ExecuteScalar(Connection,
					CommandType.StoredProcedure, 
					&quot;mp_roles_insert(:siteid,:rolename)&quot;, 
					arParams));

				Connection.Close();
				return newID;
			}
			catch(Exception ex)
			{
				Connection.Close();
				throw ex;
			}
		}

		public static bool Role_Update(int RoleID, string
RoleName)
		{
			NpgsqlConnection Connection = GetConnection();
			NpgsqlParameter[] arParams = new
NpgsqlParameter[2];
		
if(ConfigurationSettings.AppSettings.Get(&quot;CachePostgreSQLParameters&quot;).ToLower()
 == &quot;true&quot;)
			{
				arParams =
NpgsqlHelperParameterCache.GetSpParameterSet(ConfigurationSettings.AppSettings.Get(&quot;PostgreSQLConnectionString&quot;),
					&quot;mp_roles_update(:roleid,:rolename)&quot;);

				arParams[0].Value = RoleID;
				arParams[1].Value = RoleName;
			}
			else
			{
				arParams[0] = new NpgsqlParameter(&quot;roleid&quot;,
NpgsqlTypes.NpgsqlDbType.Integer);
				arParams[0].Direction = ParameterDirection.Input;
				arParams[0].Value = RoleID;
			
				arParams[1] = new NpgsqlParameter(&quot;rolename&quot;,
NpgsqlTypes.NpgsqlDbType.Text,50);
				arParams[1].Direction = ParameterDirection.Input;
				arParams[1].Value = RoleName;
			}

			try
			{
				int rowsAffected =
NpgsqlHelper.ExecuteNonQuery(Connection,
					CommandType.StoredProcedure, 
					&quot;mp_roles_update(:roleid,:rolename)&quot;, 
					arParams);

				Connection.Close();
				return (rowsAffected &gt; -1);
			}
			catch(Exception ex)
			{
				Connection.Close();
				throw ex;
			}
		}


public static IDataReader Role_GetByID(int RoleID)
		{
			NpgsqlParameter[] arParams = new
NpgsqlParameter[1];

		
if(ConfigurationSettings.AppSettings.Get(&quot;CachePostgreSQLParameters&quot;).ToLower()
 == &quot;true&quot;)
			{
				arParams =
NpgsqlHelperParameterCache.GetSpParameterSet(ConfigurationSettings.AppSettings.Get(&quot;PostgreSQLConnectionString&quot;),
					&quot;mp_roles_selectone(:roleid)&quot;);
	
				arParams[0].Value = RoleID;
			}
			else
			{
				arParams[0] = new NpgsqlParameter(&quot;roleid&quot;,
NpgsqlTypes.NpgsqlDbType.Integer);
				arParams[0].Direction = ParameterDirection.Input;
				arParams[0].Value = RoleID;
			}

			return NpgsqlHelper.ExecuteReader(
			
ConfigurationSettings.AppSettings.Get(&quot;PostgreSQLConnectionString&quot;),
				CommandType.StoredProcedure, 
				&quot;mp_roles_selectone(:roleid)&quot;, 
				arParams);
		}



--------------
Here is the same crud for MySQL using the MySQL
Connector for .NET

public static int Role_Create(
			int SiteID,
			string RoleName)
		{
			StringBuilder sqlCommand = new StringBuilder();
			sqlCommand.Append(&quot;INSERT INTO mp_Roles (SiteID,
RoleName, DisplayName) &quot;);
			sqlCommand.Append(&quot;VALUES (&quot;);

			sqlCommand.Append(&quot; ?SiteID , ?RoleName,
?RoleName&quot;);
			
			sqlCommand.Append(&quot;);&quot;);
			sqlCommand.Append(&quot;SELECT LAST_INSERT_ID();&quot;);

			MySqlParameter[] arParams = new MySqlParameter[2];

			arParams[0] = new MySqlParameter(&quot;?SiteID&quot;,
MySqlDbType.Int32);
			arParams[0].Direction = ParameterDirection.Input;
			arParams[0].Value = SiteID;

			arParams[1] = new MySqlParameter(&quot;?RoleName&quot;,
MySqlDbType.VarChar, 50);
			arParams[1].Direction = ParameterDirection.Input;
			arParams[1].Value = RoleName;

			MySqlConnection connection = GetConnection();
			try
			{
				int newID =
Convert.ToInt32(MySqlHelper.ExecuteScalar(connection,
sqlCommand.ToString(), arParams).ToString());
				connection.Close();
				return newID;
			}
			catch(Exception ex)
			{
				connection.Close();
				throw ex;
			}
		}

		public static bool Role_Update(int RoleID, string
RoleName)
		{
			StringBuilder sqlCommand = new StringBuilder();
			sqlCommand.Append(&quot;UPDATE mp_Roles &quot;);
			sqlCommand.Append(&quot;SET DisplayName = ?RoleName  &quot;);
			sqlCommand.Append(&quot;WHERE RoleID = ?RoleID  ;&quot;);

			MySqlParameter[] arParams = new MySqlParameter[2];

			arParams[0] = new MySqlParameter(&quot;?RoleID&quot;,
MySqlDbType.Int32);
			arParams[0].Direction = ParameterDirection.Input;
			arParams[0].Value = RoleID;

			arParams[1] = new MySqlParameter(&quot;?RoleName&quot;,
MySqlDbType.VarChar, 50);
			arParams[1].Direction = ParameterDirection.Input;
			arParams[1].Value = RoleName;
			
			int rowsAffected = 0;
			MySqlConnection connection = GetConnection();
			try
			{
				rowsAffected =
MySqlHelper.ExecuteNonQuery(connection,
sqlCommand.ToString(), arParams);
				connection.Close();
			}
			catch(Exception ex)
			{
				connection.Close();
				throw ex;
			}
			

			return (rowsAffected &gt; 0);
		}


public static IDataReader Role_GetByID(int RoleID)
		{
			StringBuilder sqlCommand = new StringBuilder();
			sqlCommand.Append(&quot;SELECT * &quot;);
			sqlCommand.Append(&quot;FROM	mp_Roles &quot;);
			sqlCommand.Append(&quot;WHERE RoleID = ?RoleID ; &quot;);

			MySqlParameter[] arParams = new MySqlParameter[1];

			arParams[0] = new MySqlParameter(&quot;?RoleID&quot;,
MySqlDbType.Int32);
			arParams[0].Direction = ParameterDirection.Input;
			arParams[0].Value = RoleID;
			
			return MySqlHelper.ExecuteReader(
			
ConfigurationSettings.AppSettings.Get(&quot;mySqlConnectionString&quot;),

				sqlCommand.ToString(), 
				arParams);

		}


I avoid use of DataSet if I can help it but would be
glad to produce some sample code if needed.

Let me know if any of this is helpful or you'd like me
to put together some more samples.

Cheers,

Joe



--- Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">monodanmorg at yahoo.com</A>&gt; wrote:

&gt;<i> After seeing programmers struggling to connect to
</I>&gt;<i> various databases using Mono, I realized we need
</I>&gt;<i> some documentation and examples to help people get
</I>&gt;<i> started.  
</I>&gt;<i>  
</I>&gt;<i> For instance, I could not find in a reasonable
</I>&gt;<i> amount of time to figure out how to use parameters
</I>&gt;<i> with ODBC to get data from a PostgreSQL database.
</I>&gt;<i>  
</I>&gt;<i> Does anyone have working examples to contribute?  I
</I>&gt;<i> would like to add them to Mono's wiki.
</I>&gt;<i>  
</I>&gt;<i> <A HREF="http://www.mono-project.com/Database_Access">http://www.mono-project.com/Database_Access</A>
</I>&gt;<i>  
</I>&gt;<i> Other examples could include using gtk# to load a
</I>&gt;<i> TreeView with data from a PostgreSQL database would
</I>&gt;<i> be nice.
</I>&gt;<i>  
</I>&gt;<i> Or how to execute a stored procedure on PostgreSQL
</I>&gt;<i> using the Npgsql provider.
</I>&gt;<i>  
</I>&gt;<i> Or populating an ASP.NET data grid via a DataSet
</I>&gt;<i> that was populated from SQL Lite or MySQL.
</I>&gt;<i>  
</I>&gt;<i> Examples for various databases including Sybase,
</I>&gt;<i> Oracle, SQL Server, MySQL, SQL Lite, ODBC, ADP
</I>&gt;<i> (Advanced Data Provider), etc...
</I>&gt;<i>  
</I>&gt;<i> Thanks,
</I>&gt;<i> Daniel
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> 		
</I>&gt;<i> ---------------------------------
</I>&gt;<i>  Start your day with Yahoo! - make it your home page
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>

joe_audette [at] yahoo dotcom
<A HREF="http://www.joeaudette.com">http://www.joeaudette.com</A>
<A HREF="http://www.mojoportal.com">http://www.mojoportal.com</A>
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028196.html">[Mono-list] Mono Database Documentation and Examples
</A></li>
	<LI>Next message: <A HREF="028209.html">[Mono-list] Mono Database Documentation and Examples
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28202">[ date ]</a>
              <a href="thread.html#28202">[ thread ]</a>
              <a href="subject.html#28202">[ subject ]</a>
              <a href="author.html#28202">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
