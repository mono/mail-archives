<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: Seeing Values of Unwound Stack variables
 at Exception Handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:2a5gjx302%40sneakemail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="025014.html">
   <LINK REL="Next"  HREF="025043.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: Seeing Values of Unwound Stack variables
 at Exception Handler
   </H1>
    <B>Jonathan Gilbert
    </B> 
    <A HREF="mailto:2a5gjx302%40sneakemail.com"
       TITLE="[Mono-list] Re: Seeing Values of Unwound Stack variables
 at Exception Handler">2a5gjx302@sneakemail.com
       </A><BR>
    <I>Fri, 24 Dec 2004 00:53:13 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="025014.html">[Mono-list] Re: Seeing Values of Unwound Stack variables at Exception Handler
</A></li>
        <LI> Next message: <A HREF="025043.html">[Mono-list] Re: Seeing Values of Unwound Stack variables at
 Exception Handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25041">[ date ]</a>
              <a href="thread.html#25041">[ thread ]</a>
              <a href="subject.html#25041">[ subject ]</a>
              <a href="author.html#25041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm not sure about &quot;custom stack unwinder notification&quot;, but it seems to
me, the pattern you've written there, that is:

bool finished = false;
try
{
  ...
  finished = true;
}
finally
{
  if (!finished)
  {
    ...
  }
}

..is equivalent to this:

try
{
  ...
}
catch
{
  ...
  throw;
}

Don't know if this helps at all, but it is the behaviour you described with
the try/finally. The 'finally' clause always runs when code flow exits the
scope; this is why the flag is required. The flag ensures that the code
runs only when code flow did not leave the 'try' block &quot;normally&quot; -- that
is, when an exception occurred. This is the situation that the 'catch'
block runs under. Also note, rethrowing the exception will not interfere
with the stack trace; that is generated when the exception is constructed
(&quot;new Exception(...)&quot;), and not when it is 'throw'n.

Jonathan Gilbert

At 01:05 PM 20/12/2004 -0500, TB wrote:
&gt;<i>I forgot to mention -- please reply directly to me.
</I>&gt;<i>I'm not subscribed.
</I>&gt;<i>
</I>&gt;<i>On Mon, Dec 20, 2004 at 01:03:22PM -0500, TB wrote:
</I>&gt;&gt;<i> With the Microsoft CLR one can use WinDBG !clrstack to view the CLR 
</I>&gt;&gt;<i> stack when an UHHANDLED exception is thrown.  But when you have an
</I>&gt;&gt;<i> try..catch exception block active, the stack will be unwound.  The
</I>&gt;&gt;<i> Exception.StackTrace property gives you the *names* of the methods
</I>&gt;&gt;<i> that were unwound, but not the locals or function parameters -- the 
</I>&gt;&gt;<i> stack variables.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Does Mono allow you to register a &quot;custom stack unwinder notification&quot;
</I>&gt;&gt;<i> function?  I could do it myself by adding the following code to every
</I>&gt;&gt;<i> single method body:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> function MayThrowException (int arg1, int arg2, intarg3) {
</I>&gt;&gt;<i>   bool completed = false;
</I>&gt;&gt;<i>   try {
</I>&gt;&gt;<i>     // real method body
</I>&gt;&gt;<i>    completed = true;
</I>&gt;&gt;<i>   } finally {
</I>&gt;&gt;<i>     if (!completed) {
</I>&gt;&gt;<i>       //stash arg1, args2, arg3 on heap for later perusal
</I>&gt;&gt;<i>       //possibly serialize them
</I>&gt;&gt;<i>       //you can use reflection to enumerate all method
</I>&gt;&gt;<i>       //arguments, can you use serialization to enumerate
</I>&gt;&gt;<i>       //the locals?
</I>&gt;&gt;<i>     }
</I>&gt;&gt;<i>   }
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The compiler could output this prolog/epilogue code
</I>&gt;&gt;<i> for each method.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> But if the Runtime called back some code before it
</I>&gt;&gt;<i> unwinds the stack that would be best.  It would help
</I>&gt;&gt;<i> to debug.
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="025014.html">[Mono-list] Re: Seeing Values of Unwound Stack variables at Exception Handler
</A></li>
	<LI> Next message: <A HREF="025043.html">[Mono-list] Re: Seeing Values of Unwound Stack variables at
 Exception Handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25041">[ date ]</a>
              <a href="thread.html#25041">[ thread ]</a>
              <a href="subject.html#25041">[ subject ]</a>
              <a href="author.html#25041">[ author ]</a>
         </LI>
       </UL>
</body></html>
