<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] more problems with C and C# strings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bryanb%40webbtide.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="025009.html">
   <LINK REL="Next"  HREF="025012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] more problems with C and C# strings
   </H1>
    <B>Bryan Buchanan
    </B> 
    <A HREF="mailto:bryanb%40webbtide.com"
       TITLE="[Mono-list] more problems with C and C# strings">bryanb@webbtide.com
       </A><BR>
    <I>21 Dec 2004 10:15:44 +1000</I>
    <P><UL>
        <LI> Previous message: <A HREF="025009.html">[Mono-list] mwf  -ncurses
</A></li>
        <LI> Next message: <A HREF="025012.html">[Mono-list] more problems with C and C# strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25010">[ date ]</a>
              <a href="thread.html#25010">[ thread ]</a>
              <a href="subject.html#25010">[ subject ]</a>
              <a href="author.html#25010">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

This small prog in C works:

#include &lt;gnome.h&gt;
#include &lt;stdarg.h&gt;
                                                                                                    void QMCall(char * subrname, int argc, ...);
                                                                
int main(int argc, char **argv)
{
    char *x = g_malloc(1024);
    char *y = g_malloc(1024);
    g_sprintf(x, &quot;%s&quot;, &quot;abcd&quot;);
    g_sprintf(y, &quot;%s&quot;, &quot;xyz&quot;);
    g_message(x);
    g_message(y);
    QMCall(&quot;a name&quot;, 2, x, y);
    g_message(x);
    g_message(y);
}
                                                                                                    void QMCall(char * subrname, int argc, ...) {
    va_list ap;
    char *arg;
    int i;
                                                                       
    g_message(subrname);
                                                                       
    va_start(ap, argc);
    for (i = 0; i &lt; argc; i++) {
        arg = va_arg(ap, char *);
        g_message(arg);
    }
    va_end(ap);
                                                                 
    va_start(ap, argc);
    for (i = 1; i &lt;= argc; i++) {
        arg = va_arg(ap, char *);
        g_sprintf(arg, &quot;this is string %d&quot;, i);
    }
    va_end(ap);
}

Gives this output:
** Message: abcd
** Message: xyz
** Message: a name
** Message: abcd
** Message: xyz
** Message: this is string 1
** Message: this is string 2


When I compile as a library and call it from C# with this prog:

using System;
using System.Text;
using System.Runtime.InteropServices;
                                                                                                    public class QMClient {
    [DllImport(&quot;mylib.so&quot;)]
    public static extern void QMCall(string subrname, int argc, params
StringBuilder [] str);
}
                                                                                                    class test {
    static void Main() {
                                                                       
        StringBuilder x = new StringBuilder(&quot;abcd&quot;, 1024);
        StringBuilder y = new StringBuilder(&quot;xyz&quot;, 1024);
        Console.WriteLine(&quot;{0} {1}&quot;, x.ToString(), y.ToString());
                                                                       
        QMClient.QMCall(&quot;a name&quot;, 2, x, y);
                                                                      
        Console.WriteLine(&quot;{0} {1}&quot;, x.ToString(), y.ToString());
    }
                                                                        
}

I get this result:

abcd xyz
** Message: a name
** Message: hGpKpK,
** Message: abcd
 
Unhandled Exception: System.NullReferenceException: Object reference not
set to an instance of an object
in &lt;0xf84e4c&gt; (wrapper managed-to-native) QMClient:QMCall
(string,int,System.Text.StringBuilder[])
in &lt;0x00004&gt; (wrapper managed-to-native) QMClient:QMCall
(string,int,System.Text.StringBuilder[])
in &lt;0x000cc&gt; test:Main ()

Any clues ?

Thanks,

Bryan


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="025009.html">[Mono-list] mwf  -ncurses
</A></li>
	<LI> Next message: <A HREF="025012.html">[Mono-list] more problems with C and C# strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25010">[ date ]</a>
              <a href="thread.html#25010">[ thread ]</a>
              <a href="subject.html#25010">[ subject ]</a>
              <a href="author.html#25010">[ author ]</a>
         </LI>
       </UL>
</body></html>
