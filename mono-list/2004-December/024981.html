<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: Calling back from unmanaged code to managed
 code.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:nigel_benns%40rogers.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024975.html">
   <LINK REL="Next"  HREF="024982.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: Calling back from unmanaged code to managed
 code.
   </H1>
    <B>Nigel Benns
    </B> 
    <A HREF="mailto:nigel_benns%40rogers.com"
       TITLE="[Mono-list] Re: Calling back from unmanaged code to managed
 code.">nigel_benns@rogers.com
       </A><BR>
    <I>Fri, 17 Dec 2004 09:08:02 -0500 (EST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="024975.html">[Mono-list] Re: Calling back from unmanaged code to managed
 code.
</A></li>
        <LI> Next message: <A HREF="024982.html">[Mono-list] Re: Calling back from unmanaged code to managed code.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24981">[ date ]</a>
              <a href="thread.html#24981">[ thread ]</a>
              <a href="subject.html#24981">[ subject ]</a>
              <a href="author.html#24981">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Johnathan, That couldn't have been explained better :)
And your article is very good, there should be a lot that will apply to
what I'm doing, so I've skimmed it for now, and bookmarked it for later.

I'll try what you showed me after work today, and with any luck you may
see an ewl-sharp alpha library available soon for all of those
Enlightenment DR17 fanactics out there!!!!

This will be my first set of libs like this, so I have a lot to learn,
I've downloaded the sourcecode for gtk-sharp and it proves helpful, and
I'm sure I'll be asking them a lot of questions along the way about how
they tackled some issues.

I'm sure I'll be shooting out a lot of emails on the mono lists and
enlightenment lists so I know this won't be the last you hear from me.

I've never been on a mailing list before mono, and I must say, I never
TRUELY new what opensource was all about until I joined.

Thanks again, Nigel

&gt;<i> Just for &quot;fun&quot;, I'll write the equivalent C# declarations inline with
</I>&gt;<i> the C code.  Note that I haven't tried to compile this, but the basic
</I>&gt;<i> idea should be seen...
</I>&gt;<i>
</I>&gt;<i> On Thu, 2004-12-16 at 13:32 -0500, Nigel Benns wrote:
</I>&gt;&gt;<i> Here is a C example to do a DeleteEvent:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> void delete_cb(Ewl_Widget *w, void *event, void *data) {
</I>&gt;&gt;<i>     ewl_widget_destroy(w);
</I>&gt;&gt;<i>     ewl_main_quit();
</I>&gt;&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> delegate void EwlDeleteCallback (IntPtr w, IntPtr event, IntPtr data);
</I>&gt;<i>
</I>&gt;<i> class MyTest {
</I>&gt;<i>
</I>&gt;<i> 	private const string LIB = &quot;ewl&quot;;
</I>&gt;<i>
</I>&gt;<i> 	[DllImport (LIB)]
</I>&gt;<i> 	private static extern void ewl_widget_destroy (IntPtr w);
</I>&gt;<i>
</I>&gt;<i> 	[DllImport (LIB)]
</I>&gt;<i> 	private static extern void ewl_main_quit ();
</I>&gt;<i>
</I>&gt;<i> 	private void delete_cb (IntPtr w, IntPtr event, IintPtr data)
</I>&gt;<i> 	{
</I>&gt;<i> 		ewl_widget_destroy (w);
</I>&gt;<i> 		ewl_main_quit ();
</I>&gt;<i> 	}
</I>&gt;<i>
</I>&gt;&gt;<i> int main(int argc, char **argv) {
</I>&gt;&gt;<i>    ewl_init();
</I>&gt;<i>
</I>&gt;<i> 	[DllImport (LIB)] private static extern void ewl_init ();
</I>&gt;&gt;<i>    ...
</I>&gt;&gt;<i>    win = ewl_window_new();
</I>&gt;<i>
</I>&gt;<i> 	[DllImport (LIB)] private static extern IntPtr ewl_window_new();
</I>&gt;<i>
</I>&gt;&gt;<i>    ...
</I>&gt;&gt;<i>    /*Where this function appends the callback to a calback list read
</I>&gt;&gt;<i>      by ewl_main().
</I>&gt;&gt;<i>    */
</I>&gt;&gt;<i>    ewl_callback_append(win, EWL_CALLBACK_DELETE_WINDOW, delete_cb,
</I>&gt;&gt;<i> NULL);
</I>&gt;<i>
</I>&gt;<i> 	// Here's what you're interested in:
</I>&gt;<i> 	[DllImport(LIB)]
</I>&gt;<i> 	private static extern void ewl_callback_append (IntPtr win,
</I>&gt;<i> 		int callback_type, EwlDeleteCallback cb, IntPtr data);
</I>&gt;<i>
</I>&gt;<i> 	// I'd assume that ewl_callback_append can take a variety of
</I>&gt;<i> 	// function pointer types (the callback is probably void*),
</I>&gt;<i> 	// so you could overload this function for each function
</I>&gt;<i> 	// pointer type that ewl_callback_append accepts.
</I>&gt;<i>
</I>&gt;<i> 	// obviously, this needs to be set to the correct value.
</I>&gt;<i> 	private const int EWL_CALLBACK_DELETE_WINDOW = 0xdeadbeef;
</I>&gt;<i>
</I>&gt;&gt;<i>    /*The NULL is for the Data to pass */
</I>&gt;&gt;<i>    ...
</I>&gt;&gt;<i>    ewl_main();
</I>&gt;<i>
</I>&gt;<i> 	[DllImport(LIB)] private static extern void ewl_main ();
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ok, so what I'm trying figure out is how to add the ewl_callback_append
</I>&gt;&gt;<i> as
</I>&gt;&gt;<i> a delegate in C#.
</I>&gt;<i>
</I>&gt;<i> 	public static void Main ()
</I>&gt;<i> 	{
</I>&gt;<i> 		ewl_init ();
</I>&gt;<i> 		IntPtr win = ewl_window_new ();
</I>&gt;<i> 		EwlDeleteCallback cb = new EwlDeleteCallback (delete_cb);
</I>&gt;<i> 		ewl_callback_append (win, EWL_CALLBACK_DELETE_WINDOW,
</I>&gt;<i> 			cb, IntPtr.Zero);
</I>&gt;<i> 		ewl_main ();
</I>&gt;<i> 		System.GC.KeepAlive (cb);
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> Note that the System.GC.KeepAlive is necessary so that the GC doesn't
</I>&gt;<i> collect your delegate before EWL is finished using the function pointer
</I>&gt;<i> it has (the delegate is marshaled as a function pointer).  It would be
</I>&gt;<i> &quot;bad&quot; to have the GC collect the delegate early.
</I>&gt;<i>
</I>&gt;&gt;<i> It doesn't seem write to me that I could pass a C# function to C, even
</I>&gt;&gt;<i> if
</I>&gt;&gt;<i> I could figure out how to do that?
</I>&gt;<i>
</I>&gt;<i> You can pass a delegate referring to a C# method to C.
</I>&gt;<i>
</I>&gt;<i> I would suggest reading my guide, &quot;Everything you (n)ever wanted to know
</I>&gt;<i> about marshaling (and were afraid to ask!)&quot;:
</I>&gt;<i>
</I>&gt;<i> 	<A HREF="http://www.jprl.com/~jon/interop.html">http://www.jprl.com/~jon/interop.html</A>
</I>&gt;<i>
</I>&gt;<i> It's also available through monodoc (though the above is more recent --
</I>&gt;<i> I've been lazy about committing):
</I>&gt;<i>
</I>&gt;<i> 	<A HREF="http://www.go-mono.com/docs/index.aspx?tlink=8@xhtml%3anew%2fen%2fprogramming%2finterop.html">http://www.go-mono.com/docs/index.aspx?tlink=8@xhtml%3anew%2fen%2fprogramming%2finterop.html</A>
</I>&gt;<i>
</I>&gt;<i> You may also want to look into Gtk#, just to see how the wrapper code
</I>&gt;<i> can be used.
</I>&gt;<i>
</I>&gt;<i>  - Jon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024975.html">[Mono-list] Re: Calling back from unmanaged code to managed
 code.
</A></li>
	<LI> Next message: <A HREF="024982.html">[Mono-list] Re: Calling back from unmanaged code to managed code.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24981">[ date ]</a>
              <a href="thread.html#24981">[ thread ]</a>
              <a href="subject.html#24981">[ subject ]</a>
              <a href="author.html#24981">[ author ]</a>
         </LI>
       </UL>
</body></html>
