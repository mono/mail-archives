<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Support for marshalling of C# string to unmanaged wchar_t on Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:kalabalun%40yahoo.co.in">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024972.html">
   <LINK REL="Next"  HREF="024976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Support for marshalling of C# string to unmanaged wchar_t on Linux
   </H1>
    <B>Kala B
    </B> 
    <A HREF="mailto:kalabalun%40yahoo.co.in"
       TITLE="[Mono-list] Support for marshalling of C# string to unmanaged wchar_t on Linux">kalabalun@yahoo.co.in
       </A><BR>
    <I>Thu, 16 Dec 2004 13:12:02 +0000 (GMT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="024972.html">[Mono-list] Embedded mono (small devices)
</A></li>
        <LI> Next message: <A HREF="024976.html">[Mono-list] Support for marshalling of C# string to unmanaged
 wchar_t on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24965">[ date ]</a>
              <a href="thread.html#24965">[ thread ]</a>
              <a href="subject.html#24965">[ subject ]</a>
              <a href="author.html#24965">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
Does mono support marshalling of C# string to
unmanaged wchar_t on Linux? 

It does not seem to work. Consider the following
sample code, 
( contents of 3 files ) 
1. chash.cs
   This C# code makes a call to a C API, which takes a
wchar_t[].
2. testlib.c
   This is the C code which implements the C API.
3. makefile
   to build the library and C# exe.
    

Contents of chash.cs
--------------------
using System;
using System.Runtime.InteropServices;
using System.Text;
using System.Collections.Specialized;

[StructLayout(LayoutKind.Sequential, CharSet =
CharSet.Unicode)]
public class Id
      {
          public int              len;
          [MarshalAs(UnmanagedType.ByValTStr,
SizeConst = 256)]
          public string   name;
      };
class Test
{
    [DllImport(&quot;libtest.so&quot;)]
    public static extern int TestFn (Id id);

    public static void Main()
    {
        string name = &quot;testname&quot;;
        Id id = new Id();
        id.name = name;
        id.len = 8;        //name.Length();
        int rcode = TestFn(id);
        Console.WriteLine(&quot;TestFn returns {0}&quot;,rcode);
    }
}

Contents of testlib.c
---------------------
#include &lt;stdio.h&gt;
#include &lt;wchar.h&gt;

typedef struct _id
{
    int len;
    wchar_t name[256];
}Id;

int TestFn(Id *id)
{
    printf(&quot;%s\t%S\t%d\n&quot;,__func__,id-&gt;name,id-&gt;len);
    printf(&quot;wcslen returns.. %d\n&quot;,strlen(id-&gt;name));
    return 1;
}

makefile
--------
all: lib test
lib: testlib.c
        gcc -fPIC -c testlib.c
        ld -x --shared -o libtest.so testlib.o
test:
        mcs -debug chash.cs
clean :
        rm ./libtest.so
        rm ./chash.exe

When chash.exe is run, it prints some junk characters.
Even wcslen() does not print the expected output.

Could you please help? 
If marshalling is not supported, could you please
suggest some alternate solution to solve the issue?

Thanks &amp; Regards
Kala B.



________________________________________________________________________
Yahoo! India Matrimony: Find your life partner online
Go to: <A HREF="http://yahoo.shaadi.com/india-matrimony">http://yahoo.shaadi.com/india-matrimony</A>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024972.html">[Mono-list] Embedded mono (small devices)
</A></li>
	<LI> Next message: <A HREF="024976.html">[Mono-list] Support for marshalling of C# string to unmanaged
 wchar_t on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24965">[ date ]</a>
              <a href="thread.html#24965">[ thread ]</a>
              <a href="subject.html#24965">[ subject ]</a>
              <a href="author.html#24965">[ author ]</a>
         </LI>
       </UL>
</body></html>
