<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: Calling back from unmanaged code to managed
 code.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jonpryor%40vt.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024881.html">
   <LINK REL="Next"  HREF="024942.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: Calling back from unmanaged code to managed
 code.
   </H1>
    <B>Jonathan Pryor
    </B> 
    <A HREF="mailto:jonpryor%40vt.edu"
       TITLE="[Mono-list] Re: Calling back from unmanaged code to managed
 code.">jonpryor@vt.edu
       </A><BR>
    <I>Sun, 12 Dec 2004 12:14:47 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="024881.html">[Mono-list] Re: Calling back from unmanaged code to managed
 code.
</A></li>
        <LI> Next message: <A HREF="024942.html">[Mono-list] Re: Calling back from unmanaged code to managed code.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24901">[ date ]</a>
              <a href="thread.html#24901">[ thread ]</a>
              <a href="subject.html#24901">[ subject ]</a>
              <a href="author.html#24901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2004-12-10 at 19:02 +0000, Gregory Bowyer wrote:
&gt;<i> Paolo Molaro wrote:
</I>&gt;<i> &gt; We could easily remove this assert and instead add the code to setup
</I>&gt;<i> &gt; the thread to execute managed code. This won't solve the whole issue,
</I>&gt;<i> &gt; though: the GC needs to know about the thread and its stack limits or
</I>&gt;<i> &gt; it won't work correctly.
</I>&gt;<i> &gt; There is also the issue of deciding which application domain should be set
</I>&gt;<i> &gt; for the new thread. We should probably add a call to a function that does
</I>&gt;<i> &gt; all this setup to the wrapper methods used to go from unmanaged to
</I>&gt;<i> &gt; managed code.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; lupus
</I>&gt;<i> &gt; 
</I>&gt;<i> If i am reading this correctly, is the lack of support for unmanaged 
</I>&gt;<i> code in mono a case of three incomplete features namely:
</I>&gt;<i> 	1) Lack of Code access security stuff
</I>&gt;<i> 	2) Bits of monos internal setup
</I>&gt;<i> 	3) GC &quot;pinning&quot; and stack issues
</I>
To simplify greatly on Francis Brosnan Bl√°zquez's response:

1)  No, Code Access Security has nothing to do with it
2)  Yes, it has to do with Mono's internal requirements, mostly from...
3)  The GC has it's own requirements.

&gt;<i> If so is it that difficult to add this feature to mono (say once the 
</I>&gt;<i> work on code security is finished)
</I>
It's not so much difficult, as questionable.  Questionable as in,
&quot;should we do this?&quot;.

There are two requirements/changes lupus mentioned:

1.  The native delegate should marshal the thread into the correct 
    AppDomain.  This probably wouldn't be too difficult (says the guy
    who hasn't done *any* runtime hacking).

2.  Setup/initialize non-mono threads so that mono can use them.  This
    includes determining the stack information so that the GC can 
    properly trace the entire GC heap.

(2) is the problematic requirement.  Should mono &quot;take over&quot; all threads
that enter mono?  *Can* mono do that?  (I don't know if it's possible to
get the stack size from the pthreads API.)  Taking over any thread that
enters mono's runtime is questionable, at best -- these may be threads
created by Wine, or Xine, or Evolution, or...  Altering them to make
them suitable for use by mono may be a questionable tactic, at best.

A better approach is what mono already requires -- all threads that used
by mono should call mono_thread_attach before entering or being used by
mono.  Unfortunately this requires partitioning your application so that
non-mono threads don't call into mono, directly or indirectly, but this
is probably the only usable solution.

 - Jon



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024881.html">[Mono-list] Re: Calling back from unmanaged code to managed
 code.
</A></li>
	<LI> Next message: <A HREF="024942.html">[Mono-list] Re: Calling back from unmanaged code to managed code.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24901">[ date ]</a>
              <a href="thread.html#24901">[ thread ]</a>
              <a href="subject.html#24901">[ subject ]</a>
              <a href="author.html#24901">[ author ]</a>
         </LI>
       </UL>
</body></html>
