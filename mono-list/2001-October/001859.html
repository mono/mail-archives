<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Constructors for StringBuilder
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:ndrochak%40gol.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001858.html">
   <LINK REL="Next"  HREF="001862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Constructors for StringBuilder
   </H1>
    <B>Nick Drochak
    </B> 
    <A HREF="mailto:ndrochak%40gol.com"
       TITLE="[Mono-list] Constructors for StringBuilder">ndrochak@gol.com
       </A><BR>
    <I>Tue, 23 Oct 2001 18:38:18 +0900</I>
    <P><UL>
        <LI> Previous message: <A HREF="001858.html">[Mono-list] Constructors for StringBuilder
</A></li>
        <LI> Next message: <A HREF="001862.html">[Mono-list] I am at the PDC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1859">[ date ]</a>
              <a href="thread.html#1859">[ thread ]</a>
              <a href="subject.html#1859">[ subject ]</a>
              <a href="author.html#1859">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_0018_01C15BF1.E28641E0
Content-Type: text/plain;
	charset=&quot;utf-8&quot;
Content-Transfer-Encoding: quoted-printable

All,

I had some time today, so I put in the missing constructors for =
StringBuilder.  I also refactored the code into one constructor to =
simplify things.

On my machine this fixes the broken build we got recently.

If Marcin (the author of StringBuilder) or someone else can look over my =
patch I can commit it.

Regards,
Nick D.

------=_NextPart_000_0018_01C15BF1.E28641E0
Content-Type: application/octet-stream;
	name=&quot;stringbuilder.diff&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;stringbuilder.diff&quot;

? stringbuilder.diff=0A=
Index: ChangeLog=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvs/public/mcs/class/corlib/System.Text/ChangeLog,v=0A=
retrieving revision 1.5=0A=
diff -r1.5 ChangeLog=0A=
0a1,9=0A=
&gt;<i> 2001-10-23  Nick Drochak  &lt;<A HREF="mailto:ndrochak@gol.com">ndrochak@gol.com</A>&gt;=0A=
</I>&gt;<i> =0A=
</I>&gt;<i> 	* StringBuilder.cs: Refactored constructor code into just one=0A=
</I>&gt;<i> 	constructor. All the other construtors call it. Also supplied missing=0A=
</I>&gt;<i> 	constructors so the class has all those in the spec.=0A=
</I>&gt;<i> =0A=
</I>&gt;<i> 	Added the MaxCapacity property as well, however this needs to be =0A=
</I>&gt;<i> 	completed to return a value is related to the available system memory.=0A=
</I>&gt;<i> =0A=
</I>Index: StringBuilder.cs=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvs/public/mcs/class/corlib/System.Text/StringBuilder.cs,v=0A=
retrieving revision 1.4=0A=
diff -r1.4 StringBuilder.cs=0A=
15d14=0A=
&lt;=20
19c18=0A=
&lt; 		const int defaultCapacity =3D 16;
---=0A=
&gt;<i> 		private const int defaultCapacity =3D 16;
</I>23a23=0A=
&gt;<i> 		private int sMaxCapacity =3D Int32.MaxValue;
</I>25c25,47=0A=
&lt; 		public StringBuilder() {
---=0A=
&gt;<i> 		public StringBuilder(string str, int startIndex, int length, int =
</I>capacity) {
&gt;<i> 			// the capacity must be at least as big as the default capacity
</I>&gt;<i> 			// LAMESPEC: what to do if capacity is too small to hold the =
</I>substring?
&gt;<i> 			// For now, truncate the substring to &quot;capacity&quot; characters
</I>&gt;<i> 			sCapacity =3D Math.Max(capacity, defaultCapacity);
</I>&gt;<i> 			sString =3D new char[sCapacity];
</I>&gt;<i>=20
</I>&gt;<i> 			// LAMESPEC: what to do if startIndex is too big?  Throw an =
</I>exception?  Which one?
&gt;<i> 			// For now, if the startIndex is beyond the end of the string, =
</I>create an empty StringBuilder
&gt;<i> 			// Also, if str is null, then create an empty StringBuilder
</I>&gt;<i> 			if (null =3D=3D str || startIndex &gt; str.Length - 1)=20
</I>&gt;<i> 			{
</I>&gt;<i> 				sLength =3D 0;
</I>&gt;<i> 			}
</I>&gt;<i> 			else
</I>&gt;<i> 			{
</I>&gt;<i> 				// LAMESPEC: what if the length specified would take us past the =
</I>end of the string?
&gt;<i> 				// For now, copy to the end of the string
</I>&gt;<i> 				// First find out how many characters we can actually copy
</I>&gt;<i> 				sLength =3D Math.Min(length, str.Length - startIndex);
</I>&gt;<i> 				// Then limit the length to the capacity if necessary.  See =
</I>LAMESPEC above.
&gt;<i> 				sLength =3D Math.Min(sLength, capacity);
</I>&gt;<i> 			}
</I>27,34c49,54=0A=
&lt; 			// The MS Implementation uses the default
&lt; 			// capacity for a StringBuilder.  The spec
&lt; 			// says it's up to the implementer, but=20
&lt; 			// we'll do it the MS way just in case.
&lt; 			=09
&lt; 			sString =3D new char[ defaultCapacity ];
&lt; 			sCapacity =3D defaultCapacity;
&lt; 			sLength =3D 0;
---=0A=
&gt;<i> 			// if the length is not going to be zero, then we have to copy some =
</I>characters
&gt;<i> 			if (sLength &gt; 0) {
</I>&gt;<i> 				// Copy the correct number of characters into the internal array
</I>&gt;<i> 				char[] tString =3D str.ToCharArray(startIndex, sLength);
</I>&gt;<i> 				Array.Copy( tString, sString, sLength);
</I>&gt;<i> 			}
</I>37,42c57=0A=
&lt; 		public StringBuilder( int capacity ) {
&lt; 			if( capacity &lt; defaultCapacity ) {
&lt; 					// The spec says that the capacity
&lt; 					// has to be at least the default capacity
&lt; 				capacity =3D defaultCapacity;
&lt; 			}
---=0A=
&gt;<i> 		public StringBuilder() : this(null, 0, 0, 0) {}
</I>44,46c59,62=0A=
&lt; 			sString =3D new char[capacity];
&lt; 			sCapacity =3D capacity;
&lt; 			sLength =3D 0;
---=0A=
&gt;<i> 		public StringBuilder( int capacity ) : this(null, 0, 0, capacity) {}
</I>&gt;<i>=20
</I>&gt;<i> 		public StringBuilder( int capacity, int maxCapacity ) : this(null, =
</I>0, 0, capacity) {
&gt;<i> 			sMaxCapacity =3D maxCapacity;
</I>49,60c65,74=0A=
&lt; 		public StringBuilder( string str ) {
&lt; 	=09
&lt; 			if( str.Length &lt; defaultCapacity ) {   =20
&lt; 				char[] tString =3D str.ToCharArray();
&lt; 				sString =3D new char[ defaultCapacity ];
&lt; 				Array.Copy( tString, sString, str.Length );
&lt; 				sLength =3D str.Length;
&lt; 				sCapacity =3D defaultCapacity;
&lt; 			} else {
&lt; 				sString =3D str.ToCharArray();
&lt; 				sCapacity =3D sString.Length;
&lt; 				sLength =3D sString.Length;
---=0A=
&gt;<i> 		public StringBuilder( string str ) : this(str, 0, str.Length, =
</I>str.Length) {}
&gt;<i> =09
</I>&gt;<i> 		public StringBuilder( string str, int capacity) : this(str, 0, =
</I>str.Length, capacity) {}
&gt;<i> =09
</I>&gt;<i> 		public int MaxCapacity=20
</I>&gt;<i> 		{
</I>&gt;<i> 			get=20
</I>&gt;<i> 			{
</I>&gt;<i> 				// TODO: Need to look at the memory of the system to return a =
</I>useful value here
&gt;<i> 				return sMaxCapacity;
</I>63c77=0A=
&lt; =09
---=0A=
&gt;<i>=20
</I>
------=_NextPart_000_0018_01C15BF1.E28641E0--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001858.html">[Mono-list] Constructors for StringBuilder
</A></li>
	<LI> Next message: <A HREF="001862.html">[Mono-list] I am at the PDC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1859">[ date ]</a>
              <a href="thread.html#1859">[ thread ]</a>
              <a href="subject.html#1859">[ subject ]</a>
              <a href="author.html#1859">[ author ]</a>
         </LI>
       </UL>
</body></html>
