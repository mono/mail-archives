<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] How many strings do I have?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="023672.html">
   <LINK REL="Next"  HREF="023635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] How many strings do I have?
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] How many strings do I have?">lupus@ximian.com
       </A><BR>
    <I>Mon, 11 Oct 2004 17:56:23 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="023672.html">[Mono-list] How many strings do I have?
</A></li>
        <LI> Next message: <A HREF="023635.html">[Mono-list] conversions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23709">[ date ]</a>
              <a href="thread.html#23709">[ thread ]</a>
              <a href="subject.html#23709">[ subject ]</a>
              <a href="author.html#23709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/09/04 Jonathan Pryor wrote:
&gt;<i> On Fri, 2004-10-08 at 04:39, Jeroen Frijters wrote:
</I>&gt;<i> &gt; Jonathan Gilbert wrote:
</I>&gt;<i> &gt; &gt; Once a string is in the pool, it can NEVER be removed
</I>&gt;<i> &gt; &gt; (until the AppDomain is disposed).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In Java the string intern pool uses weak references. I don't know about
</I>&gt;<i> &gt; .NET, but I'd hope it does the same.
</I>&gt;<i> 
</I>&gt;<i> I believe it doesn't.  From [1]:
</I>&gt;<i> 
</I>&gt;<i>         Interning happens two ways in the CLR.
</I>&gt;<i>         ... 
</I>&gt;<i>         
</I>&gt;<i>         2) It happens automatically, when you load an assembly.  All the
</I>&gt;<i>         string literals in the assembly are intern???ed.  This is
</I>
I doubt this is true, though I'm lazy and didn't write a test.
What the current C# compiler behaviour imposes is to intern all the strings 
referenced by a method before the method is executed, so AFAIK, this is
a requirement per-method and not per-assembly.
I'm not sure why using weak references would help: the strings must continue
to exist until the appdomain is shut down anyway.

As for the original issue: mono behaves that way because it uses the
unmanaged representation of a string as the key in the hash of interned
strings. This made sense at the time when the code was written (we had 
just the interpreter). The code should be changed to use MonoString* as 
the key since this will make the string intern icalls faster.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="023672.html">[Mono-list] How many strings do I have?
</A></li>
	<LI> Next message: <A HREF="023635.html">[Mono-list] conversions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23709">[ date ]</a>
              <a href="thread.html#23709">[ thread ]</a>
              <a href="subject.html#23709">[ subject ]</a>
              <a href="author.html#23709">[ author ]</a>
         </LI>
       </UL>
</body></html>
