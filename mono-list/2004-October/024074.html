<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Marshalling byte[]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bis0n%40mail.ru">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="024072.html">
   <LINK REL="Next"  HREF="024091.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Marshalling byte[]
   </H1>
    <B>Dmitry Kostenko
    </B> 
    <A HREF="mailto:bis0n%40mail.ru"
       TITLE="[Mono-list] Marshalling byte[]">bis0n@mail.ru
       </A><BR>
    <I>Wed, 27 Oct 2004 19:48:05 +0300</I>
    <P><UL>
        <LI> Previous message: <A HREF="024072.html">[Mono-list] Marshalling byte[]
</A></li>
        <LI> Next message: <A HREF="024091.html">[Mono-list] Ask Microsoft: Mono support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24074">[ date ]</a>
              <a href="thread.html#24074">[ thread ]</a>
              <a href="subject.html#24074">[ subject ]</a>
              <a href="author.html#24074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, Neale.

You should not use ByValArray enumeration member on function arguments. MS.NET 
SDK documentation says that ByValArray should be used only for structure members.

Are you passing byte arrays as in or out arguments?

What is the prototype of your C function?
1. int scumbag( int* X, char** fb, int lFb, ...)
2. int scumbag( int* X, char* fb, int lFb...)
3. int scumbag( int* X, char** fb, int* lFb...)

<A HREF="mailto:Neale.Ferguson@SoftwareAG-USA.com">Neale.Ferguson@SoftwareAG-USA.com</A> wrote:

&gt;<i> Thanks Dmitry,
</I>&gt;<i>  I tried this and am getting the following when compiling this simple test case:
</I>&gt;<i> 
</I>&gt;<i> using System;
</I>&gt;<i> using System.Text;
</I>&gt;<i> using System.Runtime.InteropServices;
</I>&gt;<i> 
</I>&gt;<i> public class main {
</I>&gt;<i> 
</I>&gt;<i>                 [DllImport(&quot;libname&quot;, EntryPoint = &quot;scumbag&quot;)]
</I>&gt;<i>                 private unsafe static extern int scumbag(ref int X,
</I>&gt;<i>                 [MarshalAs(UnmanagedType.ByValArray, SizeParamIndex=2)] ref byte[] fb,
</I>&gt;<i>                 long  lFb,
</I>&gt;<i>                 [MarshalAs(UnmanagedType.ByValArray, SizeParamIndex=4)] ref byte[] rb,
</I>&gt;<i>                 long  lRb,
</I>&gt;<i>                 [MarshalAs(UnmanagedType.ByValArray, SizeParamIndex=6)] ref byte[] sb,
</I>&gt;<i>                 long  lSb,
</I>&gt;<i>                 [MarshalAs(UnmanagedType.ByValArray, SizeParamIndex=8)] ref byte[] vb,
</I>&gt;<i>                 long  lVb,
</I>&gt;<i>                 [MarshalAs(UnmanagedType.ByValArray, SizeParamIndex=10)] ref byte[] ib,
</I>&gt;<i>                 long  lIb);
</I>&gt;<i> 
</I>&gt;<i>         static void Main() {
</I>&gt;<i>                 int rc;
</I>&gt;<i>                 Console.WriteLine(&quot;Waiting..&quot;);
</I>&gt;<i>                 string line = Console.ReadLine();
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>mcs marsh.cs -unsafe
</I>&gt;<i> 
</I>&gt;<i> Unhandled Exception: System.NullReferenceException: Object reference not set to an instance of an object
</I>&gt;<i> in &lt;0x0000034c&gt; Mono.CSharp.Attribute:GetMarshal ()
</I>&gt;<i> in &lt;0x00000054&gt; Mono.CSharp.ParameterBase:ApplyAttributeBuilder (Mono.CSharp.Attribute,System.Reflection.Emit.CustomAttributeBuilder)
</I>&gt;<i> in &lt;0x0000009c&gt; Mono.CSharp.Parameter:ApplyAttributeBuilder (Mono.CSharp.Attribute,System.Reflection.Emit.CustomAttributeBuilder)
</I>&gt;<i> in &lt;0x000001a4&gt; Mono.CSharp.Attribute:Emit (Mono.CSharp.EmitContext,Mono.CSharp.Attributable,System.Collections.Specialized.ListDictionary)
</I>&gt;<i> in &lt;0x0000011c&gt; Mono.CSharp.Attributes:Emit (Mono.CSharp.EmitContext,Mono.CSharp.Attributable)
</I>&gt;<i> in &lt;0x0000012c&gt; Mono.CSharp.Parameter:DefineParameter (Mono.CSharp.EmitContext,System.Reflection.Emit.MethodBuilder,System.Reflection.Emit.ConstructorBuilder,int,Mono.CSharp.Location)
</I>&gt;<i> in &lt;0x00000158&gt; Mono.CSharp.Parameters:LabelParameters (Mono.CSharp.EmitContext,System.Reflection.MethodBase,Mono.CSharp.Location)
</I>&gt;<i> in &lt;0x0000027a&gt; Mono.CSharp.MethodData:Emit (Mono.CSharp.TypeContainer,Mono.CSharp.Attributable)
</I>&gt;<i> in &lt;0x00000032&gt; Mono.CSharp.Method:Emit ()
</I>&gt;<i> in &lt;0x000007d2&gt; Mono.CSharp.TypeContainer:EmitType ()
</I>&gt;<i> in &lt;0x00000672&gt; Mono.CSharp.RootContext:EmitCode ()
</I>&gt;<i> in &lt;0x00001334&gt; Mono.CSharp.Driver:MainDriver (string[])
</I>&gt;<i> in &lt;0x00000026&gt; Mono.CSharp.Driver:Main (string[])
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> Hello, Neale.
</I>&gt;<i> 
</I>&gt;<i> You could use:
</I>&gt;<i> 
</I>&gt;<i> extern static void f([MarshalAs(UnmanagedType.LPArray] byte[] p, int size);
</I>&gt;<i> 
</I>&gt;<i> C function:
</I>&gt;<i> void f(char* p, int size) {}
</I>&gt;<i> 
</I>&gt;<i> C# call:
</I>&gt;<i> 
</I>&gt;<i> byte[] val = new byte[1024];
</I>&gt;<i> 
</I>&gt;<i> f(val, val.Length);
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
Dmitry Kostenko
.NET Developer

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="024072.html">[Mono-list] Marshalling byte[]
</A></li>
	<LI> Next message: <A HREF="024091.html">[Mono-list] Ask Microsoft: Mono support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24074">[ date ]</a>
              <a href="thread.html#24074">[ thread ]</a>
              <a href="subject.html#24074">[ subject ]</a>
              <a href="author.html#24074">[ author ]</a>
         </LI>
       </UL>
</body></html>
