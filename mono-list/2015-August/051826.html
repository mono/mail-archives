<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Configuration.SectionGroups type cast problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Configuration.SectionGroups%20type%20cast%20problem&In-Reply-To=%3CCAG7rGv465sDRdMeHe5vHg4KUmq-HVL5JZnRMzoTUi6i2Uf8rNw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="051823.html">
   <LINK REL="Next"  HREF="051827.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Configuration.SectionGroups type cast problem</H1>
    <B>Danny Gorton</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Configuration.SectionGroups%20type%20cast%20problem&In-Reply-To=%3CCAG7rGv465sDRdMeHe5vHg4KUmq-HVL5JZnRMzoTUi6i2Uf8rNw%40mail.gmail.com%3E"
       TITLE="[Mono-list] Configuration.SectionGroups type cast problem">dgortonii at gmail.com
       </A><BR>
    <I>Mon Aug 24 14:38:11 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="051823.html">[Mono-list] Issues with concurrent HttpWebRequests
</A></li>
        <LI>Next message: <A HREF="051827.html">[Mono-list] Garbage collector problem ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51826">[ date ]</a>
              <a href="thread.html#51826">[ thread ]</a>
              <a href="subject.html#51826">[ subject ]</a>
              <a href="author.html#51826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all.  I searched the list archives (using google) and couldn't find
anything related to this issue.

My environment is:

Linux raspberrypi 3.12.35+ #730 PREEMPT Fri Dec 19 18:31:24 GMT 2014 armv6l
GNU/Linux and Mono JIT compiler version 3.2.8 (Debian 3.2.8+dfsg-4+rpi1).
I develop on Windows with VS.NET and automate builds on Linux/Mono and test
on Windows and Raspbian (ARM) and Ubuntu.  Most of the time it *just
works*, but every once in a while I run into some weird differences between
.NET and Mono.

My product is a daemon with ServiceStack 3.9.x embedded to provide web
services.  I have features for altering server configuration options
through a web UI.  When that web service is called it looks for specific
ConfigurationSection instances (some custom, some standard) by iterating
the configuration hierarchy, through the SectionGroups
(ConfigurationSectionGroupCollection) on downward until it finds a match.
Here is one example:

            foreach (Config.ConfigurationSectionGroup group in
_config.SectionGroups)
            {
                ......
            }

In this code _config is a System.Configuration.Configuration instance and
this code works on .NET (Windows 7), but breaks on Mono on the foreach line
with:

System.InvalidCastException: Cannot cast from source type to destination
type.

For some reason the contents of SectionGroups don't seem to be
ConfigurationSectionGroup objects. So I put in some debug logging like this:

            if (_log.IsDebugEnabled)
            {
                StringBuilder sb = new StringBuilder();
                sb.AppendLine(string.Format(&quot;Configuration has [{0}]
section groups:&quot;, _config.SectionGroups.Count));
                foreach(object o in _config.SectionGroups)
                {
                    sb.AppendLine(string.Format(&quot;\tSectionGroup of type:
[{0}] is [{1}]&quot;, o.GetType().FullName, o));
                }
                _log.Debug(sb.ToString());
            }

The output on .NET shows the right types (don't have an example handy right
now).  The output on Mono looks like:

2015-08-23 21:59:14,945 [Threadpool worker] DEBUG raspberrypi
ConfigurationHandler.getSection (line 0) - Configuration has [5] section
groups:
        SectionGroup of type: [System.String] is [system.web]
        SectionGroup of type: [System.String] is [system.net]
        SectionGroup of type: [System.String] is [system.serviceModel]
        SectionGroup of type: [System.String] is [system.transactions]
        SectionGroup of type: [System.String] is [apac]

As you can see, the types are string and the values are the names of the
section groups in question.  I've looked at the code history for
ConfiguratoinSectionGroupCollection and Configuration.SectionGroups and I
don't see where either was ever written to store just simple strings,
though I may be missing something.

My &lt;configSections&gt; element is:
  &lt;configSections&gt;
    &lt;sectionGroup name=&quot;apac&quot;
type=&quot;System.Configuration.ConfigurationSectionGroup, System.Configuration,
Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;&gt;
      &lt;section name=&quot;default&quot;
type=&quot;Apac.Configuration.XmlSerializingConfigSection, apac.core&quot;/&gt;
      &lt;section name=&quot;pluginPaths&quot;
type=&quot;Apac.Configuration.NameMultipleValueSectionHandler, apac.core&quot;/&gt;
    &lt;/sectionGroup&gt;
      &lt;!-- APAC Messaging Configuration--&gt;
    &lt;section
 name=&quot;apac.messaging&quot;
 type=&quot;Apac.Configuration.MessageControllerConfigSection, apac.core&quot;
 restartOnExternalChanges=&quot;true&quot; /&gt;

      &lt;!-- APAC Licensing Configuration--&gt;
      &lt;section name=&quot;apac.licensing&quot;

 type=&quot;Apac.Licensing.Configuration.LicensingConfigurationSection,
apac.licensing&quot;
               restartOnExternalChanges=&quot;true&quot;/&gt;
  &lt;/configSections&gt;

Anyone have any idea why this would be happening?

Regards,
Danny
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20150824/f122552c/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20150824/f122552c/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="051823.html">[Mono-list] Issues with concurrent HttpWebRequests
</A></li>
	<LI>Next message: <A HREF="051827.html">[Mono-list] Garbage collector problem ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51826">[ date ]</a>
              <a href="thread.html#51826">[ thread ]</a>
              <a href="subject.html#51826">[ subject ]</a>
              <a href="author.html#51826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
