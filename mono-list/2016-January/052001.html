<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono, Windows Forms, and Headless operation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%2C%20Windows%20Forms%2C%20and%20Headless%20operation&In-Reply-To=%3CD2B4339D.1838%25glover.e.george%40erdc.dren.mil%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="052000.html">
   <LINK REL="Next"  HREF="052002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono, Windows Forms, and Headless operation</H1>
    <B>George, Glover E ERDC-RDE-ITL-MS</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%2C%20Windows%20Forms%2C%20and%20Headless%20operation&In-Reply-To=%3CD2B4339D.1838%25glover.e.george%40erdc.dren.mil%3E"
       TITLE="[Mono-list] Mono, Windows Forms, and Headless operation">Glover.E.George at erdc.dren.mil
       </A><BR>
    <I>Thu Jan  7 21:24:14 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="052000.html">[Mono-list] Massive performance slowdown in C# SOAP client when one AppDomain per thread versus just one (ie the primary) AppDomain
</A></li>
        <LI>Next message: <A HREF="052002.html">[Mono-list] Mono, Windows Forms, and Headless operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52001">[ date ]</a>
              <a href="thread.html#52001">[ thread ]</a>
              <a href="subject.html#52001">[ subject ]</a>
              <a href="author.html#52001">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

We&#8217;re currently porting a Windows Forms Application to Mono, and have generally had great success.  However, we have now hit a critical decision point, and were hoping for some guidance on the best route forward.   If we don&#8217;t have X11, mono fails to run Windows Forms code with the following error:

From: System.Windows.Forms, at: Void .ctor(), Error Message: The type initializer for 'System.Windows.Forms.WindowsFormsSynchronizationContext' threw an exception.

Question First:
The main question I had for the Mono list is this.  Is it possible to have mono run Windows Forms code without trying to open X11 (I.e. headless mode)?  What triggers mono to request an X11 display? Is it the project type?  Is it the call to an object that inherits from a Windows Forms control?  I don&#8217;t need to see the form, but if I&#8217;m using BackgroundWorkers, I need the form's event handler, don&#8217;t I?

Details Last:
Requirements dictate that make every attempt possible to keep a single code base.  I.e., either if&#8217;s or #ifdefs if different code needs to run on Linux than on Windows.

The code uses multiple concurrent BackgroundWorkers (it&#8217;s a .net 2.0 app, and we currently don&#8217;t have permission to move it to 4.0 and thread pools) that process data in parallel.  We&#8217;re trying to run this code on a large Linux-based HPC system that uses a batch (PBS) queueing system.  The problem is that we do not have X11  available on the compute nodes (well, at least not unless we&#8217;re in interactive mode, and that&#8217;s against the requirements).  There is a large amount of logic that is tied into using BackgroundWorkers, and those seem to require a visible form to provide an event loop to handle events generated by the BackgroundWorkers.  Essentially, this app was designed to only be run interactively, but now we&#8217;re both parallelizing it, as well as giving it a headless option (I.e. if a command line option is given, we&#8217;re running with no GUI).

1. We tried creating a Windows Console app in Visual Studio, essentially a driver, that then instantiated the the forms and ran them.  Although nothing is shown on the screen, it still required us to use X11. giving the error at the top of this message.

2.  We tried just not using BackgroundWorkers.  This meant the code was single threaded, but it still relies on logic in the Windows forms.  We could move this logic to classes that don&#8217;t have anything to do with Windows Forms, but now we have two code bases, essentially.  However, it still fails even though we don&#8217;t display anything on screen, we get the error at the top of this message.

3.  Xvfb.  This works on local VM&#8217;s, but not on our cluster, which we don&#8217;t have admin rights to (it&#8217;s not installed).  There is a possibility that we could install X11-Xvfb from source, but this seems overkill.

4.  Worst case option - remove all background worker logic, and change it to just use C# threads.  REALLY don&#8217;t want to do this if we don&#8217;t have to.

I know this may be confusing, and if so, please feel free to ask for clarifications, or even just to say &#8220;Why would you want to do that?&#8221;

Cheers.
&#8212; &#8212; &#8212;
Glover E. George
Computer Scientist
Information Technology Laboratory
US Army Engineer Research and Development Center
Vicksburg, MS 39180
601-634-4730

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20160107/72489366/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20160107/72489366/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="052000.html">[Mono-list] Massive performance slowdown in C# SOAP client when one AppDomain per thread versus just one (ie the primary) AppDomain
</A></li>
	<LI>Next message: <A HREF="052002.html">[Mono-list] Mono, Windows Forms, and Headless operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52001">[ date ]</a>
              <a href="thread.html#52001">[ thread ]</a>
              <a href="subject.html#52001">[ subject ]</a>
              <a href="author.html#52001">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
