<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Array.Copy performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tum%40veridicus.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="010054.html">
   <LINK REL="Next"  HREF="010047.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Array.Copy performance
   </H1>
    <B>Tum
    </B> 
    <A HREF="mailto:tum%40veridicus.com"
       TITLE="[Mono-list] Array.Copy performance">tum@veridicus.com
       </A><BR>
    <I>Wed, 4 Dec 2002 02:53:32 +1300</I>
    <P><UL>
        <LI> Previous message: <A HREF="010054.html">[Mono-list] Re: ASP.Net
</A></li>
        <LI> Next message: <A HREF="010047.html">[Mono-list] Array.Copy performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10045">[ date ]</a>
              <a href="thread.html#10045">[ thread ]</a>
              <a href="subject.html#10045">[ subject ]</a>
              <a href="author.html#10045">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I was writing a program that was making heavy use of Array.Copy to copy
small amounts of data (the data consisted of 4 byte audio frames).

The MS jitter seems to inline Array.Copy (memcpy?) because it performs
over 10 times faster than Mono.

Here's some test code:

using System;

public class Test
{
	public static void Main()
	{
		int size = 4;
		byte[] src, des;
		long ticks;

		src = new byte[size];
		des = new byte[size];

		ticks = System.Environment.TickCount;

		for (int i = 0; i &lt; 3000000; i++)
		{
			Array.Copy(src, 0, des, 0, size);
		}

		Console.WriteLine(System.Environment.TickCount - ticks);
	}
}

I'm getting about 1312ms on .NET and 18106ms on Mono.  13 times slower
:<i>(.
</I>
I've since rewritten my code to make copies in larger chunks and the CPU
usage is now comparable to .NET.  

How hard would it be to inline Array.Copy with the current jitter
implementation [I haven't explored the code much]?


Wibble.

^Tum




</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="010054.html">[Mono-list] Re: ASP.Net
</A></li>
	<LI> Next message: <A HREF="010047.html">[Mono-list] Array.Copy performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10045">[ date ]</a>
              <a href="thread.html#10045">[ thread ]</a>
              <a href="subject.html#10045">[ subject ]</a>
              <a href="author.html#10045">[ author ]</a>
         </LI>
       </UL>
</body></html>
