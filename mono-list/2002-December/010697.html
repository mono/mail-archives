<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] replacement for mscoree.dll
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:japj%40xs4all.nl">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="010698.html">
   <LINK REL="Next"  HREF="010701.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] replacement for mscoree.dll
   </H1>
    <B>Jeroen Janssen
    </B> 
    <A HREF="mailto:japj%40xs4all.nl"
       TITLE="[Mono-list] replacement for mscoree.dll">japj@xs4all.nl
       </A><BR>
    <I>Mon, 30 Dec 2002 16:53:23 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="010698.html">[Mono-list] mcs needs mscorlib!! - Why?
</A></li>
        <LI> Next message: <A HREF="010701.html">[Mono-list] replacement for mscoree.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10697">[ date ]</a>
              <a href="thread.html#10697">[ thread ]</a>
              <a href="subject.html#10697">[ subject ]</a>
              <a href="author.html#10697">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I don't know if anyone has worked on this yet, but I did a small 
experiment creating a replacement for mscoree.dll.
It's very &quot;rude&quot;, but it works for simple applications (just a &quot;proof of 
concept&quot;). Maybe someone is interested in working on this in the near 
future.

This is how it works (as far as I understand):
When you build a .NET executable you get a PE executable. This consists 
out of 2 parts: the.NET code and a small stub (x86 code).
The stub references mscoree.dll and calls a function. For simple 
applications it calls _CorExeMain (there are some other function in 
there, but this is the one I used).

Now, this _CorExeMain function can locate a decent .NET runtime 
(example: Mono) and have it execute the .NET code contained in the PE file.

What I did was very simple: just find out what the commandline (exe 
filename) was and call the mono.bat file (from the mono for windows 
distribution) with the found exe (as I said, &quot;very rude&quot;).

D:\sandbox\mscortest&gt;test.exe
mscorlib, Version=1.0.3300.0, Culture=neutral, 
PublicKeyToken=b77a5c561934e089

D:\sandbox\mscortest&gt;copy ..\mscoree.dll
        1 file(s) copied.

D:\sandbox\mscortest&gt;test.exe
_CorExeMain&gt; going to execute Mono with [test.exe]
mscorlib, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null

_CorExeMain&gt; Press Any Key to Exit

D:\sandbox\mscortest&gt;

Now the next step(s) could be
* directly call the mono jit/interpreter api in order to execute the 
.NET code (can this be done?)
* correctly find out the application path (path to .exe) + parameters 
passed on the commandline

p.s. I can send the example code if anyone wants (5kb zipfile, VS7 project)
---
Jeroen



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="010698.html">[Mono-list] mcs needs mscorlib!! - Why?
</A></li>
	<LI> Next message: <A HREF="010701.html">[Mono-list] replacement for mscoree.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10697">[ date ]</a>
              <a href="thread.html#10697">[ thread ]</a>
              <a href="subject.html#10697">[ subject ]</a>
              <a href="author.html#10697">[ author ]</a>
         </LI>
       </UL>
</body></html>
