<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] A vaguely POSIXy Getopt class.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jmallett%40FreeBSD.ORG">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="010343.html">
   <LINK REL="Next"  HREF="010375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] A vaguely POSIXy Getopt class.
   </H1>
    <B>Juli Mallett
    </B> 
    <A HREF="mailto:jmallett%40FreeBSD.ORG"
       TITLE="[Mono-list] A vaguely POSIXy Getopt class.">jmallett@FreeBSD.ORG
       </A><BR>
    <I>Fri, 13 Dec 2002 14:51:02 -0800</I>
    <P><UL>
        <LI> Previous message: <A HREF="010343.html">[Mono-list] mcs compile/install - Linux
</A></li>
        <LI> Next message: <A HREF="010375.html">[Mono-list] A vaguely POSIXy Getopt class.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10340">[ date ]</a>
              <a href="thread.html#10340">[ thread ]</a>
              <a href="subject.html#10340">[ subject ]</a>
              <a href="author.html#10340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I wanted to write some apps that'd take arguments in the POSIXy way,
and so I decided to implement a Getopt class which provides all the
common things, and aside from the fact that I use an exception to
show the end of args (other than using an output parameter boolean
and checking that, I couldn't think of a saneish way), I'm fairly
happy with it.  I have no idea if anyone but me would even begin to
find this useful, but it follows in this message, and the usage is
such (it will even do a lazy usage() style message for you, if you
don't want to construct a prettier one yourself):

% public static void Main(string[] args)
% {
% 	Getopt getopt = new Getopt(args, &quot;a:b&quot;);
% 	char ch;
% 	for (;;) {
% 		try {
% 			ch = getopt.Next();
% 		} catch (IndexOutOfRangeException) {
% 			goto EndOfArgs;
% 		} catch (Exception e) {
% 			Console.WriteLine(&quot;Getopt got {0}&quot;, e);
% 			System.Environment.Exit(1);
% 			//Notreached.
% 			return;
% 		}
% 		switch (ch) {
% 		case 'a':
% 			Console.WriteLine(&quot;Got -a with arg {0}&quot;, getopt.OptionArgument);
% 			break;
% 		case 'b':
% 			Console.WriteLine(&quot;Got -b&quot;);
% 			break;
% 		case '?':
% 		default:
% 			getopt.Usage();
% 			System.Environment.Exit(1);
% 			//Notreached.
% 			return;
% 		}
% 	}
% EndOfArgs:
% 	// Finished argument parsing.

And here's getopt.cs:

%%%
using System;
using System.Reflection;

class Getopt
{
	public static char BadCharacter = '?';
	public static char BadArgument = ':';

	public bool Error = true;
	public int Index = 0;
	public char Option;
	public bool Reset;
	public string OptionArgument;

	public string ProgramName;

	private Assembly CallingAssembly;

	private int Length;
	private string[] Array;
	private string Options;

	private string Place;

	public Getopt(string progname, int argc, string[] argv, string ostr)
	{
		CallingAssembly = System.Reflection.Assembly.GetEntryAssembly();
		Length = argc;
		Array = argv;
		Options = ostr;
		if (progname == null)
			progname = CallingAssembly.ToString();
		ProgramName = progname;
	}

	public Getopt(string progname, string[] argv, string ostr)
	: this(progname, argv.Length, argv, ostr)
	{
	}

	public Getopt(int argc, string[] argv, string ostr)
	: this(null, argc, argv, ostr)
	{
	}

	public Getopt(string[] argv, string ostr)
	: this(argv.Length, argv, ostr)
	{
	}

	public void Usage()
	{
		string iterator;
		string usageString;

		usageString = String.Format(&quot;usage: {0}&quot;, ProgramName);

		iterator = Options;
		if (iterator == null) {
			Console.WriteLine(usageString);
			return;
		}
		if (iterator[0] == ':') {
			iterator = GetStringNext(iterator);
		}
		if (iterator == null) {
			Console.WriteLine(usageString);
			return;
		}
		do {
			if (iterator.Length == 0)
				break;
			char optionFlag = iterator[0];
			usageString += String.Format(&quot; -{0}&quot;, optionFlag);
			if (iterator.Length &gt; 1) {
				if (iterator[1] == ':') {
					usageString += &quot; &lt;argument&gt;&quot;;
					iterator = GetStringNext(iterator);
				}
			}
			iterator = GetStringNext(iterator);
		} while (iterator != null);
		Console.WriteLine(usageString);
	}

	public char Next()
	{
		if (Place == null)
			Place = &quot;&quot;;
		if (Reset || Place.Length == 0) {
			Reset = false;
			if (Index &gt;= Length || (Place = Array[Index])[0] != '-') {
				Place = null;
				throw new IndexOutOfRangeException();
			}
			if (Place[0] == '-' &amp;&amp; Place[1] == '-') {
				Index++;
				Place = null;
				throw new IndexOutOfRangeException();
			}
			Place = GetStringNext(Place);
		}

		Option = Place[0];
		Place = GetStringNext(Place);
		if (Place == null)
			throw new IndexOutOfRangeException();
		int optionLetterIndex = Options.IndexOf(Option);
		if (Option == ':' || optionLetterIndex == -1) {
			if (Option == '-')
				throw new IndexOutOfRangeException();
			if (Place.Length == 0)
				Index++;
			if (Error &amp;&amp; Options[0] != ':' &amp;&amp; Option != BadCharacter)
				Console.WriteLine(&quot;{0}: illegal option -- {1}&quot;, ProgramName, Option);
			return BadCharacter;
		}
		if (Options[optionLetterIndex + 1] != ':') {
			OptionArgument = null;
			if (Place.Length == 0)
				Index++;
		} else {
			if (Place.Length != 0)
				OptionArgument = Place;
			else if (Length &lt;= ++Index) {
				Place = null;
				if (Options[0] != ':')
					return BadArgument;
				if (Error)
					Console.WriteLine(&quot;{0}: option requires an argument -- {1}&quot;, ProgramName, Option);
				return BadCharacter;
			} else
				OptionArgument = Array[Index];
			Place = null;
			Index++;
		}
		return Option;
	}

	private string GetStringNext(string ThisString)
	{
		try {
			ThisString = ThisString.Substring(1);
		} catch {
			ThisString = null;
		}
		return ThisString;

	}
}
%%%

Thanx &amp; let me know if you find it useful,
juli.
-- 
Juli Mallett &lt;<A HREF="mailto:jmallett@FreeBSD.org">jmallett@FreeBSD.org</A>&gt;
OpenDarwin, Mono, FreeBSD Developer.
ircd-hybrid Developer, EFnet addict.
FreeBSD on MIPS-Anything on FreeBSD.


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="010343.html">[Mono-list] mcs compile/install - Linux
</A></li>
	<LI> Next message: <A HREF="010375.html">[Mono-list] A vaguely POSIXy Getopt class.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10340">[ date ]</a>
              <a href="thread.html#10340">[ thread ]</a>
              <a href="subject.html#10340">[ subject ]</a>
              <a href="author.html#10340">[ author ]</a>
         </LI>
       </UL>
</body></html>
