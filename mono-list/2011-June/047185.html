<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mod-mono apache asp.net request cancelled by other request
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20mod-mono%20apache%20asp.net%20request%20cancelled%20by%20other%0A%20request&In-Reply-To=1307646165.2819.12.camel%40LnxWorkstation">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="047184.html">
   <LINK REL="Next"  HREF="047186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mod-mono apache asp.net request cancelled by other request</H1>
    <B>Peter Hagen</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20mod-mono%20apache%20asp.net%20request%20cancelled%20by%20other%0A%20request&In-Reply-To=1307646165.2819.12.camel%40LnxWorkstation"
       TITLE="[Mono-list] mod-mono apache asp.net request cancelled by other request">peter at wingsofdeath.net
       </A><BR>
    <I>Fri Jun 10 05:50:47 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="047184.html">[Mono-list] mod-mono apache asp.net request cancelled by other	request
</A></li>
        <LI>Next message: <A HREF="047186.html">[Mono-list] Cairo showtext and umlauts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47185">[ date ]</a>
              <a href="thread.html#47185">[ thread ]</a>
              <a href="subject.html#47185">[ subject ]</a>
              <a href="author.html#47185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

I solved my issue, by keeping the bufferOutput on true, but calling the
Response.Flush(). I seemed, by accident, to call the
Response.OutputStream.Flush() which doesn't have the same effect. Now
the file is downloaded without buffering it completely in memory, and
without the socket being closed (although this is still something that
should not have happened, I guess).

Cheers

Peter

On Thu, 2011-06-09 at 21:02 +0200, Peter Hagen wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> today I found an issue with my mono 2.10.2 + apache setup, which I
</I>&gt;<i> cant figure out what is wrong with it. Hopefully someone has some
</I>&gt;<i> similar experience. I run a site, which has a aspx page, but also uses
</I>&gt;<i> iHttpHandler's. There is a handler that queries the database and with
</I>&gt;<i> small buffers sends it to the client. For this the
</I>&gt;<i> Response.BufferOutput is set to false, and that works perfectly. It
</I>&gt;<i> starts downloading directly. Today I was testing a big fill on our
</I>&gt;<i> development site, which runs on the same machine as the live site, and
</I>&gt;<i> suddenly noticed, on the apache server, that while during the
</I>&gt;<i> download, and I called another request, even from another host, my
</I>&gt;<i> download is cancelled. I tested it after that with XSP on the same
</I>&gt;<i> machine (and later on another server) and there it works without a
</I>&gt;<i> problem. So it seems to be a combination with mod-mono or apache
</I>&gt;<i> maybe. In all cases, I see first a message like this in the error.log
</I>&gt;<i> (the number changes):
</I>&gt;<i> 
</I>&gt;<i> [Thu Jun 09 20:44:48 2011] [error] Unknown command: 2004184946
</I>&gt;<i> 
</I>&gt;<i> And after that the exception is posted to the error log:
</I>&gt;<i> 
</I>&gt;<i> [vspdev|09-06-2011 20:45:18|11] Exception in
</I>&gt;<i> _ExecuteActionXML::element=unknown1
</I>&gt;<i> [vspdev|09-06-2011 20:45:18|11] System.Net.Sockets.SocketException
</I>&gt;<i> [vspdev|09-06-2011 20:45:18|11] The socket has been shut down
</I>&gt;<i> [vspdev|09-06-2011 20:45:18|11]   at System.Net.Sockets.Socket.Send
</I>&gt;<i> (System.Byte[] buf, Int32 size, SocketFlags flags) [0x00000] in
</I>&gt;<i> &lt;filename unknown&gt;:0 
</I>&gt;<i>   at Mono.WebServer.ModMonoRequest.Send () [0x00000] in &lt;filename
</I>&gt;<i> unknown&gt;:0 
</I>&gt;<i>   at Mono.WebServer.ModMonoRequest.SendResponseFromMemory
</I>&gt;<i> (System.Byte[] data, Int32 position, Int32 length) [0x00000] in
</I>&gt;<i> &lt;filename unknown&gt;:0 
</I>&gt;<i>   at Mono.WebServer.ModMonoWorker.Write (System.Byte[] buffer, Int32
</I>&gt;<i> position, Int32 size) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>   at Mono.WebServer.ModMonoWorkerRequest.SendResponseFromMemory
</I>&gt;<i> (System.Byte[] data, Int32 length) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>   at System.Web.HttpResponseStream.Write (System.Byte[] buffer, Int32
</I>&gt;<i> offset, Int32 count) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>   at System.Web.HttpWriter.WriteString (System.String s, Int32 index,
</I>&gt;<i> Int32 count) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>   at System.Web.HttpWriter.Write (System.String s) [0x00000] in
</I>&gt;<i> &lt;filename unknown&gt;:0 
</I>&gt;<i>   at Willow.Data.Converter.CsvStorage.Save () [0x00000] in &lt;filename
</I>&gt;<i> unknown&gt;:0 
</I>&gt;<i>   at Willow.Data.Converter.CsvStorage.Dispose () [0x00000] in
</I>&gt;<i> &lt;filename unknown&gt;:0 
</I>&gt;<i>   at Willow.Cms.Common.CollectionPlugin.CollectionToFile
</I>&gt;<i> (System.Web.HttpResponse response, iCmsFormControlValues values,
</I>&gt;<i> Willow.Cms.Common.ActionResult result, iWillowDataCollection
</I>&gt;<i> collection, System.String TempFile, System.String OutputFilename,
</I>&gt;<i> System.String Filetype, Willow.Common.WillowXmlElement
</I>&gt;<i> FileSettingsXml) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>   at Willow.Cms.Common.WillowFormControl.DownloadCollection
</I>&gt;<i> (Willow.Cms.Common.ActionResult result, System.String Filename,
</I>&gt;<i> System.String Filetype, iWillowDataCollection collection,
</I>&gt;<i> Willow.Common.WillowXmlElement FileSettingsXml) [0x00000] in &lt;filename
</I>&gt;<i> unknown&gt;:0 
</I>&gt;<i>   at Willow.Cms.Common.WillowFormControl.DownloadFile
</I>&gt;<i> (Willow.Cms.Common.ActionResult result, Willow.Common.WillowXmlElement
</I>&gt;<i> xml) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i>   ...
</I>&gt;<i> 
</I>&gt;<i> Somehow, the socket is just being closed. As far as I know, this is
</I>&gt;<i> happening since today, but I also tried older revisions of the code,
</I>&gt;<i> and they have the same effect. While searching for an answer, I also
</I>&gt;<i> restarted the server and after that the live site does the same thing.
</I>&gt;<i> i cant be 100% sure that the live site (with a bit older code) was
</I>&gt;<i> working 100% ok before. So, anyone any idea? Been searching, testing
</I>&gt;<i> and trying all day, and have no clue were to look for this. 
</I>&gt;<i> 
</I>&gt;<i> Cheers
</I>&gt;<i> 
</I>&gt;<i> Peter
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20110610/d5ed515e/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20110610/d5ed515e/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="047184.html">[Mono-list] mod-mono apache asp.net request cancelled by other	request
</A></li>
	<LI>Next message: <A HREF="047186.html">[Mono-list] Cairo showtext and umlauts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47185">[ date ]</a>
              <a href="thread.html#47185">[ thread ]</a>
              <a href="subject.html#47185">[ subject ]</a>
              <a href="author.html#47185">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
