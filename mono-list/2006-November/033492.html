<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] prototype XSLT debugging patch ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20prototype%20XSLT%20debugging%20patch%20...&In-Reply-To=1164397861.9088.442.camel%40t60p.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033488.html">
   <LINK REL="Next"  HREF="033509.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] prototype XSLT debugging patch ...</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20prototype%20XSLT%20debugging%20patch%20...&In-Reply-To=1164397861.9088.442.camel%40t60p.site"
       TITLE="[Mono-list] prototype XSLT debugging patch ...">atsushi at ximian.com
       </A><BR>
    <I>Fri Nov 24 22:37:00 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="033488.html">[Mono-list] prototype XSLT debugging patch ...
</A></li>
        <LI>Next message: <A HREF="033509.html">[Mono-list] prototype XSLT debugging patch ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33492">[ date ]</a>
              <a href="thread.html#33492">[ thread ]</a>
              <a href="subject.html#33492">[ subject ]</a>
              <a href="author.html#33492">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

Ok, now I understand what you originally wanted. I was thinking that
you want either trimmed information to hide stack trace details, or
want working XSLT debugger which is not realistic at this state
(as I'm not working on sys.xml and primarily working on web service
related stuff, except for important bug fixes).

Your patch shows interesting error information and I'd love to
get this functionality in svn. But I don't think it should be
&quot;always&quot; shown to users. An immediate concern example is that
since XSLT could be designed to work recursively, this detailed
information could be hundreds of lines. Also this patch ends up
to hide exact problematic code location. So I think something
like environment variable should be used to &quot;enable&quot; this
detailed report.

Atsushi Eno

Michael Meeks wrote:
&gt;<i> Hi dudie,
</I>&gt;<i> 
</I>&gt;<i> 	So - of course this builds the frames on the exception - we could of
</I>&gt;<i> course alternatively dump them to Debug.WriteLine [ or perhaps something
</I>&gt;<i> easier to get at for the hacker without re-compiling mono ].
</I>&gt;<i> 
</I>&gt;<i> 	Either way, this turns my 100 line, unreadable barf into the appended,
</I>&gt;<i> which I hope is much more useful (?)
</I>&gt;<i> 
</I>&gt;<i> 	Patch attached, what do you think ? I'll try to catch you tomorrow on
</I>&gt;<i> IRC to chew it over (?) :-)
</I>&gt;<i> 
</I>&gt;<i> 	Thanks,
</I>&gt;<i> 
</I>&gt;<i> 		Michael.
</I>&gt;<i> 
</I>&gt;<i> [ERROR][/tmp/tst.docx] Conversion failed - Error during conversion
</I>&gt;<i> [DEBUG][/tmp/tst.docx] Error during processing:  at <A HREF="zip://localhost/word/document.xml(2,3076">zip://localhost/word/document.xml(2,3076</A>). from
</I>&gt;<i> xsl:template child::<A HREF="http://schemas.openxmlformats.org/wordprocessingml/2006/main:p">http://schemas.openxmlformats.org/wordprocessingml/2006/main:p</A> at <A HREF="assembly://localhost/content.xsl(336,46">assembly://localhost/content.xsl(336,46</A>) from
</I>&gt;<i> xsl:template child::<A HREF="http://schemas.openxmlformats.org/wordprocessingml/2006/main:p">http://schemas.openxmlformats.org/wordprocessingml/2006/main:p</A> at <A HREF="assembly://localhost/content.xsl(244,29">assembly://localhost/content.xsl(244,29</A>) from
</I>&gt;<i> xsl:template child::<A HREF="http://schemas.openxmlformats.org/wordprocessingml/2006/main:tc">http://schemas.openxmlformats.org/wordprocessingml/2006/main:tc</A> at <A HREF="assembly://localhost/tables.xsl(80,30">assembly://localhost/tables.xsl(80,30</A>) from
</I>&gt;<i> xsl:template child::<A HREF="http://schemas.openxmlformats.org/wordprocessingml/2006/main:tr">http://schemas.openxmlformats.org/wordprocessingml/2006/main:tr</A> at <A HREF="assembly://localhost/tables.xsl(57,30">assembly://localhost/tables.xsl(57,30</A>) from
</I>&gt;<i> xsl:template child::<A HREF="http://schemas.openxmlformats.org/wordprocessingml/2006/main:tbl">http://schemas.openxmlformats.org/wordprocessingml/2006/main:tbl</A> at <A HREF="assembly://localhost/tables.xsl(37,31">assembly://localhost/tables.xsl(37,31</A>) from
</I>&gt;<i> xsl:template  at <A HREF="assembly://localhost/content.xsl(55,32">assembly://localhost/content.xsl(55,32</A>) from
</I>&gt;<i> xsl:template self::node-type [Root]()/child::urn:oox:source at (51,6)(  at Mono.Xml.Xsl.XslTemplate.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p, System.Col
</I>&gt;<i> lections.Hashtable withParams) [0x0010a] in /data/mono/mcs/class/System.XML/Mono.Xml.Xsl/XslTemplate.cs:412 
</I>&gt;<i>   at Mono.Xml.Xsl.XslTransformProcessor.ApplyTemplates (System.Xml.XPath.XPathNodeIterator nodes, System.Xml.XmlQualifiedName mode, System.Collections.ArrayLi
</I>&gt;<i> st withParams) [0x0002e] in /data/mono/mcs/class/System.XML/Mono.Xml.Xsl/XslTransformProcessor.cs:244 
</I>&gt;<i>   at Mono.Xml.Xsl.Operations.XslApplyTemplates.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p) [0x0005a] in /data/mono/mcs/class/System.XML/Mono.Xml.Xsl.Opera
</I>&gt;<i> tions/XslApplyTemplates.cs:105 
</I>&gt;<i>   at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p) [0x0002a] in /data/mono/mcs/class/System.XML/Mono.Xml.Xsl.Oper
</I>&gt;<i> ations/XslTemplateContent.cs:193 
</I>&gt;<i>   at Mono.Xml.Xsl.Operations.XslChoose.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p) [0x00047] in /data/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/Xs
</I>&gt;<i> lChoose.cs:92 
</I>&gt;<i>   at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p) [0x0002a] in /data/mono/mcs/class/System.XML/Mono.Xml.Xsl.Oper
</I>&gt;<i> ations/XslTemplateContent.cs:193 
</I>&gt;<i>   at Mono.Xml.Xsl.XslTemplate.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p, System.Collections.Hashtable withParams) [0x000ca] in /data/mono/mcs/class/Syste
</I>&gt;<i> m.XML/Mono.Xml.Xsl/XslTemplate.cs:403 )
</I>&gt;<i> Done.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> Index: class/System.XML/System.Xml.Xsl/XsltException.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- class/System.XML/System.Xml.Xsl/XsltException.cs	(revision 67841)
</I>&gt;<i> +++ class/System.XML/System.Xml.Xsl/XsltException.cs	(working copy)
</I>&gt;<i> @@ -64,6 +64,7 @@
</I>&gt;<i>  		int lineNumber;
</I>&gt;<i>  		int linePosition;
</I>&gt;<i>  		string sourceUri;
</I>&gt;<i> +		string xsltFrames;
</I>&gt;<i>  
</I>&gt;<i>  		#endregion
</I>&gt;<i>  
</I>&gt;<i> @@ -132,7 +133,10 @@
</I>&gt;<i>  
</I>&gt;<i>  		public override string Message {
</I>&gt;<i>  			get {
</I>&gt;<i> -				return base.Message;
</I>&gt;<i> +			    string msg = base.Message;
</I>&gt;<i> +			    if (xsltFrames != null)
</I>&gt;<i> +				    msg += xsltFrames;
</I>&gt;<i> +			    return msg;
</I>&gt;<i>  			}
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i> @@ -157,6 +161,11 @@
</I>&gt;<i>  			info.AddValue (&quot;sourceUri&quot;, sourceUri);
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i> +		public void appendXsltFrame( string msg )
</I>&gt;<i> +		{
</I>&gt;<i> +		    xsltFrames += msg;
</I>&gt;<i> +		}
</I>&gt;<i> +
</I>&gt;<i>  		#endregion
</I>&gt;<i>  	}
</I>&gt;<i>  }
</I>&gt;<i> Index: class/System.XML/Mono.Xml.Xsl/XslStylesheet.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- class/System.XML/Mono.Xml.Xsl/XslStylesheet.cs	(revision 67841)
</I>&gt;<i> +++ class/System.XML/Mono.Xml.Xsl/XslStylesheet.cs	(working copy)
</I>&gt;<i> @@ -66,6 +66,7 @@
</I>&gt;<i>  
</I>&gt;<i>  		// stylesheet attributes
</I>&gt;<i>  		string version;
</I>&gt;<i> +		string baseURI;
</I>&gt;<i>  		XmlQualifiedName [] extensionElementPrefixes;
</I>&gt;<i>  		XmlQualifiedName [] excludeResultPrefixes;
</I>&gt;<i>  		ArrayList stylesheetNamespaces = new ArrayList ();
</I>&gt;<i> @@ -111,6 +112,10 @@
</I>&gt;<i>  			get { return version; }
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i> +		public string BaseURI {
</I>&gt;<i> +			get { return baseURI; }
</I>&gt;<i> +		}
</I>&gt;<i> +
</I>&gt;<i>  		public XslStylesheet ()
</I>&gt;<i>  		{
</I>&gt;<i>  		}
</I>&gt;<i> @@ -121,6 +126,8 @@
</I>&gt;<i>  			
</I>&gt;<i>  			templates = new XslTemplateTable (this);
</I>&gt;<i>  
</I>&gt;<i> +			baseURI = c.Input.BaseURI;
</I>&gt;<i> +
</I>&gt;<i>  			// move to root element
</I>&gt;<i>  			while (c.Input.NodeType != XPathNodeType.Element)
</I>&gt;<i>  				if (!c.Input.MoveToNext ())
</I>&gt;<i> Index: class/System.XML/Mono.Xml.Xsl/XslTemplate.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- class/System.XML/Mono.Xml.Xsl/XslTemplate.cs	(revision 67841)
</I>&gt;<i> +++ class/System.XML/Mono.Xml.Xsl/XslTemplate.cs	(working copy)
</I>&gt;<i> @@ -350,11 +360,19 @@
</I>&gt;<i>  				c.Input.MoveToParent ();
</I>&gt;<i>  			}
</I>&gt;<i>  		}
</I>&gt;<i> -		
</I>&gt;<i> +
</I>&gt;<i> +		void accumulateFrames(XsltException ex)
</I>&gt;<i> +		{
</I>&gt;<i> +		    XslCompiledElementBase op = (XslCompiledElementBase) content;
</I>&gt;<i> +		    ex.appendXsltFrame(&quot; from\nxsl:template &quot; + Match  + &quot; at &quot; +
</I>&gt;<i> +				       style.BaseURI + &quot;(&quot; + op.LineNumber + &quot;,&quot; + op.LinePosition + &quot;)&quot;);
</I>&gt;<i> +		}
</I>&gt;<i> +
</I>&gt;<i>  		public virtual void Evaluate (XslTransformProcessor p, Hashtable withParams)
</I>&gt;<i>  		{
</I>&gt;<i>  			p.PushStack (stackSize);
</I>&gt;<i>  
</I>&gt;<i> +		try {
</I>&gt;<i>  			if (parameters != null) {
</I>&gt;<i>  				if (withParams == null) {
</I>&gt;<i>  					int len = parameters.Count;
</I>&gt;<i> @@ -374,10 +398,20 @@
</I>&gt;<i>  					}
</I>&gt;<i>  				}
</I>&gt;<i>  			}
</I>&gt;<i> -			
</I>&gt;<i> +
</I>&gt;<i>  			if (content != null)
</I>&gt;<i>  				content.Evaluate (p);
</I>&gt;<i>  
</I>&gt;<i> +		} catch (XsltException ex) {
</I>&gt;<i> +		    accumulateFrames (ex);
</I>&gt;<i> +		    throw ex;
</I>&gt;<i> +		} catch (Exception ex) {
</I>&gt;<i> +		    XsltException e = new XsltException (&quot;Error during XSLT processing: &quot;,
</I>&gt;<i> +						     null, p.CurrentNode);
</I>&gt;<i> +		    accumulateFrames (e);
</I>&gt;<i> +		    throw e;
</I>&gt;<i> +		}
</I>&gt;<i> +			
</I>&gt;<i>  			p.PopStack ();
</I>&gt;<i>  		}
</I>&gt;<i>  		public void Evaluate (XslTransformProcessor p)
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033488.html">[Mono-list] prototype XSLT debugging patch ...
</A></li>
	<LI>Next message: <A HREF="033509.html">[Mono-list] prototype XSLT debugging patch ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33492">[ date ]</a>
              <a href="thread.html#33492">[ thread ]</a>
              <a href="subject.html#33492">[ subject ]</a>
              <a href="author.html#33492">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
