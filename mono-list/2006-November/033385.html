<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] System.Xml XmlTextReader 'resolver' ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Xml%20XmlTextReader%20%27resolver%27%20...&In-Reply-To=45590D95.4010404%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033375.html">
   <LINK REL="Next"  HREF="033376.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] System.Xml XmlTextReader 'resolver' ...</H1>
    <B>Michael Meeks</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Xml%20XmlTextReader%20%27resolver%27%20...&In-Reply-To=45590D95.4010404%40ximian.com"
       TITLE="[Mono-list] System.Xml XmlTextReader 'resolver' ...">michael.meeks at novell.com
       </A><BR>
    <I>Mon Nov 13 19:53:40 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="033375.html">[Mono-list] System.Xml XmlTextReader 'resolver' ...
</A></li>
        <LI>Next message: <A HREF="033376.html">[Mono-list] System.Xml XmlTextReader 'resolver' ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33385">[ date ]</a>
              <a href="thread.html#33385">[ thread ]</a>
              <a href="subject.html#33385">[ subject ]</a>
              <a href="author.html#33385">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Atsushi,

On Tue, 2006-11-14 at 09:28 +0900, Atsushi Eno wrote:
&gt;<i> Sadly the patch is wrong - the XmlResolver in XmlReaderSettings is
</I>&gt;<i> used only to resolve DTD or whatever dependent files, not the XML
</I>&gt;<i> stream itself.
</I>
	Interesting; I'd be interesting to know what source you get that from.
Based on the fact that this code works on MS' .Net 2.0 but not under
Mono, it appears likely that we behave differently, and thus we are in
error. Furthermore, (now I look) MSDN appears to support my view:

	<A HREF="http://msdn2.microsoft.com/en-us/library/ms162478.aspx">http://msdn2.microsoft.com/en-us/library/ms162478.aspx</A>

&quot;inputUri
        
        The URI for the file containing the XML data. The XmlResolver
        object on the XmlReaderSettings object is used to convert the
        path to a canonical data representation. If XmlResolver is a
        null reference (Nothing in Visual Basic), a new XmlUrlResolver
        object is used.&quot;

	ie. currently we are not using the resolver from the XmlReaderSettings
for converting 'inputURI' [ AFAICS ].

&gt;<i>  For XML stream, you could just pass the stream itself to one of the
</I>&gt;<i> constructors (for example, by using your XmlResolver.GetEntity()).
</I>
	I understand that, but given that the existing code works on Win32 this
is a hard sell wrt. changing up-stream.

&gt;<i> XmlResolver could be explicitly set null (which indicates that it
</I>&gt;<i> must skip external entity resolution) and in such case your patch
</I>&gt;<i> causes NullReferenceException. (I will add such case to our tests.)
</I>
	True - fair cop, it needs a conditional there.

&gt;<i> &gt; 	This was provoked by OdfConverter - which likes to stuff
</I>&gt;&gt;<i> a whole load of XSLT magic inside the .exe itself :-)
</I>&gt;<i> 
</I>&gt;<i> What kind of issue was it?
</I>
	Doesn't work under Mono when it runs fine under Win32 ;-) stack trace
as follows:

[DEBUG][/tmp/tst.docx] Could not find file &quot;/data/OpenOffice/odf-converter/source/OdfConverterTest/source.xml&quot;.(  at System.IO.FileStream..ctor (System.String name, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize, Boolean anonymous, FileOptions options) [0x001f5] in /data/mono/mcs/class/corlib/System.IO/FileStream.cs:221 
  at System.IO.FileStream..ctor (System.String name, FileMode mode, FileAccess access, FileShare share) [0x00000] in /data/mono/mcs/class/corlib/System.IO/FileStream.cs:121 
  at (wrapper remoting-invoke-with-check) System.IO.FileStream:.ctor (string,System.IO.FileMode,System.IO.FileAccess,System.IO.FileShare)
  at System.Xml.XmlUrlResolver.GetEntity (System.Uri absoluteUri, System.String role, System.Type ofObjectToReturn) [0x00068] in /data/mono/mcs/class/System.XML/System.Xml/XmlUrlResolver.cs:64 

    As you see this XmlUrlResolver is used here in error instead of our custom resolver.

  at Mono.Xml2.XmlTextReader.GetStreamFromUrl (System.String url, System.String&amp; absoluteUriString) [0x0002c] in /data/mono/mcs/class/System.XML/System.Xml/XmlTextReader.cs:177 
  at Mono.Xml2.XmlTextReader..ctor (Boolean dummy, System.String url, XmlNodeType fragType, System.Xml.XmlParserContext context) [0x00044] in /data/mono/mcs/class/System.XML/System.Xml/XmlTextReader.cs:133 
  at System.Xml.XmlTextReader..ctor (Boolean dummy, System.String url, XmlNodeType fragType, System.Xml.XmlParserContext context) [0x00006] in /data/mono/mcs/class/System.XML/System.Xml/XmlTextReader2.cs:134 
  at System.Xml.XmlReader.Create (System.String url, System.Xml.XmlReaderSettings settings, System.Xml.XmlParserContext context) [0x00018] in /data/mono/mcs/class/System.XML/System.Xml/XmlReader.cs:313 
  at System.Xml.XmlReader.Create (System.String url, System.Xml.XmlReaderSettings settings) [0x00000] in /data/mono/mcs/class/System.XML/System.Xml/XmlReader.cs:265 

    We pass in the correct XmlReaderSettings ...

  at CleverAge.OdfConverter.OdfConverterLib.Converter.Transform (System.String inputFile, System.String outputFile) [0x0009e] in /data/OpenOffice/odf-converter/source/OdfConverterLib/Converter.cs:151 
  at CleverAge.OdfConverter.CommandLineTool.OdfConverterTest.ConvertFile (System.String input, System.String output, Boolean isDirectTransform) [0x00037] in /data/OpenOffice/odf-converter/source/OdfConverterTest/OdfConverterTest.cs:342 )

	HTH,

		Michael.

-- 
 <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">michael.meeks at novell.com</A>  &lt;&gt;&lt;, Pseudo Engineer, itinerant idiot


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033375.html">[Mono-list] System.Xml XmlTextReader 'resolver' ...
</A></li>
	<LI>Next message: <A HREF="033376.html">[Mono-list] System.Xml XmlTextReader 'resolver' ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33385">[ date ]</a>
              <a href="thread.html#33385">[ thread ]</a>
              <a href="subject.html#33385">[ subject ]</a>
              <a href="author.html#33385">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
