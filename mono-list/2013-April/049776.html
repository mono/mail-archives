<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Help debugging program failing randomly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Help%20debugging%20program%20failing%20randomly&In-Reply-To=%3C5162FAE6.80803%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049765.html">
   <LINK REL="Next"  HREF="049782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Help debugging program failing randomly</H1>
    <B>Danny</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Help%20debugging%20program%20failing%20randomly&In-Reply-To=%3C5162FAE6.80803%40gmail.com%3E"
       TITLE="[Mono-list] Help debugging program failing randomly">dgortonii at gmail.com
       </A><BR>
    <I>Mon Apr  8 17:14:14 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="049765.html">[Mono-list] Help debugging program failing randomly
</A></li>
        <LI>Next message: <A HREF="049782.html">[Mono-list] Help debugging program failing randomly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49776">[ date ]</a>
              <a href="thread.html#49776">[ thread ]</a>
              <a href="subject.html#49776">[ subject ]</a>
              <a href="author.html#49776">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks to Ian and Alan for the replies.  I have done some further 
elimination (by removing runtime components) and I don't think it is the 
new board interface causing this.  I think it is another component, that 
isn't quite as new, but I had forgotten is new in this context (ubuntu 
server).  This component periodically uses a graphing library (ZedGraph) 
to generate line graphs from the data collected from the input boards. 
I have included the entire capture of the stack trace that mono sends to 
stdout.  Note that this is a capture of the console, not a log file, so 
it includes system status messages from my code as well - I left them in 
for context, whether it matters or not.

<A HREF="http://pastebin.com/kQFF4TUB">http://pastebin.com/kQFF4TUB</A>

I currently have a test running that eliminates this graphing component, 
but includes the new board component, and it seems promising so far. 
I'll feel better after it runs for a week though, since I've had it run 
for almost 5 days before it crashed.

At any rate, if it is this new component and the graphing library 
causing this issue, I need figure out how to fix it.  Also, I have used 
ZedGraph for a very long time to generate images like this, but the 
frequency used to be limited to once per day.  Now it can be once per 
minute.  The once/day generation is done in yet another component, so it 
could be the two 'walking' on each other if the underlying code isn't 
thread-safe.  I would expect some kind of time correlation if that was 
the case, and I just don't see that.  I have some ideas on how to 
serialize all of these operations to a single thread, but I'd need to be 
fairly sure of the problem before I went to the effort to implement that.

If I could get a good bead on what I'm doing that causes this error I 
can work around it.

Thanks again for the help,
Danny


On 04/08/2013 06:21 AM, Alan wrote:
&gt;<i> I'm not sure if fontconfig is threadsafe and the finalizer thread is
</I>&gt;<i> directly unreffing some fontconfig objects. This could easily be causing
</I>&gt;<i> the corruption you're seeing if that's the case. Can you paste the full
</I>&gt;<i> stacktrace of your crash (including all threads!) in a pastebin, or
</I>&gt;<i> attach it to your email in some way?
</I>&gt;<i>
</I>&gt;<i> Alan
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 8 April 2013 08:42, Ian Norton
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">ian.norton-badrul at thales-esecurity.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">ian.norton-badrul at thales-esecurity.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     I'd be sure to check your struct packing and call conventions
</I>&gt;<i>     properly. And
</I>&gt;<i>     perhaps be sure that you aren't passing in any &quot;ref System.String&quot;
</I>&gt;<i>     instead of
</I>&gt;<i>     StringBuilders
</I>&gt;<i>
</I>&gt;<i>     Ian
</I>&gt;<i>
</I>&gt;<i>     On Mon, Apr 08, 2013 at 04:21:32AM +0100, Danny wrote:
</I>&gt;<i>      &gt; Hello,
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I'm having a difficult time with an application I have written.  I
</I>&gt;<i>      &gt; recently made some changes and I'm having a problem with it
</I>&gt;<i>     failing at
</I>&gt;<i>      &gt; seemingly random times and locations (within the code), with sigsegv
</I>&gt;<i>      &gt; errors.  This is a multithreaded plugin-style daemon/service (can be
</I>&gt;<i>      &gt; launched from CLI) and I recently added a new component to it to
</I>&gt;<i>     poll a
</I>&gt;<i>      &gt; data acquisition board via USB using FTDI.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Almost all of our integrations like this use a shared library (or
</I>&gt;<i>     DLL on
</I>&gt;<i>      &gt; Windows) and p/invoke to access hardware.  I have done dozens of
</I>&gt;<i>     these
</I>&gt;<i>      &gt; integrations over USB without a persistent issue like this.  But
</I>&gt;<i>     still
</I>&gt;<i>      &gt; at first I suspected this new component, as I had initially
</I>&gt;<i>     thought it
</I>&gt;<i>      &gt; was trashing RAM because of the problems I had developing the
</I>&gt;<i>     shared library
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; However, at the same time as I made this addition, I was also
</I>&gt;<i>     (somewhat)
</I>&gt;<i>      &gt; forced to upgrade our base OS to the latest LTS Ubuntu 12.04 (was on
</I>&gt;<i>      &gt; 10.04).  So unfortunately, I have more than one variable changing
</I>&gt;<i>     at a
</I>&gt;<i>      &gt; time.  So I confirmed, with a configuration that eliminates the newly
</I>&gt;<i>      &gt; developed component, that this problem occurs without that running.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; That's good and bad, since now it seems likely that the offending
</I>&gt;<i>     code
</I>&gt;<i>      &gt; is out of my control.  I am hoping to get some information on the
</I>&gt;<i>      &gt; error(s) I was able to capture, or some advice on how to debug
</I>&gt;<i>     the root
</I>&gt;<i>      &gt; cause of this problem.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I have a couple of stack traces captured and I'll include what I
</I>&gt;<i>     believe
</I>&gt;<i>      &gt; is the crucial part of one here.  It's worth noting that not all
</I>&gt;<i>     of the
</I>&gt;<i>      &gt; stack traces are the same.  It's also worth noting that I have seen
</I>&gt;<i>      &gt; libgdiplus.so in other traces that I didn't get captured.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; I tried setting up a 10.04 machine to test with, but one of our newer
</I>&gt;<i>      &gt; dependencies (ServiceStack) introduced a class that is not in the
</I>&gt;<i>      &gt; default mono on that platform, giving a startup error trying to
</I>&gt;<i>     resolve
</I>&gt;<i>      &gt; the IgnoreDataMemberAttribute class.  So I then got the latest
</I>&gt;<i>     mono set
</I>&gt;<i>      &gt; up on that machine now, but fear that this will result in the
</I>&gt;<i>     same error
</I>&gt;<i>      &gt; I am reporting (ie: I believe this to be a mono problem), since it
</I>&gt;<i>      &gt; should be the same mono framework running there.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Any help is greatly appreciated.
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; &lt;snip - a bunch of standard output msgs from the service /&gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Stacktrace:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;    at (wrapper managed-to-native)
</I>&gt;<i>     System.Drawing.GDIPlus.GdipDeleteFont
</I>&gt;<i>      &gt; (intptr) &lt;0xffffffff&gt;
</I>&gt;<i>      &gt;    at System.Drawing.Font.Dispose () &lt;0x0002b&gt;
</I>&gt;<i>      &gt;    at (wrapper remoting-invoke-with-check)
</I>&gt;<i>     System.Drawing.Font.Dispose
</I>&gt;<i>      &gt; () &lt;0xffffffff&gt;
</I>&gt;<i>      &gt;    at System.Drawing.Font.Finalize () &lt;0x00013&gt;
</I>&gt;<i>      &gt;    at (wrapper runtime-invoke)
</I>&gt;<i>      &gt; object.runtime_invoke_virtual_void__this__
</I>&gt;<i>     (object,intptr,intptr,intpt$
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Native stacktrace:
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;          mono() [0x80e16fc]
</I>&gt;<i>      &gt;          mono() [0x81209fc]
</I>&gt;<i>      &gt;          mono() [0x806094d]
</I>&gt;<i>      &gt;          [0xb770240c]
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; /usr/lib/i386-linux-gnu/libfontconfig.so.1(FcCharSetDestroy+0x15)
</I>&gt;<i>      &gt; [0xb4b1b9b5]
</I>&gt;<i>      &gt;          /usr/lib/i386-linux-gnu/libfontconfig.so.1(+0x17b43)
</I>&gt;<i>     [0xb4b29b43]
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; /usr/lib/i386-linux-gnu/libfontconfig.so.1(FcPatternDestroy+0x82)
</I>&gt;<i>      &gt; [0xb4b29e12]
</I>&gt;<i>      &gt;          /usr/lib/libgdiplus.so.0(GdipDeleteFontFamily+0x132)
</I>&gt;<i>     [0xb5004642]
</I>&gt;<i>      &gt;          /usr/lib/libgdiplus.so.0(GdipDeleteFont+0x2c) [0xb500510c]
</I>&gt;<i>      &gt;          [0xaf711940]
</I>&gt;<i>      &gt;          [0xaf7118cc]
</I>&gt;<i>      &gt;          [0xaf711870]
</I>&gt;<i>      &gt;          [0xaf7117ec]
</I>&gt;<i>      &gt;          [0xb5cddf41]
</I>&gt;<i>      &gt;          mono() [0x8150107]
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; &lt;snip - 42 thread stack details&gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; =================================================================
</I>&gt;<i>      &gt; Got a SIGSEGV while executing native code. This usually indicates
</I>&gt;<i>      &gt; a fatal error in the mono runtime or one of the native libraries
</I>&gt;<i>      &gt; used by your application.
</I>&gt;<i>      &gt; =================================================================
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt;
</I>&gt;<i>      &gt; Danny
</I>&gt;<i>      &gt; _______________________________________________
</I>&gt;<i>      &gt; Mono-list maillist  - <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>&gt;
</I>&gt;<i>      &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     Mono-list maillist  - <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>&gt;
</I>&gt;<i>     <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049765.html">[Mono-list] Help debugging program failing randomly
</A></li>
	<LI>Next message: <A HREF="049782.html">[Mono-list] Help debugging program failing randomly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49776">[ date ]</a>
              <a href="thread.html#49776">[ thread ]</a>
              <a href="subject.html#49776">[ subject ]</a>
              <a href="author.html#49776">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
