<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Xamarin Bug #10857 - System.Data.SqlTypes.SqlDecimal on ARM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Xamarin%20Bug%20%2310857%20-%0A%20System.Data.SqlTypes.SqlDecimal%20on%20ARM&In-Reply-To=%3CCACBComHhqDDXPd9CBdiFSVTO_aZFUJeewMgj_rizy2RhAQ_ScQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049793.html">
   <LINK REL="Next"  HREF="049795.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Xamarin Bug #10857 - System.Data.SqlTypes.SqlDecimal on ARM</H1>
    <B>Weeble</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Xamarin%20Bug%20%2310857%20-%0A%20System.Data.SqlTypes.SqlDecimal%20on%20ARM&In-Reply-To=%3CCACBComHhqDDXPd9CBdiFSVTO_aZFUJeewMgj_rizy2RhAQ_ScQ%40mail.gmail.com%3E"
       TITLE="[Mono-list] Xamarin Bug #10857 - System.Data.SqlTypes.SqlDecimal on ARM">clockworksaint at gmail.com
       </A><BR>
    <I>Thu Apr 11 16:34:53 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="049793.html">[Mono-list] Xamarin Bug #10857 -	System.Data.SqlTypes.SqlDecimal on ARM
</A></li>
        <LI>Next message: <A HREF="049795.html">[Mono-list] Xamarin Bug #10857 -	System.Data.SqlTypes.SqlDecimal on ARM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49794">[ date ]</a>
              <a href="thread.html#49794">[ thread ]</a>
              <a href="subject.html#49794">[ subject ]</a>
              <a href="author.html#49794">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11 April 2013 16:28, mickeyf &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mickey at thesweetoasis.com</A>&gt; wrote:
&gt;<i> Bug referred to is  HERE.
</I>&gt;<i> &lt;<A HREF="https://bugzilla.xamarin.com/show_bug.cgi?id=10857">https://bugzilla.xamarin.com/show_bug.cgi?id=10857</A>&gt;   This pretty well is a
</I>&gt;<i> show stopper for doing anything with a DB on the ARM, since many of the
</I>&gt;<i> higher level SQL classes refer to this whether it's actually going to be
</I>&gt;<i> used or not. (My own DB could care less about 'Decimal')
</I>&gt;<i>
</I>&gt;<i> Since the ARM (BeagleBone in my case) is so much less mainstream than x86, I
</I>&gt;<i> don't expect this to get immediate attention from the regular mono
</I>&gt;<i> developers.
</I>&gt;<i>
</I>&gt;<i> So I'm wondering a couple of things:
</I>&gt;<i>
</I>&gt;<i> Is anyone on this list familiar with both this part of the mono code
</I>&gt;<i> (SqlDataTypes), and working with ARM?
</I>
I have a little familiarity with ARM. I've cross-compiled mono for a
Sheevaplug (so soft-float only) and run and debugged code on the
device. I don't have much familiarity with SqlDataTypes, but I think I
can at least explain what's going on here.

&gt;<i> Has anyone else encountered this particular bug and consider is it important
</I>&gt;<i> to you?
</I>&gt;<i>
</I>&gt;<i> Any clues as to what the issue might be? (I thought endianess, but x86 and
</I>&gt;<i> ARM are both little endian..?)
</I>
You already posted a link to bug 7938 which explains what's wrong, if
only briefly. There's nothing wrong with SqlDecimal - the problem is
simply that hard-float is not supported. Any time you have code
compiled for soft-float (which I assume is what the ARM JIT outputs)
trying to call code compiled for hard-float, you will get undefined
behaviour. So long as floats or doubles aren't involved in the
function specification it will work, but as soon as they are, you will
find that at best the called function will get scrambled arguments,
and at worst the stack could be unbalanced, you'll get a segfault or
you'll see memory corruption. (Now that I think about it, the calling
convention is caller-cleanup, so you shouldn't actually see an
unbalanced stack in this case. Not that it's much consolation.)

SqlDecimal's constructor calls ToDouble, which calls Math.Pow, which
has a native implementation. It's probably at that point that
soft-float code is trying to call hard-float code and there's a
floating point argument involved. The soft-float code probably pushes
it onto the stack, while the hard-float code expects it to be in a
register. Disaster ensues.

I'm afraid that's about the extent of my knowledge. Good luck with the
hard-float patches. I'd be interested to know if they work.

&gt;<i> I have no way to use anything but a terminal window on my BeagleBone, so
</I>&gt;<i> will may want to set up an ARM virtual machine for initial tests. Anyone
</I>&gt;<i> done this and have suggestions?
</I>
I'm not sure that the virtual machine will be worth the hassle... What
will it let you do that you couldn't do on the device?

Regards,

Weeble.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049793.html">[Mono-list] Xamarin Bug #10857 -	System.Data.SqlTypes.SqlDecimal on ARM
</A></li>
	<LI>Next message: <A HREF="049795.html">[Mono-list] Xamarin Bug #10857 -	System.Data.SqlTypes.SqlDecimal on ARM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49794">[ date ]</a>
              <a href="thread.html#49794">[ thread ]</a>
              <a href="subject.html#49794">[ subject ]</a>
              <a href="author.html#49794">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
