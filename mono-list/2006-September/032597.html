<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] apache terminating mod_mono?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20apache%20terminating%20mod_mono%3F&In-Reply-To=007b01c6cddf%24b900b430%248f0e020a%40agc01.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032596.html">
   <LINK REL="Next"  HREF="032598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] apache terminating mod_mono?</H1>
    <B>Mike Glenn</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20apache%20terminating%20mod_mono%3F&In-Reply-To=007b01c6cddf%24b900b430%248f0e020a%40agc01.com"
       TITLE="[Mono-list] apache terminating mod_mono?">mglenn at zoominternet.net
       </A><BR>
    <I>Fri Sep  1 14:01:18 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="032596.html">[Mono-list] apache terminating mod_mono?
</A></li>
        <LI>Next message: <A HREF="032598.html">[Mono-list] Mono.Data.Sqlite problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32597">[ date ]</a>
              <a href="thread.html#32597">[ thread ]</a>
              <a href="subject.html#32597">[ subject ]</a>
              <a href="author.html#32597">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> OK some digging and debugging turned up this:

If no apache MonoUnixSocket flag is defined in the config then the server tries
to load:

[Fri Sep 01 13:44:54 2006] [warn] Socket file name /tmp/mod_mono_server_global


Where as the man page for mod-mono-server says:
 --filename file (mod-mono-server only)
              The unix socket file name to listen on.  Default value:
/tmp/mod_mono_server

and mod_mono.c has:

MAKE_CMD12 (MonoUnixSocket, filename,
	&quot;Named pipe file name. Mutually exclusive with MonoListenPort. &quot;
	&quot;Default: /tmp/mod_mono_server&quot;
	)


I had added this line to the apache config because I was apache/mod_mono were
not communicating with mod-mono-server:
MonoUnixSocket default /tmp/mod_mono_server

this seems to have caused mod_mono.so to think there where two instances of
mod-mono-server/xsp running.
One that was set to MonoRunXSP False and one that was true. I added some
debugging lines to mod_mono.c and heres what I got in the terminate loop:

static apr_status_t
terminate_xsp2 (void *data, char *alias)
{
  /* alias may be NULL to terminate all XSPs */
  server_rec *server;
  module_cfg *config;
  apr_socket_t *sock;
  apr_status_t rv;
  char *termstr = &quot;&quot;;
  xsp_data *xsp;
  int i;

  DEBUG_PRINT (0, &quot;Terminate XSP&quot;);
  server = (server_rec *) data;
  config = ap_get_module_config (server-&gt;module_config, &amp;mono_module);

  for (i = 0; i &lt; config-&gt;nservers; i++) {
    xsp = &amp;config-&gt;servers [i];
    DEBUG_PRINT (0, &quot;XSP Setting: %s&quot;, xsp-&gt;run_xsp);
    if (xsp-&gt;run_xsp &amp;&amp; !strcasecmp (xsp-&gt;run_xsp, &quot;false&quot;))
      continue;
...snip...

[Fri Sep 01 13:40:28 2006] [notice] caught SIGTERM, shutting down
[Fri Sep 01 13:40:28 2006] [warn] Terminate XSP
[Fri Sep 01 13:40:28 2006] [warn] XSP Setting: False
[Fri Sep 01 13:40:28 2006] [warn] XSP Setting: True
[Fri Sep 01 13:40:28 2006] [warn] Socket file name /tmp/mod_mono_server
[Fri Sep 01 13:40:28 2006] [warn] try_connect: 0


So in the end I changed mod-mono-server --filename /tmp/mod_mono_server_global
and now things are working again as expected. But it seems that the defaults are
not what the use to be or that the docs need updated.

Mike Glenn

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Mike Glenn [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mglenn at zoominternet.net</A>] 
</I>&gt;<i> Sent: Friday, September 01, 2006 12:00 PM
</I>&gt;<i> To: 'Gonzalo Paniagua Javier'; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;<i> Subject: [Mono-list] apache terminating mod_mono?
</I>&gt;<i> 
</I>&gt;<i> A little background:
</I>&gt;<i> 
</I>&gt;<i> I run mod-mono-server with its own init script.
</I>&gt;<i> I run apache with the MonoRunXSP False flag
</I>&gt;<i> 
</I>&gt;<i> This allows me to start and stop apache and mod-mono-server 
</I>&gt;<i> independently of
</I>&gt;<i> each other. 
</I>&gt;<i> I.E. when I take down mod-mono-server apache displays a 
</I>&gt;<i> custom error page
</I>&gt;<i> informing the user that we are working on the site instead of 
</I>&gt;<i> a message from the
</I>&gt;<i> browser that no such server exists. On the flip side I can 
</I>&gt;<i> make a change to the
</I>&gt;<i> apache config and reload with out going through the restart 
</I>&gt;<i> time or session loss
</I>&gt;<i> on the running mod-mono-server.
</I>&gt;<i> 
</I>&gt;<i> I recently updated to mono, xsp and mod_mono to 1.1.17 from 
</I>&gt;<i> 1.1.13 and now when
</I>&gt;<i> I stop apache it kills mod-mono-server. I've tested and the 
</I>&gt;<i> same thing occurs
</I>&gt;<i> using both unix and tcp sockets. 
</I>&gt;<i> 
</I>&gt;<i> Can anyone advise me on this?
</I>&gt;<i> 
</I>&gt;<i> Thanks for your time.
</I>&gt;<i> 
</I>&gt;<i> Mike Glenn
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032596.html">[Mono-list] apache terminating mod_mono?
</A></li>
	<LI>Next message: <A HREF="032598.html">[Mono-list] Mono.Data.Sqlite problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32597">[ date ]</a>
              <a href="thread.html#32597">[ thread ]</a>
              <a href="subject.html#32597">[ subject ]</a>
              <a href="author.html#32597">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
