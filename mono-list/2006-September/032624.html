<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] NetworkStream.ReadByte behavior is differing from ms.net
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20NetworkStream.ReadByte%20behavior%20is%20differing%20from%20ms.net&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032625.html">
   <LINK REL="Next"  HREF="032626.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] NetworkStream.ReadByte behavior is differing from ms.net</H1>
    <B>Francisco Figueiredo Jr.</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20NetworkStream.ReadByte%20behavior%20is%20differing%20from%20ms.net&In-Reply-To="
       TITLE="[Mono-list] NetworkStream.ReadByte behavior is differing from ms.net">fxjrlists at yahoo.com.br
       </A><BR>
    <I>Tue Sep  5 10:10:52 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="032625.html">[Mono-list] Online editor
</A></li>
        <LI>Next message: <A HREF="032626.html">[Mono-list] Hashtable behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32624">[ date ]</a>
              <a href="thread.html#32624">[ thread ]</a>
              <a href="subject.html#32624">[ subject ]</a>
              <a href="author.html#32624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Hi all,

While playing with NetworkStream.ReadByte in Npgsql I faced a situation
where Mono behavior is differing from ms.net.

If I establish a connection and later stop server while client is
connected and call NetworkStream.ReadByte() from client, ms.net throws a
SocketException wrapped inside an IOException, while Mono returns -1.

This is ms.net stack trace:

Unhandled Exception: System.IO.IOException: Unable to read data from the
transp
rt connection. ---&gt; System.Net.Sockets.SocketException: Uma conex&#227;o
estabelecid
 foi anulada pelo software no computador host
   at System.Net.Sockets.Socket.Receive(Byte[] buffer, Int32 offset,
Int32 size
 SocketFlags socketFlags)
   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset,
Int32
ize)
   --- End of inner exception stack trace ---
   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset,
Int32
ize)
   at System.IO.BufferedStream.ReadByte()
   at Npgsql.NpgsqlState.ProcessBackendResponses_Ver_3(NpgsqlConnector
context)
   at Npgsql.NpgsqlState.ProcessBackendResponses(NpgsqlConnector context)
   at Npgsql.NpgsqlReadyState.Query(NpgsqlConnector context,
NpgsqlCommand comm
nd)
   at Npgsql.NpgsqlConnector.Query(NpgsqlCommand queryCommand)
   at Npgsql.NpgsqlCommand.ExecuteCommand()
   at Npgsql.NpgsqlCommand.ExecuteScalar()
   at c.Main(String[] args)



Checking mono source, it seems that it ends calling
System.Net.Sockets.Socket.Receive(Byte[] buffer, Int32 offset, Int32
size SocketFlags socketFlags) too from NetworkStream.Read().

Socket.Receive ends up calling Receive_nochecks which seems is not
realizing that the connection is broken and returns ok which makes
Receive returns ok without throwing any SocketException.

Can you confirm that?

The closest bug I could find about that is this:
<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=63233">http://bugzilla.ximian.com/show_bug.cgi?id=63233</A>

But it talks about async calls which isn't my case.

If you can confirm that, I can fill a bug report.

Thanks in advance.


- --
Regards,

Francisco Figueiredo Jr.
<A HREF="http://fxjr.blogspot.com">http://fxjr.blogspot.com</A>
Npgsql Lead Developer
<A HREF="http://pgfoundry.org/projects/npgsql">http://pgfoundry.org/projects/npgsql</A>
Mono Project Contributor
<A HREF="http://www.go-mono.com">http://www.go-mono.com</A>
MonoBrasil Project Founder Member
<A HREF="http://monobrasil.softwarelivre.org">http://monobrasil.softwarelivre.org</A>


- --
 - Would you tell me, please, which way I ought to go from here?
 - That depends a good deal on where you want to get to.
 		-- Lewis Carroll &quot;Alice's Adventures in Wonderland&quot;
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.4 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org">http://enigmail.mozdev.org</A>

iQEVAwUBRP2FbP7iFmsNzeXfAQJGkQgAn/oknk5yYc1Wu8ES/SUo3bq5OTGKoliY
m61V6NzCDxylVPiXcPUaFjfjisXMQuwr3KgCs5IigLAyyff/odOLbuTcQk0y6SqE
xmMv85yPpW//ZEuAoLzVzg5cxyhGWSBCtdbVWGZKFcDbm5eTixHvIVO+x0KGx34c
8BniK6RNq0wnQTk9k2ytlvopfegmeDBVsnsbJa9dbD/hdwMbi1kCYcxQbWSZgHHv
313PanjLx26Pui1OY/DqjHT1hGvLt3wVbfdLvkb4usEa+JwEm+kU0JAE3jWU0QDF
L5ECTwFWabZ0G3mtqd6gz3YQPENjSKaOsOfEpybFDtpjvWbrn1PEVA==
=G7K0
-----END PGP SIGNATURE-----

		
_______________________________________________________ 
O Yahoo! est&#225; de cara nova. Venha conferir! 
<A HREF="http://br.yahoo.com">http://br.yahoo.com</A>
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032625.html">[Mono-list] Online editor
</A></li>
	<LI>Next message: <A HREF="032626.html">[Mono-list] Hashtable behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32624">[ date ]</a>
              <a href="thread.html#32624">[ thread ]</a>
              <a href="subject.html#32624">[ subject ]</a>
              <a href="author.html#32624">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
