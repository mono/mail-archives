<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mkbundle on windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20mkbundle%20on%20windows&In-Reply-To=450919CA.1060507%40gmx.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032806.html">
   <LINK REL="Next"  HREF="032809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mkbundle on windows</H1>
    <B>Travis Staloch</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20mkbundle%20on%20windows&In-Reply-To=450919CA.1060507%40gmx.net"
       TITLE="[Mono-list] mkbundle on windows">twostepted at yahoo.com
       </A><BR>
    <I>Fri Sep 22 00:52:42 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="032806.html">[Mono-list] Comand line options
</A></li>
        <LI>Next message: <A HREF="032809.html">[Mono-list] Gdk.Pixbuf error using xsp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32808">[ date ]</a>
              <a href="thread.html#32808">[ thread ]</a>
              <a href="subject.html#32808">[ subject ]</a>
              <a href="author.html#32808">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey All,

Just wanted to share this conversation I had where Robert helped me get mkbundle to work on windows with cygwin.  I've since tried to bundle my app on linux with no success yet.  I'll try to write back once I've figured out how to get it to the bundle native dependencies GLib and GTK correctly.  If anyone has any pointers, please let me know.  I just installed a fresh version of Mono on my linux machine, hoping it would help.

In short, I had to do the following to get mkbundle to work on windows:
1. Run it from a path without any spaces in it (ie c:\Program Files\Mono... didn't work).
2. I had to use a different version of mkbundle from the one provided with 1.1.17.1.  
3.I had to deliver mono\1.0\machine.config along with my app, copying it from my mono installation to mono\1.0 under my app's directory.  

Here's our conversation below.  

--Travis
 
Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">robertj at gmx.net</A>&gt; wrote: Hi,

If you bundle you app on a Linux 2.4 system, the binary should work
an all systems.

The problem on Linux are the native dependencies (GLib, GTK) that
you have to deliver. I can't help you with that, because I never did
it myself.

You may try to put them in the private &quot;lib&quot; dir of your application
and change LD_LIBRARY_PATH from inside of a launcher script
to point to this lib dir.

Robert


Travis Staloch wrote:
&gt;<i> Robert,
</I>&gt;<i> 
</I>&gt;<i> Thanks so much.  It looks like thats worked now on windows.  Very
</I>&gt;<i> cool.  Thanks alot.  I'll let you know how things work out with it.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> BTW, Am I going to have to do the same on a linux machine for a linux
</I>&gt;<i> bundle?  If so, will that version be linux independent?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> --Travis
</I>&gt;<i> 
</I>&gt;<i> Robert Jordan  wrote: Hi Travis,
</I>&gt;<i> 
</I>&gt;&gt;<i> Robert,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Just wondering if you think this might be easier on linux?  I have
</I>&gt;&gt;<i> an FC5 box with mono installed too.  Are you having success on your
</I>&gt;&gt;<i>  machine?  If so, what type of a machine are you running?
</I>&gt;<i> 
</I>&gt;<i> It's not easier on Linux. Since mkbundle generates executables for
</I>&gt;<i> the OS it gets invoked from, it doesn't make sense in your case.
</I>&gt;<i> 
</I>&gt;<i> I've found the problem. The machine config must be deployed rather
</I>&gt;<i> than embedded, because some classes are actually trying to read this
</I>&gt;<i> file.
</I>&gt;<i> 
</I>&gt;<i> Try this:
</I>&gt;<i> 
</I>&gt;<i> mono mkbundle.exe -z --deps --config-dir . MyInstaller.exe
</I>&gt;<i> 
</I>&gt;<i> (&quot;--config-dir .&quot; specifies that Mono's config directory is the
</I>&gt;<i> current folder)
</I>&gt;<i> 
</I>&gt;<i> Then create the directory and subdirectory &quot;mono\1.0&quot; and copy the
</I>&gt;<i> machine.config into this directory.
</I>&gt;<i> 
</I>&gt;<i> You end up having to deploy this:
</I>&gt;<i> 
</I>&gt;<i> mono\1.0\machine.config MyInstaller.exe
</I>&gt;<i> 
</I>&gt;<i> Robert
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> --Travis
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Robert Jordan  wrote: Hi Travis,
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Thanks again for your help.  Please let me know if I'm bothering 
</I>&gt;&gt;&gt;<i> you too much or there is a better person to answer my questions. 
</I>&gt;&gt;&gt;<i> After
</I>&gt;&gt;<i> Mkbundle is not very often used, so every feedback is welcome.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> installing 1.1.17 to c:\mono, mkbundle was able to run to 
</I>&gt;&gt;&gt;<i> completion and generate an a.out file (yeah!). I've renamed the 
</I>&gt;&gt;&gt;<i> file to a.exe and when run it shows an error message where my app
</I>&gt;&gt;&gt;<i>  had previously not shown an error. The messsage is below.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> This problem is likely related to the fact that my app is adding
</I>&gt;&gt;&gt;<i> a debug listener file at
</I>&gt;&gt;&gt;<i> System.IO.Directory.GetCurrentDirectory(). Is there some reason
</I>&gt;&gt;&gt;<i> why mkbundle would have a problem with this?
</I>&gt;&gt;<i> Try
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> mono mkbundle.exe --deps --config
</I>&gt;&gt;<i> c:/Mono/etc/mono/1.0/machine.config MyInstaller.exe
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> This will bundle the current machine.config as well.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I'll try it myself tonight.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Robert
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> --------------------------------- Yahoo! Messenger with Voice. Make
</I>&gt;&gt;<i>  PC-to-Phone Calls to the US (and 30+ countries) for 2&#162;/min or
</I>&gt;&gt;<i> less.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  --------------------------------- Do you Yahoo!? Get on board.
</I>&gt;<i> You're invited to try the new Yahoo! Mail.
</I>


Hi Travis,

This is indeed a path issue. Try to reinstall the current Mono 1.1.17.1
into c:\Mono\. Installing the new version has another benefit: mkbundle
(the one I sent you, mkbundle as of 1.1.17.1 has the same issues, so
don't use it) supports the &quot;-z&quot; option (compressing). Your app
will shrink at about 2MB.

Robert


Travis Staloch wrote:
&gt;<i> Robert,
</I>&gt;<i> 
</I>&gt;<i> Again, thanks SO much as I was able to get much further with the 
</I>&gt;<i> process.  However, I still have a problem which doesn't allow 
</I>&gt;<i> mkbundle to complete.  During compilation I get a bunch of compiler 
</I>&gt;<i> warnings and errors from gcc.  I just installed cygwin recently and 
</I>&gt;<i> am using gcc version 3.4.4.
</I>&gt;<i> 
</I>&gt;<i> Do you think that the problem is caused by the space in the path to 
</I>&gt;<i> the mono install directory (Program Files)?
</I>&gt;<i> 
</I>&gt;<i> BTW, I'm planning to post the results of this thread on the mono-list
</I>&gt;<i>  after I get it resolved.
</I>&gt;<i> 
</I>&gt;<i> --Travis
</I>&gt;<i> 
</I>&gt;<i> Here's the command and the first few compiler warnings and errors in
</I>&gt;<i>  case you want to have a look:
</I>&gt;<i> 
</I>&gt;<i> $ gcc -mno-cygwin -g -o a.out -Wall temp.c `pkg-config --cflags 
</I>&gt;<i> --libs mono`  temp.o
</I>&gt;<i> 
</I>&gt;<i> gcc: Files/Mono-1.1.16/include: No such file or directory gcc: 
</I>&gt;<i> Files/Mono-1.1.16/include/glib-2.0: No such file or directory gcc: 
</I>&gt;<i> Files/Mono-1.1.16/lib/glib-2.0/include: No such file or directory 
</I>&gt;<i> gcc: Files/Mono-1.1.16/lib: No such file or directory temp.c:2:36: 
</I>&gt;<i> mono/metadata/assembly.h: No such file or directory temp.c:5: error:
</I>&gt;<i>  parse error before &quot;assembly_bundle_MyInstaller_exe&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">robertj at gmx.net</A>&gt; wrote: Hi Travis,
</I>&gt;<i> 
</I>&gt;<i> I've just repeated the bundling with the exe I sent to you (the same)
</I>&gt;<i>  and it works. Please copy mkbundle.exe into the folder with the app
</I>&gt;<i>  you want to bundle and call it like this:
</I>&gt;<i> 
</I>&gt;<i> mono mkbundle.exe --deps MyInstaller.exe
</I>&gt;<i> 
</I>&gt;<i> Robert
</I>&gt;<i> 
</I>&gt;<i> Travis Staloch wrote:
</I>&gt;&gt;<i> Thanks alot Robert!
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> So I'm understanding that the assembly properties (set in 
</I>&gt;&gt;<i> AssemblyInfo.cs or otherwise) must have read 
</I>&gt;&gt;<i> &quot;IWshRuntimeLibrary.dll&quot; when the assembly file name was actually 
</I>&gt;&gt;<i> Interop.IWshRuntimeLibrary.dll.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> After overwriting mkbundle.exe (in C:\Program 
</I>&gt;&gt;<i> Files\Mono-1.1.16\lib\mono\1.0) with the one you provided, I still 
</I>&gt;&gt;<i> get the same message.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> --Travis
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> C:\&gt;mkbundle --deps 
</I>&gt;&gt;<i> c:/Stats/open/installer/MyInstaller/bin/Release/MyInstaller.exe OS 
</I>&gt;&gt;<i> is: Windows Sources: 1 Auto-dependencies: True
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Unhandled Exception: System.IO.FileNotFoundException: 
</I>&gt;&gt;<i> InstallerCommon,Version=1.0.2444.27396, Culture=neutral : 
</I>&gt;&gt;<i> InstallerCommon, Version=1.0.2444.27396, Culture=neutral at 
</I>&gt;&gt;<i> &lt;0x00000&gt; at (wrapper managed-to-native) 
</I>&gt;&gt;<i> System.AppDomain:LoadAssembly 
</I>&gt;&gt;<i> (string,System.Security.Policy.Evidence,bool) at 
</I>&gt;&gt;<i> System.AppDomain.Load (System.Reflection.AssemblyName assemblyRef, 
</I>&gt;&gt;<i> System.Security.Policy.Evidence assemblySecurity) [0x00000] at 
</I>&gt;&gt;<i> (wrapper remoting-invoke-with-check) System.AppDomain:Load 
</I>&gt;&gt;<i> (System.Reflection.AssemblyName,System.Security.Policy.Evidence) at
</I>&gt;&gt;<i>  System.AppDomain.Load (System.Reflection.AssemblyName assemblyRef)
</I>&gt;&gt;<i>  [0x00000] at (wrapper remoting-invoke-with-check) 
</I>&gt;&gt;<i> System.AppDomain:Load (System.Reflection.AssemblyName) at 
</I>&gt;&gt;<i> System.Reflection.Assembly.Load (System.Reflection.AssemblyName 
</I>&gt;&gt;<i> assemblyRef) [0x00000] at MakeBundle.QueueAssembly 
</I>&gt;&gt;<i> (System.Collections.ArrayList files, System.Reflection.Assembly a) 
</I>&gt;&gt;<i> [0x00000] at MakeBundle.Main (System.String[] args) [0x00000]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Robert Jordan  wrote: Hi Travis,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Here is an updated mkbundle.exe. It should work now. The problem 
</I>&gt;&gt;<i> was Interop.IWshRuntimeLibrary.dll, which was renamed from 
</I>&gt;&gt;<i> IWshRuntimeLibrary.dll. Since renaming an assembly doesn't change 
</I>&gt;&gt;<i> its identity, mkbundle.exe was still trying to load the original 
</I>&gt;&gt;<i> name.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Robert
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Travis Staloch wrote:
</I>&gt;&gt;&gt;<i> Robert,
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Here's the app release directory.  Running it shouldn't do much 
</I>&gt;&gt;&gt;<i> except complain that its missing  a license.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Thanks for any advice.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> --Travis
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Message: 3 Date: Sun, 10 Sep 2006 12:20:56 +0200 From: Robert 
</I>&gt;&gt;&gt;<i> Jordan Subject: Re: [Mono-list] mkbundle on windows To: 
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A> Message-ID: Content-Type: text/plain; 
</I>&gt;&gt;&gt;<i> charset=ISO-8859-1; format=flowed
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I can reproduce it only for the trivial case: delete an assembly
</I>&gt;&gt;&gt;<i>  which is referenced by the app.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> If you email me a zip/tar.gz with the assemblies, I'll have a 
</I>&gt;&gt;&gt;<i> look at the problem.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Robert
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Travis Staloch wrote:
</I>&gt;&gt;&gt;&gt;<i> Robert,
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I'm still stuck with this.  Sorry if you couldn't get my 
</I>&gt;&gt;&gt;&gt;<i> message last
</I>&gt;&gt;&gt;<i> time, I had one message where your email was the subject and one 
</I>&gt;&gt;&gt;<i> where my attached words didn't make it through.
</I>&gt;&gt;&gt;&gt;<i> Does anyone have any ideas why mkbundle on windows would be 
</I>&gt;&gt;&gt;&gt;<i> acting
</I>&gt;&gt;&gt;<i> this way with mono 1.17?
</I>&gt;&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> --Travis
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Travis Staloch wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> I'm trying to use mkbundle on windows with Mono-1.1.16 and 
</I>&gt;&gt;&gt;&gt;&gt;<i> not
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> having
</I>&gt;&gt;&gt;&gt;&gt;<i> any luck.  I'm running mkbundle as shown below.  All of the 
</I>&gt;&gt;&gt;&gt;&gt;<i> dlls referenced by MyApp.exe are in the same directory as 
</I>&gt;&gt;&gt;&gt;&gt;<i> MyApp.exe. Thats also the directory where I'm running the 
</I>&gt;&gt;&gt;&gt;&gt;<i> mkbundle command
</I>&gt;&gt;&gt;<i> from.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> mkbundle --deps MyApp.exe
</I>&gt;&gt;&gt;&gt;&gt;<i> OS is: Windows Sources: 1 Auto-dependencies: True
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Unhandled Exception: System.IO.FileNotFoundException: 
</I>&gt;&gt;&gt;&gt;&gt;<i> MyAppCommon, Version=1.0.2441.695, Culture=neutral : 
</I>&gt;&gt;&gt;&gt;&gt;<i> MyAppCommon, Version=1.0.2441.695, Culture=neutral
</I>&gt;&gt;&gt;&gt;<i> What happens if you call &quot;mono MyApp.exe&quot; from inside of this 
</I>&gt;&gt;&gt;&gt;<i> directory?
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Robert
</I>&gt;&gt;&gt;<i> 
</I>



 		
---------------------------------
Get your email and more, right on the  new Yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20060921/0e0993a5/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20060921/0e0993a5/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032806.html">[Mono-list] Comand line options
</A></li>
	<LI>Next message: <A HREF="032809.html">[Mono-list] Gdk.Pixbuf error using xsp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32808">[ date ]</a>
              <a href="thread.html#32808">[ thread ]</a>
              <a href="subject.html#32808">[ subject ]</a>
              <a href="author.html#32808">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
