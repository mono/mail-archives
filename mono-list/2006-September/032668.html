<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Static constructor issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Static%20constructor%20issue&In-Reply-To=1157680839.30699.17.camel%40melchior.magi">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032667.html">
   <LINK REL="Next"  HREF="032657.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Static constructor issue</H1>
    <B>Massimiliano Mantione</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Static%20constructor%20issue&In-Reply-To=1157680839.30699.17.camel%40melchior.magi"
       TITLE="[Mono-list] Static constructor issue">massi at ximian.com
       </A><BR>
    <I>Fri Sep  8 01:03:16 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="032667.html">[Mono-list] Static constructor issue
</A></li>
        <LI>Next message: <A HREF="032657.html">[Mono-list] Fwd:  Static constructor issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32668">[ date ]</a>
              <a href="thread.html#32668">[ thread ]</a>
              <a href="subject.html#32668">[ subject ]</a>
              <a href="author.html#32668">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Thu, 2006-09-07 at 22:00 -0400, Jonathan Pryor wrote:
&gt;<i> beforefieldinit is a performance advantage: it allows the JIT inliner to
</I>&gt;<i> invoke the static constructor during JIT time, instead of needing to
</I>&gt;<i> delay static constructor invocation until just before a member is
</I>&gt;<i> accessed.  It's also useful for --aot code, as the initialization
</I>&gt;<i> performed by the static constructor could be cached (in some principal)
</I>&gt;<i> within the AOT code.
</I>
The (sad) truth is that apparently the MS runtime does not take
advantage
of this fact.
Our runtime did, but when inline was enabled by default in the Mono JIT,
many programs which depended on the order in which .cctors were executed
started showing a different behavior in the two runtimes.
Of course, this different behavior was perceived as a Mono bug
introduced
by the inline optimization, even if it was perfectly standard compliant
and it was the program that was at fault, using the wrong
beforefieldinit
setting.

To make a long story short, we now behave like the MS runtime so that
developers have their life easier...

&gt;<i> If the `Pixbuf' constructor requires that Gtk# be initialized, this use
</I>&gt;<i> _may_ fail if the Foo static constructor is invoked before Gtk# is
</I>&gt;<i> initialized.  This will be hell to debug. :-/
</I>
Yep :-)
These are the sort of things that happened (and were debugged) when we
enabled inline by default.

Ciao,
  Massi


</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032667.html">[Mono-list] Static constructor issue
</A></li>
	<LI>Next message: <A HREF="032657.html">[Mono-list] Fwd:  Static constructor issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32668">[ date ]</a>
              <a href="thread.html#32668">[ thread ]</a>
              <a href="subject.html#32668">[ subject ]</a>
              <a href="author.html#32668">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
