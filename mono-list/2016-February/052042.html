<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] File Locking
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20File%20Locking&In-Reply-To=%3CBN3PR0801MB1154F2A16B95C9AFFD18759AFAAE0%40BN3PR0801MB1154.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="052041.html">
   <LINK REL="Next"  HREF="052043.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] File Locking</H1>
    <B>Edward Ned Harvey (mono)</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20File%20Locking&In-Reply-To=%3CBN3PR0801MB1154F2A16B95C9AFFD18759AFAAE0%40BN3PR0801MB1154.namprd08.prod.outlook.com%3E"
       TITLE="[Mono-list] File Locking">edward.harvey.mono at clevertrove.com
       </A><BR>
    <I>Wed Feb 17 14:45:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="052041.html">[Mono-list] File Locking
</A></li>
        <LI>Next message: <A HREF="052043.html">[Mono-list] File Locking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52042">[ date ]</a>
              <a href="thread.html#52042">[ thread ]</a>
              <a href="subject.html#52042">[ subject ]</a>
              <a href="author.html#52042">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A> [mailto:mono-list-
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">bounces at lists.ximian.com</A>] On Behalf Of shrimpywu
</I>&gt;<i> 
</I>&gt;<i> i have the same issue. any solution?
</I>
Kinda sorta. The underlying issue is that OSX, Linux, and Windows all have different underlying file locking constructs, and then of course, there's some variability about even *which* filesystem is being used. I didn't thoroughly figure out all the answers for every OS or filesystem, and I don't know under which situations this will be good enough, but this is what I ended up using, works under the conditions we needed it to work:

using (var foo = new FileStream(filePath, FileMode.Open, FileAccess.ReadWrite, FileShare.None)) {     // must include Write access in order to lock file
	foo.Lock(0, 0);   // 0,0 has special meaning to lock entire file regardless of length
}

For windows, simply specifying the FileAccess and FileShare is good enough. For linux, at least ext4, files are concurrently readable regardless of what you specify for FileAccess and FileShare. The Lock() method does something of a soft-lock. It's not enforced by the OS, but at least all the situations we tried, other client apps honor the lock. Didn't look into it any deeper.
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="052041.html">[Mono-list] File Locking
</A></li>
	<LI>Next message: <A HREF="052043.html">[Mono-list] File Locking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52042">[ date ]</a>
              <a href="thread.html#52042">[ thread ]</a>
              <a href="subject.html#52042">[ subject ]</a>
              <a href="author.html#52042">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
