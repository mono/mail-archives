<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] HttpRuntime initialised check?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20HttpRuntime%20initialised%20check%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035938.html">
   <LINK REL="Next"  HREF="035940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] HttpRuntime initialised check?</H1>
    <B>James Fitzsimons</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20HttpRuntime%20initialised%20check%3F&In-Reply-To="
       TITLE="[Mono-list] HttpRuntime initialised check?">james.fitzsimons at gmail.com
       </A><BR>
    <I>Tue Aug 14 16:49:04 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="035938.html">[Mono-list] [Mono-dev] ANN: Smokey 0.3.2.0
</A></li>
        <LI>Next message: <A HREF="035940.html">[Mono-list] HttpRuntime initialised check?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35939">[ date ]</a>
              <a href="thread.html#35939">[ thread ]</a>
              <a href="subject.html#35939">[ subject ]</a>
              <a href="author.html#35939">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I am doing a bit of work trying to get Spring.NET (specifically the web
support) running on mono. I am using 1.2.5 preview 3 of the mono runtime
at the moment.

The problem is that in the spring code they attempt to check if the
HttpRuntime has been fully initialised. They do this in a rather nasty
fashion that will only ever work on the MS .NET runtime. The question I
have for this list is:

Is there a &quot;correct&quot; way to check if the HttpRuntime has finished it's
initialisation?

From this <A HREF="http://msdn2.microsoft.com/en-us/library/aa479328.aspx">http://msdn2.microsoft.com/en-us/library/aa479328.aspx</A>

&quot;The HttpRuntime object initializes a number of internal objects that
will help carry the request out. Helper objects include the cache
manager (the Cache object) and the internal file system monitor used to
detect changes in the source files that form the application. The
HttpRuntime creates the context for the request and fills it up with any
HTTP information specific to the request. The context is represented by
an instance of the HttpContext class.&quot;

it looks like you could just check if the HttpContext wasn't null. Would
that be a sufficient check?

Thanks for any advice you can provide!
James Fitzsimons

PS: offending Spring.NET code here:

 static WebApplicationContext()
    {
        // register for ContextRegistry.Cleared event - we need to
discard our cache in this case
        ContextRegistry.Cleared += new
EventHandler(OnContextRegistryCleared);

#if NET_2_0
        if (HttpRuntime.AppDomainAppVirtualPath != null) // check if
we're within an ASP.NET AppDomain!
        {
            // ensure HttpRuntime has been fully initialized!
            // this is a problem,.if ASP.NET Web Administration
Application is used. This app does not fully set up the AppDomain...
            HttpRuntime runtime =
                (HttpRuntime)
                typeof(HttpRuntime).GetField(&quot;_theRuntime&quot;,
BindingFlags.Static | BindingFlags.NonPublic).GetValue(null);

            bool beforeFirstRequest = false;
            lock (HttpRuntime)
            {
                beforeFirstRequest =
                    (bool)
                    typeof(HttpRuntime).GetField(&quot;_beforeFirstRequest&quot;,
BindingFlags.Instance | BindingFlags.NonPublic).
                        GetValue(runtime);
            }
            log.Debug(&quot;BeforeFirstRequest:&quot; + beforeFirstRequest);
            if (beforeFirstRequest)
            {
                try
                {
                    string firstRequestPath =
HttpRuntime.AppDomainAppVirtualPath.TrimEnd('/') + &quot;/dummy.context&quot;;
                    log.Info(&quot;Forcing first request &quot; +
firstRequestPath);
                    HttpRuntime.ProcessRequest(
                        new SimpleWorkerRequest(firstRequestPath,
string.Empty, new StringWriter()));
                    log.Info(&quot;Successfully processed first request!&quot;);
                }
                catch (Exception ex)
                {
                    log.Error(&quot;Failed processing first request&quot;, ex);
                    throw;
                }
            }
        }
#endif
    }
-- 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070814/db9f5000/attachment.bin">http://lists.ximian.com/pipermail/mono-list/attachments/20070814/db9f5000/attachment.bin</A> 
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035938.html">[Mono-list] [Mono-dev] ANN: Smokey 0.3.2.0
</A></li>
	<LI>Next message: <A HREF="035940.html">[Mono-list] HttpRuntime initialised check?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35939">[ date ]</a>
              <a href="thread.html#35939">[ thread ]</a>
              <a href="subject.html#35939">[ subject ]</a>
              <a href="author.html#35939">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
