<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] some older MonoLogo code notes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:birbilis%40kagi.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="026213.html">
   <LINK REL="Next"  HREF="026209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] some older MonoLogo code notes
   </H1>
    <B>George Birbilis
    </B> 
    <A HREF="mailto:birbilis%40kagi.com"
       TITLE="[Mono-list] some older MonoLogo code notes">birbilis@kagi.com
       </A><BR>
    <I>Mon, 7 Mar 2005 22:26:46 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="026213.html">[Mono-list] escaping a string for sql
</A></li>
        <LI> Next message: <A HREF="026209.html">[Mono-list] GnomeVFS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26201">[ date ]</a>
              <a href="thread.html#26201">[ thread ]</a>
              <a href="subject.html#26201">[ subject ]</a>
              <a href="author.html#26201">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sometime ago I took a look at MonoLOGO and also sent some e-mails to its
creator regarding enhancing it etc., but never got an answer. It seems
abandonned.

Nevertheless I'm senting some notes I kept while trying to build it, since
I'm going to throw away those files from my PC and the notes might be useful
to somebody in the future:

see //Birb in the code below

* console/console-gtk.cs (didn't make to build that I think):

 public ConsoleGtk ()
  {
   Window win = new Window (&quot;MonoLOGO&quot;);
   //win.DeleteEvent += new EventHandler(Window_Delete); //Birb: commented
out
   win.BorderWidth = 4;
   win.DefaultSize = new Gdk.Size (450, 300); //Birb: added &quot;Gdk.&quot;

   VBox vbox = new VBox (false, 4);
   win.Add (vbox); //Birb: changed from &quot;EmitAdd&quot;

   ...

   swin.Add (text); //Birb: changed from &quot;swin.EmitAdd&quot;

   Entry entry = new Entry ();
   entry.Activated += new EventHandler (Entry_Activate); //Birb: changed
&quot;Activate&quot; to &quot;Activated&quot;
   vbox.PackStart (entry, false, false, 0);

* console/console.cs:

namespace Mono.Languages.Logo
{
 using Mono.Languages.Logo.Compiler; //Birb: changed from &quot;Mono.LOGO.Lib&quot;
 using Mono.Languages.Logo.Runtime; //Birb: changed from &quot;Mono.LOGO.Lib&quot;
 using System;
 using System.IO;

 public abstract class LogoConsole
 {
  InstructionList stack = new InstructionList (); //Birb: changed from
&quot;LogoStack&quot;
  Parser parser = new Parser (); //Birb: changed from &quot;LogoParser&quot;
  Interpreter interpreter; //Birb: added

  IMessageStoreCollection funcs; //Birb: added
  LogoMessageTarget lmt; //Birb: added

  private void LoadFuncs ()  //Birb: added
  {
   if (interpreter==null){
    funcs = new IMessageStoreCollection ();
    funcs.Add (new CTSMessageTarget (typeof (Funcs)));
    lmt = new LogoMessageTarget ();
    funcs.Add (lmt);
    interpreter = new Interpreter(funcs);
   }
  }

  ...

  public void InputCommand (string cmd)
  {
   //int ret = -1; //Birb: removed
   object ret; //Birb: added

   Console.WriteLine (&quot;? &quot; + cmd);
   InstructionList tree; //Birb: added
   tree = parser.Parse (cmd); //Birb: changed from &quot;ParseString&quot; and added
assingment to tree variable
   if (tree != null) //Birb: changed from &quot;parser.Tree&quot;
   {
    try
    {
     LoadFuncs ();
     ret = interpreter.Execute (tree/*stack*/); //Birb: changed from
&quot;parser.Tree.Eval&quot;
    }
    catch (Exception e)
    {
     Console.WriteLine (e.Message);
    }
   }
   else
    Console.WriteLine (&quot;parse error&quot;);
   stack.Clear ();
  }
 }
}

* console/textwriter-gtk.cs:

  public override void Write (string value)
  {
   buf.Insert (buf.EndIter, value/*, value.Length*/); //Birb: removed last
part
  }

* Tokenizer.cs:

 public class Tokenizer {

  ...

  private static bool IsNewline (char c) {
   return (c == '\n') || (c == '\r'); //Birb: added support for CRLF, not
just LF
  }

 ...

  private static bool IsNumber (string str, out double num) {
   num = 0;

   if (str.Length == 1 &amp;&amp; IsInfix (str[0]))
    return false;

   try {
    num = Double.Parse (str);
    return true;
   } catch (Exception /*e*/) { //Birb: removed &quot;e&quot;
    return false;
   }
  }

 ...

  private Token TokenForChar (int c_prev_int, int c_peek_int, char c) {
   if (c == '-') {
    TokenType type;
    if (c_prev_int == -1)
     type = TokenType.Minus;
    else if (c_peek_int == -1)
     type = TokenType.Infix;
    else {
     char c_prev = (char) c_prev_int;
     char c_peek = (char) c_peek_int;
     if (IsNumber (c_peek) || IsSymbolStart (c_peek) || c_peek == '(') {
      if (c_prev == ')')
       type = TokenType.Infix;
      else
       type = TokenType.Minus;
     } else {
      type = TokenType.Infix;
     }
    }
    return new Token (type, c);
   } else if (c == '(')
    return new Token (TokenType.OpenParens, c);
   else if (c == ')')
    return new Token (TokenType.CloseParens, c);
   else if (c == '[')
    return new Token (TokenType.OpenBracket, c);
   else if (c == ']')
    return new Token (TokenType.CloseBracket, c);
   else if (IsNewline(c)) //Birb: changed from [c == '\n'] to add support
for CRLF instead of just LF
    return new Token (TokenType.Newline, c);
   else if (IsInfix (c))
    return new Token (TokenType.Infix, c);
   else if (allow_question_mark &amp;&amp; c == '?')
    return new Token (TokenType.QuestionMark, c);
   else
    throw new Exception (&quot;Unexpected input: &quot; + c);
  }

regarding the 1st three files, I've never programmed Gtk+ so I might be
totally wrong, but I just couldn't compile the files from the CVS at all so
tried to fix them as I thought best. At the Tokenizer.cs, a change removes
some unused variable warning (make an exception unnamed instead of named
one) and added CRLF support too apart from LF one for newlines in parsed
content

cheers,
George

P.S. for the project I had I finally resulted in writing my own Logo
tokenizer, parser and (meta)compiler to RemObjects PascalScript. Was/Is an
interesting excercise, but would rather have merged MonoLogo and
TurtleTracks Logo functionality instead as was my original intent...

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
George Birbilis &lt;<A HREF="mailto:birbilis@kagi.com">birbilis@kagi.com</A>&gt;
Microsoft MVP J# for 2004, 2005
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ QuickTime controls (Delphi &amp; ActiveX: VB, PowerPoint, .NET)
+ Plugs (InterProcess/Internet communication)
+ TranXform (VB6 form to ASP.net WebForm convertion)
<A HREF="http://www.kagi.com/birbilis">http://www.kagi.com/birbilis</A>
+ Robotics
<A HREF="http://www.mech.upatras.gr/~robgroup">http://www.mech.upatras.gr/~robgroup</A>
........................................................................


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="026213.html">[Mono-list] escaping a string for sql
</A></li>
	<LI> Next message: <A HREF="026209.html">[Mono-list] GnomeVFS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26201">[ date ]</a>
              <a href="thread.html#26201">[ thread ]</a>
              <a href="subject.html#26201">[ subject ]</a>
              <a href="author.html#26201">[ author ]</a>
         </LI>
       </UL>
</body></html>
