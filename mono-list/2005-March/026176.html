<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Current state of FormsAuthentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:ilyak%40mainsoft.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="026171.html">
   <LINK REL="Next"  HREF="026203.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Current state of FormsAuthentication
   </H1>
    <B>Ilya Kharmatsky
    </B> 
    <A HREF="mailto:ilyak%40mainsoft.com"
       TITLE="[Mono-list] Current state of FormsAuthentication">ilyak@mainsoft.com
       </A><BR>
    <I>Sun, 06 Mar 2005 18:49:01 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="026171.html">[Mono-list] Current state of FormsAuthentication
</A></li>
        <LI> Next message: <A HREF="026203.html">[Mono-list] Current state of FormsAuthentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26176">[ date ]</a>
              <a href="thread.html#26176">[ thread ]</a>
              <a href="subject.html#26176">[ subject ]</a>
              <a href="author.html#26176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.
--------------060608060903090102060008
Content-Type: multipart/alternative;
 boundary=&quot;------------050407030105050604070602&quot;


--------------050407030105050604070602
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hi!

We found regression in latest version of Forms Authentication - in case
when the FormsAuthenticationTicket is not persistent (created with
FormsAuthentication.SetAuthCookie(&quot;userName&quot;, false))
the HttpRequest.IsAuthenticated will return false.

Attached possible patch (in FormsAuthenticationModule.cs) and test case.

Thanks,
Ilya Kharmatsky.

Gonzalo Paniagua Javier wrote:

&gt;<i>On Wed, 2005-03-02 at 11:45 -0700, Jesse Pasichnyk wrote:
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>I am working on developing an ecommerce site with mono/postgres and am
</I>&gt;&gt;<i>having some issues with the a Forms based security login area. 
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Last mono release shipped with a regression that might make
</I>&gt;<i>FormsAuthentication fail.
</I>&gt;<i>
</I>&gt;<i>You can get a new System.Web.dll from
</I>&gt;<i><A HREF="http://www.go-mono.com/archive/1.0.6/System.Web.dll">http://www.go-mono.com/archive/1.0.6/System.Web.dll</A> or
</I>&gt;<i><A HREF="http://www.go-mono.com/archive/1.1.4/System.Web.dll">http://www.go-mono.com/archive/1.1.4/System.Web.dll</A>
</I>&gt;<i>
</I>&gt;<i>-Gonzalo
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>
--------------050407030105050604070602
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta content=&quot;text/html;charset=ISO-8859-1&quot; http-equiv=&quot;Content-Type&quot;&gt;
  &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body bgcolor=&quot;#ffffff&quot; text=&quot;#000000&quot;&gt;
Hi!&lt;br&gt;
&lt;br&gt;
We found regression in latest version of Forms Authentication - in case&lt;br&gt;
when the FormsAuthenticationTicket is not persistent (created with &lt;br&gt;
FormsAuthentication.SetAuthCookie(&quot;userName&quot;, false)) &lt;br&gt;
the HttpRequest.IsAuthenticated will return false.&lt;br&gt;
&lt;br&gt;
Attached possible patch (in FormsAuthenticationModule.cs) and test
case. &lt;br&gt;
&lt;br&gt;
Thanks,&lt;br&gt;
Ilya Kharmatsky.&lt;br&gt;
&lt;br&gt;
Gonzalo Paniagua Javier wrote:
&lt;blockquote cite=&quot;<A HREF="mailto:mid1110070103.31447.11.camel@localhost.localdomain">mid1110070103.31447.11.camel@localhost.localdomain</A>&quot;
 type=&quot;cite&quot;&gt;
  &lt;pre wrap=&quot;&quot;&gt;On Wed, 2005-03-02 at 11:45 -0700, Jesse Pasichnyk wrote:
  &lt;/pre&gt;
  &lt;blockquote type=&quot;cite&quot;&gt;
    &lt;pre wrap=&quot;&quot;&gt;I am working on developing an ecommerce site with mono/postgres and am
having some issues with the a Forms based security login area. 
    &lt;/pre&gt;
  &lt;/blockquote&gt;
  &lt;pre wrap=&quot;&quot;&gt;&lt;!----&gt;

Last mono release shipped with a regression that might make
FormsAuthentication fail.

You can get a new System.Web.dll from
&lt;a class=&quot;moz-txt-link-freetext&quot; href=&quot;<A HREF="http://www.go-mono.com/archive/1.0.6/System.Web.dll"">http://www.go-mono.com/archive/1.0.6/System.Web.dll&quot;</A>&gt;<A HREF="http://www.go-mono.com/archive/1.0.6/System.Web.dll</a">http://www.go-mono.com/archive/1.0.6/System.Web.dll&lt;/a</A>&gt; or
&lt;a class=&quot;moz-txt-link-freetext&quot; href=&quot;<A HREF="http://www.go-mono.com/archive/1.1.4/System.Web.dll"">http://www.go-mono.com/archive/1.1.4/System.Web.dll&quot;</A>&gt;<A HREF="http://www.go-mono.com/archive/1.1.4/System.Web.dll</a">http://www.go-mono.com/archive/1.1.4/System.Web.dll&lt;/a</A>&gt;

-Gonzalo


_______________________________________________
Mono-list maillist  -  &lt;a class=&quot;moz-txt-link-abbreviated&quot; href=&quot;mailto:<A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>&quot;&gt;<A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>&lt;/a&gt;
&lt;a class=&quot;moz-txt-link-freetext&quot; href=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list"">http://lists.ximian.com/mailman/listinfo/mono-list&quot;</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list</a">http://lists.ximian.com/mailman/listinfo/mono-list&lt;/a</A>&gt;

  &lt;/pre&gt;
&lt;/blockquote&gt;
&lt;/body&gt;
&lt;/html&gt;

--------------050407030105050604070602--

--------------060608060903090102060008
Content-Type: text/plain;
 name=&quot;FormAuthModule.patch&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;FormAuthModule.patch&quot;

Index: System.Web.Security/FormsAuthenticationModule.cs
===================================================================
--- System.Web.Security/FormsAuthenticationModule.cs	(revision 41482)
+++ System.Web.Security/FormsAuthenticationModule.cs	(working copy)
@@ -15,10 +15,10 @@
 // distribute, sublicense, and/or sell copies of the Software, and to
 // permit persons to whom the Software is furnished to do so, subject to
 // the following conditions:
-// 
+//
 // The above copyright notice and this permission notice shall be
 // included in all copies or substantial portions of the Software.
-// 
+//
 // THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
 // EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 // MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
@@ -65,7 +65,7 @@
 			string reqPath = context.Request.PhysicalPath;
 			string loginPath = context.Request.MapPath (loginPage);
 			context.SkipAuthorization = (reqPath == loginPath);
-			
+
 			FormsAuthenticationEventArgs formArgs = new FormsAuthenticationEventArgs (context);
 			if (Authenticate != null)
 				Authenticate (this, formArgs);
@@ -76,13 +76,13 @@
 					context.User = formArgs.User;
 				return;
 			}
-				
+
 			HttpCookie cookie = context.Request.Cookies [cookieName];
 			if (cookie == null || (cookie.Expires != DateTime.MinValue &amp;&amp; cookie.Expires &lt; DateTime.Now))
 				return;
 
 			FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt (cookie.Value);
-			if (ticket == null || ticket.Expired)
+			if (ticket == null || (ticket.IsPersistent &amp;&amp; ticket.Expired))
 				return;
 
 			if (config.SlidingExpiration)

--------------060608060903090102060008
Content-Type: text/plain;
 name=&quot;FormsAuthTestCase.txt&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;FormsAuthTestCase.txt&quot;

private void Page_Load(object sender, System.EventArgs e)
{
	Response.Write(&quot;Request.IsAuthenticated &quot;+Request.IsAuthenticated + &quot;&lt;br&gt;&quot;);
	HttpCookieCollection collection = Response.Cookies;
	Response.Write(&quot;Before setting forms cookie! &lt;br&gt;&quot;);
	foreach(string o in collection)
	{
		Response.Write(collection[o].Name + &quot; &quot; +collection[o].Value + &quot;&lt;br&gt;&quot;);				
	}
	FormsAuthentication.SetAuthCookie(&quot;userName&quot;, false);
	collection = Response.Cookies;
	Response.Write(&quot;After setting forms cookie! &lt;br&gt;&quot;);
	foreach(string o in collection)
	{
		Response.Write(collection[o].Name + &quot; &quot; +collection[o].Value + &quot; &quot; + collection[o].Expires + &quot;&lt;br&gt;&quot;);				
	}
}

--------------060608060903090102060008--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="026171.html">[Mono-list] Current state of FormsAuthentication
</A></li>
	<LI> Next message: <A HREF="026203.html">[Mono-list] Current state of FormsAuthentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26176">[ date ]</a>
              <a href="thread.html#26176">[ thread ]</a>
              <a href="subject.html#26176">[ subject ]</a>
              <a href="author.html#26176">[ author ]</a>
         </LI>
       </UL>
</body></html>
