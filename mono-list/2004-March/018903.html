<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Executing Programmer-Specified Method from Within Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="018860.html">
   <LINK REL="Next"  HREF="018861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Executing Programmer-Specified Method from Within Mono
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Executing Programmer-Specified Method from Within Mono">lupus@ximian.com
       </A><BR>
    <I>Fri, 12 Mar 2004 15:55:45 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="018860.html">[Mono-list] Executing Programmer-Specified Method from Within Mono
</A></li>
        <LI> Next message: <A HREF="018861.html">[Mono-list] problem with testing on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18903">[ date ]</a>
              <a href="thread.html#18903">[ thread ]</a>
              <a href="subject.html#18903">[ subject ]</a>
              <a href="author.html#18903">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/10/04 Hamza Karamali wrote:
&gt;<i> While compiling a certain method in mini_method_compile, I want to invoke
</I>&gt;<i> a method written in C# (I know the name) and pass as an argument to the
</I>&gt;<i> method a certain local variable (e.g. local[12]).  The C# method returns a
</I>&gt;<i> boolean, and I want to check the value of this returned result.
</I>&gt;<i> 
</I>&gt;<i> Can anyone give me any tips on how I can accomplish this?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> Hamza.
</I>&gt;<i> 
</I>&gt;<i> PS: To make the scenario clearer, here is exactly what I'm doing
</I>&gt;<i> 
</I>&gt;<i> 1. Mono is compiling methodA and is currently in the mini_method_compile
</I>&gt;<i> function.
</I>&gt;<i> 
</I>&gt;<i> 2. I want to invoke methodB *from within Mono*, and pass it as an argument
</I>&gt;<i> local[12], which is one of the local variables of methodA.
</I>&gt;<i> 
</I>&gt;<i> 3. methodB returns a boolean.  I want to find out whether it returned true
</I>&gt;<i> or false.
</I>
Note that a local variable value exists only once a method is actually
executed, so what you say is not possible. My guess is that you want one
of two things:
1) invoke a managed method from C code (it doesn't matter if it's from
mini_method_compile() or not): use mono_runtime_invoke () from the
metadata/object.h header file.
2) inject a call to methodB inside the method you're currently
compiling and make it act upon the result. This is not very simple, but
you can look at how IL opcodes that do the same thing you need are
handled and do a bit of cut &amp; paste. Basically you need to create
by hand the internal representation data structures.
For example, to load a local, you can just look at the CEE_LDLOC case in
the big switch:
	MonoInst *load;
	NEW_LOCLOAD (cfg, load, 12);
will create in load the code. Then you need to synthetize the call: have
a look at the CEE_CALL case (ignore all the special cases). It basically
is a call to:
	temp = mono_emit_method_call_spilled (cfg, bblock, called_method, method_signature, 
		&amp;load, ip, NULL);

Where temp is a boolean local created with mono_compile_create_var ().
Then you can look at the code emitted for BRTRUE/BRFALSE and do the
same. You'll likely need to create additional basic blocks to support
the jumps and connect them in the graph: you'll insert more handling code 
inside them.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="018860.html">[Mono-list] Executing Programmer-Specified Method from Within Mono
</A></li>
	<LI> Next message: <A HREF="018861.html">[Mono-list] problem with testing on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18903">[ date ]</a>
              <a href="thread.html#18903">[ thread ]</a>
              <a href="subject.html#18903">[ subject ]</a>
              <a href="author.html#18903">[ author ]</a>
         </LI>
       </UL>
</body></html>
