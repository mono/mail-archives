<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: magic quotes (like PHP) (or prevent SQL Injection)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:topace%40lightbox.org">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="026542.html">
   <LINK REL="Next"  HREF="026544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: magic quotes (like PHP) (or prevent SQL Injection)
   </H1>
    <B>James Grant
    </B> 
    <A HREF="mailto:topace%40lightbox.org"
       TITLE="[Mono-list] Re: magic quotes (like PHP) (or prevent SQL Injection)">topace@lightbox.org
       </A><BR>
    <I>Tue, 12 Apr 2005 09:52:34 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="026542.html">[Mono-list] Re: magic quotes (like PHP) (or prevent SQL Injection)
</A></li>
        <LI> Next message: <A HREF="026544.html">[Mono-list] [Fwd: [Open Office] ANNOUNCE: ooo-build-1.9.90]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26596">[ date ]</a>
              <a href="thread.html#26596">[ thread ]</a>
              <a href="subject.html#26596">[ subject ]</a>
              <a href="author.html#26596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ahh, indeed - the code in question is using a string concatenation.

                        request = &quot;public.\&quot;InsertSchool\&quot;( '&quot; +
                                Name.Replace(&quot;'&quot;,&quot;\\'&quot;) + &quot;', '&quot; +
                                Address1.Replace(&quot;'&quot;,&quot;\\'&quot;)  + &quot;', '&quot; + .....


or at least, _some_ of it is using string concatenations - some is using (what 
might be) correct parameterization?


                        NpgsqlConnection npgsqlConnection = new 
NpgsqlConnection(cstr);
                        NpgsqlCommand command = new NpgsqlCommand(&quot;public.
\&quot;InsertRecord\&quot;(:a,:b,:c, :d,:f)&quot;, npgsqlConnection);
                                
                        command.Parameters.Add(new 
NpgsqlParameter(&quot;a&quot;,DbType.Int32));
                        command.Parameters.Add(new 
NpgsqlParameter(&quot;b&quot;,DbType.String));
                        command.Parameters.Add(new 
NpgsqlParameter(&quot;c&quot;,DbType.Int32));
                        command.Parameters.Add(new 
NpgsqlParameter(&quot;d&quot;,DbType.Int32));
                        command.Parameters.Add(new 
NpgsqlParameter(&quot;f&quot;,DbType.String));
                                
                        command.Parameters[0].Value = UserID;
                        command.Parameters[1].Value = Password;
                        command.Parameters[2].Value = ExtraID;
                        command.Parameters[3].Value = Year;
                        command.Parameters[4].Value = Title;
                                
                        command.CommandType = CommandType.StoredProcedure;
                        npgsqlConnection.Open();
                        try     
                        {
                                Object o = command.ExecuteScalar();
                                nReturn = Int32.Parse(o.ToString());
                        }

So I guess this code calling the stored procedure would work properly without 
having Title.Replace(&quot;'&quot;,&quot;\\'&quot;) .  Is this how it should all be done?  Its 
curious why some parts of the code do it this way, and others do it the other 
way... either there's a sound reason behind using both methods in different 
places, or pure randomness....

(its not my code!)

Thanks for your response!

Cheers,
  James


On Friday 08 April 2005 4:00 pm, Richard Norman wrote:
&gt;<i> I am not sure if this is database specific, but to avoid SQL Injection
</I>&gt;<i> attacks, what should be going on in all queries (but it is developer's
</I>&gt;<i> choice today) is that you use parameters in the query.
</I>&gt;<i>
</I>&gt;<i> Either parameterized queries or stored procedures. We mostly use SQL server
</I>&gt;<i> so I am not sure how other DBMS handle this, but in SQL server when you use
</I>&gt;<i> parameters, the &quot;special&quot; characters are automatically escaped properly.
</I>&gt;<i>
</I>&gt;<i> If you are using a concat string, then you could be vulnerable to this
</I>&gt;<i> attack. Microsoft has been talking about it a lot in their security talks
</I>&gt;<i> recently.
</I>&gt;<i>
</I>&gt;<i> Something like the following (using C#) is better.
</I>&gt;<i> *******************************************
</I>&gt;<i> System.Data.SqlClient.SqlCommand test1;
</I>&gt;<i> test1 = new System.Data.SqlClient.SqlCommand(&quot;Select name from table where
</I>&gt;<i> [ID]=@tempID&quot;); test1.CommandType = System.Data.CommandType.Text;
</I>&gt;<i> System.Data.SqlClient.SqlParameter para1 = new
</I>&gt;<i> System.Data.SqlClient.SqlParameter(&quot;@tempID&quot;,
</I>&gt;<i> System.Data.SqlDbType.VarChar, 50); test1.Parameters.Add(para1);
</I>&gt;<i> *******************************************
</I>&gt;<i>
</I>&gt;<i> But that is what I recomend if the system supports it. And if not, Scrub
</I>&gt;<i> the data REALLY well.. ;-)
</I>&gt;<i>
</I>&gt;<i> Richard Norman
</I>&gt;<i> Web &amp; Application Developer
</I>&gt;<i> <A HREF="http://www.jazzynupe.net/Community/blog/">http://www.jazzynupe.net/Community/blog/</A>
</I>&gt;<i>
</I>&gt;<i> Refs:
</I>&gt;<i> <A HREF="http://search.microsoft.com/search/results.aspx?qu=SQL+Injection&View=msdn&">http://search.microsoft.com/search/results.aspx?qu=SQL+Injection&amp;View=msdn&amp;</A>
</I>&gt;<i>st=b&amp;c=0&amp;s=1&amp;swc=0
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://toolbar.search.msn.com/results.aspx?FORM=DESKBR&q=SQL+Injection">http://toolbar.search.msn.com/results.aspx?FORM=DESKBR&amp;q=SQL+Injection</A>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; <A HREF="mailto:mono-list-request@lists.ximian.com">mono-list-request@lists.ximian.com</A> 4/7/2005 6:22:12 PM &gt;&gt;&gt;
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> From: James Grant &lt;<A HREF="mailto:topace@lightbox.org">topace@lightbox.org</A>&gt;
</I>&gt;<i> Organization: Lightbox Technologies Inc
</I>&gt;<i> To: <A HREF="mailto:mono-list@lists.ximian.com">mono-list@lists.ximian.com</A>
</I>&gt;<i> Date: Thu, 7 Apr 2005 12:06:36 -0400
</I>&gt;<i> Subject: [Mono-list] magic quotes (like PHP)
</I>&gt;<i>
</I>&gt;<i> Hi there,
</I>&gt;<i> I'm running into an issue with an application that has been ported over
</I>&gt;<i> from windows to linux/mono.  On windows, you could enter apostrophe's in
</I>&gt;<i> input boxes which are then stored in the database without any problems, but
</I>&gt;<i> on mono it seems that the apostrophe's all need to be manually escaped on
</I>&gt;<i> every query.
</I>&gt;<i>
</I>&gt;<i> I know PHP has an option for &quot;magic quotes&quot;
</I>&gt;<i>     <A HREF="http://ca.php.net/manual/en/ref.info.php#ini.magic-quotes-runtime">http://ca.php.net/manual/en/ref.info.php#ini.magic-quotes-runtime</A>
</I>&gt;<i>
</I>&gt;<i> and was wondering if mono had a similar configuration option?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>   James
</I>
-- 
James Grant
Lightbox Technologies Inc.
<A HREF="http://www.lightbox.org">http://www.lightbox.org</A>
613-294-3670

-- 
James Grant
Lightbox Technologies Inc.
<A HREF="http://www.lightbox.org">http://www.lightbox.org</A>
613-294-3670

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="026542.html">[Mono-list] Re: magic quotes (like PHP) (or prevent SQL Injection)
</A></li>
	<LI> Next message: <A HREF="026544.html">[Mono-list] [Fwd: [Open Office] ANNOUNCE: ooo-build-1.9.90]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26596">[ date ]</a>
              <a href="thread.html#26596">[ thread ]</a>
              <a href="subject.html#26596">[ subject ]</a>
              <a href="author.html#26596">[ author ]</a>
         </LI>
       </UL>
</body></html>
