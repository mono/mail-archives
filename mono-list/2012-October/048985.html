<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Addresses marked as ??? in Valgrind stack trace
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Addresses%20marked%20as%20%3F%3F%3F%20in%20Valgrind%20stack%20trace&In-Reply-To=%3C506E102D.7080809%40dayark.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048984.html">
   <LINK REL="Next"  HREF="048988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Addresses marked as ??? in Valgrind stack trace</H1>
    <B>Gregory Junker</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Addresses%20marked%20as%20%3F%3F%3F%20in%20Valgrind%20stack%20trace&In-Reply-To=%3C506E102D.7080809%40dayark.com%3E"
       TITLE="[Mono-list] Addresses marked as ??? in Valgrind stack trace">gjunker at dayark.com
       </A><BR>
    <I>Thu Oct  4 22:39:41 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="048984.html">[Mono-list] Addresses marked as ??? in Valgrind stack trace
</A></li>
        <LI>Next message: <A HREF="048988.html">[Mono-list] Addresses marked as ??? in Valgrind stack trace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48985">[ date ]</a>
              <a href="thread.html#48985">[ thread ]</a>
              <a href="subject.html#48985">[ subject ]</a>
              <a href="author.html#48985">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/4/2012 11:19 AM, Kerrick Staley wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I'm running Valgrind on Mono as it executes a C# program. The C# program
</I>&gt;<i> in question invokes several native routines in several different shared
</I>&gt;<i> object files, and it's crashing in one of these native routines. The
</I>&gt;<i> following is a snippet from Valgrind's output:
</I>&gt;<i>
</I>&gt;<i> ==3652== Thread 5:
</I>&gt;<i> ==3652== Conditional jump or move depends on uninitialised value(s)
</I>&gt;<i> ==3652==    at 0xA55A385: ???
</I>&gt;<i> ==3652==    by 0xA55A1F7: ???
</I>&gt;<i> ==3652==    by 0x78C8074: ???
</I>&gt;<i> ==3652==    by 0x8064415: mono_jit_runtime_invoke (mini.c:5791)
</I>&gt;<i> ==3652==    by 0x81AF4EE: mono_runtime_invoke (object.c:2755)
</I>&gt;<i> ==3652==    by 0x81AF8F3: mono_runtime_delegate_invoke (object.c:3420)
</I>&gt;<i> ==3652==    by 0x8202FEB: start_wrapper (threads.c:790)
</I>&gt;<i> ==3652==    by 0x82305EE: thread_start_routine (wthreads.c:287)
</I>&gt;<i> ==3652==    by 0x416FD5D: clone (clone.S:130)
</I>&gt;<i> ==3652==
</I>&gt;<i> ==3652== Invalid read of size 4
</I>&gt;<i> ==3652==    at 0xA55A543: ???
</I>&gt;<i> ==3652==    by 0xA55A1F7: ???
</I>&gt;<i> ==3652==    by 0x78C8074: ???
</I>&gt;<i> ==3652==    by 0x8064415: mono_jit_runtime_invoke (mini.c:5791)
</I>&gt;<i> ==3652==    by 0x81AF4EE: mono_runtime_invoke (object.c:2755)
</I>&gt;<i> ==3652==    by 0x81AF8F3: mono_runtime_delegate_invoke (object.c:3420)
</I>&gt;<i> ==3652==    by 0x8202FEB: start_wrapper (threads.c:790)
</I>&gt;<i> ==3652==    by 0x82305EE: thread_start_routine (wthreads.c:287)
</I>&gt;<i> ==3652==    by 0x416FD5D: clone (clone.S:130)
</I>&gt;<i> ==3652==  Address 0x0 is not stack'd, malloc'd or (recently) free'd
</I>&gt;<i> ==3652==
</I>&gt;<i> ==3652== Thread 5 return signal frame corrupted.  Killing process.
</I>&gt;<i> ==3652==
</I>&gt;<i> ==3652== Process terminating with default action of signal 11 (SIGSEGV)
</I>&gt;<i> ==3652==  General Protection Fault
</I>&gt;<i> ==3652==    at 0x408F655: ??? (in /lib/libpthread-2.11.3.so
</I>&gt;<i> &lt;<A HREF="http://libpthread-2.11.3.so">http://libpthread-2.11.3.so</A>&gt;)
</I>&gt;<i> ==3652==    by 0xA55A1F7: ???
</I>&gt;<i> ==3652==    by 0x78C8074: ???
</I>&gt;<i> ==3652==    by 0x8064415: mono_jit_runtime_invoke (mini.c:5791)
</I>&gt;<i> ==3652==    by 0x81AF4EE: mono_runtime_invoke (object.c:2755)
</I>&gt;<i> ==3652==    by 0x81AF8F3: mono_runtime_delegate_invoke (object.c:3420)
</I>&gt;<i> ==3652==    by 0x8202FEB: start_wrapper (threads.c:790)
</I>&gt;<i> ==3652==    by 0x82305EE: thread_start_routine (wthreads.c:287)
</I>&gt;<i> ==3652==    by 0x416FD5D: clone (clone.S:130)
</I>&gt;<i>
</I>&gt;<i> I can't track down the error since the stack trace doesn't indicate
</I>&gt;<i> which shared object and function it occurs in.
</I>&gt;<i>
</I>&gt;<i> According to <A HREF="http://valgrind.org/docs/manual/faq.html#faq.unhelpful,">http://valgrind.org/docs/manual/faq.html#faq.unhelpful,</A> if
</I>&gt;<i> a shared object is unloaded before the program terminates, ??? entries
</I>&gt;<i> will appear in the stack trace, so I'm guessing that Mono is dynamically
</I>&gt;<i> unloading the shared object after the segfault. I'm unsure as to whether
</I>&gt;<i> this hunch even makes sense, though. Is there anything I can do on
</I>&gt;<i> either the Valgrind or the Mono side to get more information from the
</I>&gt;<i> stack trace?
</I>
Well, for starters, you can look at what line 5791 in mini.c is doing:

<A HREF="https://github.com/mono/mono/blob/master/mono/mini/mini.c">https://github.com/mono/mono/blob/master/mono/mini/mini.c</A>

It looks like it's calling mono_raise_exception, and if you follow the 
chain of calls from there, it eventually is calling an 
exception-handling function pointer, so the FAQ probably is in correct 
in this case.

One thing you can do with Valgrind is have it break to debugger on 
errors, by supplying the --attach-db=yes option. If you still can't get 
function names in GDB, you may be able to get module names (the 
addresses look to be in different modules than the Mono runtime), and 
from there you might have to get your hands dirty with nm or objdump.

HTH
Greg
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048984.html">[Mono-list] Addresses marked as ??? in Valgrind stack trace
</A></li>
	<LI>Next message: <A HREF="048988.html">[Mono-list] Addresses marked as ??? in Valgrind stack trace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48985">[ date ]</a>
              <a href="thread.html#48985">[ thread ]</a>
              <a href="subject.html#48985">[ subject ]</a>
              <a href="author.html#48985">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
