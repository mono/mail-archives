<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] NuGet struggles
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20NuGet%20struggles&In-Reply-To=%3CCACBComFSi2guDHN6eWMP7ZR-2eQrXCY4fioECH2J%2BS9xhc3ncA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049033.html">
   <LINK REL="Next"  HREF="049031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] NuGet struggles</H1>
    <B>Weeble</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20NuGet%20struggles&In-Reply-To=%3CCACBComFSi2guDHN6eWMP7ZR-2eQrXCY4fioECH2J%2BS9xhc3ncA%40mail.gmail.com%3E"
       TITLE="[Mono-list] NuGet struggles">clockworksaint at gmail.com
       </A><BR>
    <I>Tue Oct 16 10:55:09 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="049033.html">[Mono-list] MVC3 project on Mono 2.11.4 - problems
</A></li>
        <LI>Next message: <A HREF="049031.html">[Mono-list] NuGet struggles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49025">[ date ]</a>
              <a href="thread.html#49025">[ thread ]</a>
              <a href="subject.html#49025">[ subject ]</a>
              <a href="author.html#49025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm having trouble with NuGet on recent development versions of Mono.
It works fine on 2.11.1, but on 2.11.2 and 2.11.4 (I haven't tried
.3), when it tries to download several packages at once it will get
some of them, but then hang for about two minutes before timing out
with a message like this:

WARNING: Could not connect to the feed specified at
'<A HREF="https://nuget.org/api/v2/">https://nuget.org/api/v2/</A>'. Please verify that the package source
(located in the Package Manager Settings) is valid and ensure your
network connectivity.
Unable to find version '0.3.1' of package 'Gate'.

Under 2.11.1 it downloads all the packages in 20 seconds or so. It
certainly doesn't take close to the amount of time it takes for it to
time out with recent Mono versions. I've observed this on both a
32-bit Linux VM with 4 CPUs (running on a Windows 7 host with a 4 core
hyperthreaded i7), and on a Mac Mini. It doesn't seem to happen when
fetching a small number of packages, but seems to become a certainty
when fetching around five or more. Which package will fail seems to be
unpredictable, probably because they are all downloaded in parallel.

Here's a paste of a console session showing what I see:
<A HREF="http://pastebin.com/NeYedE9n">http://pastebin.com/NeYedE9n</A>


I built NuGet from source (using Visual Studio - I had problems with
its build files in Mono) and got it to print out the exception stack
trace that's causing it to fail. I'm not certain that it fails the
same way every time, but it does fail every time:

 System.Net.WebException: The request timed out
  at System.Net.HttpWebRequest.EndGetResponse (IAsyncResult asyncResult)
  at System.Net.HttpWebRequest.GetResponse ()
  at System.Data.Services.Client.QueryResult.Execute ()
  --- End of inner exception stack trace ---
  at NuGet.DataServiceQueryWrapper`1[NuGet.IPackage].Execute[IEnumerable]
(System.Func`1 action)
  at NuGet.DataServiceQueryWrapper`1+&lt;GetAll&gt;d__7[NuGet.IPackage].MoveNext ()
  at System.Collections.Generic.List`1[NuGet.IPackage].AddEnumerable
(IEnumerable`1 enumerable)
  at System.Collections.Generic.List`1[NuGet.IPackage]..ctor
(IEnumerable`1 collection)
  at System.Linq.Enumerable.ToList[IPackage] (IEnumerable`1 source)
  at NuGet.PackageRepositoryExtensions.FindPackagesByIdCore
(IPackageRepository repository, System.String packageId)
  at NuGet.PackageRepositoryExtensions.FindPackagesById
(IPackageRepository repository, System.String packageId)
  at NuGet.PackageRepositoryExtensions.FindPackage (IPackageRepository
repository, System.String packageId, NuGet.Semanti
cVersion version, IPackageConstraintProvider constraintProvider,
Boolean allowPrereleaseVersions, Boolean allowUnlisted)


My questions:

1. Did anything change between 2.11.1 and 2.11.2 that might affect the
behaviour of HttpWebRequest or System.Data.Services, especially when
multiple threads are making simultaneous independent requests?
2. Any suggestions for next steps to diagnose this?

Regards,

Weeble.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049033.html">[Mono-list] MVC3 project on Mono 2.11.4 - problems
</A></li>
	<LI>Next message: <A HREF="049031.html">[Mono-list] NuGet struggles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49025">[ date ]</a>
              <a href="thread.html#49025">[ thread ]</a>
              <a href="subject.html#49025">[ subject ]</a>
              <a href="author.html#49025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
