<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] P/Invoke on amd64
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:james.fitzsimons%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="025727.html">
   <LINK REL="Next"  HREF="025697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] P/Invoke on amd64
   </H1>
    <B>James Fitzsimons
    </B> 
    <A HREF="mailto:james.fitzsimons%40gmail.com"
       TITLE="[Mono-list] P/Invoke on amd64">james.fitzsimons@gmail.com
       </A><BR>
    <I>Mon, 14 Feb 2005 22:15:48 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="025727.html">[Mono-list] P/Invoke on amd64
</A></li>
        <LI> Next message: <A HREF="025697.html">[Mono-list] gdiplus.dll Not Found?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25728">[ date ]</a>
              <a href="thread.html#25728">[ thread ]</a>
              <a href="subject.html#25728">[ subject ]</a>
              <a href="author.html#25728">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-ZX/4Cm5em1bDaENBTmmm
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Hi all,
Sorry to keep replying to myself ;)

Yay!! I have it working.

On Mon, 2005-02-14 at 21:55, James Fitzsimons wrote:
&gt;<i> However now that I am (reasonably) sure that P/Invoke is working
</I>&gt;<i> correctly I still can't use my target library libopencv.so. When trying
</I>&gt;<i> to load it I get the following errors:
</I>&gt;<i> Mono-INFO: DllImport loading: 'libopencv'.
</I>&gt;<i> Mono-INFO: DllImport error loading library '/usr/local/lib/libopencv.so:
</I>&gt;<i> undefined symbol: __gxx_personality_v0'.
</I>&gt;<i>=20
</I>&gt;<i> (CvImage.exe:8000): Mono-WARNING **: DllImport unable to load library
</I>&gt;<i> '/usr/local/lib/libopencv.so: undefined symbol: __gxx_personality_v0'.
</I>&gt;<i>=20
</I>&gt;<i> Unhandled Exception: System.DllNotFoundException: opencv
</I>&gt;<i>=20
</I>&gt;<i> Now, I am aware that this has something to do with libstdc++, and I
</I>&gt;<i> definately have that installed, but I don't know what to try next.
</I>So this is what I did. Previously doing an ldd on libhighgui.so what=20
giving me this:

<A HREF="mailto:james@athos">james@athos</A> src $ ldd /usr/local/lib/libhighgui.so=20
        libXm.so.3 =3D&gt; //usr/lib/libXm.so.3 (0x0000002a95675000)
        libMrm.so.3 =3D&gt; //usr/lib/libMrm.so.3 (0x0000002a95a0a000)
        libUil.so.3 =3D&gt; //usr/lib/libUil.so.3 (0x0000002a95b2e000)
        libpng.so.3 =3D&gt; //usr/lib/libpng.so.3 (0x0000002a95cb5000)
        libjpeg.so.62 =3D&gt; //usr/lib/libjpeg.so.62 (0x0000002a95deb000)
        libz.so.1 =3D&gt; /lib/libz.so.1 (0x0000002a95f33000)
        libtiff.so.3 =3D&gt; //usr/lib/libtiff.so.3 (0x0000002a96046000)
        libavcodec.so =3D&gt; //usr/lib/libavcodec.so (0x0000002a9619a000)
        libm.so.6 =3D&gt; /lib/libm.so.6 (0x0000002a966f8000)
        libc.so.6 =3D&gt; /lib/libc.so.6 (0x0000002a9687e000)
        libXmu.so.6 =3D&gt; /usr/lib/libXmu.so.6 (0x0000002a96aa5000)
        libXt.so.6 =3D&gt; /usr/lib/libXt.so.6 (0x0000002a96bbd000)
        libSM.so.6 =3D&gt; /usr/lib/libSM.so.6 (0x0000002a96d20000)
        libICE.so.6 =3D&gt; /usr/lib/libICE.so.6 (0x0000002a96e2b000)
        libXext.so.6 =3D&gt; /usr/lib/libXext.so.6 (0x0000002a96f46000)
        libXp.so.6 =3D&gt; /usr/lib/libXp.so.6 (0x0000002a97057000)
        libX11.so.6 =3D&gt; /usr/lib/libX11.so.6 (0x0000002a97161000)
        libstdc++.so.5 =3D&gt;
/usr/lib/gcc-lib/x86_64-pc-linux-gnu/3.3.4/libstdc++.so.5
(0x0000002a97342000)
        libgcc_s.so.1 =3D&gt; /lib/libgcc_s.so.1 (0x0000002a9753a000)
        libdl.so.2 =3D&gt; /lib/libdl.so.2 (0x0000002a97645000)
        libmp3lame.so.0 =3D&gt; /usr/lib/libmp3lame.so.0 (0x0000002a97748000)
        libvorbis.so.0 =3D&gt; /usr/lib/libvorbis.so.0 (0x0000002a978de000)
        libvorbisenc.so.2 =3D&gt; /usr/lib/libvorbisenc.so.2
(0x0000002a97a09000)
        libpthread.so.0 =3D&gt; /lib/libpthread.so.0 (0x0000002a97ce7000)
        /lib64/ld-linux-x86-64.so.2 (0x000000552aaaa000)
        libogg.so.0 =3D&gt; /usr/lib/libogg.so.0 (0x0000002a97e7d000)

You'll notice there is no reference to libopencv in there. So I hacked
the Make file and added libopencv to the linker step. Now doing ldd
/usr/local/lib/libhihgui.so:
<A HREF="mailto:james@athos">james@athos</A> src $ ldd /usr/local/lib/libhighgui.so=20
        libXm.so.3 =3D&gt; //usr/lib/libXm.so.3 (0x0000002a95675000)
        libMrm.so.3 =3D&gt; //usr/lib/libMrm.so.3 (0x0000002a95a0a000)
        libUil.so.3 =3D&gt; //usr/lib/libUil.so.3 (0x0000002a95b2e000)
        libpng.so.3 =3D&gt; //usr/lib/libpng.so.3 (0x0000002a95cb5000)
        libjpeg.so.62 =3D&gt; //usr/lib/libjpeg.so.62 (0x0000002a95deb000)
        libz.so.1 =3D&gt; /lib/libz.so.1 (0x0000002a95f33000)
        libtiff.so.3 =3D&gt; //usr/lib/libtiff.so.3 (0x0000002a96046000)
        libavcodec.so =3D&gt; //usr/lib/libavcodec.so (0x0000002a9619a000)
        libopencv-0.9.so.5 =3D&gt; /usr/local/lib/libopencv-0.9.so.5
(0x0000002a9646d000)
        libm.so.6 =3D&gt; /lib/libm.so.6 (0x0000002a966f8000)
        libc.so.6 =3D&gt; /lib/libc.so.6 (0x0000002a9687e000)
        libXmu.so.6 =3D&gt; /usr/lib/libXmu.so.6 (0x0000002a96aa5000)
        libXt.so.6 =3D&gt; /usr/lib/libXt.so.6 (0x0000002a96bbd000)
        libSM.so.6 =3D&gt; /usr/lib/libSM.so.6 (0x0000002a96d20000)
        libICE.so.6 =3D&gt; /usr/lib/libICE.so.6 (0x0000002a96e2b000)
        libXext.so.6 =3D&gt; /usr/lib/libXext.so.6 (0x0000002a96f46000)
        libXp.so.6 =3D&gt; /usr/lib/libXp.so.6 (0x0000002a97057000)
        libX11.so.6 =3D&gt; /usr/lib/libX11.so.6 (0x0000002a97161000)
        libstdc++.so.5 =3D&gt;
/usr/lib/gcc-lib/x86_64-pc-linux-gnu/3.3.4/libstdc++.so.5
(0x0000002a97342000)
        libgcc_s.so.1 =3D&gt; /lib/libgcc_s.so.1 (0x0000002a9753a000)
        libdl.so.2 =3D&gt; /lib/libdl.so.2 (0x0000002a97645000)
        libmp3lame.so.0 =3D&gt; /usr/lib/libmp3lame.so.0 (0x0000002a97748000)
        libvorbis.so.0 =3D&gt; /usr/lib/libvorbis.so.0 (0x0000002a978de000)
        libvorbisenc.so.2 =3D&gt; /usr/lib/libvorbisenc.so.2
(0x0000002a97a09000)
        libpthread.so.0 =3D&gt; /lib/libpthread.so.0 (0x0000002a97ce7000)
        /lib64/ld-linux-x86-64.so.2 (0x000000552aaaa000)
        libogg.so.0 =3D&gt; /usr/lib/libogg.so.0 (0x0000002a97e7d000)

Hurrah. Ok, that's part of the problem fixed. The real issue was with
libopencv missing a reference to libstdc++. But libhighgui has a
reference to it... so now I made a very subtle change to my program.

public static void Main(string[] args)
{
	Console.WriteLine(&quot;CvImage test application&quot;);
        Console.WriteLine(&quot;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D&quot;);

A	CvImage.CvCreateWindow(&quot;test&quot;, 1);           =20
B       CvImage image =3D new CvImage(new CvSize(100,100), 8, 3);
C=09
	image.CvShowImage(&quot;test&quot;);

}

I moved the line now in position A from position C. Line A is a call to
a libhighgui method. Line B is an opencv method. Since libstdc++ is
loaded by libhighgui in line A, line B executes fine. A bit of a hack
but hey it works for now!

Sorry about the long post but I am just stoked it works. Thanks so much
to everyone that has helped me over the last couple of days. I've learnt
a lot here and I like that feeling :)

Cheers!
James=20

--=20
It's 5.50 a.m.... Do you know where your stack pointer is ?

--=-ZX/4Cm5em1bDaENBTmmm
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.6 (GNU/Linux)

iD8DBQBCESMUtf4qL6AoafMRAhFUAKCndx6nW59llQ5WZ7lkIMA889IWIACgjLes
IhbfOV0NCT5m4V5ufR8xM6k=
=2DA7
-----END PGP SIGNATURE-----

--=-ZX/4Cm5em1bDaENBTmmm--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="025727.html">[Mono-list] P/Invoke on amd64
</A></li>
	<LI> Next message: <A HREF="025697.html">[Mono-list] gdiplus.dll Not Found?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25728">[ date ]</a>
              <a href="thread.html#25728">[ thread ]</a>
              <a href="subject.html#25728">[ subject ]</a>
              <a href="author.html#25728">[ author ]</a>
         </LI>
       </UL>
</body></html>
