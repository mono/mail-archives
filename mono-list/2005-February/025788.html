<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Status of Mono's garbage collector
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="025739.html">
   <LINK REL="Next"  HREF="025738.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Status of Mono's garbage collector
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Status of Mono's garbage collector">lupus@ximian.com
       </A><BR>
    <I>Thu, 17 Feb 2005 12:17:11 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="025739.html">[Mono-list] Status of Mono's garbage collector
</A></li>
        <LI> Next message: <A HREF="025738.html">[Mono-list] Refreshing an image display
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25788">[ date ]</a>
              <a href="thread.html#25788">[ thread ]</a>
              <a href="subject.html#25788">[ subject ]</a>
              <a href="author.html#25788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A small update on this.

On 02/15/05 Paolo Molaro wrote:
&gt;<i> To fix some of these issues we also need to have libgc handle
</I>&gt;<i> additions to the root set more gracefully (right now it has a fixed
</I>&gt;<i> number of entries).
</I>
I implemented the code to make the number of root entries dynamic,
but after a few thousand libgc will assert because it doesn't
expect to have too many roots, I guess (probably the mark stack size 
needs to be tuned, too). This results by adding roots for the entries
in the runtime hash tables that contain objects, I started
implementing a different hashtable design that requires just a root
entry per hashtable: this moves the problem to when a few
hundred appdomains and dynamic re.emit images are created and active at
the same time, but it may be good enough for the loads libgc can
sustain, until we have our own GC.

&gt;<i> Fragmentation may be an issue, but I haven't investigated how much
</I>&gt;<i> effect it has on heap size. My guess is that much of the issue
</I>&gt;<i> with increasing heap size is because libgc prefers to increase the
</I>&gt;<i> heap instead of being more aggressive at reclaiming memory (this
</I>&gt;<i> is easily triggered by storing somewhat big arrays in objects with
</I>&gt;<i> finalizers). There is probably some tuning or small fixes that need
</I>&gt;<i> to be done in libgc to prevent this from happening.
</I>
I committed a fix for this issue yesterday: at least two tests that were
reported to increase memory usage until the process died are
now behaving quite well, with memory usage constant after a few requests.

At this point, people that had issues with the memory usage of mono apps,
especially xsp and server-side kind of workloads, should test again
with the current mono from svn and report their results.
The behaviour should be much better for all the workloads
and for some it should not be an issue anymore (meaning that,
when the max amount of memory to service the outstanding requests
has been reached, it should not increase over time, unless
many more requests need to be serviced at the same time).

Please do file bug reports about this issues with tests cases
we can use to reproduce. For mono 1.2 we may not be able to
have a perfect GC (because that requires a precise GC), but
we made several improvements and a few more are possible.

Thanks.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="025739.html">[Mono-list] Status of Mono's garbage collector
</A></li>
	<LI> Next message: <A HREF="025738.html">[Mono-list] Refreshing an image display
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25788">[ date ]</a>
              <a href="thread.html#25788">[ thread ]</a>
              <a href="subject.html#25788">[ subject ]</a>
              <a href="author.html#25788">[ author ]</a>
         </LI>
       </UL>
</body></html>
