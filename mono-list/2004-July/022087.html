<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: Remaining S/390 JIT issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="022086.html">
   <LINK REL="Next"  HREF="022093.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: Remaining S/390 JIT issues
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Re: Remaining S/390 JIT issues">lupus@ximian.com
       </A><BR>
    <I>Tue, 13 Jul 2004 17:51:57 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="022086.html">[Mono-list] Remaining S/390 JIT issues
</A></li>
        <LI> Next message: <A HREF="022093.html">[Mono-list] Mac OS X 10.2 compatible build needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22087">[ date ]</a>
              <a href="thread.html#22087">[ thread ]</a>
              <a href="subject.html#22087">[ subject ]</a>
              <a href="author.html#22087">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/13/04 <A HREF="mailto:Neale.Ferguson@SoftwareAG-USA.com">Neale.Ferguson@SoftwareAG-USA.com</A> wrote:
&gt;<i>  I am now passing all but two of the regression tests using my JIT
</I>
Excellent! Congrats!

&gt;<i> port. One is strange that I haven't fully diagnosed with appdomain-unload
</I>&gt;<i> (the page containing one of the compiled methods seems to get freed);
</I>
This is likely a general problem and not specific to your port.
We need more work to make appdomain unload fully stable.

&gt;<i> the other is relates to single floating point numbers.
</I>&gt;<i> 
</I>&gt;<i> The way I handle single floats is:
</I>&gt;<i> 1. When loaded from storage I immediately convert them to double so that all operations work correctly
</I>&gt;<i> 2. Before storing back to memory I convert them from double to single and then store
</I>&gt;<i> 3. When passing in a call I convert from double to single
</I>&gt;<i> 4. When coming back from a function call I convert from single to double
</I>&gt;<i> 
</I>&gt;<i> This appears to work most of the time, but sometimes I get sequences like:
</I>&gt;<i> 
</I>&gt;<i> (stind.r4 (add (ldind.ref regoffset[0xd0(s390_r11)]) iconst[8]) (float_conv_to_r4 (ldind.r8 regoffset[0xc8(s390_r11)])))
</I>&gt;<i> 
</I>&gt;<i> In this instance float_conv_to_r4 will convert from double to single
</I>&gt;<i> and then stind.4 will try to convert from double to single as well:
</I>&gt;<i> resulting in junk. How do other architectures handle single floats?
</I>
float_conv_to_r4 is supposed to change the precision, but since the
resulting value is still on the evaluation stack it should be still a
double. stind.r4 will convert the value to a float during or before
saving to memory. For some architectures this process creates more code
than necessary, but most of the cases can be optimized with the proper
burg rules.
Later we may want to track FP values on the eval stack both as floats
and doubles, so that in some architectures we can use 32 bit FP
registers since some ops there will be faster: this requires that all
the operand are floats and not doubles, though.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="022086.html">[Mono-list] Remaining S/390 JIT issues
</A></li>
	<LI> Next message: <A HREF="022093.html">[Mono-list] Mac OS X 10.2 compatible build needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22087">[ date ]</a>
              <a href="thread.html#22087">[ thread ]</a>
              <a href="subject.html#22087">[ subject ]</a>
              <a href="author.html#22087">[ author ]</a>
         </LI>
       </UL>
</body></html>
