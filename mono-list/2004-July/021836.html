<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] PInvoke &amp; Marshaling problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:kai.reichert%40udo.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="021829.html">
   <LINK REL="Next"  HREF="021841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] PInvoke &amp; Marshaling problem
   </H1>
    <B>Kai Reichert
    </B> 
    <A HREF="mailto:kai.reichert%40udo.edu"
       TITLE="[Mono-list] PInvoke &amp; Marshaling problem">kai.reichert@udo.edu
       </A><BR>
    <I>Sat, 3 Jul 2004 23:06:33 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="021829.html">[Mono-list] Re: P/Invoke IntPtr versus byte[]
</A></li>
        <LI> Next message: <A HREF="021841.html">[Mono-list] PInvoke &amp; Marshaling problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21836">[ date ]</a>
              <a href="thread.html#21836">[ thread ]</a>
              <a href="subject.html#21836">[ subject ]</a>
              <a href="author.html#21836">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

I want to pass an array of bytes to a method compiled in c/c++.

The first naiv method works and looks like this : 

 - ---------------------
  xx.c :

void takeArray( unsigned char array[] ){
  /* do something useful with it */
}

  xy.cs :

  [ DllImport(myclib.so) ]
  static extern void takeArray(  byte[] array  );
  byte[] array = new byte[10];
  takeArray( array );
 - --------------------------
 
O.K., this one works perfectly.
But now consider you have a c-method that takes the array as

  takeArray( const void *pointer )
  
YES, it makes sense, e.g. the OpenGL method glTexImage2D.

Since all structures are passed by reference the parameter of the method is 
just the pointer to the beginning of the structure in memory. so I only need 
a way to access this pointer.

my aproach was the following : 

takeArray ( GCHandle.Alloc( array, 
GCHandleType.Pinned).AddrOfPinnedObject() );

BUT this method invocation is not associated with the right piece of memory 
that the subsequent c-method gets :-)

Yes I know that Mono has a garbage collection and there are mechanisms in the 
runtimes that copy memory from managed to unmanaged. This wouldn't be a 
problem ...

I just want to know why it is not possible to pass 

  System.IntPtr   --C--&gt;  const void*
since 
  byte[]    --C--&gt; unsigned char array[]
works ;-)


Thx for reading boring PInvoke problems :-)

Kai

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="021829.html">[Mono-list] Re: P/Invoke IntPtr versus byte[]
</A></li>
	<LI> Next message: <A HREF="021841.html">[Mono-list] PInvoke &amp; Marshaling problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21836">[ date ]</a>
              <a href="thread.html#21836">[ thread ]</a>
              <a href="subject.html#21836">[ subject ]</a>
              <a href="author.html#21836">[ author ]</a>
         </LI>
       </UL>
</body></html>
