<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Problem with XmlTextReader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:atsushi%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="022287.html">
   <LINK REL="Next"  HREF="022290.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Problem with XmlTextReader
   </H1>
    <B>Atsushi Eno
    </B> 
    <A HREF="mailto:atsushi%40ximian.com"
       TITLE="[Mono-list] Problem with XmlTextReader">atsushi@ximian.com
       </A><BR>
    <I>Thu, 22 Jul 2004 03:14:37 +0900</I>
    <P><UL>
        <LI> Previous message: <A HREF="022287.html">[Mono-list] Implemented classes
</A></li>
        <LI> Next message: <A HREF="022290.html">[Mono-list] Problem with XmlTextReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22289">[ date ]</a>
              <a href="thread.html#22289">[ thread ]</a>
              <a href="subject.html#22289">[ subject ]</a>
              <a href="author.html#22289">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Assuming you also wanted to reply to the list...

David Waite wrote:

&gt;<i> I might be misunderstanding the problem, but...
</I>&gt;<i> 
</I>&gt;<i> It seems like the stream could simply be Read() from; if there is no
</I>&gt;<i> data, the read will block, if there is data it can go into an internal
</I>&gt;<i> buffer. That buffer gets examined to see if there is enough
</I>&gt;<i> information to identify and represent the next event in the pull
</I>&gt;<i> parser; if not, you call Read() again, which may block again. MoveTo*
</I>&gt;<i> and Read* methods will just keep reading until the conditions
</I>&gt;<i> specified by the method are satisfied.
</I>
What I've written in the previous post is &quot;how Read() events do not
match with the *required* text stream consumption for one Read() call&quot;.
The TextReader (stream) is likely to be set as empty (not set any
contents) and thus it easily freezes. In such case are those stream
developers aware of how XmlTextReader consumes the stream at any time?

(BTW MoveTo*() never consumes the stream. Those methods must be
available for iterating attributes.)

&gt;<i> I don't think the original poster's problem was that it read a little
</I>&gt;<i> more than needed, but that it seems to read a lot more than needed,
</I>&gt;<i> i.e. after enough data about the event has been received by the local
</I>&gt;<i> stream, more data is still needed in order to exit Read()
</I>
I could not get how we can share the concept of &quot;a lot&quot;. If just
the buffer size matters? (If my monitoring &amp;&amp; my memory were correct)
Microsoft implementation always read 4096 bytes from the stream.
Our buffer size is smaller.

What is the benefit by changing XmlTextReader as such?

	- As discussed above, developers won't be aware of how
	  XmlTextReader consumes steam unlike their expectations.
	- At least it will require 1024 times call to Read()
	  instead of one call to Read(char[], int, int).
	- There is GetRemainder() method that implies XmlTextReader
	  consumes the stream more than &quot;required&quot; (they think) size.
	  Developers could be aware of such stream consumption.

I think there we just lose performance improvements, in vain.

Atsushi Eno


&gt;<i> On Wed, 21 Jul 2004 13:09:14 +0900, Atsushi Eno &lt;<A HREF="mailto:atsushi@ximian.com">atsushi@ximian.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Thanks for answering my question. but the problem is that i
</I>&gt;&gt;<i> &gt; feel the XmlTextReader, just reads to the end of the stream
</I>&gt;&gt;<i> &gt; when it is instantiated (thats why it takes so long to instantiate)
</I>&gt;&gt;<i> &gt; and keeps this in memory. Then when the client asks for a Read()
</I>&gt;&gt;<i> &gt; he just gives the next element or whatever. Shouldn't the parser
</I>&gt;&gt;<i> &gt; be reading off the stream when the client gives a Read()?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>In short, no. It is impossible.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I have one easy answer: for such TextReader whose CanSeek
</I>&gt;&gt;<i>is false (can not Peek()), we will have to cache the peek character
</I>&gt;&gt;<i>anyways. It have to continue reading until it encounters '&lt;', but
</I>&gt;&gt;<i>you won't send the next '&lt;foo&gt;' element. Thus, such &quot;wait &amp; see&quot;
</I>&gt;&gt;<i>way won't work anyways.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Another complicated case: Suppose you are going to read such XML
</I>&gt;&gt;<i>document like:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        &lt;!DOCTYPE foo SYSTEM &quot;foo.dtd&quot;&gt;
</I>&gt;&gt;<i>        &lt;root&gt;
</I>&gt;&gt;<i>        &amp;amp; &amp;quot; &amp;apos; &amp;lt; &amp;gt; are character entity.
</I>&gt;&gt;<i>        external &amp;ent; &amp;amp; &amp;not; are defined in foo.dtd.
</I>&gt;&gt;<i>        &lt;/root&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>There general entity &quot;ent&quot; and &quot;not&quot; are defined in foo.dtd.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>When you call the third Read(), then XmlTextReader tries to
</I>&gt;&gt;<i>read the text node inside root element. Read() will return
</I>&gt;&gt;<i>true and then it represents Text node that ends with &quot;external &quot;
</I>&gt;&gt;<i>(immediate before &amp;ent;).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>When XmlTextReader found '&amp;', it MUST NOT stop the parse since
</I>&gt;&gt;<i>it cannoy identify if following markup represents character
</I>&gt;&gt;<i>entity (&amp;amp;, &amp;quot;, &amp;apos;, &amp;lt; or &amp;gt;) or general entity
</I>&gt;&gt;<i>without reading the folloing text stream.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Atsushi Eno
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>_______________________________________________
</I>&gt;&gt;<i>Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="022287.html">[Mono-list] Implemented classes
</A></li>
	<LI> Next message: <A HREF="022290.html">[Mono-list] Problem with XmlTextReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22289">[ date ]</a>
              <a href="thread.html#22289">[ thread ]</a>
              <a href="subject.html#22289">[ subject ]</a>
              <a href="author.html#22289">[ author ]</a>
         </LI>
       </UL>
</body></html>
