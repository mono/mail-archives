<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Internal compiler error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20Internal%20compiler%20error&In-Reply-To=%3CCAGzCYFNfjDA5xC-%3D9%2BK%2BW0%3DqpoYZGPiyVbOMqmBN1%3D%3DRjZkCFA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052317.html">
   <LINK REL="Next"  HREF="052316.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Internal compiler error</H1>
    <B>Baltasar Garc√≠a Perez-Schofield</B> 
    <A HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20Internal%20compiler%20error&In-Reply-To=%3CCAGzCYFNfjDA5xC-%3D9%2BK%2BW0%3DqpoYZGPiyVbOMqmBN1%3D%3DRjZkCFA%40mail.gmail.com%3E"
       TITLE="[Mono-list] Internal compiler error">baltasarq at gmail.com
       </A><BR>
    <I>Fri Dec 23 13:40:13 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052317.html">[Mono-list] Easy way to deadlock Mono with concurrent	HttpWebRequests
</A></li>
        <LI>Next message (by thread): <A HREF="052316.html">[Mono-list] Internal compiler error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52315">[ date ]</a>
              <a href="thread.html#52315">[ thread ]</a>
              <a href="subject.html#52315">[ subject ]</a>
              <a href="author.html#52315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Xamarin,

I've found an error in the mono compiler (by accident), with a program
which includes a generic class (the error I am reporting does not happen
with a regular class). If I compile it this way:

==
//using System;

public sealed class Foo&lt;T&gt;: IComparable, IComparable&lt;Foo&lt;T&gt;&gt; {
    //private class NestedClass {}

    public int CompareTo(object o)
    {
        return 0;
    }

    public int CompareTo(Foo&lt;T&gt; q2)
    {
        return 0;
    }
}
==

Then I get the expected output:

==
$ mcs -target:library error.cs
error.cs(3,29): error CS0246: The type or namespace name `IComparable'
could not be found. Are you missing `System' using directive?
error.cs(3,42): error CS0246: The type or namespace name `IComparable'
could not be found. Are you missing `System' using directive?
Compilation failed: 2 error(s), 0 warnings
==

If I delete the comment mark in the first line then the error is solved. So
far, so good.

If both lines (the first one, and the one about the nested class) are
uncommented, then it compiles without a glitch.

But when I uncomment the nestedclass, and comment the first line (i.e.,
//using System), I get:

==
$ mcs -target:library error.cs

Unhandled Exception:
Mono.CSharp.InternalErrorException: error.cs(3,21): Foo&lt;T&gt; ---&gt;
System.ArgumentException: An item with the same key has already been added.
  at System.ThrowHelper.ThrowArgumentException (System.ExceptionResource
resource) [0x0000b] in &lt;8f2c484307284b51944a1a13a14c0266&gt;:0
  at System.Collections.Generic.Dictionary`2[TKey,TValue].Insert (TKey key,
TValue value, System.Boolean add) [0x0008e] in
&lt;8f2c484307284b51944a1a13a14c0266&gt;:0
  at System.Collections.Generic.Dictionary`2[TKey,TValue].Add (TKey key,
TValue value) [0x00000] in &lt;8f2c484307284b51944a1a13a14c0266&gt;:0
  at Mono.CSharp.MemberCache.InflateTypes (Mono.CSharp.MemberCache
inflated_cache, Mono.CSharp.TypeParameterInflator inflator) [0x00086] in
&lt;9494102539fd45149c591ed0d231421b&gt;:0
  at Mono.CSharp.InflatedTypeSpec.InitializeMemberCache (System.Boolean
onlyTypes) [0x0006d] in &lt;9494102539fd45149c591ed0d231421b&gt;:0
  at Mono.CSharp.InflatedTypeSpec.get_BaseType () [0x0001c] in
&lt;9494102539fd45149c591ed0d231421b&gt;:0
==

Hope this helps to fix the compiler.
-- Baltasar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-list/attachments/20161223/557cc636/attachment.html">http://lists.dot.net/pipermail/mono-list/attachments/20161223/557cc636/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052317.html">[Mono-list] Easy way to deadlock Mono with concurrent	HttpWebRequests
</A></li>
	<LI>Next message (by thread): <A HREF="052316.html">[Mono-list] Internal compiler error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52315">[ date ]</a>
              <a href="thread.html#52315">[ thread ]</a>
              <a href="subject.html#52315">[ subject ]</a>
              <a href="author.html#52315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
