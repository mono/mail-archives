<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mkbundle on Mac OS 10.9
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20mkbundle%20on%20Mac%20OS%2010.9&In-Reply-To=%3C1B490A7E-0102-4E05-BBAE-1F5C8A9D2E54%40geteventstore.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="050764.html">
   <LINK REL="Next"  HREF="050781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mkbundle on Mac OS 10.9</H1>
    <B>James Nugent</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20mkbundle%20on%20Mac%20OS%2010.9&In-Reply-To=%3C1B490A7E-0102-4E05-BBAE-1F5C8A9D2E54%40geteventstore.com%3E"
       TITLE="[Mono-list] mkbundle on Mac OS 10.9">james at geteventstore.com
       </A><BR>
    <I>Thu Mar 20 23:32:17 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="050764.html">[Mono-list] mkbundle on Mac OS 10.9
</A></li>
        <LI>Next message: <A HREF="050781.html">[Mono-list] i want a quick integration overview to work on monodevelop/xamarin studio IDE to work on it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50789">[ date ]</a>
              <a href="thread.html#50789">[ thread ]</a>
              <a href="subject.html#50789">[ subject ]</a>
              <a href="author.html#50789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To follow up on this and for anyone else that hits the same thing in future, the following *does* work (this is for dynamic but static also working):

$ mkbundle --deps -c -oo helloworld.o -o helloworld.c helloworld.exe

$ gcc -I/opt/mono/include/mono-2.0 -L/opt/mono/lib/ -lmonosgen-2.0 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.9.sdk/ -framework Foundation -arch x86_64 -o helloworld helloworld.c helloworld.o

$ ./helloworld
Hello World

Regards,


James

On 14 Mar 2014, at 15:46, James Nugent &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">james at geteventstore.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">james at geteventstore.com</A>&gt;&gt; wrote:

Hi,

I&#8217;m trying to get a simple example working of statically linking Mono on Mac OS Mavericks, with a 64 bit build of mono (from source), but am hitting various problems. All this works on Linux (for the most part!).

Is it actually possible to statically link mono on Mac OS, and if not what is the recommended way to deploy binaries, especially ones which really want 64 bit Mono where we don&#8217;t want users to have to build from source? I feel like I&#8217;m probably missing something - the details of what I&#8217;ve tried are below, along with a link to a repository with all the related files in.

Regards,


James



I have mono on PATH, mono --version gives:

mono JIT compiler version 3.2.8 ((detached/b1e8599 Thu  6 Mar 2014 11:44:00 GMT)
Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. www.mono-project.com&lt;<A HREF="http://www.mono-project.com/">http://www.mono-project.com/</A>&gt;
TLS:           normal
SIGSEGV:       altstack
Notification:  kqueue
Architecture:  amd64
Disabled:      none
Misc:          softdebug
LLVM:          supported, not enabled.
GC:            sgen

I also have PKG_CONFIG_PATH set up to point to /opt/mono/lib/pkgconfig.

I have a simple &#8220;Hello World&#8221; console app named helloworld.exe (source and all the scripts are here: <A HREF="https://github.com/jen20/mono-static-linking">https://github.com/jen20/mono-static-linking</A>).

Dynamic Linking

Trying the simplest example from the docs page:

mkbundle helloworld.exe --deps -o helloworld

This builds, but when running gives the following output:

dyld: Symbol not found: _kCFLocaleCountryCode
  Referenced from: /opt/mono/lib//libmonoboehm-2.0.1.dylib
  Expected in: flat namespace
 in /opt/mono/lib//libmonoboehm-2.0.1.dylib
Trace/BPT trap: 5

Setting DYLD_LIBRARY_PATH to include /opt/mono/lib doesn&#8217;t help this, but it&#8217;s likely not the path I want to be going down anyway because I want to use sgen rather than Boehm.

Static Linking

Changing the command used to:

mkbundle --static --deps helloworld.exe -o helloworld-static

This gives me a whole stack of errors during execution of mkbundle relating to undefined symbols for x86_64, but from the output it looks like this is determining config based on the mono-2 package anyway which likely still isn&#8217;t what I want. On Linux separating the call to mkbundle and using -c, then compiling the output separately worked, so I next tried:

mkbundle --static --deps -c -o main.c -oo helloworld.a helloworld.exe

cc -o helloworld-static2 -Wall `pkg-config --cflags monosgen-2` `pkg-config --libs-only-L monosgen-2` -Wl,-static -lmonosgen-2.0 -Wl,-dynamic `pkg-config --libs-only-l monosgen-2 | sed -e &quot;s/\-lmono-2.0 //&quot;` main.c helloworld.a

This complains about -lpthread, which research suggested I should go and edit in the pkgconfig files to be -pthread instead. Then I get complaints about -lSystem instead.
_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>&gt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20140320/66bcbf08/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20140320/66bcbf08/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="050764.html">[Mono-list] mkbundle on Mac OS 10.9
</A></li>
	<LI>Next message: <A HREF="050781.html">[Mono-list] i want a quick integration overview to work on monodevelop/xamarin studio IDE to work on it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50789">[ date ]</a>
              <a href="thread.html#50789">[ thread ]</a>
              <a href="subject.html#50789">[ subject ]</a>
              <a href="author.html#50789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
