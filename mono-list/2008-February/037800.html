<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] System.Data.OracleClient on z/Linux - 64-bit -	Big-endian
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Data.OracleClient%20on%20z/Linux%20-%2064-bit%20-%0A%09Big-endian&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037811.html">
   <LINK REL="Next"  HREF="037802.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] System.Data.OracleClient on z/Linux - 64-bit -	Big-endian</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Data.OracleClient%20on%20z/Linux%20-%2064-bit%20-%0A%09Big-endian&In-Reply-To="
       TITLE="[Mono-list] System.Data.OracleClient on z/Linux - 64-bit -	Big-endian">monodanmorg at yahoo.com
       </A><BR>
    <I>Thu Feb 14 22:45:51 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="037811.html">[Mono-list] System.Data.OracleClient on z/Linux
</A></li>
        <LI>Next message: <A HREF="037802.html">[Mono-list] Mono for RedHat 9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37800">[ date ]</a>
              <a href="thread.html#37800">[ thread ]</a>
              <a href="subject.html#37800">[ subject ]</a>
              <a href="author.html#37800">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After some discussion on IRC, this what some helpful
people gave me.  

Marshal an IntPtr since it is the size of a native
pointer.  I believe an IntPtr can be casted to an int
or long and vice-versa.

<A HREF="http://www.mono-project.com/Interop_with_Native_Libraries">http://www.mono-project.com/Interop_with_Native_Libraries</A>


--- Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">monodanmorg at yahoo.com</A>&gt; wrote:

&gt;<i> Date: Thu, 14 Feb 2008 17:28:41 -0800 (PST)
</I>&gt;<i> From: Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">monodanmorg at yahoo.com</A>&gt;
</I>&gt;<i> To: Edwin Kim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">EKIM at transitchicago.com</A>&gt;,
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-list] System.Data.OracleClient on
</I>&gt;<i> z/Linux
</I>&gt;<i> 
</I>&gt;<i> Go to Mono's web site and go to the download page. 
</I>&gt;<i> Download the source code to mono if you have not
</I>&gt;<i> already.  Unarchive it somewhere.  I assume you know
</I>&gt;<i> how to ungzip and untar a file.
</I>&gt;<i> 
</I>&gt;<i> In the source, go to
</I>&gt;<i>
</I>mono_source/mcs/class/System.Data.OracleClient/System.Data.OracleClient.cs
&gt;<i> 
</I>&gt;<i> And look in file OciStatementHandle.cs at function
</I>&gt;<i> Prepare.  You should see it calling the function
</I>&gt;<i> OCIUnicodeToCharSet.  You need to see what the
</I>&gt;<i> function is actually passing returning via
</I>&gt;<i> Console.Error.WriteLine calls.
</I>&gt;<i> 
</I>&gt;<i> Oracle Call Interface Programmer's Guide
</I>&gt;<i>
</I><A HREF="http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14250/toc.htm">http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14250/toc.htm</A>
&gt;<i> 
</I>&gt;<i> Documentation for all Oracle products can be found
</I>&gt;<i> here:
</I>&gt;<i> <A HREF="http://tahiti.oracle.com/">http://tahiti.oracle.com/</A>
</I>&gt;<i> 
</I>&gt;<i> sword OCIUnicodeToCharSet ( dvoid       *hndl, 
</I>&gt;<i>                             OraText     *dst, 
</I>&gt;<i>                             size_t      dstlen, 
</I>&gt;<i>                             CONST ub2   *src, 
</I>&gt;<i>                             size_t      srclen, 
</I>&gt;<i>                             size_t      *rsize );
</I>&gt;<i> 
</I>&gt;<i> The docs says these are the possible values that can
</I>&gt;<i> be returned: OCI_SUCCESS, OCI_INVALID_HANDLE. or
</I>&gt;<i> OCI_ERROR.  I'm not sure the proper way to marshal a
</I>&gt;<i> size_t that will work on 32-bit and 64-bits systems.
</I>&gt;<i> 
</I>&gt;<i> Perhaps someone reading this can shed some light.
</I>&gt;<i> 
</I>&gt;<i> Also, take a look at OciCalls.cs and see how to
</I>&gt;<i> enable
</I>&gt;<i> tracing.  You may need to re-build
</I>&gt;<i> System.Data.OracleClient to enable tracing.  And I
</I>&gt;<i> think you would also need to set OCI_TRACE to point
</I>&gt;<i> to
</I>&gt;<i> the file to log tracing.
</I>&gt;<i> 
</I>&gt;<i> --- Edwin Kim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">EKIM at transitchicago.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Thanks much!!!
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'm new to Mono, OCI, and C#.
</I>&gt;<i> &gt; I guess z/Linux running on the IBM z/800
</I>&gt;<i> (mainframe)
</I>&gt;<i> &gt; is big endian.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I was able to display some information using
</I>&gt;<i> &gt; environment variables:
</I>&gt;<i> &gt;         export MONO_LOG_LEVEL=info
</I>&gt;<i> &gt;         export MONO_LOG_MASK=dll
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Console output:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Mono-INFO: Searching for 'OCISessionBegin'.
</I>&gt;<i> &gt; Mono-INFO: Probing 'OCISessionBegin'.
</I>&gt;<i> &gt; Mono-INFO: Found as 'OCISessionBegin'.
</I>&gt;<i> &gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: Searching for 'OCIServerVersion'.
</I>&gt;<i> &gt; Mono-INFO: Probing 'OCIServerVersion'.
</I>&gt;<i> &gt; Mono-INFO: Found as 'OCIServerVersion'.
</I>&gt;<i> &gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: Searching for 'OCICharSetToUnicode'.
</I>&gt;<i> &gt; Mono-INFO: Probing 'OCICharSetToUnicode'.
</I>&gt;<i> &gt; Mono-INFO: Found as 'OCICharSetToUnicode'.
</I>&gt;<i> &gt; ServerVersion: Oracle Database
</I>&gt;<i> &gt; DataSource: wpsdb
</I>&gt;<i> &gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: Searching for 'OCIUnicodeToCharSet'.
</I>&gt;<i> &gt; Mono-INFO: Probing 'OCIUnicodeToCharSet'.
</I>&gt;<i> &gt; Mono-INFO: Found as 'OCIUnicodeToCharSet'.
</I>&gt;<i> &gt; Unhandled Exception:
</I>&gt;<i> System.NullReferenceException:
</I>&gt;<i> &gt; Object reference not set to an instance of an
</I>&gt;<i> object
</I>&gt;<i> &gt;   at
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>System.Data.OracleClient.Oci.OciStatementHandle.Prepare
&gt;<i> &gt; (System.String commandText) [0x00000]
</I>&gt;<i> &gt;   at
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>System.Data.OracleClient.OracleCommand.PrepareStatement
&gt;<i> &gt; (System.Data.OracleClient.Oci.OciStatementHandle
</I>&gt;<i> &gt; statement) [0x00000]
</I>&gt;<i> &gt;   at
</I>&gt;<i> &gt;
</I>&gt;<i> System.Data.OracleClient.OracleCommand.ExecuteReader
</I>&gt;<i> &gt; (CommandBehavior behavior) [0x00000]
</I>&gt;<i> &gt;   at
</I>&gt;<i> &gt;
</I>&gt;<i> System.Data.OracleClient.OracleCommand.ExecuteReader
</I>&gt;<i> &gt; () [0x00000]
</I>&gt;<i> &gt;   at (wrapper remoting-invoke-with-check)
</I>&gt;<i> &gt;
</I>&gt;<i> System.Data.OracleClient.OracleCommand:ExecuteReader
</I>&gt;<i> &gt; ()
</I>&gt;<i> &gt;   at Test.Main (System.String[] args) [0x00000]
</I>&gt;<i> &gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> &gt; 'libclntsh.so'.
</I>&gt;<i> &gt; Mono-INFO: Searching for 'OCIHandleFree'.
</I>&gt;<i> &gt; Mono-INFO: Probing 'OCIHandleFree'.
</I>&gt;<i> &gt; Mono-INFO: Found as 'OCIHandleFree'.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; and source code:
</I>&gt;<i> &gt; using System;
</I>&gt;<i> &gt; using System.Data;
</I>&gt;<i> &gt; using System.Data.OracleClient;
</I>&gt;<i> &gt; public class Test
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt;    public static void Main (string[] args)
</I>&gt;<i> &gt;    {
</I>&gt;<i> &gt;        string connectionString =
</I>&gt;<i> &gt;           &quot;Data Source=wpsdb;&quot; +
</I>&gt;<i> &gt;           &quot;User ID=test;&quot; +
</I>&gt;<i> &gt;           &quot;Password=test;&quot;;
</I>&gt;<i> &gt;        OracleConnection dbcon = null;
</I>&gt;<i> &gt;        dbcon = new OracleConnection
</I>&gt;<i> &gt; (connectionString);
</I>&gt;<i> &gt;        dbcon.Open ();
</I>&gt;<i> &gt;        Console.WriteLine(&quot;ServerVersion: &quot; +
</I>&gt;<i> &gt; dbcon.ServerVersion + &quot;\nDataSource: &quot; +
</I>&gt;<i> &gt; dbcon.DataSource);
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;        OracleCommand dbcmd = dbcon.CreateCommand
</I>&gt;<i> ();
</I>&gt;<i> &gt;        string sql = &quot;SELECT * FROM dual&quot;;
</I>&gt;<i> &gt;        dbcmd.CommandText = sql;
</I>&gt;<i> &gt;        OracleDataReader reader =
</I>&gt;<i> dbcmd.ExecuteReader
</I>&gt;<i> &gt; ();
</I>&gt;<i> &gt;        while (reader.Read ()) {
</I>&gt;<i> &gt;          System.Console.WriteLine( &quot;.&quot; );
</I>&gt;<i> &gt;        }
</I>&gt;<i> &gt;        // clean up
</I>&gt;<i> &gt;        reader.Close ();
</I>&gt;<i> &gt;        reader = null;
</I>&gt;<i> &gt;        dbcmd.CommandText = sql;
</I>&gt;<i> &gt;        dbcmd.ExecuteNonQuery ();
</I>&gt;<i> &gt;        dbcmd.Dispose ();
</I>&gt;<i> &gt;        dbcmd = null;
</I>&gt;<i> &gt;        dbcon.Close ();
</I>&gt;<i> &gt;        dbcon = null;
</I>&gt;<i> &gt;    }
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ________________________________________
</I>&gt;<i> &gt; From: Daniel Morgan [<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">monodanmorg at yahoo.com</A>]
</I>&gt;<i> &gt; Sent: Tuesday, February 12, 2008 9:08 PM
</I>&gt;<i> &gt; To: Edwin Kim
</I>&gt;<i> &gt; Subject: Re: [Mono-list] System.Data.OracleClient
</I>&gt;<i> on
</I>&gt;<i> &gt; z/Linux
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'm sorry.  It does look that way.  You could use
</I>&gt;<i> &gt; ODBC
</I>&gt;<i> &gt; instead.  Or you could use a fully managed oracle
</I>&gt;<i> &gt; provider, such as, one from DataDirect.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It looks like Mono's OracleClient fails trying to
</I>&gt;<i> &gt; call
</I>&gt;<i> &gt; the Prepare function.  Maybe OCI did not create an
</I>&gt;<i> &gt; OCI
</I>&gt;<i> &gt; statement handle.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If you look in source in OciStatementHandle, it
</I>&gt;<i> may
</I>&gt;<i> &gt; give you a clue where it is failing.  You could
</I>&gt;<i> turn
</I>&gt;<i> &gt; tracing on.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Or you could put a bunch of
</I>&gt;<i> &gt; Console.Error.WriteLine's
</I>&gt;<i> &gt; checking the output of function calls to see what
</I>&gt;<i> is
</I>&gt;<i> &gt; being returned.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; dbcmd.commandText fails to compile because you
</I>&gt;<i> were
</I>&gt;<i> &gt; trying to access a member of OracleCommand that is
</I>&gt;<i> &gt; private, protected, or internal.  C# is case
</I>&gt;<i> &gt; sesitive.
</I>&gt;<i> &gt;  If you need to access the CommandText property of
</I>&gt;<i> &gt; OracleCommand, you have to spell it with the
</I>&gt;<i> correct
</I>&gt;<i> &gt; capitalization.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Is z/Linux running on the IBM z/800 big endian or
</I>&gt;<i> &gt; little endian?  I assume big endian.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Mono's OracleClient was mainly developed on
</I>&gt;<i> Windows
</I>&gt;<i> &gt; and Linux on 32-bit x86.  So, there could be a
</I>&gt;<i> &gt; problem
</I>&gt;<i> &gt; with marshalling integers and unicode strings. 
</I>&gt;<i> Does
</I>&gt;<i> &gt; the IBM z/800 require alignment of integers?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; --- Edwin Kim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">ekim at transitchicago.com</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; Do you mean I can't use the OracleClient
</I>&gt;<i> provider
</I>&gt;<i> &gt; &gt; yet?
</I>&gt;<i> &gt; &gt; z/linux is 64-bit running on IBM z/800
</I>&gt;<i> processor.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I was able to display the connection state and
</I>&gt;<i> &gt; &gt; dbcmd.CommandText on the screen:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Code:
</I>&gt;<i> &gt; &gt;  using System;
</I>&gt;<i> &gt; &gt;  using System.Data;
</I>&gt;<i> &gt; &gt;  using System.Data.OracleClient;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  public class Test
</I>&gt;<i> &gt; &gt;  {
</I>&gt;<i> &gt; &gt;     public static void Main (string[] args)
</I>&gt;<i> &gt; &gt;     {
</I>&gt;<i> &gt; &gt;        string connectionString =
</I>&gt;<i> &gt; &gt;           &quot;Data Source=wpsdb;&quot; +
</I>&gt;<i> &gt; &gt;           &quot;User ID=test;&quot; +
</I>&gt;<i> &gt; &gt;           &quot;Password=test;&quot;;
</I>&gt;<i> &gt; &gt;        OracleConnection dbcon = null;
</I>&gt;<i> &gt; &gt;        dbcon = new OracleConnection
</I>&gt;<i> &gt; &gt; (connectionString);
</I>&gt;<i> &gt; &gt;        dbcon.Open ();
</I>&gt;<i> &gt; &gt;        Console.WriteLine(&quot;Connection State: &quot; +
</I>&gt;<i> &gt; &gt; dbcon.State);
</I>&gt;<i> &gt; &gt;        Console.WriteLine(&quot;ServerVersion: &quot; +
</I>&gt;<i> &gt; &gt; dbcon.ServerVersion + &quot;\nDataSource: &quot; +
</I>&gt;<i> &gt; &gt; dbcon.DataSource);
</I>&gt;<i> &gt; &gt;        string commandText = &quot;SELECT * FROM
</I>&gt;<i> dual&quot;;
</I>&gt;<i> &gt; &gt;        OracleCommand dbcmd = new OracleCommand
</I>&gt;<i> &gt; &gt; (commandText, dbcon);
</I>&gt;<i> &gt; &gt;        Console.WriteLine(&quot;commandText: &quot; +
</I>&gt;<i> &gt; &gt; dbcmd.CommandText);
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;        OracleDataReader reader =
</I>&gt;<i> &gt; dbcmd.ExecuteReader
</I>&gt;<i> &gt; &gt; ();
</I>&gt;<i> &gt; &gt;        // clean up
</I>&gt;<i> &gt; &gt;        reader.Close ();
</I>&gt;<i> &gt; &gt;        reader = null;
</I>&gt;<i> &gt; &gt;        dbcmd.Dispose ();
</I>&gt;<i> &gt; &gt;        dbcmd = null;
</I>&gt;<i> &gt; &gt;        dbcon.Close ();
</I>&gt;<i> &gt; &gt;        dbcon = null;
</I>&gt;<i> &gt; &gt;     }
</I>&gt;<i> &gt; &gt;  }
</I>&gt;<i> &gt; 
</I>&gt;<i> === message truncated ===
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i>
</I>____________________________________________________________________________________
&gt;<i> Never miss a thing.  Make Yahoo your home page. 
</I>&gt;<i> <A HREF="http://www.yahoo.com/r/hs">http://www.yahoo.com/r/hs</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>


      ____________________________________________________________________________________
Never miss a thing.  Make Yahoo your home page. 
<A HREF="http://www.yahoo.com/r/hs">http://www.yahoo.com/r/hs</A>
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037811.html">[Mono-list] System.Data.OracleClient on z/Linux
</A></li>
	<LI>Next message: <A HREF="037802.html">[Mono-list] Mono for RedHat 9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37800">[ date ]</a>
              <a href="thread.html#37800">[ thread ]</a>
              <a href="subject.html#37800">[ subject ]</a>
              <a href="author.html#37800">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
