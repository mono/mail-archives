<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] System.Data.OracleClient on z/Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Data.OracleClient%20on%20z/Linux&In-Reply-To=3A89ACCE1BCAF24DB3227D0E710283B20ED9ACBE8F%40LAKS-EXMA001.corp.transitchicago.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037798.html">
   <LINK REL="Next"  HREF="037809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] System.Data.OracleClient on z/Linux</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Data.OracleClient%20on%20z/Linux&In-Reply-To=3A89ACCE1BCAF24DB3227D0E710283B20ED9ACBE8F%40LAKS-EXMA001.corp.transitchicago.com"
       TITLE="[Mono-list] System.Data.OracleClient on z/Linux">monodanmorg at yahoo.com
       </A><BR>
    <I>Thu Feb 14 20:28:41 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="037798.html">[Mono-list] ANNOUNCE: NDesk.Options 0.2.0
</A></li>
        <LI>Next message: <A HREF="037809.html">[Mono-list] System.Data.OracleClient on z/Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37799">[ date ]</a>
              <a href="thread.html#37799">[ thread ]</a>
              <a href="subject.html#37799">[ subject ]</a>
              <a href="author.html#37799">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Go to Mono's web site and go to the download page. 
Download the source code to mono if you have not
already.  Unarchive it somewhere.  I assume you know
how to ungzip and untar a file.

In the source, go to
mono_source/mcs/class/System.Data.OracleClient/System.Data.OracleClient.cs

And look in file OciStatementHandle.cs at function
Prepare.  You should see it calling the function
OCIUnicodeToCharSet.  You need to see what the
function is actually passing returning via
Console.Error.WriteLine calls.

Oracle Call Interface Programmer's Guide
<A HREF="http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14250/toc.htm">http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14250/toc.htm</A>

Documentation for all Oracle products can be found
here:
<A HREF="http://tahiti.oracle.com/">http://tahiti.oracle.com/</A>

sword OCIUnicodeToCharSet ( dvoid       *hndl, 
                            OraText     *dst, 
                            size_t      dstlen, 
                            CONST ub2   *src, 
                            size_t      srclen, 
                            size_t      *rsize );

The docs says these are the possible values that can
be returned: OCI_SUCCESS, OCI_INVALID_HANDLE. or
OCI_ERROR.  I'm not sure the proper way to marshal a
size_t that will work on 32-bit and 64-bits systems. 
Perhaps someone reading this can shed some light.

Also, take a look at OciCalls.cs and see how to enable
tracing.  You may need to re-build
System.Data.OracleClient to enable tracing.  And I
think you would also need to set OCI_TRACE to point to
the file to log tracing.

--- Edwin Kim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">EKIM at transitchicago.com</A>&gt; wrote:

&gt;<i> Thanks much!!!
</I>&gt;<i> 
</I>&gt;<i> I'm new to Mono, OCI, and C#.
</I>&gt;<i> I guess z/Linux running on the IBM z/800 (mainframe)
</I>&gt;<i> is big endian.
</I>&gt;<i> 
</I>&gt;<i> I was able to display some information using
</I>&gt;<i> environment variables:
</I>&gt;<i>         export MONO_LOG_LEVEL=info
</I>&gt;<i>         export MONO_LOG_MASK=dll
</I>&gt;<i> 
</I>&gt;<i> Console output:
</I>&gt;<i> 
</I>&gt;<i> Mono-INFO: Searching for 'OCISessionBegin'.
</I>&gt;<i> Mono-INFO: Probing 'OCISessionBegin'.
</I>&gt;<i> Mono-INFO: Found as 'OCISessionBegin'.
</I>&gt;<i> Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: Searching for 'OCIServerVersion'.
</I>&gt;<i> Mono-INFO: Probing 'OCIServerVersion'.
</I>&gt;<i> Mono-INFO: Found as 'OCIServerVersion'.
</I>&gt;<i> Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: Searching for 'OCICharSetToUnicode'.
</I>&gt;<i> Mono-INFO: Probing 'OCICharSetToUnicode'.
</I>&gt;<i> Mono-INFO: Found as 'OCICharSetToUnicode'.
</I>&gt;<i> ServerVersion: Oracle Database
</I>&gt;<i> DataSource: wpsdb
</I>&gt;<i> Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: Searching for 'OCIUnicodeToCharSet'.
</I>&gt;<i> Mono-INFO: Probing 'OCIUnicodeToCharSet'.
</I>&gt;<i> Mono-INFO: Found as 'OCIUnicodeToCharSet'.
</I>&gt;<i> Unhandled Exception: System.NullReferenceException:
</I>&gt;<i> Object reference not set to an instance of an object
</I>&gt;<i>   at
</I>&gt;<i>
</I>System.Data.OracleClient.Oci.OciStatementHandle.Prepare
&gt;<i> (System.String commandText) [0x00000]
</I>&gt;<i>   at
</I>&gt;<i>
</I>System.Data.OracleClient.OracleCommand.PrepareStatement
&gt;<i> (System.Data.OracleClient.Oci.OciStatementHandle
</I>&gt;<i> statement) [0x00000]
</I>&gt;<i>   at
</I>&gt;<i> System.Data.OracleClient.OracleCommand.ExecuteReader
</I>&gt;<i> (CommandBehavior behavior) [0x00000]
</I>&gt;<i>   at
</I>&gt;<i> System.Data.OracleClient.OracleCommand.ExecuteReader
</I>&gt;<i> () [0x00000]
</I>&gt;<i>   at (wrapper remoting-invoke-with-check)
</I>&gt;<i> System.Data.OracleClient.OracleCommand:ExecuteReader
</I>&gt;<i> ()
</I>&gt;<i>   at Test.Main (System.String[] args) [0x00000]
</I>&gt;<i> Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libclntsh.so'.
</I>&gt;<i> Mono-INFO: Searching for 'OCIHandleFree'.
</I>&gt;<i> Mono-INFO: Probing 'OCIHandleFree'.
</I>&gt;<i> Mono-INFO: Found as 'OCIHandleFree'.
</I>&gt;<i> 
</I>&gt;<i> and source code:
</I>&gt;<i> using System;
</I>&gt;<i> using System.Data;
</I>&gt;<i> using System.Data.OracleClient;
</I>&gt;<i> public class Test
</I>&gt;<i> {
</I>&gt;<i>    public static void Main (string[] args)
</I>&gt;<i>    {
</I>&gt;<i>        string connectionString =
</I>&gt;<i>           &quot;Data Source=wpsdb;&quot; +
</I>&gt;<i>           &quot;User ID=test;&quot; +
</I>&gt;<i>           &quot;Password=test;&quot;;
</I>&gt;<i>        OracleConnection dbcon = null;
</I>&gt;<i>        dbcon = new OracleConnection
</I>&gt;<i> (connectionString);
</I>&gt;<i>        dbcon.Open ();
</I>&gt;<i>        Console.WriteLine(&quot;ServerVersion: &quot; +
</I>&gt;<i> dbcon.ServerVersion + &quot;\nDataSource: &quot; +
</I>&gt;<i> dbcon.DataSource);
</I>&gt;<i> 
</I>&gt;<i>        OracleCommand dbcmd = dbcon.CreateCommand ();
</I>&gt;<i>        string sql = &quot;SELECT * FROM dual&quot;;
</I>&gt;<i>        dbcmd.CommandText = sql;
</I>&gt;<i>        OracleDataReader reader = dbcmd.ExecuteReader
</I>&gt;<i> ();
</I>&gt;<i>        while (reader.Read ()) {
</I>&gt;<i>          System.Console.WriteLine( &quot;.&quot; );
</I>&gt;<i>        }
</I>&gt;<i>        // clean up
</I>&gt;<i>        reader.Close ();
</I>&gt;<i>        reader = null;
</I>&gt;<i>        dbcmd.CommandText = sql;
</I>&gt;<i>        dbcmd.ExecuteNonQuery ();
</I>&gt;<i>        dbcmd.Dispose ();
</I>&gt;<i>        dbcmd = null;
</I>&gt;<i>        dbcon.Close ();
</I>&gt;<i>        dbcon = null;
</I>&gt;<i>    }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ________________________________________
</I>&gt;<i> From: Daniel Morgan [<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">monodanmorg at yahoo.com</A>]
</I>&gt;<i> Sent: Tuesday, February 12, 2008 9:08 PM
</I>&gt;<i> To: Edwin Kim
</I>&gt;<i> Subject: Re: [Mono-list] System.Data.OracleClient on
</I>&gt;<i> z/Linux
</I>&gt;<i> 
</I>&gt;<i> I'm sorry.  It does look that way.  You could use
</I>&gt;<i> ODBC
</I>&gt;<i> instead.  Or you could use a fully managed oracle
</I>&gt;<i> provider, such as, one from DataDirect.
</I>&gt;<i> 
</I>&gt;<i> It looks like Mono's OracleClient fails trying to
</I>&gt;<i> call
</I>&gt;<i> the Prepare function.  Maybe OCI did not create an
</I>&gt;<i> OCI
</I>&gt;<i> statement handle.
</I>&gt;<i> 
</I>&gt;<i> If you look in source in OciStatementHandle, it may
</I>&gt;<i> give you a clue where it is failing.  You could turn
</I>&gt;<i> tracing on.
</I>&gt;<i> 
</I>&gt;<i> Or you could put a bunch of
</I>&gt;<i> Console.Error.WriteLine's
</I>&gt;<i> checking the output of function calls to see what is
</I>&gt;<i> being returned.
</I>&gt;<i> 
</I>&gt;<i> dbcmd.commandText fails to compile because you were
</I>&gt;<i> trying to access a member of OracleCommand that is
</I>&gt;<i> private, protected, or internal.  C# is case
</I>&gt;<i> sesitive.
</I>&gt;<i>  If you need to access the CommandText property of
</I>&gt;<i> OracleCommand, you have to spell it with the correct
</I>&gt;<i> capitalization.
</I>&gt;<i> 
</I>&gt;<i> Is z/Linux running on the IBM z/800 big endian or
</I>&gt;<i> little endian?  I assume big endian.
</I>&gt;<i> 
</I>&gt;<i> Mono's OracleClient was mainly developed on Windows
</I>&gt;<i> and Linux on 32-bit x86.  So, there could be a
</I>&gt;<i> problem
</I>&gt;<i> with marshalling integers and unicode strings.  Does
</I>&gt;<i> the IBM z/800 require alignment of integers?
</I>&gt;<i> 
</I>&gt;<i> --- Edwin Kim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">ekim at transitchicago.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Do you mean I can't use the OracleClient provider
</I>&gt;<i> &gt; yet?
</I>&gt;<i> &gt; z/linux is 64-bit running on IBM z/800 processor.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I was able to display the connection state and
</I>&gt;<i> &gt; dbcmd.CommandText on the screen:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Code:
</I>&gt;<i> &gt;  using System;
</I>&gt;<i> &gt;  using System.Data;
</I>&gt;<i> &gt;  using System.Data.OracleClient;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  public class Test
</I>&gt;<i> &gt;  {
</I>&gt;<i> &gt;     public static void Main (string[] args)
</I>&gt;<i> &gt;     {
</I>&gt;<i> &gt;        string connectionString =
</I>&gt;<i> &gt;           &quot;Data Source=wpsdb;&quot; +
</I>&gt;<i> &gt;           &quot;User ID=test;&quot; +
</I>&gt;<i> &gt;           &quot;Password=test;&quot;;
</I>&gt;<i> &gt;        OracleConnection dbcon = null;
</I>&gt;<i> &gt;        dbcon = new OracleConnection
</I>&gt;<i> &gt; (connectionString);
</I>&gt;<i> &gt;        dbcon.Open ();
</I>&gt;<i> &gt;        Console.WriteLine(&quot;Connection State: &quot; +
</I>&gt;<i> &gt; dbcon.State);
</I>&gt;<i> &gt;        Console.WriteLine(&quot;ServerVersion: &quot; +
</I>&gt;<i> &gt; dbcon.ServerVersion + &quot;\nDataSource: &quot; +
</I>&gt;<i> &gt; dbcon.DataSource);
</I>&gt;<i> &gt;        string commandText = &quot;SELECT * FROM dual&quot;;
</I>&gt;<i> &gt;        OracleCommand dbcmd = new OracleCommand
</I>&gt;<i> &gt; (commandText, dbcon);
</I>&gt;<i> &gt;        Console.WriteLine(&quot;commandText: &quot; +
</I>&gt;<i> &gt; dbcmd.CommandText);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;        OracleDataReader reader =
</I>&gt;<i> dbcmd.ExecuteReader
</I>&gt;<i> &gt; ();
</I>&gt;<i> &gt;        // clean up
</I>&gt;<i> &gt;        reader.Close ();
</I>&gt;<i> &gt;        reader = null;
</I>&gt;<i> &gt;        dbcmd.Dispose ();
</I>&gt;<i> &gt;        dbcmd = null;
</I>&gt;<i> &gt;        dbcon.Close ();
</I>&gt;<i> &gt;        dbcon = null;
</I>&gt;<i> &gt;     }
</I>&gt;<i> &gt;  }
</I>&gt;<i> 
</I>=== message truncated ===



      ____________________________________________________________________________________
Never miss a thing.  Make Yahoo your home page. 
<A HREF="http://www.yahoo.com/r/hs">http://www.yahoo.com/r/hs</A>
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037798.html">[Mono-list] ANNOUNCE: NDesk.Options 0.2.0
</A></li>
	<LI>Next message: <A HREF="037809.html">[Mono-list] System.Data.OracleClient on z/Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37799">[ date ]</a>
              <a href="thread.html#37799">[ thread ]</a>
              <a href="subject.html#37799">[ subject ]</a>
              <a href="author.html#37799">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
