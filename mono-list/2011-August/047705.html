<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] newbie - understanding profiler data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20newbie%20-%20understanding%20profiler%20data&In-Reply-To=1314805905507-3781405.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="047704.html">
   <LINK REL="Next"  HREF="047706.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] newbie - understanding profiler data</H1>
    <B>Alan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20newbie%20-%20understanding%20profiler%20data&In-Reply-To=1314805905507-3781405.post%40n4.nabble.com"
       TITLE="[Mono-list] newbie - understanding profiler data">alan.mcgovern at gmail.com
       </A><BR>
    <I>Wed Aug 31 19:49:01 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="047704.html">[Mono-list] newbie - understanding profiler data
</A></li>
        <LI>Next message: <A HREF="047706.html">[Mono-list] newbie - understanding profiler data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47705">[ date ]</a>
              <a href="thread.html#47705">[ thread ]</a>
              <a href="subject.html#47705">[ subject ]</a>
              <a href="author.html#47705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To be honest, the numbers mean nothing by themselves. Why are you surprised
about the memory usage? Apparently there's 110mb of data being allocated by
the streamwriter. This is because you're creating thousands of
streamwriters.

If you find the amount of memory being allocated (and released) by
streamwriters to be excessive, you should rewrite your code so that you
reuse them were appropriate instead of creating new ones.

Similar optimisations could potentially be applied to your usage of the
Dictionary class. You're allocating a lot of them. Would it be possible for
you to call Clear on a dictionary and then reuse it?

Alan

On 31 Aug 2011 16:51, &quot;pjsmith&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">pjsmith at mtgsy.net</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> My vb.net app running under mono on linux(built under .net on windows) is
</I>&gt;<i> using a lot of memory. I tried to use the profiler running on linux to see
</I>&gt;<i> where this is all going, but having some problems interpreting exactly
</I>what
&gt;<i> I see. I read the profiler info on the mono site, but whilst it explains
</I>&gt;<i> how to use it, it doesn't do much about telling how to interpret the
</I>&gt;<i> results!
</I>&gt;<i>
</I>&gt;<i> I'm seeing data like the following and am surprised at the memory usage.
</I>&gt;<i>
</I>&gt;<i> ########################
</I>&gt;<i> 118830 KB System.IO.StreamWriter::Initialize(Encoding,int)
</I>&gt;<i> 79194 KB 4948 System.Byte[]
</I>&gt;<i> 39635 KB 4948 System.Char[]
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 4944 99 % System.IO.StreamWriter::.ctor(string,bool,Encoding,int)
</I>&gt;<i> ########################
</I>&gt;<i> 102769 KB
</I>&gt;<i>
</I>Mono.Globalization.Unicode.SortKeyBuffer::Initialize(CompareOptions,int,string,bool)
&gt;<i> 102769 KB 3599832 System.Byte[]
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 449979 100 %
</I>&gt;<i>
</I>Mono.Globalization.Unicode.SimpleCollator::GetSortKey(string,int,int,CompareOptions)
&gt;<i> ########################
</I>&gt;<i> 81311 KB System.Collections.Generic.Dictionary`2::Resize()
</I>&gt;<i> 31979 KB 54578 .Link[]
</I>&gt;<i> 16458 KB 54598 System.String[]
</I>&gt;<i> 16457 KB 54595 System.Int32[]
</I>&gt;<i> 16416 KB 54578 System.Object[]
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 54581 99 %
</I>&gt;<i> System.Collections.Generic.Dictionary`2::set_Item(TKey,TValue)
</I>&gt;<i> ########################
</I>&gt;<i> 60706 KB System.String::ToCharArray()
</I>&gt;<i> 60706 KB 305281 System.Char[]
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 283019 92 %
</I>&gt;<i> Microsoft.VisualBasic.Strings::Replace(string,string,string,int,int,bool)
</I>&gt;<i> 17182 5 %
</I>&gt;<i> Microsoft.VisualBasic.Strings::Split(string,string,int,CompareMethod)
</I>&gt;<i> 4969 1 % System.IO.TextWriter::.ctor()
</I>&gt;<i> ########################
</I>&gt;<i> 60047 KB System.Text.StringBuilder::.ctor(string,int,int,int,int)
</I>&gt;<i> 60047 KB 294018 System.String
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 294018 100 % System.Text.StringBuilder::.ctor(string,int,int,int)
</I>&gt;<i> ########################
</I>&gt;<i> 56349 KB System.String::Remove(int,int)
</I>&gt;<i> 56349 KB 217892 System.String
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 217892 100 % ConsoleApplication1.Module1::GetRecords(string,soa)
</I>&gt;<i> ########################
</I>&gt;<i> 39647 KB System.IO.FileStream::InitBuffer(int,bool)
</I>&gt;<i> 39647 KB 4953 System.Byte[]
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 4948 99 %
</I>&gt;<i>
</I>System.IO.FileStream::.ctor(string,FileMode,FileAccess,FileShare,int,bool,FileOptions)
&gt;<i> ########################
</I>&gt;<i> 38670 KB
</I>&gt;<i>
</I>Mono.Globalization.Unicode.SimpleCollator::GetSortKey(string,int,int,CompareOptions)
&gt;<i> 38670 KB 449979 Mono.Globalization.Unicode.SortKeyBuffer
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 449979 100 %
</I>&gt;<i>
</I>Mono.Globalization.Unicode.SimpleCollator::GetSortKey(string,CompareOptions)
&gt;<i> ########################
</I>&gt;<i> 32156 KB System.String::ConcatInternal(string[],int)
</I>&gt;<i> 32156 KB 86981 System.String
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 86981 100 % System.String::Concat(string[])
</I>&gt;<i> ########################
</I>&gt;<i> 29879 KB System.String::SubstringUnchecked(int,int)
</I>&gt;<i> 29879 KB 1394496 System.String
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 1715586 77 % System.String::Substring(int,int)
</I>&gt;<i> 449964 20 % System.String::Substring(int)
</I>&gt;<i> 37896 1 % System.Text.StringBuilder::ToString()
</I>&gt;<i> ########################
</I>&gt;<i> 27962 KB System.String::CreateString(char,int)
</I>&gt;<i> 27962 KB 1211286 System.String
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 1211286 100 % System.String::.ctor(char,int)
</I>&gt;<i> ########################
</I>&gt;<i> 27741 KB maxmind.LookupService::init()
</I>&gt;<i> 27741 KB 3 System.Byte[]
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 1 100 % maxmind.LookupService::.ctor(string,int)
</I>&gt;<i> ########################
</I>&gt;<i> 25583 KB System.Text.Encoding::GetBytes(string)
</I>&gt;<i> 25583 KB 1433648 System.Byte[]
</I>&gt;<i> Callers (with count) that contribute at least for 1%:
</I>&gt;<i> 1421228 99 %
</I>&gt;<i> MySql.Data.MySqlClient.MySqlPacket::WriteStringNoNull(string)
</I>&gt;<i>
</I>&gt;<i> I've tried calling gc.collect (I know, bad), but it doesn't help much. Now
</I>&gt;<i> experimenting with .dispose, but this is all managed code, so not sure any
</I>&gt;<i> of this should really be needed?
</I>&gt;<i>
</I>&gt;<i> Mono version is 2.4.4 and I'm running it under Ubuntu 10.4.
</I>&gt;<i>
</I>&gt;<i> Does anyone have any suggestions or pointers to material where I can learn
</I>a
&gt;<i> bit more about this, or any suggestions for preserving memory when running
</I>&gt;<i> apps under mono?
</I>&gt;<i>
</I>&gt;<i> Thanks.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I><A HREF="http://mono.1490590.n4.nabble.com/newbie-understanding-profiler-data-tp3781405p3781405.html">http://mono.1490590.n4.nabble.com/newbie-understanding-profiler-data-tp3781405p3781405.html</A>
&gt;<i> Sent from the Mono - General mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist - <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20110901/c6c30153/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20110901/c6c30153/attachment-0001.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="047704.html">[Mono-list] newbie - understanding profiler data
</A></li>
	<LI>Next message: <A HREF="047706.html">[Mono-list] newbie - understanding profiler data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47705">[ date ]</a>
              <a href="thread.html#47705">[ thread ]</a>
              <a href="subject.html#47705">[ subject ]</a>
              <a href="author.html#47705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
