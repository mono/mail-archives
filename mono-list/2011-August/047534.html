<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Dictionary&lt;&gt; key'ed by Decimal works differently between Mono and .NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Dictionary%3C%3E%20key%27ed%20by%20Decimal%20works%20differently%0A%20between%20Mono%20and%20.NET&In-Reply-To=CABs1bs33Cg8OSfwanU7e8udmUg3%3DHzuj--J5bZGT%2BviTHrSg4w%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="047533.html">
   <LINK REL="Next"  HREF="047535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Dictionary&lt;&gt; key'ed by Decimal works differently between Mono and .NET</H1>
    <B>Robert Jordan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Dictionary%3C%3E%20key%27ed%20by%20Decimal%20works%20differently%0A%20between%20Mono%20and%20.NET&In-Reply-To=CABs1bs33Cg8OSfwanU7e8udmUg3%3DHzuj--J5bZGT%2BviTHrSg4w%40mail.gmail.com"
       TITLE="[Mono-list] Dictionary&lt;&gt; key'ed by Decimal works differently between Mono and .NET">robertj at gmx.net
       </A><BR>
    <I>Thu Aug  4 06:04:59 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="047533.html">[Mono-list] Dictionary&lt;&gt; key'ed by Decimal works differently	between Mono and .NET
</A></li>
        <LI>Next message: <A HREF="047535.html">[Mono-list] Dictionary&lt;&gt; key'ed by Decimal works differently between Mono and .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47534">[ date ]</a>
              <a href="thread.html#47534">[ thread ]</a>
              <a href="subject.html#47534">[ subject ]</a>
              <a href="author.html#47534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04.08.2011 11:09, Mike Christensen wrote:
&gt;<i> I'm trying to get my unit tests to pass so I can try out my code on
</I>&gt;<i> Mono, however I ran into some different behavior using the
</I>&gt;<i> Dictionary&lt;&gt;  class.  I've written a stand-alone test case to
</I>&gt;<i> illustrate the problem.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://pastie.org/2318806">http://pastie.org/2318806</A>
</I>&gt;<i>
</I>&gt;<i> The code will print out &quot;True&quot; on .NET and &quot;False&quot; on Mono.  I believe
</I>&gt;<i> this is because I add the key as 0.5m to the dictionary, but I try to
</I>&gt;<i> look it up with 0.500m.  .NET will see these values as equal, Mono
</I>&gt;<i> will not.
</I>&gt;<i>
</I>&gt;<i> Technically the numbers are equal, though they have different levels
</I>&gt;<i> of precision.  However, I'm of the opinion that Mono should emulate
</I>&gt;<i> .NET where-ever possible.
</I>
Well, MS.NET is inconsistent. It returns &quot;false&quot; in all cases
below, which means that it performs some insane magic inside
Dictionary, something that cannot be reproduced even using
its own comparer.

If you want this fixed, then you should provide some sort
of evidence (a document/blog/etc. that describes MS.NET's
behavior).

using System;
using System.Collections.Generic;

class Test
{
	static void Main ()
	{
		decimal a = 10.5m;
		decimal b = Math.Round (10.5m - 10, 3);
		Console.WriteLine (a == b);

		var map = new Dictionary&lt;decimal, string&gt;();
		var c = map.Comparer;
		Console.WriteLine (c.Equals (a, b));
		Console.WriteLine (c.GetHashCode (a) == c.GetHashCode (b));
	}
}

Robert

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="047533.html">[Mono-list] Dictionary&lt;&gt; key'ed by Decimal works differently	between Mono and .NET
</A></li>
	<LI>Next message: <A HREF="047535.html">[Mono-list] Dictionary&lt;&gt; key'ed by Decimal works differently between Mono and .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47534">[ date ]</a>
              <a href="thread.html#47534">[ thread ]</a>
              <a href="subject.html#47534">[ subject ]</a>
              <a href="author.html#47534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
