<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono does not include full stacktrace while rethrowing exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%20does%20not%20include%20full%20stacktrace%20while%0A%20rethrowing%20exception&In-Reply-To=%3CCAGu5pZfZFL1dAC-M_pU7-sB%2BBs%3D0%2BU7YJU_Z-TJYyw%3DismsbHw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="052119.html">
   <LINK REL="Next"  HREF="052120.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono does not include full stacktrace while rethrowing exception</H1>
    <B>Alan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%20does%20not%20include%20full%20stacktrace%20while%0A%20rethrowing%20exception&In-Reply-To=%3CCAGu5pZfZFL1dAC-M_pU7-sB%2BBs%3D0%2BU7YJU_Z-TJYyw%3DismsbHw%40mail.gmail.com%3E"
       TITLE="[Mono-list] Mono does not include full stacktrace while rethrowing exception">alan.mcgovern at gmail.com
       </A><BR>
    <I>Wed Jun 22 22:30:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="052119.html">[Mono-list] Mono does not include full stacktrace while rethrowing exception
</A></li>
        <LI>Next message: <A HREF="052120.html">[Mono-list] Mono does not include full stacktrace while rethrowing	exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52122">[ date ]</a>
              <a href="thread.html#52122">[ thread ]</a>
              <a href="subject.html#52122">[ subject ]</a>
              <a href="author.html#52122">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

It's not just inlining that'll cause a problem, it's also tailcalls. Read
the section that starts right after this sentence: &quot;Plus, we haven't tried
64-bit yet. Let's run the Release build on 64-bit:&quot;

It's pretty hard to guarantee you'll always get every stackframe on either
.NET or mono without hacking up every method because that stackframe may
not actually exist at runtime. This is especially true if you're running F#.

Alan

On 22 June 2016 at 10:36, &#1040;&#1083;&#1077;&#1082;&#1089;&#1077;&#1081; &#1041;&#1086;&#1075;&#1086;&#1084;&#1086;&#1083;&#1086;&#1074; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">horse315 at gmail.com</A>&gt; wrote:

&gt;<i> Hi, Alan! I understand inlining in Release configuration. I should have
</I>&gt;<i> mentioned that I'm running in Debug mode in both cases.
</I>&gt;<i>
</I>&gt;<i> Bernard, I tried running with and without inlining in Debug configuration.
</I>&gt;<i> Thre result *with* inlining is:
</I>&gt;<i>
</I>&gt;<i> System.NotImplementedException: The method or operation is not implemented.
</I>&gt;<i>   at TestApp.ExceptionReThrow.M2 () [0x00001] in
</I>&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:31
</I>&gt;<i>
</I>&gt;<i> *without *inlining:
</I>&gt;<i>
</I>&gt;<i> System.NotImplementedException: The method or operation is not implemented.
</I>&gt;<i>   at TestApp.ExceptionReThrow.M3 () [0x00001] in
</I>&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:42
</I>&gt;<i>   at TestApp.ExceptionReThrow.M2 () [0x00003] in
</I>&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:32
</I>&gt;<i>
</I>&gt;<i> So, in Mono a allways loose original Test-M1-M2 method call chain.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 2016-06-21 20:55 GMT+03:00 Bernhard Urban &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">beurba at microsoft.com</A>&gt;:
</I>&gt;<i>
</I>&gt;&gt;<i> You can try to run mono without inlining: `mono -O=-inline [...]'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------
</I>&gt;&gt;<i> *From:* <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A> &lt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>&gt; on behalf of Alan &lt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">alan.mcgovern at gmail.com</A>&gt;
</I>&gt;&gt;<i> *Sent:* Tuesday, June 21, 2016 2:33 AM
</I>&gt;&gt;<i> *To:* &#1040;&#1083;&#1077;&#1082;&#1089;&#1077;&#1081; &#1041;&#1086;&#1075;&#1086;&#1084;&#1086;&#1083;&#1086;&#1074;
</I>&gt;&gt;<i> *Cc:* Mono List
</I>&gt;&gt;<i> *Subject:* Re: [Mono-list] Mono does not include full stacktrace while
</I>&gt;&gt;<i> rethrowing exception
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This happens on .NET too. This gives a good description of what's
</I>&gt;&gt;<i> happening and why.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://www.hanselman.com/blog/ReleaseISNOTDebug64bitOptimizationsAndCMethodInliningInReleaseBuildCallStacks.aspx">http://www.hanselman.com/blog/ReleaseISNOTDebug64bitOptimizationsAndCMethodInliningInReleaseBuildCallStacks.aspx</A>
</I>&gt;&gt;<i> &lt;<A HREF="https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2fwww.hanselman.com%2fblog%2fReleaseISNOTDebug64bitOptimizationsAndCMethodInliningInReleaseBuildCallStacks.aspx&amp;data=01%7c01%7cbeurba%40microsoft.com%7cf5f2327fd4a34d18817208d399b71770%7c72f988bf86f141af91ab2d7cd011db47%7c1&amp;sdata=OW3ca33WcWiqD83Jujdu9dArjwARXrWC5ssdRcMU0CU%3d">https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2fwww.hanselman.com%2fblog%2fReleaseISNOTDebug64bitOptimizationsAndCMethodInliningInReleaseBuildCallStacks.aspx&amp;data=01%7c01%7cbeurba%40microsoft.com%7cf5f2327fd4a34d18817208d399b71770%7c72f988bf86f141af91ab2d7cd011db47%7c1&amp;sdata=OW3ca33WcWiqD83Jujdu9dArjwARXrWC5ssdRcMU0CU%3d</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 21 June 2016 at 09:31, &#1040;&#1083;&#1077;&#1082;&#1089;&#1077;&#1081; &#1041;&#1086;&#1075;&#1086;&#1084;&#1086;&#1083;&#1086;&#1074; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">horse315 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This behavior makes difficult to troubleshoot errors, especially in
</I>&gt;&gt;&gt;<i> external libraries. Example code:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> public class ExceptionReThrow{
</I>&gt;&gt;&gt;<i>     public void Test(){
</I>&gt;&gt;&gt;<i>         try
</I>&gt;&gt;&gt;<i>         {
</I>&gt;&gt;&gt;<i>             M1 ();
</I>&gt;&gt;&gt;<i>         }
</I>&gt;&gt;&gt;<i>         catch (Exception ex)
</I>&gt;&gt;&gt;<i>         {
</I>&gt;&gt;&gt;<i>             Console.WriteLine(ex);
</I>&gt;&gt;&gt;<i>         }
</I>&gt;&gt;&gt;<i>     }
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     public void M1()
</I>&gt;&gt;&gt;<i>     {
</I>&gt;&gt;&gt;<i>         M2();
</I>&gt;&gt;&gt;<i>     }
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     private void M2()
</I>&gt;&gt;&gt;<i>     {
</I>&gt;&gt;&gt;<i>         try{
</I>&gt;&gt;&gt;<i>             M3();
</I>&gt;&gt;&gt;<i>         }catch{
</I>&gt;&gt;&gt;<i>             throw;
</I>&gt;&gt;&gt;<i>         }
</I>&gt;&gt;&gt;<i>     }
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     private void M3()
</I>&gt;&gt;&gt;<i>     {
</I>&gt;&gt;&gt;<i>         throw new NotImplementedException();
</I>&gt;&gt;&gt;<i>     }}
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For Microsoft .Net output will be:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> System.NotImplementedException: The method or operation is not
</I>&gt;&gt;&gt;<i> implemented. at TestApp.ExceptionReThrow.M3() in
</I>&gt;&gt;&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:line 38 at
</I>&gt;&gt;&gt;<i> TestApp.ExceptionReThrow.M2() in
</I>&gt;&gt;&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:line 32 at
</I>&gt;&gt;&gt;<i> TestApp.ExceptionReThrow.M1() in
</I>&gt;&gt;&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:line 24 at
</I>&gt;&gt;&gt;<i> TestApp.ExceptionReThrow.Test() in
</I>&gt;&gt;&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:line 14
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For mono (4.2.3) output will be:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> System.NotImplementedException: The method or operation is not
</I>&gt;&gt;&gt;<i> implemented. at TestApp.ExceptionReThrow.M3 () [0x00001] in
</I>&gt;&gt;&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:38 at
</I>&gt;&gt;&gt;<i> TestApp.ExceptionReThrow.M2 () [0x00003] in
</I>&gt;&gt;&gt;<i> D:\source\TestApp\TestApp\ExceptionReThrow.cs:30
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> As you can see, mono looses stack between first and second catch
</I>&gt;&gt;&gt;<i> statements. What is the explanation for this feature? Can I disable it?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;&gt;<i> &lt;<A HREF="https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2flists.ximian.com%2fmailman%2flistinfo%2fmono-list&amp;data=01%7c01%7cbeurba%40microsoft.com%7cf5f2327fd4a34d18817208d399b71770%7c72f988bf86f141af91ab2d7cd011db47%7c1&amp;sdata=HCjwCdQLyKc7gIOR1gMdBebupL2mSvlwxQGIGcDvYGM%3d">https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2flists.ximian.com%2fmailman%2flistinfo%2fmono-list&amp;data=01%7c01%7cbeurba%40microsoft.com%7cf5f2327fd4a34d18817208d399b71770%7c72f988bf86f141af91ab2d7cd011db47%7c1&amp;sdata=HCjwCdQLyKc7gIOR1gMdBebupL2mSvlwxQGIGcDvYGM%3d</A>&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> &#1057; &#1091;&#1074;&#1072;&#1078;&#1077;&#1085;&#1080;&#1077;&#1084;, &#1040;&#1083;&#1077;&#1082;&#1089;&#1077;&#1081; &#1041;&#1086;&#1075;&#1086;&#1084;&#1086;&#1083;&#1086;&#1074; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">horse315 at gmail.com</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20160622/8111b943/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20160622/8111b943/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="052119.html">[Mono-list] Mono does not include full stacktrace while rethrowing exception
</A></li>
	<LI>Next message: <A HREF="052120.html">[Mono-list] Mono does not include full stacktrace while rethrowing	exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52122">[ date ]</a>
              <a href="thread.html#52122">[ thread ]</a>
              <a href="subject.html#52122">[ subject ]</a>
              <a href="author.html#52122">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
