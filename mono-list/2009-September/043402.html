<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list]  Mono and Oracle OCI character set encoding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20%20Mono%20and%20Oracle%20OCI%20character%20set%20encoding&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043403.html">
   <LINK REL="Next"  HREF="043404.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list]  Mono and Oracle OCI character set encoding</H1>
    <B>James Dalton</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20%20Mono%20and%20Oracle%20OCI%20character%20set%20encoding&In-Reply-To="
       TITLE="[Mono-list]  Mono and Oracle OCI character set encoding">james.dalton at deltadentalva.com
       </A><BR>
    <I>Wed Sep  9 13:18:12 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="043403.html">[Mono-list] [MonoDevelop] MonoDevelop 2.2 Beta 1 released
</A></li>
        <LI>Next message: <A HREF="043404.html">[Mono-list] Mono and Oracle OCI character set encoding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43402">[ date ]</a>
              <a href="thread.html#43402">[ thread ]</a>
              <a href="subject.html#43402">[ subject ]</a>
              <a href="author.html#43402">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
We are looking into moving from Microsoft.Net to Mono (probably on openSUSE),
one of the stumbling blocks has been working with Oracle. For Windows we use
the ODP.Net provider, we looked into using System.Data.OracleClient, but
neither version supports as much as ODP.Net, so we are rolling our own Mono
to OCI code. I've gotten some things working, but I'm stumped trying to get
string bind variables to work correctly. I have no problem with ref cursors
and getting strings from ref cursors, just sending strings as a parameter in
a stored procedure. 

I'm pretty sure my problem is with character set encoding, what C# sees and
and PL/SQL sees don't match (the PL/SQL text is garbage.)  I've tried
different means of marshalling the strings and nothing is working what I
have right now is (which should work according to the OCI docs):

internal static extern int OCIBindByName(IntPtr stmtp,
  							out IntPtr bindpp,
							IntPtr errhp,
							string placeholder,
							int placeh_len,
							ref IntPtr valuep,
							int value_sz,
							[MarshalAs (UnmanagedType.U2)] OciDataType dty,
							ref short indp,
							IntPtr alenp,
							IntPtr rcodep,
							uint maxarr_len,
							IntPtr curelp,
							uint mode);

and

   parameterDef.DataType = OciDataType.String;
   parameterDef.ValueSource = parameter;

   size = Encoding.UTF8.GetMaxByteCount(size) + 1;
   parameterDef.BindSource = OciCalls.AllocateClear(size);
   if (paramDirection != ParameterDirection.Out)
   {
      parameter += &quot;\0&quot;;
      int status =
OciCalls.OCIUnicodeToCharSet(OciSession.OciEnvironmentHandle,
parameterDef.BindSource, size, parameter, parameter.Length, IntPtr.Zero);
    }
   parameterDef.Indicator = new short[1];
  if (string.IsNullOrEmpty(parameter) || paramDirection ==
ParameterDirection.Out)
      parameterDef.Indicator[0] = -1;
   else
      parameterDef.Indicator[0] = 0;
   OciCalls.OCIBindByName(OciStatementHandle, out
parameterDef.OciBindHandle, 
	 	                       	   OciSession.OciErrorHandle, &quot;:&quot; +
parameterName, parameterName.Length + 1, 
   ref parameterDef.BindSource, size, parameterDef.DataType, ref
parameterDef.Indicator[0], 
   IntPtr.Zero, IntPtr.Zero, 0, IntPtr.Zero, 0);

-- 
View this message in context: <A HREF="http://www.nabble.com/Mono-and-Oracle-OCI-character-set-encoding-tp25368213p25368213.html">http://www.nabble.com/Mono-and-Oracle-OCI-character-set-encoding-tp25368213p25368213.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043403.html">[Mono-list] [MonoDevelop] MonoDevelop 2.2 Beta 1 released
</A></li>
	<LI>Next message: <A HREF="043404.html">[Mono-list] Mono and Oracle OCI character set encoding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43402">[ date ]</a>
              <a href="thread.html#43402">[ thread ]</a>
              <a href="subject.html#43402">[ subject ]</a>
              <a href="author.html#43402">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
