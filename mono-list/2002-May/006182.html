<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] New improved Emacs C# mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:davh%40davh.dk">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="006178.html">
   <LINK REL="Next"  HREF="006179.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] New improved Emacs C# mode
   </H1>
    <B>Dennis Haney
    </B> 
    <A HREF="mailto:davh%40davh.dk"
       TITLE="[Mono-list] New improved Emacs C# mode">davh@davh.dk
       </A><BR>
    <I>31 May 2002 20:05:15 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="006178.html">[Mono-list] Broken mono build
</A></li>
        <LI> Next message: <A HREF="006179.html">[Mono-list] mbas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6182">[ date ]</a>
              <a href="thread.html#6182">[ thread ]</a>
              <a href="subject.html#6182">[ subject ]</a>
              <a href="author.html#6182">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-=-=

I have a thing for code who alters every file in the system to get
what they want especially if its completly unnecessary... So I ripped
out all of Brad Merrill's csharp code and put it in a file for
itself.

Please try it out and see if there is any regressions. (I altered the
indention for namespaces a little)

This also has the distinct benefit that cc-mode is again the one you
have installed, instead of the one Brad Merrill supplied you with.

This script is also available on <A HREF="http://davh.dk/script/">http://davh.dk/script/</A>

Diff below to add link to the documentation, this also renames Merryl
to Merrill, I expect he can spell his name better himself so Merrill
is better...

-- 
Dennis
use Inline C =&gt; qq{void p(char*g){printf(&quot;Just Another %s Hacker\n&quot;,g);}};p(&quot;Perl&quot;);


--=-=-=
Content-Type: application/emacs-lisp
Content-Disposition: attachment; filename=csharp-mode.el
Content-Description: C-sharp mode for emacs

;;; csharp-mode.el --- csharp-mode

;; Copyright (C) 2002  Free Software Foundation, Inc.

;; Authors: 2002 Dennis Haney &lt;<A HREF="mailto:davh@davh.dk">davh@davh.dk</A>&gt;
;;          2000 Brad Merrill &lt;<A HREF="mailto:zbrad@cybercom.net">zbrad@cybercom.net</A>&gt;
;; Keywords: c, languages, oop
;; Version: 1.0
;; $Id: csharp-mode.el,v 1.5 2002/05/31 18:03:45 davh Exp $

;; This file is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation; either version 2, or (at your option)
;; any later version.

;; This file is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with GNU Emacs; see the file COPYING.  If not, write to
;; the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
;; Boston, MA 02111-1307, USA.

;;; Commentary:

;; Version one was ripped from version 3.0 from
;; <A HREF="http://www.cybercom.net/~zbrad/DotNet/Emacs/">http://www.cybercom.net/~zbrad/DotNet/Emacs/</A>

;; Newest version of this can be found here:
;; <A HREF="http://davh.dk/script/">http://davh.dk/script/</A>

;; To activate put his in your .emacs:

;; (autoload 'csharp-mode &quot;csharp-mode&quot; 
;;   &quot;Major mode for editing C# code.&quot; t)
;; (setq auto-mode-alist (cons '( &quot;\\.cs\\'&quot; . csharp-mode ) auto-mode-alist ))

;; $Log: csharp-mode.el,v $
;; Revision 1.5  2002/05/31 18:03:45  davh
;; Didnt get Merrills name with :(
;;
;; Revision 1.4  2002/05/31 17:48:00  davh
;; I moved a comment
;;
;; Revision 1.3  2002/05/31 17:45:31  davh
;; Added website 'n log
;;
;; 

;;; Code:

(provide 'csharp-mode)

(require 'cc-mode)

(defconst c-Csharp-extra-toplevel-key &quot;\\(namespace\\)&quot;)

(defconst c-Csharp-attrib-key (concat &quot;\[&quot; c-symbol-key &quot;\\(([^)]*)\\)?\]&quot;))

(defconst c-Csharp-class-key
  (concat
  c-Csharp-attrib-key
  &quot;\\(&quot; 
    &quot;\\(&quot;
	&quot;new\\|&quot;
	&quot;public\\|&quot;
	&quot;protected\\|&quot;
	&quot;internal\\|&quot;
	&quot;private\\|&quot;
	&quot;abstract\\|&quot;
	&quot;sealed&quot;
    &quot;\\)&quot;
   &quot;\\s +\\)*&quot;
   &quot;\\(struct\\|class\\)\\s +&quot;
   c-symbol-key				;name of the class
   &quot;\\(&quot; 		;maybe followed by parent
	&quot;\\(\\s +:\\s *&quot; c-symbol-key
		&quot;\\(\\s *,\\s *&quot; c-symbol-key &quot;\\)*&quot;
	&quot;\\)*&quot;
   &quot;\\)?&quot;
   ))

(defconst c-Csharp-conditional-key 
  (concat &quot;\\b\\(&quot; 
	  &quot;for\\|if\\|do\\|else\\|while\\|switch&quot;
	  &quot;\\|try\\|catch&quot;
	  &quot;\\|finally&quot;
	  &quot;\\)\\b[^_]&quot;))

(defconst c-Csharp-method-key
  (concat
   &quot;\\(&quot; c-Csharp-attrib-key &quot;\\s *&quot; &quot;\\)?&quot;
   &quot;\\(&quot; &quot;\\(&quot;
	&quot;new\\|&quot;
	&quot;public\\|&quot;
	&quot;protected\\|&quot;
	&quot;internal\\|&quot;
	&quot;private\\|&quot;
	&quot;static\\|&quot;
	&quot;virtual\\|&quot;
	&quot;override\\|&quot;
	&quot;abstract\\|&quot;
	&quot;extern&quot;
    &quot;\\)&quot; &quot;\\s +\\)*&quot;
   c-symbol-key &quot;\\s *&quot;
   c-symbol-key &quot;\\([.]&quot; c-symbol-key &quot;\\)*&quot;
   &quot;\\s *\\(([^)]*)\\)&quot;
   ))

(defconst c-Csharp-access-key &quot;\\(public\\|protected\\|internal\\|private\\)&quot;)

;
; 3 style of C# comments:
; 1) C block; 2) C++ line comment 3) C# xmldoc format
(defconst c-Csharp-comment-start-regexp &quot;/\\(/[/]?\\|[*][*]?\\)&quot;)

(defconst c-Csharp-xmldoc-paragraph-start
  &quot;@\\(remarks\\|summary\\|exception\\|param\\|returns\\|see\\|c\\)&quot;)

;; Support for Csharp

(defvar csharp-mode-abbrev-table nil
  &quot;Abbreviation table used in csharp-mode buffers.&quot;)
(define-abbrev-table 'csharp-mode-abbrev-table ())

(defvar csharp-mode-map ()
  &quot;Keymap used in csharp-mode buffers.&quot;)
(if csharp-mode-map
    nil
  (setq csharp-mode-map (c-make-inherited-keymap))
  ;; add bindings which are only useful for Csharp
  )

(defvar csharp-mode-syntax-table nil
  &quot;Syntax table used in csharp-mode buffers.&quot;)
(if csharp-mode-syntax-table
    ()
  (setq csharp-mode-syntax-table (make-syntax-table))
  (c-populate-syntax-table csharp-mode-syntax-table))
;; @keyword can be used
  (modify-syntax-entry ?@ &quot;_&quot; csharp-mode-syntax-table)
;; try to treat &quot;.&quot; as part of the sexp
  (modify-syntax-entry ?. &quot;_&quot; csharp-mode-syntax-table)
;; try to treat &quot;.&quot; as part of the word
  (modify-syntax-entry ?. &quot;w&quot; csharp-mode-syntax-table)

(easy-menu-define c-csharp-menu csharp-mode-map &quot;C# Mode Commands&quot;
		  (c-mode-menu &quot;C#&quot;))

(defcustom csharp-mode-hook nil
  &quot;*Hook called by `csharp-mode'.&quot;
  :type 'hook
  :group 'c)

(defcustom csharp-font-lock-extra-types
  '()
  &quot;*List of extra types to fontify in C# mode.
Each list item should be a regexp not containing word-delimiters.
For example, a value of (\&quot;System\&quot;) means the word string is treated as a type
name.

The value of this variable is used when Font Lock mode is turned on.&quot;
  :type 'font-lock-extra-types-widget
  :group 'font-lock-extra-types)

(defconst csharp-font-lock-keywords-1 nil
  &quot;Subdued level highlighting for C# mode.&quot;)

(defconst csharp-font-lock-keywords-2 nil
  &quot;Medium level highlighting for C# mode.
See also `csharp-font-lock-extra-types'.&quot;)

(defconst csharp-font-lock-keywords-3 nil
  &quot;Gaudy level highlighting for C# mode.
See also `csharp-font-lock-extra-types'.&quot;)

(let* ((csharp-keywords
	(eval-when-compile
	  (regexp-opt
	   '(
	     &quot;break&quot; &quot;continue&quot; &quot;do&quot; &quot;else&quot; &quot;for&quot; &quot;if&quot; &quot;return&quot; &quot;switch&quot;
	     &quot;while&quot; &quot;catch&quot; &quot;new&quot; &quot;base&quot; &quot;this&quot; &quot;throw&quot; &quot;try&quot; &quot;finally&quot;
	     &quot;explicit&quot; &quot;implicit&quot;
	     &quot;const&quot; &quot;static&quot;
	     &quot;sizeof&quot; &quot;typeof&quot; &quot;checked&quot; &quot;unchecked&quot;
	     &quot;foreach&quot; &quot;lock&quot; &quot;fixed&quot;
;	     &quot;virtual&quot; &quot;override&quot; &quot;abstract&quot; &quot;extern&quot; &quot;internal&quot;
	     ) t)))
       (csharp-operators
	(eval-when-compile
	  (regexp-opt
	   '(&quot;+&quot; &quot;-&quot; &quot;*&quot; &quot;/&quot; &quot;%&quot; &quot;^&quot; &quot;&amp;&quot; &quot;|&quot; &quot;~&quot; &quot;!&quot; &quot;=&quot; &quot;&lt;&quot; &quot;&gt;&quot; &quot;+=&quot; &quot;-=&quot;
	     &quot;*=&quot; &quot;/=&quot; &quot;%=&quot; &quot;^=&quot; &quot;&amp;=&quot; &quot;|=&quot; &quot;&lt;&lt;&quot; &quot;&gt;&gt;&quot; &quot;&gt;&gt;=&quot; &quot;&lt;&lt;=&quot; &quot;==&quot; &quot;!=&quot;
	     &quot;&lt;=&quot; &quot;&gt;=&quot; &quot;&amp;&amp;&quot; &quot;||&quot; &quot;++&quot; &quot;--&quot;))))
       ;;
       ;; Classes immediately followed by an object name.
       (csharp-type-names
	`(mapconcat 'identity
	  (cons 
	   (,@ (eval-when-compile
		 (regexp-opt '(&quot;bool&quot; &quot;char&quot; &quot;byte&quot;
			       &quot;short&quot; &quot;int&quot; &quot;long&quot;
			       &quot;ushort&quot; &quot;uint&quot; &quot;ulong&quot; &quot;sbyte&quot;
			       &quot;float&quot; &quot;double&quot; &quot;void&quot;
			       &quot;enum&quot; &quot;string&quot; &quot;delegate&quot; &quot;object&quot;
			       ))))
	   csharp-font-lock-extra-types)
	  &quot;\\|&quot;))
       (csharp-type-names-depth `(regexp-opt-depth (,@ csharp-type-names)))
       ;;
       ;; These are eventually followed by an object name.
       (csharp-type-spec
	(eval-when-compile
	  (regexp-opt
	   '(
	     &quot;public&quot; &quot;private&quot; &quot;protected&quot; &quot;sealed&quot; &quot;internal&quot;
	     &quot;class&quot; &quot;namespace&quot; &quot;enum&quot;
	     &quot;interface&quot;
	     &quot;in&quot; &quot;out&quot; &quot;ref&quot;
	     &quot;virtual&quot; &quot;override&quot; &quot;abstract&quot; &quot;extern&quot; &quot;struct&quot; &quot;using&quot;
	     ))))
       (csharp-type-spec-depth
	(regexp-opt-depth csharp-type-spec))
       )
 (setq csharp-font-lock-keywords-1
  (list
   ;;
   ;; Fontify symbol names in #elif or #if ... defined preprocessor directives.
   '(&quot;^#[ \t]*\\(elif\\|if\\|endif\\)\\(\\sw+\\)?&quot;
      (1 font-lock-builtin-face) (3 font-lock-variable-name-face nil t))

   ;; Fontify class names.
   '(&quot;\\&lt;\\(class\\|interface\\)\\&gt;[ \t]*\\(\\sw+\\)?&quot;
     (1 font-lock-keyword-face) (2 font-lock-type-face nil t))
   )
  )

 (setq csharp-font-lock-keywords-2
  (append csharp-font-lock-keywords-1
   (list
    ;;
    ;; Fontify class names.
    `(eval .
      (cons (concat &quot;\\&lt;\\(&quot; (,@ csharp-type-names) &quot;\\)\\&gt;&quot;)
	    '(1 font-lock-type-face)
	    ))
    ;;
    ;; Fontify operator overloading.
    (list (concat &quot;\\&lt;&quot;
		  &quot;\\(\\(implicit\\|explicit\\)&quot;
		  &quot;[ \t]*operator\\)&quot;
		  &quot;\\&gt;[ \t]*&quot;
		  &quot;\\(&quot; csharp-operators &quot;\\)?&quot;)
	  '(1 font-lock-keyword-face)
	  '(2 font-lock-builtin-face nil t))
    ;;
    ;; Fontify all builtin keywords (except below).
    (concat &quot;\\&lt;\\(&quot; csharp-keywords &quot;\\|&quot; csharp-type-spec &quot;\\)\\&gt;&quot;)
    ;;
    ;; Fontify keywords and targets, and case default/goto tags.
    (list &quot;\\&lt;\\(break\\|case\\|continue\\|goto\\)\\&gt;[ \t]*\\(-?\\sw+\\)?&quot;
	  '(1 font-lock-keyword-face)
	  '(2 font-lock-constant-face nil t)
	  )
    ;;
    ;; This must come after the one for keywords and targets.
    '(&quot;:&quot; (&quot;^[ \t]*\\(\\sw+\\)[ \t]*:[ \t]*$&quot;
	   (beginning-of-line) (end-of-line)
	   (1 font-lock-constant-face)
	   ))
    ;;
    ;; Fontify all constants.
    '(&quot;\\&lt;\\(false\\|null\\|true\\)\\&gt;&quot; . font-lock-constant-face)
    )))

 (setq csharp-font-lock-keywords-3
  (append csharp-font-lock-keywords-2
   ;;
   ;; More complicated regexps for more complete highlighting for types.
   ;; (Note: Need to revisit the styling here.)
   (list
    ;;
    ;; Fontify random types immediately followed by an item or items.
    `(eval .
      (list (concat &quot;\\&lt;\\(&quot; (,@ csharp-type-names) &quot;\\)\\&gt;&quot;
		    &quot;\\([ \t]*\\[[ \t]*\\]\\)*&quot;
		    &quot;\\([ \t]*\\sw\\)&quot;)
	    ;; Fontify each declaration item.
	    (list 'font-lock-match-c-style-declaration-item-and-skip-to-next
		  ;; Start with point after all type specifiers.
		  (list 'goto-char (list 'or
					 (list 'match-beginning
					       (+ (,@ csharp-type-names-depth) 2))
					 '(match-end 1)))
		  ;; Finish with point after first type specifier.
		  '(goto-char (match-end 1))
		  ;; Fontify as a variable or function name.
		  '(1 (if (match-beginning 2)
			  font-lock-function-name-face
			font-lock-variable-name-face)))))
    ;;
    ;; Fontify structures, or typedef names, plus their items.
    '(&quot;\\(}\\)[ \t*]*\\sw&quot;
      (font-lock-match-c-style-declaration-item-and-skip-to-next
       (goto-char (match-end 1)) nil
       (1 font-lock-type-face)))
    ;;
    ;; Fontify anything at beginning of line as a declaration or definition.
    '(&quot;^\\(\\sw+\\)\\&gt;\\([ \t*]+\\sw+\\&gt;\\)*&quot;
      (1 font-lock-type-face)
      (font-lock-match-c-style-declaration-item-and-skip-to-next
       (goto-char (or (match-beginning 2) (match-end 1))) nil
       (1 (if (match-beginning 2)
	      font-lock-function-name-face
	    font-lock-variable-name-face))))
    )))
 )

(defvar csharp-font-lock-keywords csharp-font-lock-keywords-3
  &quot;Default expressions to highlight in C# mode.
See also `csharp-font-lock-extra-types'.&quot;)

(defvar cc-imenu-csharp-generic-expression
  cc-imenu-c++-generic-expression
  &quot;Imenu generic expression for C# mode.  See `imenu-generic-expression'.&quot;)

(c-add-style &quot;C#&quot;
 '(&quot;Java&quot;
   (c-basic-offset . 2)
   (c-comment-only-line-offset . (0 . 0))
   (c-offsets-alist 
    . (
       (c			. c-lineup-C-comments)
       (namespace-open		. 0)
       (namespace-close		. 0)
       (innamespace		. ++)
       (class-open		. +)
       (class-close		. +)
       (inclass			. 0)
       (inline-open		. ++)
       (defun-block-intro	. 0)
       (statement-block-intro	. 0)
       (topmost-intro-cont	. +)
       (statement-block-intro	. +)
       (substatement-open	. +)
       (label			. 0)
       (statement-case-open	. +)
       (statement-cont		. +)
       (arglist-intro		. +)
       (arglist-close		. +)
       (access-label		. 0)
       (inher-cont		. c-lineup-multi-inher)
       ))
   ))


;;;###autoload
(defun csharp-mode ()
  &quot;Major mode for editing C# code.
To submit a problem report, enter `\\[c-submit-bug-report]' from a
csharp-mode buffer.  This automatically sets up a mail buffer with
version information already added.  You just need to add a description
of the problem, including a reproducible test case and send the
message.

To see what version of CC Mode you are running, enter `\\[c-version]'.

The hook variable `csharp-mode-hook' is run with no args, if that value
is bound and has a non-nil value.  Also the common hook
`c-mode-common-hook' is run first.  Note that this mode automatically
sets the \&quot;C#\&quot; style before calling any hooks so be careful if you
set styles in `c-mode-common-hook'.

Key bindings:
\\{csharp-mode-map}&quot;
  (interactive)
  (c-initialize-cc-mode)
  (kill-all-local-variables)
  (set-syntax-table csharp-mode-syntax-table)
  (setq major-mode 'csharp-mode
 	mode-name &quot;C#&quot;
 	local-abbrev-table csharp-mode-abbrev-table)
  (use-local-map csharp-mode-map)
  (c-common-init)
  (setq comment-start &quot;// &quot;
 	comment-end   &quot;&quot;
 	c-conditional-key c-Csharp-conditional-key
 	c-comment-start-regexp c-C++-comment-start-regexp
  	c-class-key c-Csharp-class-key
	c-extra-toplevel-key c-Csharp-extra-toplevel-key
	c-method-key c-Csharp-method-key
 	c-baseclass-key nil
	c-recognize-knr-p nil
 	c-access-key  c-Csharp-access-key
	c-inexpr-class-key nil
	imenu-generic-expression cc-imenu-csharp-generic-expression
	imenu-case-fold-search nil
	)
  ;; Font lock
  (make-local-variable 'font-lock-defaults)
  (setq font-lock-defaults
	'((csharp-font-lock-keywords csharp-font-lock-keywords-1
				     csharp-font-lock-keywords-2 csharp-font-lock-keywords-3)
	  nil nil ((?_ . &quot;w&quot;) (?$ . &quot;w&quot;)) nil
	  (font-lock-mark-block-function . mark-defun)))
  ;; hocks
  (run-hooks 'c-mode-common-hook)
  (run-hooks 'csharp-mode-hook)
  (c-update-modeline))

;;; csharp-mode.el ends here

--=-=-=
Content-Disposition: attachment
Content-Description: Diff to doc

Index: contributing
===================================================================
RCS file: /mono/mono/doc/contributing,v
retrieving revision 1.24
diff -u -b -B -r1.24 contributing
--- contributing	25 Apr 2002 11:01:55 -0000	1.24
+++ contributing	31 May 2002 18:02:15 -0000
@@ -107,8 +107,11 @@
 
 * Emacs support
 
-	Brad Merryl's C# mode for Emacs is available: &lt;a
+	Brad Merrill's C# mode for Emacs is available: &lt;a
 	href=&quot;<A HREF="http://www.cybercom.net/~zbrad/DotNet/Emacs/"">http://www.cybercom.net/~zbrad/DotNet/Emacs/&quot;</A>&gt;<A HREF="http://www.cybercom.net/~zbrad/DotNet/Emacs/</a">http://www.cybercom.net/~zbrad/DotNet/Emacs/&lt;/a</A>&gt;
+
+	Dennis Haney's C# mode for Emacs (based on Brad's) is available: &lt;a
+	href=&quot;<A HREF="http://www.davh.dk/script/"">http://www.davh.dk/script/&quot;</A>&gt;<A HREF="http://www.davh.dk/script/</a">http://www.davh.dk/script/&lt;/a</A>&gt;
 
 * Books on C# and DotNet.
 

--=-=-=--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="006178.html">[Mono-list] Broken mono build
</A></li>
	<LI> Next message: <A HREF="006179.html">[Mono-list] mbas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6182">[ date ]</a>
              <a href="thread.html#6182">[ thread ]</a>
              <a href="subject.html#6182">[ subject ]</a>
              <a href="author.html#6182">[ author ]</a>
         </LI>
       </UL>
</body></html>
