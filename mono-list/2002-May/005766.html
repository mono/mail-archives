<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Patch for TcpClient/TcpListener
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jarek%40atm.com.pl">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005839.html">
   <LINK REL="Next"  HREF="005769.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Patch for TcpClient/TcpListener
   </H1>
    <B>Jaroslaw Kowalski
    </B> 
    <A HREF="mailto:jarek%40atm.com.pl"
       TITLE="[Mono-list] Patch for TcpClient/TcpListener">jarek@atm.com.pl
       </A><BR>
    <I>Fri, 17 May 2002 08:23:39 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="005839.html">[Mono-list] ConvertTest reveals runtime bug
</A></li>
        <LI> Next message: <A HREF="005769.html">[Mono-list] Patch for TcpClient/TcpListener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5766">[ date ]</a>
              <a href="thread.html#5766">[ thread ]</a>
              <a href="subject.html#5766">[ subject ]</a>
              <a href="author.html#5766">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_0007_01C1FD7C.25BB79E0
Content-Type: text/plain;
	charset=&quot;iso-8859-2&quot;
Content-Transfer-Encoding: 7bit

There's a problem with the TcpClient object returned from
TcpListener.AcceptTcpClient.
When you attempted to call GetStream() on the result you'd get null instead
of the correct NetworkStream object.

Attached is the patch for it. It modifies internal void SetTcpClient() to
correctly initialize &quot;stream&quot; member.
ChangeLog is also included.

Can you add it to CVS?

Jarek

------=_NextPart_000_0007_01C1FD7C.25BB79E0
Content-Type: text/plain;
	name=&quot;patch0.txt&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;patch0.txt&quot;

Index: ChangeLog=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /mono/mcs/class/System/System.Net.Sockets/ChangeLog,v=0A=
retrieving revision 1.8=0A=
diff -u -r1.8 ChangeLog=0A=
--- ChangeLog	24 Apr 2002 08:39:24 -0000	1.8=0A=
+++ ChangeLog	17 May 2002 06:21:06 -0000=0A=
@@ -1,3 +1,8 @@=0A=
+2002-05-17  Jaroslaw Kowalski &lt;<A HREF="mailto:jarek@atm.com.pl">jarek@atm.com.pl</A>&gt;=0A=
+	* TcpClient.cs: fixed SetTcpClient so that=0A=
+	TcpListener.AcceptTcpClient works and allows=0A=
+	you to call GetStream() on its result=0A=
+=0A=
 2002-04-24  Dick Porter  &lt;<A HREF="mailto:dick@ximian.com">dick@ximian.com</A>&gt;=0A=
 =0A=
 	* Socket.cs (Poll): Give correct argument to Select(), as spotted=0A=
Index: TcpClient.cs=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /mono/mcs/class/System/System.Net.Sockets/TcpClient.cs,v=0A=
retrieving revision 1.3=0A=
diff -u -r1.3 TcpClient.cs=0A=
--- TcpClient.cs	6 Jan 2002 10:58:38 -0000	1.3=0A=
+++ TcpClient.cs	17 May 2002 06:21:06 -0000=0A=
@@ -92,7 +92,7 @@=0A=
 		protected Socket Client=0A=
 		{=0A=
 			get { return client; }=0A=
-			set { client =3D value; } //TODO: should we be able to set the =
socket like this?=0A=
+			set { client =3D value; }=0A=
 		}=0A=
 =0A=
 		/// &lt;summary&gt;=0A=
@@ -103,7 +103,8 @@=0A=
 		/// &lt;param name=3D&quot;s&quot;&gt;&lt;/param&gt;=0A=
 		internal void SetTcpClient (Socket s) =0A=
 		{=0A=
-			Client =3D s; // client or Client?  They are the same at the moment=0A=
+			client =3D s;=0A=
+			stream =3D new NetworkStream(client, true);=0A=
 		}=0A=
 		=0A=
 		/// &lt;summary&gt;=0A=

------=_NextPart_000_0007_01C1FD7C.25BB79E0--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005839.html">[Mono-list] ConvertTest reveals runtime bug
</A></li>
	<LI> Next message: <A HREF="005769.html">[Mono-list] Patch for TcpClient/TcpListener
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5766">[ date ]</a>
              <a href="thread.html#5766">[ thread ]</a>
              <a href="subject.html#5766">[ subject ]</a>
              <a href="author.html#5766">[ author ]</a>
         </LI>
       </UL>
</body></html>
