<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Some patches regarding Win32Exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jarek%40atm.com.pl">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005723.html">
   <LINK REL="Next"  HREF="005732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Some patches regarding Win32Exception
   </H1>
    <B>Jaroslaw Kowalski
    </B> 
    <A HREF="mailto:jarek%40atm.com.pl"
       TITLE="[Mono-list] Some patches regarding Win32Exception">jarek@atm.com.pl
       </A><BR>
    <I>Tue, 14 May 2002 08:45:37 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="005723.html">[Mono-list] pnetmark: bug in mono?
</A></li>
        <LI> Next message: <A HREF="005732.html">[Mono-list] Some patches regarding Win32Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5721">[ date ]</a>
              <a href="thread.html#5721">[ thread ]</a>
              <a href="subject.html#5721">[ subject ]</a>
              <a href="author.html#5721">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_000B_01C1FB23.B8186C40
Content-Type: multipart/alternative;
	boundary=&quot;----=_NextPart_001_000C_01C1FB23.B8186C40&quot;


------=_NextPart_001_000C_01C1FB23.B8186C40
Content-Type: text/plain;
	charset=&quot;iso-8859-2&quot;
Content-Transfer-Encoding: quoted-printable

Hi!

I'd like to contribute some error descriptions for =
System.ComponentModel.Win32Exception.cs
(included in patch1.txt)

I'd also like to contribute a small PERL utility =
&quot;update_win32_errors.pl&quot; that, when executed at the top level of source =
code (which is below mono and mcs and gtk-sharp) will scan through all =
&quot;*.c&quot; source files in mono looking for WSASetLastError(...) and =
SetLastError(...) calls and for all errors that are not handled in =
Win32Exception.cs it will generate the appropriate source code to =
stdout.

The code needs to be pasted into Win32Exception.cs and error codes need =
to be replaced with their descriptions.

I'm also sending a patch to sockets.c to check for bind() EADDRINUSE =
error (Address already in use, perhaps the most common bind() error) =
(patch2.txt)

BTW. I'm not sure if all error texts should be in &quot;Win32Exception.cs&quot; =
instead of &quot;SocketException.cs&quot;, but it's very easy to fix.

Regards,

Jarek

------=_NextPart_001_000C_01C1FB23.B8186C40
Content-Type: text/html;
	charset=&quot;iso-8859-2&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META http-equiv=3DContent-Type content=3D&quot;text/html; =
charset=3Diso-8859-2&quot;&gt;
&lt;META content=3D&quot;MSHTML 6.00.2600.0&quot; name=3DGENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=3D#ffffff&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;Hi!&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;I'd like to contribute some error =
descriptions for=20
System.ComponentModel.Win32Exception.cs&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;(included in patch1.txt)&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;I'd also like to contribute a small =
PERL utility=20
&quot;update_win32_errors.pl&quot; that, when executed at the top level of source =
code=20
&lt;/FONT&gt;&lt;FONT face=3DArial size=3D2&gt;(which is below mono and mcs and =
gtk-sharp) will=20
scan through all &quot;*.c&quot; source files in mono looking for =
WSASetLastError(...) and=20
SetLastError(...) calls and for all errors that are not handled in=20
Win32Exception.cs it will generate the appropriate source code to=20
stdout.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;The code needs to be pasted into =
Win32Exception.cs=20
and error codes need to be replaced with their =
descriptions.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;I'm also sending a patch to sockets.c =
to&amp;nbsp;check=20
for&amp;nbsp;bind() EADDRINUSE error (Address already in use, perhaps the =
most=20
common bind() error) (patch2.txt)&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;BTW. I'm not sure if all error texts =
should be in=20
&quot;Win32Exception.cs&quot; instead of&amp;nbsp;&quot;SocketException.cs&quot;, but it's very =
easy to=20
fix.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;Regards,&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;Jarek&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;

------=_NextPart_001_000C_01C1FB23.B8186C40--

------=_NextPart_000_000B_01C1FB23.B8186C40
Content-Type: text/plain;
	name=&quot;patch1.txt&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;patch1.txt&quot;

Index: Win32Exception.cs=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: =
/mono/mcs/class/System/System.ComponentModel/Win32Exception.cs,v=0A=
retrieving revision 1.3=0A=
diff -u -r1.3 Win32Exception.cs=0A=
--- Win32Exception.cs	27 Apr 2002 18:52:58 -0000	1.3=0A=
+++ Win32Exception.cs	14 May 2002 06:28:49 -0000=0A=
@@ -72,6 +72,37 @@=0A=
 				       Locale.GetText(&quot;proto no supported&quot;));=0A=
 			w32_errors.Add(10044,=0A=
 				       Locale.GetText(&quot;socket not supproted&quot;));=0A=
+			w32_errors.Add(10004,=0A=
+			    Locale.GetText(&quot;interrupted&quot;));=0A=
+=0A=
+			w32_errors.Add(10013,=0A=
+			    Locale.GetText(&quot;Access denied&quot;));=0A=
+			w32_errors.Add(11002,=0A=
+			    Locale.GetText(&quot;A temporary error occurred on an  authoritative  =
name  server. Try  again later.&quot;));=0A=
+			w32_errors.Add(10022,=0A=
+			    Locale.GetText(&quot;Invalid arguments&quot;));=0A=
+			w32_errors.Add(10050,=0A=
+			    Locale.GetText(&quot;Network subsystem is down&quot;));=0A=
+			w32_errors.Add(10051,=0A=
+			    Locale.GetText(&quot;Network is unreachable&quot;));=0A=
+			w32_errors.Add(10061,=0A=
+			    Locale.GetText(&quot;Connection refused&quot;));=0A=
+			w32_errors.Add(10045,=0A=
+			    Locale.GetText(&quot;Operation not supported&quot;));=0A=
+			w32_errors.Add(10038,=0A=
+			    Locale.GetText(&quot;The descriptor is not a socket&quot;));=0A=
+			w32_errors.Add(10055,=0A=
+			    Locale.GetText(&quot;Not enough buffer space is available&quot;));=0A=
+			w32_errors.Add(10056,=0A=
+			    Locale.GetText(&quot;Socket is already connected&quot;));=0A=
+			w32_errors.Add(10048,=0A=
+			    Locale.GetText(&quot;Address already in use&quot;));=0A=
+			w32_errors.Add(10057,=0A=
+			    Locale.GetText(&quot;The socket is not connected&quot;));=0A=
+			w32_errors.Add(10058,=0A=
+			    Locale.GetText(&quot;The socket has been shut down&quot;));=0A=
+			w32_errors.Add(10093,=0A=
+			    Locale.GetText(&quot;Winsock not initialized&quot;));=0A=
 		}=0A=
 =0A=
 		private static string W32ErrorMessage(int error_code) {=0A=

------=_NextPart_000_000B_01C1FB23.B8186C40
Content-Type: application/x-perl;
	name=&quot;update_win32_errors.pl&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;update_win32_errors.pl&quot;

#!/usr/bin/perl=0A=
$WIN32_EXCEPTION_CS=3D&quot;mcs/class/System/System.ComponentModel/Win32Except=
ion.cs&quot;;=0A=
$MONO_IO_ERROR=3D&quot;mcs/class/corlib/System.IO/MonoIOError.cs&quot;;=0A=
$MONO_SRC_DIR=3D&quot;mono&quot;;=0A=
=0A=
open(IN, &quot;&lt;$MONO_IO_ERROR&quot;);=0A=
while (&lt;IN&gt;)=0A=
{=0A=
    if (m/\s+([A-Z]\S+)\s+\=3D\s+(\d+)/)=0A=
    {=0A=
        my $id =3D $1;=0A=
        my $val =3D $2;=0A=
=0A=
        $id2value{$id} =3D $val;=0A=
        $value2id{$val} =3D $id;=0A=
    };=0A=
};=0A=
close(IN);=0A=
=0A=
$command =3D &quot;grep SetLastError `find $MONO_SRC_DIR -name \'*.c\' =
-print`&quot;;=0A=
@files =3D `$command`;=0A=
=0A=
for (@files)=0A=
{=0A=
    if (m/SetLastError\(([A-Z].*?)\)/)=0A=
    {=0A=
        my $id =3D $1;=0A=
        my $val =3D $id2value{$id} || die &quot;Symbol $id not defined in =
$MONO_IO_ERROR&quot;;=0A=
=0A=
        $used_id{$id} =3D 1;=0A=
        $used_val{$val} =3D 1;=0A=
    };=0A=
};=0A=
=0A=
open(IN, &quot;&lt;$WIN32_EXCEPTION_CS&quot;);=0A=
while (&lt;IN&gt;)=0A=
{=0A=
    if (m/w32_errors\.Add\((\d+),/)=0A=
    {=0A=
        my $err =3D $1;=0A=
=0A=
        $already_added{$err} =3D 1;=0A=
    };=0A=
};=0A=
close(IN);=0A=
=0A=
for $val (keys %used_val)=0A=
{=0A=
    if (!$already_added{$val})=0A=
    {=0A=
#        print &quot;val: $val &quot; . $value2id{$val} . &quot;\n&quot;;=0A=
         $id =3D $value2id{$val};=0A=
=0A=
print qq!\t\t\tw32_errors.Add($val,\n!;=0A=
print qq!\t\t\t    Locale.GetText(&quot;$id&quot;));\n!;=0A=
    };=0A=
};
------=_NextPart_000_000B_01C1FB23.B8186C40
Content-Type: text/plain;
	name=&quot;patch2.txt&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;patch2.txt&quot;

Index: sockets.c=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /mono/mono/mono/io-layer/sockets.c,v=0A=
retrieving revision 1.10=0A=
diff -u -r1.10 sockets.c=0A=
--- sockets.c	9 May 2002 13:10:18 -0000	1.10=0A=
+++ sockets.c	14 May 2002 06:36:11 -0000=0A=
@@ -348,6 +348,11 @@=0A=
 		case EFAULT:=0A=
 			WSASetLastError(WSAEFAULT);=0A=
 			break;=0A=
+	=0A=
+		case EADDRINUSE:=0A=
+			WSASetLastError(WSAEADDRINUSE);=0A=
+			break;=0A=
+=0A=
 		case EROFS:=0A=
 		case ENAMETOOLONG:=0A=
 		case ENOENT:=0A=

------=_NextPart_000_000B_01C1FB23.B8186C40--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005723.html">[Mono-list] pnetmark: bug in mono?
</A></li>
	<LI> Next message: <A HREF="005732.html">[Mono-list] Some patches regarding Win32Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5721">[ date ]</a>
              <a href="thread.html#5721">[ thread ]</a>
              <a href="subject.html#5721">[ subject ]</a>
              <a href="author.html#5721">[ author ]</a>
         </LI>
       </UL>
</body></html>
