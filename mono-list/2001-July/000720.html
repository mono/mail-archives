<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] PInvoke Conventions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tomasr%40mvps.org">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000718.html">
   <LINK REL="Next"  HREF="000727.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] PInvoke Conventions
   </H1>
    <B>Tomas Restrepo
    </B> 
    <A HREF="mailto:tomasr%40mvps.org"
       TITLE="[Mono-list] PInvoke Conventions">tomasr@mvps.org
       </A><BR>
    <I>Wed, 18 Jul 2001 19:28:25 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="000718.html">[Mono-list] PInvoke Conventions
</A></li>
        <LI> Next message: <A HREF="000727.html">[Mono-list] PInvoke Conventions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#720">[ date ]</a>
              <a href="thread.html#720">[ thread ]</a>
              <a href="subject.html#720">[ subject ]</a>
              <a href="author.html#720">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Rhys,

&gt;<i> It may not be necessary to add an extra attribute either.  The
</I>&gt;<i> CLR spec already has a way to specify that a class has &quot;explicit
</I>&gt;<i> layout&quot;.  Right now, it assumes that the programmer will provide
</I>&gt;<i> the offsets of the fields and the packing details to use for the
</I>&gt;<i> class.
</I>
That's correct. Personally, I don't see much need to overload it. But that
aside, I don't see the problem of dealing with native sized values as such a
big deal. While nor the ECMA, nor MS say it a lot, using P/Invoke does, in
more ways than one, leave platform independence out of the question.
Besides, even if you do support it, I don't see that as such a big
improvement, since in the case you cite with structs and other cases, using
native types for integral types in interop still leaves you with the  big
trouble of what to do if the underlying native type is larger than the
declared one in C# (i.e. the struct has int, but you use a 64-bit value
underneath). What do you do if you have to marshal both ways? This is being
discussed elsewhere on this thread, I know, but either possibility is going
to bring it's own set of problems, and worse, it's own set of unexpected
side effects, causing developers pretty ugly to debug cases (which is
already a problem in P/Invoke).


&gt;<i> Sam, perhaps it could be adjusted slightly to say &quot;if the
</I>&gt;<i> class is marked explicit, but no explicit information is supplied,
</I>&gt;<i> then use the platform-specific conventions&quot;.
</I>
Isn't that what SequentialLayout means, anyway? The ECMA spec doesn't say it
out loud, but I presume it is expected to use the default packing in that
case. If, instead it implies a packing of 1, then one could suggest the
attribute is extended to support an argument telling it what packing to use,
which seems clearer that using explicit in this case (at least to me).

--
Tomas Restrepo
<A HREF="mailto:tomasr@mvps.org">tomasr@mvps.org</A>





</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000718.html">[Mono-list] PInvoke Conventions
</A></li>
	<LI> Next message: <A HREF="000727.html">[Mono-list] PInvoke Conventions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#720">[ date ]</a>
              <a href="thread.html#720">[ thread ]</a>
              <a href="subject.html#720">[ subject ]</a>
              <a href="author.html#720">[ author ]</a>
         </LI>
       </UL>
</body></html>
