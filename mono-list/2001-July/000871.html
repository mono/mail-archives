<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] JVM performance: JVM as a basis for CLR
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:kunle.odutola%40virgin.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000896.html">
   <LINK REL="Next"  HREF="000874.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] JVM performance: JVM as a basis for CLR
   </H1>
    <B>Kunle Odutola
    </B> 
    <A HREF="mailto:kunle.odutola%40virgin.net"
       TITLE="[Mono-list] JVM performance: JVM as a basis for CLR">kunle.odutola@virgin.net
       </A><BR>
    <I>Sun, 22 Jul 2001 16:59:49 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="000896.html">[Mono-list] JVM performance: JVM as a basis for CLR
</A></li>
        <LI> Next message: <A HREF="000874.html">[Mono-list] JVM performance: JVM as a basis for CLR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#871">[ date ]</a>
              <a href="thread.html#871">[ thread ]</a>
              <a href="subject.html#871">[ subject ]</a>
              <a href="author.html#871">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Interesting figures. I get very different results as you can see below (I'll
post figures for the fib test too in a mo'):

JAVA
=====

D:\Temp\bmark&gt;java  -showversion convj
java version &quot;1.3.0&quot;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.3.0-C)
Java HotSpot(TM) Client VM (build 1.3.0-C, mixed mode)

starting
convolve=75.88665 took 13.359
convolve=80.14561 took 13.56

.NET
=====

D:\Temp\bmark&gt;csc /o /unsafe+ /checked- convj.cs
Microsoft (R) Visual C# Compiler Version 7.00.9254 [CLR version v1.0.2914]
Copyright (C) Microsoft Corp 2000-2001. All rights reserved.


D:\Temp\bmark&gt;convj
starting
convolve=75.88665 took 00:00:03.1445216
convolve=80.14561 took 00:00:03.1144784


I was a bit puzzled by the difference to say the least, so I compiled it
again with no switches.

D:\Temp\bmark&gt;csc convj.cs
Microsoft (R) Visual C# Compiler Version 7.00.9254 [CLR version v1.0.2914]
Copyright (C) Microsoft Corp 2000-2001. All rights reserved.


D:\Temp\bmark&gt;convj
starting
convolve=75.88665 took 00:00:03.5551120
convolve=80.14561 took 00:00:03.3347952

D:\Temp\bmark&gt;convj
starting
convolve=75.88665 took 00:00:03.3347952
convolve=80.14561 took 00:00:03.3247808


I used the .java file as supplied but did a conversion of the C# file
myself. The results of running with your C# source file is:
D:\Temp\bmark&gt;csc /o /unsafe+ /checked- convj.cs
Microsoft (R) Visual C# Compiler Version 7.00.9254 [CLR version v1.0.2914]
Copyright (C) Microsoft Corp 2000-2001. All rights reserved.


D:\Temp\bmark&gt;convj
starting
convolve=75.88665 took 00:00:04.9871712
convolve=80.14561 took 00:00:04.9671424

D:\Temp\bmark&gt;convj
starting
convolve=75.88665 took 00:00:04.9771568
convolve=80.14561 took 00:00:05.0072000



This is my conversion as used in the re-test:



------------- BEGIN
convj.cs ------------------------------------------------------------
public class convj
{
    public static double rseed = 0.198095803940820482309384;

    public static double random()
    {
    	rseed = rseed * 9.2935802938408293480923 + 1.203985032850982902384;
		while(rseed&gt;1.0)
			rseed -= 1.0;
		return rseed;
    }

    public static void fill_random(float[] outval)
    {
		for(int i=0;i&lt;outval.Length;i++)
			outval[i] = (float)random();
    }

    public static void convolve(float[] outval, float[] inval, float[] mask)
    {
    	for(int i=0,n=inval.Length;i&lt;n;i++)
    	{
	    	double total = 0.0;
	    	for(int j=0,m=mask.Length;j&lt;m;j++)
	    	{
				int index = j-m/2;
				index = index&lt;0?0:index&gt;=m?m-1:index;
				float value = inval[index];
				total += value * mask[j];
	    	}
	    	outval[i] = (float)total;
		}
    }

    public static void Main(string[] args)
    {
		System.Console.WriteLine(&quot;starting&quot;);
		float[] outval = new float[65536];
		float[] inval = new float[65536];
		float[] mask = new float[256];
		for(int iter=0;iter&lt;2;iter++)
		{
	    	long start = System.DateTime.Now.Ticks;
	    	for(int i=0;i&lt;10;i++)
	    	{
				fill_random(inval);
				fill_random(mask);
				convolve(outval,inval,mask);
	    	}
	    System.TimeSpan span = new
System.TimeSpan(System.DateTime.Now.Ticks-start);
	    System.Console.WriteLine(&quot;convolve=&quot;+outval[0]+&quot; took &quot;+span);
		}
    }
}
------------- END
  convj.cs ------------------------------------------------------------

Cheers,

Kunle


&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A> [mailto:<A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A>]On
</I>&gt;<i> Behalf Of Tom
</I>&gt;<i> Sent: 22 July 2001 01:18
</I>&gt;<i> To: <A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>
</I>&gt;<i> Subject: [Mono-list] JVM performance: JVM as a basis for CLR
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Given that there have been lots of arguments against
</I>&gt;<i> basing a Mono runtime (CLI/CLR) on a JVM based on
</I>&gt;<i> performance, I was curious to see how well Microsoft's
</I>&gt;<i> CRL compares to Java VMs in terms of performance.  So,
</I>&gt;<i> without claiming that these are anywhere near complete
</I>&gt;<i> benchmarks, I tested two simple cases: &quot;fib&quot; and
</I>&gt;<i> &quot;convolution&quot;.
</I>&gt;<i>
</I>&gt;<i> On the &quot;fib&quot; benchmark (mostly function calls), CLR
</I>&gt;<i> performs considerably worse than Sun's JVM.  On the
</I>&gt;<i> convolution benchmark, they perform about the same.  I
</I>&gt;<i> gave the CLR the benefit of the doubt and compiled
</I>&gt;<i> with &quot;/unsafe+ /checked-&quot;.  Based on these little
</I>&gt;<i> benchmarks, I see no performance advantage to CLR.
</I>&gt;<i> This seems in agreement with other recent comparisons
</I>&gt;<i> of CLR and JVM.  I have yet to see any reproducible
</I>&gt;<i> evidence that the CLR actually performs significantly
</I>&gt;<i> better on any task; if you know of any (including
</I>&gt;<i> source code), I'd like to know about it.
</I>&gt;<i>
</I>&gt;<i> What does this mean?  I don't want to bring up the
</I>&gt;<i> issue of creating a Java foundation for Gnome, since
</I>&gt;<i> that's not where the project is going.  But I think it
</I>&gt;<i> suggests again that starting with a JVM implementation
</I>&gt;<i> may lead to a high quality CLR implementation much
</I>&gt;<i> faster than starting from scratch.  And starting with
</I>&gt;<i> a JVM may also make it easy to provide CLR and JVM
</I>&gt;<i> support in the same runtime from the start.  I think
</I>&gt;<i> that would be a really great contribution, and it
</I>&gt;<i> would allow the open source community to hedge its
</I>&gt;<i> bets on the C#-vs.-Java issue.
</I>&gt;<i>
</I>&gt;<i> As people have pointed out, Intel's ORP
</I>&gt;<i> (<A HREF="http://orp.sourceforge.net/">http://orp.sourceforge.net/</A>) indeed has a non-trivial
</I>&gt;<i> optimizing JIT.  OpenJIT (<A HREF="http://www.openjit.org/">http://www.openjit.org/</A>) may
</I>&gt;<i> also be worth a look.  I'm going to take a look and
</I>&gt;<i> see how they compare performance-wise to Sun's JDK
</I>&gt;<i> (this is a little easier since programs don't need to
</I>&gt;<i> be ported from one to the other).
</I>&gt;<i>
</I>&gt;<i> Tom.
</I>&gt;<i>
</I>&gt;<i> Here is the output from the benchmarks (this uses
</I>&gt;<i> JDK1.4beta, but JDK1.3 gives the same results):
</I>&gt;<i>
</I>&gt;<i> + javac fibj.java
</I>&gt;<i> + java -server -showversion fibj
</I>&gt;<i> java version &quot;1.4.0-beta&quot;
</I>&gt;<i> Java(TM) 2 Runtime Environment, Standard Edition
</I>&gt;<i> (build 1.4.0-beta-b65)
</I>&gt;<i> Java HotSpot(TM) Server VM (build 1.4.0-beta-b65,
</I>&gt;<i> mixed mode)
</I>&gt;<i> starting
</I>&gt;<i> fib(40)=165580141 took 12.63
</I>&gt;<i> fib(40)=165580141 took 12.530000000000001
</I>&gt;<i>
</I>&gt;<i> + csc /o /unsafe+ /checked- fibs.cs
</I>&gt;<i> Microsoft (R) Visual C# Compiler Version 7.00.9254
</I>&gt;<i> [CLR version v1.0.2914]
</I>&gt;<i> Copyright (C) Microsoft Corp 2000-2001. All rights
</I>&gt;<i> reserved.
</I>&gt;<i>
</I>&gt;<i> + ./fibs.exe
</I>&gt;<i> starting
</I>&gt;<i> fib(40)=165580141 took 00:00:17.3000000
</I>&gt;<i> fib(40)=165580141 took 00:00:17.2500000
</I>&gt;<i> + javac convj.java
</I>&gt;<i> + java -server -showversion convj
</I>&gt;<i> java version &quot;1.4.0-beta&quot;
</I>&gt;<i> Java(TM) 2 Runtime Environment, Standard Edition
</I>&gt;<i> (build 1.4.0-beta-b65)
</I>&gt;<i> Java HotSpot(TM) Server VM (build 1.4.0-beta-b65,
</I>&gt;<i> mixed mode)
</I>&gt;<i> starting
</I>&gt;<i> convolve=75.88665 took 13.67
</I>&gt;<i> convolve=80.14561 took 13.68
</I>&gt;<i>
</I>&gt;<i> + csc /o /unsafe+ /checked- convs.cs
</I>&gt;<i> Microsoft (R) Visual C# Compiler Version 7.00.9254
</I>&gt;<i> [CLR version v1.0.2914]
</I>&gt;<i> Copyright (C) Microsoft Corp 2000-2001. All rights
</I>&gt;<i> reserved.
</I>&gt;<i>
</I>&gt;<i> + ./convs.exe
</I>&gt;<i> starting
</I>&gt;<i> convolve=75.88665 took 00:00:12.3500000
</I>&gt;<i> convolve=80.14561 took 00:00:12.3000000
</I>&gt;<i>
</I>&gt;<i> Here is the source code:
</I>&gt;<i>
</I>&gt;<i> === convj.java ===
</I>&gt;<i> public class convj {
</I>&gt;<i>     public static double rseed =
</I>&gt;<i> 0.198095803940820482309384;
</I>&gt;<i>     public static double random() {
</I>&gt;<i> 	rseed = rseed * 9.2935802938408293480923 +
</I>&gt;<i> 1.203985032850982902384;
</I>&gt;<i> 	while(rseed&gt;1.0) rseed -= 1.0;
</I>&gt;<i> 	return rseed;
</I>&gt;<i>     }
</I>&gt;<i>     public static void fill_random(float[] out) {
</I>&gt;<i> 	for(int i=0;i&lt;out.length;i++) out[i] =
</I>&gt;<i> (float)random();
</I>&gt;<i>     }
</I>&gt;<i>     public static void convolve(float[] out,float[]
</I>&gt;<i> in,float[] mask) {
</I>&gt;<i> 	for(int i=0,n=in.length;i&lt;n;i++) {
</I>&gt;<i> 	    double total = 0.0;
</I>&gt;<i> 	    for(int j=0,m=mask.length;j&lt;m;j++) {
</I>&gt;<i> 		int index = j-m/2;
</I>&gt;<i> 		index = index&lt;0?0:index&gt;=m?m-1:index;
</I>&gt;<i> 		float value = in[index];
</I>&gt;<i> 		total += value * mask[j];
</I>&gt;<i> 	    }
</I>&gt;<i> 	    out[i] = (float)total;
</I>&gt;<i> 	}
</I>&gt;<i>     }
</I>&gt;<i>     public static void main(String args[]) {
</I>&gt;<i> 	System.err.println(&quot;starting&quot;);
</I>&gt;<i> 	float[] out = new float[65536];
</I>&gt;<i> 	float[] in = new float[65536];
</I>&gt;<i> 	float[] mask = new float[256];
</I>&gt;<i> 	for(int iter=0;iter&lt;2;iter++) {
</I>&gt;<i> 	    long start = System.currentTimeMillis();
</I>&gt;<i> 	    for(int i=0;i&lt;10;i++) {
</I>&gt;<i> 		fill_random(in);
</I>&gt;<i> 		fill_random(mask);
</I>&gt;<i> 		convolve(out,in,mask);
</I>&gt;<i> 	    }
</I>&gt;<i> 	    double delta = 1e-3 *
</I>&gt;<i> (System.currentTimeMillis()-start);
</I>&gt;<i> 	    System.out.println(&quot;convolve=&quot;+out[0]+&quot; took
</I>&gt;<i> &quot;+delta);
</I>&gt;<i> 	}
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> === fibj.java ===
</I>&gt;<i> public class fibj {
</I>&gt;<i>     public static int fib(int i) {
</I>&gt;<i> 	if(i&lt;2) return 1;
</I>&gt;<i> 	return fib(i-1)+fib(i-2);
</I>&gt;<i>     }
</I>&gt;<i>     public static void main(String args[]) {
</I>&gt;<i> 	System.err.println(&quot;starting&quot;);
</I>&gt;<i> 	for(int iter=0;iter&lt;2;iter++) {
</I>&gt;<i> 	    int i = 40;
</I>&gt;<i> 	    long start = System.currentTimeMillis();
</I>&gt;<i> 	    int result = fib(i);
</I>&gt;<i> 	    double delta = 1e-3 *
</I>&gt;<i> (System.currentTimeMillis()-start);
</I>&gt;<i> 	    System.out.println(&quot;fib(&quot;+i+&quot;)=&quot;+result+&quot; took
</I>&gt;<i> &quot;+delta);
</I>&gt;<i> 	}
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> === convs.cs ===
</I>&gt;<i> using System;
</I>&gt;<i>
</I>&gt;<i> class App {
</I>&gt;<i>     public static double rseed =
</I>&gt;<i> 0.198095803940820482309384;
</I>&gt;<i>     public static double random() {
</I>&gt;<i> 	rseed = rseed * 9.2935802938408293480923 +
</I>&gt;<i> 1.203985032850982902384;
</I>&gt;<i> 	while(rseed&gt;1.0) rseed -= 1.0;
</I>&gt;<i> 	return rseed;
</I>&gt;<i>     }
</I>&gt;<i>     public static void fill_random(float[] outv) {
</I>&gt;<i> 	for(int i=0;i&lt;outv.Length;i++) outv[i] =
</I>&gt;<i> (float)random();
</I>&gt;<i>     }
</I>&gt;<i>     public static void convolve(float[] outv,float[]
</I>&gt;<i> inv,float[] mask) {
</I>&gt;<i> 	for(int i=0,n=inv.Length;i&lt;n;i++) {
</I>&gt;<i> 	    double total = 0.0;
</I>&gt;<i> 	    for(int j=0,m=mask.Length;j&lt;m;j++) {
</I>&gt;<i> 		int index = j-m/2;
</I>&gt;<i> 		index = index&lt;0?0:index&gt;=m?m-1:index;
</I>&gt;<i> 		float value = inv[index];
</I>&gt;<i> 		total += value * mask[j];
</I>&gt;<i> 	    }
</I>&gt;<i> 	    outv[i] = (float)total;
</I>&gt;<i> 	}
</I>&gt;<i>     }
</I>&gt;<i>     public static void Main() {
</I>&gt;<i> 	Console.WriteLine(&quot;starting&quot;);
</I>&gt;<i> 	float[] outv = new float[65536];
</I>&gt;<i> 	float[] inv = new float[65536];
</I>&gt;<i> 	float[] mask = new float[256];
</I>&gt;<i> 	for(int iter=0;iter&lt;2;iter++) {
</I>&gt;<i> 	    DateTime start = DateTime.Now;
</I>&gt;<i> 	    for(int i=0;i&lt;10;i++) {
</I>&gt;<i> 		fill_random(inv);
</I>&gt;<i> 		fill_random(mask);
</I>&gt;<i> 		convolve(outv,inv,mask);
</I>&gt;<i> 	    }
</I>&gt;<i> 	    TimeSpan span = DateTime.Now.Subtract(start);
</I>&gt;<i> 	    Console.WriteLine(&quot;convolve=&quot;+outv[0]+&quot; took
</I>&gt;<i> &quot;+span);
</I>&gt;<i> 	}
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> === fibs.cs ===
</I>&gt;<i> // -*- Java -*-
</I>&gt;<i>
</I>&gt;<i> using System;
</I>&gt;<i>
</I>&gt;<i> class App {
</I>&gt;<i>     public static int fib(int i) {
</I>&gt;<i> 	if(i&lt;2) return 1;
</I>&gt;<i> 	return fib(i-1)+fib(i-2);
</I>&gt;<i>     }
</I>&gt;<i>     public static void Main() {
</I>&gt;<i> 	Console.WriteLine(&quot;starting&quot;);
</I>&gt;<i> 	for(int iter=0;iter&lt;2;iter++) {
</I>&gt;<i> 	    int i = 40;
</I>&gt;<i> 	    DateTime start = DateTime.Now;
</I>&gt;<i> 	    int result = fib(i);
</I>&gt;<i> 	    TimeSpan span = DateTime.Now.Subtract(start);
</I>&gt;<i> 	    Console.WriteLine(&quot;fib(&quot;+i+&quot;)=&quot;+result+&quot; took
</I>&gt;<i> &quot;+span);
</I>&gt;<i> 	}
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> __________________________________________________
</I>&gt;<i> Do You Yahoo!?
</I>&gt;<i> Make international calls for as low as $.04/minute with Yahoo! Messenger
</I>&gt;<i> <A HREF="http://phonecard.yahoo.com/">http://phonecard.yahoo.com/</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@ximian.com">Mono-list@ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000896.html">[Mono-list] JVM performance: JVM as a basis for CLR
</A></li>
	<LI> Next message: <A HREF="000874.html">[Mono-list] JVM performance: JVM as a basis for CLR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#871">[ date ]</a>
              <a href="thread.html#871">[ thread ]</a>
              <a href="subject.html#871">[ subject ]</a>
              <a href="author.html#871">[ author ]</a>
         </LI>
       </UL>
</body></html>
