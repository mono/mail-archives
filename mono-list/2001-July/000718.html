<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] PInvoke Conventions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rweather%40zip.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000697.html">
   <LINK REL="Next"  HREF="000720.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] PInvoke Conventions
   </H1>
    <B>Rhys Weatherley
    </B> 
    <A HREF="mailto:rweather%40zip.com.au"
       TITLE="[Mono-list] PInvoke Conventions">rweather@zip.com.au
       </A><BR>
    <I>Thu, 19 Jul 2001 10:10:35 +1000</I>
    <P><UL>
        <LI> Previous message: <A HREF="000697.html">[Mono-list] PInvoke Conventions
</A></li>
        <LI> Next message: <A HREF="000720.html">[Mono-list] PInvoke Conventions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#718">[ date ]</a>
              <a href="thread.html#718">[ thread ]</a>
              <a href="subject.html#718">[ subject ]</a>
              <a href="author.html#718">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bob Salita wrote:

&gt;<i> Rhys previously posted the struct problem example, which poisons many
</I>&gt;<i> seemingly good solutions. Hmmm, but wait, a struct is so C compiler specific
</I>&gt;<i> that there can be no hope of a generalized C#-to-C-struct mapping. Several
</I>&gt;<i> 32/32 compilers on the same system can map a struct totally differently.
</I>&gt;<i> Thus I'm concluding that there is no way to reliably handle structs.
</I>
Actually, &quot;libffi&quot; does a pretty good job of handling structs, both in
parameters and return values.  The main issue is one of layout of
the C#-defined class, but it may be possible to hijack some of
&quot;libffi&quot;'s code to handle this also, if an appropriate attribute is
present to turn the special layout on.  e.g.

[NativeStructLayout(true), NativeTypeSizes(true)]
public struct timeval
{
    public long tv_sec;
    public long tv_usec;
}

It may not be necessary to add an extra attribute either.  The
CLR spec already has a way to specify that a class has &quot;explicit
layout&quot;.  Right now, it assumes that the programmer will provide
the offsets of the fields and the packing details to use for the
class.  Sam, perhaps it could be adjusted slightly to say &quot;if the
class is marked explicit, but no explicit information is supplied,
then use the platform-specific conventions&quot;.

The &quot;libffi&quot; library is quite nice.  It takes care of all the nasty
business of converting abstract descriptions of call information
into the specifics used by the underlying CPU, OS, and compiler.

Cheers,

Rhys.




</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000697.html">[Mono-list] PInvoke Conventions
</A></li>
	<LI> Next message: <A HREF="000720.html">[Mono-list] PInvoke Conventions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#718">[ date ]</a>
              <a href="thread.html#718">[ thread ]</a>
              <a href="subject.html#718">[ subject ]</a>
              <a href="author.html#718">[ author ]</a>
         </LI>
       </UL>
</body></html>
