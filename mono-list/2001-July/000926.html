<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] PInvoke Conventions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:fjh%40cs.mu.OZ.AU">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000957.html">
   <LINK REL="Next"  HREF="000675.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] PInvoke Conventions
   </H1>
    <B>Fergus Henderson
    </B> 
    <A HREF="mailto:fjh%40cs.mu.OZ.AU"
       TITLE="[Mono-list] PInvoke Conventions">fjh@cs.mu.OZ.AU
       </A><BR>
    <I>Tue, 24 Jul 2001 05:03:12 +1000</I>
    <P><UL>
        <LI> Previous message: <A HREF="000957.html">[Mono-list] PInvoke Conventions
</A></li>
        <LI> Next message: <A HREF="000675.html">[Mono-list] PInvoke Conventions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#926">[ date ]</a>
              <a href="thread.html#926">[ thread ]</a>
              <a href="subject.html#926">[ subject ]</a>
              <a href="author.html#926">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18-Jul-2001, Rhys Weatherley &lt;<A HREF="mailto:rweather@zip.com.au">rweather@zip.com.au</A>&gt; wrote:
&gt;<i> I've been investigating PInvoke support for Portable.NET,
</I>&gt;<i> and I've come across some icky issues that will probably
</I>&gt;<i> affect Mono's VM as well.
</I>&gt;<i> 
</I>&gt;<i> In particular, because [C] &quot;int&quot; and &quot;long&quot; have different types
</I>&gt;<i> on different CPU's, it is difficult to write PInvoke declarations
</I>&gt;<i> in C# that will work with all Unix libc's.  The result would
</I>&gt;<i> be libraries and applications that need to be compiled
</I>&gt;<i> separately for 32-bit and 64-bit systems.
</I>&gt;<i> 
</I>&gt;<i> To avoid duplication of effort, I propose we come up with a
</I>&gt;<i> common way of solving these problems.
</I>
The Ada 95 standard has a solution to these problems.
They define a standard package Interfaces.C
that contains types Interfaces.C.int, Interfaces.C.long,
Interfaces.C.double, Interfaces.C.size_t, etc.
This package is implemented differently for different platforms.

When you want to interface to a C routine from Ada,
you give an Ada declaration for it using the Ada names
for the C types.  For example, to import the C function sin()
you could write

	with Interfaces.C;
	using Interfaces;
	package Example is
	  function sin(C.double) returns C.double;
	private
	  pragma Import(C, sin);
	end Example;

or something like that (my Ada is a little rusty, so I'm not sure
about the exact syntax, but anyway the syntax is not important).

There are various ways to convert from the Interfaces.C types to
similar native-Ada types and vice versa.  In other words, the
programmer has control over the marshalling, and can decide
how to handle overflow, etc.

Is there any reason why the same approach wouldn't work for .NET too?

What advantage is there to inventing special custom modifiers for
marshalling, rather than using the approach described above?

-- 
Fergus Henderson &lt;<A HREF="mailto:fjh@cs.mu.oz.au">fjh@cs.mu.oz.au</A>&gt;  |  &quot;I have always known that the pursuit
The University of Melbourne         |  of excellence is a lethal habit&quot;
WWW: &lt;<A HREF="http://www.cs.mu.oz.au/~fjh">http://www.cs.mu.oz.au/~fjh</A>&gt;  |     -- the last words of T. S. Garp.


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000957.html">[Mono-list] PInvoke Conventions
</A></li>
	<LI> Next message: <A HREF="000675.html">[Mono-list] PInvoke Conventions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#926">[ date ]</a>
              <a href="thread.html#926">[ thread ]</a>
              <a href="subject.html#926">[ subject ]</a>
              <a href="author.html#926">[ author ]</a>
         </LI>
       </UL>
</body></html>
