<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] [Gtk-sharp-list] Check Process state in an GUI app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20%5BGtk-sharp-list%5D%20Check%20Process%20state%20in%20an%20GUI%20app&In-Reply-To=14982013.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037648.html">
   <LINK REL="Next"  HREF="037628.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] [Gtk-sharp-list] Check Process state in an GUI app</H1>
    <B>Chris Howie</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20%5BGtk-sharp-list%5D%20Check%20Process%20state%20in%20an%20GUI%20app&In-Reply-To=14982013.post%40talk.nabble.com"
       TITLE="[Mono-list] [Gtk-sharp-list] Check Process state in an GUI app">cdhowie at gmail.com
       </A><BR>
    <I>Mon Jan 21 12:45:51 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="037648.html">[Mono-list] Using BasicAuthenticationModule
</A></li>
        <LI>Next message: <A HREF="037628.html">[Mono-list]  DirectoryInfo.GetFiles()  bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37612">[ date ]</a>
              <a href="thread.html#37612">[ thread ]</a>
              <a href="subject.html#37612">[ subject ]</a>
              <a href="author.html#37612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 21, 2008 11:58 AM, hellboy195 &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">hellboy195 at gmail.com</A>&gt; wrote:
&gt;<i> hi,
</I>&gt;<i> I'm currently trying to write a very very simple front-end for ffmpeg with
</I>&gt;<i> gtk#.
</I>&gt;<i> My Code looks like this:
</I>&gt;<i>
</I>&gt;<i> First I check if a file already exits with File.Exits(path)
</I>&gt;<i> MessageDialog -&gt; Overwrite YesNO.
</I>&gt;<i>
</I>&gt;<i> Then the I start ffmpeg with Process.Start().
</I>&gt;<i> Then I want show a MessageDialog if the process finished so I did it like :
</I>&gt;<i>
</I>&gt;<i> while(!proc.HasExited) {}
</I>&gt;<i> MessageDialog -&gt; &quot;Encoding finished&quot;;
</I>&gt;<i>
</I>&gt;<i> This is working good but this causes some bugs. E.g: If I do Overwrite it
</I>&gt;<i> &quot;yes&quot;. The MessageDialog isn't destroyed until the process finished. If I
</I>&gt;<i> delete this while {} it's working correct but the Message appears
</I>&gt;<i> immediately and not after the process hast Finished. Using if is also not
</I>&gt;<i> that good I suppose :/
</I>&gt;<i>
</I>&gt;<i> Any solution? Thx in advance :)
</I>
The problem is that you are waiting for the operation to complete on
the GUI thread.  You have destroyed the dialog, but Gtk cannot
actually remove the dialog from the screen until you give control back
to the main GUI loop.

What you want to do is either add an idle handler or spin off another
thread to take care of it.  An idle handler would probably be easiest
for your purpose:

// Message dialog code
Process proc = ...;
GLib.Idle.Add(delegate {
    if (proc.HasExited) {
        // Show dialog.
        return false; // Remove this delegate from the idle list.
    }

    return true; // Run this delegate again when idle.
});

Note that this approach can burn quite a bit of CPU running the idle
delegate.  You may want to try attaching an event handler to
Process.Exited instead:

proc.EnableRaisingEvents = true;
proc.Exited += delegate {
    Application.Invoke(delegate {
        // Show dialog.
    });
};

Note that you must call Application.Invoke because the Exited event
handler will not be running on the GUI thread, and you should not
touch the GUI from other threads.  Application.Invoke puts a delegate
in a queue to be executed on the GUI thread the next time the main
loop is entered.

-- 
Chris Howie
<A HREF="http://www.chrishowie.com">http://www.chrishowie.com</A>
<A HREF="http://en.wikipedia.org/wiki/User:Crazycomputers">http://en.wikipedia.org/wiki/User:Crazycomputers</A>
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037648.html">[Mono-list] Using BasicAuthenticationModule
</A></li>
	<LI>Next message: <A HREF="037628.html">[Mono-list]  DirectoryInfo.GetFiles()  bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37612">[ date ]</a>
              <a href="thread.html#37612">[ thread ]</a>
              <a href="subject.html#37612">[ subject ]</a>
              <a href="author.html#37612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
