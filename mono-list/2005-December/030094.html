<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: Encoding email message ??
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Re%3A%20Encoding%20email%20message%20%3F%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030093.html">
   <LINK REL="Next"  HREF="030095.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: Encoding email message ??</H1>
    <B>Peter Dennis Bartok</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Re%3A%20Encoding%20email%20message%20%3F%3F&In-Reply-To="
       TITLE="[Mono-list] Re: Encoding email message ??">peter at novonyx.com
       </A><BR>
    <I>Wed Dec 28 11:51:44 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="030093.html">[Mono-list] Learning to developing in mono...
</A></li>
        <LI>Next message: <A HREF="030095.html">[Mono-list] Re: Encoding email message ??
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30094">[ date ]</a>
              <a href="thread.html#30094">[ thread ]</a>
              <a href="subject.html#30094">[ subject ]</a>
              <a href="author.html#30094">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There's more to it then just reading the encoding from a header and pulling 
the body through an encoder. First, anything encoded in the header itself 
(like the Subject or Sender and Recipient names) use a special way of 
encoding, which needs separate parsing. Then, a body can consist of multiple 
parts, for different data types or different encodings, which requries 
reading more headers and parsing the body into separate sections

Doign what was suggested in this thread will not result in a well working 
mail 'reader'.

I suggest reading at least RFC 2045 (Multipurpose Internet Mail Extensions 
(MIME) Part One: Format of Internet Message Bodies) and RFC 2047 (MIME 
(Multipurpose Internet Mail Extensions) Part Three: Message Header 
Extensions for Non-ASCII Text) or better RFC 2045-2049.

The Hula project has (or at least used to have) code that did what you are 
trying to do (take a message from the network and translate it on the fly to 
HTML), <A HREF="http://www.hula-project.com/">http://www.hula-project.com/</A> (the mwmail module and StreamIO 
libraries do the work)

Cheers,
  Peter


-----Original Message-----
From: &quot;Robert Jordan&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">robertj at gmx.net</A>&gt;
To: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>&gt;
Date: Wednesday, 28 December, 2005 06:50
Subject: [Mono-list] Re: Encoding email message ??


&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>Read the headers using StreamReader (..., Encoding.ASCII).
</I>&gt;<i>If you got the encoding, just use another StreamReader, now
</I>&gt;<i>with the specified encoding.
</I>&gt;<i>
</I>&gt;<i>Robert
</I>&gt;<i>
</I>&gt;&gt;<i> Sorry, wrong line from the code, I mean System.IO.StreamReader.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> System.Net.Sockets.TcpClient Server = null;
</I>&gt;&gt;<i> System.Net.Sockets.NetworkStream NetStrm = null;
</I>&gt;&gt;<i> System.IO.StreamReader RdStrm = null;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Server = new System.Net.Sockets.TcpClient(MailFetchHost, 110);
</I>&gt;&gt;<i> NetStrm = Server.GetStream();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> RdStrm = new System.IO.StreamReader(NetStrm, Encoding.?????);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Roman,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Sure, but to get to those &quot;headers&quot; I must already have
</I>&gt;&gt;&gt;&gt;<i> System.Net.Sockets.NetworkStream with some encoding. Are you sure it
</I>&gt;&gt;&gt;&gt;<i> is possible to dynamically change encoding of NetworkStream?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> NetworkStream doesn't have an encoding. It's transparent.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Robert
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Mail message headers use to have a Content-Type which also contains
</I>&gt;&gt;&gt;&gt;&gt;<i> the encoding of the message. So you have to parse the headers
</I>&gt;&gt;&gt;&gt;&gt;<i> first, then use the specified encoding to decode the message.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Robert
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Im having similar problem. I have written my own mail server and
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> encoding is killing me. If messages are in Unicode everything is
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> ok, but in case of any other encoding characters just disappear. :-(
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> If you will find some useful information how to work around this
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> problem, please let me know.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> In my opinion problem is in the way how I use
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> System.Net.Sockets.NetworkStream
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Salvatore Scarciglia wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Hello !
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Using the System.Net.Sockets.TcpClient i'm reading my POP3 inbox
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> mail; I want
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> to convert (encode ??) the message in HTML and render it in a
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> gtkhtml widget
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> created at runtime.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> It's all ok except the encoding phase. Ho can I do ? Is there a
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> class in the framework that can help me?
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Thanx
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Salvatore
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i> 
</I>
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030093.html">[Mono-list] Learning to developing in mono...
</A></li>
	<LI>Next message: <A HREF="030095.html">[Mono-list] Re: Encoding email message ??
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30094">[ date ]</a>
              <a href="thread.html#30094">[ thread ]</a>
              <a href="subject.html#30094">[ subject ]</a>
              <a href="author.html#30094">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
