<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono.Data.SqliteClient always report text as
	DataTypeName
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Data.SqliteClient%20always%20report%20text%20as%0A%09DataTypeName&In-Reply-To=494f8120512140605p1db8a253h9b9314bfd1b37955%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029892.html">
   <LINK REL="Next"  HREF="029901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono.Data.SqliteClient always report text as
	DataTypeName</H1>
    <B>Aaron Bockover</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Data.SqliteClient%20always%20report%20text%20as%0A%09DataTypeName&In-Reply-To=494f8120512140605p1db8a253h9b9314bfd1b37955%40mail.gmail.com"
       TITLE="[Mono-list] Mono.Data.SqliteClient always report text as
	DataTypeName">abockover at novell.com
       </A><BR>
    <I>Wed Dec 14 10:42:36 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="029892.html">[Mono-list] Mono.Data.SqliteClient always report text as
	DataTypeName
</A></li>
        <LI>Next message: <A HREF="029901.html">[Mono-list] Mono.Data.SqliteClient always report text as
	DataTypeName
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29900">[ date ]</a>
              <a href="thread.html#29900">[ thread ]</a>
              <a href="subject.html#29900">[ subject ]</a>
              <a href="author.html#29900">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dates in Sqlite are stored as strings, in the format &quot;YYYY-MM-DD
HH:MM:SS&quot;. If you read them in and use some variation of
System.DateTime.Parse() to convert the string to a System.DateTime, the
conversion may be incorrect if the current locale does not support this
format. If you must parse it, be sure to manually specify the US to the
Parse method. 

However... System.DateTime.Parse is extremely inefficient, and I
recommend avoiding it altogether. Instead, store a unix expoch timestamp
in the database, and use
Mono.Unix.Native.NativeConvert.ToDateTime/FromDateTime to do the
conversions to/from. 

If you must store it as a formatted date string in the database, you can
also use this SQL to do the conversion to epoch time:

SELECT strftime(&quot;%s&quot;, &quot;2005-12-14 10:32:55&quot;);

This will return the time in UTC. If you need it for the current
timezone:

SELECT strftime(&quot;%s&quot;, &quot;2005-12-14 10:32:55&quot;, &quot;localtime&quot;);

I've never tested this method in practice, but I would imagine it's much
faster than using System.DateTime.Parse() on the string variant.

To give you a rough idea of how slow System.DateTime.Parse is:

In Banshee, the Tracks table had two &quot;DATETIME&quot; columns. There were 4000
rows in the table. Loading all 4000 rows meant System.DateTime.Parse()
was called 8000 times. This load operation took about 20 seconds. When I
changed the value being stored from a formatted date/time string to an
epoch int, using ToDateTime to do the conversion took only about 1.5
seconds to load all 4000 rows.

--Aaron


On Wed, 2005-12-14 at 08:05 -0600, Duncan McQueen wrote:
&gt;<i> Will this error be related to DateTime values not being reported correctly?
</I>&gt;<i> 
</I>&gt;<i> On 12/14/05, Julien Sobrier &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">julien at sobrier.net</A>&gt; wrote:
</I>&gt;<i> &gt; Aaron Bockover wrote:
</I>&gt;<i> &gt; &gt; Internally in sqlite, everything is stored as a string, regardless of
</I>&gt;<i> &gt; &gt; what type a column was assigned during table creation.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The only way to know the &quot;type&quot; is to parse the table definition from
</I>&gt;<i> &gt; &gt; the sqlite_master table. This should probably be done for convenience
</I>&gt;<i> &gt; &gt; inside Mono.Data.SqliteClient.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; For instance, run this query:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SELECT sql FROM sqlite_master WHERE name=&quot;Tracks&quot;;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; That will return the SQL used to create the &quot;Tracks&quot; table. You can then
</I>&gt;<i> &gt; &gt; parse that result to build a map of column names-&gt;types.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; There is some example code for this in Banshee:
</I>&gt;<i> &gt; &gt; <A HREF="http://cvs.gnome.org/viewcvs/*checkout*/banshee/src/Database.cs">http://cvs.gnome.org/viewcvs/*checkout*/banshee/src/Database.cs</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; --Aaron
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks a lot, I'll look at it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029892.html">[Mono-list] Mono.Data.SqliteClient always report text as
	DataTypeName
</A></li>
	<LI>Next message: <A HREF="029901.html">[Mono-list] Mono.Data.SqliteClient always report text as
	DataTypeName
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29900">[ date ]</a>
              <a href="thread.html#29900">[ thread ]</a>
              <a href="subject.html#29900">[ subject ]</a>
              <a href="author.html#29900">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
