<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Async sockets and memory leaks in BeginSend
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Async%20sockets%20and%20memory%20leaks%20in%20BeginSend&In-Reply-To=%3CCAEGCbu%2BWpg4VA%3DOdYHY7hnxL_jFStwjVXm0-RwEWNwwgPGZdrw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048594.html">
   <LINK REL="Next"  HREF="048602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Async sockets and memory leaks in BeginSend</H1>
    <B>Nicholas Frechette</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Async%20sockets%20and%20memory%20leaks%20in%20BeginSend&In-Reply-To=%3CCAEGCbu%2BWpg4VA%3DOdYHY7hnxL_jFStwjVXm0-RwEWNwwgPGZdrw%40mail.gmail.com%3E"
       TITLE="[Mono-list] Async sockets and memory leaks in BeginSend">zeno490 at gmail.com
       </A><BR>
    <I>Sat May 26 16:07:15 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="048594.html">[Mono-list] Async sockets and memory leaks in BeginSend
</A></li>
        <LI>Next message: <A HREF="048602.html">[Mono-list] Async sockets and memory leaks in BeginSend
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48595">[ date ]</a>
              <a href="thread.html#48595">[ thread ]</a>
              <a href="subject.html#48595">[ subject ]</a>
              <a href="author.html#48595">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dispose on async results is mostly to properly clear the
synchronization object (AsyncWaitHandle).
You can call dispose manually after calling EndSend(..) on the
AsyncWaitHandle. I do not believe this is required. It should be
called internally automatically.

This will not however fix the memory leak (I did try it myself). The
leak appears to be within the runtime, on the native side.
We'll just have to wait and see if it is indeed fixed. Btw here is the
link to the bug report I filled for this:

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=723148">https://bugzilla.novell.com/show_bug.cgi?id=723148</A>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=731579">https://bugzilla.novell.com/show_bug.cgi?id=731579</A>

Have you tried without --debug to see if it still leaks?

On Thu, May 24, 2012 at 2:46 PM, xplicit &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">svg at ngs.ru</A>&gt; wrote:
&gt;<i> Thank you for you suggestion.
</I>&gt;<i>
</I>&gt;<i> SocketAsyncResult has Dispose method in it's implementation, but how could I
</I>&gt;<i> call Dispose on SocketAsyncResult if this class is internal? BeginSend
</I>&gt;<i> returns IAsyncResult interface, which does not have Dispose in the interface
</I>&gt;<i> definition.
</I>&gt;<i>
</I>&gt;<i> I found some old posts in the internet about similar issue with
</I>&gt;<i> OverlappedAsyncResult (internal implementation of IAsyncResult in BeginSend
</I>&gt;<i> in .NET). They told, that in .NET 1.1 there was a memory leak in similar
</I>&gt;<i> scenarious, because buffer was pinned and memory could not be defragmented
</I>&gt;<i> by GC. Also, they told, that in .NET 2.0 such issue was fixed.
</I>&gt;<i>
</I>&gt;<i> They recommended &#160;to pool buffers to prevent reallocating them in memory. I
</I>&gt;<i> followed this advice and removed creation of SendStateObject from the Send
</I>&gt;<i> function. &#160;Creation SendStateObject only one time per each client in class
</I>&gt;<i> constructor helped me to minimize memory leaks, so they now not so huge, but
</I>&gt;<i> still present.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Async-sockets-and-memory-leaks-in-BeginSend-tp4648844p4649533.html">http://mono.1490590.n4.nabble.com/Async-sockets-and-memory-leaks-in-BeginSend-tp4648844p4649533.html</A>
</I>&gt;<i> Sent from the Mono - General mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048594.html">[Mono-list] Async sockets and memory leaks in BeginSend
</A></li>
	<LI>Next message: <A HREF="048602.html">[Mono-list] Async sockets and memory leaks in BeginSend
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48595">[ date ]</a>
              <a href="thread.html#48595">[ thread ]</a>
              <a href="subject.html#48595">[ subject ]</a>
              <a href="author.html#48595">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
