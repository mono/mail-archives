<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Async sockets and memory leaks in BeginSend
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Async%20sockets%20and%20memory%20leaks%20in%20BeginSend&In-Reply-To=%3CCAEGCbuKUamHLC%3DGroisTiAwOWuE1cWmsB1fay_N0bt-ypkpoqA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048603.html">
   <LINK REL="Next"  HREF="048577.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Async sockets and memory leaks in BeginSend</H1>
    <B>Nicholas Frechette</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Async%20sockets%20and%20memory%20leaks%20in%20BeginSend&In-Reply-To=%3CCAEGCbuKUamHLC%3DGroisTiAwOWuE1cWmsB1fay_N0bt-ypkpoqA%40mail.gmail.com%3E"
       TITLE="[Mono-list] Async sockets and memory leaks in BeginSend">zeno490 at gmail.com
       </A><BR>
    <I>Mon May 28 14:21:54 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="048603.html">[Mono-list] Async sockets and memory leaks in BeginSend
</A></li>
        <LI>Next message: <A HREF="048577.html">[Mono-list] Memory limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48604">[ date ]</a>
              <a href="thread.html#48604">[ thread ]</a>
              <a href="subject.html#48604">[ subject ]</a>
              <a href="author.html#48604">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I would advise against a design relying on a crash callback to save data.
I do believe in mono (under linux only?) that you can hook into the
sigkill/sigterm or something similar. However, it probably isn't very
safe to do any amount of processing in those callbacks. I am also
pretty sure that it isn't supported under .net/windows.

Regardless, relying on such a callback isn't safe enough. In the event
where the hardware fails or power fails, your pc will shutdown and no
hardware failure callback will be called.
Even if there was, depending on which thread is executing that
callback and depending on the OS/mono behavior when that happens,
other threads might not get another chance to run, might have data
store in IO buffers or on the stack that you will not be able to find,
etc.

For sensitive data, either use a DB with transactions or roll out a
similar feature yourself: write everything to a journal/disk
periodically with an optional coalescing/compressing step that you
might run every day, twice a day, when a max size is reached, etc.
Other than that, you just have to accept that not all data can be
saved always :(

Cheers,
Nicholas

On Sat, May 26, 2012 at 5:52 PM, xplicit &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">svg at ngs.ru</A>&gt; wrote:
&gt;<i> I always run mono without --debug key, and memory is still leaking. I'll
</I>&gt;<i> collect heapshot info of the my latest build and will post info from it in a
</I>&gt;<i> day or two.
</I>&gt;<i>
</I>&gt;<i> There is much worse thing. After long working mono crashes with a dump. Once
</I>&gt;<i> or twice it told, that could not create thread (it's predictable that in my
</I>&gt;<i> app could be a sutiation, when max threads limit is reached, but why mono
</I>&gt;<i> drops in core and did not call AppDomain.CurrentDomain.UnhandledException?)
</I>&gt;<i> Sometimes it tells about segmentation fault (maybe this is related to high
</I>&gt;<i> fragmentation in GC). Sometimes mono drops into core without any human
</I>&gt;<i> readable cause. Several times I saw &quot;timeout reached in the finalizer
</I>&gt;<i> thread&quot;.
</I>&gt;<i>
</I>&gt;<i> I have got some important data in the memory, which I want to save on the
</I>&gt;<i> crash of mono. Maybe mono has a some extension, which I can use to register
</I>&gt;<i> 'on crash' callback and save important data?
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Async-sockets-and-memory-leaks-in-BeginSend-tp4648844p4649559.html">http://mono.1490590.n4.nabble.com/Async-sockets-and-memory-leaks-in-BeginSend-tp4648844p4649559.html</A>
</I>&gt;<i> Sent from the Mono - General mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048603.html">[Mono-list] Async sockets and memory leaks in BeginSend
</A></li>
	<LI>Next message: <A HREF="048577.html">[Mono-list] Memory limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48604">[ date ]</a>
              <a href="thread.html#48604">[ thread ]</a>
              <a href="subject.html#48604">[ subject ]</a>
              <a href="author.html#48604">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
