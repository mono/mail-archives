<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Making a ruby.net compiler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:malekith%40pld-linux.org">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="013912.html">
   <LINK REL="Next"  HREF="013916.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Making a ruby.net compiler
   </H1>
    <B>Michal Moskal
    </B> 
    <A HREF="mailto:malekith%40pld-linux.org"
       TITLE="[Mono-list] Making a ruby.net compiler">malekith@pld-linux.org
       </A><BR>
    <I>Sun, 11 May 2003 19:37:52 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="013912.html">[Mono-list] Making a ruby.net compiler
</A></li>
        <LI> Next message: <A HREF="013916.html">[Mono-list] Making a ruby.net compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13914">[ date ]</a>
              <a href="thread.html#13914">[ thread ]</a>
              <a href="subject.html#13914">[ subject ]</a>
              <a href="author.html#13914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>[snip]

Few more thoughts.

1. why should we optimize (special-case) the particular get_type call?

Because it's *very* important in any language that has some kinds of
variant (discriminating union) data structure, which would be compiled
to subclasses. For example list is defined in ML:

type 'a list = Cons of 'a * 'a list | Nil

Which would be compiled to following Generic C#:

class list&lt;A&gt; {}
sealed class Cons&lt;A&gt; : list&lt;A&gt; {
  A field_1;
  list&lt;A&gt; field_2;
}
sealed class Nil&lt;A&gt; : list&lt;A&gt; {}

And functions like (warning: this isn't optimal version :-)

ML:

let length = function
    Cons (x, xs) -&gt; 1 + length (xs)
  | Nil -&gt; 0

C#:

int length&lt;A&gt;(list&lt;A&gt; x)
{
  if (x is Cons&lt;A&gt;) {	// (*)
    return 1 + length(((Cons&lt;A&gt;)x).field_2);
  } else {
    return 0;
  }
}

Here another issue should be raised, wrt Generic C#. It should be
possible to write something like &quot;if (x is Cons) {&quot; at (*), because
there is no need to check if type parameter A is the same.

But this is just a comment.

2. bit patterns Fergus Henderson was talking about could be used to use
   jump table in pattern matching. For example:
 
type t = 
    Case1 of int
  | Case2 of ...
  | Case3 ...
  ....
  | Case23

and then you have function:

let f = function
    Case1 (i) -&gt; ...
  | Case2 (...) -&gt; ...
  ...
  | Case23 -&gt; ...

you would need to have 23 successive equality tests. It would be better
to use jump table, but I'm not quite sure if it's at all possible in
CIL. Anyway it can be done by having compiler-generated &quot;int get_tag()&quot;
method in each of CaseN classes.

Anyway this jump-table stuff doesn't present that-big performance hit
as calling runtime function for each typeof.

3. if you are familiar with ILX, you should remember .classunion type
   there, that just did discriminating unions.

But I believe it isn't very good idea to put it in Mono, since it's
very limited (namely it seems to fit OCaml variants, but not SML
variants (things after of can have names), or OCaml polymorphic 
variants (one polymorphic variant can be in several types)).

-- 
:<i> Michal Moskal :: <A HREF="http://www.kernel.pl/~malekith">http://www.kernel.pl/~malekith</A> : GCS {C,UL}++++$ a? !tv
</I>:<i> PLD Linux ::::::::: Wroclaw University, CS Dept : {E-,w}-- {b++,e}&gt;+++ h
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="013912.html">[Mono-list] Making a ruby.net compiler
</A></li>
	<LI> Next message: <A HREF="013916.html">[Mono-list] Making a ruby.net compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13914">[ date ]</a>
              <a href="thread.html#13914">[ thread ]</a>
              <a href="subject.html#13914">[ subject ]</a>
              <a href="author.html#13914">[ author ]</a>
         </LI>
       </UL>
</body></html>
