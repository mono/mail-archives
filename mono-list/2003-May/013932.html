<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Making a ruby.net compiler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:miguel%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="013919.html">
   <LINK REL="Next"  HREF="013920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Making a ruby.net compiler
   </H1>
    <B>Miguel de Icaza
    </B> 
    <A HREF="mailto:miguel%40ximian.com"
       TITLE="[Mono-list] Making a ruby.net compiler">miguel@ximian.com
       </A><BR>
    <I>12 May 2003 11:20:06 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="013919.html">[Mono-list] Making a ruby.net compiler
</A></li>
        <LI> Next message: <A HREF="013920.html">[Mono-list] Making a ruby.net compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13932">[ date ]</a>
              <a href="thread.html#13932">[ thread ]</a>
              <a href="subject.html#13932">[ subject ]</a>
              <a href="author.html#13932">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

&gt;<i> Some thoughts about using lowest bits of a pointer to store some flags about
</I>&gt;<i> object type. I'm not sure if this is valid for this case (I'm not very good
</I>&gt;<i> in functional languages)
</I>&gt;<i> 
</I>&gt;<i> 1. It makes your pointers unaligned, which I believe to be MUCH worse,
</I>&gt;<i> because it involves heavy penalty cycles in most current CPUs and is even
</I>&gt;<i> disallowed on some RISCs
</I>
You can pick another two bits, and just allocate objects where those two
bits are valid ;-)

&gt;<i> 2. If you want to align your pointers before each dereference - you can do
</I>&gt;<i> it but you have to add some additional instructions to the JIT output, which
</I>&gt;<i> would reduce the benefit of using bit flags
</I>
This is correct at face value, but we do not know what is more
expensive: anding a pointer on each access, or testing the type of the
object.  It will depend heavily on the pattern and volume that you will
be dealing with.  testing is required in this area.

&gt;<i> 3. It also (may or may not) make your memory allocator be sub-optimal
</I>&gt;<i> because you have to deal with an internal fragmentation (you either allocate
</I>&gt;<i> contiguous block and discard the beginning of it or allocate contiguous one
</I>&gt;<i> and mangle the pointer, but you have to make a decision which takes time)
</I>&gt;<i> 
</I>&gt;<i> I wonder if you could have separate heaps (perhaps starting at some
</I>&gt;<i> well-known virtual memory addresses, like
</I>&gt;<i> 
</I>&gt;<i> 0x40000000 - 0x7fffffff - heap for normal objects
</I>&gt;<i> 0x80000000 - 0x8fffffff - heap for A objects
</I>&gt;<i> 0x90000000 - 0x9fffffff - heap for B objects
</I>&gt;<i> 
</I>&gt;<i> This has an interesting property of being able to make decisions by checking
</I>&gt;<i> some pointer bits, keeps your pointers aligned and may even allow for the
</I>&gt;<i> jump table approach.
</I>&gt;<i> 
</I>&gt;<i> Just an idea.
</I>
Yes, exactly!

The bottom line (which Paolo echoed much better than I did) is: we would
love to use Mono as a test-bed for trying out different optimizations
that would help dynamic languages, a research platform if you will.

I proposed using lower two bits, you suggested an encoding that has a
lesser performance penalty, then Fergus suggested using an attribute
instead of a runtime call.  We are fleshing out the original idea to be
useful.  Through this iterative process we can polish something up. 
When the process is done, we can publish a document that others can use
to improve the performance of dynamic languages on their runtime.  

Miguel


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="013919.html">[Mono-list] Making a ruby.net compiler
</A></li>
	<LI> Next message: <A HREF="013920.html">[Mono-list] Making a ruby.net compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13932">[ date ]</a>
              <a href="thread.html#13932">[ thread ]</a>
              <a href="subject.html#13932">[ subject ]</a>
              <a href="author.html#13932">[ author ]</a>
         </LI>
       </UL>
</body></html>
