<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] LAMESPEC?:
 System.Diagnostics.DiagnosticsConfigurationHandler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pbaena%40uol.com.ar">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="014029.html">
   <LINK REL="Next"  HREF="014031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] LAMESPEC?:
 System.Diagnostics.DiagnosticsConfigurationHandler
   </H1>
    <B>Pablo Baena
    </B> 
    <A HREF="mailto:pbaena%40uol.com.ar"
       TITLE="[Mono-list] LAMESPEC?:
 System.Diagnostics.DiagnosticsConfigurationHandler">pbaena@uol.com.ar
       </A><BR>
    <I>21 May 2003 04:51:13 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="014029.html">[Mono-list] LAMESPEC?:
 System.Diagnostics.DiagnosticsConfigurationHandler
</A></li>
        <LI> Next message: <A HREF="014031.html">[Mono-list] RE: Mono-list digest, Vol 1 #973 - 13 msgs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14070">[ date ]</a>
              <a href="thread.html#14070">[ thread ]</a>
              <a href="subject.html#14070">[ subject ]</a>
              <a href="author.html#14070">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-38EJI1ndl0W0U7nVRfJI
Content-Type: multipart/alternative; boundary=&quot;=-3YrIOLJhCt2Ol0LXB+0/&quot;


--=-3YrIOLJhCt2Ol0LXB+0/
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Could you apply this patch? It took so long 'cause I was trying to
replicate .NET behaviour. It seems that .NET doesn't remove the
DefaultTraceListener anyway, and I didn't get help in any list about
this.

At least it works in Mono.

On Sat, 2003-05-17 at 14:48, Jonathan Pryor wrote:

&gt;<i> Go ahead and fix it.  It doesn't seem to be a particularly lame
</I>&gt;<i> requirement, as not everyone will expect the default TraceListener to be
</I>&gt;<i> named &quot;Default&quot; (case sensitive).
</I>&gt;<i> 
</I>&gt;<i> Could you also update the test cases in
</I>&gt;<i> class/System/Test/System.Diagnostics/DiagnosticsConfigurationHandlerTest.cs?
</I>&gt;<i> 
</I>&gt;<i>  - Jon
</I>&gt;<i> 
</I>&gt;<i> On Sat, 2003-05-17 at 06:42, Pablo Baena wrote:
</I>&gt;<i> &gt; In Mono's
</I>&gt;<i> &gt; System.Diagnostics.DiagnosticsConfigurationHandler.AddTraceListeners
</I>&gt;<i> &gt; (), &quot;name&quot; and &quot;type&quot; are required. On the other hand, MSDN
</I>&gt;<i> &gt; documentation for System.Diagnostics.DefaultTraceListener says that:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &lt;configuration&gt;
</I>&gt;<i> &gt; &lt;system.diagnostics&gt;
</I>&gt;<i> &gt;     &lt;trace autoflush=&quot;false&quot; indentsize=&quot;4&quot;&gt;
</I>&gt;<i> &gt;         &lt;listeners&gt;
</I>&gt;<i> &gt;            &lt;remove
</I>&gt;<i> &gt; type=&quot;System.Diagnostics.DefaultTraceListener,System&quot;/&gt; 
</I>&gt;<i> &gt;         &lt;/listeners&gt;
</I>&gt;<i> &gt;     &lt;/trace&gt;
</I>&gt;<i> &gt; &lt;/system.diagnostics&gt;
</I>&gt;<i> &gt; &lt;/configuration&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; should remove the DefaultTraceListener (apparently without specifying
</I>&gt;<i> &gt; the name).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thus, that sample .config file throws an exception on Mono.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I can fix this. Should I?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -- 
</I>&gt;<i> &gt; Pablo Baena &lt;<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>
-- 
Pablo Baena &lt;<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&gt;

--=-3YrIOLJhCt2Ol0LXB+0/
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: 7bit

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 TRANSITIONAL//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
  &lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; CHARSET=UTF-8&quot;&gt;
  &lt;META NAME=&quot;GENERATOR&quot; CONTENT=&quot;GtkHTML/1.1.10&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
Could you apply this patch? It took so long 'cause I was trying to replicate .NET behaviour. It seems that .NET doesn't remove the DefaultTraceListener anyway, and I didn't get help in any list about this.&lt;BR&gt;
&lt;BR&gt;
At least it works in Mono.&lt;BR&gt;
&lt;BR&gt;
On Sat, 2003-05-17 at 14:48, Jonathan Pryor wrote:
&lt;BLOCKQUOTE TYPE=CITE&gt;
&lt;PRE&gt;&lt;FONT COLOR=&quot;#737373&quot; SIZE=&quot;3&quot;&gt;&lt;I&gt;Go ahead and fix it.  It doesn't seem to be a particularly lame
requirement, as not everyone will expect the default TraceListener to be
named &amp;quot;Default&amp;quot; (case sensitive).

Could you also update the test cases in
class/System/Test/System.Diagnostics/DiagnosticsConfigurationHandlerTest.cs?

 - Jon

On Sat, 2003-05-17 at 06:42, Pablo Baena wrote:
&amp;gt;<i> In Mono's
</I>&amp;gt;<i> System.Diagnostics.DiagnosticsConfigurationHandler.AddTraceListeners
</I>&amp;gt;<i> (), &amp;quot;name&amp;quot; and &amp;quot;type&amp;quot; are required. On the other hand, MSDN
</I>&amp;gt;<i> documentation for System.Diagnostics.DefaultTraceListener says that:
</I>&amp;gt;<i> 
</I>&amp;gt;<i> &amp;lt;configuration&amp;gt;
</I>&amp;gt;<i> &amp;lt;system.diagnostics&amp;gt;
</I>&amp;gt;<i>     &amp;lt;trace autoflush=&amp;quot;false&amp;quot; indentsize=&amp;quot;4&amp;quot;&amp;gt;
</I>&amp;gt;<i>         &amp;lt;listeners&amp;gt;
</I>&amp;gt;<i>            &amp;lt;remove
</I>&amp;gt;<i> type=&amp;quot;System.Diagnostics.DefaultTraceListener,System&amp;quot;/&amp;gt; 
</I>&amp;gt;<i>         &amp;lt;/listeners&amp;gt;
</I>&amp;gt;<i>     &amp;lt;/trace&amp;gt;
</I>&amp;gt;<i> &amp;lt;/system.diagnostics&amp;gt;
</I>&amp;gt;<i> &amp;lt;/configuration&amp;gt;
</I>&amp;gt;<i> 
</I>&amp;gt;<i> should remove the DefaultTraceListener (apparently without specifying
</I>&amp;gt;<i> the name).
</I>&amp;gt;<i> 
</I>&amp;gt;<i> Thus, that sample .config file throws an exception on Mono.
</I>&amp;gt;<i> 
</I>&amp;gt;<i> I can fix this. Should I?
</I>&amp;gt;<i> 
</I>&amp;gt;<i> -- 
</I>&amp;gt;<i> Pablo Baena &amp;lt;<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&amp;gt;
</I>
_______________________________________________
Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>&lt;/FONT&gt;
&lt;A HREF=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list"">http://lists.ximian.com/mailman/listinfo/mono-list&quot;</A>&gt;&lt;FONT SIZE=&quot;3&quot;&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list</I">http://lists.ximian.com/mailman/listinfo/mono-list&lt;/I</A>&gt;&lt;/FONT&gt;&lt;/A&gt;&lt;/PRE&gt;
&lt;/BLOCKQUOTE&gt;
&lt;PRE&gt;&lt;TABLE CELLSPACING=&quot;0&quot; CELLPADDING=&quot;0&quot; WIDTH=&quot;100%&quot;&gt;
&lt;TR&gt;
&lt;TD&gt;
-- &lt;BR&gt;
Pablo Baena &amp;lt;&lt;A HREF=&quot;mailto:<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&quot;&gt;<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&lt;/A&gt;&amp;gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TABLE&gt;
&lt;/PRE&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;

--=-3YrIOLJhCt2Ol0LXB+0/--

--=-38EJI1ndl0W0U7nVRfJI
Content-Disposition: attachment; filename=deftrace_listener.patch
Content-Type: text/plain; name=deftrace_listener.patch; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

? class/ByteFX.Data/.makefrag
? class/ByteFX.Data/.response
? class/ByteFX.Data/library-deps.stamp
? class/Commons.Xml.Relaxng/.makefrag
? class/Commons.Xml.Relaxng/.response
? class/Commons.Xml.Relaxng/library-deps.stamp
? class/ICSharpCode.SharpZipLib/.makefrag
? class/ICSharpCode.SharpZipLib/.response
? class/ICSharpCode.SharpZipLib/library-deps.stamp
? class/Microsoft.VisualC/.makefrag
? class/Microsoft.VisualC/.response
? class/Microsoft.VisualC/library-deps.stamp
? class/Mono.Data.DB2Client/.makefrag
? class/Mono.Data.DB2Client/.response
? class/Mono.Data.DB2Client/library-deps.stamp
? class/Mono.Posix/.makefrag
? class/Mono.Posix/.response
? class/Mono.Posix/library-deps.stamp
? class/Mono.Security/.makefrag
? class/Mono.Security/.response
? class/Mono.Security/library-deps.stamp
? class/Npgsql/.makefrag
? class/Npgsql/.response
? class/Npgsql/library-deps.stamp
? class/PEAPI/.makefrag
? class/PEAPI/.response
? class/PEAPI/library-deps.stamp
? class/System/System.Diagnostics/DiagnosticsConfigurationHandler.cs-back
? class/System/Test/.makefrag
? class/System/Test/.response
? class/System/Test/TestResult.xml
? class/System/Test/argument.txt
? class/System/Test/library-deps.stamp
? class/System.Data.OracleClient/.makefrag
? class/System.Data.OracleClient/.response
? class/System.Data.OracleClient/library-deps.stamp
? class/System.Design/.makefrag
? class/System.Design/.response
? class/System.Design/library-deps.stamp
? class/System.Management/.makefrag
? class/System.Management/.response
? class/System.Management/library-deps.stamp
? class/System.Security/.makefrag
? class/System.Security/.response
? class/System.Security/library-deps.stamp
? class/System.Security/Test/.makefrag
? class/System.Security/Test/.response
? class/System.Security/Test/library-deps.stamp
? class/System.Security/Test/security_linux_test.dll
? class/System.XML/Test/.makefrag
? class/System.XML/Test/.response
? class/System.XML/Test/TestResult.xml
? class/System.XML/Test/library-deps.stamp
? class/System.XML/Test/XmlFiles/xsl/result.xml
? class/corlib/Test/TestResult.xml
? class/corlib/Test/library-deps.stamp
? nunit20/framework/.makefrag
? nunit20/framework/.response
? nunit20/framework/library-deps.stamp
? nunit20/nunit-console/.makefrag-exe
? nunit20/nunit-console/.response-exe
? nunit20/nunit-console/program-deps
? nunit20/util/.makefrag
? nunit20/util/.response
? nunit20/util/library-deps.stamp
Index: class/System/System.Diagnostics/DiagnosticsConfigurationHandler.cs
===================================================================
RCS file: /mono/mcs/class/System/System.Diagnostics/DiagnosticsConfigurationHandler.cs,v
retrieving revision 1.5
diff -u -r1.5 DiagnosticsConfigurationHandler.cs
--- class/System/System.Diagnostics/DiagnosticsConfigurationHandler.cs	21 Dec 2002 03:38:12 -0000	1.5
+++ class/System/System.Diagnostics/DiagnosticsConfigurationHandler.cs	21 May 2003 07:47:11 -0000
@@ -233,8 +233,13 @@
 							AddTraceListener (name, type, id);
 							break;
 						case &quot;remove&quot;:
-							name = GetAttribute (attributes, &quot;name&quot;, true, child);
-							RemoveTraceListener (name);
+							name = GetAttribute (attributes, &quot;name&quot;, false, child);
+							if (name == null) {
+								type = GetAttribute (attributes, &quot;type&quot;, true, child);
+								RemoveTraceListener (Type.GetType (type));
+							}
+							else
+								RemoveTraceListener (name);
 							break;
 						case &quot;clear&quot;:
 							TraceImpl.Listeners.Clear ();
@@ -282,6 +287,15 @@
 				throw new ConfigurationException (
 						string.Format (&quot;Unknown error removing listener: {0}&quot;, name),
 						e);
+			}
+		}
+
+		private void RemoveTraceListener (Type type)
+		{
+			// .NET apparently ignores other types
+			if (type == typeof (DefaultTraceListener))
+			{
+				RemoveTraceListener (&quot;Default&quot;);
 			}
 		}
 
Index: class/System/Test/System.Diagnostics/DiagnosticsConfigurationHandlerTest.cs
===================================================================
RCS file: /mono/mcs/class/System/Test/System.Diagnostics/DiagnosticsConfigurationHandlerTest.cs,v
retrieving revision 1.3
diff -u -r1.3 DiagnosticsConfigurationHandlerTest.cs
--- class/System/Test/System.Diagnostics/DiagnosticsConfigurationHandlerTest.cs	25 Mar 2003 08:37:23 -0000	1.3
+++ class/System/Test/System.Diagnostics/DiagnosticsConfigurationHandlerTest.cs	21 May 2003 07:47:13 -0000
@@ -196,7 +196,8 @@
 				&quot;&lt;remove name=\&quot;foo\&quot;/&gt;&quot;,
 				&quot;&lt;add name=\&quot;foo\&quot;&quot; +
 					&quot;type=\&quot;System.Diagnostics.TextWriterTraceListener, System, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\&quot; /&gt;&quot;,
-				&quot;&lt;remove name=\&quot;foo\&quot;/&gt;&quot;
+				&quot;&lt;remove name=\&quot;foo\&quot;/&gt;&quot;,
+				&quot;&lt;remove type=\&quot;System.Diagnostics.DefaultTraceListener\&quot;/&gt;&quot;
 			};
 			ValidateSuccess (&quot;#TTT:L:Good&quot;, format, good);
 

--=-38EJI1ndl0W0U7nVRfJI--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="014029.html">[Mono-list] LAMESPEC?:
 System.Diagnostics.DiagnosticsConfigurationHandler
</A></li>
	<LI> Next message: <A HREF="014031.html">[Mono-list] RE: Mono-list digest, Vol 1 #973 - 13 msgs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14070">[ date ]</a>
              <a href="thread.html#14070">[ thread ]</a>
              <a href="subject.html#14070">[ subject ]</a>
              <a href="author.html#14070">[ author ]</a>
         </LI>
       </UL>
</body></html>
