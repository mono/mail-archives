<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Problem using 0.24 aot - Please help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="014037.html">
   <LINK REL="Next"  HREF="014035.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Problem using 0.24 aot - Please help
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Problem using 0.24 aot - Please help">lupus@ximian.com
       </A><BR>
    <I>Mon, 19 May 2003 11:21:54 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="014037.html">[Mono-list] Problem using 0.24 aot - Please help
</A></li>
        <LI> Next message: <A HREF="014035.html">[Mono-list] XSP,I have to restart after I change a  class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14043">[ date ]</a>
              <a href="thread.html#14043">[ thread ]</a>
              <a href="subject.html#14043">[ subject ]</a>
              <a href="author.html#14043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/18/03 Vivek, Bharath Varma (IE10) wrote:
&gt;<i> I'm facing few problems using the new aot compiler.
</I>&gt;<i> The problem is explained in detail below.....
</I>
Note, the AOT compiler is not yet at the same level of performance or
robustness as the plain JIT, so find issues with it is likely at this
time. Also, it's completely untested by us on windows and won't work as
it is. Help by windows programmers is appreciated.

&gt;<i> Doing mono --aot HelloWorld.exe, gave me the following.........
</I>&gt;<i> Executing the native assembler now:
</I>&gt;<i> as c:\WINNT\Profiles\vivekv\LOCALS~1\Temp/mono_aot_03456 -o
</I>&gt;<i> c:\WINNT\Profiles\vivekv\LOCALS~1\Temp/mono_aot_03456.o;ld -shared -o
</I>&gt;<i> HelloWorld.exe.so c:\WINNT\Profiles\vivekv\LOCALS~1\Temp/mono_aot_03456.o;rm
</I>&gt;<i> c:\WINNT\Profiles\vivekv\LOCALS~1\Temp/mono_aot_03456.o;strip
</I>&gt;<i> --strip-unneeded --discard-all HelloWorld.exe.so
</I>&gt;<i> as: unrecognized option `-shared'
</I>
The windows shell doesn't understand the command separator ';'.
We'll need to issue the separate commands with separate system() calls.

&gt;<i> Using the ld(GNU linker) as mentioned above gave me the following..........
</I>&gt;<i> Cannot export method_06000001: symbol not found
</I>&gt;<i> Cannot export method_06000001_patch_info: symbol not found
</I>&gt;<i> Cannot export method_06000002: symbol not found
</I>&gt;<i> Cannot export method_06000002_patch_info: symbol not found
</I>&gt;<i> Cannot export mono_assembly_guid: symbol not found
</I>&gt;<i>  
</I>&gt;<i> So I removed the -shared option and did 
</I>&gt;<i> ld -o HelloWorld.exe.so
</I>&gt;<i> c:\WINNT\Profiles\vivekv\LOCALS~1\Temp/mono_aot_03456.o
</I>
You can't remove -shared: the linker is supposed to create a shared
library (.dll) with all the needed methods exported, so that it can be
later loaded by the JIT as a library at runtime.

&gt;<i> To make sure that the aot compiled code was being used, I debugged the
</I>&gt;<i> execution and found that it was not using the aot compiled code!
</I>
Yes, using mini --stats will also report:
Methods from AOT:       0

Since you didn't compile to a dll, it can't work.

&gt;<i> Few Questions.....
</I>&gt;<i> Why did I get the unrecognized option &quot;-shared&quot;?
</I>
See above the issue with the shell.

&gt;<i> Why did I get &quot;cannot export method&quot; errors when using the linker? 
</I>
No idea, the function in the assembly output may need to be marked with
some windows-specific stuff, try checking the assembly generated by gcc
and make the aot code output the same kind of stuff.

&gt;<i> I created HelloWorld.exe.so without using the -shared option, so did my
</I>&gt;<i> HelloWorld.exe.so getting created properly?
</I>
No, you need to create a shared library.

&gt;<i> Why is &quot;g_module_symbol&quot; not able to find the symbol which contains my
</I>&gt;<i> assembly's GUID?
</I>
Because you didn't build a dll that exported the symbol.
Note, after you've fixed those issues, there is another one to address,
grep in aot.c for this chunk of code:
#ifndef PLATFORM_WIN32
                /* disable write protection */
                page_start = (char *) (((int) (code)) &amp; ~ (PAGESIZE - 1));
                pages = (code + code_len - page_start + PAGESIZE - 1) / PAGESIZE;
                err = mprotect (page_start, pages * PAGESIZE, PROT_READ | PROT_WRITE | PROT_EXEC);
                g_assert (err == 0);
#endif
You need to write the equivalent code that works on windows, basically
get the area of memory at page_start have read, write and execute
privileges.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="014037.html">[Mono-list] Problem using 0.24 aot - Please help
</A></li>
	<LI> Next message: <A HREF="014035.html">[Mono-list] XSP,I have to restart after I change a  class
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14043">[ date ]</a>
              <a href="thread.html#14043">[ thread ]</a>
              <a href="subject.html#14043">[ subject ]</a>
              <a href="author.html#14043">[ author ]</a>
         </LI>
       </UL>
</body></html>
