<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Problem with ODBC Driver
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Tam%40SiuLung.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="014064.html">
   <LINK REL="Next"  HREF="014066.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Problem with ODBC Driver
   </H1>
    <B>Alan Tam
    </B> 
    <A HREF="mailto:Tam%40SiuLung.com"
       TITLE="[Mono-list] Problem with ODBC Driver">Tam@SiuLung.com
       </A><BR>
    <I>Wed, 21 May 2003 05:11:46 +0800</I>
    <P><UL>
        <LI> Previous message: <A HREF="014064.html">[Mono-list] Problem with ODBC Driver
</A></li>
        <LI> Next message: <A HREF="014066.html">[Mono-list] Building a layer beetween buisiness logic and GUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14065">[ date ]</a>
              <a href="thread.html#14065">[ thread ]</a>
              <a href="subject.html#14065">[ subject ]</a>
              <a href="author.html#14065">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The problem you have maybe more chaotic. It happens to be the enum value of
small date time = 0, i.e. same as default value. So if somehow initialization
to the correct value is skipped, it will be treated as a DateTime type ... and
failed to cast ...

Btw, the reason no exception is thrown for types other than int and string is
that those parts are correctly implemented. The only wrong implementation is
that we haven't allocated storage for every datatype. When it is detected to be
an int, do the thing and otherwise assume that it is a string. So the internal
stored copy has a wrong datatype.

I am not too familar with ODBC, but I suspect, when I looked at the code, that
when we need to fetch a value, we need to allocate a buffer and call the
function by reference. When we need to update the value, the same buffer
location is used. This implies that for different datatypes, e.g. Int32, Int64,
... we need a different buffer, if we don't implement the serializations
ourselves. In view of this, a correct implementation need a big switch and
every datatype has a different function call for the respective variable.

Regards,
Alan

----- Original Message ----- 
From: &quot;Olivier Gaumond&quot; &lt;<A HREF="mailto:ogaumond@yahoo.com">ogaumond@yahoo.com</A>&gt;
To: &quot;Alan Tam&quot; &lt;<A HREF="mailto:Tam@SiuLung.com">Tam@SiuLung.com</A>&gt;; &lt;<A HREF="mailto:mono-list@lists.ximian.com">mono-list@lists.ximian.com</A>&gt;
Sent: 2003-05-21 04:33
Subject: Re: [Mono-list] Problem with ODBC Driver


&gt;<i>
</I>&gt;<i> However my table contains only varchar.
</I>&gt;<i>
</I>&gt;<i> But it explains other bugs I had.
</I>&gt;<i>
</I>&gt;<i> I thing it should throw a NotImplementedExcepetion when you call functions
</I>such
&gt;<i> as GetDouble.
</I>&gt;<i>
</I>&gt;<i> Olivier
</I>&gt;<i>
</I>&gt;<i>  --- Alan Tam &lt;<A HREF="mailto:Tam@SiuLung.com">Tam@SiuLung.com</A>&gt; a écrit : &gt; It is because the ODBC data
</I>&gt;<i> provider currently only implemented String, Int32
</I>&gt;<i> &gt; and no more other datatypes.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; Alan
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----- Original Message ----- 
</I>&gt;<i> &gt; From: &quot;Olivier Gaumond&quot; &lt;<A HREF="mailto:ogaumond@yahoo.com">ogaumond@yahoo.com</A>&gt;
</I>&gt;<i> &gt; To: &lt;<A HREF="mailto:mono-list@lists.ximian.com">mono-list@lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; Sent: 2003-05-21 03:37
</I>&gt;<i> &gt; Subject: [Mono-list] Problem with ODBC Driver
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I created the following table in MySQL test database
</I>&gt;<i> &gt; &gt; create table employee (firstname varchar(32), lastname varchar(32));
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I can retrieve data from the database with the Mono.Data.MySql provider
</I>but
&gt;<i> &gt; not
</I>&gt;<i> &gt; &gt; with the ODBC provider.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I have unixODBC and MyODBC installed and working and I added a DSN to
</I>&gt;<i> &gt; connect
</I>&gt;<i> &gt; &gt; to the database.  I can succesfully test the DSN and connection with
</I>&gt;<i> &gt; unixODBC
</I>&gt;<i> &gt; &gt; DataManager.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; To avoid errors when testing with Mono I had to symlink
</I>&gt;<i> &gt; /usr/local/libodbc32.so
</I>&gt;<i> &gt; &gt; to /usr/local/libodbc.so and export LD_LIBRARY_PATH=/usr/local/lib
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Here are the tests I made in sqlsharp to demonstrate the errors.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; With the Mono.Data.MySql provider
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# \Provider MySql
</I>&gt;<i> &gt; &gt; The default Provider is LOADEXTPROVIDER
</I>&gt;<i> &gt; &gt;           Assembly: Mono.Data.MySql
</I>&gt;<i> &gt; &gt;   Connection Class: Mono.Data.MySql.MySqlConnection
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# \ConnectionString
</I>&gt;<i> &gt; SERVER=localhost;DATABASE=test;UID=test;PASSWORD=test;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# \Open
</I>&gt;<i> &gt; &gt; Attempt to open connection...
</I>&gt;<i> &gt; &gt; Loading external provider...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ** (sqlsharp.exe:7934): WARNING **: Failed to load function my_thread_end
</I>&gt;<i> &gt; from
</I>&gt;<i> &gt; &gt; libmySQL
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ** (sqlsharp.exe:7934): WARNING **: Failed to load function my_thread_end
</I>&gt;<i> &gt; from
</I>&gt;<i> &gt; &gt; libmySQL
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ** (sqlsharp.exe:7934): WARNING **: Failed to load function
</I>my_thread_init
&gt;<i> &gt; from
</I>&gt;<i> &gt; &gt; libmySQL
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ** (sqlsharp.exe:7934): WARNING **: Failed to load function
</I>my_thread_init
&gt;<i> &gt; from
</I>&gt;<i> &gt; &gt; libmySQL
</I>&gt;<i> &gt; &gt; External provider loaded.
</I>&gt;<i> &gt; &gt; Open was successfull.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# SELECT * FROM employee;
</I>&gt;<i> &gt; &gt; Execute SQL: SELECT * FROM employee;
</I>&gt;<i> &gt; &gt; Display any result sets...
</I>&gt;<i> &gt; &gt; Display the result set 1
</I>&gt;<i> &gt; &gt; Fields in Query Result: 2
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; firstname lastname
</I>&gt;<i> &gt; &gt; ========= ========
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Joe       Bloe
</I>&gt;<i> &gt; &gt; John      Smith
</I>&gt;<i> &gt; &gt; Scott     Tiger
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Rows retrieved: 3
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ----
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; With the ODBC Driver
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# \Provider odbc
</I>&gt;<i> &gt; &gt; The default Provider is ODBC
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# \ConnectionString DSN=test;UID=test;PWD=test;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# \Open
</I>&gt;<i> &gt; &gt; Attempt to open connection...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; ** (sqlsharp.exe:7934): WARNING **: byref boolean marshalling not
</I>&gt;<i> &gt; inplemented
</I>&gt;<i> &gt; &gt; Open was successfull.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; SQL# SELECT * FROM employee;
</I>&gt;<i> &gt; &gt; Execute SQL: SELECT * FROM employee;
</I>&gt;<i> &gt; &gt; Display any result sets...
</I>&gt;<i> &gt; &gt; Display the result set 1
</I>&gt;<i> &gt; &gt; Fields in Query Result: 2
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; firstname           lastname
</I>&gt;<i> &gt; &gt; =================== ===================
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Error: System.InvalidCastException: Cannot cast from source type to
</I>&gt;<i> &gt; destination
</I>&gt;<i> &gt; &gt; type
</I>&gt;<i> &gt; &gt; in &lt;0x0002f&gt; 00 System.Data.Odbc.OdbcDataReader:GetDateTime (int)
</I>&gt;<i> &gt; &gt; in &lt;0x0083e&gt; 00 Mono.Data.SqlSharp.SqlSharpCli:DisplayResult
</I>&gt;<i> &gt; &gt; (System.Data.IDataReader,System.Data.DataTable)
</I>&gt;<i> &gt; &gt; in &lt;0x00028&gt; 00 Mono.Data.SqlSharp.SqlSharpCli:OutputQueryResult
</I>&gt;<i> &gt; &gt; (System.Data.IDataReader,System.Data.DataTable)
</I>&gt;<i> &gt; &gt; in &lt;0x000d7&gt; 00 Mono.Data.SqlSharp.SqlSharpCli:DisplayData
</I>&gt;<i> &gt; &gt; (System.Data.IDataReader)
</I>&gt;<i> &gt; &gt; in &lt;0x00106&gt; 00 Mono.Data.SqlSharp.SqlSharpCli:ExecuteSql (string)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The driver seems to always return DateTime from GetFieldType().
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; To run the sample from <A HREF="http://www.go-mono.com/odbc.html">http://www.go-mono.com/odbc.html</A> I had to change
</I>two
&gt;<i> &gt; &gt; lines
</I>&gt;<i> &gt; &gt; string FirstName = reader[&quot;firstname&quot;];
</I>&gt;<i> &gt; &gt; string LastName = reader[&quot;lastname&quot;];
</I>&gt;<i> &gt; &gt; to
</I>&gt;<i> &gt; &gt; string FirstName = reader.GetString(0);
</I>&gt;<i> &gt; &gt; string LastName = reader.GetString(1);
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Should I fill a bug report about that?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Olivier
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; __________________________________________________________
</I>&gt;<i> &gt; &gt; Lèche-vitrine ou lèche-écran ?
</I>&gt;<i> &gt; &gt; magasinage.yahoo.ca
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i> __________________________________________________________
</I>&gt;<i> Lèche-vitrine ou lèche-écran ?
</I>&gt;<i> magasinage.yahoo.ca
</I>&gt;<i>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="014064.html">[Mono-list] Problem with ODBC Driver
</A></li>
	<LI> Next message: <A HREF="014066.html">[Mono-list] Building a layer beetween buisiness logic and GUI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14065">[ date ]</a>
              <a href="thread.html#14065">[ thread ]</a>
              <a href="subject.html#14065">[ subject ]</a>
              <a href="author.html#14065">[ author ]</a>
         </LI>
       </UL>
</body></html>
