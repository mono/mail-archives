<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] 'make test' fails in mono/tests with cygwin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001713.html">
   <LINK REL="Next"  HREF="001719.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] 'make test' fails in mono/tests with cygwin
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40debian.org"
       TITLE="[Mono-list] 'make test' fails in mono/tests with cygwin">lupus@debian.org
       </A><BR>
    <I>Fri, 28 Sep 2001 15:30:24 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="001713.html">[Mono-list] 'make test' fails in mono/tests with cygwin
</A></li>
        <LI> Next message: <A HREF="001719.html">[Mono-list] 'make test' fails in mono/tests with cygwin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1718">[ date ]</a>
              <a href="thread.html#1718">[ thread ]</a>
              <a href="subject.html#1718">[ subject ]</a>
              <a href="author.html#1718">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/27/01 Brian Jepson wrote:
&gt;<i> I've incorporated the patch, but I'm still having trouble. It seems that
</I>&gt;<i> mint is looking for libraries but can't find them:
</I>&gt;<i> 
</I>&gt;<i> $ mint delegate.exe
</I>&gt;<i> 
</I>&gt;<i>   ** ERROR **: Failed to load library libmonowrapper.so (monowrapper)
</I>&gt;<i>   aborting...
</I>&gt;<i>       0 [sig] mint 260 open_stackdumpfile: Dumping stack trace to
</I>&gt;<i>       mint.exe.stackdump
</I>&gt;<i>       Aborted (core dumped)
</I>&gt;<i> 
</I>&gt;<i>   $ mint array.exe
</I>&gt;<i> 
</I>&gt;<i>   ** ERROR **: Failed to load library libc.so.6 (libc.so.6)
</I>&gt;<i>   aborting...
</I>&gt;<i>       0 [sig] mint 940 open_stackdumpfile: Dumping stack trace to
</I>&gt;<i>       mint.exe.stackdump
</I>&gt;<i>       Aborted (core dumped)
</I>
As I said, the tests that use delegates, internalcalls and P/Invoke
don't work yet on cygwin, the following patch may help some, but
there are some things missing: libmonowrapper should be built as a
DLL, the corlib should be built for cygwin, the DLL mapping may need
to be changed etc.
It would be good if someone that actually uses win32 could step forward
and give an hand fixing this (small) issues.
I'll also make sure the next snapshot handles the missing functions
more gracefully with an exception.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better

--- metadata/loader.c	Thu Sep 27 19:11:23 2001
+++ /mnt/net/tmp/mono-0.7/mono/metadata/loader.c	Fri Sep 28 15:07:12 2001
@@ -33,6 +33,9 @@
 
 MonoDefaults mono_defaults;
 
+#ifdef __CYGWIN__
+#define mono_map_dll(name) (name)
+#else
 static char *dll_map[] = {
 	&quot;libc&quot;, &quot;libc.so.6&quot;,
 	&quot;libm&quot;, &quot;libm.so.6&quot;,
@@ -53,6 +56,7 @@
 
 	return name;
 }
+#endif
 
 void
 mono_init (void)
@@ -385,9 +389,11 @@
 
 	mh-&gt;addr = NULL;
 	if (!gmodule) {
-		g_warning (&quot;Failed to load library %s (%s)&quot;, full_name, scope);
-		g_free (full_name);
-		return;
+		if (!(gmodule=g_module_open (scope, G_MODULE_BIND_LAZY))) {
+			g_warning (&quot;Failed to load library %s (%s)&quot;, full_name, scope);
+			g_free (full_name);
+			return;
+		}
 	}
 	g_free (full_name);
 


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001713.html">[Mono-list] 'make test' fails in mono/tests with cygwin
</A></li>
	<LI> Next message: <A HREF="001719.html">[Mono-list] 'make test' fails in mono/tests with cygwin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1718">[ date ]</a>
              <a href="thread.html#1718">[ thread ]</a>
              <a href="subject.html#1718">[ subject ]</a>
              <a href="author.html#1718">[ author ]</a>
         </LI>
       </UL>
</body></html>
