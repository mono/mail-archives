<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono on Linux and Missing methods
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%20on%20Linux%20and%20Missing%20methods&In-Reply-To=%3CCAJzb9Z%2By9rHf7%2Bd5X1wZMyCzFmzv82O6vfJpA3kjj4%2BiozTZhg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="051716.html">
   <LINK REL="Next"  HREF="051723.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono on Linux and Missing methods</H1>
    <B>Zacharia Karami</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%20on%20Linux%20and%20Missing%20methods&In-Reply-To=%3CCAJzb9Z%2By9rHf7%2Bd5X1wZMyCzFmzv82O6vfJpA3kjj4%2BiozTZhg%40mail.gmail.com%3E"
       TITLE="[Mono-list] Mono on Linux and Missing methods">heatedphoenix at gmail.com
       </A><BR>
    <I>Fri May 29 11:29:45 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="051716.html">[Mono-list] Mono on Linux and Missing methods
</A></li>
        <LI>Next message: <A HREF="051723.html">[Mono-list] Mono on Linux and Missing methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51722">[ date ]</a>
              <a href="thread.html#51722">[ thread ]</a>
              <a href="subject.html#51722">[ subject ]</a>
              <a href="author.html#51722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To finalize this voyage into missing methods, here's my fix for any future
(would-be) users of MapToIPv4/6.


namespace ExtensionMethods
&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> public static class IPextension
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> internal static object GetInstanceField (Type type, object instance,
</I>&gt;&gt;<i> string fieldName)//Steals private values from classes
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> BindingFlags bindFlags = BindingFlags.Instance | BindingFlags.Public |
</I>&gt;&gt;<i> BindingFlags.NonPublic
</I>&gt;<i>
</I>&gt;<i>                          | BindingFlags.Static;
</I>&gt;<i>
</I>&gt;<i> FieldInfo field = type.GetField (fieldName, bindFlags);
</I>&gt;<i>
</I>&gt;<i> return field.GetValue (instance);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> public static IPAddress MapToIPv4 (this IPAddress ipa)
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> ushort[] m_Numbers = GetInstanceField (typeof(IPAddress), ipa,
</I>&gt;&gt;<i> &quot;m_Numbers&quot;) as ushort[];
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> foreach (ushort u in m_Numbers) {
</I>&gt;<i>
</I>&gt;<i> Console.WriteLine (u);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> if (ipa.AddressFamily == AddressFamily.InterNetwork)
</I>&gt;<i>
</I>&gt;<i> return ipa;
</I>&gt;<i>
</I>&gt;<i> if (ipa.AddressFamily != AddressFamily.InterNetworkV6)
</I>&gt;<i>
</I>&gt;<i> throw new Exception (&quot;Only AddressFamily.InterNetworkV6 can be converted
</I>&gt;&gt;<i> to IPv4&quot;);
</I>&gt;<i>
</I>&gt;<i>  //Test for 0000 0000 0000 0000 0000 FFFF xxxx xxxx
</I>&gt;<i>
</I>&gt;<i> for (int i = 0; i &lt; 5; i++) {
</I>&gt;<i>
</I>&gt;<i> if (m_Numbers[i] != 0x0000)
</I>&gt;<i>
</I>&gt;<i> throw new Exception (&quot;Address does not have the ::FFFF prefix&quot;);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> if (m_Numbers [5] != 0xFFFF)
</I>&gt;<i>
</I>&gt;<i> throw new Exception (&quot;Address does not have the ::FFFF prefix&quot;);
</I>&gt;<i>
</I>&gt;<i>  //We've got an IPv4 address
</I>&gt;<i>
</I>&gt;<i> byte[] ipv4Bytes = new byte [4];
</I>&gt;<i>
</I>&gt;<i> Buffer.BlockCopy (m_Numbers, 12, ipv4Bytes, 0, 4);
</I>&gt;<i>
</I>&gt;<i> return new IPAddress (ipv4Bytes);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> public static IPAddress MapToIPv6 (this IPAddress ipa)
</I>&gt;<i>
</I>&gt;<i> {
</I>&gt;<i>
</I>&gt;<i> if (ipa.AddressFamily == AddressFamily.InterNetworkV6)
</I>&gt;<i>
</I>&gt;<i> return ipa;
</I>&gt;<i>
</I>&gt;<i> if (ipa.AddressFamily != AddressFamily.InterNetwork)
</I>&gt;<i>
</I>&gt;<i> throw new Exception (&quot;Only AddressFamily.InterNetworkV4 can be converted
</I>&gt;&gt;<i> to IPv6&quot;);
</I>&gt;<i>
</I>&gt;<i>  byte[] ipv4Bytes = ipa.GetAddressBytes ();
</I>&gt;<i>
</I>&gt;<i> byte[] ipv6Bytes = new byte [16] {
</I>&gt;<i>
</I>&gt;<i> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xFF, 0xFF,
</I>&gt;<i>
</I>&gt;<i> ipv4Bytes [0], ipv4Bytes [1], ipv4Bytes [2], ipv4Bytes [3]
</I>&gt;<i>
</I>&gt;<i> };
</I>&gt;<i>
</I>&gt;<i> return new IPAddress (ipv6Bytes);
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>Simply use the methods as you would in NET 4.5. Add &quot;using
ExtensionMethods&quot;.
Note, this steals the private values from IPAddress because that's how the
solution was implemented (it needs those values as the original solution
was made to be INSIDE the IPAddress class).

Credit obviously goes to the person who implemented the original solution.

Good luck &amp; regards,
Zack

On Fri, May 22, 2015 at 1:51 PM, Zacharia Karami &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">heatedphoenix at gmail.com</A>&gt;
wrote:

&gt;<i> Thank you, this is indeed the conclusion I stumbled upon right before your
</I>&gt;<i> previous email.
</I>&gt;<i>
</I>&gt;<i> My solution (for anyone else reading with this issue at some point) is to
</I>&gt;<i> just implement the patch as produced by someone for the Mono project myself
</I>&gt;<i> (as linked to here <A HREF="https://github.com/mono/mono/pull/641">https://github.com/mono/mono/pull/641</A>).
</I>&gt;<i>
</I>&gt;<i> Just turn it into an extension method for IPaddress and there you go. I'll
</I>&gt;<i> use your tip in the future, though.
</I>&gt;<i>
</I>&gt;<i> Thanks and regards,
</I>&gt;<i> Zacharia
</I>&gt;<i>
</I>&gt;<i> On Fri, May 22, 2015 at 1:42 PM, Edward Ned Harvey (mono) &lt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">edward.harvey.mono at clevertrove.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> &gt; From: Zacharia Karami [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">heatedphoenix at gmail.com</A>]
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &quot;It works in 4.5&quot; on Windows. But again, there is a problem (in so far
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Oh! Ok, I get it. You should check the mono class compatibility page.
</I>&gt;&gt;<i> Although *most* stuff in .Net is implemented in mono, there are areas where
</I>&gt;&gt;<i> things are known absent or broken. So whenever you encounter something like
</I>&gt;&gt;<i> this, which works in .Net and doesn't work in mono, always start by
</I>&gt;&gt;<i> checking the class status page.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> From <A HREF="http://mono-project.com,">http://mono-project.com,</A> Documentation, About Mono, Class Status,
</I>&gt;&gt;<i> Status.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here, you can browse the 4.5 column, System.Net.IPAddress, and the two
</I>&gt;&gt;<i> methods MapToIPv4 and MapToIPv6 are both marked as broken. There may be
</I>&gt;&gt;<i> more info somewhere about *why* it's broken and what needs to happen to fix
</I>&gt;&gt;<i> it, but that would be a discussion best for the mono-dev list, to assist in
</I>&gt;&gt;<i> fixing mono sources.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In this case, you have a definite answer. That method is definitely just
</I>&gt;&gt;<i> broken in mono, end of story. Your only solution is not to use that method
</I>&gt;&gt;<i> on mono... Hopefully there is a workaround you can use without suffering
</I>&gt;&gt;<i> too much pain.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20150529/a058ba89/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20150529/a058ba89/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="051716.html">[Mono-list] Mono on Linux and Missing methods
</A></li>
	<LI>Next message: <A HREF="051723.html">[Mono-list] Mono on Linux and Missing methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51722">[ date ]</a>
              <a href="thread.html#51722">[ thread ]</a>
              <a href="subject.html#51722">[ subject ]</a>
              <a href="author.html#51722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
