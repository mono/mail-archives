<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Problem with mono_arch_local_regalloc( )
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Piyush%20%20Garyali%22%20%3Cpiyush_garyali%40rediffmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="016911.html">
   <LINK REL="Next"  HREF="016914.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Problem with mono_arch_local_regalloc( )
   </H1>
    <B>Piyush  Garyali
    </B> 
    <A HREF="mailto:Piyush%20%20Garyali%22%20%3Cpiyush_garyali%40rediffmail.com"
       TITLE="[Mono-list] Problem with mono_arch_local_regalloc( )">Piyush  Garyali&quot; &lt;piyush_garyali@rediffmail.com
       </A><BR>
    <I>13 Nov 2003 15:03:48 -0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="016911.html">[Mono-list] GUI Library
</A></li>
        <LI> Next message: <A HREF="016914.html">[Mono-list] GUI Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16913">[ date ]</a>
              <a href="thread.html#16913">[ thread ]</a>
              <a href="subject.html#16913">[ subject ]</a>
              <a href="author.html#16913">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> This is a multipart mime message


--Next_1068735828---0-203.199.83.37-9941
Content-type: text/html;
	charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

&lt;P&gt;=0AHello, &lt;BR&gt;=0A&lt;BR&gt;=0AI found that the runtime was generating the foll=
owing runtime invoke code for Assembly.DoAssemblyLoad:&lt;BR&gt;=0A&lt;BR&gt;=0ARUNTIME=
 CODE FOR (wrapper runtime-invoke) System.AppDomain:DoAssemblyLoad (object,=
intptr,intptr)&lt;BR&gt;=0A IL_0000: ldarg.2&amp;nbsp;  &lt;BR&gt;=0A IL_0001: brfalse.s IL=
_0006&lt;BR&gt;=0A IL_0003: ldarg.2&amp;nbsp;  &lt;BR&gt;=0A IL_0004: ldnull&amp;nbsp; &amp;nbsp; &lt;=
BR&gt;=0A IL_0005: stind.i&amp;nbsp;  &lt;BR&gt;=0A IL_0006: ldarg.0&amp;nbsp;  &lt;BR&gt;=0A IL_0=
007: ldarg.1&amp;nbsp;  &lt;BR&gt;=0A IL_0008: ldind.i&amp;nbsp;  &lt;BR&gt;=0A IL_0009: ldftn&amp;=
nbsp; &amp;nbsp;  0x00000001&lt;BR&gt;=0A IL_000f: calli&amp;nbsp; &amp;nbsp;  0x00000002&lt;BR&gt;=
=0A IL_0014: ldnull&amp;nbsp; &amp;nbsp; &lt;BR&gt;=0A IL_0015: stloc.0&amp;nbsp;  &lt;BR&gt;=0A IL=
_0016: leave&amp;nbsp; &amp;nbsp;  IL_002b&lt;BR&gt;=0A IL_001b: pop&amp;nbsp; &amp;nbsp; &amp;nbsp; =
 &lt;BR&gt;=0A IL_001c: ldarg.2&amp;nbsp;  &lt;BR&gt;=0A IL_001d: ldc.i4.0&amp;nbsp; &lt;BR&gt;=0A IL=
_001e: cgt.un&amp;nbsp; &amp;nbsp; &lt;BR&gt;=0A IL_0020: endfilter &lt;BR&gt;=0A IL_0022: stlo=
c.1&amp;nbsp;  &lt;BR&gt;=0A IL_0023: ldarg.2&amp;nbsp;  &lt;BR&gt;=0A IL_0024: ldloc.1&amp;nbsp;  =
&lt;BR&gt;=0A IL_0025: stind.i&amp;nbsp;  &lt;BR&gt;=0A IL_0026: leave&amp;nbsp; &amp;nbsp;  IL_002=
b&lt;BR&gt;=0A IL_002b: ldloc.0&amp;nbsp;  &lt;BR&gt;=0A IL_002c: ret&lt;BR&gt;=0A&lt;BR&gt;=0ANow whil=
e this code is being compiled using mini_method_compile()--&amp;gt;mono_codegen=
()--&amp;gt;mono_arch_local_regalloc() something different is looked in the cpu=
-g4.h array instead of the code above:&lt;BR&gt;=0A&lt;BR&gt;=0A372: load_membase&lt;BR&gt;=
=0A312: compare_imm&lt;BR&gt;=0A59 : beq&lt;BR&gt;=0A372: load_membase&lt;BR&gt;=0A360: store=
_membase_imm&lt;BR&gt;=0A372: load_membase&lt;BR&gt;=0A361: store_membase_reg&lt;BR&gt;=0A372=
:<i> load_membase&lt;BR&gt;=0A372: load_membase&lt;BR&gt;=0A361: store_membase_reg&lt;BR&gt;=0A3=
</I>27: setregimm&lt;BR&gt;=0A40 : call&lt;BR&gt;=0A361: store_membase_reg&lt;BR&gt;=0A372: load_=
membase&lt;BR&gt;=0A326: setreg&lt;BR&gt;=0A372: load_membase&lt;BR&gt;=0A332: voidcall_reg&lt;B=
R&gt;=0A360: store_membase_reg&lt;BR&gt;=0A56 : br&lt;BR&gt;=0A551: start_handler&lt;BR&gt;=0A&lt;B=
R&gt;=0ANow in the &amp;quot;cpu-g4.h&amp;quot; the value assigned for &amp;quot;start_han=
dler&amp;quot; is &amp;quot;NULL&amp;quot; which make the following code inside mono_ar=
ch_local_regalloc() ..&lt;BR&gt;=0A&lt;BR&gt;=0A&amp;lt;snip&amp;gt;&lt;BR&gt;=0A..&lt;BR&gt;=0A&amp;nbsp; &amp;nbs=
p; &amp;nbsp;while(ins) {&lt;BR&gt;=0A&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp;spec =
=3D ins_spec[ins-&amp;gt;opcode];&lt;BR&gt;=0A&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp=
;..&lt;BR&gt;=0A&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp;if (spec[MONO_INST_SRC1])=
 {&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;BR&gt;=0A&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp;..&lt;BR&gt;=
=0A&amp;nbsp; &amp;nbsp; &amp;nbsp;}&lt;BR&gt;=0A&amp;lt;/snip&amp;gt;&lt;BR&gt;=0A&amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbs=
p; &amp;nbsp; &amp;nbsp;&lt;BR&gt;=0A.. to crash as spec becomes NULL and the if statemen=
t tries to access a null pointer. What I am surprised to find is that for t=
he RUNTIME INVOKE code for DoAssemblyLoad the instrcutions looked into the =
ins_spec[] array and completely different.&lt;BR&gt;=0A&lt;BR&gt;=0AIs there anything I=
 am missing in here ???&lt;BR&gt;=0A&lt;BR&gt;=0Aregards,&lt;BR&gt;=0Apg=0A&lt;/P&gt;=0A&lt;br&gt;&lt;br&gt;=0A=
&lt;A target=3D&quot;_blank&quot; HREF=3D&quot;<A HREF="http://clients.rediff.com/signature/track_sig.=">http://clients.rediff.com/signature/track_sig.=</A>
asp&quot;&gt;&lt;IMG SRC=3D&quot;<A HREF="http://ads.rediff.com/RealMedia/ads/adstream_nx.cgi/www.re=">http://ads.rediff.com/RealMedia/ads/adstream_nx.cgi/www.re=</A>
diffmail.com/<A HREF="mailto:inbox.htm@Bottom">inbox.htm@Bottom</A>&quot; BORDER=3D0 VSPACE=3D0 HSPACE=3D0 HEIGHT=3D74=
 WIDTH=3D496&gt;&lt;/a&gt;=0A
--Next_1068735828---0-203.199.83.37-9941
Content-type: text/plain;
	charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

Hello, =0A=0AI found that the runtime was generating the following runtime =
invoke code for Assembly.DoAssemblyLoad:=0A=0ARUNTIME CODE FOR (wrapper run=
time-invoke) System.AppDomain:DoAssemblyLoad (object,intptr,intptr)=0A IL_0=
000: ldarg.2   =0A IL_0001: brfalse.s IL_0006=0A IL_0003: ldarg.2   =0A IL_=
0004: ldnull    =0A IL_0005: stind.i   =0A IL_0006: ldarg.0   =0A IL_0007: =
ldarg.1   =0A IL_0008: ldind.i   =0A IL_0009: ldftn     0x00000001=0A IL_00=
0f: calli     0x00000002=0A IL_0014: ldnull    =0A IL_0015: stloc.0   =0A I=
L_0016: leave     IL_002b=0A IL_001b: pop       =0A IL_001c: ldarg.2   =0A =
IL_001d: ldc.i4.0  =0A IL_001e: cgt.un    =0A IL_0020: endfilter =0A IL_002=
2: stloc.1   =0A IL_0023: ldarg.2   =0A IL_0024: ldloc.1   =0A IL_0025: sti=
nd.i   =0A IL_0026: leave     IL_002b=0A IL_002b: ldloc.0   =0A IL_002c: re=
t=0A=0ANow while this code is being compiled using mini_method_compile()--&gt;=
mono_codegen()--&gt;mono_arch_local_regalloc() something different is looked i=
n the cpu-g4.h array instead of the code above:=0A=0A372: load_membase=0A31=
2: compare_imm=0A59 : beq=0A372: load_membase=0A360: store_membase_imm=0A37=
2: load_membase=0A361: store_membase_reg=0A372: load_membase=0A372: load_me=
mbase=0A361: store_membase_reg=0A327: setregimm=0A40 : call=0A361: store_me=
mbase_reg=0A372: load_membase=0A326: setreg=0A372: load_membase=0A332: void=
call_reg=0A360: store_membase_reg=0A56 : br=0A551: start_handler=0A=0ANow i=
n the &quot;cpu-g4.h&quot; the value assigned for &quot;start_handler&quot; is &quot;NULL&quot; which mak=
e the following code inside mono_arch_local_regalloc() ..=0A=0A&lt;snip&gt;=0A..=
=0A	while(ins) {=0A		spec =3D ins_spec[ins-&gt;opcode];=0A		..=0A		if (spec[MO=
NO_INST_SRC1]) {	=0A		..=0A	}=0A&lt;/snip&gt;=0A		=0A.. to crash as spec becomes =
NULL and the if statement tries to access a null pointer. What I am surpris=
ed to find is that for the RUNTIME INVOKE code for DoAssemblyLoad the instr=
cutions looked into the ins_spec[] array and completely different.=0A=0AIs =
there anything I am missing in here ???=0A=0Aregards,=0Apg
--Next_1068735828---0-203.199.83.37-9941--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="016911.html">[Mono-list] GUI Library
</A></li>
	<LI> Next message: <A HREF="016914.html">[Mono-list] GUI Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16913">[ date ]</a>
              <a href="thread.html#16913">[ thread ]</a>
              <a href="subject.html#16913">[ subject ]</a>
              <a href="author.html#16913">[ author ]</a>
         </LI>
       </UL>
</body></html>
