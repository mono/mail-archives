<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Problem with mono_arch_local_regalloc( ) on PPC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Piyush%20%20Garyali%22%20%3Cpiyush_garyali%40rediffmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="016936.html">
   <LINK REL="Next"  HREF="016941.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Problem with mono_arch_local_regalloc( ) on PPC
   </H1>
    <B>Piyush  Garyali
    </B> 
    <A HREF="mailto:Piyush%20%20Garyali%22%20%3Cpiyush_garyali%40rediffmail.com"
       TITLE="[Mono-list] Problem with mono_arch_local_regalloc( ) on PPC">Piyush  Garyali&quot; &lt;piyush_garyali@rediffmail.com
       </A><BR>
    <I>14 Nov 2003 17:22:54 -0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="016936.html">[Mono-list] .NET C# LDAP Libraray.
</A></li>
        <LI> Next message: <A HREF="016941.html">[Mono-list] Mono 0.28 SUSE 9 Binaries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16940">[ date ]</a>
              <a href="thread.html#16940">[ thread ]</a>
              <a href="subject.html#16940">[ subject ]</a>
              <a href="author.html#16940">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> This is a multipart mime message


--Next_1068830574---0-203.199.83.39-3969
Content-type: text/html;
	charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

&lt;P&gt;=0AHello,&lt;BR&gt;=0A&lt;BR&gt;=0ASorry for the last mail. It got all screwed by as=
 my internet mailer was adding HTML tags.&lt;BR&gt;=0A&lt;BR&gt;=0AComing back to the p=
oint, I was looking at the runtime invoke code generated for Assembly.DoAss=
emblyLoad(). (which comes from mono_domain_fire_assembly_load). Now while t=
he code is being compiled using mono_method_compile--&amp;gt;mono_codegen()--&amp;g=
t;mono_arch_local_regalloc() I found that the follwing instructions were lo=
oked up in the **ppcg4 array.&lt;BR&gt;=0A&lt;BR&gt;=0A372: load_membase&lt;BR&gt;=0A312: com=
pare_imm&lt;BR&gt;=0A59 : beq&lt;BR&gt;=0A..&lt;BR&gt;=0A..&lt;BR&gt;=0A..&lt;BR&gt;=0A56 : br&lt;BR&gt;=0A551:=
 start_handler&lt;BR&gt;=0A&amp;nbsp; &amp;nbsp;  ^^^^^^^^^^^^^&lt;BR&gt;=0A&lt;BR&gt;=0ANow in the &amp;=
quot;cpu-g4.h&amp;quot; the value assigned to &amp;quot;start_handler&amp;quot; is &amp;quo=
t;NULL&amp;quot; which makes the code inside the mono_arch_local_regalloc ..&lt;BR=
&gt;<i>=0A&lt;BR&gt;=0Awhile(ins) {&lt;BR&gt;=0A&amp;nbsp;  spec =3D ins_spec[ins-&amp;gt;opcode];&lt;BR=
</I>&gt;<i>=0A&amp;nbsp;  ..&lt;BR&gt;=0A&amp;nbsp;  if (spec[MONO_INST_SRC1]) {&lt;BR&gt;=0A&amp;nbsp;  ..&lt;B=
</I>R&gt;=0A}&lt;BR&gt;=0A&lt;BR&gt;=0A.. to crash as spec becomes NULL and the if block tried=
 to access a NULL pointer. After hacking the code to work around this excep=
tion, I later found the when the emitted code is run through mono_ldftn() t=
he MonoMethod *method is corrupted and it crashes again.&lt;BR&gt;=0A&lt;BR&gt;=0AIs th=
ere still some problem with the ppc emitter or I am missing something in he=
re.&lt;BR&gt;=0A&lt;BR&gt;=0Aany pointers would be appreciated.&lt;BR&gt;=0A&lt;BR&gt;=0Aregards,&lt;B=
R&gt;=0Agary&lt;BR&gt;=0A =0A&lt;/P&gt;=0A&lt;br&gt;&lt;br&gt;=0A&lt;A target=3D&quot;_blank&quot; HREF=3D&quot;<A HREF="http://c=">http://c=</A>
lients.rediff.com/signature/track_sig.asp&quot;&gt;&lt;IMG SRC=3D&quot;<A HREF="http://ads.rediff.co=">http://ads.rediff.co=</A>
m/RealMedia/ads/adstream_nx.cgi/www.rediffmail.com/<A HREF="mailto:inbox.htm@Bottom">inbox.htm@Bottom</A>&quot; BORDER=
=3D0 VSPACE=3D0 HSPACE=3D0 HEIGHT=3D74 WIDTH=3D496&gt;&lt;/a&gt;=0A
--Next_1068830574---0-203.199.83.39-3969
Content-type: text/plain;
	charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline

Hello,=0A=0ASorry for the last mail. It got all screwed by as my internet m=
ailer was adding HTML tags.=0A=0AComing back to the point, I was looking at=
 the runtime invoke code generated for Assembly.DoAssemblyLoad(). (which co=
mes from mono_domain_fire_assembly_load). Now while the code is being compi=
led using mono_method_compile--&gt;mono_codegen()--&gt;mono_arch_local_regalloc()=
 I found that the follwing instructions were looked up in the **ppcg4 array=
.=0A=0A372: load_membase=0A312: compare_imm=0A59 : beq=0A..=0A..=0A..=0A56 =
:<i> br=0A551: start_handler=0A     ^^^^^^^^^^^^^=0A=0ANow in the &quot;cpu-g4.h&quot; t=
</I>he value assigned to &quot;start_handler&quot; is &quot;NULL&quot; which makes the code inside =
the mono_arch_local_regalloc ..=0A=0Awhile(ins) {=0A   spec =3D ins_spec[in=
s-&gt;opcode];=0A   ..=0A   if (spec[MONO_INST_SRC1]) {=0A   ..=0A}=0A=0A.. to=
 crash as spec becomes NULL and the if block tried to access a NULL pointer=
. After hacking the code to work around this exception, I later found the w=
hen the emitted code is run through mono_ldftn() the MonoMethod *method is =
corrupted and it crashes again.=0A=0AIs there still some problem with the p=
pc emitter or I am missing something in here.=0A=0Aany pointers would be ap=
preciated.=0A=0Aregards,=0Agary=0A=20
--Next_1068830574---0-203.199.83.39-3969--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="016936.html">[Mono-list] .NET C# LDAP Libraray.
</A></li>
	<LI> Next message: <A HREF="016941.html">[Mono-list] Mono 0.28 SUSE 9 Binaries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16940">[ date ]</a>
              <a href="thread.html#16940">[ thread ]</a>
              <a href="subject.html#16940">[ subject ]</a>
              <a href="author.html#16940">[ author ]</a>
         </LI>
       </UL>
</body></html>
