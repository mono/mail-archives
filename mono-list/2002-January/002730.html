<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono vs. ASP.NET Design
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:totte%40labs2.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002728.html">
   <LINK REL="Next"  HREF="002731.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono vs. ASP.NET Design
   </H1>
    <B>Patrik Torstensson
    </B> 
    <A HREF="mailto:totte%40labs2.com"
       TITLE="[Mono-list] Mono vs. ASP.NET Design">totte@labs2.com
       </A><BR>
    <I>Sat, 12 Jan 2002 17:35:25 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="002728.html">[Mono-list] [Off topic?] Java Bytecode -&gt; IL Bytecode Compiler
</A></li>
        <LI> Next message: <A HREF="002731.html">[Mono-list] Mono vs. ASP.NET Design
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2730">[ date ]</a>
              <a href="thread.html#2730">[ thread ]</a>
              <a href="subject.html#2730">[ subject ]</a>
              <a href="author.html#2730">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------_=_NextPart_001_01C19B87.234D57CC
Content-Type: text/plain;
	charset=&quot;us-ascii&quot;
Content-Transfer-Encoding: quoted-printable

Hi All,

I have been looking into how to fix the ASP.NET support in Mono, my
focus has been on getting the runtime to work and I haven't look at the
parsing and everything that gets executed during a request. My first
goal is to get the runtime to work and make a good abstraction model
that also will make it possible to implement the Mono.WEB runtime on any
web server and still be compatible with existing ASP.Net applications
(without doing a complete reverse enginering of MS platform and the
current ASP.Net implementation). My suggestion is that we remove a
number of existing MS classes (both public and internal) that we have
done up to this point, the only classes we need to support are the one's
used by developers outside (and maybee inside) MS and not the ISAPI
implementation classes. There is a number of reasons for this but the
main one is of course that MS has not developed the framework to support
any other Web server.=20

This is my notes about Mono vs ASP.NET implementation (to become Mono
implementation I would say). I'm currently have developed the
HttpResponse, HttpRequest classes and also a number of the support
classes but they are not yet commited to Mono due to that need to fix
the startup and request flow first.

ASP.NET Startup flow
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D

Interfaces:
 IAppDomainFactory is exposed via COM interopt
 IISAPIRuntime interface is exposed via COM interopt (may be used to
ProccessRequest)

ASP.Net (Unmanaged code) uses the AppDomainFactory that it uses to
create the ISAPIRuntime class and from there aspnet_isapi.dll can then
use the IISAPIRuntime::ProcessRequest to execute a request, from that
point everything is in managed code (I think).

All the HTTP classes then uses a special unsafe managed class to talk to
the aspnet_isapi.dll, there also exists a safe managed class that uses
interopt for functions that don't need to be unsafe.

Mono Impl Aspects
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
I think all of the above interfaces and functions (all interfaces and
classes under Hosting) are not needed in the Mono implementation and I
think Microsoft should have made them Internal but probably other MS
projects are using the Worker implementations and therefore they are
public. They are not used by any developer right now and no developer
(outside MS) can really use them).

I think the Mono project should almost make the same implementation
except a few classes that we need to make more abstract to make it
possible to easy change web server implementation. I'm can implement
this if everyone agree's that we don't need to reverse engineer (or
should I say Copy) the undocumented MS way. This also includes the
internal of HttpRuntime (we only need to keep the public methods).

I would like to have a TCP/IP unmanged C code to kick of Mono runtime
and use a class (AppFactory) to get the IHttpRuntime interface that then
the unmanaged code can use to post requests. The AppFactory can then
provide different implementations depending on parameters (web server
type etc) and this is like the MS implementation but they have named the
interfaces like IISAPIRuntime with is not a good name.


ASP.NET Execution vs Mono impl
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D
This is not that complex, it executes a request via the
HttpRuntime::ProcessRequest(HttpWorkerRequest) and we should use the
same public methods here, we need to look at the security implementation
and the unmanaged callbacks (like mappath etc) but in the begining they
could be a managed class created via the same AppFactory as the
unmanaged code uses (and then different web servers can register
different unmanaged callback classes).

From there we need to implement the support for the IHttpHandler and
IHttpModule interfaces and all of the context classes (I have almost
implemented all of them except the App class).

Comments? I would like to kick this of, we need to have a number of
people also working on the System.Web.UI parser and executor that is the
next step. I'm planning of using a own web server (in C#) as test bed
for the classes. If I draw up the architecture and implement the basics
then the rest of the System.Web contributors can start doing the extra
functions ( a lot is still to be implemented) like the session handling,
caching, tracing and of course the the .ASPX execution (Page object in
System.Web.UI)

Best Regards
 Patrik Torstensson


------_=_NextPart_001_01C19B87.234D57CC
Content-Type: text/html;
	charset=&quot;us-ascii&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Dus-ascii&quot;&gt;
&lt;META NAME=3D&quot;Generator&quot; CONTENT=3D&quot;MS Exchange Server version =
6.0.5762.3&quot;&gt;
&lt;TITLE&gt;Mono vs. ASP.NET Design&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;!-- Converted from text/rtf format --&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;Hi All,&lt;/FONT&gt;
&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;I have been looking into how to fix =
the ASP.NET support in Mono, my focus has been on getting the runtime to =
work and I haven't look at the parsing and everything that gets executed =
during a request. My first goal is to get the runtime to work and make a =
good abstraction model that also will make it possible to implement the =
Mono.WEB runtime on any web server and still be compatible with existing =
ASP.Net applications (without doing a complete reverse enginering of MS =
platform and the current ASP.Net implementation). My suggestion is that =
we remove a number of existing MS classes (both public and internal) =
that we have done up to this point, the only classes we need to support =
are the one's used by developers outside (and maybee inside) MS and not =
the ISAPI implementation classes. There is a number of reasons for this =
but the main one is of course that MS has not developed the framework to =
support any other Web server. &lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;This is my notes about Mono vs =
ASP.NET implementation (to become Mono implementation I would say). I'm =
currently have developed the HttpResponse, HttpRequest classes and also =
a number of the support classes but they are not yet commited to Mono =
due to that need to fix the startup and request flow first.&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;ASP.NET Startup flow&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Verdana&quot;&gt;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D&lt;/FONT&gt;
&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;Interfaces:&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;&amp;nbsp;IAppDomainFactory is exposed =
via COM interopt&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;&amp;nbsp;IISAPIRuntime interface is =
exposed via COM interopt (may be used to ProccessRequest)&lt;/FONT&gt;
&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;ASP.Net (Unmanaged code) uses the =
AppDomainFactory that it uses to create the ISAPIRuntime class and from =
there aspnet_isapi.dll can then use the IISAPIRuntime::ProcessRequest to =
execute a request, from that point everything is in managed code (I =
think).&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;All the HTTP classes then uses a =
special unsafe managed class to talk to the aspnet_isapi.dll, there also =
exists a safe managed class that uses interopt for functions that don't =
need to be unsafe.&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;Mono Impl Aspects&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Verdana&quot;&gt;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;I think all of the above interfaces =
and functions (all interfaces and classes under Hosting) are not needed =
in the Mono implementation and I think Microsoft should have made them =
Internal but probably other MS projects are using the Worker =
implementations and therefore they are public. They are not used by any =
developer right now and no developer (outside MS) can really use =
them).&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;I think the Mono project should =
almost make the same implementation except a few classes that we need to =
make more abstract to make it possible to easy change web server =
implementation. I'm can implement this if everyone agree's that we don't =
need to reverse engineer (or should I say Copy) the undocumented MS way. =
This also includes the internal of HttpRuntime (we only need to keep the =
public methods).&lt;/FONT&gt;&lt;/P&gt;
&lt;BR&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;I would like to have a TCP/IP =
unmanged C code to kick of Mono runtime and use a class (AppFactory) to =
get the IHttpRuntime interface that then the unmanaged code can use to =
post requests. The AppFactory can then provide different implementations =
depending on parameters (web server type etc) and this is like the MS =
implementation but they have named the interfaces like IISAPIRuntime =
with is not a good name.&lt;/FONT&gt;&lt;/P&gt;
&lt;BR&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;ASP.NET Execution vs Mono impl&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Verdana&quot;&gt;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;This is not that complex, it =
executes a request via the =
HttpRuntime::ProcessRequest(HttpWorkerRequest) and we should use the =
same public methods here, we need to look at the security implementation =
and the unmanaged callbacks (like mappath etc) but in the begining they =
could be a managed class created via the same AppFactory as the =
unmanaged code uses (and then different web servers can register =
different unmanaged callback classes).&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;From there we need to implement the =
support for the IHttpHandler and IHttpModule interfaces and all of the =
context classes (I have almost implemented all of them except the App =
class).&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;Comments? I would like to kick this =
of, we need to have a number of people also working on the System.Web.UI =
parser and executor that is the next step. I'm planning of using a own =
web server (in C#) as test bed for the classes. If I draw up the =
architecture and implement the basics then the rest of the System.Web =
contributors can start doing the extra functions ( a lot is still to be =
implemented) like the session handling, caching, tracing and of course =
the the .ASPX execution (Page object in System.Web.UI)&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;Best Regards&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Verdana&quot;&gt;&amp;nbsp;Patrik Torstensson&lt;/FONT&gt;
&lt;/P&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
------_=_NextPart_001_01C19B87.234D57CC--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002728.html">[Mono-list] [Off topic?] Java Bytecode -&gt; IL Bytecode Compiler
</A></li>
	<LI> Next message: <A HREF="002731.html">[Mono-list] Mono vs. ASP.NET Design
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2730">[ date ]</a>
              <a href="thread.html#2730">[ thread ]</a>
              <a href="subject.html#2730">[ subject ]</a>
              <a href="author.html#2730">[ author ]</a>
         </LI>
       </UL>
</body></html>
