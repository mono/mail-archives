<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] GetUpdateCommand/ExecuteNonQuery adapter.Update
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20GetUpdateCommand/ExecuteNonQuery%20adapter.Update&In-Reply-To=649814.97084.qm%40web30804.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040657.html">
   <LINK REL="Next"  HREF="040649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] GetUpdateCommand/ExecuteNonQuery adapter.Update</H1>
    <B>Wolfgang Mauer</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20GetUpdateCommand/ExecuteNonQuery%20adapter.Update&In-Reply-To=649814.97084.qm%40web30804.mail.mud.yahoo.com"
       TITLE="[Mono-list] GetUpdateCommand/ExecuteNonQuery adapter.Update">W.Mauer at top-soft.info
       </A><BR>
    <I>Wed Dec 10 04:20:27 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="040657.html">[Mono-list] Mono code style guide with Visual Studio settings
</A></li>
        <LI>Next message: <A HREF="040649.html">[Mono-list] GetUpdateCommand/ExecuteNonQuery adapter.Update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40642">[ date ]</a>
              <a href="thread.html#40642">[ thread ]</a>
              <a href="subject.html#40642">[ subject ]</a>
              <a href="author.html#40642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for Help.
Now i use the factory from System.Data.
adapter.Update updates 0 records (values are changed!)
GetUpdateCommand throws a cast exception.
Now i write my own UpdateCommand :-((
something like this

public static DbCommand CreateUpdateCommand(DbProviderFactory factory, DataSet 
dataSet)
		{
			DbCommand updateCommand = factory.CreateCommand();
			if (dataSet.Tables.Count &gt; 1)
			{
				throw new InvalidOperationException(&quot;Nur eine Tabelle pro DataSet 
erlaubt!&quot;);
			}
			DataTable table = dataSet.Tables[0];
			string commandText = String.Format(&quot;UPDATE `{0}` SET&quot;, table.TableName);
			string whereText = &quot; WHERE&quot;;

			foreach (DataColumn column in table.Columns)
			{
				if (column.Unique)
				{
					whereText += String.Format(&quot; `{0}` = ?{0}&quot;, column.ColumnName);
				}
				else
				{
					commandText += String.Format(&quot; `{0}` = ?{0},&quot;, column.ColumnName);
				}
				DbParameter param = factory.CreateParameter();
				param.ParameterName = column.ColumnName;
				param.DbType = TypeConvertor.ToDbType(column.DataType);
				param.Value = dataSet.Tables[0].Rows[0][column.ColumnName];
				updateCommand.Parameters.Add(param);
			}
			commandText = commandText.Remove(commandText.Length -1);
			updateCommand.CommandText = commandText + whereText;
			return updateCommand;
		}

/Wolfgang

&gt;<i>Am Dienstag, 9. Dezember 2008 15:35:06 schrieb Daniel Morgan:
</I>&gt;<i> If you are using gmcs and the .net 2.0 profile or higher, you should be
</I>&gt;<i> using the built-in provider factories in System.Data.
</I>&gt;<i>
</I>&gt;<i> You would only use the provider factory stuff from Mono.Data if you are
</I>&gt;<i> using mcs and the .net  1.1 profile.  Mono.Data.ProviderFactory is
</I>&gt;<i> deprecated and should only be used with .net 1.1 software.
</I>&gt;<i>
</I>&gt;<i> DbcommandBuilder does not exist in the .net 1.1 profile.  DbCommandBuilder
</I>&gt;<i> is a data type found in the .net 2.0 profile; therefore, you should be
</I>&gt;<i> using the gmcs to compile and DbProviderFactory found in System.Data.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://msdn.microsoft.com/en-us/library/dd0w4a2z.aspx">http://msdn.microsoft.com/en-us/library/dd0w4a2z.aspx</A>
</I>&gt;<i>
</I>&gt;<i> --- On Tue, 12/9/08, Wolfgang Mauer &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">W.Mauer at top-soft.info</A>&gt; wrote:
</I>&gt;<i> &gt; From: Wolfgang Mauer &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">W.Mauer at top-soft.info</A>&gt;
</I>&gt;<i> &gt; Subject: [Mono-list]  GetUpdateCommand/ExecuteNonQuery adapter.Update
</I>&gt;<i> &gt; To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; Date: Tuesday, December 9, 2008, 7:18 AM
</I>&gt;<i> &gt; Hi all,
</I>&gt;<i> &gt; can someone can tell me what is the &quot;right&quot; way
</I>&gt;<i> &gt; to sync a dataset with the
</I>&gt;<i> &gt; database.
</I>&gt;<i> &gt; I have try'd some diffrent ways with MySql and Npgsql
</I>&gt;<i> &gt; but in all ways Update
</I>&gt;<i> &gt; was not possible.
</I>&gt;<i> &gt; the filling of a dataset was no problem.
</I>&gt;<i> &gt; i use the ProviderFactory from Mono.Data
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Just do a adapter.Update has no effect
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; with
</I>&gt;<i> &gt; CommandBuilder and GetUpdateCommand/ExecuteNonQuery
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Provider provider =
</I>&gt;<i> &gt; ProviderFactory.Providers[&quot;Mysql.Data&quot;];
</I>&gt;<i> &gt; DbCommandBuilder builder =
</I>&gt;<i> &gt; (DbCommandBuilder)provider.CreateCommandBuilder(this.adapter);
</I>&gt;<i> &gt; DbCommand updateCommand = builder.GetUpdateCommand();
</I>&gt;<i> &gt; exception =&gt; &quot;Cannot
</I>&gt;<i> &gt; cast from source to destination type&quot; ???????
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; the selectcommand of the adapter is valid an a adapte.fill
</I>&gt;<i> &gt; work right.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; any Help
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Top-Soft
</I>&gt;<i> &gt; Softwareentwicklung
</I>&gt;<i> &gt; Inhaber: Wolfgang Mauer
</I>&gt;<i> &gt; Reitesweg 9, 96103 Hallstadt
</I>&gt;<i> &gt; Tel.: +49 (0)951 / 2221520
</I>&gt;<i> &gt; Fax: +49 (0)951 / 2221521
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>


-- 
Top-Soft
Softwareentwicklung
Inhaber: Wolfgang Mauer
Reitesweg 9, 96103 Hallstadt
Tel.: +49 (0)951 / 2221520
Fax: +49 (0)951 / 2221521
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040657.html">[Mono-list] Mono code style guide with Visual Studio settings
</A></li>
	<LI>Next message: <A HREF="040649.html">[Mono-list] GetUpdateCommand/ExecuteNonQuery adapter.Update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40642">[ date ]</a>
              <a href="thread.html#40642">[ thread ]</a>
              <a href="subject.html#40642">[ subject ]</a>
              <a href="author.html#40642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
