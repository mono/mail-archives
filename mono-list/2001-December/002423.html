<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> Patches for CYGWIN, was Re: [Mono-list] Jit compiler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:david%40dawkins.st">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002422.html">
   <LINK REL="Next"  HREF="002424.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Patches for CYGWIN, was Re: [Mono-list] Jit compiler
   </H1>
    <B>David Dawkins
    </B> 
    <A HREF="mailto:david%40dawkins.st"
       TITLE="Patches for CYGWIN, was Re: [Mono-list] Jit compiler">david@dawkins.st
       </A><BR>
    <I>Thu, 20 Dec 2001 13:42:22 -0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="002422.html">[Mono-list] Jit compiler
</A></li>
        <LI> Next message: <A HREF="002424.html">Patches for CYGWIN, was Re: [Mono-list] Jit compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2423">[ date ]</a>
              <a href="thread.html#2423">[ thread ]</a>
              <a href="subject.html#2423">[ subject ]</a>
              <a href="author.html#2423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Make this patch to mono/metadata/image.c:

- Replace the  fopen() call in do_mono_image_open() with:
#if defined(__CYGWIN__)
    image-&gt;f  = fopen (fname, &quot;rb&quot;);   /* open binary */
#else
    image-&gt;f  = fopen (fname, &quot;r&quot;);
#endif

This will stop CRLF conversion; I'm guessing your cygwin
filesystem is mounted as &quot;textmode&quot; (type &quot;mount&quot;).

You'll probably need to disable the mmap() call in rawbuffer.c
too:

- Replace the call to mmap() with the following:

#if defined(__CYGWIN__)
 mmap_ptr = (char *) -1;
#else
 mmap_ptr = mmap (0, end - start, prot, flags, fd, start);
#endif

Someone else logged this issue, check out the list archives
for September (Sep 29th?). Seems there's a bug in mmap() still.

Rebuild everything, and see how far this gets you.

How do we get these patches applied, or at least reviewed?

Regards,
David

----- Original Message -----
From: &quot;adc&quot; &lt;<A HREF="mailto:shark@blueyonder.co.uk">shark@blueyonder.co.uk</A>&gt;
To: &lt;<A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>&gt;
Sent: Thursday, December 20, 2001 1:16 PM
Subject: [Mono-list] Jit compiler


&gt;<i> Hi,
</I>&gt;<i>  I have downloaded the latest anonCVS and I am trying to run the
</I>disassembler on some of the tests in the tests directory. Once I have
compiled these with the Microsoft C# compiler I execute, for example
&gt;<i> ./monodis ../tests/ackermann.exe
</I>&gt;<i>
</I>&gt;<i> but I recieve an error about an assertion in loader.c at line 73.
</I>&gt;<i> This assertion asserts that the assembly has been opened without error
</I>(which it obviously hasn't) the error appears to be happening in the
mono_image_open function in image.c. This seems to happen with every
executable I throw at it, even extremely simple programs.
&gt;<i>
</I>&gt;<i> Do we have some tests CLI executables which are loaded by the metadata
</I>library somewhere that I can get my hands on?
&gt;<i>
</I>&gt;<i> I ask as for my disertation I am going to investigate the worthiness of
</I>writing an assembler from CIL executables to native code executables, what
optimisations etc can be gained by the fact that we no longer have
compilation speed as a major restriction (obviously we don't want a compiler
that takes forever but it would then be of less concern).
&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@ximian.com">Mono-list@ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002422.html">[Mono-list] Jit compiler
</A></li>
	<LI> Next message: <A HREF="002424.html">Patches for CYGWIN, was Re: [Mono-list] Jit compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2423">[ date ]</a>
              <a href="thread.html#2423">[ thread ]</a>
              <a href="subject.html#2423">[ subject ]</a>
              <a href="author.html#2423">[ author ]</a>
         </LI>
       </UL>
</body></html>
