<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] List.FindAll method implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20List.FindAll%20method%20implementation&In-Reply-To=c3b5f930703181500h65bd335cn8af6b7688d79a8d6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034632.html">
   <LINK REL="Next"  HREF="034645.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] List.FindAll method implementation</H1>
    <B>Juan C. Olivares</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20List.FindAll%20method%20implementation&In-Reply-To=c3b5f930703181500h65bd335cn8af6b7688d79a8d6%40mail.gmail.com"
       TITLE="[Mono-list] List.FindAll method implementation">juancri at gmail.com
       </A><BR>
    <I>Mon Mar 19 02:51:26 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="034632.html">[Mono-list] List.FindAll method implementation
</A></li>
        <LI>Next message: <A HREF="034645.html">[Mono-list] List.FindAll method implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34639">[ date ]</a>
              <a href="thread.html#34639">[ thread ]</a>
              <a href="subject.html#34639">[ subject ]</a>
              <a href="author.html#34639">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I followed some instructions from Miguel and here we have this brand new
patch.

It uses the new algorithm bits-on-stack for
System.Collections.Generic.List&lt;T&gt;::FindAll
(Predicate). This algorithm stores a group of uint's in the stack and uses
their bits as flags.

Because there's no way to know the size of the stack in any moment in time,
Miguel suggested me to limit this new method to use only 8KB of the stack...
so it will be useful for list with 8 * 1024 * 8 elements or less. Bigger
lists will use the old algorithm.

It also includes few testcases.

Juan C. Olivares
www.juancri.com

On 3/18/07, Juan C. Olivares &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">juancri at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> I'll check...
</I>&gt;<i>
</I>&gt;<i> Juan Crist&#243;bal Olivares
</I>&gt;<i> www.juancri.com
</I>&gt;<i>
</I>&gt;<i> On 3/18/07, Miguel de Icaza &lt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">miguel at novell.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hello,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     I feel a bit strange that the bools are allocated using
</I>&gt;<i> &gt; numbers.Count but the loop uses this._items.   I rather keep them in
</I>&gt;<i> &gt; parallel.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Also, another idea might be to use three code paths depending on the
</I>&gt;<i> &gt; number of items:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         * [0,N] use bools.
</I>&gt;<i> &gt;         * [N,M] use bitbools.
</I>&gt;<i> &gt;         * [M,infinity] use the old method.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Thread stacks could not be very large, and you would like to avoid a
</I>&gt;<i> &gt; crash in that condition.   Actually, I wonder if stackalloc returns a
</I>&gt;<i> &gt; null if the requested size is larger than the available stack.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Miguel.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Attached.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Juan C. Olivares
</I>&gt;<i> &gt; &gt; www.juancri.com
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 3/18/07, Miguel de Icaza &lt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">miguel at novell.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt;         Hello,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;         &gt;
</I>&gt;<i> &gt; &gt;         &gt; Do you have any comment?. I could send a patch...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;         These numbers look fantastic.   We would love to see a patch.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;         &gt; best regards
</I>&gt;<i> &gt; &gt;         &gt;
</I>&gt;<i> &gt; &gt;         &gt; Juan C. Olivares
</I>&gt;<i> &gt; &gt;         &gt; www.juancri.com
</I>&gt;<i> &gt; &gt;         &gt;
</I>&gt;<i> &gt; &gt;         &gt;
</I>&gt;<i> &gt; &gt;         &gt;
</I>&gt;<i> &gt; &gt;         &gt; _______________________________________________
</I>&gt;<i> &gt; &gt;         &gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt;         &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mono-list maillist  -   <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070319/024d0caf/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20070319/024d0caf/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: list.patch
Type: text/x-patch
Size: 4113 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070319/024d0caf/attachment.bin">http://lists.ximian.com/pipermail/mono-list/attachments/20070319/024d0caf/attachment.bin</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034632.html">[Mono-list] List.FindAll method implementation
</A></li>
	<LI>Next message: <A HREF="034645.html">[Mono-list] List.FindAll method implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34639">[ date ]</a>
              <a href="thread.html#34639">[ thread ]</a>
              <a href="subject.html#34639">[ subject ]</a>
              <a href="author.html#34639">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
