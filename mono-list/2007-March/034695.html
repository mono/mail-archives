<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Calling a dll from ASP.Net under XSP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Calling%20a%20dll%20from%20ASP.Net%20under%20XSP&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034697.html">
   <LINK REL="Next"  HREF="034699.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Calling a dll from ASP.Net under XSP</H1>
    <B>Vincent Finn</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Calling%20a%20dll%20from%20ASP.Net%20under%20XSP&In-Reply-To="
       TITLE="[Mono-list] Calling a dll from ASP.Net under XSP">vincent.finn at riverdocs.com
       </A><BR>
    <I>Thu Mar 22 08:16:55 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="034697.html">[Mono-list] Exception in Mono
</A></li>
        <LI>Next message: <A HREF="034699.html">[Mono-list] Ignoring NullReferenceExceptions from Mono in gdb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34695">[ date ]</a>
              <a href="thread.html#34695">[ thread ]</a>
              <a href="subject.html#34695">[ subject ]</a>
              <a href="author.html#34695">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am running mono on windows.

I have a simple ASP.Net form with a text box, a label, and a button.
When the button is pressed it calls a dll that takes the text from the 
text box and returns a new string to replace it and the size of the new 
string is returned as well for debugging purposes.

This all works fine when running the page under the .Net framework but 
running under XSP causes a strange result.

The size value of the string returned is what I expect (matches .Net) 
and suggests that the dll is working properly but the string itself is 
always only one character long.

Can anyone tell me what I am doing wrong.

	Vin

Here is the code

////////////////////////////////////////
// C#
public partial class _Default : System.Web.UI.Page
{
[DllImport(&quot;C:/interop/release/Controller.dll&quot;, EntryPoint = &quot;Execute&quot;)]
private static extern void Execute([MarshalAs(UnmanagedType.LPWStr), In] 
string commandIn, [MarshalAs(UnmanagedType.LPWStr), Out] out string 
commandOut, out int size);

protected void Button1_Click(object sender, EventArgs e)
{
   string commandOut;
   int stringSize;
   Execute(TextBox1.Text, out commandOut, out stringSize);
   TextBox1.Text = commandOut;
   Label1.Text = stringSize.ToString() + &quot;:&quot; +
     commandOut.Length.ToString();
}

/////////////////////////////////////
// C++
void Execute(wchar_t* pIn, wchar_t*&amp; pOut, int* pSize)
{
   std::wstring test = pIn;
   test = test + test + test;
   test += L'\0';
	
   const unsigned int c_size = sizeof(wchar_t) * test.size();
   *pSize = c_size;
   pOut = reinterpret_cast&lt;wchar_t*&gt;(malloc(c_size));
   std::copy(test.begin(), test.end(), pOut);
}

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034697.html">[Mono-list] Exception in Mono
</A></li>
	<LI>Next message: <A HREF="034699.html">[Mono-list] Ignoring NullReferenceExceptions from Mono in gdb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34695">[ date ]</a>
              <a href="thread.html#34695">[ thread ]</a>
              <a href="subject.html#34695">[ subject ]</a>
              <a href="author.html#34695">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
