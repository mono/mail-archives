<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Adding Solaris/amd64 support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Adding%20Solaris/amd64%20support&In-Reply-To=1173143045.6580.46.camel%40erandi.dom">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034465.html">
   <LINK REL="Next"  HREF="034476.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Adding Solaris/amd64 support</H1>
    <B>Andreas F&#228;rber</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Adding%20Solaris/amd64%20support&In-Reply-To=1173143045.6580.46.camel%40erandi.dom"
       TITLE="[Mono-list] Adding Solaris/amd64 support">andreas.faerber at web.de
       </A><BR>
    <I>Tue Mar  6 03:58:36 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="034465.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
        <LI>Next message: <A HREF="034476.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34469">[ date ]</a>
              <a href="thread.html#34469">[ thread ]</a>
              <a href="subject.html#34469">[ subject ]</a>
              <a href="author.html#34469">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Miguel,

Thanks for the quick reply!

&gt;&gt;<i> By default, Solaris' gcc compiles to 32-bit unless overwritten by -
</I>&gt;&gt;<i> m64. I have therefore patched configure.in to infer the x86/amd64
</I>&gt;&gt;<i> architecture from the pointer size (as seen for another platform).
</I>&gt;<i>
</I>&gt;<i> This sounds like a choice that the Solaris gcc people thought  
</I>&gt;<i> should be
</I>&gt;<i> made explicitly.  Maybe we should do the same, and have a special
</I>&gt;<i> configure option that enables the 64 bit binary?
</I>
I adapted it from this snippet in configure.in:
	sparc*-*-*)
		if test &quot;x$ac_cv_sizeof_void_p&quot; = &quot;x8&quot;; then
		   TARGET=SPARC64
		else
			TARGET=SPARC
		fi
So that if I pass CFLAGS=-m64 it compiles 64-bit amd64 or otherwise  
32-bit x86.

Of course you/we could change this behavior. My personal opinion on  
this is that I don't like this approach at all - I would favor an  
approach where this is decided at compile time using the defines  
__x86_64__ etc. Would it not be possible to set up a header to do #if  
defined(__x86_64) #define TARGET AMD64 or similar? That would also  
facilitate cross-compiling e.g. Mac OS X universal or Unix to Symbian.

&gt;&gt;<i> ** ERROR **: file mini-amd64.c: line 180 (amd64_patch): assertion
</I>&gt;&gt;<i> failed: (amd64_is_imm32 (disp))
</I>&gt;&gt;<i> aborting...
</I>&gt;&gt;<i> Stacktrace:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Abbrechen - Speicherabbild 'core' geschrieben
</I>&gt;<i>
</I>&gt;<i> You could turn the above into a G_BREAKPOINT and with the debugger see
</I>&gt;<i> what it is trying to decode (you cause x/20i address on the address to
</I>&gt;<i> see the disassembled instruction).
</I>
Unfortunately I've never needed to debug on Unix except in Xcode but  
if you or someone else walks me through this I'd be happy to provide  
any output. How do I turn it into a G_BREAKPOINT? What tools do I  
need to use? Dtrace? gdb? What parameters, prompts etc.?

Andreas
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034465.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
	<LI>Next message: <A HREF="034476.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34469">[ date ]</a>
              <a href="thread.html#34469">[ thread ]</a>
              <a href="subject.html#34469">[ subject ]</a>
              <a href="author.html#34469">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
