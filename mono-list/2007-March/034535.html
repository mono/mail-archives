<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Adding Solaris/amd64 support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Adding%20Solaris/amd64%20support&In-Reply-To=794C9EAD-527C-4D4B-AAE8-688D62F32B72%40web.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034532.html">
   <LINK REL="Next"  HREF="034544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Adding Solaris/amd64 support</H1>
    <B>Andreas F&#228;rber</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Adding%20Solaris/amd64%20support&In-Reply-To=794C9EAD-527C-4D4B-AAE8-688D62F32B72%40web.de"
       TITLE="[Mono-list] Adding Solaris/amd64 support">andreas.faerber at web.de
       </A><BR>
    <I>Sat Mar 10 12:50:21 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="034532.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
        <LI>Next message: <A HREF="034544.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34535">[ date ]</a>
              <a href="thread.html#34535">[ thread ]</a>
              <a href="subject.html#34535">[ subject ]</a>
              <a href="author.html#34535">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Paolo,

Sorry for the monologue...

&gt;&gt;<i> If configured [...] --with-
</I>&gt;&gt;<i> gc=included I get a segmentation fault:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> GC Warning: Large stack limit(10485760): only scanning 8 MB
</I>&gt;&gt;<i> Segmentierungsfehler - Speicherabbild 'core' geschrieben
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> gdb refers to libgc's GC_SysVGetDataStart
</I>
&gt;<i> I added some debug output to GC_SysVGetDataStart and it appears to
</I>&gt;<i> return okay, that is it returns 0x64d000 (which it gets by calling
</I>&gt;<i> GC_find_limit(0x66a778, FALSE). I tried patching GC_find_limit to
</I>&gt;<i> match CVS (a boundary check was added) to no avail, also adding some
</I>&gt;<i> new assertions for the signal handling but they do not fail.
</I>&gt;<i>
</I>&gt;<i> Maybe gdb is simply confused because of the SIGSEGV signal handler in
</I>&gt;<i> GC_SysVGetDataStart and does not show where the actual segfault
</I>&gt;<i> happens? Are there any options or commands that might help?
</I>
I've discovered the &quot;continue&quot; command in gdb, which confirmed that  
the reported SIGSEGV is the normal operation of GC_SysVGetDataStart.  
The problem instead turned out to be GC_pthread_detach: Mono appears  
to use the Boehm GC 6.6, and in 6.8 this function has apparently been  
removed for Solaris. If I comment it out, Mono compiles fine and does  
not segfault!

I also found out where the GC warning is originating from: libgc/ 
solaris_threads.c defines MAX_ORIG_STACK_SIZE as 8 MB and uses this  
as an upper limit, emitting the warning if above. The code even  
documents that on Solaris/Intel this value is larger but a) only  
calculates this differing limit for I386 (not X86_64) and b) the  
calculation appears to be broken on both platforms under certain  
circumstances. It adds USRSTACK to the 8 MB but for I386 this does  
not fix it on this machine, and on X86_64 USRSTACK seems to be  
defined in terms of the undefined USERLIMIT which I haven't been able  
to locate. So as a personal workaround I have simply removed the  
limit on the value for now.

Would it make sense to update Mono's Boehm GC to 6.8, fixing the  
segfault? Or should we limit the changes to the Boehm GC in light of  
the new SGen-GC you're working on?

Andreas
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034532.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
	<LI>Next message: <A HREF="034544.html">[Mono-list] Adding Solaris/amd64 support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34535">[ date ]</a>
              <a href="thread.html#34535">[ thread ]</a>
              <a href="subject.html#34535">[ subject ]</a>
              <a href="author.html#34535">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
