<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Unhandled Exception: System.EntryPointNotFoundException:
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Unhandled%20Exception%3A%20System.EntryPointNotFoundException%3A&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034728.html">
   <LINK REL="Next"  HREF="034651.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Unhandled Exception: System.EntryPointNotFoundException:</H1>
    <B>William Huskey</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Unhandled%20Exception%3A%20System.EntryPointNotFoundException%3A&In-Reply-To="
       TITLE="[Mono-list] Unhandled Exception: System.EntryPointNotFoundException:">william.huskey at gmail.com
       </A><BR>
    <I>Mon Mar 19 18:39:50 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="034728.html">[Mono-list] Problems using a library.
</A></li>
        <LI>Next message: <A HREF="034651.html">[Mono-list] Unhandled	Exception:	System.EntryPointNotFoundException:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34647">[ date ]</a>
              <a href="thread.html#34647">[ thread ]</a>
              <a href="subject.html#34647">[ subject ]</a>
              <a href="author.html#34647">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have this program that uses kernel32.dll and I have linked the wine
kernel32.dll to help this, but I get the same error as below, is this not
doable, It was compile using Mono 2.0 on windows and runs under mono on
windows. is there a cross platform way of using
System.Runtime.InteropServices ?

Thanks for your time


Initializing Simulators...rting Simulation...

Unhandled Exception: System.EntryPointNotFoundException:
QueryPerformanceFrequency
  at (wrapper managed-to-native)
RTSTest.HiPerfTimer:QueryPerformanceFrequency (long&amp;)
  at RTSTest.HiPerfTimer..ctor () [0x00000]
  at RTSTest.MainClass.Main (System.String[] args) [0x00000]


the code is as follows



using System;
using System.Collections.Generic;
using System.Collections;
using System.Threading;
using System.Security.Cryptography;
using System.Runtime.InteropServices;
using System.ComponentModel;

namespace RTSTest
{
    class MainClass
    {
        private static List&lt;Simulator&gt; Simulators = new List&lt;Simulator&gt;();

        const int SimulatorCount = 64;
        const int IterationCount = 100;

        public static void Main(string[] args)
        {
            Console.WriteLine(&quot;Simulator Timing Prototype Application&quot;);
            Console.WriteLine(&quot;by Andrew Flanagan, March 15, 2007\n&quot;);
            Console.WriteLine(&quot;Initializing Simulators...&quot;);

            AutoResetEvent[] doneEvents = new
AutoResetEvent[SimulatorCount];

            for (int i = 0; i &lt; SimulatorCount; i++)
            {
                doneEvents[i] = new AutoResetEvent(false);
                Simulators.Add(new Simulator(&quot;Sim&quot; + (i + 1),
doneEvents[i]));
            }

            Console.WriteLine(&quot;Starting Simulation...&quot;);

            //Start the HPT
            HiPerfTimer mainLoopTimer = new HiPerfTimer();

            mainLoopTimer.Start();

            //Run for 10 iterations
            for (int i = 0; i &lt; IterationCount; i++)
            {
                HiPerfTimer subLoopTimer = new HiPerfTimer();

                subLoopTimer.Start();

                Console.WriteLine(&quot;\nStarting iteration &quot; + (i + 1) + &quot;:&quot;);
                foreach (Simulator sim in Simulators)
                {
                    ThreadPool.QueueUserWorkItem(sim.ThreadPoolCallback,
sim.Name);
                }

                WaitHandle.WaitAll(doneEvents);

                subLoopTimer.Stop();

                Console.WriteLine(&quot;All threads have completed.&quot;);

                Console.WriteLine(&quot;Here are the results:&quot;);
                foreach (Simulator sim in Simulators)
                {
                    Console.WriteLine(&quot;++SampleOutput is &quot; +
sim.keyValuePair[&quot;SampleOutput&quot;]);
                }

                Console.WriteLine(&quot;Total time for this iteration: {0}ms&quot;,
subLoopTimer.RoundedDuration);
            }

            mainLoopTimer.Stop();

            Console.WriteLine(&quot;\nDone.&quot;);
            Console.WriteLine(&quot;\nTotal run time: {0}ms&quot;,
mainLoopTimer.RoundedDuration);


            Console.ReadLine();
        }
    }

    #region Simulator Class

    class Simulator
    {
        public Dictionary&lt;string, object&gt; keyValuePair;

        private string SimulatorName;

        public string Name {get {return SimulatorName; }}

        private AutoResetEvent doneEvent;

        public Simulator(string Name, AutoResetEvent doneEvent)
        {
            keyValuePair = new Dictionary&lt;string, object&gt;();

            keyValuePair.Add(&quot;SampleOutput&quot;, 0);

            this.SimulatorName = Name;
            this.doneEvent = doneEvent;
        }

        public void ThreadPoolCallback(Object threadContext)
        {
            HiPerfTimer threadLoopTimer = new HiPerfTimer();
            threadLoopTimer.Start();

            string threadName = (string)threadContext;
           Console.WriteLine(&quot;++thread {0} started...&quot;, threadName);

            RandomNumberGenerator rng = RandomNumberGenerator.Create();
            byte[] byteArray = new byte[10];
            rng.GetNonZeroBytes(byteArray);

            int randomSampleOutput = 0;
            for (int i = 0; i &lt; 4; i++) {
                int shift = (4 - 1 - i) * 8;
                randomSampleOutput += (byteArray[i] &amp; 0x000000FF) &lt;&lt; shift;
            }

            Random rnd = new Random(randomSampleOutput);

            int SleepTime = Convert.ToInt16(rnd.NextDouble() * 5000);

            Thread.Sleep(SleepTime);

            this.keyValuePair[&quot;SampleOutput&quot;] = randomSampleOutput;

            threadLoopTimer.Stop();

            Console.WriteLine(&quot;++thread {0} finished. (Simulated Processing
Time took {1}ms)&quot;, threadName, threadLoopTimer.RoundedDuration);

            this.doneEvent.Set();
        }
    }

    #endregion

    #region High-Performance Timer Class

    public class HiPerfTimer
    {
        [DllImport(&quot;Kernel32.dll&quot;)]
        private static extern bool QueryPerformanceCounter(out long
lpPerformanceCount);
        [DllImport(&quot;Kernel32.dll&quot;)]
        private static extern bool QueryPerformanceFrequency(out long
lpFrequency);

        private long startTime ;
        private long stopTime;
        private long freq;

        /// &lt;summary&gt;
        /// ctor
        /// &lt;/summary&gt;
        public HiPerfTimer()
        {
            startTime = 0;
            stopTime = 0;
            freq =0;
            if (QueryPerformanceFrequency(out freq) == false)
            {
                throw new Win32Exception(); // timer not supported
            }
        }

        /// &lt;summary&gt;
        /// Start the timer
        /// &lt;/summary&gt;
        /// &lt;returns&gt;long - tick count&lt;/returns&gt;
        public long Start()
        {
            QueryPerformanceCounter(out startTime);
            return startTime;
        }

        /// &lt;summary&gt;
        /// Stop timer
        /// &lt;/summary&gt;
        /// &lt;returns&gt;long - tick count&lt;/returns&gt;
        public long Stop()
        {
            QueryPerformanceCounter(out stopTime);
            return stopTime;
        }

        /// &lt;summary&gt;
        /// Return the duration of the timer (in seconds)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;double - duration&lt;/returns&gt;
        public double Duration
        {
            get
            {
                return (double)(stopTime - startTime) / (double) freq;
            }
        }

        /// &lt;summary&gt;
        /// Return the duration of the timer (in milliseconds) but rounded
nicely
        /// &lt;/summary&gt;
        /// &lt;returns&gt;double - duration&lt;/returns&gt;
        public double RoundedDuration
        {
            get
            {
                return Math.Round((double)(stopTime - startTime) / (double)
freq, 3) * 1000;
            }
        }

        /// &lt;summary&gt;
        /// Frequency of timer (no counts in one second on this machine)
        /// &lt;/summary&gt;
        ///&lt;returns&gt;long - Frequency&lt;/returns&gt;
        public long Frequency
        {
            get
            {
                QueryPerformanceFrequency(out freq);
                return freq;
            }
        }
    }

    #endregion
}






-- 
William S. Huskey

UNIX Systems Engineer

Maritime Systems Solutions Division

SAIC

Tel: 425-267-5643

Email: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">huskeyw at saic.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070319/7b2223e3/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20070319/7b2223e3/attachment.html</A> 
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034728.html">[Mono-list] Problems using a library.
</A></li>
	<LI>Next message: <A HREF="034651.html">[Mono-list] Unhandled	Exception:	System.EntryPointNotFoundException:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34647">[ date ]</a>
              <a href="thread.html#34647">[ thread ]</a>
              <a href="subject.html#34647">[ subject ]</a>
              <a href="author.html#34647">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
