<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Assembly mutual dependencies or
 chicken-and-eggproblem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jonpryor%40vt.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="017651.html">
   <LINK REL="Next"  HREF="017599.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Assembly mutual dependencies or
 chicken-and-eggproblem
   </H1>
    <B>Jonathan Pryor
    </B> 
    <A HREF="mailto:jonpryor%40vt.edu"
       TITLE="[Mono-list] Assembly mutual dependencies or
 chicken-and-eggproblem">jonpryor@vt.edu
       </A><BR>
    <I>Mon, 12 Jan 2004 22:03:49 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="017651.html">[Mono-list] Assembly mutual dependencies or chicken-and-eggproblem
</A></li>
        <LI> Next message: <A HREF="017599.html">[Mono-list] Error CS0246: Cannot find type 'MyClass'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17665">[ date ]</a>
              <a href="thread.html#17665">[ thread ]</a>
              <a href="subject.html#17665">[ subject ]</a>
              <a href="author.html#17665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There shouldn't be any problems with your build system and mcs.  If
there is, it's an mcs bug (and please file it :-).

In general, if it works with CSC.EXE, it should work with mcs. 
(Exceptions for language implementation bugs in CSC.EXE, which accepts
some constructs which are not permitted by the ECMA standard.)

 - Jon

On Mon, 2004-01-12 at 08:10, Jaroslaw Kowalski wrote:
&gt;<i> Thanks for your answer.
</I>&gt;<i> 
</I>&gt;<i> Actually I've developed a foolproof version of the build process:
</I>&gt;<i> 
</I>&gt;<i> 1. I have a script that creates a &quot;mini&quot; version of business.dll containing
</I>&gt;<i> nothing but all classes and their constructors. The classes inherit from
</I>&gt;<i> their _Stub counterparts.
</I>&gt;<i> 
</I>&gt;<i> 2. I have another script that creates a &quot;mini&quot; version of &quot;stubs.dll&quot;
</I>&gt;<i> containing nothing but all &quot;*_Stub&quot; classes and their constructors. The
</I>&gt;<i> classes inherit &quot;BaseObject&quot;.
</I>&gt;<i> 
</I>&gt;<i> 3. The compilation process is:
</I>&gt;<i> 
</I>&gt;<i> a) compile &quot;mini&quot; stubs.dll (references nothing but base.dll)
</I>&gt;<i> 
</I>&gt;<i> b) compile &quot;mini&quot; business.dll (references &quot;mini&quot; stubs.dll - this must use
</I>&gt;<i> the same version and keyfile, to take care of strong names)
</I>&gt;<i> 
</I>&gt;<i> c) compile full stubs.dll (references &quot;mini&quot; business.dll)
</I>&gt;<i> 
</I>&gt;<i> d) full &quot;business.dll&quot; can be recompiled now against full stubs.dll.
</I>&gt;<i> 
</I>&gt;<i> This may cause warnings (or even errors) with compilers that complain that
</I>&gt;<i> &quot;business.dll&quot; is not found when compiling &quot;business.dll&quot; (in step &quot;d&quot;), but
</I>&gt;<i> can be easily overcome with:
</I>&gt;<i> 
</I>&gt;<i> csc /out:business.dll /r:path_to\stubs.dll /r:\path_to\mini_business.dll
</I>&gt;<i> business*.cs
</I>&gt;<i> 
</I>&gt;<i> Actually csc produces only a warning so I need to reference only
</I>&gt;<i> &quot;stubs.dll&quot;.
</I>&gt;<i> 
</I>&gt;<i> DO YOU SEE ANY POTENTIAL PROBLEMS WITH THIS AND MCS?
</I>&gt;<i> 
</I>&gt;<i> Jarek
</I>&gt;<i> ----- Original Message ----- 
</I>&gt;<i> From: &quot;Jonathan Pryor&quot; &lt;<A HREF="mailto:jonpryor@vt.edu">jonpryor@vt.edu</A>&gt;
</I>&gt;<i> To: &quot;Jaroslaw Kowalski&quot; &lt;<A HREF="mailto:jaak@zd.com.pl">jaak@zd.com.pl</A>&gt;
</I>&gt;<i> Cc: &quot;Mono List&quot; &lt;<A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>&gt;
</I>&gt;<i> Sent: Monday, January 12, 2004 1:52 PM
</I>&gt;<i> Subject: Re: [Mono-list] Assembly mutual dependencies or
</I>&gt;<i> chicken-and-eggproblem
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; You note that System.dll and System.Xml.dll are mutually dependent.
</I>&gt;<i> &gt; They are built, however, by referring to the previous versions of the
</I>&gt;<i> &gt; assemblies.  So System.dll &quot;version&quot; (build?) 101 is built against
</I>&gt;<i> &gt; System.Xml.dll build 100 (previous build), and System.Xml.dll (which is
</I>&gt;<i> &gt; built after System.dll) can depend System.dll build 101 (current).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It doesn't look like this will easily work for your scenario.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The simple thing to do would likely be to break the dependency, and have
</I>&gt;<i> &gt; the Stub objects just refer to the other Stub objects.  The non-stub
</I>&gt;<i> &gt; objects can then expose new methods/properties, offering the
</I>&gt;<i> &gt; properly-cast stub objects for consumption.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Pro: No mutual dependencies between assemblies; if the user stays within
</I>&gt;<i> &gt; the &quot;tablename&quot; classes, they'll never see the Stub classes.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Con: Requires that the user-editable classes have boilerplate code (the
</I>&gt;<i> &gt; method/property overrides that expose the correct type).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Example:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; // Assembly: Base.dll
</I>&gt;<i> &gt; class BaseObject {}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; // Assembly: Stubs.dll
</I>&gt;<i> &gt; class Table1_Stub : BaseObject {
</I>&gt;<i> &gt; public Table2_Stub Table2 { get; set; }
</I>&gt;<i> &gt; // ...
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; // Assembly: Business.dll
</I>&gt;<i> &gt; class Table1 : Table1_Stub {
</I>&gt;<i> &gt; public new Table2 Table2 {
</I>&gt;<i> &gt; get {return (Table2) base.Table2;}
</I>&gt;<i> &gt; set {base.Table2 = value;}
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; // ...
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If the boilerplate code is an issue (and it could be, with enough table
</I>&gt;<i> &gt; values), introducing a &quot;_Impl&quot; class might work.  It would have to be in
</I>&gt;<i> &gt; the same assembly as the &quot;tablename&quot; classes, but I would think this
</I>&gt;<i> &gt; would work:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; // Both of these in &quot;Business.dll&quot;
</I>&gt;<i> &gt; // You could probably use CodeDom to generate the _Impl classes,
</I>&gt;<i> &gt; // since it needs to be in the same language as Table1.
</I>&gt;<i> &gt; class Table1_Impl : Table1_Stub {
</I>&gt;<i> &gt; public new Table2 Table2 {
</I>&gt;<i> &gt; // same as Table1, above
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; class Table1 : Table1_Impl {}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; To answer your questions:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Q1: Do you see any problems in the long run? [with original approach]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's a complicated build process, and if the API exposed by the classes
</I>&gt;<i> &gt; ever radically changes (new DB schema, etc.) I think you'd have to start
</I>&gt;<i> &gt; the build &quot;from scratch&quot; (new stub classes, etc.).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Q2: Do you have any better ideas?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; See above.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Q3: I'd like to be able to use VB.NET or JScript.NET for
</I>&gt;<i> &gt; BUSINESS_OBJECTS.dll while STUBS.dll will remain C#. Do you this this is
</I>&gt;<i> &gt; doable?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Yes.  The &quot;barrier&quot; between languages is the .netmodule or the
</I>&gt;<i> &gt; Assembly.  Since each .dll is a different assembly, it should be fairly
</I>&gt;<i> &gt; straightforward to use different languages in this manner.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Q4: I know there can be issues with strong-names, but I believe it
</I>&gt;<i> &gt; should work. Am I right?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I would think so, but I'm not the strong-name expert.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  - Jon
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Fri, 2004-01-09 at 18:38, Jaroslaw Kowalski wrote:
</I>&gt;<i> &gt; &gt; Hi guys!
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I'm implementing a Data Access Layer (with a source code generator) in
</I>&gt;<i> C#
</I>&gt;<i> &gt; &gt; and I'm having a conceptual problem with partitioning my design into
</I>&gt;<i> &gt; &gt; assemblies as it involves mutual dependencies.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Maybe someone can give me some advice?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Problem statement (a bit long - sorry)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 1. The system represents database entities as objects (O/R mapping)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 2. All entities ultimately derive from some base class that provides
</I>&gt;<i> common
</I>&gt;<i> &gt; &gt; functionality. Let's call it BaseObject.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 3. On top of that there's a C# code (generated by some stub generation
</I>&gt;<i> &gt; &gt; utility) that creates a class for each database table. Class is named
</I>&gt;<i> &gt; &gt; &quot;tablename_STUB&quot; and derives from &quot;BaseObject&quot;.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 4. I'd like the user to be able to implement additional methods so I
</I>&gt;<i> create
</I>&gt;<i> &gt; &gt; another class for each database table, called &quot;tablename&quot;. The idea is
</I>&gt;<i> that
</I>&gt;<i> &gt; &gt; this class will never be re-generated while &quot;tablename_STUB&quot; will be
</I>&gt;<i> &gt; &gt; regenerated whenever the database schema changes.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; So basically I have:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; class BaseObject {}
</I>&gt;<i> &gt; &gt; class SomeTable_Stub : BaseObject { }
</I>&gt;<i> &gt; &gt; class SomeTable : SomeTable_Stub { }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 5. I want the instance of &quot;SomeTable_Stub&quot; to be able to return
</I>&gt;<i> references
</I>&gt;<i> &gt; &gt; to &quot;SomeTable&quot; objects. This will be used to represent foreign key
</I>&gt;<i> &gt; &gt; relationships and I don't want to clutter SomeTable with any boilerplate
</I>&gt;<i> &gt; &gt; code. So this needs to be done in the Stub class and inherited.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Now I'd like to partition the system into separate assemblies:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; BASE - which will contain BaseObject and helper stuff
</I>&gt;<i> &gt; &gt; STUBS - which will contain &quot;_Stub&quot; classes (regenerated after the schema
</I>&gt;<i> &gt; &gt; changes)
</I>&gt;<i> &gt; &gt; and
</I>&gt;<i> &gt; &gt; BUSINESS_OBJECTS - which contains classes without &quot;_Stubs&quot;.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; My problem is that there's a mutual dependency between STUBS and
</I>&gt;<i> &gt; &gt; BUSINESS_OBJECTS. So I'd need STUBS.dll referencing BUSINESS_OBJECTS.dll
</I>&gt;<i> and
</I>&gt;<i> &gt; &gt; vice versa.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I don't know how to accomplish it best.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I've looked at mono makefiles and found that &quot;System.dll&quot; references
</I>&gt;<i> &gt; &gt; &quot;System.Xml.dll&quot; and &quot;System.Xml.dll&quot; references &quot;System.dll&quot;. Somehow
</I>&gt;<i> we
</I>&gt;<i> &gt; &gt; have a chicken-and-egg problem because it's not directly buildable.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I came up with the following idea to build this project:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 1. Build BASE.dll
</I>&gt;<i> &gt; &gt; 2. Create a small assembly that will have all the classes and methods
</I>&gt;<i> that
</I>&gt;<i> &gt; &gt; STUBS.dll needs from BUSINESS_OBJECTS.dll but they derive from
</I>&gt;<i> BaseObject
</I>&gt;<i> &gt; &gt; and the methods will be stubbed out.
</I>&gt;<i> &gt; &gt; 3. Compile this fake assembly (referencing BASE.dll) and name it:
</I>&gt;<i> &gt; &gt; &quot;BUSINESS_OBJECTS.dll&quot;
</I>&gt;<i> &gt; &gt; 4. Compile &quot;STUBS.dll&quot; passing it a reference to this fake
</I>&gt;<i> &gt; &gt; &quot;BUSINESS_OBJECTS.dll&quot;
</I>&gt;<i> &gt; &gt; 5. Now that we have &quot;STUBS.dll&quot; we can recompile the actual
</I>&gt;<i> &gt; &gt; &quot;BUSINESS_OBJECTS.dll&quot; with it.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I compiled it and even made it work, but I'm not convinced that this is
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; best idea.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Q1: Do you see any problems in the long run?
</I>&gt;<i> &gt; &gt; Q2: Do you have any better ideas?
</I>&gt;<i> &gt; &gt; Q3: I'd like to be able to use VB.NET or JScript.NET for
</I>&gt;<i> &gt; &gt; BUSINESS_OBJECTS.dll while STUBS.dll will remain C#. Do you this this is
</I>&gt;<i> &gt; &gt; doable?
</I>&gt;<i> &gt; &gt; Q4: I know there can be issues with strong-names, but I believe it
</I>&gt;<i> should
</I>&gt;<i> &gt; &gt; work. Am I right?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Jarek
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; P.S. I know I can keep the stubs and business objects in a single
</I>&gt;<i> assembly
</I>&gt;<i> &gt; &gt; (this is actually how I did this before) but want to evaluate the
</I>&gt;<i> &gt; &gt; possibility of separating stubs and keeping them pre-compiled. The
</I>&gt;<i> stubgen
</I>&gt;<i> &gt; &gt; phase takes a considerable amount of time and the stubs are getting
</I>&gt;<i> large
</I>&gt;<i> &gt; &gt; (over 1MB of source code for a large database) so the compilation takes
</I>&gt;<i> &gt; &gt; time.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; P.S.2. I'm planning to release my O/R mapping software as open source
</I>&gt;<i> after
</I>&gt;<i> &gt; &gt; I resolve those basic issues and make it work with mono.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="017651.html">[Mono-list] Assembly mutual dependencies or chicken-and-eggproblem
</A></li>
	<LI> Next message: <A HREF="017599.html">[Mono-list] Error CS0246: Cannot find type 'MyClass'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17665">[ date ]</a>
              <a href="thread.html#17665">[ thread ]</a>
              <a href="subject.html#17665">[ subject ]</a>
              <a href="author.html#17665">[ author ]</a>
         </LI>
       </UL>
</body></html>
