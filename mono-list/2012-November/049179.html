<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] FileStream performance under Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20FileStream%20performance%20under%20Windows&In-Reply-To=%3C1352988441005-4657397.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049177.html">
   <LINK REL="Next"  HREF="049180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] FileStream performance under Windows</H1>
    <B>studan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20FileStream%20performance%20under%20Windows&In-Reply-To=%3C1352988441005-4657397.post%40n4.nabble.com%3E"
       TITLE="[Mono-list] FileStream performance under Windows">stu_dan at hispeed.ch
       </A><BR>
    <I>Thu Nov 15 14:07:21 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="049177.html">[Mono-list] crash in...	mcs/class/corlib/System.Resources/ResourceManager.cs:123
</A></li>
        <LI>Next message: <A HREF="049180.html">[Mono-list] FileStream performance under Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49179">[ date ]</a>
              <a href="thread.html#49179">[ thread ]</a>
              <a href="subject.html#49179">[ subject ]</a>
              <a href="author.html#49179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>HiI've processed a XML file with XMLDocument(&quot;filename&quot;) under Windows 7.
After several seconds an error (Fatal error in gc: To many heap sections)
occured. The XML file size is ~130MB.So I changed the code to use
XMLReader(&quot;filename&quot;) and counted the elments (5448 elements named
&quot;Artikel&quot;).The whole operation was done in ~6 sec. With MS.NET instead of
Mono the operation was done in ~1.3 sec. As I started the program (with
MS.NET) after a reboot, the operation was done in ~4.8sec. But with the next
execution of the program the execution time was again at ~1.35 sec.After
some web search I found the FileOptions (0x20000000 //
FILE_FLAG_NO_BUFFERING). Using this option for a FileStream the execution
time under MS.NET is now ~5 sec. I've tested other options but they have no
effect for Mono.Code:        private static int ProcessXMLReader(string
filePath, bool useCache)        {            var articles = 0;           
var options = FileOptions.None;            if (useCache == false)               
options = (FileOptions)0x20000000; // FILE_FLAG_NO_BUFFERING           
using (var fStream = new FileStream(filePath, FileMode.Open,
FileAccess.Read, FileShare.None, 512, options))            {               
var reader = XmlReader.Create(fStream);                while (!reader.EOF)               
{                    if (reader.Read())                    {                       
if (reader.NodeType == XmlNodeType.Element &amp;&amp; reader.LocalName == &quot;Artikel&quot;)                       
{                            articles++;                        }                   
}                }            }            return articles;        }



--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/FileStream-performance-under-Windows-tp4657397.html">http://mono.1490590.n4.nabble.com/FileStream-performance-under-Windows-tp4657397.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20121115/6693535e/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20121115/6693535e/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049177.html">[Mono-list] crash in...	mcs/class/corlib/System.Resources/ResourceManager.cs:123
</A></li>
	<LI>Next message: <A HREF="049180.html">[Mono-list] FileStream performance under Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49179">[ date ]</a>
              <a href="thread.html#49179">[ thread ]</a>
              <a href="subject.html#49179">[ subject ]</a>
              <a href="author.html#49179">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
