<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] New: cross-compiling with mkbundle
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20New%3A%20cross-compiling%20with%20mkbundle&In-Reply-To=%3C2C743B51-BE65-46CC-9156-EA55BCE2D491%40microsoft.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052164.html">
   <LINK REL="Next"  HREF="052184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] New: cross-compiling with mkbundle</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20New%3A%20cross-compiling%20with%20mkbundle&In-Reply-To=%3C2C743B51-BE65-46CC-9156-EA55BCE2D491%40microsoft.com%3E"
       TITLE="[Mono-list] New: cross-compiling with mkbundle">miguel at microsoft.com
       </A><BR>
    <I>Wed Aug 10 03:06:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052164.html">[Mono-list] New: cross-compiling with mkbundle
</A></li>
        <LI>Next message (by thread): <A HREF="052184.html">[Mono-list] New: cross-compiling with mkbundle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52169">[ date ]</a>
              <a href="thread.html#52169">[ thread ]</a>
              <a href="subject.html#52169">[ subject ]</a>
              <a href="author.html#52169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

That command line is using the old mkbundle system, not the new one.

That said, the error is likely the same, can you try using MONO_PATH to direct the loader?

From: Dave Curylo &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">dacurylo at gmail.com</A>&gt; on behalf of David Curylo &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">curylod at asme.org</A>&gt;
Date: Tuesday, August 9, 2016 at 5:42 PM
To: Miguel de Icaza &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">miguel at microsoft.com</A>&gt;
Cc: &quot;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&quot; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&gt;
Subject: Re: [Mono-list] New: cross-compiling with mkbundle

Miguel,

Thanks for this, better cross-compiling support is huge given I don’t need to have a ton of CI agents handling it.  However, something seems to break for me when using the mkbundle that ships with 4.4.2.

mkbundle --deps --static -o myApp MyApp.exe *.dll

fails with an exception looking for an old version of a .dll, in my case Npgsql:

Unhandled Exception:
System.IO.FileNotFoundException: Could not load file or assembly 'Npgsql, Version=2.2.1.0, Culture=neutral, PublicKeyToken=5d8b90d52f46fda7' or one of its dependencies
File name: 'Npgsql, Version=2.2.1.0, Culture=neutral, PublicKeyToken=5d8b90d52f46fda7'
  at System.AppDomain.Load (System.String assemblyString, System.Security.Policy.Evidence assemblySecurity, Boolean refonly) &lt;0x19f78c0 + 0x000b0&gt; in &lt;filename unknown&gt;:0
  at (wrapper remoting-invoke-with-check) System.AppDomain:Load (string,System.Security.Policy.Evidence,bool)
  at System.Reflection.Assembly.ReflectionOnlyLoad (System.String assemblyString) &lt;0x1a72eb0 + 0x00038&gt; in &lt;filename unknown&gt;:0
  at IKVM.Reflection.Universe.DefaultResolver (System.String refname, Boolean throwOnError) &lt;0x6e7890 + 0x00057&gt; in &lt;filename unknown&gt;:0
  at IKVM.Reflection.Universe.Load (System.String refname, IKVM.Reflection.Module requestingModule, Boolean throwOnError) &lt;0x6e6f68 + 0x0006f&gt; in &lt;filename unknown&gt;:0
  at IKVM.Reflection.Universe.Load (System.String refname) &lt;0x6e6f30 + 0x00027&gt; in &lt;filename unknown&gt;:0
  at MakeBundle.QueueAssembly (System.Collections.Generic.List`1 files, System.String codebase) &lt;0x7b44b0 + 0x001ab&gt; in &lt;filename unknown&gt;:0
No problems bundling with mkbundle from 4.2.3 - it runs there in CI all the time.  Did something in this new version change how assemblies are located?

Thanks,
Dave

On Aug 9, 2016, at 5:35 PM, Miguel de Icaza via Mono-list &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&lt;mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&gt;&gt; wrote:


From: Miguel de Icaza &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">miguel at microsoft.com</A>&lt;mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">miguel at microsoft.com</A>&gt;&gt;
Subject: New: cross-compiling with mkbundle
Date: August 9, 2016 at 2:02:11 PM EDT
To: &quot;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&lt;mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&gt;&quot; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&lt;mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>&gt;&gt;


Hello folks,

The new mkbundle tool in Mono no longer requires an installed compiler, and you can use it to cross compile.

Would love to get some feedback from you guys.

First, get a list of all cross-platform targets available, like this:

mkbundle –list-targets

Then, find out which version of Mono you have on your system:

mono –version

Use this to pick the right version and fetch it, for example, to cross compile to Linux/64 from a Mac do:

mkbundle –fetch-target 4.4.2-linux-libc2.13-amd64

Repeat for as many cross-platform targets as wanted.

Now take your executable that you want to bundle and bundle it up for this platform:

mkbundle –cross 4.4.2-linux-libc2.13-amd64 demo.exe demo-native

Now, you can copy that “demo-native” executable to your Linux machine and run it.

I have done very minimal testing on this, and some features are missing, things that I want to add:
•         Ship native libraries
•         Add support for shipping the LLVM runtime as an option
•         Add support to target different Mono versions, not just the same you have installed

Miguel.



_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.dot.net/mailman/listinfo/mono-list">Mono-list at lists.dot.net</A>&lt;mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">Mono-list at lists.dot.net</A>&gt;
<A HREF="http://lists.dot.net/mailman/listinfo/mono-list&lt;https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2flists.dot.net%2fmailman%2flistinfo%2fmono-list&amp;data=02%7c01%7cmiguel%40microsoft.com%7cf9e7ae3a341840b11ae508d3c09e04e6%7c72f988bf86f141af91ab2d7cd011db47%7c1%7c0%7c636063757323186162&amp;sdata=kt9qFYmFdckK3tFBRtfjTnQiAMrb%2fA0MZDxoXxGwlNM%3d">http://lists.dot.net/mailman/listinfo/mono-list&lt;https://na01.safelinks.protection.outlook.com/?url=http%3a%2f%2flists.dot.net%2fmailman%2flistinfo%2fmono-list&amp;data=02%7c01%7cmiguel%40microsoft.com%7cf9e7ae3a341840b11ae508d3c09e04e6%7c72f988bf86f141af91ab2d7cd011db47%7c1%7c0%7c636063757323186162&amp;sdata=kt9qFYmFdckK3tFBRtfjTnQiAMrb%2fA0MZDxoXxGwlNM%3d</A>&gt;

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-list/attachments/20160810/f49b2744/attachment-0001.html">http://lists.dot.net/pipermail/mono-list/attachments/20160810/f49b2744/attachment-0001.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052164.html">[Mono-list] New: cross-compiling with mkbundle
</A></li>
	<LI>Next message (by thread): <A HREF="052184.html">[Mono-list] New: cross-compiling with mkbundle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52169">[ date ]</a>
              <a href="thread.html#52169">[ thread ]</a>
              <a href="subject.html#52169">[ subject ]</a>
              <a href="author.html#52169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
