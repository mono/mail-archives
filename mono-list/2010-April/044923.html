<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Duplicate keys in hashtable when using Castle Monorail with Brail view engine
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Duplicate%20keys%20in%20hashtable%20when%20using%20Castle%20Monorail%0A%20with%20Brail%20view%20engine&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044922.html">
   <LINK REL="Next"  HREF="044924.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Duplicate keys in hashtable when using Castle Monorail with Brail view engine</H1>
    <B>Simon Lindgren</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Duplicate%20keys%20in%20hashtable%20when%20using%20Castle%20Monorail%0A%20with%20Brail%20view%20engine&In-Reply-To="
       TITLE="[Mono-list] Duplicate keys in hashtable when using Castle Monorail with Brail view engine">simon.n.lindgren at gmail.com
       </A><BR>
    <I>Thu Apr 22 13:57:32 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="044922.html">[Mono-list] cannot find metadata file MySql.Data.dll
</A></li>
        <LI>Next message: <A HREF="044924.html">[Mono-list] Duplicate keys in hashtable when using Castle Monorail with Brail view engine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44923">[ date ]</a>
              <a href="thread.html#44923">[ thread ]</a>
              <a href="subject.html#44923">[ subject ]</a>
              <a href="author.html#44923">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello list,

I can not figure this one out. I have an ASP.NET project in which I use
Castle Monorail together with the Brail view engine. For the project I
have written a custom routing rule, which is supposed to receive a
Hashtable (well, IDictionary actually, but it is a Hashtable) containing
the parameters with which to generate a URL.

The key I'm looking for is in the Hashtable, but it is not possible to
access it. The lookup simply fails. I've looked at the table both in the
soft debugger and by looping through it using an iterator. I can insert
a new element with the same key as the one I want to access. This new
element does not take the place of my wanted row, so now there is a
duplicate key in the table. If I try to insert one more entry with that
same key I get an ArgumentException about duplicate keys. I've also
ruled out special characters as a cause by manually finding the correct
entry and comparing the actual key to my input key.

I'm really at a loss here, a part of the code is below:

public string CreateUrl(IDictionary parameters)
{
	//Log the contents of the parameter dictionary
	StringBuilder s = new StringBuilder();
	s.Append(&quot;{&quot;);
	foreach (DictionaryEntry entry in parameters) {
		s.Append(String.Format(&quot;{0} {1} = {2}, &quot;, entry.Key.GetType().ToString(), (string)entry.Key, (entry.Value ?? &quot;null&quot;)));
	}
	s.Remove(s.Length - 2, 2);
	s.Append('}');
	Console.WriteLine(&quot;Parameters: &quot; + s.ToString());
	
	string path = &quot;path&quot;;
	try {
		for (IDictionaryEnumerator n = parameters.GetEnumerator(); ;) {
			n.MoveNext();
			if (((string)n.Value) == &quot;/Page1&quot;) {
				Console.WriteLine(&quot;path.GetHashCode(): {0}&quot;, path.GetHashCode());
				Console.WriteLine(&quot;Key.GetHashCode(): {0}&quot;, n.Key.GetHashCode());
				Console.WriteLine(&quot;Key.Equals(path): {0}&quot;, n.Key.Equals(path));
				Console.WriteLine(&quot;ReferenceEquals(Key, path): {0}&quot;, ReferenceEquals(n.Key, path));
				Console.WriteLine(&quot;Key == path: {0}&quot;, n.Key == path);
			}
		}
	}
	catch (InvalidOperationException endOfDictionary) {} //just swallow
	
	Console.WriteLine(&quot;parameters.Contains(path): {0}&quot;, parameters.Contains(path));
	parameters.Add(path, &quot;/Page&quot;);
	Console.WriteLine(&quot;parameters.Contains(path): {0}&quot;, parameters.Contains(path));

	return &quot;some url&quot;;
}

This is the code that is supposed to generate a URL, but altered to do
some tests instead. When I run it I get this in the console output:

...
Loads of xsp2 debug output
...
Parameters: {System.String controller = null, System.String path = /Page1, System.String action = null, System.String area = null}
path.GetHashCode(): 3433509
Key.GetHashCode(): 3433509
Key.Equals(path): True
ReferenceEquals(Key, path): False
Key == path: False
parameters.Contains(path): False
parameters.Contains(path): True

How could this possibly be? My current code is actually pretty trivial
as I have removed all but the bare minimum. I'm running Mono 2.6.3 as
available in Gentoo.

-- 
Simon Lindgren

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: Detta =?ISO-8859-1?Q?=E4r?= en digitalt signerad
	meddelandedel
Url : <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20100422/e195c392/attachment.bin">http://lists.ximian.com/pipermail/mono-list/attachments/20100422/e195c392/attachment.bin</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044922.html">[Mono-list] cannot find metadata file MySql.Data.dll
</A></li>
	<LI>Next message: <A HREF="044924.html">[Mono-list] Duplicate keys in hashtable when using Castle Monorail with Brail view engine
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44923">[ date ]</a>
              <a href="thread.html#44923">[ thread ]</a>
              <a href="subject.html#44923">[ subject ]</a>
              <a href="author.html#44923">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
