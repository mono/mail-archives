<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono SSL server fails to send intermediate to client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%20SSL%20server%20fails%20to%20send%20intermediate%20to%20client&In-Reply-To=%3CCAJjm3Zde-1bXd4eyx_6RzzQ7DHAvxj%2Biek27qTdE8bgPcD_bog%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="050870.html">
   <LINK REL="Next"  HREF="050872.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono SSL server fails to send intermediate to client</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Mono%20SSL%20server%20fails%20to%20send%20intermediate%20to%20client&In-Reply-To=%3CCAJjm3Zde-1bXd4eyx_6RzzQ7DHAvxj%2Biek27qTdE8bgPcD_bog%40mail.gmail.com%3E"
       TITLE="[Mono-list] Mono SSL server fails to send intermediate to client">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Wed Apr 23 13:38:48 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="050870.html">[Mono-list] Mono SSL server fails to send intermediate to client
</A></li>
        <LI>Next message: <A HREF="050872.html">[Mono-list] Mono SSL server fails to send intermediate to client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50871">[ date ]</a>
              <a href="thread.html#50871">[ thread ]</a>
              <a href="subject.html#50871">[ subject ]</a>
              <a href="author.html#50871">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Apr 23, 2014 at 9:29 AM, Edward Ned Harvey (mono) &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">edward.harvey.mono at clevertrove.com</A>&gt; wrote:

&gt;<i>  In SSL/TLS, the server is supposed to send a certificate chain to the
</I>&gt;<i> client, to make the client easily validate the authenticity of the server
</I>&gt;<i> from one of the client's trusted root CA's.  If the server doesn't send a
</I>&gt;<i> chain, the client can make some level of effort trying to construct the
</I>&gt;<i> chain, but each client implementation might perform that effort differently.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm digging into this some more, but the observed behavior is:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm using SslStream.  When I connect a mono client to a mono server, I can
</I>&gt;<i> step through mono source on the client and I can see the server doesn't
</I>&gt;<i> send the chain.  The client therefore checks root CA's but no intermediates,
</I>&gt;<i>
</I>
That's already fixed in git.


&gt;<i> and therefore fails.
</I>&gt;<i>
</I>
Not always, as you found out.


&gt;<i> (To be technically accurate, the server incorrectly sends a chain with
</I>&gt;<i> zero items in it, which causes the client to *only* check root CA's with no
</I>&gt;<i> intermediates.  The behavior would be different if the server had sent a
</I>&gt;<i> &quot;null&quot; chain, in which case the mono client will execute different code,
</I>&gt;<i> attempting to construct a chain, but I don't actually know if that other
</I>&gt;<i> code would succeed or not.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My test program, with the exact same C# code with the exact same cert,
</I>&gt;<i> running on windows server, actually sends the chain to the client,
</I>&gt;<i> including a single item, which is the intermediate, and therefore, both
</I>&gt;<i> windows &amp; mono clients are able to authenticate the windows server with no
</I>&gt;<i> problem.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The mono server, connected with a windows client, presumably does not send
</I>&gt;<i> the chain to the client (but I can't step through MS code to confirm this
</I>&gt;<i> assumption), but the client is able to authenticate the server, so
</I>&gt;<i> presumably the windows client makes more effort to construct the chain, or
</I>&gt;<i> perhaps the client has some sort of pre-built chain in its list to
</I>&gt;<i> check...  All I know is that it works.
</I>&gt;<i>
</I>
That's because many clients will use their own stores (either in addition
or exclusively) to create the chain before validating the server
certificate.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So the problem only exists with a mono server, connected to a mono client,
</I>&gt;<i> when the server cert is signed by an intermediate.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm rather amazed that I'm the first person to observe this, as every CA
</I>&gt;<i> that I know of actually signs certs with intermediate authorities.  I'd
</I>&gt;<i> like to ask the community:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Do you run any mono SSL server, connected with mono SSL clients?  Does
</I>&gt;<i> your server certificate include an intermediate chain?  Did you make your
</I>&gt;<i> clients override a cert that the client would naturally reject from the
</I>&gt;<i> server?  Did you tweak your client trusts, more than simply running
</I>&gt;<i> mozroots, in order to make your intermediate chain work?
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20140423/5482ac4c/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20140423/5482ac4c/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="050870.html">[Mono-list] Mono SSL server fails to send intermediate to client
</A></li>
	<LI>Next message: <A HREF="050872.html">[Mono-list] Mono SSL server fails to send intermediate to client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50871">[ date ]</a>
              <a href="thread.html#50871">[ thread ]</a>
              <a href="subject.html#50871">[ subject ]</a>
              <a href="author.html#50871">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
