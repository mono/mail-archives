<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] XSP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:stodden%40in.tum.de">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="006241.html">
   <LINK REL="Next"  HREF="006193.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] XSP
   </H1>
    <B>Daniel Stodden
    </B> 
    <A HREF="mailto:stodden%40in.tum.de"
       TITLE="[Mono-list] XSP">stodden@in.tum.de
       </A><BR>
    <I>03 Jun 2002 19:11:52 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="006241.html">[Mono-list] XSP
</A></li>
        <LI> Next message: <A HREF="006193.html">[Mono-list] mono fails to build on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6244">[ date ]</a>
              <a href="thread.html#6244">[ thread ]</a>
              <a href="subject.html#6244">[ subject ]</a>
              <a href="author.html#6244">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-S2ya/QdOpJLAqZH9Wrt8
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Mon, 2002-06-03 at 13:21, Miguel de Icaza wrote:
&gt;<i> 
</I>&gt;<i> Thanks for the good news.  I did not realize that we were so close to
</I>&gt;<i> have CodeDOM complete, I should add a news item to the web page.
</I>
ok, demo. nonsensical example attached.

build this on windows against the ms runtime with mono's
CSharpCodegenerator pulled in statically, i.e as follows:

csc testcodedom4.cs `cygpath -w
&lt;mono_root&gt;/mcs/class/System/Microsoft.CSharp/CSharpCodeGenerator.cs`

on windows, it allows for switching between 
mono::csharpcodegenerator and
the original microsoft.csharp.* codegenerator implementation:
$ testcodedom4.cs [ms | mono]

i'm currently using this kind of stuff to spot differences.

works on linux, but of course won't make a difference there.

indentifying some of the bugs is left as an exercise :), but you get the
idea. so much to do, so little time...

regards,
dns

-- 
___________________________________________________________________________
 mailto:<A HREF="mailto:stodden@in.tum.de">stodden@in.tum.de</A>

--=-S2ya/QdOpJLAqZH9Wrt8
Content-Disposition: attachment; filename=testcodedom4.cs
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; name=testcodedom4.cs; charset=ISO-8859-1

namespace Test {
	using System;
	using System.CodeDom;
	using System.CodeDom.Compiler;
	using System.Reflection;
	using Microsoft.CSharp;
	using Mono.CSharp;

	public class TestCodeDom3
	{
		static void PopulateImports( object sender, EventArgs args )
		{
			CodeNamespace ns =3D (CodeNamespace)sender;
		=09
			CodeNamespaceImportCollection imports =3D ns.Imports;
		=09
			imports.Add( new CodeNamespaceImport( &quot;System.Collections&quot; ) );
			imports.Add( new CodeNamespaceImport( &quot;System.Collections.Specialized&quot; )=
 );
		}

		static void AddArrayTypes( CodeMemberMethod method )
		{
			CodeTypeReference type;
			type =3D new CodeTypeReference( new CodeTypeReference( &quot;System.Int32&quot;, 3=
 ), 1 );
			CodeArrayCreateExpression create =3D new CodeArrayCreateExpression( type=
 );
			create.Size =3D 42;
			create.Initializers.Add( new CodePrimitiveExpression( 1 ) );
			method.Statements.Add( new CodeVariableDeclarationStatement( type, &quot;arra=
y1&quot;, create ) );

			type =3D new CodeTypeReference( &quot;System.Int32&quot;, 1 );
			create =3D new CodeArrayCreateExpression( type );
			method.Statements.Add( new CodeVariableDeclarationStatement( type, &quot;arra=
y2&quot;, create ) );
		=09
			CodeTypeReference arrayType;
			arrayType =3D new CodeTypeReference( &quot;System.Int32&quot;, 2 );
			type =3D new CodeTypeReference( arrayType, 1 );
			create =3D new CodeArrayCreateExpression( type,=20
								new CodeExpression[] {=20
									new CodeArrayCreateExpression( arrayType,
												       new CodeExpression[] {=20
													       new CodePrimitiveExpression( 1 )
												       } ),
									new CodeArrayCreateExpression( arrayType,
												       new CodeExpression[] {=20
													       new CodePrimitiveExpression( 2 )
												       } ),
									new CodeArrayCreateExpression( arrayType,
												       new CodeExpression[] {=20
													       new CodePrimitiveExpression( 3 )
												       } )=20
								} );
			create.Size =3D 3;
			method.Statements.Add( new CodeVariableDeclarationStatement( type, &quot;arra=
y3&quot;, create ) );

			arrayType =3D new CodeTypeReference( &quot;System.Int32&quot;, 2 );
			type =3D new CodeTypeReference( arrayType, 1 );
			create =3D new CodeArrayCreateExpression( type, 2 );
			method.Statements.Add( new CodeVariableDeclarationStatement( type, &quot;arra=
y4&quot;, create ) );
		}

		static void AddTryCatch( CodeMemberMethod method )
		{
			method.Statements.Add( new CodeTryCatchFinallyStatement( new CodeStateme=
nt[] {
					new CodeAssignStatement( new CodeFieldReferenceExpression( new CodeThi=
sReferenceExpression(), &quot;member&quot; ),
						new CodeBinaryOperatorExpression( new CodeCastExpression( &quot;System.Int=
64&quot;, new CodeVariableReferenceExpression( &quot;param&quot; ) ),
										   CodeBinaryOperatorType.Add,
										   new CodePrimitiveExpression( 1 ) ) )
				},
				new CodeCatchClause[] {
					new CodeCatchClause( &quot;e&quot;,
						new CodeTypeReference( &quot;Exception&quot; ),
							     new CodeExpressionStatement(=20
									new CodeMethodInvokeExpression(=20
											new CodeTypeReferenceExpression(new CodeTypeReference(typeof(Sys=
tem.Console))),
											&quot;WriteLine&quot;,=20
											new CodePrimitiveExpression(&quot;an \&quot;error\&quot; occurred.&quot;) ) ) )
				},
				new CodeStatement[] {
					new CodeCommentStatement( &quot;give up&quot; )=20
				} ) );
		}

		static void PopulateStatements( object sender, EventArgs args )
		{
			CodeMemberMethod method =3D (CodeMemberMethod)sender;

			AddArrayTypes( method );
			AddTryCatch( method );
		=09
			method.Statements.Add( new CodeExpressionStatement( new CodeArrayIndexer=
Expression( new CodeBaseReferenceExpression(),
													    new CodeExpression[] {
														    new CodePrimitiveExpression( 10 ),
														    new CodeFieldReferenceExpression( new CodeThisReferenceEx=
pression(), &quot;arrayindexer&quot; )
													    } ) ) );

			method.Statements.Add( new CodeExpressionStatement( new CodeIndexerExpre=
ssion( new CodeBaseReferenceExpression(),
												       new CodeExpression[] {
													       new CodePrimitiveExpression( 10 ),
													       new CodeFieldReferenceExpression( new CodeThisReference=
Expression(), &quot;indexer&quot; )
												       } ) ) );
			method.Statements.Add( new CodeExpressionStatement( new CodeSnippetExpre=
ssion( &quot;this&quot; ) ) );
			method.Statements.Add( new CodeExpressionStatement( new CodeSnippetExpre=
ssion( &quot;\&quot;this\&quot;&quot; ) ) );
		}

		static void PopulateTypes( object sender, EventArgs args )
		{
			CodeNamespace ns =3D (CodeNamespace)sender;
		=09
			CodeTypeDeclaration test =3D new CodeTypeDeclaration( &quot;Test&quot; );
#if false
			test.TypeAttributes =3D=20
				TypeAttributes.Public |=20
				TypeAttributes.Sealed |
				TypeAttributes.Abstract;
#endif
			test.IsClass =3D true;

			test.BaseTypes.Add( new CodeTypeReference( typeof(System.Array) ) );
			test.BaseTypes.Add( new CodeTypeReference( typeof(System.Collections.ICo=
llection) ) );
			test.BaseTypes.Add( new CodeTypeReference( &quot;System.Collections.IEnumerab=
le&quot; ) );

			CodeMemberMethod method =3D new CodeMemberMethod();

			method.Name =3D &quot;GetEnumerator&quot;;
			method.Parameters.Add( new CodeParameterDeclarationExpression( new CodeT=
ypeReference( typeof(System.Collections.ICollection) ), &quot;collection&quot; ) );
			method.Parameters.Add( new CodeParameterDeclarationExpression( &quot;System.I=
nt32&quot;, &quot;value&quot; ) );
			CodeArrayCreateExpression array =3D new CodeArrayCreateExpression( new C=
odeTypeReference( &quot;System.Int32&quot;, 2 ) );
#if false
			array.Initializers.Add( new CodePrimitiveExpression( 1 ) );
			array.Initializers.Add( new CodePrimitiveExpression( 2 ) );
			array.Initializers.Add( new CodePrimitiveExpression( 3 ) );
#endif
			method.Statements.Add( array );
			method.Statements.Add( new CodeConditionStatement( new CodePrimitiveExpr=
ession( true ),
									   new CodeStatement[] { new CodeAssignStatement( new CodeVariable=
ReferenceExpression( &quot;a&quot; ), new CodePrimitiveExpression( 10 ) ) },
									   new CodeStatement[] { new CodeAssignStatement( new CodeVariable=
ReferenceExpression( &quot;b&quot; ), new CodePrimitiveExpression( &quot;hello&quot; ) ) } ) );
			method.PrivateImplementationType =3D new CodeTypeReference( &quot;IEnumerable=
&quot; );

			method.Attributes =3D MemberAttributes.Final | MemberAttributes.Static |=
 MemberAttributes.Public;

			method.CustomAttributes.Add( new CodeAttributeDeclaration( &quot;Flags&quot; ) );
			method.CustomAttributes.Add( new CodeAttributeDeclaration( &quot;Serializable=
&quot; ) );
			method.CustomAttributes.Add( new CodeAttributeDeclaration( &quot;SomeOtherAtt=
ribute&quot;,=20
										   new CodeAttributeArgument( &quot;name&quot;,=20
													      new CodeSnippetExpression( &quot;value&quot; ) ) ) );
			test.Members.Add( method );

			method =3D new CodeMemberMethod();
			method.PopulateStatements +=3D new EventHandler( PopulateStatements );
			method.Name =3D &quot;MoveNext&quot;;
			method.Attributes =3D MemberAttributes.Family;
			method.CustomAttributes.Add( new CodeAttributeDeclaration( &quot;System.Compo=
nentModel.ReadOnly&quot;, new CodeAttributeArgument( new CodeSnippetExpression( =
&quot;true&quot; ) ) ) );
			test.Members.Add( method );

			ns.Types.Add( test );
		}
	=09
		static ICodeGenerator GetCodeGenerator( string argv0 )
		{
			CSharpCodeProvider provider;
			ICodeGenerator codegen =3D null;
			switch ( argv0 ) {
			case &quot;ms&quot;:
				provider =3D new Microsoft.CSharp.CSharpCodeProvider();
				codegen =3D provider.CreateGenerator();
				break;
			case &quot;mono&quot;:
				codegen =3D new Mono.CSharp.CSharpCodeGenerator();
				break;
			default:
				Console.WriteLine( &quot;either 'ms' or 'mono'&quot; );
				break;
			}
		=09
			return codegen;
		}

		static void GenCode( CodeCompileUnit unit, string argv0 )
		{
			ICodeGenerator codegen =3D GetCodeGenerator( argv0 );
			CodeGeneratorOptions options =3D new CodeGeneratorOptions();
			options.BlankLinesBetweenMembers =3D true;
			options.ElseOnClosing =3D true;
			options.BracingStyle =3D &quot;C&quot;;
			codegen.GenerateCodeFromCompileUnit( unit, Console.Out, options );
		}

		static void Main( string[] argv )
		{
			CodeCompileUnit unit =3D new CodeCompileUnit();

			unit.AssemblyCustomAttributes.Add( new CodeAttributeDeclaration( &quot;Assemb=
lyAttribute&quot;,=20
											 new CodeAttributeArgument[] {
												 new CodeAttributeArgument( &quot;name&quot;, new CodePrimitiveExpression=
( &quot;value&quot; ) )
											 } ) );
			unit.ReferencedAssemblies.Add( &quot;XXXXXXXXXXXXXXXXXXXXXXXXX&quot; );

			CodeNamespaceCollection namespaces =3D unit.Namespaces;

			CodeNamespace ns;
			ns =3D new CodeNamespace( &quot;System&quot; );
			namespaces.Add( ns );
			ns.PopulateImports +=3D new EventHandler( PopulateImports );

			ns =3D new CodeNamespace( &quot;CodeDom.Test&quot; );
			namespaces.Add( ns );
			ns.Comments.Add( new CodeCommentStatement( &quot;This program is complete rub=
bish and only used for Testing System.CodeDom &quot; +
								   &quot;and System.CodeDom.Compiler implementatations.&quot;, true ) );
			ns.PopulateImports +=3D new EventHandler( PopulateImports );
			ns.PopulateTypes +=3D new EventHandler( PopulateTypes );
		=09
			GenCode( unit, argv[0] );
		}
	}
}

--=-S2ya/QdOpJLAqZH9Wrt8--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="006241.html">[Mono-list] XSP
</A></li>
	<LI> Next message: <A HREF="006193.html">[Mono-list] mono fails to build on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6244">[ date ]</a>
              <a href="thread.html#6244">[ thread ]</a>
              <a href="subject.html#6244">[ subject ]</a>
              <a href="author.html#6244">[ author ]</a>
         </LI>
       </UL>
</body></html>
