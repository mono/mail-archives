<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Graph of a Class
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rafaelteixeirabr%40hotmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="006488.html">
   <LINK REL="Next"  HREF="006465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Graph of a Class
   </H1>
    <B>A Rafael D Teixeira
    </B> 
    <A HREF="mailto:rafaelteixeirabr%40hotmail.com"
       TITLE="[Mono-list] Graph of a Class">rafaelteixeirabr@hotmail.com
       </A><BR>
    <I>Sat, 15 Jun 2002 23:24:52 -0300</I>
    <P><UL>
        <LI> Previous message: <A HREF="006488.html">[Mono-list] Error: mcs.exe: cannot execute binary file
</A></li>
        <LI> Next message: <A HREF="006465.html">[Mono-list] how far behind is anon cvs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6461">[ date ]</a>
              <a href="thread.html#6461">[ thread ]</a>
              <a href="subject.html#6461">[ subject ]</a>
              <a href="author.html#6461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>From: &quot;Dwivedi , Ajay Kumar&quot; &lt;<A HREF="mailto:AjayKumar.Dwivedi@dresdner-bank.com">AjayKumar.Dwivedi@dresdner-bank.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i>	I asked a question about the order in which members are serialized
</I>&gt;<i>by XmlSerializer on the DOTNET-CLR mailing list. One of the answers is:
</I>&gt;<i>
</I>&gt;<i> &gt; The object is serialized as a graph: starting with the root object, top
</I>&gt;<i> &gt; down, fields then properties and *deep* into each field/property.
</I>&gt;<i>
</I>&gt;<i>Can anyone explain how to obtain this graph?
</I>
I´m using XmlSerializer heavily on a project at work, and I can say some 
things:

1 - It´s at most a PARTIAL graph, because only 'public' fields or properties 
are serialized.

2 - It´s commandered by attributes which can make fields/props be ignored ( 
[XmlIgnore]) or output as xml attributes ([XmlAttribute]) instead of as xml 
elements, which is the default.

3 - Subclassing brings even more attributes into play to tell the serializer 
what descendant types to expect in some superclass instance.

4 - A schema with a element having MaxOccurs &gt; 1, is interpreted normally by 
the xsd utility as a request to have an Array, when generating classes to 
correspond to the schema. But normally, I change it to ArrayList, to be 
possible to add elements at runtime.

Recomendation: Play with the xsd utility, it can make class to schema, and 
schema to class transformations...

&gt;<i>Another answer from &quot;Yann Christensen&quot; (probably from Microsoft) was:
</I>&gt;<i>
</I>&gt;<i> &gt; The answer is that the order is a function of the order of reflection. I
</I>&gt;<i> &gt; believe reflection makes no guarantees but in V1 for C# compiled code
</I>&gt;<i> &gt; you get fields in order and then properties in order as declared.
</I>&gt;<i> &gt; Apparently in VB the declared order and reflection order are not always
</I>&gt;<i> &gt; the same.
</I>
When you construct a XMLSerializer, you pass it a root type and it analises 
it with reflection (my hundred-plus hierarchy, takes almost half a minute to 
have a XMLSerializer constructed) AND generates a customized parser/writer 
in a temporary assembly to do the serialization/deserialization (when you 
debug the project you see this assembly being loaded, and when something 
breaks the parsing/writing you can see the generated methods' names in the 
stack-trace)

&gt;<i>	Now if this means the order of members returned by
</I>&gt;<i>GetType().GetMembers(), this is not entirely correct. The above theory of a
</I>&gt;<i>graph looks more appropriate.
</I>&gt;<i>	How are we implementing this? What is the order of reflection in
</I>&gt;<i>Mono?
</I>
Reflection really have some issues with ordering, at least when reading 
assembly attributes for my GetOptions class (GNU getopt is too low in 
abstraction that I´m writing something more object/event-oriented for Mono) 
I normally get attributes with multiple instances, in reversed order 
(looking at the instances values).

But surely, &quot;source&quot; order is what XmlSerializer considers, except for xml 
attributes. Look at this example:

[XmlRoot..]
[XmlType(&quot;MyRoot&quot;...]
public class Root
{

int a;

public int b;

[XmlAttribute...]
public int c;

[XmlIgnore]
public int d;

[XmlInclude(&quot;GrandChild&quot;,typeof(GrandChild)]
public Child[] children;

}

public class Child
{
public int ca;

public int cb;
}

public class GrandChild : Child
{
public int cc { get { return cb*2; } set { cb = value / 2; } }
}

A valid instance may be serialized as:

&lt;MyRoot xmlns=&quot;...&quot; c=&quot;456&quot;&gt;
  &lt;b&gt;123&lt;/b&gt;
  &lt;Child&gt;&lt;ca&gt;1&lt;/ca&gt;&lt;cb&gt;2&lt;/cb&gt;&lt;/Child&gt;
  &lt;GrandChild&gt;&lt;ca&gt;3&lt;/ca&gt;&lt;cb&gt;4&lt;/cb&gt;&lt;cc&gt;8&lt;/cc&gt;&lt;/GrandChild&gt;
  &lt;Child&gt;&lt;ca&gt;6&lt;/ca&gt;&lt;cb&gt;7&lt;/cb&gt;&lt;/Child&gt;
&lt;/MyRoot&gt;

See as field/properties names are the default tag names, but may be 
substituted, and go into oblivion for collections (this brings limitations 
on what types are allowed to be contained in subsequent fields that are 
collections, as the serializer will use tag names as a bordering criteria).

Sorry for showing you all this complexity, but I´m quite sure you´ll smash 
it. Time allowing, I´ll try to help you, at least with test cases from my 
daily usage.

Happy Hackings

Rafael Teixeira
Brazilian Developer


_________________________________________________________________
MSN Photos is the easiest way to share and print your photos: 
<A HREF="http://photos.msn.com/support/worldwide.aspx">http://photos.msn.com/support/worldwide.aspx</A>



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="006488.html">[Mono-list] Error: mcs.exe: cannot execute binary file
</A></li>
	<LI> Next message: <A HREF="006465.html">[Mono-list] how far behind is anon cvs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6461">[ date ]</a>
              <a href="thread.html#6461">[ thread ]</a>
              <a href="subject.html#6461">[ subject ]</a>
              <a href="author.html#6461">[ author ]</a>
         </LI>
       </UL>
</body></html>
