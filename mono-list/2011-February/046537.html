<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] System.Diagnostic.Process and event handlers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Diagnostic.Process%20and%20event%20handlers&In-Reply-To=1296667317620-3255025.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="046533.html">
   <LINK REL="Next"  HREF="046530.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] System.Diagnostic.Process and event handlers</H1>
    <B>noda</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20System.Diagnostic.Process%20and%20event%20handlers&In-Reply-To=1296667317620-3255025.post%40n4.nabble.com"
       TITLE="[Mono-list] System.Diagnostic.Process and event handlers">www.bgr at free.fr
       </A><BR>
    <I>Wed Feb  2 16:09:31 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="046533.html">[Mono-list] System.Diagnostic.Process and event handlers
</A></li>
        <LI>Next message: <A HREF="046530.html">[Mono-list] Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46537">[ date ]</a>
              <a href="thread.html#46537">[ thread ]</a>
              <a href="subject.html#46537">[ subject ]</a>
              <a href="author.html#46537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Just in case of interest, while making some tests before submitting my bug
report, I've been able to confirm the mono bug and also find a workaround in
the meanwhile.

The workaround (and somehow the proof of the bug) is to to do the
asynchronous standard output / event dispatch yourself, and it works
perfectly:

        public static bool HasStarted(Process proc)
        {
            try 
            {
                return (proc != null &amp;&amp; !proc.HasExited &amp;&amp; proc.Id != 0);
            }
            catch
            {
                return false;
            }
        }

        private void asyncReadStandardOutput()
        {
            try
            {
                do 
                {
                    string line = proc.StandardOutput.ReadLine();
                    if (line != null) {
                        // forward event here, or do something you want with
the line
                    }
                } 
                while (!proc.HasExited);
            }
            catch
            { }
        }

and in your code:

               proc = new Process();
                proc.StartInfo.FileName = &quot;aProgram&quot;;
                proc.StartInfo.WorkingDirectory =
Path.GetDirectoryName(proc.StartInfo.FileName);
                proc.StartInfo.UseShellExecute = false;;
                proc.StartInfo.RedirectStandardOutput = true;
                proc.StartInfo.CreateNoWindow = true;

                proc.Start();

                // work around mono bug while forwarding asynchronously
console output events
                while (!HasStarted(proc))
                    Thread.Sleep(1);

                Thread t1 = new Thread(asyncReadStandardOutput);
                t1.Start();
                
                proc.WaitForExit();				
                proc.Close();


I dislike using such Exception handling as part of the program, but for now
I haven't found any other way to work around this bug. 

-- 
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/System-Diagnostic-Process-and-event-handlers-tp3246096p3255815.html">http://mono.1490590.n4.nabble.com/System-Diagnostic-Process-and-event-handlers-tp3246096p3255815.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="046533.html">[Mono-list] System.Diagnostic.Process and event handlers
</A></li>
	<LI>Next message: <A HREF="046530.html">[Mono-list] Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46537">[ date ]</a>
              <a href="thread.html#46537">[ thread ]</a>
              <a href="subject.html#46537">[ subject ]</a>
              <a href="author.html#46537">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
