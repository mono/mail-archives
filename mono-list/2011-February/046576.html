<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] DllImport and modifying library search path
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20DllImport%20and%20modifying%20library%20search%20path&In-Reply-To=4D54E499.1060405%40xdt.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="046575.html">
   <LINK REL="Next"  HREF="046581.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] DllImport and modifying library search path</H1>
    <B>Robert Jordan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20DllImport%20and%20modifying%20library%20search%20path&In-Reply-To=4D54E499.1060405%40xdt.com.au"
       TITLE="[Mono-list] DllImport and modifying library search path">robertj at gmx.net
       </A><BR>
    <I>Fri Feb 11 04:25:37 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="046575.html">[Mono-list] DllImport and modifying library search path
</A></li>
        <LI>Next message: <A HREF="046581.html">[Mono-list] DllImport and modifying library search path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46576">[ date ]</a>
              <a href="thread.html#46576">[ thread ]</a>
              <a href="subject.html#46576">[ subject ]</a>
              <a href="author.html#46576">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On 11.02.2011 08:26, Uli Hertlein wrote:
&gt;<i> Now, to pickup the correct shared library I thought I'd prefix the the respective search path
</I>&gt;<i> (LD_LIBRARY_PATH on Linux, DYLD_LIBRARY_PATH on OS X, and PATH on Windows) with this directory.
</I>&gt;<i> This is then set using 'Environment.SetEnvironmentVariable(&quot;LD_LIBRARY_PATH&quot;, dllSearchPath)'
</I>
You're probably calling one of the p/invokes too close
to SetEnvironmentVariable (called either directly or indirectly).

If you really want such a fragile hack (it depends on the
order and the moment a method is JITed), you should compute
the variable that keeps the OS and bitness &quot;far away&quot; from
the first p/invoke call.

As Alexander wrote: in some static constructor, preferably
of another class.

Please consider using DLL maps (see &quot;man mono-config&quot;):

&lt;configuration&gt;
&lt;dllmap dll=&quot;Sdk&quot; target=&quot;libSdk32.so&quot; os=&quot;linux&quot; cpu=&quot;x86&quot; /&gt;
&lt;dllmap dll=&quot;Sdk&quot; target=&quot;libSdk64.so&quot; os=&quot;linux&quot; cpu=&quot;x86-64&quot; /&gt;
&lt;dllmap dll=&quot;Sdk&quot; target=&quot;libSdk32.dylib&quot; os=&quot;osx&quot; cpu=&quot;x86&quot; /&gt;
&lt;dllmap dll=&quot;Sdk&quot; target=&quot;libSdk64.dylib&quot; os=&quot;osx&quot; cpu=&quot;x86-64&quot; /&gt;
&lt;/configuration&gt;

Since MS.NET does not understand these elements, you must either
have a per target .exe.config file or move the p/invoke stuff
to its own assembly and configure it with its .dll.config.

Note that this does not solve the 32 vs. 64 bit issue under MS.NET,
so your mileage may vary.

The recommended way is to use the same native dll name under
all platforms and decide at deploy time what to install.
If this is not possible, then consider setting these
environment variables from a launching script.

Anything else is just a huge hack and big waste of time, IMO.

Robert

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="046575.html">[Mono-list] DllImport and modifying library search path
</A></li>
	<LI>Next message: <A HREF="046581.html">[Mono-list] DllImport and modifying library search path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46576">[ date ]</a>
              <a href="thread.html#46576">[ thread ]</a>
              <a href="subject.html#46576">[ subject ]</a>
              <a href="author.html#46576">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
