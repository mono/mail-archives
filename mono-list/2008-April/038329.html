<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono.Data.Tds.Protocol.TdsInternalException: Server	closed the connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Data.Tds.Protocol.TdsInternalException%3A%20Server%0A%09closed%20the%20connection&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038316.html">
   <LINK REL="Next"  HREF="038334.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono.Data.Tds.Protocol.TdsInternalException: Server	closed the connection</H1>
    <B>Christian Hobelsberger</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Data.Tds.Protocol.TdsInternalException%3A%20Server%0A%09closed%20the%20connection&In-Reply-To="
       TITLE="[Mono-list] Mono.Data.Tds.Protocol.TdsInternalException: Server	closed the connection">hobi1972 at gmail.com
       </A><BR>
    <I>Thu Apr 17 10:47:27 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="038316.html">[Mono-list] Mono/Gtk/X
</A></li>
        <LI>Next message: <A HREF="038334.html">[Mono-list] Mono.Data.Tds.Protocol.TdsInternalException: Server	closed the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38329">[ date ]</a>
              <a href="thread.html#38329">[ thread ]</a>
              <a href="subject.html#38329">[ subject ]</a>
              <a href="author.html#38329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

maybe someone can help with this problem.

I have a c# application which is copying a lot of data from one sql-server
to an other one - along with doing some re-structuring of data. So there are
a lot of sql-statements and stored procedures invoked, transactions are
used, too.
After a certain time i get the following exception:

Unhandled Exception: Mono.Data.Tds.Protocol.TdsInternalException: Server
closed the connection. ---&gt; System.IO.IOException: Write failure ---&gt;
System.Net.Sockets.SocketException: The socket has been shut down
  at System.Net.Sockets.Socket.Send (System.Byte[] buf, Int32 offset, Int32
size, SocketFlags flags) [0x00000]
  at System.Net.Sockets.NetworkStream.Write (System.Byte[] buffer, Int32
offset, Int32 size) [0x00000] --- End of inner exception stack trace ---
  at System.Net.Sockets.NetworkStream.Write (System.Byte[] buffer, Int32
offset, Int32 size) [0x00000]
  at Mono.Data.Tds.Protocol.TdsComm.SendPhysicalPacket (Boolean
isLastSegment) [0x00000]
  at Mono.Data.Tds.Protocol.TdsComm.SendPacket () [0x00000]
  at Mono.Data.Tds.Protocol.Tds.ExecuteQuery (System.String sql, Int32
timeout, Boolean wantResults) [0x00000] --- End of inner exception stack
trace ---
  at Mono.Data.Tds.Protocol.Tds.ExecuteQuery (System.String sql, Int32
timeout, Boolean wantResults) [0x00000]
  at Mono.Data.Tds.Protocol.Tds70.Execute (System.String commandText,
Mono.Data.Tds.TdsMetaParameterCollection parameters, Int32 timeout, Boolean
wantResults) [0x00000]
  at Mono.Data.Tds.Protocol.Tds.Execute (System.String sql) [0x00000]
  at System.Data.SqlClient.SqlTransaction.Rollback (System.String
transactionName) [0x00000]
  at System.Data.SqlClient.SqlTransaction.Rollback () [0x00000]
It always happens at the same record - if i remove the record - it happens
with the next ... so it seems not to be related to the record itself, but
more or less to the number of already processed records.

At the sql-server i see a message &quot;invalid buffer from client, error 17805,
severity 20, status 3&quot;.

The code itself runs well under windows with .net ... on linux (centos 4.5)
using mono 1.4, 1.5 and 1.9 it crashes. The machine should have enough
memory, etc. The code was compiled with visual studio 2005 - and then copied
over to a linux machine.

Does anyone have an idea what the reason can be - or how this can be solved?

thank you
CH
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20080417/3bebd505/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20080417/3bebd505/attachment.html</A> 
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038316.html">[Mono-list] Mono/Gtk/X
</A></li>
	<LI>Next message: <A HREF="038334.html">[Mono-list] Mono.Data.Tds.Protocol.TdsInternalException: Server	closed the connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38329">[ date ]</a>
              <a href="thread.html#38329">[ thread ]</a>
              <a href="subject.html#38329">[ subject ]</a>
              <a href="author.html#38329">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
