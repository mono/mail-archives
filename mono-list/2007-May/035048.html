<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Too many heap sections: Increase MAXHINCR	orMAX_HEAP_SECTS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Too%20many%20heap%20sections%3A%20Increase%20MAXHINCR%0A%09orMAX_HEAP_SECTS&In-Reply-To=117799f00705100843w622ddbc7tf25db84b9f006cf1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035043.html">
   <LINK REL="Next"  HREF="035049.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Too many heap sections: Increase MAXHINCR	orMAX_HEAP_SECTS</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Too%20many%20heap%20sections%3A%20Increase%20MAXHINCR%0A%09orMAX_HEAP_SECTS&In-Reply-To=117799f00705100843w622ddbc7tf25db84b9f006cf1%40mail.gmail.com"
       TITLE="[Mono-list] Too many heap sections: Increase MAXHINCR	orMAX_HEAP_SECTS">alan.mcgovern at gmail.com
       </A><BR>
    <I>Thu May 10 11:44:38 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="035043.html">[Mono-list] is inaccessible due to its protection level	(CS0122).possible Bug?
</A></li>
        <LI>Next message: <A HREF="035049.html">[Mono-list] Too many heap sections: Increase	MAXHINCRorMAX_HEAP_SECTS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35048">[ date ]</a>
              <a href="thread.html#35048">[ thread ]</a>
              <a href="subject.html#35048">[ subject ]</a>
              <a href="author.html#35048">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i> &gt;Also, as a test, could you initialise the memory stream to roughly the
</I>&gt;<i> size required to store the entire list&lt;T&gt; and see if it works then.
</I>

&gt;<i> That works fine if I do it that way.  But my problem is that I can't
</I>&gt;<i> really know in advance how much memory the serialization will use, so it's
</I>&gt;<i> not really a viable solution.  I'm thinking of trying to split up my list
</I>&gt;<i> into smaller chunks to see it this could fix the problem by avoiding the
</I>&gt;<i> large object heap, if there is such a heap in mono.
</I>&gt;<i>
</I>
Sounds like your problem is due to heap fragmentation. The only solution is
to use a best-guess for the approximate size of the memory stream and
initialise the memorystream to that to start off with. For example if the
average size of your class is 68 bytes, then initialise the memorystream to
array.Length * 68. Or some such thing.

Still, a testcase may prove useful.

Alan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070510/3caaaf95/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20070510/3caaaf95/attachment.html</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035043.html">[Mono-list] is inaccessible due to its protection level	(CS0122).possible Bug?
</A></li>
	<LI>Next message: <A HREF="035049.html">[Mono-list] Too many heap sections: Increase	MAXHINCRorMAX_HEAP_SECTS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35048">[ date ]</a>
              <a href="thread.html#35048">[ thread ]</a>
              <a href="subject.html#35048">[ subject ]</a>
              <a href="author.html#35048">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
