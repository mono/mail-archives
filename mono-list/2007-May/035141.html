<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] My program randomly doesn't work with Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20My%20program%20randomly%20doesn%27t%20work%20with%20Mono&In-Reply-To=117799f00705161344l174c2ae9y72c80f9b07ddc5bc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035130.html">
   <LINK REL="Next"  HREF="035122.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] My program randomly doesn't work with Mono</H1>
    <B>Jonathan Gagnon</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20My%20program%20randomly%20doesn%27t%20work%20with%20Mono&In-Reply-To=117799f00705161344l174c2ae9y72c80f9b07ddc5bc%40mail.gmail.com"
       TITLE="[Mono-list] My program randomly doesn't work with Mono">jonathan.gagnon at croesus.com
       </A><BR>
    <I>Thu May 17 07:51:22 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="035130.html">[Mono-list] My program randomly doesn't work with Mono
</A></li>
        <LI>Next message: <A HREF="035122.html">[Mono-list] My program randomly doesn't work with Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35141">[ date ]</a>
              <a href="thread.html#35141">[ thread ]</a>
              <a href="subject.html#35141">[ subject ]</a>
              <a href="author.html#35141">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
 
I don't think it is related to my system setup since you reproduced a
similar problem using my serialization example (attached to this email) on
MacOS.  Here's what you answered to me on 5/10/2007 :
 
&gt;<i>So the problem is this (as far as i can make out). You're fragmenting the
</I>heap and running out of &quot;free&quot; memory or the GC is just choking on the
amount of data you're spitting out. This is caused by two things. 
&gt;<i>1) The memorystream increasing in size
</I>&gt;<i>2) A hashtable internal to mono constantly increasing in size while
</I>serialisation is taking place.

&gt;<i>If you run your testcase with int num = 9000; instead of int num = 15000;
</I>it works fine. So the best advice i can offer is to serialise your data in
smaller chunks for the moment. 

&gt;<i>Also, i never managed to get an OOM exception when running on MacOS, but
</I>the program did seem to crash/hang.

&gt;<i>Alan. 
</I> 
This is the same problem, although with the simpler hashtable example, it
happens not to crash/hang on your system.  I'm pretty sure that by changing
the number of iterations, you could make it crash.
 
I noticed that although my serialization example doesn't crash on Windows,
it doesn't behave properly.  I would expect the serialized stream to be the
same size at each iteration, since I serialize the same data every time.
But after a few iterations, the size of the stream begins to change and then
I never get the same size again, which is unexpected.  Also, the behavior is
not the same at every run, and I have been able to make the application hang
on Windows too, although it doesn't happen very often.  So it really looks
like a memory problem, which would explain the different behavior from one
OS to another.  In any case, I don't think it is a system setup problem, now
that I have been able to reproduce it on Windows.
 
I submitted it as a runtime bug yesterday (81642).
 
Jonathan


  _____  

De : Alan McGovern [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">alan.mcgovern at gmail.com</A>] 
Envoy&#233; : Wednesday, May 16, 2007 4:44 PM
&#192; : Jonathan Gagnon
Cc : Chris Seaton; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
Objet : Re: [Mono-list] My program randomly doesn't work with Mono


I suppose it'd be worth submitting it as a runtime bug, but personally i
think it's an issue with your system setup. I can't see why the GC would
have a 2 gig heap when it's only allocated 1/10th of that.

Alan.


On 5/16/07, Jonathan Gagnon &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">jonathan.gagnon at croesus.com</A>&gt; wrote: 

I use Fedora Core 3 and mono 1.2.3.1.  I get the same problem when using
mono 1.2.4.  I  wanted to attach the outfile generated by heap-buddy but it
is too large for the mono-list.  I attached the &quot;backtraces&quot; and the &quot;types&quot;
outputs instead.  Here's the summary :

 
           SUMMARY
 
         Filename: outfile
  Allocated Bytes: 228.3M
Allocated Objects: 5000070
              GCs: 12
          Resizes: 328
  Final heap size: 2725.3M
 
   Distinct Types: 8
       Backtraces: 14 
 
 
Jonathan


  _____  

De : <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] De la part de Alan McGovern
Envoy&#233; : Wednesday, May 16, 2007 12:05 PM
&#192; : Chris Seaton
Cc : <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
Objet : Re: [Mono-list] My program randomly doesn't work with Mono



Can i get both of you experiencing problems to either run your applications
with heap-prof or heap-buddy to generate some profiling statistics to help
figure out whats going wrong on your particular setup?

Also, what OS's and mono versions are you on that are causing these
problems? Is the behaviour the same with mono 1.2.4? Please test that before
filing any bug reports.

Alan.


On 5/16/07, Chris Seaton &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">chris at chrisseaton.com</A>
&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">chris at chrisseaton.com</A>&gt; &gt; wrote: 

The problem is intermittent. I can work on my program all day and
then suddenly it just starts failing. Stick a Console.WriteLine in
and it works again. Then it stops again and I take it out and it
works again!

Chris

On 16 May 2007, at 16:54, Ted Milker wrote:

&gt;<i> Just an FYI but none of these crash on FreeBSD 6.2 running mono
</I>&gt;<i> 1.2.3.1
</I>&gt;<i>
</I>&gt;<i> Jonathan Gagnon wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I too have different behaviors if I put a Console.WriteLine in my
</I>&gt;&gt;<i> code. 
</I>&gt;&gt;<i> Consider the following example :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> static void Main(string[] args)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>     int num = 5000000;
</I>&gt;&gt;<i>     Hashtable table = new Hashtable();
</I>&gt;&gt;<i>     for (int i = 0; i &lt; num; ++i) 
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         Object obj = new Object();
</I>&gt;&gt;<i>         table.Add(obj, obj);
</I>&gt;&gt;<i>     }
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That crashes somewhere inside the for loop.  But if I add a 
</I>&gt;&gt;<i> WriteLine at the
</I>&gt;&gt;<i> beginning like this :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> static void Main(string[] args)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>     int num = 5000000;
</I>&gt;&gt;<i>     Console.WriteLine(&quot;WriteLine&quot;); 
</I>&gt;&gt;<i>     Hashtable table = new Hashtable();
</I>&gt;&gt;<i>     for (int i = 0; i &lt; num; ++i)
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         Object obj = new Object();
</I>&gt;&gt;<i>         table.Add(obj, obj);
</I>&gt;&gt;<i>     } 
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Everything works fine.  Then if I add another WriteLine at the end
</I>&gt;&gt;<i> followed
</I>&gt;&gt;<i> by a Thread.Sleep, it crashes again, but this time inside the
</I>&gt;&gt;<i> Thread.Sleep :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> static void Main(string[] args)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>     int num = 5000000;
</I>&gt;&gt;<i>     Console.WriteLine(&quot;WriteLine&quot;);
</I>&gt;&gt;<i>     Hashtable table = new Hashtable();
</I>&gt;&gt;<i>     for (int i = 0; i &lt; num; ++i) 
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         Object obj = new Object();
</I>&gt;&gt;<i>         table.Add(obj, obj);
</I>&gt;&gt;<i>     }
</I>&gt;&gt;<i>     Console.WriteLine(&quot;WriteLine&quot;);
</I>&gt;&gt;<i>     Thread.Sleep(10000);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any modifications to that code may lead to different behaviors.
</I>&gt;&gt;<i> Sometimes I
</I>&gt;&gt;<i> seem to end up being stuck in a infinite loop (with 2.8 gig of
</I>&gt;&gt;<i> allocated
</I>&gt;&gt;<i> virtual memory).  It seems like the size of the executable has an
</I>&gt;&gt;<i> impact on
</I>&gt;&gt;<i> the result...
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -   <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>
_______________________________________________ 
Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070517/3703b5cb/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20070517/3703b5cb/attachment.html</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Serialization.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070517/3703b5cb/attachment.pl">http://lists.ximian.com/pipermail/mono-list/attachments/20070517/3703b5cb/attachment.pl</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035130.html">[Mono-list] My program randomly doesn't work with Mono
</A></li>
	<LI>Next message: <A HREF="035122.html">[Mono-list] My program randomly doesn't work with Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35141">[ date ]</a>
              <a href="thread.html#35141">[ thread ]</a>
              <a href="subject.html#35141">[ subject ]</a>
              <a href="author.html#35141">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
