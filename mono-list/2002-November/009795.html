<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] [PATCH] BufferedStream.cs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:carlosga%40telefonica.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <LINK REL="Previous"  HREF="009825.html">
   <LINK REL="Next"  HREF="009798.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] [PATCH] BufferedStream.cs
   </H1>
    <B>Carlos Guzmán Álvarez
    </B> 
    <A HREF="mailto:carlosga%40telefonica.net"
       TITLE="[Mono-list] [PATCH] BufferedStream.cs">carlosga@telefonica.net
       </A><BR>
    <I>Wed, 20 Nov 2002 12:12:50 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="009825.html">[Mono-list] compiler error
</A></li>
        <LI> Next message: <A HREF="009798.html">[Mono-list] [PATCH] BufferedStream.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9795">[ date ]</a>
              <a href="thread.html#9795">[ thread ]</a>
              <a href="subject.html#9795">[ subject ]</a>
              <a href="author.html#9795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.
--------------090107010507080904010903
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit

Hello:


This patch fix a problem closing a bufferedstream that uses a 
networkstream, the problem gives when bufferedstream try to get the 
value of the property Position of the networkstream, this property on 
networkstream will throw always an exeption(this is correct).

The same thing with csc works well.




Best regards
Carlos Guzmán Álvarez
Vigo-Spain



P.S.: I use GetType().FullName instead of is because using the last mcs 
don´t build.

--------------090107010507080904010903
Content-Type: text/plain;
 name=&quot;patch.txt&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;patch.txt&quot;

Index: BufferedStream.cs
===================================================================
RCS file: /mono/mcs/class/corlib/System.IO/BufferedStream.cs,v
retrieving revision 1.2
diff -u -r1.2 BufferedStream.cs
--- BufferedStream.cs	8 May 2002 13:21:11 -0000	1.2
+++ BufferedStream.cs	20 Nov 2002 10:53:55 -0000
@@ -65,7 +65,9 @@
 
 		public override void Flush() {
 			if (m_buffer_reading) {
-				m_stream.Position = Position;
+				if((m_stream.GetType().FullName != &quot;System.Net.Sockets.NetworkStream&quot;)){
+					m_stream.Position = Position;
+				}
 			} else {
 				m_stream.Write(m_buffer, 0, m_buffer_pos);
 			}

--------------090107010507080904010903--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009825.html">[Mono-list] compiler error
</A></li>
	<LI> Next message: <A HREF="009798.html">[Mono-list] [PATCH] BufferedStream.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9795">[ date ]</a>
              <a href="thread.html#9795">[ thread ]</a>
              <a href="subject.html#9795">[ subject ]</a>
              <a href="author.html#9795">[ author ]</a>
         </LI>
       </UL>
</body></html>
