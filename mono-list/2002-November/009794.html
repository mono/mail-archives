<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Writing daemons in C#
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="009793.html">
   <LINK REL="Next"  HREF="009801.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Writing daemons in C#
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Writing daemons in C#">lupus@ximian.com
       </A><BR>
    <I>Wed, 20 Nov 2002 11:49:39 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="009793.html">[Mono-list] Writing daemons in C#
</A></li>
        <LI> Next message: <A HREF="009801.html">[Mono-list] Writing daemons in C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9794">[ date ]</a>
              <a href="thread.html#9794">[ thread ]</a>
              <a href="subject.html#9794">[ subject ]</a>
              <a href="author.html#9794">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/19/02 Adam Keys wrote:
&gt;<i> On Tue, 2002-11-19 at 19:31, Miguel de Icaza wrote:
</I>&gt;<i> &gt; There are various sites online with the POSIX APIs.
</I>&gt;<i> 
</I>&gt;<i> Googling revealed a few fairly uninformative sites.  However, an
</I>&gt;<i> effort[1] to implement POSIX APIs in Java did show up.  However, they
</I>&gt;<i> did not have code, just a (useful to me) list of functions in the POSIX
</I>&gt;<i> standard.
</I>
Have also a look at the POSIX perl module: just do man POSIX if you have
perl installed.

&gt;<i> &gt; It should be easily doable for a new programmer, but you must be ready
</I>&gt;<i> &gt; to rewrite a few chunks based on the input that you will very likely
</I>&gt;<i> &gt; receive ;-)
</I>&gt;<i> 
</I>&gt;<i> I'm presuming DllImport and P/Invoke aren't the preferred methods here? 
</I>&gt;<i> I looked at System.Net.Socket, since that would appear to be a task
</I>&gt;<i> similar to implementing POSIX APIs.  It uses InternalCall, which I'm
</I>&gt;<i> presuming (C# In A Nutshell is not so clear on this) is implemented
</I>&gt;<i> within the interpreter.  I poked through mono and found the file
</I>&gt;<i> mono/io-layer/sockets.c which appears to be the internal implementation
</I>&gt;<i> of the Sockets API.  Would the POSIX implementation look similar to
</I>&gt;<i> this?  Is there someplace all this is documented or am I on my own?
</I>
My idea is to implement it using DllImport, mostly. Many of the calls
are dangerous anyway, so requiring p/invoke permissions is just about
right. The socket stuff in System is done using internal calls because
it has different permission requirements and it needs to tie to some
runtime features like the handles.
Consider chwon:

	int chown (const char *path, uid_t owner, gid_t group);

in C# it becomes:

	[DllImport (&quot;libc&quot;)]
	public static int chown (string path, int owner, int group);

Now, that is the bare-bones stuff and it's enough to get started.
Next, I want to write easy to use wrappers, like:

	public static int chown (string path, string owner, string group) {
		int uid = owner == null? -1: get_uid_from_name (owner);
		int gid = group == null? -1: get_gid_from_name (group);
		// check for errors
		return chown (path, uid, gid);
	}

So that I can do things like:

	POSIX.chown (&quot;/etc/passwd&quot;, &quot;lupus&quot;, &quot;evil&quot;);

Third, I want a version of the API that raises exceptions on error, so
that I don't need to do all the checking myself.

After that I want it to have better integration with the mono runtime
and the base assemblies: this involves internal calls. This is needed,
say, to get a FileStream back from a file descriptor used in the POSIX
API and vice versa.

Hope that gives a better idea of what I'd like the Mono.POSIX assembly
to look like:

1) Massive use of DllImport (a little boring, but easy to do).
2) Easy to use interfaces (requires good taste for APIs:-).
3) Exception-raising variants (again, a little boring).
4) Requires internal calls for better integration.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009793.html">[Mono-list] Writing daemons in C#
</A></li>
	<LI> Next message: <A HREF="009801.html">[Mono-list] Writing daemons in C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9794">[ date ]</a>
              <a href="thread.html#9794">[ thread ]</a>
              <a href="subject.html#9794">[ subject ]</a>
              <a href="author.html#9794">[ author ]</a>
         </LI>
       </UL>
</body></html>
