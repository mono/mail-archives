<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] DbDataAdapter in ADO.NET Provider Factory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:danmorg%40sc.rr.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="009572.html">
   <LINK REL="Next"  HREF="009659.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] DbDataAdapter in ADO.NET Provider Factory
   </H1>
    <B>Daniel Morgan
    </B> 
    <A HREF="mailto:danmorg%40sc.rr.com"
       TITLE="[Mono-list] DbDataAdapter in ADO.NET Provider Factory">danmorg@sc.rr.com
       </A><BR>
    <I>Mon, 11 Nov 2002 14:14:52 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="009572.html">[Mono-list] ADO.NET Provider Factory
</A></li>
        <LI> Next message: <A HREF="009659.html">[Mono-list] profiling mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9607">[ date ]</a>
              <a href="thread.html#9607">[ thread ]</a>
              <a href="subject.html#9607">[ subject ]</a>
              <a href="author.html#9607">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brian,

Can you add the ability to dynamically create a DbDataAdapter for a given
connection class generically?

I would l like to use the adapter in provider generic code.  I've also
provided sample code that could create the DbDataAdapter for an ADO.NET data
provider.

What do you think?

		// data provider generic code
		IDbConnection conn =
ProviderFactory.CreateConnectionFromConfig(&quot;TdsPubsConnStr&quot;);
		CreateXmlFileFromSqlQuery(&quot;select * from employee&quot;, &quot;employee.xml&quot;,
			conn, &quot;Mono.Data.TdsClient&quot;);

		public void CreateXmlFileFromSqlQuery (string sql, string filename,
				IDbConnection conn, string providerAssembly) {

			IDbCommand cmd = conn.CreateCommand();

			// set command properties
			cmd.CommandType = CommandType.Text;
			cmd.CommandText = sql;
			cmd.Connection = conn;

			DataSet dataSet = new DataSet ();
			DataAdapter adapter = CreateNewDataAdapter (cmd, conn);
			adapter.Fill (dataSet, &quot;Table1&quot;);
			dataSet.WriteXml (filename);
		}

		// sample code to create new data adapter generically
		public DataAdapter CreateNewDataAdapter (string provider,
			string providerAssembly,
			IDbConnection connection, IDbCommand command) {

			DataAdapter adapter = null;

			switch(provider) {
			case &quot;ODBC&quot;:
				adapter = (DataAdapter) new OdbcDataAdapter ();
				break;
			case &quot;OLEDB&quot;:
				adapter = (DataAdapter) new OleDataAdapter ();
				break;
			case &quot;SQLCLIENT&quot;:
				adapter = (DataAdapter) new SqlDataAdapter ();
				break;
			case &quot;LOADEXTPROVIDER&quot;:
				adapter = CreateExternalDataAdapter ();
				if (adapter == null)
					return;
				break;
			default:
				Console.WriteLine(&quot;Error: Data Adapter not found in provider.&quot;);
				return;
			}
			IDbDataAdapter dbAdapter = (IDbDataAdapter) adapter;
			dbAdapter.SelectCommand = command;

			return adapter;
		}

		// sample code for loading the concrete subclass of DbDataAdapter
		// Thanks to Gonzalo for helping me with this
		public DataAdapter CreateExternalDataAdapter (string providerAssembly) {

			Assembly ass = Assembly.Load (providerAssembly);
			Type [] types = ass.GetTypes ();
			foreach (Type t in types) {
				if (t.IsSubClassOf (&quot;System.Data.DbDataAdapter&quot;) == false)
					continue;
			}
			if (t.IsSubClassOf (&quot;System.Data.DbDataAdapter&quot;) == false)
				return null; // adapter class not found

			adapter = (DataAdapter) Activator.CreateInstance (t);

			return adapter;
		}

-----Original Message-----
From: <A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A> [mailto:<A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A>]On
Behalf Of Brian Ritchieo u
Sent: Saturday, November 09, 2002 11:59 AM
To: <A HREF="mailto:rodrigo@ximian.com">rodrigo@ximian.com</A>
Cc: <A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>
Subject: Re: [Mono-list] ADO.NET Provider Factory


Rodrigo,

Thanks for the review.  I guess great minds think alike...I actually already
had a CreateConnectionFromConfig. :)

Here's the syntax for it:

IDbConnection
conn=ProviderFactory.CreateConnectionFromConfig(&quot;PubsConnStr&quot;);

&lt;appSettings&gt;
  &lt;add key=&quot;PubsConnStr&quot; value=&quot;factory=System.Data.SqlClient;
server=speedy;database=pubs;uid=sa;pwd=&quot; /&gt;
&lt;/appSettings&gt;

The factory attribute specifies which provider to use.  I parse out the
factory attribute, crete the object, and then pass the rest of the
connection string into the provider. The providers are definited in the
app.config (or machine.config).

I'll get the code commited sometime today.

Brian


&gt;<i>From: Rodrigo Moya &lt;<A HREF="mailto:rodrigo@ximian.com">rodrigo@ximian.com</A>&gt;
</I>&gt;<i>To: Brian Ritchie &lt;<A HREF="mailto:brianlritchie@hotmail.com">brianlritchie@hotmail.com</A>&gt;
</I>&gt;<i>CC: Mono List &lt;<A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>&gt;
</I>&gt;<i>Subject: Re: [Mono-list] ADO.NET Provider Factory
</I>&gt;<i>Date: 09 Nov 2002 12:15:52 +0100
</I>&gt;<i>
</I>&gt;<i>On Mon, 2002-11-04 at 06:37, Brian Ritchie wrote:
</I>&gt;<i> &gt; I've started work on the set of objects known as... &quot;ADO.NET
</I>&gt;<i> &gt; Multiplexor Provider&quot; in... <A HREF="http://www.go-mono.com/ado-net.html">http://www.go-mono.com/ado-net.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'd appreciate the ADO.NET team to review this (and attached files)
</I>&gt;<i> &gt; before I commit things to CVS. I'm planning to put them under
</I>&gt;<i> &gt; /mcs/class/Mono.Data. Please note: connection strings will in attached
</I>&gt;<i> &gt; files will need to be updated to match your configuration.  I've done
</I>&gt;<i> &gt; some basic testing of the code under MS.NET &amp; Mono on Windows.
</I>&gt;<i> &gt;
</I>&gt;<i>it looks ok to me. I would also add one thing though, which is a way to
</I>&gt;<i>activate a given provider/connection string without having to know the
</I>&gt;<i>provider to be used. That is, something like the ODBC (or libgda) data
</I>&gt;<i>sources, on which you store, under a unique name, all parameteres needed
</I>&gt;<i>for the connection to be established. Something like:
</I>&gt;<i>
</I>&gt;<i>IDbConnection cnc = ProviderFactory.CreateConnectionFromConfig
</I>&gt;<i>(&quot;my_data_source&quot;);
</I>&gt;<i>
</I>&gt;<i>and then have, in the config file, an entry called &quot;my_data_source&quot;
</I>&gt;<i>which contains the info for the provider and connection string to be
</I>&gt;<i>used to open this given connection.
</I>&gt;<i>
</I>&gt;<i>Apart from that, it looks ok to me, so please commit as soon as you can.
</I>&gt;<i>
</I>&gt;<i>and sorry for the delay in answering, but I've been really busy these
</I>&gt;<i>last weeks.
</I>&gt;<i>
</I>&gt;<i>cheers
</I>&gt;<i>--
</I>&gt;<i>Rodrigo Moya &lt;<A HREF="mailto:rodrigo@ximian.com">rodrigo@ximian.com</A>&gt;
</I>

_________________________________________________________________
Help STOP SPAM with the new MSN 8 and get 2 months FREE*
<A HREF="http://join.msn.com/?page=features/junkmail">http://join.msn.com/?page=features/junkmail</A>


_______________________________________________
Mono-list maillist  -  <A HREF="mailto:Mono-list@ximian.com">Mono-list@ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009572.html">[Mono-list] ADO.NET Provider Factory
</A></li>
	<LI> Next message: <A HREF="009659.html">[Mono-list] profiling mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9607">[ date ]</a>
              <a href="thread.html#9607">[ thread ]</a>
              <a href="subject.html#9607">[ subject ]</a>
              <a href="author.html#9607">[ author ]</a>
         </LI>
       </UL>
</body></html>
