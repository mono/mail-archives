<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Writing daemons in C#
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="009829.html">
   <LINK REL="Next"  HREF="009809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Writing daemons in C#
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Writing daemons in C#">lupus@ximian.com
       </A><BR>
    <I>Wed, 20 Nov 2002 23:01:25 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="009829.html">[Mono-list] Writing daemons in C#
</A></li>
        <LI> Next message: <A HREF="009809.html">[Mono-list] C# Class Scheduler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9831">[ date ]</a>
              <a href="thread.html#9831">[ thread ]</a>
              <a href="subject.html#9831">[ subject ]</a>
              <a href="author.html#9831">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/20/02 Miguel de Icaza wrote:
&gt;<i> &gt; 1) per-OS assembly
</I>&gt;<i> &gt; 	* faster
</I>&gt;<i> &gt; 	* smaller
</I>&gt;<i> &gt; 	* easier to deploy
</I>&gt;<i> &gt; 2) OS-indep assembly + OS-dependent shared library
</I>&gt;<i> &gt; 	* slower
</I>&gt;<i> &gt; 	* bigger
</I>&gt;<i> &gt; 	* one more thing to deploy
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The choice looks like a no brainer to me:-)
</I>&gt;<i> 
</I>&gt;<i> You also have to consider that you will need to wrap structures, for
</I>&gt;<i> example, lets take the `stat' structure.   That is much easier to
</I>&gt;<i> implement by using the scheme I suggested.
</I>&gt;<i> 
</I>&gt;<i> If we want to have a shared-library-less implementation the parser for
</I>&gt;<i> structures will probably be pretty complex to generate a c# version of
</I>&gt;<i> it that matches the Unix version of it.
</I>&gt;<i> 
</I>&gt;<i> Your turn ;)
</I>
Dude, you never give up, eh? :-)

There is no difference in supporting the stat call, your method is still
bigger and it requires a shared library in C. And there is no complexity
difference: you don't write a parser for structures, you just need to
know the names of the fields you're interested in and use offsetof to
calc their offset inside the struct.
The same script/C program that retrieves the values for the defines can
also create the C# structure that matches the OS stat structure:

	[StructLayout (LayoutKind.Explicit)]
	struct StatInternal {
		[FieldOffset (0)] int st_dev;
		[FieldOffset (4)] int st_ino;
		[...]
	};

The assembly will export instead a different Stat structure that doesn't
change on different systems (but some fields can be unset):

	public struct Stat {
		int st_dev;
		int st_ino;
		[...]
	};

The script that creates StatInternal will also output a method that
translates a StatInternal to a Stat:

	static void ConvertStat (ref StatInternal from, out Stat to) {
		to.st_dev = from.st_dev;
		[...]
	}

The assembly will have two stat methods, the pinvoke one that uses
StatInternal and the normal one that uses Stat:

	[DllImport (libc&quot;, &quot;stat&quot;)]
	static int stat_internal (string path, out StatInternal stat);

and

	public static int stat (string path, out Stat stat) {
		StatInternal si;
		int result = stat_internal (path, out si);
		ConvertStat (ref si, out stat);
		return result;
	}

We _could_ make StatInternal and stat_internal() public, so that people
that know what they are doing can poke into it and make their programm
less portable:-)
As you see, still no ugly shared library to depend upon:-)

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009829.html">[Mono-list] Writing daemons in C#
</A></li>
	<LI> Next message: <A HREF="009809.html">[Mono-list] C# Class Scheduler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9831">[ date ]</a>
              <a href="thread.html#9831">[ thread ]</a>
              <a href="subject.html#9831">[ subject ]</a>
              <a href="author.html#9831">[ author ]</a>
         </LI>
       </UL>
</body></html>
