<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] JITer / Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="004607.html">
   <LINK REL="Next"  HREF="004760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] JITer / Windows
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] JITer / Windows">lupus@ximian.com
       </A><BR>
    <I>Sat, 6 Apr 2002 16:13:39 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="004607.html">[Mono-list] JITer / Windows
</A></li>
        <LI> Next message: <A HREF="004760.html">[Mono-list] JITer / Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4756">[ date ]</a>
              <a href="thread.html#4756">[ thread ]</a>
              <a href="subject.html#4756">[ subject ]</a>
              <a href="author.html#4756">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/03/02 Serge wrote:
&gt;<i> &gt; That way we do not need
</I>&gt;<i> &gt; macros, which are quite confusing IMO.
</I>&gt;<i> 
</I>&gt;<i> I completely agree, will change this.
</I>&gt;<i> Actually, in the future I'd prefer to use some mono-defined structure rather
</I>&gt;<i> than straight sigcontext. As a part of os/arch interface or host API. Some
</I>&gt;<i> things that also seems suitable for such interface are i-cache flushing
</I>&gt;<i> (some OSes have API/syscall for this) and code-memory allocation (it seems
</I>&gt;<i> that under Windows g_malloc always allocates memory that is executable, but
</I>&gt;<i> anyway).
</I>
We'll need to handle this for Linux, too: there is no guarantee malloc()
returns executable memory. I think the beter approach on unix-like
systems is to just use an anonymous mmap() call and sequentially
write the code into that area. Say, you allocate 64-128 KB with mmap
at once and just write the methods one after another: this should
automatically give also some code locality for related methods since
we compile them as needed. A different buffer could be used for
static constructors, since they are executed just once tipically
the code could be discarded after it's executed and so it may be better
to alloc that with malloc.
i-cache flushing is processor-specific, it doesn't depend on the OS,
AFAIK (though it may need to be coded in the compiler-specific asm
keyword variant).

Anyway, I don't know if it makes sense to have OS-specific directories
or modules since the OS details should be really small and can be
#ifdeffed in the source (the io-layer is an exception, of course, but
I don't consider it an OS-specific detail:-).

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="004607.html">[Mono-list] JITer / Windows
</A></li>
	<LI> Next message: <A HREF="004760.html">[Mono-list] JITer / Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4756">[ date ]</a>
              <a href="thread.html#4756">[ thread ]</a>
              <a href="subject.html#4756">[ subject ]</a>
              <a href="author.html#4756">[ author ]</a>
         </LI>
       </UL>
</body></html>
