<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] .NET exe's at cmdline mini tutorial
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pt99par%40student.bth.se">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005248.html">
   <LINK REL="Next"  HREF="005184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] .NET exe's at cmdline mini tutorial
   </H1>
    <B>Per Arneng
    </B> 
    <A HREF="mailto:pt99par%40student.bth.se"
       TITLE="[Mono-list] .NET exe's at cmdline mini tutorial">pt99par@student.bth.se
       </A><BR>
    <I>Sun, 21 Apr 2002 17:20:54 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="005248.html">[Mono-list] System.Web.Mail Enumerations
</A></li>
        <LI> Next message: <A HREF="005184.html">[Mono-list] .NET exe's at cmdline mini tutorial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5179">[ date ]</a>
              <a href="thread.html#5179">[ thread ]</a>
              <a href="subject.html#5179">[ subject ]</a>
              <a href="author.html#5179">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--------------Boundary-00=_UYBXRKV4YPYETK8Q2V9F
Content-Type: text/plain;
  charset=&quot;us-ascii&quot;
Content-Transfer-Encoding: 8bit

Hi!

Made a mini tutorial and a startup script.. heard about some other program 
that did something about it too but then it was to late, i had already done 
it so here it is .. 

/per
--------------Boundary-00=_UYBXRKV4YPYETK8Q2V9F
Content-Type: text/html;
  charset=&quot;us-ascii&quot;;
  name=&quot;PELinux.html&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename=&quot;PELinux.html&quot;


&lt;html&gt;

&lt;head&gt;
  &lt;title&gt;.NET executables directly from the command line in Linux&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;h1&gt;.NET executables directly from the command line in Linux&lt;/h1&gt;
&lt;p&gt;
  &lt;h2&gt;Abstract&lt;/h2&gt;
  This is a mini tutorial on how to make .NET executables run directly from the command line like this:
  &lt;p&gt;
    &lt;pre&gt;[<A HREF="mailto:pure@p">pure@p</A> tmp]$ mcs.exe&lt;/pre&gt;
  
    or
  
    &lt;pre&gt;[<A HREF="mailto:pure@p">pure@p</A> test]$ ./my_dotnet_app.exe&lt;/pre&gt;
 
&lt;p&gt;
  &lt;h2&gt;Registering .NET executables with the binfmt_misc kernel module&lt;/h2&gt;
&lt;p&gt;
  To do this we need to echo a a string containing the association to the 'register' file
  in the  '/proc/sys/fs/binfmt_misc' directory. The format of this string looks like this:
  &lt;pre&gt;:name:type:offset:magic:mask:interpreter:&lt;/pre&gt;
&lt;p&gt;
  Now as you see we need some info to create this string:
  &lt;p&gt;

  &lt;table border='1'&gt;
    &lt;tr&gt;&lt;td&gt;&lt;b&gt; Name: &lt;/b&gt;&lt;/td&gt;&lt;td&gt; &amp;nbsp; mono &lt;/td&gt;&lt;td&gt;can be anything you wish&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;&lt;b&gt; Type: &lt;/b&gt;&lt;/td&gt;&lt;td&gt; &amp;nbsp; M &lt;/td&gt;&lt;td&gt;specifies that we want to use the magic number instead of the extension&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;&lt;b&gt; Offset: &lt;/b&gt;&lt;/td&gt;&lt;td&gt;&amp;nbsp; 74 &lt;/td&gt;&lt;td&gt;Nr of bytes to where the magic number is found inside the .exe file&lt;/td&gt;&lt;/tr
    &lt;tr&gt;&lt;td&gt;&lt;b&gt; Magic:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&amp;nbsp; 01 4c &lt;/td&gt;&lt;td&gt;Magic number as stated &lt;a href='<A HREF="http://www.southern-storm.com.au/docs/pnettools_10.html'">http://www.southern-storm.com.au/docs/pnettools_10.html'</A>&gt;here&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;&lt;b&gt; Mask: &lt;/b&gt;&lt;/td&gt;&lt;td&gt; &amp;nbsp;  &lt;/td&gt;&lt;td&gt;should be left empty in this case&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;&lt;b&gt; Interpreter: &lt;/b&gt;&lt;/td&gt;&lt;td&gt; &amp;nbsp; /usr/local/bin/mono &lt;/td&gt;&lt;td&gt;path to interpreter or jit ex: mono or mint&lt;/td&gt;&lt;/tr&gt;
  &lt;/table&gt;
&lt;p&gt;
  The string we end up with now looks like this:

  &lt;pre&gt;:mono:M:74:\x01\x4c::/usr/local/bin/mono:&lt;/pre&gt;

  &lt;p&gt;
   Now lets register this string with binfmt_misc. To achieve that we do like this (as root ):
  &lt;p&gt;
  
  &lt;pre&gt;[<A HREF="mailto:root@p">root@p</A> tmp]# echo ':mono:M:74:\x01\x4c::/usr/local/bin/mono:' &gt; /proc/sys/fs/binfmt_misc/register&lt;/pre&gt;

&lt;p&gt;
  A file called 'mono' (or the name you chose) should have been created in this directory. You can try
 it out by executing a .NET executable but remember that the executable bit has to be set.
&lt;p&gt;
 
&lt;pre&gt;[<A HREF="mailto:pure@p">pure@p</A> test]$ ./my_dotnet_app.exe&lt;/pre&gt;

&lt;p&gt; 
 You probably want to have this registration done at boot time so then you could just add :
&lt;p&gt;
 &lt;pre&gt;echo ':mono:M:74:\x01\x4c::/usr/local/bin/mono:' &gt; /proc/sys/fs/binfmt_misc/register&lt;/pre&gt;
&lt;p&gt; 
to one of your rc scripts of your choice.

&lt;h2&gt;Important&lt;/h2&gt;
&lt;p&gt;
 Make sure that the registration is done after Wine makes its registrations for windows exe files. Otherwise wine will
 try to execute the file.

&lt;h2&gt;Sample script for use at startup in /etc/init.d&lt;/h2&gt;
&lt;p&gt;
&lt;table border='0' bgcolor='#DDDDDD' width='90%'&gt;&lt;tr&gt;&lt;td&gt;
&lt;pre&gt;
#!/bin/bash
# This startup script enables .NET portable executables to be executed directly
# from command line or by clicking on them.
# The script it converted from wine's by Per Arneng

RETVAL=0

function start () {
    /sbin/modprobe binfmt_misc &amp;&gt; /dev/null
    
    RETVAL=$?
    
    echo ':mono:M:74:\x01\x4c::/usr/local/bin/mono:' &gt; /proc/sys/fs/binfmt_misc/register
    
    return $RETVAL
}

function stop () {
    echo &quot;-1&quot; &gt; /proc/sys/fs/binfmt_misc/mono
    
    RETVAL=$?
    
    return $RETVAL
}

case &quot;$1&quot; in
    start)start;;
    stop)stop;;
    status)[[ -e /proc/sys/fs/binfmt_misc/mono ]] &amp;&amp; echo .NET exe registration enabled || echo .NET exe registration disabled ;;
    restart);;
    reload);;
    *) echo &quot;Usage: ${0##*/} {start|status|stop}&quot;; exit 1;
esac

exit $RETVAL

&lt;/pre&gt;

&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;p&gt;

&lt;h2&gt;Links&lt;/h2&gt;
 The binfmt_misc home-page - &lt;a href='<A HREF="http://www.tat.physik.uni-tuebingen.de/~rguenth/linux/binfmt_misc.html'">http://www.tat.physik.uni-tuebingen.de/~rguenth/linux/binfmt_misc.html'</A>&gt; <A HREF="http://www.tat.physik.uni-tuebingen.de/~rguenth/linux/binfmt_misc.html</a">http://www.tat.physik.uni-tuebingen.de/~rguenth/linux/binfmt_misc.html&lt;/a</A>&gt;&lt;br&gt;
 The binfmt_misc documentation - &lt;a href='<A HREF="http://www.linuxhq.com/kernel/v2.4/doc/binfmt_misc.txt.html'">http://www.linuxhq.com/kernel/v2.4/doc/binfmt_misc.txt.html'</A>&gt;<A HREF="http://www.linuxhq.com/kernel/v2.4/doc/binfmt_misc.txt.html</a">http://www.linuxhq.com/kernel/v2.4/doc/binfmt_misc.txt.html&lt;/a</A>&gt;&lt;br&gt;
 ECMA file format extensions - &lt;a href='<A HREF="http://www.southern-storm.com.au/docs/pnettools_10.html'">http://www.southern-storm.com.au/docs/pnettools_10.html'</A>&gt;<A HREF="http://www.southern-storm.com.au/docs/pnettools_10.html</a">http://www.southern-storm.com.au/docs/pnettools_10.html&lt;/a</A>&gt;&lt;br&gt;
&lt;p&gt;
&lt;h2&gt;Author&lt;/h2&gt;
Per Arneng &lt;a href='mailto:<A HREF="mailto:pt99par@student.bth.se">pt99par@student.bth.se</A>'&gt;<A HREF="mailto:pt99par@student.bth.se">pt99par@student.bth.se</A>&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;








--------------Boundary-00=_UYBXRKV4YPYETK8Q2V9F--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005248.html">[Mono-list] System.Web.Mail Enumerations
</A></li>
	<LI> Next message: <A HREF="005184.html">[Mono-list] .NET exe's at cmdline mini tutorial
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5179">[ date ]</a>
              <a href="thread.html#5179">[ thread ]</a>
              <a href="subject.html#5179">[ subject ]</a>
              <a href="author.html#5179">[ author ]</a>
         </LI>
       </UL>
</body></html>
