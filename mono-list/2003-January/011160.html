<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] bug in ArrayList::RemoveRange ()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:vargaz%40freemail.hu">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="011170.html">
   <LINK REL="Next"  HREF="011161.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] bug in ArrayList::RemoveRange ()
   </H1>
    <B>Varga Zoltan
    </B> 
    <A HREF="mailto:vargaz%40freemail.hu"
       TITLE="[Mono-list] bug in ArrayList::RemoveRange ()">vargaz@freemail.hu
       </A><BR>
    <I>Sun, 12 Jan 2003 17:59:33 +0100 (CET)</I>
    <P><UL>
        <LI> Previous message: <A HREF="011170.html">[Mono-list] Moving from .NET to Mono on Linux
</A></li>
        <LI> Next message: <A HREF="011161.html">[Mono-list] bug in ArrayList::RemoveRange ()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11160">[ date ]</a>
              <a href="thread.html#11160">[ thread ]</a>
              <a href="subject.html#11160">[ subject ]</a>
              <a href="author.html#11160">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--0-1804289383-1042390773=:88315
Content-Type: TEXT/PLAIN; CHARSET=ISO-8859-2


                                         Hi,

  Under MS .NET, RemoveRange () allows a zero sized removal
at the end
of the list, i.e. 

aList.RemoveRange (aList.Count, 0)

works. There is code out there which depends on this behavior.

The attached patch fixes this. It also cleans up the
argument checking code so the raised exceptions have the
same message as under MS.NET.


--0-1804289383-1042390773=:88315
Content-Type: APPLICATION/octet-stream; name=&quot;arraylist.patch&quot;
Content-Disposition: attachment; filename=&quot;arraylist.patch&quot;

Index: System.Collections/ArrayList.cs
===================================================================
RCS file: /cvs/public/mcs/class/corlib/System.Collections/ArrayList.cs,v
retrieving revision 1.39
diff -u -3 -p -r1.39 ArrayList.cs
--- System.Collections/ArrayList.cs	10 Jan 2003 21:54:44 -0000	1.39
+++ System.Collections/ArrayList.cs	12 Jan 2003 16:57:28 -0000
@@ -892,10 +892,17 @@ namespace System.Collections {
 					(&quot;Collection is fixed size.&quot;);
 			}
 
-			if (index &lt; 0 || index &gt;= this.count || index + count &gt; this.count) {
-				throw new ArgumentOutOfRangeException
-					(&quot;index/count out of range&quot;);
-			}
+			if (index &lt; 0)
+				throw new ArgumentOutOfRangeException 
+					(&quot;index&quot;, &quot;Non-negative number required.&quot;);
+
+			if (count &lt; 0)
+				throw new ArgumentOutOfRangeException 
+					(&quot;count&quot;, &quot;Non-negative number required.&quot;);
+
+			if (index + count &gt; this.count)
+				throw new ArgumentException
+					(&quot;Offset and length were out of bounds for the array or count is greater than the number of elements from index to the end of the source collection.&quot;);
 
 			shiftElements (index, - count);
 			this.count -= count;

--0-1804289383-1042390773=:88315--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="011170.html">[Mono-list] Moving from .NET to Mono on Linux
</A></li>
	<LI> Next message: <A HREF="011161.html">[Mono-list] bug in ArrayList::RemoveRange ()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11160">[ date ]</a>
              <a href="thread.html#11160">[ thread ]</a>
              <a href="subject.html#11160">[ subject ]</a>
              <a href="author.html#11160">[ author ]</a>
         </LI>
       </UL>
</body></html>
