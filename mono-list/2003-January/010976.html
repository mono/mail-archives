<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [DotGNU]Re: [Mono-list] Enum declaration; Conflicts and Blame for Interoperability Problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jeroen%40sumatra.nl">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="010975.html">
   <LINK REL="Next"  HREF="010984.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[DotGNU]Re: [Mono-list] Enum declaration; Conflicts and Blame for Interoperability Problems
   </H1>
    <B>Jeroen Frijters
    </B> 
    <A HREF="mailto:jeroen%40sumatra.nl"
       TITLE="[DotGNU]Re: [Mono-list] Enum declaration; Conflicts and Blame for Interoperability Problems">jeroen@sumatra.nl
       </A><BR>
    <I>Tue, 7 Jan 2003 15:24:36 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="010975.html">[Mono-list] Enum declaration; Conflicts and Blame for Interoperability Problems
</A></li>
        <LI> Next message: <A HREF="010984.html">[DotGNU]Re: [Mono-list] Enum declaration; Conflicts and Blame for Interoperability Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10976">[ date ]</a>
              <a href="thread.html#10976">[ thread ]</a>
              <a href="subject.html#10976">[ subject ]</a>
              <a href="author.html#10976">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hmm, interesting. I just tried the following (on the MS CLR):

AssemblyName name = new AssemblyName();
name.Name = &quot;test&quot;;
AssemblyBuilder asm = AppDomain.CurrentDomain.DefineDynamicAssembly(name,
AssemblyBuilderAccess.Save);
ModuleBuilder mod = asm.DefineDynamicModule(&quot;testmodule&quot;, &quot;test.dll&quot;);
TypeBuilder enumBldr = mod.DefineType(&quot;MyEnum&quot;, TypeAttributes.Public,
typeof(Enum));
enumBldr.DefineField(&quot;value__&quot;, typeof(int), FieldAttributes.Private |
FieldAttributes.RTSpecialName | FieldAttributes.SpecialName);
enumBldr.DefineField(&quot;foo&quot;, enumBldr, FieldAttributes.Literal |
FieldAttributes.Public).SetConstant(1);
enumBldr.CreateType();
asm.Save(&quot;test.dll&quot;);

And this seems to work.

Regards,
Jeroen

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Paolo Molaro [mailto:<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>] 
</I>&gt;<i> Sent: Tuesday, January 07, 2003 15:10
</I>&gt;<i> To: <A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>; <A HREF="mailto:developers@dotgnu.org">developers@dotgnu.org</A>
</I>&gt;<i> Subject: [DotGNU]Re: [Mono-list] Enum declaration; Conflicts 
</I>&gt;<i> and Blame for Interoperability Problems
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 01/07/03 Jeroen Frijters wrote:
</I>&gt;<i> &gt; &gt; The underlying issue, though, is that with the 
</I>&gt;<i> &gt; &gt; Reflection.Emit API it's not possible to create enums as
</I>&gt;<i> &gt; &gt; produced by csc. Once portable.net
</I>&gt;<i> &gt; &gt; will implement Reflection.Emit, it'll have to support this 
</I>&gt;<i> &gt; &gt; stuff anyway, just like the MS runtime does.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ... I would argue that MS's EnumBuilder.DefineLiteral is 
</I>&gt;<i> broken. It would be
</I>&gt;<i> &gt; best if it allowed both using the underlying type as well 
</I>&gt;<i> as the enum type,
</I>&gt;<i> &gt; but the current behavior as the only option is *not* 
</I>&gt;<i> acceptable (given that
</I>&gt;<i> &gt; it is not CLS compliant).
</I>&gt;<i> 
</I>&gt;<i> I don't know off-hand what DefineLiteral accepts. The issue 
</I>&gt;<i> is that you
</I>&gt;<i> can't use EnumBuilder in all cases, so mcs doesn't use it and it
</I>&gt;<i> 'constructs' the enum type by hand. The reason is that an API
</I>&gt;<i> is missing (though it's documented): TypeBuilder.DefineNestedEnum().
</I>&gt;<i> 
</I>&gt;<i> So the process is to create a TypeBuilder and then DefineField()
</I>&gt;<i> as needed. The value of the enum is set with 
</I>&gt;<i> FieldBuilder.SetConstant().
</I>&gt;<i> I think SetConstant() accepts values of the underlying type 
</I>&gt;<i> of the enum,
</I>&gt;<i> but it can't accept constants of the type itself, because that would
</I>&gt;<i> imply calling CreateType() on the enum type (and hence it wouldn't be
</I>&gt;<i> possible anymore to create fields in it and set their value with
</I>&gt;<i> SetConstant).
</I>&gt;<i> 
</I>&gt;<i> lupus
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> -----------------------------------------------------------------
</I>&gt;<i> <A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
</I>&gt;<i> <A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Developers mailing list
</I>&gt;<i> <A HREF="mailto:Developers@dotgnu.org">Developers@dotgnu.org</A>
</I>&gt;<i> <A HREF="http://www.dotgnu.org/mailman/listinfo/developers">http://www.dotgnu.org/mailman/listinfo/developers</A>
</I>&gt;<i> 
</I>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="010975.html">[Mono-list] Enum declaration; Conflicts and Blame for Interoperability Problems
</A></li>
	<LI> Next message: <A HREF="010984.html">[DotGNU]Re: [Mono-list] Enum declaration; Conflicts and Blame for Interoperability Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10976">[ date ]</a>
              <a href="thread.html#10976">[ thread ]</a>
              <a href="subject.html#10976">[ subject ]</a>
              <a href="author.html#10976">[ author ]</a>
         </LI>
       </UL>
</body></html>
