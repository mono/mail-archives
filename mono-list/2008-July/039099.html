<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono.Zeroconf Problem: Calling delegate	after	garbagecollection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Zeroconf%20Problem%3A%20Calling%20delegate%0A%09after%09garbagecollection&In-Reply-To=18534138.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039121.html">
   <LINK REL="Next"  HREF="039124.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono.Zeroconf Problem: Calling delegate	after	garbagecollection</H1>
    <B>Aaron Bockover</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Zeroconf%20Problem%3A%20Calling%20delegate%0A%09after%09garbagecollection&In-Reply-To=18534138.post%40talk.nabble.com"
       TITLE="[Mono-list] Mono.Zeroconf Problem: Calling delegate	after	garbagecollection">abockover at novell.com
       </A><BR>
    <I>Mon Jul 21 19:26:15 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="039121.html">[Mono-list] Mono.Zeroconf Problem: Calling delegate after	garbage collection
</A></li>
        <LI>Next message: <A HREF="039124.html">[Mono-list] Mono.Zeroconf Problem: Calling delegate	after	garbagecollection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39099">[ date ]</a>
              <a href="thread.html#39099">[ thread ]</a>
              <a href="subject.html#39099">[ subject ]</a>
              <a href="author.html#39099">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>These GC issues should be fixed in SVN/trunk. I have not yet made a release including them however. There will be a Mono.Zeroconf release hopefully this week. Follow the link below to get binaries for testing. They will not change from what will be released next week unless you find there is still a collection issue with the delegates:

<A HREF="http://getbanshee.org/~abock/mz-gc-fix">http://getbanshee.org/~abock/mz-gc-fix</A>

&gt;<i>From the ChangeLog:
</I>
2008-04-02  Aaron Bockover  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">abockover at novell.com</A>&gt;

    * src/Mono.Zeroconf.Providers.Bonjour/Mono.Zeroconf.Providers.Bonjour/BrowseService.cs:
    * src/Mono.Zeroconf.Providers.Bonjour/Mono.Zeroconf.Providers.Bonjour/RegisterService.cs:
    * src/Mono.Zeroconf.Providers.Bonjour/Mono.Zeroconf.Providers.Bonjour/ServiceBrowser.cs:
    Fixed a big bug reported by Josh Cooley wherein delegates passed to
    native code could be GCed at the wrong time, apparently particularly
    noticeable on MS.NET

--Aaron


--

&gt;&gt;&gt;<i> On Mon, Jul 21, 2008 at  6:24 PM, in message &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">18534138.post at talk.nabble.com</A>&gt;,
</I>parkerjm &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">parkerjm at gmail.com</A>&gt; wrote: 

&gt;<i> I wrote a pair of programs that communicate through the Mono.Zeroconf
</I>&gt;<i> library. The first program just broadcasts its presence and the other
</I>&gt;<i> program listens for instances of the broadcasting program. When the listener
</I>&gt;<i> is running and finds a broadcaster and then the broadcaster is closed, I get
</I>&gt;<i> the following exception:
</I>&gt;<i> 
</I>&gt;<i> &quot;CallbackOnCollectedDelegate was detected
</I>&gt;<i> Message: A callback was made on a garbage collected delegate of type
</I>&gt;<i> 'Mono.Zeroconf.Providers.Bonjour!Mono.Zeroconf.Providers.Bonjour.Native+DNSS
</I>&gt;<i> erviceBrowseReply::Invoke'.
</I>&gt;<i> This may cause application crashes, corruption and data loss. When passing
</I>&gt;<i> delegates to unmanaged code, they must be kept alive by the managed
</I>&gt;<i> application until it is guaranteed that they will never be called.&quot;
</I>&gt;<i> 
</I>&gt;<i> It seems like the object is being marked for garbage collection too soon or
</I>&gt;<i> something. How can I keep it alive? I pretty much used a lot of the mzclient
</I>&gt;<i> source for creating these programs, but it doesn't crash and mine does. I am
</I>&gt;<i> not sure why. 
</I>&gt;<i> 
</I>&gt;<i> Here is a snippet of the important code:
</I>&gt;<i> <A HREF="http://pastebin.com/fb91b9d2">http://pastebin.com/fb91b9d2</A>
</I>&gt;<i> 
</I>&gt;<i> I am creating this on Windows using .NET.
</I>
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039121.html">[Mono-list] Mono.Zeroconf Problem: Calling delegate after	garbage collection
</A></li>
	<LI>Next message: <A HREF="039124.html">[Mono-list] Mono.Zeroconf Problem: Calling delegate	after	garbagecollection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39099">[ date ]</a>
              <a href="thread.html#39099">[ thread ]</a>
              <a href="subject.html#39099">[ subject ]</a>
              <a href="author.html#39099">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
