<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] make check fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20make%20check%20fails&In-Reply-To=4681308C.1060507%40koxta.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035452.html">
   <LINK REL="Next"  HREF="035446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] make check fails</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20make%20check%20fails&In-Reply-To=4681308C.1060507%40koxta.net"
       TITLE="[Mono-list] make check fails">jonpryor at vt.edu
       </A><BR>
    <I>Tue Jun 26 17:53:45 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="035452.html">[Mono-list] make check fails
</A></li>
        <LI>Next message: <A HREF="035446.html">[Mono-list] make check fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35453">[ date ]</a>
              <a href="thread.html#35453">[ thread ]</a>
              <a href="subject.html#35453">[ subject ]</a>
              <a href="author.html#35453">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2007-06-26 at 17:28 +0200, Jurek Bartuszek wrote:
&gt;<i> &gt; You should rather fix the problem on your system. Are you using a
</I>&gt;<i> &gt; chrooted environment for &quot;make check&quot;? Maybe it doesn't contain
</I>&gt;<i> &gt; /etc/group.
</I>&gt;<i> 
</I>&gt;<i> strange, I've tried to build mono outside the chrooted/sandboxed
</I>&gt;<i> environment and still get the same error. The /etc/group file is present:
</I>&gt;<i> 
</I>&gt;<i> # ls -l /etc/group
</I>&gt;<i> -rw-r--r-- 1 root root 827 cze 20 21:15 /etc/group
</I>&gt;<i> 
</I>&gt;<i> so I have no idea what's causing it.
</I>
This came up on #mono today in the context of
UnixUserInfo.GetLocalUsers() failing on some systems.  We finally solved
that, and I imagine the UnixGroupInfo problem is the same.

In short: execute the following command as the root user:

	touch /etc/default/nss
	chmod 664 /etc/default/nss

The Long sordid tale:

UnixGroupInfo.GetLocalGroups() and UnixUserInfo.GetLocalUsers() call
setgrent(3) and setpwent(3), respectively.  These functions return
`void', so to check for errors MonoPosixHelper has:

	int Mono_Posix_Syscall_setgrent (void)
	{
		errno = 0;
		setgrent ();
		return errno == 0 ? 0 : -1;
	}

(and similar for setpwent(3).)

I did this because that's what the man page implied I should do:

        Upon error, errno may be set.  If one wants to check errno after
        the call, it should be set to zero before the call.

OK, simple enough.  Yet it still fails.

The problem is that in this case, errno WILL be set to an UNDOCUMENTED
value -- in this case errno is set to ENOENT (because /etc/default/nss
doesn't exist) while the documented error values are EINTR, EIO, EMFILE,
ENFILE, ENOMEM, and ERANGE.

Apparently what MonoPosixHelper *needs* to do is check if errno is one
of these documented values, and if it is then flag an error condition,
otherwise, an error didn't occur.

Which means two things:

1. Errno can be set but &quot;an error didn't occur,&quot; leading to...

2. Fugly code:

        int Mono_Posix_Syscall_setgrent (void)
        {
                int e;
                errno = 0;
                setgrent ();
                e = errno;
                if (e == EINTR || e == EIO || e == EMFILE || e == ENFILE
                ||
                                e == ENOMEM || e == ERANGE)
                        return -1;
                return 0;
        }

Blech!

I'll be fixing this in MonoPosixHelper later today or tomorrow, but I
don't know when this &quot;fix&quot; will make it into a proper release, so for
now just create /etc/default/nss and things should Just Work.

 - Jon


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035452.html">[Mono-list] make check fails
</A></li>
	<LI>Next message: <A HREF="035446.html">[Mono-list] make check fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35453">[ date ]</a>
              <a href="thread.html#35453">[ thread ]</a>
              <a href="subject.html#35453">[ subject ]</a>
              <a href="author.html#35453">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
