<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] HttpHandler for *.jpg
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20HttpHandler%20for%20%2A.jpg&In-Reply-To=7fb6395905062000584fd89d2b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027535.html">
   <LINK REL="Next"  HREF="027551.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] HttpHandler for *.jpg</H1>
    <B>Marc DM</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20HttpHandler%20for%20%2A.jpg&In-Reply-To=7fb6395905062000584fd89d2b%40mail.gmail.com"
       TITLE="[Mono-list] HttpHandler for *.jpg">m at phronein.com
       </A><BR>
    <I>Mon Jun 20 11:25:06 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027535.html">[Mono-list] HttpHandler for *.jpg
</A></li>
        <LI>Next message: <A HREF="027551.html">[Mono-list] HttpHandler for *.jpg
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27550">[ date ]</a>
              <a href="thread.html#27550">[ thread ]</a>
              <a href="subject.html#27550">[ subject ]</a>
              <a href="author.html#27550">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After a little bit of debugging, 
I have discovered that when there are QueryString parameters, passed
such as /images/pic1.jpg?thumb=1 the ProcessRequest method of the
Handler doesn't get called. 

I added a line to the ProcessRequest medhod to write a log to a text
file for each iteration of the method. I also added log statements to
various places in the code. 

After browsing a couple of pages, I realize that every entry in the log
is an entry for which there is no querystring.

Below is the code I put in the handler :


&gt;<i> 	public class ImageHandler:IHttpHandler
</I>&gt;<i> 	{
</I>&gt;<i> 
</I>&gt;<i> 		HttpResponse Response;
</I>&gt;<i> 		HttpRequest Request;
</I>&gt;<i> 		HttpServerUtility Server;
</I>&gt;<i> 
</I>&gt;<i> 		#region IHttpHandler Members
</I>&gt;<i> 
</I>&gt;<i> 		public void ProcessRequest(HttpContext context)
</I>&gt;<i> 		{
</I>&gt;<i> 
</I>&gt;<i> 			//Set global context objects
</I>&gt;<i> 			Server = context.Server;
</I>&gt;<i> 			Response = context.Response;
</I>&gt;<i> 			Request = context.Request;
</I>&gt;<i> 
</I>&gt;<i> 			//Do the image stuff
</I>&gt;<i> 			
</I>&gt;<i> ///DEBUG
</I>&gt;<i> 			Log(&quot;Beginning image output [QS=&quot; + Request.QueryString.Count.ToString() + &quot;] = &quot; + Request.RawUrl);
</I>&gt;<i> ///DEBUG
</I>&gt;<i> 
</I>&gt;<i> 			RequestImage();
</I>&gt;<i> 
</I>&gt;<i> 		}
</I>&gt;<i> 		public bool IsReusable
</I>&gt;<i> 		{
</I>&gt;<i> 			get{ return true; 
</I>&gt;<i> 		}
</I>&gt;<i> 
</I>&gt;<i> [... rest of the handler code ...]
</I>&gt;<i> 
</I>
And the Logger.

&gt;<i> //debugging logger
</I>&gt;<i>     public static void Log (String logMessage)
</I>&gt;<i>     {
</I>&gt;<i>     
</I>&gt;<i>     	StreamWriter w = File.AppendText(&quot;/home/gary/www/mysite/www/images/hih_cache/hih_log.txt&quot;);
</I>&gt;<i>         w.Write(&quot;\r\nLog Entry : &quot;);
</I>&gt;<i>         w.WriteLine(&quot;{0} {1}&quot;, DateTime.Now.ToLongTimeString(),
</I>&gt;<i>             DateTime.Now.ToLongDateString());
</I>&gt;<i>         w.WriteLine(&quot;  :{0}&quot;, logMessage);
</I>&gt;<i>         w.WriteLine (&quot;-------------------------------&quot;);
</I>&gt;<i>         // Update the underlying file.
</I>&gt;<i>         w.Flush();
</I>&gt;<i>         w.Close(); 
</I>&gt;<i>     }
</I>
Records in the log file were like :

&gt;<i> Log Entry : 10:02:52 AM Monday, June 20, 2005
</I>&gt;<i>   :Beginning image output [QS=0] = /images/banner_c1.jpg
</I>&gt;<i> -------------------------------
</I>

Anyone else having this kinda fun?

Marc DM

---------------

On Mon, 2005-06-20 at 08:58 +0100, Martin Hinks wrote:
&gt;<i> What part of the app is failing?
</I>&gt;<i> 
</I>&gt;<i> Is the handler for .jpg types being called but the querystring is blank?
</I>&gt;<i> 
</I>&gt;<i> Have you traced through the application? If you can find exactly what
</I>&gt;<i> is failing we can file BugZilla reports.
</I>&gt;<i> 
</I>&gt;<i> If the handler is working post some source and I'll take a look later.
</I>&gt;<i> 
</I>&gt;<i> To find out what's going on add &quot;response.writeline&quot; statements at
</I>&gt;<i> various points in your code - or try Mono Debugger - although I dont
</I>&gt;<i> know how advanced it is...
</I>&gt;<i> 
</I>&gt;<i> Martin
</I>&gt;<i> 
</I>&gt;<i> On 6/20/05, Marc DM &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">m at phronein.com</A>&gt; wrote:
</I>&gt;<i> &gt; (*falling asleep as I type this*)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have a HttpHandler that works on .NET but not on Mono. I need some
</I>&gt;<i> &gt; help to sort it out.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It is a HttpHandler to allow me to use a url like :
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    <A HREF="http://mysite/images/Beach12/DCS001.JPG?w=200">http://mysite/images/Beach12/DCS001.JPG?w=200</A>
</I>&gt;<i> &gt;    to give me the image at the specified url, but proportionately
</I>&gt;<i> &gt; resized to 200px wide.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    <A HREF="http://mysite/images/Beach12/DCS001.JPG?thumb=1">http://mysite/images/Beach12/DCS001.JPG?thumb=1</A>
</I>&gt;<i> &gt;    to give me the image at the specified url, resized to a pre-defined
</I>&gt;<i> &gt; thumbnail size
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; etc...
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have the HttpHandler, written in c#, it compiles on mono (had to
</I>&gt;<i> &gt; change Response.TransmitFile to Response.WriteFile); no errors.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It compiles on Windows. No Problem.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; using Microsoft .NET Framework 1.1 when I access
</I>&gt;<i> &gt; <A HREF="http://mysite/images/Beach12/DCS001.JPG?thumb=1">http://mysite/images/Beach12/DCS001.JPG?thumb=1</A> from my browser, a
</I>&gt;<i> &gt; thumbnailed version of the photo is created in the cache directory (if
</I>&gt;<i> &gt; it doesn't already exist, within the site), and then returned to the
</I>&gt;<i> &gt; browser. It works.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; on Apache/2.0.54 (Debian GNU/Linux) mod_mono/1.0.9
</I>&gt;<i> &gt; Everything else in the application works beautifully.  But a call to
</I>&gt;<i> &gt; <A HREF="http://mysite/images/Beach12/DCS001.JPG?thumb=1">http://mysite/images/Beach12/DCS001.JPG?thumb=1</A> returns the full size
</I>&gt;<i> &gt; image and the QueryString is seemingly ignored.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; My Apache config, mono webapp file,web.config are attached below.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Can someone clue me in? How can I tell what's happening here.
</I>&gt;<i> &gt; Thanks.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Marc DM
</I>&gt;<i> &gt; -----------------APACHE CONFIG---------------------
</I>&gt;<i> &gt; ---------------------/etc/apache2/sites-available/mysite----------
</I>&gt;<i> &gt; NameVirtualHost *:80
</I>&gt;<i> &gt; &lt;VirtualHost *:80&gt;
</I>&gt;<i> &gt;        ServerName mysite
</I>&gt;<i> &gt;        ServerAdmin <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">webmaster at mysite</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;        DocumentRoot /home/gary/www/mysite/www/
</I>&gt;<i> &gt;        AddHandler mono .aspx .ascx .jpg
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;        DirectoryIndex default.aspx index.aspx default.html index.html
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;        &lt;Directory /home/gary/www/mysite/www/&gt;
</I>&gt;<i> &gt;                Options FollowSymLinks MultiViews
</I>&gt;<i> &gt;                Order allow,deny
</I>&gt;<i> &gt;                allow from all
</I>&gt;<i> &gt;        &lt;/Directory&gt;
</I>&gt;<i> &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ---------------------/etc/apache2/ mods-available/mono.conf----------
</I>&gt;<i> &gt;  MonoUnixSocket /tmp/mod_mono_server
</I>&gt;<i> &gt;  MonoRunXSP true
</I>&gt;<i> &gt;  MonoApplicationsConfigDir /etc/apache2/mod-mono-applications
</I>&gt;<i> &gt;  MonoDebug true
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -----------------web.config---------------------
</I>&gt;<i> &gt;  &lt;system.web&gt;
</I>&gt;<i> &gt;    ...
</I>&gt;<i> &gt;    ...
</I>&gt;<i> &gt;    &lt;httpHandlers&gt;
</I>&gt;<i> &gt;      &lt;add verb=&quot;*&quot; path=&quot;*.jpg&quot;
</I>&gt;<i> &gt; type=&quot;Mynamespace.HttpHandlers.ImageHandler,HolmokImageHandler /&gt;
</I>&gt;<i> &gt; &lt;/httpHandlers&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ---------------------------------------------------------------
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027535.html">[Mono-list] HttpHandler for *.jpg
</A></li>
	<LI>Next message: <A HREF="027551.html">[Mono-list] HttpHandler for *.jpg
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27550">[ date ]</a>
              <a href="thread.html#27550">[ thread ]</a>
              <a href="subject.html#27550">[ subject ]</a>
              <a href="author.html#27550">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
