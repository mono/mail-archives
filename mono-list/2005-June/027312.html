<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Certificate Store / LDAP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Certificate%20Store%20/%20LDAP&In-Reply-To=2505.142.106.149.226.1117632010.squirrel%40mail.mmgsecurity.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027311.html">
   <LINK REL="Next"  HREF="027313.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Certificate Store / LDAP</H1>
    <B>S&#233;bastien Pouliot</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Certificate%20Store%20/%20LDAP&In-Reply-To=2505.142.106.149.226.1117632010.squirrel%40mail.mmgsecurity.com"
       TITLE="[Mono-list] Certificate Store / LDAP">spouliot at videotron.ca
       </A><BR>
    <I>Wed Jun  1 10:05:13 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027311.html">[Mono-list] Certificate Store / LDAP
</A></li>
        <LI>Next message: <A HREF="027313.html">[Mono-list] Certificate Store / LDAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27312">[ date ]</a>
              <a href="thread.html#27312">[ thread ]</a>
              <a href="subject.html#27312">[ subject ]</a>
              <a href="author.html#27312">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Loren,

&gt;<i> BACKGROUND: I've been using Mono for a couple of projects, one of which is
</I>&gt;<i> called LAT (LDAP Administration Tool) [1].
</I>&gt;<i>
</I>&gt;<i> I've been trying to get LDAP over SSL to work.  I found some sample code
</I>&gt;<i> (Samples.SecureBind.cs) written by Sunil Kumar at Novell but I couldn't
</I>&gt;<i> get it work on my system.
</I>&gt;<i>
</I>&gt;<i> I figured out pretty quickly the problem was I needed to use the
</I>&gt;<i> certificate manager tool (certmgr) to import the SSL certificate into my
</I>&gt;<i> personal store.  Once I did that I could make a secure LDAP connection.
</I>&gt;<i>
</I>&gt;<i> I dug into the certmgr source code to see how it imported certificates
</I>&gt;<i> into the store and copied over some chunks into LAT (my code is GPL'd; so
</I>&gt;<i> is the certmgr).
</I>
Not exactly ;-) For historical reasons (i.e. my previous employer) the
security tools were created with a BSD license. But that's not a problem for
your GPL application.

Just be aware that the certificate store may change format in the future.
The safest way to avoid problems is to use the code from the
Mono.Security.dll assembly (which is probably what you did by copying the
certmgr code into your application). The next version (2.0) of the framework
will have better interfaces to deal with certificate stores.

&gt;<i> The plan was is if you were making an SSL connection, LAT would check the
</I>&gt;<i> store if there was no certificate it would popup a dialog and ask the user
</I>&gt;<i> if they wanted to import it.
</I>
Note that importing the certificate means that _all_ Mono applications will
start trusting it. This should be clear in your UI / documentation. If you
don't mind I have a suggestion for this (near the end).

&gt;<i> If you click on 'Yes' the certificate does get imported into the user's
</I>&gt;<i> personal store but the LDAP connection fails.  If I exit and re-run the
</I>&gt;<i> program it works.
</I>
The certificate store isn't (and won't be) monitored for changes. This is
mostly for performance issues (as adding certificates is a rare operation)
and, anyway, there is a (IMHO) better alternative...

&gt;<i> Is there some way I can get the Novell.Directory.Ldap classes to use a
</I>&gt;<i> freshly imported certificate without requiring a restart? Maybe there is a
</I>&gt;<i> better way to do want I want??
</I>&gt;<i>
</I>&gt;<i> Anyone got any suggestions?
</I>
Note: This has been discuted in the past but I don't know if the feature
made it into a release of the LDAP library.

The SSL client code allows what you want to do (e.g. accepting any
certificate) so it is possible to accept it (if the user click yes) and add
it to the store (like you're doing). Because this is accepted by your own
code you don't need to restart your application. The &quot;tlstest&quot; tool shows
how to do this:
<A HREF="http://svn.myrealbox.com/source/trunk/mcs/class/Mono.Security/Test/tools/tls">http://svn.myrealbox.com/source/trunk/mcs/class/Mono.Security/Test/tools/tls</A>
test/tlstest.cs

The problem is (or was ?) that the LDAP library doesn't expose the
SslClientStream instance nor does it (or didn't) provide a similar
functionality to accept a certificate. If this is still the case then you
should contact the LDAP developers. They have a mailing list available on
Novell Forge.


So now the suggestion... You should consider to take the FireFox approach:
* Yes (always)		-&gt; which imports the certificate
* Yes (this time only)	-&gt; only accept the certificate for this session
* No				-&gt; cancel the connection (that should be the default)

&gt;<i> [1; cheap plug] - <A HREF="http://people.mmgsecurity.com/~lorenb/lat/">http://people.mmgsecurity.com/~lorenb/lat/</A>
</I>
Looks nice :)

Sebastien Pouliot
home: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">spouliot at videotron.ca</A>
blog: <A HREF="http://pages.infinit.net/ctech/poupou.html">http://pages.infinit.net/ctech/poupou.html</A>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027311.html">[Mono-list] Certificate Store / LDAP
</A></li>
	<LI>Next message: <A HREF="027313.html">[Mono-list] Certificate Store / LDAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27312">[ date ]</a>
              <a href="thread.html#27312">[ thread ]</a>
              <a href="subject.html#27312">[ subject ]</a>
              <a href="author.html#27312">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
