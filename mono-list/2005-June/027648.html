<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Building mono on Solaris 10 x86/x64 : What I did,
	with patches
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Building%20mono%20on%20Solaris%2010%20x86/x64%20%3A%20What%20I%20did%2C%0A%09with%20patches&In-Reply-To=19aada300506270958558e7ca4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027647.html">
   <LINK REL="Next"  HREF="027654.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Building mono on Solaris 10 x86/x64 : What I did,
	with patches</H1>
    <B>Jeremy Teo</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Building%20mono%20on%20Solaris%2010%20x86/x64%20%3A%20What%20I%20did%2C%0A%09with%20patches&In-Reply-To=19aada300506270958558e7ca4%40mail.gmail.com"
       TITLE="[Mono-list] Building mono on Solaris 10 x86/x64 : What I did,
	with patches">white.wristband at gmail.com
       </A><BR>
    <I>Tue Jun 28 23:21:25 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027647.html">[Mono-list] boo 0.5.6 is out!
</A></li>
        <LI>Next message: <A HREF="027654.html">[Mono-list] Building mono on Solaris 10 x86/x64 : What I did,
	with patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27648">[ date ]</a>
              <a href="thread.html#27648">[ thread ]</a>
              <a href="subject.html#27648">[ subject ]</a>
              <a href="author.html#27648">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi folks,

After a whole weekend of ugly hackey, I managed to get mono 1.1.8.1 to
build and run on Solaris 10 x86/x64. It fails some tests though, but
it seems good enough to build and run GtkDemo.exe from gtk-sharp. Oh
and of course i managed to build gtk-sharp on the same environment.

Without much further ado, this is what I did.

1) Must build with --with-tls=pthreads on Solaris x86/x64
ie. configure must be called with &quot;--with-tls=pthreads&quot;

I would appreciate it if someone who knows how to hack autotools make
this the default for Solaris 10 x64?

2) Don't set FILE_OFFSET_BITS to 64
The current configure script sets FILE_OFFSET_BITS to 64, but on
Solaris, this is only allowed if you're compiling for ILP64 (i'm no
expert, but this means 64bit code. eg. -m64 for gcc?)

3) The bundled gc (boehm garbage collector) doesn't build.

I suspect this is due to the build system again. I worked around this
by building boehm gc version 6.3alpha1 (which is identical to what you
folks bundle in the tarball),
and specifying &quot;--with-gc=boehm&quot;.

4) libtool is generated wrongly / configured wrongly.
On Solaris 10, gcc uses the system linker, also named &quot;ld&quot;. In order
to generate shared libraries, the proper flag to pass to gcc (which
then passes it to the system linker) is &quot;-Wl,-G&quot;, not &quot;-shared&quot; as on
other platforms.

I hacked this manually in the generated libtool.

5) The shared library for libc is libc.so.1
For the &quot;config&quot; file found in data/config, libc should be set to
libc.so.1 for Solaris, instead of libc.so.6

Is this autogenerated? Can someone in the know fix this? (or teach me how :) )

6) The filepath to install-sh for the mcs subtree is wrong

The various Makefiles in the mcs subtree try to call &quot;./install-sh&quot;,
which obviously fails since install-sh is in the top source directory.

I hacked around this by setting $INSTALL correctly in config.make.

7) exceptions-x86.c had to be patched.
Patch is attached to this email.

8) socket-io.c had to be patched
Patch is attached to this email. Probably not correct, but works for now.

9) mph.h had to be patched
Patch is attached. Could someone explain to me the significance of
defining MPH_INTERNAL?

Thank you all again for your work. :)

I would be happy to work with you folks to make Mono build cleanly and
pass all the tests on Solaris 10. (incidentally, once it does, i will
package it for www.blastwave.org. Testers are welcome too.)


--
Regards,
Jeremy




-- 
Regards,
Jeremy
-------------- next part --------------
A non-text attachment was scrubbed...
Name: exceptions-x86.patch
Type: text/x-patch
Size: 2403 bytes
Desc: not available
Url : <A HREF="http://galactus.ximian.com/pipermail/mono-list/attachments/20050629/5e439859/exceptions-x86.bin">http://galactus.ximian.com/pipermail/mono-list/attachments/20050629/5e439859/exceptions-x86.bin</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: socket-io.patch
Type: text/x-patch
Size: 416 bytes
Desc: not available
Url : <A HREF="http://galactus.ximian.com/pipermail/mono-list/attachments/20050629/5e439859/socket-io.bin">http://galactus.ximian.com/pipermail/mono-list/attachments/20050629/5e439859/socket-io.bin</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mph.patch
Type: text/x-patch
Size: 425 bytes
Desc: not available
Url : <A HREF="http://galactus.ximian.com/pipermail/mono-list/attachments/20050629/5e439859/mph.bin">http://galactus.ximian.com/pipermail/mono-list/attachments/20050629/5e439859/mph.bin</A>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027647.html">[Mono-list] boo 0.5.6 is out!
</A></li>
	<LI>Next message: <A HREF="027654.html">[Mono-list] Building mono on Solaris 10 x86/x64 : What I did,
	with patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27648">[ date ]</a>
              <a href="thread.html#27648">[ thread ]</a>
              <a href="subject.html#27648">[ subject ]</a>
              <a href="author.html#27648">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
