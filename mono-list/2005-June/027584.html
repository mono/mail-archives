<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Using SQLite, Mono and Monodevelop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Using%20SQLite%2C%20Mono%20and%20Monodevelop&In-Reply-To=200506221622.06452.alessandro-bottoni%40libero.it">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027583.html">
   <LINK REL="Next"  HREF="027585.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Using SQLite, Mono and Monodevelop</H1>
    <B>Thomas Zoechling</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Using%20SQLite%2C%20Mono%20and%20Monodevelop&In-Reply-To=200506221622.06452.alessandro-bottoni%40libero.it"
       TITLE="[Mono-list] Using SQLite, Mono and Monodevelop">thomas.zoechling at gmx.at
       </A><BR>
    <I>Wed Jun 22 11:06:45 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027583.html">[Mono-list] Using SQLite, Mono and Monodevelop
</A></li>
        <LI>Next message: <A HREF="027585.html">[Mono-list] Using SQLite, Mono and Monodevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27584">[ date ]</a>
              <a href="thread.html#27584">[ thread ]</a>
              <a href="subject.html#27584">[ subject ]</a>
              <a href="author.html#27584">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alessandro Bottoni wrote:

&gt;<i>I have a few questions:
</I>&gt;<i>-  Why I have just Windows DLLs in my /usr/lib/mono/gac/Mono.Data.SqliteClient 
</I>&gt;<i>directory? Shouldn't I have a few .SO Linux libraries as well?
</I>&gt;<i>
</I>That are CIL dlls. Therefore the term &quot;Windows&quot; dll isnt valid anymore 
(thats what mono is all about :) )

&gt;<i>- Do I have to install the .SO Linux libraries by hand? Which version? I'm 
</I>&gt;<i>unable to identify the version of SQLite used to create the existing DLL.
</I>&gt;<i>
</I>To install sqlite under debian you should apt-cache search for sqlite. I 
suppose the package name will be something like libsqlite-dev.
Another way to install sqlite is to download the .so from 
<A HREF="http://www.sqlite.org/download.html">http://www.sqlite.org/download.html</A> (Scroll down the list and pick the 
.so.bz file !!!! -
Don't take the first file -&gt; thats some command line tool -&gt; that way my 
first mistake :) ).
Then extract the file and symlink it to libsqlite.so or libsqlite3.so 
(depending on what version you choose).
If you still have troubles with Mono.Data.Sqlite then read the following 
Blog post of Chris Turchin:
<A HREF="http://turchin.homelinux.net/blogx/PermaLink.aspx/acbc7138-08d6-4a0f-a86d-709748a283d8">http://turchin.homelinux.net/blogx/PermaLink.aspx/acbc7138-08d6-4a0f-a86d-709748a283d8</A>

&gt;<i>- Where is the test suite mentioned by the SQLite docu at 
</I>&gt;<i>www.go-mono.com/sqlite.html? It should be in 
</I>&gt;<i>mcs/class/Mono.Data.SqliteTest/Test but I'm unable to find this directory on 
</I>&gt;<i>my machine.
</I>&gt;<i>
</I>I am one of the authors of the latest Mono.Data.Sqlite patch. And I also 
provided a Test and  a UnitTest program, but I just noticed that it has 
been removed from the
patch :) Here are the basic code parts :

Notice that the Parameter delimeter in sqlite3 is ':' and that you have 
to specify the correct version in your Connection string

//
// SqliteTest.cs
//
// Author(s):     Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">danmorg at sc.rr.com</A>&gt;
//                     Chris Turchin &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">chris at turchin.net</A>&gt;
//                     Thomas Zoechling &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">thomas.zoechling at gmx.at</A>&gt;
//

using System;
using System.Data;
using System.Data.Common;
using System.IO;
using Mono.Data.SqliteClient;

namespace Test.Mono.Data.SqliteClient
{
    class SqliteTest
    {
        //static string connectionString = 
&quot;Version=3,URI=file:SqliteTest.db&quot;;
        static string connectionString = &quot;Version=3,URI=file:SqliteTest.db&quot;;
        static SqliteConnection dbcon = new SqliteConnection();
        static SqliteCommand dbcmd = new SqliteCommand();

        [STAThread]
        static void Main(string[] args)
        {
            Console.WriteLine(&quot;setting ConnectionString using: &quot; + 
connectionString);
            dbcon.ConnectionString = connectionString;
           
            if (File.Exists(&quot;SqliteTest.db&quot;))
            File.Delete(&quot;SqliteTest.db&quot;);
           
            Console.WriteLine(&quot;open the connection...&quot;);
            dbcon.Open();
            dbcmd.Connection = dbcon;
            SetupDB();
           
            Console.WriteLine(&quot;SELECTING DATA FROM MONO_TEST&quot;);
           
            TestWithoutParameters();
            TestSingleParameter();
            TestMultipleParameters();
            TestUsingDataAdapter();
            TestUpdateWithParamsAndEvents();
           
            dbcmd.Dispose();
            dbcon.Close();
           
            Console.WriteLine(&quot;Done.&quot;);
        }

        static void SetupDB()
        {
            dbcmd.CommandText = &quot;CREATE TABLE MONO_TEST ( NID INT, NDESC 
TEXT, EMAIL TEXT)&quot;;
            Console.WriteLine(&quot;execute SqliteCommand to CREATE TABLE 
MONO_TEST: &quot; + dbcmd.CommandText );
            dbcmd.ExecuteNonQuery();
           
            Console.WriteLine(&quot;inserting data into MONO_TEST...&quot;);
            dbcmd.CommandText = &quot;INSERT INTO MONO_TEST  (NID, NDESC, 
EMAIL ) VALUES(1,'Mono 1','<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">chris at turchin.net</A>')&quot;;
            dbcmd.ExecuteNonQuery();
           
            dbcmd.CommandText =&quot;INSERT INTO MONO_TEST  (NID, NDESC, 
EMAIL ) VALUES(2,'Mono 2','<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">test at test</A>')&quot;;
            dbcmd.ExecuteNonQuery();
           
            dbcmd.CommandText = &quot;INSERT INTO MONO_TEST  (NID, NDESC ) 
VALUES(3,'Mono 3')&quot;;
            dbcmd.ExecuteNonQuery();
           
            dbcmd.CommandText =&quot;INSERT INTO MONO_TEST (NID, NDESC ) 
VALUES(4,'Mono 4')&quot;;
            dbcmd.ExecuteNonQuery();
           
            dbcmd.CommandText = &quot;INSERT INTO MONO_TEST (NID, NDESC, 
EMAIL ) VALUES(5,'Mono 5','<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">test at test</A>')&quot;;
            dbcmd.ExecuteNonQuery();
        }

        static void TestUsingDataAdapter()
        {
            Console.WriteLine(&quot;read and display data using DataAdapter...&quot;);
                        SqliteDataAdapter adapter = new 
SqliteDataAdapter(&quot;SELECT * FROM MONO_TEST&quot;, connectionString);
                        DataSet dataset = new DataSet();
                        adapter.Fill(dataset);

            DisplayDataSet(dataset);
   
            Console.WriteLine(&quot;next test...&quot;);
            Console.WriteLine(&quot;Insert and change data using dataset...&quot;);
            DataRow dataRow = dataset.Tables[0].NewRow();
            dataRow[&quot;NID&quot;] = &quot;6&quot;;
            dataRow[&quot;NDESC&quot;] = &quot;New via dataset&quot;;
            dataRow[&quot;EMAIL&quot;] = &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">chris at turchin.net</A>&quot;;
            dataset.Tables[0].Rows.Add(dataRow);
            dataset.Tables[0].Rows[0][&quot;EMAIL&quot;]=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">thomas.zoechling at gmx.at</A>&quot;;
   
            DisplayDataSet(dataset);
            Console.WriteLine(&quot;next test...&quot;);
            Console.WriteLine(&quot;Custom data adapter and data adapter 
events.&quot;);
   
            SqliteCommand dbcmd2 = new SqliteCommand(&quot;SELECT NID, NDESC, 
EMAIL FROM MONO_TEST where NID &gt; :NID&quot;,dbcon);
   
            SqliteParameter param = new SqliteParameter();
            param.ParameterName = &quot;:NID&quot;;
            param.Value = 3;
            param.DbType = DbType.Int32;
            dbcmd2.Parameters.Add(param);
   
            SqliteDataAdapter custDA = new SqliteDataAdapter(dbcmd2);
           
            /*
            //FIXME SqliteCommandBuilder not yet implemented...
            SqliteCommandBuilder custCB = new SqliteCommandBuilder(custDA);
            Console.WriteLine(custCB.GetUpdateCommand().CommandText);
            */
   
            DataSet custDS = new DataSet();
            custDA.Fill(custDS);
   
            //custDS.Tables[0].Rows[1][&quot;EMAIL&quot;]=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">devnull at dev.null</A>&quot;;
            DisplayDataSet(custDS);
   
            Console.WriteLine(&quot;next test...&quot;);
            Console.WriteLine(&quot;read and display data as XML&quot;);
            Console.WriteLine(dataset.GetXml());
        }



        static void TestUpdateWithParamsAndEvents()
        {
            dbcmd.CommandText = &quot;SELECT NID, NDESC, EMAIL FROM MONO_TEST&quot;;
            SqliteCommand update = new SqliteCommand(&quot;UPDATE MONO_TEST 
SET NID = :NID, NDESC = :NDESC, EMAIL = :EMAIL WHERE NID = :NID &quot;);
            update.Connection=dbcon;
            SqliteCommand delete = new SqliteCommand(&quot;DELETE FROM 
MONO_TEST WHERE NID = :NID&quot;);
            delete.Connection=dbcon;
            SqliteCommand insert = new SqliteCommand(&quot;INSERT INTO 
MONO_TEST  (NID, NDESC, EMAIL ) VALUES(:NID,:NDESC,:EMAIL)&quot;);
            insert.Connection=dbcon;
            SqliteDataAdapter custDA = new SqliteDataAdapter(dbcmd);
           
            custDA.RowUpdating += new 
SqliteRowUpdatingEventHandler(OnRowUpdating);
            custDA.RowUpdated += new 
SqliteRowUpdatedEventHandler(OnRowUpdated);
           
            SqliteParameter nid = new SqliteParameter();
            nid.ParameterName = &quot;:NID&quot;;
            nid.DbType = DbType.Int32;
            nid.SourceColumn = &quot;NID&quot;;
            nid.SourceVersion = DataRowVersion.Current;
           
            SqliteParameter ndesc = new SqliteParameter();
            ndesc.ParameterName = &quot;:NDESC&quot;;
            ndesc.DbType = DbType.String;
            ndesc.SourceColumn = &quot;NDESC&quot;;
            ndesc.SourceVersion = DataRowVersion.Current;
           
            SqliteParameter email = new SqliteParameter();
            email.ParameterName =&quot;:EMAIL&quot;;
            email.DbType = DbType.String;
            email.SourceColumn = &quot;EMAIL&quot;;
            email.SourceVersion = DataRowVersion.Current;
           
            update.Parameters.Add(nid);
            update.Parameters.Add(ndesc);
            update.Parameters.Add(email);
           
            delete.Parameters.Add(nid);
           
            insert.Parameters.Add(nid);
            insert.Parameters.Add(ndesc);
            insert.Parameters.Add(email);
           
            custDA.UpdateCommand = update;
            custDA.DeleteCommand = delete;
            custDA.InsertCommand = insert;

            DataSet dataset = new DataSet();
            custDA.Fill(dataset);
            dataset.AcceptChanges();
            DisplayDataSet(dataset);
           
            DataRow dataRow = dataset.Tables[0].Rows[0];
            dataRow[&quot;NDESC&quot;] = &quot;CHANGED&quot;;
           
            DataRow newRow = dataset.Tables[0].NewRow();
            newRow[&quot;NID&quot;] = 999;
            newRow[&quot;NDESC&quot;]   = &quot;newDesc&quot;;
            newRow[&quot;EMAIL&quot;]   = &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">new at Desc.at</A>&quot;;
            dataset.Tables[0].Rows.Add(newRow);
           
            DataRow victim = dataset.Tables[0].Rows[3];
            victim.Delete();
           
            Console.WriteLine(&quot;Rows affected: &quot; + 
custDA.Update(dataset).ToString());
           
            dataset.Clear();
            custDA.Fill(dataset);
            DisplayDataSet(dataset);
           
            custDA.RowUpdating -= new 
SqliteRowUpdatingEventHandler(OnRowUpdating);
            custDA.RowUpdated -= new 
SqliteRowUpdatedEventHandler(OnRowUpdated);
        }

        protected static void OnRowUpdating(object sender, 
RowUpdatingEventArgs args)
        {
            Console.WriteLine(&quot;OnRowUpdating fired...&quot;);
        }

        protected static void OnRowUpdated(object sender, 
RowUpdatedEventArgs args)
        {
            Console.WriteLine(&quot;OnRowUpdated fired...&quot;);
        }

        static void TestWithoutParameters()
        {
            dbcmd.CommandText = &quot;SELECT * FROM MONO_TEST where NID &gt;  2&quot;;
            Console.WriteLine(&quot;TestWithoutParameters: &quot; + 
dbcmd.CommandText + &quot;\n\nexecute reader...&quot;);
            ShowData( dbcmd.ExecuteReader());
            Console.WriteLine(&quot;next test...&quot;);
        }

        static void TestSingleParameter()
        {
            dbcmd.CommandText = &quot;SELECT * FROM MONO_TEST where NID &gt;  :1&quot;;
           
            SqliteParameter param = new SqliteParameter();
            param.ParameterName = &quot;:1&quot;;
            param.Value = 1;
            param.DbType = DbType.Int32;
            dbcmd.Parameters.Add(param);
           
            Console.WriteLine(&quot;TestSingleParameter: &quot; + 
dbcmd.CommandText + &quot;\n\nexecute reader...&quot;);
           
            ShowData( dbcmd.ExecuteReader());
            dbcmd.Parameters.Clear();
            Console.WriteLine(&quot;next test...&quot;);
        }


        static void TestMultipleParameters()
        {
            dbcmd.CommandText = &quot;SELECT * FROM MONO_TEST where NID &gt;=  
:<i>nid AND NDESC LIKE :ndesc and (EMAIL LIKE '%@test' or EMAIL = :email)&quot;;
</I>           
            dbcmd.Parameters.Add(new SqliteParameter(&quot;:nid&quot; , 1) );
            dbcmd.Parameters.Add(new SqliteParameter(&quot;:ndesc&quot;, &quot;_ono%&quot;) );
            dbcmd.Parameters.Insert(1,new 
SqliteParameter(&quot;:email&quot;,&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">chris at turchin.net</A>&quot;));
           
            Console.WriteLine(&quot;TestMultipleParameters: &quot; + 
dbcmd.CommandText + &quot;\n\nexecute reader...&quot;);
            ShowData( dbcmd.ExecuteReader());
            dbcmd.Parameters.Clear();
            Console.WriteLine(&quot;next test...&quot;);
        }

        static void TestUnnamedParameters()
        {
            dbcmd.CommandText = &quot;SELECT * FROM MONO_TEST where NID &gt;  :1 
AND NDESC LIKE :2 and (EMAIL LIKE '%@test' or EMAIL = :3)&quot;;
           
            SqliteParameter param = new SqliteParameter();
            SqliteParameter param2 = new SqliteParameter();
           
            param.Value = 1;
            param.DbType = DbType.Int32;
            param2.Value = &quot;_ono 5&quot;;

            dbcmd.Parameters.Add(param);
            dbcmd.Parameters.Add(param2);
            dbcmd.Parameters.Insert(1,new 
SqliteParameter(&quot;:3&quot;,&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">chris at turchin.net</A>&quot;));
            Console.WriteLine(&quot;TestUnnamedParameters: &quot; + 
dbcmd.CommandText + &quot;\n\nexecute reader...&quot;);
            ShowData(dbcmd.ExecuteReader());
            dbcmd.Parameters.Clear();
            Console.WriteLine(&quot;next test...&quot;);
        }

        static void DisplayDataSet(DataSet dataset)
        {
            foreach(DataTable myTable in dataset.Tables)
            {
                foreach(DataRow myRow in myTable.Rows)
                {
                    Console.Write(&quot;datarow:\t&quot;);
                    string data = myRow[&quot;NID&quot;] + &quot;|\t&quot; + myRow[&quot;NDESC&quot;] 
+ &quot;|\t&quot; + myRow[&quot;EMAIL&quot;] ;
                    Console.WriteLine(data);
                }
            }
        }

        static void ShowData(SqliteDataReader reader)
        {
            Console.WriteLine(&quot;read and display data...&quot;);
           
            while(reader.Read())
            {
                Console.Write(&quot;datarow:\t&quot; + reader[0].ToString());
                Console.Write(&quot;|\t&quot; + reader[1].ToString());
                string email;
                if (reader[2]==null)
                    email = &quot;(null)&quot;;
                else
                    email = reader[2].ToString();
                Console.Write(&quot;|\t&quot; + email + &quot;\n&quot;);
            }
            reader.Close();
        }
    }
}



&gt;<i>I'm trying to use monodevelop 0.7, mono 1.1.8.1pre on a Debian 3.1 (brought to 
</I>&gt;<i>the latest stable version available on debian.meebey.net by apt-get) for 
</I>&gt;<i>building a small DB-based application with SQLite n3.2.1.
</I>&gt;<i>
</I>&gt;<i>I have a few questions:
</I>&gt;<i>-  Why I have just Windows DLLs in my /usr/lib/mono/gac/Mono.Data.SqliteClient 
</I>&gt;<i>directory? Shouldn't I have a few .SO Linux libraries as well?
</I>&gt;<i>
</I>&gt;<i>- Do I have to install the .SO Linux libraries by hand? Which version? I'm 
</I>&gt;<i>unable to identify the version of SQLite used to create the existing DLL.
</I>&gt;<i>
</I>&gt;<i>- Where is the test suite mentioned by the SQLite docu at 
</I>&gt;<i>www.go-mono.com/sqlite.html? It should be in 
</I>&gt;<i>mcs/class/Mono.Data.SqliteTest/Test but I'm unable to find this directory on 
</I>&gt;<i>my machine.
</I>&gt;<i>
</I>&gt;<i>In short: is it available any (up-to-date and reliable) tutorial about setting 
</I>&gt;<i>up the system and developing a small SQLite+Mono application?
</I>&gt;<i>
</I>&gt;<i>Many thanks for your attention
</I>&gt;<i>-------------------------------
</I>&gt;<i>Alessandro Bottoni
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027583.html">[Mono-list] Using SQLite, Mono and Monodevelop
</A></li>
	<LI>Next message: <A HREF="027585.html">[Mono-list] Using SQLite, Mono and Monodevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27584">[ date ]</a>
              <a href="thread.html#27584">[ thread ]</a>
              <a href="subject.html#27584">[ subject ]</a>
              <a href="author.html#27584">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
