<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] OdbcDataReader.cs bug. Attached with fix.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20OdbcDataReader.cs%20bug.%20Attached%20with%20fix.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027463.html">
   <LINK REL="Next"  HREF="027471.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] OdbcDataReader.cs bug. Attached with fix.</H1>
    <B>ndo at rockwellcollins.com</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20OdbcDataReader.cs%20bug.%20Attached%20with%20fix.&In-Reply-To="
       TITLE="[Mono-list] OdbcDataReader.cs bug. Attached with fix.">ndo at rockwellcollins.com
       </A><BR>
    <I>Mon Jun 13 18:21:39 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027463.html">[Mono-list] Announce - SWIG-1.3.25
</A></li>
        <LI>Next message: <A HREF="027471.html">[Mono-list] OdbcDataReader.cs bug. Attached with fix.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27466">[ date ]</a>
              <a href="thread.html#27466">[ thread ]</a>
              <a href="subject.html#27466">[ subject ]</a>
              <a href="author.html#27466">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Skipped content of type multipart/alternative-------------- next part --------------
5c5
&lt; //   Brian Ritchie (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">brianlritchie at hotmail.com</A>)
---
&gt;<i> //   Brian Ritchie (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">brianlritchie at hotmail.com</A>) 
</I>23c23
&lt; //
---
&gt;<i> // 
</I>26c26
&lt; //
---
&gt;<i> // 
</I>92c92
&lt;                 private CommandBehavior CommandBehavior
---
&gt;<i>                 private CommandBehavior CommandBehavior 
</I>107c107
&lt;                 protected override bool IsValidRow
---
&gt;<i>                 protected override bool IsValidRow 
</I>225,226c225,226
&lt; 				OdbcReturn ret=libodbc.SQLDescribeCol(hstmt, Convert.ToUInt16(ordinal+1),
&lt; 					colname_buffer, bufsize, ref colname_size, ref dt, ref ColSize,
---
&gt;<i> 				OdbcReturn ret=libodbc.SQLDescribeCol(hstmt, Convert.ToUInt16(ordinal+1), 
</I>&gt;<i> 					colname_buffer, bufsize, ref colname_size, ref dt, ref ColSize, 
</I>228c228
&lt; 				if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo))
---
&gt;<i> 				if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo)) 
</I>250c250
&lt; 			if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo))
---
&gt;<i> 			if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo)) 
</I>256,257c256,257
&lt; 			ret = libodbc.SQLFreeHandle( (ushort) OdbcHandleType.Stmt, hstmt);
&lt; 			if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo))
---
&gt;<i> 			ret = libodbc.SQLFreeHandle( (ushort) OdbcHandleType.Stmt, hstmt);
</I>&gt;<i> 			if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo)) 
</I>270c270
&lt; 		public
---
&gt;<i> 		public 
</I>279c279
&lt; 		public
---
&gt;<i> 		public 
</I>288c288
&lt; 		public
---
&gt;<i> 		public 
</I>300c300
&lt;                         ret=libodbc.SQLGetData (hstmt, (ushort) (ordinal+1), SQL_C_TYPE.BINARY, tbuff, length,
---
&gt;<i>                         ret=libodbc.SQLGetData (hstmt, (ushort) (ordinal+1), SQL_C_TYPE.BINARY, tbuff, length, 
</I>306c306
&lt;                         if ( (ret != OdbcReturn.Success) &amp;&amp; (ret != OdbcReturn.SuccessWithInfo))
---
&gt;<i>                         if ( (ret != OdbcReturn.Success) &amp;&amp; (ret != OdbcReturn.SuccessWithInfo)) 
</I>325c325
&lt;                                         if (sqlstate != libodbc.SQLSTATE_RIGHT_TRUNC)
---
&gt;<i>                                         if (sqlstate != libodbc.SQLSTATE_RIGHT_TRUNC) 
</I>346c346
&lt; 		public
---
&gt;<i> 		public 
</I>356c356
&lt; 		public
---
&gt;<i> 		public 
</I>367c367
&lt; 		public
---
&gt;<i> 		public 
</I>376c376
&lt; 		public
---
&gt;<i> 		public 
</I>389c389
&lt; 		public
---
&gt;<i> 		public 
</I>399c399
&lt; 		public
---
&gt;<i> 		public 
</I>408c408
&lt; 		public
---
&gt;<i> 		public 
</I>417c417
&lt; 		public
---
&gt;<i> 		public 
</I>426c426
&lt; 		public
---
&gt;<i> 		public 
</I>436c436
&lt; 		public
---
&gt;<i> 		public 
</I>445c445
&lt; 		public
---
&gt;<i> 		public 
</I>454c454
&lt; 		public
---
&gt;<i> 		public 
</I>463c463
&lt; 		public
---
&gt;<i> 		public 
</I>472c472
&lt; 		public
---
&gt;<i> 		public 
</I>481c481
&lt; 		public
---
&gt;<i> 		public 
</I>500c500
&lt;                 DataTable GetSchemaTable()
---
&gt;<i>                 DataTable GetSchemaTable() 
</I>502c502
&lt;                         // FIXME :
---
&gt;<i>                         // FIXME : 
</I>506c506
&lt;                         // * Cache this DataTable so that it is not contacting
---
&gt;<i>                         // * Cache this DataTable so that it is not contacting 
</I>510c510
&lt; 			// Only Results from SQL SELECT Queries
---
&gt;<i> 			// Only Results from SQL SELECT Queries 
</I>513c513
&lt; 			if(cols.Length &gt; 0)
---
&gt;<i> 			if(cols.Length &gt; 0) 
</I>546c546
&lt; 				for (int i = 0; i &lt; cols.Length; i += 1 )
---
&gt;<i> 				for (int i = 0; i &lt; cols.Length; i += 1 ) 
</I>599c599
&lt; 					// FIXME: according to Brian,
---
&gt;<i> 					// FIXME: according to Brian, 
</I>601c601
&lt; 					// however, we need it for Mono
---
&gt;<i> 					// however, we need it for Mono 
</I>611c611
&lt; 		public
---
&gt;<i> 		public 
</I>626c626
&lt; 		public
---
&gt;<i> 		public 
</I>651a652
&gt;<i> 					case OdbcType.Numeric:
</I>654,655c655
&lt; 						buffer=new byte[bufsize];  // According to sqlext.h, use SQL_CHAR for decima.
&lt;                                                 // 2005 03 10 : this now works with unixodbc with numeric c type.
---
&gt;<i> 						buffer=new byte[bufsize];  // According to sqlext.h, use SQL_CHAR for decimal. 
</I>657,661c657,660
&lt; 						byte[] temp = new byte[outsize];
&lt;                                                 for (int i=0;i&lt;outsize;i++)
&lt;                                                         temp[i]=buffer[i];
&lt; 
&lt; 						if (outsize!=-1)
---
&gt;<i> 						if (outsize!=-1) {
</I>&gt;<i> 							byte[] temp = new byte[outsize];
</I>&gt;<i> 							for (int i=0;i&lt;outsize;i++)
</I>&gt;<i> 								temp[i]=buffer[i];
</I>662a662
&gt;<i> 						}
</I>716c716
&lt;                                                 if (outsize!=-1) // This means SQL_NULL_DATA
---
&gt;<i>                                                 if (outsize!=-1) // This means SQL_NULL_DATA 
</I>739c739
&lt; 				if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo))
---
&gt;<i> 				if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo)) 
</I>742c742
&lt; 				if (outsize==-1) // This means SQL_NULL_DATA
---
&gt;<i> 				if (outsize==-1) // This means SQL_NULL_DATA 
</I>750c750
&lt; 		public
---
&gt;<i> 		public 
</I>823c823
&lt; 			}
---
&gt;<i> 			}	
</I>854,855c854,855
&lt;                         ret = libodbc.SQLColAttribute (hstmt, column, fieldId,
&lt;                                                        buffer, buffer.Length,
---
&gt;<i>                         ret = libodbc.SQLColAttribute (hstmt, column, fieldId, 
</I>&gt;<i>                                                        buffer, buffer.Length, 
</I>872,873c872,873
&lt;                         ret = libodbc.SQLColAttribute (hstmt, column, fieldId,
&lt;                                                        buffer, buffer.Length,
---
&gt;<i>                         ret = libodbc.SQLColAttribute (hstmt, column, fieldId, 
</I>&gt;<i>                                                        buffer, buffer.Length, 
</I>891,892c891
&lt;                         //string [] keys = new string [cols.Length];
&lt; 						string [] keys = null;
---
&gt;<i>                         string [] keys = new string [cols.Length];
</I>894c893
&lt;                         OdbcReturn ret = OdbcReturn.Error;
---
&gt;<i>                         OdbcReturn ret = OdbcReturn.Error;                  
</I>896c895
&lt;                                 ret=libodbc.SQLAllocHandle(OdbcHandleType.Stmt,
---
&gt;<i>                                 ret=libodbc.SQLAllocHandle(OdbcHandleType.Stmt, 
</I>898c897
&lt; 				if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo))
---
&gt;<i> 				if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo)) 
</I>906,907c905,906
&lt;                                 ret = libodbc.SQLPrimaryKeys (handle, catalogName, -3,
&lt;                                                               schemaName, -3,
---
&gt;<i>                                 ret = libodbc.SQLPrimaryKeys (handle, catalogName, -3,  
</I>&gt;<i>                                                               schemaName, -3, 
</I>919,922c918,919
&lt;                                 //int i = 0;
&lt; 								ArrayList keysList = new ArrayList();
&lt; 						
&lt; 								while (true) {
---
&gt;<i>                                 int i = 0;                              
</I>&gt;<i>                                 while (true) {
</I>927,937c924,926
&lt;                                         
&lt; 										//keys [i++] = pkey;
&lt; 										keysList.Add(pkey);
&lt; 								}
&lt; 								
&lt; 								if(keysList.Count &gt; 0) {
&lt; 									keys = new string[keysList.Count];
&lt; 									keysList.CopyTo(keys);
&lt; 								}
&lt; 						
&lt; 						} catch (OdbcException){
---
&gt;<i>                                         keys [i++] = pkey;
</I>&gt;<i>                                 }
</I>&gt;<i>                         } catch (OdbcException){
</I>940,941d928
&lt; 								if(keys == null) keys = new string[0];
&lt; 						
944c931
&lt;                                         if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo))
---
&gt;<i>                                         if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo)) 
</I>948c935
&lt;                                                 if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo))
---
&gt;<i>                                                 if ((ret!=OdbcReturn.Success) &amp;&amp; (ret!=OdbcReturn.SuccessWithInfo)) 
</I>950c937
&lt;                                 }
---
&gt;<i>                                 }                             
</I></PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027463.html">[Mono-list] Announce - SWIG-1.3.25
</A></li>
	<LI>Next message: <A HREF="027471.html">[Mono-list] OdbcDataReader.cs bug. Attached with fix.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27466">[ date ]</a>
              <a href="thread.html#27466">[ thread ]</a>
              <a href="subject.html#27466">[ subject ]</a>
              <a href="author.html#27466">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
