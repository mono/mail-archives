<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Npgsql.dll
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Npgsql.dll&In-Reply-To=20050607142434.5AD6F7007B%40frontgate.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027375.html">
   <LINK REL="Next"  HREF="027398.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Npgsql.dll</H1>
    <B>Carl Olsen</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Npgsql.dll&In-Reply-To=20050607142434.5AD6F7007B%40frontgate.ximian.com"
       TITLE="[Mono-list] Npgsql.dll">carl at carl-olsen.com
       </A><BR>
    <I>Wed Jun  8 06:49:29 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027375.html">[Mono-list] Npgsql.dll
</A></li>
        <LI>Next message: <A HREF="027398.html">[Mono-list] Npgsql.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27394">[ date ]</a>
              <a href="thread.html#27394">[ thread ]</a>
              <a href="subject.html#27394">[ subject ]</a>
              <a href="author.html#27394">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How about some examples of inserts and updates using parameters?  I think
I'm using strings, integers, and booleans, and byte[]s for parameters.

Also, and example of NpgsqlCommand, such as would be used to call a stored
procedure?

Like:

		public User(string newConnectionString):
base(newConnectionString)
		{	}

		public int Create(string emailAddress,
			byte[] password,
			string firstName,
			string lastName,
			string address1,
			string address2,
			string city,
			string state,
			string zipCode,
			string homePhone,
			string country)
		{
			int rowsAffected;
			SqlParameter[] 
				parameters = {
								 new
SqlParameter(&quot;@EmailAddress&quot;, SqlDbType.VarChar, 255),
								 new
SqlParameter(&quot;@Password&quot;, SqlDbType.Binary, 20),
								 new
SqlParameter(&quot;@FirstName&quot;, SqlDbType.VarChar, 30),
								 new
SqlParameter(&quot;@LastName&quot;, SqlDbType.VarChar, 50),
								 new
SqlParameter(&quot;@Address1&quot;, SqlDbType.VarChar, 80),
								 new
SqlParameter(&quot;@Address2&quot;, SqlDbType.VarChar, 80),
								 new
SqlParameter(&quot;@City&quot;, SqlDbType.VarChar, 40),
								 new
SqlParameter(&quot;@State&quot;, SqlDbType.VarChar, 2),

								 new
SqlParameter(&quot;@ZipCode&quot;, SqlDbType.VarChar, 10),
								 new
SqlParameter(&quot;@HomePhone&quot;, SqlDbType.VarChar, 14),
								 new
SqlParameter(&quot;@Country&quot;, SqlDbType.VarChar, 50),
								 new
SqlParameter(&quot;@UserID&quot;, SqlDbType.Int, 4)
							 };

			parameters[0].Value = emailAddress;
			parameters[1].Value = password;
			parameters[2].Value = firstName;
			parameters[3].Value = lastName;
			parameters[4].Value = address1;
			parameters[5].Value = address2;
			parameters[6].Value = city;
			parameters[7].Value = state;
			parameters[8].Value = zipCode;
			parameters[9].Value = homePhone;
			parameters[10].Value = country;
			parameters[11].Direction =
ParameterDirection.Output;
	
			try 
			{
				RunProcedure(&quot;sp_Accounts_CreateUser&quot;,
parameters, out rowsAffected);
			}
			catch ( SqlException e )
			{
				// 2601 is the number returned when the
primary key
				// is violated. We know if we're violating
the primary
				// key that the e-mail address is already on
file.
				// Its cheaper than actually searching for
that address before
				// inserting.
				if (e.Number == 2601) 
				{
					return
(int)CarlsWebs.WebModules.Accounts.ProcResultCodes.AccountAlreadyOnFile;
				}
				else 
				{
					throw new AppException(&quot;An error
occurred while executing the Accounts_CreateUser stored procedure&quot;,
						e );
				}
			}

			return (int)parameters[11].Value;
		}
Carl

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] On Behalf Of Chris Aitken
Sent: Tuesday, June 07, 2005 9:24 AM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">carl at carl-olsen.com</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
Subject: RE: [Mono-list] Npgsql.dll

&gt;<i> It's me again, back to try and write some SPROC.  I want to 
</I>&gt;<i> try the second method (PL/PgSQL), but I'm assuming you get 
</I>&gt;<i> back two arrays each with the same index, one for the 
</I>&gt;<i> customername and one for the postcode.  Is that how you 
</I>&gt;<i> capture the returned data in a dataset?
</I>&gt;<i> 
</I>
Hi Carl,

If you set up as per the original example. It will return a set - i.e. a
table, much the same as a pure SQL query. My example here returns (within
pgAdminIII):

Row	customername(varchar)	postcode(varchar)
1	data				data
2	data				data
...
...
N	data				data

Obviously the above is substituted for the actual data (apart from row
numbers). As I mentioned, is is returning a set of 'type', where in this
case the 'type' is called 'tp_company' is 2 columns of varchar, one named
customername, the other postcode. The type must be defined first:

	CREATE TYPE tp_company AS
		(customername varchar,
		postcode varchar);

Now the actual SPROC is written:

	CREATE FUNCTION plpgsql_company()
		RETURNS SETOF tp_company AS
		'
		DECLARE
			r tp_company%rowtype;
		BEGIN
			FOR r IN SELECT customername,postcode FROM
tblcustomerinformation LOOP
				RETURN NEXT r;
			END LOOP;
			RETURN;
		END
		'
	LANGUAGE 'plpgsql' VOLATILE;


As can be seen, the function is defined as returning a set of 'tp_company'.
We then delare 'r' as being a row of 'tp_company'.

Then for each 'r' (row of 'tp_company', remember) in the SQL query, return
it, then loop until the end.
Return the whole shebang.
End

Hope this helps.

If you want me to write you an example for your data, let me know which
columns you want, table names &amp; column types.

Chris


-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>



</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027375.html">[Mono-list] Npgsql.dll
</A></li>
	<LI>Next message: <A HREF="027398.html">[Mono-list] Npgsql.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27394">[ date ]</a>
              <a href="thread.html#27394">[ thread ]</a>
              <a href="subject.html#27394">[ subject ]</a>
              <a href="author.html#27394">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
