<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Npgsql.dll
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Npgsql.dll&In-Reply-To=20050608120505.692E3700D6%40frontgate.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027398.html">
   <LINK REL="Next"  HREF="027412.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Npgsql.dll</H1>
    <B>Carl Olsen</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Npgsql.dll&In-Reply-To=20050608120505.692E3700D6%40frontgate.ximian.com"
       TITLE="[Mono-list] Npgsql.dll">carl at carl-olsen.com
       </A><BR>
    <I>Wed Jun  8 20:21:07 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027398.html">[Mono-list] Npgsql.dll
</A></li>
        <LI>Next message: <A HREF="027412.html">[Mono-list] Npgsql.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27414">[ date ]</a>
              <a href="thread.html#27414">[ thread ]</a>
              <a href="subject.html#27414">[ subject ]</a>
              <a href="author.html#27414">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chris,

Thanks for the example.  I've downloaded a bunch of stuff from various web
sites, including the Npgsql manual, so I'll be doing some reading this
weekend.

I'm not having any trouble with making a direct connection from a page.  I'm
just trying the abstract the database connections, and I really can't say
I'm having any problems yet.  I just haven't finished writing all the code.
I'll get back to you once I start getting some actual error messages.

Carl

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] On Behalf Of Chris Aitken
Sent: Wednesday, June 08, 2005 7:05 AM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">carl at carl-olsen.com</A>
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
Subject: RE: [Mono-list] Npgsql.dll

&gt;<i> How about some examples of inserts and updates using 
</I>&gt;<i> parameters?  I think I'm using strings, integers, and 
</I>&gt;<i> booleans, and byte[]s for parameters.
</I>
Inserting and updating is pretty simple.

Once you have written your sproc, you call it as:

SELECT update_sproc(&quot;string&quot;,int,&quot;bool&quot;,&quot;byte[]s&quot;)

An app I wrote had:

Public static void Update ()
{
	OpenCon();

	string strSQL;
	int result;

	strSQL = SELECT update_squash(&quot; + &quot;&quot; + playername + &quot;&quot; + &quot;,&quot; +
playedtoday + &quot;,&quot; + wontoday + &quot;)&quot;;

	NpgsqlCommand UpdateCmd = new NpgsqlCommand(strSQL,connSquash);

	result = (int)UpdateCmd.ExecuteScalar();

	if (result ==1)
		Console.Writeline(&quot;Update Successful&quot;);
	else
		Console.Writeline(&quot;Oops!&quot;);

	CloseCon();
}

The sproc update_squash tool a players name(string), their games played that
day (int), and their games won that day (int). The sproc returned a 1 for
success, or a 0 for a FUBAR. I'll try to dig out the actual pl/PgSQL if
possible.




&gt;<i> Also, and example of NpgsqlCommand, such as would be used to 
</I>&gt;<i> call a stored procedure?
</I>
Hopefully the above is a good enough example of how to call the command?
I'll email you the entire C# file if you wish, for the above example?

&gt;<i> Like:
</I>&gt;<i> 
</I>&gt;<i> 		public User(string newConnectionString):
</I>&gt;<i> base(newConnectionString)
</I>&gt;<i> 		{	}
</I>&gt;<i> 
</I>&gt;<i> 		public int Create(string emailAddress,
</I>&gt;<i> 			byte[] password,
</I>&gt;<i> 			string firstName,
</I>&gt;<i> 			string lastName,
</I>&gt;<i> 			string address1,
</I>&gt;<i> 			string address2,
</I>&gt;<i> 			string city,
</I>&gt;<i> 			string state,
</I>&gt;<i> 			string zipCode,
</I>&gt;<i> 			string homePhone,
</I>&gt;<i> 			string country)
</I>&gt;<i> 		{
</I>&gt;<i> 			int rowsAffected;
</I>&gt;<i> 			SqlParameter[] 
</I>&gt;<i> 				parameters = {
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@EmailAddress&quot;, SqlDbType.VarChar, 255),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@Password&quot;, SqlDbType.Binary, 20),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@FirstName&quot;, SqlDbType.VarChar, 30),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@LastName&quot;, SqlDbType.VarChar, 50),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@Address1&quot;, SqlDbType.VarChar, 80),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@Address2&quot;, SqlDbType.VarChar, 80),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@City&quot;, SqlDbType.VarChar, 40),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@State&quot;, SqlDbType.VarChar, 2),
</I>&gt;<i> 
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@ZipCode&quot;, SqlDbType.VarChar, 10),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@HomePhone&quot;, SqlDbType.VarChar, 14),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@Country&quot;, SqlDbType.VarChar, 50),
</I>&gt;<i> 								 new
</I>&gt;<i> SqlParameter(&quot;@UserID&quot;, SqlDbType.Int, 4)
</I>&gt;<i> 							 };
</I>&gt;<i> 
</I>&gt;<i> 			parameters[0].Value = emailAddress;
</I>&gt;<i> 			parameters[1].Value = password;
</I>&gt;<i> 			parameters[2].Value = firstName;
</I>&gt;<i> 			parameters[3].Value = lastName;
</I>&gt;<i> 			parameters[4].Value = address1;
</I>&gt;<i> 			parameters[5].Value = address2;
</I>&gt;<i> 			parameters[6].Value = city;
</I>&gt;<i> 			parameters[7].Value = state;
</I>&gt;<i> 			parameters[8].Value = zipCode;
</I>&gt;<i> 			parameters[9].Value = homePhone;
</I>&gt;<i> 			parameters[10].Value = country;
</I>&gt;<i> 			parameters[11].Direction =
</I>&gt;<i> ParameterDirection.Output;
</I>&gt;<i> 	
</I>&gt;<i> 			try 
</I>&gt;<i> 			{
</I>&gt;<i> 				RunProcedure(&quot;sp_Accounts_CreateUser&quot;,
</I>&gt;<i> parameters, out rowsAffected);
</I>&gt;<i> 			}
</I>&gt;<i> 			catch ( SqlException e )
</I>&gt;<i> 			{
</I>&gt;<i> 				// 2601 is the number returned 
</I>&gt;<i> when the primary key
</I>&gt;<i> 				// is violated. We know if 
</I>&gt;<i> we're violating the primary
</I>&gt;<i> 				// key that the e-mail address 
</I>&gt;<i> is already on file.
</I>&gt;<i> 				// Its cheaper than actually 
</I>&gt;<i> searching for that address before
</I>&gt;<i> 				// inserting.
</I>&gt;<i> 				if (e.Number == 2601) 
</I>&gt;<i> 				{
</I>&gt;<i> 					return
</I>&gt;<i> (int)CarlsWebs.WebModules.Accounts.ProcResultCodes.AccountAlre
</I>&gt;<i> adyOnFile;
</I>&gt;<i> 				}
</I>&gt;<i> 				else 
</I>&gt;<i> 				{
</I>&gt;<i> 					throw new AppException(&quot;An error
</I>&gt;<i> occurred while executing the Accounts_CreateUser stored procedure&quot;,
</I>&gt;<i> 						e );
</I>&gt;<i> 				}
</I>&gt;<i> 			}
</I>&gt;<i> 
</I>&gt;<i> 			return (int)parameters[11].Value;
</I>&gt;<i> 		}
</I>
Chris


-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>



</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027398.html">[Mono-list] Npgsql.dll
</A></li>
	<LI>Next message: <A HREF="027412.html">[Mono-list] Npgsql.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27414">[ date ]</a>
              <a href="thread.html#27414">[ thread ]</a>
              <a href="subject.html#27414">[ subject ]</a>
              <a href="author.html#27414">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
