<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] P/Invoke, Mono, .NET and Windows XP funny platform
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20P/Invoke%2C%20Mono%2C%20.NET%20and%20Windows%20XP%20funny%20platform&In-Reply-To=42AD9872.1080907%40aspl.es">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027458.html">
   <LINK REL="Next"  HREF="027417.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] P/Invoke, Mono, .NET and Windows XP funny platform</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20P/Invoke%2C%20Mono%2C%20.NET%20and%20Windows%20XP%20funny%20platform&In-Reply-To=42AD9872.1080907%40aspl.es"
       TITLE="[Mono-list] P/Invoke, Mono, .NET and Windows XP funny platform">jonpryor at vt.edu
       </A><BR>
    <I>Mon Jun 13 22:09:17 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027458.html">[Mono-list] P/Invoke, Mono, .NET and Windows XP funny platform
</A></li>
        <LI>Next message: <A HREF="027417.html">[Mono-list] Accessing Mono SVN via http
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27470">[ date ]</a>
              <a href="thread.html#27470">[ thread ]</a>
              <a href="subject.html#27470">[ subject ]</a>
              <a href="author.html#27470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2005-06-13 at 16:30 +0200, Francis Brosnan Bl&#225;zquez wrote:
&gt;<i> About the library renaming issue.
</I>&gt;<i> 
</I>&gt;<i> Renaming library basename could help us to find a solution to build 
</I>&gt;<i> application that can run on top of mono and .NET runtime ensuring the
</I>&gt;<i> libraries the af-arch framework relies on will allways be loaded using
</I>&gt;<i> the dll version we have used (appending the &quot;af-arch-&quot;) on develop
</I>&gt;<i> stage.
</I>&gt;<i> 
</I>&gt;<i> My question is: Could this confuse the windows dinamic library loading 
</I>&gt;<i> to load a library called glib.dll and another one called af-arch-
</I>&gt;<i> glib.dll both exporting the same symbols?
</I>
No.  Win32 is less flexible than ELF (which has its pros and cons).  ELF
will link an exported symbol from *any* library to any symbol import
that exists, which is rather useful -- it allows you to use LD_PRELOAD
to replace the GTK+ file selector without recompiling any apps (as was
occasionally done before GTK+ 2.4).

Win32, and &quot;bi-level&quot; Mach-O libraries (I forget the correct term, but
they're the recommendation for Mac OS X &gt;= 10.2) don't have this
flexibility; instead, they require that a symbol come from a
specifically-named library.  In practice this is similar to C++/C#
namespaces or Java packages: you can have several different Foo classes,
but as long as they all reside in a different namespace/package, there
are no problems -- a class loads whatever it was compiled against.

This reduces any external flexibility (LD_PRELOAD has no equivalent
under Win32), but increases sanity (if you have a plugin that brings in
a DLL with the same symbols as some dependency of yours, there is no
conflict as long as the DLLs have different names; consider also any
versioning issues -- you don't need to worry about adding a symbol which
might be present in a different library, since the actual symbol name is
&quot;tied&quot; to the library name).  This is why there can be N different C
runtime libraries without conflict (msvcrt.dll, cygwin1.dll, whatever
Borland's compiler needs...).

&gt;<i> In other words, while running applications using .NET and doing
</I>&gt;<i> P/Invoke over the af-arch-glib.dll the LoadLibrary will find it with
</I>&gt;<i> no problem as well the Mono enviroment will do but, in the case of
</I>&gt;<i> Mono, it have the glib.dll already loaded exporting the same (or
</I>&gt;<i> mostly) symbols leading to have loaded into memory two version for the
</I>&gt;<i> same entry point.
</I>&gt;<i> 
</I>&gt;<i> Using as follow [DllImport(&quot;af-arch-glib&quot;)] will ensure the .NET
</I>&gt;<i> runtime as well as Mono toload the af-arch-glib.dll library. But will
</I>&gt;<i> this also guide both runtimes to differenciate the symbols exported
</I>&gt;<i> from glib.dll and those ones from af-arch-glib.dll?
</I>
Yes, for the reasons stated above.

&lt;snip/&gt;

&gt;<i> &gt;(I'm not entirely sure why this works for you on Linux either, unless
</I>&gt;<i> &gt;you depend on a different version of glib than mono does, in which case
</I>&gt;<i> &gt;you'd bring in a different .so-name.  However, given that Linux/ELF
</I>&gt;<i> &gt;doesn't require a symbol to come from a given library, and instead
</I>&gt;<i> &gt;matches a symbol reference to ANY MATCHING SYMBOL within the address
</I>&gt;<i> &gt;space, I fail to see how, if B.so.2 is already loaded, when C.so.1 is
</I>&gt;<i> &gt;loaded and brings in B.so.3, you could ensure that C.so.1 actually uses
</I>&gt;<i> &gt;the functions in B.so.3 and not B.so.2, since the dynamic linker should
</I>&gt;<i> &gt;find the B.so.2 symbols first...  Madness, I say. :-)
</I>&gt;<i>
</I>&gt;<i> Well, what is happening is that we use Debian ;-). As other Linux
</I>&gt;<i> distributions, the libraries dependecy is handled by the package
</I>&gt;<i> system avoid you lot of problems. Libraries dependencies are set to
</I>&gt;<i> the same for both mono and af-arch, but, libglib and libxml are not
</I>&gt;<i> bundle as part of the mono package as opposed to windows platform.
</I>
In other words, your app uses the same dependencies as mono, not a
different version, which makes for a different (and simpler!) scenario
than your Win32 build. :-)

 - Jon


</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027458.html">[Mono-list] P/Invoke, Mono, .NET and Windows XP funny platform
</A></li>
	<LI>Next message: <A HREF="027417.html">[Mono-list] Accessing Mono SVN via http
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27470">[ date ]</a>
              <a href="thread.html#27470">[ thread ]</a>
              <a href="subject.html#27470">[ subject ]</a>
              <a href="author.html#27470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
