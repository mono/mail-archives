<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Performance benchmark
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Performance%20benchmark&In-Reply-To=1267217588054-1571319.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044508.html">
   <LINK REL="Next"  HREF="044510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Performance benchmark</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Performance%20benchmark&In-Reply-To=1267217588054-1571319.post%40n4.nabble.com"
       TITLE="[Mono-list] Performance benchmark">kumpera at gmail.com
       </A><BR>
    <I>Fri Feb 26 16:19:25 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="044508.html">[Mono-list] Performance benchmark
</A></li>
        <LI>Next message: <A HREF="044510.html">[Mono-list] Performance benchmark
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44509">[ date ]</a>
              <a href="thread.html#44509">[ thread ]</a>
              <a href="subject.html#44509">[ subject ]</a>
              <a href="author.html#44509">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Feb 26, 2010 at 5:53 PM, JCKodel &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">jckodel at gmail.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> First of all, this is NOT a &quot;native MS .net framework is better&quot; e-mail.
</I>&gt;<i>
</I>&gt;<i> I want to build a huge cross-platform system, and I'm a .net programmer
</I>&gt;<i> since, well, ever =) so making something in .net running on all major
</I>&gt;<i> platforms would be heaven for me =) (not really many good results with
</I>&gt;<i> Adobe
</I>&gt;<i> AIR, RealBasic, Lazaro, etc.)
</I>&gt;<i>
</I>&gt;<i> So, I run a very dumb and simple test to check out if there were some
</I>&gt;<i> performance issue with mono. I'm using the latest stable release on both
</I>&gt;<i> Windows and Linux machines (didn't tested on Mac yet) and I'm getting a 10x
</I>&gt;<i> slower results for mono =(
</I>&gt;<i>
</I>&gt;<i> The tests are very simple, although the code itself is not well written
</I>&gt;<i> (that was made on purpose). I know I can do the math way better and using
</I>&gt;<i> some other constructs on strings that are waaaay faster than raw strings.
</I>&gt;<i> The point is to force the memory manipulation, type converters and float
</I>&gt;<i> point calculations.
</I>&gt;<i>
</I>&gt;<i> So, am I doing something wrong (in the sense of mono configuration or
</I>&gt;<i> options), or there is any tips that I should be aware of to, at least,
</I>&gt;<i> bring
</I>&gt;<i> this difference for, say, 2x slower?
</I>&gt;<i>
</I>&gt;<i> The source code for test is simple:
</I>&gt;<i>
</I>&gt;<i> First, some stupid Math calculations:
</I>&gt;<i>
</I>&gt;<i>                                for (int ct = 0; ct &lt; 1000000; ct++)
</I>&gt;<i>                                {
</I>&gt;<i>                                        decimal d =
</I>&gt;<i> Convert.ToDecimal(Math.Pow(ct, 4));
</I>&gt;<i>                                        d =
</I>&gt;<i> Convert.ToDecimal(Math.Sqrt(Convert.ToDouble(d)) * 4 *
</I>&gt;<i> Math.Atan(Convert.ToDouble(ct)));
</I>&gt;<i>                                }
</I>&gt;<i>
</I>&gt;<i> Then some memory play with raw strings:
</I>&gt;<i>
</I>&gt;<i>                                for (int ct = 0; ct &lt; 100000; ct++)
</I>&gt;<i>                                {
</I>&gt;<i>                                        string foo = &quot;foo&quot;;
</I>&gt;<i>
</I>&gt;<i>                                        for (int x = 1; x &lt; 10; x++)
</I>&gt;<i>                                        {
</I>&gt;<i>                                                foo += &quot; &quot; +
</I>&gt;<i> x.ToString(&quot;X2&quot;) + foo;
</I>&gt;<i>                                        }
</I>&gt;<i>
</I>&gt;<i>                                        string bar = foo;
</I>&gt;<i>                                        foo += bar;
</I>&gt;<i>                                }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The results:
</I>&gt;<i>
</I>&gt;<i> Each test was done 3 times in a row. The numbers are milliseconds (lower,
</I>&gt;<i> better):
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is the executable generated by MonoDevelop, in Release configuration,
</I>&gt;<i> running on a Windows 7 Console:
</I>&gt;<i>
</I>&gt;<i> Math: 535
</I>&gt;<i> Strings: 2.038
</I>&gt;<i> Math: 530
</I>&gt;<i> Strings: 1.962
</I>&gt;<i> Math: 530
</I>&gt;<i> Strings: 1.963
</I>&gt;<i>
</I>&gt;<i> Using the mono.exe running the same executable above:
</I>&gt;<i> Math: 6.875
</I>&gt;<i> String: 6.206
</I>&gt;<i> Math: 6.840
</I>&gt;<i> String: 6.114
</I>&gt;<i> Math: 6.857
</I>&gt;<i> String: 6.116
</I>&gt;<i>
</I>&gt;<i> Running the same executable above using ./Benchmark.exe on a Ubuntu
</I>&gt;<i> terminal
</I>&gt;<i> running on a VirtualBox VM (not quite sure which mono version I'm running
</I>&gt;<i> on
</I>&gt;<i> this machine, anyway, is a VM and is running faster than mono.exe on native
</I>&gt;<i> Windows):
</I>&gt;<i>
</I>&gt;<i>
</I>There are a few things to notice. A virtualized machine will perform
significantly slower, specially
for CPU intensive workloads. You should try our live CD to get better
numbers.

Mono runs faster on linux than windows, but the virtualization has it's
costs.

To find our which version of mono you're running use &quot;mono --version&quot; on the
console. Since you're
using what comes with ubuntu it's most likely 2.4. The 2.6 release has some
performance improvements.

Now about your benchmark in particular. Mono has a significantly worse GC,
so any micro-benchmark
that stress this will show some significant performance  degradation. We are
working on replacing it with
a generational copying collection (read very fast), but it won't be ready
any time soon.

The other point is that you didn't mention if you were testing under 32 or
64bits. Mono 32bits has a slower
FP implementation which shows up pretty badly. This is something that will
eventually be fixed.

Mono on real workloads is not 10x slower than MS, it comes to be 10-40%
slower on things like asp.net.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20100226/4fb6e7c0/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20100226/4fb6e7c0/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044508.html">[Mono-list] Performance benchmark
</A></li>
	<LI>Next message: <A HREF="044510.html">[Mono-list] Performance benchmark
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44509">[ date ]</a>
              <a href="thread.html#44509">[ thread ]</a>
              <a href="subject.html#44509">[ subject ]</a>
              <a href="author.html#44509">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
