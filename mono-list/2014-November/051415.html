<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Debug.Assert - a cross-platform issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Debug.Assert%20-%20a%20cross-platform%20issue&In-Reply-To=%3CDB0AB27C-3C3B-48C9-92BD-4413B578E02B%40vt.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="051413.html">
   <LINK REL="Next"  HREF="051416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Debug.Assert - a cross-platform issue</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Debug.Assert%20-%20a%20cross-platform%20issue&In-Reply-To=%3CDB0AB27C-3C3B-48C9-92BD-4413B578E02B%40vt.edu%3E"
       TITLE="[Mono-list] Debug.Assert - a cross-platform issue">jonpryor at vt.edu
       </A><BR>
    <I>Sat Nov 22 02:43:37 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="051413.html">[Mono-list] Debug.Assert - a cross-platform issue
</A></li>
        <LI>Next message: <A HREF="051416.html">[Mono-list] Why there's no document for config file in latest	versions?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51415">[ date ]</a>
              <a href="thread.html#51415">[ thread ]</a>
              <a href="subject.html#51415">[ subject ]</a>
              <a href="author.html#51415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Nov 21, 2014, at 7:25 PM, MarLOne &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">InfoSeeker002 at gmail.com</A>&gt; wrote:
&gt;<i> It will be good if these classes and assemblies from Microsoft open-sources are incorporated verbatim into Mono to replace its inconsistent code.
</I>
This will not be possible, for (at least) three reasons:

1. That code is also shared by Xamarin.Android, Xamarin.iOS, and Xamarin.Mac, all of which lack System.Configuration.dll, and the .NET DefaultTraceListener relies upon System.Configuration (via DiagnosticsConfiguration).

2. There are several CAS demands, which don't make sense on Mono.

3. The default code to write messages is useless outside of Windows, as no other platform has OutputDebugString():

	<A HREF="https://github.com/Microsoft/referencesource/blob/9da503f9ef21e8d1f2905c78d4e3e5cbb3d6f85a/System/compmod/system/diagnostics/DefaultTraceListener.cs#L182-191">https://github.com/Microsoft/referencesource/blob/9da503f9ef21e8d1f2905c78d4e3e5cbb3d6f85a/System/compmod/system/diagnostics/DefaultTraceListener.cs#L182-191</A>

This doesn't mean that the .NET source can't be taken *and modified* for use off Windows, but it can't be used as-is.

&gt;<i> I have to thank Microsoft to open-source the .Net library allowing me to read ...  default values for the System.Diagnostics.DefaultTraceListener.
</I>&gt;<i> The default value of property that determines the reaction of Debug.Assert is set here:  assertuienabled
</I>
The hilarious thing is that AssertUiEnabled does not alone control actual runtime behavior!

	<A HREF="https://github.com/Microsoft/referencesource/blob/9da503f9ef21e8d1f2905c78d4e3e5cbb3d6f85a/System/compmod/system/diagnostics/DefaultTraceListener.cs#L105-107">https://github.com/Microsoft/referencesource/blob/9da503f9ef21e8d1f2905c78d4e3e5cbb3d6f85a/System/compmod/system/diagnostics/DefaultTraceListener.cs#L105-107</A>

The behavior of DefaultTraceListener.Fail() depends on *both* DefaultTraceListener.AssertUiEnabled *and* DefaultTraceListener.UiPermission, which is a private property that demands the UIPermissionWindow.SafeSubWindows CAS permission:
	
                try {
                    new UIPermission(UIPermissionWindow.SafeSubWindows).Demand();
                    return true;
                }
                catch {
                    return false;
                }

This explains how they can sanely have a non-GUI Windows service use Debug.Assert() and have it not hang when there's no Window Station: just have the startup code set security permissions which denies UIPermissionWindow.SafeSubWindows...

This doesn't at all answer how things should work off Windows. You can reasonably argue that DefaultTraceListener.AssertUiEnabled should default to `true` off Windows, even if/when a GUI is never shown, because DefaultTraceListener.AssertUiEnabled is in fact meaningless (it's not the sole control over whether a GUI is shown).

Which really means the docs are misleading. :-)

	<A HREF="http://msdn.microsoft.com/en-us/library/system.diagnostics.defaulttracelistener.assertuienabled(v=vs.110">http://msdn.microsoft.com/en-us/library/system.diagnostics.defaulttracelistener.assertuienabled(v=vs.110</A>).aspx

It's entirely possible, as we can now see, for &quot;user interface mode&quot; to be enabled, yet still not actually display a GUI when Fail() is invoked. This possibility is not noted at all in the documentation, afaict.

 - Jon

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="051413.html">[Mono-list] Debug.Assert - a cross-platform issue
</A></li>
	<LI>Next message: <A HREF="051416.html">[Mono-list] Why there's no document for config file in latest	versions?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51415">[ date ]</a>
              <a href="thread.html#51415">[ thread ]</a>
              <a href="subject.html#51415">[ subject ]</a>
              <a href="author.html#51415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
