<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Bug (?) in SqliteDataReader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Bug%20%28%3F%29%20in%20SqliteDataReader&In-Reply-To=44760FBB.9050104%40for.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031748.html">
   <LINK REL="Next"  HREF="031694.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Bug (?) in SqliteDataReader</H1>
    <B>Nikki Locke</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Bug%20%28%3F%29%20in%20SqliteDataReader&In-Reply-To=44760FBB.9050104%40for.net"
       TITLE="[Mono-list] Bug (?) in SqliteDataReader">nikki at trumphurst.com
       </A><BR>
    <I>Fri May 26 05:30:03 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="031748.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
        <LI>Next message: <A HREF="031694.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31751">[ date ]</a>
              <a href="thread.html#31751">[ thread ]</a>
              <a href="subject.html#31751">[ subject ]</a>
              <a href="author.html#31751">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Joshua Tauberer wrote:
&gt;<i> Nikki Locke wrote: 
</I>&gt;<i> &gt; So I tried some code to insert a DateTime in a parameter. I used the 
</I>&gt;<i> &gt; following code... 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; string sql = &quot;insert into tester (testdate) values (?)&quot;; 
</I>&gt;<i>  
</I>&gt;<i> If you use a named parameter, i.e. ?var, it should work.  Unnamed 
</I>&gt;<i> parameters weren't implemented.  (I just committed a fix for that.) 
</I>
What you suggest does not work. I looked up the syntax, and the correct syntax is 
&quot;:var&quot;. This appears to work (although, obviously, the DateTime.Parse bug still 
applies). Interestingly, it doesn't work with Finisar.SQLite!

&gt;<i> &gt; I think that, in order to avoid breaking existing code, the default should be much 
</I>&gt;<i> &gt; as it is now, EXCEPT do not convert strings to DateTimes in ReadpVm 
</I>&gt;<i> &gt; (SqliteDataReader, about line 188). That would stop it giving an exception when a 
</I>&gt;<i> &gt; string is inserted in a DateTime. It would also prevent the DateTime getting 
</I>&gt;<i> &gt; converted back into a string by the DataTable (which is what makes the original 
</I>&gt;<i> &gt; value unrecoverable). 
</I>&gt;<i>  
</I>&gt;<i> Well, what makes the original value unrecoverable is an independent bug 
</I>&gt;<i> in DateTime.Parse (for reference: it is parsing strings like 02/01/2005 
</I>&gt;<i> with the U.S. format when the current culture is UK).  Importantly, 
</I>&gt;<i> knowing where the bug is means the workaround is in your own code that 
</I>&gt;<i> parses the contents of the DataTable. 
</I>
Sorry, I don't think I understand. Are you suggesting I write my own date parsing 
routine?

&gt;<i> The second work-around was to have GetSchemaTable return DateTime where 
</I>&gt;<i> possible, so that the DateTimes the SqliteClient is already parsing 
</I>&gt;<i> don't get converted back into strings that need parsing in user code. 
</I>&gt;<i> Despite my earlier objections, this seems like a reasonable thing to do. 
</I>
Oh good - my constant nagging has convinced you then :-)

&gt;<i> The third word-around is to stop parsing strings to DateTimes in 
</I>&gt;<i> SqliteClient.  Given this changes the data types people get back from 
</I>&gt;<i> the SqliteDataReader, I'm very hesitant to change this except through a 
</I>&gt;<i> connection string parameter. 
</I>
Well, the suggested behaviour is more consistent, less prone to unexpected exceptions, 
and avoids existing problems (e.g. what do you think happens to a string which contains 
something parseable as a DateTime, plus some additional information?). It should at 
least be an option. Personally, I think it should be the default.

&gt;<i> But these are all workarounds and it would be nice to just fix DateTime 
</I>&gt;<i> before proceeding.
</I>
I agree.

However, having studied the code for the DateTime parsing, I see from the comments that 
this bug is deliberate (to the extent that the necessary information about the likely 
DateTime formats to be encountered in a Culture has a FIXME: not supported comment).

I would try to offer a patch for it myself, but I'm at a bit of a loss how it should 
work.

-- 
Nikki Locke, Trumphurst Ltd.      PC &amp; Unix consultancy &amp; programming
<A HREF="http://www.trumphurst.com/">http://www.trumphurst.com/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031748.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
	<LI>Next message: <A HREF="031694.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31751">[ date ]</a>
              <a href="thread.html#31751">[ thread ]</a>
              <a href="subject.html#31751">[ subject ]</a>
              <a href="author.html#31751">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
