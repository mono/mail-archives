<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Bug (?) in SqliteDataReader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Bug%20%28%3F%29%20in%20SqliteDataReader&In-Reply-To=VA.000027e1.008d376d%40trumphurst.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031751.html">
   <LINK REL="Next"  HREF="031707.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Bug (?) in SqliteDataReader</H1>
    <B>Joshua Tauberer</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Bug%20%28%3F%29%20in%20SqliteDataReader&In-Reply-To=VA.000027e1.008d376d%40trumphurst.com"
       TITLE="[Mono-list] Bug (?) in SqliteDataReader">tauberer at for.net
       </A><BR>
    <I>Sat May 20 08:41:03 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="031751.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
        <LI>Next message: <A HREF="031707.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31694">[ date ]</a>
              <a href="thread.html#31694">[ thread ]</a>
              <a href="subject.html#31694">[ subject ]</a>
              <a href="author.html#31694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Nikki Locke wrote:
&gt;<i> Joshua Tauberer wrote:
</I>&gt;&gt;<i> I don't think there should be a database that can't be read using any 
</I>&gt;&gt;<i> method, even if it wasn't created with Mono.Data.SqliteClient and even 
</I>&gt;&gt;<i> if it has crazy nonuniform data in columns. 
</I>&gt;<i> 
</I>&gt;<i> Well, it is currently possible (actually, easy) to write a data row using the 
</I>&gt;<i> existing Mono.Data.SqliteClient library which cannot be read back!
</I>
True enough, though I guess what I mean is that I wouldn't want to make
this situation worse.

&gt;<i> Note also that storing an arbitrary integer in the DateTime field does not 
</I>&gt;<i> result in a sensible value being returned - the integer has been converted to a 
</I>&gt;<i> string, then passed through DateTime.Parse().ToString().
</I>
If you Fill a DataTable to get the data.

&gt;<i> The bug in DateTime.Parse which does not correctly parse the output of 
</I>&gt;<i> DateTime.ToString in certain locales should also be fixed, but I have no idea 
</I>&gt;<i> where to start with this one, as I haven't unravelled the maze of twisty code 
</I>&gt;<i> which does the job. Suggestions welcome!
</I>
Start a separate thread for that to get some other peoples' attention. :)

&gt;<i> In a similar vein, it would be nice if Mono.Data.Sqlite had trivial subclasses 
</I>&gt;<i> of all the public classes called &quot;SQLite*&quot; instead of &quot;Sqlite*&quot;, thus making it 
</I>&gt;<i> even more compatible with Finisar (without breaking any existing code).
</I>
That's not ugly at all!

Jonathan's suggestion sounds like a good idea:

&gt;<i> What about making SQLite type &quot;safety&quot; an optional feature, configured in
</I>&gt;<i> the connection string, so that when enabled, the GetSchemaTable method
</I>&gt;<i> returns the types asreported by SQLite, but by default (with a plain,
</I>&gt;<i> standard connection string) it returns all columns as 'String'?
</I>
What I wish we could do would be to have all of the special DateTime
handling functionality dependent on the connection string, but that
would break how it works currently.

So, putting it all together from all of your ideas, maybe the best thing
to do is:
   Any DATE/DATETIME column values are forced to be DateTimes.
   Anything that can't be converted to a DateTime is returned as null
(any double values, invalid long values, and unparseable strings),
avoiding casting exceptions later on.
   The column type in GetSchemaTable is returned as DateTime.
   All of this (including the existing DateTime conversion) can be
turned off via the connection string, ensuring that there is a way to
read any database.

This would be a breaking change in so far as double and unparseable
string values in DATETIME columns will be reported as null, rather than
being accessible through the SqliteDataReader.

*But* if the DateTime parsing issue is a bug and is fixed, none of this
is really necessary except as a possible performance improvement to
avoid parsing DateTimes twice (once in SqliteDataReader, once in user
code)... Does it make sense to attack this from that angle instead,
rather than making a breaking change to the data adapter?

-- 
- Joshua Tauberer

<A HREF="http://taubz.for.net">http://taubz.for.net</A>

&quot;Unfortunately, we're having this discussion. It's too bad,
because guess who listens to the discussion: the enemy.&quot;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031751.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
	<LI>Next message: <A HREF="031707.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31694">[ date ]</a>
              <a href="thread.html#31694">[ thread ]</a>
              <a href="subject.html#31694">[ subject ]</a>
              <a href="author.html#31694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
