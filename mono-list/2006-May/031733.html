<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Error in System.Drawing.GDIPlus:GdipDrawLineI when
	using third party control
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Error%20in%20System.Drawing.GDIPlus%3AGdipDrawLineI%20when%0A%09using%20third%20party%20control&In-Reply-To=1148430195.19184.483.camel%40poupou.home">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031732.html">
   <LINK REL="Next"  HREF="031741.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Error in System.Drawing.GDIPlus:GdipDrawLineI when
	using third party control</H1>
    <B>Paddy Joy</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Error%20in%20System.Drawing.GDIPlus%3AGdipDrawLineI%20when%0A%09using%20third%20party%20control&In-Reply-To=1148430195.19184.483.camel%40poupou.home"
       TITLE="[Mono-list] Error in System.Drawing.GDIPlus:GdipDrawLineI when
	using third party control">mono at paddyjoy.com
       </A><BR>
    <I>Wed May 24 02:21:08 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="031732.html">[Mono-list] Error in System.Drawing.GDIPlus:GdipDrawLineI when
	using third party control
</A></li>
        <LI>Next message: <A HREF="031741.html">[Mono-list] Error in System.Drawing.GDIPlus:GdipDrawLineI when
	using third party control
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31733">[ date ]</a>
              <a href="thread.html#31733">[ thread ]</a>
              <a href="subject.html#31733">[ subject ]</a>
              <a href="author.html#31733">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sebastien,

Thanks for the help! By using the trace option I was able to find the 
cause of the problem, but first some info about my system.

I'm running Linux, fedora core 5, mono and libgdi from svn (last night).

The last few lines of the trace suggest that the code is creating a 
brush and a pen, then disposing of the brush before drawing the line.

ENTER: (wrapper managed-to-native) System.Drawing.GDIPlus:GdipCreatePen2 
(intptr,single,System.Drawing.Unit,intptr&amp;)(0x89eefc8, 1.000000, 0, 
[BYREF:0xbf2dc], )
LEAVE: (wrapper managed-to-native) System.Drawing.GDIPlus:GdipCreatePen2 
(intptr,single,System.Drawing.Unit,intptr&amp;)result=0
ENTER: System.Drawing.GDIPlus:CheckStatus (System.Drawing.Status)(0, )
LEAVE: System.Drawing.GDIPlus:CheckStatus (System.Drawing.Status)
ENTER: (wrapper managed-to-native) 
System.Drawing.GDIPlus:GdipDeleteBrush (intptr)(0x89eefc8, )
LEAVE: (wrapper managed-to-native) 
System.Drawing.GDIPlus:GdipDeleteBrush (intptr)result=0
ENTER: (wrapper managed-to-native) System.Drawing.GDIPlus:GdipDrawLineI 
(intptr,intptr,int,int,int,int)(0x89f6b60, 0x89f3b70, 1, 44, 100, 44, )

So it looks like the dodgy third party code is causing the problem, 
unfortunately this doesn't throw an error on MS .NET so I dont think the 
producer will be fixing it anytime soon! Maybe I should log a bug with 
MS ;-) I have reproduced the problem in an attached test case.

Paddy



Sebastien Pouliot wrote:
&gt;<i> Hello Paddy,
</I>&gt;<i>
</I>&gt;<i> On Tue, 2006-05-23 at 14:26 +1000, Paddy Joy wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> I have been trying to get a third party grid control to work on Mono 
</I>&gt;&gt;<i> recently, its the Janus Grid control. However I have hit an error that I 
</I>&gt;&gt;<i> can't really debug because I don't have the source of the control.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Well you can probably debug it because you have Mono source code for
</I>&gt;<i> both System.Drawing.dll and libgdiplus. Of course not having the control
</I>&gt;<i> source code makes it more challenging ;-)
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> Anybody got any ideas? 
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> There's not enough data to get very useful ideas. In fact your email
</I>&gt;<i> lacks very basic information, like:
</I>&gt;<i> * Mono version being used;
</I>&gt;<i> * Libgdiplus version being used;
</I>&gt;<i> * Operating system ...
</I>&gt;<i>
</I>&gt;<i> As for debugging it yourself, you can use mono build-in trace tool (&quot;man
</I>&gt;<i> mono&quot; and look for --trace) to get an idea where it failed (and get an
</I>&gt;<i> idea what the method parameters are).
</I>&gt;<i>
</I>&gt;<i> You can also modify either System.Drawing (C#) or libgdiplus (C) to log
</I>&gt;<i> the parameters used to make the call (with more details and/or at the
</I>&gt;<i> &quot;right&quot; moment).
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> Should I give up and look for an open source 
</I>&gt;&gt;<i> alternative?
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> First things first. If you already invested time and money in this you
</I>&gt;<i> should start by asking your vendor. If no one ask for Mono support, then
</I>&gt;<i> no vendor will invest the time to make sure their controls works with
</I>&gt;<i> Mono.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> Thanks
</I>&gt;&gt;<i> Paddy
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Mono System.Windows.Forms Assembly [$auto_build_revision$]
</I>&gt;&gt;<i> Keyboard: United States keyboard layout (phantom key version)
</I>&gt;&gt;<i> Gtk colorscheme read
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =================================================================
</I>&gt;&gt;<i> Got a SIGSEGV while executing native code. This usually indicates
</I>&gt;&gt;<i> a fatal error in the mono runtime or one of the native libraries
</I>&gt;&gt;<i> used by your application.
</I>&gt;&gt;<i> =================================================================
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Stacktrace:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> in (wrapper managed-to-native) System.Drawing.GDIPlus:GdipDrawLineI 
</I>&gt;&gt;<i> (intptr,intptr,int,int,int,int) &lt;0x4&gt;
</I>&gt;&gt;<i> in (wrapper managed-to-native) System.Drawing.GDIPlus:GdipDrawLineI 
</I>&gt;&gt;<i> (intptr,intptr,int,int,int,int) &lt;0xffffffa5&gt;
</I>&gt;&gt;<i> in System.Drawing.Graphics:DrawLine (System.Drawing.Pen,int,int,int,int) 
</I>&gt;&gt;<i> &lt;0x3d&gt;
</I>&gt;&gt;<i> in (wrapper remoting-invoke-with-check) System.Drawing.Graphics:DrawLine 
</I>&gt;&gt;<i> (System.Drawing.Pen,int,int,int,int) &lt;0x3668&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.Internal.JNSCC:PaintGridlines 
</I>&gt;&gt;<i> (System.Drawing.Graphics,Janus.Windows.GridEX.Internal.JNSCK,System.Drawing.Rectangle,bool) 
</I>&gt;&gt;<i> &lt;0x240&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.Internal.JNSBJ:PaintGridlines 
</I>&gt;&gt;<i> (System.Drawing.Graphics,Janus.Windows.GridEX.Internal.JNSCK,System.Drawing.Rectangle) 
</I>&gt;&gt;<i> &lt;0x81&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.GridEX:b 
</I>&gt;&gt;<i> (System.Drawing.Graphics,Janus.Windows.GridEX.Internal.JNSCK,Janus.Windows.GridEX.GridEXFormatStyle,System.Drawing.Rectangle) 
</I>&gt;&gt;<i> &lt;0x7c2&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.GridEX:a 
</I>&gt;&gt;<i> (System.Drawing.Graphics,Janus.Windows.GridEX.Internal.JNSCK,Janus.Windows.GridEX.GridEXFormatStyle) 
</I>&gt;&gt;<i> &lt;0xa5&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.GridEX:f 
</I>&gt;&gt;<i> (System.Drawing.Graphics,Janus.Windows.GridEX.Internal.JNSCJ) &lt;0x9c3&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.GridEX:c 
</I>&gt;&gt;<i> (System.Drawing.Graphics,Janus.Windows.GridEX.Internal.JNSCJ) &lt;0x4af&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.GridEX:g (System.Drawing.Graphics) &lt;0x267&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.GridEX:e (System.Drawing.Graphics) &lt;0x43&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.GridEX:OnPaint 
</I>&gt;&gt;<i> (System.Windows.Forms.PaintEventArgs) &lt;0x137&gt;
</I>&gt;&gt;<i> in System.Windows.Forms.Control:WndProc (System.Windows.Forms.Message&amp;) 
</I>&gt;&gt;<i> &lt;0x563&gt;
</I>&gt;&gt;<i> in Janus.Windows.GridEX.ScrollableBase:WndProc 
</I>&gt;&gt;<i> (System.Windows.Forms.Message&amp;) &lt;0x52&gt;
</I>&gt;&gt;<i> in ControlNativeWindow:WndProc (System.Windows.Forms.Message&amp;) &lt;0x14&gt;
</I>&gt;&gt;<i> in System.Windows.Forms.NativeWindow:WndProc 
</I>&gt;&gt;<i> (intptr,System.Windows.Forms.Msg,intptr,intptr) &lt;0x11e&gt;
</I>&gt;&gt;<i> in System.Windows.Forms.XplatUIX11:DispatchMessage 
</I>&gt;&gt;<i> (System.Windows.Forms.MSG&amp;) &lt;0x16&gt;
</I>&gt;&gt;<i> in System.Windows.Forms.XplatUI:DispatchMessage 
</I>&gt;&gt;<i> (System.Windows.Forms.MSG&amp;) &lt;0x15&gt;
</I>&gt;&gt;<i> in System.Windows.Forms.Application:RunLoop 
</I>&gt;&gt;<i> (bool,System.Windows.Forms.ApplicationContext) &lt;0x614&gt;
</I>&gt;&gt;<i> in System.Windows.Forms.Application:Run (System.Windows.Forms.Form) &lt;0x24&gt;
</I>&gt;&gt;<i> in JanusTest.Form1:Main () &lt;0x1f&gt;
</I>&gt;&gt;<i> in (wrapper runtime-invoke) System.Object:runtime_invoke_void 
</I>&gt;&gt;<i> (object,intptr,intptr,intptr) &lt;0x7d085f9&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Native stacktrace:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     mono(mono_handle_native_sigsegv+0xbf) [0x81547ef]
</I>&gt;&gt;<i>     mono [0x8122498]
</I>&gt;&gt;<i>     [0x9c8440]
</I>&gt;&gt;<i>     /usr/local/lib/libgdiplus.so(gdip_pen_setup+0x3f) [0x81674f]
</I>&gt;&gt;<i>     /usr/local/lib/libgdiplus.so(GdipDrawLine+0x118) [0x801ba8]
</I>&gt;&gt;<i>     /usr/local/lib/libgdiplus.so(GdipDrawLineI+0x40) [0x801c90]
</I>&gt;&gt;<i>     [0xbd1364]
</I>&gt;&gt;<i>     [0xbd12ce]
</I>&gt;&gt;<i>     [0xbd124e]
</I>&gt;&gt;<i>     [0xbd4821]
</I>&gt;&gt;<i>     [0xbd4592]
</I>&gt;&gt;<i>     [0xbc8ae3]
</I>&gt;&gt;<i>     [0xbc8316]
</I>&gt;&gt;<i>     [0xbd2244]
</I>&gt;&gt;<i>     [0xbc7508]
</I>&gt;&gt;<i>     [0xbc6b38]
</I>&gt;&gt;<i>     [0xbc63f4]
</I>&gt;&gt;<i>     [0x223c40]
</I>&gt;&gt;<i>     [0x699654]
</I>&gt;&gt;<i>     [0x6990a3]
</I>&gt;&gt;<i>     [0x699045]
</I>&gt;&gt;<i>     [0xe45ec7]
</I>&gt;&gt;<i>     [0x222917]
</I>&gt;&gt;<i>     [0x2228f6]
</I>&gt;&gt;<i>     [0x216c65]
</I>&gt;&gt;<i>     [0x216615]
</I>&gt;&gt;<i>     [0x3b6708]
</I>&gt;&gt;<i>     [0x3b57be]
</I>&gt;&gt;<i>     mono(mono_runtime_exec_main+0x62) [0x80bdd92]
</I>&gt;&gt;<i>     mono(mono_runtime_run_main+0x152) [0x80beef2]
</I>&gt;&gt;<i>     mono(mono_main+0xe46) [0x805d106]
</I>&gt;&gt;<i>     mono [0x805bdb2]
</I>&gt;&gt;<i>     /lib/libc.so.6(__libc_start_main+0xdc) [0x9fb724]
</I>&gt;&gt;<i>     mono [0x805bd01]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>   
</I>-------------- next part --------------
using System;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Collections;
using System.ComponentModel;
using System.Windows.Forms;
using System.Data;

namespace WindowsApplication2
{
	/// &lt;summary&gt;
	/// Summary description for Form1.
	/// &lt;/summary&gt;
	public class Form1 : System.Windows.Forms.Form
	{
		/// &lt;summary&gt;
		/// Required designer variable.
		/// &lt;/summary&gt;
		private System.ComponentModel.Container components = null;

		public Form1()
		{
			//
			// Required for Windows Form Designer support
			//
			InitializeComponent();

			//
			// TODO: Add any constructor code after InitializeComponent call
			//
		}

		/// &lt;summary&gt;
		/// Clean up any resources being used.
		/// &lt;/summary&gt;
		protected override void Dispose( bool disposing )
		{
			if( disposing )
			{
				if (components != null) 
				{
					components.Dispose();
				}
			}
			base.Dispose( disposing );
		}

		#region Windows Form Designer generated code
		/// &lt;summary&gt;
		/// Required method for Designer support - do not modify
		/// the contents of this method with the code editor.
		/// &lt;/summary&gt;
		private void InitializeComponent()
		{
			this.components = new System.ComponentModel.Container();
			this.Size = new System.Drawing.Size(300,300);
			this.Text = &quot;Form1&quot;;
		}
		#endregion

		/// &lt;summary&gt;
		/// The main entry point for the application.
		/// &lt;/summary&gt;
		[STAThread]
		static void Main() 
		{
			Application.Run(new Form1());
	
		}

		
		protected override void OnPaint(PaintEventArgs pe)
		{
			Graphics g = pe.Graphics ;
			
			HatchBrush h = new HatchBrush((System.Drawing.Drawing2D.HatchStyle)12, Color.FromArgb(-5134956), Color.FromArgb(-1));
			
			Pen p = new Pen(h, 5);

			h.Dispose();

			g.DrawLine(p, 10, 10, 100, 100);
			
		} 
	}
}
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031732.html">[Mono-list] Error in System.Drawing.GDIPlus:GdipDrawLineI when
	using third party control
</A></li>
	<LI>Next message: <A HREF="031741.html">[Mono-list] Error in System.Drawing.GDIPlus:GdipDrawLineI when
	using third party control
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31733">[ date ]</a>
              <a href="thread.html#31733">[ thread ]</a>
              <a href="subject.html#31733">[ subject ]</a>
              <a href="author.html#31733">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
