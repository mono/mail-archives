<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Does FileMode.Append have O_APPEND semantics on Unix?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Does%20FileMode.Append%20have%20O_APPEND%20semantics%20on%20Unix%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031531.html">
   <LINK REL="Next"  HREF="031505.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Does FileMode.Append have O_APPEND semantics on Unix?</H1>
    <B>Jaroslaw Kowalski</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Does%20FileMode.Append%20have%20O_APPEND%20semantics%20on%20Unix%3F&In-Reply-To="
       TITLE="[Mono-list] Does FileMode.Append have O_APPEND semantics on Unix?">jaak at jkowalski.net
       </A><BR>
    <I>Wed May  3 02:43:18 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="031531.html">[Mono-list] System.InvalidOperationException: Process has not been
	started.
</A></li>
        <LI>Next message: <A HREF="031505.html">[Mono-list] Does FileMode.Append have O_APPEND semantics on Unix?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31503">[ date ]</a>
              <a href="thread.html#31503">[ thread ]</a>
              <a href="subject.html#31503">[ subject ]</a>
              <a href="author.html#31503">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys!

When developing NLog (<A HREF="http://www.nlog-project.org">http://www.nlog-project.org</A>) I faced an interesting 
problem: how to enable multiple process to append to log files in a 
synchronized manner.

Here are my thoughts:

1. You can achieve best performance if you keep the files open. That implies 
FileShare.Write when creating/opening them.

2. FileMode.Append is broken on Windows, since it only moves the file 
pointer once, after the file has been opened/created. This leads to race 
conditions when multiple processes want to append to the same file without 
synchronization. You get garbage in files.

What I wanted to achieve is something similar to the semantics of O_APPEND 
flag passed to open() function, where all append operations are atomic 
(<A HREF="http://theory.uwinnipeg.ca/gnu/glibc/libc_144.html">http://theory.uwinnipeg.ca/gnu/glibc/libc_144.html</A>)

On Windows I came up with the solution that uses global named mutexes to 
synchronize seek-and-write operation. It would be great if I could use 
native Unix support for appending files while running on this platform.

My question is: is FileMode.Append supposed to have O_APPEND semantics on 
Unix? If not, what's the best way to open file with this append semantics in 
mono? I've seen you have MonoIO class, but I'm not sure how it can be used. 
Do you have any ideas?

--
Jarek
<A HREF="http://blog.jkowalski.net/">http://blog.jkowalski.net/</A>

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031531.html">[Mono-list] System.InvalidOperationException: Process has not been
	started.
</A></li>
	<LI>Next message: <A HREF="031505.html">[Mono-list] Does FileMode.Append have O_APPEND semantics on Unix?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31503">[ date ]</a>
              <a href="thread.html#31503">[ thread ]</a>
              <a href="subject.html#31503">[ subject ]</a>
              <a href="author.html#31503">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
