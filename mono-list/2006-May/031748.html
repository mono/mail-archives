<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Bug (?) in SqliteDataReader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Bug%20%28%3F%29%20in%20SqliteDataReader&In-Reply-To=VA.000027e4.014dcec5%40trumphurst.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031687.html">
   <LINK REL="Next"  HREF="031751.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Bug (?) in SqliteDataReader</H1>
    <B>Joshua Tauberer</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Bug%20%28%3F%29%20in%20SqliteDataReader&In-Reply-To=VA.000027e4.014dcec5%40trumphurst.com"
       TITLE="[Mono-list] Bug (?) in SqliteDataReader">tauberer at for.net
       </A><BR>
    <I>Thu May 25 16:12:43 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="031687.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
        <LI>Next message: <A HREF="031751.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31748">[ date ]</a>
              <a href="thread.html#31748">[ thread ]</a>
              <a href="subject.html#31748">[ subject ]</a>
              <a href="author.html#31748">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Nikki Locke wrote:
&gt;<i> In GetSchemaTable, you claim all the fields are strings. However, in 
</I>&gt;<i> ReadpVm you go to some trouble to return the fields as other types. 
</I>&gt;<i> This strikes me as inconsistent!
</I>
No argument there.  We've ended up in a strange situation.

&gt;<i> Having looked at the source, I see that the justification for 
</I>&gt;<i> treating integer values in DateTime columns as FileTimes is that is
</I>&gt;<i> how they are treated in parameters.
</I>
That's right.

&gt;<i> So I tried some code to insert a DateTime in a parameter. I used the
</I>&gt;<i> following code...
</I>&gt;<i> 
</I>&gt;<i> string sql = &quot;insert into tester (testdate) values (?)&quot;;
</I>
If you use a named parameter, i.e. ?var, it should work.  Unnamed
parameters weren't implemented.  (I just committed a fix for that.)

&gt;<i> Do you have the Mono debugger working at all? Any hints how I can get
</I>&gt;<i>  it working?
</I>
Never used it...

&gt;<i> I think that, in order to avoid breaking existing code, the default should be much 
</I>&gt;<i> as it is now, EXCEPT do not convert strings to DateTimes in ReadpVm 
</I>&gt;<i> (SqliteDataReader, about line 188). That would stop it giving an exception when a 
</I>&gt;<i> string is inserted in a DateTime. It would also prevent the DateTime getting 
</I>&gt;<i> converted back into a string by the DataTable (which is what makes the original 
</I>&gt;<i> value unrecoverable).
</I>
Well, what makes the original value unrecoverable is an independent bug
in DateTime.Parse (for reference: it is parsing strings like 02/01/2005
with the U.S. format when the current culture is UK).  Importantly,
knowing where the bug is means the workaround is in your own code that
parses the contents of the DataTable.

The second work-around was to have GetSchemaTable return DateTime where
possible, so that the DateTimes the SqliteClient is already parsing
don't get converted back into strings that need parsing in user code.
Despite my earlier objections, this seems like a reasonable thing to do.

The third word-around is to stop parsing strings to DateTimes in
SqliteClient.  Given this changes the data types people get back from
the SqliteDataReader, I'm very hesitant to change this except through a
connection string parameter.

But these are all workarounds and it would be nice to just fix DateTime
before proceeding.

-- 
- Joshua Tauberer

<A HREF="http://taubz.for.net">http://taubz.for.net</A>

&quot;Unfortunately, we're having this discussion. It's too bad,
because guess who listens to the discussion: the enemy.&quot;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031687.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
	<LI>Next message: <A HREF="031751.html">[Mono-list] Bug (?) in SqliteDataReader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31748">[ date ]</a>
              <a href="thread.html#31748">[ thread ]</a>
              <a href="subject.html#31748">[ subject ]</a>
              <a href="author.html#31748">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
