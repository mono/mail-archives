<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Owin authentication: Method GetBufferlessInputStream not found
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Owin%20authentication%3A%20Method%0A%20GetBufferlessInputStream%20not%20found&In-Reply-To=%3CCACmR%2BBAtv7HRdYByu5acHoXdnQsD%2Bu9kBcBwSHyjFPcPy4Om0g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="051845.html">
   <LINK REL="Next"  HREF="051854.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Owin authentication: Method GetBufferlessInputStream not found</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Owin%20authentication%3A%20Method%0A%20GetBufferlessInputStream%20not%20found&In-Reply-To=%3CCACmR%2BBAtv7HRdYByu5acHoXdnQsD%2Bu9kBcBwSHyjFPcPy4Om0g%40mail.gmail.com%3E"
       TITLE="[Mono-list] Owin authentication: Method GetBufferlessInputStream not found">kumpera at gmail.com
       </A><BR>
    <I>Mon Oct  5 15:31:44 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="051845.html">[Mono-list] Owin authentication: Method GetBufferlessInputStream	not found
</A></li>
        <LI>Next message: <A HREF="051854.html">[Mono-list] Confusing message about El Capitan on download page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51851">[ date ]</a>
              <a href="thread.html#51851">[ thread ]</a>
              <a href="subject.html#51851">[ subject ]</a>
              <a href="author.html#51851">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This method was added to master after 4.2.0 was branches.

Would you mind trying with master or 4.3.0?

--
Rodrigo

On Sun, Oct 4, 2015 at 5:18 AM, Olli Heiskanen &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">ohjelmistoarkkitehti at gmail.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Hello experts,
</I>&gt;<i>
</I>&gt;<i> I was wondering if someone here could help me out with an Asp.Net Web API
</I>&gt;<i> with owin authentication on a CentOS server with the latest mono release.
</I>&gt;<i>
</I>&gt;<i> I'm trying to get such a service working on mono on CentOS server, with
</I>&gt;<i> apache and mod_mono. I'm using mono compiled from source, from git repo
</I>&gt;<i> release mono-4.2.1.36.
</I>&gt;<i>
</I>&gt;<i> I've verified a working Asp.Net website without authentication in my
</I>&gt;<i> CentOS environment, and on my Windows development environment I have a
</I>&gt;<i> working example of an API with owin authentication using bearer tokens to
</I>&gt;<i> authenticate.
</I>&gt;<i>
</I>&gt;<i> Problem is, when deployed to apache, when I send a http POST to the /token
</I>&gt;<i> endpoint, the server returns a 200 OK, but without any response payload
</I>&gt;<i> (which would include the bearer token the client needs to authenticate
</I>&gt;<i> subsequent requests). Also, I get an exception (below) in the apache error
</I>&gt;<i> log (note it originates from Microsoft.Owin.Host.SystemWeb). My server is
</I>&gt;<i> CentOS, but I posted a question about this on stackoverflow and someone
</I>&gt;<i> commented they have observed the same on Ubuntu as well. Nobody was able to
</I>&gt;<i> answer my question there so perhaps here I'll find better expertise on this.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> System.MissingMethodException: Method
</I>&gt;<i> 'HttpRequestBase.GetBufferlessInputStream' not found.
</I>&gt;<i>   at Microsoft.Owin.Host.SystemWeb.CallStreams.InputStream.get_Stream ()
</I>&gt;<i> &lt;0xb0e339b8 + 0x00013&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> Microsoft.Owin.Host.SystemWeb.CallStreams.DelegatingStream.get_CanRead ()
</I>&gt;<i> &lt;0xb0e45eb0 + 0x00013&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at System.IO.StreamReader..ctor (System.IO.Stream stream,
</I>&gt;<i> System.Text.Encoding encoding, Boolean detectEncodingFromByteOrderMarks,
</I>&gt;<i> Int32 bufferSize, Boolean leaveOpen) &lt;0xb0e5d790 + 0x0005f&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at (wrapper remoting-invoke-with-check) System.IO.StreamReader:.ctor
</I>&gt;<i> (System.IO.Stream,System.Text.Encoding,bool,int,bool)
</I>&gt;<i>   at Microsoft.Owin.OwinRequest+&lt;ReadFormAsync&gt;d__0.MoveNext ()
</I>&gt;<i> &lt;0xb0e33510 + 0x000f3&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i> --- End of stack trace from previous location where exception was thrown
</I>&gt;<i> ---
</I>&gt;<i>   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw ()
</I>&gt;<i> &lt;0xb0e34a68 + 0x0002b&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e346d0 + 0x000bb&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e34588 + 0x0007f&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb270df98 + 0x00033&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter`1[TResult].GetResult ()
</I>&gt;<i> &lt;0xb270e1d0 + 0x00017&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> Microsoft.Owin.Security.OAuth.OAuthAuthorizationServerHandler+&lt;InvokeTokenEndpointAsync&gt;d__22.MoveNext
</I>&gt;<i> () &lt;0xb0e2f118 + 0x00463&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i> --- End of stack trace from previous location where exception was thrown
</I>&gt;<i> ---
</I>&gt;<i>   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw ()
</I>&gt;<i> &lt;0xb0e34a68 + 0x0002b&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e346d0 + 0x000bb&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e34588 + 0x0007f&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb270df98 + 0x00033&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.GetResult () &lt;0xb270df70
</I>&gt;<i> + 0x00013&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> Microsoft.Owin.Security.OAuth.OAuthAuthorizationServerHandler+&lt;InvokeAsync&gt;d__0.MoveNext
</I>&gt;<i> () &lt;0xb270e790 + 0x007a7&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i> --- End of stack trace from previous location where exception was thrown
</I>&gt;<i> ---
</I>&gt;<i>   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw ()
</I>&gt;<i> &lt;0xb0e34a68 + 0x0002b&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e346d0 + 0x000bb&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e34588 + 0x0007f&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb270df98 + 0x00033&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter`1[TResult].GetResult ()
</I>&gt;<i> &lt;0xb270f5b0 + 0x00013&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> Microsoft.Owin.Security.Infrastructure.AuthenticationMiddleware`1+&lt;Invoke&gt;d__0[TOptions].MoveNext
</I>&gt;<i> () &lt;0xb270b2a0 + 0x0030f&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i> --- End of stack trace from previous location where exception was thrown
</I>&gt;<i> ---
</I>&gt;<i>   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw ()
</I>&gt;<i> &lt;0xb0e34a68 + 0x0002b&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e346d0 + 0x000bb&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb0e34588 + 0x0007f&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd
</I>&gt;<i> (System.Threading.Tasks.Task task) &lt;0xb270df98 + 0x00033&gt; in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i>   at System.Runtime.CompilerServices.TaskAwaiter.GetResult () &lt;0xb270df70
</I>&gt;<i> + 0x00013&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>   at
</I>&gt;<i> Microsoft.Owin.Host.SystemWeb.IntegratedPipeline.IntegratedPipelineContextStage+&lt;RunApp&gt;d__5.MoveNext
</I>&gt;<i> () &lt;0xb270aa98 + 0x00173&gt; in &lt;filename unknown&gt;:0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So apparently the GetBufferlessInputStream method is not implemented in
</I>&gt;<i> that namespace (I know it is implemented elsewhere). Then I tried the old
</I>&gt;<i> remove-the-dll trick and the behavior changed: Now there is no exception in
</I>&gt;<i> the log, but instead, when I send the http POST to the /token endpoint, the
</I>&gt;<i> server returns a 500 Internal Server Error like so:
</I>&gt;<i>
</I>&gt;<i> System.Web.HttpException
</I>&gt;<i> Method 'POST' is not allowed when accessing file '/webapitest/token'
</I>&gt;<i>
</I>&gt;<i> Description: HTTP 500.Error processing request.
</I>&gt;<i> Details: Error processing request.
</I>&gt;<i> Exception stack trace:
</I>&gt;<i>    at System.Web.DefaultHttpHandler.BeginProcessRequest
</I>&gt;<i> (System.Web.HttpContext context, System.AsyncCallback callback,
</I>&gt;<i> System.Object state) in &lt;filename unknown&gt;:line 0
</I>&gt;<i>    at System.Web.HttpApplication+&lt;Pipeline&gt;c__Iterator1.MoveNext () in
</I>&gt;<i> &lt;filename unknown&gt;:line 0
</I>&gt;<i>    at System.Web.HttpApplication.Tick () in &lt;filename unknown&gt;:line 0
</I>&gt;<i>
</I>&gt;<i> Of course the entire directory containing the api and the client html page
</I>&gt;<i> are chowned to apache user so it's not an obvious file access problem.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So, some of the questions that I'm wondering are; does mono actually
</I>&gt;<i> support owin authentication and bearer tokens? So far I've not found a
</I>&gt;<i> definitive answer to that. I used an online tutorial to build this project
</I>&gt;<i> as a proof-of-concept, it instructed me to use a number of Nuget packages
</I>&gt;<i> including Microsoft.Owin.Host.SystemWeb, so if mono does support owin, it's
</I>&gt;<i> just a matter of finding a way to implement the service without using that
</I>&gt;<i> particular namespace. I'd appreciate if someone can point me to the right
</I>&gt;<i> direction on how to get my project working.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Olli
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20151005/40cdf783/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20151005/40cdf783/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="051845.html">[Mono-list] Owin authentication: Method GetBufferlessInputStream	not found
</A></li>
	<LI>Next message: <A HREF="051854.html">[Mono-list] Confusing message about El Capitan on download page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51851">[ date ]</a>
              <a href="thread.html#51851">[ thread ]</a>
              <a href="subject.html#51851">[ subject ]</a>
              <a href="author.html#51851">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
