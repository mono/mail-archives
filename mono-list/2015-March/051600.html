<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Use existing socket descriptor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Use%20existing%20socket%20descriptor&In-Reply-To=%3C1427743219868-4665729.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="051599.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Use existing socket descriptor</H1>
    <B>Rick</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Use%20existing%20socket%20descriptor&In-Reply-To=%3C1427743219868-4665729.post%40n4.nabble.com%3E"
       TITLE="[Mono-list] Use existing socket descriptor">mono at rickparrish.ca
       </A><BR>
    <I>Mon Mar 30 19:20:19 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="051599.html">[Mono-list] Mono cross compilation on MIPS
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51600">[ date ]</a>
              <a href="thread.html#51600">[ thread ]</a>
              <a href="subject.html#51600">[ subject ]</a>
              <a href="author.html#51600">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In August of 2013 I asked about using an existing socket handle.  Here's the
original message as a reference:
<A HREF="http://lists.ximian.com/pipermail/mono-list/2013-August/050233.html">http://lists.ximian.com/pipermail/mono-list/2013-August/050233.html</A>

I ended up abandoning that project so lost interest, but the need has come
up again.  So I looked into it further this time, and have made a bit of
progress.  What I'm doing is:

- Populate a SocketInformation object with data, including the socket handle
passed from the server program.
- Create a new Socket by passing in the SocketInformation object.
- I modified the above constructor to call OpenSocket_Internal (a new
internal function I added)
- OpenSocket_Internal calls _wapi_open_socket (another new function I added)
- _wapi_open_socket calls _wapi_handle_new_fd (I saw _wapi_accept and
_wapi_socket both call this, so figured it was what I needed)

With these changes I'm now able to have the server pass the numeric socket
handle to my mono program, which can then create a managed Socket class to
make use of that handle.  And everything works fine, until my program
terminates.

When it terminates the connection is being closed, so the server thinks I've
disconnected and also terminates.  What I would like to happen is for the
connection to remain open so then the server will be able to resume socket
I/O with the client.

On Windows I had this problem as well, and I found that if I called
Socket.Close() without first calling Socket.Shutdown() then the connection
remained open, but no such luck here.  I've tried commenting out various
bits of the Dispose handler for the Socket class, and can't seem to get
anything to work.

Any ideas what change I need to make to keep the connection open when my
program terminates?

And a follow-up, assuming keeping the connection open is possible, what are
the chances this &quot;use an existing socket handle&quot; feature could be included
into the main codebase?  Asking users of my program to modify and recompile
mono isn't going to result in very happy people :)  I'm using 3.12.1 but
would be happy to start over with the latest source on GitHub so I can
create a pull-request if it has a chance to be included.

Thanks,
Rick




--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Use-existing-socket-descriptor-tp4660658p4665729.html">http://mono.1490590.n4.nabble.com/Use-existing-socket-descriptor-tp4660658p4665729.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="051599.html">[Mono-list] Mono cross compilation on MIPS
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51600">[ date ]</a>
              <a href="thread.html#51600">[ thread ]</a>
              <a href="subject.html#51600">[ subject ]</a>
              <a href="author.html#51600">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
