<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Unable to create more than 1000 objects.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Unable%20to%20create%20more%20than%201000%20objects.&In-Reply-To=1323683190.4511.17.camel%40drax.riviti.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048059.html">
   <LINK REL="Next"  HREF="048062.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Unable to create more than 1000 objects.</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Unable%20to%20create%20more%20than%201000%20objects.&In-Reply-To=1323683190.4511.17.camel%40drax.riviti.org"
       TITLE="[Mono-list] Unable to create more than 1000 objects.">kumpera at gmail.com
       </A><BR>
    <I>Mon Dec 12 11:42:31 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="048059.html">[Mono-list] Unable to create more than 1000 objects.
</A></li>
        <LI>Next message: <A HREF="048062.html">[Mono-list] Unable to create more than 1000 objects.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48061">[ date ]</a>
              <a href="thread.html#48061">[ thread ]</a>
              <a href="subject.html#48061">[ subject ]</a>
              <a href="author.html#48061">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Dec 12, 2011 at 7:46 AM, Simon Lindgren
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">simon.n.lindgren at gmail.com</A>&gt;wrote:

&gt;<i> Your test program does not fit your description very well, only creating
</I>&gt;<i> 10000 objects and that Unit being of ~4MB size instead of 100B.
</I>&gt;<i>
</I>&gt;<i> I could only test up to 4GB of memory since that is the limit of the
</I>&gt;<i> mono in the Fedora 16 repos, but for me the run time seems to scale
</I>&gt;<i> linearly with growing length of the Unit array. My adapted test code
</I>&gt;<i> (with much smaller object size to exaggerate object construction):
</I>&gt;<i>
</I>&gt;<i> using System;
</I>&gt;<i>
</I>&gt;<i> class Test {
</I>&gt;<i>  static Unit[] units = new Unit[50000000];
</I>&gt;<i>   static public void Main () {
</I>&gt;<i>     for (int i = 0; i &lt; units.Length; i++) units[i] = new Unit();
</I>&gt;<i>    Console.WriteLine(&quot;Now having &quot; + units.Length + &quot; units. &quot; +
</I>&gt;<i> (GC.GetTotalMemory(false) / 1000000).ToString() + &quot; MB&quot;);
</I>&gt;<i>  }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> class Unit {
</I>&gt;<i>  int[] dummy = new int[1];
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> time mono --gc=sgen memtest.exe
</I>&gt;<i> Now having 50000000 units. 3612 MB
</I>&gt;<i> mono --gc=sgen memtest.exe  11,98s user 0,93s system 179% cpu 7,214 total
</I>&gt;<i>
</I>&gt;<i> An observation:
</I>&gt;<i> 3612000000 bytes / 50000000 objects = 72 bytes/object
</I>&gt;<i> 72 bytes - 20 bytes = 52 bytes overhead in object instance storage.
</I>&gt;<i>
</I>

Your numbers need some polishing.

First, an object has a 2 words header, so 16 bytes on 64bits systems.
Then array, they have 4 words header, so 32 bytes on 64bits systems.

Let's measure what the expected size would be:

class Unit: 24 bytes: 16 bytes header + 8 of the dummy field
new int[1]: 40 bytes: 32 for the header + 4 of the one element + 4 padding

 Unit[] array. Each slot takes 8 bytes.

Summing up: 24 + 40 + 8 = 72 bytes. Which is pretty much what you found
out experimentally.

Besides that, your 72 - 20
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20111212/0385c737/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20111212/0385c737/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048059.html">[Mono-list] Unable to create more than 1000 objects.
</A></li>
	<LI>Next message: <A HREF="048062.html">[Mono-list] Unable to create more than 1000 objects.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48061">[ date ]</a>
              <a href="thread.html#48061">[ thread ]</a>
              <a href="subject.html#48061">[ subject ]</a>
              <a href="author.html#48061">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
