<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Large HTTP GET request issues with mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Large%20HTTP%20GET%20request%20issues%20with%20mono&In-Reply-To=%3C1438006297591-4666378.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="051790.html">
   <LINK REL="Next"  HREF="051792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Large HTTP GET request issues with mono</H1>
    <B>DavidS</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Large%20HTTP%20GET%20request%20issues%20with%20mono&In-Reply-To=%3C1438006297591-4666378.post%40n4.nabble.com%3E"
       TITLE="[Mono-list] Large HTTP GET request issues with mono">david.stewart at telogis.com
       </A><BR>
    <I>Mon Jul 27 14:11:37 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="051790.html">[Mono-list] Getting pull request 1665 into Mono 4.2 release
</A></li>
        <LI>Next message: <A HREF="051792.html">[Mono-list] Timeout failure running Mono 4.0.3.19
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51791">[ date ]</a>
              <a href="thread.html#51791">[ thread ]</a>
              <a href="subject.html#51791">[ subject ]</a>
              <a href="author.html#51791">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a fairly simple program with a single HTTP GET call to a Node.js
webserver that returns the entirety of its underlying Mongo database. This
query returns a good bit of data, with a JSON array response of ~460,000
entities. 

When running the application in Visual Studio .Net 4.0, the query takes
approximately 15-20 seconds. However when running in Mono (checked with
versions 2.10.1, 3.0.0, 3.4.0, 3.6.0, and 4.0.3) in multiple different
environments, the query takes at least an order of magnitude longer. Using
Wireshark to look at network traffic showed a massive amount of TCP Window
Update and TCP ZeroWindow packets when running the app in Mono, exactly zero
of these packets when running natively in .Net. So I suspect Mono's TCP
receiver has some sort of buffer issues but honestly I don't know. I've
tried changing the DefaultStreamBufferSize under
System.Runtime.Remoting.Channels.Tcp.TcpMessageIO.cs from 1000 byte array to
8192, but saw no improvement in performance.

A user yesterday suggested checking if it was a compression issue, but the
webserver is not compressing the http packets at all so that can't be the
problem. Any suggestions on what could be the issue here?

It's some sort of scaling issue. Here's some timing numbers based on number
of returned entries:

Mono Run:
Returned Entries | Time
10k   | .5s
100k | 5.8s
200k | 19s
300k | 45s
400k | 79s

.Net Run:

10k   | .4s
100k | 3.5s
200k | 6.6s
300k | 9.8s
400k | 12.9s

As you can see, .Net scales linearly with increasing return count, whereas
Mono has some scaling problems the more data is returned. 




--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Large-HTTP-GET-request-issues-with-mono-tp4666378.html">http://mono.1490590.n4.nabble.com/Large-HTTP-GET-request-issues-with-mono-tp4666378.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="051790.html">[Mono-list] Getting pull request 1665 into Mono 4.2 release
</A></li>
	<LI>Next message: <A HREF="051792.html">[Mono-list] Timeout failure running Mono 4.0.3.19
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51791">[ date ]</a>
              <a href="thread.html#51791">[ thread ]</a>
              <a href="subject.html#51791">[ subject ]</a>
              <a href="author.html#51791">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
