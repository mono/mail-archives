<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Wrapping a native library which uses &quot;unsigned	long&quot; on 32 bit and 64 bit systems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Wrapping%20a%20native%20library%20which%20uses%20%22unsigned%0A%09long%22%20on%2032%20bit%20and%2064%20bit%20systems&In-Reply-To=4BAB2A35.5050802%40a-cert.at">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044695.html">
   <LINK REL="Next"  HREF="044707.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Wrapping a native library which uses &quot;unsigned	long&quot; on 32 bit and 64 bit systems</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Wrapping%20a%20native%20library%20which%20uses%20%22unsigned%0A%09long%22%20on%2032%20bit%20and%2064%20bit%20systems&In-Reply-To=4BAB2A35.5050802%40a-cert.at"
       TITLE="[Mono-list] Wrapping a native library which uses &quot;unsigned	long&quot; on 32 bit and 64 bit systems">alan.mcgovern at gmail.com
       </A><BR>
    <I>Thu Mar 25 07:10:27 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="044695.html">[Mono-list] Wrapping a native library which uses &quot;unsigned	long&quot; on 32 bit and 64 bit systems
</A></li>
        <LI>Next message: <A HREF="044707.html">[Mono-list] Wrapping a native library which uses	&quot;unsigned	long&quot; on 32 bit and 64 bit systems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44694">[ date ]</a>
              <a href="thread.html#44694">[ thread ]</a>
              <a href="subject.html#44694">[ subject ]</a>
              <a href="author.html#44694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Unfortunately there's no trivial way to map this. If you follow that
rule, you're broken on 64bit windows systems (if you care about cross
platform compatibility). There may be other systems which won't work
with that rule, but I don't know.

One approach is to create a wrapper C library which you P/Invoke
instead of P/Invoking the actual library you want to use. The wrapper
library can expose exactly the same API, but it can change usages of
'long' to either int32_t or int64_t as appropriate so that other
languages (not just .NET ones) can easily call those functions.

If you don't want to do that, there's really very little - if anything
- you can do other than guess and write multiple P/Invokes for each
case. For example you could write two p/invoke signatues, one which
maps a C long to a .NET int and one which maps it to a .NET long. Then
at runtime you can detect what platform you're on and whether it's
64bit or 32bit and then make a guess as to which function will not
blow up when you call it. This isn't a great approach unless you're
positive you know all the platforms you're going to run on ;)

Alan.

On Thu, Mar 25, 2010 at 9:17 AM, Mathias Tausig
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mathias.tausig at a-cert.at</A>&gt; wrote:
&gt;<i> Hello!
</I>&gt;<i>
</I>&gt;<i> I am writing a wrapper for a c library which uses the c datatype
</I>&gt;<i> &quot;unsigned long&quot; a lot. According to
</I>&gt;<i> <A HREF="http://www.mono-project.com/Interop_with_Native_Libraries">http://www.mono-project.com/Interop_with_Native_Libraries</A> , unsigned
</I>&gt;<i> long maps to the .NET type uint on a 32bit architecture and to ulong on
</I>&gt;<i> a 64-bit one.
</I>&gt;<i> Is there some sort of best practice, for achieving to write a library
</I>&gt;<i> which can work on both architectures?
</I>&gt;<i>
</I>&gt;<i> cheers
</I>&gt;<i> Mathias
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I></PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044695.html">[Mono-list] Wrapping a native library which uses &quot;unsigned	long&quot; on 32 bit and 64 bit systems
</A></li>
	<LI>Next message: <A HREF="044707.html">[Mono-list] Wrapping a native library which uses	&quot;unsigned	long&quot; on 32 bit and 64 bit systems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44694">[ date ]</a>
              <a href="thread.html#44694">[ thread ]</a>
              <a href="subject.html#44694">[ subject ]</a>
              <a href="author.html#44694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
