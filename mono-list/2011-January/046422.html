<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] RSA with SHA512 hash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20RSA%20with%20SHA512%20hash&In-Reply-To=1294663983.4855.28.camel%40mizar.home">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="046418.html">
   <LINK REL="Next"  HREF="046460.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] RSA with SHA512 hash</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20RSA%20with%20SHA512%20hash&In-Reply-To=1294663983.4855.28.camel%40mizar.home"
       TITLE="[Mono-list] RSA with SHA512 hash">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Mon Jan 10 15:32:21 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="046418.html">[Mono-list] RSA with SHA512 hash
</A></li>
        <LI>Next message: <A HREF="046460.html">[Mono-list] RSA with SHA512 hash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46422">[ date ]</a>
              <a href="thread.html#46422">[ thread ]</a>
              <a href="subject.html#46422">[ subject ]</a>
              <a href="author.html#46422">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello again,

&gt;<i>From source code:
</I>
		// LAMESPEC: str is not the hash name but an OID
		// NOTE: this method is LIMITED to SHA1 and MD5 like the MS framework 1.0 
		// and 1.1 because there's no method to get a hash algorithm from an OID. 
		// However there's no such limit when using the [De]Formatter class.
		public byte[] SignHash (byte[] rgbHash, string str) 

So this is something that has changed after 1.x (likely 2.0 or 3.5).
I'll fix this soon in GIT (maybe in time for 2.10). In the mean time the
workaround will work on all Mono / .NET releases.

Sebastien

On Mon, 2011-01-10 at 07:53 -0500, Sebastien Pouliot wrote:
&gt;<i> Hello Jeremy,
</I>&gt;<i> 
</I>&gt;<i> This was not supported in earlier version of Windows. Most of MS .NET
</I>&gt;<i> cryptography is not managed and redirected to CryptoAPI, which features
</I>&gt;<i> varies by Windows versions (which means your code won't work on all
</I>&gt;<i> Windows versions out there).
</I>&gt;<i> 
</I>&gt;<i> In any case Mono can support this (all managed and no dependency on the
</I>&gt;<i> OS). Please fill a bug report on bugzilla.novell.com with a
</I>&gt;<i> self-contained test case and I'll look at it asap.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> Sebastien
</I>&gt;<i> 
</I>&gt;<i> On Mon, 2011-01-10 at 01:50 -0800, jeremy.poulter wrote:
</I>&gt;<i> &gt; I have been developing an application that uses an SHA512 hash signed with a
</I>&gt;<i> &gt; RSA private key for a digital signature.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This is working fine on Windows under .Net but when I try this on Linux
</I>&gt;<i> &gt; under Mono I get the following exception;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; System.NotSupportedException: 2.16.840.1.101.3.4.2.3 is an unsupported hash
</I>&gt;<i> &gt; algorithm for RSA signing
</I>&gt;<i> &gt;   at
</I>&gt;<i> &gt; System.Security.Cryptography.RSACryptoServiceProvider.GetHashNameFromOID
</I>&gt;<i> &gt; (System.String oid) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Security.Cryptography.RSACryptoServiceProvider.SignHash
</I>&gt;<i> &gt; (System.Byte[] rgbHash, System.String str) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at Oregan.Utilities.DigitalSignature.DigitalSignature.Sign (HashType
</I>&gt;<i> &gt; hashType, System.IO.Stream stream) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at Oregan.FilePackBuilder.FilePack.Save (System.String sPath,
</I>&gt;<i> &gt; Oregan.Utilities.DigitalSignature.DigitalSignature digitalSignature, Boolean
</I>&gt;<i> &gt; bPreserveName) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at Oregan.FilePackBuilder.FilePackViewer.filepackToolStripMenuItem1_Click
</I>&gt;<i> &gt; (System.Object sender, System.EventArgs e) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStripItem.OnClick (System.EventArgs e)
</I>&gt;<i> &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStripMenuItem.OnClick (System.EventArgs e)
</I>&gt;<i> &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStripMenuItem.HandleClick (System.EventArgs e)
</I>&gt;<i> &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStripItem.FireEvent (System.EventArgs e,
</I>&gt;<i> &gt; ToolStripItemEventType met) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at (wrapper remoting-invoke-with-check)
</I>&gt;<i> &gt; System.Windows.Forms.ToolStripItem:FireEvent
</I>&gt;<i> &gt; (System.EventArgs,System.Windows.Forms.ToolStripItemEventType)
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStrip.OnMouseUp
</I>&gt;<i> &gt; (System.Windows.Forms.MouseEventArgs mea) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStripDropDown.OnMouseUp
</I>&gt;<i> &gt; (System.Windows.Forms.MouseEventArgs mea) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.Control.WmLButtonUp (System.Windows.Forms.Message&amp;
</I>&gt;<i> &gt; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.Control.WndProc (System.Windows.Forms.Message&amp; m)
</I>&gt;<i> &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ScrollableControl.WndProc
</I>&gt;<i> &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStrip.WndProc (System.Windows.Forms.Message&amp;
</I>&gt;<i> &gt; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.ToolStripDropDown.WndProc
</I>&gt;<i> &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.Control+ControlWindowTarget.OnMessage
</I>&gt;<i> &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.Control+ControlNativeWindow.WndProc
</I>&gt;<i> &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt;   at System.Windows.Forms.NativeWindow.WndProc (IntPtr hWnd, Msg msg, IntPtr
</I>&gt;<i> &gt; wParam, IntPtr lParam) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; FYI the code I used is;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;     public byte[] Sign(HashType hashType, Stream stream)
</I>&gt;<i> &gt;     {
</I>&gt;<i> &gt;       switch (hashType)
</I>&gt;<i> &gt;       {
</I>&gt;<i> &gt;         case HashType.MD5:
</I>&gt;<i> &gt;         {
</I>&gt;<i> &gt;           MD5 md5 = new MD5CryptoServiceProvider();
</I>&gt;<i> &gt;           byte[] hash = md5.ComputeHash(stream);
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;           return key.SignHash(hash, CryptoConfig.MapNameToOID(&quot;MD5&quot;));
</I>&gt;<i> &gt;         }
</I>&gt;<i> &gt;         case HashType.SHA512:
</I>&gt;<i> &gt;         {
</I>&gt;<i> &gt;           SHA512 shaM = new SHA512Managed();
</I>&gt;<i> &gt;           byte[] hash = shaM.ComputeHash(stream);
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;           return key.SignHash(hash, CryptoConfig.MapNameToOID(&quot;SHA512&quot;));
</I>&gt;<i> &gt;         }
</I>&gt;<i> &gt;       }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;       return null;
</I>&gt;<i> &gt;     }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Any feedback is appreciated.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Cheers,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Jeremy
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="046418.html">[Mono-list] RSA with SHA512 hash
</A></li>
	<LI>Next message: <A HREF="046460.html">[Mono-list] RSA with SHA512 hash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46422">[ date ]</a>
              <a href="thread.html#46422">[ thread ]</a>
              <a href="subject.html#46422">[ subject ]</a>
              <a href="author.html#46422">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
