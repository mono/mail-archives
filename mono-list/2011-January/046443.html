<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] HTTPS: 'Invalid certificate received from server.' and	mozroots
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20HTTPS%3A%20%27Invalid%20certificate%20received%20from%20server.%27%20and%0A%09mozroots&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="046442.html">
   <LINK REL="Next"  HREF="046462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] HTTPS: 'Invalid certificate received from server.' and	mozroots</H1>
    <B>Tym Majewski</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20HTTPS%3A%20%27Invalid%20certificate%20received%20from%20server.%27%20and%0A%09mozroots&In-Reply-To="
       TITLE="[Mono-list] HTTPS: 'Invalid certificate received from server.' and	mozroots">tym.majewski at nearmap.com
       </A><BR>
    <I>Wed Jan 19 23:34:50 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="046442.html">[Mono-list] Mono 2.10 RC1
</A></li>
        <LI>Next message: <A HREF="046462.html">[Mono-list] HTTPS: 'Invalid certificate received from server.' and mozroots
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46443">[ date ]</a>
              <a href="thread.html#46443">[ thread ]</a>
              <a href="subject.html#46443">[ subject ]</a>
              <a href="author.html#46443">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello gurus,

This is Mono 2.6.7 Ubuntu

Problem:
    I cannot connect to https pages (using HttpWebRequest) from MONO ASP and
I cannot (well, maybe I'm not doing it right) display installed x509 certs.

Error message:
    Failed to submit to encrypted.google.com form System.Net.WebException:
Error getting response stream (Write: The authentication or decryption has
failed.): SendFailure ---&gt; System.IO.IOException: The authentication or
decryption has failed. ---&gt; Mono.Security.Protocol.Tls.
TlsException: Invalid certificate received from server. Error code:
0xffffffff800b010a

Extra info:
1. I restarted mono several times.
2. If I provide my own
ServicePointManager.ServerCertificateValidationCallback validator and return
true, the handshake goes through.
3. Connecting to example pages (paypal, google etc) from my Firefox doesn't
show any issues.
4. Connecting to various pages with http:// (not s) works fine.
5. I imported the std root certs with mozroots:

          $sudo mozroots --import --machine --sync
          Mozilla Roots Importer - version 2.6.7.0
          Download and import trusted root certificates from Mozilla's LXR.
          Copyright 2002, 2003 Motus Technologies. Copyright 2004-2008
Novell. BSD licensed.

          Downloading from '
<A HREF="http://lxr.mozilla.org/seamonkey/source/security/nss/lib/ckfw/builtins/certdata.txt'.&lt;http://lxr.mozilla.org/seamonkey/source/security/nss/lib/ckfw/builtins/certdata.txt%27.">http://lxr.mozilla.org/seamonkey/source/security/nss/lib/ckfw/builtins/certdata.txt'.&lt;http://lxr.mozilla.org/seamonkey/source/security/nss/lib/ckfw/builtins/certdata.txt%27.</A>&gt;
..
          Importing certificates into machine store...
          140 new root certificates were added to your trust store.
          Import process completed.

I can see the certs are there:
          $ls /usr/share/.mono/certs/Trust | wc -l
          140


I tried to look at the installed certs but I always get Count = 0:

            X509Store storeMachine = new
X509Store(StoreLocation.LocalMachine); //I also tried
StoreLocation.CurrentUser also with no success.
            storeMachine.Open(OpenFlags.ReadOnly); //BTW. Is this necessary
at all?

            X509Certificate2Collection storecollection2 =
(X509Certificate2Collection)storeMachine.Certificates;
            Console.WriteLine(&quot;Number of X509 certs Machine: {0}&quot;,
storecollection2.Count);
            foreach (X509Certificate2 x509 in storecollection2)
            {
                Console.WriteLine(&quot;certificate name: {0}&quot;, x509.Subject);
            }


Thanks in advance for any help


-- 
Tymek Majewski
Software Developer
NearMap.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20110120/d7cf9558/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20110120/d7cf9558/attachment-0001.html</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="046442.html">[Mono-list] Mono 2.10 RC1
</A></li>
	<LI>Next message: <A HREF="046462.html">[Mono-list] HTTPS: 'Invalid certificate received from server.' and mozroots
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46443">[ date ]</a>
              <a href="thread.html#46443">[ thread ]</a>
              <a href="subject.html#46443">[ subject ]</a>
              <a href="author.html#46443">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
