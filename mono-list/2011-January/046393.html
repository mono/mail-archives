<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] why does gmcs let me assign null to a value type?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20why%20does%20gmcs%20let%20me%20assign%20null%20to%20a%20value%20type%3F&In-Reply-To=AANLkTi%3DLG1ygdQAucS1rMXZT%2BkvK5Pd6_bUjHthe4iB9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="046390.html">
   <LINK REL="Next"  HREF="046396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] why does gmcs let me assign null to a value type?</H1>
    <B>Eric Slosser</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20why%20does%20gmcs%20let%20me%20assign%20null%20to%20a%20value%20type%3F&In-Reply-To=AANLkTi%3DLG1ygdQAucS1rMXZT%2BkvK5Pd6_bUjHthe4iB9%40mail.gmail.com"
       TITLE="[Mono-list] why does gmcs let me assign null to a value type?">eric.slosser at v-fx.com
       </A><BR>
    <I>Thu Jan  6 10:55:22 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="046390.html">[Mono-list] why does gmcs let me assign null to a value type?
</A></li>
        <LI>Next message: <A HREF="046396.html">[Mono-list] why does gmcs let me assign null to a value type?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46393">[ date ]</a>
              <a href="thread.html#46393">[ thread ]</a>
              <a href="subject.html#46393">[ subject ]</a>
              <a href="author.html#46393">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 5, 2011, at 3:45 PM, Miguel de Icaza wrote:
&gt;<i> I hate this behavior, and I believe it was introduced around c# 3
</I>
I'm not sure what you're saying.  That this is csharp standard behavior?  Can you point me to a reference or discussion of this?

Further poking finds that 'Field' just needs to be in a referenced assembly.  Field's assembly doesn't need to be compiled by VisStudio, it can be compiled by gmcs.

The problem is that downstream of 'f = null', we have code that does 'f == null' and 'f != null', which does one thing under .NET and another under Mono.  That's no fun.

If that code is compiled by gmcs, we get a compile-time warning (CS0472) and can fix it.  But many of the assemblies are intended to be compiled only by VisStudio.  Some of the assemblies CAN ONLY be compiled by VisStudio because their projects rely on VisStudio plugins.  

So all we have is unexpected runtime behavior, which we have to search for at runtime. Is there some way to inspect the VisStudio-produced assemblies and find all instances of these &quot;compare struct to null&quot;?

Another solution would be to teach VisStudio to not allow 'Field f = null' or 'f == null', then everyone working on .NET alone would have to write code that conforms to Mono's behavior.  Is that possible?


&gt;<i> On Wednesday, January 5, 2011, Eric Slosser &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">eric.slosser at v-fx.com</A>&gt; wrote:
</I>&gt;&gt;<i> &lt;csharp newbie&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I have a C# struct that's defined as
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>        public struct Field : IComparable, IComparable&lt;Field&gt;, IEquatable&lt;Field&gt;
</I>&gt;&gt;<i>        {
</I>&gt;&gt;<i>        }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> When I do this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>        Field f = null;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I'd expect error CS0037 (can't convert null to 'Field' because it is a value type.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> But when Field is defined in an assembly that was compiled by VisStudio,
</I>&gt;&gt;<i> gmcs (v2.8.1.0) is happy to let me assign null to it.
</I>&gt;<i> 
</I>


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="046390.html">[Mono-list] why does gmcs let me assign null to a value type?
</A></li>
	<LI>Next message: <A HREF="046396.html">[Mono-list] why does gmcs let me assign null to a value type?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46393">[ date ]</a>
              <a href="thread.html#46393">[ thread ]</a>
              <a href="subject.html#46393">[ subject ]</a>
              <a href="author.html#46393">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
