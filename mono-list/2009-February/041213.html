<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Memory leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Memory%20leak&In-Reply-To=20090202180550.GD8859%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041181.html">
   <LINK REL="Next"  HREF="041227.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Memory leak</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Memory%20leak&In-Reply-To=20090202180550.GD8859%40debian.org"
       TITLE="[Mono-list] Memory leak">alan.mcgovern at gmail.com
       </A><BR>
    <I>Fri Feb  6 05:02:25 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041181.html">[Mono-list] Memory leak
</A></li>
        <LI>Next message: <A HREF="041227.html">[Mono-list] Memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41213">[ date ]</a>
              <a href="thread.html#41213">[ thread ]</a>
              <a href="subject.html#41213">[ subject ]</a>
              <a href="author.html#41213">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys,

Someone emailed me a C# version of the 'leaking' program (leak.cs). As was
stated by Rodrigo, this bug is caused by stack slots not being overrwritten.
I've attached a non leaking version (recurse.cs) which adds some recursion
so the stack slots are overrwritten. This version exhibits no leak and will
run forever.

Jon, so if your application is 'leaking' on mono, it's not due to the list
implementation, unless of course your application performs all it's
operations in the same stack slot.

Alan.

On Mon, Feb 2, 2009 at 6:05 PM, Paolo Molaro &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">lupus at ximian.com</A>&gt; wrote:

&gt;<i> On 02/01/09 Jon Harrop wrote:
</I>&gt;<i> &gt; This code creates a queue represented by a cyclic list and repeatedly
</I>&gt;<i> adds and
</I>&gt;<i> &gt; takes one element at a time (so there are always either 1 or 2 elements
</I>&gt;<i> in
</I>&gt;<i> &gt; the queue). Running on Mono 2.2, this program leaks, consuming all 4Gb of
</I>&gt;<i> my
</I>&gt;<i> &gt; memory in only 60 seconds.
</I>&gt;<i>
</I>&gt;<i> If your description of the code is correct, it shouldn't &quot;leak&quot; even with
</I>&gt;<i> the Boehm GC. Write the equivalent code in C#, for example. My guess is
</I>&gt;<i> that either your code doesn't do what you describe or there is a bug
</I>&gt;<i> triggered by F# in the runtime and what is actually leaking is not
</I>&gt;<i> managed memory. Post the equivalent C# code and we can easily check
</I>&gt;<i> which case it is.
</I>&gt;<i>
</I>&gt;<i> &gt; I understand that Mono's new garbage collector has been delayed until
</I>&gt;<i> Mono 2.9
</I>&gt;<i> &gt; but someone else mentioned that even this new GC will still not be
</I>&gt;<i> accurate
</I>&gt;<i> &gt; and, therefore, is likely to leak memory indefinitely as well. Is that
</I>&gt;<i> &gt; correct?
</I>&gt;<i>
</I>&gt;<i> There are various degrees of GC precisions: the current GC is already
</I>&gt;<i> precise wrt heap objects and basically only thread stacks are scanned
</I>&gt;<i> conservatively. The new GC does the same (though there are
</I>&gt;<i> a few more little-used memory locations that are scanned precisely).
</I>&gt;<i> Precise scanning of the managed stack frames is planned for a subsequent
</I>&gt;<i> release (it requires JIT changes as well).
</I>&gt;<i>
</I>&gt;<i> lupus
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> -----------------------------------------------------------------
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">lupus at debian.org</A>                                     debian/rules
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">lupus at ximian.com</A>                             Monkeys do it better
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20090206/d0697512/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20090206/d0697512/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: leak.cs
Type: text/x-csharp
Size: 959 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20090206/d0697512/attachment.bin">http://lists.ximian.com/pipermail/mono-list/attachments/20090206/d0697512/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: recurse.cs
Type: text/x-csharp
Size: 1081 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20090206/d0697512/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-list/attachments/20090206/d0697512/attachment-0001.bin</A> 
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041181.html">[Mono-list] Memory leak
</A></li>
	<LI>Next message: <A HREF="041227.html">[Mono-list] Memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41213">[ date ]</a>
              <a href="thread.html#41213">[ thread ]</a>
              <a href="subject.html#41213">[ subject ]</a>
              <a href="author.html#41213">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
