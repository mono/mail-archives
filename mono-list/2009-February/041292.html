<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Deserialization issue when talking to	webservicefrom mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Deserialization%20issue%20when%20talking%20to%0A%09webservicefrom%20mono&In-Reply-To=117799f00902111134s3d6a64f4t7ba9a228a8c02206%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041290.html">
   <LINK REL="Next"  HREF="041385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Deserialization issue when talking to	webservicefrom mono</H1>
    <B>Robert Weiss</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Deserialization%20issue%20when%20talking%20to%0A%09webservicefrom%20mono&In-Reply-To=117799f00902111134s3d6a64f4t7ba9a228a8c02206%40mail.gmail.com"
       TITLE="[Mono-list] Deserialization issue when talking to	webservicefrom mono">rweiss at chesapeakebay.net
       </A><BR>
    <I>Wed Feb 11 14:41:39 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041290.html">[Mono-list] Deserialization issue when talking to	webservicefrom mono
</A></li>
        <LI>Next message: <A HREF="041385.html">[Mono-list]  how to deploy .NET application to iphone simulator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41292">[ date ]</a>
              <a href="thread.html#41292">[ thread ]</a>
              <a href="subject.html#41292">[ subject ]</a>
              <a href="author.html#41292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A really good point to make regarding this is to make sure that when you
&quot;have&quot; to serialize across platforms, then do it at the lowest level
possible.

 

Basically, my solution was to *not* serialize the SortedList by marking
it [NonSerialized], putting the data in a *more* generic container and
then creating a accessor to load the data from the generic store into
the sorted list when needed the first time. Still all in the same class,
so I have 1 binary still and it works across the platforms without
issue.

 

Thanks to all who offered up help!!

 

________________________________

From: Alan McGovern [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">alan.mcgovern at gmail.com</A>] 
Sent: Wednesday, February 11, 2009 2:34 PM
To: Robert Weiss
Cc: Robert Jordan; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
Subject: Re: [Mono-list] Deserialization issue when talking to
webservicefrom mono

 

 

On Wed, Feb 11, 2009 at 7:23 PM, Robert Weiss &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">rweiss at chesapeakebay.net</A>&gt;
wrote:

Ok. I understand that answer and I have implemented a change similar to
what you responded.


That's a good move. Binary serialization isn't even compatible between
different releases of the .NET framework if you happen to try
serializing the wrong class.
 

	However, I was under the assumption that mono was a supported
project,
	had access to the MS .NET Framework Source and was implementing
it based
	on that source.

 

Nope, not at all.
 

	Is this not the case? If it is the case, then this is a bug that
needs
	to be fixed to the correct implementation.

The fix is really to not use binary serialization on that datatype. As I
said above, you can end up in trouble just trying to interop with
another version of MS.NET. If i remember correctly, binary DateTime
serialization is one which changed between MS.NET releases.

Glad you got it working anyway. That's the important part ;)

Alan.

 

	Thanks for the info.

	
	-----Original Message-----
	From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>
	[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] On Behalf Of Robert
Jordan
	Sent: Wednesday, February 11, 2009 2:18 PM
	To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
	Subject: Re: [Mono-list] Deserialization issue when talking to
	webservicefrom mono

	Robert Weiss wrote:
	&gt; Yes. Assuming that your example class &quot;Sample&quot; was part of the
.net
	&gt; framework and the implementation in .Net was what you listed
and the
	&gt; mono implementation differs, then the binary serialization
would not
	&gt; work. Since this *appears* to be the issue at hand with the
way that
	the
	&gt; Generic Sorted List was implemented in mono, how does one get
the
	&gt; incorrect mono implementation fixed?
	
	Mono's implementation isn't incorrect. It's just incompatible
	regarding binary serialization.
	
	Since SortedList&lt;K, V&gt; does not implement ISerializable, there
	is no way to intercept the serialization process other than
	trying to design the class layout like MS did. It's not an
	easy process given that mono's developers never decompile
	and look at MS' implementation.
	
	Here's an exception I got while trying to deserialize
	a stream created with MS.NET 2.x:
	
	Unhandled Exception: System.TypeLoadException: Could not load
type
	'System.Collections.Generic.SortedList`2+KeyList[[System.Int32,
	mscorlib, Version=2.0.0.0, Culture=neutral,
	PublicKeyToken=b77a5c561934e089],[System.String, mscorlib,
	Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b77a5c561934e089]]'.
	
	This means that MS' implementation is using an internal class
	SortedList&lt;K,V&gt;.KeyList. No one knows exactly what this class is
	for and how it's implemented...
	
	You should replace the SortedList from your WebService API with
	something that can be serialized better, like an array of pairs.
	
	More on serialization:
<A HREF="http://www.mono-project.com/FAQ:_Technical">http://www.mono-project.com/FAQ:_Technical</A>
	(search for serialization).
	
	Robert
	
	_______________________________________________
	Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
	<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
	_______________________________________________
	Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
	<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20090211/f422d125/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20090211/f422d125/attachment-0001.html</A> 
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041290.html">[Mono-list] Deserialization issue when talking to	webservicefrom mono
</A></li>
	<LI>Next message: <A HREF="041385.html">[Mono-list]  how to deploy .NET application to iphone simulator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41292">[ date ]</a>
              <a href="thread.html#41292">[ thread ]</a>
              <a href="subject.html#41292">[ subject ]</a>
              <a href="author.html#41292">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
