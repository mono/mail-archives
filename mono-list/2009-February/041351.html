<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] More .NET and mono floating point inconsistencies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20More%20.NET%20and%20mono%20floating%20point%20inconsistencies&In-Reply-To=4998106D.9060205%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041314.html">
   <LINK REL="Next"  HREF="041355.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] More .NET and mono floating point inconsistencies</H1>
    <B>ddambro</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20More%20.NET%20and%20mono%20floating%20point%20inconsistencies&In-Reply-To=4998106D.9060205%40gmail.com"
       TITLE="[Mono-list] More .NET and mono floating point inconsistencies">ddambro at gmail.com
       </A><BR>
    <I>Thu Feb 19 22:14:14 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041314.html">[Mono-list] More .NET and mono floating point inconsistencies
</A></li>
        <LI>Next message: <A HREF="041355.html">[Mono-list] More .NET and mono floating point inconsistencies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41351">[ date ]</a>
              <a href="thread.html#41351">[ thread ]</a>
              <a href="subject.html#41351">[ subject ]</a>
              <a href="author.html#41351">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

Thanks for looking into my issues.  I hope my post didn't come across as
rude or anything, I was really just looking to ask if it was better to post
issues here or directly to Bugzilla.  I'm sure there are far more important
issues than my weird floating point inconsistencies.  

For the curious, I am an AI researcher working on Evolutionary Computation. 
I tend to use Windows and .NET to run my code, but my research group has
several large computing clusters that could massively speed up my
experiments, but they only run Linux. Also academia tends to shy away from
&quot;Windows Only&quot; software, so if I can say &quot;Runs in Linux&quot; when I release my
code to the public, it's a pretty big boon for me as well as the people who
want to run it.  However, because of the floating point issues described,
experiments run on mono are not compatible with experiments run on .NET, as
over the course of a simulation, the small errors propagate over thousands
of time steps into large differences in the final AI behavior.  Thus, if I
used both mono and .NET, not only would I have to be mindful of which
experiment was run on which platform when I do analysis and demonstrations,
but when I release my results to the public I would also have to mark
arbitrary sets of experiments as &quot;mono only&quot; or &quot;.NET only.&quot;


Korn&#233;l P&#225;l wrote:
&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Thanks for the test cases, I'll invetigate these as well and try to fix 
</I>&gt;<i> them.
</I>&gt;<i> 
</I>&gt;<i> The best way to get bugs fixed is to produce test cases and report them 
</I>&gt;<i> in buzilla.
</I>&gt;<i> 
</I>&gt;<i> You can help more if you are able to provide a patch to fix the bugs.
</I>&gt;<i> 
</I>&gt;<i> Note that for some reasons Novell guys seem to ignore this bug mostly 
</I>&gt;<i> because they have other things to do and their approval is required for 
</I>&gt;<i> these changes.
</I>&gt;<i> 
</I>&gt;<i> Could you please describe your scenario (application name, purpose, etc. 
</I>&gt;<i> if they are public) where you need these floating point roundings and 
</I>&gt;<i> describe why these bugs are critical for you.
</I>&gt;<i> 
</I>&gt;<i> Providing some description may raise component owners' attention.
</I>&gt;<i> 
</I>&gt;<i> Korn&#233;l
</I>&gt;<i> 
</I>&gt;<i> ddambro wrote:
</I>&gt;&gt;<i> I previously posted about some differences I noticed between the floating
</I>&gt;&gt;<i> point math in .NET and mono 
</I>&gt;&gt;<i> <A HREF="http://www.nabble.com/Mono-and-.Net-Floating-Point-Inconsistencies-to21428695ef1367.html">http://www.nabble.com/Mono-and-.Net-Floating-Point-Inconsistencies-to21428695ef1367.html</A>
</I>&gt;&gt;<i> here .  The bug report can be found 
</I>&gt;&gt;<i> <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=467201">https://bugzilla.novell.com/show_bug.cgi?id=467201</A> here .  The patch
</I>&gt;&gt;<i> provided (Thank you!) fixes several issues I was encountering, but
</I>&gt;&gt;<i> unfortunately it led me to discover a couple more.  The following two
</I>&gt;&gt;<i> code
</I>&gt;&gt;<i> samples were tested x86 machines using Linux mono 2.2 with the patch
</I>&gt;&gt;<i> found
</I>&gt;&gt;<i> in the bug report, a clean Windows mono 2.0.1, and the latest version of
</I>&gt;&gt;<i> .NET targeting 3.0 framework and x86.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ---
</I>&gt;&gt;<i> 1.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> using System;
</I>&gt;&gt;<i> using System.Runtime.CompilerServices;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> class Testing
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>     [MethodImpl(MethodImplOptions.NoInlining)]
</I>&gt;&gt;<i>     public static void Main()
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         float f1=200;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         float distance=Distance(300, 500, 387.5f, 362.5f);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         float dist = 1 - (distance / f1);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         float distSqud = dist * dist;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         Console.WriteLine(distSqud.ToString(&quot;R&quot;));
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         foreach (byte b in BitConverter.GetBytes(distSqud))
</I>&gt;&gt;<i>             Console.WriteLine(b);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>     }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>     public static float Distance(float x1, float y1, float x2, float y2)
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         float xDist = x1 - x2;
</I>&gt;&gt;<i>         float yDist = y1 - y2;
</I>&gt;&gt;<i>         float dist = (float)Math.Sqrt(xDist * xDist + yDist * yDist);
</I>&gt;&gt;<i>         return dist;
</I>&gt;&gt;<i>     }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On .NET this code produces:
</I>&gt;&gt;<i> 0.0342619047
</I>&gt;&gt;<i> 54
</I>&gt;&gt;<i> 86
</I>&gt;&gt;<i> 12
</I>&gt;&gt;<i> 61
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> and on mono it produces:
</I>&gt;&gt;<i> 0.03426191
</I>&gt;&gt;<i> 55
</I>&gt;&gt;<i> 86
</I>&gt;&gt;<i> 12
</I>&gt;&gt;<i> 61
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ---
</I>&gt;&gt;<i> 2.  
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> using System;
</I>&gt;&gt;<i> using System.Runtime.CompilerServices;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> class Testing
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>     [MethodImpl(MethodImplOptions.NoInlining)]
</I>&gt;&gt;<i>     public static void Main()
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         float distance = Distance(616.161255f, 391.2928f, 550.8382f,
</I>&gt;&gt;<i> 131.006973f);
</I>&gt;&gt;<i>         Console.WriteLine(distance.ToString(&quot;R&quot;));
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         foreach (byte b in BitConverter.GetBytes(distance))
</I>&gt;&gt;<i>             Console.WriteLine(b);
</I>&gt;&gt;<i>     }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>     public static float Distance(float x1, float y1, float x2, float y2)
</I>&gt;&gt;<i>     {
</I>&gt;&gt;<i>         float xDist = x1 - x2;
</I>&gt;&gt;<i>         float yDist = y1 - y2;
</I>&gt;&gt;<i>         float dist = (float)Math.Sqrt(xDist * xDist + yDist * yDist);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         Console.WriteLine(dist.ToString(&quot;R&quot;));
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         foreach (byte b in BitConverter.GetBytes(dist))
</I>&gt;&gt;<i>             Console.WriteLine(b);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         return dist;
</I>&gt;&gt;<i>     }
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On .NET this code produces:
</I>&gt;&gt;<i> 268.3576
</I>&gt;&gt;<i> 198
</I>&gt;&gt;<i> 45
</I>&gt;&gt;<i> 134
</I>&gt;&gt;<i> 67
</I>&gt;&gt;<i> 268.3576
</I>&gt;&gt;<i> 198
</I>&gt;&gt;<i> 45
</I>&gt;&gt;<i> 134
</I>&gt;&gt;<i> 67
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> and on mono it produces:
</I>&gt;&gt;<i> 268.357635
</I>&gt;&gt;<i> 199
</I>&gt;&gt;<i> 45
</I>&gt;&gt;<i> 134
</I>&gt;&gt;<i> 67
</I>&gt;&gt;<i> 268.357635
</I>&gt;&gt;<i> 199
</I>&gt;&gt;<i> 45
</I>&gt;&gt;<i> 134
</I>&gt;&gt;<i> 67
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ---
</I>&gt;&gt;<i> These seem to be very similar to the issues I was encountering before,
</I>&gt;&gt;<i> but
</I>&gt;&gt;<i> they are not fixed by the patch.  What is the best way to resolve these
</I>&gt;&gt;<i> inconsistencies?  
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> David
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://www.nabble.com/More-.NET-and-mono-floating-point-inconsistencies-tp22018718p22114104.html">http://www.nabble.com/More-.NET-and-mono-floating-point-inconsistencies-tp22018718p22114104.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.

</PRE>












































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041314.html">[Mono-list] More .NET and mono floating point inconsistencies
</A></li>
	<LI>Next message: <A HREF="041355.html">[Mono-list] More .NET and mono floating point inconsistencies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41351">[ date ]</a>
              <a href="thread.html#41351">[ thread ]</a>
              <a href="subject.html#41351">[ subject ]</a>
              <a href="author.html#41351">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
