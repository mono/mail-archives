<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Memory leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Memory%20leak&In-Reply-To=200902071400.30732.jon%40ffconsultancy.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041235.html">
   <LINK REL="Next"  HREF="041242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Memory leak</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Memory%20leak&In-Reply-To=200902071400.30732.jon%40ffconsultancy.com"
       TITLE="[Mono-list] Memory leak">alan.mcgovern at gmail.com
       </A><BR>
    <I>Sat Feb  7 09:04:28 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041235.html">[Mono-list] Memory leak
</A></li>
        <LI>Next message: <A HREF="041242.html">[Mono-list] Memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41236">[ date ]</a>
              <a href="thread.html#41236">[ thread ]</a>
              <a href="subject.html#41236">[ subject ]</a>
              <a href="author.html#41236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I found the issue. Turns out that MS.NET is hitting the boehm &quot;Embarrassing
Failure Scenario&quot;, in particular part 3:

The problem is not limited to what is normally referred to as &quot;conservative&quot;
garbage collection. *It could also be caused by having the garbage collector
accidentally trace from a dead compiler-generated variable*, or by promoting
a queue element to a generation that is effectively not collected. This data
structure is safe only with a system that is carefully designed to prevent
any form of extra space retention (cf. [Appel?]).

If you compile the code without optimisations, it leaks indefinitely. If you
compile with optimisations, the compiler generated variable is being
optimised away and so it doesn't leak. So, as was stated before and as is
stated in the boehm docs, this issue is *not* limited to conservative
garbage collectors.

It looks like mono could *probably* avoid the issue if it's optimisation
pass was able to nuke the same dead variable. It'd be interesting to compare
the IL of the version which does not leak under mono with the version that
does leak and see what the difference is.

Alan.

On Sat, Feb 7, 2009 at 2:00 PM, Jon Harrop &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">jon at ffconsultancy.com</A>&gt; wrote:
&gt;<i> On Saturday 07 February 2009 13:47:01 you wrote:
</I>&gt;&gt;<i> Well, the code you pasted in your email is definitely leaking on my
</I>&gt;&gt;<i> system under MS.NET 3.5 x86. Did you paste the wrong code in your
</I>&gt;&gt;<i> email?
</I>&gt;<i>
</I>&gt;<i> No, I pasted the correct code in my e-mail and I compiled it with MS
</I>Visual C#
&gt;<i> 2008 Express to run it on .NET.
</I>&gt;<i>
</I>&gt;<i> However, I just noticed that Mono only leaks if the code is compiled using
</I>&gt;<i> Mono's C# compiler and *not* if you give Mono the assembly produced by MS
</I>&gt;<i> Visual C#. Perhaps you did the opposite and tried to run the output of
</I>Mono's
&gt;<i> C# compiler under .NET without recompiling the C# source code using MS'
</I>&gt;<i> tools?
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Dr Jon Harrop, Flying Frog Consultancy Ltd.
</I>&gt;<i> <A HREF="http://www.ffconsultancy.com/?e">http://www.ffconsultancy.com/?e</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20090207/35175df0/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20090207/35175df0/attachment-0001.html</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041235.html">[Mono-list] Memory leak
</A></li>
	<LI>Next message: <A HREF="041242.html">[Mono-list] Memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41236">[ date ]</a>
              <a href="thread.html#41236">[ thread ]</a>
              <a href="subject.html#41236">[ subject ]</a>
              <a href="author.html#41236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
