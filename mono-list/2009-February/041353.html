<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Code optimizations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Code%20optimizations&In-Reply-To=22119164.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041352.html">
   <LINK REL="Next"  HREF="041354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Code optimizations</H1>
    <B>Yoav HaCohen</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Code%20optimizations&In-Reply-To=22119164.post%40talk.nabble.com"
       TITLE="[Mono-list] Code optimizations">yoavhacohen at gmail.com
       </A><BR>
    <I>Fri Feb 20 06:43:52 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041352.html">[Mono-list]  Code optimizations
</A></li>
        <LI>Next message: <A HREF="041354.html">[Mono-list] Code optimizations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41353">[ date ]</a>
              <a href="thread.html#41353">[ thread ]</a>
              <a href="subject.html#41353">[ subject ]</a>
              <a href="author.html#41353">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Here is my first idea:

Suppose we have the following code:

[DllImport(NATIVE_LIBRARY, CallingConvention = CallingConvention.Cdecl)]
        private static extern void NativeFoo(int temp, out int cx, out int
cy);

public System.Drawing.Point Foo()
{
	int cx, cy;
	NativeFoo(int a, out cx, out cy);
	return new System.Drawing.Point(cx, cy);
|<i>
</I>
This code could be written like that:
public System.Drawing.Point Foo()
{
	int cx, cy;
	System.Drawing.Point result;
	NativeFoo(int a, out result.Y, out result.X);
	return result;
|<i>
</I>
But it's possible to pass a property as an out or ref argument.

However, it's easy for the compiler to find when the properties are inlined
and the private fields of the struct point are referenced directly, the code
can be translated in compile time to:
public System.Drawing.Point Foo()
{
	int cx, cy;
	System.Drawing.Point result;
	NativeFoo(int a, out result.y, out result.x); // use the directly the
private fields of System.Drawing.Point.

	return result;
|<i>
</I>
In addition, if the struct result is allocated on the caller stack (also by
compiler optimization), than we should eliminate the copy of the two
integers twice.

What do you think?
-- 
View this message in context: <A HREF="http://www.nabble.com/Code-optimizations-tp22119164p22119176.html">http://www.nabble.com/Code-optimizations-tp22119164p22119176.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.

</PRE>























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041352.html">[Mono-list]  Code optimizations
</A></li>
	<LI>Next message: <A HREF="041354.html">[Mono-list] Code optimizations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41353">[ date ]</a>
              <a href="thread.html#41353">[ thread ]</a>
              <a href="subject.html#41353">[ subject ]</a>
              <a href="author.html#41353">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
