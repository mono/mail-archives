<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] StoredProcedure Output Parameters System.Data.Odbc
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20StoredProcedure%20Output%20Parameters%20System.Data.Odbc&In-Reply-To=21997635.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041297.html">
   <LINK REL="Next"  HREF="041298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] StoredProcedure Output Parameters System.Data.Odbc</H1>
    <B>Bartolomeo Nicolotti</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20StoredProcedure%20Output%20Parameters%20System.Data.Odbc&In-Reply-To=21997635.post%40talk.nabble.com"
       TITLE="[Mono-list] StoredProcedure Output Parameters System.Data.Odbc">bnicolotti at siapcn.it
       </A><BR>
    <I>Mon Feb 16 06:04:37 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="041297.html">[Mono-list]  StoredProcedure Output Parameters System.Data.Odbc
</A></li>
        <LI>Next message: <A HREF="041298.html">[Mono-list] Mono 1.9 + mod_mono on Ubuntu - strange problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41312">[ date ]</a>
              <a href="thread.html#41312">[ thread ]</a>
              <a href="subject.html#41312">[ subject ]</a>
              <a href="author.html#41312">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

the problem seems to be that Mono calls SQLPrepare before binding parameters

Bartolomeo Nicolotti wrote:

&gt;<i>As you can see from here:
</I>&gt;<i>
</I>&gt;<i><A HREF="http://www.itjungle.com/mgo/mgo120503-story01.html">http://www.itjungle.com/mgo/mgo120503-story01.html</A>
</I>&gt;<i>
</I>&gt;<i>the code I've written in mono should be ok. The link above is an example in
</I>&gt;<i>visual basic .net on windows, I'm using mono on linux.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>Ok, but the log shows a error coming back from the driver where one
should not occur, so I suggest the problem lies with the driver. All
unixODBC is doing at this point is passing the call from the app to the
driver.

Try executing the same call in isql.

{CALL GIANLUCA.Provacs( ? )}

it should fail to SQLExecute it, but if the driver is working as
expected, the SQLPrepare should succeed. It may be that your DB2 driver
requires the parameters to a SQLPrepare on a stored procedure to be
bound before calling prepare, but if it does, and the mono code only
binds after calling SQLPrepare then all you can do is change the code in
mono, or use a different driver.

<A HREF="http://www.nabble.com/inputOutput-parameter-problem-in-calling-stored-Procedure-td22002537.html">http://www.nabble.com/inputOutput-parameter-problem-in-calling-stored-Procedure-td22002537.html</A>





Bartolomeo Nicolotti wrote:
&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm trying unixodbc with System.Data.ODBC to access DB2 for iseries
</I>&gt;<i> 
</I>&gt;<i> I can do select, see this file 
</I>&gt;<i> <A HREF="http://www.nabble.com/file/p21997635/helloODBC.cs">http://www.nabble.com/file/p21997635/helloODBC.cs</A> helloODBC.cs , but I've
</I>&gt;<i> some problems with out parameters of stored procedueres.
</I>&gt;<i> 
</I>&gt;<i> With this file  <A HREF="http://www.nabble.com/file/p21997635/helloODBCCommand.cs">http://www.nabble.com/file/p21997635/helloODBCCommand.cs</A>
</I>&gt;<i> helloODBCCommand.cs  I get:
</I>&gt;<i> 
</I>&gt;<i> Hello, Dunkel
</I>&gt;<i> Eseguo:CALL QGPL.WBC022(9)
</I>&gt;<i> Eseguo:CALL GIANLUCA.PROVACS
</I>&gt;<i> System.Data.Odbc.OdbcException: ERROR [42000] [unixODBC][IBM][iSeries
</I>&gt;<i> Access ODBC Driver][DB2 UDB]SQL0104 - Token GIANLUCA non valido. Token
</I>&gt;<i> validi: ( END GET SET CALL DROP FREE HOLD LOCK OPEN WITH ALTER.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> It seems that setting the CommandType to StoredProcedure has no effect, as
</I>&gt;<i> one can also see from the source of mono (I've installed mono from source)
</I>&gt;<i> 
</I>&gt;<i> /home/siap/dwn/src/mono/mono-2.2/mcs/class/System.Data/System.Data.Odbc/OdbcCommand
</I>&gt;<i> 
</I>&gt;<i> the ExecuteNonQuery member function call ExecSQL that
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> private int ExecuteNonQuery (bool freeHandle)
</I>&gt;<i>                 {
</I>&gt;<i> ...
</I>&gt;<i>                         ExecSQL(CommandText);
</I>&gt;<i> 
</I>&gt;<i> ExecSQL is:
</I>&gt;<i> 
</I>&gt;<i>                 private void ExecSQL (string sql)
</I>&gt;<i>                 {
</I>&gt;<i>                         OdbcReturn ret;
</I>&gt;<i>                         if (! prepared &amp;&amp; Parameters.Count &lt;= 0) {
</I>&gt;<i> 
</I>&gt;<i>                                 ReAllocStatment ();
</I>&gt;<i>                                
</I>&gt;<i>                                 ret = libodbc.SQLExecDirect (hstmt, sql,
</I>&gt;<i> libodbc.SQL_NTS);
</I>&gt;<i>                                 if ((ret != OdbcReturn.Success) &amp;&amp; (ret !=
</I>&gt;<i> OdbcReturn.SuccessWithInfo) &amp;&amp;
</I>&gt;<i>                                     (ret != OdbcReturn.NoData))
</I>&gt;<i>                                         throw
</I>&gt;<i> connection.CreateOdbcException (OdbcHandleType.Stmt, hstmt);
</I>&gt;<i>                                 return;
</I>&gt;<i>                         }
</I>&gt;<i> 
</I>&gt;<i>                         if (!prepared)
</I>&gt;<i>                                 Prepare();
</I>&gt;<i> 
</I>&gt;<i>                         BindParameters ();
</I>&gt;<i>                         ret = libodbc.SQLExecute (hstmt);
</I>&gt;<i>                         if (ret != OdbcReturn.Success &amp;&amp; ret !=
</I>&gt;<i> OdbcReturn.SuccessWithInfo)
</I>&gt;<i>                                 throw connection.CreateOdbcException
</I>&gt;<i> (OdbcHandleType.Stmt, hstmt);
</I>&gt;<i>                 }
</I>&gt;<i> 
</I>&gt;<i> Should I use prepared to BindParameters?
</I>&gt;<i> 
</I>&gt;<i> How can I get the output parameter of a Stored Procedure?
</I>&gt;<i> 
</I>&gt;<i> Many thanks
</I>&gt;<i> 
</I>&gt;<i> Best regards
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://www.nabble.com/StoredProcedure-Output-Parameters-System.Data.Odbc-tp21997635p22035240.html">http://www.nabble.com/StoredProcedure-Output-Parameters-System.Data.Odbc-tp21997635p22035240.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.

</PRE>










































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041297.html">[Mono-list]  StoredProcedure Output Parameters System.Data.Odbc
</A></li>
	<LI>Next message: <A HREF="041298.html">[Mono-list] Mono 1.9 + mod_mono on Ubuntu - strange problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41312">[ date ]</a>
              <a href="thread.html#41312">[ thread ]</a>
              <a href="subject.html#41312">[ subject ]</a>
              <a href="author.html#41312">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
