<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Embedded API: thunk value type parameters and return	types
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20Embedded%20API%3A%20thunk%20value%20type%20parameters%20and%20return%0A%09types&In-Reply-To=%3CDA4EE713-5190-43F0-8CBD-C6F6DD2B1CBF%40mugginsoft.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052222.html">
   <LINK REL="Next"  HREF="052225.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Embedded API: thunk value type parameters and return	types</H1>
    <B>Jonathan Mitchell</B> 
    <A HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20Embedded%20API%3A%20thunk%20value%20type%20parameters%20and%20return%0A%09types&In-Reply-To=%3CDA4EE713-5190-43F0-8CBD-C6F6DD2B1CBF%40mugginsoft.com%3E"
       TITLE="[Mono-list] Embedded API: thunk value type parameters and return	types">lists at mugginsoft.com
       </A><BR>
    <I>Thu Sep 22 20:22:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052222.html">[Mono-list] [Mono-dev] Q: &quot;The assembly mscorlib.dll was not	found&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="052225.html">[Mono-list] Embedded API: thunk value type parameters and	return types
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52215">[ date ]</a>
              <a href="thread.html#52215">[ thread ]</a>
              <a href="subject.html#52215">[ subject ]</a>
              <a href="author.html#52215">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am trying to upgrade some method invoke based code to used thunks.

The comments for mono_method_get_unmanaged_thunk() say:

 * LIMITATIONS
 *
 * Value type arguments and return values are treated as they were objects:
 *
 * C#: public static Rectangle Intersect (Rectangle a, Rectangle b);
 * C:  typedef MonoObject* (*Intersect)(MonoObject*, MonoObject*, MonoException**);
 *
 * Arguments must be properly boxed upon trunk's invocation, while return
 * values must be unboxed.

However it seems that primitive value types are returned unboxed while non primitive value types are not.
Does the same apply for thunk parameters?
Are primitive value parameters based by value and non primitive value parameters as a boxed reference?

// Obj-C
// non primitive value type
    - (NSDate *)date
    {
		typedef MonoObject* (*Thunk)(MonoObject *, MonoObject**);
		static Thunk thunk;
		MonoObject *monoException = NULL;
		if (!thunk) {
			MonoMethod *monoMethod = GetPropertyGetMethod(self.monoClass, &quot;Date&quot;);
			thunk = (Thunk)mono_method_get_unmanaged_thunk(monoMethod);
		}
		MonoObject *monoObject = thunk(self.monoObject, &amp;monoException);
		if (monoException != NULL) @throw(NSExceptionFromMonoException(monoException, @{}));

		if ([self object:_date isEqualToMonoObject:monoObject]) return _date;					
		_date = [NSDate dateWithMonoDateTime:monoObject];

		return _date;
	}

// primitive value type
    - (int64_t)int64Number
    {
		typedef int64_t (*Thunk)(MonoObject *, MonoObject**);
		static Thunk thunk;
		MonoObject *monoException = NULL;
		if (!thunk) {
			MonoMethod *monoMethod = GetPropertyGetMethod(self.monoClass, &quot;Int64Number&quot;);
			thunk = (Thunk)mono_method_get_unmanaged_thunk(monoMethod);
		}
		_int64Number = thunk(self.monoObject, &amp;monoException);
		if (monoException != NULL) @throw(NSExceptionFromMonoException(monoException, @{}));
		return _int64Number;
	}
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052222.html">[Mono-list] [Mono-dev] Q: &quot;The assembly mscorlib.dll was not	found&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="052225.html">[Mono-list] Embedded API: thunk value type parameters and	return types
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52215">[ date ]</a>
              <a href="thread.html#52215">[ thread ]</a>
              <a href="subject.html#52215">[ subject ]</a>
              <a href="author.html#52215">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
