<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono.Unix.Native.Syscall.(l)stat weirdness
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Unix.Native.Syscall.%28l%29stat%20weirdness&In-Reply-To=1140634348.998.12.camel%40whisper.home">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030742.html">
   <LINK REL="Next"  HREF="030760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono.Unix.Native.Syscall.(l)stat weirdness</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Unix.Native.Syscall.%28l%29stat%20weirdness&In-Reply-To=1140634348.998.12.camel%40whisper.home"
       TITLE="[Mono-list] Mono.Unix.Native.Syscall.(l)stat weirdness">jonpryor at vt.edu
       </A><BR>
    <I>Thu Feb 23 07:50:31 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="030742.html">[Mono-list] Mono.Unix.Native.Syscall.(l)stat weirdness
</A></li>
        <LI>Next message: <A HREF="030760.html">[Mono-list] Mono.Unix.Native.Syscall.(l)stat weirdness
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30749">[ date ]</a>
              <a href="thread.html#30749">[ thread ]</a>
              <a href="subject.html#30749">[ subject ]</a>
              <a href="author.html#30749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2006-02-22 at 19:52 +0100, L&#225;szl&#243; Monda wrote:
&gt;<i> On Fri, 2006-02-17 at 06:28 -0500, Jonathan Pryor wrote:
</I>&gt;<i> &gt; On Fri, 2006-02-17 at 00:36 +0100, L&#225;szl&#243; Monda wrote:
</I>&gt;<i> &gt; &gt; UnixFileSystemInfo seems to be a well-designed abstraction on top of the
</I>&gt;<i> &gt; &gt; Unix VFS API, but I'll stick with syscalls, because I don't like
</I>&gt;<i> &gt; &gt; UnixFileSystemInfo's exception policy.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What don't you like about its exception policy?
</I>&gt;<i> 
</I>&gt;<i> It was something to do with dangling links.  If I remember correctly,
</I>&gt;<i> UnixFileSystemInfo throwed an exception on dangling links.  I wanted to
</I>&gt;<i> subclass this class, but this policy made it unconvenient for me.  Of
</I>&gt;<i> course, my scenario is rather unusual, because I'm writing a file
</I>&gt;<i> manager application and the File class is a critical part of it.
</I>
UnixFileSystemInfo's exception policy is to throw an exception if the
file doesn't exist.  You were probably using the UnixFileInfo subclass,
which uses Syscall.stat, which would generate an exception when trying
to access the UnixFileSystemInfo members.

If you need to care about potentially dangling symlinks,
UnixSymbolicLinkInfo would be your friend, as it uses Syscall.lstat to
provide information, thus no exceptions would be generated when
accessing the UnixFileSystemInfo members.  Instead, you might get an
exception when reading UnixSymbolicLinkInfo.Contents, which tries to
create a UnixFileSystemInfo object on the dangling symlink target.

One issue that I've just found is that for dangling symlinks HasContents
will return true while Contents will generate a FileNotFoundException
exception.  This is obviously bad (as there's no way to avoid the
exception), and I will fix this.

(Then, to be fully confusing, if you create a UnixSymbolicLinkInfo over
a regular file, Contents will return null instead of generating an
exception.  Yay consistency!  At least HasContents returns false in this
case...)

I need to make a public UnixFileSystemInfo.CreateInfo() method which
looks at an existing file and creates a UnixFileInfo, UnixDirectoryInfo,
or UnixSymbolicLinkInfo instance as appropriate for the specified file.

&gt;<i> I probably had some other minor issues with UnixFileSystemInfo, but the
</I>&gt;<i> above behaviour was the showstopper.
</I>&gt;<i> 
</I>&gt;<i> In the end, I implemented my own File class.  You may want to take a
</I>&gt;<i> look at it:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://cvs.sourceforge.net/viewcvs.py/ulc/uc/File.cs?view=markup">http://cvs.sourceforge.net/viewcvs.py/ulc/uc/File.cs?view=markup</A>
</I>
FYI, your SymbolicPermissions property could be replaced with
Mono.Unix.Native.NativeConvert.ToUnixPermissionString().

 - Jon


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030742.html">[Mono-list] Mono.Unix.Native.Syscall.(l)stat weirdness
</A></li>
	<LI>Next message: <A HREF="030760.html">[Mono-list] Mono.Unix.Native.Syscall.(l)stat weirdness
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30749">[ date ]</a>
              <a href="thread.html#30749">[ thread ]</a>
              <a href="subject.html#30749">[ subject ]</a>
              <a href="author.html#30749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
