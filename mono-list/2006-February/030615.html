<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Config file for dll
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Config%20file%20for%20dll&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030614.html">
   <LINK REL="Next"  HREF="030616.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Config file for dll</H1>
    <B>Bradley, Peter</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Config%20file%20for%20dll&In-Reply-To="
       TITLE="[Mono-list] Config file for dll">PBradley at uwic.ac.uk
       </A><BR>
    <I>Tue Feb  7 06:06:58 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="030614.html">[Mono-list] Using Jasper Reports with the help of IKVM
</A></li>
        <LI>Next message: <A HREF="030616.html">[Mono-list] Config file for dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30615">[ date ]</a>
              <a href="thread.html#30615">[ thread ]</a>
              <a href="subject.html#30615">[ subject ]</a>
              <a href="author.html#30615">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

 

I've tried to post on this before, but never managed to get below the
size limit.  So this is a change of tactic :-)

 

The problem is that I would like to keep the connection string for the
application's db connectivity in a configuration file instead of hard
coding it.  However, since I'm making the db connection from a dll
rather than an exe file I can't use a normal App.config file.  What I
would like to do is to use the AssemblySettings class that can be found
at:

 

<A HREF="http://www.bearcanyon.com/dotnet/#AssemblySettings">http://www.bearcanyon.com/dotnet/#AssemblySettings</A>

 

This allows the settings to be accessed like this:

 

// AssemblySettings usage:

//

// If you know the keys you're after, the following is probably

// the most convenient:

//

//      AssemblySettings settings = new AssemblySettings();

//      string someSetting1 = settings[&quot;someKey1&quot;];

//      string someSetting2 = settings[&quot;someKey2&quot;];

 

This works in .NET on Windows, but not in Mono on Linux.  When I deploy
the project to my Linux server and try to run the db connectivity code,
I get an error saying that the table cannot be read.  I'm certain this
is because the connection string is not being read from the config file
because if I hard code the connection string into the program instead of
calling AssemblySettings, everything works just fine.  In other words, I
think the config file is not found under Mono.

 

Looking at the AssemblySettings code, I think the problem is here:

 

            public static IDictionary GetConfig( Assembly asm )

            {

                  // Open and parse configuration file for specified

                  // assembly, returning collection to caller for future

                  // use outside of this class.

                  //

                  try

                  {

                        string cfgFile = asm.CodeBase + &quot;.config&quot;;

                        const string nodeName = &quot;assemblySettings&quot;;

 

                        XmlDocument doc = new XmlDocument();

                        doc.Load(new XmlTextReader(cfgFile));

            

                        XmlNodeList nodes =
doc.GetElementsByTagName(nodeName);

 

                        foreach( XmlNode node in nodes )

                        {

                              if( node.LocalName == nodeName )

                              {

                                    DictionarySectionHandler handler =
new DictionarySectionHandler();

                                    return
(IDictionary)handler.Create(null, null, node);

                              }

                        }

                  }

                  catch (Exception ex)

                  {

                        string s = ex.Message;

                  }

 

                  return(null);

            }

 

In Windows, the variable cfgFile is set to (for example)
MyAssembly.dll.config and then the XmlTextReader object reads the XML
file (the config file) in the folder of the dll's calling assembly,
which would be the folder of the executable assembly that links to the
dll, under normal circumstances (assuming the assembly is not in the
GAC).  I don't plan to put the assembly in the GAC.

 

Is it possible that Mono is looking in a different place?  Is there some
code I need to add to ensure that Mono will look in some specific place?

 

Many thanks

 

 

Peter

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20060207/356a5d9e/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20060207/356a5d9e/attachment.html</A>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030614.html">[Mono-list] Using Jasper Reports with the help of IKVM
</A></li>
	<LI>Next message: <A HREF="030616.html">[Mono-list] Config file for dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30615">[ date ]</a>
              <a href="thread.html#30615">[ thread ]</a>
              <a href="subject.html#30615">[ subject ]</a>
              <a href="author.html#30615">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
