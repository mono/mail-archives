<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Crypto Unit tests on linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="009116.html">
   <LINK REL="Next"  HREF="009057.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Crypto Unit tests on linux
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Crypto Unit tests on linux">lupus@ximian.com
       </A><BR>
    <I>Wed, 16 Oct 2002 10:35:56 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="009116.html">[Mono-list] Crypto Unit tests on linux
</A></li>
        <LI> Next message: <A HREF="009057.html">[Mono-list] Crypto Unit tests on linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9070">[ date ]</a>
              <a href="thread.html#9070">[ thread ]</a>
              <a href="subject.html#9070">[ subject ]</a>
              <a href="author.html#9070">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/15/02 Sebastien Pouliot wrote:
&gt;<i> I found out that I made a cyclic dependency: some classes
</I>&gt;<i> (AsymmetricAlgorithm, DSA, RSA) requires XmlDocument. And still the problem
</I>&gt;<i> didn't show up until I tried a &quot;make clean&quot; (else it would just use the one
</I>&gt;<i> present in System.Xml.Dll). These classes have been excluded from the build
</I>&gt;<i> process (probably just because of this) but I wasn't aware of it. So this is
</I>&gt;<i> the reason for the class library is compiling just fine.
</I>
corlib needs to be self-contained: you can't use types from any other
assembly in it, so you need to remove the use of XmlDocument from the
crypto classes.
You have two choices for the substitute code:
1) write a small xml parser that handles just the stuff you need
in corlib
2) (better, IMHO) write an internalcall that uses the GMarkup parser
in glib and fills in the RSA and DSA structures.

To do 2), you need to declare in the runtime header files two structures
that match the C# implementation of DSAParameters and RSAParameters.

typedef struct {
	MonoArray *P;
	MonoArray *Q;
	MonoArray *D;
	MonoArray *DP;
	MonoArray *DQ;
	MonoArray *InverseQ;
	MonoArray *Modulus;
	MonoArray *Exponent;
} MonoRSAParameters;

Then you write the two internalcalls as:

	static extern bool GetRSA (string xml, out RSAParameters rsap);
and
	static extern bool GetDSA (string xml, out DSAParameters rsap);

The C functions will look like:

MonoBoolean
CryptoGetRSA (MonoString *xml, MonoRSAParameters *rsap)
{
	GMarkupParseContext *context;
	char *p = mono_string_to_utf8 (xml);
	
	context = ...create markup context...;
	...parse and set the fields in rsap...
	g_free (p);
	if (parse_success)
		return TRUE;
	return FALSE;
}

mono/docs/internal-calls has some more info on registering the internal
call to the runtime.

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009116.html">[Mono-list] Crypto Unit tests on linux
</A></li>
	<LI> Next message: <A HREF="009057.html">[Mono-list] Crypto Unit tests on linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9070">[ date ]</a>
              <a href="thread.html#9070">[ thread ]</a>
              <a href="subject.html#9070">[ subject ]</a>
              <a href="author.html#9070">[ author ]</a>
         </LI>
       </UL>
</body></html>
