<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] System.Xml bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:piersh%40friskit.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="009277.html">
   <LINK REL="Next"  HREF="009290.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] System.Xml bug
   </H1>
    <B>Piers Haken
    </B> 
    <A HREF="mailto:piersh%40friskit.com"
       TITLE="[Mono-list] System.Xml bug">piersh@friskit.com
       </A><BR>
    <I>Sat, 26 Oct 2002 15:39:24 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="009277.html">[Mono-list] System.Xml bug
</A></li>
        <LI> Next message: <A HREF="009290.html">[Mono-list] CVS code automake fails on RedHat 8.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9278">[ date ]</a>
              <a href="thread.html#9278">[ thread ]</a>
              <a href="subject.html#9278">[ subject ]</a>
              <a href="author.html#9278">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------_=_NextPart_001_01C27D40.88ED74FC
Content-Type: text/plain;
	charset=&quot;US-ASCII&quot;
Content-Transfer-Encoding: quoted-printable

It looks like XmlDocumentNavigator wasn't handling the xml declaration
node correctly. I have checked the following simple patch into cvs:

Index: XmlDocumentNavigator.cs
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file:
/cvs/public/mcs/class/System.XML/System.Xml/XmlDocumentNavigator.cs,v
retrieving revision 1.4
diff -u -r1.4 XmlDocumentNavigator.cs
--- XmlDocumentNavigator.cs	13 Sep 2002 02:15:40 -0000	1.4
+++ XmlDocumentNavigator.cs	26 Oct 2002 22:25:28 -0000
@@ -123,7 +123,7 @@
 				case XmlNodeType.ProcessingInstruction:
 					return
XPathNodeType.ProcessingInstruction;
 				}
-				throw new InvalidOperationException ();
+				return (XPathNodeType) (-1);
 			}
 		}
=20

Piers.

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Jaroslaw Kowalski [mailto:<A HREF="mailto:jarek@atm.com.pl">jarek@atm.com.pl</A>]=20
</I>&gt;<i> Sent: Saturday, October 26, 2002 2:11 PM
</I>&gt;<i> To: <A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>
</I>&gt;<i> Subject: [Mono-list] System.Xml bug
</I>&gt;<i>=20
</I>&gt;<i>=20
</I>&gt;<i> Hi all!
</I>&gt;<i>=20
</I>&gt;<i> Looks like there's been some regression in System.Xml=20
</I>&gt;<i> classes: Consider the (kind of trivial) code in xmlbug.cs=20
</I>&gt;<i> (attached) and test.xml (also attached)
</I>&gt;<i>=20
</I>&gt;<i> On .NET it runs ok. On Mono, it produces:
</I>&gt;<i> =3D=3D=3D=3D=3D=3D=3D=3D
</I>&gt;<i> Unhandled Exception: System.InvalidOperationException: The=20
</I>&gt;<i> requested operation cannot be performed in &lt;0x000b1&gt; 00=20
</I>&gt;<i> System.Xml.XmlDocumentNavigator:get_NodeType () in &lt;0x00020&gt;=20
</I>&gt;<i> 00 System.Xml.XPath.NodeNameTest:Match
</I>&gt;<i> (System.Xml.Xsl.XsltContext,System.Xml.XPath.XPathNavigator)
</I>&gt;<i> in &lt;0x00034&gt; 00 System.Xml.XPath.AxisIterator:MoveNext ()
</I>&gt;<i> in &lt;0x0001a&gt; 00 System.Xml.XPath.SlashIterator:MoveNext ()
</I>&gt;<i> in &lt;0x0010e&gt; 00 System.Xml.XmlNode:SelectNodes
</I>&gt;<i> (string,System.Xml.XmlNamespaceManager)
</I>&gt;<i> in &lt;0x0006d&gt; 00 .Bug1:Main (string[])
</I>&gt;<i> =3D=3D=3D=3D=3D=3D=3D=3D
</I>&gt;<i>=20
</I>&gt;<i> I found that the problem is related to innocent '&lt;?xml=20
</I>&gt;<i> version=3D&quot;1.0&quot; ?&gt;' at the top of 'test.xml'. If I remove it,=20
</I>&gt;<i> everything is OK. I'm 100% sure that it used to work properly=20
</I>&gt;<i> on mono but is broken for some time now.
</I>&gt;<i>=20
</I>&gt;<i> Regards,
</I>&gt;<i>=20
</I>&gt;<i> Jarek
</I>&gt;<i>=20
</I>
------_=_NextPart_001_01C27D40.88ED74FC
Content-Type: text/html;
	charset=&quot;US-ASCII&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Dus-ascii&quot;&gt;
&lt;META NAME=3D&quot;Generator&quot; CONTENT=3D&quot;MS Exchange Server version =
6.0.4417.0&quot;&gt;
&lt;TITLE&gt;RE: [Mono-list] System.Xml bug&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;!-- Converted from text/plain format --&gt;

&lt;P&gt;&lt;FONT SIZE=3D2&gt;It looks like XmlDocumentNavigator wasn't handling the =
xml declaration node correctly. I have checked the following simple =
patch into cvs:&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2&gt;Index: XmlDocumentNavigator.cs&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT =
SIZE=3D2&gt;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;RCS file: =
/cvs/public/mcs/class/System.XML/System.Xml/XmlDocumentNavigator.cs,v&lt;/FO=
NT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;retrieving revision 1.4&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;diff -u -r1.4 XmlDocumentNavigator.cs&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;--- XmlDocumentNavigator.cs&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
13 Sep 2002 02:15:40 -0000&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 1.4&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;+++ XmlDocumentNavigator.cs&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
26 Oct 2002 22:25:28 -0000&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;@@ -123,7 +123,7 @@&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; case =
XmlNodeType.ProcessingInstruction:&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return =
XPathNodeType.ProcessingInstruction;&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; throw new =
InvalidOperationException ();&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return (XPathNodeType) =
(-1);&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;nbsp;&lt;/FONT&gt;
&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2&gt;Piers.&lt;/FONT&gt;
&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; -----Original Message-----&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; From: Jaroslaw Kowalski [&lt;A =
HREF=3D&quot;mailto:<A HREF="mailto:jarek@atm.com.pl">jarek@atm.com.pl</A>&quot;&gt;mailto:<A HREF="mailto:jarek@atm.com.pl">jarek@atm.com.pl</A>&lt;/A&gt;] &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; Sent: Saturday, October 26, 2002 2:11 PM&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; To: <A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; Subject: [Mono-list] System.Xml bug&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; Hi all!&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; Looks like there's been some regression in =
System.Xml &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; classes: Consider the (kind of trivial) code in =
xmlbug.cs &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; (attached) and test.xml (also attached)&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; On .NET it runs ok. On Mono, it produces:&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; =3D=3D=3D=3D=3D=3D=3D=3D&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; Unhandled Exception: =
System.InvalidOperationException: The &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; requested operation cannot be performed in =
&amp;lt;0x000b1&amp;gt; 00 &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; System.Xml.XmlDocumentNavigator:get_NodeType () =
in &amp;lt;0x00020&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; 00 System.Xml.XPath.NodeNameTest:Match&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; =
(System.Xml.Xsl.XsltContext,System.Xml.XPath.XPathNavigator)&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; in &amp;lt;0x00034&amp;gt; 00 =
System.Xml.XPath.AxisIterator:MoveNext ()&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; in &amp;lt;0x0001a&amp;gt; 00 =
System.Xml.XPath.SlashIterator:MoveNext ()&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; in &amp;lt;0x0010e&amp;gt; 00 =
System.Xml.XmlNode:SelectNodes&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; (string,System.Xml.XmlNamespaceManager)&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; in &amp;lt;0x0006d&amp;gt; 00 .Bug1:Main =
(string[])&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; =3D=3D=3D=3D=3D=3D=3D=3D&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; I found that the problem is related to innocent =
'&amp;lt;?xml &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; version=3D&amp;quot;1.0&amp;quot; ?&amp;gt;' at the top of =
'test.xml'. If I remove it, &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; everything is OK. I'm 100% sure that it used to =
work properly &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; on mono but is broken for some time now.&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; Regards,&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; Jarek&lt;/FONT&gt;

&lt;BR&gt;&lt;FONT SIZE=3D2&gt;&amp;gt; &lt;/FONT&gt;
&lt;/P&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
------_=_NextPart_001_01C27D40.88ED74FC--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009277.html">[Mono-list] System.Xml bug
</A></li>
	<LI> Next message: <A HREF="009290.html">[Mono-list] CVS code automake fails on RedHat 8.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9278">[ date ]</a>
              <a href="thread.html#9278">[ thread ]</a>
              <a href="subject.html#9278">[ subject ]</a>
              <a href="author.html#9278">[ author ]</a>
         </LI>
       </UL>
</body></html>
