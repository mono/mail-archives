<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Quick trampoline explanation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Neale.Ferguson%40SoftwareAG-USA.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="009144.html">
   <LINK REL="Next"  HREF="009159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Quick trampoline explanation
   </H1>
    <B>Ferguson, Neale
    </B> 
    <A HREF="mailto:Neale.Ferguson%40SoftwareAG-USA.com"
       TITLE="[Mono-list] Quick trampoline explanation">Neale.Ferguson@SoftwareAG-USA.com
       </A><BR>
    <I>Fri, 18 Oct 2002 12:38:48 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="009144.html">[Mono-list] Test for SqlMoney
</A></li>
        <LI> Next message: <A HREF="009159.html">[Mono-list] patents on ISO/ECMA C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9152">[ date ]</a>
              <a href="thread.html#9152">[ thread ]</a>
              <a href="subject.html#9152">[ subject ]</a>
              <a href="author.html#9152">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C276C4.D5A23440
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;

In the x86 mono_create_method_pointer routine there is the following section
of code:
 
        /*
         * Handle the return value storage area.
         */
        x86_lea_membase (p, X86_EAX, X86_EBP, stackval_pos);
        x86_mov_membase_reg (p, X86_EBP, (MINV_POS + G_STRUCT_OFFSET
(MonoInvocation, retval)), X86_EAX, 4);
        if (sig-&gt;ret-&gt;type == MONO_TYPE_VALUETYPE &amp;&amp; !sig-&gt;ret-&gt;byref) {
                MonoClass *klass  = sig-&gt;ret-&gt;data.klass;
                if (!klass-&gt;enumtype) {
                        x86_mov_reg_membase (p, X86_ECX, X86_EBP, 8, 4);
                        x86_mov_membase_reg (p, X86_EBP, stackval_pos,
X86_ECX, 4);
                }
        }

To my undestanding this does:
- Get the address of the return value and set this in the Monoinvocation
structure
- if we are returning a structure (not by reference) and the structure isn't
a simple type then ?? [this is what I need an explanation of]

Neale Ferguson 



------_=_NextPart_001_01C276C4.D5A23440
Content-Type: text/html;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Diso-8859-1&quot;&gt;


&lt;META content=3D&quot;MSHTML 6.00.2713.1100&quot; name=3DGENERATOR&gt;&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;DIV&gt;&lt;SPAN class=3D269093717-18102002&gt;&lt;FONT face=3DArial size=3D2&gt;In =
the x86 &lt;FONT=20
face=3D&quot;Courier New&quot; color=3D#800000&gt;mono_create_method_pointer&lt;/FONT&gt; =
routine there=20
is the following section of code:&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D269093717-18102002&gt;&lt;FONT face=3DArial=20
size=3D2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D269093717-18102002&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
/*&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; * Handle the =
return value=20
storage area.&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
*/&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; x86_lea_membase (p, =
X86_EAX,=20
X86_EBP, stackval_pos);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
x86_mov_membase_reg (p, X86_EBP, (MINV_POS + G_STRUCT_OFFSET =
(MonoInvocation,=20
retval)), X86_EAX, 4);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if =

(sig-&amp;gt;ret-&amp;gt;type =3D=3D MONO_TYPE_VALUETYPE &amp;amp;&amp;amp; =
!sig-&amp;gt;ret-&amp;gt;byref)=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
MonoClass *klass&amp;nbsp; =3D=20
sig-&amp;gt;ret-&amp;gt;data.klass;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp=
;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
if (!klass-&amp;gt;enumtype)=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =

&lt;FONT color=3D#0000ff&gt;x86_mov_reg_membase (p, X86_ECX, X86_EBP, 8,=20
4);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp=
;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp=
;=20
x86_mov_membase_reg (p, X86_EBP, stackval_pos, X86_ECX,=20
4);&lt;BR&gt;&lt;/FONT&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs=
p;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
}&lt;BR&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D269093717-18102002&gt;&lt;FONT face=3DArial size=3D2&gt;To my =
undestanding=20
this does:&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D269093717-18102002&gt;&lt;FONT face=3DArial size=3D2&gt;- Get =
the address of=20
the return value and set this in the Monoinvocation=20
structure&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D269093717-18102002&gt;&lt;FONT face=3DArial size=3D2&gt;- if =
we are=20
returning a structure (not by reference) and the structure isn't a =
simple type=20
then &lt;FONT color=3D#0000ff&gt;??&lt;/FONT&gt; [this is what I need an =
explanation=20
of]&lt;/DIV&gt;&lt;/FONT&gt;&lt;/SPAN&gt;
&lt;P&gt;&lt;FONT face=3D&quot;Monotype Corsiva&quot;&gt;Neale Ferguson&lt;/FONT&gt; =
&lt;BR&gt;&lt;/P&gt;&lt;/BODY&gt;&lt;/HTML&gt;

------_=_NextPart_001_01C276C4.D5A23440--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009144.html">[Mono-list] Test for SqlMoney
</A></li>
	<LI> Next message: <A HREF="009159.html">[Mono-list] patents on ISO/ECMA C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9152">[ date ]</a>
              <a href="thread.html#9152">[ thread ]</a>
              <a href="subject.html#9152">[ subject ]</a>
              <a href="author.html#9152">[ author ]</a>
         </LI>
       </UL>
</body></html>
