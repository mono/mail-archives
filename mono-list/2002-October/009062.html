<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Possible P/Invoke bug found in ODBC.NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:brianlritchie%40hotmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="009069.html">
   <LINK REL="Next"  HREF="009110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Possible P/Invoke bug found in ODBC.NET
   </H1>
    <B>Brian Ritchie
    </B> 
    <A HREF="mailto:brianlritchie%40hotmail.com"
       TITLE="[Mono-list] Possible P/Invoke bug found in ODBC.NET">brianlritchie@hotmail.com
       </A><BR>
    <I>Wed, 16 Oct 2002 00:11:54 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="009069.html">[Mono-list] Downloaded Source files are not in zip format
</A></li>
        <LI> Next message: <A HREF="009110.html">[Mono-list] Possible P/Invoke bug found in ODBC.NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9062">[ date ]</a>
              <a href="thread.html#9062">[ thread ]</a>
              <a href="subject.html#9062">[ subject ]</a>
              <a href="author.html#9062">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've run across what looks to be a bug with P/Invoke in mono...

In the ODBC.NET provider, I've declared a reference to an external dll as 
follows...

[DllImport(&quot;odbc32.dll&quot;)]
public static extern OdbcReturn SQLDescribeCol(IntPtr StatementHandle, 
ushort ColumnNumber, byte[] ColumnName, short BufferLength, ref short 
NameLength, ref OdbcType DataType, ref short ColumnSize, ref short 
DecimalDigits, ref short Nullable);

The OdbcType is an enumeration declared as:

public enum OdbcType : short
{
    BigInt=-5,
    Binary=-2,
    ...
}

This call works fine under ms.net...and the DataType parameter is returned 
correctly.  However, when run through mono on windows...it return 0.  It 
looks like mono isn't using the declared type of the enumeration: short.

I modified the code as follows...and it works in mono and ms.net...

[DllImport(&quot;odbc32.dll&quot;)]
public static extern OdbcReturn SQLDescribeCol(IntPtr StatementHandle, 
ushort ColumnNumber, byte[] ColumnName, short BufferLength, ref short 
NameLength, ref short DataType, ref short ColumnSize, ref short 
DecimalDigits, ref short Nullable);

Could someone on the runtime side take a look at this?

Thanks,
Brian

BTW...

I've checked in the alternate Dllimport declaration for the ODBC.NET 
provider so it will work in Mono.
Daniel, this should fix the problem you report to me today.






_________________________________________________________________
Protect your PC - get McAfee.com VirusScan Online 
<A HREF="http://clinic.mcafee.com/clinic/ibuy/campaign.asp?cid=3963">http://clinic.mcafee.com/clinic/ibuy/campaign.asp?cid=3963</A>



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="009069.html">[Mono-list] Downloaded Source files are not in zip format
</A></li>
	<LI> Next message: <A HREF="009110.html">[Mono-list] Possible P/Invoke bug found in ODBC.NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9062">[ date ]</a>
              <a href="thread.html#9062">[ thread ]</a>
              <a href="subject.html#9062">[ subject ]</a>
              <a href="author.html#9062">[ author ]</a>
         </LI>
       </UL>
</body></html>
