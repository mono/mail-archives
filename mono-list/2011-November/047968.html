<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono heapshot profiler woes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20heapshot%20profiler%20woes&In-Reply-To=CAEGCbuJA4qfUzsnU-%3DyH%2BuLUzA_xkf64Ypq-uvwpJWhgkLrK3Q%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="047966.html">
   <LINK REL="Next"  HREF="047970.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono heapshot profiler woes</H1>
    <B>Alan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono%20heapshot%20profiler%20woes&In-Reply-To=CAEGCbuJA4qfUzsnU-%3DyH%2BuLUzA_xkf64Ypq-uvwpJWhgkLrK3Q%40mail.gmail.com"
       TITLE="[Mono-list] Mono heapshot profiler woes">alan.mcgovern at gmail.com
       </A><BR>
    <I>Mon Nov  7 05:45:12 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="047966.html">[Mono-list] Mono heapshot profiler woes
</A></li>
        <LI>Next message: <A HREF="047970.html">[Mono-list] Using mono aot / aot-full compilation: nothing appears	to happen?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47968">[ date ]</a>
              <a href="thread.html#47968">[ thread ]</a>
              <a href="subject.html#47968">[ subject ]</a>
              <a href="author.html#47968">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Running with sgen disabled will result in a completely useless log file.
The boehm GC does not have the required hooks implemented to actually track
allocations in the log profiler. The simplest testcase would be for you to
provide the source code (confidentially if required) for your app or to
provide a binary which can be used to diagnose the issue. A crash as
reliable as you describe should be relatively easy to diagnose once we have
a way to reproduce it.

Alan

On 6 November 2011 23:20, Nicholas Frechette &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">zeno490 at gmail.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i> I just tried without sgen. There is no crash, a log is generated and
</I>&gt;<i> there seems to be data inside but heapshot fails to interpret the data
</I>&gt;<i> afterwards. It shows 1 object for every snapshot...
</I>&gt;<i>
</I>&gt;<i> I'm not sure if I can manage to create a test case for this. I have a
</I>&gt;<i> fairly simple gtk# application, nothing fancy: no interop besides
</I>&gt;<i> gtk#, no heavy usage of the GC, mostly simple C# code.
</I>&gt;<i>
</I>&gt;<i> I'll see what I can do next weekend.
</I>&gt;<i>
</I>&gt;<i> On Sun, Nov 6, 2011 at 10:50 AM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">kumpera at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; This sucks, I did hope 2.10.6 would fix it.
</I>&gt;<i> &gt; Can you provide a test case for this crash? This way it's a lot easier to
</I>&gt;<i> &gt; diagnose and fix it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Sat, Nov 5, 2011 at 5:26 PM, Nicholas Frechette &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">zeno490 at gmail.com</A>&gt;
</I>&gt;<i> &gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I upgraded to mono 2.10.6, the latest official stable release. I still
</I>&gt;<i> &gt;&gt; get a similar result, see below.
</I>&gt;<i> &gt;&gt; Are there extra dependencies required for it to work?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; [mono-2.10] ~/projects/rovisualizer-dev/rovisualizer/bin/Debug @ mono
</I>&gt;<i> &gt;&gt; --version
</I>&gt;<i> &gt;&gt; Mono JIT compiler version 2.10.6 (tarball Sat Nov  5 14:41:55 EDT 2011)
</I>&gt;<i> &gt;&gt; Copyright (C) 2002-2011 Novell, Inc, Xamarin, Inc and Contributors.
</I>&gt;<i> &gt;&gt; www.mono-project.com
</I>&gt;<i> &gt;&gt;        TLS:           __thread
</I>&gt;<i> &gt;&gt;        SIGSEGV:       altstack
</I>&gt;<i> &gt;&gt;        Notifications: epoll
</I>&gt;<i> &gt;&gt;        Architecture:  x86
</I>&gt;<i> &gt;&gt;        Disabled:      none
</I>&gt;<i> &gt;&gt;        Misc:          softdebug
</I>&gt;<i> &gt;&gt;        LLVM:          supported, not enabled.
</I>&gt;<i> &gt;&gt;        GC:            Included Boehm (with typed GC and Parallel Mark)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; [mono-2.10] ~/projects/rovisualizer-dev/rovisualizer/bin/Debug @
</I>&gt;<i> &gt;&gt; ./profile.sh
</I>&gt;<i> &gt;&gt; Stacktrace:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Native stacktrace:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x80e391b]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x8129e8b]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x805d431]
</I>&gt;<i> &gt;&gt;        [0x9c740c]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x8189ea7]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_object_new_alloc_specific+0x28) [0x81676b8]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_object_new_specific+0x80) [0x81677b0]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_exception_from_name_domain+0x3e) [0x8205ede]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_exception_from_name+0x28) [0x8205f78]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_get_exception_null_reference+0x23) [0x8206213]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x80e4733]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x8128866]
</I>&gt;<i> &gt;&gt;        [0x128fce]
</I>&gt;<i> &gt;&gt;        [0x15242c]
</I>&gt;<i> &gt;&gt;        [0x1522bc]
</I>&gt;<i> &gt;&gt;        [0x151768]
</I>&gt;<i> &gt;&gt;        [0x155eb8]
</I>&gt;<i> &gt;&gt;        [0x154f3c]
</I>&gt;<i> &gt;&gt;        [0x1522dc]
</I>&gt;<i> &gt;&gt;        [0x151768]
</I>&gt;<i> &gt;&gt;        [0x151848]
</I>&gt;<i> &gt;&gt;        [0x1512fc]
</I>&gt;<i> &gt;&gt;        [0x151150]
</I>&gt;<i> &gt;&gt;        [0x14f0a8]
</I>&gt;<i> &gt;&gt;        [0x14ebd0]
</I>&gt;<i> &gt;&gt;        [0x1a10e4]
</I>&gt;<i> &gt;&gt;        [0x159ca4]
</I>&gt;<i> &gt;&gt;        [0x14a36c]
</I>&gt;<i> &gt;&gt;        [0xf50244]
</I>&gt;<i> &gt;&gt;        [0x1415bc]
</I>&gt;<i> &gt;&gt;        [0x141270]
</I>&gt;<i> &gt;&gt;        [0x128d6c]
</I>&gt;<i> &gt;&gt;        [0x128f1e]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x80621c8]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_runtime_invoke+0x3e) [0x81671ee]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_runtime_exec_main+0xd8) [0x8169a28]
</I>&gt;<i> &gt;&gt;        mono-sgen(mono_main+0x1878) [0x80bcdb8]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x805707e]
</I>&gt;<i> &gt;&gt;        /lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xe7) [0x3ade37]
</I>&gt;<i> &gt;&gt;        mono-sgen() [0x8056ed1]
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Debug info from gdb:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Could not attach to process.  If your uid matches the uid of the target
</I>&gt;<i> &gt;&gt; process, check the setting of /proc/sys/kernel/yama/ptrace_scope, or try
</I>&gt;<i> &gt;&gt; again as the root user.  For more details, see
</I>&gt;<i> &gt;&gt; /etc/sysctl.d/10-ptrace.conf
</I>&gt;<i> &gt;&gt; ptrace: Operation not permitted.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; =================================================================
</I>&gt;<i> &gt;&gt; Got a SIGSEGV while executing native code. This usually indicates
</I>&gt;<i> &gt;&gt; a fatal error in the mono runtime or one of the native libraries
</I>&gt;<i> &gt;&gt; used by your application.
</I>&gt;<i> &gt;&gt; =================================================================
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ./profile.sh: line 1: 25637 Aborted                 mono --gc=sgen
</I>&gt;<i> &gt;&gt; --profile=log:heapshot rovisualizer.exe
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Mon, Oct 31, 2011 at 10:34 AM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">kumpera at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt; Please try a more current version of mono such as 2.10.7, there have
</I>&gt;<i> &gt;&gt; &gt; been
</I>&gt;<i> &gt;&gt; &gt; sgen related fixes since 2.10.2.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; On Mon, Oct 31, 2011 at 12:25 PM, Nicholas Frechette &lt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">zeno490 at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt; wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Hi,
</I>&gt;<i> &gt;&gt; &gt;&gt; I'm attempting to track down a memory leak in my application.
</I>&gt;<i> &gt;&gt; &gt;&gt; I managed to run heapshot a number of times as described in the wiki
</I>&gt;<i> &gt;&gt; &gt;&gt; page but unfortunately, now my application fails to start every time
</I>&gt;<i> &gt;&gt; &gt;&gt; with the profiler enabled.
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Running a debug build on ubuntu 11.04 + mono 2.10.2 produces:
</I>&gt;<i> &gt;&gt; &gt;&gt; [mono-2.10] ~/projects/rovisualizer-dev/rovisualizer/bin/Debug @ mono
</I>&gt;<i> &gt;&gt; &gt;&gt; --gc=sgen --profile=log:heapshot rovisualizer.exe
</I>&gt;<i> &gt;&gt; &gt;&gt; Stacktrace:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Native stacktrace:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x80e30eb]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x81293ab]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x805d3c1]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x54840c]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x8188d47]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_object_new_alloc_specific+0x28) [0x8166bd8]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_object_new_specific+0x80) [0x8166cd0]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_exception_from_name_domain+0x3e) [0x8204dbe]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_exception_from_name+0x28) [0x8204e58]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_get_exception_null_reference+0x23) [0x82050f3]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x80e3f03]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x8127d86]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x8fafc6]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda520c]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda49fe]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda3f2a]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda911e]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda774c]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda4a1e]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda3f2a]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda400a]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda3c74]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda3ac8]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda18aa]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xda1588]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x3820e4]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xdadd26]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0xd9e36c]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x37d13c]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x36858c]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x368222]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x8fad6e]
</I>&gt;<i> &gt;&gt; &gt;&gt;        [0x8faf1c]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x8062158]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_runtime_invoke+0x3e) [0x816670e]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_runtime_exec_main+0xd8) [0x8168f48]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen(mono_main+0x1878) [0x80bc9d8]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x805707e]
</I>&gt;<i> &gt;&gt; &gt;&gt;        /lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xe7)
</I>&gt;<i> [0x126e37]
</I>&gt;<i> &gt;&gt; &gt;&gt;        mono-sgen() [0x8056ed1]
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Debug info from gdb:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Could not attach to process.  If your uid matches the uid of the
</I>&gt;<i> target
</I>&gt;<i> &gt;&gt; &gt;&gt; process, check the setting of /proc/sys/kernel/yama/ptrace_scope, or
</I>&gt;<i> &gt;&gt; &gt;&gt; try
</I>&gt;<i> &gt;&gt; &gt;&gt; again as the root user.  For more details, see
</I>&gt;<i> &gt;&gt; &gt;&gt; /etc/sysctl.d/10-ptrace.conf
</I>&gt;<i> &gt;&gt; &gt;&gt; ptrace: Operation not permitted.
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; =================================================================
</I>&gt;<i> &gt;&gt; &gt;&gt; Got a SIGSEGV while executing native code. This usually indicates
</I>&gt;<i> &gt;&gt; &gt;&gt; a fatal error in the mono runtime or one of the native libraries
</I>&gt;<i> &gt;&gt; &gt;&gt; used by your application.
</I>&gt;<i> &gt;&gt; &gt;&gt; =================================================================
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; Aborted
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; -------------------
</I>&gt;<i> &gt;&gt; &gt;&gt; Any ideas?
</I>&gt;<i> &gt;&gt; &gt;&gt; Thanks,
</I>&gt;<i> &gt;&gt; &gt;&gt; Nicholas
</I>&gt;<i> &gt;&gt; &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt;&gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt;&gt; &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20111107/94f0881c/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20111107/94f0881c/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="047966.html">[Mono-list] Mono heapshot profiler woes
</A></li>
	<LI>Next message: <A HREF="047970.html">[Mono-list] Using mono aot / aot-full compilation: nothing appears	to happen?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47968">[ date ]</a>
              <a href="thread.html#47968">[ thread ]</a>
              <a href="subject.html#47968">[ subject ]</a>
              <a href="author.html#47968">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
