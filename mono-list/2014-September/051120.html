<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mod-mono-server process busy 100% or 200% CPU
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20mod-mono-server%20process%20busy%20100%25%20or%20200%25%20CPU&In-Reply-To=%3C5407118A.20302%40yandex.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="051119.html">
   <LINK REL="Next"  HREF="051122.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mod-mono-server process busy 100% or 200% CPU</H1>
    <B>Maxim</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20mod-mono-server%20process%20busy%20100%25%20or%20200%25%20CPU&In-Reply-To=%3C5407118A.20302%40yandex.ru%3E"
       TITLE="[Mono-list] mod-mono-server process busy 100% or 200% CPU">makska at yandex.ru
       </A><BR>
    <I>Wed Sep  3 13:03:06 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="051119.html">[Mono-list] [Announcement] Winforms GUI Generator
</A></li>
        <LI>Next message: <A HREF="051122.html">[Mono-list] mod-mono-server process busy 100% or 200% CPU
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51120">[ date ]</a>
              <a href="thread.html#51120">[ thread ]</a>
              <a href="subject.html#51120">[ subject ]</a>
              <a href="author.html#51120">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello!

I've just created ASP.Net website and ran it on Apache&amp;mono on Linux.
And I've got strange situation. After 50.000-100.000 requests mod-mono-server 
process unexpectedly become busy with 100% or 200% (exactly) CPU load.
After restarting mono process via mono-ctl panel cpu consumption returns to 1-3%.
I've found some errors like
[Wed Sep 03 16:02:57 2014] [error] (32)Broken pipe: write_data failed
[Wed Sep 03 16:02:57 2014] [error] (32)Broken pipe: write_data failed
[Wed Sep 03 16:02:57 2014] [error] command failed: failed to get client block (data)
in apache error_log, but it seems like there are no relations in time between 
these errors and busy moment.

So, the questions:
1) are there any way to know what is happening in this situation? What threads 
are running, etc... I'm not sure the reason is in mono itself, may be the reason 
is in my application. Full profiling on production server is not possible, I 
mean just a few statistics,
2) if the reason is in garbage collector: are there any ways to tune it? Or to 
switch from sgen to old Boehm or so on?

Any help are highly appreciated!

P.S. Mono 3.2.8 compiled from sources on standard CentOS 6.5
# mono -V
Mono JIT compiler version 3.2.8 (tarball Wed Jun 11 00:48:42 MSK 2014)
Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. 
www.mono-project.com
     TLS:           __thread
     SIGSEGV:       altstack
     Notifications: epoll
     Architecture:  amd64
     Disabled:      none
     Misc:          softdebug
     LLVM:          supported, not enabled.
     GC:            sgen

# httpd -v
Server version: Apache/2.2.15 (Unix)
Server built:   Apr  3 2014 23:56:16

# uname -a
Linux web1.server 2.6.32-431.17.1.el6.x86_64 #1 SMP Wed May 7 23:32:49 UTC 2014 
x86_64 x86_64 x86_64 GNU/Linux


With best wishes,
Max Karavaev
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="051119.html">[Mono-list] [Announcement] Winforms GUI Generator
</A></li>
	<LI>Next message: <A HREF="051122.html">[Mono-list] mod-mono-server process busy 100% or 200% CPU
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#51120">[ date ]</a>
              <a href="thread.html#51120">[ thread ]</a>
              <a href="subject.html#51120">[ subject ]</a>
              <a href="author.html#51120">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
