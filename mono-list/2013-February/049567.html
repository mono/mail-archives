<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] crash in Mono runtime related to GdipDeleteGraphics
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20crash%20in%20Mono%20runtime%20related%20to%20GdipDeleteGraphics&In-Reply-To=%3C1361051397981-4658612.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049565.html">
   <LINK REL="Next"  HREF="049569.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] crash in Mono runtime related to GdipDeleteGraphics</H1>
    <B>jrjr</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20crash%20in%20Mono%20runtime%20related%20to%20GdipDeleteGraphics&In-Reply-To=%3C1361051397981-4658612.post%40n4.nabble.com%3E"
       TITLE="[Mono-list] crash in Mono runtime related to GdipDeleteGraphics">jresnick at gmail.com
       </A><BR>
    <I>Sat Feb 16 21:49:58 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="049565.html">[Mono-list] Updating my gmail source code
</A></li>
        <LI>Next message: <A HREF="049569.html">[Mono-list] crash in Mono runtime related to GdipDeleteGraphics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49567">[ date ]</a>
              <a href="thread.html#49567">[ thread ]</a>
              <a href="subject.html#49567">[ subject ]</a>
              <a href="author.html#49567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I am porting a program originally written for .net/windows to mono/linux.
The program is a long-running application that has been running solidly on
Windows for months, but on mono/linux it will not run for more than about 18
hours before it crashes with the stack trace below, or a similar (the stack
trace isn't always identical, but GdipDeleteGraphics always seems to be the
culprit).  I am running it on an ubuntu 12.10 VM, using Mono 2.10.8.1.

Any idea what might be causing the problem and/or how I might work around
it?


mono: /build/buildd/cairo-1.12.2/src/cairo-hash.c:506:
_cairo_hash_table_lookup_exact_key: Assertion `!&quot;reached&quot;' failed.
Stacktrace:

  at (wrapper managed-to-native) System.Drawing.GDIPlus.GdipDeleteGraphics
(intptr) &lt;0xffffffff&gt;
  at System.Drawing.Graphics.Dispose () &lt;0x00063&gt;
  at (wrapper remoting-invoke-with-check) System.Drawing.Graphics.Dispose ()
&lt;0xffffffff&gt;
  at System.Drawing.Bitmap..ctor (System.Drawing.Image,int,int) &lt;0x0005f&gt;
  at System.Drawing.Bitmap..ctor (System.Drawing.Image,System.Drawing.Size)
&lt;0x0001b&gt;
  at (wrapper remoting-invoke-with-check) System.Drawing.Bitmap..ctor
(System.Drawing.Image,System.Drawing.Size) &lt;0xffffffff&gt;
  at PhotoMontage.ImageUtils.Scale
(System.Drawing.Bitmap,System.Drawing.Size) &lt;0x00037&gt;
  at PhotoMontage.ImageFactory.ScaleBitmap
(System.Drawing.Bitmap,System.Drawing.Size) &lt;0x00063&gt;
  at PhotoMontage.ImageFactory/DefaultImage.Scale (System.Drawing.Size)
&lt;0x0002f&gt;
  at PhotoMontage.ImageTransform/Scale.ApplyCore (PhotoMontage.IImage)
&lt;0x0003b&gt;
  at PhotoMontage.ImageTransform.Apply (PhotoMontage.IImage) &lt;0x00014&gt;
  at PhotoMontage.Tile.Create
(PhotoMontage.IImage,System.Drawing.Size,PhotoMontage.ImageResizeMode)
&lt;0x0008b&gt;
  at FM.ImageSearchTileSet.MoveNext () &lt;0x0009f&gt;
  at PhotoMontage.MontageEngine.Run () &lt;0x00073&gt;
  at FM.Generator.Session.Execute () &lt;0x0010f&gt;
  at FM.Generator.Engine.&lt;OnTimer&gt;m__60 (object) &lt;0x00017&gt;
  at (wrapper runtime-invoke) &lt;Module&gt;.runtime_invoke_void__this___object
(object,intptr,intptr,intptr) &lt;0xffffffff&gt;

Native stacktrace:

	mono() [0x80e6431]
	[0xb772640c]
	[0xb7726424]
	/lib/i386-linux-gnu/libc.so.6(gsignal+0x4f) [0xb753e1df]
	/lib/i386-linux-gnu/libc.so.6(abort+0x175) [0xb7541825]
	/lib/i386-linux-gnu/libc.so.6(+0x27085) [0xb7537085]
	/lib/i386-linux-gnu/libc.so.6(+0x27137) [0xb7537137]
	/usr/lib/i386-linux-gnu/libcairo.so.2(+0x2c888) [0xb3a01888]
	/usr/lib/i386-linux-gnu/libcairo.so.2(+0x771c3) [0xb3a4c1c3]
	/usr/lib/i386-linux-gnu/libcairo.so.2(cairo_font_face_destroy+0x4f)
[0xb39fa3cf]
	/usr/lib/i386-linux-gnu/libcairo.so.2(+0x286ce) [0xb39fd6ce]
	/usr/lib/i386-linux-gnu/libcairo.so.2(+0x247da) [0xb39f97da]
	/usr/lib/i386-linux-gnu/libcairo.so.2(+0x24862) [0xb39f9862]
	/usr/lib/i386-linux-gnu/libcairo.so.2(cairo_destroy+0x39) [0xb39efa39]
	/usr/lib/libgdiplus.so(GdipDeleteGraphics+0x80) [0xb4998cb0]
	[0xb4d36fd0]
	[0xb4d36f54]
	[0xb4d36ec0]
	[0xb4d36458]
	[0xb4d363e4]
	[0xb4d363a0]
	[0xb4d36330]
	[0xb4d3a93c]
	[0xb4d3a890]
	[0xb4d3a854]
	[0xb4d3a7ed]
	[0xb4d3a2d4]
	[0xb4d4b6d8]
	[0xb2a8bdbc]
	[0xb2a8ba08]
	[0xb2a8b8c8]
	[0xb67fccad]
	mono() [0x8066dcc]

Debug info from gdb:

Could not attach to process.  If your uid matches the uid of the target
process, check the setting of /proc/sys/kernel/yama/ptrace_scope, or try
again as the root user.  For more details, see /etc/sysctl.d/10-ptrace.conf
ptrace: Operation not permitted.
No threads.

=================================================================
Got a SIGABRT while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries 
used by your application.
=================================================================

Aborted (core dumped)




--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/crash-in-Mono-runtime-related-to-GdipDeleteGraphics-tp4658612.html">http://mono.1490590.n4.nabble.com/crash-in-Mono-runtime-related-to-GdipDeleteGraphics-tp4658612.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049565.html">[Mono-list] Updating my gmail source code
</A></li>
	<LI>Next message: <A HREF="049569.html">[Mono-list] crash in Mono runtime related to GdipDeleteGraphics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49567">[ date ]</a>
              <a href="thread.html#49567">[ thread ]</a>
              <a href="subject.html#49567">[ subject ]</a>
              <a href="author.html#49567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
