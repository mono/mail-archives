<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Updating my gmail source code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Updating%20my%20gmail%20source%20code&In-Reply-To=%3C511F6D1C.9020407%40all-the-johnsons.co.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049576.html">
   <LINK REL="Next"  HREF="049565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Updating my gmail source code</H1>
    <B>Paul Johnson</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Updating%20my%20gmail%20source%20code&In-Reply-To=%3C511F6D1C.9020407%40all-the-johnsons.co.uk%3E"
       TITLE="[Mono-list] Updating my gmail source code">paul at all-the-johnsons.co.uk
       </A><BR>
    <I>Sat Feb 16 11:27:24 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="049576.html">[Mono-list] Sockets don't work
</A></li>
        <LI>Next message: <A HREF="049565.html">[Mono-list] Updating my gmail source code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49564">[ date ]</a>
              <a href="thread.html#49564">[ thread ]</a>
              <a href="subject.html#49564">[ subject ]</a>
              <a href="author.html#49564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have on my website a nice simple way to connect to gmail and pull down 
emails with it. It worked. However, I've had an email from someone who 
decided to implement it to say it no longer worked. URL is 
<A HREF="http://www.all-the-johnsons.co.uk/csharp/email.html">http://www.all-the-johnsons.co.uk/csharp/email.html</A>

Having looked over the code, it's down to the a TLSSecurity exception 
when trying to authenticate on the server. I've adjusted the code as 
follows, but I'm still getting the same error.

Code that failed

SslStream nstream;
		
public SslStream Connect(string username, string password)
{
    string message;
    string response;
    TcpClient tcpClient = new TcpClient();
    tcpClient.Connect(&quot;pop.gmail.com&quot;, 995);
    nstream = new SslStream(tcpClient.GetStream());
    nstream.AuthenticateAsClient(&quot;pop.gmail.com&quot;); // fails
    response = Response(nstream);

adjusted code

public static bool Validator (object sender, X509Certificate 
certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
{	
return true;
}

public SslStream Connect ()
{
string message = &quot;&quot;, response = &quot;&quot;;
ServicePointManager.ServerCertificateValidationCallback = Validator;
TcpClient tcpClient = new TcpClient ();
tcpClient.Connect (&quot;pop.gmail.com&quot;, 995);
SslStream nstream = new SslStream (tcpClient.GetStream ());
nstream.AuthenticateAsClient (&quot;pop.gmail.com&quot;); // fail still

Any ideas on what I'm doing wrong?

The exact error is
System.IO.IOException: The authentication or decryption has failed --&gt; 
Mono.Security.Protocol.Tls.TlsException: Invalid certificate received 
from the server

Paul

-- 
&quot;Space,&quot; it says, &quot;is big. Really big. You just won't believe how 
vastly, hugely, mindbogglingly big it is. I mean, you may think it's a 
long way down the road to the chemist's, but that's just peanuts to 
space, listen...&quot;
Hitch Hikers Guide to the Galaxy, a truly remarkable book!

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049576.html">[Mono-list] Sockets don't work
</A></li>
	<LI>Next message: <A HREF="049565.html">[Mono-list] Updating my gmail source code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49564">[ date ]</a>
              <a href="thread.html#49564">[ thread ]</a>
              <a href="subject.html#49564">[ subject ]</a>
              <a href="author.html#49564">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
