<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Question on Unmanaged code Invocation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Question%20on%20Unmanaged%20code%20Invocation&In-Reply-To=20051015035017.48170.qmail%40web51007.mail.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029022.html">
   <LINK REL="Next"  HREF="029039.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Question on Unmanaged code Invocation</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Question%20on%20Unmanaged%20code%20Invocation&In-Reply-To=20051015035017.48170.qmail%40web51007.mail.yahoo.com"
       TITLE="[Mono-list] Question on Unmanaged code Invocation">jonpryor at vt.edu
       </A><BR>
    <I>Sat Oct 15 19:47:38 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="029022.html">[Mono-list] Question on Unmanaged code Invocation
</A></li>
        <LI>Next message: <A HREF="029039.html">[Mono-list] Method signature modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29032">[ date ]</a>
              <a href="thread.html#29032">[ thread ]</a>
              <a href="subject.html#29032">[ subject ]</a>
              <a href="author.html#29032">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2005-10-14 at 20:50 -0700, Shankari wrote:
&gt;<i> I have some questions in unmanaged call internals.
</I>&gt;<i> From what I understood, an unmanaged code is a
</I>&gt;<i> function call.
</I>
&lt;pedantic&gt;
Unmanaged code can be anything (including Perl code), and can be an
unmanaged *function*.  A function call would invoke the function.
&lt;/pedantic&gt;

&gt;<i> To figure out where exactly the switch from managed to
</I>&gt;<i> unmanaged code is happening, I set a breakpoint in my
</I>&gt;<i> C program and tried a backtrace from it. Here is the
</I>&gt;<i> info I got.
</I>&gt;<i> 
</I>&gt;<i> (gdb) backtrace
</I>&gt;<i> #0  printmsg () at cprog.c:13
</I>&gt;<i> #1  0x0045b6ac in ?? ()
</I>&gt;<i> #2  0x00000001 in ?? ()
</I>&gt;<i> #3  0x00e65710 in ?? ()
</I>&gt;<i> #4  0x00450ad7 in ?? ()
</I>&gt;<i> #5  0x093458e0 in ?? ()
</I>&gt;<i> #6  0x093458c8 in ?? ()
</I>&gt;<i> #7  0x09389398 in ?? ()
</I>&gt;<i> #8  0x0002be60 in ?? ()
</I>&gt;<i> #9  0x00000000 in ?? ()
</I>&gt;<i> (gdb) n
</I>&gt;<i> 0x0045b6ac in ?? ()
</I>&gt;<i> (gdb) 
</I>
Translation of all that: Mono created a new thread which contains JITed
code, so no debug symbols exist (that GDB knows about).

Consequently, you need the managed callstack, which you can get using
mono_print_method_from_ip, which takes a stack pointer as an argument,
e.g.:

	(gdb) p mono_print_method_from_ip (0x0045b6ac)

&gt;<i> I am not able to single step through the code from the
</I>&gt;<i> point where unmanaged code is ending.
</I>
That's because no source code exists for those functions, at least as
far as GDB is concerned.

&gt;<i> Since the backtrace addr are not resolved, it looks
</I>&gt;<i> like an unmanaged call is spawned in a new thread.
</I>
Correct.  Mono creates several threads during startup for myriad reasons
(such as for the garbage collector, finalizer thread, etc.).

 - Jon


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029022.html">[Mono-list] Question on Unmanaged code Invocation
</A></li>
	<LI>Next message: <A HREF="029039.html">[Mono-list] Method signature modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29032">[ date ]</a>
              <a href="thread.html#29032">[ thread ]</a>
              <a href="subject.html#29032">[ subject ]</a>
              <a href="author.html#29032">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
