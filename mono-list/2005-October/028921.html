<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] NOAA Soap Server and System.Web.Services problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20NOAA%20Soap%20Server%20and%20System.Web.Services%20problems&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028908.html">
   <LINK REL="Next"  HREF="028929.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] NOAA Soap Server and System.Web.Services problems</H1>
    <B>Jimmy</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20NOAA%20Soap%20Server%20and%20System.Web.Services%20problems&In-Reply-To="
       TITLE="[Mono-list] NOAA Soap Server and System.Web.Services problems">jkernel1234 at bellsouth.net
       </A><BR>
    <I>Fri Oct  7 16:48:02 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="028908.html">[Mono-list] Process Address space map
</A></li>
        <LI>Next message: <A HREF="028929.html">[Mono-list] NOAA Soap Server and System.Web.Services problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28921">[ date ]</a>
              <a href="thread.html#28921">[ thread ]</a>
              <a href="subject.html#28921">[ subject ]</a>
              <a href="author.html#28921">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
	I use the NOAA Soap Web Service (<A HREF="http://www.weather.gov/xml/">http://www.weather.gov/xml/</A>) to access
weather data using the System.Web.Services class.  This has worked for a
while up until a couple of weeks ago.  A couple of weeks ago they
changed to using a proxy servers in front of the actual server.  Well,
this change causes the Soap client to timeout waiting for a response.  

You get this exception:

Unhandled Exception: System.Net.WebException: Error getting response
stream (Rea dDone2): ReceiveFailure ---&gt; System.Exception:
         at System.Net.WebConnection.HandleError ()
         at System.Net.WebConnection.ReadDone ()
         at System.MulticastDelegate.invoke_void_IAsyncResult ()
         at System.Net.Sockets.Socket+SocketAsyncResult.Complete ()
         at System.Net.Sockets.Socket+Worker.Receive ()
         at System.MulticastDelegate.invoke_void ()
in &lt;0x000ad&gt; System.Net.WebConnection:HandleError (WebExceptionStatus
st, System.Exception e, System.String where)--- End of inner exception
stack trace ---
in &lt;0x00158&gt; System.Net.HttpWebRequest:EndGetResponse (IAsyncResult
asyncResult)in &lt;0x00047&gt; System.Net.HttpWebRequest:GetResponse ()
in &lt;0x0004d&gt;
System.Web.Services.Protocols.WebClientProtocol:GetWebResponse (Sys
tem.Net.WebRequest request)

I was not sure where the problem was so I tested using the MS WebClient.
However, I get a different result : Http Protocol Violation exception.  

I did some packet captures, and I noticed something odd.  It seems that
the NOAA soap server is packaging up the soap response within another
chunked HTTP response.  Is this an allowed HTTP response?  Maybe this is
why the MS client throws an HTTP Protocol Violation exception? 

I did some debugging in /mcs/class/System/System.Net/WebConnection.cs to
see what I can find, and I noticed that the code does not handle the
case where an HTTP header is contained within a chunked response.
Therefore, it never gets past the Transfer-Encoding: chunked line.  Then
it just continually loops until the response times out.   

I have enclosed a partial text output of my NOAA Soap client-&gt;server
request (taken from an Ethereal capture) for reference: 

System.Web.Services request:

POST /forecasts/xml/SOAP_server/ndfdXMLserver.php HTTP/1.1
User-Agent: Mono Web Services Client Protocol 1.1.4322.573
SOAPAction:
&quot;<A HREF="http://www.weather.gov/forecasts/xml/DWMLgen/wsdl/ndfdXML.wsdl#NDFDgenByDay&quot;">http://www.weather.gov/forecasts/xml/DWMLgen/wsdl/ndfdXML.wsdl#NDFDgenByDay&quot;</A>
Content-Type: text/xml; charset=utf-8
Content-Length: 671
Expect: 100-continue
Connection: keep-alive
Host: www.weather.gov

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soap:Envelope
xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</A>
xmlns:xsd=&quot;<A HREF="http://www.w3.org/2001/XMLSchema&quot;">http://www.w3.org/2001/XMLSchema&quot;</A>
xmlns:soap=&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/&quot;">http://schemas.xmlsoap.org/soap/envelope/&quot;</A>&gt;&lt;soap:Body
soap:encodingStyle=&quot;<A HREF="http://schemas.xmlsoap.org/soap/encoding/&quot;">http://schemas.xmlsoap.org/soap/encoding/&quot;</A>&gt;&lt;q1:NDFDgenByDay xmlns:q1=&quot;<A HREF="http://www.weather.gov/forecasts/xml/DWMLgen/wsdl/ndfdXML.wsdl&quot;">http://www.weather.gov/forecasts/xml/DWMLgen/wsdl/ndfdXML.wsdl&quot;</A>&gt;&lt;latitude xsi:type=&quot;xsd:decimal&quot;&gt;34.026099&lt;/latitude&gt;&lt;longitude xsi:type=&quot;xsd:decimal&quot;&gt;-84.311677&lt;/longitude&gt;&lt;startDate xsi:type=&quot;xsd:date&quot;&gt;2005-10-07&lt;/startDate&gt;&lt;numDays xsi:type=&quot;xsd:integer&quot;&gt;7&lt;/numDays&gt;&lt;format xsi:type=&quot;xsd:string&quot;&gt;24 hourly&lt;/format&gt;&lt;/q1:NDFDgenByDay&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;

NOAA Soap Server Response:

HTTP/1.1 100 Continue
Via: 1.1 ics_server.xpc-mii.net (ICS 2.2.64.208)
Connection: keep-alive
Transfer-Encoding: chunked

5B4
HTTP/1.1 200 OK
Date: Fri, 07 Oct 2005 19:20:42 GMT
Accept-Ranges: bytes
X-Powered-By: PHP/4.3.2
X-Soap-Server: NuSOAP/0.6.8 (1.82)
Vary: Accept-Encoding,User-Agent
Cache-Control: max-age=900
Expires: Fri, 07 Oct 2005 19:35:42 GMT
Content-Type: text/xml;charset=ISO-8859-1
Server: Apache-Coyote/1.1
Connection: close

... The rest of the data is below in HTTP chunked format. . 

Any comments or questions are welcomed.

Thanks,
Jimmy


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028908.html">[Mono-list] Process Address space map
</A></li>
	<LI>Next message: <A HREF="028929.html">[Mono-list] NOAA Soap Server and System.Web.Services problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28921">[ date ]</a>
              <a href="thread.html#28921">[ thread ]</a>
              <a href="subject.html#28921">[ subject ]</a>
              <a href="author.html#28921">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
