<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] A big (MS created) flaw in DateTime that surfaces in Web Services
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Jazzynupe%40sbcglobal.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="014649.html">
   <LINK REL="Next"  HREF="014679.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] A big (MS created) flaw in DateTime that surfaces in Web Services
   </H1>
    <B>Richard Norman
    </B> 
    <A HREF="mailto:Jazzynupe%40sbcglobal.net"
       TITLE="[Mono-list] A big (MS created) flaw in DateTime that surfaces in Web Services">Jazzynupe@sbcglobal.net
       </A><BR>
    <I>Sat, 28 Jun 2003 01:38:56 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="014649.html">[Mono-list] CVS timeout
</A></li>
        <LI> Next message: <A HREF="014679.html">[Mono-list] A big (MS created) flaw in DateTime that surfaces in Web Services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14651">[ date ]</a>
              <a href="thread.html#14651">[ thread ]</a>
              <a href="subject.html#14651">[ subject ]</a>
              <a href="author.html#14651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_0003_01C33D16.0A5281A0
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

Now I may be wrong in this too, but isn't the offset used as a marker to
indicate the time zone?
=20
So the time shown is 2 hours behind the GMT... so if you are going from =
say
-2 to a -8 time zone, you would  take the destination time zone and =
subtract
the source and add those hours to the time ( take -8-(-2)=3D -8 + 2 =3D =
-6) take
away 6 hours from the time......
=20
So if I follow your example,
=20
 27/6/2003 14:00:00-6  sent to a time zone with +1 should become the
following...
=20
(+1)-(-6) becomes +1+6=3D7
=20
So you add 7 hours to the time which then becomes 27/6/2003 21:00:00+1
=20
So if that is correct, and that is how it is handled internally, then we
don't have a problem I believe
=20
However if you are saying that you want to send a datetime without =
changes
to another potentially different time zone, why not send it as another =
type
in transmission so it is not interpreted. That might be one way to do =
it...
Time information should be universal and the time one place should =
coincide
with the same moment in another place. Hence I believe it is not a true =
but
but a exercise in relativity... :-)
=20
Do you want the time it is there or the time it is here. if you want the
time there, then you must either send date time and create a thread with =
the
same time zone information, or send something like a string that is not
interpreted and convert once it is received.  If you want the instant, =
then
the conversion outlined above and previously is correct.
=20
Could someone check this out?  I don't have all the tools here at home =
to
test this.
=20
Richard Norman
Web/Application Developer
=20
*****************Original Messages**************************
=20

Message: 12

From: &quot;A Rafael D Teixeira&quot; &lt;<A HREF="mailto:rafaelteixeirabr@hotmail.com">rafaelteixeirabr@hotmail.com</A>&gt;

To: <A HREF="mailto:lluis@ideary.com">lluis@ideary.com</A>, <A HREF="mailto:mono-list@lists.ximian.com">mono-list@lists.ximian.com</A>

Subject: Re: [Mono-list] A big (MS created) flaw in DateTime that =
surfaces
in Web Services

Date: Fri, 27 Jun 2003 19:10:47 -0300

Hi Lluis,

&gt;<i>Hmm. Maybe I'm missing something, but I don't see the problem. For=20
</I>
&gt;<i>example, lets say that there is a server A in GMT+1 timezone thats=20
</I>
&gt;<i>makes a call to a server B in GMT-6 timezone. The call includes the=20
</I>
&gt;<i>date 27/6/2003 14:00:00. The XmlSerializer in server A will format this =
</I>

&gt;<i>date as 27/6/2003T14:00:00.0000000+01:00. The server B will deserialize =
</I>

&gt;<i>this date as 27/6/2003 07:00:00 (where 7 =3D 14 - (+1) + (-6)). If this =
</I>

&gt;<i>date goes back from
</I>
&gt;<i>server B to server A, server B will serialize
</I>
&gt;<i>27/6/2003T07:00:00.0000000-06:00, and server A will get again 27/6/2003
</I>
&gt;<i>14:00:00 (where 14 =3D 7 - (-6) + 1)
</I>
&gt;<i>
</I>
&gt;<i>BTW, this didn't work a couple of days ago, I just commited that fixes=20
</I>
&gt;<i>it.
</I>
You are missing the point:

Here is an example you can possibly test for yourself.

I have two DateTimes one containing 1998/10/16T00:00:00000 (a friday) =
and=20

the other 1998/10/19T00:00:00000 (a monday) both without time zone=20

information and both extracted from a database.

The server is in a time zone so that it decides to encode them as:

1998/10/16T00:00:00000-03:00 (normal period of the year) and

1998/10/19T00:00:00000-02:00 (because it crossed into a daylight savings =


period)

The problem is that the client is theoretically in the same time zone =
but it


ends parsing it back as follow:

1998/10/16T00:00:00000

1998/10/18T23:00:00000 (became sunday 11pm). THAT IS THE PROBLEM =
MANIFESTING


ITSELF.

Even if I'm wrong about both machines staying in the same time zone, I =
don't


want the information to change because in truth the server may be housed =
in=20

S=E3o Paulo, but this data has many sources around the globe (Tokyo and =
New=20

York, for example), and Dates and Times are already universalized in the =


database and are to be shown as stored not adjusted.

&gt;<i>
</I>
&gt;<i>In Remoting, there may be a problem, because DateTime is serialized as=20
</I>
&gt;<i>ticks, so don't include the UTC offset. When such a date is serialized=20
</I>
&gt;<i>in the destination sever there is no way to know the original timezone. =
</I>

&gt;<i>But you can always include the UTC offset as an extra parameter.
</I>
That is what I want: It MUST NOT be adjusted from the insuficient=20

information the infraestructure has.

=20

&gt;<i>Yes, that's another problem. I've partially removed some of this checks =
</I>

&gt;<i>to match MS.NET behavior, and it works better now. However you have to=20
</I>
&gt;<i>be careful to use for example DateTime.MinValue as a marker for null=20
</I>
&gt;<i>dates, because this value can change if the date is deserialized in a=20
</I>
&gt;<i>server that has a different timezone.
</I>
That is the problem again. Server and client location can't interfere in =


transmitting data. If I have a DateTime.MinValue at one end IT MUST =
STILL BE


A DateTime.MinValue at the other. What we are saying is that this =
channel is


not transparent, that is for me a BUG.

&gt;<i>
</I>
&gt;<i> &gt; For my application I will just avoid the issue by serializing the=20
</I>
&gt;<i> &gt; Ticks member of the DateTime, but this is a larger issue with=20
</I>
&gt;<i> &gt; broader implications.
</I>
&gt;<i>
</I>
&gt;<i>This does not solve the issue, unless you work always with the same=20
</I>
&gt;<i>timezone. Ticks are also relative to the time zone.
</I>
Yes, my database contains data from around the globe, but all of it is=20

normalized to a single reference location.

&gt;<i>I dont find necessary to extend or change DateTime to include UTC info. =
</I>

&gt;<i>It is enough to include it when a data is serialized. XmlSerializer=20
</I>
&gt;<i>already does it, BinaryFormatter does not.
</I>
I only want to have control of the process so that I can say, when =
needed,=20

that I want a datetime to pass transparently from one end to the other.

Best regards,

Rafael Teixeira

Brazilian Polymath

Mono Hacker since 16 Jul 2001


------=_NextPart_000_0003_01C33D16.0A5281A0
Content-Type: text/html;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Diso-8859-1&quot;&gt;
&lt;TITLE&gt;Message&lt;/TITLE&gt;

&lt;META content=3D&quot;MSHTML 6.00.2800.1170&quot; name=3DGENERATOR&gt;&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;Now I may be wrong in this too, =
but isn't=20
the offset used as a marker to indicate the time zone?&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;So the time shown is 2 hours =
behind the=20
GMT... so if you are going from say -2 to a -8 time zone, you =
would&amp;nbsp; take=20
the destination time zone and subtract the source and add those hours to =
the=20
time ( take -8-(-2)=3D -8 + 2 =3D -6) take away 6 hours from the=20
time......&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;So if I follow your =
example,&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&amp;nbsp;27/6/2003 14:00:00-6&amp;nbsp; =
sent to a=20
time zone with +1&amp;nbsp;should become&amp;nbsp;the following...&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;(+1)-(-6) becomes =
+1+6=3D7&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;So you add 7 hours to the time =
which then=20
becomes 27/6/2003 21:00:00+1&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;So if that is correct, and that is =
how it is=20
handled internally, then we don't have a problem I believe&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;However if you are saying that you =
want to=20
send a datetime without changes to another potentially different time =
zone, why=20
not send it as another type in transmission so it is not interpreted. =
That might=20
be one way to do it... Time information should be universal and the time =
one=20
place should coincide with the same moment in another place. Hence I =
believe it=20
is not a true but but a exercise in relativity... :-)&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;Do you want the time it is there =
or the time=20
it is here. if you want the time there, then you must either send date =
time and=20
create a thread with the same time zone information, or send something =
like a=20
string that is not interpreted and convert once it is received.&amp;nbsp; If =
you=20
want the instant, then the conversion outlined above and previously is=20
correct.&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;Could someone check this =
out?&amp;nbsp; I don't=20
have all the tools here at home to test this.&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;Richard Norman&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;Web/Application =
Developer&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D201141908-28062003&gt;*****************Original=20
Messages**************************&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;
&lt;P&gt;Message: 12&lt;/P&gt;
&lt;P&gt;From: &quot;A Rafael D Teixeira&quot; &amp;lt;<A HREF="mailto:rafaelteixeirabr@hotmail.com">rafaelteixeirabr@hotmail.com</A>&amp;gt;&lt;/P&gt;
&lt;P&gt;To: <A HREF="mailto:lluis@ideary.com">lluis@ideary.com</A>, <A HREF="mailto:mono-list@lists.ximian.com">mono-list@lists.ximian.com</A>&lt;/P&gt;
&lt;P&gt;Subject: Re: [Mono-list] A big (MS created) flaw in DateTime that =
surfaces in=20
Web Services&lt;/P&gt;
&lt;P&gt;Date: Fri, 27 Jun 2003 19:10:47 -0300&lt;/P&gt;
&lt;P&gt;Hi Lluis,&lt;/P&gt;
&lt;P&gt;&amp;gt;Hmm. Maybe I'm missing something, but I don't see the problem. =
For &lt;/P&gt;
&lt;P&gt;&amp;gt;example, lets say that there is a server A in GMT+1 timezone =
thats &lt;/P&gt;
&lt;P&gt;&amp;gt;makes a call to a server B in GMT-6 timezone. The call includes =
the &lt;/P&gt;
&lt;P&gt;&amp;gt;date 27/6/2003 14:00:00. The XmlSerializer in server A will =
format this=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;date as 27/6/2003T14:00:00.0000000+01:00. The server B will =
deserialize=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;this date as 27/6/2003 07:00:00 (where 7 =3D 14 - (+1) + (-6)). =
If this=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;date goes back from&lt;/P&gt;
&lt;P&gt;&amp;gt;server B to server A, server B will serialize&lt;/P&gt;
&lt;P&gt;&amp;gt;27/6/2003T07:00:00.0000000-06:00, and server A will get again=20
27/6/2003&lt;/P&gt;
&lt;P&gt;&amp;gt;14:00:00 (where 14 =3D 7 - (-6) + 1)&lt;/P&gt;
&lt;P&gt;&amp;gt;&lt;/P&gt;
&lt;P&gt;&amp;gt;BTW, this didn't work a couple of days ago, I just commited that =
fixes=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;it.&lt;/P&gt;
&lt;P&gt;You are missing the point:&lt;/P&gt;
&lt;P&gt;Here is an example you can possibly test for yourself.&lt;/P&gt;
&lt;P&gt;I have two DateTimes one containing 1998/10/16T00:00:00000 (a friday) =
and=20
&lt;/P&gt;
&lt;P&gt;the other 1998/10/19T00:00:00000 (a monday) both without time zone =
&lt;/P&gt;
&lt;P&gt;information and both extracted from a database.&lt;/P&gt;
&lt;P&gt;The server is in a time zone so that it decides to encode them =
as:&lt;/P&gt;
&lt;P&gt;1998/10/16T00:00:00000-03:00 (normal period of the year) and&lt;/P&gt;
&lt;P&gt;1998/10/19T00:00:00000-02:00 (because it crossed into a daylight =
savings &lt;/P&gt;
&lt;P&gt;period)&lt;/P&gt;
&lt;P&gt;The problem is that the client is theoretically in the same time zone =
but it=20
&lt;/P&gt;
&lt;P&gt;ends parsing it back as follow:&lt;/P&gt;
&lt;P&gt;1998/10/16T00:00:00000&lt;/P&gt;
&lt;P&gt;1998/10/18T23:00:00000 (became sunday 11pm). THAT IS THE PROBLEM =
MANIFESTING=20
&lt;/P&gt;
&lt;P&gt;ITSELF.&lt;/P&gt;
&lt;P&gt;Even if I'm wrong about both machines staying in the same time zone, =
I don't=20
&lt;/P&gt;
&lt;P&gt;want the information to change because in truth the server may be =
housed in=20
&lt;/P&gt;
&lt;P&gt;S=E3o Paulo, but this data has many sources around the globe (Tokyo =
and New=20
&lt;/P&gt;
&lt;P&gt;York, for example), and Dates and Times are already universalized in =
the &lt;/P&gt;
&lt;P&gt;database and are to be shown as stored not adjusted.&lt;/P&gt;
&lt;P&gt;&amp;gt;&lt;/P&gt;
&lt;P&gt;&amp;gt;In Remoting, there may be a problem, because DateTime is =
serialized as=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;ticks, so don't include the UTC offset. When such a date is =
serialized=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;in the destination sever there is no way to know the original =
timezone.=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;But you can always include the UTC offset as an extra =
parameter.&lt;/P&gt;
&lt;P&gt;That is what I want: It MUST NOT be adjusted from the insuficient =
&lt;/P&gt;
&lt;P&gt;information the infraestructure has.&lt;/P&gt;
&lt;P&gt;&amp;nbsp;&lt;/P&gt;
&lt;P&gt;&amp;gt;Yes, that's another problem. I've partially removed some of this =
checks=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;to match MS.NET behavior, and it works better now. However you =
have to=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;be careful to use for example DateTime.MinValue as a marker for =
null &lt;/P&gt;
&lt;P&gt;&amp;gt;dates, because this value can change if the date is deserialized =
in a=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;server that has a different timezone.&lt;/P&gt;
&lt;P&gt;That is the problem again. Server and client location can't interfere =
in &lt;/P&gt;
&lt;P&gt;transmitting data. If I have a DateTime.MinValue at one end IT MUST =
STILL BE=20
&lt;/P&gt;
&lt;P&gt;A DateTime.MinValue at the other. What we are saying is that this =
channel is=20
&lt;/P&gt;
&lt;P&gt;not transparent, that is for me a BUG.&lt;/P&gt;
&lt;P&gt;&amp;gt;&lt;/P&gt;
&lt;P&gt;&amp;gt; &amp;gt; For my application I will just avoid the issue by =
serializing the=20
&lt;/P&gt;
&lt;P&gt;&amp;gt; &amp;gt; Ticks member of the DateTime, but this is a larger issue =
with &lt;/P&gt;
&lt;P&gt;&amp;gt; &amp;gt; broader implications.&lt;/P&gt;
&lt;P&gt;&amp;gt;&lt;/P&gt;
&lt;P&gt;&amp;gt;This does not solve the issue, unless you work always with the =
same &lt;/P&gt;
&lt;P&gt;&amp;gt;timezone. Ticks are also relative to the time zone.&lt;/P&gt;
&lt;P&gt;Yes, my database contains data from around the globe, but all of it =
is &lt;/P&gt;
&lt;P&gt;normalized to a single reference location.&lt;/P&gt;
&lt;P&gt;&amp;gt;I dont find necessary to extend or change DateTime to include UTC =
info.=20
&lt;/P&gt;
&lt;P&gt;&amp;gt;It is enough to include it when a data is serialized. =
XmlSerializer &lt;/P&gt;
&lt;P&gt;&amp;gt;already does it, BinaryFormatter does not.&lt;/P&gt;
&lt;P&gt;I only want to have control of the process so that I can say, when =
needed,=20
&lt;/P&gt;
&lt;P&gt;that I want a datetime to pass transparently from one end to the =
other.&lt;/P&gt;
&lt;P&gt;Best regards,&lt;/P&gt;
&lt;P&gt;Rafael Teixeira&lt;/P&gt;
&lt;P&gt;Brazilian Polymath&lt;/P&gt;
&lt;P&gt;Mono Hacker since 16 Jul 2001&lt;/P&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;

------=_NextPart_000_0003_01C33D16.0A5281A0--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="014649.html">[Mono-list] CVS timeout
</A></li>
	<LI> Next message: <A HREF="014679.html">[Mono-list] A big (MS created) flaw in DateTime that surfaces in Web Services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14651">[ date ]</a>
              <a href="thread.html#14651">[ thread ]</a>
              <a href="subject.html#14651">[ subject ]</a>
              <a href="author.html#14651">[ author ]</a>
         </LI>
       </UL>
</body></html>
