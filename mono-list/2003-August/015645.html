<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Microsoft Mutex example doesn't work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:sergio-blanco%40iespana.es">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="015639.html">
   <LINK REL="Next"  HREF="015647.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Microsoft Mutex example doesn't work
   </H1>
    <B>Sergio Blanco Cuaresma
    </B> 
    <A HREF="mailto:sergio-blanco%40iespana.es"
       TITLE="[Mono-list] Microsoft Mutex example doesn't work">sergio-blanco@iespana.es
       </A><BR>
    <I>28 Aug 2003 18:56:28 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="015639.html">[Mono-list] Workaround for AppDomain.Load + Unload problem?
</A></li>
        <LI> Next message: <A HREF="015647.html">[Mono-list] QT# or GTK# ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15645">[ date ]</a>
              <a href="thread.html#15645">[ thread ]</a>
              <a href="subject.html#15645">[ subject ]</a>
              <a href="author.html#15645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-Yy/VVaBvtEu7vrX1UlWb
Content-Type: multipart/mixed; boundary=&quot;=-Iqb5GTK37mFuvKn1OWWy&quot;


--=-Iqb5GTK37mFuvKn1OWWy
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable


I've tested an example from:

<A HREF="http://msdn.microsoft.com/library/default.asp?url=3D/library/en-us/cpguide/=">http://msdn.microsoft.com/library/default.asp?url=3D/library/en-us/cpguide/=</A>
html/cpconmutex.asp

And it doesn't work correctly with Mono. It uses 2 mutex no control 4
threads, lets see each one:

t1Start: Waits to finish until all mutex are released
t2Start: Waits until mutex 1 is released
t3Start: Waits until any mutex is released (1 or 2)
t4Start: Waits until mutex 2 is released

The program launch the 4 threads and Release mutex 1 and then mutex 2.
The output of the program shows:

MutexSample.cs ...
 - Main Owns gM1 and gM2
t1Start started,  Mutex.WaitAll(Mutex[])
t2Start started,  gM1.WaitOne( )
t3Start started,  Mutex.WaitAny(Mutex[])
t4Start started,  gM2.WaitOne( )
 - Main releases gM1
t2Start finished, gM1.WaitOne( )
 - Main releases gM2
t4Start finished, gM2.WaitOne( )

And the program doesn't finish. As we can see only the threads t2 and t4
have finished, so the calls WaitAll and WaitAny of thread t1 and t3
don't work properly.

The code is attached. Is it a bug?

--=20

[aka Marble]
 Registered LiNUX user #140941  &lt;&gt;  <A HREF="http://counter.li.org/">http://counter.li.org/</A>
 Socio #3274 de HispaLinux  &lt;&gt;  <A HREF="http://www.hispalinux.es">http://www.hispalinux.es</A>
 Miembro de GPL URV  &lt;&gt;  <A HREF="http://www.gplurv.org">http://www.gplurv.org</A>
 GnuPG key: 0x0ED2CF9D  &lt;&gt;  pgp.escomposlinux.org

--=-Iqb5GTK37mFuvKn1OWWy
Content-Disposition: attachment; filename=ThreadMutexMS.cs
Content-Transfer-Encoding: base64
Content-Type: text/plain; name=ThreadMutexMS.cs; charset=iso-8859-15

dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLlRocmVhZGluZzsNCg0KcHVibGljIGNsYXNzIE11
dGV4U2FtcGxlew0KDQogICBzdGF0aWMgTXV0ZXggICAgICAgICAgICBnTTE7DQogICBzdGF0aWMg
TXV0ZXggICAgICAgICAgICBnTTI7DQogICBjb25zdCBpbnQgICAgICAgICAgICAgICBJVEVSUyAg
ID0gMTAwOw0KICAgc3RhdGljIEF1dG9SZXNldEV2ZW50ICAgRXZlbnQxICA9IG5ldyBBdXRvUmVz
ZXRFdmVudChmYWxzZSk7DQogICBzdGF0aWMgQXV0b1Jlc2V0RXZlbnQgICBFdmVudDIgID0gbmV3
IEF1dG9SZXNldEV2ZW50KGZhbHNlKTsNCiAgIHN0YXRpYyBBdXRvUmVzZXRFdmVudCAgIEV2ZW50
MyAgPSBuZXcgQXV0b1Jlc2V0RXZlbnQoZmFsc2UpOw0KICAgc3RhdGljIEF1dG9SZXNldEV2ZW50
ICAgRXZlbnQ0ICA9IG5ldyBBdXRvUmVzZXRFdmVudChmYWxzZSk7DQoNCiAgIHB1YmxpYyBzdGF0
aWMgdm9pZCBNYWluKFN0cmluZ1tdIGFyZ3Mpew0KDQogICAgICBDb25zb2xlLldyaXRlTGluZSgi
TXV0ZXhTYW1wbGUuY3MgLi4uIik7DQogICAgICBnTTEgPSBuZXcgTXV0ZXgodHJ1ZSwiTXlNdXRl
eCIpOw0KICAgICAgICAgICAgLy8gQ3JlYXRlIE11dGV4dCBpbml0aWFsT3duZWQsIHdpdGggbmFt
ZSBvZiAiTXlNdXRleCIuDQogICAgICAgZ00yID0gbmV3IE11dGV4KHRydWUpOyAgICAgICAgICAg
ICAgICAgICAgICANCiAgICAgICAgICAgIC8vIENyZWF0ZSBNdXRleHQgaW5pdGlhbE93bmVkLCB3
aXRoIG5vIG5hbWUuDQogICAgICBDb25zb2xlLldyaXRlTGluZSgiIC0gTWFpbiBPd25zIGdNMSBh
bmQgZ00yIik7DQoNCiAgICAgIEF1dG9SZXNldEV2ZW50W10gICAgZXZzID0gbmV3IEF1dG9SZXNl
dEV2ZW50WzRdOw0KICAgICAgZXZzWzBdID0gRXZlbnQxOw0KICAgICAgICAgICAgLy8gRXZlbnQg
Zm9yIHQxLg0KICAgICAgZXZzWzFdID0gRXZlbnQyOw0KICAgICAgICAgICAgLy8gRXZlbnQgZm9y
IHQyLg0KICAgICAgZXZzWzJdID0gRXZlbnQzOw0KICAgICAgICAgICAgLy8gRXZlbnQgZm9yIHQz
Lg0KICAgICAgZXZzWzNdID0gRXZlbnQ0Ow0KICAgICAgICAgICAgLy8gRXZlbnQgZm9yIHQ0Lg0K
DQogICAgICBNdXRleFNhbXBsZSAgICAgICAgIHRtICA9IG5ldyBNdXRleFNhbXBsZSggKTsNCiAg
ICAgIFRocmVhZCAgICAgICAgICAgICAgdDEgID0gbmV3IFRocmVhZChuZXcgVGhyZWFkU3RhcnQo
dG0udDFTdGFydCkpOw0KICAgICAgVGhyZWFkICAgICAgICAgICAgICB0MiAgPSBuZXcgVGhyZWFk
KG5ldyBUaHJlYWRTdGFydCh0bS50MlN0YXJ0KSk7DQogICAgICBUaHJlYWQgICAgICAgICAgICAg
IHQzICA9IG5ldyBUaHJlYWQobmV3IFRocmVhZFN0YXJ0KHRtLnQzU3RhcnQpKTsNCiAgICAgIFRo
cmVhZCAgICAgICAgICAgICAgdDQgID0gbmV3IFRocmVhZChuZXcgVGhyZWFkU3RhcnQodG0udDRT
dGFydCkpOw0KICAgICAgdDEuU3RhcnQoKTsNCiAgICAgICAgICAgICAgICAvLyBDYWxscyBNdXRl
eC5XYWl0QWxsKE11dGV4W10gb2YgZ00xIGFuZCBnTTIpLg0KICAgICAgdDIuU3RhcnQoKTsNCiAg
ICAgICAgICAgICAgICAvLyBDYWxscyBNdXRleC5XYWl0T25lKE11dGV4IGdNMSkuDQogICAgICB0
My5TdGFydCgpOw0KICAgICAgICAgICAgICAgIC8vIENhbGxzIE11dGV4LldhaXRBbnkoTXV0ZXhb
XSBvZiBnTTEgYW5kIGdNMikuDQogICAgICB0NC5TdGFydCgpOw0KICAgICAgICAgICAgICAgIC8v
IENhbGxzIE11dGV4LldhaXRPbmUoTXV0ZXggZ00yKS4NCg0KICAgICAgVGhyZWFkLlNsZWVwKDIw
MDApOw0KICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIiAtIE1haW4gcmVsZWFzZXMgZ00xIik7DQog
ICAgICBnTTEuUmVsZWFzZU11dGV4KCApOw0KICAgICAgICAvLyB0MiBhbmQgdDMgd2lsbCBlbmQg
YW5kIHNpZ25hbC4NCg0KICAgICAgVGhyZWFkLlNsZWVwKDEwMDApOw0KICAgICAgQ29uc29sZS5X
cml0ZUxpbmUoIiAtIE1haW4gcmVsZWFzZXMgZ00yIik7DQogICAgICBnTTIuUmVsZWFzZU11dGV4
KCApOw0KICAgICAgICAvLyB0MSBhbmQgdDQgd2lsbCBlbmQgYW5kIHNpZ25hbC4NCg0KICAgICAg
V2FpdEhhbmRsZS5XYWl0QWxsKGV2cyk7DQogICAgICAvLyBXYWl0aW5nIHVudGlsIGFsbCBmb3Vy
IHRocmVhZHMgc2lnbmFsIHRoYXQgdGhleSBhcmUgZG9uZS4NCiAgICAgIENvbnNvbGUuV3JpdGVM
aW5lKCIuLi4gTXV0ZXhTYW1wbGUuY3MiKTsNCiAgIH0NCg0KICAgcHVibGljIHZvaWQgdDFTdGFy
dCgpew0KDQogICAgICBDb25zb2xlLldyaXRlTGluZSgidDFTdGFydCBzdGFydGVkLCAgTXV0ZXgu
V2FpdEFsbChNdXRleFtdKSIpOw0KICAgICAgTXV0ZXhbXSAgICAgICAgICAgICBnTXMgPSBuZXcg
TXV0ZXhbMl07DQogICAgICBnTXNbMF0gPSBnTTE7DQogICAgICAgICAgICAgICAvLyBDcmVhdGUg
YW5kIGxvYWQgYW4gYXJyYXkgb2YgTXV0ZXggb2JqZWN0cyBmb3IgV2FpdEFsbCBjYWxsLg0KICAg
ICAgZ01zWzFdID0gZ00yOw0KICAgICAgTXV0ZXguV2FpdEFsbChnTXMpOw0KICAgICAgICAgICAg
ICAgLy8gV2FpdHMgdW50aWwgYm90aCBNdXRleCBvYmplY3RzIGFyZSByZWxlYXNlZC4NCiAgICAg
IFRocmVhZC5TbGVlcCgyMDAwKTsNCiAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJ0MVN0YXJ0IGZp
bmlzaGVkLCBNdXRleC5XYWl0QWxsKE11dGV4W10pIik7DQogICAgICBFdmVudDEuU2V0KCApOw0K
ICAgICAgICAgICAgICAvLyBBdXRvUmVzZXRFdmVudC5TZXQoICkgZmxhZ2dpbmcgbWV0aG9kIGlz
IGRvbmUuDQogICB9DQoNCiAgIHB1YmxpYyB2b2lkIHQyU3RhcnQoKXsNCiAgICAgIENvbnNvbGUu
V3JpdGVMaW5lKCJ0MlN0YXJ0IHN0YXJ0ZWQsICBnTTEuV2FpdE9uZSggKSIpOw0KICAgICAgZ00x
LldhaXRPbmUoICk7DQogICAgICAgICAgICAvLyBXYWl0cyB1bnRpbCBNdXRleCBnTTEgaXMgcmVs
ZWFzZWQuDQogICAgICBDb25zb2xlLldyaXRlTGluZSgidDJTdGFydCBmaW5pc2hlZCwgZ00xLldh
aXRPbmUoICkiKTsNCiAgICAgIEV2ZW50Mi5TZXQoICk7DQogICAgICAgICAgICAvLyBBdXRvUmVz
ZXRFdmVudC5TZXQoICkgZmxhZ2dpbmcgbWV0aG9kIGlzIGRvbmUuDQogICB9DQoNCiAgIHB1Ymxp
YyB2b2lkIHQzU3RhcnQoKXsNCiAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJ0M1N0YXJ0IHN0YXJ0
ZWQsICBNdXRleC5XYWl0QW55KE11dGV4W10pIik7DQogICAgICBNdXRleFtdICAgICAgICAgICAg
IGdNcyA9IG5ldyBNdXRleFsyXTsNCiAgICAgIGdNc1swXSA9IGdNMTsNCiAgICAgICAgICAgICAg
IC8vIENyZWF0ZSBhbmQgbG9hZCBhbiBhcnJheSBvZiBNdXRleCBvYmplY3RzIGZvciBXYWl0QW55
IGNhbGwuDQogICAgICBnTXNbMV0gPSBnTTI7DQogICAgICBNdXRleC5XYWl0QW55KGdNcyk7DQog
ICAgICAgICAgICAgICAvLyBXYWl0cyB1bnRpbCBlaXRoZXIgTXV0ZXggb2JqZWN0IGlzIHJlbGVh
c2VkLg0KICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoInQzU3RhcnQgZmluaXNoZWQsIE11dGV4Lldh
aXRBbnkoTXV0ZXhbXSkiKTsNCiAgICAgIEV2ZW50My5TZXQoICk7DQogICAgICAgICAgICAgICAv
LyBBdXRvUmVzZXRFdmVudC5TZXQoICkgZmxhZ2dpbmcgbWV0aG9kIGlzIGRvbmUuDQogICB9DQoN
CiAgIHB1YmxpYyB2b2lkIHQ0U3RhcnQoKXsNCiAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJ0NFN0
YXJ0IHN0YXJ0ZWQsICBnTTIuV2FpdE9uZSggKSIpOw0KICAgICAgZ00yLldhaXRPbmUoICk7DQog
ICAgICAgICAgICAvLyBXYWl0cyB1bnRpbCBNdXRleCBnTTIgaXMgcmVsZWFzZWQuDQogICAgICBD
b25zb2xlLldyaXRlTGluZSgidDRTdGFydCBmaW5pc2hlZCwgZ00yLldhaXRPbmUoICkiKTsNCiAg
ICAgIEV2ZW50NC5TZXQoICk7DQogICAgICAgICAgICAvLyBBdXRvUmVzZXRFdmVudC5TZXQoICkg
ZmxhZ2dpbmcgbWV0aG9kIGlzIGRvbmUuDQogICB9DQp9DQo=

--=-Iqb5GTK37mFuvKn1OWWy--

--=-Yy/VVaBvtEu7vrX1UlWb
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: Esta parte del mensaje =?ISO-8859-1?Q?est=E1?= firmada
	digitalmente

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.2 (GNU/Linux)

iD8DBQA/TjQ7fGXf5g7Sz50RAscLAJ9XmbPg0N3jarNkyjQIMsgewJNPRgCg6dcN
W9FBAjMnH2vFWi4yx1fxkPQ=
=R//R
-----END PGP SIGNATURE-----

--=-Yy/VVaBvtEu7vrX1UlWb--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="015639.html">[Mono-list] Workaround for AppDomain.Load + Unload problem?
</A></li>
	<LI> Next message: <A HREF="015647.html">[Mono-list] QT# or GTK# ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15645">[ date ]</a>
              <a href="thread.html#15645">[ thread ]</a>
              <a href="subject.html#15645">[ subject ]</a>
              <a href="author.html#15645">[ author ]</a>
         </LI>
       </UL>
</body></html>
