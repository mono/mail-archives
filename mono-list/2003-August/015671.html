<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] TripleDES encryption problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:spouliot%40videotron.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <LINK REL="Previous"  HREF="015668.html">
   <LINK REL="Next"  HREF="015674.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] TripleDES encryption problem
   </H1>
    <B>Sébastien Pouliot
    </B> 
    <A HREF="mailto:spouliot%40videotron.ca"
       TITLE="[Mono-list] TripleDES encryption problem">spouliot@videotron.ca
       </A><BR>
    <I>Fri, 29 Aug 2003 22:48:18 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="015668.html">[Mono-list] TripleDES encryption problem
</A></li>
        <LI> Next message: <A HREF="015674.html">[Mono-list] TripleDES encryption problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15671">[ date ]</a>
              <a href="thread.html#15671">[ thread ]</a>
              <a href="subject.html#15671">[ subject ]</a>
              <a href="author.html#15671">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Carlos,

&gt;<i> Huuummmm  i'm encrypting the fragment + mac +
</I>&gt;<i> padding length, this gives 37 bytes of data and 3 bytes more for
</I>&gt;<i> padding, if i'm not wrong the correct padding is
</I>
Well this isn't the structure described in rfc2246. You may not be
encrypting the right structure!
But I'm unsure why you are encrypting this. What are you using as the TLS
specification ?

&gt;<i> I have checked this on windows and seems to be correct.
</I>
That's still a mystery why this works under Windows !
But there's something you can try:
- Rename Mono's TripleDESCryptoServiceProvider class to something else (like
Mono3DES).
- Include this new into your projet
- Duplicate all crypto code using TripleDESCryptoServiceProvider;
- Compare all output buffers between the 2 implementations
somewhere there must be a difference between the outputs...

&gt;<i> And a final note from the Microsoft .NET Framework help:
</I>&gt;<i>
</I>&gt;<i> PaddingMode.PKCS7
</I>&gt;<i>
</I>&gt;<i> The PKCS #7 padding string consists of a sequence of bytes, each of
</I>&gt;<i> which is equal to the total number of padding bytes added. For example,
</I>&gt;<i> if 24 bits (3 bytes) of padding need to be added, the padding string is
</I>&gt;<i> &quot;03 03 03&quot;.
</I>
Yeah this is all true, PKCS#7 pads using the number of unused bytes as the
padding value. You can see this in your previous sample when you had 7 times
0x07 decoded by OpenSSL - so Mono got the PKCS#7 padding right.

But this ISN'T the behaviour described in rfc2246 in section 6.2.3.2. If you
check the included example (page 20) you'll see that the last 8 bytes are xx
06 06 06 06 06 06 06 (7 times 0x06) which ISN'T a standard PKCS#7 padding
but consistent with the pseudo-code GenericBlockCipher structure.

I hope this helps
Good luck

Sebastien Pouliot
Security Architect, Motus Technologies, <A HREF="http://www.motus.com/">http://www.motus.com/</A>
work: <A HREF="mailto:spouliot@motus.com">spouliot@motus.com</A>
home: <A HREF="mailto:spouliot@videotron.ca">spouliot@videotron.ca</A>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="015668.html">[Mono-list] TripleDES encryption problem
</A></li>
	<LI> Next message: <A HREF="015674.html">[Mono-list] TripleDES encryption problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15671">[ date ]</a>
              <a href="thread.html#15671">[ thread ]</a>
              <a href="subject.html#15671">[ subject ]</a>
              <a href="author.html#15671">[ author ]</a>
         </LI>
       </UL>
</body></html>
