<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] MonoTorrent error + fix
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20MonoTorrent%20error%20%2B%20fix&In-Reply-To=27b05b490701220201i6da7481by6006e458f0a8e7d8%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033985.html">
   <LINK REL="Next"  HREF="033947.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] MonoTorrent error + fix</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20MonoTorrent%20error%20%2B%20fix&In-Reply-To=27b05b490701220201i6da7481by6006e458f0a8e7d8%40mail.gmail.com"
       TITLE="[Mono-list] MonoTorrent error + fix">alan.mcgovern at gmail.com
       </A><BR>
    <I>Mon Jan 22 10:56:45 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="033985.html">[Mono-list] MonoTorrent error + fix
</A></li>
        <LI>Next message: <A HREF="033947.html">[Mono-list] serial port problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33992">[ date ]</a>
              <a href="thread.html#33992">[ thread ]</a>
              <a href="subject.html#33992">[ subject ]</a>
              <a href="author.html#33992">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey


&gt;<i>   I haven't experienced any more size-related crashes with the latest
</I>&gt;<i> SVN code.
</I>

Good good. Another bug crushed ;)

  I have a few more questions/suggestions WRT the library, though.
&gt;<i> I'd like to show a list of peers and how fast each one is
</I>&gt;<i> delivering/receiving data, and this seems to be impossible with the
</I>&gt;<i> current code.  It's keeping track of how fast it's interacting with
</I>&gt;<i> each peer, but it's keeping that information to itself - in
</I>&gt;<i> TorrentManager.connectedPeers[i].Peer.Connection.Monitor.UploadSpeed.
</I>&gt;<i> What would a good way to expose this be?
</I>

I thought i had exposed this. My mistake if i haven't. Whenever a connection
is opened with another peer, that peer is given to you in an event. What
will happen (in the next SVN commit) is that you should be able to directly
access the bytes downloaded/uploaded from/to that peer, the current
upload/download speed, the current state (choked/unchoked/if he's a seeder
etc), the client that is running (if it's known) and the number of hashfails
from that peer. Is there any more information you would like?


  TorrentManager.DownloadSpeed() occasionally returns NaN.  This means
&gt;<i> I need code like this to keep track of ETA:
</I>&gt;<i> ETA = ((obj.downSpeed == 0) || double.IsNaN(obj.downSpeed)) ?
</I>&gt;<i> TimeSpan.MaxValue : TimeSpan.FromSeconds((double)obj.bytesLeft /
</I>&gt;<i> obj.downSpeed);
</I>&gt;<i> It'd be more convenient to get back non-NaN values, and the fact that
</I>&gt;<i> it's giving NaNs is an indication to me that something's up with the
</I>&gt;<i> rate calculations.  I can't get it to happen right now or I'd send a
</I>&gt;<i> better bug report.
</I>

Yup, that's on my todo list. I'm not quite sure what is causing the problem.
I could implement a workaround to hide the bug from the end user but i
haven't as of yet so i get a constant reminder that it's not right ;)

I'm not 100% sure what is causing the problem. What i think has been
happening is that sometimes when writing a block to the disk (or reading
from the disk) the operation blocks for a few engine &quot;ticks&quot; and that breaks
the speed calculations then as then 3-4 ticks would run at the same time
causing division by 0's in the speed calculation giving NaN. The problem is
i can't reliably replicate the situation so it makes debugging hard.


  There's no quick way to tell how many bytes have been downloaded in
&gt;<i> total (not just from this session) that I can tell of.
</I>

I was wary about putting that in because i didn't want to confuse the users
of the library by having 10 different listings of &quot;downloaded data&quot;.
Currently i have separate counts for the amount of protocol data
sent/received, the amount of actual data sent/received and there's another
count for each peer showing that they've sent/received. I didn't want to add
more ones for TotalBytesRemaining and TotalBytesDownloaded.

Easiest way to find out how many bytes have been downloaded overall would
be:
int bytesDownloaded= manager.Progress() * manager.Torrent.Size;

bytes remaining would be:
int remaining = manager.Torrent.Size -  bytesDownloaded;

If you have any comments or suggestions, give me a shout. Or if you can find
a way to easily replicate the NaN bug, that'd be great.

Thanks,
Alan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20070122/5e0537b9/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20070122/5e0537b9/attachment.html</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033985.html">[Mono-list] MonoTorrent error + fix
</A></li>
	<LI>Next message: <A HREF="033947.html">[Mono-list] serial port problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33992">[ date ]</a>
              <a href="thread.html#33992">[ thread ]</a>
              <a href="subject.html#33992">[ subject ]</a>
              <a href="author.html#33992">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
