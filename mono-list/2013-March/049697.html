<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Poor Mono performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Poor%20Mono%20performance&In-Reply-To=%3CCACmR%2BBCJkRsoUgPe7th5%3DSbSYj-v3pqSF8XS3Fs2Sftt2M7B3w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="049724.html">
   <LINK REL="Next"  HREF="049698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Poor Mono performance</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Poor%20Mono%20performance&In-Reply-To=%3CCACmR%2BBCJkRsoUgPe7th5%3DSbSYj-v3pqSF8XS3Fs2Sftt2M7B3w%40mail.gmail.com%3E"
       TITLE="[Mono-list] Poor Mono performance">kumpera at gmail.com
       </A><BR>
    <I>Tue Mar 12 20:34:18 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="049724.html">[Mono-list] Poor Mono performance
</A></li>
        <LI>Next message: <A HREF="049698.html">[Mono-list] FW:  Poor Mono performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49697">[ date ]</a>
              <a href="thread.html#49697">[ thread ]</a>
              <a href="subject.html#49697">[ subject ]</a>
              <a href="author.html#49697">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A few important things to keep in mind:

-The Windows port of mono lags in terms of performance compared to OSX and
linux;
-The new, and significantly faster, garbage collector is not fully
supported on windows, and absent on 2.10;
-The new 3.0 series is significantly faster;


On Tue, Mar 12, 2013 at 12:54 PM, Nigel Delaney
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">nigel.delaney at outlook.com</A>&gt;wrote:

&gt;<i> Edward and Imre - Wow, okay your results definitely didn't mesh with mine,
</I>&gt;<i> very strange things are afoot... On my windows 7 with an Intel i7 3.4 GHz
</I>&gt;<i> processor I had substantially different runtimes comparing mono and .NET
</I>&gt;<i> 4.5.  Below shows the 2x2 factorial for compiler versus runtime.  These
</I>&gt;<i> results do not change much across replicates, and basically there is a
</I>&gt;<i> massive performance difference between .NET and mono when I ran it.  I
</I>&gt;<i> don&#8217;t know if at this stage this is due to cache misses/etc.  Looking at
</I>&gt;<i> the IL produced by the two different compilers, there are some differences
</I>&gt;<i> in the methods and they load the different methods at different positions
</I>&gt;<i> in the table, in any event there is a clear difference between all of these
</I>&gt;<i> 4 except the two mono treatments.  I wonder if this is a .NET 4 v 4.5 thing?
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> *Compiler*
</I>&gt;<i>
</I>&gt;<i> *CLI*
</I>&gt;<i>
</I>&gt;<i> *Time*
</I>&gt;<i>
</I>&gt;<i> mcs ****
</I>&gt;<i>
</I>&gt;<i> Mono 2.10.9****
</I>&gt;<i>
</I>&gt;<i> 1.9 s****
</I>&gt;<i>
</I>&gt;<i> mcs ****
</I>&gt;<i>
</I>&gt;<i> .NET 4.5****
</I>&gt;<i>
</I>&gt;<i> .93 s****
</I>&gt;<i>
</I>&gt;<i> Visual Studio****
</I>&gt;<i>
</I>&gt;<i> Mono 2.10.9****
</I>&gt;<i>
</I>&gt;<i> 1.87 s****
</I>&gt;<i>
</I>&gt;<i> Visual Studio****
</I>&gt;<i>
</I>&gt;<i> .NET 4.5****
</I>&gt;<i>
</I>&gt;<i> 0.64 s****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Imre  &#8211;  you missed the point of my email, and obviously I could have made
</I>&gt;<i> the program a lot faster than I did.  The point is that your program is
</I>&gt;<i> generally slow for other reasons, though you seemed to be worried about
</I>&gt;<i> using Arrays or Lists which is peanuts compared to other things you could
</I>&gt;<i> do.  In particular, in both Mono and .NET, method calls are expensive.  In
</I>&gt;<i> my experience, adding numbers and incrementing values takes no time
</I>&gt;<i> compared to calling the method that does these things.  I was suggesting
</I>&gt;<i> you should do the following things:****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> 1 &#8211; Make sure the method is inlined, avoid the method call.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> 2 &#8211; Do not insert the for loop inside a useless do while loop.  You are
</I>&gt;<i> checking conditions inside and outside the method and likely preventing
</I>&gt;<i> important optimizations like caching the list.count property.  I don&#8217;t know
</I>&gt;<i> what you are trying to do, but note that if you replace the do/while code
</I>&gt;<i> with the code below, than you inline the Advance method, can still do
</I>&gt;<i> everything inside the loop and it is over an order of magnitude faster on
</I>&gt;<i> either .NET or Mono.  Not sure if you can do this with your code, but the
</I>&gt;<i> point is mono v. .NET performance differences pale in comparison to the
</I>&gt;<i> nested for-loop-method-call-inside-do-while-loop performance penalty you
</I>&gt;<i> are paying right now. ****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i>        for (int index = counters.Count - 1; index &gt;= 0; --index)****
</I>&gt;<i>
</I>&gt;<i>                {****
</I>&gt;<i>
</I>&gt;<i>                     ++counter;****
</I>&gt;<i>
</I>&gt;<i>                     if (counters[index] == (totals[index] - 1))****
</I>&gt;<i>
</I>&gt;<i>                     {****
</I>&gt;<i>
</I>&gt;<i>                         counters[index] = 0;****
</I>&gt;<i>
</I>&gt;<i>                         continue;****
</I>&gt;<i>
</I>&gt;<i>                     }****
</I>&gt;<i>
</I>&gt;<i>                     else****
</I>&gt;<i>
</I>&gt;<i>                     {****
</I>&gt;<i>
</I>&gt;<i>                         ++counters[index];****
</I>&gt;<i>
</I>&gt;<i>                     }****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i>                     //All kinds of other stuff can be done here....****
</I>&gt;<i>
</I>&gt;<i>                 }****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> -N****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A> [mailto:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>] On Behalf Of edward.harvey.mono
</I>&gt;<i> Sent: Tuesday, March 12, 2013 10:06 AM
</I>&gt;<i> To: imreolajos; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-list] Poor Mono performance
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> &gt; From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A> [mailto:mono-list- ****
</I>&gt;<i>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">bounces at lists.ximian.com</A>] On Behalf Of imreolajos****
</I>&gt;<i>
</I>&gt;<i> &gt; ****
</I>&gt;<i>
</I>&gt;<i> &gt; SpeedTest.cs****
</I>&gt;<i>
</I>&gt;<i> &gt; &lt;<A HREF="http://mono.1490590.n4.nabble.com/file/n4658877/SpeedTest.cs">http://mono.1490590.n4.nabble.com/file/n4658877/SpeedTest.cs</A>&gt;****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Ok, you've provided some source code, you said it is important to you, and
</I>&gt;<i> it represents your real life work load.  You've said you had some
</I>&gt;<i> performance problems with it and would like to know why and what to do
</I>&gt;<i> about it ...  Other people here have commented that it seems we're avoiding
</I>&gt;<i> the problem.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> So, I'll bite:****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I downloaded the file you linked above, and compiled it, .Net 4 Windows 7
</I>&gt;<i> x86_64 dual core intel i5.  It ran in 3.3 sec.  I then ran on the exact
</I>&gt;<i> same machine in windows mono 2.10.9 and it ran in 3.66 sec.  To eliminate
</I>&gt;<i> sampling error, I ran repeatedly, and alternatingly.  Windows 3.4, Mono
</I>&gt;<i> 3.41, Win 3.3, Mono 3.41, Win 3.3, Mono 3.43****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> While the mono performance is a little lower, it's not dramatic.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I then set var totals = new List&lt;int&gt;() { 10, 10, 100, 100, 1000 }; to
</I>&gt;<i> make the job run longer, and ran again.  Win 32.7, Mono 32.8, Win 32.4,
</I>&gt;<i> Mono 32.9****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Even less dramatic.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I set the totals list back to the original presets.  Deployed the .exe to
</I>&gt;<i> a slightly slower windows 7 x86_64 virtual machine with 2 cpu's and 1 g
</I>&gt;<i> ram, and also deployed (and recompiled) to a fedora 17 x86_64 machine, mono
</I>&gt;<i> 2.10.8 installed via yum.  The win &amp; lin machines have identical system
</I>&gt;<i> specs, running on the same host hardware.  win 4.9, lin 3.2, win 4.9, lin
</I>&gt;<i> 3.2, win 4.9, lin 3.2****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> The most dramatic result we're seeing in any of these tests, is that mono
</I>&gt;<i> for linux is significantly faster than .Net for this particular task, while
</I>&gt;<i> mono for windows is slightly slower than .Net.  Again, specifically for
</I>&gt;<i> this test case in this configuration.  I would not be comfortable
</I>&gt;<i> generalizing anything from this.  I bet you'll see different results with
</I>&gt;<i> different patch levels of Windows or linux, different versions of .Net,
</I>&gt;<i> different versions of mono, different on 32bit vs 64bit hardware, etc.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> _______________________________________________****
</I>&gt;<i>
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list****">http://lists.ximian.com/mailman/listinfo/mono-list****</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20130312/f9422e3e/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20130312/f9422e3e/attachment-0001.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="049724.html">[Mono-list] Poor Mono performance
</A></li>
	<LI>Next message: <A HREF="049698.html">[Mono-list] FW:  Poor Mono performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#49697">[ date ]</a>
              <a href="thread.html#49697">[ thread ]</a>
              <a href="subject.html#49697">[ subject ]</a>
              <a href="author.html#49697">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
