<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Running Mono on platforms that can't generate code
	at runtime.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Running%20Mono%20on%20platforms%20that%20can%27t%20generate%20code%0A%09at%20runtime.&In-Reply-To=20050927222138.46583.qmail%40web81007.mail.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028767.html">
   <LINK REL="Next"  HREF="028774.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Running Mono on platforms that can't generate code
	at runtime.</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Running%20Mono%20on%20platforms%20that%20can%27t%20generate%20code%0A%09at%20runtime.&In-Reply-To=20050927222138.46583.qmail%40web81007.mail.yahoo.com"
       TITLE="[Mono-list] Running Mono on platforms that can't generate code
	at runtime.">jonpryor at vt.edu
       </A><BR>
    <I>Tue Sep 27 20:22:24 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="028767.html">[Mono-list] Running Mono on platforms that can't generate code at
	runtime.
</A></li>
        <LI>Next message: <A HREF="028774.html">[Mono-list] Running Mono on platforms that can't generate code at
	runtime.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28768">[ date ]</a>
              <a href="thread.html#28768">[ thread ]</a>
              <a href="subject.html#28768">[ subject ]</a>
              <a href="author.html#28768">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2005-09-27 at 15:21 -0700, Bruce Wilkie wrote:
&gt;<i> Is anyone doing this / has done this?  Specifically,
</I>&gt;<i> on systems that can't alloc memory that can later be
</I>&gt;<i> executed.
</I>
No.  See also:

	<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/2005-February/010432.html">http://lists.ximian.com/pipermail/mono-devel-list/2005-February/010432.html</A>
	<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=61710">http://bugzilla.ximian.com/show_bug.cgi?id=61710</A>

It may not even be possible.

There are two primary problems:

(1) The current closest way to getting all executable code on disk is
Ahead of Time compilation (`mono --aot`).  This *still* requires
modifications to the on-disk code to update the memory addresses of
various functions, which requires access to writable + executable
memory.  Game over.

(2)The way the JIT normally works is one method at a time.  A method is
JITed, and any methods it in turn calls refer to JIT stubs.  When the
JIT stub is invoked the JIT is invoked, JITing the referred to method,
and then back-patching the call site to skip the JIT the next time the
original method is invoke.  Repeat ad infinitum.

This not only requires writable+executable memory for the JIT code, but
also for wherever mono patches up existing call sites.

This also impacts the first proposal listed above (the Feb 2005 email to
mono-devel-list).  It proposed JITing methods to 3 levels in depth to
disk and them loading mmaping the disk file.  You *still* need to
back-patch method calls though -- if you don't, you need to JIT the
WHOLE PROGRAM before you start executing, and forget about loading up
code at runtime via Reflection/System.Assembly.Load/etc.

In short, for a decent, well performing, *sane* JIT, it is likely
impossible to get mono to work on a PaX-like system.  If you're willing
to lose most of the capabilities that a JIT affords, then you might be
able to make it work.  No one has expressed much interest to date.

 - Jon


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028767.html">[Mono-list] Running Mono on platforms that can't generate code at
	runtime.
</A></li>
	<LI>Next message: <A HREF="028774.html">[Mono-list] Running Mono on platforms that can't generate code at
	runtime.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28768">[ date ]</a>
              <a href="thread.html#28768">[ thread ]</a>
              <a href="subject.html#28768">[ subject ]</a>
              <a href="author.html#28768">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
