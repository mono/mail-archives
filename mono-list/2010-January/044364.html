<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mono performance,	20x differential with Java (what am 	i doing wrong)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20mono%20performance%2C%0A%0920x%20differential%20with%20Java%20%28what%20am%20%09i%20doing%20wrong%29&In-Reply-To=201001300254.32333.jon%40ffconsultancy.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="044363.html">
   <LINK REL="Next"  HREF="044365.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mono performance,	20x differential with Java (what am 	i doing wrong)</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20mono%20performance%2C%0A%0920x%20differential%20with%20Java%20%28what%20am%20%09i%20doing%20wrong%29&In-Reply-To=201001300254.32333.jon%40ffconsultancy.com"
       TITLE="[Mono-list] mono performance,	20x differential with Java (what am 	i doing wrong)">kumpera at gmail.com
       </A><BR>
    <I>Fri Jan 29 21:42:11 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="044363.html">[Mono-list] mono performance,	20x differential with Java (what am i doing wrong)
</A></li>
        <LI>Next message: <A HREF="044365.html">[Mono-list] mono performance,	20x differential with Java (what am 	i doing wrong)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44364">[ date ]</a>
              <a href="thread.html#44364">[ thread ]</a>
              <a href="subject.html#44364">[ subject ]</a>
              <a href="author.html#44364">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Jan 30, 2010 at 12:54 AM, Jon Harrop &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">jon at ffconsultancy.com</A>&gt; wrote:

&gt;<i> On Saturday 30 January 2010 00:20:11 Jonathan Shore wrote:
</I>&gt;<i> &gt; On Jan 29, 2010, at 7:19 PM, Jon Harrop wrote:
</I>&gt;<i> &gt; &gt;&gt; Jon, I saw your post about that on your blog some time ago.   Someone
</I>&gt;<i> &gt; &gt;&gt; familiar with Mono claimed otherwise, was therefore uncertain as to
</I>&gt;<i> &gt; &gt;&gt; whether was addressed or not.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; You should be able to verify my results easily: just run the 8-line
</I>&gt;<i> &gt; &gt; example F# program I gave and Mono will stack overflow.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;&gt; I can live some some inefficiency in tail calls provided one does not
</I>&gt;<i> &gt; &gt;&gt; get stack overflow or some other fatal issue.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; TCO is broken on Mono, not merely inefficient.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As I have no familiarity with the Mono VM code, no idea what it would
</I>&gt;<i> take
</I>&gt;<i> &gt; to fix this.
</I>&gt;<i>
</I>&gt;<i> There are many different solutions. The simplest would be to use LLVM's
</I>&gt;<i> fast
</I>&gt;<i> calling convention and tail calls as HLVM does.
</I>&gt;<i>
</I>
Implementing proper TCO in mono requires 2 things. First is to change the
managed calling convention to
have the caller pop its arguments. Then to lift any other few minor
restrictions. Well probably have similar
restrictions as MS's, such as no TCO on synchronized method.



&gt;<i> &gt; &gt;&gt; There is just so much momentum and available libraries on the two
</I>&gt;<i> major
</I>&gt;<i> &gt; &gt;&gt; VMs (CLR and JVM), that would be a huge risk for me at the moment.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I was actually disappointed with .NET's libraries in the context of
</I>&gt;<i> &gt; &gt; technical computing. I felt OCaml had better libraries and it turns out
</I>&gt;<i> &gt; &gt; that .NET was about as popular for technical computing as OCaml was
</I>&gt;<i> when
</I>&gt;<i> &gt; &gt; I started. The main exception is WPF but you don't get that with Mono.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I guess it depends where you come from.  First I'll have to be honest and
</I>&gt;<i> &gt; say that I am new to Ocaml.    My FP background is Scheme and some
</I>&gt;<i> dabbling
</I>&gt;<i> &gt; in Haskell.    I had heard from real-world users of Ocaml (such as the
</I>&gt;<i> Jane
</I>&gt;<i> &gt; Street capital guys), that the depth of libraries for Ocaml is pretty
</I>&gt;<i> &gt; shallow.    They've invested some years into building that up, but is
</I>&gt;<i> &gt; private work largely.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Now if we are talking about numerical stuff, then yes, there is not much
</I>&gt;<i> &gt; publicly available on either the CLR or JVM.    I was more referring to
</I>&gt;<i> the
</I>&gt;<i> &gt; tech libraries rather than scientific.
</I>&gt;<i>
</I>&gt;<i> Yes. Technical libraries (e.g. graphing) are far more advanced on .NET. I
</I>&gt;<i> was
</I>&gt;<i> referring only to numerical libraries like BLAS, LAPACK, FFTW and GSL.
</I>&gt;<i>
</I>
There is a not very usually explored bit of hidden performance in .NET which
is
runtime code generation. It is trivial to produce code that does runtime
algorithm
specialization. You can even do most of it at high level in C# using
expression trees.



&gt;<i> &gt; Will or does HLVM support the F# dialect of Ocaml as well?
</I>&gt;<i>
</I>&gt;<i> HLVM is designed to be a language agnostic VM so it could support either in
</I>&gt;<i> theory. In practice, I will probably create a new language and any others
</I>&gt;<i> will be ports done by other people. Currently, both OCaml and F# box tuples
</I>&gt;<i> which would be a disaster on HLVM because my GC is not optimized for
</I>&gt;<i> short-lived values. Objectively, F# should not box tuples either. In fact,
</I>&gt;<i> if
</I>&gt;<i> Mono implemented TCO and structs correctly and its own F# then it could
</I>&gt;<i> unbox
</I>&gt;<i> tuples and would see huge performance improvements as a consequence.
</I>&gt;<i>
</I>
What's wrong with the way mono implement structs?



By the way, guys, the mono community is very welcoming to both external
contribution
and feedback. So if you guys make a compelling case for TCO, maybe Miguel
can get
someone to have it fixed.

Cheers,
Rodrigo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20100130/c696cebd/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20100130/c696cebd/attachment.html</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="044363.html">[Mono-list] mono performance,	20x differential with Java (what am i doing wrong)
</A></li>
	<LI>Next message: <A HREF="044365.html">[Mono-list] mono performance,	20x differential with Java (what am 	i doing wrong)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44364">[ date ]</a>
              <a href="thread.html#44364">[ thread ]</a>
              <a href="subject.html#44364">[ subject ]</a>
              <a href="author.html#44364">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
