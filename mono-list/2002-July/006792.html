<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] [PATCH] String literals
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:adb%40tardis.ed.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="006794.html">
   <LINK REL="Next"  HREF="006807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] [PATCH] String literals
   </H1>
    <B>Andrew Birkett
    </B> 
    <A HREF="mailto:adb%40tardis.ed.ac.uk"
       TITLE="[Mono-list] [PATCH] String literals">adb@tardis.ed.ac.uk
       </A><BR>
    <I>Fri, 5 Jul 2002 18:16:43 +0100 (BST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="006794.html">[Mono-list] question on how mono looks like
</A></li>
        <LI> Next message: <A HREF="006807.html">[Mono-list] [PATCH] String literals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6792">[ date ]</a>
              <a href="thread.html#6792">[ thread ]</a>
              <a href="subject.html#6792">[ subject ]</a>
              <a href="author.html#6792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to <A HREF="mailto:mime@docserver.cac.washington.edu">mime@docserver.cac.washington.edu</A> for more info.

---559023410-851401618-1025889403=:10286
Content-Type: TEXT/PLAIN; charset=US-ASCII

Hi,

This patch does the following:

  - makes mcs reject newlines in (non-verbatim) string literals
  - Ensures that '@' is followed immediately by a string or an identifier
  - Reports an error when EOF is found in a string constant.
  - Adds a new test to tests/test-74.cs

The attached patch applies correctly on cygwin and solaris, so hopefully
no cr/lf woes.  I've also included a tarball with three new files for
mcs/errors which check for the above errors.  Hmm, but no changelog entry
in there yet.

I can commit these to CVS myself if you want.

Andrew

- www.tardis.ed.ac.uk/~adb -

---559023410-851401618-1025889403=:10286
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=string-lit-patch
Content-Transfer-Encoding: BASE64
Content-ID: &lt;<A HREF="mailto:Pine.GS4.4.33.0207051816430.10286@davros.tardis.ed.ac.uk">Pine.GS4.4.33.0207051816430.10286@davros.tardis.ed.ac.uk</A>&gt;
Content-Description: Patch for mcs/cs-tokenizer.cs for string lits
Content-Disposition: attachment; filename=string-lit-patch

SW5kZXg6IG1jcy9jcy10b2tlbml6ZXIuY3MNCj09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT0NClJDUyBmaWxlOiAvbW9uby9tY3MvbWNzL2NzLXRva2VuaXplci5j
cyx2DQpyZXRyaWV2aW5nIHJldmlzaW9uIDEuNTcNCmRpZmYgLXUgLXIxLjU3
IGNzLXRva2VuaXplci5jcw0KLS0tIG1jcy9jcy10b2tlbml6ZXIuY3MJNCBK
dWwgMjAwMiAxODoyMDoxMCAtMDAwMAkxLjU3DQorKysgbWNzL2NzLXRva2Vu
aXplci5jcwk1IEp1bCAyMDAyIDE2OjQ4OjI4IC0wMDAwDQpAQCAtMTAzNCwx
MyArMTAzNCwxMyBAQA0KIAkJCQkJcmV0dXJuIGZhbHNlOw0NCiAJCQkJfQ0N
CiAJCQkJDQ0KLQkJCQlpZiAoQ2hhci5Jc0xldHRlciAoYykgfHwgYyA9PSAn
Xycpew0NCisJCQkJaWYgKGlzX2lkZW50aWZpZXJfc3RhcnRfY2hhcmFjdGVy
KGMpKXsNDQogCQkJCQlpbnQgaiA9IDE7DQ0KIA0NCiAJCQkJCXdoaWxlIChq
IDwgbGVuKXsNDQogCQkJCQkJYyA9IHMgW2pdOw0NCiAJCQkJCQkNDQotCQkJ
CQkJaWYgKENoYXIuSXNMZXR0ZXIgKGMpIHx8IENoYXIuSXNEaWdpdCAoYykg
fHwgYyA9PSAnXycpew0NCisJCQkJCQlpZiAoaXNfaWRlbnRpZmllcl9wYXJ0
X2NoYXJhY3RlcihjKSl7DQ0KIAkJCQkJCQlqKys7DQ0KIAkJCQkJCQljb250
aW51ZTsNDQogCQkJCQkJfQ0NCkBAIC0xMzM5LDQ5ICsxMzM5LDg0IEBADQog
DQ0KIAkJCVJlcG9ydC5FcnJvciAoMTAyNCwgTG9jYXRpb24sICJQcmVwcm9j
ZXNzb3IgZGlyZWN0aXZlIGV4cGVjdGVkIChnb3Q6ICIgKyBjbWQgKyAiKSIp
Ow0NCiAJCQlyZXR1cm4gdHJ1ZTsNDQorDQ0KKwkJfQ0NCisNDQorCQlwcml2
YXRlIGludCBjb25zdW1lX3N0cmluZyhib29sIHF1b3RlZCkgDQ0KKwkJew0N
CisJCQlpbnQgYzsNDQorCQkJc3RyaW5nX2J1aWxkZXIuTGVuZ3RoID0gMDsN
DQorCQkJCQkJCQkNDQorCQkJd2hpbGUgKChjID0gZ2V0Q2hhciAoKSkgIT0g
LTEpew0NCisJCQkJaWYgKGMgPT0gJyInKXsNDQorCQkJCQlpZiAocXVvdGVk
ICYmIHBlZWtDaGFyICgpID09ICciJyl7DQ0KKwkJCQkJCXN0cmluZ19idWls
ZGVyLkFwcGVuZCAoKGNoYXIpIGMpOw0NCisJCQkJCQlnZXRDaGFyICgpOw0N
CisJCQkJCQljb250aW51ZTsNDQorCQkJCQl9IGVsc2Ugew0NCisJCQkJCQl2
YWwgPSBzdHJpbmdfYnVpbGRlci5Ub1N0cmluZyAoKTsNDQorCQkJCQkJcmV0
dXJuIFRva2VuLkxJVEVSQUxfU1RSSU5HOw0NCisJCQkJCX0NDQorCQkJCX0N
DQorDQ0KKwkJCQlpZiAoYyA9PSAnXG4nICYmICFxdW90ZWQpIHsNDQorCQkJ
CQlSZXBvcnQuRXJyb3IoMTAxMCwgTG9jYXRpb24sICJOZXdsaW5lIGluIGNv
bnN0YW50Iik7DQ0KKwkJCQl9DQ0KKw0NCisJCQkJaWYgKCFxdW90ZWQpew0N
CisJCQkJCWMgPSBlc2NhcGUgKGMpOw0NCisJCQkJCWlmIChjID09IC0xKQ0N
CisJCQkJCQlyZXR1cm4gVG9rZW4uRVJST1I7DQ0KKwkJCQl9DQ0KKwkJCQlz
dHJpbmdfYnVpbGRlci5BcHBlbmQgKChjaGFyKSBjKTsNDQorCQkJfQ0NCisN
DQorCQkJUmVwb3J0LkVycm9yICgxMDM5LCBMb2NhdGlvbiwgIlVudGVybWlu
YXRlZCBzdHJpbmcgbGl0ZXJhbCIpOw0NCisJCQlyZXR1cm4gVG9rZW4uRU9G
Ow0NCisJCX0NDQorDQ0KKwkJcHJpdmF0ZSBpbnQgY29uc3VtZV9pZGVudGlm
aWVyKGludCBjLCBib29sIHF1b3RlZCkgDQ0KKwkJew0NCisJCQlpZF9idWls
ZGVyLkxlbmd0aCA9IDA7DQ0KKw0NCisJCQlpZF9idWlsZGVyLkFwcGVuZCAo
KGNoYXIpIGMpOw0NCisJCQkJCQ0NCisJCQl3aGlsZSAoKGMgPSBwZWVrQ2hh
ciAoKSkgIT0gLTEpIHsNDQorCQkJCWlmIChpc19pZGVudGlmaWVyX3BhcnRf
Y2hhcmFjdGVyICgoY2hhcikgYykpew0NCisJCQkJCWlkX2J1aWxkZXIuQXBw
ZW5kICgoY2hhcilnZXRDaGFyICgpKTsNDQorCQkJCQljb2wrKzsNDQorCQkJ
CX0gZWxzZSANDQorCQkJCQlicmVhazsNDQorCQkJfQ0NCisJCQkJCQ0NCisJ
CQlzdHJpbmcgaWRzID0gaWRfYnVpbGRlci5Ub1N0cmluZyAoKTsNDQorDQ0K
KwkJCWlmICghaXNfa2V5d29yZCAoaWRzKSB8fCBxdW90ZWQpIHsNDQorCQkJ
CXZhbCA9IGlkczsNDQorCQkJCWlmIChpZHMuTGVuZ3RoID4gNTEyKXsNDQor
CQkJCQlSZXBvcnQuRXJyb3IgKA0NCisJCQkJCQk2NDUsIExvY2F0aW9uLA0N
CisJCQkJCQkiSWRlbnRpZmllciB0b28gbG9uZyAobGltaXQgaXMgNTEyIGNo
YXJzKSIpOw0NCisJCQkJfQ0NCisJCQkJcmV0dXJuIFRva2VuLklERU5USUZJ
RVI7DQ0KKwkJCX0NDQorDQ0KKwkJCS8vIHRydWUsIGZhbHNlIGFuZCBudWxs
IGFyZSBpbiB0aGUgaGFzaCBhbnl3YXkuDQ0KKwkJCXJldHVybiBHZXRLZXl3
b3JkIChpZHMpOw0NCiAJCX0NDQogCQkNDQogCQlwdWJsaWMgaW50IHh0b2tl
biAoKQ0NCiAJCXsNDQogCQkJaW50IHQ7DQ0KLQkJCWJvb2wgYWxsb3dfa2V5
d29yZF9hc19pZGVudCA9IGZhbHNlOw0NCiAJCQlib29sIGRvcmVhZCA9IGZh
bHNlOw0NCiAJCQlpbnQgYzsNDQogDQ0KIAkJCXZhbCA9IG51bGw7DQ0KIAkJ
CS8vIG9wdGltaXphdGlvbjogZWxpbWluYXRlIGNvbCBhbmQgaW1wbGVtZW50
ICNkaXJlY3RpdmUgc2VtYW50aWMgY29ycmVjdGx5Lg0NCiAJCQlmb3IgKDso
YyA9IGdldENoYXIgKCkpICE9IC0xOyBjb2wrKykgew0NCi0JCQkJaWYgKENo
YXIuSXNMZXR0ZXIgKChjaGFyKWMpIHx8IGMgPT0gJ18nKXsNDQotCQkJCQlz
dHJpbmcgaWRzOw0NCi0NDQotCQkJCQlpZF9idWlsZGVyLkxlbmd0aCA9IDA7
DQ0KKwkJCQlpZiAoaXNfaWRlbnRpZmllcl9zdGFydF9jaGFyYWN0ZXIoKGNo
YXIpYykpew0NCiAJCQkJCXRva2Vuc19zZWVuID0gdHJ1ZTsNDQotCQkJCQlp
ZF9idWlsZGVyLkFwcGVuZCAoKGNoYXIpIGMpOw0NCi0JCQkJCQ0NCi0JCQkJ
CXdoaWxlICgoYyA9IHBlZWtDaGFyICgpKSAhPSAtMSkgew0NCi0JCQkJCQlp
ZiAoaXNfaWRlbnRpZmllcl9wYXJ0X2NoYXJhY3RlciAoKGNoYXIpIGMpKXsN
DQotCQkJCQkJCWlkX2J1aWxkZXIuQXBwZW5kICgoY2hhcilnZXRDaGFyICgp
KTsNDQotCQkJCQkJCWNvbCsrOw0NCi0JCQkJCQl9IGVsc2UgDQ0KLQkJCQkJ
CQlicmVhazsNDQotCQkJCQl9DQ0KLQkJCQkJDQ0KLQkJCQkJaWRzID0gaWRf
YnVpbGRlci5Ub1N0cmluZyAoKTsNDQotDQ0KLQkJCQkJaWYgKCFpc19rZXl3
b3JkIChpZHMpIHx8IGFsbG93X2tleXdvcmRfYXNfaWRlbnQpIHsNDQotCQkJ
CQkJdmFsID0gaWRzOw0NCi0JCQkJCQlpZiAoaWRzLkxlbmd0aCA+IDUxMil7
DQ0KLQkJCQkJCQlSZXBvcnQuRXJyb3IgKA0NCi0JCQkJCQkJCTY0NSwgTG9j
YXRpb24sDQ0KLQkJCQkJCQkJIklkZW50aWZpZXIgdG9vIGxvbmcgKGxpbWl0
IGlzIDUxMiBjaGFycykiKTsNDQotCQkJCQkJfQ0NCi0JCQkJCQlhbGxvd19r
ZXl3b3JkX2FzX2lkZW50ID0gZmFsc2U7DQ0KLQkJCQkJCXJldHVybiBUb2tl
bi5JREVOVElGSUVSOw0NCi0JCQkJCX0NDQotDQ0KLQkJCQkJLy8gdHJ1ZSwg
ZmFsc2UgYW5kIG51bGwgYXJlIGluIHRoZSBoYXNoIGFueXdheS4NDQotCQkJ
CQlyZXR1cm4gR2V0S2V5d29yZCAoaWRzKTsNDQotDQ0KKwkJCQkJcmV0dXJu
IGNvbnN1bWVfaWRlbnRpZmllcihjLCBmYWxzZSk7DQ0KIAkJCQl9DQ0KIA0N
CiAJCQkJaWYgKGMgPT0gJy4nKXsNDQpAQCAtMTQ3NywzMCArMTUxMiw4IEBA
DQogCQkJCQlyZXR1cm4gdDsNDQogCQkJCX0NDQogCQkJCQ0NCi0JCQkJaWYg
KGMgPT0gJyInKXsNDQotCQkJCQlzdHJpbmdfYnVpbGRlci5MZW5ndGggPSAw
Ow0NCi0JCQkJCQ0NCi0JCQkJCXRva2Vuc19zZWVuID0gdHJ1ZTsNDQotCQkJ
CQkNDQotCQkJCQl3aGlsZSAoKGMgPSBnZXRDaGFyICgpKSAhPSAtMSl7DQ0K
LQkJCQkJCWlmIChjID09ICciJyl7DQ0KLQkJCQkJCQlpZiAoYWxsb3dfa2V5
d29yZF9hc19pZGVudCAmJiBwZWVrQ2hhciAoKSA9PSAnIicpew0NCi0JCQkJ
CQkJCXN0cmluZ19idWlsZGVyLkFwcGVuZCAoKGNoYXIpIGMpOw0NCi0JCQkJ
CQkJCWdldENoYXIgKCk7DQ0KLQkJCQkJCQkJY29udGludWU7DQ0KLQkJCQkJ
CQl9IA0NCi0JCQkJCQkJYWxsb3dfa2V5d29yZF9hc19pZGVudCA9IGZhbHNl
Ow0NCi0JCQkJCQkJdmFsID0gc3RyaW5nX2J1aWxkZXIuVG9TdHJpbmcgKCk7
DQ0KLQkJCQkJCQlyZXR1cm4gVG9rZW4uTElURVJBTF9TVFJJTkc7DQ0KLQkJ
CQkJCX0NDQotDQ0KLQkJCQkJCWlmICghYWxsb3dfa2V5d29yZF9hc19pZGVu
dCl7DQ0KLQkJCQkJCQljID0gZXNjYXBlIChjKTsNDQotCQkJCQkJCWlmIChj
ID09IC0xKQ0NCi0JCQkJCQkJCXJldHVybiBUb2tlbi5FUlJPUjsNDQotCQkJ
CQkJfQ0NCi0JCQkJCQlzdHJpbmdfYnVpbGRlci5BcHBlbmQgKChjaGFyKSBj
KTsNDQotCQkJCQl9DQ0KKwkJCQlpZiAoYyA9PSAnIicpIHsNDQorCQkJCQly
ZXR1cm4gY29uc3VtZV9zdHJpbmcoZmFsc2UpOw0NCiAJCQkJfQ0NCiANDQog
CQkJCWlmIChjID09ICdcJycpew0NCkBAIC0xNTQ5LDEwICsxNTYyLDE2IEBA
DQogCQkJCQljb250aW51ZTsNDQogCQkJCX0NDQogDQ0KLQkJCQlpZiAoYyA9
PSAnQCcpew0NCi0JCQkJCXRva2Vuc19zZWVuID0gdHJ1ZTsNDQotCQkJCQlh
bGxvd19rZXl3b3JkX2FzX2lkZW50ID0gdHJ1ZTsNDQotCQkJCQljb250aW51
ZTsNDQorCQkJCWlmIChjID09ICdAJykgew0NCisJCQkJCWMgPSBnZXRDaGFy
KCk7DQ0KKwkJCQkJaWYgKGMgPT0gJyInKSB7DQ0KKwkJCQkJCXRva2Vuc19z
ZWVuID0gdHJ1ZTsNDQorCQkJCQkJcmV0dXJuIGNvbnN1bWVfc3RyaW5nKHRy
dWUpOw0NCisJCQkJCX0gZWxzZSBpZiAoaXNfaWRlbnRpZmllcl9zdGFydF9j
aGFyYWN0ZXIoKGNoYXIpIGMpKXsNDQorCQkJCQkJcmV0dXJuIGNvbnN1bWVf
aWRlbnRpZmllcihjLCB0cnVlKTsNDQorCQkJCQl9IGVsc2Ugew0NCisJCQkJ
CQlSZXBvcnQuRXJyb3IoMTAzMywgTG9jYXRpb24sICInQCcgbXVzdCBiZSBm
b2xsb3dlZCBieSBzdHJpbmcgY29uc3RhbnQgb3IgaWRlbnRpZmllciIpOw0N
CisJCQkJCX0NDQogCQkJCX0NDQogDQ0KIAkJCQllcnJvcl9kZXRhaWxzID0g
KChjaGFyKWMpLlRvU3RyaW5nICgpOw0NCkluZGV4OiB0ZXN0cy90ZXN0LTc0
LmNzDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09DQpSQ1MgZmlsZTogL21vbm8v
bWNzL3Rlc3RzL3Rlc3QtNzQuY3Msdg0KcmV0cmlldmluZyByZXZpc2lvbiAx
LjINCmRpZmYgLXUgLXIxLjIgdGVzdC03NC5jcw0KLS0tIHRlc3RzL3Rlc3Qt
NzQuY3MJMjUgRmViIDIwMDIgMjA6MTc6MDAgLTAwMDAJMS4yDQorKysgdGVz
dHMvdGVzdC03NC5jcwk1IEp1bCAyMDAyIDE2OjQ4OjI4IC0wMDAwDQpAQCAt
MTcsNiArMTcsMTMgQEANCiAJCQlyZXR1cm4gMTsNCiAJCWlmIChlICE9IGYp
DQogCQkJcmV0dXJuIDI7DQorDQorCQlzdHJpbmcgZyA9ICJIZWxsb1xud29y
bGQiOw0KKwkJc3RyaW5nIGggPSBAIkhlbGxvDQord29ybGQiOw0KKwkJaWYg
KGcgIT0gaCkgDQorCQkJcmV0dXJuIDM7DQorDQogCQlyZXR1cm4gMDsNCiAJ
fQ0KIH0NCg==
---559023410-851401618-1025889403=:10286
Content-Type: APPLICATION/octet-stream; name=&quot;string-lit-newfiles.tgz&quot;
Content-Transfer-Encoding: BASE64
Content-ID: &lt;<A HREF="mailto:Pine.GS4.4.33.0207051816431.10286@davros.tardis.ed.ac.uk">Pine.GS4.4.33.0207051816431.10286@davros.tardis.ed.ac.uk</A>&gt;
Content-Description: New tests for mcs/errors for string literal handling
Content-Disposition: attachment; filename=&quot;string-lit-newfiles.tgz&quot;

H4sIAAAAAAAAC+3WQUvDMBjG8V4N5Du87qQX27Rdh4gwb552E7x2bToCXQJJ
pIj43X23iRNRcIe1l+d3KQ2hNIF/Wu298yFtgspUdtOE5Az4yVlVlknGFtX+
yiNqf7+jFI8t5koVuZoXFc8vVZ4nlJ3jZX56CbH2RMlDuzXWhOjr6Pwv81bO
6jHeZ2RpSis99MZqMpYaZ3k7bJRCiqavQ6BnKd6kuODRaBri7TF2Q4Huafao
+95JMTjft5ezOynep14LnE4f+y+KqfrPj/0vCnXof47+x8D9L2nLm0BrTZ3j
pAfd0vqVZnTlPJlW22g6o/3114lAfx0JS9qdAlJMvSb4v+/9307Vf1Yd+68O
3/+yQP9j4P6fbNSeF19HLv8z51N+BDrnpl4FAAAAAAAAAAAAAAAAAAB8AAKj
rXkAKAAA
---559023410-851401618-1025889403=:10286--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="006794.html">[Mono-list] question on how mono looks like
</A></li>
	<LI> Next message: <A HREF="006807.html">[Mono-list] [PATCH] String literals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6792">[ date ]</a>
              <a href="thread.html#6792">[ thread ]</a>
              <a href="subject.html#6792">[ subject ]</a>
              <a href="author.html#6792">[ author ]</a>
         </LI>
       </UL>
</body></html>
