<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Announce: A .NET assembly -&gt; native code generation tool (ala ngen for MONO)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lupus%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="007376.html">
   <LINK REL="Next"  HREF="007390.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Announce: A .NET assembly -&gt; native code generation tool (ala ngen for MONO)
   </H1>
    <B>Paolo Molaro
    </B> 
    <A HREF="mailto:lupus%40ximian.com"
       TITLE="[Mono-list] Announce: A .NET assembly -&gt; native code generation tool (ala ngen for MONO)">lupus@ximian.com
       </A><BR>
    <I>Mon, 29 Jul 2002 12:34:02 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="007376.html">[Mono-list] Announce: A .NET assembly -&gt; native code generation
 tool (ala ngen for MONO)
</A></li>
        <LI> Next message: <A HREF="007390.html">[Mono-list] Announce: A .NET assembly -&gt; native code generation
 tool (ala ngen for MONO)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7381">[ date ]</a>
              <a href="thread.html#7381">[ thread ]</a>
              <a href="subject.html#7381">[ subject ]</a>
              <a href="author.html#7381">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/29/02 Dietmar Maurer wrote:
&gt;<i>         1. It does not work with exceptions: The current code is
</I>&gt;<i>            incorrect because it does not save/restore the LMF when
</I>&gt;<i>            calling precompiled methods - but saving/restoring the LMF
</I>&gt;<i>            would lead to serious performance problems.
</I>
As long as the native code doesn't handle exceptions, the only info
needed is registering the method code address and size, there is no need
to save/restore the LMF, right? I saw the code that uses objdump, so
maybe this is already handled.
Actually, if this turns out to work, we may want to use it also for the
internalcalls.

&gt;<i> &gt; What I wanted to look into was to use the JIT to generate code that
</I>&gt;<i> &gt; would end up in a library, basically reusing the JIT, but turning on all
</I>&gt;<i> &gt; the optimizations for this.
</I>&gt;<i> This approach would also avoid much code duplication. 
</I>&gt;<i> 
</I>&gt;<i> So IMO we should first check if we gain anything by using gcc, and of
</I>&gt;<i> course we need a solution for the exception problem? 
</I>
I think the approach of using gcc is certainly interesting even if the
first snapshot has limitations.
The primary purpouse of ngen-ed assemblies is to reduce startup and JIT
costs (microsoft itself documents ngen-assemblies being slower code-wise
than jitted code...). Of course, performance is an bonus:-), but I'm
very impressed with the first snapshot.

The gain in mcs compilation times, for example, seems to match
pretty well with the jit overhead as measured with mono --profile.
And, of course, mcs is not a good benchmark for native code quality.

Of the current limitations, the .ovf opcodes seems only a matter of
(boring) programming, mostly. The exception handling stuff is certainly
harder and if done using the C++ exception tables, it will
require porting efforts between different compilers. However, I just
checked and methods with exception tables are less than 7% in mcs and
less than 2% in corlib, so even if 5% of the methods still need to be
jitted, it's not a big problem.

My main concern with using gcc is that we might not be able to constrain
the gcc optimizer to obey the CLR rules (Zoltan notes the problem with
division by 0, for example). Using the JIT to output the code would give
us better control on such issues, but researching these issues is the
only way to find out if the concept works:-)

lupus

-- 
-----------------------------------------------------------------
<A HREF="mailto:lupus@debian.org">lupus@debian.org</A>                                     debian/rules
<A HREF="mailto:lupus@ximian.com">lupus@ximian.com</A>                             Monkeys do it better


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="007376.html">[Mono-list] Announce: A .NET assembly -&gt; native code generation
 tool (ala ngen for MONO)
</A></li>
	<LI> Next message: <A HREF="007390.html">[Mono-list] Announce: A .NET assembly -&gt; native code generation
 tool (ala ngen for MONO)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7381">[ date ]</a>
              <a href="thread.html#7381">[ thread ]</a>
              <a href="subject.html#7381">[ subject ]</a>
              <a href="author.html#7381">[ author ]</a>
         </LI>
       </UL>
</body></html>
