<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Announce: A .NET assembly -&gt; native code
 generationtool (ala ngen for MONO)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:dietmar%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="007392.html">
   <LINK REL="Next"  HREF="007421.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Announce: A .NET assembly -&gt; native code
 generationtool (ala ngen for MONO)
   </H1>
    <B>Dietmar Maurer
    </B> 
    <A HREF="mailto:dietmar%40ximian.com"
       TITLE="[Mono-list] Announce: A .NET assembly -&gt; native code
 generationtool (ala ngen for MONO)">dietmar@ximian.com
       </A><BR>
    <I>29 Jul 2002 17:22:56 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="007392.html">[Mono-list] Announce: A .NET assembly -&gt; native code generationtool (ala ngen for MONO)
</A></li>
        <LI> Next message: <A HREF="007421.html">[Mono-list] Announce: A .NET assembly -&gt; native code generationtool (ala ngen for MONO)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7396">[ date ]</a>
              <a href="thread.html#7396">[ thread ]</a>
              <a href="subject.html#7396">[ subject ]</a>
              <a href="author.html#7396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2002-07-29 at 15:30, <A HREF="mailto:Zoltan.2.Varga@nokia.com">Zoltan.2.Varga@nokia.com</A> wrote:
&gt;<i> If there is concern whenever this will be the 'real' MONO ngen, I would gladly name it something else. Any ideas?
</I>&gt;<i> 
</I>&gt;<i> &gt; Unfortunately the current patch is much to large to integrate. What we
</I>&gt;<i> &gt; need is a bunch of smaller patches which we can integrate into our
</I>&gt;<i> &gt; codebase.
</I>&gt;<i> 
</I>&gt;<i> I plan on maintaining the code whenever its integrated into MONO CVS or not. The current patch is 600 lines long 
</I>&gt;<i> (this includes the context added by diff) + the two new files (ngen-runtime.{c,h}). It includes the following:
</I>&gt;<i> 
</I>&gt;<i>   ngen-runtime.{c,h} - this does the loading and linking in of native assemblies
</I>&gt;<i>   appdomain.h        - adds a new field to MonoJitInfo
</I>&gt;<i>   assembly.{c,h}     - adds a callback function which will be called when an assembly is loaded
</I>&gt;<i>   exception.c        - adds exception handling for native methods (hackish)
</I>&gt;<i>   mono.c             - adds additional command line arguments + installs the native assembly loading callback
</I>&gt;<i>   trampoline.c       - adds a new trampoline which can be called by the native methods + adds a new argument to
</I>&gt;<i>                        x86_magic_trampoline so it can read the receiver off the stack
</I>&gt;<i>   
</I>&gt;<i>   There are two bug fixes/improvements in the patch:
</I>&gt;<i>    reflection.c      - speed up mono_type_get_object which seems to be called a lot
</I>&gt;<i>    trampoline.c      - the arch_get_trampoline function sometimes returns a pointer to JIT generated code instead of a 
</I>&gt;<i> 			     trampoline. This is wrong if the returned pointer is put into a vtable. This is not happening 				     currently, but I think it is by coincidence not by design :).
</I>&gt;<i> 
</I>
Your patch contains many changes, an I would prefer to integrate them
step by step. For example the get_type speedup code is totally
unrelated. Or that callback function on assembly load.

I don't understand some comments, for example why is it wrong if the
get_trampoline returns final code instead of the trampoline? Any why do
we need another trampoline?

IMO we cant integrate things like the (hackish) exception handling, or
anything that make maintaining/porting more complex. Everything else can
be integrated.

Maybe you can use a LMF before calling gcc generated code (simply call
them like internal calls). It would be interesting to test if
performance gets really worse. If not we can use that approach and dump
the ugly exception hack.

- Dietmar



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="007392.html">[Mono-list] Announce: A .NET assembly -&gt; native code generationtool (ala ngen for MONO)
</A></li>
	<LI> Next message: <A HREF="007421.html">[Mono-list] Announce: A .NET assembly -&gt; native code generationtool (ala ngen for MONO)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7396">[ date ]</a>
              <a href="thread.html#7396">[ thread ]</a>
              <a href="subject.html#7396">[ subject ]</a>
              <a href="author.html#7396">[ author ]</a>
         </LI>
       </UL>
</body></html>
