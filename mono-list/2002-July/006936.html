<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Re: [Mono-bugs] Hi.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:stodden%40in.tum.de">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="006924.html">
   <LINK REL="Next"  HREF="006939.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Re: [Mono-bugs] Hi.
   </H1>
    <B>Daniel Stodden
    </B> 
    <A HREF="mailto:stodden%40in.tum.de"
       TITLE="[Mono-list] Re: [Mono-bugs] Hi.">stodden@in.tum.de
       </A><BR>
    <I>12 Jul 2002 00:34:53 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="006924.html">[Mono-list] Re: [Mono-bugs] Hi.
</A></li>
        <LI> Next message: <A HREF="006939.html">[Mono-list] Re: [Mono-bugs] Hi.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6936">[ date ]</a>
              <a href="thread.html#6936">[ thread ]</a>
              <a href="subject.html#6936">[ subject ]</a>
              <a href="author.html#6936">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 2002-07-11 at 09:11, Nick Drochak wrote:
&gt;<i> | -----Original Message-----
</I>&gt;<i> | From: <A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A> [mailto:<A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A>]On
</I>&gt;<i> | Behalf Of Dietmar Maurer
</I>&gt;<i> | Sent: Thursday, July 11, 2002 3:22 PM
</I>&gt;<i> |
</I>&gt;<i> | On Thu, 2002-07-11 at 06:52, Yuan-Fen Eric Kuo || 郭源汾 wrote:
</I>&gt;<i> | &gt; I am new to the thread so please forgive me if it has been 
</I>&gt;<i> | discussed or I
</I>&gt;<i> | &gt; have missed some points somewhere.
</I>&gt;<i> | &gt; 
</I>&gt;<i> | &gt; It seems that delegate invokes the methods in the reversed order as they
</I>&gt;<i> | &gt; were combined. According to MS's Spec.  isn't it supposed to 
</I>&gt;<i> | invoke methods
</I>&gt;<i> | &gt; from the left to right of the operator?
</I>&gt;<i> | 
</I>&gt;<i> | Yes, I think we should not reverse the order. Do you have some tests to
</I>&gt;<i> | show that behavior? 
</I>&gt;<i> 
</I>&gt;<i> I just read in a few of places over the past couple of days that the order is not guaranteed and one should not depend on it.
</I>&gt;<i> 
</I>&gt;<i> Does someone have information otherwise?
</I>
i can assure you the order should be guaranteed, the same order in which
the individual combination of addition/removal suggests. 
just what one would expect.

same goes for MS. the documentation remains comparably precise in this
respect, once you've sorted out the blurry stuff (the MS class design
isn't all that well).

haven't looked again into it for quite some time now. though, i can't
replicate above problem just by trying from simple examples.

maybe the original question derived from browsing the source code?
mono keeps multicastdelegate chains linked in a recursive manner, i.e.
each multicastdelegate simply keeps a single link to another one or null
(as opposed to encapsulated arraylists or whatever).
the internal chaining is indeed _reverted_. i.e. the internal link is a
prev-pointer, not a next pointer.

why? removal. consider removing an invocation chain from another. now
the fun part is that not the first occurence of the list to remove is
removed but the _last_ occurence.

might have originated at MS from a side effect. but it's documented in
the class docs nonetheless.
removals are therefore implemented in mono by reverting the internal
order for speed. ::Invoke() then recurses depth-first through the chain,
which gets you back to the expected order during invocation. eats up
some stack space, but i can't think of a more elegant way.

summary, for a bundle of delegates of type foo(int):

(a + b + c)(42) invokes a -&gt; b -&gt; c.

(a + b + c - b)(42) invokes a -&gt; c.

(a + b + c + a + b - (a + b))(42) 
invokes a -&gt; b -&gt; c, not c -&gt; a -&gt; b.

ever.

i've spent quite some time until i got this right. pleaso drop me a note
if any problems arise. i remember having checked in unit tests for this,
though.

regards,
dns

-- 
___________________________________________________________________________
 mailto:<A HREF="mailto:stodden@in.tum.de">stodden@in.tum.de</A>



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="006924.html">[Mono-list] Re: [Mono-bugs] Hi.
</A></li>
	<LI> Next message: <A HREF="006939.html">[Mono-list] Re: [Mono-bugs] Hi.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6936">[ date ]</a>
              <a href="thread.html#6936">[ thread ]</a>
              <a href="subject.html#6936">[ subject ]</a>
              <a href="author.html#6936">[ author ]</a>
         </LI>
       </UL>
</body></html>
