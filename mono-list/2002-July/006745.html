<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Problem with while loop and Main returning void
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:dietmar%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="006743.html">
   <LINK REL="Next"  HREF="006748.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Problem with while loop and Main returning void
   </H1>
    <B>Dietmar Maurer
    </B> 
    <A HREF="mailto:dietmar%40ximian.com"
       TITLE="[Mono-list] Problem with while loop and Main returning void">dietmar@ximian.com
       </A><BR>
    <I>03 Jul 2002 09:48:29 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="006743.html">[Mono-list] Problem with while loop and Main returning void
</A></li>
        <LI> Next message: <A HREF="006748.html">[Mono-list] Problem with while loop and Main returning void
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6745">[ date ]</a>
              <a href="thread.html#6745">[ thread ]</a>
              <a href="subject.html#6745">[ subject ]</a>
              <a href="author.html#6745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This looks like a mcs bug. mcs don't generate a return statement at the
end of Main:

    .method public static 
           default void Main()  cil managed 
    {
        // Method begins at RVA 0x20f4
	.entrypoint
	// Code size 25 (0x19)
	.maxstack 8
	IL_0000: br IL_0005

	IL_0005: ldstr &quot;Breaking...&quot;
	IL_000a: call void class [corlib]System.Console::WriteLine(string)
	IL_000f: br IL_0019

	IL_0014: br IL_0005

    } // end of method default void Main() 

csc generates correct code wit a return at the end:

    .method public static  hidebysig 
           default void Main()  cil managed 
    {
        // Method begins at RVA 0x2050
	.entrypoint
	// Code size 17 (0x11)
	.maxstack 1
	IL_0000: br.s IL_000e

	IL_0002: ldstr &quot;Breaking...&quot;
	IL_0007: call void class [corlib]System.Console::WriteLine(string)
	IL_000c: br.s IL_0010

	IL_000e: br.s IL_0002

	IL_0010: ret 
    } // end of method default void Main() 

csc also generates much shorter code!

- Dietmar

On Wed, 2002-07-03 at 08:29, Leigh Dyer wrote:
&gt;<i> Hey guys,
</I>&gt;<i> 
</I>&gt;<i> I think I've found a minor bug in either mcs or the runtime. I was
</I>&gt;<i> writing a small app that has just has a Main() and a small while(true)
</I>&gt;<i> loop, with a break condition inside it. However, when I compiled my app
</I>&gt;<i> with mcs and ran it with mono, after breaking out of the while(true)
</I>&gt;<i> loop my program kept running - it seems to just keep re-running Main().
</I>&gt;<i> Running with mint exits at the end of the first run, but with a
</I>&gt;<i> &quot;Trace/breakpoint trap&quot; message.
</I>&gt;<i> 
</I>&gt;<i> However, if I change my Main() so that it returns int instead of void,
</I>&gt;<i> and add a &quot;return 0;&quot; to the end, everything works as expected.
</I>&gt;<i> 
</I>&gt;<i> I tried to isolate the problem with a small test case, and while it
</I>&gt;<i> doesn't exhibit exactly the same behaviour, it still doesn't work as
</I>&gt;<i> expected with Main() returning void - mint segfaults and mono returns
</I>&gt;<i> the following error:
</I>&gt;<i> 
</I>&gt;<i> ** (process:18686): WARNING (recursed) **: unhandled exception
</I>&gt;<i> System.NullReferenceException: &quot;A null value was found where an object
</I>&gt;<i> instance was required&quot;
</I>&gt;<i> 
</I>&gt;<i> RESULT: -1
</I>&gt;<i> 
</I>&gt;<i> and then needs to be sent a ctrl-c.
</I>&gt;<i> 
</I>&gt;<i> I'm running the mono CVS debs from <A HREF="http://www.atoker.com/mono/">http://www.atoker.com/mono/</A> as of
</I>&gt;<i> yesterday on a Debian sid system.
</I>&gt;<i> 
</I>&gt;<i> I've attached both my small test case and the original app (it's very
</I>&gt;<i> small - all it does is iterate over the bytes of a text file looking for
</I>&gt;<i> non-ascii chars) - I hope they're of some use.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> Leigh
</I>&gt;<i> ----
</I>&gt;<i> 
</I>
&gt;<i> using System;
</I>&gt;<i> 
</I>&gt;<i> public class BreakTest
</I>&gt;<i> {
</I>&gt;<i> 	public static void Main()
</I>&gt;<i> 	//public static int Main()
</I>&gt;<i> 	{
</I>&gt;<i> 		while(true)
</I>&gt;<i> 		{
</I>&gt;<i> 			Console.WriteLine(&quot;Breaking...&quot;);
</I>&gt;<i> 			break;
</I>&gt;<i> 		}
</I>&gt;<i> 		//return 0;
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i> ----
</I>&gt;<i> 
</I>
&gt;<i> using System;
</I>&gt;<i> using System.IO;
</I>&gt;<i> 
</I>&gt;<i> public class NonAscii
</I>&gt;<i> {
</I>&gt;<i> 	public static void Main(string[] args)
</I>&gt;<i> 	//public static int Main(string[] args)
</I>&gt;<i> 	{
</I>&gt;<i> 		FileStream s = new FileStream(args[0], FileMode.Open, FileAccess.Read);
</I>&gt;<i> 		int line=0, ch=0;
</I>&gt;<i> 		int x=0;
</I>&gt;<i> 		
</I>&gt;<i> 		while(true)
</I>&gt;<i> 		{
</I>&gt;<i> 			int c = s.ReadByte();
</I>&gt;<i> 			Console.WriteLine(&quot;char &quot; + x + &quot;: &quot; + c);
</I>&gt;<i> 			if(c == -1) break;
</I>&gt;<i> 
</I>&gt;<i> 			if(c == '\n')
</I>&gt;<i> 			{
</I>&gt;<i> 				line++; ch=0;
</I>&gt;<i> 			} else {
</I>&gt;<i> 				if(c &gt; 127)
</I>&gt;<i> 				{
</I>&gt;<i> 					Console.WriteLine(&quot;Non-ASCII char: line &quot; + line + &quot;, char &quot; + ch);
</I>&gt;<i> 				}
</I>&gt;<i> 				ch++;
</I>&gt;<i> 			}
</I>&gt;<i> 			x++;
</I>&gt;<i> 		}
</I>&gt;<i> 		//return 0;
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="006743.html">[Mono-list] Problem with while loop and Main returning void
</A></li>
	<LI> Next message: <A HREF="006748.html">[Mono-list] Problem with while loop and Main returning void
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6745">[ date ]</a>
              <a href="thread.html#6745">[ thread ]</a>
              <a href="subject.html#6745">[ subject ]</a>
              <a href="author.html#6745">[ author ]</a>
         </LI>
       </UL>
</body></html>
