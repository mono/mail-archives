<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] MCS -cppoutput C# to C++ generator work in progress
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:miguel%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="006771.html">
   <LINK REL="Next"  HREF="006781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] MCS -cppoutput C# to C++ generator work in progress
   </H1>
    <B>Miguel de Icaza
    </B> 
    <A HREF="mailto:miguel%40ximian.com"
       TITLE="[Mono-list] MCS -cppoutput C# to C++ generator work in progress">miguel@ximian.com
       </A><BR>
    <I>04 Jul 2002 14:17:52 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="006771.html">[Mono-list] MCS -cppoutput C# to C++ generator work in progress
</A></li>
        <LI> Next message: <A HREF="006781.html">[Mono-list] MCS -cppoutput C# to C++ generator work in progress
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6774">[ date ]</a>
              <a href="thread.html#6774">[ thread ]</a>
              <a href="subject.html#6774">[ subject ]</a>
              <a href="author.html#6774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello!

&gt;<i> Since porting last may's rev of mono to MSVC , I've been working on the C++
</I>&gt;<i> output module for mcs.  Basically, cppoutput.cs is added to the mcs core,
</I>&gt;<i> and from the parse tree generated by the main compiler, it generates a
</I>&gt;<i> compatible set of .cpp, .h, and .inl files complete with nice #line
</I>&gt;<i> directives for .cs debugging, and with the limited set of statements
</I>&gt;<i> compiling, it seems to work nicely.
</I>
I am not sure that you will be able to do a complete translator by using
the internal parse tree, as this parse tree is lacking the semantic
analysis phase.  

For instance, during the `DoResolve' phase, names are resolved to their
actual meaning.  For instance:

	A += X;

A could mean a number of things depending on its context.  An assignment
to field variable;  An assignment to a property;  An event addition or
even an error if A is a type. 

My suggestion would be to add a different &quot;Emit&quot; method to the Statement
and Expression base classes (EmitCpp) that would generate the code that
you want, but the resulting code would look less than C#, and more close
to the real internal representation.

Btw, someone could also write an EmitJava method, and for some cases
generate code for a JVM.

&gt;<i> I tweaked mono's and binary vtable representations to coexist with C++
</I>&gt;<i> efficiently so that mono could easily marshall and call c++ code as if it
</I>&gt;<i> was doing an &quot;internal_call&quot;, and c++ could call mono as well using
</I>&gt;<i> mono_execute().  The solution I came up with was to put mono's vtable
</I>&gt;<i> &quot;before&quot; the vtable structure, and the c++ vtable after it.   When you
</I>&gt;<i> inherit in C++ from the Object class, you automatically get a set of 6
</I>&gt;<i> vtable entries which reserve space in the C++ vtable for the mono vtable
</I>&gt;<i> structure.  That way mono objects are C++ objects, and vica-versa, and each
</I>&gt;<i> side conveniently marshals to the other transparently.
</I>
Pretty cool hack, I am reading with excitement the rest of your
message.  It looks really interesting.  

Miguel


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="006771.html">[Mono-list] MCS -cppoutput C# to C++ generator work in progress
</A></li>
	<LI> Next message: <A HREF="006781.html">[Mono-list] MCS -cppoutput C# to C++ generator work in progress
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6774">[ date ]</a>
              <a href="thread.html#6774">[ thread ]</a>
              <a href="subject.html#6774">[ subject ]</a>
              <a href="author.html#6774">[ author ]</a>
         </LI>
       </UL>
</body></html>
