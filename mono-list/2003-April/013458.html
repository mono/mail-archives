<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono 0.23 Bug in the method  System.IO.StringReader.Read
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:nosyryev%40attbi.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="013466.html">
   <LINK REL="Next"  HREF="013465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono 0.23 Bug in the method  System.IO.StringReader.Read
   </H1>
    <B>Igor Nosyryev
    </B> 
    <A HREF="mailto:nosyryev%40attbi.com"
       TITLE="[Mono-list] Mono 0.23 Bug in the method  System.IO.StringReader.Read">nosyryev@attbi.com
       </A><BR>
    <I>Sat, 19 Apr 2003 19:06:48 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="013466.html">[Mono-list] CVS status of
 System.Reflection.Emit.ILGenerator.EmitCall
</A></li>
        <LI> Next message: <A HREF="013465.html">[Mono-list] Mono 0.23 Bug in the method
 System.IO.StringReader.Read
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13458">[ date ]</a>
              <a href="thread.html#13458">[ thread ]</a>
              <a href="subject.html#13458">[ subject ]</a>
              <a href="author.html#13458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_0066_01C306A6.D3D81F40
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

This is absolutely right. But the error is still here. I just got wrong =
target :-) To fix it we need to change:

. . .
Array.Copy(sourceChars, nextChar, buffer, index, charsToRead );

nextChar +=3D count;
. . .

to

. . .
Array.Copy(sourceChars, nextChar, buffer, index, charsToRead );

nextChar +=3D charsToRead;
. . .

--------------------------
Igor Nosyryev
E-mail: <A HREF="mailto:nosyryev@attbi.com">nosyryev@attbi.com</A>
  ----- Original Message -----=20
  From: <A HREF="mailto:2a5gjx302@sneakemail.com">2a5gjx302@sneakemail.com</A>=20
  To: <A HREF="mailto:nosyryev@attbi.com">nosyryev@attbi.com</A>=20
  Sent: Saturday, April 19, 2003 5:07 PM
  Subject: Re: [Mono-list] Mono 0.23 Bug in the method =
System.IO.StringReader.Read


  At 04:11 PM 19/04/2003 -0400, you wrote:=20
  &gt;&gt;&gt;&gt;
  Class: System.IO.StringReader

  Method: public override int Read( char[] buffer, int index, int count =
)

  Problem:
  If there are no more characters (end-of-stream) call to this method =
generates the exception. But it should just return 0.

  CVS code:

  public override int Read( char[] buffer, int index, int count ) {

  CheckObjectDisposedException ();

  if( buffer =3D=3D null ) {
  throw new ArgumentNullException();
  } else if( buffer.Length - index &lt; count ) {
  throw new ArgumentException();
  } else if( index &lt; 0 || count &lt; 0 ) {
  throw new ArgumentOutOfRangeException();
  }

  int charsToRead;

  if( nextChar + count &gt; sourceLength ) {
  charsToRead =3D sourceLength - nextChar;
  } else {
  charsToRead =3D count;
  }

  Array.Copy(sourceChars, nextChar, buffer, index, charsToRead );

  nextChar +=3D count;

  return charsToRead;
  }

  Make change:

  public override int Read( char[] buffer, int index, int count ) {

  CheckObjectDisposedException ();

  if( buffer =3D=3D null ) {
  throw new ArgumentNullException();
  } else if( buffer.Length - index &lt; count ) {
  throw new ArgumentException();
  } else if( index &lt; 0 || count &lt; 0 ) {
  throw new ArgumentOutOfRangeException();
  }

  int charsToRead;

  if( nextChar + count &gt; sourceLength ) {
  charsToRead =3D sourceLength - nextChar;
  } else {
  charsToRead =3D count;
  }
  if(charsToRead &lt; 1) return 0;

  Array.Copy(sourceChars, nextChar, buffer, index, charsToRead );

  nextChar +=3D count;

  return charsToRead;
  }
  &lt;&lt;&lt;&lt;

  Based on the source code, and on where you inserted the check, it =
looks like the exception is occurring as a result of Array.Copy being =
passed a value of 0 as the number of elements to copy. If this is the =
case, then this is what is in error; Array.Copy should accept a value of =
0 for the number of elements to copy.

  Jonathan Gilbert

------=_NextPart_000_0066_01C306A6.D3D81F40
Content-Type: text/html;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META http-equiv=3DContent-Type content=3D&quot;text/html; =
charset=3Diso-8859-1&quot;&gt;
&lt;META content=3D&quot;MSHTML 6.00.2800.1141&quot; name=3DGENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=3D#ffffff&gt;
&lt;DIV&gt;&lt;FONT face=3DVerdana size=3D2&gt;This is absolutely right. But the =
error is still=20
here. I just got wrong target :-) To fix it we need to =
change:&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DVerdana size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot; size=3D2&gt;. . .&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot; size=3D2&gt;Array.Copy(sourceChars, =
nextChar, buffer,=20
index, charsToRead );&lt;BR&gt;&lt;BR&gt;nextChar +=3D count;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DVerdana size=3D2&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;. .=20
.&lt;BR&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/FONT&gt;
&lt;DIV&gt;&lt;FONT face=3DVerdana size=3D2&gt;to&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DVerdana size=3D2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot; size=3D2&gt;. . .&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot; size=3D2&gt;Array.Copy(sourceChars, =
nextChar, buffer,=20
index, charsToRead );&lt;BR&gt;&lt;BR&gt;nextChar +=3D &lt;FONT=20
color=3D#ff0000&gt;charsToRead&lt;/FONT&gt;;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=3D2&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;. . =
.&lt;BR&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=3D2&gt;&lt;FONT=20
face=3D&quot;Courier New&quot;&gt;--------------------------&lt;/DIV&gt;&lt;/FONT&gt;&lt;/FONT&gt;
&lt;DIV&gt;&lt;FONT face=3DVerdana size=3D2&gt;Igor Nosyryev&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3DVerdana size=3D2&gt;E-mail: &lt;/FONT&gt;&lt;A=20
href=3D&quot;mailto:<A HREF="mailto:nosyryev@attbi.com">nosyryev@attbi.com</A>&quot;&gt;&lt;FONT face=3DVerdana=20
size=3D2&gt;<A HREF="mailto:nosyryev@attbi.com">nosyryev@attbi.com</A>&lt;/FONT&gt;&lt;/A&gt;&lt;/DIV&gt;
&lt;BLOCKQUOTE=20
style=3D&quot;PADDING-RIGHT: 0px; PADDING-LEFT: 5px; MARGIN-LEFT: 5px; =
BORDER-LEFT: #000000 2px solid; MARGIN-RIGHT: 0px&quot;&gt;
  &lt;DIV style=3D&quot;FONT: 10pt arial&quot;&gt;----- Original Message ----- &lt;/DIV&gt;
  &lt;DIV=20
  style=3D&quot;BACKGROUND: #e4e4e4; FONT: 10pt arial; font-color: =
black&quot;&gt;&lt;B&gt;From:&lt;/B&gt;=20
  &lt;A title=<A HREF="mailto:3D2a5gjx302@sneakemail.com">3D2a5gjx302@sneakemail.com</A>=20
  href=3D&quot;mailto:<A HREF="mailto:2a5gjx302@sneakemail.com">2a5gjx302@sneakemail.com</A>&quot;&gt;<A HREF="mailto:2a5gjx302@sneakemail.com">2a5gjx302@sneakemail.com</A>&lt;/A&gt; =
&lt;/DIV&gt;
  &lt;DIV style=3D&quot;FONT: 10pt arial&quot;&gt;&lt;B&gt;To:&lt;/B&gt; &lt;A =
title=<A HREF="mailto:3Dnosyryev@attbi.com">3Dnosyryev@attbi.com</A>=20
  href=3D&quot;mailto:<A HREF="mailto:nosyryev@attbi.com">nosyryev@attbi.com</A>&quot;&gt;<A HREF="mailto:nosyryev@attbi.com">nosyryev@attbi.com</A>&lt;/A&gt; &lt;/DIV&gt;
  &lt;DIV style=3D&quot;FONT: 10pt arial&quot;&gt;&lt;B&gt;Sent:&lt;/B&gt; Saturday, April 19, 2003 =
5:07=20
  PM&lt;/DIV&gt;
  &lt;DIV style=3D&quot;FONT: 10pt arial&quot;&gt;&lt;B&gt;Subject:&lt;/B&gt; Re: [Mono-list] Mono =
0.23 Bug in=20
  the method System.IO.StringReader.Read&lt;/DIV&gt;
  &lt;DIV&gt;&lt;BR&gt;&lt;/DIV&gt;At 04:11 PM 19/04/2003 -0400, you wrote:=20
  &lt;BR&gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;BR&gt;&lt;?fontfamily&gt;&lt;?param Verdana&gt;&lt;?smaller&gt;Class:=20
  =
System.IO.StringReader&lt;BR&gt;&lt;?/smaller&gt;&lt;?/fontfamily&gt;&lt;BR&gt;&lt;?fontfamily&gt;&lt;?par=
am Verdana&gt;&lt;?smaller&gt;Method:=20
  public override int Read( char[] buffer, int index, int count =
)&lt;BR&gt;&lt;?/smaller&gt;&lt;?/fontfamily&gt;&lt;BR&gt;&lt;?fontfamily&gt;&lt;?param =
Verdana&gt;&lt;?smaller&gt;Problem:&lt;BR&gt;If=20
  there are no more characters (end-of-stream) call to this method =
generates the=20
  exception. But it should just return =
0.&lt;BR&gt;&lt;?/smaller&gt;&lt;?/fontfamily&gt;&lt;BR&gt;&lt;?fontfamily&gt;&lt;?param =
Verdana&gt;&lt;?smaller&gt;CVS=20
  code:&lt;BR&gt;&lt;?/smaller&gt;&lt;?/fontfamily&gt;&lt;BR&gt;&lt;?smaller&gt;public override int =
Read(=20
  char[] buffer, int index, int count )=20
  {&lt;BR&gt;&lt;?/smaller&gt;&lt;BR&gt;CheckObjectDisposedException ();&lt;BR&gt;&lt;BR&gt;if( buffer =
=3D=3D null=20
  ) {&lt;BR&gt;throw new ArgumentNullException();&lt;BR&gt;} else if( buffer.Length =
- index=20
  &amp;lt; count ) {&lt;BR&gt;throw new ArgumentException();&lt;BR&gt;} else if( index =
&amp;lt; 0 ||=20
  count &amp;lt; 0 ) {&lt;BR&gt;throw new =
ArgumentOutOfRangeException();&lt;BR&gt;}&lt;BR&gt;&lt;BR&gt;int=20
  charsToRead;&lt;BR&gt;&lt;BR&gt;if( nextChar + count &amp;gt; sourceLength ) =
{&lt;BR&gt;charsToRead=20
  =3D sourceLength - nextChar;&lt;BR&gt;} else {&lt;BR&gt;charsToRead =3D=20
  count;&lt;BR&gt;}&lt;BR&gt;&lt;BR&gt;Array.Copy(sourceChars, nextChar, buffer, index,=20
  charsToRead );&lt;BR&gt;&lt;BR&gt;nextChar +=3D count;&lt;BR&gt;&lt;BR&gt;return=20
  charsToRead;&lt;BR&gt;}&lt;BR&gt;&lt;BR&gt;&lt;?fontfamily&gt;&lt;?param Verdana&gt;&lt;?smaller&gt;Make=20
  change:&lt;BR&gt;&lt;?/smaller&gt;&lt;?/fontfamily&gt;&lt;BR&gt;&lt;?smaller&gt;public override int =
Read(=20
  char[] buffer, int index, int count )=20
  {&lt;BR&gt;&lt;?/smaller&gt;&lt;BR&gt;CheckObjectDisposedException ();&lt;BR&gt;&lt;BR&gt;if( buffer =
=3D=3D null=20
  ) {&lt;BR&gt;throw new ArgumentNullException();&lt;BR&gt;} else if( buffer.Length =
- index=20
  &amp;lt; count ) {&lt;BR&gt;throw new ArgumentException();&lt;BR&gt;} else if( index =
&amp;lt; 0 ||=20
  count &amp;lt; 0 ) {&lt;BR&gt;throw new =
ArgumentOutOfRangeException();&lt;BR&gt;}&lt;BR&gt;&lt;BR&gt;int=20
  charsToRead;&lt;BR&gt;&lt;BR&gt;if( nextChar + count &amp;gt; sourceLength ) =
{&lt;BR&gt;charsToRead=20
  =3D sourceLength - nextChar;&lt;BR&gt;} else {&lt;BR&gt;charsToRead =3D =
count;&lt;BR&gt;}&lt;BR&gt;&lt;?color&gt;&lt;?param ffff,0000,0000&gt;&lt;?smaller&gt;if(charsToRead =
&amp;lt; 1)=20
  return 0;&lt;BR&gt;&lt;?/smaller&gt;&lt;?/color&gt;&lt;BR&gt;Array.Copy(sourceChars, nextChar, =
buffer,=20
  index, charsToRead );&lt;BR&gt;&lt;BR&gt;nextChar +=3D count;&lt;BR&gt;&lt;BR&gt;return=20
  charsToRead;&lt;BR&gt;}&lt;BR&gt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&lt;BR&gt;&lt;BR&gt;Based on the source code, =
and on=20
  where you inserted the check, it looks like the exception is occurring =
as a=20
  result of Array.Copy being passed a value of 0 as the number of =
elements to=20
  copy. If this is the case, then this is what is in error; Array.Copy =
should=20
  accept a value of 0 for the number of elements to =
copy.&lt;BR&gt;&lt;BR&gt;Jonathan=20
  Gilbert&lt;BR&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;

------=_NextPart_000_0066_01C306A6.D3D81F40--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="013466.html">[Mono-list] CVS status of
 System.Reflection.Emit.ILGenerator.EmitCall
</A></li>
	<LI> Next message: <A HREF="013465.html">[Mono-list] Mono 0.23 Bug in the method
 System.IO.StringReader.Read
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13458">[ date ]</a>
              <a href="thread.html#13458">[ thread ]</a>
              <a href="subject.html#13458">[ subject ]</a>
              <a href="author.html#13458">[ author ]</a>
         </LI>
       </UL>
</body></html>
