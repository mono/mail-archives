<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] urgent: WS with client side certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20urgent%3A%20WS%20with%20client%20side%20certificate&In-Reply-To=e1b2e97f0604180828w2f69b2bdq%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031301.html">
   <LINK REL="Next"  HREF="031305.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] urgent: WS with client side certificate</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20urgent%3A%20WS%20with%20client%20side%20certificate&In-Reply-To=e1b2e97f0604180828w2f69b2bdq%40mail.gmail.com"
       TITLE="[Mono-list] urgent: WS with client side certificate">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Tue Apr 18 11:55:34 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="031301.html">[Mono-list] urgent: WS with client side certificate
</A></li>
        <LI>Next message: <A HREF="031305.html">[Mono-list] RPMS for Fedora Core 5 and rawhide
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31302">[ date ]</a>
              <a href="thread.html#31302">[ thread ]</a>
              <a href="subject.html#31302">[ subject ]</a>
              <a href="author.html#31302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2006-04-18 at 17:28 +0200, Pere Rodr&#237;guez wrote:
&gt;<i> Hello Sebastien,
</I>&gt;<i> 
</I>&gt;<i> &gt; The SSL/TLS code inside Mono.Security does support client-certificates.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's not easy or clean but it's possible to use reflection to add a
</I>&gt;<i> &gt; delegate to Mono.Security.SslClientStream.PrivateKeySelectionCallback.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This would allow you to supply (manually) the private key (associated
</I>&gt;<i> &gt; with the certificate) when it is required by the stream to authenticate
</I>&gt;<i> &gt; the client connection to the server.
</I>&gt;<i> 
</I>&gt;<i> How can I do it?
</I>&gt;<i> 
</I>&gt;<i> I only have a proxy class, so how can I acces to
</I>&gt;<i> Mono.Security.SslClientStream.PrivateKeySelectionCallback object and
</I>&gt;<i> add a delegate?
</I>
Well... I forgot about the (code) proxy part for ws clients, so this
gets even more awful (if possible).

Doing a &quot;real&quot; network proxy in your own application now seem an easier
solution.

Get your ws client proxy code to talk to a local (either embedded or
external) HTTP server that will forward everything (well both ways) to
the destination HTTPS server. This will give you full control to setup
the HTTPS connection (including setting up the client certificates).

&gt;<i> Thanks in advance,
</I>&gt;<i> 
</I>&gt;<i> pere
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 2006/4/18, Sebastien Pouliot &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">sebastien.pouliot at gmail.com</A>&gt;:
</I>&gt;<i> &gt; Hello Pere,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Tue, 2006-04-18 at 10:17 +0200, Pere Rodr&#237;guez wrote:
</I>&gt;<i> &gt; &gt; Hello,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I need connect to a WS that require certificate on client side and I don't
</I>&gt;<i> &gt; &gt; know how do it.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Does mono suport for a certificate on client side in a WS connection?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The short answer is no.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I registered with certmgr server certificate and my certificate
</I>&gt;<i> &gt; &gt; (client) and I add
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; proxy.ClientCertificates.Add (X509Certificate.CreateFromCertFile (&quot;...&quot;));
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; to my source, but it doesn't run. Server doesn't accept connection.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I don't know how to inform about my private key or how to register my
</I>&gt;<i> &gt; &gt; PKCS#12 in mono.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You're on the right track and found the main problem. I.e. before fx 2.0
</I>&gt;<i> &gt; there's no API to match a certificate and a keypair. MS depends on
</I>&gt;<i> &gt; CryptoAPI to do this &quot;magic&quot; behind the scene.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Fx 2.0 supports certificates &quot;with&quot; a private key (e.g. it keeps both of
</I>&gt;<i> &gt; them inside the same instance when a X.509 certificate is loaded from a
</I>&gt;<i> &gt; PKCS#12 file, or a certificate store).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Some idea please ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The SSL/TLS code inside Mono.Security does support client-certificates.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's not easy or clean but it's possible to use reflection to add a
</I>&gt;<i> &gt; delegate to Mono.Security.SslClientStream.PrivateKeySelectionCallback.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This would allow you to supply (manually) the private key (associated
</I>&gt;<i> &gt; with the certificate) when it is required by the stream to authenticate
</I>&gt;<i> &gt; the client connection to the server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Other alternatives are:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * wrap the HTTP code around a HTTPS connection made with
</I>&gt;<i> &gt; Mono.Security.dll (e.g. your own proxy);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * contribute to the Mono .NET 2.0 profile (wait for it to be completed);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Sebastien Pouliot  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">sebastien at ximian.com</A>&gt;
</I>&gt;<i> &gt; Blog: <A HREF="http://pages.infinit.net/ctech/">http://pages.infinit.net/ctech/</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031301.html">[Mono-list] urgent: WS with client side certificate
</A></li>
	<LI>Next message: <A HREF="031305.html">[Mono-list] RPMS for Fedora Core 5 and rawhide
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31302">[ date ]</a>
              <a href="thread.html#31302">[ thread ]</a>
              <a href="subject.html#31302">[ subject ]</a>
              <a href="author.html#31302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
