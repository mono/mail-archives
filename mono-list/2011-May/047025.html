<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Help with embedded mono: mono_runtime_object_init
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Help%20with%20embedded%20mono%3A%20mono_runtime_object_init&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="047020.html">
   <LINK REL="Next"  HREF="047027.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Help with embedded mono: mono_runtime_object_init</H1>
    <B>Rod</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Help%20with%20embedded%20mono%3A%20mono_runtime_object_init&In-Reply-To="
       TITLE="[Mono-list] Help with embedded mono: mono_runtime_object_init">rodney.foley at lumension.com
       </A><BR>
    <I>Tue May 17 13:20:25 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="047020.html">[Mono-list] Apache+mono+mod_mono_server with '--gc=sgen' fails	on start-up
</A></li>
        <LI>Next message: <A HREF="047027.html">[Mono-list] Help with embedded mono: mono_runtime_object_init
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47025">[ date ]</a>
              <a href="thread.html#47025">[ thread ]</a>
              <a href="subject.html#47025">[ subject ]</a>
              <a href="author.html#47025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are presently evaluating embedded mono for use in an existing C++ project.
The evaluation is taking place on windows, and with the help of some people
on this forum previously, we have been successful in building mono,
acquiring a .def file from git and generating a subsequent Visual Studio
2010 import library.

 

The first part of our investigation is bringing the moral equivalent of
&#8220;hello world&#8221; on-line for embedded mono so as such we have a simple Win32
console project that starts up, boots the mono runtime and then attempts to
load an assembly, locate a class in that assembly and then instantiate it
(essentially replicating the instructions on
<A HREF="http://www.mono-project.com/Embedding_Mono">http://www.mono-project.com/Embedding_Mono</A>). 

 

So far this has all worked out pretty well but we&#8217;re at the point now were
when we call &#8220;mono_runtime_object_init&#8221; and it causes the process to close.
No exception, no console output, no debug messages &#8211; the console simply
exits with a 1. The code we&#8217;re using looks as follows:

 

int _tmain(int argc, _TCHAR* argv[])

{

        // Tell mono where to find its brain

        const char * monoAssemblyPath           = &quot;C:\\Program Files
(x86)\\Mono-2.11\\lib&quot;;

        const char * monoConfigurationPath      = &quot;C:\\Program Files
(x86)\\Mono-2.11\\etc&quot;;

        ::mono_set_dirs(monoAssemblyPath,monoConfigurationPath);

 

        // Initialize the JIT runtime

        const char * domainName = &quot;EmbeddedMonoExample&quot;;

        MonoDomain *domain = ::mono_jit_init (domainName);

 

        // Load an assembly from the working directory

        boost::filesystem::path assemblyPath =
operator/(boost::filesystem::current_path(),
&quot;EmbeddedMonoExampleAssembly.dll&quot;);

        MonoAssembly * assembly =
::<i>mono_domain_assembly_open(domain,UtfConverter::ToUtf8(assemblyPath.c_str()).c_str());
</I>
        

        // Instantiate a class in .NET land

        MonoImage * image = ::mono_assembly_get_image(assembly);

        MonoClass * klass =
::<i>mono_class_from_name(image,&quot;EmbeddedMonoExampleAssembly&quot;,&quot;ExampleClass&quot;);
</I>
        MonoObject* instance = ::mono_object_new (domain, klass);

        ::mono_runtime_object_init (instance); &lt;----- fail here

 

        // Cleanup      

        mono_jit_cleanup (domain);

        return 0;

}

 

Note that everything appears to work fine up until we call
&#8220;mono_runtime_object_init&#8221;. Each of the preceding methods
(mono_assembly_get_image, etc.) return non-null pointers, and we have
verified that the assembly paths are constructed properly. In fact we can
even deliberately sabotage the process by, say changing the test assembly
name to be incorrect and mono_domain_assembly_open starts to fail (returns
null), so we&#8217;re comfortable that the test assembly has been located. Any
advice on what we&#8217;re doing wrong? Also any advice on where to look when mono
embedded gets unhappy like this, does it write a log? Anything besides hard
downing the process? How do I figure out what steps to take next?

 

By the way, the test assembly &quot;EmbeddedMonoExampleAssembly.dll&quot; is
co-located in the same folder as the test console, and the code for it looks
like this:

 

namespace EmbeddedMonoExampleAssembly

{

        public class ExampleClass

        {

                public ExampleClass()

                {

                }

 

                public int ExamlpeMethod(string exampleString)

                {

                        return 42;

                }

        }

}



--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Help-with-embedded-mono-mono-runtime-object-init-tp3529932p3529932.html">http://mono.1490590.n4.nabble.com/Help-with-embedded-mono-mono-runtime-object-init-tp3529932p3529932.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="047020.html">[Mono-list] Apache+mono+mod_mono_server with '--gc=sgen' fails	on start-up
</A></li>
	<LI>Next message: <A HREF="047027.html">[Mono-list] Help with embedded mono: mono_runtime_object_init
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47025">[ date ]</a>
              <a href="thread.html#47025">[ thread ]</a>
              <a href="subject.html#47025">[ subject ]</a>
              <a href="author.html#47025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
