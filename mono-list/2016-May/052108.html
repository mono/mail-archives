<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Why is 0.1f + 0.2f - 0.3f produces such a large	error number?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Why%20is%200.1f%20%2B%200.2f%20-%200.3f%20produces%20such%20a%20large%0A%09error%20number%3F&In-Reply-To=%3CCAGu5pZfsQWPh8rgPRWWdga374tUA-1WmVZOE1DSGwoWorbGqUg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="052107.html">
   <LINK REL="Next"  HREF="052105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Why is 0.1f + 0.2f - 0.3f produces such a large	error number?</H1>
    <B>Alan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Why%20is%200.1f%20%2B%200.2f%20-%200.3f%20produces%20such%20a%20large%0A%09error%20number%3F&In-Reply-To=%3CCAGu5pZfsQWPh8rgPRWWdga374tUA-1WmVZOE1DSGwoWorbGqUg%40mail.gmail.com%3E"
       TITLE="[Mono-list] Why is 0.1f + 0.2f - 0.3f produces such a large	error number?">alan.mcgovern at gmail.com
       </A><BR>
    <I>Mon May 23 14:13:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="052107.html">[Mono-list] Why is 0.1f + 0.2f - 0.3f produces such a large	error number?
</A></li>
        <LI>Next message: <A HREF="052105.html">[Mono-list] Why is 0.1f + 0.2f - 0.3f produces such a large	error number?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52108">[ date ]</a>
              <a href="thread.html#52108">[ thread ]</a>
              <a href="subject.html#52108">[ subject ]</a>
              <a href="author.html#52108">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You really have two options:
1)  Use float/double values and accept that you will get rounding errors in
all trivial and/non-trivial floating point calculations. You will have to
deal with this lack of precision appropriately for the type of calculation
you are performing. This is not a bug, this is just how floating point
works.

2) Use a higher precision/infinite precision type which will give you the
higher accuracy you require, if you require it.

The calculation which kickstarted this conversation contains the value
'0.2' which cannot be precisely represented by a float/double. The
expectation here is that you *will* have rounding errors. If you get '0'
it's because you got lucky and those rounding errors just happened to get
truncated to give a final value of 0. The stackoverflow link in my last
email has a very thorough explanation as to exactly why non-zero errors in
every calculation can give a final result with zero error.

The fact that different versions of .NET produce different outputs doesn't
mean much as long as the error is within the expected range. The JIT in
newer releases of .NET could've started choosing a different
(better/faster/whatever) codepath to implement the calculation which
triggers this negligible difference.



On 23 May 2016 at 13:59, MarLOne &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">InfoSeeker002 at gmail.com</A>&gt; wrote:

&gt;<i> Hi Alan,
</I>&gt;<i>
</I>&gt;<i> While all this is find it does not explain the following observation using
</I>&gt;<i> the same CPU:
</I>&gt;<i> VS2015  the delta is zero
</I>&gt;<i>
</I>&gt;<i> For all other VS dated back to 2003 the delta is non-zero.
</I>&gt;<i>
</I>&gt;<i> In fact my friend has shown me his code that led him to question this:
</I>&gt;<i> He has a web server implementing that simple expression. When the server
</I>&gt;<i> was
</I>&gt;<i> hosted in VS2015 IIS (v10) Express and in a local IIS 7.5, the results are
</I>&gt;<i> different. One returning perfect zero while the other the delta I have
</I>&gt;<i> reported.
</I>&gt;<i>
</I>&gt;<i> There is hardly any accumulated error. It seems to be MS finally decides
</I>&gt;<i> that the result should be zero (previously some mistake or simplistic
</I>&gt;<i> approach) so that it is the same as Java, Swift and C/C++.
</I>&gt;<i>
</I>&gt;<i> Something dodgy to me. My friend's web demo is pretty much the same as mine
</I>&gt;<i> using C/Com and .Net assembly resulting in two different values.
</I>&gt;<i>
</I>&gt;<i> For those that are using this for SCIENTIFIC calculations, I urge you to do
</I>&gt;<i> fine grain test them using Learning Test when moving to and from VS2015 or
</I>&gt;<i> Roslyn. It seems VS2015 has changed something leading to the observation.
</I>&gt;<i> Just to make sure the change does not have impact on it. Alternately those
</I>&gt;<i> developed in VS2015 but run with code developed in earlier compiler one
</I>&gt;<i> needs to implement floating point defensive code.
</I>&gt;<i>
</I>&gt;<i> If you have to do some SCIENTIFIC computation of running that expression or
</I>&gt;<i> more complex one a few hundred times, the result if not taken care of of
</I>&gt;<i> the
</I>&gt;<i> type's accuracy at each iteration, the end result will have accumulation
</I>&gt;<i> error that puts the end result within the precision of the type. Clearly
</I>&gt;<i> that is wrong and should not be so sensitive to version change of the VS.
</I>&gt;<i>
</I>&gt;<i> In fairness scientific calculation is best to be performed in Double
</I>&gt;<i> because
</I>&gt;<i> more floating point operations are performed internally in double. Doing so
</I>&gt;<i> with produce a number of 5.55E-017 which is the same as produced by Java
</I>&gt;<i> and
</I>&gt;<i> C.
</I>&gt;<i>
</I>&gt;<i> Rover
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://mono.1490590.n4.nabble.com/Why-is-0-1f-0-2f-0-3f-produces-such-a-large-error-number-tp4667837p4667862.html">http://mono.1490590.n4.nabble.com/Why-is-0-1f-0-2f-0-3f-produces-such-a-large-error-number-tp4667837p4667862.html</A>
</I>&gt;<i> Sent from the Mono - General mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20160523/cb31a440/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20160523/cb31a440/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="052107.html">[Mono-list] Why is 0.1f + 0.2f - 0.3f produces such a large	error number?
</A></li>
	<LI>Next message: <A HREF="052105.html">[Mono-list] Why is 0.1f + 0.2f - 0.3f produces such a large	error number?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52108">[ date ]</a>
              <a href="thread.html#52108">[ thread ]</a>
              <a href="subject.html#52108">[ subject ]</a>
              <a href="author.html#52108">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
