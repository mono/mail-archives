<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Unit tests load a different configuration file under	mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Unit%20tests%20load%20a%20different%20configuration%20file%20under%0A%09mono&In-Reply-To=%3C32A3E5C6-3339-4070-AA1E-AFD660DF1199%40asme.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="050175.html">
   <LINK REL="Next"  HREF="050177.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Unit tests load a different configuration file under	mono</H1>
    <B>David Curylo</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Unit%20tests%20load%20a%20different%20configuration%20file%20under%0A%09mono&In-Reply-To=%3C32A3E5C6-3339-4070-AA1E-AFD660DF1199%40asme.org%3E"
       TITLE="[Mono-list] Unit tests load a different configuration file under	mono">curylod at asme.org
       </A><BR>
    <I>Fri Aug  9 22:24:13 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="050175.html">[Mono-list] Building Mono 3 on SLES11
</A></li>
        <LI>Next message: <A HREF="050177.html">[Mono-list] Unit tests load a different configuration file	under mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50176">[ date ]</a>
              <a href="thread.html#50176">[ thread ]</a>
              <a href="subject.html#50176">[ subject ]</a>
              <a href="author.html#50176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I ran into an issue several months back where my code could not find ConnectionStrings while running my code in NUnit under mono, however, I was having trouble making a simple reproducible test case.  Now I have one, and I suspect that it is not an NUnit issue, as the same thing happens under xUnit.  Rather, I'm guessing that this has to do with how the AppDomain in mono resolves configuration file locations in shadow copied assemblies like those used by unit testing frameworks.

My simple test is below.  The first test will succeed, but the second one will fail only under mono (tried versions 2.10.8.1, 3.0.2, 3.1.2, and 3.2.0). Under MS.NET, both will succeed.  The only difference in the first and the second test is that the second test uses HttpUtility from System.Web, and when this happens, the ConfigurationManager.ConnectionStrings changes to the default one from ASP.NET, containing a LocalSqlServer (SQLEXPRESS) and LocalSqliteServer.

Is anyone able to explain why this would happen only in the AppDomains as created by unit testing frameworks?  Any known workarounds for this to keep it from loading a different config?

### TestCode.cs ###

using System;
using System.Configuration;
using NUnit.Framework;

namespace TestHarness
{
	[TestFixture]
	public class MyClass
	{
		[Test]
		public void TestSomeCode1() {
			var connStr = ConfigurationManager.ConnectionStrings[&quot;mystr&quot;];
			Assert.IsNotNull (connStr);
		}
		[Test]
		public void TestSomeCode2() {
			System.Web.HttpUtility.ParseQueryString (&quot;<A HREF="http://foo.bz?bar=fu">http://foo.bz?bar=fu</A>&quot;);
			var connStr = ConfigurationManager.ConnectionStrings[&quot;mystr&quot;];
			Assert.IsNotNull (connStr);
		}
	}
}

### App.config ###

&lt;configuration&gt;
	&lt;connectionStrings&gt;
		&lt;add name=&quot;mystr&quot; connectionString=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">test at whatever.net</A>&quot; /&gt;
	&lt;/connectionStrings&gt;
&lt;/configuration&gt;

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20130809/47f78a04/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20130809/47f78a04/attachment.html</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="050175.html">[Mono-list] Building Mono 3 on SLES11
</A></li>
	<LI>Next message: <A HREF="050177.html">[Mono-list] Unit tests load a different configuration file	under mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50176">[ date ]</a>
              <a href="thread.html#50176">[ thread ]</a>
              <a href="subject.html#50176">[ subject ]</a>
              <a href="author.html#50176">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
