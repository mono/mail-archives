<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Unit tests load a different configuration file	under mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Unit%20tests%20load%20a%20different%20configuration%20file%0A%09under%20mono&In-Reply-To=%3CCAJ%2B%3Dfjg%3D9MNCB0uHrZeH9-tg7YXZPg-oE4tNAxZxPgBKZ-%3DnNQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="050176.html">
   <LINK REL="Next"  HREF="050178.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Unit tests load a different configuration file	under mono</H1>
    <B>Charlie Poole</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Unit%20tests%20load%20a%20different%20configuration%20file%0A%09under%20mono&In-Reply-To=%3CCAJ%2B%3Dfjg%3D9MNCB0uHrZeH9-tg7YXZPg-oE4tNAxZxPgBKZ-%3DnNQ%40mail.gmail.com%3E"
       TITLE="[Mono-list] Unit tests load a different configuration file	under mono">charlie at nunit.com
       </A><BR>
    <I>Fri Aug  9 23:14:07 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="050176.html">[Mono-list] Unit tests load a different configuration file under	mono
</A></li>
        <LI>Next message: <A HREF="050178.html">[Mono-list] Unit tests load a different configuration file	under mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50177">[ date ]</a>
              <a href="thread.html#50177">[ thread ]</a>
              <a href="subject.html#50177">[ subject ]</a>
              <a href="author.html#50177">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Each test framework has it's own requirements for where a config file must
be located and how it should be named in order to be loaded and used. Those
requirements are necessarily different from how .NET normally locates
config files because following the .NET rules would load the config for the
test runner itself rather than for your tests.

In the case of NUnit, you can find the required info at
<A HREF="http://www.nunit.org/index.php?p=configFiles&amp;r=2.6.2">http://www.nunit.org/index.php?p=configFiles&amp;r=2.6.2</A>

Charlie


On Fri, Aug 9, 2013 at 3:24 PM, David Curylo &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">curylod at asme.org</A>&gt; wrote:

&gt;<i> I ran into an issue several months back where my code could not find
</I>&gt;<i> ConnectionStrings while running my code in NUnit under mono, however, I was
</I>&gt;<i> having trouble making a simple reproducible test case.  Now I have one, and
</I>&gt;<i> I suspect that it is not an NUnit issue, as the same thing happens under
</I>&gt;<i> xUnit.  Rather, I'm guessing that this has to do with how the AppDomain in
</I>&gt;<i> mono resolves configuration file locations in shadow copied assemblies like
</I>&gt;<i> those used by unit testing frameworks.
</I>&gt;<i>
</I>&gt;<i> My simple test is below.  The first test will succeed, but the second one
</I>&gt;<i> will fail only under mono (tried versions 2.10.8.1, 3.0.2, 3.1.2, and
</I>&gt;<i> 3.2.0). Under MS.NET &lt;<A HREF="http://ms.net/">http://ms.net/</A>&gt;, both will succeed.  The only
</I>&gt;<i> difference in the first and the second test is that the second test uses
</I>&gt;<i> HttpUtility from System.Web, and when this happens, the
</I>&gt;<i> ConfigurationManager.ConnectionStrings changes to the default one from
</I>&gt;<i> ASP.NET &lt;<A HREF="http://asp.net/">http://asp.net/</A>&gt;, containing a LocalSqlServer (SQLEXPRESS) and
</I>&gt;<i> LocalSqliteServer.
</I>&gt;<i>
</I>&gt;<i> Is anyone able to explain why this would happen only in the AppDomains as
</I>&gt;<i> created by unit testing frameworks?  Any known workarounds for this to keep
</I>&gt;<i> it from loading a different config?
</I>&gt;<i>
</I>&gt;<i> ### TestCode.cs ###
</I>&gt;<i>
</I>&gt;<i> using System;
</I>&gt;<i> using System.Configuration;
</I>&gt;<i> using NUnit.Framework;
</I>&gt;<i>
</I>&gt;<i> namespace TestHarness
</I>&gt;<i> {
</I>&gt;<i> [TestFixture]
</I>&gt;<i> public class MyClass
</I>&gt;<i> {
</I>&gt;<i>  [Test]
</I>&gt;<i>  public void TestSomeCode1() {
</I>&gt;<i>  var connStr = ConfigurationManager.ConnectionStrings[&quot;mystr&quot;];
</I>&gt;<i>  Assert.IsNotNull (connStr);
</I>&gt;<i>  }
</I>&gt;<i>  [Test]
</I>&gt;<i>  public void TestSomeCode2() {
</I>&gt;<i>  System.Web.HttpUtility.ParseQueryString (&quot;<A HREF="http://foo.bz?bar=fu&lt;http://foo.bz/?bar=fu">http://foo.bz?bar=fu&lt;http://foo.bz/?bar=fu</A>&gt;
</I>&gt;<i> &quot;);
</I>&gt;<i>  var connStr = ConfigurationManager.ConnectionStrings[&quot;mystr&quot;];
</I>&gt;<i>  Assert.IsNotNull (connStr);
</I>&gt;<i>  }
</I>&gt;<i> }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> ### App.config ###
</I>&gt;<i>
</I>&gt;<i> &lt;configuration&gt;
</I>&gt;<i> &lt;connectionStrings&gt;
</I>&gt;<i>  &lt;add name=&quot;mystr&quot; connectionString=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">test at whatever.net</A>&quot; /&gt;
</I>&gt;<i> &lt;/connectionStrings&gt;
</I>&gt;<i> &lt;/configuration&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20130809/fe6557a1/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20130809/fe6557a1/attachment.html</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="050176.html">[Mono-list] Unit tests load a different configuration file under	mono
</A></li>
	<LI>Next message: <A HREF="050178.html">[Mono-list] Unit tests load a different configuration file	under mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50177">[ date ]</a>
              <a href="thread.html#50177">[ thread ]</a>
              <a href="subject.html#50177">[ subject ]</a>
              <a href="author.html#50177">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
