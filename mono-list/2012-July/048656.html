<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Unload AppDomain containing GTK Window
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Unload%20AppDomain%20containing%20GTK%20Window&In-Reply-To=%3CA47E4DF37A358742A59E468C05AE700134E16CFC%40sfexchange.screenfood.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048655.html">
   <LINK REL="Next"  HREF="048652.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Unload AppDomain containing GTK Window</H1>
    <B>Adrian Stern</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-list%5D%20Unload%20AppDomain%20containing%20GTK%20Window&In-Reply-To=%3CA47E4DF37A358742A59E468C05AE700134E16CFC%40sfexchange.screenfood.com%3E"
       TITLE="[Mono-list] Unload AppDomain containing GTK Window">adrian.stern at screenfood.com
       </A><BR>
    <I>Tue Jul  3 05:26:53 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="048655.html">[Mono-list] Unload AppDomain containing GTK Window
</A></li>
        <LI>Next message: <A HREF="048652.html">[Mono-list] WCF IClientChannel Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48656">[ date ]</a>
              <a href="thread.html#48656">[ thread ]</a>
              <a href="subject.html#48656">[ subject ]</a>
              <a href="author.html#48656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your answer.

Do you see a way for running the flashplugin (embedded in Webkit.WebView) in a separate context/process?
We need to kill it from time to time because  it gets slower after a few hours and a crash in flash will result in a crash of the whole application.


Freundliche Gr&#252;sse / Best Regards / Meilleures salutations
Adrian Stern

______________

Adrian Stern
Software Developer

screenFOOD AG
Digital Signage Software and Multimedia Solutions
Cysatstrasse 6
CH-6004 Lucerne
SWITZERLAND

Fon +41 (0)41 444 21 41
Fax +41 (0)41 444 21 43
<A HREF="http://www.screenfood.com&lt;http://www.screenfood.com/">http://www.screenfood.com&lt;http://www.screenfood.com/</A>&gt;

&#187; NEU! screenFOOD&#174; CS Server 4.1 mit verlinkten Animation Factories, mehr animierten Bild&#252;berg&#228;ngen, L&#228;ngenerkennung von Videos und Animation Factories und vielem mehr unter: <A HREF="http://www.screenfood.com&lt;http://www.screenfood.com/html/pages/de_index.html">http://www.screenfood.com&lt;http://www.screenfood.com/html/pages/de_index.html</A>&gt;

&#187; NEW! screenFOOD&#174; CS Server 4.1 with linked Animation Factories, more animated image transitions, video and Animation Factory duration recognition and much more at: <A HREF="http://www.screenfood.com&lt;http://www.screenfood.com/html/pages/en_index.html">http://www.screenfood.com&lt;http://www.screenfood.com/html/pages/en_index.html</A>&gt;

Von: Rodrigo Kumpera [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">kumpera at gmail.com</A>]
Gesendet: Montag, 2. Juli 2012 19:08
An: Adrian Stern
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>
Betreff: Re: [Mono-list] Unload AppDomain containing GTK Window

GTK# does not work with multiple appdomains. You must do everything from the root domain.
On Mon, Jul 2, 2012 at 10:44 AM, Adrian Stern &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">adrian.stern at screenfood.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">adrian.stern at screenfood.com</A>&gt;&gt; wrote:
Hello

Since the Flashplugin is not very stable and on top of that leaks memory in long term use we try to run this critical part in a seperate AppDomain.
While creating and interacting with this window works fine, unloading the updomain causes the whole app to crash.

Since the unload works when i remove the Gtk.Window from the marshal object i can confirm this problem to be Gtk related (GTK Sharp)
Run on Ubuntu 11.4 and 12.4. This Bug seems to be known since 2004.

Running this sample every x seconds (loop) should just open a new window every x seconds while closing and destroying the other.

Any idey how i could accomplish this?

What i do:
#################################################
##### Class to run in other AppDomain and ist proxy class
#################################################

public class Fanta
{
  string s;

 // commenting this line out will cause the example to work!
  Gtk.Window w = new Gtk.Window(Gtk.WindowType.Toplevel);

  public Fanta(){ s = &quot;blubb&quot;; }

  public void echoS(){ Console.WriteLine( s );}
}

public class FantaProxy : MarshalByRefObject
{
  Fanta f = new Fanta();

  public void echoS(){
    f.GetType().InvokeMember(&quot;echoS&quot;, BindingFlags.InvokeMethod, null, f, null );
  }
}

#################################################
##### Code which causes the app to exit
#################################################

// d is a gobal AppDomain
// fp is FantaProxy  Type (also global)

d = AppDomain.CreateDomain( &quot;FantaD&quot;);
string currentAssemblyPath = Assembly.GetExecutingAssembly().Location;
fp = d.CreateInstanceFromAndUnwrap( currentAssemblyPath, &quot;AppDomainTest.FantaProxy&quot; ) as FantaProxy;
fp.echoS();
AppDomain.Unload( d );
Diese E-Mail und ihre Anh&#228;nge enthalten vertrauliche und/oder rechtlich gesch&#252;tzte Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail irrt&#252;mlich erhalten haben, informieren Sie bitte sofort den Absender und vernichten Sie diese Mail inklusive Anh&#228;nge. Das unerlaubte Kopieren sowie die unbefugte Weitergabe der Inhalte dieser Mail ist nicht gestattet.
This e-mail and any attachments may contain confidential and/or privileged information. If you are not the intended recipient (or have received this e-mail in error) please notify the sender immediately and destroy this e-mail including the attachments. Any unauthorized copying, disclosure or distribution of the material in this e-mail is strictly forbidden.

_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>&gt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>

Diese E-Mail und ihre Anh&#228;nge enthalten vertrauliche und/oder rechtlich gesch&#252;tzte Informationen. Wenn Sie nicht der richtige Adressat sind oder diese E-Mail irrt&#252;mlich erhalten haben, informieren Sie bitte sofort den Absender und vernichten Sie diese Mail inklusive Anh&#228;nge. Das unerlaubte Kopieren sowie die unbefugte Weitergabe der Inhalte dieser Mail ist nicht gestattet.
This e-mail and any attachments may contain confidential and/or privileged information. If you are not the intended recipient (or have received this e-mail in error) please notify the sender immediately and destroy this e-mail including the attachments. Any unauthorized copying, disclosure or distribution of the material in this e-mail is strictly forbidden.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20120703/88b24ff3/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20120703/88b24ff3/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048655.html">[Mono-list] Unload AppDomain containing GTK Window
</A></li>
	<LI>Next message: <A HREF="048652.html">[Mono-list] WCF IClientChannel Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48656">[ date ]</a>
              <a href="thread.html#48656">[ thread ]</a>
              <a href="subject.html#48656">[ subject ]</a>
              <a href="author.html#48656">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
