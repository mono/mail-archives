<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] updated patch for HttpWebResponse
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:shahms%40shahms.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="008246.html">
   <LINK REL="Next"  HREF="008207.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] updated patch for HttpWebResponse
   </H1>
    <B>Shahms E. King
    </B> 
    <A HREF="mailto:shahms%40shahms.com"
       TITLE="[Mono-list] updated patch for HttpWebResponse">shahms@shahms.com
       </A><BR>
    <I>09 Sep 2002 15:52:47 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="008246.html">[Mono-list] Delphi.NET exes do not work on Mono...
</A></li>
        <LI> Next message: <A HREF="008207.html">[Mono-list] updated patch for HttpWebResponse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8206">[ date ]</a>
              <a href="thread.html#8206">[ thread ]</a>
              <a href="subject.html#8206">[ subject ]</a>
              <a href="author.html#8206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-BObyNdnOoWLQi+Tw9nJD
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

This patch fixes a minor problem with HttpWebRequest not actually using
the Version property and HttpWebResponse's cookie parsing wasn't correct
(was checking for String.Empty rather than null)

--Shahms

--=-BObyNdnOoWLQi+Tw9nJD
Content-Disposition: attachment; filename=WebResponse-update.patch
Content-Transfer-Encoding: quoted-printable
Content-Type: text/x-patch; name=WebResponse-update.patch; charset=ISO-8859-1

Index: HttpWebRequest.cs
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /mono/mcs/class/System/System.Net/HttpWebRequest.cs,v
retrieving revision 1.6
diff -u -r1.6 HttpWebRequest.cs
--- HttpWebRequest.cs	4 Sep 2002 01:42:23 -0000	1.6
+++ HttpWebRequest.cs	9 Sep 2002 22:53:13 -0000
@@ -565,17 +569,17 @@
 				: base (HttpWebStream.CreateSocket (webRequest), true)
 			{
 				StreamWriter webWriter =3D null;
-				string headerValue =3D null;
-
=20
 				webWriter =3D new StreamWriter (this);
 =09
-				webWriter.Write (webRequest.Method + &quot; &quot; + webRequest.actualUri.Absolu=
tePath + &quot; HTTP/1.1\r\n&quot;);
+				webWriter.Write (webRequest.Method + &quot; &quot; +=20
+					webRequest.actualUri.AbsolutePath + &quot; HTTP/&quot; + webRequest.version.ToS=
tring(2) + &quot;\r\n&quot;);
+
+				foreach (string header in webRequest.webHeaders)
+					webWriter.Write (header + &quot;: &quot; + webRequest.webHeaders[header] + &quot;\r\=
n&quot;);
+
+				// FIXME: write cookie headers (CookieContainer not yet implemented)
=20
-				foreach (string header in webRequest.webHeaders) {
-					headerValue =3D header + &quot;: &quot; + webRequest.webHeaders[header] + &quot;\r\n=
&quot;;
-					webWriter.Write (headerValue);
-				}
 				webWriter.Write (&quot;\r\n&quot;);
 				webWriter.Flush();
=20
Index: HttpWebResponse.cs
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: /mono/mcs/class/System/System.Net/HttpWebResponse.cs,v
retrieving revision 1.5
diff -u -r1.5 HttpWebResponse.cs
--- HttpWebResponse.cs	4 Sep 2002 01:42:23 -0000	1.5
+++ HttpWebResponse.cs	9 Sep 2002 22:53:13 -0000
@@ -75,7 +76,6 @@
 			}
 		=09
 			this.webHeaders[last] =3D value.ToString(); // otherwise we miss the la=
st header
-			// TODO: parse cookies from headers
 		}
 	=09
 		protected HttpWebResponse (SerializationInfo serializationInfo, Streamin=
gContext streamingContext)
@@ -342,7 +342,7 @@
 				parts =3D ((string)options.Dequeue()).Split ('=3D');
 				switch (parts[0].ToUpper()) { // cookie options are case-insensitive
 					case &quot;COMMENT&quot;:
-						if (cookie.Comment =3D=3D String.Empty)
+						if (cookie.Comment =3D=3D null)
 							cookie.Comment =3D parts[1];
 					break;
 					case &quot;COMMENTURL&quot;:
@@ -353,7 +353,7 @@
 						cookie.Discard =3D true;
 					break;
 					case &quot;DOMAIN&quot;:
-						if (cookie.Domain =3D=3D String.Empty)
+						if (cookie.Domain =3D=3D null)
 							cookie.Domain =3D parts[1];
 					break;
 					case &quot;MAX-AGE&quot;: // RFC Style Set-Cookie2
@@ -365,11 +365,11 @@
 							cookie.Expires =3D DateTime.Parse (parts[1]);
 					break;
 					case &quot;PATH&quot;:
-						if (cookie.Path =3D=3D String.Empty)
+						if (cookie.Path =3D=3D null)
 							cookie.Path =3D parts[1];
 					break;
 					case &quot;PORT&quot;:
-						if (cookie.Port =3D=3D String.Empty)
+						if (cookie.Port =3D=3D null)
 							cookie.Port =3D parts[1];
 					break;
 					case &quot;SECURE&quot;:
@@ -383,6 +383,9 @@
=20
 			if (cookieCollection =3D=3D null)
 				cookieCollection =3D new CookieCollection();
+
+			if (cookie.Domain =3D=3D null)
+				cookie.Domain =3D uri.Host;
=20
 			cookieCollection.Add (cookie);
 		}

--=-BObyNdnOoWLQi+Tw9nJD--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="008246.html">[Mono-list] Delphi.NET exes do not work on Mono...
</A></li>
	<LI> Next message: <A HREF="008207.html">[Mono-list] updated patch for HttpWebResponse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8206">[ date ]</a>
              <a href="thread.html#8206">[ thread ]</a>
              <a href="subject.html#8206">[ subject ]</a>
              <a href="author.html#8206">[ author ]</a>
         </LI>
       </UL>
</body></html>
