<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] About the thumbnail creator
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:benoit.caccinolo%40free.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="021349.html">
   <LINK REL="Next"  HREF="021351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] About the thumbnail creator
   </H1>
    <B>Benoit Caccinolo
    </B> 
    <A HREF="mailto:benoit.caccinolo%40free.fr"
       TITLE="[Mono-list] About the thumbnail creator">benoit.caccinolo@free.fr
       </A><BR>
    <I>Wed, 16 Jun 2004 18:59:06 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="021349.html">[Mono-list] About the thumbnail creator
</A></li>
        <LI> Next message: <A HREF="021351.html">[Mono-list] About the thumbnail creator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21350">[ date ]</a>
              <a href="thread.html#21350">[ thread ]</a>
              <a href="subject.html#21350">[ subject ]</a>
              <a href="author.html#21350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2004-06-16 at 18:20, Todd Berman wrote:
&gt;<i> I think the issue is mozilla not getting enough time to render. I would 
</I>&gt;<i> try putting a Thread.Sleep (3000) or something as the first line of code 
</I>&gt;<i> in the NetStop handler.
</I>
The problem is surely a problem of time. But with a Thread.Sleep in the
MakeShot method the problem is not solved cause the sleep stops the
rendering too :)

My solution is too put a button to launch the MakeShot method. It is
less elegant but it works.

Thx

Here is the code.

using System;
using Gtk;
using Gecko;

class Thumbnail { 
	static WebControl wc;
	static string output = &quot;shot.png&quot;;
	static string url;
	static int width = -1;
	static int height = -1;
	
	static void Main (string [] args)
	{
		for (int i = 0; i &lt; args.Length; i++){
			switch (args [i]){
			case &quot;-width&quot;:
				try {
					i++;
					width = Int32.Parse (args [i]);
				} catch {
					Console.WriteLine (&quot;-width requires an numeric argument&quot;);
				}
				break;
			case &quot;-height&quot;:
				try {
					i++;
					height = Int32.Parse (args [i]);
				} catch {
					Console.WriteLine (&quot;-height requires an numeric argument&quot;);
				}
				break;
			case &quot;-help&quot;:
			case &quot;-h&quot;:
				Help ();
				break;
				
			default:
				if (url == null)
					url = args [i];
				else if (output == null)
					output = args [i];
				else
					Help ();
				break;
			}
		}

		Application.Init();
		Window w = new Window (&quot;test&quot;);
		VBox vbox = new VBox ();
		Button bt = new Button (&quot;Take a Shot&quot;);
		bt.Clicked += new EventHandler (btn_click);
		vbox.PackStart (bt);	

		wc = new WebControl ();
		wc.LoadUrl (url);
		//wc.NetStop += MakeShot;
		//wc.Show ();
		wc.SetSizeRequest (800, 600);
		vbox.PackStart (wc);
		w.Add (vbox);
		w.ShowAll ();
		Application.Run();
		
		System.Threading.Thread.Sleep (1500);
	}

	static void Help ()
	{
		Console.WriteLine (&quot;Usage is: shot [-width N] [-height N] url
[shot]&quot;);
		Environment.Exit (0);
	}
	
	 static void btn_click (object obj, EventArgs args)
     {
          Console.WriteLine (&quot;Button Clicked&quot;);
          MakeShot();
     }
     
	static void MakeShot()
	{		
		System.Console.Write(&quot;Taking a new shot&quot;);	
		
		Gdk.Window win = wc.GdkWindow;
		int iwidth = wc.Allocation.Width;
		int iheight = wc.Allocation.Height;
		Gdk.Pixbuf p = new Gdk.Pixbuf (Gdk.Colorspace.Rgb, false, 8, iwidth,
iheight);
		Gdk.Pixbuf scaled;
		
		p = p.GetFromDrawable (win, win.Colormap, 0, 0, 0, 0, iwidth,
iheight);
		if (width == -1){
			if (height == -1)
				scaled = p;
			else
				scaled = p.ScaleSimple (height * iwidth / iheight, height,
Gdk.InterpType.Hyper);
		} else {
			if (height == -1)
				scaled = p.ScaleSimple (width, width * iheight / iwidth,
Gdk.InterpType.Hyper);
			else
				scaled = p.ScaleSimple (width, height, Gdk.InterpType.Hyper);
		}
		
		scaled.Savev (output, &quot;png&quot;, null, null);  
	}
	
}




</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="021349.html">[Mono-list] About the thumbnail creator
</A></li>
	<LI> Next message: <A HREF="021351.html">[Mono-list] About the thumbnail creator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21350">[ date ]</a>
              <a href="thread.html#21350">[ thread ]</a>
              <a href="subject.html#21350">[ subject ]</a>
              <a href="author.html#21350">[ author ]</a>
         </LI>
       </UL>
</body></html>
