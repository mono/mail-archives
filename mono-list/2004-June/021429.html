<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Remoting + interface parameter names = a bug ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lluis%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="021428.html">
   <LINK REL="Next"  HREF="021432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Remoting + interface parameter names = a bug ?
   </H1>
    <B>Lluis Sanchez
    </B> 
    <A HREF="mailto:lluis%40ximian.com"
       TITLE="[Mono-list] Remoting + interface parameter names = a bug ?">lluis@ximian.com
       </A><BR>
    <I>Fri, 18 Jun 2004 16:06:06 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="021428.html">[Mono-list] Remoting + interface parameter names = a bug ?
</A></li>
        <LI> Next message: <A HREF="021432.html">[Mono-list] Remoting + interface parameter names = a bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21429">[ date ]</a>
              <a href="thread.html#21429">[ thread ]</a>
              <a href="subject.html#21429">[ subject ]</a>
              <a href="author.html#21429">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a very complete bug report. If you can file it in
bugzilla.ximian.com it would be perfect.

Thanks!

On dv, 2004-06-18 at 15:52, Yuri Leikind wrote:
&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> Looks like I have found an astonishing thing:
</I>&gt;<i> 
</I>&gt;<i> If I have a server that exposes some type via remoting, and 
</I>&gt;<i> this type implements an interface with the help of which
</I>&gt;<i> the type is accessed in the remoting client, the parameter names
</I>&gt;<i> in interface methods declarations influence runtime. 
</I>&gt;<i> 
</I>&gt;<i> In other words, if the parameters names are not the same,
</I>&gt;<i> the call to the remote object will raise an exception.
</I>&gt;<i> 
</I>&gt;<i> Here is the code for you to believe me:
</I>&gt;<i> 
</I>&gt;<i> ==========     IFactorial.cs   ==========
</I>&gt;<i> 
</I>&gt;<i> namespace ProofOfConcepts{
</I>&gt;<i>     public interface IFactorial{
</I>&gt;<i>         //ulong CalculateFactorial(uint a);  // With this line everything  works
</I>&gt;<i>         ulong CalculateFactorial(uint b);    // With this line it doesn't
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ==========     Server.cs   ==========
</I>&gt;<i> using System;
</I>&gt;<i> using System.Runtime.Remoting;
</I>&gt;<i> using System.Runtime.Remoting.Channels;
</I>&gt;<i> using System.Runtime.Remoting.Channels.Http;
</I>&gt;<i> 
</I>&gt;<i> namespace ProofOfConcepts{
</I>&gt;<i>     
</I>&gt;<i>     public class Calculator : MarshalByRefObject, IFactorial{
</I>&gt;<i>         public ulong CalculateFactorial(uint a){
</I>&gt;<i>             ulong res = 1;
</I>&gt;<i>             for (uint i=1 ; i&lt;=a; i++)
</I>&gt;<i>                 res = res * i;
</I>&gt;<i>             Console.WriteLine(&quot;!{0} = {1}&quot;, a, res);
</I>&gt;<i>             return res;
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>     
</I>&gt;<i>     class Server{
</I>&gt;<i>         public Server(){
</I>&gt;<i>             HttpChannel channel = new HttpChannel(60000);
</I>&gt;<i>             ChannelServices.RegisterChannel(channel);
</I>&gt;<i>             Type facType = Type.GetType(&quot;ProofOfConcepts.Calculator&quot;);
</I>&gt;<i>             RemotingConfiguration.RegisterWellKnownServiceType(
</I>&gt;<i>                 facType,
</I>&gt;<i>                 &quot;MyEndPoint&quot;,
</I>&gt;<i>                 WellKnownObjectMode.Singleton );            
</I>&gt;<i>         }
</I>&gt;<i>         
</I>&gt;<i>         void Listen(){
</I>&gt;<i>             Console.WriteLine(&quot;Press Enter to exit...&quot;);
</I>&gt;<i>             Console.ReadLine( );
</I>&gt;<i>         }
</I>&gt;<i>         
</I>&gt;<i>         public static void Main(){
</I>&gt;<i>             new Server().Listen();
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i> 
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> ==========     Client.cs   ==========
</I>&gt;<i> 
</I>&gt;<i> using System;
</I>&gt;<i> using System.Runtime.Remoting;
</I>&gt;<i> using System.Runtime.Remoting.Channels;
</I>&gt;<i> using System.Runtime.Remoting.Channels.Http;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> namespace ProofOfConcepts{
</I>&gt;<i>     class Client{
</I>&gt;<i>         public static void Main(){
</I>&gt;<i>             HttpChannel channel = new HttpChannel(0);
</I>&gt;<i>             ChannelServices.RegisterChannel(channel);
</I>&gt;<i>             MarshalByRefObject obj = 
</I>&gt;<i>                 (MarshalByRefObject) RemotingServices.Connect(
</I>&gt;<i>                     typeof(ProofOfConcepts.IFactorial),
</I>&gt;<i>                     &quot;<A HREF="http://localhost:60000/MyEndPoint"">http://localhost:60000/MyEndPoint&quot;</A>);
</I>&gt;<i>             IFactorial cal = (IFactorial) obj;
</I>&gt;<i>             Console.WriteLine(&quot;!4 = {0}&quot;, cal.CalculateFactorial(4));
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> ==============================
</I>&gt;<i> 
</I>&gt;<i> To compile these, issue the following commands:
</I>&gt;<i> 
</I>&gt;<i> mcs   /t:library /out:IFactorial.dll IFactorial.cs
</I>&gt;<i> 
</I>&gt;<i> mcs  /r:IFactorial.dll,System.Runtime.Remoting.dll  /out:Server.exe Server.cs
</I>&gt;<i> 
</I>&gt;<i> mcs  /r:IFactorial.dll,System.Runtime.Remoting.dll  /out:Client.exe Client.cs
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Now run the server, then start the client.
</I>&gt;<i> 
</I>&gt;<i> I get the following in the Client.exe console::
</I>&gt;<i> 
</I>&gt;<i> ===============================
</I>&gt;<i> 
</I>&gt;<i> <A HREF="mailto:leikind@pc324">leikind@pc324</A>:~/cs/appDomains/my_remoting$ mono Client.exe 
</I>&gt;<i> 
</I>&gt;<i> Unhandled Exception: System.IndexOutOfRangeException: Array index is out of range.
</I>&gt;<i> 
</I>&gt;<i> Server stack trace: 
</I>&gt;<i> in &lt;0x005ea&gt; System.Runtime.Remoting.Channels.SoapMessageFormatter:BuildMethodCallFromSoapMessage (System.Runtime.Serialization.Formatters.SoapMessage,string)
</I>&gt;<i> in &lt;0x001f5&gt; System.Runtime.Remoting.Channels.SoapServerFormatterSink:ProcessMessage (System.Runtime.Remoting.Channels.IServerChannelSinkStack,System.Runtime.Remoting.Messaging.IMessage,System.Runtime.Remoting.Channels.ITransportHeaders,System.IO.Stream,System.Runtime.Remoting.Messaging.IMessage&amp;,System.Runtime.Remoting.Channels.ITransportHeaders&amp;,System.IO.Stream&amp;)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Exception rethrown at [0]: 
</I>&gt;<i> 
</I>&gt;<i> in &lt;0x00748&gt; System.Runtime.Remoting.Proxies.RealProxy:PrivateInvoke (System.Runtime.Remoting.Proxies.RealProxy,System.Runtime.Remoting.Messaging.IMessage,System.Exception&amp;,object[]&amp;)
</I>&gt;<i> 
</I>&gt;<i> ===============================
</I>&gt;<i> 
</I>&gt;<i> If you cache in the interface  line 
</I>&gt;<i> 	ulong CalculateFactorial(uint b);  
</I>&gt;<i> to
</I>&gt;<i> 	ulong CalculateFactorial(uint a);  
</I>&gt;<i> recompile all the three assemblies, and run again, everything will work just fine.
</I>&gt;<i> 
</I>&gt;<i> I run Mono 0.95
</I>&gt;<i> 
</I>&gt;<i> On MS .NET it works fine in all cases
</I>&gt;<i> 
</I>&gt;<i> Does anyone have any comments?
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="021428.html">[Mono-list] Remoting + interface parameter names = a bug ?
</A></li>
	<LI> Next message: <A HREF="021432.html">[Mono-list] Remoting + interface parameter names = a bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21429">[ date ]</a>
              <a href="thread.html#21429">[ thread ]</a>
              <a href="subject.html#21429">[ subject ]</a>
              <a href="author.html#21429">[ author ]</a>
         </LI>
       </UL>
</body></html>
