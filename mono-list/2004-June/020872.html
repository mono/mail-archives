<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] issue with pinvoke &amp; memory leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rkumar%40novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="020871.html">
   <LINK REL="Next"  HREF="020873.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] issue with pinvoke &amp; memory leak
   </H1>
    <B>Ravindra
    </B> 
    <A HREF="mailto:rkumar%40novell.com"
       TITLE="[Mono-list] issue with pinvoke &amp; memory leak">rkumar@novell.com
       </A><BR>
    <I>Wed, 02 Jun 2004 17:08:39 +0530</I>
    <P><UL>
        <LI> Previous message: <A HREF="020871.html">[Mono-list] issue with pinvoke &amp; memory leak
</A></li>
        <LI> Next message: <A HREF="020873.html">[Mono-list] issue with pinvoke &amp; memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20872">[ date ]</a>
              <a href="thread.html#20872">[ thread ]</a>
              <a href="subject.html#20872">[ subject ]</a>
              <a href="author.html#20872">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

On Wed, 2004-06-02 at 17:00, Chris Turchin wrote:
&gt;<i> i have been playing with  a wrapper for an image library with the following
</I>&gt;<i> method:
</I>&gt;<i> 
</I>&gt;<i> private static extern FIBITMAP FreeImage_Rescale(FIBITMAP dib, int dst_width,
</I>&gt;<i> 					int dst_height, FilterOption filter);
</I>&gt;<i> 
</I>&gt;<i> I had implemented it like this:
</I>&gt;<i> 
</I>&gt;<i> public FreeImage Resample(int newwidth, int newheight,
</I>&gt;<i> 				FilterOption filter)
</I>&gt;<i> 
</I>&gt;<i> which works fine with something like:
</I>&gt;<i> 
</I>&gt;<i> FreeImage img2 = img.Resample(100,100,FilterOption.BILINEAR);
</I>&gt;<i> 
</I>&gt;<i> but when I do:
</I>&gt;<i> 
</I>&gt;<i> img = img.Resample(100,100,FilterOption.BILINEAR);
</I>&gt;<i> 
</I>&gt;<i> then the img object is 'replaced' but a I have a big memory leak, since the
</I>&gt;<i> Dispose() method which handles the cleanup of unmanaged resources (the img
</I>&gt;<i> object has a pointer to the unmanaged image data which is normally released when
</I>&gt;<i> the object is disposed) is never called.
</I>&gt;<i> 
</I>&gt;<i> Can someone give me a tip how to handle this in a way that ensures that the old
</I>&gt;<i> data from img is disposed in the second case above? Actaully, would this same
</I>&gt;<i> issue be a problem for all IDisposable objects in managed code (maybe I am not
</I>&gt;<i> allowed to do this at all with IDisposable objects) or is this unique to the
</I>&gt;<i> managed/unmanaged code in question here?
</I>
Dude, you need to implement finalizer for your FreeImage class.
Finalizer method would do all the required cleanup you want to do. GC
would call your class finalizer, when you are done with the referenced
object.

- Ravindra


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="020871.html">[Mono-list] issue with pinvoke &amp; memory leak
</A></li>
	<LI> Next message: <A HREF="020873.html">[Mono-list] issue with pinvoke &amp; memory leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20872">[ date ]</a>
              <a href="thread.html#20872">[ thread ]</a>
              <a href="subject.html#20872">[ subject ]</a>
              <a href="author.html#20872">[ author ]</a>
         </LI>
       </UL>
</body></html>
