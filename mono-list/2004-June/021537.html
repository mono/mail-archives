<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Embedding mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rafael.teixeirabr%40terra.com.br">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="021462.html">
   <LINK REL="Next"  HREF="021536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Embedding mono
   </H1>
    <B>A Rafael D Teixeira
    </B> 
    <A HREF="mailto:rafael.teixeirabr%40terra.com.br"
       TITLE="[Mono-list] Embedding mono">rafael.teixeirabr@terra.com.br
       </A><BR>
    <I>Tue, 22 Jun 2004 11:10:45 -0300</I>
    <P><UL>
        <LI> Previous message: <A HREF="021462.html">[Mono-list] Embedding mono
</A></li>
        <LI> Next message: <A HREF="021536.html">[Mono-list] Embedding mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21537">[ date ]</a>
              <a href="thread.html#21537">[ thread ]</a>
              <a href="subject.html#21537">[ subject ]</a>
              <a href="author.html#21537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Inline
On Fri, 2004-06-18 at 23:34, Jonathan Pryor wrote:
&gt;<i> On Fri, 2004-06-18 at 16:08, Joe Ante wrote:
</I>&gt;<i> &gt; &gt; It should be possible to load assemblies on demand.
</I>&gt;<i> &gt; Ok so how exactly does this work?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Say I have two .cs files. One calls a function in the other .cs file.
</I>&gt;<i> &gt; Obviously just compiling the two .cs files seperately in two different
</I>&gt;<i> &gt; .dll's gives me a compile error for the .cs file that tries to use the other
</I>&gt;<i> &gt; .cs file.
</I>&gt;<i> 
</I>&gt;<i> Circular dependencies are notoriously complicated in a statically typed
</I>&gt;<i> environment.  The simple answer would be to put both .cs files into the
</I>&gt;<i> same assembly, but this isn't apparently what you want to do.
</I>&gt;<i> 
</I>&gt;<i> Paolo could answer this better, but I would imagine that assemblies are
</I>&gt;<i> demand-paged from disk -- only the parts of the assembly that you
</I>&gt;<i> actually use are loaded, so I don't see any reason to not put everything
</I>&gt;<i> into the same assembly.
</I>
Yes, as calling the compiler has always a measurable initializing cost,
I would go further and suggest to compile all the scripts as single
source, every time. The question here is how big will your scripts be?
See below

&gt;<i> &gt; So is there some kind of import/include mechanism?
</I>&gt;<i> 
</I>&gt;<i> I'm not sure what you mean by import/include, but I imagine it's related
</I>&gt;<i> to your questions below, so hopefully my answers below will help.
</I>
Yes, it's called a reference to an external assembly, but you can mess
with it, it is internal to the compiler mechanism.

&gt;<i> &gt; The problem I am trying to solve is:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; We have a game creation tool which includes a text editor to change scripts
</I>&gt;<i> &gt; (At the moment using python). Python has a import function, which is
</I>&gt;<i> &gt; necessary if you want to use a class that is defined in another script file.
</I>&gt;<i> &gt; We intercepted the import function and returned it the correct python script
</I>&gt;<i> &gt; and built a dependency tree. When the user saves a pythonscript we recompile
</I>&gt;<i> &gt; all pythonscripts that import the script the user has changed.
</I>&gt;<i> &gt; It is very important for us that saving/recompiling is immediate (less than
</I>&gt;<i> &gt; half a second).
</I>
If your scripts total some thousands of lines it is possible to
recompile them fast (but particularly the startup time for any compiler
may be more than half a second even on fast machines.

The important thing is: recompiling things means no instances can be
kept running around, everything will have to be restarted afterwards. Is
that true for your engine? Jon seems to believe it is not, from what you
can read below, but that is not a safe thing to do.

&gt;<i> &gt; So whats the best way to do that?
</I>&gt;<i> 
</I>&gt;<i> It sounds like you want a highly dynamic environment, in which existing
</I>&gt;<i> code can be changed at runtime, with older code silently invoking newer
</I>&gt;<i> code.
</I>&gt;<i> 
</I>&gt;<i> I don't believe it's possible, or at least easily possible, to do this
</I>&gt;<i> in C#.  This sounds more like something System.Reflection.Emit and a
</I>&gt;<i> custom compiler would be useful for.  That way, you could ensure fast
</I>&gt;<i> compile time, and you could come up with a custom way for pre-existing
</I>&gt;<i> code to invoke newer code without requiring recompilation (interfaces
</I>&gt;<i> might be good for this).
</I>
&gt;<i> I would suggest looking into IronPython, which is a Python
</I>&gt;<i> implementation for .NET.  This may be an easier migration path for you,
</I>&gt;<i> assuming you can actually get your hands on it (it's currently a
</I>&gt;<i> &quot;unreleased research prototype&quot;, but the author might be willing to
</I>&gt;<i> help; I have no idea...).
</I>
As Rodrigo has pointed out in another email, now there is his new
language: Boo a statically-typed Python-lookalike. It's a very
interesting language and the compiler is a configurable pipeline, where
you can plug your own pieces to augment or personalize it. More:
probably it could be kept loaded as a library instead of as an
executable to help you with the initialization time. That is also
possible but not easily done with mcs/mbas code.

Hope it helps,

-- 
Rafael &quot;Monoman&quot; Teixeira 
Mono Hacker since 16 Jul 2001 - <A HREF="http://www.go-mono.org/">http://www.go-mono.org/</A>
Mono Brasil Founding Member - <A HREF="http://monobrasil.redesolbrasil.org/">http://monobrasil.redesolbrasil.org/</A>
English Blog: <A HREF="http://monoblog.blogspot.com/">http://monoblog.blogspot.com/</A>
Brazilian Portuguese Blog: <A HREF="http://monoblog.weblogger.terra.com.br/">http://monoblog.weblogger.terra.com.br/</A>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="021462.html">[Mono-list] Embedding mono
</A></li>
	<LI> Next message: <A HREF="021536.html">[Mono-list] Embedding mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21537">[ date ]</a>
              <a href="thread.html#21537">[ thread ]</a>
              <a href="subject.html#21537">[ subject ]</a>
              <a href="author.html#21537">[ author ]</a>
         </LI>
       </UL>
</body></html>
