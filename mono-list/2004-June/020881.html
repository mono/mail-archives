<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Can't open a StreamWritter with a file created by File.Create
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:robik%40mailbox.sk">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="020877.html">
   <LINK REL="Next"  HREF="020878.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Can't open a StreamWritter with a file created by File.Create
   </H1>
    <B>RoBiK
    </B> 
    <A HREF="mailto:robik%40mailbox.sk"
       TITLE="[Mono-list] Can't open a StreamWritter with a file created by File.Create">robik@mailbox.sk
       </A><BR>
    <I>Wed, 2 Jun 2004 17:06:57 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="020877.html">[Mono-list] Can't open a StreamWritter with a file created by File.Create
</A></li>
        <LI> Next message: <A HREF="020878.html">[Mono-list] mcs cannot compile on NFS shares due to Win32 locks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20881">[ date ]</a>
              <a href="thread.html#20881">[ thread ]</a>
              <a href="subject.html#20881">[ subject ]</a>
              <a href="author.html#20881">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

It doesn't work, because &quot;File.Create(&quot;test-file&quot;)&quot; creates a new file =
and
returns an FileStream object, wich holds the handle for the file. You do =
not
assing this object anywhere, so it is a candidate for the garbage
collection. Until the GC disposes this object (this can take some time),
wich releases the allocated file handle, the file is still opened. So if
your next statement tryes to access this file, you get an sharing =
violation.
You should always call Close() to release the underlying file handle.

Solution 1.:

FileStream s =3D File.Create(&quot;test-file&quot;);
s.Close();
StreamWriter sw =3D new StreamWriter(&quot;test-file&quot;);
//do some work
sw.Close();

Solution 2 (more elegant):

using(StreamWriter sw =3D new StreamWriter(File.Create(&quot;test-file&quot;))) {
	//do some work
}

RoBiK

-----Original Message-----
From: <A HREF="mailto:mono-list-admin@lists.ximian.com">mono-list-admin@lists.ximian.com</A>
[mailto:<A HREF="mailto:mono-list-admin@lists.ximian.com">mono-list-admin@lists.ximian.com</A>] On Behalf Of HannibAl Bundie
Sent: Mittwoch, 02. Juni 2004 16:39
To: <A HREF="mailto:mono-list@lists.ximian.com">mono-list@lists.ximian.com</A>
Subject: [Mono-list] Can't open a StreamWritter with a file created by
File.Create

Hi,

With the mono beta 2 I'm not able to create a file with File.Create and
then, open a StreamWritter on it.
For example a simple program like this throws the error &quot;Unhandled
Exception: System.IO.IOException: Win32 IO returned =
ERROR_SHARING_VIOLATION.

Path: test-file&quot; everytime I run it :

using System;
using System.IO;

namespace Test {

	public class test {

		public test()
		{
			File.Create(&quot;test-file&quot;);
			StreamWriter sw =3D new StreamWriter(&quot;test-file&quot;);
		}

		static void Main (string[] args)
		{
			new test();
		}
	}
}

But this kind of operation works perfectly on mono beta 1.


So I would like to know if this bug is a regression (what regression !!) =
or
just a bizzarery of my computer.
Accordingly, I would be grateful if someone could run the little program
above and tell me if he has the same result.
In this case I'll open a bug on bugzilla, and in the other case any help
would be appreciated :)

Thanks in advance

_________________________________________________________________
Bloquez les fen=EAtres pop-up, c'est gratuit ! <A HREF="http://toolbar.msn.fr">http://toolbar.msn.fr</A>

_______________________________________________
Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="020877.html">[Mono-list] Can't open a StreamWritter with a file created by File.Create
</A></li>
	<LI> Next message: <A HREF="020878.html">[Mono-list] mcs cannot compile on NFS shares due to Win32 locks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20881">[ date ]</a>
              <a href="thread.html#20881">[ thread ]</a>
              <a href="subject.html#20881">[ subject ]</a>
              <a href="author.html#20881">[ author ]</a>
         </LI>
       </UL>
</body></html>
