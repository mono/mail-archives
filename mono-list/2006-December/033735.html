<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Troubles with Session in Web Services, client side
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Troubles%20with%20Session%20in%20Web%20Services%2C%20client%20side&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033731.html">
   <LINK REL="Next"  HREF="033750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Troubles with Session in Web Services, client side</H1>
    <B>S&#233;bastien Mosser</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Troubles%20with%20Session%20in%20Web%20Services%2C%20client%20side&In-Reply-To="
       TITLE="[Mono-list] Troubles with Session in Web Services, client side">mosser at polytech.unice.fr
       </A><BR>
    <I>Tue Dec 26 07:30:45 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="033731.html">[Mono-list] TimeZone list
</A></li>
        <LI>Next message: <A HREF="033750.html">[Mono-list] Troubles with Session in Web Services, client side
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33735">[ date ]</a>
              <a href="thread.html#33735">[ thread ]</a>
              <a href="subject.html#33735">[ subject ]</a>
              <a href="author.html#33735">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everybody.

I got a problem while trying to invoke a WS written in C#. the WS is
quite simple, and is just a sample of 'How to use Session in .Net Web
Services : A Simple Session Counter'.

The Web User interface works fine (counter value changes well), but,
when I invoke it from a C# client, it doesn't :'(

The following problem happend on my iBook (Mac OS X, Mono 1.2.1) and
on my desktop (Kubuntu, mono 1.1.13.6), even using xsp or xsp2 as Web
Server, ans mcs or gmcs as compiler ...

WS Source code is the following :
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">petitroll at bartimeus</A>:~/Adore/webservices/sandbox/session_counter$ cat
SessionCounter.asmx
&lt;%@ WebService Language=&quot;C#&quot; Class=&quot;Adore.WebServices.SandBox.SessionCounter&quot;%&gt;
/**
 * Test Web Service : Test usage of Session in .Net Web Services !
 * @author Sebastien Mosser
 * @date 2006.12.23
 */
using System;
using System.Web.Services;
using System.Xml.Serialization;
namespace Adore.WebServices.SandBox
{
  [WebService( Namespace=&quot;<A HREF="http://rainbow.essi.fr/Adore4ws/&quot;,">http://rainbow.essi.fr/Adore4ws/&quot;,</A>
               Description=&quot;A quite simple service using session&quot;) ]
  public class SessionCounter: System.Web.Services.WebService
  {
    public SessionCounter() {}
    [WebMethod( Description=&quot;Reseting the session counter value&quot;,
                EnableSession=true)]
    public void ResetValue() { Session[&quot;counter&quot;] = 0; }
    [WebMethod( Description=&quot;Increment by one the session counter&quot;,
                EnableSession=true)]
    public void Increment() {
     if (Session[&quot;counter&quot;] == null)
       ResetValue();
      int i = (int) Session[&quot;counter&quot;] ;
      Session[&quot;counter&quot;] = i+1;
    }
   [WebMethod( Description=&quot;Get the session counter internal value&quot;,
               EnableSession=true)]
    public int GetValue() {
     if (Session[&quot;counter&quot;] == null)
       ResetValue();
     return ((int) Session[&quot;counter&quot;] ) ;
    }
  }
}

Client code is :
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">petitroll at bartimeus</A>:~/Adore/sandbox/DotNetWSClients/SessionCounter$ cat Test.cs
/** A simple SessionCounter Test
 * @author Sebastien
 */
using System;
namespace Adore.WsClient.SessionCounterTest
{
  public class Test
  {
    public static void Main()
    {
      Console.WriteLine(&quot;####&quot;);
      Console.WriteLine(&quot;## SessionCounter.asmx .Net Client&quot;);
      Console.WriteLine(&quot;####&quot;);
      SessionCounter stub = new SessionCounter();
      Console.WriteLine(&quot;## Session Counter Value : &quot; + stub.GetValue());
      Console.WriteLine(&quot;## Incrementing counter 15 times&quot;);
      for (int i = 0; i &lt; 15; i++) {
	Console.WriteLine(&quot;## Invoking 'SessionCounter::Increment()'&quot;);
	stub.Increment();
      }
      Console.WriteLine(&quot;## Session Counter Value : &quot; + stub.GetValue());
    }
  }
}

Execution provide the following result, which is not ... normal :'( :

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">petitroll at bartimeus</A>:~/Adore/sandbox/DotNetWSClients/SessionCounter$ make run

dowmnloading WSDL contract, generate .Net Stub class
wsdl &quot;<A HREF="http://localhost:9000/sandbox/session_counter/SessionCounter.asmx&quot;">http://localhost:9000/sandbox/session_counter/SessionCounter.asmx&quot;</A>
Mono Web Services Description Language Utility
Writing file 'SessionCounter.cs'
mcs /out:Test.exe /r:System.Web.Services *.cs
mono Test.exe
####
## SessionCounter.asmx .Net Client
####
## Session Counter Value : 0
## Incrementing counter 15 times
## Invoking 'SessionCounter::Increment()'
[ ... snipped 13 times ... ]
## Invoking 'SessionCounter::Increment()'
## Session Counter Value : 0
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">petitroll at bartimeus</A>:~/Adore/sandbox/DotNetWSClients/SessionCounter$

does anybody got an idea ? I think I'm missing something obvious ...

Cheers,

-- 
 Sebastien Mosser
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033731.html">[Mono-list] TimeZone list
</A></li>
	<LI>Next message: <A HREF="033750.html">[Mono-list] Troubles with Session in Web Services, client side
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33735">[ date ]</a>
              <a href="thread.html#33735">[ thread ]</a>
              <a href="subject.html#33735">[ subject ]</a>
              <a href="author.html#33735">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
