<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Unix.Native.Syscall.readlink%20memory%20corruption&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030948.html">
   <LINK REL="Next"  HREF="030950.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Unix.Native.Syscall.readlink%20memory%20corruption&In-Reply-To="
       TITLE="[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption">kornelpal at hotmail.com
       </A><BR>
    <I>Tue Mar 14 07:22:23 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="030948.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
        <LI>Next message: <A HREF="030950.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30949">[ date ]</a>
              <a href="thread.html#30949">[ thread ]</a>
              <a href="subject.html#30949">[ subject ]</a>
              <a href="author.html#30949">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;&gt;<i> On a related note:  if a C function mallocs some memory and returns a
</I>&gt;&gt;&gt;<i> pointer
</I>&gt;&gt;&gt;<i> to that memory, does p/invoke free the memory once marshalling is
</I>&gt;&gt;&gt;<i> complete?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> No. There is simply no way to automatically determine whether it
</I>&gt;&gt;<i> should be
</I>&gt;&gt;<i> freed and there is even less chance to determine how (using what
</I>&gt;&gt;<i> function)
</I>&gt;&gt;<i> it should be freed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you want to do so you have to use an IntPtr that you can free
</I>&gt;&gt;<i> manually.
</I>&gt;&gt;<i> Note that you can alternatively use a custom marshaler but you have to do
</I>&gt;&gt;<i> the same with a more complex and probably more proper design.
</I>&gt;<i> This is not entirely true. A returned string is actually automatically
</I>&gt;<i> freed when marshalled as string (as opposed to IntPtr). In that case
</I>&gt;<i> Mono does not determine whether it should be freed, it simply frees it.
</I>
I don't think so. If you pass a buffer (that can be StringBuilder as well)
the runtime will free any temporary allocated buffer and the GC will free
the managed buffer. But that buffer is allocated by the caller so it can be
freed easily. The buffer in question however is allocated by the callee and
returned to caller. In this case the runtime will not free the buffer. You
have to free it manually using the function mentioned in the documentation
of the function that return the buffer becuase calling free() may not work
as the buffer may come from other source. Also note that the returned buffer
may come from some shared source so you should not free or modify it at.
This latter case is unsafe but can provide better performance.

I hope now you uderstand what kind of buffer are we talking about and why is
it impossible for the runtime to free it automatically.

Korn&#233;l

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030948.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
	<LI>Next message: <A HREF="030950.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30949">[ date ]</a>
              <a href="thread.html#30949">[ thread ]</a>
              <a href="subject.html#30949">[ subject ]</a>
              <a href="author.html#30949">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
