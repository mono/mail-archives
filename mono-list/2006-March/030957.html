<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Unix.Native.Syscall.readlink%20memory%20corruption&In-Reply-To=1142350659.2859.7.camel%40lalo.micasa">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030953.html">
   <LINK REL="Next"  HREF="030958.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Mono.Unix.Native.Syscall.readlink%20memory%20corruption&In-Reply-To=1142350659.2859.7.camel%40lalo.micasa"
       TITLE="[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption">jonpryor at vt.edu
       </A><BR>
    <I>Tue Mar 14 17:00:02 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="030953.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
        <LI>Next message: <A HREF="030958.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30957">[ date ]</a>
              <a href="thread.html#30957">[ thread ]</a>
              <a href="subject.html#30957">[ subject ]</a>
              <a href="author.html#30957">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2006-03-14 at 10:37 -0500, Gonzalo Paniagua Javier wrote:
&gt;<i> Here's a patch that fixes the corruption problem. May I commit?
</I>        
&gt;<i> -       if (items_written &gt; mono_stringbuilder_capacity (sb))
</I>&gt;<i> +       if (items_written &gt; mono_stringbuilder_capacity (sb)) {
</I>&gt;<i>                 items_written = mono_stringbuilder_capacity (sb);
</I>&gt;<i> +               need_nul = TRUE;
</I>&gt;<i> +       }
</I>
I may be missing something, but I'm missing how this actually fixes the
corruption problem.

The intent is that a marshaled StringBuilder will contain a buffer that
unmanaged code should fill.  (Reality is that the runtime passes an
internally allocated buffer to the unmanaged code and copies this buffer
into the StringBuilder, but this doesn't change things significantly...)

So if unmanaged code overwrote the buffer:

-       if (items_written &gt; mono_stringbuilder_capacity (sb))

isn't there a chance that the internal buffer was also overwritten?  If
this is the case, isn't there _no_ _way_ to avoid any memory corruption,
since by definition a buffer was overflowed, so you have no idea what
was overflowed?

(I suppose mono could allocate an extra memory block and set the
permissions to deny writing, triggering a hardware exception if it's
written to, but I don't believe this is actually done...)

Regardless, if the StringBuilder capacity is overwritten, wouldn't it
make more sense to generate an exception, such as an
ExecutionEngineException or something?

 - Jon


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030953.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
	<LI>Next message: <A HREF="030958.html">[Mono-list] Mono.Unix.Native.Syscall.readlink memory corruption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30957">[ date ]</a>
              <a href="thread.html#30957">[ thread ]</a>
              <a href="subject.html#30957">[ subject ]</a>
              <a href="author.html#30957">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
