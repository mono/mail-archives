<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Rewriting path with an HttpModule
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gonzalo%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="012992.html">
   <LINK REL="Next"  HREF="013010.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Rewriting path with an HttpModule
   </H1>
    <B>Gonzalo Paniagua Javier
    </B> 
    <A HREF="mailto:gonzalo%40ximian.com"
       TITLE="[Mono-list] Rewriting path with an HttpModule">gonzalo@ximian.com
       </A><BR>
    <I>18 Mar 2003 01:07:27 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="012992.html">[Mono-list] Rewriting path with an HttpModule
</A></li>
        <LI> Next message: <A HREF="013010.html">[Mono-list] Rewriting path with an HttpModule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13004">[ date ]</a>
              <a href="thread.html#13004">[ thread ]</a>
              <a href="subject.html#13004">[ subject ]</a>
              <a href="author.html#13004">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>El lun, 17 de 03 de 2003 a las 14:42, Daniel Lopez escribió:
&gt;<i> As mentioned earlier, I am developing an ASP.NET HttpModule that maps URLs like
</I>&gt;<i> 
</I>&gt;<i> ~/username/foo/bar.aspx
</I>
/~username/....

Well, in this case, the application host running the module must be
running on '/' virtual directory, since MS does not allow that the path
passed to HttpContext.RewritePath is from another application (i just
tested it under MS+IIS and it says &quot;The virtual path 'xxx' maps to
another application, which is not allowed&quot; (btw, i'll change RewritePath
to behave as MS after some more testing)).

&gt;<i> 
</I>&gt;<i> to the file on disk
</I>&gt;<i> 
</I>&gt;<i> /home/username/public_html/foo/bar.aspx
</I>&gt;<i> 
</I>&gt;<i> In a similar way to how Apache mod_userdir does.
</I>&gt;<i> That requires implementing RewritePath and changing the PhysicalFilePath
</I>&gt;<i> returned, small changes that I already commited.
</I>&gt;<i> The problem that I am running into is that some parts of the current codebase
</I>&gt;<i> assume that that file path does not change in the life of the request and
</I>&gt;<i> that is also rooted on AppPath.
</I>
There are probably a few fields returned from properties that are filled
on the first use of the property. Those fields have to be set to null in
RewritePath. I'll try to fix this too.

&gt;<i> I am looking for the minimal changes to get this to work, I attach a small
</I>&gt;<i> pacth that works, but since I am not familiar with that part of the
</I>&gt;<i> codebase, can you have a look before I apply?
</I>
The path passed to rewrite path must be relative to the application host
base path (--root in server.exe), so UserDir.cs is wrong because it
passes the full path to the file instead of a virtual path. (MS says
&quot;c:\xxx&quot; is a physical path&quot;) (heh, and they say that they throw an
ArgumentNullException when the path is null but i get a
NullReferenceException :).

I don't think that hacking the generator is a good idea. For example,
the developer can provide his/her own .dll with a
TemplateSourceDirectory override.

&gt;<i> 
</I>&gt;<i> I also attach the sample module and a makefile. To test this, you will
</I>&gt;<i> need to copu UserDir.dll to where your other dlls are and add the following
</I>&gt;<i> to your machine.config in the &lt;httpModules&gt; section 
</I>&gt;<i> 
</I>&gt;<i> &lt;add name=&quot;UserDir&quot; type=&quot;ModMono.Examples.UserDir, UserDir&quot; /&gt;
</I>
After fixing RewritePath, i'll modify it and send it back to you.

Btw, I've found an interesing link (god bless google!):
<A HREF="http://www.codeproject.com/aspnet/URLRewriter.asp">http://www.codeproject.com/aspnet/URLRewriter.asp</A> 


Thanks!

-Gonzalo



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="012992.html">[Mono-list] Rewriting path with an HttpModule
</A></li>
	<LI> Next message: <A HREF="013010.html">[Mono-list] Rewriting path with an HttpModule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13004">[ date ]</a>
              <a href="thread.html#13004">[ thread ]</a>
              <a href="subject.html#13004">[ subject ]</a>
              <a href="author.html#13004">[ author ]</a>
         </LI>
       </UL>
</body></html>
