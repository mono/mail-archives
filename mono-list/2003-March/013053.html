<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Threading + Exception Handling (2 Questions)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jonpryor%40vt.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="013051.html">
   <LINK REL="Next"  HREF="013054.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Threading + Exception Handling (2 Questions)
   </H1>
    <B>Jonathan Pryor
    </B> 
    <A HREF="mailto:jonpryor%40vt.edu"
       TITLE="[Mono-list] Threading + Exception Handling (2 Questions)">jonpryor@vt.edu
       </A><BR>
    <I>20 Mar 2003 10:12:38 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="013051.html">[Mono-list] Threading + Exception Handling (2 Questions)
</A></li>
        <LI> Next message: <A HREF="013054.html">[Mono-list] Threading + Exception Handling (2 Questions)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13053">[ date ]</a>
              <a href="thread.html#13053">[ thread ]</a>
              <a href="subject.html#13053">[ subject ]</a>
              <a href="author.html#13053">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Responses Inline.

On Thu, 2003-03-20 at 09:59, Timothy Parez wrote:
&lt;snip/&gt;
&gt;<i> Is this implemented for mono under Linux ?
</I>
Yes, Thread.Abort is implemented under Linux.

&lt;snip/&gt;
&gt;<i> Alas, this information appears to be null
</I>&gt;<i> &gt; &gt; for my build of mono (see attached sample program), but that might be
</I>&gt;<i> &gt; &gt; fixed by now.  Anyone else know for sure?
</I>&gt;<i> 
</I>&gt;<i> What version of mono are you using ?
</I>&gt;<i> I'm currently using mono 0.23 (red-carpet rpm)
</I>
I'm using an ancient CVS build (mono --version reports 0.19.1.0).  I
really should update some time...

&lt;snip/&gt;
&gt;<i> Besides the solution you noted what do you think about
</I>&gt;<i> making the QueryBase class expose a custom event which the second
</I>&gt;<i> thread calls when an error occurs and which the first thread subscribes to.
</I>&gt;<i> Or is that to far fetched, as it would involve a class subscribing to an
</I>&gt;<i> event
</I>&gt;<i> he exposed himself.
</I>
That should be possible as well.  It's effectively the same thing.  It's
also the first idea that came to mind before I looked up the
UnhandledException event.

 - Jon

&gt;<i> Thnx
</I>&gt;<i> Timothy.
</I>&gt;<i> 
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i> From: &quot;Jonathan Pryor&quot; &lt;<A HREF="mailto:jonpryor@vt.edu">jonpryor@vt.edu</A>&gt;
</I>&gt;<i> To: &quot;Timothy Parez&quot; &lt;<A HREF="mailto:tpsoftware@users.sourceforge.net">tpsoftware@users.sourceforge.net</A>&gt;
</I>&gt;<i> Cc: &quot;Mono List&quot; &lt;<A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>&gt;
</I>&gt;<i> Sent: Thursday, March 20, 2003 3:47 PM
</I>&gt;<i> Subject: Re: [Mono-list] Threading + Exception Handling (2 Questions)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; Oops.  Forgot to attach the UnhandledException sample.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  - Jon
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Thu, 2003-03-20 at 09:45, Jonathan Pryor wrote:
</I>&gt;<i> &gt; &gt; It sounds like you want to have an exception generated in one thread
</I>&gt;<i> &gt; &gt; appear in another.  I don't think that's possible.  Exceptions are
</I>&gt;<i> &gt; &gt; relative to the thread they're generated from, and deal exclusively with
</I>&gt;<i> &gt; &gt; the thread of that stack.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; However, there is a workaround, if I'm understanding you correctly.  You
</I>&gt;<i> &gt; &gt; could hook up the AppDomain.UnhandledException event to your first
</I>&gt;<i> &gt; &gt; thread, which would let you know if an exception was thrown from some
</I>&gt;<i> &gt; &gt; thread in your application and not caught.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; In theory, you could use the UnhandledExceptionEventArgs information to
</I>&gt;<i> &gt; &gt; determine the type of the thrown exception, to ensure that you're
</I>&gt;<i> &gt; &gt; trapping the right errors.  Alas, this information appears to be null
</I>&gt;<i> &gt; &gt; for my build of mono (see attached sample program), but that might be
</I>&gt;<i> &gt; &gt; fixed by now.  Anyone else know for sure?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Regardless, your UnhandledException handler can set a variable which the
</I>&gt;<i> &gt; &gt; main thread checks.  If the variable is set, the main thread would throw
</I>&gt;<i> &gt; &gt; an exception, simulating the appearance of the thread moving from one
</I>&gt;<i> &gt; &gt; thread to another.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; As for Thread.Abort, it should work as you expect.  Thread.Abort
</I>&gt;<i> &gt; &gt; generates an exception in the specified thread, not the calling thread
</I>&gt;<i> &gt; &gt; (unless they're the same), and that exception will have no effect on the
</I>&gt;<i> &gt; &gt; calling thread.  So Thread.Abort followed by a throw should work.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; There is one problem, though.  Thread.Abort isn't implemented for mono
</I>&gt;<i> &gt; &gt; under Windows (it's a pthread under Windows problem; check the
</I>&gt;<i> &gt; &gt; archives), so this may not be an acceptable solution for you.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  - Jon
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On Thu, 2003-03-20 at 08:51, Timothy Parez wrote:
</I>&gt;<i> &gt; &gt; &gt; Hello,
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I have class which creates another thread
</I>&gt;<i> &gt; &gt; &gt; now that other tread can throw a custom error, but
</I>&gt;<i> &gt; &gt; &gt; when this error is thrown I want the main thread of the class library
</I>&gt;<i> &gt; &gt; &gt; to receive this exception so that the client application which uses my
</I>&gt;<i> &gt; &gt; &gt; library get's this error and all execution of other code in my class
</I>&gt;<i> &gt; &gt; &gt; library is stopped.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;  //Code executed by the main thread:
</I>&gt;<i> &gt; &gt; &gt;   protected byte[] Query(byte[] sendData)
</I>&gt;<i> &gt; &gt; &gt;   {
</I>&gt;<i> &gt; &gt; &gt;    //Set all values
</I>&gt;<i> &gt; &gt; &gt;    data = sendData;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;    queryThread = new Thread(new ThreadStart(ExecuteQuery));
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;    //Start the query
</I>&gt;<i> &gt; &gt; &gt;    queryThread.Start();
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;    //Wait for the query to exit
</I>&gt;<i> &gt; &gt; &gt;    if (!queryThread.Join(timeout * 1000))
</I>&gt;<i> &gt; &gt; &gt;    {
</I>&gt;<i> &gt; &gt; &gt;     queryThread.Abort();
</I>&gt;<i> &gt; &gt; &gt;     throw new Exceptions.QueryTimeoutException(&quot;Query Timeout: &quot; +
</I>&gt;<i> &gt; &gt; &gt; timeout.ToString() + &quot; seconds&quot;);
</I>&gt;<i> &gt; &gt; &gt;    }
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;    //Return the response, which is now saved in the local variable
</I>&gt;<i> &gt; &gt; &gt;    return queryResponse;
</I>&gt;<i> &gt; &gt; &gt;   }
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; // Code executed by the queryThread
</I>&gt;<i> &gt; &gt; &gt;  private void ExecuteQuery()
</I>&gt;<i> &gt; &gt; &gt;   {
</I>&gt;<i> &gt; &gt; &gt;    UdpClient client = new UdpClient();
</I>&gt;<i> &gt; &gt; &gt;    //Connect to the server and send the query data
</I>&gt;<i> &gt; &gt; &gt;    try
</I>&gt;<i> &gt; &gt; &gt;    {
</I>&gt;<i> &gt; &gt; &gt;     client.Connect(ip,port);
</I>&gt;<i> &gt; &gt; &gt;     client.Send(data,data.Length);
</I>&gt;<i> &gt; &gt; &gt;    }
</I>&gt;<i> &gt; &gt; &gt;    catch (Exception e)
</I>&gt;<i> &gt; &gt; &gt;    {
</I>&gt;<i> &gt; &gt; &gt;     client.Close();
</I>&gt;<i> &gt; &gt; &gt;     throw new Exceptions.InvalidHostException(&quot;Unknown host: &quot; +
</I>&gt;<i> &gt; &gt; &gt; ip,e);
</I>&gt;<i> &gt; &gt; &gt;    }
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;    //Listen for a response - This is the client side
</I>&gt;<i> &gt; &gt; &gt;    IPEndPoint serverIPEndPoint = new IPEndPoint(IPAddress.Any,0);
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;    //Receive the response
</I>&gt;<i> &gt; &gt; &gt;    try
</I>&gt;<i> &gt; &gt; &gt;    {
</I>&gt;<i> &gt; &gt; &gt;     queryResponse = client.Receive(ref serverIPEndPoint);
</I>&gt;<i> &gt; &gt; &gt;    }
</I>&gt;<i> &gt; &gt; &gt;    catch (Exception e)
</I>&gt;<i> &gt; &gt; &gt;    {
</I>&gt;<i> &gt; &gt; &gt;     throw new Exceptions.ConnectionRefusedException(&quot;The connection
</I>&gt;<i> &gt; &gt; &gt; was refused by the remote host: &quot; + ip + &quot;:&quot; + port.ToString(),e);
</I>&gt;<i> &gt; &gt; &gt;    }
</I>&gt;<i> &gt; &gt; &gt;    finally
</I>&gt;<i> &gt; &gt; &gt;    {
</I>&gt;<i> &gt; &gt; &gt;     client.Close();
</I>&gt;<i> &gt; &gt; &gt;    }
</I>&gt;<i> &gt; &gt; &gt;   }
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; As you can see the ExecuteQuery() function can throw the
</I>&gt;<i> &gt; &gt; &gt; Exceptions.ConnectionRefusedException,
</I>&gt;<i> &gt; &gt; &gt; but my main thread never receives this error, so the execution of the
</I>&gt;<i> &gt; &gt; &gt; code in the main thread does not stop.
</I>&gt;<i> &gt; &gt; &gt; How can I fix this.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I also have a second question:
</I>&gt;<i> &gt; &gt; &gt;     queryThread.Abort();
</I>&gt;<i> &gt; &gt; &gt;     throw new Exceptions.QueryTimeoutException(&quot;Query Timeout: &quot; +
</I>&gt;<i> &gt; &gt; &gt; timeout.ToString() + &quot; seconds&quot;);
</I>&gt;<i> &gt; &gt; &gt; I abort the second thread, will the QueryTimeoutException still be
</I>&gt;<i> &gt; &gt; &gt; thrown ? (I hope so), or will the .Abort() cause an error
</I>&gt;<i> &gt; &gt; &gt; which will prevent from the QueryTimeoutException ever happening, in
</I>&gt;<i> &gt; &gt; &gt; that case how do I abort the second query and still throw the
</I>&gt;<i> &gt; &gt; &gt; QueryTimeoutException ?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Thnx.
</I>&gt;<i> &gt; &gt; &gt; TP.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="013051.html">[Mono-list] Threading + Exception Handling (2 Questions)
</A></li>
	<LI> Next message: <A HREF="013054.html">[Mono-list] Threading + Exception Handling (2 Questions)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13053">[ date ]</a>
              <a href="thread.html#13053">[ thread ]</a>
              <a href="subject.html#13053">[ subject ]</a>
              <a href="author.html#13053">[ author ]</a>
         </LI>
       </UL>
</body></html>
