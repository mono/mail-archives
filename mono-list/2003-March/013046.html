<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Threading + Exception Handling (2 Questions)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tpsoftware%40users.sourceforge.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="013045.html">
   <LINK REL="Next"  HREF="013049.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Threading + Exception Handling (2 Questions)
   </H1>
    <B>Timothy Parez
    </B> 
    <A HREF="mailto:tpsoftware%40users.sourceforge.net"
       TITLE="[Mono-list] Threading + Exception Handling (2 Questions)">tpsoftware@users.sourceforge.net
       </A><BR>
    <I>Thu, 20 Mar 2003 14:51:51 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="013045.html">[Mono-list] Mono build problem. Please Help
</A></li>
        <LI> Next message: <A HREF="013049.html">[Mono-list] Threading + Exception Handling (2 Questions)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13046">[ date ]</a>
              <a href="thread.html#13046">[ thread ]</a>
              <a href="subject.html#13046">[ subject ]</a>
              <a href="author.html#13046">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_000A_01C2EEF0.3D8D7E40
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

Hello,

I have class which creates another thread
now that other tread can throw a custom error, but
when this error is thrown I want the main thread of the class library to =
receive this exception so that the client application which uses my =
library get's this error and all execution of other code in my class =
library is stopped.

 //Code executed by the main thread:
  protected byte[] Query(byte[] sendData)
  {
   //Set all values
   data =3D sendData;

   queryThread =3D new Thread(new ThreadStart(ExecuteQuery));
           =20
   //Start the query
   queryThread.Start();
  =20
   //Wait for the query to exit
   if (!queryThread.Join(timeout * 1000))
   {
    queryThread.Abort();
    throw new Exceptions.QueryTimeoutException(&quot;Query Timeout: &quot; + =
timeout.ToString() + &quot; seconds&quot;);
   }
  =20
   //Return the response, which is now saved in the local variable
   return queryResponse;
  }

// Code executed by the queryThread
 private void ExecuteQuery()
  {
   UdpClient client =3D new UdpClient();
   //Connect to the server and send the query data
   try
   {
    client.Connect(ip,port);
    client.Send(data,data.Length);
   }
   catch (Exception e)
   {
    client.Close();
    throw new Exceptions.InvalidHostException(&quot;Unknown host: &quot; + ip,e);
   }

   //Listen for a response - This is the client side
   IPEndPoint serverIPEndPoint =3D new IPEndPoint(IPAddress.Any,0);
  =20
   //Receive the response
   try
   {
    queryResponse =3D client.Receive(ref serverIPEndPoint);
   }
   catch (Exception e)
   {
    throw new Exceptions.ConnectionRefusedException(&quot;The connection was =
refused by the remote host: &quot; + ip + &quot;:&quot; + port.ToString(),e);
   }
   finally
   {
    client.Close();
   }
  }

As you can see the ExecuteQuery() function can throw the =
Exceptions.ConnectionRefusedException,
but my main thread never receives this error, so the execution of the =
code in the main thread does not stop.
How can I fix this.

I also have a second question:=20
    queryThread.Abort();
    throw new Exceptions.QueryTimeoutException(&quot;Query Timeout: &quot; + =
timeout.ToString() + &quot; seconds&quot;);
I abort the second thread, will the QueryTimeoutException still be =
thrown ? (I hope so), or will the .Abort() cause an error
which will prevent from the QueryTimeoutException ever happening, in =
that case how do I abort the second query and still throw the =
QueryTimeoutException ?


Thnx.
TP.
------=_NextPart_000_000A_01C2EEF0.3D8D7E40
Content-Type: text/html;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META http-equiv=3DContent-Type content=3D&quot;text/html; =
charset=3Diso-8859-1&quot;&gt;
&lt;META content=3D&quot;MSHTML 6.00.2800.1106&quot; name=3DGENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=3D#ffffff&gt;
&lt;DIV&gt;&lt;FONT face=3DArial size=3D2&gt;
&lt;DIV&gt;Hello,&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;I have class which creates another thread&lt;/DIV&gt;
&lt;DIV&gt;now that other tread can throw a custom error, but&lt;/DIV&gt;
&lt;DIV&gt;when this error is thrown I want the main thread of the class =
library to=20
receive this exception so that the client application which uses my =
library=20
get's this error and all execution of other code in my class library is=20
stopped.&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;//Code executed by the main thread:&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;protected byte[] Query(byte[]=20
sendData)&lt;BR&gt;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;//Set all=20
values&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;data =3D sendData;&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;queryThread =3D new Thread(new=20
ThreadStart(ExecuteQuery));&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;//Start the=20
query&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;queryThread.Start();&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;BR&gt;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;//Wait=20
for the query to exit&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (!queryThread.Join(timeout =
*=20
1000))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;queryThread.Abor=
t();&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throw=20
new Exceptions.QueryTimeoutException(&quot;Query Timeout: &quot; + =
timeout.ToString() + &quot;=20
seconds&quot;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;n=
bsp;//Return=20
the response, which is now saved in the local=20
variable&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;return =
queryResponse;&lt;BR&gt;&amp;nbsp;&amp;nbsp;}&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;// Code executed by the queryThread&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;private void=20
ExecuteQuery()&lt;BR&gt;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;UdpClient client =
=3D new=20
UdpClient();&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;//Connect to the server and send the =
query=20
data&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;try&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp=
;&amp;nbsp;client.Connect(ip,port);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;client.Send(da=
ta,data.Length);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;catch=20
(Exception=20
e)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;client.Close();&lt;BR&gt;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throw=20
new Exceptions.InvalidHostException(&quot;Unknown host: &quot; +=20
ip,e);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;//Listen for a response - This is the client=20
side&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;IPEndPoint serverIPEndPoint =3D new=20
IPEndPoint(IPAddress.Any,0);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;/=
/Receive=20
the=20
response&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;try&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;queryResponse=20
=3D client.Receive(ref=20
serverIPEndPoint);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;catch =
(Exception=20
e)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throw new=20
Exceptions.ConnectionRefusedException(&quot;The connection was refused by the =
remote=20
host: &quot; + ip + &quot;:&quot; +=20
port.ToString(),e);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;finally&lt;B=
R&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;client.Close();&lt;BR&gt;&amp;nbsp=
;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;}&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;As you can see the ExecuteQuery() function can throw the=20
Exceptions.ConnectionRefusedException,&lt;/DIV&gt;
&lt;DIV&gt;but my main thread never receives this error, so the execution of =
the code=20
in the main thread does not stop.&lt;/DIV&gt;
&lt;DIV&gt;How can I fix this.&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;I also have a second question: &lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;queryThread.Abort();&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;n=
bsp;throw=20
new Exceptions.QueryTimeoutException(&quot;Query Timeout: &quot; + =
timeout.ToString() + &quot;=20
seconds&quot;);&lt;/DIV&gt;
&lt;DIV&gt;I abort the second thread, will the QueryTimeoutException still be =
thrown ?=20
(I hope so), or will the .Abort() cause an error&lt;/DIV&gt;
&lt;DIV&gt;which will prevent from the QueryTimeoutException ever happening, =
in that=20
case how do I abort the second query and still throw the =
QueryTimeoutException=20
?&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;Thnx.&lt;/DIV&gt;
&lt;DIV&gt;TP.&lt;/DIV&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;

------=_NextPart_000_000A_01C2EEF0.3D8D7E40--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="013045.html">[Mono-list] Mono build problem. Please Help
</A></li>
	<LI> Next message: <A HREF="013049.html">[Mono-list] Threading + Exception Handling (2 Questions)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13046">[ date ]</a>
              <a href="thread.html#13046">[ thread ]</a>
              <a href="subject.html#13046">[ subject ]</a>
              <a href="author.html#13046">[ author ]</a>
         </LI>
       </UL>
</body></html>
