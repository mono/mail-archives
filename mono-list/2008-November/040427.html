<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] does GZipStream class has any bugs?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20%3D%3Fwindows-1251%3Fq%3Fdoes_GZipStream_class_has_any_bugs%3F%3D%0A%09%3D%3Fwindows-1251%3Fq%3F%3D3F%3F%3D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040422.html">
   <LINK REL="Next"  HREF="040428.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] does GZipStream class has any bugs?</H1>
    <B>CarGa</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20%3D%3Fwindows-1251%3Fq%3Fdoes_GZipStream_class_has_any_bugs%3F%3D%0A%09%3D%3Fwindows-1251%3Fq%3F%3D3F%3F%3D&In-Reply-To="
       TITLE="[Mono-list] does GZipStream class has any bugs?">carga at mail.ru
       </A><BR>
    <I>Tue Nov 25 04:41:19 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="040422.html">[Mono-list] MonoDevelop 2.0 Alpha 2 released
</A></li>
        <LI>Next message: <A HREF="040428.html">[Mono-list] Develop &quot;patent-safe&quot; with mono - How?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40427">[ date ]</a>
              <a href="thread.html#40427">[ thread ]</a>
              <a href="subject.html#40427">[ subject ]</a>
              <a href="author.html#40427">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, all.

I tried zip/unzip actions with GZipStream class and had no luck with it. It looks like zip process works well, but unzip fails completely.

Here is some snippets here:

Zipping method seems to work well

protected static byte [] GetDefaultSerializedForm (byte [] bytesToZip) {
	byte [] buffer = null;
	using (MemoryStream ms2 = new MemoryStream ()) {
		using (var gzip = new GZipStream (ms2, CompressionMode.Compress, true)) {
			gzip.Write (bytesToZip, 0, bytesToZip.Length);
			gzip.Flush ();
			ms2.Position = 0;
			buffer = ms2.ToArray ();
			gzip.Close ();
		}
		ms2.Close ();
	}

	return buffer;
}

But unzip...

protected static byte[] RestoreFromDefaultSerializedForm (byte [] bytesToUnzip) {
	byte [] result = null;
	byte [] buffer = new byte [8192];
	using(MemoryStream unpacked = new MemoryStream())
	using (MemoryStream ms = new MemoryStream (bytesToUnzip)) {
	    ms.Position = 0;
	    using (GZipStream gunzip = new GZipStream (ms, CompressionMode.Decompress, true)) {
	        ms.Position = 0;
	        int count=0;
		while ((count = gunzip.Read (buffer, 0, buffer.Length)) &gt; 0) {
	            unpacked.Write(buffer, 0, count);
	        }
	        gunzip.Close ();
	    }
	    ms.Close ();
	    unpacked.Position = 0;
	    result = unpacked.ToArray ();
	}

	return result;
}

Debugging shows, that it never comes to unpacked.Write(buffer, 0, count); line, because gunzip.Read(...) always returns 0. At the same time after gunzip.Read(...) ms.Position changes and becomes equal to the size of the bytesToUnzip array. Extremely weird!

Please, advice me how to implement decompression with GZipStream. Code snippet maybe...

Environment: Ubuntu 8.10, mono is compiled from svn (rev. 119107).

Thank you in advance,
Anton.
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040422.html">[Mono-list] MonoDevelop 2.0 Alpha 2 released
</A></li>
	<LI>Next message: <A HREF="040428.html">[Mono-list] Develop &quot;patent-safe&quot; with mono - How?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40427">[ date ]</a>
              <a href="thread.html#40427">[ thread ]</a>
              <a href="subject.html#40427">[ subject ]</a>
              <a href="author.html#40427">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
