<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Trouble Porting a C# Ogg, Vorbis,	Theora wrapper	to Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Trouble%20Porting%20a%20C%23%20Ogg%2C%20Vorbis%2C%0A%09Theora%20wrapper%09to%20Mono&In-Reply-To=1960fb140805191414v3001c4del741d513a5bb51293%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038562.html">
   <LINK REL="Next"  HREF="038563.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Trouble Porting a C# Ogg, Vorbis,	Theora wrapper	to Mono</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Trouble%20Porting%20a%20C%23%20Ogg%2C%20Vorbis%2C%0A%09Theora%20wrapper%09to%20Mono&In-Reply-To=1960fb140805191414v3001c4del741d513a5bb51293%40mail.gmail.com"
       TITLE="[Mono-list] Trouble Porting a C# Ogg, Vorbis,	Theora wrapper	to Mono">miguel at novell.com
       </A><BR>
    <I>Tue May 20 17:21:01 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="038562.html">[Mono-list] Trouble Porting a C# Ogg, Vorbis, Theora wrapper to Mono
</A></li>
        <LI>Next message: <A HREF="038563.html">[Mono-list]  Forums added to Mono Website
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38575">[ date ]</a>
              <a href="thread.html#38575">[ thread ]</a>
              <a href="subject.html#38575">[ subject ]</a>
              <a href="author.html#38575">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>My suggestion is to try Valgrind, your marshalling might be buggy in
some place and it just happens to trample on some memory on Linux that
you do not trample on Windows.

On Mon, 2008-05-19 at 22:14 +0100, Charles Mason wrote:
&gt;<i> Hi All,
</I>&gt;<i> 
</I>&gt;<i> I am currently trying to port an open source wrapper I wrote for
</I>&gt;<i> libogg, libvorbis and libtheora to mono. All of the above libraries
</I>&gt;<i> are standard portable C libraries compiled as shared objects.
</I>&gt;<i> 
</I>&gt;<i> I currently have a wrapper for each of the three libraries written in
</I>&gt;<i> C#, which works correctly on windows. However when I try to use the
</I>&gt;<i> same wrapper with mono and linux versions of same libraries I get a
</I>&gt;<i> SIGSEGV error. Know the C libraries are identical as I have compiled
</I>&gt;<i> them myself form the same code which works on windows.
</I>&gt;<i> 
</I>&gt;<i> All of the marshaling my wrappers do is manual, using the Marshal
</I>&gt;<i> class, except for a few single value types (int &amp; doubles mostly). I
</I>&gt;<i> assumed I was trying to free some unmanaged memory that was currently
</I>&gt;<i> in use by the native library, so as I test I tried commenting out all
</I>&gt;<i> references to Marshal.FreeHGlobal.This hasn't stopped the SIGSEGV
</I>&gt;<i> error.
</I>&gt;<i> 
</I>&gt;<i> The Managed Stack Trace mono creates seems to point to a different
</I>&gt;<i> method every time. So I began to wonder if it was mono which actually
</I>&gt;<i> triggered the SIGSEGV error. I updated from the standard Ubuntu
</I>&gt;<i> packages to a third party one containing the latest release, the
</I>&gt;<i> problem was unchanged.
</I>&gt;<i> 
</I>&gt;<i> After installing the debug symbols for mono I manged to use gdb to do
</I>&gt;<i> a back trace. I don't know much about the internals of mono but, from
</I>&gt;<i> what I can tell it appears to be part of the mono garbage collector
</I>&gt;<i> which is causing the SIGSEGV. I have included the back trace below.
</I>&gt;<i> 
</I>&gt;<i> (gdb) mono_backtrace 40
</I>&gt;<i> #0  0xb7fa9410 in __kernel_vsyscall ()
</I>&gt;<i> #1  0xb7d6e085 in raise () from /lib/tls/i686/cmov/libc.so.6
</I>&gt;<i> #2  0xb7d6fa01 in abort () from /lib/tls/i686/cmov/libc.so.6
</I>&gt;<i> #3  0x08181782 in mono_handle_native_sigsegv (signal=11, ctx=0xb7b06d0c)
</I>&gt;<i>     at mini-exceptions.c:1080
</I>&gt;<i> 1080	mini-exceptions.c: No such file or directory.
</I>&gt;<i> 	in mini-exceptions.c
</I>&gt;<i> #4  0x08080001 in mono_arch_handle_altstack_exception (sigctx=0xb7b06d0c,
</I>&gt;<i>     fault_addr=0x5, stack_ovf=0) at exceptions-x86.c:855
</I>&gt;<i> 855	exceptions-x86.c: No such file or directory.
</I>&gt;<i> 	in exceptions-x86.c
</I>&gt;<i> #5  &lt;signal handler called&gt;
</I>&gt;<i> #6  0x08142423 in GC_mark_from (mark_stack_top=0x20160, mark_stack=0x20000,
</I>&gt;<i>     mark_stack_limit=0x28000) at mark.c:724
</I>&gt;<i> 724	mark.c: No such file or directory.
</I>&gt;<i> 	in mark.c
</I>&gt;<i> #7  0x081427ef in GC_mark_some (cold_gc_frame=0xbfc7bcac &quot;&quot;) at mark.c:378
</I>&gt;<i> 378	in mark.c
</I>&gt;<i> #8  0x0813884b in GC_stopped_mark (stop_func=0x8137e30 &lt;GC_never_stop_func&gt;)
</I>&gt;<i>     at alloc.c:544
</I>&gt;<i> 544	alloc.c: No such file or directory.
</I>&gt;<i> 	in alloc.c
</I>&gt;<i> #9  0x08138bc7 in GC_try_to_collect_inner (
</I>&gt;<i>     stop_func=0x8137e30 &lt;GC_never_stop_func&gt;) at alloc.c:386
</I>&gt;<i> 386	in alloc.c
</I>&gt;<i> #10 0x08138f3c in GC_collect_or_expand (needed_blocks=43, ignore_off_page=0)
</I>&gt;<i>     at alloc.c:1046
</I>&gt;<i> ---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
</I>&gt;<i> 1046	in alloc.c
</I>&gt;<i> #11 0x0819817a in GC_alloc_large (lw=43012, k=0, flags=0) at malloc.c:60
</I>&gt;<i> 60	malloc.c: No such file or directory.
</I>&gt;<i> 	in malloc.c
</I>&gt;<i> #12 0x08198436 in GC_generic_malloc (lb=172048, k=0) at malloc.c:204
</I>&gt;<i> 204	in malloc.c
</I>&gt;<i> #13 0x08198663 in GC_malloc_atomic (lb=172048) at malloc.c:270
</I>&gt;<i> 270	in malloc.c
</I>&gt;<i> #14 0x080ae24f in mono_array_new_specific (vtable=0x8403878, n=86016)
</I>&gt;<i>     at object.c:3321
</I>&gt;<i> 3321	object.c: No such file or directory.
</I>&gt;<i> 	in object.c
</I>&gt;<i> #15 0xb787fdca in  (wrapper managed-to-native)
</I>&gt;<i> System.Object:__icall_wrapper_mono_array_new_specific (intptr,int) +
</I>&gt;<i> 0x2a (0xb787fda0 0xb787fdf0) [0x34f00 - AMPE Command Line Audio
</I>&gt;<i> Player.exe]
</I>&gt;<i> #16 0x08403878 in ?? ()
</I>&gt;<i> #17 0x00015000 in ?? ()
</I>&gt;<i> #18 0x08235d78 in ?? ()
</I>&gt;<i> #19 0x0009df50 in ?? ()
</I>&gt;<i> #20 0x00000000 in ?? ()
</I>&gt;<i> Initial frame selected; you cannot go up.
</I>&gt;<i> 
</I>&gt;<i> Does anyone have any suggestions on how I can find the cause of this
</I>&gt;<i> problem? There can't be too many problems with my code as the same
</I>&gt;<i> code runs on windows fine. Is there something particularly different
</I>&gt;<i> about the way mono handles unmanaged memory. Is it possible to
</I>&gt;<i> completely disable the garbage collector to see if that stops the
</I>&gt;<i> SIGSEGV error. I know its not a viable solution but it would at least
</I>&gt;<i> help narrow down the cause.
</I>&gt;<i> 
</I>&gt;<i> Any help would be greatly appreciated on this.
</I>&gt;<i> 
</I>&gt;<i> Charlie M
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038562.html">[Mono-list] Trouble Porting a C# Ogg, Vorbis, Theora wrapper to Mono
</A></li>
	<LI>Next message: <A HREF="038563.html">[Mono-list]  Forums added to Mono Website
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38575">[ date ]</a>
              <a href="thread.html#38575">[ thread ]</a>
              <a href="subject.html#38575">[ subject ]</a>
              <a href="author.html#38575">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
