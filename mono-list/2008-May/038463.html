<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] appdomains
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20appdomains&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038461.html">
   <LINK REL="Next"  HREF="038464.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] appdomains</H1>
    <B>Peter Hagen</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20appdomains&In-Reply-To="
       TITLE="[Mono-list] appdomains">peter at wingsofdeath.nu
       </A><BR>
    <I>Fri May  2 05:43:13 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="038461.html">[Mono-list] Native Gtk# on OS X?
</A></li>
        <LI>Next message: <A HREF="038464.html">[Mono-list] VB problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38463">[ date ]</a>
              <a href="thread.html#38463">[ thread ]</a>
              <a href="subject.html#38463">[ subject ]</a>
              <a href="author.html#38463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

i have a very strange resource problem. I'm using the  
GemBox.Spreadsheet dll and it seemed that somehow the resources (or  
something) aren't freed on finishing. I did a manual GC.Collect and  
could see that the garbage collector did release the memory, but when  
looking into top or some kind of proces list, the memory was still in  
use. If I ran it a second time, it would even allocate more memory.  
The only way the memory is freed, is on killing xsp of apache. So, I  
thought I should use a different AppDomain. After sometime I got i  
working, but unfortunally, the memory is still not freed! I have the  
same issue with mono 1.9.1 and 1.2.6. According to GemBox, the  
GC.Collect should clean up the memory. Here is my code:


			AppDomainSetup setup = new AppDomainSetup();
			setup.ApplicationBase = Path.Combine 
(ApplicationInfo.ApplicationPath, &quot;bin&quot;);
			setup.PrivateBinPath = ApplicationInfo.ApplicationPath;
			setup.ApplicationName = &quot;CsvImport&quot;;
			AppDomain appDomain = AppDomain.CreateDomain(&quot;Converter&quot;, null,  
setup);
			
			try {
				//Console.Error.WriteLine(&quot;Checkpoint 1&quot;);
				ObjectHandle oh = (ObjectHandle)appDomain.CreateInstanceFrom 
(Path.Combine(Path.Combine(ApplicationInfo.ApplicationPath, &quot;bin&quot;),  
&quot;DMICTService.Converter.GemBoxSpreadsheet.dll&quot;),  
&quot;DMICTService.Converter.GemBoxSpreadsheet.GemBoxConverter&quot;);
				//Console.Error.WriteLine(&quot;Checkpoint 2&quot;);

				object o = oh.Unwrap();

				//if (o != null)
				//	Console.Error.WriteLine(&quot;o={0}&quot;, o.GetType());

				if (o is iAppDomainConverter) {
					// Console.Error.WriteLine(&quot;we have a iAppDomainConverter&quot;);

					iAppDomainConverter conv = (iAppDomainConverter) o;
					// Console.Error.WriteLine(conv.ToUpper(&quot;test&quot;));

					Willow.Common.IO io = new Willow.Common.IO();
					Encoding enc = io.TextFileEncodingGuess(path);

					if (conv.LoadFileCsv(path, seperator, enc))
						Console.Error.WriteLine(&quot;csv file loaded&quot;);
				}
			} finally {
				AppDomain.Unload(appDomain);
				appDomain = null;
			}

I thought that running something in a different domain would seperate  
the memory usage etc. So, shouldnt this construction clean up the  
memory?

with kind regards

Peter Hagen
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">peter at wingsofdeath.nu</A>
www.WingsOfDeath.nu



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20080502/930ef912/attachment.html">http://lists.ximian.com/pipermail/mono-list/attachments/20080502/930ef912/attachment.html</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038461.html">[Mono-list] Native Gtk# on OS X?
</A></li>
	<LI>Next message: <A HREF="038464.html">[Mono-list] VB problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38463">[ date ]</a>
              <a href="thread.html#38463">[ thread ]</a>
              <a href="subject.html#38463">[ subject ]</a>
              <a href="author.html#38463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
