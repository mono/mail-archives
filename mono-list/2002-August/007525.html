<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] removing delegate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:stodden%40cs.tum.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="007522.html">
   <LINK REL="Next"  HREF="007526.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] removing delegate
   </H1>
    <B>Daniel Stodden
    </B> 
    <A HREF="mailto:stodden%40cs.tum.edu"
       TITLE="[Mono-list] removing delegate">stodden@cs.tum.edu
       </A><BR>
    <I>04 Aug 2002 02:20:54 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="007522.html">[Mono-list] Bug in method System.Threading.ThreadPool.QueueUserWorkItem
</A></li>
        <LI> Next message: <A HREF="007526.html">[Mono-list] Generics support?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7525">[ date ]</a>
              <a href="thread.html#7525">[ thread ]</a>
              <a href="subject.html#7525">[ subject ]</a>
              <a href="author.html#7525">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 2002-08-04 at 01:44, YUAN-FEN KUO wrote:

[cc'd to mono-dev]

&gt;<i> I think the follwoing piece of code will make my question clear:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> delegate void delA();
</I>&gt;<i> delegate void delB();
</I>&gt;<i> 
</I>&gt;<i> class main{
</I>&gt;<i>         static void Main(){
</I>&gt;<i>                 delA food;
</I>&gt;<i>                 delA aoo = new delA(aa);
</I>&gt;<i>                 delB boo = new delB(aa);
</I>&gt;<i>                 delA coo = new delA(aa);
</I>&gt;<i> 
</I>&gt;<i>                 //legal combine
</I>&gt;<i>                 food += aoo;
</I>&gt;<i>                 food();
</I>&gt;<i> 
</I>&gt;<i>                 //combine wrong type
</I>&gt;<i>                 //food += boo;   //throws exception as expected during runtime, though I 
</I>&gt;<i> wonder why not compile time
</I>&gt;<i>                 //food();
</I>&gt;<i> 
</I>&gt;<i>                 //revomve wrong type
</I>&gt;<i>                 food -= boo;   //does not throw any exceptions though type 
</I>&gt;<i> mismathched??
</I>&gt;<i>                 food();
</I>&gt;<i> 
</I>&gt;<i>                 //legal remove 
</I>&gt;<i>                 //&quot;Attempting to remove a delegate from an empty list (or to remove a 
</I>&gt;<i> non-existent delegate from a non-empty list) is not an error&quot; is said in the last 
</I>&gt;<i> paragraph of Secion 15.3
</I>&gt;<i>                  //&quot;Impossible Removal is benign&quot; was used in their sample code in 
</I>&gt;<i> Sec. 15.3 as well.
</I>&gt;<i>                 food -= coo;
</I>&gt;<i>                 food();
</I>&gt;<i> 
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         static void aa(){System.Console.WriteLine(&quot;method aa&quot;);}
</I>&gt;<i> 
</I>&gt;<i> }
</I>
just tried it. this is indeed helpful.

first, there is a bug in mcs. removing the wrong type (food-=boo) should
not be allowed by the compiler.

second, no mscli does not throw on food-=boo. it never does as i pointed
out. but what's _really_ interesting here is that (given an actual
assembly as written above) food -= boo actually suceeds, leaving you
with a null ref.

running mono, the second food() gets you a second call to aa().
running mscli, the second food() already bails out on null.

i'll have to look into this. you may file a bug for the mcs gang in the
mean time if you want to [if there isn't one already].

thanks a lot, i hate you ;),
daniel

&gt;<i> &gt; &gt; It seems that type mismatching isn't caught when removing a 
</I>&gt;<i> &gt; delegate from a 
</I>&gt;<i> &gt; &gt; sequence of delegates.  
</I>&gt;<i> &gt; &gt; I am just wondering if this were done to match the Spec's saying 
</I>&gt;<i> &gt; that 
</I>&gt;<i> &gt; &gt; &quot;impossible removal is benign.&quot;
</I>
-- 
___________________________________________________________________________
 mailto:<A HREF="mailto:stodden@in.tum.de">stodden@in.tum.de</A>




</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="007522.html">[Mono-list] Bug in method System.Threading.ThreadPool.QueueUserWorkItem
</A></li>
	<LI> Next message: <A HREF="007526.html">[Mono-list] Generics support?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7525">[ date ]</a>
              <a href="thread.html#7525">[ thread ]</a>
              <a href="subject.html#7525">[ subject ]</a>
              <a href="author.html#7525">[ author ]</a>
         </LI>
       </UL>
</body></html>
