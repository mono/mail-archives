<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Are constants accessible via reflection?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:harnold%40gmx.de">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="007571.html">
   <LINK REL="Next"  HREF="007576.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Are constants accessible via reflection?
   </H1>
    <B>Holger Arnold
    </B> 
    <A HREF="mailto:harnold%40gmx.de"
       TITLE="[Mono-list] Are constants accessible via reflection?">harnold@gmx.de
       </A><BR>
    <I>Tue, 6 Aug 2002 18:22:45 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="007571.html">[Mono-list] Mono and ADO.NET
</A></li>
        <LI> Next message: <A HREF="007576.html">[Mono-list] Are constants accessible via reflection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7564">[ date ]</a>
              <a href="thread.html#7564">[ thread ]</a>
              <a href="subject.html#7564">[ subject ]</a>
              <a href="author.html#7564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

lupus, thank you for your quick answer. Some further thoughts of mine:
&gt;<i> &gt; for a research project I'm developing a compiler that targets the CLI.
</I>&gt;<i> &gt; This compiler, which is developed partly in C# using Mono, has to store
</I>&gt;<i> &gt; additional semantic information in the compiled PE files. The information
</I>&gt;<i> &gt; will be stored either in the Constant table (0x0B), or in the data
</I>&gt;<i> &gt; section of the PE file, referenced through the FieldRVA table (0x1D).
</I>&gt;<i>
</I>&gt;<i> You could also use custom attributes.
</I>
Yes, I though about that. The information that is attached to the types is
encoded rather low-level in byte arrays. The CLI spec, part. II, describes in
22.3 how arrays can encoded as arguments for custom attributes. But, I don't
know how to do this from within C#, so I was not shure if attributes with
array parameters had any disadvantages. Does anyone know...?

&gt;<i> The constant table can hold only simple types, while you can set an
</I>&gt;<i> arbitrary blob of data in the FieldRVA table.
</I>
Ok, I see. But why don't they store simple types directly in the Value column
of the constant table, instead of an index into the Blob heap? Does this 
mean, that e.g. string constants are stored as index into the Blob heap, 
where an index into the string heap is stored? Or is the spec not exact here?

&gt;<i> &gt; accessible via the standard System.Reflection mechanism, or if I have
</I>&gt;<i> &gt; to use a more low-level metadata library?
</I>&gt;<i>
</I>&gt;<i> field.GetValue() should work.
</I>
I don't think that GetValue() will work, because the runtime does not
automatically initialize fields with their field init meta-data, they are
only zero'ed out.

&gt;<i> See also how the C# compiler handles array initialization like:
</I>&gt;<i> 	int[] array = {0, 1, 2, 3, 4, 5, 6};
</I>
The Microsoft compiler uses a special InitializeArray() method. This is not
possible for me, because some of the information must also be accessible
outside the CLI, so no types can be instantiated and no methods called.

&gt;<i> &gt; There should be a way to access such data via System.Reflection, as at
</I>&gt;<i> &gt; least constants can easily be generated via the SetConstant() method of
</I>&gt;<i> &gt; the System.Reflection.Emit.FieldBuilder class, but I'm unable to find out
</I>&gt;<i> &gt; how.
</I>&gt;<i>
</I>&gt;<i> There is also SetRVAData().
</I>
Yes, but all I needed was a FieldInfo.GetConstant() method. Anyone hearing me
in Redmont...?

Regards,
Holger

-------------------------------------------------------



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="007571.html">[Mono-list] Mono and ADO.NET
</A></li>
	<LI> Next message: <A HREF="007576.html">[Mono-list] Are constants accessible via reflection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7564">[ date ]</a>
              <a href="thread.html#7564">[ thread ]</a>
              <a href="subject.html#7564">[ subject ]</a>
              <a href="author.html#7564">[ author ]</a>
         </LI>
       </UL>
</body></html>
