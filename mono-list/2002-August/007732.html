<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] AppDomain problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:dietmar%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="007730.html">
   <LINK REL="Next"  HREF="007733.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] AppDomain problems
   </H1>
    <B>Dietmar Maurer
    </B> 
    <A HREF="mailto:dietmar%40ximian.com"
       TITLE="[Mono-list] AppDomain problems">dietmar@ximian.com
       </A><BR>
    <I>14 Aug 2002 19:39:53 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="007730.html">[Mono-list] Building Mono from CVS
</A></li>
        <LI> Next message: <A HREF="007733.html">[Mono-list] AppDomain problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7732">[ date ]</a>
              <a href="thread.html#7732">[ thread ]</a>
              <a href="subject.html#7732">[ subject ]</a>
              <a href="author.html#7732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I cant get the attached program to work on MS windows, even if security
is turned off with: CasPol -s off

Whats wrong? Any ideas?

- Dietmar

------------------------------------------------------------------------
using System;
using System.Security.Policy;
using System.Threading;
using System.Runtime.Serialization;

class Container {

	[Serializable]
	public struct c2 : ISerializable {
		public int a;
		public string s1;

		private c2 (SerializationInfo info, StreamingContext context) {
			a = info.GetInt32(&quot;a&quot;);
			s1 = info.GetString(&quot;s1&quot;);
			Console.WriteLine (&quot;SetObjectData called: &quot; + info.AssemblyName + &quot;,&quot; +
					   info.FullTypeName + &quot; &quot; + s1 + &quot;, &quot; + a);
		}

		public void GetObjectData (SerializationInfo info, StreamingContext context) {
			Console.WriteLine (&quot;GetObjectData called: &quot; + info.AssemblyName + &quot;,&quot; +
					   info.FullTypeName + &quot; &quot; + s1 + &quot;, &quot; + a);
			info.AddValue (&quot;a&quot;, a);
			if (s1 != null)
				info.AddValue (&quot;s1&quot;, s1);
			else
				info.AddValue (&quot;s1&quot;, &quot;(null)&quot;);
		}
	}
	
	[Serializable]
	public class c1 {
		public c1 () {
			e1.a = 3;
			e1.s1 = &quot;SS&quot;;
		}
		public int a = 1;
		public int b = 2;
		public string s1 = &quot;TEST1&quot;;
		[NonSerialized] public string s2 = &quot;TEST2&quot;;
		public c2 [] sa = new c2 [2];
		public c2 e1;
	}
	
	static int Main ()
	{
		AppDomainSetup setup = new AppDomainSetup ();
		setup.ApplicationBase = &quot;.&quot;;

		Console.WriteLine (AppDomain.CurrentDomain.FriendlyName);
			
		AppDomain newDomain = AppDomain.CreateDomain (&quot;NewDomain&quot;, new Evidence (), setup);

		c1 a1 = new c1 ();
		
		newDomain.SetData (&quot;TEST&quot;, a1);
		c1 r1 = (c1)newDomain.GetData (&quot;TEST&quot;);
		if (r1.a != 1 || r1.b !=2)
			return 1;
		
		if (r1.s1 != &quot;TEST1&quot;)
			return 2;
		
		if (r1.s2 != null)
			return 3;

		if (r1.e1.a != 3)
			return 4;

		if (r1.e1.s1 != &quot;SS&quot;)
			return 4;
		
		if (r1.sa [0].s1 != &quot;(null)&quot;)
			return 5;
		
		if (r1.sa [0].a != 0)
			return 6;

		return 0;
	}
}






</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="007730.html">[Mono-list] Building Mono from CVS
</A></li>
	<LI> Next message: <A HREF="007733.html">[Mono-list] AppDomain problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7732">[ date ]</a>
              <a href="thread.html#7732">[ thread ]</a>
              <a href="subject.html#7732">[ subject ]</a>
              <a href="author.html#7732">[ author ]</a>
         </LI>
       </UL>
</body></html>
