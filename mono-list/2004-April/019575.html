<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Exception handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Neale.Ferguson%40SoftwareAG-USA.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="019581.html">
   <LINK REL="Next"  HREF="019576.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Exception handling
   </H1>
    <B>Ferguson, Neale
    </B> 
    <A HREF="mailto:Neale.Ferguson%40SoftwareAG-USA.com"
       TITLE="[Mono-list] Exception handling">Neale.Ferguson@SoftwareAG-USA.com
       </A><BR>
    <I>Wed, 14 Apr 2004 07:42:01 -0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="019581.html">[Mono-list] GTK#/GLADE Deploying and running on the .NET Framework
</A></li>
        <LI> Next message: <A HREF="019576.html">[Mono-list] Problem running autogen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19575">[ date ]</a>
              <a href="thread.html#19575">[ thread ]</a>
              <a href="subject.html#19575">[ subject ]</a>
              <a href="author.html#19575">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C42226.439C3B00
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;

I have the following piece of code:
 
class Tests {
 
        static int Main () {
                return TestDriver.RunTests (typeof (Tests));
        }
 
        static int test_0_byte_cast () {
                int a;
                long l;
                byte b = 0;
                bool failed;
 
                try {
                        double d = 256;
                        failed = true;
                        checked {
                                b = (byte)d;
                        }
                } catch (OverflowException) {
                        failed = false;
                }
                if (failed)
                        return 8;
                if (b != 255)
                        return -8;
 

                return 0;
        }
}

When I run it I get an unhandled exception raised. Tracing shows me that the
call comes from:
 
static gint64
mono_fconv_ovf_i8 (double v)
{
        gint64 res;
 
        MONO_ARCH_SAVE_REGS;
 
        res = (gint64)v;
 
        if (isnan(v) || truncl (v) != res) {
                mono_raise_exception (mono_get_exception_overflow ());
        }
        return res;
}

Which is called by the test code. Now, the method-&gt;save_lmf flag for the
code is not set so that the lmf stuff has not been setup and thus the
exception handling code can't locate the JIT code involved and will
therefore treat this as an unhandled exception. Why wouldn't the save_lmf
flag be set? I don't see my example calling and icall_wrapper type routine.

Neale Ferguson 
R&amp;D Fellow 
Software AG 

 

------_=_NextPart_001_01C42226.439C3B00
Content-Type: text/html;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Diso-8859-1&quot;&gt;


&lt;META content=3D&quot;MSHTML 6.00.2800.1400&quot; name=3DGENERATOR&gt;&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3DArial size=3D2&gt;I =
have the following=20
piece of code:&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3DArial=20
size=3D2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot; =
size=3D2&gt;class Tests=20
{&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; static int Main ()=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
return TestDriver.RunTests (typeof=20
(Tests));&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
}&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; static int =
test_0_byte_cast ()=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
int=20
a;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
long=20
l;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
byte b =3D=20
0;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
bool failed;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nb=
sp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
try=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =

double d =3D=20
256;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs=
p;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs=
p;=20
failed =3D=20
true;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nb=
sp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nb=
sp;=20
checked=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
b =3D=20
(byte)d;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;=20
}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
} catch (OverflowException)=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =

failed =3D=20
false;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;n=
bsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
if=20
(failed)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;=20
return=20
8;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
if (b !=3D=20
255)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs=
p;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbs=
p;=20
return -8;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;&lt;SPAN =
class=3D454242313-14042004&gt;
&lt;DIV&gt;&lt;BR&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nb=
sp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
return 0;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; =
}&lt;BR&gt;}&lt;BR&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3DArial size=3D2&gt;When =
I run it I get=20
an unhandled exception raised. Tracing shows me that the call comes=20
from:&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3DArial=20
size=3D2&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot; =
size=3D2&gt;static=20
gint64&lt;BR&gt;mono_fconv_ovf_i8 (double=20
v)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; gint64=20
res;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
MONO_ARCH_SAVE_REGS;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; res =3D=20
(gint64)v;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=3D&quot;Courier New&quot;&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3D&quot;Courier New&quot;=20
size=3D2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (isnan(v) || =
truncl (v) !=3D=20
res)=20
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;=
nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
mono_raise_exception (mono_get_exception_overflow=20
());&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=20
}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return=20
res;&lt;BR&gt;}&lt;BR&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;SPAN class=3D454242313-14042004&gt;&lt;FONT face=3DArial size=3D2&gt;Which =
is called by=20
the test code. Now, the method-&amp;gt;save_lmf flag for the code is not =
set so that=20
the lmf stuff has not been setup and thus the exception handling code =
can't=20
locate the JIT code involved and will therefore&amp;nbsp;treat this as=20
an&amp;nbsp;unhandled exception. Why wouldn't the save_lmf flag be set? I =
don't see=20
my&amp;nbsp;example calling and icall_wrapper type=20
routine.&lt;/DIV&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/SPAN&gt;
&lt;P&gt;&lt;FONT face=3D&quot;Monotype Corsiva&quot;&gt;Neale Ferguson&lt;/FONT&gt; &lt;BR&gt;&lt;FONT =
face=3DArial=20
size=3D2&gt;R&amp;amp;D Fellow&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face=3DArial size=3D2&gt;Software =
AG&lt;/FONT&gt; &lt;/P&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;

------_=_NextPart_001_01C42226.439C3B00--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="019581.html">[Mono-list] GTK#/GLADE Deploying and running on the .NET Framework
</A></li>
	<LI> Next message: <A HREF="019576.html">[Mono-list] Problem running autogen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19575">[ date ]</a>
              <a href="thread.html#19575">[ thread ]</a>
              <a href="subject.html#19575">[ subject ]</a>
              <a href="author.html#19575">[ author ]</a>
         </LI>
       </UL>
</body></html>
