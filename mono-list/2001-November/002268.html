<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Multiplatform DllImport?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cratliff%40lily.org">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002266.html">
   <LINK REL="Next"  HREF="002279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Multiplatform DllImport?
   </H1>
    <B>Christian Ratliff
    </B> 
    <A HREF="mailto:cratliff%40lily.org"
       TITLE="[Mono-list] Multiplatform DllImport?">cratliff@lily.org
       </A><BR>
    <I>Fri, 23 Nov 2001 17:43:33 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="002266.html">[Mono-list] Multiplatform DllImport?
</A></li>
        <LI> Next message: <A HREF="002279.html">[Mono-list] Multiplatform DllImport?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2268">[ date ]</a>
              <a href="thread.html#2268">[ thread ]</a>
              <a href="subject.html#2268">[ subject ]</a>
              <a href="author.html#2268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> 
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Miguel,

  Hmm. It still sounds like there are two possible mechanisms: 
implement wrappers in mono/mono/wrapper/wrapper.c OR implement direct
DLL imports into two different .cs source files. For the
System.Net.Socket.Sockets class the variance between Win32 and Unix
is great enough that the latter seems like the more appropriate
solution.
  If, however, the former were the more appropriate, how would I gain
DllImport access to the wrappers? Say, if I wrote
&quot;mono_wrapper_setsockopt&quot;, how would I import that into my class?

  [DllImport(&quot;monowrapper&quot;, EntryPOint=&quot;mono_wrapper_setsockopt&quot;)];

  Sorry to be so thick about this!

Thanks again,
christian

+-----+
Christian Ratliff &lt;<A HREF="mailto:cratliff@lily.org">cratliff@lily.org</A>&gt;
lily Development Group
&quot;This is the very perfection of man, 
  to find out his own imperfections&quot; -  St. Augustine


- -----Original Message-----
From: <A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A> [mailto:<A HREF="mailto:mono-list-admin@ximian.com">mono-list-admin@ximian.com</A>]
On Behalf Of Miguel de Icaza
Sent: Friday, November 23, 2001 5:25 PM
To: Christian Ratliff; <A HREF="mailto:sean@ximian.com">sean@ximian.com</A>
Cc: <A HREF="mailto:mono-list@ximian.com">mono-list@ximian.com</A>
Subject: Re: [Mono-list] Multiplatform DllImport?


&gt;<i>   How are we supposed to be dealing with classes which offer
</I>&gt;<i> platform  services (e.g. System.Net.Sockets.Socket)? This class
</I>&gt;<i> will need to  import not only things like socket, bind, listen,
</I>&gt;<i> connect, but also  Win32 (Winsock) functions like WSAStartup and
</I>&gt;<i> WSACleanup. I hate to  ask before looking so...
</I>
At least on the Unix side of things we should be doing that using the
wrapper code in mono/mono/wrapper and maybe also for Windows
compatibility (this makes sure that enumeration constants from the
underlying OS are mapped correctly). 

&gt;<i> I looked for some other example in the code base, and the latest 
</I>&gt;<i> snapshot contains mcs/class/System/System.Net/Dns.cs. That file has
</I>&gt;<i> a  DllImport which explicitly mentions the cygwin DLL as the source
</I>&gt;<i> for  gethostbyaddr and gethostbyname. Is this the right way?
</I>
No, that is actually wrong.  

That file probably should be called Dns-posix.cs and we should not
try to bind directly to the cygwin.dll.  Cygwin is only being used to
'build' Mono, but we should not depend on it for the runtime.

That being said, cygwin is useful to test in Windows how things are
going to be in the Unix world.  That is why I think that we should
rename Dns.cs to Dns-posix.cs and later on rename the references to
be to libc instead of cygwin.

&gt;<i> Meanwhile, there is a file called
</I>&gt;<i> mcs/class/corlib/Windows/Windows.cs which implements
</I>&gt;<i> System.PAL.OpSys. This file contains DllImports for  many common
</I>&gt;<i> math library functions. The Linux version
</I>&gt;<i> (mcs/class/corlib/Linux/Linux.cs) contains only stubs, no real 
</I>&gt;<i> imports. Is this the right way?
</I>
The idea originally was to have an `IOperatingSystem' interface, and
dynamically choose which OS you are running on.  But this seems
overkill, instead what we are going to do is just compile-in
different sources files depending on the target.

So you can still implement the various functions in Unix.cs (it
should be Unix.cs also) and the &quot;target&quot; decides which files are
compiled in.


&gt;<i>   Suffice it to say that I am confused about how this is to be 
</I>&gt;<i> managed.
</I>
Yes, I wish we could clean this up and not leave the old files lying
around.  Also, as soon as we have done some of the core work on the
runtime and the compiler, the team at Ximian will be able to devote
more time to polish those bits of the infrastructure.

Miguel.

_______________________________________________
Mono-list maillist  -  <A HREF="mailto:Mono-list@ximian.com">Mono-list@ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>

-----BEGIN PGP SIGNATURE-----
Version: PGPfreeware 7.0.3 for non-commercial use &lt;<A HREF="http://www.pgp.com">http://www.pgp.com</A>&gt;

iQA/AwUBO/7RE7ZBtyfwMNgGEQK4HQCdGOson3JHTBApisdTSQcmnF6514QAnA1g
Yb2jmWgrjeide6L3XijrrOSE
=mNBR
-----END PGP SIGNATURE-----



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002266.html">[Mono-list] Multiplatform DllImport?
</A></li>
	<LI> Next message: <A HREF="002279.html">[Mono-list] Multiplatform DllImport?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2268">[ date ]</a>
              <a href="thread.html#2268">[ thread ]</a>
              <a href="subject.html#2268">[ subject ]</a>
              <a href="author.html#2268">[ author ]</a>
         </LI>
       </UL>
</body></html>
