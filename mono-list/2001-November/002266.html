<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Multiplatform DllImport?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:miguel%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002256.html">
   <LINK REL="Next"  HREF="002268.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Multiplatform DllImport?
   </H1>
    <B>Miguel de Icaza
    </B> 
    <A HREF="mailto:miguel%40ximian.com"
       TITLE="[Mono-list] Multiplatform DllImport?">miguel@ximian.com
       </A><BR>
    <I>23 Nov 2001 17:24:54 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="002256.html">[Mono-list] Multiplatform DllImport?
</A></li>
        <LI> Next message: <A HREF="002268.html">[Mono-list] Multiplatform DllImport?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2266">[ date ]</a>
              <a href="thread.html#2266">[ thread ]</a>
              <a href="subject.html#2266">[ subject ]</a>
              <a href="author.html#2266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>   How are we supposed to be dealing with classes which offer platform
</I>&gt;<i> services (e.g. System.Net.Sockets.Socket)? This class will need to
</I>&gt;<i> import not only things like socket, bind, listen, connect, but also
</I>&gt;<i> Win32 (Winsock) functions like WSAStartup and WSACleanup. I hate to
</I>&gt;<i> ask before looking so...
</I>
At least on the Unix side of things we should be doing that using the
wrapper code in mono/mono/wrapper and maybe also for Windows
compatibility (this makes sure that enumeration constants from the
underlying OS are mapped correctly). 

&gt;<i> I looked for some other example in the code base, and the latest
</I>&gt;<i> snapshot contains mcs/class/System/System.Net/Dns.cs. That file has a
</I>&gt;<i> DllImport which explicitly mentions the cygwin DLL as the source for
</I>&gt;<i> gethostbyaddr and gethostbyname. Is this the right way?
</I>
No, that is actually wrong.  

That file probably should be called Dns-posix.cs and we should not try
to bind directly to the cygwin.dll.  Cygwin is only being used to
'build' Mono, but we should not depend on it for the runtime.

That being said, cygwin is useful to test in Windows how things are
going to be in the Unix world.  That is why I think that we should
rename Dns.cs to Dns-posix.cs and later on rename the references to be
to libc instead of cygwin.

&gt;<i> Meanwhile, there is a file called mcs/class/corlib/Windows/Windows.cs
</I>&gt;<i> which implements System.PAL.OpSys. This file contains DllImports for
</I>&gt;<i> many common math library functions. The Linux version
</I>&gt;<i> (mcs/class/corlib/Linux/Linux.cs) contains only stubs, no real
</I>&gt;<i> imports. Is this the right way?
</I>
The idea originally was to have an `IOperatingSystem' interface, and
dynamically choose which OS you are running on.  But this seems
overkill, instead what we are going to do is just compile-in different
sources files depending on the target.

So you can still implement the various functions in Unix.cs (it should
be Unix.cs also) and the &quot;target&quot; decides which files are compiled in.


&gt;<i>   Suffice it to say that I am confused about how this is to be
</I>&gt;<i> managed.
</I>
Yes, I wish we could clean this up and not leave the old files lying
around.  Also, as soon as we have done some of the core work on the
runtime and the compiler, the team at Ximian will be able to devote more
time to polish those bits of the infrastructure.

Miguel.


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002256.html">[Mono-list] Multiplatform DllImport?
</A></li>
	<LI> Next message: <A HREF="002268.html">[Mono-list] Multiplatform DllImport?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2266">[ date ]</a>
              <a href="thread.html#2266">[ thread ]</a>
              <a href="subject.html#2266">[ subject ]</a>
              <a href="author.html#2266">[ author ]</a>
         </LI>
       </UL>
</body></html>
