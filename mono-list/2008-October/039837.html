<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Some issues with mono 2.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Some%20issues%20with%20mono%202.0&In-Reply-To=48E11624.5030802%40occams.info">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039832.html">
   <LINK REL="Next"  HREF="039838.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Some issues with mono 2.0</H1>
    <B>Maxim</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Some%20issues%20with%20mono%202.0&In-Reply-To=48E11624.5030802%40occams.info"
       TITLE="[Mono-list] Some issues with mono 2.0">makska at yandex.ru
       </A><BR>
    <I>Thu Oct  9 11:55:16 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="039832.html">[Mono-list] installation proplem on fedora 8
</A></li>
        <LI>Next message: <A HREF="039838.html">[Mono-list] Some issues with mono 2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39837">[ date ]</a>
              <a href="thread.html#39837">[ thread ]</a>
              <a href="subject.html#39837">[ subject ]</a>
              <a href="author.html#39837">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Joshua,

thanks you for explanation.

For about week ago we've installed  mono 2.0 RC4.
So, the situation is the following:
1) something happens. Sometimes:
 [Thu Oct 09 01:39:16 2008] [alert] Requesting termination of
abtronics.ru mod-mono-server for restart...
System.Threading.ThreadAbortException: Thread was being aborted

Server stack trace:
  at Mono.WebServer.BaseApplicationHost.ProcessRequest
(Mono.WebServer.MonoWorkerRequest mwr) [0x00000]
  at Mono.WebServer.ModMonoApplicationHost.ProcessRequest (Int32 reqId,
System.String verb, System.String queryString, System.String path,
System.String protocol, System.String localAddress, Int32 serverPort,
System.String remoteAddress, Int32 remotePort, System.String remoteName,
System.String[] headers, System.String[] headerValues) [0x00000]
  at (wrapper remoting-invoke-with-check)
Mono.WebServer.ModMonoApplicationHost:ProcessRequest
(int,string,string,string,string,string,int,string,int,string,string[],string[])
  at (wrapper xdomain-dispatch)
Mono.WebServer.ModMonoApplicationHost:ProcessRequest
(object,byte[]&amp;,byte[]&amp;,int,string,string,string,string,string,int,string,int,string,string[],string[])

Exception rethrown at [0]:

  at (wrapper xdomain-invoke)
Mono.WebServer.ModMonoApplicationHost:ProcessRequest
(int,string,string,string,string,string,int,string,int,string,string[],string[])
  at (wrapper remoting-invoke-with-check)
Mono.WebServer.ModMonoApplicationHost:ProcessRequest
(int,string,string,string,string,string,int,string,int,string,string[],string[])
  at Mono.WebServer.ModMonoWorker.InnerRun (System.Object state) [0x00000]
  at Mono.WebServer.ModMonoWorker.Run (System.Object state) [0x00000]
System.Threading.ThreadAbortException: Thread was being aborted
....

sometimes something like this:

[Wed Oct 08 00:55:48 2008] [error] (70014)End of file found: read_data
failed
[Wed Oct 08 00:55:48 2008] [error] Command stream corrupted, last
command was 0


2) mod_mono stop to close connections, number of concurrent connections
fast reach limit
note: load of server for this time far from 100%

3) service becomes temporary unavailable, a lot of records like
[Wed Oct 08 13:55:43 2008] [error] Maximum number (70) of concurrent
mod_mono requests to /tmp/mod_mono_dashboard_abtronics.ru_2.lock
reached. Droping request.
in logs.
Note, that it's only &quot;concurrent&quot; requests, not &quot;concurrent and
waiting&quot;. So, it seems like these requests doesn't wait (sleep).
I don't know is this situation A) or B)

For now we've moved some services to other server. In few days will
upgrade mono to 2.0 official release and see what happen.
If problem repeats we will try to use profiler for more deep
investigation of this situation.

All the best,
Max Karavaev

&gt;&gt;<i> &quot;Service Temporary Unavailable&quot; error appears when amount of waiting
</I>&gt;&gt;<i> requests reach limit or when waiting requests reach apache timeout?
</I>&gt;<i>
</I>&gt;<i> Yes, both. That is (to be clear), either:
</I>&gt;<i>
</I>&gt;<i> A) A request comes in and the maximum number of requests are already
</I>&gt;<i> being processed, so this request waits (it sleeps for short intervals)
</I>&gt;<i> until the number of currently-being-processed requests drops below the
</I>&gt;<i> maximum. If that doesn't happen within a certain amount of time
</I>&gt;<i> (hard-coded in mod_mono), the request is dropped with 503. (Service
</I>&gt;<i> Temporarily Unavailable)
</I>&gt;<i>
</I>&gt;<i> B) A request comes in and the maximum number of requests are already
</I>&gt;<i> being processed, but there are also already the maximum number of
</I>&gt;<i> waiting requests waiting, so this request gets dropped *immediately*
</I>&gt;<i> with 503 (Service Temporarily Unavailable).
</I>&gt;<i>
</I>&gt;<i> So I was half-wrong before because I forgot that another way to avoid
</I>&gt;<i> 503s is to increase the timeout in mod_mono (but as I said, it's
</I>&gt;<i> hard-coded) so requests can wait longer. But it's already fairly long
</I>&gt;<i> --- 20 seconds or something.
</I>&gt;<i>
</I>
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039832.html">[Mono-list] installation proplem on fedora 8
</A></li>
	<LI>Next message: <A HREF="039838.html">[Mono-list] Some issues with mono 2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39837">[ date ]</a>
              <a href="thread.html#39837">[ thread ]</a>
              <a href="subject.html#39837">[ subject ]</a>
              <a href="author.html#39837">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
