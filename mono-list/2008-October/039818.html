<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Extending generic methods
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Extending%20generic%20methods&In-Reply-To=gbofcg%24eim%241%40ger.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039822.html">
   <LINK REL="Next"  HREF="039823.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Extending generic methods</H1>
    <B>DraconisBG</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Extending%20generic%20methods&In-Reply-To=gbofcg%24eim%241%40ger.gmane.org"
       TITLE="[Mono-list] Extending generic methods">draconisbg at yahoo.com
       </A><BR>
    <I>Tue Oct  7 17:43:29 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="039822.html">[Mono-list]  Mono Mono and again Mono!
</A></li>
        <LI>Next message: <A HREF="039823.html">[Mono-list]  Windows installer requires admin access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39818">[ date ]</a>
              <a href="thread.html#39818">[ thread ]</a>
              <a href="subject.html#39818">[ subject ]</a>
              <a href="author.html#39818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Robert Jordan wrote:
&gt;<i> 
</I>&gt;<i> Let's say we want to support only a subset:
</I>&gt;<i> 
</I>&gt;<i> 	R Method&lt;T&gt;(P1, ... Pn), where R and Px	are statically typed
</I>&gt;<i> 
</I>&gt;<i> This is just one reflection call (the same call the runtime
</I>&gt;<i> would have to perform if it would be extended to support this
</I>&gt;<i> kind of &quot;variable type generic methods&quot;).
</I>&gt;<i> 
</I>&gt;<i> Now, the only missing link is a wrapper that could be easily written
</I>&gt;<i> using LCG (DynamicMethod) or using a runtime icall. The latter
</I>&gt;<i> would prevent the code from running on MS.NET, though.
</I>&gt;<i> 
</I>&gt;<i> Robert
</I>&gt;<i> 
</I>
I forgot to specify that, but yes, that would be just the subset you've
introduced (that is, the System.Type reference can stand only between the
&lt;&gt;).

Since I'm relatively beginner in Mono/gmcs, I am asking for advice in two
questions:

(1) If possible, I would like to allow a complete expression to be between
&lt;&gt;, an Expression which evaluates to a System.Type. (If it's not possible,
my task also allows a simple &quot;t&quot; local variable to be there, which earlier
evaluated to a System.Type, t=....) The question is, is it possible? I know
which parts I should modify in gmcs (the jay file, and semantic parser where
needed), but an expression inside can be quite complex (containing e.g.
other &lt;&gt; parts as well, or even generic method calls of the same type as
this, i.e. with System.Type references between the &lt;&gt;), if anyone knows for
sure that it won't work, it would be good to know. It should also work with
multiple type arguments, e.g. &lt;t1, int, t2&gt;, but I guess this should
automatically follow from the update jay grammar spec.

(2) What's the easiest way of doing the wrapper Robert mentions? This is
what I can think of: 

1. I code the method which checks whether there is already a DynamicMethod
delegate for that particular System.Type. If there is, it simply calls the
delegate from the cache (Dictionary&lt;System.Type&gt; perhaps?). If not, it
creates the DynamicMethod (and delegate for it, added to the cache) with IL
code which does this: it gets the underlying type from the System.Type
reference we have and calls the target method with that typeparameter
(instead of System.Type).

2. Then I compile the above code somewhere, copy out the disassembled IL
code, and change the gmcs in a way that it automatically inserts the IL code
as a method to the assembly it compiles. It replaces the original method
call of the source code (GenMethod&lt;t1&gt;(...)) with a call to the
compiler-generated method.

This looks like a bit complicated (generating IL code that creates IL code
for a DynamicMethod...), are there perhaps facilities in Mono/gmcs that
allow me to write the code that makes the DynamicMethod in C# instead of
emitting IL instructions to the body of the method that gmcs will add to the
compiled application? At the moment, I can only think of emitting the method
via IL into the target application...
-- 
View this message in context: <A HREF="http://www.nabble.com/Extending-generic-methods-tp19712662p19867975.html">http://www.nabble.com/Extending-generic-methods-tp19712662p19867975.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039822.html">[Mono-list]  Mono Mono and again Mono!
</A></li>
	<LI>Next message: <A HREF="039823.html">[Mono-list]  Windows installer requires admin access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39818">[ date ]</a>
              <a href="thread.html#39818">[ thread ]</a>
              <a href="subject.html#39818">[ subject ]</a>
              <a href="author.html#39818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
