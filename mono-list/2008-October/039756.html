<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] re moting lifetime problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20re%20moting%20lifetime%20problem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039755.html">
   <LINK REL="Next"  HREF="039757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] re moting lifetime problem</H1>
    <B>semichel</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20re%20moting%20lifetime%20problem&In-Reply-To="
       TITLE="[Mono-list] re moting lifetime problem">inschenjoer at gmx.de
       </A><BR>
    <I>Thu Oct  2 11:07:47 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="039755.html">[Mono-list] Mono.zeroconf timeouts or refresh / rescan ?
</A></li>
        <LI>Next message: <A HREF="039757.html">[Mono-list] re moting lifetime problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39756">[ date ]</a>
              <a href="thread.html#39756">[ thread ]</a>
              <a href="subject.html#39756">[ subject ]</a>
              <a href="author.html#39756">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello,

I have a client/server program with the followin architecture.

1. The server program contains a singleton SessionFactory class. The return
value of InitializeLifeTime is null to live forever. There is a login method
that returns a SessionObject to the client.

2. The InitializeLifeTime function of the SessionObject is defined as:

            ILease lease = (ILease)base.InitializeLifetimeService();
            if (lease.CurrentState == LeaseState.Initial)
            {
                lease.InitialLeaseTime = TimeSpan.FromMinutes(5);
                lease.SponsorshipTimeout = TimeSpan.FromMinutes(2);
                lease.RenewOnCallTime = TimeSpan.FromSeconds(2);
            }
            return lease;

3. The client program contains an AppClient class, that requests the
SessionFactory instance from the server and logs in. After this it adds a
ClientSponsor to the SessionObject:

                m_session = m_factory.Login(username, password);

                ClientSponsor client_sponsor = new
ClientSponsor(TimeSpan.FromMinutes(10));
                ILease lease =
(ILease)RemotingServices.GetLifetimeService(m_session);
                lease.Register(client_sponsor);


The behaviour of the SessionObjects on the serverside is different on .Net
on windows and mono on linux. After I close the clients, the SessionObjects
should get disconnected.

WINDOWS:

0, 02.10.2008 12:53:35: SessionFactory was marshaled.
Press the enter key to exit...
1, 02.10.2008 12:53:59: SessionObject was marshaled.
1, 02.10.2008 12:53:59: AppClient was unmarshaled.
1, 02.10.2008 12:53:59: Lease was marshaled.
1, 02.10.2008 12:53:59: ClientSponsor was unmarshaled.
SessionObject.Dispose()
2, 02.10.2008 12:54:04: SessionObject was marshaled.
2, 02.10.2008 12:54:04: AppClient was unmarshaled.
2, 02.10.2008 12:54:04: Lease was marshaled.
2, 02.10.2008 12:54:04: ClientSponsor was unmarshaled.
SessionObject.Dispose()
2, 02.10.2008 12:59:09: Lease was marshaled.
2, 02.10.2008 12:59:11: Lease was marshaled.
1, 02.10.2008 12:59:11: SessionObject was disconnected.
1, 02.10.2008 12:59:11: Lease was disconnected.
0, 02.10.2008 12:59:13: SessionObject was disconnected.
0, 02.10.2008 12:59:13: Lease was disconnected.

LINUX:

debian:/opt/Soma# mono ./Server.exe
0, 02.10.2008 12:47:59: SessionFactory was marshaled.
Press the enter key to exit...
1, 02.10.2008 12:48:01: SessionObject was marshaled.
1, 02.10.2008 12:48:01: AppClient was unmarshaled.
1, 02.10.2008 12:48:01: Lease was marshaled.
1, 02.10.2008 12:48:01: ClientSponsor was unmarshaled.
SessionObject.Dispose()
2, 02.10.2008 12:48:06: SessionObject was marshaled.
2, 02.10.2008 12:48:06: AppClient was unmarshaled.
2, 02.10.2008 12:48:07: Lease was marshaled.
2, 02.10.2008 12:48:07: ClientSponsor was unmarshaled.
SessionObject.Dispose()
2, 02.10.2008 12:53:01: Lease was marshaled.
2, 02.10.2008 12:56:10: Lease was marshaled.


The first number, is the number of connected clients.

As you can see, the SessionObjects in Windows will be disconnected. When
running in Mono, the objects live forever and a lease will be marshalled.

Here is the mono version.

debian:~# mono -V
Mono JIT compiler version 1.9.1 (tarball)
Copyright (C) 2002-2007 Novell, Inc and Contributors. www.mono-project.com
        TLS:           __thread
        GC:            Included Boehm (with typed GC)
        SIGSEGV:       altstack
        Notifications: epoll
        Architecture:  x86
        Disabled:      none


Can somebody help me with his?

bye
Sebastian
-- 
View this message in context: <A HREF="http://www.nabble.com/remoting-lifetime-problem-tp19777368p19777368.html">http://www.nabble.com/remoting-lifetime-problem-tp19777368p19777368.html</A>
Sent from the Mono - General mailing list archive at Nabble.com.

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039755.html">[Mono-list] Mono.zeroconf timeouts or refresh / rescan ?
</A></li>
	<LI>Next message: <A HREF="039757.html">[Mono-list] re moting lifetime problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39756">[ date ]</a>
              <a href="thread.html#39756">[ thread ]</a>
              <a href="subject.html#39756">[ subject ]</a>
              <a href="author.html#39756">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
