<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Applying volatile keyword on IntPtr
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Applying%20volatile%20keyword%20on%20IntPtr&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042757.html">
   <LINK REL="Next"  HREF="042739.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Applying volatile keyword on IntPtr</H1>
    <B>ptr</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Applying%20volatile%20keyword%20on%20IntPtr&In-Reply-To="
       TITLE="[Mono-list] Applying volatile keyword on IntPtr">ptrajkumar at gmail.com
       </A><BR>
    <I>Wed Jun 17 11:31:52 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="042757.html">[Mono-list] server-sided concepts in Mono / ASP.NET vs. Java EE
</A></li>
        <LI>Next message: <A HREF="042739.html">[Mono-list]  Applying volatile keyword on IntPtr
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42738">[ date ]</a>
              <a href="thread.html#42738">[ thread ]</a>
              <a href="subject.html#42738">[ subject ]</a>
              <a href="author.html#42738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hey all

   I am applying a volatile keyword on IntPtr like this

private volatile IntPtr mNativeCancelRequest;

  And compiling against Mono 2.4 I get this error.


error CS0677: `mNativeCancelRequest': A volatile field cannot be of the type
`System.IntPtr'



This seems like a bug according to the standard. As it explicitly allow this
to be done.



 Is this a bug in the gmcs compiler ? Should I file a bug report ?

Thanks

Raj



*10.5.3 Volatile fields***

When a *field-declaration* includes a volatile modifier, the fields
introduced by that declaration are *volatile fields*.

For non-volatile fields, optimization techniques that reorder instructions
can lead to unexpected and unpredictable results in multi-threaded programs
that access fields without synchronization such as that provided by the *
lock-statement* (&#167;8.12). These optimizations can be performed by the
compiler, by the runtime system, or by hardware. For volatile fields, such
reordering optimizations are restricted:

A read of a volatile field is called a *volatile read*. A volatile read has
&#8220;acquire semantics&#8221;; that is, it is guaranteed to occur prior to any
references to memory that occur after it in the instruction sequence.

A write of a volatile field is called a *volatile write*. A volatile write
has &#8220;release semantics&#8221;; that is, it is guaranteed to happen after any
memory references prior to the write instruction in the instruction
sequence.

These restrictions ensure that all threads will observe volatile writes
performed by any other thread in the order in which they were performed. A
conforming implementation is not required to provide a single total ordering
of volatile writes as seen from all threads of execution. The type of a
volatile field must be one of the following:

A *reference-type*.

The type byte, sbyte, short, ushort, int, uint, char, float, bool,
System.IntPtr, or System.UIntPtr.

An *enum-type* having an enum base type of byte, sbyte, short, ushort, int,
or uint.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-list/attachments/20090617/f1b87acc/attachment-0001.html">http://lists.ximian.com/pipermail/mono-list/attachments/20090617/f1b87acc/attachment-0001.html</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042757.html">[Mono-list] server-sided concepts in Mono / ASP.NET vs. Java EE
</A></li>
	<LI>Next message: <A HREF="042739.html">[Mono-list]  Applying volatile keyword on IntPtr
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42738">[ date ]</a>
              <a href="thread.html#42738">[ thread ]</a>
              <a href="subject.html#42738">[ subject ]</a>
              <a href="author.html#42738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
