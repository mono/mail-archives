<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Determine the name and/or kind of CLI runtime
	environment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Determine%20the%20name%20and/or%20kind%20of%20CLI%20runtime%0A%09environment&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027267.html">
   <LINK REL="Next"  HREF="027274.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Determine the name and/or kind of CLI runtime
	environment</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Determine%20the%20name%20and/or%20kind%20of%20CLI%20runtime%0A%09environment&In-Reply-To="
       TITLE="[Mono-list] Determine the name and/or kind of CLI runtime
	environment">kornelpal at hotmail.com
       </A><BR>
    <I>Mon May 30 15:56:23 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="027267.html">[Mono-list] Modifying Assemblies
</A></li>
        <LI>Next message: <A HREF="027274.html">[Mono-list] Re: Determine the name and/or kind of CLI runtime
	environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27271">[ date ]</a>
              <a href="thread.html#27271">[ thread ]</a>
              <a href="subject.html#27271">[ subject ]</a>
              <a href="author.html#27271">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

&gt;<i>From: &quot;Todd Berman&quot;
</I>&gt;<i> The real question is why?
</I>
I have written in my first message in the thread, but it wasn't in the
message you replied, so I copy it:

&gt;<i>They have different interfaces to low level runtime functionality and it is
</I>&gt;<i>good if an error report contains the name of the CLI runtime as well.
</I>
In error reporting it is very important to know the name of the runtime.

&gt;<i> It seems like in general, doing capability based testing gets you futher
</I>&gt;<i> than checking which runtime you are on. Just isolate easy tests that can
</I>&gt;<i> determine if the needed functionality is there, and use those.
</I>
You are absolutely right regarding this topic, the application itself has to
use the functionality depending on it's availability and not the name of the
runtime, but if more than one runtimes are installed you can control all of
them.

For example on Windows you can access mscoree.dll from a managed application
running on Mono and a you can also have Mono and .NET Framework runtime
loaded into the same process.

&gt;<i>From: &quot;Robert Jordan&quot;
</I>&gt;<i> You may try to instantiate a type that only exists
</I>&gt;<i> on Mono (i.e. one from the Mono.* namespaces). However, most
</I>&gt;<i> of those types might run with MSFT runtime as well ...
</I>
Thank you for your answer, this gave me some ideas.

&gt;<i> Another way might be to call some unimplemented
</I>&gt;<i> System.Runtime.InteropServices.Marshal methods.
</I>&gt;<i> That's what I'm doing.
</I>
But I don't recommend your current practicle. The main cause is that these
methods will be implemeneted in the near or distant future.

I think the following code is a good solution:

Assembly mscorlibAssembly = typeof(object).Assembly;
string runtimeName;
if (mscorlibAssembly.GetType(&quot;Microsoft.Win32.Fusion&quot;) != null)
 runtimeName = &quot;Microsoft .NET Framework&quot;;
else if (mscorlibAssembly.GetType(&quot;Mono.Runtime&quot;) != null)
 runtimeName = &quot;Mono&quot;;
else if (mscorlibAssembly.GetType(&quot;Platform.TaskMethods&quot;) != null)
 runtimeName = &quot;DotGNU Portable.NET&quot;;
else
 runtimeName = &quot;Unknown Runtime&quot;;
Console.WriteLine(String.Format(&quot;Runtime: {0} {1}&quot;, runtimeName,
Environment.Version.ToString()));

All of these types are from mscorlib.dll and it is the only assembly that is
guaranted to exist and be specific on each platforms.
All of them are internal classes so it is very unlikely to be copied ever.
&quot;Microsoft.Win32.Fusion&quot; is OK, it exists in 1.0, 1.1 and 2.0 as well and
Fusion is the code name of the GAC manager, so it's Microsoft specific.
&quot;Platform.TaskMethods&quot; is OK, it exists since the early releases and is
specific to Portable.NET.

My only problem is &quot;Mono.Runtime&quot; is seems not to been always there.
Could anyone suggest a better class name in mscorlib.dll?

If we can found an internal, Mono specific class in mscorlib.dll that is
included almost every release we should document that the class shouldn't be
removed to provide a way to detect Mono.

Korn&#233;l

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027267.html">[Mono-list] Modifying Assemblies
</A></li>
	<LI>Next message: <A HREF="027274.html">[Mono-list] Re: Determine the name and/or kind of CLI runtime
	environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27271">[ date ]</a>
              <a href="thread.html#27271">[ thread ]</a>
              <a href="subject.html#27271">[ subject ]</a>
              <a href="author.html#27271">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
