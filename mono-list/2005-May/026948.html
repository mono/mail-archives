<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] XmlIncludeAttribute missing class
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:lluis%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="026941.html">
   <LINK REL="Next"  HREF="026930.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] XmlIncludeAttribute missing class
   </H1>
    <B>Lluis Sanchez
    </B> 
    <A HREF="mailto:lluis%40ximian.com"
       TITLE="[Mono-list] XmlIncludeAttribute missing class">lluis@ximian.com
       </A><BR>
    <I>Wed, 11 May 2005 18:43:57 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="026941.html">[Mono-list] XmlIncludeAttribute missing class
</A></li>
        <LI> Next message: <A HREF="026930.html">[Mono-list] Problem buiding MonoDevelop 0.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26948">[ date ]</a>
              <a href="thread.html#26948">[ thread ]</a>
              <a href="subject.html#26948">[ subject ]</a>
              <a href="author.html#26948">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

When building the xml map, the XmlSerializer detects that the Folder
class is a collection (because it implements IEnumerable and has an Add
method). Collections are not serialized like regular data classes. For
example, public members of collections are ignored, only the collection
items are serialized. For the same reason, the XmlSerializer ignores the
inheritance hierarchy of the collection. This means that it will ignore
the Artifact class and the XmlInclude attributes it has.

This behavior is &quot;by design&quot; and you will get the same error running on
MS.NET. The solution is to add the XmlInclude in the Configuration
class, as Chris pointed out.

Lluis.

On dc, 2005-05-11 at 12:49 +0100, Ricardo Gladwell wrote:
&gt;<i> I'm getting the following exception when I attempt to deserialize some 
</I>&gt;<i> objects in my application using System.Xml.Serialization:
</I>&gt;<i> 
</I>&gt;<i> System.InvalidOperationException: The type WebPuppy.Model.Site was not 
</I>&gt;<i> expected. Use the XmlInclude or SoapInclude attribute to specify types 
</I>&gt;<i> that are not known statically.
</I>&gt;<i> 
</I>&gt;<i> I've been careful to include all the relevant objects using the 
</I>&gt;<i> XmlIncludeAttribute so I can't figure out why the XML serializer is not 
</I>&gt;<i> properly finding the Site object. See code fragment below:
</I>&gt;<i> 
</I>&gt;<i> using System.Collections;
</I>&gt;<i> using System.IO;
</I>&gt;<i> using System.Xml.Serialization;
</I>&gt;<i> 
</I>&gt;<i> public class Test {
</I>&gt;<i>      public static void Main () {
</I>&gt;<i>          Configuration configuration = new Configuration();
</I>&gt;<i>          Site site = new Site();
</I>&gt;<i>          site.Id = &quot;id&quot;;
</I>&gt;<i>          configuration.Sites.Add( site );
</I>&gt;<i>          XmlSerializer serializer = new XmlSerializer (typeof 
</I>&gt;<i> (Configuration));
</I>&gt;<i>          using (FileStream fs = new FileStream (&quot;test.xml&quot;, 
</I>&gt;<i> FileMode.Create)) {
</I>&gt;<i>              serializer.Serialize (fs, configuration);
</I>&gt;<i>          }
</I>&gt;<i>      }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> public class Configuration {
</I>&gt;<i> 
</I>&gt;<i> 	Folder sites = new Folder();
</I>&gt;<i> 
</I>&gt;<i> 	public Folder Sites
</I>&gt;<i> 	{
</I>&gt;<i> 		get {
</I>&gt;<i> 			return sites;
</I>&gt;<i> 		}
</I>&gt;<i> 		set {
</I>&gt;<i> 			this.sites = value;
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> 
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> [XmlInclude (typeof (Folder))]
</I>&gt;<i> [XmlInclude (typeof (Site))]
</I>&gt;<i> public abstract class Artifact {
</I>&gt;<i> 	public string Id;
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> public class Folder : Artifact, IEnumerable
</I>&gt;<i> {
</I>&gt;<i> 	private Hashtable artifacts = new Hashtable ();
</I>&gt;<i> 
</I>&gt;<i> 	public IEnumerator GetEnumerator ()
</I>&gt;<i> 	{
</I>&gt;<i> 		return artifacts.Values.GetEnumerator ();
</I>&gt;<i> 	}
</I>&gt;<i> 
</I>&gt;<i> 	public void Add(object o) {
</I>&gt;<i>          Artifact artifact = (Artifact) o;
</I>&gt;<i> 		artifacts[artifact.Id] = (Artifact) artifact;
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> public class Site : Folder
</I>&gt;<i> {
</I>&gt;<i> }
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="mailto:Mono-list@lists.ximian.com">Mono-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="026941.html">[Mono-list] XmlIncludeAttribute missing class
</A></li>
	<LI> Next message: <A HREF="026930.html">[Mono-list] Problem buiding MonoDevelop 0.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26948">[ date ]</a>
              <a href="thread.html#26948">[ thread ]</a>
              <a href="subject.html#26948">[ subject ]</a>
              <a href="author.html#26948">[ author ]</a>
         </LI>
       </UL>
</body></html>
