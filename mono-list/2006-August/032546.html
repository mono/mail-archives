<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Announce%3A%20Mono.Fuse%20%28%2B%20Required%20Mono.Posix%20Changes%29&In-Reply-To=1156854422.3776.7.camel%40melchior.magi">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032540.html">
   <LINK REL="Next"  HREF="032557.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Announce: Mono.Fuse (+ Required Mono.Posix Changes)</H1>
    <B>Valient Gough</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Announce%3A%20Mono.Fuse%20%28%2B%20Required%20Mono.Posix%20Changes%29&In-Reply-To=1156854422.3776.7.camel%40melchior.magi"
       TITLE="[Mono-list] Announce: Mono.Fuse (+ Required Mono.Posix Changes)">valient at gmail.com
       </A><BR>
    <I>Wed Aug 30 02:12:08 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="032540.html">[Mono-list] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
</A></li>
        <LI>Next message: <A HREF="032557.html">[Mono-list] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32546">[ date ]</a>
              <a href="thread.html#32546">[ thread ]</a>
              <a href="subject.html#32546">[ subject ]</a>
              <a href="author.html#32546">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've responded separately to Jon because I find his comments inflammatory.

The SULF project you reference predates the FUSE low-level API and
even the latest couple kernel interface revisions.  You could have
found out about much newer code, and perhaps learned something about
FUSE itself through a number of routes:

1. ask about the state of SULF.  I would not have recommended starting
with this defunct project,  nor recommended referencing it as an
alternative.
2. search FUSE mailing list for C# related announcements (and language
binding discussions in general)
3. search this Mono list for FUSE related announcements

regards,
Valient

On 8/29/06, Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">jonpryor at vt.edu</A>&gt; wrote:
&gt;<i> Mono.Fuse is a binding for the FUSE library, permitting user-space
</I>&gt;<i> file systems to be written in C#.
</I>&gt;<i>
</I>&gt;<i> Why?
</I>&gt;<i> ===
</I>&gt;<i>
</I>&gt;<i> I read Robert Love's announcement of beaglefs, a FUSE program that
</I>&gt;<i> exposes Beagle searches as a filesystem.  My first thought: Why
</I>&gt;<i> wasn't that done in C# (considering that the rest of Beagle is C#)?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What about SULF?
</I>&gt;<i> ===============
</I>&gt;<i>
</I>&gt;<i> Stackable User-Level Filesystem, or SULF
</I>&gt;<i> (<A HREF="http://arg0.net/users/vgough/sulf/">http://arg0.net/users/vgough/sulf/</A>), is a pre-existing FUSE binding
</I>&gt;<i> in C#, started by Valient Gough in 2004.
</I>&gt;<i>
</I>&gt;<i> Mono.Fuse has no relation to SULF, for two reasons:
</I>&gt;<i>
</I>&gt;<i>   1.  It goes to great efforts to avoid a Mono.Posix.dll dependency,
</I>&gt;<i>       duplicating Mono.Unix.Native.Stat (Fuse.Stat),
</I>&gt;<i>       Mono.Unix.Native.Statvfs (Fuse.StatFS), and many methods from
</I>&gt;<i>       Mono.Unix.Native.Syscall (Fuse.Wrapper).
</I>&gt;<i>
</I>&gt;<i>   2.  I don't like the SULF API.  (Not that I spent a great deal of
</I>&gt;<i>       time looking at it, but what I did see I didn't like.)
</I>&gt;<i>
</I>&gt;<i>   3.  SULF wraps the FUSE kernel-level interface, while Mono.Fuse
</I>&gt;<i>       wraps the higher level libfuse C interface
</I>&gt;<i>
</I>&gt;<i> I find (1) the most appalling, if only because I'm the Mono.Posix
</I>&gt;<i> maintainer and I'd like to see my work actually used. :-)
</I>&gt;<i>
</I>&gt;<i> Once I started writing Mono.Fuse, I discovered a good reason to avoid
</I>&gt;<i> Mono.Posix: it's currently impossible to use from outside of Mono.
</I>&gt;<i> I figured this would be a good opportunity to rectify that, making it
</I>&gt;<i> easier for additional libraries to build upon the Mono.Posix
</I>&gt;<i> infrastructure.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Implementation:
</I>&gt;<i> ==============
</I>&gt;<i>
</I>&gt;<i> Mono.Fuse requires patches to the mcs &amp; mono modules, changes which
</I>&gt;<i> need to be proposed (hence this email) and discussed.
</I>&gt;<i>
</I>&gt;<i> mono:
</I>&gt;<i> ----
</I>&gt;<i>
</I>&gt;<i> The biggest problem with the mono module is that no headers are
</I>&gt;<i> installed, making it difficult to make use of libMonoPosixHelper.so.
</I>&gt;<i>
</I>&gt;<i> Changes:
</I>&gt;<i>   - Modify `configure' to generate a mono-config.h file, installed as
</I>&gt;<i>     $libdir/mono/include/mono-config.h.  (Basic idea &quot;borrowed&quot; from
</I>&gt;<i>     GLib's $libdir/glib-2.0/include/glibconfig.h).
</I>&gt;<i>   - Add a mono-posix-helper.pc file
</I>&gt;<i>   - Install the files $includedir/mono/posix/helper.h and
</I>&gt;<i>     $includedir/mono/posix/map.h.
</I>&gt;<i>
</I>&gt;<i> map.h is the current map.h file generated by make-map.exe, with some
</I>&gt;<i> major additions (detailed in the mcs section).
</I>&gt;<i>
</I>&gt;<i> helper.h is the main include file, which includes map.h and declares
</I>&gt;<i> all types/functions which cannot be generated by make-map.exe.
</I>&gt;<i>
</I>&gt;<i> mono-config.h is necessary because it needs to contain
</I>&gt;<i> platform-specific macros.  In particular, Linux needs:
</I>&gt;<i>
</I>&gt;<i>   int
</I>&gt;<i>   Mono_Posix_ToStat (struct statvfs *to, struct Mono_Posix_Helper *to);
</I>&gt;<i>
</I>&gt;<i> while OS X and *BSD need:
</I>&gt;<i>
</I>&gt;<i>   int
</I>&gt;<i>   Mono_Posix_ToStat (struct statfs *to, struct Mono_Posix_Helper *to);
</I>&gt;<i>
</I>&gt;<i> Note `struct statvfs' vs. `struct statfs'.  The mono/posix/helper.h
</I>&gt;<i> header needs to &quot;paper over&quot; the difference, and thus needs to know
</I>&gt;<i> which type the platform prefers.  helper.h thus looks like:
</I>&gt;<i>
</I>&gt;<i>   #ifdef MONO_HAVE_STATVFS
</I>&gt;<i>     struct statvfs;
</I>&gt;<i>     int Mono_Posix_ToStatvfs (struct statvfs *from,
</I>&gt;<i>         struct Mono_Posix_Statvfs *to);
</I>&gt;<i>   #endif
</I>&gt;<i>   #ifdef MONO_HAVE_STATFS
</I>&gt;<i>     struct statfs;
</I>&gt;<i>     int Mono_Posix_ToStatvfs (struct statfs *from,
</I>&gt;<i>         struct Mono_Posix_Statvfs *to);
</I>&gt;<i>   #endif
</I>&gt;<i>
</I>&gt;<i> One of MONO_HAVE_STATVFS or MONO_HAVE_STATFS would be defined in
</I>&gt;<i> mono-config.h.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> mcs:
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> There are two major changes:
</I>&gt;<i>
</I>&gt;<i>   * The addition of one public attributes to the API:
</I>&gt;<i>
</I>&gt;<i>     // targets Class, Delegate, Enum, Field, Struct
</I>&gt;<i>     class Mono.Unix.Native.MapAttribute {
</I>&gt;<i>       public MapAttribute ();
</I>&gt;<i>       public MapAttribute (string nativeType);
</I>&gt;<i>       public string NativeType {get;}
</I>&gt;<i>       public string NativeSymbolPrefix {get; set;}
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>   * A major revamp to make-map.exe
</I>&gt;<i>
</I>&gt;<i> The Map and MapHeader attributes are public so that make-map.exe can
</I>&gt;<i> use a publically exposed API for code generation purposes which can be
</I>&gt;<i> used by other libraries (Mono.Fuse makes use of these changes).
</I>&gt;<i>
</I>&gt;<i> Make-map.exe can also generate structure declarations and delegate
</I>&gt;<i> declarations in addition to P/Invoke function declarations,
</I>&gt;<i> allowing for a better, automated interface between C and C#.
</I>&gt;<i>
</I>&gt;<i> Previously, [Map] could only be used on enumerations.
</I>&gt;<i>
</I>&gt;<i> Now, [Map] can be used on classes, structures, &amp; delegates, to create
</I>&gt;<i> a C declaration of the C# type, suitable for P/Invoke purposes, e.g.
</I>&gt;<i>
</I>&gt;<i>   [Map] struct Stat {public FilePermissions mode;}
</I>&gt;<i>
</I>&gt;<i> would generate the C declaration
</I>&gt;<i>
</I>&gt;<i>   struct Namespace_Stat {unsigned int mode;};
</I>&gt;<i>
</I>&gt;<i> The MapAttribute.NativeType property is used to specify that type
</I>&gt;<i> conversion functions should be generated, thus:
</I>&gt;<i>
</I>&gt;<i>   [Map (&quot;struct stat&quot;)] struct Stat {public FilePermissions mode;}
</I>&gt;<i>
</I>&gt;<i> would generate
</I>&gt;<i>
</I>&gt;<i>   struct Namespace_Stat {unsigned int mode;};
</I>&gt;<i>   int Namespace_ToStat (struct stat *from, struct Namespace_Stat *to);
</I>&gt;<i>   int Namespace_FromStat (struct Namespace_Stat *from, struct stat *to);
</I>&gt;<i>
</I>&gt;<i> along with the actual implementations of Namespace_ToStat() and
</I>&gt;<i> Namespace_FromStat().
</I>&gt;<i>
</I>&gt;<i> The MapAttribute.NativeSymbolPrefix is used to specify the C
</I>&gt;<i> &quot;namespace&quot; to use:
</I>&gt;<i>
</I>&gt;<i>   [Map (NativeSymbolPrefix=&quot;Foo&quot;)] struct Stat {FilePermissiond mode;}
</I>&gt;<i>
</I>&gt;<i> generates
</I>&gt;<i>
</I>&gt;<i>   struct Foo_Stat {unsigned int mode;};
</I>&gt;<i>
</I>&gt;<i> This prefix is also used for the conversion functions.
</I>&gt;<i>
</I>&gt;<i> (You may be wondering why NativeSymbolPrefix exists at all.  This is
</I>&gt;<i> for reasonable symbol versioning -- make-map.exe currently has a
</I>&gt;<i> &quot;hack&quot; in place to rename Mono.Unix(.Native) to Mono_Posix, a hack
</I>&gt;<i> I'd like to remove, and NativeSymbolPrefix allows the Mono.Unix.Native
</I>&gt;<i> types to have a &quot;Mono_Posix&quot; C namespace in a reasonably general
</I>&gt;<i> manner.)
</I>&gt;<i>
</I>&gt;<i> The previously internal Mono.Unix.HeaderAttribute has been removed.
</I>&gt;<i> The HeaderAttribute.Includes and HeaderAttribute.Defines properties
</I>&gt;<i> have been replaced with make-map.exe command-line arguments.  In
</I>&gt;<i> particular, HeaderAttribute.Includes has been replaced with
</I>&gt;<i> --autoconf-header, --impl-header, --impl-macro, --public-header, and
</I>&gt;<i> --public-macro (the first three modify the generated .c file, while
</I>&gt;<i> the latter two modify the generated .h file).
</I>&gt;<i>
</I>&gt;<i> Finally, make-map.exe has been renamed and moved from
</I>&gt;<i> mcs/class/Mono.Posix/Mono.Unix.Native/make-map.exe to
</I>&gt;<i> mcs/tools/create-native-map/create-native-map.exe.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HOWTO:
</I>&gt;<i> =====
</I>&gt;<i>
</I>&gt;<i> Go to <A HREF="http://www.jprl.com/mono-fuse">http://www.jprl.com/mono-fuse</A> for the patches and source download.
</I>&gt;<i>
</I>&gt;<i> Apply ``mcs.patch'' to a ``mcs'' checkout, rebuild, and install.
</I>&gt;<i> Apply ``mono.patch'' to a ``mono'' checkout, rebuild, and install.
</I>&gt;<i> Build ``mono-fuse-0.1.0.tar.gz'' in &quot;the standard manner&quot; (ye olde
</I>&gt;<i> &quot;./configure; make; make install&quot; business).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Questions:
</I>&gt;<i> =========
</I>&gt;<i>
</I>&gt;<i>   - Is it OK for create-native-map.exe to be a .NET 2.0 app?
</I>&gt;<i>
</I>&gt;<i>   - How should we cope with unstable APIs which make use of native
</I>&gt;<i>     code?  The Application Deployment Guidelines [1] don't address
</I>&gt;<i>     this issue, nor the related issue of what should be done with
</I>&gt;<i>     64-bit binaries.  In particular, for an AMD64 machine, which
</I>&gt;<i>     directory layout should be used for an assembly + native lib
</I>&gt;<i>     combo?
</I>&gt;<i>     1. What Mono seems to do, with the GAC in $prefix/lib no matter
</I>&gt;<i>        what the architecture:
</I>&gt;<i>
</I>&gt;<i>         /usr/lib/mono-fuse/Mono.Fuse.dll
</I>&gt;<i>         /usr/lib64/libMonoFuseHelper.so
</I>&gt;<i>     2. Be consistent, and toss everything in @libdir@:
</I>&gt;<i>
</I>&gt;<i>         /usr/lib64/mono-fuse/Mono.Fuse.dll
</I>&gt;<i>         /usr/lib64/libMonoFuseHelper.so
</I>&gt;<i>
</I>&gt;<i> [1]
</I>&gt;<i> <A HREF="http://www.mono-project.com/Guidelines:Application_Deployment#Libraries_with_Unstable_APIs">http://www.mono-project.com/Guidelines:Application_Deployment#Libraries_with_Unstable_APIs</A>
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>  - Jon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i>
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032540.html">[Mono-list] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
</A></li>
	<LI>Next message: <A HREF="032557.html">[Mono-list] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32546">[ date ]</a>
              <a href="thread.html#32546">[ thread ]</a>
              <a href="subject.html#32546">[ subject ]</a>
              <a href="author.html#32546">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
