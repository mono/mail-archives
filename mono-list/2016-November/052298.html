<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] mono process - high number of threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20mono%20process%20-%20high%20number%20of%20threads&In-Reply-To=%3C45E8A49DE8DF9B4E9A8038276F135D3AAE581A6A%40RWC-EXCH02.trionworld.priv%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="052297.html">
   <LINK REL="Next"  HREF="052299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] mono process - high number of threads</H1>
    <B>Chris Swiedler</B> 
    <A HREF="mailto:mono-list%40lists.dot.net?Subject=Re%3A%20%5BMono-list%5D%20mono%20process%20-%20high%20number%20of%20threads&In-Reply-To=%3C45E8A49DE8DF9B4E9A8038276F135D3AAE581A6A%40RWC-EXCH02.trionworld.priv%3E"
       TITLE="[Mono-list] mono process - high number of threads">cswiedler at trionworlds.com
       </A><BR>
    <I>Wed Nov 23 17:10:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="052297.html">[Mono-list] mono process - high number of threads
</A></li>
        <LI>Next message (by thread): <A HREF="052299.html">[Mono-list] LLVM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52298">[ date ]</a>
              <a href="thread.html#52298">[ thread ]</a>
              <a href="subject.html#52298">[ subject ]</a>
              <a href="author.html#52298">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Those are the .Net/mono threadpool. It may be that you're leaking threadpool threads somehow, or it may be that there's enough contention that eventually you need that many threads.

Does the number of threads grow infinitely?

Try setting MONO_THREADS_PER_CPU=1 in the environment of your process.

Try running pstack on the process and see what the threads are doing.

chris

-----Original Message-----
From: Mono-list [mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list-bounces at lists.dot.net</A>] On Behalf Of Rubén de Alba
Sent: Wednesday, November 23, 2016 7:05 AM
To: <A HREF="http://lists.dot.net/mailman/listinfo/mono-list">mono-list at lists.dot.net</A>; <A HREF="http://lists.dot.net/mailman/listinfo/mono-list">psantosl at codicesoftware.com</A>
Subject: [Mono-list] mono process - high number of threads

I'm testing a server process running with mono under heavy load.

The server app handles the max number of threads that are available to handle client requests (32) and I can assure you that no new threads are created from our C# code.

However, I see that the number of threads used by the mono process doesn't stop growing (from 15 to 241 after 2 hours of execution time)

I use 'ps -o nlwp &lt;pid&gt;' to monitor the process threads.

Could you explain me why this is happening?

Is there any way to see if mono is launching new threads itself and why?

Rubén.
_______________________________________________
Mono-list maillist  -  <A HREF="http://lists.dot.net/mailman/listinfo/mono-list">Mono-list at lists.dot.net</A> <A HREF="http://lists.dot.net/mailman/listinfo/mono-list">http://lists.dot.net/mailman/listinfo/mono-list</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="052297.html">[Mono-list] mono process - high number of threads
</A></li>
	<LI>Next message (by thread): <A HREF="052299.html">[Mono-list] LLVM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52298">[ date ]</a>
              <a href="thread.html#52298">[ thread ]</a>
              <a href="subject.html#52298">[ subject ]</a>
              <a href="author.html#52298">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
