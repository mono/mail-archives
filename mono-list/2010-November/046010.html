<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-list] Connecting to a database (VB)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Connecting%20to%20a%20database%20%28VB%29&In-Reply-To=%21%26%21AAAAAAAAAAAYAAAAAAAAAOb5xiPoTM8RjQUAgEiElinCgAAAEAAAAGeqQ714TKdBl3/AohLHQJ8BAAAAAA%3D%3D%40manfbraun.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="046005.html">
   <LINK REL="Next"  HREF="046004.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-list] Connecting to a database (VB)</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-list%40lists.ximian.com?Subject=%5BMono-list%5D%20Connecting%20to%20a%20database%20%28VB%29&In-Reply-To=%21%26%21AAAAAAAAAAAYAAAAAAAAAOb5xiPoTM8RjQUAgEiElinCgAAAEAAAAGeqQ714TKdBl3/AohLHQJ8BAAAAAA%3D%3D%40manfbraun.de"
       TITLE="[Mono-list] Connecting to a database (VB)">monodanmorg at yahoo.com
       </A><BR>
    <I>Tue Nov  2 16:43:03 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="046005.html">[Mono-list] Connecting to a database (VB)
</A></li>
        <LI>Next message: <A HREF="046004.html">[Mono-list]  ppc monodoc 2.8 segfault
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46010">[ date ]</a>
              <a href="thread.html#46010">[ thread ]</a>
              <a href="subject.html#46010">[ subject ]</a>
              <a href="author.html#46010">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>My explaination is how to use Mono's SqlClient with Integrated Security currently.  If you can inspect the packets on your machine, you might be able to discover how to get it to work locally.

I have verified a long time ago that Mono's SqlClient can connect to SQL Server using Integrated Security.  You have to specify the windows domain userid and password because there is no way that I know of to get this info from the Windows operationg system. 

To understand this more, read about Domain Logins in FreeTDS.
<A HREF="http://www.freetds.org/userguide/domains.htm">http://www.freetds.org/userguide/domains.htm</A>

To support NTLM locally, you would need to modify Mono.Data.Tds Tds.cs

If client receives type 2 message from the server with the Negotiate Local Call (0x00004000) flag, then you will need to do things differently to support local authentication. 

<A HREF="http://davenport.sourceforge.net/ntlm.html#localAuthentication">http://davenport.sourceforge.net/ntlm.html#localAuthentication</A>





--- On Mon, 11/1/10, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mabra at manfbraun.de</A> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mabra at manfbraun.de</A>&gt; wrote:

&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mabra at manfbraun.de</A> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mabra at manfbraun.de</A>&gt;
</I>&gt;<i> Subject: RE: [Mono-list] Connecting to a database (VB)
</I>&gt;<i> To: &quot;'Daniel Morgan'&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">monodanmorg at yahoo.com</A>&gt;, &quot;'mono-list'&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>&gt;, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">paul at all-the-johnsons.co.uk</A>
</I>&gt;<i> Date: Monday, November 1, 2010, 1:17 PM
</I>&gt;<i> Hello !
</I>&gt;<i> 
</I>&gt;<i> Sorry, I'll really NOT bother you, but I don't trust your
</I>&gt;<i> statement.
</I>&gt;<i> 
</I>&gt;<i> I am administering Windows since the beginning and using
</I>&gt;<i> and developing lots
</I>&gt;<i> of admin tools in C#. What NTLM gives you finally, is an
</I>&gt;<i> access token,
</I>&gt;<i> containing different SIDs [your user, groups, rights etc.].
</I>&gt;<i> If it does not
</I>&gt;<i> contain a &quot;real&quot; domain, it is usually - on windows [even
</I>&gt;<i> with SqlClient] so
</I>&gt;<i> far - able to authenticate to a windows's machine local
</I>&gt;<i> domain. If your
</I>&gt;<i> computer is named &quot;X&quot;, you should be able to connect to
</I>&gt;<i> &quot;X\myUser&quot; on this
</I>&gt;<i> local domain with &quot;Integrated Security&quot;.
</I>&gt;<i> 
</I>&gt;<i> If this is not working, I would feel bad about mono.
</I>&gt;<i> Or is there something, I think fundamentally wrong??
</I>&gt;<i> I do not have the time shortly, but I'll definitively
</I>&gt;<i> setup
</I>&gt;<i> a XP-VM with mono to try this out later!
</I>&gt;<i> 
</I>&gt;<i> Naturally, as I wrote, specifying &quot;Integrated Security&quot; AND
</I>&gt;<i> specifying
</I>&gt;<i> username and password WILL NEVER work [wether local domain
</I>&gt;<i> nor real domain].
</I>&gt;<i> 
</I>&gt;<i> br++mabra
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list-bounces at lists.ximian.com</A>]
</I>&gt;<i> On Behalf Of Daniel Morgan
</I>&gt;<i> Sent: Monday, November 01, 2010 3:35 PM
</I>&gt;<i> To: mono-list; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">paul at all-the-johnsons.co.uk</A>
</I>&gt;<i> Subject: Re: [Mono-list] Connecting to a database (VB)
</I>&gt;<i> 
</I>&gt;<i> Mono's SqlClient supports Integrated Security (NTLM), but
</I>&gt;<i> you must be on a
</I>&gt;<i> true windows domain.&#160; A workgroup does not count. You
</I>&gt;<i> also have to give your
</I>&gt;<i> windows domain user id and password.&#160; On Mono's
</I>&gt;<i> SqlClient, you have to give
</I>&gt;<i> your windows domain credentials because Mono is not
</I>&gt;<i> integrated with your
</I>&gt;<i> Windows workstation, nor SQL Server, nor the Windows server
</I>&gt;<i> where the SQL
</I>&gt;<i> Server instance is running.&#160; 
</I>&gt;<i> 
</I>&gt;<i> --- On Sun, 10/31/10, Paul F. Johnson &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">paul at all-the-johnsons.co.uk</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; From: Paul F. Johnson &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">paul at all-the-johnsons.co.uk</A>&gt;
</I>&gt;<i> &gt; Subject: [Mono-list] Connecting to a database (VB)
</I>&gt;<i> &gt; To: &quot;mono-list&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">mono-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; Date: Sunday, October 31, 2010, 11:16 AM
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have set up a really simple MS SQL database and am
</I>&gt;<i> trying
</I>&gt;<i> &gt; to connect
</I>&gt;<i> &gt; to it using VB.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Currently, my code looks like this
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Dim connstr as String = &quot;Data
</I>&gt;<i> &gt; Source=localhost\SQLEXPRESS;&quot;+&quot;Initial
</I>&gt;<i> &gt; Catalog=&quot;Database1\Table1;&quot;+&quot;Integrated
</I>&gt;<i> Security=SSPI;&quot;
</I>&gt;<i> &gt; Dim sql as String = Nothing
</I>&gt;<i> &gt; Dim tables as New ArrayList
</I>&gt;<i> &gt; Dim sqldata as new DataSet
</I>&gt;<i> &gt; Try
</I>&gt;<i> &gt; Dim connect as new SqlConnection(connstr)
</I>&gt;<i> &gt; connect.Open()
</I>&gt;<i> &gt; Dim sqlcomm as new SqlCommand(sql, connect)
</I>&gt;<i> &gt; sqlcomm.CommandText = &quot;Select Name where (Age &gt; 25
</I>&gt;<i> and
</I>&gt;<i> &gt; Hometown =
</I>&gt;<i> &gt; Liverpool);&quot;
</I>&gt;<i> &gt; Dim sqlad = new SqlDataAdapter
</I>&gt;<i> &gt; sqlad.SelectCommand = sqlcomm
</I>&gt;<i> &gt; For i = 0 to 3
</I>&gt;<i> &gt; &#160; sqlad.TableMappings.Add(&quot;Table&quot;,
</I>&gt;<i> &gt; tables(i).ToString())
</I>&gt;<i> &gt; Next
</I>&gt;<i> &gt; sqlad.Fill(sqldata)
</I>&gt;<i> &gt; connect.Close()
</I>&gt;<i> &gt; Catch ex as SqlException
</I>&gt;<i> &gt; WriteLine(&quot;Error &quot; + ex.Message.ToString())
</I>&gt;<i> &gt; End Try
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Nothing amazing. The problem is the connection string
</I>&gt;<i> -
</I>&gt;<i> &gt; I've googled
</I>&gt;<i> &gt; around and nothing seems to fit. The exception thrown
</I>&gt;<i> is
</I>&gt;<i> &gt; that it can't
</I>&gt;<i> &gt; log in for user pb5\paul. If I add User Id=paul or
</I>&gt;<i> User
</I>&gt;<i> &gt; Id=pb5\paul, it
</I>&gt;<i> &gt; still won't connect.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What is wrong?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; TTFN
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Paul
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -- 
</I>&gt;<i> &gt; Vertraue mir, ich weiss, was ich mache...
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist&#160; -&#160; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &#160; &#160; &#160; 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-list maillist&#160; -&#160; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>

      
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="046005.html">[Mono-list] Connecting to a database (VB)
</A></li>
	<LI>Next message: <A HREF="046004.html">[Mono-list]  ppc monodoc 2.8 segfault
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#46010">[ date ]</a>
              <a href="thread.html#46010">[ thread ]</a>
              <a href="subject.html#46010">[ subject ]</a>
              <a href="author.html#46010">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-list">More information about the Mono-list
mailing list</a><br>
</body></html>
