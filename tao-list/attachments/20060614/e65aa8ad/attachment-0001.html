<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=UTF-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
I&nbsp;myself&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid448FAE48.3030109@nuclex.org&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=UTF-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
I&nbsp;have&nbsp;compiled&nbsp;both&nbsp;the&nbsp;svn&nbsp;copy&nbsp;of&nbsp;Tao&nbsp;and&nbsp;my&nbsp;test&nbsp;application&nbsp;with<br>
.NET&nbsp;1.1.&nbsp;This&nbsp;replaces&nbsp;the&nbsp;access&nbsp;violation&nbsp;by&nbsp;a<br>
NullReferenceException&nbsp;being&nbsp;triggered&nbsp;inside&nbsp;the&nbsp;Tao&nbsp;function.&nbsp;My<br>
pointers&nbsp;appear&nbsp;to&nbsp;be&nbsp;valid&nbsp;and&nbsp;the&nbsp;Tao&nbsp;function&nbsp;in&nbsp;question&nbsp;is&nbsp;just&nbsp;a<br>
P/Invoke&nbsp;declaration&nbsp;so&nbsp;I've&nbsp;got&nbsp;no&nbsp;idea&nbsp;where&nbsp;or&nbsp;why&nbsp;this&nbsp;exception&nbsp;is<br>
caused.&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
I&nbsp;finally&nbsp;managed&nbsp;to&nbsp;attach&nbsp;a&nbsp;debugger&nbsp;to&nbsp;the&nbsp;x86&nbsp;side&nbsp;of&nbsp;the&nbsp;process.<br>
Even&nbsp;in&nbsp;.NET&nbsp;1.1,&nbsp;an&nbsp;access&nbsp;violation&nbsp;occurs.&nbsp;Seems&nbsp;like&nbsp;the&nbsp;.NET&nbsp;1.1<br>
runtime&nbsp;tries&nbsp;to&nbsp;catch&nbsp;such&nbsp;access&nbsp;violations&nbsp;and&nbsp;transform&nbsp;them&nbsp;into<br>
NullReferenceExceptions&nbsp;and&nbsp;then&nbsp;Microsoft&nbsp;re-thought&nbsp;this&nbsp;behavior&nbsp;in<br>
.NET&nbsp;2.0,&nbsp;deciding&nbsp;to&nbsp;leave&nbsp;such&nbsp;errors&nbsp;alone.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;call&nbsp;from&nbsp;Tao.Ode.dll&nbsp;to&nbsp;Ode.dll&nbsp;is&nbsp;successfully&nbsp;made&nbsp;and&nbsp;the&nbsp;GPF<br>
occurs&nbsp;inside&nbsp;the&nbsp;memcpy()&nbsp;done&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;Ode&nbsp;function:&lt;br&gt;<br>
&lt;br&gt;<br>
   &nbsp;void&nbsp;dGeomSetRotation&nbsp;(dxGeom&nbsp;*g,&nbsp;const&nbsp;dMatrix3&nbsp;R)&lt;br&gt;<br>
   &nbsp;{&lt;br&gt;<br>
     &nbsp;dAASSERT&nbsp;(g&nbsp;&amp;amp;&amp;amp;&nbsp;R);&lt;br&gt;<br>
     &nbsp;dUASSERT&nbsp;(g-&amp;gt;gflags&nbsp;&amp;amp;&nbsp;GEOM_PLACEABLE,&quot;geom&nbsp;must&nbsp;be<br>
placeable&quot;);&lt;br&gt;<br>
     &nbsp;CHECK_NOT_LOCKED&nbsp;(g-&amp;gt;parent_space);&lt;br&gt;<br>
     &nbsp;if&nbsp;(g-&amp;gt;offset_posr)&nbsp;{&lt;br&gt;<br>
       &nbsp;g-&amp;gt;recomputePosr();&lt;br&gt;<br>
       &nbsp;//&nbsp;move&nbsp;body&nbsp;such&nbsp;that&nbsp;body+offset&nbsp;=&nbsp;rotation&lt;br&gt;<br>
       &nbsp;dxPosR&nbsp;new_final_posr;&lt;br&gt;<br>
       &nbsp;dxPosR&nbsp;new_body_posr;&lt;br&gt;<br>
       &nbsp;memcpy(new_final_posr.pos,&nbsp;g-&amp;gt;final_posr-&amp;gt;pos,<br>
sizeof(dVector3));&lt;br&gt;<br>
       &nbsp;memcpy(new_final_posr.R,&nbsp;R,&nbsp;sizeof(dMatrix3));&lt;br&gt;<br>
       &nbsp;getBodyPosr(*g-&amp;gt;offset_posr,&nbsp;new_final_posr,&nbsp;new_body_posr);&lt;br&gt;<br>
       &nbsp;dBodySetRotation(g-&amp;gt;body,&nbsp;new_body_posr.R);&lt;br&gt;<br>
       &nbsp;dBodySetPosition(g-&amp;gt;body,&nbsp;new_body_posr.pos[0],<br>
new_body_posr.pos[1],&nbsp;new_body_posr.pos[2]);&lt;br&gt;<br>
     &nbsp;}&lt;br&gt;<br>
     &nbsp;else&nbsp;if&nbsp;(g-&amp;gt;body)&nbsp;{&lt;br&gt;<br>
       &nbsp;//&nbsp;this&nbsp;will&nbsp;call&nbsp;dGeomMoved&nbsp;(g),&nbsp;so&nbsp;we&nbsp;don't&nbsp;have&nbsp;to&lt;br&gt;<br>
       &nbsp;dBodySetRotation&nbsp;(g-&amp;gt;body,R);&lt;br&gt;<br>
     &nbsp;}&lt;br&gt;<br>
     &nbsp;else&nbsp;{&lt;br&gt;<br>
       &nbsp;memcpy&nbsp;(g-&amp;gt;final_posr-&amp;gt;R,R,sizeof(dMatrix3));&lt;br&gt;<br>
       &nbsp;dGeomMoved&nbsp;(g);&lt;br&gt;<br>
     &nbsp;}&lt;br&gt;<br>
   &nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;dMatrix3&nbsp;parameter&nbsp;points&nbsp;to&nbsp;a&nbsp;suspicious&nbsp;memory&nbsp;address,<br>
0x3f800000.&nbsp;The&nbsp;other&nbsp;error&nbsp;also&nbsp;involved&nbsp;a&nbsp;by-value&nbsp;matrix&nbsp;parameter,<br>
so&nbsp;probably&nbsp;there's&nbsp;something&nbsp;wrong&nbsp;with&nbsp;the&nbsp;way&nbsp;the&nbsp;dMatrix3&nbsp;structure<br>
is&nbsp;passed&nbsp;to&nbsp;Ode.dll.&nbsp;I'll&nbsp;see&nbsp;if&nbsp;I&nbsp;can&nbsp;find&nbsp;out&nbsp;what...&lt;br&gt;<br>
&lt;br&gt;<br>
-Markus-&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
