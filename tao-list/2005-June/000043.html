<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Tao-list] ODE commit?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20ODE%20commit%3F&In-Reply-To=42ACF90E.5050308%40randyridge.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000034.html">
   <LINK REL="Next"  HREF="000035.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Tao-list] ODE commit?</H1>
    <B>Terry L. Triplett</B> 
    <A HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20ODE%20commit%3F&In-Reply-To=42ACF90E.5050308%40randyridge.com"
       TITLE="[Tao-list] ODE commit?">terry at triplett.org
       </A><BR>
    <I>Mon Jun 13 16:00:26 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000034.html">[Tao-list] ODE commit?
</A></li>
        <LI>Next message: <A HREF="000035.html">[Tao-list] How to use OpenGL in .NET platform
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43">[ date ]</a>
              <a href="thread.html#43">[ thread ]</a>
              <a href="subject.html#43">[ subject ]</a>
              <a href="author.html#43">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>See attached patches.  This allows ode-0.5 to be built as a shared
library using the soname agreed upon by the debian project ODE
maintainer and the upstream ode developers (libode.so.0).  The patch
also forces the ode test apps to run against the shared lib rather than
the static version.  Everything seems to work, at least for me, so ODE
doesn't seem to have problems running as a shared lib, at least as far
as the test programs are concerned.  The Tao.Ode example, on the other
hand, does not work with the shared lib currently - it dies with a
segfault.  I haven't had a chance to dig into this yet (this is low on
my priority list). 

After applying the patches and configuring the build as you would
normally do, 'make ode-shared-lib' builds the shared lib, 'make ode-lib'
builds the static version. 

Cheers.

Randy Ridge wrote:

&gt;<i> As far as cross platform issues with ODE, the biggest is that it's a
</I>&gt;<i> static lib on *nix.  I suspect it's reasonably straightforward to
</I>&gt;<i> build a shared library for it though.
</I>
-------------- next part --------------
Make sure we don't clobber %ebx (important with PIC).

<A HREF="http://bugs.gentoo.org/show_bug.cgi?id=77079">http://bugs.gentoo.org/show_bug.cgi?id=77079</A>

--- ode-0.5/ode/src/timer.cpp.orig	2005-01-08 00:42:12.799324632 -0500
+++ ode-0.5/ode/src/timer.cpp	2005-01-08 00:42:38.347440728 -0500
@@ -118,6 +118,13 @@
 {
   asm volatile (
+#if defined(__i386__) &amp;&amp; defined(__PIC__)
+	&quot;pushl %%ebx\n&quot;
+	&quot;cpuid\n&quot;
+	&quot;popl %%ebx\n&quot;
+	: : : &quot;%eax&quot;,&quot;%ecx&quot;,&quot;%edx&quot;,&quot;cc&quot;,&quot;memory&quot;);
+#else
 	&quot;mov $0,%%eax\n&quot;
 	&quot;cpuid\n&quot;
 	: : : &quot;%eax&quot;,&quot;%ebx&quot;,&quot;%ecx&quot;,&quot;%edx&quot;,&quot;cc&quot;,&quot;memory&quot;);
+#endif
 }
-------------- next part --------------
--- ode-0.5.orig/Makefile	2004-05-18 14:07:45.000000000 -0400
+++ ode-0.5/Makefile	2005-05-16 13:23:20.268382136 -0400
@@ -250,6 +250,8 @@
 
 # library file names
 ODE_LIB=$(LIBPATH)/$(LIB_PREFIX)$(ODE_LIB_NAME)$(LIB_SUFFIX)
+ODE_SHARED_SUFFIX=.so.0
+ODE_SHARED_LIB=$(LIBPATH)/$(LIB_PREFIX)$(ODE_LIB_NAME)$(ODE_SHARED_SUFFIX)
 DRAWSTUFF_LIB=$(LIBPATH)/$(LIB_PREFIX)$(DRAWSTUFF_LIB_NAME)$(LIB_SUFFIX)
 
 # executable file names
@@ -267,12 +269,13 @@
 # were discovered by fbuild to be the fastest on that platform. believe it or
 # not, O2 makes this code run much slower for most compilers.
 
-all: ode-lib drawstuff-lib ode-test drawstuff-test
+all: ode-shared-lib drawstuff-lib ode-test drawstuff-test
 	@echo SUCCESS
 
 ode-lib: configure $(ODE_LIB)
+ode-shared-lib: configure $(ODE_SHARED_LIB)
 drawstuff-lib: configure $(DRAWSTUFF_LIB)
-ode-test: ode-lib drawstuff-lib $(ODE_TEST_EXE)
+ode-test: ode-shared-lib drawstuff-lib $(ODE_TEST_EXE)
 drawstuff-test: drawstuff-lib $(DRAWSTUFF_TEST_EXE)
 
 ifndef ODE_LIB_AR_RULE
@@ -298,6 +301,9 @@
 	$(RANLIB) $@
 endif
 
+$(ODE_SHARED_LIB): pre_ode_lib $(ODE_OBJECTS)
+	$(CC) -o $@ $(PICFLAGS) -shared -Wl,-soname,$(LIB_PREFIX)$(ODE_LIB_NAME)$(ODE_SHARED_SUFFIX) $(ODE_OBJECTS)
+
 $(DRAWSTUFF_LIB): pre_drawstuff_lib $(DRAWSTUFF_OBJECTS)
 ifeq ($WINDOWS16),1)
 #   if we have a command-line-length limitation, then do the same as above.
@@ -325,17 +331,17 @@
 endif
 
 clean:
-	-$(DEL_CMD) $(ODE_OBJECTS) $(ODE_TEST_EXE) $(ODE_LIB) $(DRAWSTUFF_OBJECTS) $(DRAWSTUFF_TEST_EXE) $(DRAWSTUFF_LIB) ode/test/*$(OBJ) drawstuff/dstest/*$(OBJ) $(CONFIGURATOR_EXE) $(CONFIG_H)
+	-$(DEL_CMD) $(ODE_OBJECTS) $(ODE_TEST_EXE) $(ODE_LIB) $(ODE_SHARED_LIB) $(DRAWSTUFF_OBJECTS) $(DRAWSTUFF_TEST_EXE) $(DRAWSTUFF_LIB) ode/test/*$(OBJ) drawstuff/dstest/*$(OBJ) $(CONFIGURATOR_EXE) $(CONFIG_H)
 	-$(DEL_CMD) OPCODE/*.obj OPCODE/*.o OPCODE/Ice/*.obj OPCODE/Ice/*.o
 
 %$(OBJ): %.c
-	$(CC) $(C_FLAGS) $(C_INC)$(INCPATH) $(DEFINES) $(C_OPT)1 $(C_OUT)$@ $&lt;
+	$(CC) $(PICFLAGS) $(C_FLAGS) $(C_INC)$(INCPATH) $(DEFINES) $(C_OPT)1 $(C_OUT)$@ $&lt;
 
 %$(OBJ): %.cpp
-	$(CC) $(C_FLAGS) $(C_INC)$(INCPATH) $(INC_OPCODE) $(DEFINES) $(C_OPT)$(OPT) $(C_OUT)$@ $&lt;
+	$(CC) $(PICFLAGS) $(C_FLAGS) $(C_INC)$(INCPATH) $(INC_OPCODE) $(DEFINES) $(C_OPT)$(OPT) $(C_OUT)$@ $&lt;
 
 %.exe: %$(OBJ)
-	$(CC) $(C_EXEOUT)$@ $&lt; $(ODE_LIB) $(DRAWSTUFF_LIB) $(RESOURCE_FILE) $(LINK_OPENGL) $(LINK_MATH)
+	$(CC) $(C_EXEOUT)$@ $&lt; $(ODE_SHARED_LIB) $(DRAWSTUFF_LIB) $(RESOURCE_FILE) $(LINK_OPENGL) $(LINK_MATH)
 
 
 # windows specific rules
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000034.html">[Tao-list] ODE commit?
</A></li>
	<LI>Next message: <A HREF="000035.html">[Tao-list] How to use OpenGL in .NET platform
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43">[ date ]</a>
              <a href="thread.html#43">[ thread ]</a>
              <a href="subject.html#43">[ subject ]</a>
              <a href="author.html#43">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://galactus.ximian.com/mailman/listinfo/tao-list">More information about the Tao-list
mailing list</a><br>
</body></html>
