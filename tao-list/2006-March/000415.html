<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Tao-list] TriangleMesh callbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20TriangleMesh%20callbacks&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000414.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Tao-list] TriangleMesh callbacks</H1>
    <B>Daniel Oberhoff</B> 
    <A HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20TriangleMesh%20callbacks&In-Reply-To="
       TITLE="[Tao-list] TriangleMesh callbacks">daniel at danieloberhoff.de
       </A><BR>
    <I>Fri Mar 31 16:36:59 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000414.html">[Tao-list] Tao Status..
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#415">[ date ]</a>
              <a href="thread.html#415">[ thread ]</a>
              <a href="subject.html#415">[ subject ]</a>
              <a href="author.html#415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Folks,

I am playing around with a little scenegraph framework including physics
on top of Tao (and OdeDotNet) and just got the TriangleMesh working. When
I pass some callbacks to the constructor though it crashes. Here is the
modified OdeDotNet TriangleMesh Geometry I used:

/*
* $RCSfile: TriangleMesh.cs,v $
* Copyright (C) 2005 Rob Loach (<A HREF="http://www.robloach.net">http://www.robloach.net</A>)
*
* This library is free software; you can redistribute it and/or
* modify it under the terms of the GNU Lesser General Public
* License as published by the Free Software Foundation; either
* version 2.1 of the License, or (at your option) any later version.
*
* This library is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
* Lesser General Public License for more details.
*
* You should have received a copy of the GNU Lesser General Public
* License along with this library; if not, write to the Free Software
* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
*/

using System;

using Tao.Ode;

#region Aliases

using dReal=System.Single;
using dWorldID=System.IntPtr;
using dBodyID=System.IntPtr;
using dJointID=System.IntPtr;
using dJointGroupID=System.IntPtr;
using dGeomID=System.IntPtr;
using dSpaceID=System.IntPtr;
using dTriMeshDataID=System.IntPtr;

#endregion Aliases

namespace OdeDotNet.Geometry
{
	/// Summary description for TriangleMesh.
	/// &lt;/summary&gt;
	public class TriangleMesh : Geom
	{

		public  void TriArrayCallback(dGeomID TriMesh, dGeomID RefObject, int[]
TriIndices, int TriCount)
		{
		}

		public  int TriCallback(dGeomID TriMesh, dGeomID RefObject, int
TriangleIndex)
		{
			return 0;
		}

		public  int TriRayCallback(dGeomID TriMesh, dGeomID Ray, int
TriangleIndex, dReal u, dReal v)
		{
			return 0;
		}

		public TriangleMesh(Space space, dTriMeshDataID data) : base
		(IntPtr.Zero)
		{
			this.Handle = Ode.dCreateTriMesh(
				space.Handle, data,
				new Ode.dTriCallback(TriCallback),
				new Ode.dTriArrayCallback(TriArrayCallback),
				new Ode.dTriRayCallback(TriRayCallback)
			);
		}

		public TriangleMesh(Space space) : this(space, IntPtr.Zero)		{
		}

		internal TriangleMesh(dGeomID geom) : base(geom)
		{
		}

		protected override void CloseHandle()
		{
			Ode.dGeomTriMeshDataDestroy(this.Handle);
		}

	}
}

Here is the stacktrace of the crash:

in (wrapper managed-to-native)
System.Object:__icall_wrapper_mono_delegate_to_ftnptr (object)
&lt;0xffffffff&gt;
in (wrapper managed-to-native)
System.Object:__icall_wrapper_mono_delegate_to_ftnptr (object) &lt;0x84&gt;
in (wrapper managed-to-native) Tao.Ode.Ode:dCreateTriMesh
(intptr,intptr,Tao.Ode.Ode/dTriCallback,Tao.Ode.Ode/dTriArrayCallback,Tao.Ode.Ode/dTriRayCallback)
&lt;0xb8&gt;
in OdeDotNet.Geometry.TriangleMesh:.ctor (OdeDotNet.Space,intptr) &lt;0xf8&gt;
in SceneGraph.Drawables.VertexBase:makeGeoms
(System.Collections.ArrayList&amp;,OdeDotNet.Space) (at
/Users/daniel/working/scenegraph/src/Drawables/vertexbase.cs:305)
in SceneGraph.Nodes.Node:getGeoms
(System.Collections.ArrayList&amp;,OdeDotNet.Space) (at
/Users/daniel/working/scenegraph/src/Nodes/Node.cs:56)
in MeinClass:buildtree (SceneGraph.Nodes.Node) (at
/Users/daniel/working/scenegraph/src/Test.cs:40)
in MeinClass:Main (string[]) (at
/Users/daniel/working/scenegraph/src/Test.cs:67)
in (wrapper runtime-invoke) System.Object:runtime_invoke_void_string[]
(object,intptr,intptr,intptr) &lt;0x64&gt;

I don't really need these callbacks, and if I pass null for the callbacks
it works fine, including collisions, just thought I should report the bug.

Cheers

Daniel
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000414.html">[Tao-list] Tao Status..
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#415">[ date ]</a>
              <a href="thread.html#415">[ thread ]</a>
              <a href="subject.html#415">[ subject ]</a>
              <a href="author.html#415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://galactus.ximian.com/mailman/listinfo/tao-list">More information about the Tao-list
mailing list</a><br>
</body></html>
