<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Tao-list] Re: Using GLSL-Shaders with TAO
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20Re%3A%20Using%20GLSL-Shaders%20with%20TAO&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000282.html">
   <LINK REL="Next"  HREF="000284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Tao-list] Re: Using GLSL-Shaders with TAO</H1>
    <B>Stefan Stammberger</B> 
    <A HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20Re%3A%20Using%20GLSL-Shaders%20with%20TAO&In-Reply-To="
       TITLE="[Tao-list] Re: Using GLSL-Shaders with TAO">sstammberger at web.de
       </A><BR>
    <I>Tue Dec 13 11:11:52 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000282.html">[Tao-list] Using GLSL-Shaders with TAO
</A></li>
        <LI>Next message: <A HREF="000284.html">[Tao-list] Re: Using GLSL-Shaders with TAO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#283">[ date ]</a>
              <a href="thread.html#283">[ thread ]</a>
              <a href="subject.html#283">[ subject ]</a>
              <a href="author.html#283">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

this is the shader class I'm using. It works, but i didn't do any extensive testing yet.
I'm still in the process of writing other parts of my engine. And while looking through the code
I've just seen I'm not doing any testing of return values but I know it works.

	public class Shader
	{
		int mHandleVert;
		int mHandleFrag;
		int mHandleProg;

		public Shader()
		{
			mHandleVert = -1;
			mHandleFrag = -1;
			mHandleProg = -1;
		}

		public int LoadShader(string fragFile, string vertFile)
		{
			VirtualFileSystem vfs = VirtualFileSystem.GetInstance();
			
			StreamReader vs = vfs.OpenTextFile(vertFile);
			string vertexsource = vs.ReadToEnd();
			vs.Close();

			vs = vfs.OpenTextFile(fragFile);
			string fragsource = vs.ReadToEnd();
			vs.Close();

			mHandleVert = Gl.glCreateShaderObjectARB(Gl.GL_VERTEX_SHADER_ARB);
			mHandleFrag = Gl.glCreateShaderObjectARB(Gl.GL_FRAGMENT_SHADER_ARB);

			Gl.glShaderSourceARB(mHandleVert, 1, ref vertexsource, null);
			Gl.glShaderSourceARB(mHandleFrag, 1, ref fragsource, null);

			Gl.glCompileShaderARB(mHandleVert);
			Gl.glCompileShaderARB(mHandleFrag);

			mHandleProg = Gl.glCreateProgramObjectARB();
			Gl.glAttachObjectARB(mHandleProg, mHandleVert);
			Gl.glAttachObjectARB(mHandleProg, mHandleFrag);

			Gl.glLinkProgramARB(mHandleProg);

			return mHandleProg;
		}
	}

And this is how I use the shader then:


Gl.glUseProgramObjectARB(shaderProgHandle); // the shader prog you want to use ( as returned by Shader.LoadShader(...) )
Gl.glUniform4fARB(Gl.glGetUniformLocationARB(shaderProgHandle, &quot;BaseColor&quot;), r , g , b, 1.0f); // pass the information to the shader you might want to use

// draw your stuff  using the shader here

Gl.glUseProgramObjectARB(0); // disable the shader usage


I hope this helps to solve your problems :)


Stefan




Dennis Wagner &lt;<A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">wagner at Spheron.com</A>&gt; schrieb am 13.12.05 12:25:52:

Hi everyone!

I was programming OpenGL for quite a while now in C and C++ when I had 
the need to look into some of the &quot;newer&quot; language-bindings. First I 
worked quite a lot with jogl which produced quite good results (besides 
the lame fps). Now I focussed on .NET and C# for a new project and 
therefore I came across TAO. I downloaded it and started writing some 
basic code like a viewer for obj-files. But then again I was bored by 
OpenGL messing up the lighting with per-vertex-lighting all the time so 
I decided to include at least some basic per-pixel-lighting. I took the 
glsl-shaders I had in store. They work like a charm for me under C and 
C++. I checked them on the graphics card I'm using at the moment (ATI 
Mobility Radeon X600) using my own C-code and ATI's RenderMonkey. They 
work on the given machine. But I run into some troubles when I try to 
use those shaders in C#. Those troubles get even deeper the more I try 
to find out what's going wrong :(
As I have seen on the mailing-list-archives there have been some 
questions about different aspects of what my problem is earlier but I 
found none of the answers helping me out. So here's my question:
Has anyone every managed to get a fully working example of glsl running 
with TAO? I did not find anything using those functions in the source of 
the examples nor on the internet (using google for hours now).
It would be great if someone had some lines to contribute that really 
work. My problems start just after a call to &quot;this.id = 
Gl.glCreateShader( Gl.GL_VERTEX_SHADER );&quot;.
I store the return value in a class-member. I found that value being 
quite weird when I used int so I looked up glext.h again and as I 
expected I found GLHandle to be declared as unsigned int. So I switched 
the local member to uint and casted the int-return of glCreateShader 
apropriatly. That gave the same weird value, just being non-negative. 
When I tried a bit around and changed the member to type unsigned short 
I finally got the value &quot;1&quot; that I expected from the beginning (I know, 
it needn't be &quot;1&quot; always..). But then again passing that value to any 
function later always generates INVALID_VALUE-errors that are showing 
the handle to be invalid according to the documentation of the 
OpenGL-methods. I fiddled around a bit with different casts and stuff 
but it hasn't produced some good results yet.
While trying some different htings I came over glGetString returning a 
System.IntPtr. I don't have any clue how to get the string when I have 
just a pointer in C#. Also specifying the shader-code seems to be not 
that easy. I tried different versions, from using only &quot;old-style&quot; 
ARB-methods and constants to using completly OpenGL2.0-stuff to even 
mixing them (although I don't think this is wise after all). Right now I 
am very close to giving up but some little voice inside my head is 
whispering that can't be...
So, please help a drowning man...

greets


dennis

_______________________________________________
Tao-list mailing list
<A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">Tao-list at lists.ximian.com</A>
<A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">http://galactus.ximian.com/mailman/listinfo/tao-list</A>


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000282.html">[Tao-list] Using GLSL-Shaders with TAO
</A></li>
	<LI>Next message: <A HREF="000284.html">[Tao-list] Re: Using GLSL-Shaders with TAO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#283">[ date ]</a>
              <a href="thread.html#283">[ thread ]</a>
              <a href="subject.html#283">[ subject ]</a>
              <a href="author.html#283">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://galactus.ximian.com/mailman/listinfo/tao-list">More information about the Tao-list
mailing list</a><br>
</body></html>
