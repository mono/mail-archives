<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Tao-list] Reading .gif files fast to Tao.Sdl surfaces
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20Reading%20.gif%20files%20fast%20to%20Tao.Sdl%20surfaces&In-Reply-To=OF2F511AF4.0EF971D5-ON882570D1.007875A7-882570D1.00789A08%40capgroup.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000273.html">
   <LINK REL="Next"  HREF="000277.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Tao-list] Reading .gif files fast to Tao.Sdl surfaces</H1>
    <B>Olof Bjarnason</B> 
    <A HREF="mailto:tao-list%40lists.ximian.com?Subject=%5BTao-list%5D%20Reading%20.gif%20files%20fast%20to%20Tao.Sdl%20surfaces&In-Reply-To=OF2F511AF4.0EF971D5-ON882570D1.007875A7-882570D1.00789A08%40capgroup.com"
       TITLE="[Tao-list] Reading .gif files fast to Tao.Sdl surfaces">olof.bjarnason at gmail.com
       </A><BR>
    <I>Sat Dec 10 05:10:30 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000273.html">[Tao-list] Reading .gif files fast to Tao.Sdl surfaces
</A></li>
        <LI>Next message: <A HREF="000277.html">[Tao-list] Reading .gif files fast to Tao.Sdl surfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#275">[ date ]</a>
              <a href="thread.html#275">[ thread ]</a>
              <a href="subject.html#275">[ subject ]</a>
              <a href="author.html#275">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks, I will try this out.

But I'm thinking, how does SdlImage handle the multi-frame-format .gif?
There are no APIs for getting the individual surfaces of a .gif in SdlImage,
or have I missed something? Of course, I could do something like putting all
the frames of the .gif into a grid on a single frame.

/Olof

On 12/8/05, <A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">David_Hudson at capgroup.com</A> &lt;<A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">David_Hudson at capgroup.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> for step 6 use this
</I>&gt;<i> IntPtr surface = SdlImage.IMG_Load_RW(Sdl.SDL_RWFromMem(pixelarray,
</I>&gt;<i> pixelarray.Length), 1);
</I>&gt;<i>
</I>&gt;<i> Dave
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">tao-list-bounces at lists.ximian.com</A> wrote on 12/08/2005 11:36:10 AM:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi there!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm fairly new to Tao, and am using it primarily for the Sdl
</I>&gt;<i> &gt; wrapper. I'm in C#.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Now I want to load images into Sdl's surfaces. I'm using .gif for my
</I>&gt;<i> &gt; pixel-animation based game, so that format is preferable from my
</I>&gt;<i> &gt; side, and also I'd like to read them from memory (I'm using binary
</I>&gt;<i> &gt; archive files instead of the file system.). All 8-bits.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The method I've come up with so far is quite complicated, and as you
</I>&gt;<i> &gt; might image after reading this, quite slow. The reason for the
</I>&gt;<i> &gt; complication is because I want to avoid unsafe code sections. Also,
</I>&gt;<i> &gt; I don't exactly know how the garbage collection of C# work, and how
</I>&gt;<i> &gt; I make sure sdl doesn't garble up when I throw in an IntPtr (or that
</I>&gt;<i> &gt; pointer's heap space being reclaimed by the GC).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So bear with me ---
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. To begin with, I have the .gif file loaded into a byte[] called
</I>&gt;<i> &gt; 'bytes'. Nothing strange here, and it's fast.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2. I use Tao.DevIL to decode 'bytes' to image number 1. This is fast
</I>&gt;<i> too.
</I>&gt;<i> &gt;       Il.ilBindImage(1);
</I>&gt;<i> &gt;       Il.ilLoadL(Il.IL_GIF, bytes, bytes.Length);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3. Find out the bitmap dimensions via DevIL:
</I>&gt;<i> &gt;       int w = Il.ilGetInteger(Il.IL_IMAGE_WIDTH);
</I>&gt;<i> &gt;       int h = Il.ilGetInteger(Il.IL_IMAGE_HEIGHT);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 4. Gain access to the pixels of the read-in bitmap via DevIL's (an
</I>&gt;<i> IntPtr)
</I>&gt;<i> &gt;       IntPtr pixels = Il.ilGetData();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 5. In order to gain access to the actual 8-bit bytes of the bitmap, I
</I>&gt;<i> copy the
</I>&gt;<i> &gt;   actual bytes in 'pixels' to another byte[] called 'pixelarray' via
</I>&gt;<i> &gt; C#'s Marshalling copy function.
</I>&gt;<i> &gt;   This should be reasonably fast too, given the built-in marshalling
</I>&gt;<i> &gt; functions are fast, which
</I>&gt;<i> &gt;   they really should be.
</I>&gt;<i> &gt;       byte[] pixelarray = new byte[w*h];
</I>&gt;<i> &gt;       Marshal.Copy(pixels, pixelarray, 0, w*h);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 6. Now I'm ready to create the Sdl surface. Since I don't wanna hack
</I>&gt;<i> &gt; around with byte* I simply
</I>&gt;<i> &gt;    use Sdl's FillRect to blit the bytes of the loaded bitmap to the
</I>&gt;<i> &gt; sdl surface:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         IntPtr surface = Sdl.SDL_CreateRGBSurface(Sdl.SDL_SWSURFACE,
</I>&gt;<i> &gt; w, h, 8, 0, 0, 0, 0);
</I>&gt;<i> &gt;         Sdl.SDL_Rect r = new Sdl.SDL_Rect(0, 0, 1, 1);
</I>&gt;<i> &gt;         for (short y = 0; y &lt; h; y++)
</I>&gt;<i> &gt;           for (short x = 0; x &lt; w; x++)
</I>&gt;<i> &gt;           {
</I>&gt;<i> &gt;             r.x = x;
</I>&gt;<i> &gt;             r.y = y;
</I>&gt;<i> &gt;             Sdl.SDL_FillRect(surface, ref r, pixelarray[w * y + x]);
</I>&gt;<i> &gt;           }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This step is HORRIBLY slow - something like 5 seconds on my 1.5GHz
</I>&gt;<i> Pentium 4.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So, is there a faster way to load binar-embedded .gifs without using
</I>&gt;<i> &gt; 'unsafe'? May I safely assume using SDL_CreateRGBSurfaceFrom() will
</I>&gt;<i> &gt; work with the IntPtr returned from DevIL, as long as I don't delete
</I>&gt;<i> &gt; the DevIL bitmap?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; /Olof
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Tao-list mailing list
</I>&gt;<i> &gt; <A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">Tao-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://galactus.ximian.com/mailman/listinfo/tao-list">http://galactus.ximian.com/mailman/listinfo/tao-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/tao-list/attachments/20051210/a01a70ba/attachment.html">http://lists.ximian.com/pipermail/tao-list/attachments/20051210/a01a70ba/attachment.html</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000273.html">[Tao-list] Reading .gif files fast to Tao.Sdl surfaces
</A></li>
	<LI>Next message: <A HREF="000277.html">[Tao-list] Reading .gif files fast to Tao.Sdl surfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#275">[ date ]</a>
              <a href="thread.html#275">[ thread ]</a>
              <a href="subject.html#275">[ subject ]</a>
              <a href="author.html#275">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://galactus.ximian.com/mailman/listinfo/tao-list">More information about the Tao-list
mailing list</a><br>
</body></html>
