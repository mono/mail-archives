<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] MaskedTextBox.GetCharFromPosition Method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20MaskedTextBox.GetCharFromPosition%20Method&In-Reply-To=8C95D2A5B1B095A-F78-319C%40FWM-R34.sysops.aol.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002871.html">
   <LINK REL="Next"  HREF="002859.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] MaskedTextBox.GetCharFromPosition Method</H1>
    <B>daniele_dll</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20MaskedTextBox.GetCharFromPosition%20Method&In-Reply-To=8C95D2A5B1B095A-F78-319C%40FWM-R34.sysops.aol.com"
       TITLE="[Mono-winforms-list] MaskedTextBox.GetCharFromPosition Method">d.albano at gmail.com
       </A><BR>
    <I>Sat May  5 13:31:05 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="002871.html">[Mono-winforms-list] MaskedTextBox.GetCharFromPosition	Method
</A></li>
        <LI>Next message: <A HREF="002859.html">[Mono-winforms-list] Probably bug in SetSystemColors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2843">[ date ]</a>
              <a href="thread.html#2843">[ thread ]</a>
              <a href="subject.html#2843">[ subject ]</a>
              <a href="author.html#2843">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

this is my first post here, i haven't so much free time, but i read every
day all mails of this interesting mailing list :)

&gt;<i> Because there could be different fonts. The only solution seems to be to
</I>call the Grapics.MeasureText method for each letter.

The fonts aren't the only problem, infact a char in a string is rendered
differently, with a different width, by a single char, so, probably, you
really need to use Grapics.MeasureText

But you can speed up it doing another kinda of calculation if the string
lenght is more than X (X must be calculated doing some benchs): you can
split the text in the middle and look for what part contains the position.

Here there is a fast example of my idea:
####### CODE #######
        private int MyGetCharIndexFromPosition(TextBox textBox, Point pt)
        {
            // Initialize return value
            int returnValue = -1;

            // Acquire the necessary stuff for the code (graphics and
textbox content)
            Graphics g = textBox.CreateGraphics();
            string baseText = textBox.Text;

            // Check if the pointer is out of the text bounds
            float textBounds = g.MeasureString(baseText, textBox.Font
).Width;
            if (pt.X + 7 &gt; textBounds)
            {
                return baseText.Length - 1;
            }

            int pieceLenght = baseText.Length;
            int basePosition = 0;
            while (pieceLenght &gt; 0)
            {
                // Divide the lenght
                pieceLenght = pieceLenght &gt;&gt; 1;

                // Extract the first half of the base string
                string pieceText = baseText.Substring(0, basePosition +
pieceLenght);

                // Acquire the width
                float pieceWidth = g.MeasureString(pieceText, textBox.Font
).Width;

                // Check if only a char remained
                if (pieceLenght == 1)
                {
                    // Check what char index must be returned
                    if (pt.X + 7 /* i've added this because the text doesn't
start from the textbox left border */ &lt;= pieceWidth)
                    {
                        returnValue = basePosition;
                    }
                    else
                    {
                        returnValue = basePosition + 1;
                    }

                    break;
                }
                else
                {
                    // Check on what side the code must work
                    if (pt.X + 7 &lt;= pieceWidth)
                    {
                        // do nothing
                    }
                    else
                    {
                        // Update the basePosition
                        basePosition += pieceLenght;
                    }
                }
            }

            // Free memory
            g.Dispose();

            // Return the value
            return returnValue;
        }
####### CODE #######

This code is BUGGY: it doesn't select correctly the last char, i've really
short time, however this code can be used as starting point

I've tested this code ONLY with TextBox, not with MaskedTextBox, i'm saying
because i'm using the Text property of the control and in the maskedtextbox
the user doesn't see the text but the masked one

I hope this suggestion can be useful!

Best Regards,
Daniele


2007/5/5, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">aatdark at aol.com</A> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">aatdark at aol.com</A> &gt;:
&gt;<i>
</I>&gt;<i>  Hi
</I>&gt;<i> I have written lots of nunit tests for the Function and they are all
</I>&gt;<i> runnning well on MS .NET 2.0
</I>&gt;<i>  No i'm proceding with step 2.
</I>&gt;<i>
</I>&gt;<i> for now i try to get the correct line with
</I>&gt;<i> Line line = document.GetLineByPixel(p.Y,false);
</I>&gt;<i>
</I>&gt;<i> but the problem is: How can i get the char index from the position in
</I>&gt;<i> pixels?
</I>&gt;<i> I can only use the
</I>&gt;<i>
</I>&gt;<i> LineTagToCharIndex
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> if i know the char index.
</I>&gt;<i>
</I>&gt;<i> Because there could be different fonts. The only solution seems to be to
</I>&gt;<i> call the Grapics.MeasureText method for each letter.
</I>&gt;<i>
</I>&gt;<i> for example if the Text is:
</I>&gt;<i> HiTestText
</I>&gt;<i> I have to measure
</I>&gt;<i> H
</I>&gt;<i> Hi
</I>&gt;<i> HiT
</I>&gt;<i> HiTe
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> But this seems to be terrible slow?
</I>&gt;<i> Anyone a better solution for this ?
</I>&gt;<i>
</I>&gt;<i> Yours,
</I>&gt;<i> Berni
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20070505/f279c675/attachment.html">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20070505/f279c675/attachment.html</A> 
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002871.html">[Mono-winforms-list] MaskedTextBox.GetCharFromPosition	Method
</A></li>
	<LI>Next message: <A HREF="002859.html">[Mono-winforms-list] Probably bug in SetSystemColors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2843">[ date ]</a>
              <a href="thread.html#2843">[ thread ]</a>
              <a href="subject.html#2843">[ subject ]</a>
              <a href="author.html#2843">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
