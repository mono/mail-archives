<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] [Fwd: new Control.Autosize Patch]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20%5BFwd%3A%20new%20Control.Autosize%20Patch%5D&In-Reply-To=461A94F4.3040901%40jpobst.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002807.html">
   <LINK REL="Next"  HREF="002810.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] [Fwd: new Control.Autosize Patch]</H1>
    <B>Stefan Noack</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20%5BFwd%3A%20new%20Control.Autosize%20Patch%5D&In-Reply-To=461A94F4.3040901%40jpobst.com"
       TITLE="[Mono-winforms-list] [Fwd: new Control.Autosize Patch]">noackstefan at googlemail.com
       </A><BR>
    <I>Mon Apr  9 16:44:02 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="002807.html">[Mono-winforms-list] [Fwd:  new Control.Autosize Patch]
</A></li>
        <LI>Next message: <A HREF="002810.html">[Mono-winforms-list] Concerns about system colors?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2808">[ date ]</a>
              <a href="thread.html#2808">[ thread ]</a>
              <a href="subject.html#2808">[ subject ]</a>
              <a href="author.html#2808">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi

ok. i will fix those issues in the next days. :) thanks!

noah

2007/4/9, Jonathan Pobst &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">monkey at jpobst.com</A>&gt;:
&gt;<i>
</I>&gt;<i> Hey Noah, sorry this didn't go out quicker.  Dunno why the list is
</I>&gt;<i> eating it (or if it's just me that isn't getting it).
</I>&gt;<i>
</I>&gt;<i> It's good work, but there's some things that need to be fixed up before
</I>&gt;<i> I can commit it.
</I>&gt;<i>
</I>&gt;<i> We have to match the MS public API, so the following things are issues:
</I>&gt;<i> - Control.GetAutoSizeMode must be protected.
</I>&gt;<i> - We can't have the overrides: Button.AutoSize, Button.GetPreferredSize,
</I>&gt;<i> GroupBox.GetPreferredSize, or UserControl.GetPreferredSize.
</I>&gt;<i> (Check out the ButtonBase class.)
</I>&gt;<i>
</I>&gt;<i> Other issues:
</I>&gt;<i> - Don't call the DefaultLayout.LayoutAutoSizedChildren method on
</I>&gt;<i> !NET_2_0.  (Since there doesn't seem to be any work done in there for 1.1
</I>&gt;<i> .)
</I>&gt;<i> - Remove the MonoTODO on Control.AutoSize.  Since it's implemented now,
</I>&gt;<i> there's no real reason to have it.
</I>&gt;<i> - In DefaultLayout.LayoutAutoSizedChildren, use BoundsSpecified.None in
</I>&gt;<i> your SetBounds call.
</I>&gt;<i> (<A HREF="http://jpobst.blogspot.com/2007/04/setboundscore.html">http://jpobst.blogspot.com/2007/04/setboundscore.html</A>)
</I>&gt;<i> - What is the purpose for Control.GetPreferredSizeCore?
</I>&gt;<i> - Please write a ChangeLog entry summarizes the changes.
</I>&gt;<i>
</I>&gt;<i> I think most of the patch is fine.  No old tests broke, and your new
</I>&gt;<i> tests pass.  It just needs a little cleaning to make sure we match MS's
</I>&gt;<i> public API.  :-)
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i> Jon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Jackson Harper wrote:
</I>&gt;<i> &gt; Since this didn't get delivered to everyone on the list.  Just
</I>&gt;<i> &gt; re-posting.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Love,
</I>&gt;<i> &gt; Jackson
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -------- Forwarded Message --------
</I>&gt;<i> &gt; From: Stefan Noack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">noackstefan at googlemail.com</A>&gt;
</I>&gt;<i> &gt; To: mono-winforms-list &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">mono-winforms-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; Subject: [Mono-winforms-list] new Control.Autosize Patch
</I>&gt;<i> &gt; Date: Mon, 9 Apr 2007 18:02:27 +0200
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; hi
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; here it is. related to a newer revision and without non-autosize stuff.
</I>&gt;<i> &gt; (let me recheck this .... yes it is ok :) it also contains a new
</I>&gt;<i> &gt; testcase.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; best, noah
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-winforms-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">Mono-winforms-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Index:
</I>&gt;<i> mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/ControlTest.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; ---
</I>&gt;<i> mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/ControlTest.cs  (Revision
</I>&gt;<i> 75536)
</I>&gt;<i> &gt; +++
</I>&gt;<i> mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/ControlTest.cs  (Arbeitskopie)
</I>&gt;<i> &gt; @@ -3,6 +3,7 @@
</I>&gt;<i> &gt;  //
</I>&gt;<i> &gt;  // Authors:
</I>&gt;<i> &gt;  //      Ritvik Mayank (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">mritvik at novell.com</A>)
</I>&gt;<i> &gt; +//           Stefan Noack (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">noackstefan at googlemail.com</A>)
</I>&gt;<i> &gt;  //
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  using System;
</I>&gt;<i> &gt; @@ -24,7 +25,137 @@
</I>&gt;<i> &gt;       [TestFixture]
</I>&gt;<i> &gt;       public class ControlTest
</I>&gt;<i> &gt;       {
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt;               [Test]
</I>&gt;<i> &gt; +             public void AutoSizeTest ()
</I>&gt;<i> &gt; +             {
</I>&gt;<i> &gt; +                     ControlAutoSizeTester c = new
</I>&gt;<i> ControlAutoSizeTester (new Size (23, 17), AutoSizeMode.GrowAndShrink);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     Form f = new Form();
</I>&gt;<i> &gt; +                     f.Size = new Size (200, 200);
</I>&gt;<i> &gt; +                     c.Parent = f;
</I>&gt;<i> &gt; +                     f.Show();
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     Size s = new Size (42, 42);
</I>&gt;<i> &gt; +                     c.Size = s;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     Point l = new Point (10, 10);
</I>&gt;<i> &gt; +                     c.Location = l;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether normal size setting is OK
</I>&gt;<i> &gt; +                     Assert.AreEqual (s, c.Size, &quot;#S1&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether size remains without
</I>&gt;<i> GetPreferredSize implemented even when AutoSize turned on.
</I>&gt;<i> &gt; +                     c.AutoSize = true;
</I>&gt;<i> &gt; +                     f.PerformLayout();
</I>&gt;<i> &gt; +                     Assert.AreEqual (s, c.Size, &quot;#S2&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Simulate a Control implementing GetPreferredSize
</I>&gt;<i> &gt; +                     c.UseCustomPrefSize = true;
</I>&gt;<i> &gt; +                     f.PerformLayout();
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether size shrinks to preferred size
</I>&gt;<i> &gt; +                     Assert.AreEqual (c.CustomPrefSize, c.Size, &quot;#S3&quot;);
</I>&gt;<i> &gt; +                     //Check wether Location stays constant
</I>&gt;<i> &gt; +                     Assert.AreEqual (l, c.Location, &quot;#L1&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether Dock is respected
</I>&gt;<i> &gt; +                     c.Dock = DockStyle.Bottom;
</I>&gt;<i> &gt; +                     Assert.AreEqual (f.ClientSize.Width, c.Width,
</I>&gt;<i> &quot;#D1&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether size shrinks to preferred size
</I>&gt;<i> again
</I>&gt;<i> &gt; +                     c.Dock = DockStyle.None;
</I>&gt;<i> &gt; +                     Assert.AreEqual (c.CustomPrefSize, c.Size, &quot;#S4&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether Anchor is respected for adjusting
</I>&gt;<i> Locatioon
</I>&gt;<i> &gt; +                     c.Anchor = AnchorStyles.Bottom;
</I>&gt;<i> &gt; +                     f.Height += 50;
</I>&gt;<i> &gt; +                     Assert.AreEqual (l.Y + 50, c.Top, &quot;#A1&quot;);
</I>&gt;<i> &gt; +                     //Check wether size is still OK
</I>&gt;<i> &gt; +                     Assert.AreEqual (c.CustomPrefSize, c.Size, &quot;#S5&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //just tidy up
</I>&gt;<i> &gt; +                     c.Anchor = AnchorStyles.Top | AnchorStyles.Left;
</I>&gt;<i> &gt; +                     c.Location = l;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether shrinking to zero is possible
</I>&gt;<i> &gt; +                     c.CustomPrefSize = new Size (0, 0);
</I>&gt;<i> &gt; +                     f.PerformLayout();
</I>&gt;<i> &gt; +                     Assert.AreEqual (c.CustomPrefSize, c.Size, &quot;#S6&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether MinimumSize is honored
</I>&gt;<i> &gt; +                     c.MinimumSize = new Size (10, 12);
</I>&gt;<i> &gt; +                     c.CustomPrefSize = new Size (5, 5);
</I>&gt;<i> &gt; +                     f.PerformLayout();
</I>&gt;<i> &gt; +                     Assert.AreEqual (c.MinimumSize, c.Size, &quot;#S7&quot;);
</I>&gt;<i> &gt; +                     c.MinimumSize = new Size (0, 0);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether MaximumSize is honored
</I>&gt;<i> &gt; +                     c.MaximumSize = new Size (100, 120);
</I>&gt;<i> &gt; +                     c.CustomPrefSize = new Size (500, 500);
</I>&gt;<i> &gt; +                     f.PerformLayout();
</I>&gt;<i> &gt; +                     Assert.AreEqual (c.MaximumSize, c.Size, &quot;#S8&quot;);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     //Check wether shrinking does not happen when
</I>&gt;<i> GrowOnly
</I>&gt;<i> &gt; +                     c.AutoSize = false;
</I>&gt;<i> &gt; +                     s = new Size (23, 23);
</I>&gt;<i> &gt; +                     c.Size = s;
</I>&gt;<i> &gt; +                     c.CustomPrefSize = new Size (5, 5);
</I>&gt;<i> &gt; +                     c.AutoSizeMode = AutoSizeMode.GrowOnly;
</I>&gt;<i> &gt; +                     c.AutoSize = true;
</I>&gt;<i> &gt; +                     f.PerformLayout();
</I>&gt;<i> &gt; +                     Assert.AreEqual (s, c.Size, &quot;#S9&quot;);
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             public class ControlAutoSizeTester : Control {
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     public ControlAutoSizeTester (Size customPrefSize,
</I>&gt;<i> AutoSizeMode autoSizeMode)
</I>&gt;<i> &gt; +                     {
</I>&gt;<i> &gt; +                             custom_prefsize = customPrefSize;
</I>&gt;<i> &gt; +                             AutoSizeMode = autoSizeMode;
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     public AutoSizeMode AutoSizeMode {
</I>&gt;<i> &gt; +                             set {
</I>&gt;<i> &gt; +                                     base.SetAutoSizeMode (value);
</I>&gt;<i> &gt; +                             }
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     private bool use_custom_prefsize = false;
</I>&gt;<i> &gt; +                     public bool UseCustomPrefSize {
</I>&gt;<i> &gt; +                             set {
</I>&gt;<i> &gt; +                                     use_custom_prefsize = value;
</I>&gt;<i> &gt; +                             }
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     private Size custom_prefsize;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     public Size CustomPrefSize {
</I>&gt;<i> &gt; +                             get {
</I>&gt;<i> &gt; +                                     return custom_prefsize;
</I>&gt;<i> &gt; +                             }
</I>&gt;<i> &gt; +                             set {
</I>&gt;<i> &gt; +                                     custom_prefsize = value;
</I>&gt;<i> &gt; +                             }
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     public override Size GetPreferredSize (Size
</I>&gt;<i> proposedSize)
</I>&gt;<i> &gt; +                     {
</I>&gt;<i> &gt; +                             if (use_custom_prefsize) {
</I>&gt;<i> &gt; +                                     return custom_prefsize;
</I>&gt;<i> &gt; +                             } else {
</I>&gt;<i> &gt; +                                     return base.GetPreferredSize
</I>&gt;<i> (proposedSize);
</I>&gt;<i> &gt; +                             }
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             [Test]
</I>&gt;<i> &gt;               public void InvokeTestParentHandle ()
</I>&gt;<i> &gt;               {
</I>&gt;<i> &gt;                       Control child, parent;
</I>&gt;<i> &gt; Index: mcs/class/Managed.Windows.Forms/System.Windows.Forms/Button.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; ---
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/Button.cs    (Revision
</I>&gt;<i> 75536)
</I>&gt;<i> &gt; +++
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/Button.cs    (Arbeitskopie)
</I>&gt;<i> &gt; @@ -94,6 +94,30 @@
</I>&gt;<i> &gt;                               dialog_result = value;
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             //Propagate that we can AutoSize
</I>&gt;<i> &gt; +             public override bool AutoSize {
</I>&gt;<i> &gt; +                     get {
</I>&gt;<i> &gt; +                             return base.AutoSize;
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +                     set {
</I>&gt;<i> &gt; +                             base.AutoSize = value;
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             public System.Windows.Forms.AutoSizeMode AutoSizeMode {
</I>&gt;<i> &gt; +                     set {
</I>&gt;<i> &gt; +                             base.SetAutoSizeMode (value);
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +                     get {
</I>&gt;<i> &gt; +                             return base.GetAutoSizeMode();
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #endregion      // Public Instance Properties
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               #region Protected Instance Properties
</I>&gt;<i> &gt; @@ -117,6 +141,28 @@
</I>&gt;<i> &gt;               public override string ToString() {
</I>&gt;<i> &gt;                       return base.ToString() + &quot;, Text: &quot; + this.Text;
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt; +             public override Size GetPreferredSize (Size proposedSize)
</I>&gt;<i> &gt; +             {
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     Size retsize = new Size (0, 0);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     // Figure out where our text and image should go
</I>&gt;<i> &gt; +                     Rectangle text_rectangle;
</I>&gt;<i> &gt; +                     Rectangle image_rectangle;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> ThemeEngine.Current.CalculateButtonTextAndImageLayout (this, out
</I>&gt;<i> text_rectangle, out image_rectangle);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     // FIXME: Image should also be respected of course
</I>&gt;<i> - not only text - depending on how they are put together
</I>&gt;<i> &gt; +                     retsize.Width += text_rectangle.Width;
</I>&gt;<i> &gt; +                     retsize.Height += text_rectangle.Height;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     return retsize;
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #endregion      // Public Instance Methods
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               #region Protected Instance Methods
</I>&gt;<i> &gt; Index: mcs/class/Managed.Windows.Forms/System.Windows.Forms/GroupBox.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; ---
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/GroupBox.cs  (Revision
</I>&gt;<i> 75536)
</I>&gt;<i> &gt; +++
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/GroupBox.cs  (Arbeitskopie)
</I>&gt;<i> &gt; @@ -196,9 +196,63 @@
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -             #endregion //Public Properties
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; +             //Propagate that we can AutoSize
</I>&gt;<i> &gt; +             public override bool AutoSize {
</I>&gt;<i> &gt; +                     get {
</I>&gt;<i> &gt; +                             return base.AutoSize;
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +                     set {
</I>&gt;<i> &gt; +                             base.AutoSize = value;
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             public System.Windows.Forms.AutoSizeMode AutoSizeMode {
</I>&gt;<i> &gt; +                     set {
</I>&gt;<i> &gt; +                             base.SetAutoSizeMode (value);
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +                     get {
</I>&gt;<i> &gt; +                             return base.GetAutoSizeMode();
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             #endregion      // Public Instance Properties
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #region Public Methods
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt; +             public override Size GetPreferredSize (Size proposedSize)
</I>&gt;<i> &gt; +             {
</I>&gt;<i> &gt; +                     Size retsize = new Size (0, 0);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     for (int i = Controls.Count - 1; i &gt;= 0; i--) {
</I>&gt;<i> &gt; +                             Control child = Controls[i];
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (child.Dock != DockStyle.Top
</I>&gt;<i> &gt; +                             &amp;&amp; child.Dock != DockStyle.Bottom
</I>&gt;<i> &gt; +                             &amp;&amp; child.Bounds.Right &gt; retsize.Width)
</I>&gt;<i> &gt; +                                     retsize.Width=child.Bounds.Right;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (child.Dock != DockStyle.Left
</I>&gt;<i> &gt; +                             &amp;&amp; child.Dock != DockStyle.Right
</I>&gt;<i> &gt; +                             &amp;&amp; child.Bounds.Bottom &gt; retsize.Height)
</I>&gt;<i> &gt; +                                     retsize.Height=child.Bounds.Bottom
</I>&gt;<i> ;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     Rectangle display_r = DisplayRectangle;
</I>&gt;<i> &gt; +                     retsize.Width += Width - display_r.Width;
</I>&gt;<i> &gt; +                     retsize.Height += Height - display_r.Height;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     return retsize;
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               protected override void OnFontChanged (EventArgs e)
</I>&gt;<i> &gt;               {
</I>&gt;<i> &gt;                       base.OnFontChanged (e);
</I>&gt;<i> &gt; Index: mcs/class/Managed.Windows.Forms/System.Windows.Forms/Control.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; --- mcs/class/Managed.Windows.Forms/System.Windows.Forms/Control.cs
</I>&gt;<i> (Revision 75536)
</I>&gt;<i> &gt; +++ mcs/class/Managed.Windows.Forms/System.Windows.Forms/Control.cs
</I>&gt;<i> (Arbeitskopie)
</I>&gt;<i> &gt; @@ -881,7 +881,7 @@
</I>&gt;<i> &gt;                                       owner.PerformLayout(ctrl,
</I>&gt;<i> &quot;Parent&quot;);
</I>&gt;<i> &gt;                               }
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt; -
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;                       bool IList.IsFixedSize {
</I>&gt;<i> &gt;                               get {
</I>&gt;<i> &gt;                                       return false;
</I>&gt;<i> &gt; @@ -2028,7 +2028,6 @@
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -             // XXX: Implement me!
</I>&gt;<i> &gt;               bool auto_size;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               [RefreshProperties (RefreshProperties.All)]
</I>&gt;<i> &gt; @@ -2037,7 +2036,7 @@
</I>&gt;<i> &gt;               [Browsable (false)]
</I>&gt;<i> &gt;               [EditorBrowsable (EditorBrowsableState.Never)]
</I>&gt;<i> &gt;               [DefaultValue (false)]
</I>&gt;<i> &gt; -             [MonoTODO(&quot;This method currently does nothing&quot;)]
</I>&gt;<i> &gt; +             [MonoTODO(&quot;This method now works. (Done by the
</I>&gt;<i> LayoutEngine.) However, derived classes supposed to provide AutoSize must
</I>&gt;<i> implement their AutoSize habits by overriding GetPreferredSize to complete
</I>&gt;<i> this functionality&quot;)]
</I>&gt;<i> &gt;               public virtual bool AutoSize {
</I>&gt;<i> &gt;                       get { return auto_size; }
</I>&gt;<i> &gt;                       set {
</I>&gt;<i> &gt; @@ -2048,6 +2047,18 @@
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; +             private AutoSizeMode auto_size_mode =
</I>&gt;<i> AutoSizeMode.GrowOnly;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             protected void SetAutoSizeMode (AutoSizeMode mode)
</I>&gt;<i> &gt; +             {
</I>&gt;<i> &gt; +                     auto_size_mode = mode;
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             internal AutoSizeMode GetAutoSizeMode ()
</I>&gt;<i> &gt; +             {
</I>&gt;<i> &gt; +                     return auto_size_mode;
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;  #if NET_2_0
</I>&gt;<i> &gt;               [AmbientValue (&quot;{Width=0, Height=0}&quot;)]
</I>&gt;<i> &gt;  #else
</I>&gt;<i> &gt; @@ -3485,7 +3496,7 @@
</I>&gt;<i> &gt;  #if NET_2_0
</I>&gt;<i> &gt;               [EditorBrowsable (EditorBrowsableState.Advanced)]
</I>&gt;<i> &gt;               public virtual Size GetPreferredSize (Size proposedSize) {
</I>&gt;<i> &gt; -                     Size retsize = this.explicit_bounds.Size;
</I>&gt;<i> &gt; +                     Size retsize = GetPreferredSizeCore(proposedSize);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                       // If we're bigger than the MaximumSize, fix that
</I>&gt;<i> &gt;                       if (this.maximum_size.Width != 0 &amp;&amp; retsize.Width&gt;
</I>&gt;<i> this.maximum_size.Width)
</I>&gt;<i> &gt; @@ -3501,6 +3512,11 @@
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                       return retsize;
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             internal virtual Size GetPreferredSizeCore (Size
</I>&gt;<i> proposedSize) {
</I>&gt;<i> &gt; +                     return this.explicit_bounds.Size;
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;  #endif
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               public void Hide() {
</I>&gt;<i> &gt; Index:
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/UserControl.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; ---
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/UserControl.cs
</I>&gt;<i> (Revision 75536)
</I>&gt;<i> &gt; +++
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/UserControl.cs
</I>&gt;<i> (Arbeitskopie)
</I>&gt;<i> &gt; @@ -68,8 +68,56 @@
</I>&gt;<i> &gt;                               base.Text = value;
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             //Propagate that we can AutoSize
</I>&gt;<i> &gt; +             public override bool AutoSize {
</I>&gt;<i> &gt; +                     get {
</I>&gt;<i> &gt; +                             return base.AutoSize;
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +                     set {
</I>&gt;<i> &gt; +                             base.AutoSize = value;
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             public System.Windows.Forms.AutoSizeMode AutoSizeMode {
</I>&gt;<i> &gt; +                     set {
</I>&gt;<i> &gt; +                             base.SetAutoSizeMode (value);
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +                     get {
</I>&gt;<i> &gt; +                             return base.GetAutoSizeMode();
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #endregion      // Public Instance Properties
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt; +             public override Size GetPreferredSize (Size proposedSize)
</I>&gt;<i> &gt; +             {
</I>&gt;<i> &gt; +                     Size retsize = new Size (0, 0);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     for (int i = Controls.Count - 1; i &gt;= 0; i--) {
</I>&gt;<i> &gt; +                             Control child = Controls[i];
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (child.Dock != DockStyle.Top
</I>&gt;<i> &gt; +                             &amp;&amp; child.Dock != DockStyle.Bottom
</I>&gt;<i> &gt; +                             &amp;&amp; child.Bounds.Right &gt; retsize.Width)
</I>&gt;<i> &gt; +                                     retsize.Width=child.Bounds.Right;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (child.Dock != DockStyle.Left
</I>&gt;<i> &gt; +                             &amp;&amp; child.Dock != DockStyle.Right
</I>&gt;<i> &gt; +                             &amp;&amp; child.Bounds.Bottom &gt; retsize.Height)
</I>&gt;<i> &gt; +                                     retsize.Height=child.Bounds.Bottom
</I>&gt;<i> ;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +                     return retsize;
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #region Protected Instance Methods
</I>&gt;<i> &gt;               [EditorBrowsable(EditorBrowsableState.Advanced)]
</I>&gt;<i> &gt;               protected override void OnCreateControl() {
</I>&gt;<i> &gt; @@ -96,6 +144,7 @@
</I>&gt;<i> &gt;               protected override void WndProc(ref Message m) {
</I>&gt;<i> &gt;                       base.WndProc(ref m);
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #endregion      // Protected Instance Methods
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               #region Protected Properties
</I>&gt;<i> &gt; @@ -110,6 +159,7 @@
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt;  #endif
</I>&gt;<i> &gt;               #endregion
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #region Events
</I>&gt;<i> &gt;               static object LoadEvent = new object ();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Index:
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/ContainerControl.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; ---
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/ContainerControl.cs  (Revision
</I>&gt;<i> 75536)
</I>&gt;<i> &gt; +++
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms/ContainerControl.cs  (Arbeitskopie)
</I>&gt;<i> &gt; @@ -334,15 +334,19 @@
</I>&gt;<i> &gt;                               return null;
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #endregion      // Public Instance Properties
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #region Protected Instance Methods
</I>&gt;<i> &gt;               protected override CreateParams CreateParams {
</I>&gt;<i> &gt;                       get {
</I>&gt;<i> &gt;                               return base.CreateParams;
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; -             #endregion      // Public Instance Methods
</I>&gt;<i> &gt; +             #endregion      // Protected Instance Methods
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               #region Public Instance Methods
</I>&gt;<i> &gt;               [MonoTODO]
</I>&gt;<i> &gt; @@ -359,6 +363,7 @@
</I>&gt;<i> &gt;               bool IContainerControl.ActivateControl(Control control) {
</I>&gt;<i> &gt;                       return Select(control);
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               #endregion      // Public Instance Methods
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               #region Protected Instance Methods
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Index:
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms.Layout/DefaultLayout.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; ---
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms.Layout/DefaultLayout.cs      (Revision
</I>&gt;<i> 75536)
</I>&gt;<i> &gt; +++
</I>&gt;<i> mcs/class/Managed.Windows.Forms/System.Windows.Forms.Layout/DefaultLayout.cs      (Arbeitskopie)
</I>&gt;<i> &gt; @@ -24,6 +24,7 @@
</I>&gt;<i> &gt;  //
</I>&gt;<i> &gt;  // Authors:
</I>&gt;<i> &gt;  //   Jonathan Pobst (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">monkey at jpobst.com</A>)
</I>&gt;<i> &gt; +//  Stefan Noack (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">noackstefan at googlemail.com</A>)
</I>&gt;<i> &gt;  //
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  using System;
</I>&gt;<i> &gt; @@ -111,14 +112,14 @@
</I>&gt;<i> &gt;                               left = child.Left;
</I>&gt;<i> &gt;                               top = child.Top;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -#if NET_2_0
</I>&gt;<i> &gt; -                             Size preferredsize = child.PreferredSize;
</I>&gt;<i> &gt; -                             width = preferredsize.Width;
</I>&gt;<i> &gt; -                             height = preferredsize.Height;
</I>&gt;<i> &gt; -#else
</I>&gt;<i> &gt; +//#if NET_2_0
</I>&gt;<i> &gt; +//                           Size preferredsize = child.PreferredSize;
</I>&gt;<i> &gt; +//                           width = preferredsize.Width;
</I>&gt;<i> &gt; +//                           height = preferredsize.Height;
</I>&gt;<i> &gt; +//#else
</I>&gt;<i> &gt;                               width = child.Width;
</I>&gt;<i> &gt;                               height = child.Height;
</I>&gt;<i> &gt; -#endif
</I>&gt;<i> &gt; +//#endif
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                               if ((anchor &amp; AnchorStyles.Right) != 0) {
</I>&gt;<i> &gt;                                       if ((anchor &amp; AnchorStyles.Left)
</I>&gt;<i> != 0)
</I>&gt;<i> &gt; @@ -154,7 +155,65 @@
</I>&gt;<i> &gt;                               child.SetBounds (left, top, width, height,
</I>&gt;<i> BoundsSpecified.None);
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +             void LayoutAutoSizedChildren (Control parent, Control[]
</I>&gt;<i> controls)
</I>&gt;<i> &gt; +             {
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     for (int i = 0; i &lt; controls.Length; i++) {
</I>&gt;<i> &gt; +                             int left;
</I>&gt;<i> &gt; +                             int top;
</I>&gt;<i> &gt; +                             int width;
</I>&gt;<i> &gt; +                             int height;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; +                             Control child = controls[i];
</I>&gt;<i> &gt; +#if NET_2_0
</I>&gt;<i> &gt; +                             if (!child.VisibleInternal
</I>&gt;<i> &gt; +                                 || child.ControlLayoutType ==
</I>&gt;<i> Control.LayoutType.Dock
</I>&gt;<i> &gt; +                                 || !child.AutoSize)
</I>&gt;<i> &gt; +                                     continue;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             left = child.Left;
</I>&gt;<i> &gt; +                             top = child.Top;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             Size preferredsize = child.PreferredSize;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (child.GetAutoSizeMode() ==
</I>&gt;<i> AutoSizeMode.GrowAndShrink) {
</I>&gt;<i> &gt; +                                     width = preferredsize.Width;
</I>&gt;<i> &gt; +                                     height = preferredsize.Height;
</I>&gt;<i> &gt; +                             } else {
</I>&gt;<i> &gt; +                                     width = child.Width;
</I>&gt;<i> &gt; +                                     height = child.Height;
</I>&gt;<i> &gt; +                                     if (preferredsize.Width &gt; width)
</I>&gt;<i> &gt; +                                             width =
</I>&gt;<i> preferredsize.Width;
</I>&gt;<i> &gt; +                                     if (preferredsize.Height &gt; height)
</I>&gt;<i> &gt; +                                             height =
</I>&gt;<i> preferredsize.Height;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             // Sanity
</I>&gt;<i> &gt; +                             if (width &lt; child.MinimumSize.Width)
</I>&gt;<i> &gt; +                                     width = child.MinimumSize.Width;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (height &lt; child.MinimumSize.Height)
</I>&gt;<i> &gt; +                                     height = child.MinimumSize.Height;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (child.MaximumSize.Width != 0 &amp;&amp; width
</I>&gt;<i> &gt; child.MaximumSize.Width)
</I>&gt;<i> &gt; +                                     width = child.MaximumSize.Width;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             if (child.MaximumSize.Height != 0 &amp;&amp;
</I>&gt;<i> height &gt; child.MaximumSize.Height)
</I>&gt;<i> &gt; +                                     height = child.MaximumSize.Height;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                             child.SetBounds (left, top, width,
</I>&gt;<i> height);
</I>&gt;<i> &gt; +#endif
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                     }
</I>&gt;<i> &gt; +             }
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt;               public override bool Layout (object container,
</I>&gt;<i> LayoutEventArgs args)
</I>&gt;<i> &gt;               {
</I>&gt;<i> &gt;                       Control parent = container as Control;
</I>&gt;<i> &gt; @@ -163,6 +222,7 @@
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                       LayoutDockedChildren (parent, controls);
</I>&gt;<i> &gt;                       LayoutAnchoredChildren (parent, controls);
</I>&gt;<i> &gt; +                     LayoutAutoSizedChildren (parent, controls);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                       return false;
</I>&gt;<i> &gt;               }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-winforms-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">Mono-winforms-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20070409/82ab5410/attachment-0001.html">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20070409/82ab5410/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002807.html">[Mono-winforms-list] [Fwd:  new Control.Autosize Patch]
</A></li>
	<LI>Next message: <A HREF="002810.html">[Mono-winforms-list] Concerns about system colors?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2808">[ date ]</a>
              <a href="thread.html#2808">[ thread ]</a>
              <a href="subject.html#2808">[ subject ]</a>
              <a href="author.html#2808">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
