<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] ClipRectangles and Paint.NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20ClipRectangles%20and%20Paint.NET&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002804.html">
   <LINK REL="Next"  HREF="002805.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] ClipRectangles and Paint.NET</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20ClipRectangles%20and%20Paint.NET&In-Reply-To="
       TITLE="[Mono-winforms-list] ClipRectangles and Paint.NET">miguel at ximian.com
       </A><BR>
    <I>Mon Apr  9 10:51:51 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="002804.html">[Mono-winforms-list] Ruler widgets
</A></li>
        <LI>Next message: <A HREF="002805.html">[Mono-winforms-list] new Control.Autosize Patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2809">[ date ]</a>
              <a href="thread.html#2809">[ thread ]</a>
              <a href="subject.html#2809">[ subject ]</a>
              <a href="author.html#2809">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Chris!

    To optimize the rendering in Paint.NET, the application gets a list
of clipping rectangles.   

    I tried to use the get_ClipRectangles on the Hwnd class through
reflection and it works, but it returns some strange rectangles which
can make the application hang for 20-30 at a time.

    I have added some instrumentation code to look at the rectangles
returned and they seem to be out of range, and this seems to hang the
application.   Notice that the control's boundary is 212, 159:

Returning 3 rectangles for PaintDotNet.SurfaceBox that has 212,159
{X=-58655,Y=-58655,Width=59013,Height=58923}
{X=0,Y=0,Width=800,Height=600}
{X=0,Y=0,Width=212,Height=159}
Returning 2 rectangles for PaintDotNet.SurfaceBox that has 212,159
{X=-138,Y=-138,Width=267,Height=156}
{X=118,Y=7,Width=11,Height=21}

    The hang goes away if I replace the code in SystemLayer/UI.cs with
code that just returns a rectangle that is 0, 0, control.Width,
control.Height, but this is not optimal.

    I tried using &quot;Rectangle.Intersect&quot; with the  control.Bounds, but it
got me too much of a clipped rectangle, so I suspect am getting
rectangles that have a different origin.

    The entire code is in:

	svn+<A HREF="ssh://miguel@mono-cvs.ximian.com/extras/trunk/pdn3/trunk/src">ssh://miguel@mono-cvs.ximian.com/extras/trunk/pdn3/trunk/src</A>

Miguel.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002804.html">[Mono-winforms-list] Ruler widgets
</A></li>
	<LI>Next message: <A HREF="002805.html">[Mono-winforms-list] new Control.Autosize Patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2809">[ date ]</a>
              <a href="thread.html#2809">[ thread ]</a>
              <a href="subject.html#2809">[ subject ]</a>
              <a href="author.html#2809">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
