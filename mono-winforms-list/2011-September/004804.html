<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] Combining characters in libgdiplus strings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Combining%20characters%20in%20libgdiplus%20strings&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004803.html">
   <LINK REL="Next"  HREF="004805.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] Combining characters in libgdiplus strings</H1>
    <B>Dick Porter</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Combining%20characters%20in%20libgdiplus%20strings&In-Reply-To="
       TITLE="[Mono-winforms-list] Combining characters in libgdiplus strings">dporter at codicesoftware.com
       </A><BR>
    <I>Fri Sep  9 10:39:11 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004803.html">[Mono-winforms-list] CurrentCellDirtyStateChanged DataGridView
</A></li>
        <LI>Next message: <A HREF="004805.html">[Mono-winforms-list] Combining characters in libgdiplus strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4804">[ date ]</a>
              <a href="thread.html#4804">[ thread ]</a>
              <a href="subject.html#4804">[ subject ]</a>
              <a href="author.html#4804">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all

I've been tracking down a display bug with winforms.  Basically, any
string drawn that has combining chars (eg accents) doesn't come out
right.  I've attached a screenshot and a sample test.

In the screenshot the two buttons should look identical.  The only
difference is that the one on the left has text using a combining
accent, and the one on the right has the same text but using
pre-combined chars.  They're both valid utf-16; that is, it's not an
encoding issue.

It's caused by libgdiplus using the cairo 'toy' text api to render
strings.  This API takes each character in turn, draws the glyph from
the font, and advances the drawing point by the width of the character
in the font.  The combining accent has a zero width, but by the time it
has come to be drawn the drawing point has already been moved so it
misses the character it's supposed to be combining with.

I've tried enabling the &quot;experimental and unsupported&quot; pango text
rendering support (see attached patch to get around the failed
assertion: (process:27402): Pango-CRITICAL **: pango_fc_font_lock_face:
assertion `PANGO_IS_FC_FONT (font)' failed) but am having font loading
issues when using the 'system' cairo (with or without pango), which the
pango support depends on.

Is there any reason why the pango support can't be enabled by default?

- Dick
-------------- next part --------------
A non-text attachment was scrubbed...
Name: screen-capture.png
Type: image/png
Size: 9596 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20110909/c2652d69/attachment-0001.png">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20110909/c2652d69/attachment-0001.png</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: filedialog.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20110909/c2652d69/attachment-0002.pl">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20110909/c2652d69/attachment-0002.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: libgdiplus-pango-diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20110909/c2652d69/attachment-0003.pl">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20110909/c2652d69/attachment-0003.pl</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004803.html">[Mono-winforms-list] CurrentCellDirtyStateChanged DataGridView
</A></li>
	<LI>Next message: <A HREF="004805.html">[Mono-winforms-list] Combining characters in libgdiplus strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4804">[ date ]</a>
              <a href="thread.html#4804">[ thread ]</a>
              <a href="subject.html#4804">[ subject ]</a>
              <a href="author.html#4804">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
