<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] Button 2.0 Patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Button%202.0%20Patch&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002730.html">
   <LINK REL="Next"  HREF="002739.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] Button 2.0 Patch</H1>
    <B>Jonathan Pobst</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Button%202.0%20Patch&In-Reply-To="
       TITLE="[Mono-winforms-list] Button 2.0 Patch">monkey at jpobst.com
       </A><BR>
    <I>Tue Feb 27 13:19:50 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="002730.html">[Mono-winforms-list] problems with DataGridView and	DataTable	binding
</A></li>
        <LI>Next message: <A HREF="002739.html">[Mono-winforms-list] Button 2.0 Patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2733">[ date ]</a>
              <a href="thread.html#2733">[ thread ]</a>
              <a href="subject.html#2733">[ subject ]</a>
              <a href="author.html#2733">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey everyone,

I've finished up an initial implementation of all the new layout changes 
to Button 2.0.  Since the method I ended up going with is a departure 
from what we had, I thought I would run it by people before I commit.

In the current way our theming works for Button, drawing is done by one 
call from ButtonBase: DrawButtonBase, which calculates and draws every 
permutation of FlatStyle [4 options] for Button, CheckBox, and 
RadioButton.  Each theme must fully reimplement this do-all function to 
draw a button.  For 2.0, there are many more permutations: AutoEllipsis 
[2 options], TextImageRelation [5 options], UseMnemonic [2 options], and 
UseCompatibleTextRendering [2 options].  Also, there are 5 new options 
in FlatAppearance used when FlatStyle = Flat.

Therefore, I have tried to break it down a bit.  There is a new class 
called ThemeElements that solely handles painting an element, such as a 
standard button or a checkbox.  The elements will be broken down along 
roughly the same lines as what is used in the VisualStyle namespace, as 
it is extremely granular.  Additionally, it should make a XP/Vista Theme 
trivial to implement, and make it easy for the VisualStyle namespace to 
support drawing on other platforms.

For example, here are the 3 functions currently in ThemeElements:
        public static void DrawButton (Graphics g, Rectangle bounds, 
ButtonThemeState state, Color backColor, Color foreColor)
        public static void DrawFlatButton (Graphics g, Rectangle bounds, 
ButtonThemeState state, Color backColor, Color foreColor, 
FlatButtonAppearance appearance)
        public static void DrawPopupButton (Graphics g, Rectangle 
bounds, ButtonThemeState state, Color backColor, Color foreColor)

(state is an enum of Normal, Entered, Pressed, Disabled, Default)

These functions ONLY draw the button graphic in a given rectangle.  
Things like text and image layout and drawing is still handled in Theme, 
as it is much more likely to be reused across all themes, though it is 
overridable as well.

By breaking things down this way, it should greatly reduce the work 
required for each theme.  Each theme will generally need to override a 
function that simply draws the button graphic in a rectangle, instead of 
calculate and draw every permutation of button.

I made the changes for Win32.  It's backwards compatibile, so Nice and 
Clearlooks will draw the 1.1 button still, ignoring the 2.0 options.  
Also, only Button will currently draw the 2.0 features, RadioButton and 
CheckBox are not updated even though the properties will be settable in 
ButtonBase.

Thoughts?  Concerns?  Suggestions?  Anyone read past the first paragraph?
Jon
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: theme.patch
Url: <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20070227/0311b953/attachment-0001.pl">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20070227/0311b953/attachment-0001.pl</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002730.html">[Mono-winforms-list] problems with DataGridView and	DataTable	binding
</A></li>
	<LI>Next message: <A HREF="002739.html">[Mono-winforms-list] Button 2.0 Patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2733">[ date ]</a>
              <a href="thread.html#2733">[ thread ]</a>
              <a href="subject.html#2733">[ subject ]</a>
              <a href="author.html#2733">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
