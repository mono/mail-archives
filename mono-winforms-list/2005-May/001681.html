<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] Jonathan Gilbert's indexed color
	support patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Jonathan%20Gilbert%27s%20indexed%20color%0A%09support%20patch&In-Reply-To=120901c5624d%24c1538fd0%240a00a8c0%40pdb">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001677.html">
   <LINK REL="Next"  HREF="001678.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] Jonathan Gilbert's indexed color
	support patch</H1>
    <B>Jonathan Gilbert</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Jonathan%20Gilbert%27s%20indexed%20color%0A%09support%20patch&In-Reply-To=120901c5624d%24c1538fd0%240a00a8c0%40pdb"
       TITLE="[Mono-winforms-list] Jonathan Gilbert's indexed color
	support patch">2a5gjx302 at sneakemail.com
       </A><BR>
    <I>Sat May 28 00:20:53 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001677.html">[Mono-winforms-list] Jonathan Gilbert's indexed color support patch
</A></li>
        <LI>Next message: <A HREF="001678.html">[Mono-winforms-list] Jonathan Gilbert's indexed color
	support patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 05:50 PM 26/05/2005 -0600, Peter Dennis Bartok wrote:
[snip]
&gt;<i>It seems to handle images loaded from disk with no problem on both little 
</I>&gt;<i>and big endian systems (as shown by winforms/endian), but when images are 
</I>&gt;<i>retrieved from resources (resx), colors are swapped. The winforms/filedialog 
</I>&gt;<i>test app shows the problem very nicely.
</I>
There seems to be something really odd going on here. You assert that
winforms/endian works perfectly (the only deviation from straight lines of
colour being the 1-bit black &amp; white images) on big-endian systems such as
OS X? And yet, winforms/filedialog does not work properly?

By the way, I notice that winforms/filedialog does not have correct
transparency for the buttons on the left of the dialog, but I don't know if
that's a bug in the code or in the images being embedded. That's an
unrelated issue though :-)

I have investigated the code paths used by the two ways of loading a
bitmap. They proceed as follows:

Image.cs:                                 Image.cs:
Image.FromFile(...)                       Image.FromStream(...)
       |                                          |
       v                                          v
gdipFunctions.cs:                         gdipFunctions.cs:
GDIPlus.GdipLoadImageFromDelegate_linux   GDIPlus.GdipLoadImageFromFile
       |                                          |
(managed &lt;-&gt; unmanaged boundary; below here is inside libgdiplus)
       |                                          |
       v                                          v
image.c:                                  image.c:
GdipLoadImageFromDelegate_linux           GdipLoadImageFromFile
       |                                          |
       v                                          v
bmpcodec.c:                               bmpcodec.c:
gdip_load_bmp_image_from_stream_delegate  gdip_load_bmp_image_from_file
           \                                  /
            \                                /
             \                              /
             _\|                          |/_
           bmpcodec.c:
           gdip_read_bmp_image_from_file_stream

In other words, the two functions converge onto the same underlying code.
Apart from the mechanics of reading bytes from the files, streams and files
are read in exactly the same way. Therefore I don't see how one can work
and the other not!

Anyway, I will look very closely at how bmpcodec.c reads in the palette
data and let you know if I find any glaring errors.

The closest thing I have to a big-endian system at the moment is PearPC
running OS X, and it is somehow incompatible with the mono JIT's exception
handling mechanism =/ If I do come up with a revision, what do you propose
for testing it? I have yet to actually abserve the endian incompatibility
myself.

Jonathan Gilbert

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001677.html">[Mono-winforms-list] Jonathan Gilbert's indexed color support patch
</A></li>
	<LI>Next message: <A HREF="001678.html">[Mono-winforms-list] Jonathan Gilbert's indexed color
	support patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
