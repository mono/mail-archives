<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] NumericUpDown test case (with the
	right fileattached)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20NumericUpDown%20test%20case%20%28with%20the%0A%09right%20fileattached%29&In-Reply-To=200506111253.j5BCrJ5M030611%40mail15.syd.optusnet.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001735.html">
   <LINK REL="Next"  HREF="001737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] NumericUpDown test case (with the
	right fileattached)</H1>
    <B>Jonathan Gilbert</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20NumericUpDown%20test%20case%20%28with%20the%0A%09right%20fileattached%29&In-Reply-To=200506111253.j5BCrJ5M030611%40mail15.syd.optusnet.com.au"
       TITLE="[Mono-winforms-list] NumericUpDown test case (with the
	right fileattached)">2a5gjx302 at sneakemail.com
       </A><BR>
    <I>Sun Jun 12 11:38:42 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001735.html">[Mono-winforms-list] NumericUpDown test case (with the right file
	attached)
</A></li>
        <LI>Next message: <A HREF="001737.html">[Mono-winforms-list] Cairo, libgdiplus, System.Drawing on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1736">[ date ]</a>
              <a href="thread.html#1736">[ thread ]</a>
              <a href="subject.html#1736">[ subject ]</a>
              <a href="author.html#1736">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 10:53 PM 11/06/2005 +1000, JBA wrote:
&gt;<i>Appologies, I sent the wrong file last time (please ignore the
</I>&gt;<i>last email with the MonthCalendar.cs attached)
</I>&gt;<i>
</I>&gt;<i>Hey guys.
</I>&gt;<i>
</I>&gt;<i>Attached is the simplest NumericUpDown Value bug testcase I can
</I>&gt;<i>come up with.
</I>&gt;<i>Clicking on the test button changes the value from the minimum
</I>&gt;<i>(1953) to 2004. Running this test case on windows (using MWF on
</I>&gt;<i>.net framework) it takes 3 clicks of the test button for the
</I>&gt;<i>value to change in the Numeric up down control. I don't know why
</I>&gt;<i>this is though.
</I>&gt;<i>
</I>&gt;<i>JBA
</I>
I did some testing, and the problem seems to be a bug in mono's TextBox.
For one call to:

txtView.Text = value;

..the OnTextChanged event seems to be firing twice. The reason this causes
the problem is that UpDownBase uses a pair of flags to maintain the current
state and determine the correct behaviour. When the user types text into
the text box, the OnTextChanged event fires and the UserEdit property is
set to true. This property indicates that UpdateEditText should call
ParseEditText. To allow the controls to force an update without firing
ParseEditText, there is a property ChangingText. Subclasses of UpDownBase
can set this to true before assigning to the Text property, thereby
avoiding UserEdit being set to true. The logic is like this:

void OnTextBoxTextChanged(...)
{
  if (ChangingText)
    ChangingText = false; // Permit the subclass's change to the text box.
  else
    UserEdit = true;      // Recognize a change not requested by the subclass.
  ...
}

So, if the event fires twice, the first one consumes the ChangingText ==
true, and the second one then erroneously sets UserEdit to true.

I've taken a peek at the code for TextBox (and TextBoxBase and Control, the
base classes), and I think I see why this is happening. Basically,
TextBoxBase overrides Control.Text { set; } and does this:

base.Text = value;
OnTextChanged(EventArgs.Empty);

..at the end of the accessor. However, Control's own Text { set; } accessor
*also* calls OnTextChanged. I think the solution is fairly simple: remove
the call to OnTextChanged inside TextBoxBase's Text { set; } accessor. I
tested this locally and it did fix the problem :-) I don't know if this is
the correct fix or if it will have consequences elsewhere (though it does
seem right), but it should at least work as a work-around on your local
copy until Peter Bartok (in charge of TextBox) commits an official fix.

Jonathan Gilbert

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001735.html">[Mono-winforms-list] NumericUpDown test case (with the right file
	attached)
</A></li>
	<LI>Next message: <A HREF="001737.html">[Mono-winforms-list] Cairo, libgdiplus, System.Drawing on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1736">[ date ]</a>
              <a href="thread.html#1736">[ thread ]</a>
              <a href="subject.html#1736">[ subject ]</a>
              <a href="author.html#1736">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
