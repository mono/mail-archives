<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] Jonathan Gilbert's indexed colorsupport patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Jonathan%20Gilbert%27s%20indexed%20colorsupport%20patch&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001693.html">
   <LINK REL="Next"  HREF="001695.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] Jonathan Gilbert's indexed colorsupport patch</H1>
    <B>Jonathan Gilbert</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Jonathan%20Gilbert%27s%20indexed%20colorsupport%20patch&In-Reply-To="
       TITLE="[Mono-winforms-list] Jonathan Gilbert's indexed colorsupport patch">2a5gjx302 at sneakemail.com
       </A><BR>
    <I>Thu Jun  2 19:57:22 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001693.html">[Mono-winforms-list] OpenGL with Winforms
</A></li>
        <LI>Next message: <A HREF="001695.html">[Mono-winforms-list] Jonathan Gilbert's indexed colorsupport patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1694">[ date ]</a>
              <a href="thread.html#1694">[ thread ]</a>
              <a href="subject.html#1694">[ subject ]</a>
              <a href="author.html#1694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Okay, well, kangaroo sent me a screenshot of the erroneous display in the
FileDialog, and turns out it was not an issue of red &amp; blue channels being
swapped by not paying attention to endianness. It *was* an endianness
issue, but the effect was not what had been mentioned :-) What was actually
happening was that the blue channel was being forced to 0xFF.

This screenshot shows a section of kangaroo's screenshot on the left,
followed by Windows' own display, and then on the right, the top half shows
what the R, G, B channels are in kangaroo's screenshot, and the bottom half
shows what the R, G, B channels *should* be. Note that transparency was
still being taken into account, but wherever the pixel was opaque, the blue
channel was on solid!

I tracked this down to the code that prepares Bitmap data with a non-alpha
PixelFormat for display with Cairo, which always pays attention to the
alpha channel. It was doing something along these lines:

int force_alpha = 0xFF000000;

for (each pixel)
  pixel |= force_alpha;

I have changed the force_alpha assignment to a set_pixel_bgra, which should
fix the problem. I have no way to test whether it does in fact solve this
issue; the output looks exactly the same (it was correct before) on my
little-endian system. I invite anyone with a big-endian system to apply the
latest version of the patch:

<A HREF="http://israel.logiclrd.cx/patch/">http://israel.logiclrd.cx/patch/</A>

..and try out the winforms/filedialog test case :-)

Are there any other issues with my patch?

Jonathan Gilbert

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001693.html">[Mono-winforms-list] OpenGL with Winforms
</A></li>
	<LI>Next message: <A HREF="001695.html">[Mono-winforms-list] Jonathan Gilbert's indexed colorsupport patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1694">[ date ]</a>
              <a href="thread.html#1694">[ thread ]</a>
              <a href="subject.html#1694">[ subject ]</a>
              <a href="author.html#1694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
