<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] Mono-Wine patch 2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pigolkine%40gmx.de">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000470.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] Mono-Wine patch 2
   </H1>
    <B>Alexander Pigolkin
    </B> 
    <A HREF="mailto:pigolkine%40gmx.de"
       TITLE="[Mono-winforms-list] Mono-Wine patch 2">pigolkine@gmx.de
       </A><BR>
    <I>01 Sep 2003 00:42:03 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="000470.html">[Mono-winforms-list] DataBinding
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#471">[ date ]</a>
              <a href="thread.html#471">[ thread ]</a>
              <a href="subject.html#471">[ subject ]</a>
              <a href="author.html#471">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-BcqnEdg9pcB0wM1GCCkw
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hello Duncan,

I made few changes in the WineLib to fix initialization problem
and remove warning about missing function.
Could you please make a new release of Mono-Wine packages.

Thanks,

Alex

--=-BcqnEdg9pcB0wM1GCCkw
Content-Disposition: attachment; filename=mono-wine.patch.2
Content-Type: text/x-patch; name=mono-wine.patch.2; charset=UTF-8
Content-Transfer-Encoding: 7bit

diff -Nru -x '*~' -x '*.o' -x '*.orig' -x '*.rej' -x '*.0' -x 'request*' -x '*.log' -x '*.status' -x '*.dbg.c' -x 'Makefile*' -x '*.rules' -x '*glue.c' -x '*.s' -x '*.lex.yy.c' wine-20030318.orig.patched/dlls/gdi/driver.c wine-20030318.my/dlls/gdi/driver.c
--- wine-20030318.orig.patched/dlls/gdi/driver.c	2003-08-22 10:27:57.000000000 +0200
+++ wine-20030318.my/dlls/gdi/driver.c	2003-08-31 03:21:22.000000000 +0200
@@ -54,6 +54,7 @@
     struct graphics_driver *driver;
 #ifdef MONO
     char buffer[MAX_PATH];    
+    char buffer_DIB[MAX_PATH];    
 #endif
     if (!(driver = HeapAlloc( GetProcessHeap(), 0, sizeof(*driver)))) return NULL;
     driver-&gt;next   = NULL;
@@ -64,8 +65,10 @@
     /* fill the function table */
 #ifdef MONO
     strcpy( buffer, &quot;X11DRV_&quot; );
+    strcpy( buffer_DIB, &quot;X11DRV_DIB_&quot; );
     /* MONO SWF:  Charge  the buffer with initial content. Each function we need is started from &quot;X11DRV_&quot; */
 #define GET_FUNC(name)  { buffer[7] = 0; driver-&gt;funcs.p##name = (void*)GetProcAddress( module, strcat(buffer,#name) ); }
+#define GET_FUNC_DIB(name)  { buffer_DIB[11] = 0; driver-&gt;funcs.p##name = (void*)GetProcAddress( module, strcat(buffer_DIB,#name) ); }
 #else
 #define GET_FUNC(name) driver-&gt;funcs.p##name = (void*)GetProcAddress( module, #name )
 #endif
@@ -81,7 +84,11 @@
     GET_FUNC(CloseFigure);
     GET_FUNC(CreateBitmap);
     GET_FUNC(CreateDC);
+#ifdef MONO
+    GET_FUNC_DIB(CreateDIBSection);
+#else
     GET_FUNC(CreateDIBSection);
+#endif
     GET_FUNC(DeleteBitmap);
     GET_FUNC(DeleteDC);
     GET_FUNC(DescribePixelFormat);
diff -Nru -x '*~' -x '*.o' -x '*.orig' -x '*.rej' -x '*.0' -x 'request*' -x '*.log' -x '*.status' -x '*.dbg.c' -x 'Makefile*' -x '*.rules' -x '*glue.c' -x '*.s' -x '*.lex.yy.c' wine-20030318.orig.patched/dlls/user/misc.c wine-20030318.my/dlls/user/misc.c
--- wine-20030318.orig.patched/dlls/user/misc.c	2003-01-13 21:36:39.000000000 +0100
+++ wine-20030318.my/dlls/user/misc.c	2003-08-31 01:56:49.000000000 +0200
@@ -265,3 +265,13 @@
  *		USER_496 (USER.496)
  */
 LONG WINAPI stub_USER_496(void) { FIXME(&quot;stub\n&quot;); return 0; }
+
+BOOL SetLayeredWindowAttributes(      
+    HWND hwnd,
+    COLORREF crKey,
+    BYTE bAlpha,
+    DWORD dwFlags
+)
+{
+	return TRUE;
+}
diff -Nru -x '*~' -x '*.o' -x '*.orig' -x '*.rej' -x '*.0' -x 'request*' -x '*.log' -x '*.status' -x '*.dbg.c' -x 'Makefile*' -x '*.rules' -x '*glue.c' -x '*.s' -x '*.lex.yy.c' wine-20030318.orig.patched/dlls/user/user32.spec wine-20030318.my/dlls/user/user32.spec
--- wine-20030318.orig.patched/dlls/user/user32.spec	2003-01-13 21:36:39.000000000 +0100
+++ wine-20030318.my/dlls/user/user32.spec	2003-08-31 01:58:18.000000000 +0200
@@ -659,6 +659,7 @@
 @ stdcall SendInput(long ptr long) SendInput
 @ stdcall SetWinEventHook(long long long ptr long long long) SetWinEventHook
 @ stdcall UnhookWinEvent(long) UnhookWinEvent
+@ stdcall SetLayeredWindowAttributes(ptr long long long) SetLayeredWindowAttributes
 
 ################################################################
 # Wine extensions: Win16 functions that are needed by other dlls

--=-BcqnEdg9pcB0wM1GCCkw--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000470.html">[Mono-winforms-list] DataBinding
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#471">[ date ]</a>
              <a href="thread.html#471">[ thread ]</a>
              <a href="subject.html#471">[ subject ]</a>
              <a href="author.html#471">[ author ]</a>
         </LI>
       </UL>
</body></html>
