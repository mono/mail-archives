<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] RFC on winforms / XIM clientWindow fixage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20RFC%20on%20winforms%20/%20XIM%20clientWindow%20fixage&In-Reply-To=48229D41.9020807%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003358.html">
   <LINK REL="Next"  HREF="003360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20RFC%20on%20winforms%20/%20XIM%20clientWindow%20fixage&In-Reply-To=48229D41.9020807%40ximian.com"
       TITLE="[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage">atsushi at ximian.com
       </A><BR>
    <I>Thu May  8 08:50:59 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003358.html">[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage
</A></li>
        <LI>Next message: <A HREF="003360.html">[Mono-winforms-list] Can I run DevExpress applications under Mono on Linux?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3359">[ date ]</a>
              <a href="thread.html#3359">[ thread ]</a>
              <a href="subject.html#3359">[ subject ]</a>
              <a href="author.html#3359">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, I know am becoming a spammer ;-)

I dug in depth and found a fix for the MDI issue; MapWindow() has almost the
same inconsistent WM_SHOWWINDOW handling issue as UnmapWindow() has.

Though this fix exposed another issue that ApplicationContext could send
WM_QUIT inappropriately from ExitThreadCore(). When there is no application
loop, there is nothing to quit.

Though they are needed for XIM changes, the changes above are not about XIM.

The entire XIM patch is here: <A HREF="http://monoport.com/10928">http://monoport.com/10928</A>
(It includes this patch. Also note that this patch is dirty!)

When this patch and patch for bugs I wrote earlier are applied, I could
finally checkin this XIM change.

Atsushi Eno


Atsushi Eno wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> After fixing couple of issues, I found a fix for this 
</I>&gt;<i> WaitForHwndMessage()
</I>&gt;<i> issue. The situation is that (in some cases?) WM_SHOWWINDOW could be 
</I>&gt;<i> processed
</I>&gt;<i> synchronously inside SendMessage() and when we reach 
</I>&gt;<i> WaitForHwndMessage(),
</I>&gt;<i> the MSG is already consumed and hence never shows up.
</I>&gt;<i>
</I>&gt;<i> The attached patch fixes this issue. I'm still not sure why this does not
</I>&gt;<i> happen when we don't create XIM context for each client window, but
</I>&gt;<i> the sample repro in my last mail[*1] gets fixed with this patch.
</I>&gt;<i>
</I>&gt;<i> If it looks okay, I'll commit this small change. I'm still not going 
</I>&gt;<i> to commit
</I>&gt;<i> my XIM changes, as there are still pending fixes on bugzilla[*2] and 
</I>&gt;<i> there
</I>&gt;<i> seems another MDI issue that needs fix too.
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno
</I>&gt;<i>
</I>&gt;<i> *1 <A HREF="http://monoport.com/9806">http://monoport.com/9806</A>
</I>&gt;<i> *2 #325033 and #387693
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm posting it as I've been stuck with this issue for couple of days and
</I>&gt;&gt;<i> I still don't have a fix.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now I'm trying to fix XIM stuff to show up IM engine UI. Currently only
</I>&gt;&gt;<i> scim works (I tried scim-anthy). Everything else (as far as I tried,
</I>&gt;&gt;<i> iiimx/atokx3 and kinput2) do not work.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is (to my understanding) due to incorrect use of &quot;client window&quot; 
</I>&gt;&gt;<i> of the
</I>&gt;&gt;<i> input context (XIC). I fixed this issue with the patch [*1] but
</I>&gt;&gt;<i> it caused (or exposed) some regressions [*2][*3].
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My guess is that there are some issues around X event filtering (as
</I>&gt;&gt;<i> XplatUIX11.WaitForHwndMessage does not finish) but I don't know how it
</I>&gt;&gt;<i> could be fixed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'll continue working on this issue but any help would be appreciated.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *1 <A HREF="http://monoport.com/9842">http://monoport.com/9842</A>
</I>&gt;&gt;<i> *2 Timer or Form.Close() causes infinite loop <A HREF="http://monoport.com/9804">http://monoport.com/9804</A>
</I>&gt;&gt;<i> ... and it is not always reproducible.
</I>&gt;&gt;<i> *3 Form.set_Visible() causes infinite loop <A HREF="http://monoport.com/9806">http://monoport.com/9806</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Atsushi Eno
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-winforms-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">Mono-winforms-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-winforms-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">Mono-winforms-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: x11-map-unmap-wmshowwindow-appctx.patch
Type: text/x-patch
Size: 4977 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20080508/e19e31c2/attachment.bin">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20080508/e19e31c2/attachment.bin</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003358.html">[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage
</A></li>
	<LI>Next message: <A HREF="003360.html">[Mono-winforms-list] Can I run DevExpress applications under Mono on Linux?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3359">[ date ]</a>
              <a href="thread.html#3359">[ thread ]</a>
              <a href="subject.html#3359">[ subject ]</a>
              <a href="author.html#3359">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
