<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] RFC on winforms / XIM clientWindow fixage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20RFC%20on%20winforms%20/%20XIM%20clientWindow%20fixage&In-Reply-To=481833D0.9000505%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003357.html">
   <LINK REL="Next"  HREF="003359.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20RFC%20on%20winforms%20/%20XIM%20clientWindow%20fixage&In-Reply-To=481833D0.9000505%40ximian.com"
       TITLE="[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage">atsushi at ximian.com
       </A><BR>
    <I>Thu May  8 02:27:13 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003357.html">[Mono-winforms-list] SPAM-LOW:   Correct behaviour?
</A></li>
        <LI>Next message: <A HREF="003359.html">[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3358">[ date ]</a>
              <a href="thread.html#3358">[ thread ]</a>
              <a href="subject.html#3358">[ subject ]</a>
              <a href="author.html#3358">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

After fixing couple of issues, I found a fix for this WaitForHwndMessage()
issue. The situation is that (in some cases?) WM_SHOWWINDOW could be 
processed
synchronously inside SendMessage() and when we reach WaitForHwndMessage(),
the MSG is already consumed and hence never shows up.

The attached patch fixes this issue. I'm still not sure why this does not
happen when we don't create XIM context for each client window, but
the sample repro in my last mail[*1] gets fixed with this patch.

If it looks okay, I'll commit this small change. I'm still not going to 
commit
my XIM changes, as there are still pending fixes on bugzilla[*2] and there
seems another MDI issue that needs fix too.

Atsushi Eno

*1 <A HREF="http://monoport.com/9806">http://monoport.com/9806</A>
*2 #325033 and #387693


Atsushi Eno wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm posting it as I've been stuck with this issue for couple of days and
</I>&gt;<i> I still don't have a fix.
</I>&gt;<i>
</I>&gt;<i> Now I'm trying to fix XIM stuff to show up IM engine UI. Currently only
</I>&gt;<i> scim works (I tried scim-anthy). Everything else (as far as I tried,
</I>&gt;<i> iiimx/atokx3 and kinput2) do not work.
</I>&gt;<i>
</I>&gt;<i> It is (to my understanding) due to incorrect use of &quot;client window&quot; of the
</I>&gt;<i> input context (XIC). I fixed this issue with the patch [*1] but
</I>&gt;<i> it caused (or exposed) some regressions [*2][*3].
</I>&gt;<i>
</I>&gt;<i> My guess is that there are some issues around X event filtering (as
</I>&gt;<i> XplatUIX11.WaitForHwndMessage does not finish) but I don't know how it
</I>&gt;<i> could be fixed.
</I>&gt;<i>
</I>&gt;<i> I'll continue working on this issue but any help would be appreciated.
</I>&gt;<i>
</I>&gt;<i> *1 <A HREF="http://monoport.com/9842">http://monoport.com/9842</A>
</I>&gt;<i> *2 Timer or Form.Close() causes infinite loop <A HREF="http://monoport.com/9804">http://monoport.com/9804</A>
</I>&gt;<i> ... and it is not always reproducible.
</I>&gt;<i> *3 Form.set_Visible() causes infinite loop <A HREF="http://monoport.com/9806">http://monoport.com/9806</A>
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-winforms-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">Mono-winforms-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;<i>
</I>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: x11-unmap-wmshowwindow.patch
Type: text/x-patch
Size: 2660 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20080508/d86afddb/attachment.bin">http://lists.ximian.com/pipermail/mono-winforms-list/attachments/20080508/d86afddb/attachment.bin</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003357.html">[Mono-winforms-list] SPAM-LOW:   Correct behaviour?
</A></li>
	<LI>Next message: <A HREF="003359.html">[Mono-winforms-list] RFC on winforms / XIM clientWindow fixage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3358">[ date ]</a>
              <a href="thread.html#3358">[ thread ]</a>
              <a href="subject.html#3358">[ subject ]</a>
              <a href="author.html#3358">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
