<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] When will winforms be working?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:thunderbird2k%40gmx.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000612.html">
   <LINK REL="Next"  HREF="000617.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] When will winforms be working?
   </H1>
    <B>Roderick Colenbrander
    </B> 
    <A HREF="mailto:thunderbird2k%40gmx.net"
       TITLE="[Mono-winforms-list] When will winforms be working?">thunderbird2k@gmx.net
       </A><BR>
    <I>Thu, 19 Feb 2004 13:11:17 +0100 (MET)</I>
    <P><UL>
        <LI> Previous message: <A HREF="000612.html">[Mono-winforms-list] When will winforms be working?
</A></li>
        <LI> Next message: <A HREF="000617.html">[Mono-winforms-list] When will winforms be working?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#613">[ date ]</a>
              <a href="thread.html#613">[ thread ]</a>
              <a href="subject.html#613">[ subject ]</a>
              <a href="author.html#613">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If I understand it correctly you (Vlad) like the wine as a shared library
approach more than Peter's approach. Why not continue with Peter's approach?
Ofcourse it is nicer to use wine as a shared library but the other approach has
a huge advantage as that wine version is allmost the same as normal wine.
These days there are already various hybrid .net apps that for example use com
or various native windows dlls. With the new patch those hybrid apps should
be easy to get working (perhaps they already work out of the box).

Regards,
Roderick Colenbrander

&gt;<i> Vlad, please have a look at the patch I attached to my earlier message.
</I>&gt;<i> 
</I>&gt;<i> I did not pick/patch a particular part of wine, I simply prevented wine
</I>&gt;<i> &gt;from running WinMain and instead it returns control to the app that
</I>&gt;<i> called
</I>&gt;<i> wine_init. To take care of initialization without having to plow through
</I>&gt;<i> too much code I created a winelib binary that is used for a)
</I>&gt;<i> initialization of wine itself (passed to wine_init as argument) and b) to
</I>&gt;<i> actually do the initialization of wine (by calling wine_init)
</I>&gt;<i> 
</I>&gt;<i> I have not done extensive tests yet, but it seems to work. The advantage
</I>&gt;<i> is that I don't need to specifically recompile wine as a shared library;
</I>&gt;<i> it inherently is a shared library and this patch allows me to use it as
</I>&gt;<i> such. The same wine code will allow to run regular apps and mono.
</I>&gt;<i> 
</I>&gt;<i> I tried to coordinate with you, but by the time I got your first response
</I>&gt;<i> the patch was already finished; also tried your ICQ address, but you never
</I>&gt;<i> added me to your contact list.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i>   Peter
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: &quot;Vlad kaluzhny&quot; &lt;<A HREF="mailto:vkaluzhny@openlinksw.co.uk">vkaluzhny@openlinksw.co.uk</A>&gt;
</I>&gt;<i> To: &quot;Peter Dennis Bartok&quot; &lt;<A HREF="mailto:peter@novonyx.com">peter@novonyx.com</A>&gt;
</I>&gt;<i> Cc: &quot;M. Scott Ford&quot; &lt;<A HREF="mailto:vaderpi@scottandlaurie.com">vaderpi@scottandlaurie.com</A>&gt;; &quot;'Miguel de Icaza'&quot;
</I>&gt;<i> &lt;<A HREF="mailto:miguel@ximian.com">miguel@ximian.com</A>&gt;; &lt;<A HREF="mailto:mono-winforms-list@lists.ximian.com">mono-winforms-list@lists.ximian.com</A>&gt;
</I>&gt;<i> Date: 18 February, 2004 22:05
</I>&gt;<i> Subject: Re: [Mono-winforms-list] When will winforms be working?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi All.
</I>&gt;<i> 
</I>&gt;<i> Peter  It  definitely is not clear to me - which part of Wine are  you
</I>&gt;<i> patching?
</I>&gt;<i> And second - lets coordinate our efforts in patches writing,
</I>&gt;<i> otherwise we will duplicate  our work
</I>&gt;<i> 
</I>&gt;<i> I have already patched ntdll.dll and now working on kernel32.dll.......
</I>&gt;<i> 
</I>&gt;<i> Regards, Vlad
</I>&gt;<i> 
</I>&gt;<i> Peter Dennis Bartok wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Hi All,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry for having been so quiet. I was hoping I'd get all the changes
</I>&gt;<i> &gt; done and could just present a 'complete solution'. But I'm not quite
</I>&gt;<i> &gt; there yet.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The first patch is in CVS already, it's located under
</I>&gt;<i> &gt; mcs/class/System.Windows.Forms/wine-patch
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've also attached the patch and a readme.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Keep in mind that it's not complete yet. The patches will allow you to
</I>&gt;<i> &gt; use Wine as a shared library. Unlike the previous patch, where wine
</I>&gt;<i> &gt; itself was hacked up to be compiled either the traditional way or as a
</I>&gt;<i> &gt; shared library I tried to have a patch that could make it back to the
</I>&gt;<i> &gt; main wine repository. So the only actual changes to wine itself was
</I>&gt;<i> &gt; that I prevent wine from calling the WinMain of a passed-in winelib
</I>&gt;<i> &gt; executable, if the name of the executable is 'mono-winelib'.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Everything else is handled in the mono-winelib executable. It acts as
</I>&gt;<i> &gt; a winelib binary as well as the library that gets loaded to initialize
</I>&gt;<i> &gt; wine as a shared library. Simply dlopen() and import the
</I>&gt;<i> &gt; MonoWineInit() function and run it. That function in turn will
</I>&gt;<i> &gt; initialize wine and then return. At that point any caller should be
</I>&gt;<i> &gt; able to import and use any symbols/functions from wine.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Keep in mind that I have done only minimal testing with the approach
</I>&gt;<i> &gt; so far, since I still need to develop a second patch, to make the
</I>&gt;<i> &gt; x11drv coexist with cairo. It seems that there's some offscreen
</I>&gt;<i> &gt; caching happening in cairo and when wine draws on the screen cairo
</I>&gt;<i> &gt; isn't aware and 'overwrites' the wine changes. I'm still in the
</I>&gt;<i> &gt; process of debugging the issues, give me a few days more on that.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Check the readme that goes along with the patch for some symbolic
</I>&gt;<i> &gt; links that have to be created manually currently before the wine patch
</I>&gt;<i> &gt; can be used.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have also attached a patch that's not in CVS yet (mcs-0.30.patch)
</I>&gt;<i> &gt; which fixes up SWF to properly load the new wine library. Pathnames
</I>&gt;<i> &gt; are currently fixed to /usr/local/lib/wine. Once the hard problems are
</I>&gt;<i> &gt; worked out I'll take care of these things.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hope this wasn't too much detail. Please send me any feedback you may
</I>&gt;<i> &gt; have, but keep in mind that SWF (while it may start displaying windows
</I>&gt;<i> &gt; again) will still not work properly due to the cairo/x11drv issue (and
</I>&gt;<i> &gt; potentially some of the new work done in System.Drawing)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm also working on a roadmap for SWF itself, so that we can
</I>&gt;<i> &gt; coordinate work on the library, but I figure the basic framework
</I>&gt;<i> &gt; (Wine/Cairo/SWF) needs to be in working order first.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Cheers,
</I>&gt;<i> &gt;  Peter
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; M. Scott Ford wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Miguel,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks for the update. I remember seeing the Cairo/GDI+ conversation,
</I>&gt;<i> &gt;&gt; but I
</I>&gt;<i> &gt;&gt; had no idea that it had led to so many cool changes. WINE as a
</I>&gt;<i> &gt;&gt; library will
</I>&gt;<i> &gt;&gt; be great! Please let us know as soon as the changes are committed. I am
</I>&gt;<i> &gt;&gt; eager to start working. :)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Are there any other lists that we should be watching to keep up with
</I>&gt;<i> the
</I>&gt;<i> &gt;&gt; news?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks,
</I>&gt;<i> &gt;&gt; -Scott
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; -----Original Message-----
</I>&gt;<i> &gt;&gt; From: <A HREF="mailto:mono-winforms-list-admin@lists.ximian.com">mono-winforms-list-admin@lists.ximian.com</A>
</I>&gt;<i> &gt;&gt; [mailto:<A HREF="mailto:mono-winforms-list-admin@lists.ximian.com">mono-winforms-list-admin@lists.ximian.com</A>] On Behalf Of
</I>&gt;<i> &gt;&gt; Miguel de
</I>&gt;<i> &gt;&gt; Icaza
</I>&gt;<i> &gt;&gt; Sent: Wednesday, February 18, 2004 12:14 AM
</I>&gt;<i> &gt;&gt; To: Scott Ford
</I>&gt;<i> &gt;&gt; Cc: <A HREF="mailto:mono-winforms-list@lists.ximian.com">mono-winforms-list@lists.ximian.com</A>
</I>&gt;<i> &gt;&gt; Subject: RE: [Mono-winforms-list] When will winforms be working?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Hello,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; What are the problems? I have not really seen mention of any in this
</I>&gt;<i> &gt;&gt;&gt; list. If they are being discussed, where is the discussion taking
</I>&gt;<i> &gt;&gt;&gt; place?
</I>&gt;<i> &gt;&gt;&gt; I am sure that many of us are willing to help, but have no idea what
</I>&gt;<i> is
</I>&gt;<i> &gt;&gt;&gt; going on.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The short answer is &quot;soon&quot;.  The long answer is:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * When Peter was fixing the Wine/Cairo integration issues, he found
</I>&gt;<i> &gt;&gt;   a way of doing this cleanly: to build a driver that knows about
</I>&gt;<i> &gt;&gt;   Cairo/GDI+.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * When he started writing the driver, we noticed that our patches Wine
</I>&gt;<i> &gt;&gt;   was too old, and that the code we wrote would have to be discarded
</I>&gt;<i> &gt;&gt;   when we upgraded to Wine.  So...
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * Peter started working on porting/patching the latest Wine to work
</I>&gt;<i> &gt;&gt; as   a library.  Peter noticed that the new Wine requires even less
</I>&gt;<i> &gt;&gt; changes
</I>&gt;<i> &gt;&gt;   to turn into a library and found a fairly clever way of even being
</I>&gt;<i> &gt;&gt; able
</I>&gt;<i> &gt;&gt;   to turn Wine into a library and minimizing the changes.
</I>&gt;<i> &gt;&gt;   These are good news, because we might be able to merge the few
</I>&gt;<i> changes
</I>&gt;<i> &gt;&gt;   into the main Wine.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * We will be building packages of the modified Wine very soon now ;-)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; * Work on the C#-side of Windows.Forms will resume in a couple of days.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Miguel.
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Mono-winforms-list maillist  -  <A HREF="mailto:Mono-winforms-list@lists.ximian.com">Mono-winforms-list@lists.ximian.com</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Mono-winforms-list maillist  -  <A HREF="mailto:Mono-winforms-list@lists.ximian.com">Mono-winforms-list@lists.ximian.com</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;diff -ruN wine-20040121/configure wine-20040121-mono/configure
</I>&gt;<i> &gt;--- wine-20040121/configure 2004-01-21 18:02:29.000000000 -0700
</I>&gt;<i> &gt;+++ wine-20040121-mono/configure 2004-02-12 14:33:46.000000000 -0700
</I>&gt;<i> &gt;@@ -19070,7 +19070,7 @@
</I>&gt;<i> &gt; MAKE_PROG_RULES=programs/Makeprog.rules
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;-
</I>&gt;<i> 
</I>&gt;<i> ac_config_files=&quot;$ac_config_files Make.rules dlls/Makedll.rules
</I>&gt;<i> dlls/Maketest.rules libs/Makelib.rules programs/Makeprog.rules Makefile
</I>&gt;<i> dlls/Makefile dlls/advapi32/Makefile dlls/advapi32/tests/Makefile
</I>&gt;<i> dlls/avicap32/Makefile dlls/avifil32/Makefile dlls/cabinet/Makefile
</I>&gt;<i> dlls/capi2032/Makefile dlls/cfgmgr32/Makefile dlls/comcat/Makefile
</I>&gt;<i> dlls/comctl32/Makefile dlls/comctl32/tests/Makefile dlls/commdlg/Makefile
</I>&gt;<i> dlls/crtdll/Makefile dlls/crypt32/Makefile dlls/ctl3d/Makefile
</I>&gt;<i> dlls/wined3d/Makefile dlls/d3d8/Makefile dlls/d3d9/Makefile
</I>&gt;<i> dlls/d3dim/Makefile dlls/d3dx8/Makefile dlls/dciman32/Makefile
</I>&gt;<i> dlls/ddraw/Makefile dlls/ddraw/tests/Makefile dlls/devenum/Makefile
</I>&gt;<i> dlls/dinput/Makefile dlls/dinput8/Makefile dlls/dmband/Makefile
</I>&gt;<i> dlls/dmcompos/Makefile dlls/dmime/Makefile dlls/dmloader/Makefile
</I>&gt;<i> dlls/dmscript/Makefile dlls/dmstyle/Makefile dlls/dmsynth/Makefile
</I>&gt;<i> dlls/dmusic/Makefile dlls/dmusic32/Makefile dlls/dplay/Makefile
</I>&gt;<i> dlls/dplayx/Makefile dlls/dpnhpast/Makefile dlls/dsound/Makefile
</I>&gt;<i> dlls/dsound/tests/Makefile dlls/dswave/Makefile dlls/gdi/Makefile
</I>&gt;<i> dlls/gdi/tests/Makefile dlls/glu32/Makefile dlls/glut32/Makefile
</I>&gt;<i> dlls/iccvid/Makefile dlls/icmp/Makefile dlls/imagehlp/Makefile
</I>&gt;<i> dlls/imm32/Makefile dlls/iphlpapi/Makefile dlls/iphlpapi/tests/Makefile
</I>&gt;<i> dlls/kernel/Makefile dlls/kernel/tests/Makefile dlls/lzexpand/Makefile
</I>&gt;<i> dlls/mapi32/Makefile dlls/mpr/Makefile dlls/msacm/Makefile
</I>&gt;<i> dlls/msacm/imaadp32/Makefile dlls/msacm/msadp32/Makefile
</I>&gt;<i> dlls/msacm/msg711/Makefile dlls/msacm/winemp3/Makefile dlls/msdmo/Makefile
</I>&gt;<i> dlls/mshtml/Makefile dlls/msi/Makefile dlls/msimg32/Makefile
</I>&gt;<i> dlls/msisys/Makefile dlls/msnet32/Makefile dlls/msvcrt/Makefile
</I>&gt;<i> dlls/msvcrt/tests/Makefile dlls/msvcrt20/Makefile dlls/msvcrt40/Makefile
</I>&gt;<i> dlls/msvcrtd/Makefile dlls/msvideo/Makefile dlls/msvideo/msrle32/Makefile
</I>&gt;<i> dlls/mswsock/Makefile dlls/netapi32/Makefile dlls/netapi32/tests/Makefile
</I>&gt;<i> dlls/newdev/Makefile dlls/ntdll/Makefile dlls/ntdll/tests/Makefile
</I>&gt;<i> dlls/odbc32/Makefile dlls/ole32/Makefile dlls/oleacc/Makefile
</I>&gt;<i> dlls/oleaut32/Makefile dlls/oleaut32/tests/Makefile dlls/olecli/Makefile
</I>&gt;<i> dlls/oledlg/Makefile dlls/olepro32/Makefile dlls/olesvr/Makefile
</I>&gt;<i> dlls/opengl32/Makefile dlls/psapi/Makefile dlls/qcap/Makefile
</I>&gt;<i> dlls/quartz/Makefile dlls/rasapi32/Makefile dlls/richedit/Makefile
</I>&gt;<i> dlls/rpcrt4/Makefile dlls/rpcrt4/tests/Makefile dlls/serialui/Makefile
</I>&gt;<i> dlls/setupapi/Makefile dlls/shdocvw/Makefile dlls/shell32/Makefile
</I>&gt;<i> dlls/shell32/tests/Makefile dlls/shfolder/Makefile dlls/shlwapi/Makefile
</I>&gt;<i> dlls/shlwapi/tests/Makefile dlls/snmpapi/Makefile dlls/sti/Makefile
</I>&gt;<i> dlls/tapi32/Makefile dlls/ttydrv/Makefile dlls/twain/Makefile
</I>&gt;<i> dlls/unicows/Makefile dlls/url/Makefile dlls/urlmon/Makefile
</I>&gt;<i> dlls/urlmon/tests/Makefile dlls/user/Makefile dlls/user/tests/Makefile
</I>&gt;<i> dlls/uxtheme/Makefile dlls/version/Makefile dlls/win32s/Makefile
</I>&gt;<i> dlls/winaspi/Makefile dlls/winedos/Makefile dlls/wineps/Makefile
</I>&gt;<i> dlls/wininet/Makefile dlls/wininet/tests/Makefile dlls/winmm/Makefile
</I>&gt;<i> dlls/winmm/joystick/Makefile dlls/winmm/mcianim/Makefile
</I>&gt;<i> dlls/winmm/mciavi/Makefile dlls/winmm/mcicda/Makefile
</I>&gt;<i> dlls/winmm/mciseq/Makefile dlls/winmm/mciwave/Makefile
</I>&gt;<i> dlls/winmm/midimap/Makefile dlls/winmm/tests/Makefile
</I>&gt;<i> dlls/winmm/wavemap/Makefile dlls/winmm/winealsa/Makefile
</I>&gt;<i> dlls/winmm/winearts/Makefile dlls/winmm/wineaudioio/Makefile
</I>&gt;<i> dlls/winmm/winenas/Makefile dlls/winmm/winejack/Makefile
</I>&gt;<i> dlls/winmm/wineoss/Makefile dlls/winnls/Makefile dlls/winsock/Makefile
</I>&gt;<i> dlls/winsock/tests/Makefile dlls/winspool/Makefile
</I>&gt;<i> dlls/winspool/tests/Makefile dlls/wintab32/Makefile dlls/wintrust/Makefile
</I>&gt;<i> dlls/wow32/Makefile dlls/wsock32/Makefile dlls/x11drv/Makefile
</I>&gt;<i> documentation/Makefile include/Makefile libs/Makefile libs/port/Makefile
</I>&gt;<i> libs/unicode/Makefile libs/uuid/Makefile libs/wine/Makefile
</I>&gt;<i> libs/wpp/Makefile loader/Makefile programs/Makefile
</I>&gt;<i> programs/avitools/Makefile programs/clock/Makefile
</I>&gt;<i> programs/cmdlgtst/Makefile programs/control/Makefile
</I>&gt;<i> programs/expand/Makefile programs/notepad/Makefile
</I>&gt;<i> programs/progman/Makefile programs/regedit/Makefile
</I>&gt;<i> programs/regsvr32/Makefile programs/rpcss/Makefile
</I>&gt;<i> programs/rundll32/Makefile programs/start/Makefile
</I>&gt;<i> programs/uninstaller/Makefile programs/view/Makefile
</I>&gt;<i> programs/wcmd/Makefile programs/wineboot/Makefile
</I>&gt;<i> programs/winebrowser/Makefile programs/winecfg/Makefile
</I>&gt;<i> programs/wineconsole/Makefile programs/winedbg/Makefile
</I>&gt;<i> programs/winefile/Makefile programs/winemenubuilder/Makefile
</I>&gt;<i> programs/winemine/Makefile programs/winepath/Makefile
</I>&gt;<i> programs/winetest/Makefile programs/winevdm/Makefile
</I>&gt;<i> programs/winhelp/Makefile programs/winver/Makefile server/Makefile
</I>&gt;<i> tools/Makefile tools/widl/Makefile tools/winapi/Makefile
</I>&gt;<i> tools/winebuild/Makefile tools/winedump/Makefile tools/winegcc/Makefile
</I>&gt;<i> tools/wmc/Makefile tools/wrc/Makefile&quot;
</I>&gt;<i> &gt;+
</I>&gt;<i> 
</I>&gt;<i> ac_config_files=&quot;$ac_config_files Make.rules dlls/Makedll.rules
</I>&gt;<i> dlls/Maketest.rules libs/Makelib.rules programs/Makeprog.rules Makefile
</I>&gt;<i> dlls/Makefile dlls/advapi32/Makefile dlls/advapi32/tests/Makefile
</I>&gt;<i> dlls/avicap32/Makefile dlls/avifil32/Makefile dlls/cabinet/Makefile
</I>&gt;<i> dlls/capi2032/Makefile dlls/cfgmgr32/Makefile dlls/comcat/Makefile
</I>&gt;<i> dlls/comctl32/Makefile dlls/comctl32/tests/Makefile dlls/commdlg/Makefile
</I>&gt;<i> dlls/crtdll/Makefile dlls/crypt32/Makefile dlls/ctl3d/Makefile
</I>&gt;<i> dlls/wined3d/Makefile dlls/d3d8/Makefile dlls/d3d9/Makefile
</I>&gt;<i> dlls/d3dim/Makefile dlls/d3dx8/Makefile dlls/dciman32/Makefile
</I>&gt;<i> dlls/ddraw/Makefile dlls/ddraw/tests/Makefile dlls/devenum/Makefile
</I>&gt;<i> dlls/dinput/Makefile dlls/dinput8/Makefile dlls/dmband/Makefile
</I>&gt;<i> dlls/dmcompos/Makefile dlls/dmime/Makefile dlls/dmloader/Makefile
</I>&gt;<i> dlls/dmscript/Makefile dlls/dmstyle/Makefile dlls/dmsynth/Makefile
</I>&gt;<i> dlls/dmusic/Makefile dlls/dmusic32/Makefile dlls/dplay/Makefile
</I>&gt;<i> dlls/dplayx/Makefile dlls/dpnhpast/Makefile dlls/dsound/Makefile
</I>&gt;<i> dlls/dsound/tests/Makefile dlls/dswave/Makefile dlls/gdi/Makefile
</I>&gt;<i> dlls/gdi/tests/Makefile dlls/glu32/Makefile dlls/glut32/Makefile
</I>&gt;<i> dlls/iccvid/Makefile dlls/icmp/Makefile dlls/imagehlp/Makefile
</I>&gt;<i> dlls/imm32/Makefile dlls/iphlpapi/Makefile dlls/iphlpapi/tests/Makefile
</I>&gt;<i> dlls/kernel/Makefile dlls/kernel/tests/Makefile dlls/lzexpand/Makefile
</I>&gt;<i> dlls/mapi32/Makefile dlls/mpr/Makefile dlls/msacm/Makefile
</I>&gt;<i> dlls/msacm/imaadp32/Makefile dlls/msacm/msadp32/Makefile
</I>&gt;<i> dlls/msacm/msg711/Makefile dlls/msacm/winemp3/Makefile dlls/msdmo/Makefile
</I>&gt;<i> dlls/mshtml/Makefile dlls/msi/Makefile dlls/msimg32/Makefile
</I>&gt;<i> dlls/msisys/Makefile dlls/msnet32/Makefile dlls/msvcrt/Makefile
</I>&gt;<i> dlls/msvcrt/tests/Makefile dlls/msvcrt20/Makefile dlls/msvcrt40/Makefile
</I>&gt;<i> dlls/msvcrtd/Makefile dlls/msvideo/Makefile dlls/msvideo/msrle32/Makefile
</I>&gt;<i> dlls/mswsock/Makefile dlls/netapi32/Makefile dlls/netapi32/tests/Makefile
</I>&gt;<i> dlls/newdev/Makefile dlls/ntdll/Makefile dlls/ntdll/tests/Makefile
</I>&gt;<i> dlls/odbc32/Makefile dlls/ole32/Makefile dlls/oleacc/Makefile
</I>&gt;<i> dlls/oleaut32/Makefile dlls/oleaut32/tests/Makefile dlls/olecli/Makefile
</I>&gt;<i> dlls/oledlg/Makefile dlls/olepro32/Makefile dlls/olesvr/Makefile
</I>&gt;<i> dlls/opengl32/Makefile dlls/psapi/Makefile dlls/qcap/Makefile
</I>&gt;<i> dlls/quartz/Makefile dlls/rasapi32/Makefile dlls/richedit/Makefile
</I>&gt;<i> dlls/rpcrt4/Makefile dlls/rpcrt4/tests/Makefile dlls/serialui/Makefile
</I>&gt;<i> dlls/setupapi/Makefile dlls/shdocvw/Makefile dlls/shell32/Makefile
</I>&gt;<i> dlls/shell32/tests/Makefile dlls/shfolder/Makefile dlls/shlwapi/Makefile
</I>&gt;<i> dlls/shlwapi/tests/Makefile dlls/snmpapi/Makefile dlls/sti/Makefile
</I>&gt;<i> dlls/tapi32/Makefile dlls/ttydrv/Makefile dlls/twain/Makefile
</I>&gt;<i> dlls/unicows/Makefile dlls/url/Makefile dlls/urlmon/Makefile
</I>&gt;<i> dlls/urlmon/tests/Makefile dlls/user/Makefile dlls/user/tests/Makefile
</I>&gt;<i> dlls/uxtheme/Makefile dlls/version/Makefile dlls/win32s/Makefile
</I>&gt;<i> dlls/winaspi/Makefile dlls/winedos/Makefile dlls/wineps/Makefile
</I>&gt;<i> dlls/wininet/Makefile dlls/wininet/tests/Makefile dlls/winmm/Makefile
</I>&gt;<i> dlls/winmm/joystick/Makefile dlls/winmm/mcianim/Makefile
</I>&gt;<i> dlls/winmm/mciavi/Makefile dlls/winmm/mcicda/Makefile
</I>&gt;<i> dlls/winmm/mciseq/Makefile dlls/winmm/mciwave/Makefile
</I>&gt;<i> dlls/winmm/midimap/Makefile dlls/winmm/tests/Makefile
</I>&gt;<i> dlls/winmm/wavemap/Makefile dlls/winmm/winealsa/Makefile
</I>&gt;<i> dlls/winmm/winearts/Makefile dlls/winmm/wineaudioio/Makefile
</I>&gt;<i> dlls/winmm/winenas/Makefile dlls/winmm/winejack/Makefile
</I>&gt;<i> dlls/winmm/wineoss/Makefile dlls/winnls/Makefile dlls/winsock/Makefile
</I>&gt;<i> dlls/winsock/tests/Makefile dlls/winspool/Makefile
</I>&gt;<i> dlls/winspool/tests/Makefile dlls/wintab32/Makefile dlls/wintrust/Makefile
</I>&gt;<i> dlls/wow32/Makefile dlls/wsock32/Makefile dlls/x11drv/Makefile
</I>&gt;<i> documentation/Makefile include/Makefile libs/Makefile libs/port/Makefile
</I>&gt;<i> libs/unicode/Makefile libs/uuid/Makefile libs/wine/Makefile
</I>&gt;<i> libs/wpp/Makefile loader/Makefile programs/Makefile
</I>&gt;<i> programs/avitools/Makefile programs/clock/Makefile
</I>&gt;<i> programs/cmdlgtst/Makefile programs/control/Makefile
</I>&gt;<i> programs/expand/Makefile programs/mono-winelib/Makefile
</I>&gt;<i> programs/notepad/Makefile programs/progman/Makefile
</I>&gt;<i> programs/regedit/Makefile programs/regsvr32/Makefile
</I>&gt;<i> programs/rpcss/Makefile programs/rundll32/Makefile programs/start/Makefile
</I>&gt;<i> programs/uninstaller/Makefile programs/view/Makefile
</I>&gt;<i> programs/wcmd/Makefile programs/wineboot/Makefile
</I>&gt;<i> programs/winebrowser/Makefile programs/winecfg/Makefile
</I>&gt;<i> programs/wineconsole/Makefile programs/winedbg/Makefile
</I>&gt;<i> programs/winefile/Makefile programs/winemenubuilder/Makefile
</I>&gt;<i> programs/winemine/Makefile programs/winepath/Makefile
</I>&gt;<i> programs/winetest/Makefile programs/winevdm/Makefile
</I>&gt;<i> programs/winhelp/Makefile programs/winver/Makefile server/Makefile
</I>&gt;<i> tools/Makefile tools/widl/Makefile tools/winapi/Makefile
</I>&gt;<i> tools/winebuild/Makefile tools/winedump/Makefile tools/winegcc/Makefile
</I>&gt;<i> tools/wmc/Makefile tools/wrc/Makefile&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; cat &gt;confcache &lt;&lt;\_ACEOF
</I>&gt;<i> &gt;@@ -19772,6 +19772,7 @@
</I>&gt;<i> &gt;   &quot;programs/cmdlgtst/Makefile&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES
</I>&gt;<i> programs/cmdlgtst/Makefile&quot; ;;
</I>&gt;<i> &gt;   &quot;programs/control/Makefile&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES
</I>&gt;<i> programs/control/Makefile&quot; ;;
</I>&gt;<i> &gt;   &quot;programs/expand/Makefile&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES
</I>&gt;<i> programs/expand/Makefile&quot; ;;
</I>&gt;<i> &gt;+  &quot;programs/mono-winelib/Makefile&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES
</I>&gt;<i> programs/mono-winelib/Makefile&quot; ;;
</I>&gt;<i> &gt;   &quot;programs/notepad/Makefile&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES
</I>&gt;<i> programs/notepad/Makefile&quot; ;;
</I>&gt;<i> &gt;   &quot;programs/progman/Makefile&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES
</I>&gt;<i> programs/progman/Makefile&quot; ;;
</I>&gt;<i> &gt;   &quot;programs/regedit/Makefile&quot; ) CONFIG_FILES=&quot;$CONFIG_FILES
</I>&gt;<i> programs/regedit/Makefile&quot; ;;
</I>&gt;<i> &gt;diff -ruN wine-20040121/dlls/kernel/process.c
</I>&gt;<i> wine-20040121-mono/dlls/kernel/process.c
</I>&gt;<i> &gt;--- wine-20040121/dlls/kernel/process.c 2004-01-20
</I>&gt;<i> 14:51:27.000000000 -0700
</I>&gt;<i> &gt;+++ wine-20040121-mono/dlls/kernel/process.c 2004-02-13
</I>&gt;<i> 15:14:40.000000000 -0700
</I>&gt;<i> &gt;@@ -752,8 +752,12 @@
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         SetLastError( 0 );  /* clear error code */
</I>&gt;<i> &gt;         if (peb-&gt;BeingDebugged) DbgBreakPoint();
</I>&gt;<i> &gt;-        ExitProcess( entry( peb ) );
</I>&gt;<i> &gt;+        if (__wine_main_argc!=1 || !(__wine_main_argc==1 &amp;&amp;
</I>&gt;<i> strlen(__wine_main_argv[0])&gt;=19 &amp;&amp;
</I>&gt;<i> strncasecmp(__wine_main_argv[0]+strlen(__wine_main_argv[0])-19,
</I>&gt;<i> &quot;mono-winelib.exe.so&quot;, 19)==0)) {
</I>&gt;<i> &gt;+            // This starts the main app and then exits wine
</I>&gt;<i> &gt;+            ExitProcess( entry( peb ) );
</I>&gt;<i> &gt;+        }
</I>&gt;<i> &gt;     }
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;     __EXCEPT(UnhandledExceptionFilter)
</I>&gt;<i> &gt;     {
</I>&gt;<i> &gt;         TerminateThread( GetCurrentThread(), GetExceptionCode() );
</I>&gt;<i> &gt;@@ -897,7 +901,16 @@
</I>&gt;<i> &gt;     if (!THREAD_InitStack( NtCurrentTeb(), stack_size )) goto error;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     /* switch to the new stack */
</I>&gt;<i> &gt;-    wine_switch_to_stack( start_process, NULL,
</I>&gt;<i> NtCurrentTeb()-&gt;Tib.StackBase );
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+    if (__wine_main_argc==1 &amp;&amp; strlen(__wine_main_argv[0])&gt;=19 &amp;&amp;
</I>&gt;<i> strncasecmp(__wine_main_argv[0]+strlen(__wine_main_argv[0])-19,
</I>&gt;<i> &quot;mono-winelib.exe.so&quot;, 19)==0) {
</I>&gt;<i> &gt;+        /* We don't want a new stack. Screws up our return path */
</I>&gt;<i> &gt;+        start_process(NULL);
</I>&gt;<i> &gt;+    } else {
</I>&gt;<i> &gt;+        /* Regular wine startup */
</I>&gt;<i> &gt;+        wine_switch_to_stack( start_process, NULL,
</I>&gt;<i> NtCurrentTeb()-&gt;Tib.StackBase );
</I>&gt;<i> &gt;+    }
</I>&gt;<i> &gt;+    return;
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  error:
</I>&gt;<i> &gt;     ExitProcess( GetLastError() );
</I>&gt;<i> &gt;diff -ruN wine-20040121/dlls/ntdll/loader.c
</I>&gt;<i> wine-20040121-mono/dlls/ntdll/loader.c
</I>&gt;<i> &gt;--- wine-20040121/dlls/ntdll/loader.c 2004-01-07 20:36:53.000000000 -0700
</I>&gt;<i> &gt;+++ wine-20040121-mono/dlls/ntdll/loader.c 2004-02-13
</I>&gt;<i> 15:17:45.000000000 -0700
</I>&gt;<i> &gt;@@ -1955,7 +1955,9 @@
</I>&gt;<i> &gt;     WINE_MODREF *wm;
</I>&gt;<i> &gt;     NTSTATUS status;
</I>&gt;<i> &gt;     ANSI_STRING func_name;
</I>&gt;<i> &gt;-    void (* DECLSPEC_NORETURN init_func)();
</I>&gt;<i> &gt;+    /* We might return for shared-lib startup */
</I>&gt;<i> &gt;+    /* void (* DECLSPEC_NORETURN init_func)(); */
</I>&gt;<i> &gt;+    void (* init_func)();
</I>&gt;<i> &gt;     extern void __wine_dbg_ntdll_init(void);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     thread_init();
</I>&gt;<i> &gt;diff -ruN wine-20040121/programs/Makefile.in
</I>&gt;<i> wine-20040121-mono/programs/Makefile.in
</I>&gt;<i> &gt;--- wine-20040121/programs/Makefile.in 2004-01-06
</I>&gt;<i> 13:49:59.000000000 -0700
</I>&gt;<i> &gt;+++ wine-20040121-mono/programs/Makefile.in 2004-02-12
</I>&gt;<i> 14:32:58.000000000 -0700
</I>&gt;<i> &gt;@@ -11,6 +11,7 @@
</I>&gt;<i> &gt; cmdlgtst \
</I>&gt;<i> &gt; control \
</I>&gt;<i> &gt; expand \
</I>&gt;<i> &gt;+ mono-winelib \
</I>&gt;<i> &gt; notepad \
</I>&gt;<i> &gt; progman \
</I>&gt;<i> &gt; regedit \
</I>&gt;<i> &gt;@@ -41,6 +42,7 @@
</I>&gt;<i> &gt; clock \
</I>&gt;<i> &gt; control \
</I>&gt;<i> &gt; expand \
</I>&gt;<i> &gt;+ mono-winelib \
</I>&gt;<i> &gt; notepad \
</I>&gt;<i> &gt; progman \
</I>&gt;<i> &gt; regedit \
</I>&gt;<i> &gt;@@ -179,6 +181,9 @@
</I>&gt;<i> &gt; icinfo.exe$(DLLEXT): avitools/icinfo.exe$(DLLEXT)
</I>&gt;<i> &gt; $(RM) $@ &amp;&amp; $(LN_S) avitools/icinfo.exe$(DLLEXT) $@
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;+mono-winelib.exe$(DLLEXT): mono-winelib/mono-winelib.exe$(DLLEXT)
</I>&gt;<i> &gt;+ $(RM) $@ &amp;&amp; $(LN_S) mono-winelib/mono-winelib.exe$(DLLEXT) $@
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt; notepad.exe$(DLLEXT): notepad/notepad.exe$(DLLEXT)
</I>&gt;<i> &gt; $(RM) $@ &amp;&amp; $(LN_S) notepad/notepad.exe$(DLLEXT) $@
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;@@ -255,6 +260,7 @@
</I>&gt;<i> &gt; control/control.exe$(DLLEXT): control
</I>&gt;<i> &gt; expand/expand.exe$(DLLEXT): expand
</I>&gt;<i> &gt; avitools/icinfo.exe$(DLLEXT): avitools
</I>&gt;<i> &gt;+mono-winelib/mono-winelib.exe$(DLLEXT): mono-winelib
</I>&gt;<i> &gt; notepad/notepad.exe$(DLLEXT): notepad
</I>&gt;<i> &gt; progman/progman.exe$(DLLEXT): progman
</I>&gt;<i> &gt; regedit/regedit.exe$(DLLEXT): regedit
</I>&gt;<i> &gt;diff -ruN wine-20040121/programs/mono-winelib/Makefile.in
</I>&gt;<i> wine-20040121-mono/programs/mono-winelib/Makefile.in
</I>&gt;<i> &gt;--- wine-20040121/programs/mono-winelib/Makefile.in 1969-12-31
</I>&gt;<i> 17:00:00.000000000 -0700
</I>&gt;<i> &gt;+++ wine-20040121-mono/programs/mono-winelib/Makefile.in 2004-02-12
</I>&gt;<i> 14:36:36.000000000 -0700
</I>&gt;<i> &gt;@@ -0,0 +1,26 @@
</I>&gt;<i> &gt;+TOPSRCDIR = @top_srcdir@
</I>&gt;<i> &gt;+TOPOBJDIR = ../..
</I>&gt;<i> &gt;+SRCDIR    = @srcdir@
</I>&gt;<i> &gt;+VPATH     = @srcdir@
</I>&gt;<i> &gt;+MODULE    = mono-winelib.exe
</I>&gt;<i> &gt;+APPMODE   = gui
</I>&gt;<i> &gt;+IMPORTS   = kernel32
</I>&gt;<i> &gt;+DELAYIMPORTS = user32
</I>&gt;<i> &gt;+EXTRAINCL =
</I>&gt;<i> &gt;+EXTRADEFS =
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+C_SRCS = \
</I>&gt;<i> &gt;+ mono-winelib.c \
</I>&gt;<i> &gt;+ ../../loader/pthread.c
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+RC_SRCS =
</I>&gt;<i> &gt;+RC_BINSRC =
</I>&gt;<i> &gt;+RC_BINARIES =
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+PLTESTS =
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+EXTRASUBDIRS =
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;<A HREF="mailto:+@MAKE_PROG_RULES">+@MAKE_PROG_RULES</A>@
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+### Dependencies:
</I>&gt;<i> &gt;diff -ruN wine-20040121/programs/mono-winelib/mono-winelib.c
</I>&gt;<i> wine-20040121-mono/programs/mono-winelib/mono-winelib.c
</I>&gt;<i> &gt;--- wine-20040121/programs/mono-winelib/mono-winelib.c 1969-12-31
</I>&gt;<i> 17:00:00.000000000 -0700
</I>&gt;<i> &gt;+++ wine-20040121-mono/programs/mono-winelib/mono-winelib.c 2004-02-13
</I>&gt;<i> 14:52:52.000000000 -0700
</I>&gt;<i> &gt;@@ -0,0 +1,86 @@
</I>&gt;<i> &gt;+/*
</I>&gt;<i> &gt;+ * mono-winelib code
</I>&gt;<i> &gt;+ *
</I>&gt;<i> &gt;+ * Copyright 2004 Novell, Inc. (<A HREF="http://www.novell.com/">http://www.novell.com/</A>)
</I>&gt;<i> &gt;+ *
</I>&gt;<i> &gt;+ * This library is free software; you can redistribute it and/or
</I>&gt;<i> &gt;+ * modify it under the terms of the GNU Lesser General Public
</I>&gt;<i> &gt;+ * License as published by the Free Software Foundation; either
</I>&gt;<i> &gt;+ * version 2.1 of the License, or (at your option) any later version.
</I>&gt;<i> &gt;+ *
</I>&gt;<i> &gt;+ * This library is distributed in the hope that it will be useful,
</I>&gt;<i> &gt;+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
</I>&gt;<i> &gt;+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
</I>&gt;<i> &gt;+ * Lesser General Public License for more details.
</I>&gt;<i> &gt;+ *
</I>&gt;<i> &gt;+ * You should have received a copy of the GNU Lesser General Public
</I>&gt;<i> &gt;+ * License along with this library; if not, write to the Free Software
</I>&gt;<i> &gt;+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307
</I>&gt;<i> USA
</I>&gt;<i> &gt;+ */
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+#include &lt;wine/library.h&gt;
</I>&gt;<i> &gt;+#include &lt;windows.h&gt;
</I>&gt;<i> &gt;+#include &lt;winsock.h&gt;
</I>&gt;<i> &gt;+#include &lt;dlfcn.h&gt;
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+/*
</I>&gt;<i> &gt;+ Dummy WinMain. Wine is modified so that this function is never actually
</I>&gt;<i> called
</I>&gt;<i> &gt;+*/
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+int WINAPI
</I>&gt;<i> &gt;+WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpszCmdLine,
</I>&gt;<i> int nCmdShow)
</I>&gt;<i> &gt;+{
</I>&gt;<i> &gt;+ int dummy;
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+   dummy=GetSystemMetrics(SM_CXSCREEN);
</I>&gt;<i> &gt;+ wine_pthread_init_process(NULL);
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+   return(0);
</I>&gt;<i> &gt;+}
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+/*
</I>&gt;<i> &gt;+ WineLoadLibrary is used by System.Windows.Forms to import the Wine dlls
</I>&gt;<i> &gt;+*/
</I>&gt;<i> &gt;+void *(*NTDLL_LoadLibraryA)(unsigned char *);
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+void *
</I>&gt;<i> &gt;+WineLoadLibrary(unsigned char *dll)
</I>&gt;<i> &gt;+{
</I>&gt;<i> &gt;+   return(NTDLL_LoadLibraryA(dll));
</I>&gt;<i> &gt;+}
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+/*
</I>&gt;<i> &gt;+ MonoWineInit() Must be called to initialize wine. We pass special
</I>&gt;<i> arguments
</I>&gt;<i> &gt;+ which will tell wine to not actually run the specified
</I>&gt;<i> &gt;+ application
</I>&gt;<i> &gt;+*/
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+int
</I>&gt;<i> &gt;+MonoWineInit(void)
</I>&gt;<i> &gt;+{
</I>&gt;<i> &gt;+ unsigned char Error[1024]=&quot;&quot;;
</I>&gt;<i> &gt;+ char *WineArguments[] = {&quot;monoapp&quot;,
</I>&gt;<i> &quot;/usr/local/lib/wine/mono-winelib.exe.so&quot;, NULL};
</I>&gt;<i> &gt;+ void *hModule;
</I>&gt;<i> &gt;+ int FileExists;
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+ wine_init(2, WineArguments, Error, sizeof(Error));
</I>&gt;<i> &gt;+ if (Error[0]!='\0') {
</I>&gt;<i> &gt;+ printf(&quot;Wine initialization error:%s\n&quot;, Error);
</I>&gt;<i> &gt;+ exit(-1);
</I>&gt;<i> &gt;+ }
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+   /* Now load kernel32 go get the pointers for LoadLibraryA and
</I>&gt;<i> GetProcAddress */
</I>&gt;<i> &gt;+   hModule=wine_dll_load(&quot;kernel32.dll&quot;, Error, sizeof(Error),
</I>&gt;<i> &amp;FileExists);
</I>&gt;<i> &gt;+   if (hModule==NULL) {
</I>&gt;<i> &gt;+      printf(&quot;Error loading kernel32.dll: %s\n&quot;, Error);
</I>&gt;<i> &gt;+      exit(-2);
</I>&gt;<i> &gt;+   }
</I>&gt;<i> &gt;+
</I>&gt;<i> &gt;+   NTDLL_LoadLibraryA=dlsym(hModule, &quot;LoadLibraryA&quot;);
</I>&gt;<i> &gt;+   if (NTDLL_LoadLibraryA==NULL) {
</I>&gt;<i> &gt;+      printf(&quot;Did not find symbol LoadLibraryA in kernel32.dll\n&quot;);
</I>&gt;<i> &gt;+      exit(-3);
</I>&gt;<i> &gt;+   }
</I>&gt;<i> &gt;+}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;System.Windows.Forms wine-patch README
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;After applying the patch to wine, run ./configure in the wine directory
</I>&gt;<i> and
</I>&gt;<i> &gt;'make &amp;&amp; make depend &amp;&amp; make install'.
</I>&gt;<i> &gt;For now the patch assumes that the prefix_dir is /usr/local.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Also, once the install is done you will need to create symbolic links for
</I>&gt;<i> &gt;all the dlls you plan on using in System.Windows.Forms:
</I>&gt;<i> &gt;ln -s /usr/local/lib/wine/kernel32.dll.so
</I>&gt;<i> /usr/local/lib/libkernel32.dll.so
</I>&gt;<i> &gt;ln -s /usr/local/lib/wine/user32.dll.so /usr/local/lib/libuser32.dll.so
</I>&gt;<i> &gt;ln -s /usr/local/lib/wine/gdi32.dll.so /usr/local/lib/libgdi32.dll.so
</I>&gt;<i> &gt;ln -s /usr/local/lib/wine/advapi32.dll.so /usr/local/lib/libgdi32.dll.so
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I still need to work out how to teach mono to load the libs from the wine
</I>&gt;<i> &gt;directory and without the lib prefix.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Peter
</I>&gt;<i> &gt;<A HREF="mailto:pbartok@novell.com">pbartok@novell.com</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;--- 
</I>&gt;<i> mcs-0.29/class/System.Windows.Forms/System.Windows.Forms/win32functions.cs
</I>&gt;<i> 2003-11-12 03:16:24.000000000 -0700
</I>&gt;<i> &gt;+++ mcs/class/System.Windows.Forms/System.Windows.Forms/win32functions.cs
</I>&gt;<i> 2004-02-12 16:47:29.000000000 -0700
</I>&gt;<i> &gt;@@ -1288,12 +1288,8 @@
</I>&gt;<i> &gt; return 0;
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;-
</I>&gt;<i> &gt;- [DllImport (&quot;libwinnt.dll.so&quot;, EntryPoint=&quot;PROCESS_InitWine&quot;)]
</I>&gt;<i> &gt;- extern static void PROCESS_InitWine (int argc, string [] args);
</I>&gt;<i> &gt;-
</I>&gt;<i> &gt;- [DllImport (&quot;libwinnt.dll.so&quot;, EntryPoint=&quot;LoadLibraryA&quot;)]
</I>&gt;<i> &gt;- extern static void NTDLL_LoadLibraryA (string s);
</I>&gt;<i> &gt;+ [DllImport (&quot;/usr/local/lib/wine/mono-winelib.exe.so&quot;,
</I>&gt;<i> EntryPoint=&quot;WineLoadLibrary&quot;)]
</I>&gt;<i> &gt;+ extern static void WineLoadLibrary(string s);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; static string[] WinColors = {
</I>&gt;<i> &gt; &quot;COLOR_SCROLLBAR&quot;,
</I>&gt;<i> &gt;@@ -1389,14 +1385,12 @@
</I>&gt;<i> &gt; Console.WriteLine (&quot;MonoWin32: Needs Wine MonoStub&quot;);
</I>&gt;<i> &gt; return;
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;-
</I>&gt;<i> &gt;- string [] args = new string [1];
</I>&gt;<i> &gt;- args [0] = &quot;mono&quot;;
</I>&gt;<i> &gt;-
</I>&gt;<i> &gt;- PROCESS_InitWine (0, args);
</I>&gt;<i> &gt;- NTDLL_LoadLibraryA (&quot;kernel32.dll&quot;);
</I>&gt;<i> &gt;- NTDLL_LoadLibraryA (&quot;user32.dll&quot;);
</I>&gt;<i> &gt;- NTDLL_LoadLibraryA (&quot;comctl32.dll&quot;);
</I>&gt;<i> &gt;+ Console.WriteLine(&quot;Loading Wine dlls&quot;);
</I>&gt;<i> &gt;+ WineLoadLibrary(&quot;gdi32.dll&quot;);
</I>&gt;<i> &gt;+ WineLoadLibrary(&quot;kernel32.dll&quot;);
</I>&gt;<i> &gt;+ WineLoadLibrary(&quot;comctl32.dll&quot;);
</I>&gt;<i> &gt;+ WineLoadLibrary(&quot;user32.dll&quot;);
</I>&gt;<i> &gt;+ Console.WriteLine(&quot;Loading Wine dlls complete&quot;);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; string gtk_colors = Environment.GetEnvironmentVariable
</I>&gt;<i> (&quot;SWF_GTK_COLORS&quot;);
</I>&gt;<i> &gt; if (gtk_colors == &quot;1&quot;) {
</I>&gt;<i> &gt;--- mcs-0.29/class/System.Windows.Forms/System.Windows.Forms/Form.cs
</I>&gt;<i> 2003-11-14 21:25:32.000000000 -0700
</I>&gt;<i> &gt;+++ mcs/class/System.Windows.Forms/System.Windows.Forms/Form.cs
</I>&gt;<i> 2004-02-13 11:59:08.000000000 -0700
</I>&gt;<i> &gt;@@ -105,8 +105,13 @@
</I>&gt;<i> &gt; cancelButton = null;
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;- static Form () {
</I>&gt;<i> &gt;+   // Initialization for Wine
</I>&gt;<i> &gt;+ [DllImport (&quot;/usr/local/lib/wine/mono-winelib.exe.so&quot;,
</I>&gt;<i> EntryPoint=&quot;MonoWineInit&quot;)]
</I>&gt;<i> &gt;+ extern static int MonoWineInit();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;+ static Form () {
</I>&gt;<i> &gt;+            Console.WriteLine(&quot;Initializing wine\n&quot;);
</I>&gt;<i> &gt;+            MonoWineInit();
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; //  --- Public Properties
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-winforms-list maillist  -  <A HREF="mailto:Mono-winforms-list@lists.ximian.com">Mono-winforms-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;<i> 
</I>
-- 
GMX ProMail (250 MB Mailbox, 50 FreeSMS, Virenschutz, 2,99 EUR/Monat...)
jetzt 3 Monate GRATIS + 3x DER SPIEGEL +++ <A HREF="http://www.gmx.net/derspiegel">http://www.gmx.net/derspiegel</A> +++


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000612.html">[Mono-winforms-list] When will winforms be working?
</A></li>
	<LI> Next message: <A HREF="000617.html">[Mono-winforms-list] When will winforms be working?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#613">[ date ]</a>
              <a href="thread.html#613">[ thread ]</a>
              <a href="subject.html#613">[ subject ]</a>
              <a href="author.html#613">[ author ]</a>
         </LI>
       </UL>
</body></html>
