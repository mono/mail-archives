<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] Bugzilla isn't working,	so I'm posting this bug report for MWF
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Bugzilla%20isn%27t%20working%2C%0A%09so%20I%27m%20posting%20this%20bug%20report%20for%20MWF&In-Reply-To=3631309046089500923%40unknownmsgid">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002392.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] Bugzilla isn't working,	so I'm posting this bug report for MWF</H1>
    <B>Rafael Teixeira</B> 
    <A HREF="mailto:mono-winforms-list%40lists.ximian.com?Subject=%5BMono-winforms-list%5D%20Bugzilla%20isn%27t%20working%2C%0A%09so%20I%27m%20posting%20this%20bug%20report%20for%20MWF&In-Reply-To=3631309046089500923%40unknownmsgid"
       TITLE="[Mono-winforms-list] Bugzilla isn't working,	so I'm posting this bug report for MWF">monoman at gmail.com
       </A><BR>
    <I>Fri Jun 30 09:46:13 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002392.html">[Mono-winforms-list] MWF2 Enumeration Changes
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2396">[ date ]</a>
              <a href="thread.html#2396">[ thread ]</a>
              <a href="subject.html#2396">[ subject ]</a>
              <a href="author.html#2396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>People here in Brazil is experiencing it with the pre-packaged MWF
available to their distros, how recent was that keyboard code change?
Perhaps the bug doesn't happen anymore in SVN HEAD, but people may
want to know in which release the issue was solved.

Any info is welcome,

Thank,

On 6/30/06, Jackson Harper &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">jackson at ximian.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Using an ABNT-2 keyboard layout I am unable to duplicate this crash.
</I>&gt;<i> Also looking at the stack trace it looks like you are using an older
</I>&gt;<i> version of the keyboard code.  The layout code is lazy now and should
</I>&gt;<i> not load until you actually use the keyboard.  The stack you provided is
</I>&gt;<i> crashing in initialization.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Jackson
</I>&gt;<i>
</I>&gt;<i> On Wed, 2006-06-28 at 12:03 -0300, Rafael Teixeira wrote:
</I>&gt;<i> &gt; **Description of Problem:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When starting a WinForms application on a station with the ABNT2
</I>&gt;<i> &gt; (Brazilian 105-Key Keyboard) layout, we have a &quot;Array index is out of
</I>&gt;<i> &gt; range.&quot; exception in &lt;0x0043e&gt;
</I>&gt;<i> &gt; System.Windows.Forms.X11Keyboard:CreateConversionArray that kills the
</I>&gt;<i> &gt; app.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; **Steps to reproduce the problem:
</I>&gt;<i> &gt; 1. Just run a SWF app, with that keyboard layout set on X11.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; **Actual Results:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Unhandled Exception: System.TypeInitializationException: An exception
</I>&gt;<i> &gt; was thrown by the type initializer for System.Windows.Forms.XplatUI ---&gt;
</I>&gt;<i> &gt; System.IndexOutOfRangeException: Array index is out of range.
</I>&gt;<i> &gt; in &lt;0x0043e&gt; System.Windows.Forms.X11Keyboard:CreateConversionArray
</I>&gt;<i> &gt; (System.Windows.Forms.KeyboardLayouts layouts,
</I>&gt;<i> &gt; System.Windows.Forms.KeyboardLayout layout)
</I>&gt;<i> &gt; in &lt;0x000d8&gt; System.Windows.Forms.X11Keyboard:.ctor (IntPtr display,
</I>&gt;<i> &gt; IntPtr window)
</I>&gt;<i> &gt; in &lt;0x003e9&gt; System.Windows.Forms.XplatUIX11:SetDisplay (IntPtr
</I>&gt;<i> &gt; display_handle)
</I>&gt;<i> &gt; in &lt;0x0008b&gt; System.Windows.Forms.XplatUIX11:.ctor ()
</I>&gt;<i> &gt; in &lt;0x00040&gt; System.Windows.Forms.XplatUIX11:GetInstance ()
</I>&gt;<i> &gt; in &lt;0x00061&gt; System.Windows.Forms.XplatUI:.cctor ()--- End of inner
</I>&gt;<i> &gt; exception stack trace ---
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; in &lt;0x00000&gt; &lt;unknown method&gt;
</I>&gt;<i> &gt; in &lt;0x00064&gt; System.Windows.Forms.Form:get_CreateParams ()
</I>&gt;<i> &gt; in &lt;0x00273&gt; System.Windows.Forms.Control:.ctor ()
</I>&gt;<i> &gt; in &lt;0x00011&gt; System.Windows.Forms.ScrollableControl:.ctor ()
</I>&gt;<i> &gt; in &lt;0x00010&gt; System.Windows.Forms.ContainerControl:.ctor ()
</I>&gt;<i> &gt; in &lt;0x00019&gt; System.Windows.Forms.Form:.ctor ()
</I>&gt;<i> &gt; in &lt;0x00017&gt; TestGUIWordCount.Form1:.ctor ()
</I>&gt;<i> &gt; in (wrapper remoting-invoke-with-check) TestGUIWordCount.Form1:.ctor ()
</I>&gt;<i> &gt; in &lt;0x00018&gt; TestGUIWordCount.Form1:Main ()
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; **Expected Results:
</I>&gt;<i> &gt; Just showing the app form.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; **How often does this happen?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Always for that keyboard layout.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; **Additional Information:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This patch, deals with the exception so the app runs, and shows some
</I>&gt;<i> &gt; debugging information that may lead to the correct fix:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Index: System.Windows.Forms/X11Keyboard.cs
</I>&gt;<i> &gt; ===================================================================
</I>&gt;<i> &gt; --- System.Windows.Forms/X11Keyboard.cs       (revision 61762)
</I>&gt;<i> &gt; +++ System.Windows.Forms/X11Keyboard.cs       (working copy)
</I>&gt;<i> &gt; @@ -497,14 +498,25 @@
</I>&gt;<i> &gt;                                                       }
</I>&gt;<i> &gt;                                               }
</I>&gt;<i> &gt;                                               if (maxval &gt;= 0) {
</I>&gt;<i> &gt; -                                                     scan = layouts.scan_table [(int) layout.ScanIndex][maxval];
</I>&gt;<i> &gt; -                                                     vkey = layouts.vkey_table [(int) layout.VKeyIndex][maxval];
</I>&gt;<i> &gt; +                                                     try {
</I>&gt;<i> &gt; +                                                             scan = layouts.scan_table [(int) layout.ScanIndex][maxval];
</I>&gt;<i> &gt; +                                                             vkey = layouts.vkey_table [(int) layout.VKeyIndex][maxval];
</I>&gt;<i> &gt; +                                                     } catch (Exception e) {
</I>&gt;<i> &gt; +                                                             Console.WriteLine(&quot;Ignoring invalid indexes '{0}' '{1}'
</I>&gt;<i> &gt; '{2}'&quot;, (int) layout.ScanIndex, (int) layout.VKeyIndex, maxval);
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +                                                             scan = 0;
</I>&gt;<i> &gt; +                                                             vkey = 0;
</I>&gt;<i> &gt; +                                                     }
</I>&gt;<i> &gt;                                               }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                                       }
</I>&gt;<i> &gt;                               }
</I>&gt;<i> &gt; -                             keyc2vkey [e2.KeyEvent.keycode] = vkey;
</I>&gt;<i> &gt; -                             keyc2scan [e2.KeyEvent.keycode] = scan;
</I>&gt;<i> &gt; +                             if (e2.KeyEvent.keycode &lt; 0 || e2.KeyEvent.keycode &gt; 255)
</I>&gt;<i> &gt; +                                     Console.WriteLine(&quot;Ignoring invalid keycode found '{0}'&quot;,
</I>&gt;<i> &gt; e2.KeyEvent.keycode);
</I>&gt;<i> &gt; +                             else {
</I>&gt;<i> &gt; +                                     keyc2vkey [e2.KeyEvent.keycode] = vkey;
</I>&gt;<i> &gt; +                                     keyc2scan [e2.KeyEvent.keycode] = scan;
</I>&gt;<i> &gt; +                             }
</I>&gt;<i> &gt;                       }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Rafael &quot;Monoman&quot; Teixeira
---------------------------------------
&quot;The reasonable man adapts himself to the world; the unreasonable one
persists in trying to adapt the world to himself. Therefore all
progress depends on the unreasonable man.&quot; George Bernard Shaw
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002392.html">[Mono-winforms-list] MWF2 Enumeration Changes
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2396">[ date ]</a>
              <a href="thread.html#2396">[ thread ]</a>
              <a href="subject.html#2396">[ subject ]</a>
              <a href="author.html#2396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">More information about the Mono-winforms-list
mailing list</a><br>
</body></html>
