<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:2a5gjx302%40sneakemail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001500.html">
   <LINK REL="Next"  HREF="001508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
   </H1>
    <B>Jonathan Gilbert
    </B> 
    <A HREF="mailto:2a5gjx302%40sneakemail.com"
       TITLE="[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps">2a5gjx302@sneakemail.com
       </A><BR>
    <I>Tue, 15 Mar 2005 12:40:19 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="001500.html">[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
</A></li>
        <LI> Next message: <A HREF="001508.html">[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1501">[ date ]</a>
              <a href="thread.html#1501">[ thread ]</a>
              <a href="subject.html#1501">[ subject ]</a>
              <a href="author.html#1501">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 02:06 PM 15/03/2005 -0300, Fabian Luque wrote:
&gt;&gt;<i> Oh, and one other thing: This time I actually verified that the diffs apply
</I>&gt;&gt;<i> cleanly :-)
</I>&gt;<i>
</I>&gt;<i>I'm getting this error when compiling libgdiplus after aplying the diff:
</I>&gt;<i>
</I>&gt;<i>bitmap.c: In function `GdipCreateBitmapFromScan0':
</I>&gt;<i>bitmap.c:286: warning: `default_palette' might be used uninitialized
</I>&gt;<i>in this function
</I>&gt;<i>make[2]: *** [bitmap.lo] Error 1
</I>&gt;<i>make[2]: Leaving directory `/home/fabian/Downloads/MonoSVN/libgdiplus/src'
</I>&gt;<i>make[1]: *** [all-recursive] Error 1
</I>&gt;<i>make[1]: Leaving directory `/home/fabian/Downloads/MonoSVN/libgdiplus'
</I>&gt;<i>make: *** [all] Error 2
</I>&gt;<i>
</I>&gt;<i>Any hints?
</I>
What's going on here is that there are exactly 3 indexed palette modes, and
my code is doing something like this:

if (gdip_is_an_indexed_pixelformat (format)) {
    unsigned char *default_palette;

    switch (format)
    {
        case Format1bppIndexed: default_palette =
default_Format1bppIndexed_palette; break;
        case Format4bppIndexed: default_palette =
default_Format4bppIndexed_palette; break;
        case Format8bppIndexed: default_palette =
default_Format8bppIndexed_palette; break;
    }

    /* code here that applies default_palette generically */
}

Without understanding that relationship between
gdip_is_an_indexed_pixelformat and the possible 'case's of the 'switch',
the compiler can't tell whether default_palette will always be initialized.
Clearly it will, but the compiler can't tell.

Probably the cleanest way to remove the warning, without making the code do
an extra assignment when it doesn't have to, is to add a 'default' block
that sets it to 'NULL':

        default: default_palette = NULL;

I'll add this change in at the same time as addressing the endianness
issues that kangaroo just posted. The endianness issues themselves are
pretty weird; I didn't realize that the code was working with 1- and 4-bit
images in terms of 'int's. Anyway, I'll post another patch later today. :-)

Jonathan Gilbert


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001500.html">[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
</A></li>
	<LI> Next message: <A HREF="001508.html">[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1501">[ date ]</a>
              <a href="thread.html#1501">[ thread ]</a>
              <a href="subject.html#1501">[ subject ]</a>
              <a href="author.html#1501">[ author ]</a>
         </LI>
       </UL>
</body></html>
