<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] Matrix memory management in GDI+ bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Laurent%20Debacker%20%3Cdebackerl%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001495.html">
   <LINK REL="Next"  HREF="001498.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] Matrix memory management in GDI+ bug
   </H1>
    <B>Laurent Debacker
    </B> 
    <A HREF="mailto:Laurent%20Debacker%20%3Cdebackerl%40gmail.com%3E"
       TITLE="[Mono-winforms-list] Matrix memory management in GDI+ bug">Laurent Debacker &lt;debackerl@gmail.com&gt;
       </A><BR>
    <I>Sun, 13 Mar 2005 21:24:17 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="001495.html">[Mono-winforms-list] Matrix memory management in GDI+ bug
</A></li>
        <LI> Next message: <A HREF="001498.html">[Mono-winforms-list] Matrix memory management in GDI+ bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1496">[ date ]</a>
              <a href="thread.html#1496">[ thread ]</a>
              <a href="subject.html#1496">[ subject ]</a>
              <a href="author.html#1496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> If you call Dispose the resource should be freed, as users will expect.
</I>&gt;<i> Also, Microsoft does works this way.
</I>
Well, but it depends what you want. At the end both managed and
unmanaged data live in RAM. So if you store a matrix in managed or
unmanaged space, it always use RAM space. When I call Dispose() on a
object, I expect it to work a bit like delete in C++. That is to just
free up ressources used by the object, but most of the time, big
ressources.

Also I don't think the user expect the framework to duplicate the
matrix in both the managed and unmanaged worlds.

What I think is that the matrix should be either kept in managed or
unmanaged world.

Best solution: (or I think so) To keep the Dispose() philosophy ok.
But then the matrix should be in the managed world. When the Matrix
object would be use in a graphics object, we may just convert it to a
native matrix for libgdiplus. It may be kept for some times, or
immedialely free()ed after being used. If it's kept for some times,
the Dispose() may force it to be free()ed. However if you want to
reused the matrix object with a Graphics object again, a new native
matrix could be generated. This would match the Microsoft behavior.

I'm not sure I understand the patch from Jordi, because if I Dispose()
the Matrix, I won't be able to use it again as I can with Microsoft.

On Sat, 12 Mar 2005 13:15:16 -0500, Jonathan Gilbert
&lt;<A HREF="mailto:2a5gjx302@sneakemail.com">2a5gjx302@sneakemail.com</A>&gt; wrote:
&gt;<i> At 11:18 AM 12/03/2005 +0100, Laurent Debacker wrote:
</I>&gt;<i> &gt;Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;There's is a bug in the way mono manage the unmanaged matrix in libgdiplus.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;What I wanted to do is to save the transform matrix used in a Graphics
</I>&gt;<i> &gt;object, save it in a global variable to reuse it later in other
</I>&gt;<i> &gt;Graphics objects. It's just for optimization purpose.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;However Mono's System.Drawing.Drawing2D.Matrix doesn't behave like
</I>&gt;<i> &gt;Microsoft's one.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;With Microsoft I can take the transform matrix from a matrix, even
</I>&gt;<i> &gt;Dispose() it, then give it to another Graphics object, and it still
</I>&gt;<i> &gt;works. I know it's tricky to Dispose() there, but I wanted to do
</I>&gt;<i> &gt;futher research.
</I>&gt;<i> 
</I>&gt;<i> If Microsoft's implementation allows the Matrix to be used after it has
</I>&gt;<i> been Dispose()d, this would tend to indicate that they are actually storing
</I>&gt;<i> the matrix in managed memory, and that while a System.Drawing.Graphics has
</I>&gt;<i> an unmanaged matrix involved with the GDI+ operations, a
</I>&gt;<i> System.Drawing.Drawing2D.Matrix simply duplicates the matrix data in
</I>&gt;<i> managed memory. Changing mono to behave this way would be a lot more
</I>&gt;<i> logical than changing Dispose() to not perform its task.
</I>&gt;<i> 
</I>&gt;<i> This is probably something I could do myself :-) Jordi?
</I>&gt;<i> 
</I>&gt;<i> Jonathan Gilbert
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-winforms-list maillist  -  <A HREF="mailto:Mono-winforms-list@lists.ximian.com">Mono-winforms-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-winforms-list">http://lists.ximian.com/mailman/listinfo/mono-winforms-list</A>
</I>&gt;<i>
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001495.html">[Mono-winforms-list] Matrix memory management in GDI+ bug
</A></li>
	<LI> Next message: <A HREF="001498.html">[Mono-winforms-list] Matrix memory management in GDI+ bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1496">[ date ]</a>
              <a href="thread.html#1496">[ thread ]</a>
              <a href="subject.html#1496">[ subject ]</a>
              <a href="author.html#1496">[ author ]</a>
         </LI>
       </UL>
</body></html>
