<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Fabian%20Luque%20%3Cfabianluque%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001501.html">
   <LINK REL="Next"  HREF="001511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
   </H1>
    <B>Fabian Luque
    </B> 
    <A HREF="mailto:Fabian%20Luque%20%3Cfabianluque%40gmail.com%3E"
       TITLE="[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps">Fabian Luque &lt;fabianluque@gmail.com&gt;
       </A><BR>
    <I>Wed, 16 Mar 2005 14:08:33 -0300</I>
    <P><UL>
        <LI> Previous message: <A HREF="001501.html">[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
</A></li>
        <LI> Next message: <A HREF="001511.html">[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1508">[ date ]</a>
              <a href="thread.html#1508">[ thread ]</a>
              <a href="subject.html#1508">[ subject ]</a>
              <a href="author.html#1508">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> What's going on here is that there are exactly 3 indexed palette modes, and
</I>&gt;<i> my code is doing something like this:
</I>&gt;<i> 
</I>&gt;<i> if (gdip_is_an_indexed_pixelformat (format)) {
</I>&gt;<i>     unsigned char *default_palette;
</I>&gt;<i> 
</I>&gt;<i>     switch (format)
</I>&gt;<i>     {
</I>&gt;<i>         case Format1bppIndexed: default_palette =
</I>&gt;<i> default_Format1bppIndexed_palette; break;
</I>&gt;<i>         case Format4bppIndexed: default_palette =
</I>&gt;<i> default_Format4bppIndexed_palette; break;
</I>&gt;<i>         case Format8bppIndexed: default_palette =
</I>&gt;<i> default_Format8bppIndexed_palette; break;
</I>&gt;<i>     }
</I>&gt;<i> 
</I>&gt;<i>     /* code here that applies default_palette generically */
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> Without understanding that relationship between
</I>&gt;<i> gdip_is_an_indexed_pixelformat and the possible 'case's of the 'switch',
</I>&gt;<i> the compiler can't tell whether default_palette will always be initialized.
</I>&gt;<i> Clearly it will, but the compiler can't tell.
</I>&gt;<i> 
</I>&gt;<i> Probably the cleanest way to remove the warning, without making the code do
</I>&gt;<i> an extra assignment when it doesn't have to, is to add a 'default' block
</I>&gt;<i> that sets it to 'NULL':
</I>&gt;<i> 
</I>&gt;<i>         default: default_palette = NULL;
</I>
After making this change, libgdiplus compiled just fine.

Now, when I open my 1bpp TIFF file and the save it to PNG I'm still
getting a 32bpp 180 KB file instead of a 1bpp file around 80 KB.

-- 
Fabian Luque
<A HREF="http://fluque.blogspot.com">http://fluque.blogspot.com</A>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001501.html">[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
</A></li>
	<LI> Next message: <A HREF="001511.html">[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1508">[ date ]</a>
              <a href="thread.html#1508">[ thread ]</a>
              <a href="subject.html#1508">[ subject ]</a>
              <a href="author.html#1508">[ author ]</a>
         </LI>
       </UL>
</body></html>
