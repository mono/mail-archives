<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:grompf%40sublimeintervention.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001504.html">
   <LINK REL="Next"  HREF="001469.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps
   </H1>
    <B>kangaroo
    </B> 
    <A HREF="mailto:grompf%40sublimeintervention.com"
       TITLE="[Mono-winforms-list] libgdiplus/System.Drawing patch: native support for indexed Bitmaps">grompf@sublimeintervention.com
       </A><BR>
    <I>Wed, 16 Mar 2005 17:35:42 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="001504.html">[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
</A></li>
        <LI> Next message: <A HREF="001469.html">[Mono-winforms-list] Attempting to run MWF on Mac
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1519">[ date ]</a>
              <a href="thread.html#1519">[ thread ]</a>
              <a href="subject.html#1519">[ subject ]</a>
              <a href="author.html#1519">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This patch still does not work on PPC.

Please see:
<A HREF="http://tuxppc.rz.uni-augsburg.de/">http://tuxppc.rz.uni-augsburg.de/</A>

or

<A HREF="http://www.egr.up.edu:8080/">http://www.egr.up.edu:8080/</A>

For free PPC accounts (you will need to probably write C test files; 
but it will let you test)

-kangaroo

On 11-Mar-05, at 1:22 PM, Jonathan Gilbert wrote:

&gt;<i> At 02:12 AM 05/03/2005 -0500, I wrote:
</I>&gt;&gt;<i> Please find attached the following files:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * libgdiplus.diff (patch -p0 in ./libgdiplus)
</I>&gt;&gt;<i> * System.Drawing.diff (patch -p0 in ./mcs/class/System.Drawing)
</I>&gt;&gt;<i> * lockbits.tgz (tar zvfx in ./)
</I>&gt;<i>
</I>&gt;<i> Updated diffs and some extra testing code: testgif.tgz (DOES NOT 
</I>&gt;<i> contain a
</I>&gt;<i> subdirectory; untar directly within the intended destination)
</I>&gt;<i>
</I>&gt;<i> Changes from the previous patch:
</I>&gt;<i> * Fixed the call to gdip_is_an_indexed_pixelformat that did not 
</I>&gt;<i> actually
</I>&gt;<i> call the function because it was missing the argument list.
</I>&gt;<i> * Added indexed loading &amp; saving support to gifcodec.c.
</I>&gt;<i> * Updated Image.Palette to behave like Microsoft's implementation. I
</I>&gt;<i> discovered its bizarre behaviour when I tried to write a program for 
</I>&gt;<i> the
</I>&gt;<i> Microsoft framework to save an indexed 8-bit Bitmap with a custom 
</I>&gt;<i> palette.
</I>&gt;<i> It does not actually behave like a property, and should really have 
</I>&gt;<i> been
</I>&gt;<i> engineered as two separate functions, since there is no persistence
</I>&gt;<i> involved. Reading from the property creates a new instance of
</I>&gt;<i> System.Drawing.Imaging.ColorPalette and fills it from the underlying 
</I>&gt;<i> GDI+
</I>&gt;<i> GpImage object. However, the underlying GpImage's palette is only 
</I>&gt;<i> updated
</I>&gt;<i> if you assign to the property. Since you are not allowed to create
</I>&gt;<i> instances of ColorPalette directly, you end up having to write code 
</I>&gt;<i> like this:
</I>&gt;<i>
</I>&gt;<i> ColorPalette palette = my_bitmap.Palette;
</I>&gt;<i>
</I>&gt;<i> for (int i=0; i &lt; palette.Entries.Length; i++)
</I>&gt;<i>   palette.Entries[i] = Color.FromArgb(ar, gu, ments);
</I>&gt;<i>
</I>&gt;<i> my_bitmap.Palette = palette; /* assign the same instance back! if this 
</I>&gt;<i> is
</I>&gt;<i> skipped, the image file will display and save with the old palette */
</I>&gt;<i>
</I>&gt;<i> This is not documented in MSDN! But whatever the case, mono now 
</I>&gt;<i> behaves the
</I>&gt;<i> same way.
</I>&gt;<i>
</I>&gt;<i> Oh, and one other thing: This time I actually verified that the diffs 
</I>&gt;<i> apply
</I>&gt;<i> cleanly :-)
</I>&gt;<i>
</I>&gt;<i> Jonathan Gilbert
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> !DSPAM:42376ae512631323642109!
</I>&gt;<i> &lt;testgif.tgz&gt;&lt;libgdiplus.diff&gt;&lt;System.Drawing.diff&gt;
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001504.html">[Mono-winforms-list] libgdiplus/System.Drawing patch:
 native support for indexed Bitmaps
</A></li>
	<LI> Next message: <A HREF="001469.html">[Mono-winforms-list] Attempting to run MWF on Mac
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1519">[ date ]</a>
              <a href="thread.html#1519">[ thread ]</a>
              <a href="subject.html#1519">[ subject ]</a>
              <a href="author.html#1519">[ author ]</a>
         </LI>
       </UL>
</body></html>
