<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-users] Separation between GUI and main
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:glade-users%40lists.ximian.com?Subject=Re%3A%20%5BGlade-users%5D%20Separation%20between%20GUI%20and%20main&In-Reply-To=%3CCAGUy9WKSbvhtLzp0Vx2kMFRBzVomr%3DKsC-YH45GCusGhYrcF2Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005468.html">
   <LINK REL="Next"  HREF="005472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-users] Separation between GUI and main</H1>
    <B>Tristan Van Berkom</B> 
    <A HREF="mailto:glade-users%40lists.ximian.com?Subject=Re%3A%20%5BGlade-users%5D%20Separation%20between%20GUI%20and%20main&In-Reply-To=%3CCAGUy9WKSbvhtLzp0Vx2kMFRBzVomr%3DKsC-YH45GCusGhYrcF2Q%40mail.gmail.com%3E"
       TITLE="[Glade-users] Separation between GUI and main">tristan.van.berkom at gmail.com
       </A><BR>
    <I>Sat Jan 21 10:10:57 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="005468.html">[Glade-users] Separation between GUI and main
</A></li>
        <LI>Next message: <A HREF="005472.html">[Glade-users] Separation between GUI and main
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5469">[ date ]</a>
              <a href="thread.html#5469">[ thread ]</a>
              <a href="subject.html#5469">[ subject ]</a>
              <a href="author.html#5469">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok here's a tiny tarball demonstrating the concept.

Just untar and make it... see my-demo.c to see how it works.

It's very simple and modular, lately I've been doing work with
ClutterScript and sometimes Mx, I use the same approach
with Clutter effectively it works the same way.

Note that IMO, the whole business in the -&gt;constructor()
should not be needed, this can effectively be implemented
as a feature of GtkContainerClass, one would only have
to associate some G_STRUCT_OFFSETs on the instance
or private data to determine where composite children
pulled from the UI should be assigned after the container
class constructs (just a bit of syntactic sugar).

Note that I have created a branch in GTK+ in the past that
does this, it's called &quot;composite-containers&quot;, actually it needs
some work to integrate the files as string constants in the
build system and improve the APIs which determine how
to automatically pull children from the associated builder
xml.

There is also an blog post I wrote on this subject:
<A HREF="http://blogs.gnome.org/tvb/2010/03/08/it-was-a-saturday-afternoon-patch/">http://blogs.gnome.org/tvb/2010/03/08/it-was-a-saturday-afternoon-patch/</A>

Merry Christmas,
   -Tristan

On Sat, Jan 21, 2012 at 2:31 PM, Igor Chetverovod &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">chetverovod at gmail.com</A>&gt; wrote:
&gt;<i> Hello Tristan,
</I>&gt;<i>
</I>&gt;<i> Could you please to provide more detailed example for this part of your letter:
</I>&gt;<i> &quot;...Better practice still, is to derive a GtkContainer for every modular
</I>&gt;<i> GUI object which can be used and reused throughout your GUI...&quot; &#160;?
</I>&gt;<i>
</I>&gt;<i> I am not novice in using of GTK and glade, but I did not catch the
</I>&gt;<i> work flow of mentioned new technic. It would be great to see a pice of
</I>&gt;<i> code.
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Igor
</I>&gt;<i>
</I>&gt;<i> 2012/1/20, Tristan Van Berkom &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">tristan.van.berkom at gmail.com</A>&gt;:
</I>&gt;&gt;<i> On Sat, Jan 21, 2012 at 12:44 AM, Manuel Ferrero &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">mferrero at reer.it</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> I'm learning GTK+ and Glade on my win32 machine.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Right now I was able to write, compile and run a simple code with a
</I>&gt;&gt;&gt;<i> window,
</I>&gt;&gt;&gt;<i> an hbox and a toggle button in it.
</I>&gt;&gt;&gt;<i> When the user presses the button I display the state of the button via the
</I>&gt;&gt;&gt;<i> callback function.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The main function is this:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ---SNIP---
</I>&gt;&gt;&gt;<i> int main(int argc, char *argv[])
</I>&gt;&gt;&gt;<i> {
</I>&gt;&gt;&gt;<i> gtk_init(&amp;argc, &amp;argv);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> GtkBuilder *builder_handler;
</I>&gt;&gt;&gt;<i> GtkWidget *window;
</I>&gt;&gt;&gt;<i> GtkWidget *connect_button;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> builder_handler = gtk_builder_new();
</I>&gt;&gt;&gt;<i> gtk_builder_add_from_file(builder_handler, GUI_XML_FILENAME, NULL);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> window = GTK_WIDGET(gtk_builder_get_object(builder_handler, &quot;window&quot;));
</I>&gt;&gt;&gt;<i> connect_button = GTK_WIDGET(gtk_builder_get_object(builder_handler,
</I>&gt;&gt;&gt;<i> &quot;connect_button&quot;));
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> gtk_builder_connect_signals(builder_handler, NULL);
</I>&gt;&gt;&gt;<i> g_object_unref (G_OBJECT (builder_handler));
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> gtk_widget_show (connect_button);
</I>&gt;&gt;&gt;<i> gtk_widget_show (window);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> gtk_main ();
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> return 0;
</I>&gt;&gt;&gt;<i> } &#160; // main
</I>&gt;&gt;&gt;<i> ---PINS---
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'll spare you the callbacks.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Now my question is this: with Glade I add another button (expanding the
</I>&gt;&gt;&gt;<i> hbox
</I>&gt;&gt;&gt;<i> of course) and I name it my_button_2.
</I>&gt;&gt;&gt;<i> The code has to know about this new button so at least I have to declare a
</I>&gt;&gt;&gt;<i> new GtkWidget pointer, call the gtk_builder_get_object() to assing the
</I>&gt;&gt;&gt;<i> pointer and then show it with a gtk_widget_show().
</I>&gt;&gt;&gt;<i> Leave alone the callbacks for all the signals.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I don't understand how this can separate the GUI from the code.
</I>&gt;&gt;&gt;<i> Am I missing something?
</I>&gt;&gt;&gt;<i> Is tehre some way to connect signals without knowing the objects? In this
</I>&gt;&gt;&gt;<i> case I could only write the needed callbacks to manage the new button.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you need to control the state of a widget in the interface, you need
</I>&gt;&gt;<i> a pointer to that widget.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you add a widget to your interface, say a button that causes a new
</I>&gt;&gt;<i> action you need to handle, then you don't need a pointer to that button.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A common practice is to use the last argument of
</I>&gt;&gt;<i> gtk_builder_connect_signals(),
</I>&gt;&gt;<i> you can create a data structure which contains the needed pointers for your
</I>&gt;&gt;<i> whole module, i.e.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> typedef struct _MyModule {
</I>&gt;&gt;<i> &#160; &#160;GtkWidget *the_toggle_button;
</I>&gt;&gt;<i> &#160; &#160;GtkWidget *the_entry;
</I>&gt;&gt;<i> &#160; &#160;GtkWidget *the_toplevel_window;
</I>&gt;&gt;<i> &#160; &#160;GtkWidget *etc, *etc;
</I>&gt;&gt;<i> };
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> &#160; &#160;MyModule module = { 0, };
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160;/* where you load the gui file */
</I>&gt;&gt;<i> &#160; &#160;builder = gtk_builder_new ();
</I>&gt;&gt;<i> &#160; &#160;gtk_builder_add_from_file (...);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160;module.the_toggle_button = gtk_builder_get_object (builder,
</I>&gt;&gt;<i> &quot;the-toggle-button&quot;);
</I>&gt;&gt;<i> &#160; &#160;... etc etc ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160;/* then just pass your main module structure to all of your callback */
</I>&gt;&gt;<i> &#160; &#160;gtk_builder_connect_signals (builder, &amp;module);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is common practice but still old-fashioned if you ask me.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Better practice still, is to derive a GtkContainer for every modular
</I>&gt;&gt;<i> GUI object which can be used and reused throughout your GUI.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then you repeat the above exercise in the object's -&gt;constructed()
</I>&gt;&gt;<i> method, pass the object's instance as the user data for all callbacks
</I>&gt;&gt;<i> and have one GtkBuilder xml definition for each composite object
</I>&gt;&gt;<i> which you might use in your GUI.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You might have a GUI file describing the layout of your preferences
</I>&gt;&gt;<i> dialog, your project properties dialog etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then if you are developing an editor program which might have
</I>&gt;&gt;<i> multiple projects loaded, you might be allowed to display project
</I>&gt;&gt;<i> properties dialogs for different projects at the same time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then your properties dialog (which derives from GtkDialog and
</I>&gt;&gt;<i> has it's contents defined by a GtkBuilder xml file which is added
</I>&gt;&gt;<i> to the dialog at -&gt;constructor() time)... would have a &quot;project&quot;
</I>&gt;&gt;<i> property.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> At which point, creating a preferences dialog can be done
</I>&gt;&gt;<i> at any time with a call to:
</I>&gt;&gt;<i> &#160; new_dialog = g_object_new (MY_TYPE_CUSTOM_PROPERTIES_DIALOG,
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&quot;project&quot;,
</I>&gt;&gt;<i> the_project_to_display_properties_for,
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;NULL);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Admittedly, with this paradigm, you shouldnt really have to be
</I>&gt;&gt;<i> doing things by hand in your -&gt;constructor() method... or
</I>&gt;&gt;<i> accessing GtkBuilder apis manually at all... this is just because
</I>&gt;&gt;<i> we have not yet landed something at the GtkContainer level
</I>&gt;&gt;<i> to allow you to simply assign GtkBuilder xml to a container class
</I>&gt;&gt;<i> (in other words, we are actually still a step behind NextStep
</I>&gt;&gt;<i> in this respect).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To answer your question about &quot;separating your GUI from your code&quot;,
</I>&gt;&gt;<i> of course you will always need to declare object members for the
</I>&gt;&gt;<i> widgets that you actually need to access, adding these members
</I>&gt;&gt;<i> only ever happens when your program gains new features, and
</I>&gt;&gt;<i> those features require interaction with the GUI.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In earlier times, GUIs were constructed in actual code, i.e.:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160;window = gtk_window_new();
</I>&gt;&gt;<i> &#160; &#160;box = gtk_box_new (...);
</I>&gt;&gt;<i> &#160; &#160;gtk_widget_show (box);
</I>&gt;&gt;<i> &#160; &#160;gtk_container_add (GTK_CONTAINER (window), box);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160;/* ... huge code to construct menu bar &#160;... */
</I>&gt;&gt;<i> &#160; &#160;gtk_widget_show (menubar);
</I>&gt;&gt;<i> &#160; &#160;gtk_container_add (GTK_CONTAINER (box), menubar);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160;/* huge code to construct the rest of your application... etc etc */
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In the first versions of Glade, it was only possible to use with code
</I>&gt;&gt;<i> generation,
</I>&gt;&gt;<i> this ended up in the mixing of business logic in generated C code
</I>&gt;&gt;<i> files, rendering
</I>&gt;&gt;<i> it virtually impossible to ever modify your GUI after you initially
</I>&gt;&gt;<i> developped it
</I>&gt;&gt;<i> (or just very very impractical, because then you have to re-merge in all of
</I>&gt;&gt;<i> your business logic... just because you wanted to add some icon to a menu
</I>&gt;&gt;<i> item or add some alignment to a frame or whatever minor detail you wanted
</I>&gt;&gt;<i> to change).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Using xml to define the actual interface makes UI coding practical and
</I>&gt;&gt;<i> maintainable, it separates the files in which you store your code and the
</I>&gt;&gt;<i> files in which you store your interface definition (note also that you can
</I>&gt;&gt;<i> always put your GtkBuilder xml into a header file as a string constant
</I>&gt;&gt;<i> as a step in your compilation, and include the GtkBuilder xml if you
</I>&gt;&gt;<i> are not content with accessing the hard-drive just to fire up a new
</I>&gt;&gt;<i> dialog... or if you just want to avoid the complexity of resolving system
</I>&gt;&gt;<i> installation paths at runtime).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;-Tristan
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Please remember I'm really new to this programming style, I'm an embedded
</I>&gt;&gt;&gt;<i> C
</I>&gt;&gt;&gt;<i> programmer so I know nealry nothign about objects and events.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks in advance.
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> Regards,
</I>&gt;&gt;&gt;<i> Manuel Ferrero
</I>&gt;&gt;&gt;<i> R&amp;D department
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Reer SpA
</I>&gt;&gt;&gt;<i> Tel. &#160;+39 011 2482215
</I>&gt;&gt;&gt;<i> Fax. +39 011 859867
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> L'utilizzo non autorizzato del presente messaggio e' vietato e potrebbe
</I>&gt;&gt;&gt;<i> costituire reato.
</I>&gt;&gt;&gt;<i> Se il presente messaggio non e' a Lei indirizzato, il suo contenuto non
</I>&gt;&gt;&gt;<i> deve
</I>&gt;&gt;&gt;<i> essere considerato
</I>&gt;&gt;&gt;<i> come trasmesso o autorizzato dalla Reer SpA; in tale caso Le saremmo grati
</I>&gt;&gt;&gt;<i> se, via e-mail,
</I>&gt;&gt;&gt;<i> ce ne comunicasse l'errata ricezione.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The unauthorized use of this e-mail is prohibited and could constitute an
</I>&gt;&gt;&gt;<i> offence.
</I>&gt;&gt;&gt;<i> If you are not the intended recipient of this message its contents shall
</I>&gt;&gt;&gt;<i> be
</I>&gt;&gt;&gt;<i> understood as neither
</I>&gt;&gt;&gt;<i> given nor endorsed by Reer SpA. Please notify Reer SpA by e-mail
</I>&gt;&gt;&gt;<i> immediately
</I>&gt;&gt;&gt;<i> in that case.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Glade-users maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">Glade-users at lists.ximian.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">http://lists.ximian.com/mailman/listinfo/glade-users</A>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Glade-users maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">Glade-users at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">http://lists.ximian.com/mailman/listinfo/glade-users</A>
</I>&gt;&gt;<i>
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: demo.tgz
Type: application/x-gzip
Size: 2296 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/glade-users/attachments/20120121/925afdef/attachment-0001.bin">http://lists.ximian.com/pipermail/glade-users/attachments/20120121/925afdef/attachment-0001.bin</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005468.html">[Glade-users] Separation between GUI and main
</A></li>
	<LI>Next message: <A HREF="005472.html">[Glade-users] Separation between GUI and main
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5469">[ date ]</a>
              <a href="thread.html#5469">[ thread ]</a>
              <a href="subject.html#5469">[ subject ]</a>
              <a href="author.html#5469">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/glade-users">More information about the Glade-users
mailing list</a><br>
</body></html>
