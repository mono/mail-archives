<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-users] Libglade save/restore root window size?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:glade-users%40lists.ximian.com?Subject=%5BGlade-users%5D%20Libglade%20save/restore%20root%20window%20size%3F&In-Reply-To=200801170659.40854.kbulgrien%40worldnet.att.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003778.html">
   <LINK REL="Next"  HREF="003783.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-users] Libglade save/restore root window size?</H1>
    <B>Tristan Van Berkom</B> 
    <A HREF="mailto:glade-users%40lists.ximian.com?Subject=%5BGlade-users%5D%20Libglade%20save/restore%20root%20window%20size%3F&In-Reply-To=200801170659.40854.kbulgrien%40worldnet.att.net"
       TITLE="[Glade-users] Libglade save/restore root window size?">tvb at gnome.org
       </A><BR>
    <I>Thu Jan 17 09:44:55 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003778.html">[Glade-users] Libglade save/restore root window size?
</A></li>
        <LI>Next message: <A HREF="003783.html">[Glade-users] Libglade save/restore root window size?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3782">[ date ]</a>
              <a href="thread.html#3782">[ thread ]</a>
              <a href="subject.html#3782">[ subject ]</a>
              <a href="author.html#3782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 17, 2008 10:59 AM, Kevin R. Bulgrien &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">kbulgrien at worldnet.att.net</A>&gt;
wrote:

&gt;<i> I asked some time back about this, but did not provide detail so the
</I>&gt;<i> suggestion that the old glade code ported to libglade should &quot;just work&quot;
</I>&gt;<i> was mostly confirmation to me that something odd is going on as it does
</I>&gt;<i> not just work.
</I>&gt;<i>
</I>&gt;<i> In case it is relevant:
</I>&gt;<i>
</I>&gt;<i>  lib64glade2.0_0-2.6.0-1mdv2007.0
</I>&gt;<i>  glade2-2.12.1-3mdv2007.0
</I>&gt;<i>
</I>&gt;<i> On Thursday 04 October 2007 00:28, Tristan  wrote:
</I>&gt;<i> &gt; On Wed, 2007-10-03 at 22:34 -0500, Kevin R. Bulgrien wrote:
</I>&gt;<i> &gt; &gt; Does anyone have an idea of how to have a libglade application save
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; window size and then use the save settings the next time the
</I>&gt;<i> application
</I>&gt;<i> &gt; &gt; runs?  The user should not be prevented from being able to manually
</I>&gt;<i> &gt; &gt; resize the window smaller or larger, but the user saved sizes should
</I>&gt;<i> be
</I>&gt;<i> &gt; &gt; recalled the next time the application is started.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I converted a GTK+ glade project to libglade.  The application used to
</I>&gt;<i> &gt; &gt; be able to save and set the root window size using get_window_coord(),
</I>&gt;<i> &gt; &gt; gtk_window_move(), and gtk_window_set_default_size ().
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Since converting the project to use libglade, restoring the window
</I>&gt;<i> size
</I>&gt;<i> &gt; &gt; on application start no longer works, but rather the default size
</I>&gt;<i> &gt; &gt; defined in the glade file is always used.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Perhaps this has something to do with the fact that the window is
</I>&gt;<i> &gt; &gt; rendered upon loading the XML file, and this is now done prior to
</I>&gt;<i> using
</I>&gt;<i> &gt; &gt; the gtk_window_set_default_size() function.
</I>&gt;<i>
</I>&gt;<i> &gt;    your old code should work fine if left in place, just
</I>&gt;<i> &gt; use glade_xml_get_widget() at initialization time to store
</I>&gt;<i> &gt; pointers to the widgets involved, then restore the sizes
</I>&gt;<i> &gt; after loading the glade file.
</I>&gt;<i>
</I>&gt;<i> I wonder if window sizing must be done in a certain sequence... after
</I>&gt;<i> such-and-such call, but before this-or-that call?  I've tried moving
</I>&gt;<i> the code that does this, but have not had success yet.
</I>&gt;<i>
</I>&gt;<i> I can confirm that the window sizing is saved properly, as I can code the
</I>&gt;<i> saved sizes in the xml file directly to see that they match what I saved.
</I>&gt;<i> The only issue is re-applying the sizing on the next run.
</I>&gt;<i>
</I>&gt;<i> Roughly, main.c contains in this sequence, and the main window is the only
</I>&gt;<i> one
</I>&gt;<i> I'm trying to size at start.  This isn't all the code, but should be the
</I>&gt;<i> relevant calls.
</I>&gt;<i>
</I>&gt;<i>  gtk_set_locale()
</I>&gt;<i>  gtk_init()
</I>&gt;<i>  dialog_xml = glade_xml_new(dialog_xml_path, NULL, NULL);
</I>&gt;<i>    // Don't care about sizing this one.
</I>&gt;<i>  window_xml = glade_xml_new(window_xml_path, NULL, NULL);
</I>&gt;<i>    // This is the one to resize.
</I>&gt;<i>  window_root = glade_xml_get_widget(window_xml, &quot;window_root&quot;);
</I>&gt;<i>  g_signal_connect()s
</I>&gt;<i>    // main window connections.
</I>&gt;<i>  gtk_window_set_geometry_hints(GTK_WINDOW(window_root), window_root, ...)
</I>&gt;<i>    // (non-useful for libglade as the xml hints minimums?)
</I>&gt;<i>
</I>&gt;<i> Here the various panes, etc. of the window_root are initialized.
</I>&gt;<i> The calls here make many various calls to do so, including some
</I>&gt;<i> gtk_widget_show() for the window components.  Then, finally:
</I>&gt;<i>
</I>&gt;<i>  gtk_widget_show(window_root)
</I>&gt;<i>
</I>&gt;<i> load_window_positions(window_root) is what reads in the sizing.  It uses
</I>&gt;<i>
</I>&gt;<i>  xml_tree = glade_get_widget_tree(GTK_WIDGET (window_root))
</I>&gt;<i>
</I>&gt;<i> and have I tried code like the following, but nothing tried has succeeded:
</I>&gt;<i>
</I>&gt;<i>  widget = glade_xml_get_widget(xml_tree, buf);
</I>&gt;<i>  gtk_window_move(GTK_WINDOW(widget), x, y);
</I>&gt;<i>  gtk_window_set_default_size (GTK_WINDOW(widget), w, h);
</I>&gt;<i>  // gtk_widget_set_size_request (window_root, w, h);
</I>&gt;<i>  // gdk_window_move_resize(GDK_WINDOW(window_root), x, y, w, h);
</I>&gt;<i>
</I>&gt;<i>  widget = glade_xml_get_widget(xml_tree, buf);
</I>&gt;<i>  if (widget) {
</I>&gt;<i>    gtk_paned_set_position(GTK_PANED(widget), atoi(cp));
</I>&gt;<i>  }
</I>&gt;<i>
</I>&gt;<i> I have tried placing load window positions several places to no avail.
</I>&gt;<i> Can anyone with more experience suggest an idea or two on what might
</I>&gt;<i> possibly be going wrong, or suggestions on what greater detail to
</I>&gt;<i> provide to enable said help?  The original glade project worked fine
</I>&gt;<i> with load_window_positions() immediately before the
</I>&gt;<i> gtk_widget_show(window_root) call.
</I>

At first sight I think that set_default_size() should be before the
call to gtk_widget_show(), maybe even make sure that the window
is created with visible property FALSE (so that it is not shown before
setting the default size).

Cheers,
              -Tristan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/glade-users/attachments/20080117/b0536532/attachment-0001.html">http://lists.ximian.com/pipermail/glade-users/attachments/20080117/b0536532/attachment-0001.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003778.html">[Glade-users] Libglade save/restore root window size?
</A></li>
	<LI>Next message: <A HREF="003783.html">[Glade-users] Libglade save/restore root window size?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3782">[ date ]</a>
              <a href="thread.html#3782">[ thread ]</a>
              <a href="subject.html#3782">[ subject ]</a>
              <a href="author.html#3782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/glade-users">More information about the Glade-users
mailing list</a><br>
</body></html>
