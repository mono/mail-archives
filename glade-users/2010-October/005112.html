<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-users] Viewing custom widget sub-widgets in Glade	tree-view
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:glade-users%40lists.ximian.com?Subject=%5BGlade-users%5D%20Viewing%20custom%20widget%20sub-widgets%20in%20Glade%0A%09tree-view&In-Reply-To=AANLkTin6G--GAJfobD85fLNgbgNh3gHNWyqaugAYwz%3DB%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005111.html">
   <LINK REL="Next"  HREF="005113.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-users] Viewing custom widget sub-widgets in Glade	tree-view</H1>
    <B>Tristan Van Berkom</B> 
    <A HREF="mailto:glade-users%40lists.ximian.com?Subject=%5BGlade-users%5D%20Viewing%20custom%20widget%20sub-widgets%20in%20Glade%0A%09tree-view&In-Reply-To=AANLkTin6G--GAJfobD85fLNgbgNh3gHNWyqaugAYwz%3DB%40mail.gmail.com"
       TITLE="[Glade-users] Viewing custom widget sub-widgets in Glade	tree-view">tvb at gnome.org
       </A><BR>
    <I>Tue Oct  5 10:35:50 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="005111.html">[Glade-users] Viewing custom widget sub-widgets in Glade	tree-view
</A></li>
        <LI>Next message: <A HREF="005113.html">[Glade-users] Limit combobox items
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5112">[ date ]</a>
              <a href="thread.html#5112">[ thread ]</a>
              <a href="subject.html#5112">[ subject ]</a>
              <a href="author.html#5112">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Oct 5, 2010 at 6:28 PM, Klaim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">mjklaim at gmail.com</A>&gt; wrote:
&gt;<i> Okay, so I tried to add&#160;G_PARAM_CONSTRUCT_ONLY to my properties (that are
</I>&gt;<i> built in the widget so are exposed correctly in glade) and it glade if I
</I>&gt;<i> change the property value it will crash with &quot;segmentation error&quot;. From the
</I>&gt;<i> trace I've put in my glade plugin I can see that it crashes after having
</I>&gt;<i> called (apprently successfully) the set-property function of my plugin. Not
</I>&gt;<i> sure if it's due to the way I've coded the widget...
</I>&gt;<i> I'm not sure to understand what&#160;G_PARAM_CONSTRUCT_ONLY is doing exactly...
</I>&gt;<i> As the internal buttons are destroyed and constructed by internal code of
</I>&gt;<i> the widget, don't it get in conflict with this parameter option?
</I>

Its hard to say what exactly is going on here without more details.

Setting of a construct-only property in Glade is one of the more complex
things that Glade does (the core will dig out any children added by the
user and save their packing options and then add them to the newly
&quot;rebuilt&quot; widget and then put the new version of the widget back in
to the hierarchy).

You are implementing get-children-function to return the internal
widgets as direct children of the custom widget ?

You are calling glade_widget_adaptor_create_internal() on the internal
widgets at post-create time ?

An actual stack trace by gdb would be helpful to get the drift of what's
amiss... also the glade_widget_rebuild() code (which runs to rebuild
widgets for construct-only properties) does not expect that a widget's
internal children will change across rebuilds (i.e. it expects the number
of internal children to be constant, I would expect complaints if children
existing before the rebuild were lost/inexistent after a rebuild).

Cheers,
               -Tristan
&gt;<i>
</I>&gt;<i> On Tue, Oct 5, 2010 at 11:18, Tristan Van Berkom &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">tvb at gnome.org</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sorry I have to run out right now, but reading your mail... if I
</I>&gt;&gt;<i> understand correctly
</I>&gt;&gt;<i> I think you will be able to get away with adding the text:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &lt;property .... construct-only=&quot;True&quot; /&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ...to the properties you declared which control how many columns/rows your
</I>&gt;&gt;<i> custom widget has (this will trigger the widget being rebuilt whenever the
</I>&gt;&gt;<i> amount of children changes... so it will call the post-create again and
</I>&gt;&gt;<i> add
</I>&gt;&gt;<i> the internal children correctly).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ofcourse if your children have customized internal names (like
</I>&gt;&gt;<i> &quot;button-c2-r5&quot;
</I>&gt;&gt;<i> for the button in column 2 and row 5...) then your GtkBuildable
</I>&gt;&gt;<i> implementation
</I>&gt;&gt;<i> will have to handle that correctly too in it's own
</I>&gt;&gt;<i> get_internal_child() implementation,
</I>&gt;&gt;<i> I dont think there's going to be any problems with that though.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160;-Tristan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Tue, Oct 5, 2010 at 5:52 PM, Klaim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">mjklaim at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; Hi and thank you very much for answering so fast!
</I>&gt;&gt;<i> &gt; Your explaination is clear and I now I can clearly see how much I'm not
</I>&gt;&gt;<i> &gt; in
</I>&gt;&gt;<i> &gt; this (simple) case.
</I>&gt;&gt;<i> &gt; I'll explain the structure of my custom widget to help you help me.
</I>&gt;&gt;<i> &gt; My custom widget isn't a container. I mean that in glade, or in the code
</I>&gt;&gt;<i> &gt; using it,
</I>&gt;&gt;<i> &gt; there shouldn't be ways to add something to it directly.
</I>&gt;&gt;<i> &gt; Instead, the use will simply change parametters:
</I>&gt;&gt;<i> &gt; My widget inherit from GtkAlignment and contains only a GtkTable. Now
</I>&gt;&gt;<i> &gt; the
</I>&gt;&gt;<i> &gt; table is automatically filled with GtkToggleButtons.
</I>&gt;&gt;<i> &gt; I exposed column-width and column-height in parametters of my custom
</I>&gt;&gt;<i> &gt; widget
</I>&gt;&gt;<i> &gt; and when you change it, it will automatically destroy and create toggle
</I>&gt;&gt;<i> &gt; buttons in the table to fill it. That's all done in the custom widget.
</I>&gt;&gt;<i> &gt; What I want is to allow the user to edit the buttons (everithing in it,
</I>&gt;&gt;<i> &gt; like
</I>&gt;&gt;<i> &gt; normal button edit) without being allowed to touch the structure of the
</I>&gt;&gt;<i> &gt; custom widget other than what I voluntarly exposed in the interface.
</I>&gt;&gt;<i> &gt; Now, if I understood correctly, I'm in the case where I need to
</I>&gt;&gt;<i> &gt; &#160;1. implement get-internal-child
</I>&gt;&gt;<i> &gt; &#160;2. have to get new buttons created in the widget and make glade widgets
</I>&gt;&gt;<i> &gt; for
</I>&gt;&gt;<i> &gt; them.
</I>&gt;&gt;<i> &gt; That's what I've done and it almost works perfectly so far. I just had
</I>&gt;&gt;<i> &gt; to
</I>&gt;&gt;<i> &gt; add get-children to make the widgets visible in the tree view of glade
</I>&gt;&gt;<i> &gt; (I'm
</I>&gt;&gt;<i> &gt; still not sure why).
</I>&gt;&gt;<i> &gt; So the problem I have is that is I add 1 to the column number, the
</I>&gt;&gt;<i> &gt; widget
</I>&gt;&gt;<i> &gt; will add buttons automatically and make glade widgets too. However, only
</I>&gt;&gt;<i> &gt; the
</I>&gt;&gt;<i> &gt; widget tree view in glade will not update.
</I>&gt;&gt;<i> &gt; It will only update on creation of the widget, or when I load it from a
</I>&gt;&gt;<i> &gt; saved file.
</I>&gt;&gt;<i> &gt; Yesterday I found that get-internal-child is called when I load it from
</I>&gt;&gt;<i> &gt; a
</I>&gt;&gt;<i> &gt; saved file, so I was thinking that maybe I have to make a call to a
</I>&gt;&gt;<i> &gt; function
</I>&gt;&gt;<i> &gt; or send a signal for the tree-view to get internal children again?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; On Mon, Oct 4, 2010 at 18:20, Tristan Van Berkom &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">tvb at gnome.org</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; On Tue, Oct 5, 2010 at 12:18 AM, Klaim &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">mjklaim at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt; Hi,
</I>&gt;&gt;<i> &gt;&gt; &gt; as disscussed there
</I>&gt;&gt;<i> &gt;&gt; &gt; :&#160;<A HREF="http://www.gtkforums.com/viewtopic.php?p=18030#18030">http://www.gtkforums.com/viewtopic.php?p=18030#18030</A>
</I>&gt;&gt;<i> &gt;&gt; &gt; I've managed to make my sub-widgets appear where I wanted, in the
</I>&gt;&gt;<i> &gt;&gt; &gt; treeview.
</I>&gt;&gt;<i> &gt;&gt; &gt; However, the treeview content will not be updated when I'll add new
</I>&gt;&gt;<i> &gt;&gt; &gt; seb-widget to my custom widget, or remove some from it.
</I>&gt;&gt;<i> &gt;&gt; &gt; I've been analzing and trying to reproduce some techniques that are
</I>&gt;&gt;<i> &gt;&gt; &gt; used
</I>&gt;&gt;<i> &gt;&gt; &gt; in
</I>&gt;&gt;<i> &gt;&gt; &gt; gtk widgets plugin code that we can find here :
</I>&gt;&gt;<i> &gt;&gt; &gt; <A HREF="http://git.gnome.org/browse/glade3/tree/plugins/gtk+/glade-gtk.c">http://git.gnome.org/browse/glade3/tree/plugins/gtk+/glade-gtk.c</A>
</I>&gt;&gt;<i> &gt;&gt; &gt; I've been trying for several days but couldn't update the tree view.
</I>&gt;&gt;<i> &gt;&gt; &gt; I've implemented a plugin for glade, it provide (wired in the xml
</I>&gt;&gt;<i> &gt;&gt; &gt; file)
</I>&gt;&gt;<i> &gt;&gt; &gt; :
</I>&gt;&gt;<i> &gt;&gt; &gt; &#160;&#160; &#160;post-create-function
</I>&gt;&gt;<i> &gt;&gt; &gt; &#160;&#160; &#160;set-property-function
</I>&gt;&gt;<i> &gt;&gt; &gt; &#160;&#160; &#160;get-internal-child-function
</I>&gt;&gt;<i> &gt;&gt; &gt; &#160;&#160; &#160;get-children-function
</I>&gt;&gt;<i> &gt;&gt; &gt; I see that the get-internal-child-function is not even called by
</I>&gt;&gt;<i> &gt;&gt; &gt; glade
</I>&gt;&gt;<i> &gt;&gt; &gt; (then
</I>&gt;&gt;<i> &gt;&gt; &gt; I don't undersand when it should be called) but at the moment I
</I>&gt;&gt;<i> &gt;&gt; &gt; implemented
</I>&gt;&gt;<i> &gt;&gt; &gt; get-children-function I started to see the subwidgets in the glade
</I>&gt;&gt;<i> &gt;&gt; &gt; tree-view.
</I>&gt;&gt;<i> &gt;&gt; &gt; I've been following advices given there
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; :&#160;<A HREF="http://www.mail-archive.com/gtk-app-devel-list@gnome.org/msg12349.html">http://www.mail-archive.com/gtk-app-devel-list@gnome.org/msg12349.html</A>
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; I think I'm missing something simple as the gtk glade plugin code
</I>&gt;&gt;<i> &gt;&gt; &gt; don't
</I>&gt;&gt;<i> &gt;&gt; &gt; seem
</I>&gt;&gt;<i> &gt;&gt; &gt; too complicated but I can't find how it makes the sub-children
</I>&gt;&gt;<i> &gt;&gt; &gt; updated
</I>&gt;&gt;<i> &gt;&gt; &gt; in
</I>&gt;&gt;<i> &gt;&gt; &gt; the treeview.
</I>&gt;&gt;<i> &gt;&gt; &gt; When I load a gui built with glade and saved with modified number of
</I>&gt;&gt;<i> &gt;&gt; &gt; sub-widgets in my custom widget, I get the right count of sub-widgets
</I>&gt;&gt;<i> &gt;&gt; &gt; in
</I>&gt;&gt;<i> &gt;&gt; &gt; the
</I>&gt;&gt;<i> &gt;&gt; &gt; tree-view. Only modifying it will not update the tree-view.
</I>&gt;&gt;<i> &gt;&gt; &gt; My custom widget have two properties with widgets counts that will
</I>&gt;&gt;<i> &gt;&gt; &gt; add
</I>&gt;&gt;<i> &gt;&gt; &gt; or
</I>&gt;&gt;<i> &gt;&gt; &gt; remove widgets from the custom widget (in the widget code).
</I>&gt;&gt;<i> &gt;&gt; &gt; So in the plugin I've only added in post-create-function and
</I>&gt;&gt;<i> &gt;&gt; &gt; set-property-functino some way to call
</I>&gt;&gt;<i> &gt;&gt; &gt; glade_widget_adaptor_create_internal() on new digets added to the
</I>&gt;&gt;<i> &gt;&gt; &gt; custom
</I>&gt;&gt;<i> &gt;&gt; &gt; widget.
</I>&gt;&gt;<i> &gt;&gt; &gt; It's the same function that is called in the two functions but it
</I>&gt;&gt;<i> &gt;&gt; &gt; seem
</I>&gt;&gt;<i> &gt;&gt; &gt; to
</I>&gt;&gt;<i> &gt;&gt; &gt; work only with post-create-function.
</I>&gt;&gt;<i> &gt;&gt; &gt; Any suggestion?
</I>&gt;&gt;<i> &gt;&gt; &gt; I'm not sure if that question is clear enough, but tell me if it's
</I>&gt;&gt;<i> &gt;&gt; &gt; not.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; I'm a little confused about what exactly is not working for you.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; If you have a custom widget that is a GtkContainer, so long as
</I>&gt;&gt;<i> &gt;&gt; it works like an ordinary container you should not need to implement
</I>&gt;&gt;<i> &gt;&gt; anything custom along the lines of get-children or any of that.
</I>&gt;&gt;<i> &gt;&gt; (take the GtkBox implementation for reference in this case; it
</I>&gt;&gt;<i> &gt;&gt; uses a virtual 'size' property to decide how many placeholders
</I>&gt;&gt;<i> &gt;&gt; to expose in the Glade workspace).
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Note that get-internal-child is for indirect children of composite
</I>&gt;&gt;<i> &gt;&gt; widgets. Thats what lets a GtkDialog configure properties and
</I>&gt;&gt;<i> &gt;&gt; add children to its internal 'vbox' or 'action-area' (I think thats
</I>&gt;&gt;<i> &gt;&gt; out of context for you, I think you just have a normal container).
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; What you need to do when implementing a normal container
</I>&gt;&gt;<i> &gt;&gt; is usually add placeholders to it if and when appropriate; then
</I>&gt;&gt;<i> &gt;&gt; you need to implement add-child-function/remove-child-function
</I>&gt;&gt;<i> &gt;&gt; and replace-child-function (replace-child will be called if your
</I>&gt;&gt;<i> &gt;&gt; plugin uses GladePlaceholder ... the Glade core will replace
</I>&gt;&gt;<i> &gt;&gt; the placeholder with a widget from the palette; giving it the
</I>&gt;&gt;<i> &gt;&gt; initial packing properties of the placeholder).
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; So, generally you should just start with add-child and remove-child
</I>&gt;&gt;<i> &gt;&gt; functions... you should not need to call
</I>&gt;&gt;<i> &gt;&gt; glade_widget_adaptor_create_internal()
</I>&gt;&gt;<i> &gt;&gt; unless you are exposing an internal child of a complex composite
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; You dont need to implement get-children-function either unless you need
</I>&gt;&gt;<i> &gt;&gt; to add something to the generic child list already returned by your
</I>&gt;&gt;<i> &gt;&gt; container's implementation of GtkContainerClass-&gt;forall().
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Does that help ?
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Please let me know in more detail what is the nature of your container
</I>&gt;&gt;<i> &gt;&gt; so I can better help you, is it a basic container widget that only lays
</I>&gt;&gt;<i> &gt;&gt; out
</I>&gt;&gt;<i> &gt;&gt; it's children in a custom way ?
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Cheers,
</I>&gt;&gt;<i> &gt;&gt; &#160; &#160; &#160; &#160; -Tristan
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Thanks for reading
</I>&gt;&gt;<i> &gt;&gt; &gt; Joel Lamotte.
</I>&gt;&gt;<i> &gt;&gt; &gt; _______________________________________________
</I>&gt;&gt;<i> &gt;&gt; &gt; Glade-users maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">Glade-users at lists.ximian.com</A>
</I>&gt;&gt;<i> &gt;&gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">http://lists.ximian.com/mailman/listinfo/glade-users</A>
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Glade-users maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">Glade-users at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/glade-users">http://lists.ximian.com/mailman/listinfo/glade-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005111.html">[Glade-users] Viewing custom widget sub-widgets in Glade	tree-view
</A></li>
	<LI>Next message: <A HREF="005113.html">[Glade-users] Limit combobox items
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5112">[ date ]</a>
              <a href="thread.html#5112">[ thread ]</a>
              <a href="subject.html#5112">[ subject ]</a>
              <a href="author.html#5112">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/glade-users">More information about the Glade-users
mailing list</a><br>
</body></html>
