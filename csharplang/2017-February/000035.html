<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [csharplang] Operators should be exposed for `System.IntPtr`	and `System.UIntPtr`
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:csharplang%40lists.dot.net?Subject=Re%3A%20%5Bcsharplang%5D%20Operators%20should%20be%20exposed%20for%20%60System.IntPtr%60%0A%09and%20%60System.UIntPtr%60&In-Reply-To=%3CCABoMf7%3Ds8Kgu2mtHx98%2B_vAxc8Bt9Sc3ZK%2Bu6bfo9EvvoDZPow%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000033.html">
   <LINK REL="Next"  HREF="000037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[csharplang] Operators should be exposed for `System.IntPtr`	and `System.UIntPtr`</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:csharplang%40lists.dot.net?Subject=Re%3A%20%5Bcsharplang%5D%20Operators%20should%20be%20exposed%20for%20%60System.IntPtr%60%0A%09and%20%60System.UIntPtr%60&In-Reply-To=%3CCABoMf7%3Ds8Kgu2mtHx98%2B_vAxc8Bt9Sc3ZK%2Bu6bfo9EvvoDZPow%40mail.gmail.com%3E"
       TITLE="[csharplang] Operators should be exposed for `System.IntPtr`	and `System.UIntPtr`">miguel.de.icaza at gmail.com
       </A><BR>
    <I>Fri Feb  3 03:37:09 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000033.html">[csharplang] Operators should be exposed for `System.IntPtr`	and `System.UIntPtr`
</A></li>
        <LI>Next message (by thread): <A HREF="000037.html">[csharplang] Operators should be exposed for `System.IntPtr` and `System.UIntPtr`
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35">[ date ]</a>
              <a href="thread.html#35">[ thread ]</a>
              <a href="subject.html#35">[ subject ]</a>
              <a href="author.html#35">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Addendum, for those of us not tracking all the sausage making details of
.NET at home.

Requiring a new mscorlib.dll is problematic, because it means that the
generated code would only work on systems that have an updated version of
.NET, which would rule out being able to use C# to target older systems
like Windows 7 or Windows 8.

Miguel.

On Thu, Feb 2, 2017 at 9:50 PM, Miguel de Icaza &lt;<A HREF="http://lists.dot.net/mailman/listinfo/csharplang">miguel.de.icaza at gmail.com</A>&gt;
wrote:

&gt;<i> While the various operations on data types on C# are specified in in terms
</I>&gt;<i> of &quot;operator X&quot; in the ECMA spec, the implementation of the operators has
</I>&gt;<i> historically been embedded in the compiler.
</I>&gt;<i>
</I>&gt;<i> While the runtime could certainly do the work of mapping &quot;call op_Foo&quot;
</I>&gt;<i> into the equivalent operation these would be more special cases for all the
</I>&gt;<i> assorted runtimes that exist to be updated to support this.
</I>&gt;<i>
</I>&gt;<i> Additionally, it would make code compiled with the new runtime require a
</I>&gt;<i> fresher version of mscorlib.dll to contain the operator operations.
</I>&gt;<i>
</I>&gt;<i> Given the above, I believe that if we want to add this operations to
</I>&gt;<i> IntPtr and UIntPtr, that we should have the compiler get the knowledge to
</I>&gt;<i> do this.
</I>&gt;<i>
</I>&gt;<i> Miguel.
</I>&gt;<i>
</I>&gt;<i> On Thu, Feb 2, 2017 at 9:44 PM, Cyrus Najmabadi via csharplang &lt;
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">csharplang at lists.dot.net</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Why can’t the implementation of those operators just be implemented in
</I>&gt;&gt;<i> terms of those opcodes.  Certainly the JIT/runtime would then inline all of
</I>&gt;&gt;<i> that effectively?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>           -- Cyrus
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *From:* Justin Spindler [mailto:<A HREF="http://lists.dot.net/mailman/listinfo/csharplang">justin.spindler at gmail.com</A>]
</I>&gt;&gt;<i> *Sent:* Thursday, February 2, 2017 6:22 PM
</I>&gt;&gt;<i> *To:* Cyrus Najmabadi &lt;<A HREF="http://lists.dot.net/mailman/listinfo/csharplang">cyrusn at microsoft.com</A>&gt;
</I>&gt;&gt;<i> *Cc:* Tanner Gooding &lt;<A HREF="http://lists.dot.net/mailman/listinfo/csharplang">tagoo at microsoft.com</A>&gt;; <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">csharplang at lists.dot.net</A>
</I>&gt;&gt;<i> *Subject:* Re: [csharplang] Operators should be exposed for
</I>&gt;&gt;<i> `System.IntPtr` and `System.UIntPtr`
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Primitive arithmetic operations are a concern of the compiler, which
</I>&gt;&gt;<i> needs to emit the appropriate opcodes to perform the operation.  C#-style
</I>&gt;&gt;<i> overloaded operators aren't declared on these types.  There is no
</I>&gt;&gt;<i> Int32.op_Addition, etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Feb 2, 2017 at 9:14 PM, Cyrus Najmabadi via csharplang &lt;
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">csharplang at lists.dot.net</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Why not just add the actual operators to the System.IntPtr and
</I>&gt;&gt;<i> System.UIntPtr structs?  It’s unclear to me why we’d need anything specific
</I>&gt;&gt;<i> in C# for these types.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            -- Cyrus
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *From:* csharplang [mailto:<A HREF="http://lists.dot.net/mailman/listinfo/csharplang">csharplang-bounces at lists.dot.net</A>] *On Behalf
</I>&gt;&gt;<i> Of *Tanner Gooding via csharplang
</I>&gt;&gt;<i> *Sent:* Thursday, February 2, 2017 3:58 PM
</I>&gt;&gt;<i> *To:* <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">csharplang at lists.dot.net</A>
</I>&gt;&gt;<i> *Subject:* [csharplang] Operators should be exposed for `System.IntPtr`
</I>&gt;&gt;<i> and `System.UIntPtr`
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Copied from: <A HREF="https://github.com/dotnet/roslyn/issues/12836">https://github.com/dotnet/roslyn/issues/12836</A>
</I>&gt;&gt;<i> &lt;<A HREF="https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fdotnet%2Froslyn%2Fissues%2F12836&amp;data=02%7C01%7Ccyrusn%40microsoft.com%7C6d6a112dd88541693c2208d44bdb7819%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636216853371146110&amp;sdata=IGZbU13gY11ew%2BPWfeVawC4tW2NGhqa9ScSR7P4vh98%3D&amp;reserved=0">https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fdotnet%2Froslyn%2Fissues%2F12836&amp;data=02%7C01%7Ccyrusn%40microsoft.com%7C6d6a112dd88541693c2208d44bdb7819%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636216853371146110&amp;sdata=IGZbU13gY11ew%2BPWfeVawC4tW2NGhqa9ScSR7P4vh98%3D&amp;reserved=0</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *Issue:*
</I>&gt;&gt;<i> The CLR supports a set of operators for the System.IntPtr and System.U
</I>&gt;&gt;<i> IntPtr types (native int). These operators can be seen in III.1.5 of the
</I>&gt;&gt;<i> Command Language Infrastructure specification. However, these operators are
</I>&gt;&gt;<i> not supported by the C#.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *Workaround:*
</I>&gt;&gt;<i> Either directly emit IL or write non-optimal code that does not directly
</I>&gt;&gt;<i> translate to the appropriate IL instructions.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *Request:*
</I>&gt;&gt;<i> Language support should be provided for the full set of operators
</I>&gt;&gt;<i> supported by System.IntPtr and System.UIntPtr. These operators are: Add,
</I>&gt;&gt;<i> Divide, Multiply, Remainder, Subtract, Negate, Equals, Compare, And, Not
</I>&gt;&gt;<i> , Or, XOr, ShiftLeft, ShiftRight.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *Other Thoughts:*
</I>&gt;&gt;<i> C# seems to treat both IntPtr and UIntPtr as a type only used for
</I>&gt;&gt;<i> interop and for representing pointers in a 'safe' manner, when it is really
</I>&gt;&gt;<i> just:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> an integer whose size is platform-specific.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It should be possible for a user to treat the IntPtr and UIntPtr types
</I>&gt;&gt;<i> as an equivalent to the native size_t type. However, in order to do
</I>&gt;&gt;<i> that, one must may have to deal with one or more of the following:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    - Perform multiple levels of casting
</I>&gt;&gt;<i>    - Use integers whose size is larger than their platform's native size
</I>&gt;&gt;<i>    - Have branching to use integers that are platform-specific
</I>&gt;&gt;<i>    - Work with unsafe code and do pointer arithmetic
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Tanner Gooding
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> csharplang mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">csharplang at lists.dot.net</A>
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">http://lists.dot.net/mailman/listinfo/csharplang</A>
</I>&gt;&gt;<i> &lt;<A HREF="https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.dot.net%2Fmailman%2Flistinfo%2Fcsharplang&amp;data=02%7C01%7Ccyrusn%40microsoft.com%7C6d6a112dd88541693c2208d44bdb7819%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636216853371146110&amp;sdata=Rbn5dxTPxjfQNXPs8UFBR69jS8xdsUM751bLptURhvI%3D&amp;reserved=0">https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.dot.net%2Fmailman%2Flistinfo%2Fcsharplang&amp;data=02%7C01%7Ccyrusn%40microsoft.com%7C6d6a112dd88541693c2208d44bdb7819%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636216853371146110&amp;sdata=Rbn5dxTPxjfQNXPs8UFBR69jS8xdsUM751bLptURhvI%3D&amp;reserved=0</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> csharplang mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">csharplang at lists.dot.net</A>
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/csharplang">http://lists.dot.net/mailman/listinfo/csharplang</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/csharplang/attachments/20170202/973e0b74/attachment.html">http://lists.dot.net/pipermail/csharplang/attachments/20170202/973e0b74/attachment.html</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000033.html">[csharplang] Operators should be exposed for `System.IntPtr`	and `System.UIntPtr`
</A></li>
	<LI>Next message (by thread): <A HREF="000037.html">[csharplang] Operators should be exposed for `System.IntPtr` and `System.UIntPtr`
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35">[ date ]</a>
              <a href="thread.html#35">[ thread ]</a>
              <a href="subject.html#35">[ subject ]</a>
              <a href="author.html#35">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/csharplang">More information about the csharplang
mailing list</a><br>
</body></html>
