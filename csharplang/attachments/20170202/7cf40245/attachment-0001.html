<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;a&nbsp;href=&quot;https://github.com/dotnet/roslyn/issues/1165&quot;&gt;https://github.com/dotnet/roslyn/issues/1165&lt;/a&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;h2&nbsp;style=&quot;box-sizing:border-box;margin-bottom:16px;line-height:1.25;padding-bottom:0.3em;border-bottom:1px&nbsp;solid&nbsp;rgb(238,238,238);color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;margin-top:0px&quot;&gt;Background&lt;/h2&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;In&nbsp;my&nbsp;opinion&nbsp;one&nbsp;of&nbsp;the&nbsp;more&nbsp;interesting&nbsp;ideas&nbsp;in&nbsp;the&nbsp;Polyphonic&nbsp;C#&nbsp;and&nbsp;Cω&nbsp;languages&nbsp;out&nbsp;of&nbsp;Microsoft&nbsp;Research&nbsp;was&nbsp;&quot;asynchronous&nbsp;method&nbsp;chords&quot;.&nbsp;Combined&nbsp;with&nbsp;asynchronous&nbsp;methods&nbsp;this&nbsp;simple&nbsp;syntax&nbsp;provided&nbsp;one&nbsp;of&nbsp;the&nbsp;most&nbsp;elegant&nbsp;ways&nbsp;to&nbsp;express&nbsp;complex&nbsp;synchronization&nbsp;between&nbsp;two&nbsp;or&nbsp;more&nbsp;asynchronous&nbsp;operations.&lt;/p&gt;&lt;h2&nbsp;style=&quot;box-sizing:border-box;margin-top:24px;margin-bottom:16px;line-height:1.25;padding-bottom:0.3em;border-bottom:1px&nbsp;solid&nbsp;rgb(238,238,238);color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;&quot;&gt;Proposal&lt;/h2&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;An&nbsp;asynchronous&nbsp;pattern&nbsp;is&nbsp;comprised&nbsp;of&nbsp;two&nbsp;parts.&lt;/p&gt;&lt;h4&nbsp;style=&quot;box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:14px;line-height:1.25;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;&quot;&gt;Mailbox&nbsp;Methods&lt;/h4&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;The&nbsp;first&nbsp;part&nbsp;is&nbsp;an&nbsp;asynchronous&nbsp;method&nbsp;which&nbsp;has&nbsp;no&nbsp;body&nbsp;and&nbsp;must&nbsp;return &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;void&lt;/code&gt;.&nbsp;This&nbsp;method&nbsp;serves&nbsp;as&nbsp;a&nbsp;notification&nbsp;primitive.&nbsp;Invoking&nbsp;the&nbsp;method&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;posting&nbsp;a&nbsp;message&nbsp;where&nbsp;the&nbsp;arguments&nbsp;are&nbsp;additional&nbsp;pieces&nbsp;of&nbsp;data&nbsp;transmitted&nbsp;with&nbsp;the&nbsp;message.&lt;/p&gt;&lt;div&nbsp;class=&quot;gmail-highlight&nbsp;gmail-highlight-source-cs&quot;&nbsp;style=&quot;box-sizing:border-box;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px;overflow:visible&quot;&gt;&lt;pre&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;margin-top:0px;margin-bottom:0px;font-stretch:normal;line-height:1.45;word-wrap:normal;padding:16px;overflow:auto;background-color:rgb(247,247,247);border-radius:3px;word-break:normal&quot;&gt;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;async&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;void&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Add&lt;/span&gt;(&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-smi&quot;&nbsp;style=&quot;box-sizing:border-box&quot;&gt;value&lt;/span&gt;);<br>
&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;async&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;void&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Done&lt;/span&gt;();&lt;/pre&gt;&lt;/div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;When&nbsp;invoked&nbsp;a&nbsp;mailbox&nbsp;method&nbsp;effectively&nbsp;returns&nbsp;immediately&nbsp;to&nbsp;the&nbsp;caller&nbsp;and&nbsp;can&nbsp;never&nbsp;throw&nbsp;exceptions.&lt;/p&gt;&lt;h4&nbsp;style=&quot;box-sizing:border-box;margin-top:24px;margin-bottom:16px;font-size:14px;line-height:1.25;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;&quot;&gt;Pattern&nbsp;Methods&lt;/h4&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;The&nbsp;second&nbsp;part&nbsp;is&nbsp;an&nbsp;asynchronous&nbsp;pattern&nbsp;method&nbsp;which&nbsp;may&nbsp;return &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;void&lt;/code&gt;, &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;/code&gt; or &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;T&gt;&lt;/code&gt; and&nbsp;has&nbsp;a&nbsp;normal&nbsp;method&nbsp;body.&nbsp;This&nbsp;method&nbsp;is&nbsp;decorated&nbsp;with&nbsp;one&nbsp;or&nbsp;more &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;&amp;&lt;/code&gt; join&nbsp;operators&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;signature&nbsp;of&nbsp;a&nbsp;mailbox&nbsp;method&nbsp;between&nbsp;the&nbsp;parameter&nbsp;list&nbsp;and&nbsp;the&nbsp;method&nbsp;body.&nbsp;The&nbsp;parameter&nbsp;names&nbsp;in&nbsp;the&nbsp;joined&nbsp;mailbox&nbsp;signature&nbsp;may&nbsp;be&nbsp;renamed.&nbsp;The&nbsp;values&nbsp;of&nbsp;those&nbsp;parameters&nbsp;are&nbsp;available&nbsp;in&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;pattern&nbsp;method.&lt;/p&gt;&lt;div&nbsp;class=&quot;gmail-highlight&nbsp;gmail-highlight-source-cs&quot;&nbsp;style=&quot;box-sizing:border-box;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px;overflow:visible&quot;&gt;&lt;pre&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;margin-top:0px;margin-bottom:0px;font-stretch:normal;line-height:1.45;word-wrap:normal;padding:16px;overflow:auto;background-color:rgb(247,247,247);border-radius:3px;word-break:normal&quot;&gt;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;async&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Task&lt;/span&gt;&lt;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Take&lt;/span&gt;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Add&lt;/span&gt;(&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-smi&quot;&nbsp;style=&quot;box-sizing:border-box&quot;&gt;value&lt;/span&gt;)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;return&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;value&lt;/span&gt;;<br>
}&lt;/pre&gt;&lt;/div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;After&nbsp;the&nbsp;pattern&nbsp;method&nbsp;body&nbsp;more&nbsp;join&nbsp;operations&nbsp;may&nbsp;appear&nbsp;using&nbsp;different&nbsp;permutations&nbsp;of&nbsp;the&nbsp;available&nbsp;mailbox&nbsp;methods.&nbsp;These&nbsp;permutations&nbsp;must&nbsp;be&nbsp;unique&nbsp;per&nbsp;each&nbsp;method&nbsp;body&nbsp;regardless&nbsp;of&nbsp;order.&nbsp;When&nbsp;the&nbsp;pattern&nbsp;method&nbsp;is&nbsp;invoked&nbsp;which&nbsp;body&nbsp;is&nbsp;executed&nbsp;depends&nbsp;on&nbsp;which&nbsp;mailbox&nbsp;methods&nbsp;are&nbsp;invoked.&lt;/p&gt;&lt;div&nbsp;class=&quot;gmail-highlight&nbsp;gmail-highlight-source-cs&quot;&nbsp;style=&quot;box-sizing:border-box;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px;overflow:visible&quot;&gt;&lt;pre&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;margin-top:0px;margin-bottom:0px;font-stretch:normal;line-height:1.45;word-wrap:normal;padding:16px;overflow:auto;background-color:rgb(247,247,247);border-radius:3px;word-break:normal&quot;&gt;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;async&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Task&lt;/span&gt;&lt;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Task&lt;/span&gt;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Add&lt;/span&gt;(&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-smi&quot;&nbsp;style=&quot;box-sizing:border-box&quot;&gt;value&lt;/span&gt;)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;return&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;value&lt;/span&gt;;<br>
}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;Done()<br>
{<br>
&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;throw&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;new&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;TaskCanceledException&lt;/span&gt;(&lt;span&nbsp;class=&quot;gmail-pl-s&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(24,54,145)&quot;&gt;&lt;span&nbsp;class=&quot;gmail-pl-pds&quot;&nbsp;style=&quot;box-sizing:border-box&quot;&gt;&quot;&lt;/span&gt;No&nbsp;more&nbsp;items!&lt;span&nbsp;class=&quot;gmail-pl-pds&quot;&nbsp;style=&quot;box-sizing:border-box&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;);<br>
}&lt;/pre&gt;&lt;/div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;What&nbsp;happens&nbsp;when&nbsp;the&nbsp;pattern&nbsp;method&nbsp;depends&nbsp;on&nbsp;whether&nbsp;there&nbsp;have&nbsp;already&nbsp;been&nbsp;corresponding&nbsp;calls&nbsp;to&nbsp;the&nbsp;mailbox&nbsp;methods.&nbsp;For&nbsp;a&nbsp;pattern&nbsp;method&nbsp;body&nbsp;to&nbsp;be&nbsp;executed&nbsp;there&nbsp;must&nbsp;be&nbsp;corresponding&nbsp;calls&nbsp;to&nbsp;every&nbsp;mailbox&nbsp;method&nbsp;on&nbsp;which&nbsp;it&nbsp;joins.&lt;/p&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;If&nbsp;there&nbsp;are&nbsp;no&nbsp;corresponding&nbsp;calls&nbsp;to&nbsp;the&nbsp;mailbox&nbsp;methods&nbsp;for&nbsp;any&nbsp;of&nbsp;the&nbsp;pattern&nbsp;methods&nbsp;then&nbsp;the&nbsp;method&nbsp;returns&nbsp;immediately.&nbsp;Once&nbsp;a&nbsp;mailbox&nbsp;method&nbsp;is&nbsp;called&nbsp;which&nbsp;satisfies&nbsp;the&nbsp;pattern&nbsp;method&nbsp;then&nbsp;that&nbsp;pattern&nbsp;method&nbsp;body&nbsp;will&nbsp;be&nbsp;executed&nbsp;on&nbsp;the&nbsp;same&nbsp;thread&nbsp;that&nbsp;invoked&nbsp;the&nbsp;mailbox&nbsp;method.&lt;/p&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;If&nbsp;the&nbsp;method&nbsp;returns &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;/code&gt; or &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;T&gt;&lt;/code&gt; the&nbsp;returned&nbsp;task&nbsp;is&nbsp;incomplete.&nbsp;If&nbsp;there&nbsp;are&nbsp;corresponding&nbsp;calls&nbsp;to&nbsp;the&nbsp;signal&nbsp;methods&nbsp;for&nbsp;a&nbsp;pattern&nbsp;method&nbsp;then&nbsp;the&nbsp;method&nbsp;is&nbsp;invoked&nbsp;on&nbsp;the&nbsp;current&nbsp;thread.&lt;/p&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px&quot;&gt;One&nbsp;the&nbsp;pattern&nbsp;method&nbsp;body&nbsp;is&nbsp;executing&nbsp;it&nbsp;behaves&nbsp;like&nbsp;a&nbsp;normal&nbsp;asynchronous&nbsp;method.&nbsp;It&nbsp;may&nbsp;use&nbsp;the &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;await&lt;/code&gt; keyword&nbsp;to&nbsp;await&nbsp;on&nbsp;other&nbsp;asynchronous&nbsp;operations,&nbsp;including&nbsp;other&nbsp;pattern&nbsp;methods.&nbsp;It&nbsp;may&nbsp;return&nbsp;a&nbsp;value&nbsp;which&nbsp;sets&nbsp;the&nbsp;result&nbsp;on&nbsp;the&nbsp;returned &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;/code&gt; or &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;T&gt;&lt;/code&gt; instance,&nbsp;or&nbsp;it&nbsp;may&nbsp;throw&nbsp;an&nbsp;exception&nbsp;which&nbsp;sets&nbsp;the&nbsp;exception&nbsp;on&nbsp;the&nbsp;returned &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;/code&gt; or &lt;code&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;padding:0.2em&nbsp;0px;margin:0px;background-color:rgba(0,0,0,0.0392157);border-radius:3px&quot;&gt;Task&lt;T&gt;&lt;/code&gt; instance.&lt;/p&gt;&lt;div&nbsp;class=&quot;gmail-highlight&nbsp;gmail-highlight-source-cs&quot;&nbsp;style=&quot;box-sizing:border-box;margin-bottom:16px;color:rgb(51,51,51);font-family:-apple-system,blinkmacsystemfont,&quot;segoe&nbsp;ui&quot;,helvetica,arial,sans-serif,&quot;apple&nbsp;color&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;emoji&quot;,&quot;segoe&nbsp;ui&nbsp;symbol&quot;;font-size:14px;overflow:visible&quot;&gt;&lt;pre&nbsp;style=&quot;box-sizing:border-box;font-family:consolas,&quot;liberation&nbsp;mono&quot;,menlo,courier,monospace;font-size:11.9px;margin-top:0px;margin-bottom:0px;font-stretch:normal;line-height:1.45;word-wrap:normal;padding:16px;overflow:auto;background-color:rgb(247,247,247);border-radius:3px;word-break:normal&quot;&gt;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;class&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;PatternQueue&lt;/span&gt;&lt;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&gt;<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;async&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;void&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Add&lt;/span&gt;(&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-smi&quot;&nbsp;style=&quot;box-sizing:border-box&quot;&gt;value&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;async&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;void&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Done&lt;/span&gt;();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;public&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;async&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Task&lt;/span&gt;&lt;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Get&lt;/span&gt;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Add&lt;/span&gt;(&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;T&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-smi&quot;&nbsp;style=&quot;box-sizing:border-box&quot;&gt;value&lt;/span&gt;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;return&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;value&lt;/span&gt;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Done&lt;/span&gt;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;throw&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;new&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;TaskCanceledException&lt;/span&gt;();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>
<br>
&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;static&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;class&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Program&lt;/span&gt;<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;static&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;void&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;Main&lt;/span&gt;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;var&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;queue&nbsp;&lt;/span&gt;=&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;new&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;PatternQueue&lt;/span&gt;&lt;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;int&lt;/span&gt;&gt;();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;var&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;task1&nbsp;&lt;/span&gt;=&nbsp;queue.Get();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task1.IsCompleted&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;false&lt;/span&gt;);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue.Add(&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;5&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task1.IsCompleted&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;true&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task1.Result&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;5&lt;/span&gt;);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue.Add(&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;6&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue.Add(&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;7&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;var&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;task2&nbsp;&lt;/span&gt;=&nbsp;queue.Get();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task2.IsCompleted&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;true&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task2.Result&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;6&lt;/span&gt;);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue.Done();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;var&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;task3&nbsp;&lt;/span&gt;=&nbsp;queue.Get();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task3.IsCompleted&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;true&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task3.IsCanceled&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;false&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task3.Result&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;7&lt;/span&gt;);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-k&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(167,29,93)&quot;&gt;var&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-en&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(121,93,163)&quot;&gt;task4&nbsp;&lt;/span&gt;=&nbsp;queue.Get();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Debug.Assert(task4.IsCanceled&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;gmail-pl-c1&quot;&nbsp;style=&quot;box-sizing:border-box;color:rgb(0,134,179)&quot;&gt;true&lt;/span&gt;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
