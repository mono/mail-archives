<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2574 - in trunk/MonoDevelop/Core/src:	MonoDevelop.Base MonoDevelop.Base/Gui/Workbench/Layouts	MonoDevelop.Gui.Utils MonoDevelop.Gui.Utils/FileIcons
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2574%20-%20in%20trunk/MonoDevelop/Core/src%3A%0A%09MonoDevelop.Base%20MonoDevelop.Base/Gui/Workbench/Layouts%0A%09MonoDevelop.Gui.Utils%20MonoDevelop.Gui.Utils/FileIcons&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002173.html">
   <LINK REL="Next"  HREF="002175.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2574 - in trunk/MonoDevelop/Core/src:	MonoDevelop.Base MonoDevelop.Base/Gui/Workbench/Layouts	MonoDevelop.Gui.Utils MonoDevelop.Gui.Utils/FileIcons</H1>
    <B>John Luke &lt;jluke@cfl.rr.com&gt;</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2574%20-%20in%20trunk/MonoDevelop/Core/src%3A%0A%09MonoDevelop.Base%20MonoDevelop.Base/Gui/Workbench/Layouts%0A%09MonoDevelop.Gui.Utils%20MonoDevelop.Gui.Utils/FileIcons&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2574 - in trunk/MonoDevelop/Core/src:	MonoDevelop.Base MonoDevelop.Base/Gui/Workbench/Layouts	MonoDevelop.Gui.Utils MonoDevelop.Gui.Utils/FileIcons">jluke at mono-cvs.ximian.com
       </A><BR>
    <I>Wed Jun  1 12:47:51 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002173.html">[Monodevelop-patches-list] r2573 - in trunk/MonoDevelop/Core/src:	MonoDevelop.Base MonoDevelop.Base/Gui/Pads/FileScout	MonoDevelop.Base/Gui/Workbench/Layouts MonoDevelop.Gui.Utils	MonoDevelop.Gui.Utils/FileIcons MonoDevelop.Gui.Widgets	MonoDevelop.Gui.Widgets/FileBrowser
</A></li>
        <LI>Next message: <A HREF="002175.html">[Monodevelop-patches-list] r2575 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets: . FileBrowser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2174">[ date ]</a>
              <a href="thread.html#2174">[ thread ]</a>
              <a href="subject.html#2174">[ subject ]</a>
              <a href="author.html#2174">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jluke
Date: 2005-06-01 12:47:51 -0400 (Wed, 01 Jun 2005)
New Revision: 2574

Modified:
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceWindow.cs
   trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/ChangeLog
   trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/FileIcons/FileIconLoader.cs
Log:
use Gtk.IconTheme to load the icons


Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog	2005-06-01 15:21:47 UTC (rev 2573)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog	2005-06-01 16:47:51 UTC (rev 2574)
@@ -3,7 +3,7 @@
 	* Gui/Workbench/Layouts/SdiWorkspaceLayout.cs:
 	* Gui/Workbench/Layouts/SdiWorkspaceWindow.cs:
 	* Gui/Pads/FileScout/FileListItem.cs: adjust to
-	FileIconLoader.GetPixbufForFile change
+	FileIconLoader changes
 	
 2005-06-01  Jacob Ils&#248; Christensen  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jacobilsoe at gmail.com</A>&gt;
 

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs	2005-06-01 15:21:47 UTC (rev 2573)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs	2005-06-01 16:47:51 UTC (rev 2574)
@@ -462,7 +462,7 @@
 		{	
 			Gtk.Image mimeimage = null;
 			if (content.IsUntitled) {
-				mimeimage = new Gtk.Image (FileIconLoader.GetPixbufForType (&quot;gnome-fs-regular&quot;).ScaleSimple (16, 16, Gdk.InterpType.Bilinear));
+				mimeimage = new Gtk.Image (FileIconLoader.GetPixbufForType (&quot;gnome-fs-regular&quot;, 16));
 			} else {
 				mimeimage = new Gtk.Image (FileIconLoader.GetPixbufForFile (content.ContentName, 16));
 			}

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceWindow.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceWindow.cs	2005-06-01 15:21:47 UTC (rev 2573)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Workbench/Layouts/SdiWorkspaceWindow.cs	2005-06-01 16:47:51 UTC (rev 2574)
@@ -316,7 +316,7 @@
 					tabLabel.Icon.Pixbuf = FileIconLoader.GetPixbufForFile (content.ContentName, 16);
 				}
 			} catch {
-				tabLabel.Icon.Pixbuf = FileIconLoader.GetPixbufForType (&quot;gnome-fs-regular&quot;).ScaleSimple (16, 16, Gdk.InterpType.Bilinear);
+				tabLabel.Icon.Pixbuf = FileIconLoader.GetPixbufForType (&quot;gnome-fs-regular&quot;, 16);
 			}
 			if (TitleChanged != null) {
 				TitleChanged(this, e);

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/ChangeLog	2005-06-01 15:21:47 UTC (rev 2573)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/ChangeLog	2005-06-01 16:47:51 UTC (rev 2574)
@@ -2,6 +2,9 @@
 
 	* FileIcons/FileIconLoader.cs (GetPixbufForFile):
 	just use size instead of height, width
+
+	* FileIcons/FileIconLoader.cs: use Gtk.IconTheme to load
+	icons, simplify and size appropriately
 	
 2005-04-17  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
 

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/FileIcons/FileIconLoader.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/FileIcons/FileIconLoader.cs	2005-06-01 15:21:47 UTC (rev 2573)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Utils/FileIcons/FileIconLoader.cs	2005-06-01 16:47:51 UTC (rev 2574)
@@ -1,22 +1,19 @@
 using System;
 using System.Collections;
 
-using Gnome;
+using Gtk;
 
 namespace MonoDevelop.Gui.Utils
 {
-
-	public class FileIconLoader
+	public sealed class FileIconLoader
 	{
-
-		static Gnome.IconTheme iconTheme;
+		static Gdk.Pixbuf defaultIcon;
 		static Gnome.ThumbnailFactory thumbnailFactory;
 		static Hashtable iconHash;
 
 		static FileIconLoader ()
 		{
-			iconTheme = new Gnome.IconTheme ();
-			thumbnailFactory = new Gnome.ThumbnailFactory (ThumbnailSize.Normal);
+			thumbnailFactory = new Gnome.ThumbnailFactory (Gnome.ThumbnailSize.Normal);
 			iconHash = new Hashtable ();
 		}
 
@@ -24,6 +21,15 @@
 		{
 		}
 
+		public static Gdk.Pixbuf DefaultIcon {
+			get {
+				if (defaultIcon == null)
+					defaultIcon = new Gdk.Pixbuf (&quot;../data/resources/icons/gnome-fs-regular.png&quot;);
+				return defaultIcon;
+			}
+		}
+
+		// FIXME: is there a GTK replacement for Gnome.Icon.LookupSync?
 		public static Gdk.Pixbuf GetPixbufForFile (string filename, int size)
 		{
 			Gnome.IconLookupResultFlags result;
@@ -32,35 +38,26 @@
 				if (filename == &quot;Documentation&quot;)
 					icon = &quot;gnome-fs-regular&quot;;
 				else
-					icon = Gnome.Icon.LookupSync (iconTheme, thumbnailFactory, filename, &quot;&quot;, Gnome.IconLookupFlags.None, out result);
+					icon = Gnome.Icon.LookupSync (IconTheme.Default, thumbnailFactory, filename, &quot;&quot;, Gnome.IconLookupFlags.None, out result);
 			} catch {
 				icon = &quot;gnome-fs-regular&quot;;
 			}
-			Gdk.Pixbuf pix = GetPixbufForType (icon);
-			return pix.ScaleSimple (size, size, Gdk.InterpType.Bilinear);
+			return GetPixbufForType (icon, size);
 		}
 
-		public static Gdk.Pixbuf GetPixbufForType (string type)
+		public static Gdk.Pixbuf GetPixbufForType (string type, int size)
 		{
-			Gdk.Pixbuf bf = (Gdk.Pixbuf) iconHash [type];
+			// FIXME: is caching these really worth it?
+			// we have to cache them in both type and size
+			Gdk.Pixbuf bf = (Gdk.Pixbuf) iconHash [type+size];
 			if (bf == null) {
-				const string default_icon_location = &quot;../data/resources/icons/gnome-fs-regular.png&quot;;
-				string p_filename = &quot;&quot;;
-				try {
-					int i;
-					p_filename = iconTheme.LookupIcon (type, 24, new Gnome.IconData (), out i);
-					if (p_filename.Equals (&quot;&quot;)) {
-						p_filename = default_icon_location;
-					}
-				} catch {
-					p_filename = default_icon_location;
+				bf = IconTheme.Default.LoadIcon (type, size, (IconLookupFlags) 0);
+				if (bf == null) {
+					bf = DefaultIcon;
+					if (bf.Height &gt; size)
+						bf = bf.ScaleSimple (size, size, Gdk.InterpType.Bilinear);
 				}
-				try {
-					bf = new Gdk.Pixbuf (p_filename);
-				} catch {
-					bf = new Gdk.Pixbuf (default_icon_location);
-				}
-				iconHash [type] = bf;
+				iconHash [type+size] = bf;
 			}
 			return bf;
 		}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002173.html">[Monodevelop-patches-list] r2573 - in trunk/MonoDevelop/Core/src:	MonoDevelop.Base MonoDevelop.Base/Gui/Pads/FileScout	MonoDevelop.Base/Gui/Workbench/Layouts MonoDevelop.Gui.Utils	MonoDevelop.Gui.Utils/FileIcons MonoDevelop.Gui.Widgets	MonoDevelop.Gui.Widgets/FileBrowser
</A></li>
	<LI>Next message: <A HREF="002175.html">[Monodevelop-patches-list] r2575 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets: . FileBrowser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2174">[ date ]</a>
              <a href="thread.html#2174">[ thread ]</a>
              <a href="subject.html#2174">[ subject ]</a>
              <a href="author.html#2174">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
