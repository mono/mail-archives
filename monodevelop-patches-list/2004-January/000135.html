<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r520 - trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r520%20-%20trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000133.html">
   <LINK REL="Next"  HREF="000136.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r520 - trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r520%20-%20trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r520 - trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Sat Jan 17 15:27:04 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000133.html">[Monodevelop-patches-list] r519 - in trunk/MonoDevelop: . src/Main/Base/Commands src/Main/Base/Gui/Dialogs/Wizard
</A></li>
        <LI>Next message: <A HREF="000136.html">[Monodevelop-patches-list] r521 - in trunk/MonoDevelop/src/Libraries/MonoDevelop.Gui: . FileEntry
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#135">[ date ]</a>
              <a href="thread.html#135">[ thread ]</a>
              <a href="subject.html#135">[ subject ]</a>
              <a href="author.html#135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dkor
Date: 2004-01-17 15:27:04 -0500 (Sat, 17 Jan 2004)
New Revision: 520

Modified:
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands/ToolCommands.cs
Log:
Unfinished implentation of the Insert Color dialog. Returns incorrect color. Doesn't return string known color values. 


Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands/ToolCommands.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands/ToolCommands.cs	2004-01-17 19:25:23 UTC (rev 519)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Commands/ToolCommands.cs	2004-01-17 20:27:04 UTC (rev 520)
@@ -30,19 +30,67 @@
 using ICSharpCode.SharpDevelop.Gui.HtmlControl;
 using ICSharpCode.Core.Services;
 
+using Gtk;
+using GtkSharp;
+
 namespace ICSharpCode.SharpDevelop.DefaultEditor.Commands
 {
+	public class ColorDialog : ColorSelectionDialog
+	{
+		public ColorDialog () : base (&quot;DON'T use this dialog it DOESN'T work correctly&quot;)
+		{
+			this.ColorSelection.HasPalette = true;
+			this.ColorSelection.HasOpacityControl = false;		
+		}
+		
+		public string ColorStr ()
+		{
+			Gdk.Color color = this.ColorSelection.CurrentColor;
+			StringBuilder s = new StringBuilder ();
+			ushort[] vals = { color.red, color.green, color.blue };
+			// debug line
+			// Console.WriteLine(&quot;r {0}, b {1}, g{2}&quot;, color.red, color.green, color.blue );
+			char[] hexchars = {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'};
+			s.Append (&quot;#FF&quot;);
+			foreach (ushort val in vals) {
+				/* Convert to a range of 0-255, then lookup the
+				 * digit for each half-byte */
+				byte rounded = (byte) (val &gt;&gt; 8);
+				s.Append (hexchars[(rounded &amp; 0xf0) &gt;&gt; 4]);
+				s.Append (hexchars[rounded &amp; 0x0f]);
+			}
+			return s.ToString ();
+		}
+	}
+
 	public class ShowColorDialog : AbstractMenuCommand
 	{
 		public override void Run()
 		{
+
 			IWorkbenchWindow window = WorkbenchSingleton.Workbench.ActiveWorkbenchWindow;
-			
 			if (window == null || !(window.ViewContent is ITextEditorControlProvider)) {
 				return;
 			}
 			TextEditorControl textarea = ((ITextEditorControlProvider)window.ViewContent).TextEditorControl;
-			
+			//FIXME:  
+			// - The return sting value is not the same choosen in the Dialog
+                        // - Return color name (not color value) if it IsKnownColor but it's still not implemented for System.Drawing.Color
+			ColorDialog dialog  = new ColorDialog ();
+			if ( dialog.Run () == (int) ResponseType.Ok) {
+				string ColorStr = dialog.ColorStr();
+				//string ColorStr = dialog.ColorSelection.CurrentColor.ToString();
+				textarea.Document.Insert(textarea.ActiveTextAreaControl.Caret.Offset, ColorStr);
+				int lineNumber = textarea.Document.GetLineNumberForOffset(textarea.ActiveTextAreaControl.Caret.Offset);
+				textarea.ActiveTextAreaControl.Caret.Column += ColorStr.Length;
+				textarea.Document.RequestUpdate(new TextAreaUpdate(TextAreaUpdateType.SingleLine, new Point(0, lineNumber)));
+				textarea.Document.CommitUpdate();
+				
+
+			};
+			dialog.Hide();
+
+
 			/*using (ColorDialog cd = new ColorDialog()) {
 				if (cd.ShowDialog() == DialogResult.OK) {
 					string colorstr = &quot;#&quot; + cd.Color.ToArgb().ToString(&quot;X&quot;);
@@ -193,3 +241,4 @@
 	}
 
 }
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000133.html">[Monodevelop-patches-list] r519 - in trunk/MonoDevelop: . src/Main/Base/Commands src/Main/Base/Gui/Dialogs/Wizard
</A></li>
	<LI>Next message: <A HREF="000136.html">[Monodevelop-patches-list] r521 - in trunk/MonoDevelop/src/Libraries/MonoDevelop.Gui: . FileEntry
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#135">[ date ]</a>
              <a href="thread.html#135">[ thread ]</a>
              <a href="subject.html#135">[ subject ]</a>
              <a href="author.html#135">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
