<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r720 - trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r720%20-%20trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000324.html">
   <LINK REL="Next"  HREF="000326.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r720 - trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r720%20-%20trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r720 - trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Thu Jan 29 18:24:30 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000324.html">[Monodevelop-patches-list] r719 - trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/Gui
</A></li>
        <LI>Next message: <A HREF="000326.html">[Monodevelop-patches-list] r721 - trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#325">[ date ]</a>
              <a href="thread.html#325">[ thread ]</a>
              <a href="subject.html#325">[ subject ]</a>
              <a href="author.html#325">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: benm
Date: 2004-01-29 18:24:30 -0500 (Thu, 29 Jan 2004)
New Revision: 720

Modified:
   trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion/TextUtilities.cs
Log:
fix up todds mistake

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion/TextUtilities.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion/TextUtilities.cs	2004-01-29 21:15:06 UTC (rev 719)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion/TextUtilities.cs	2004-01-29 23:24:30 UTC (rev 720)
@@ -78,8 +78,11 @@
 		/// &lt;/remarks&gt;
 		public static string GetExpressionBeforeOffset(SourceEditorView textArea, int offset)
 		{
+			// HACK HACK we should actually use GtkTextIter's
+			string text = textArea.Buffer.Text;
+			
 			while (offset - 1 &gt; 0) {
-				switch (textArea.Buffer.Text[offset - 1]) {
+				switch (text [offset - 1]) {
 					case '}':
 						goto done;
 //						offset = SearchBracketBackward(document, offset - 2, '{','}');
@@ -98,30 +101,30 @@
 					case '\'':
 						return &quot;'a'&quot;;
 					case '&gt;':
-						if (textArea.Buffer.Text[offset - 2] == '-') {
+						if (text [offset - 2] == '-') {
 							offset -= 2;
 							break;
 						}
 						goto done;
 					default:
-						if (Char.IsWhiteSpace(textArea.Buffer.Text[offset - 1])) {
+						if (Char.IsWhiteSpace (text [offset - 1])) {
 							--offset;
 							break;
 						}
 						int start = offset - 1;
-						if (!IsLetterDigitOrUnderscore(textArea.Buffer.Text[start])) {
+						if (!IsLetterDigitOrUnderscore (text [start])) {
 							goto done;
 						}
 						
-						while (start &gt; 0 &amp;&amp; IsLetterDigitOrUnderscore(textArea.Buffer.Text[start - 1])) {
+						while (start &gt; 0 &amp;&amp; IsLetterDigitOrUnderscore (text[start - 1])) {
 							--start;
 						}
 						
-						Console.WriteLine(&quot;{0} -- {1}&quot;, offset, start);
+						//Console.WriteLine(&quot;{0} -- {1}&quot;, offset, start);
 						Gtk.TextIter startIter = textArea.Buffer.GetIterAtOffset (start);
 						Gtk.TextIter endIter = textArea.Buffer.GetIterAtOffset (offset);
 						string word = textArea.Buffer.GetText (startIter, endIter, false).Trim();
-						Console.WriteLine(&quot;word &gt;{0}&lt;&quot;, word);
+						//Console.WriteLine(&quot;word &gt;{0}&lt;&quot;, word);
 						switch (word) {
 							case &quot;ref&quot;:
 							case &quot;out&quot;:
@@ -143,7 +146,7 @@
 //			Console.WriteLine(&quot;ofs : {0} cart:{1}&quot;, offset, document.Caret.Offset);
 //			Console.WriteLine(&quot;return:&quot; + document.GetText(offset, document.Caret.Offset - offset).Trim());
 			Gtk.TextIter start_Iter = textArea.Buffer.GetIterAtMark (textArea.Buffer.InsertMark);
-			Gtk.TextIter offset_Iter = textArea.Buffer.GetIterAtOffset (start_Iter.Offset - offset);
+			Gtk.TextIter offset_Iter = textArea.Buffer.GetIterAtOffset (offset);
 			return textArea.Buffer.GetText (start_Iter, offset_Iter, false ).Trim();
 		}
 		
@@ -244,8 +247,10 @@
 */
 		static bool ScanLineComment(SourceEditorView document, int offset)
 		{
+			// HACK HACK: use iters
+			string text = document.Buffer.Text;
 			while (offset &gt; 0 &amp;&amp; offset &lt; document.Buffer.Text.Length) {
-				char ch = document.Buffer.Text[offset];
+				char ch = text [offset];
 				switch (ch) {
 					case '\r':
 					case '\n':
@@ -263,6 +268,9 @@
 		
 		public static int SearchBracketBackward(SourceEditorView document, int offset, char openBracket, char closingBracket)
 		{
+			// HACK HACK: use iters
+			string text = document.Buffer.Text;
+			
 			int brackets = -1;
 			
 			bool inString = false;
@@ -271,16 +279,16 @@
 			bool blockComment = false;
 			
 			while (offset &gt;= 0 &amp;&amp; offset &lt; document.Buffer.Text.Length) {
-				char ch = document.Buffer.Text[offset];
+				char ch = text [offset];
 				switch (ch) {
 					case '/':
 						if (blockComment) {
-							if (document.Buffer.Text[offset + 1]== '*') {
+							if (text [offset + 1]== '*') {
 								blockComment = false;
 							}
 						}
-						if (!inString &amp;&amp; !inChar &amp;&amp; offset + 1 &lt; document.Buffer.Text.Length) {
-							if (offset &gt; 0 &amp;&amp; document.Buffer.Text[offset - 1] == '*') {
+						if (!inString &amp;&amp; !inChar &amp;&amp; offset + 1 &lt; text.Length) {
+							if (offset &gt; 0 &amp;&amp; text [offset - 1] == '*') {
 								blockComment = true;
 							}
 						}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000324.html">[Monodevelop-patches-list] r719 - trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/Gui
</A></li>
	<LI>Next message: <A HREF="000326.html">[Monodevelop-patches-list] r721 - trunk/MonoDevelop/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#325">[ date ]</a>
              <a href="thread.html#325">[ thread ]</a>
              <a href="subject.html#325">[ subject ]</a>
              <a href="author.html#325">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
