<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r540 - in trunk/MonoDevelop/src/AddIns: BackendBindings/CSharpBinding DisplayBindings/TextEditor/Gui/Pads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r540%20-%20in%20trunk/MonoDevelop/src/AddIns%3A%20BackendBindings/CSharpBinding%20DisplayBindings/TextEditor/Gui/Pads&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000158.html">
   <LINK REL="Next"  HREF="000166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r540 - in trunk/MonoDevelop/src/AddIns: BackendBindings/CSharpBinding DisplayBindings/TextEditor/Gui/Pads</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r540%20-%20in%20trunk/MonoDevelop/src/AddIns%3A%20BackendBindings/CSharpBinding%20DisplayBindings/TextEditor/Gui/Pads&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r540 - in trunk/MonoDevelop/src/AddIns: BackendBindings/CSharpBinding DisplayBindings/TextEditor/Gui/Pads">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Sun Jan 18 08:20:30 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000158.html">[Monodevelop-patches-list] r539 - trunk/MonoDevelop/src/Main/Base/Gui/Pads
</A></li>
        <LI>Next message: <A HREF="000166.html">[Monodevelop-patches-list] r541 - in trunk/MonoDevelop/src/Libraries/MonoDevelop.Gui: . GladeWidgetExtract
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#162">[ date ]</a>
              <a href="thread.html#162">[ thread ]</a>
              <a href="subject.html#162">[ subject ]</a>
              <a href="author.html#162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pedroas
Date: 2004-01-18 08:20:30 -0500 (Sun, 18 Jan 2004)
New Revision: 540

Modified:
   trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Pads/CompilerMessageView.cs
Log:
Tiny support for compiling projects


Modified: trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs	2004-01-18 11:08:04 UTC (rev 539)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs	2004-01-18 13:20:30 UTC (rev 540)
@@ -151,8 +151,8 @@
 				}
 				
 				writer.WriteLine(&quot;/nologo&quot;);
-				writer.WriteLine(&quot;/utf8output&quot;);
-				writer.WriteLine(&quot;/w:&quot; + compilerparameters.WarningLevel);;
+//				writer.WriteLine(&quot;/utf8output&quot;);
+//				writer.WriteLine(&quot;/w:&quot; + compilerparameters.WarningLevel);;
 				
 				if (compilerparameters.Debugmode) {
 					writer.WriteLine(&quot;/debug:+&quot;);
@@ -160,9 +160,9 @@
 					writer.WriteLine(&quot;/d:DEBUG&quot;);
 				}
 				
-				if (compilerparameters.Optimize) {
-					writer.WriteLine(&quot;/o&quot;);
-				}
+//				if (compilerparameters.Optimize) {
+//					writer.WriteLine(&quot;/o&quot;);
+//				}
 				
 				if (compilerparameters.Win32Icon != null &amp;&amp; compilerparameters.Win32Icon.Length &gt; 0 &amp;&amp; File.Exists(compilerparameters.Win32Icon)) {
 					writer.WriteLine(&quot;\&quot;/win32icon:&quot; + compilerparameters.Win32Icon + &quot;\&quot;&quot;);
@@ -260,8 +260,15 @@
 			string outstr = compilerName + &quot; @&quot; + responseFileName;
 			TempFileCollection tf = new TempFileCollection();
 			
-			Executor.ExecWaitWithCapture(outstr,  tf, ref output, ref error);
 			
+			StreamReader t = File.OpenText(responseFileName);
+			StreamWriter w = new StreamWriter(&quot;/home/pedro/mirame&quot;);
+			w.Write(t.ReadToEnd());
+			w.Close();
+			
+			//Executor.ExecWaitWithCapture(outstr,  tf, ref output, ref error);
+			DoCompilation(outstr, tf, ref output, ref error);
+			
 			ICompilerResult result = ParseOutput(tf, output);
 			project.CopyReferencesToOutputPath(false);
 			File.Delete(responseFileName);
@@ -272,8 +279,13 @@
 		
 		string GetCompilerName()
 		{
-			return fileUtilityService.GetDirectoryNameWithSeparator(System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory()) + 
-			       &quot;csc.exe&quot;;
+			//return fileUtilityService.GetDirectoryNameWithSeparator(System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory()) + 
+			//       &quot;csc.exe&quot;;
+			string ret = fileUtilityService.GetDirectoryNameWithSeparator(System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory());
+			ret = ret.Substring(0, ret.Length - 4);
+			ret = ret + &quot;bin/mcs&quot;;
+			return ret;
+			
 		}
 		
 		ICompilerResult ParseOutput(TempFileCollection tf, string file)
@@ -283,7 +295,7 @@
 			StreamReader sr = File.OpenText(file);
 			
 			// skip fist whitespace line
-			sr.ReadLine();
+			//sr.ReadLine();
 			
 			CompilerResults cr = new CompilerResults(tf);
 			
@@ -332,5 +344,20 @@
 			sr.Close();
 			return new DefaultCompilerResult(cr, compilerOutput.ToString());
 		}
+		
+		private void DoCompilation(string outstr, TempFileCollection tf, ref string output, ref string error) {
+			output = Path.GetTempFileName();
+			error = Path.GetTempFileName();
+			
+			string arguments = outstr + &quot; &gt; &quot; + output + &quot; 2&gt; &quot; + error;
+			string command = arguments;
+			ProcessStartInfo si = new ProcessStartInfo(&quot;/bin/sh -c \&quot;&quot; + command + &quot;\&quot;&quot;);
+			si.RedirectStandardOutput = true;
+			si.RedirectStandardError = true;
+			Process p = new Process();
+			p.StartInfo = si;
+			p.Start();
+			p.WaitForExit();
+		}
 	}
 }

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Pads/CompilerMessageView.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Pads/CompilerMessageView.cs	2004-01-18 11:08:04 UTC (rev 539)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Pads/CompilerMessageView.cs	2004-01-18 13:20:30 UTC (rev 540)
@@ -115,7 +115,8 @@
 			
 		}
 		
-		void SetOutput2(object sender, EventArgs e)
+		//void SetOutput2(object sender, EventArgs e)
+		void SetOutput2()
 		{
 			TaskService taskService = (TaskService)ICSharpCode.Core.Services.ServiceManager.Services.GetService(typeof(TaskService));
 			try {
@@ -128,7 +129,7 @@
 		
 		void UpdateTextArea()
 		{
-			Console.WriteLine(&quot;Create CompilerMessage View Handle:&quot; + textEditorControl.Handle);
+			//Console.WriteLine(&quot;Create CompilerMessage View Handle:&quot; + textEditorControl.Handle);
 			
 			textEditorControl.ActiveTextAreaControl.Caret.Position = textEditorControl.Document.OffsetToPosition(textEditorControl.Document.TextLength);
 			textEditorControl.ActiveTextAreaControl.ScrollToCaret();
@@ -137,9 +138,10 @@
 		string outputText = null;
 		void SetOutput(object sender, EventArgs e)
 		{
-			Console.WriteLine(&quot;Create CompilerMessage View Handle:&quot; + textEditorControl.Handle);
-			
+			//Console.WriteLine(&quot;Create CompilerMessage View Handle:&quot; + textEditorControl.Handle);
+			//throw new Exception(&quot;Trace me...&quot;);
 			if (WorkbenchSingleton.Workbench.WorkbenchLayout.IsVisible(this)) {
+				SetOutput2();
 				//textEditorControl.Invoke(new EventHandler(SetOutput2));
 				outputText = null;
 			} else {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000158.html">[Monodevelop-patches-list] r539 - trunk/MonoDevelop/src/Main/Base/Gui/Pads
</A></li>
	<LI>Next message: <A HREF="000166.html">[Monodevelop-patches-list] r541 - in trunk/MonoDevelop/src/Libraries/MonoDevelop.Gui: . GladeWidgetExtract
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#162">[ date ]</a>
              <a href="thread.html#162">[ thread ]</a>
              <a href="subject.html#162">[ subject ]</a>
              <a href="author.html#162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
