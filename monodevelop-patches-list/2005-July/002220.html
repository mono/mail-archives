<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2620 - in	trunk/MonoDevelop/Extras/VersionControl: . AddIn Diff	DiffWidget VersionControl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2620%20-%20in%0A%09trunk/MonoDevelop/Extras/VersionControl%3A%20.%20AddIn%20Diff%0A%09DiffWidget%20VersionControl&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002219.html">
   <LINK REL="Next"  HREF="002221.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2620 - in	trunk/MonoDevelop/Extras/VersionControl: . AddIn Diff	DiffWidget VersionControl</H1>
    <B>Joshua Tauberer</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2620%20-%20in%0A%09trunk/MonoDevelop/Extras/VersionControl%3A%20.%20AddIn%20Diff%0A%09DiffWidget%20VersionControl&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2620 - in	trunk/MonoDevelop/Extras/VersionControl: . AddIn Diff	DiffWidget VersionControl">joshua at mono-cvs.ximian.com
       </A><BR>
    <I>Fri Jul  1 19:56:15 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002219.html">[Monodevelop-patches-list] r2619 - in	trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding:	. SharpRefactoryVB
</A></li>
        <LI>Next message: <A HREF="002221.html">[Monodevelop-patches-list] r2621 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: .	Internal/Project/Project
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2220">[ date ]</a>
              <a href="thread.html#2220">[ thread ]</a>
              <a href="subject.html#2220">[ subject ]</a>
              <a href="author.html#2220">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: joshua
Date: 2005-07-01 19:56:15 -0400 (Fri, 01 Jul 2005)
New Revision: 2620

Added:
   trunk/MonoDevelop/Extras/VersionControl/AddIn/AddIn.mdp
   trunk/MonoDevelop/Extras/VersionControl/AddIn/mds_postbuild.sh
   trunk/MonoDevelop/Extras/VersionControl/Diff/Diff.mdp
   trunk/MonoDevelop/Extras/VersionControl/DiffWidget/DiffWidget.mdp
   trunk/MonoDevelop/Extras/VersionControl/VersionControl.mds
   trunk/MonoDevelop/Extras/VersionControl/VersionControl/VersionControl.mdp
Modified:
   trunk/MonoDevelop/Extras/VersionControl/AddIn/Addin.cs
   trunk/MonoDevelop/Extras/VersionControl/AddIn/VersionControl.addin.xml
   trunk/MonoDevelop/Extras/VersionControl/ChangeLog
   trunk/MonoDevelop/Extras/VersionControl/VersionControl/Subversion.cs
Log:
    * Added MD solution files for VersionControl.
    * Project pad overlays now update when files
      are modified.
    * Project pad context menus enabled for
      folders and combines.
    * Subversion: Don't report diffs available
      for unchanged files.
    * This was committed with the addin!

Added: trunk/MonoDevelop/Extras/VersionControl/AddIn/AddIn.mdp
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/AddIn/AddIn.mdp	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/AddIn/AddIn.mdp	2005-07-01 23:56:15 UTC (rev 2620)
@@ -0,0 +1,46 @@
+&lt;Project name=&quot;AddIn&quot; fileversion=&quot;2.0&quot; language=&quot;C#&quot; ctype=&quot;DotNetProject&quot;&gt;
+  &lt;Configurations&gt;
+    &lt;Configuration name=&quot;Debug&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;VersionControlAddIn&quot; /&gt;
+      &lt;Build executeAfterBuild=&quot;./mds_postbuild.sh&quot; debugmode=&quot;True&quot; target=&quot;Library&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; mainclass=&quot;&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+    &lt;Configuration name=&quot;Release&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;VersionControlAddIn&quot; /&gt;
+      &lt;Build debugmode=&quot;False&quot; target=&quot;Library&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; mainclass=&quot;&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+  &lt;/Configurations&gt;
+  &lt;References&gt;
+    &lt;ProjectReference type=&quot;Project&quot; localcopy=&quot;True&quot; refto=&quot;VersionControl&quot; /&gt;
+    &lt;ProjectReference type=&quot;Project&quot; localcopy=&quot;True&quot; refto=&quot;DiffWidget&quot; /&gt;
+    &lt;ProjectReference type=&quot;Project&quot; localcopy=&quot;True&quot; refto=&quot;Diff&quot; /&gt;
+    &lt;ProjectReference type=&quot;Gac&quot; localcopy=&quot;True&quot; refto=&quot;gtk-sharp, Version=2.6.0.0, Culture=neutral, PublicKeyToken=35e10195dab3c99f&quot; /&gt;
+    &lt;ProjectReference type=&quot;Assembly&quot; localcopy=&quot;True&quot; refto=&quot;../../../build/bin/MonoDevelop.Base.dll&quot; /&gt;
+    &lt;ProjectReference type=&quot;Assembly&quot; localcopy=&quot;True&quot; refto=&quot;../../../build/bin/MonoDevelop.Core.dll&quot; /&gt;
+    &lt;ProjectReference type=&quot;Assembly&quot; localcopy=&quot;True&quot; refto=&quot;../../../build/bin/MonoDevelop.Dock.dll&quot; /&gt;
+    &lt;ProjectReference type=&quot;Assembly&quot; localcopy=&quot;True&quot; refto=&quot;../../../build/bin/MonoDevelop.exe&quot; /&gt;
+    &lt;ProjectReference type=&quot;Assembly&quot; localcopy=&quot;True&quot; refto=&quot;../../../build/bin/MonoDevelop.Gui.Utils.dll&quot; /&gt;
+    &lt;ProjectReference type=&quot;Assembly&quot; localcopy=&quot;True&quot; refto=&quot;../../../build/bin/MonoDevelop.Gui.Widgets.dll&quot; /&gt;
+    &lt;ProjectReference type=&quot;Assembly&quot; localcopy=&quot;True&quot; refto=&quot;../../../build/bin/MonoDevelop.SourceEditor.dll&quot; /&gt;
+  &lt;/References&gt;
+  &lt;DeploymentInformation strategy=&quot;File&quot;&gt;
+    &lt;excludeFiles /&gt;
+  &lt;/DeploymentInformation&gt;
+  &lt;Contents&gt;
+    &lt;File name=&quot;./Addin.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./Diffs.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./Logs.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./Statuses.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./Task.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./Update.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./VersionControl.addin.xml&quot; subtype=&quot;Code&quot; buildaction=&quot;Nothing&quot; /&gt;
+    &lt;File name=&quot;./overlay_added.png&quot; subtype=&quot;Code&quot; buildaction=&quot;EmbedAsResource&quot; /&gt;
+    &lt;File name=&quot;./overlay_conflicted.png&quot; subtype=&quot;Code&quot; buildaction=&quot;EmbedAsResource&quot; /&gt;
+    &lt;File name=&quot;./overlay_locked.png&quot; subtype=&quot;Code&quot; buildaction=&quot;EmbedAsResource&quot; /&gt;
+    &lt;File name=&quot;./overlay_modified.png&quot; subtype=&quot;Code&quot; buildaction=&quot;EmbedAsResource&quot; /&gt;
+    &lt;File name=&quot;./overlay_normal.png&quot; subtype=&quot;Code&quot; buildaction=&quot;EmbedAsResource&quot; /&gt;
+  &lt;/Contents&gt;
+&lt;/Project&gt;
\ No newline at end of file

Modified: trunk/MonoDevelop/Extras/VersionControl/AddIn/Addin.cs
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/AddIn/Addin.cs	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/AddIn/Addin.cs	2005-07-01 23:56:15 UTC (rev 2620)
@@ -7,6 +7,7 @@
 using MonoDevelop.Gui;
 using MonoDevelop.Core;
 using MonoDevelop.Gui.Pads;
+using MonoDevelop.Gui.Pads.ProjectPad;
 using MonoDevelop.Internal.Project;
 using MonoDevelop.Commands;
 using MonoDevelop.Services;
@@ -42,48 +43,97 @@
 	}
 	
 	public class VersionControlNodeExtension : NodeBuilderExtension {
+		Hashtable projectsWatched = new Hashtable();
+		Hashtable fileStatus = new Hashtable();
+	
 		public override bool CanBuildNode (Type dataType) {
 			//Console.Error.WriteLine(dataType);
 			return typeof(ProjectFile).IsAssignableFrom (dataType)
-				|| typeof(DotNetProject).IsAssignableFrom (dataType);
-				// TODO: Folders
+				|| typeof(DotNetProject).IsAssignableFrom (dataType)
+				|| typeof(ProjectFolder).IsAssignableFrom (dataType)
+				|| typeof(Combine).IsAssignableFrom (dataType);
 		}		
 		
 		public override void BuildNode (ITreeBuilder builder, object dataObject, ref string label, ref Gdk.Pixbuf icon, ref Gdk.Pixbuf closedIcon) {
 			// Add status overlays
 			
-			// TODO: Watch the files in some way to detect
-			// when the overlay should be changed.
-			
 			if (!(dataObject is ProjectFile)) return;
 			if (!builder.Options[&quot;ShowVersionControlOverlays&quot;])
 				return;
 		
 			ProjectFile file = (ProjectFile) dataObject;
+			
+			WatchProject(file.Project);
+			
+			// When a file had a status and later has no status,
+			// for whatever reason, it needs to be removed from the hashtable.
+			fileStatus.Remove(file.FilePath);
+			
 			try {
-				foreach (VersionControlSystem vc in VersionControlService.Providers) {
-					if (vc.IsFileStatusAvailable(file.FilePath)) {
-						Node node = vc.GetFileStatus(file.FilePath, false);
-						
-						Gdk.Pixbuf overlay = VersionControlService.LoadIconForStatus(node.Status);
-						
-						double scale = (double)(2*icon.Width/3) / (double)overlay.Width;
-						int w = (int)(overlay.Width*scale);
-						int h = (int)(overlay.Height*scale);
-						icon = icon.Copy();
-						overlay.Composite(icon,
-							icon.Width-w,  icon.Height-h,
-							w, h,
-							icon.Width-w, icon.Height-h,
-							scale,scale, Gdk.InterpType.Bilinear, 255); 
-						break;
-					}
-				}
+				NodeStatus status = GetStatus(file.FilePath);
+				if (status == NodeStatus.Unknown) return;
+				
+				fileStatus[file.FilePath] = status;
+				
+				Gdk.Pixbuf overlay = VersionControlService.LoadIconForStatus(status);
+				
+				double scale = (double)(2*icon.Width/3) / (double)overlay.Width;
+				int w = (int)(overlay.Width*scale);
+				int h = (int)(overlay.Height*scale);
+				icon = icon.Copy();
+				overlay.Composite(icon,
+					icon.Width-w,  icon.Height-h,
+					w, h,
+					icon.Width-w, icon.Height-h,
+					scale,scale, Gdk.InterpType.Bilinear, 255); 
 			} catch (Exception e) {
-				Console.Error.WriteLine(e);
 			}
 		}
 		
+		NodeStatus GetStatus(string filepath) {
+			foreach (VersionControlSystem vc in VersionControlService.Providers) {
+				if (vc.IsFileStatusAvailable(filepath)) {
+					Node node = vc.GetFileStatus(filepath, false);
+					return node.Status;
+				}
+			}
+			return NodeStatus.Unknown;
+		}
+		
+		void WatchProject(Project project) {
+			if (projectsWatched.ContainsKey(project)) return;
+			projectsWatched[project] = projectsWatched;
+			project.FileChangedInProject += new ProjectFileEventHandler(Monitor);
+		}
+		
+		void Monitor(object sender, ProjectFileEventArgs args) {
+			// If the status of the file actually changed, then
+			// update the project pad so the overlays are updated.
+			
+			string file = args.ProjectFile.FilePath;
+			
+			NodeStatus newstatus = GetStatus(file);
+			if (newstatus == NodeStatus.Unknown &amp;&amp; !fileStatus.ContainsKey(file))
+				return; // had no status before, has no status now
+
+			if (!fileStatus.ContainsKey(file)
+				|| (fileStatus.ContainsKey(file) 
+					&amp;&amp; (NodeStatus)fileStatus[file] != newstatus)) {
+				// No status before and has status now, or
+				// status changed.  Refresh the project pad.
+				ITreeBuilder builder = Context.GetTreeBuilder(args.ProjectFile);
+				if (builder != null)
+					builder.UpdateAll();
+			}
+		}
+		
+		public override void Dispose() {
+			foreach (Project p in projectsWatched.Keys)
+				p.FileChangedInProject -= new ProjectFileEventHandler(Monitor);
+			projectsWatched.Clear();
+		}
+		
+		
 		public override Type CommandHandlerType {
 			get { return typeof(AddinCommandHandler); }
 		}
@@ -144,7 +194,7 @@
 		private bool RunCommand(Commands cmd, bool test) {
 			string path;
 			bool isDir;
-		
+			
 			if (CurrentNode.DataItem is ProjectFile) {
 				ProjectFile file = (ProjectFile)CurrentNode.DataItem;
 				path = file.FilePath;
@@ -153,6 +203,14 @@
 				DotNetProject project = (DotNetProject)CurrentNode.DataItem;
 				path = project.BaseDirectory;
 				isDir = true;
+			} else if (CurrentNode.DataItem is ProjectFolder) {
+				ProjectFolder f = ((ProjectFolder)CurrentNode.DataItem);
+				path = f.Path;
+				isDir = true;				
+			} else if (CurrentNode.DataItem is Combine) {
+				Combine c = ((Combine)CurrentNode.DataItem);
+				path = c.BaseDirectory;
+				isDir = true;				
 			} else {
 				Console.Error.WriteLine(CurrentNode.DataItem);
 				return false;

Modified: trunk/MonoDevelop/Extras/VersionControl/AddIn/VersionControl.addin.xml
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/AddIn/VersionControl.addin.xml	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/AddIn/VersionControl.addin.xml	2005-07-01 23:56:15 UTC (rev 2620)
@@ -46,5 +46,10 @@
 		&lt;CommandItem id = &quot;VersionControlPlugin.Commands.Status&quot;/&gt;
 		&lt;CommandItem id = &quot;VersionControlPlugin.Commands.Log&quot;/&gt;
 	&lt;/Extension&gt;
+	&lt;Extension path = &quot;/SharpDevelop/Views/ProjectBrowser/ContextMenu/CombineBrowserNode&quot;&gt;
+		&lt;CommandItem id = &quot;VersionControlPlugin.Commands.Update&quot;/&gt;
+		&lt;CommandItem id = &quot;VersionControlPlugin.Commands.Status&quot;/&gt;
+		&lt;CommandItem id = &quot;VersionControlPlugin.Commands.Log&quot;/&gt;
+	&lt;/Extension&gt;
 &lt;/AddIn&gt;
 	

Added: trunk/MonoDevelop/Extras/VersionControl/AddIn/mds_postbuild.sh
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/AddIn/mds_postbuild.sh	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/AddIn/mds_postbuild.sh	2005-07-01 23:56:15 UTC (rev 2620)
@@ -0,0 +1,2 @@
+#!/bin/sh
+cp VersionControl.addin.xml ../../../build/AddIns/VersionControl


Property changes on: trunk/MonoDevelop/Extras/VersionControl/AddIn/mds_postbuild.sh
___________________________________________________________________
Name: svn:executable
   + *

Modified: trunk/MonoDevelop/Extras/VersionControl/ChangeLog
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/ChangeLog	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/ChangeLog	2005-07-01 23:56:15 UTC (rev 2620)
@@ -1,3 +1,14 @@
+2005-07-01  Joshua Tauberer &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tauberer at for.net</A>&gt;
+
+	* Added MD solution files for VersionControl.
+	* Project pad overlays now update when files
+	  are modified.
+	* Project pad context menus enabled for
+	  folders and combines.
+	* Subversion: Don't report diffs available
+	  for unchanged files.
+	* This was committed with the addin!
+
 2005-06-22  Joshua Tauberer &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tauberer at for.net</A>&gt;
 
 	* Added VersionControl into repo (but sadly the addin

Added: trunk/MonoDevelop/Extras/VersionControl/Diff/Diff.mdp
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/Diff/Diff.mdp	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/Diff/Diff.mdp	2005-07-01 23:56:15 UTC (rev 2620)
@@ -0,0 +1,28 @@
+&lt;Project name=&quot;Diff&quot; fileversion=&quot;2.0&quot; language=&quot;C#&quot; ctype=&quot;DotNetProject&quot;&gt;
+  &lt;Configurations&gt;
+    &lt;Configuration name=&quot;Debug&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;Diff&quot; /&gt;
+      &lt;Build debugmode=&quot;True&quot; target=&quot;Library&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; mainclass=&quot;&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+    &lt;Configuration name=&quot;Release&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;Diff&quot; /&gt;
+      &lt;Build debugmode=&quot;False&quot; target=&quot;Exe&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+  &lt;/Configurations&gt;
+  &lt;References /&gt;
+  &lt;DeploymentInformation strategy=&quot;File&quot;&gt;
+    &lt;excludeFiles /&gt;
+  &lt;/DeploymentInformation&gt;
+  &lt;Contents&gt;
+    &lt;File name=&quot;./Diff.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./Merge.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./Patch.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./StructuredDiff.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./TextDiff.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./UnifiedDiff.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+  &lt;/Contents&gt;
+&lt;/Project&gt;
\ No newline at end of file

Added: trunk/MonoDevelop/Extras/VersionControl/DiffWidget/DiffWidget.mdp
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/DiffWidget/DiffWidget.mdp	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/DiffWidget/DiffWidget.mdp	2005-07-01 23:56:15 UTC (rev 2620)
@@ -0,0 +1,26 @@
+&lt;Project name=&quot;DiffWidget&quot; fileversion=&quot;2.0&quot; language=&quot;C#&quot; ctype=&quot;DotNetProject&quot;&gt;
+  &lt;Configurations&gt;
+    &lt;Configuration name=&quot;Debug&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;DiffWidget&quot; /&gt;
+      &lt;Build debugmode=&quot;True&quot; target=&quot;Library&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; mainclass=&quot;&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+    &lt;Configuration name=&quot;Release&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;DiffWidget&quot; /&gt;
+      &lt;Build debugmode=&quot;False&quot; target=&quot;Library&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; mainclass=&quot;&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+  &lt;/Configurations&gt;
+  &lt;References&gt;
+    &lt;ProjectReference type=&quot;Project&quot; localcopy=&quot;True&quot; refto=&quot;Diff&quot; /&gt;
+    &lt;ProjectReference type=&quot;Gac&quot; localcopy=&quot;True&quot; refto=&quot;gtk-sharp, Version=2.6.0.0, Culture=neutral, PublicKeyToken=35e10195dab3c99f&quot; /&gt;
+  &lt;/References&gt;
+  &lt;DeploymentInformation strategy=&quot;File&quot;&gt;
+    &lt;excludeFiles /&gt;
+  &lt;/DeploymentInformation&gt;
+  &lt;Contents&gt;
+    &lt;File name=&quot;./widget.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+  &lt;/Contents&gt;
+&lt;/Project&gt;
\ No newline at end of file

Modified: trunk/MonoDevelop/Extras/VersionControl/VersionControl/Subversion.cs
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/VersionControl/Subversion.cs	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/VersionControl/Subversion.cs	2005-07-01 23:56:15 UTC (rev 2620)
@@ -31,7 +31,9 @@
 		}
 		
 		public override bool IsDiffAvailable(string sourcefile) {
-			return File.Exists(GetTextBase(sourcefile));			
+			return File.Exists(GetTextBase(sourcefile))
+				&amp;&amp; IsFileStatusAvailable(sourcefile)
+				&amp;&amp; GetFileStatus(sourcefile, false).Status == NodeStatus.Modified;			
 		}
 		
 		public override bool IsHistoryAvailable(string sourcefile) {
@@ -39,7 +41,7 @@
 		}
 		
 		public override bool IsFileStatusAvailable(string sourcefile) {
-			return IsDiffAvailable(sourcefile);
+			return File.Exists(GetTextBase(sourcefile));
 		}
 
 		public override bool IsDirectoryStatusAvailable(string sourcepath) {

Added: trunk/MonoDevelop/Extras/VersionControl/VersionControl/VersionControl.mdp
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/VersionControl/VersionControl.mdp	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/VersionControl/VersionControl.mdp	2005-07-01 23:56:15 UTC (rev 2620)
@@ -0,0 +1,24 @@
+&lt;Project name=&quot;VersionControl&quot; fileversion=&quot;2.0&quot; language=&quot;C#&quot; ctype=&quot;DotNetProject&quot;&gt;
+  &lt;Configurations&gt;
+    &lt;Configuration name=&quot;Debug&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;VersionControl&quot; /&gt;
+      &lt;Build debugmode=&quot;True&quot; target=&quot;Library&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; mainclass=&quot;&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+    &lt;Configuration name=&quot;Release&quot; ctype=&quot;DotNetProjectConfiguration&quot;&gt;
+      &lt;Output directory=&quot;../../../build/AddIns/VersionControl&quot; assembly=&quot;VersionControl&quot; /&gt;
+      &lt;Build debugmode=&quot;False&quot; target=&quot;Library&quot; /&gt;
+      &lt;Execution runwithwarnings=&quot;True&quot; consolepause=&quot;True&quot; runtime=&quot;MsNet&quot; /&gt;
+      &lt;CodeGeneration compiler=&quot;Csc&quot; warninglevel=&quot;4&quot; optimize=&quot;True&quot; unsafecodeallowed=&quot;False&quot; generateoverflowchecks=&quot;True&quot; mainclass=&quot;&quot; generatexmldocumentation=&quot;False&quot; ctype=&quot;CSharpCompilerParameters&quot; /&gt;
+    &lt;/Configuration&gt;
+  &lt;/Configurations&gt;
+  &lt;References /&gt;
+  &lt;DeploymentInformation strategy=&quot;File&quot;&gt;
+    &lt;excludeFiles /&gt;
+  &lt;/DeploymentInformation&gt;
+  &lt;Contents&gt;
+    &lt;File name=&quot;./Subversion.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+    &lt;File name=&quot;./VersionControl.cs&quot; subtype=&quot;Code&quot; buildaction=&quot;Compile&quot; /&gt;
+  &lt;/Contents&gt;
+&lt;/Project&gt;
\ No newline at end of file

Added: trunk/MonoDevelop/Extras/VersionControl/VersionControl.mds
===================================================================
--- trunk/MonoDevelop/Extras/VersionControl/VersionControl.mds	2005-07-01 16:47:36 UTC (rev 2619)
+++ trunk/MonoDevelop/Extras/VersionControl/VersionControl.mds	2005-07-01 23:56:15 UTC (rev 2620)
@@ -0,0 +1,28 @@
+&lt;Combine name=&quot;VersionControl&quot; fileversion=&quot;2.0&quot;&gt;
+  &lt;Configurations&gt;
+    &lt;Configuration name=&quot;Debug&quot; ctype=&quot;CombineConfiguration&quot;&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;VersionControl&quot; /&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;Diff&quot; /&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;DiffWidget&quot; /&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;AddIn&quot; /&gt;
+    &lt;/Configuration&gt;
+    &lt;Configuration name=&quot;Release&quot; ctype=&quot;CombineConfiguration&quot;&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;VersionControl&quot; /&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;Diff&quot; /&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;DiffWidget&quot; /&gt;
+      &lt;Entry build=&quot;True&quot; name=&quot;AddIn&quot; /&gt;
+    &lt;/Configuration&gt;
+  &lt;/Configurations&gt;
+  &lt;StartMode startupentry=&quot;VersionControl&quot; single=&quot;True&quot;&gt;
+    &lt;Execute type=&quot;None&quot; entry=&quot;VersionControl&quot; /&gt;
+    &lt;Execute type=&quot;None&quot; entry=&quot;Diff&quot; /&gt;
+    &lt;Execute type=&quot;None&quot; entry=&quot;DiffWidget&quot; /&gt;
+    &lt;Execute type=&quot;None&quot; entry=&quot;AddIn&quot; /&gt;
+  &lt;/StartMode&gt;
+  &lt;Entries&gt;
+    &lt;Entry filename=&quot;./VersionControl/VersionControl.mdp&quot; /&gt;
+    &lt;Entry filename=&quot;./Diff/Diff.mdp&quot; /&gt;
+    &lt;Entry filename=&quot;./DiffWidget/DiffWidget.mdp&quot; /&gt;
+    &lt;Entry filename=&quot;./AddIn/AddIn.mdp&quot; /&gt;
+  &lt;/Entries&gt;
+&lt;/Combine&gt;
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002219.html">[Monodevelop-patches-list] r2619 - in	trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding:	. SharpRefactoryVB
</A></li>
	<LI>Next message: <A HREF="002221.html">[Monodevelop-patches-list] r2621 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: .	Internal/Project/Project
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2220">[ date ]</a>
              <a href="thread.html#2220">[ thread ]</a>
              <a href="subject.html#2220">[ subject ]</a>
              <a href="author.html#2220">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
