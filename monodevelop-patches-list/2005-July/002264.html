<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2664 - in	trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding:	. Gui
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2664%20-%20in%0A%09trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding%3A%0A%09.%20Gui&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002263.html">
   <LINK REL="Next"  HREF="002265.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2664 - in	trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding:	. Gui</H1>
    <B>Lluis Sanchez &lt;lluis@ximian.com&gt;</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2664%20-%20in%0A%09trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding%3A%0A%09.%20Gui&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2664 - in	trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding:	. Gui">lluis at mono-cvs.ximian.com
       </A><BR>
    <I>Mon Jul 18 09:01:09 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002263.html">[Monodevelop-patches-list] r2663 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Gui/Pads/ProjectPad
</A></li>
        <LI>Next message: <A HREF="002265.html">[Monodevelop-patches-list] r2665 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Gui/Dialogs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2264">[ date ]</a>
              <a href="thread.html#2264">[ thread ]</a>
              <a href="subject.html#2264">[ subject ]</a>
              <a href="author.html#2264">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: lluis
Date: 2005-07-18 09:01:09 -0400 (Mon, 18 Jul 2005)
New Revision: 2664

Modified:
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharp.glade
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Gui/CodeGenerationPanel.cs
Log:
2005-07-18  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;

	* CSharp.glade:
	* Gui/CodeGenerationPanel.cs: Use a combo entry for the main class
	field. Disable that entry when building a library.



Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharp.glade
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharp.glade	2005-07-18 11:50:06 UTC (rev 2663)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharp.glade	2005-07-18 13:01:09 UTC (rev 2664)
@@ -184,27 +184,6 @@
 		  &lt;/child&gt;
 
 		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkEntry&quot; id=&quot;mainClassEntry&quot;&gt;
-		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
-		      &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
-		      &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;invisible_char&quot; translatable=&quot;yes&quot;&gt;*&lt;/property&gt;
-		      &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
-		    &lt;/widget&gt;
-		    &lt;packing&gt;
-		      &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
-		      &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-		      &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
-		      &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
-		      &lt;property name=&quot;y_options&quot;&gt;&lt;/property&gt;
-		    &lt;/packing&gt;
-		  &lt;/child&gt;
-
-		  &lt;child&gt;
 		    &lt;widget class=&quot;GtkHBox&quot; id=&quot;hbox57&quot;&gt;
 		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 		      &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
@@ -230,6 +209,20 @@
 		      &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
 		    &lt;/packing&gt;
 		  &lt;/child&gt;
+
+		  &lt;child&gt;
+		    &lt;widget class=&quot;GtkComboBoxEntry&quot; id=&quot;mainClassEntry&quot;&gt;
+		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+		    &lt;/widget&gt;
+		    &lt;packing&gt;
+		      &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
+		      &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
+		      &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
+		      &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
+		      &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
+		      &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+		    &lt;/packing&gt;
+		  &lt;/child&gt;
 		&lt;/widget&gt;
 		&lt;packing&gt;
 		  &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog	2005-07-18 11:50:06 UTC (rev 2663)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog	2005-07-18 13:01:09 UTC (rev 2664)
@@ -1,3 +1,9 @@
+2005-07-18  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;
+
+	* CSharp.glade:
+	* Gui/CodeGenerationPanel.cs: Use a combo entry for the main class
+	field. Disable that entry when building a library.
+
 2005-07-14  Ben Motmans  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">ben.motmans at gmail.com</A>&gt;
 
 	* templates/GladeSharp2Project.xpt.xml:

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Gui/CodeGenerationPanel.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Gui/CodeGenerationPanel.cs	2005-07-18 11:50:06 UTC (rev 2663)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Gui/CodeGenerationPanel.cs	2005-07-18 13:01:09 UTC (rev 2664)
@@ -15,6 +15,7 @@
 using MonoDevelop.Core.Services;
 using MonoDevelop.Core.Properties;
 using MonoDevelop.Core.AddIns.Codons;
+using MonoDevelop.Internal.Parser;
 
 using Gtk;
 using MonoDevelop.Gui.Widgets;
@@ -32,7 +33,7 @@
 			// Gtk Controls	
 			//
  			[Glade.Widget] Entry symbolsEntry;
- 			[Glade.Widget] Entry mainClassEntry;
+ 			[Glade.Widget] ComboBoxEntry mainClassEntry;
 			[Glade.Widget] ComboBox compileTargetCombo;
  			[Glade.Widget] CheckButton generateOverflowChecksCheckButton;
 			[Glade.Widget] CheckButton allowUnsafeCodeCheckButton;
@@ -42,12 +43,16 @@
  			[Glade.Widget] CheckButton generateXmlOutputCheckButton;
  			[Glade.Widget] SpinButton warningLevelSpinButton;
 
+			Project project;
 			DotNetProjectConfiguration configuration;
 			CSharpCompilerParameters compilerParameters = null;
+			ListStore classListStore;
+			bool classListFilled;
 
  			public  CodeGenerationPanelWidget(IProperties CustomizationObject) : base (&quot;CSharp.glade&quot;, &quot;CodeGenerationPanel&quot;)
  			{	
 				configuration = (DotNetProjectConfiguration)((IProperties)CustomizationObject).GetProperty(&quot;Config&quot;);
+				project = (Project)((IProperties)CustomizationObject).GetProperty(&quot;Project&quot;);
 				compilerParameters = (CSharpCompilerParameters) configuration.CompilationParameters;
 				
 				ListStore store = new ListStore (typeof (string));
@@ -58,10 +63,17 @@
 				compileTargetCombo.PackStart (cr, true);
 				compileTargetCombo.AddAttribute (cr, &quot;text&quot;, 0);
 				compileTargetCombo.Active = (int) configuration.CompileTarget;
+				compileTargetCombo.Changed += new EventHandler (OnTargetChanged);
 
 				symbolsEntry.Text = compilerParameters.DefineSymbols;
-				mainClassEntry.Text = compilerParameters.MainClass;
+				
+				classListStore = new ListStore (typeof(string));
+				mainClassEntry.Model = classListStore;
+				mainClassEntry.TextColumn = 0;
+				((Entry)mainClassEntry.Child).Text = compilerParameters.MainClass;
 
+				UpdateTarget ();
+				
 				generateDebugInformationCheckButton.Active = configuration.DebugMode;
 				generateXmlOutputCheckButton.Active        = compilerParameters.GenerateXmlDocumentation;
 				enableOptimizationCheckButton.Active       = compilerParameters.Optimize;
@@ -70,6 +82,36 @@
 				warningsAsErrorsCheckButton.Active         = ! configuration.RunWithWarnings;
 				warningLevelSpinButton.Value               = compilerParameters.WarningLevel;				
  			}
+			
+			void FillClasses ()
+			{
+				foreach (IClass c in Runtime.ParserService.GetProjectContents (project)) {
+					if (c.Methods != null) {
+						foreach (IMethod m in c.Methods) {
+							if (m.IsStatic &amp;&amp; m.Name == &quot;Main&quot;)
+								classListStore.AppendValues (c.FullyQualifiedName);
+						}
+					}
+				}
+			}
+			
+			void UpdateTarget ()
+			{
+				if ((CompileTarget) compileTargetCombo.Active == CompileTarget.Library) {
+					mainClassEntry.Sensitive = false;
+				} else {
+					mainClassEntry.Sensitive = true;
+					if (!classListFilled) {
+						FillClasses ();
+						classListFilled = true;
+					}
+				}
+			}
+			
+			void OnTargetChanged (object s, EventArgs a)
+			{
+				UpdateTarget ();
+			}
 
 			public bool Store ()
 			{	
@@ -78,7 +120,7 @@
 				}
 				configuration.CompileTarget =  (CompileTarget) compileTargetCombo.Active;
 				compilerParameters.DefineSymbols =  symbolsEntry.Text;
-				compilerParameters.MainClass     =  mainClassEntry.Text;
+				compilerParameters.MainClass     =  ((Entry)mainClassEntry.Child).Text;
 
 				configuration.DebugMode                = generateDebugInformationCheckButton.Active;
 				compilerParameters.GenerateXmlDocumentation = generateXmlOutputCheckButton.Active;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002263.html">[Monodevelop-patches-list] r2663 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Gui/Pads/ProjectPad
</A></li>
	<LI>Next message: <A HREF="002265.html">[Monodevelop-patches-list] r2665 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Gui/Dialogs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2264">[ date ]</a>
              <a href="thread.html#2264">[ thread ]</a>
              <a href="subject.html#2264">[ subject ]</a>
              <a href="author.html#2264">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
