<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2676 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Gui/Pads/ProjectPad
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2676%20-%20in%0A%09trunk/MonoDevelop/Core/src/MonoDevelop.Base%3A%20.%20Gui/Pads/ProjectPad&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002275.html">
   <LINK REL="Next"  HREF="002277.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2676 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Gui/Pads/ProjectPad</H1>
    <B>Lluis Sanchez &lt;lluis@ximian.com&gt;</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2676%20-%20in%0A%09trunk/MonoDevelop/Core/src/MonoDevelop.Base%3A%20.%20Gui/Pads/ProjectPad&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2676 - in	trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Gui/Pads/ProjectPad">lluis at mono-cvs.ximian.com
       </A><BR>
    <I>Wed Jul 20 07:06:27 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002275.html">[Monodevelop-patches-list] r2675 - in	trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor:	. Gui
</A></li>
        <LI>Next message: <A HREF="002277.html">[Monodevelop-patches-list] r2677 - in trunk/MonoDevelop:	Core/src/AddIns/DisplayBindings/SourceEditor	Core/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion	Core/src/AddIns/DisplayBindings/SourceEditor/Gui	Core/src/AddIns/DisplayBindings/SourceEditor/InsightWindow	Core/src/MonoDevelop.Base Core/src/MonoDevelop.Base/Gui	Core/src/MonoDevelop.Base/Gui/Completion	Core/src/MonoDevelop.Base/Services/ParserService	Extras/BooBinding Extras/BooBinding/BooShell	Extras/BooBinding/Gui Extras/BooBinding/Gui/OptionPanels	Extras/BooBinding/Parser Extras/BooBinding/Properties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2276">[ date ]</a>
              <a href="thread.html#2276">[ thread ]</a>
              <a href="subject.html#2276">[ subject ]</a>
              <a href="author.html#2276">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: lluis
Date: 2005-07-20 07:06:26 -0400 (Wed, 20 Jul 2005)
New Revision: 2676

Modified:
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/FolderNodeBuilder.cs
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolder.cs
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolderNodeBuilder.cs
Log:
2005-07-20  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;

	* Gui/Pads/ProjectPad/ProjectFolderNodeBuilder.cs: When a folder is
	renamed, update the whole tree branch starting from the parent node.
	* Gui/Pads/ProjectPad/ProjectFolder.cs: Don't update the path of the
	folder when receiving the Renamed event. Just signal that the name
	has changed.
	* Gui/Pads/ProjectPad/FolderNodeBuilder.cs: ProjectFile objects that
	represent a folder generate ProjectFolder nodes, so the renaming callback
	must be attached to a ProjectFolder object.



Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog	2005-07-20 10:34:11 UTC (rev 2675)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog	2005-07-20 11:06:26 UTC (rev 2676)
@@ -1,3 +1,14 @@
+2005-07-20  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;
+
+	* Gui/Pads/ProjectPad/ProjectFolderNodeBuilder.cs: When a folder is
+	renamed, update the whole tree branch starting from the parent node.
+	* Gui/Pads/ProjectPad/ProjectFolder.cs: Don't update the path of the
+	folder when receiving the Renamed event. Just signal that the name
+	has changed.
+	* Gui/Pads/ProjectPad/FolderNodeBuilder.cs: ProjectFile objects that
+	represent a folder generate ProjectFolder nodes, so the renaming callback
+	must be attached to a ProjectFolder object.
+
 2005-07-20  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt; 
 
 	* Commands/SearchCommands.cs:

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/FolderNodeBuilder.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/FolderNodeBuilder.cs	2005-07-20 10:34:11 UTC (rev 2675)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/FolderNodeBuilder.cs	2005-07-20 11:06:26 UTC (rev 2676)
@@ -309,7 +309,7 @@
 			newFolder.Subtype = Subtype.Directory;
 			project.ProjectFiles.Add (newFolder);
 
-			Tree.AddNodeInsertCallback (newFolder, new TreeNodeCallback (OnFileInserted));
+			Tree.AddNodeInsertCallback (new ProjectFolder (directoryName, project), new TreeNodeCallback (OnFileInserted));
 		}
 	}	
 }

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolder.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolder.cs	2005-07-20 10:34:11 UTC (rev 2675)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolder.cs	2005-07-20 11:06:26 UTC (rev 2676)
@@ -110,7 +110,10 @@
 		{
 			if (!e.IsDirectory || e.SourceFile != absolutePath) return;
 
-			absolutePath = e.TargetFile;
+			// The folder path can't be updated because we would be changing
+			// the identity of the object. Another folder object will need
+			// to be created by updating the tree.
+			
 			if (FolderRenamed != null) {
 				FolderRenamed(this, e);
 			}

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolderNodeBuilder.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolderNodeBuilder.cs	2005-07-20 10:34:11 UTC (rev 2675)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/Gui/Pads/ProjectPad/ProjectFolderNodeBuilder.cs	2005-07-20 11:06:26 UTC (rev 2676)
@@ -97,8 +97,8 @@
 		void OnFolderRenamed (object sender, FileEventArgs e)
 		{
 			ProjectFolder f = (ProjectFolder) sender;
-			ITreeBuilder tb = Context.GetTreeBuilder (new ProjectFolder (e.SourceFile, f.Project, null));
-			if (tb != null) tb.Update ();
+			ITreeBuilder tb = Context.GetTreeBuilder (f.Parent);
+			if (tb != null) tb.UpdateAll ();
 		}
 		
 		void OnFolderRemoved (object sender, FileEventArgs e)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002275.html">[Monodevelop-patches-list] r2675 - in	trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor:	. Gui
</A></li>
	<LI>Next message: <A HREF="002277.html">[Monodevelop-patches-list] r2677 - in trunk/MonoDevelop:	Core/src/AddIns/DisplayBindings/SourceEditor	Core/src/AddIns/DisplayBindings/SourceEditor/CodeCompletion	Core/src/AddIns/DisplayBindings/SourceEditor/Gui	Core/src/AddIns/DisplayBindings/SourceEditor/InsightWindow	Core/src/MonoDevelop.Base Core/src/MonoDevelop.Base/Gui	Core/src/MonoDevelop.Base/Gui/Completion	Core/src/MonoDevelop.Base/Services/ParserService	Extras/BooBinding Extras/BooBinding/BooShell	Extras/BooBinding/Gui Extras/BooBinding/Gui/OptionPanels	Extras/BooBinding/Parser Extras/BooBinding/Properties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2276">[ date ]</a>
              <a href="thread.html#2276">[ thread ]</a>
              <a href="subject.html#2276">[ subject ]</a>
              <a href="author.html#2276">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
