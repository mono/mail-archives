<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r1555 - in trunk/MonoDevelop: . src/Main/Base src/Main/Base/Gui/Pads src/Main/Base/Services/ParserService
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1555%20-%20in%20trunk/MonoDevelop%3A%20.%20src/Main/Base%20src/Main/Base/Gui/Pads%20src/Main/Base/Services/ParserService&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r1555 - in trunk/MonoDevelop: . src/Main/Base src/Main/Base/Gui/Pads src/Main/Base/Services/ParserService</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1555%20-%20in%20trunk/MonoDevelop%3A%20.%20src/Main/Base%20src/Main/Base/Gui/Pads%20src/Main/Base/Services/ParserService&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r1555 - in trunk/MonoDevelop: . src/Main/Base src/Main/Base/Gui/Pads src/Main/Base/Services/ParserService">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Sat May  1 16:24:29 EDT 2004</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001163.html">[Monodevelop-patches-list] r1556 - in trunk/MonoDevelop/src/Main/Base: . Gui/Dialogs Internal/Project/Project Services/ParserService
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1162">[ date ]</a>
              <a href="thread.html#1162">[ thread ]</a>
              <a href="subject.html#1162">[ subject ]</a>
              <a href="author.html#1162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tberman
Date: 2004-05-01 16:24:29 -0400 (Sat, 01 May 2004)
New Revision: 1555

Modified:
   trunk/MonoDevelop/configure.in
   trunk/MonoDevelop/src/Main/Base/ChangeLog
   trunk/MonoDevelop/src/Main/Base/Gui/Pads/OpenTaskView.cs
   trunk/MonoDevelop/src/Main/Base/Services/ParserService/DefaultParserService.cs
Log:
gac fixes, and a gtk+ 2.4 regression

*abi compat my ass*


Modified: trunk/MonoDevelop/configure.in
===================================================================
--- trunk/MonoDevelop/configure.in	2004-04-30 19:26:38 UTC (rev 1554)
+++ trunk/MonoDevelop/configure.in	2004-05-01 20:24:29 UTC (rev 1555)
@@ -103,7 +103,8 @@
 enable_xdgmime=&quot;yes&quot;
 fi
 
-AM_CONDITIONAL(ENABLE_DEBUGGER, test &quot;x$enable_debugger&quot; = &quot;xyes&quot;)
+dnl AM_CONDITIONAL(ENABLE_DEBUGGER, test &quot;x$enable_debugger&quot; = &quot;xyes&quot;)
+AM_CONDITIONAL(ENABLE_DEBUGGER, test &quot;yes&quot; = &quot;no&quot;)
 AM_CONDITIONAL(ENABLE_XDGMIME, test &quot;x$enable_xdgmime&quot; = &quot;xyes&quot;)
 
 dnl Intl

Modified: trunk/MonoDevelop/src/Main/Base/ChangeLog
===================================================================
--- trunk/MonoDevelop/src/Main/Base/ChangeLog	2004-04-30 19:26:38 UTC (rev 1554)
+++ trunk/MonoDevelop/src/Main/Base/ChangeLog	2004-05-01 20:24:29 UTC (rev 1555)
@@ -1,3 +1,9 @@
+2004-05-01  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at sevenl.net</A>&gt;
+
+	* Gui/Pads/OpenTaskView.cs: Fix gtk+2.4 regression.
+	* Services/ParserService/DefaultParserService.cs: load assemblies
+	out of the GAC for indexing.
+
 2004-04-30  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at sevenl.net</A>&gt;
 
 	* Gui/Pads/HelpBrowser/MonodocTreePad.cs: Hide doc nodes without

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Pads/OpenTaskView.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Pads/OpenTaskView.cs	2004-04-30 19:26:38 UTC (rev 1554)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Pads/OpenTaskView.cs	2004-05-01 20:24:29 UTC (rev 1555)
@@ -61,7 +61,7 @@
 			
 			
 			store = new Gtk.ListStore (
-				typeof (string),     // stock id
+				typeof (Gdk.Pixbuf), // image
 				typeof (int),        // line
 				typeof (string),     // desc
 				typeof (string),     // path
@@ -93,7 +93,6 @@
 		void AddColumns ()
 		{
 			Gtk.CellRendererPixbuf iconRender = new Gtk.CellRendererPixbuf ();
-			iconRender.StockSize = Gtk.IconSize.SmallToolbar;
 			
 			Gtk.CellRendererToggle toggleRender = new Gtk.CellRendererToggle ();
 			toggleRender.Toggled += new ToggledHandler (ItemToggled);
@@ -101,7 +100,7 @@
 			Gtk.CellRendererText line = new Gtk.CellRendererText (), desc = new Gtk.CellRendererText () , path = new Gtk.CellRendererText (),
 			  file = new Gtk.CellRendererText ();
 			
-			view.AppendColumn (&quot;!&quot;                                        , iconRender   , &quot;stock-id&quot;, COL_TYPE);
+			view.AppendColumn (&quot;!&quot;                                        , iconRender   , &quot;pixbuf&quot;, COL_TYPE);
 			view.AppendColumn (&quot;&quot;                                         , toggleRender , &quot;active&quot;  , COL_MARKED, &quot;activatable&quot;, COL_READ);
 			view.AppendColumn (GettextCatalog.GetString (&quot;Line&quot;)        , line         , &quot;text&quot;    , COL_LINE, &quot;weight&quot;, COL_READ_WEIGHT);
 			view.AppendColumn (GettextCatalog.GetString (&quot;Description&quot;) , desc         , &quot;text&quot;    , COL_DESC, &quot;weight&quot;, COL_READ_WEIGHT, &quot;strikethrough&quot;, COL_MARKED);
@@ -159,19 +158,19 @@
 			TaskService taskService = (TaskService) ServiceManager.Services.GetService (typeof (TaskService));
 			
 			foreach (Task t in taskService.Tasks) {
-				string stock;
+				Gdk.Pixbuf stock;
 				switch (t.TaskType) {
 					case TaskType.Warning:
-						stock = Gtk.Stock.DialogWarning;
+						stock = sw.RenderIcon (Gtk.Stock.DialogWarning, Gtk.IconSize.SmallToolbar, &quot;&quot;);
 						break;
 					case TaskType.Error:
-						stock = Gtk.Stock.DialogError;
+						stock = sw.RenderIcon (Gtk.Stock.DialogError, Gtk.IconSize.SmallToolbar, &quot;&quot;);
 						break;
 					case TaskType.Comment:
-						stock = Gtk.Stock.DialogInfo;
+						stock = sw.RenderIcon (Gtk.Stock.DialogInfo, Gtk.IconSize.SmallToolbar, &quot;&quot;);
 						break;
 					case TaskType.SearchResult:
-						stock = Gtk.Stock.DialogQuestion;
+						stock = sw.RenderIcon (Gtk.Stock.DialogQuestion, Gtk.IconSize.SmallToolbar, &quot;&quot;);
 						break;
 					default:
 						stock = null;

Modified: trunk/MonoDevelop/src/Main/Base/Services/ParserService/DefaultParserService.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Services/ParserService/DefaultParserService.cs	2004-04-30 19:26:38 UTC (rev 1554)
+++ trunk/MonoDevelop/src/Main/Base/Services/ParserService/DefaultParserService.cs	2004-05-01 20:24:29 UTC (rev 1555)
@@ -103,7 +103,45 @@
 				return assemblyList;
 			}
 		}
+		
+		string LoadAssemblyFromGac (string name) {
+			MethodInfo gac_get = typeof (System.Environment).GetMethod (&quot;internalGetGacPath&quot;, BindingFlags.Static|BindingFlags.NonPublic);
+			
+			if (gac_get == null)
+				return String.Empty;
+			
+			string use_name = name;
+			string asmb_path;
+			string [] canidates;
 
+			if (name == &quot;mscorlib&quot;)
+				return Path.Combine ((string) gac_get.Invoke (null, null), name + &quot;.dll&quot;);
+            
+			if (name.EndsWith (&quot;.dll&quot;))
+				use_name = name.Substring (0, name.Length - 4);
+			
+			asmb_path = Path.Combine (Path.Combine (Path.Combine ((string) gac_get.Invoke (null, null), &quot;mono&quot;), &quot;gac&quot;), use_name);
+            
+			if (!Directory.Exists (asmb_path))
+				return String.Empty;
+			
+			canidates = Directory.GetDirectories (asmb_path, GetSysVersion () + &quot;*&quot;);
+			if (canidates.Length == 0)
+				canidates = Directory.GetDirectories (asmb_path);
+			if (canidates.Length == 0)
+				return String.Empty;
+			
+			return Path.Combine (canidates [0], use_name + &quot;.dll&quot;);
+		}
+		
+		string sys_version;
+		string GetSysVersion () {
+			if (sys_version != null)
+				return sys_version;
+			sys_version = typeof (object).Assembly.GetName ().Version.ToString ();
+			return sys_version;
+		}
+		
 		/// &lt;remarks&gt;
 		/// The initialize method writes the location of the code completion proxy
 		/// file to this string.
@@ -167,11 +205,11 @@
 			// convert all assemblies
 			for (int i = 0; i &lt; assemblyList.Length; ++i) {
 				try {
-					FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
-					string path = fileUtilityService.GetDirectoryNameWithSeparator(System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory());
-
+					//FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
+					//string path = fileUtilityService.GetDirectoryNameWithSeparator(System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory());
+					
 					AssemblyInformation frameworkAssemblyInformation = new AssemblyInformation();
-					frameworkAssemblyInformation.Load(String.Concat(path, assemblyList[i], &quot;.dll&quot;), false);
+					frameworkAssemblyInformation.Load(LoadAssemblyFromGac (assemblyList[i]), false);
 					// create all class proxies
 					foreach (IClass newClass in frameworkAssemblyInformation.Classes) {
 						ClassProxy newProxy = new ClassProxy(newClass);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001163.html">[Monodevelop-patches-list] r1556 - in trunk/MonoDevelop/src/Main/Base: . Gui/Dialogs Internal/Project/Project Services/ParserService
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1162">[ date ]</a>
              <a href="thread.html#1162">[ thread ]</a>
              <a href="subject.html#1162">[ subject ]</a>
              <a href="author.html#1162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
