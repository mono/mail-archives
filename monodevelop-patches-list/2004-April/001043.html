<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r1436 - in trunk/MonoDevelop/src/Main/Base: . Commands Gui/Workbench
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1436%20-%20in%20trunk/MonoDevelop/src/Main/Base%3A%20.%20Commands%20Gui/Workbench&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001042.html">
   <LINK REL="Next"  HREF="001044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r1436 - in trunk/MonoDevelop/src/Main/Base: . Commands Gui/Workbench</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1436%20-%20in%20trunk/MonoDevelop/src/Main/Base%3A%20.%20Commands%20Gui/Workbench&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r1436 - in trunk/MonoDevelop/src/Main/Base: . Commands Gui/Workbench">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Sun Apr 11 04:03:13 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="001042.html">[Monodevelop-patches-list] r1435 - in trunk/MonoDevelop/src: AddIns/DisplayBindings/SourceEditor AddIns/DisplayBindings/SourceEditor/Gui Main/Base Main/Base/Internal/Project/Project
</A></li>
        <LI>Next message: <A HREF="001044.html">[Monodevelop-patches-list] r1437 - in trunk/MonoDevelop/src/Main/Base: . Gui/Workbench
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1043">[ date ]</a>
              <a href="thread.html#1043">[ thread ]</a>
              <a href="subject.html#1043">[ subject ]</a>
              <a href="author.html#1043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tberman
Date: 2004-04-11 04:03:12 -0400 (Sun, 11 Apr 2004)
New Revision: 1436

Modified:
   trunk/MonoDevelop/src/Main/Base/ChangeLog
   trunk/MonoDevelop/src/Main/Base/Commands/AutostartCommands.cs
   trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs
   trunk/MonoDevelop/src/Main/Base/Gui/Workbench/WorkbenchMemento.cs
Log:
properly save/restore maximized state.


Modified: trunk/MonoDevelop/src/Main/Base/ChangeLog
===================================================================
--- trunk/MonoDevelop/src/Main/Base/ChangeLog	2004-04-11 03:10:44 UTC (rev 1435)
+++ trunk/MonoDevelop/src/Main/Base/ChangeLog	2004-04-11 08:03:12 UTC (rev 1436)
@@ -1,3 +1,11 @@
+2004-04-11  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at sevenl.net</A>&gt;
+
+	* Commands/AutostartCommands.cs: reorganize the SetMemento so it works
+	better.
+	* Gui/Workbench/WorkbenchMemento.cs: readd windowstate.
+	* Gui/Workbench/DefaultWorkbench.cs: now we restore from maximized
+	properly.
+
 2004-04-10  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at sevenl.net</A>&gt;
 
 	* Internal/Project/Project/AbstractProject.cs: fix potentiall nullref

Modified: trunk/MonoDevelop/src/Main/Base/Commands/AutostartCommands.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Commands/AutostartCommands.cs	2004-04-11 03:10:44 UTC (rev 1435)
+++ trunk/MonoDevelop/src/Main/Base/Commands/AutostartCommands.cs	2004-04-11 08:03:12 UTC (rev 1436)
@@ -1,7 +1,7 @@
 // &lt;file&gt;
 //     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
 //     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
-//     &lt;owner name=&quot;Mike Kr&#195;&#131;&#194;&#188;ger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;owner name=&quot;Mike Kr&#195;?&#194;&#188;ger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
 //     &lt;version value=&quot;$version&quot;/&gt;
 // &lt;/file&gt;
 
@@ -41,10 +41,10 @@
 			
 			w.InitializeWorkspace();
 			PropertyService propertyService = (PropertyService)ServiceManager.Services.GetService(typeof(PropertyService));
-			w.SetMemento((IXmlConvertable)propertyService.GetProperty(workbenchMemento, new WorkbenchMemento()));
 			w.UpdateViews(null, null);
 			WorkbenchSingleton.CreateWorkspace();
 			((Gtk.Window)w).Visible = false;
+			w.SetMemento ((IXmlConvertable)propertyService.GetProperty (workbenchMemento, new WorkbenchMemento ()));
 			
 		}
 	}

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs	2004-04-11 03:10:44 UTC (rev 1435)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs	2004-04-11 08:03:12 UTC (rev 1436)
@@ -396,14 +396,14 @@
 		public IXmlConvertable CreateMemento()
 		{
 			WorkbenchMemento memento   = new WorkbenchMemento();
-			int x, y, width, height;
-			GdkWindow.GetSize (out width, out height);
-			GdkWindow.GetRootOrigin (out x, out y);
-			if (GdkWindow.State != Gdk.WindowState.Fullscreen &amp;&amp; GdkWindow.State != Gdk.WindowState.Maximized) {
+			int x, y, width, height, depth;
+			GdkWindow.GetGeometry (out x, out y, out width, out height, out depth);
+			if (GdkWindow.State == 0) {
 				memento.Bounds             = new Rectangle (x, y, width, height);
 			} else {
 				memento.Bounds = normalBounds;
 			}
+			memento.WindowState = GdkWindow.State;
 
 			memento.FullScreen         = fullscreen;
 			return memento;
@@ -417,6 +417,11 @@
 				normalBounds = memento.Bounds;
 				Move (normalBounds.X, normalBounds.Y);
 				Resize (normalBounds.Width, normalBounds.Height);
+				if (memento.WindowState == Gdk.WindowState.Maximized) {
+					Maximize ();
+				} else if (memento.WindowState == Gdk.WindowState.Iconified) {
+					Iconify ();
+				}
 				FullScreen = memento.FullScreen;
 			}
 			Decorated = true;

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Workbench/WorkbenchMemento.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Workbench/WorkbenchMemento.cs	2004-04-11 03:10:44 UTC (rev 1435)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Workbench/WorkbenchMemento.cs	2004-04-11 08:03:12 UTC (rev 1436)
@@ -19,7 +19,7 @@
 	/// &lt;/summary&gt;
 	public class WorkbenchMemento : IXmlConvertable
 	{
-		//FormWindowState windowstate        = FormWindowState.Normal;
+		Gdk.WindowState windowstate        = 0;
 		//FormWindowState defaultwindowstate = FormWindowState.Normal;
 		Rectangle       bounds             = new Rectangle(0, 0, 640, 480);
 		bool            fullscreen         = false;
@@ -33,14 +33,14 @@
 			}
 		}*/
 		
-		/*public FormWindowState WindowState {
+		public Gdk.WindowState WindowState {
 			get {
 				return windowstate;
 			}
 			set {
 				windowstate = value;
 			}
-		}*/
+		}
 		
 		public Rectangle Bounds {
 			get {
@@ -76,9 +76,10 @@
 			
 			bounds = new Rectangle(Int32.Parse(boundstr[0]), Int32.Parse(boundstr[1]), 
 			                       Int32.Parse(boundstr[2]), Int32.Parse(boundstr[3]));
+			if (element.Attributes[&quot;formwindowstate&quot;] != null) {
+				windowstate = (Gdk.WindowState)Enum.Parse(typeof(Gdk.WindowState), element.Attributes[&quot;formwindowstate&quot;].InnerText);
+			}
 			
-			//windowstate = (FormWindowState)Enum.Parse(typeof(FormWindowState), element.Attributes[&quot;formwindowstate&quot;].InnerText);
-			
 			/*if (element.Attributes[&quot;defaultformwindowstate&quot;] != null) {
 				defaultwindowstate = (FormWindowState)Enum.Parse(typeof(FormWindowState), element.Attributes[&quot;defaultformwindowstate&quot;].InnerText);
 			}*/
@@ -100,11 +101,11 @@
 			attr.InnerText = bounds.X + &quot;,&quot; + bounds.Y + &quot;,&quot; + bounds.Width + &quot;,&quot; + bounds.Height;
 			element.Attributes.Append(attr);
 			
-			/*attr = doc.CreateAttribute(&quot;formwindowstate&quot;);
+			attr = doc.CreateAttribute (&quot;formwindowstate&quot;);
 			attr.InnerText = windowstate.ToString();
 			element.Attributes.Append(attr);
 			
-			attr = doc.CreateAttribute(&quot;defaultformwindowstate&quot;);
+			/*attr = doc.CreateAttribute(&quot;defaultformwindowstate&quot;);
 			attr.InnerText = defaultwindowstate.ToString();
 			element.Attributes.Append(attr);*/
 			


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001042.html">[Monodevelop-patches-list] r1435 - in trunk/MonoDevelop/src: AddIns/DisplayBindings/SourceEditor AddIns/DisplayBindings/SourceEditor/Gui Main/Base Main/Base/Internal/Project/Project
</A></li>
	<LI>Next message: <A HREF="001044.html">[Monodevelop-patches-list] r1437 - in trunk/MonoDevelop/src/Main/Base: . Gui/Workbench
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1043">[ date ]</a>
              <a href="thread.html#1043">[ thread ]</a>
              <a href="subject.html#1043">[ subject ]</a>
              <a href="author.html#1043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
