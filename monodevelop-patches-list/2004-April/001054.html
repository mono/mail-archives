<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r1447 - in trunk/MonoDevelop: . build/AddIns/AddIns/BackendBindings src/AddIns/BackendBindings src/AddIns/BackendBindings/ILAsmBinding src/AddIns/BackendBindings/ILAsmBinding/Gui src/AddIns/BackendBindings/ILAsmBinding/Project
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1447%20-%20in%20trunk/MonoDevelop%3A%20.%20build/AddIns/AddIns/BackendBindings%20src/AddIns/BackendBindings%20src/AddIns/BackendBindings/ILAsmBinding%20src/AddIns/BackendBindings/ILAsmBinding/Gui%20src/AddIns/BackendBindings/ILAsmBinding/Project&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001053.html">
   <LINK REL="Next"  HREF="001055.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r1447 - in trunk/MonoDevelop: . build/AddIns/AddIns/BackendBindings src/AddIns/BackendBindings src/AddIns/BackendBindings/ILAsmBinding src/AddIns/BackendBindings/ILAsmBinding/Gui src/AddIns/BackendBindings/ILAsmBinding/Project</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1447%20-%20in%20trunk/MonoDevelop%3A%20.%20build/AddIns/AddIns/BackendBindings%20src/AddIns/BackendBindings%20src/AddIns/BackendBindings/ILAsmBinding%20src/AddIns/BackendBindings/ILAsmBinding/Gui%20src/AddIns/BackendBindings/ILAsmBinding/Project&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r1447 - in trunk/MonoDevelop: . build/AddIns/AddIns/BackendBindings src/AddIns/BackendBindings src/AddIns/BackendBindings/ILAsmBinding src/AddIns/BackendBindings/ILAsmBinding/Gui src/AddIns/BackendBindings/ILAsmBinding/Project">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Mon Apr 12 18:11:01 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="001053.html">[Monodevelop-patches-list] r1446 - trunk/MonoDevelop
</A></li>
        <LI>Next message: <A HREF="001055.html">[Monodevelop-patches-list] r1448 - trunk/MonoDevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1054">[ date ]</a>
              <a href="thread.html#1054">[ thread ]</a>
              <a href="subject.html#1054">[ subject ]</a>
              <a href="author.html#1054">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jluke
Date: 2004-04-12 18:11:01 -0400 (Mon, 12 Apr 2004)
New Revision: 1447

Added:
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/AssemblyInfo.cs
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ChangeLog
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Gui/
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Gui/CompilerParametersPanel.cs
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmCompilerManager.cs
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmExecutionManager.cs
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmLanguageBinding.cs
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Makefile.am
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/CompilationTarget.cs
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmCompilerParameters.cs
   trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmProject.cs
Modified:
   trunk/MonoDevelop/ChangeLog
   trunk/MonoDevelop/build/AddIns/AddIns/BackendBindings/BackendBindings.addin.xml
   trunk/MonoDevelop/configure.in
   trunk/MonoDevelop/src/AddIns/BackendBindings/Makefile.am
Log:
import ILAsmBinding from SD
not tested or working


Modified: trunk/MonoDevelop/ChangeLog
===================================================================
--- trunk/MonoDevelop/ChangeLog	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/ChangeLog	2004-04-12 22:11:01 UTC (rev 1447)
@@ -1,3 +1,7 @@
+2004-04-12  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jluke at cfl.rr.com</A>&gt;
+
+	import ILAsmBinding from SD svn	
+
 2004-04-12  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at sevenl.net</A>&gt;
 
 	* configure.in: bump to 0.18.99 gtk-sharp

Modified: trunk/MonoDevelop/build/AddIns/AddIns/BackendBindings/BackendBindings.addin.xml
===================================================================
--- trunk/MonoDevelop/build/AddIns/AddIns/BackendBindings/BackendBindings.addin.xml	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/build/AddIns/AddIns/BackendBindings/BackendBindings.addin.xml	2004-04-12 22:11:01 UTC (rev 1447)
@@ -11,6 +11,7 @@
 &lt;!-- ORIGINAL #D COMMENT		&lt;Import assembly = &quot;JScriptLanguageModule.dll&quot;/&gt; --&gt;
 &lt;!--		&lt;Import assembly = &quot;VBNetBinding.dll&quot;/&gt; --&gt;
 		&lt;Import assembly = &quot;NemerleBinding.dll&quot;/&gt; 
+&lt;!--		&lt;Import assembly = &quot;ILAsmBinding.dll&quot;/&gt; --&gt;
 	&lt;/Runtime&gt;
 
 	&lt;Extension path = &quot;/SharpDevelop/Workbench/Ambiences&quot;&gt;
@@ -119,6 +120,12 @@
 			             _label = &quot;Output&quot;
 			             class = &quot;NemerleBinding.OutputPanel&quot;/&gt;
 		&lt;/Conditional&gt;		
+	&lt;!--	&lt;Conditional activeproject=&quot;ILAsm&quot;&gt;
+			&lt;DialogPanel id = &quot;ILAsmCompilerParametersPanel&quot;
+						 label = &quot;Compiler&quot;
+						 class = &quot;ICSharpCode.ILAsmBinding.CompilerParametersPanel&quot;/&gt; 
+
+		&lt;/Conditional&gt; --&gt;
 	&lt;/Extension&gt;
 	
 
@@ -222,6 +229,11 @@
 		&lt;LanguageBinding id    = &quot;Nemerle&quot;
 		                 supportedextensions = &quot;.n&quot;
 		                 class = &quot;NemerleBinding.NemerleLanguageBinding&quot; /&gt;
+		&lt;!--
+		&lt;LanguageBinding id    = &quot;ILAsm&quot;
+		                 supportedextensions = &quot;.il&quot;
+		                 class = &quot;MonoDevelop.ILAsmLanguageBinding&quot; /&gt;
+		--&gt;
 	&lt;/Extension&gt;
 	
 	&lt;Extension path = &quot;/SharpDevelop/Views/ProjectBrowser/NodeBuilders&quot;&gt;

Modified: trunk/MonoDevelop/configure.in
===================================================================
--- trunk/MonoDevelop/configure.in	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/configure.in	2004-04-12 22:11:01 UTC (rev 1447)
@@ -133,6 +133,7 @@
 src/AddIns/BackendBindings/Makefile
 src/AddIns/BackendBindings/CSharpBinding/Makefile
 src/AddIns/BackendBindings/JavaBinding/Makefile
+src/AddIns/BackendBindings/ILAsmBinding/Makefile
 src/AddIns/BackendBindings/NemerleBinding/Makefile
 src/AddIns/DisplayBindings/Makefile
 src/AddIns/DisplayBindings/SourceEditor/Makefile


Property changes on: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding
___________________________________________________________________
Name: svn:ignore
   + Makefile
Makefile.in
ILAsmBinding.dll


Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/AssemblyInfo.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/AssemblyInfo.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/AssemblyInfo.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,32 @@
+using System.Reflection;
+using System.Runtime.CompilerServices;
+
+// Information about this assembly is defined by the following
+// attributes.
+//
+// change them to the information which is associated with the assembly
+// you compile.
+
+[assembly: AssemblyTitle(&quot;ILAsmBinding&quot;)]
+[assembly: AssemblyDescription(&quot;IL language binding for #develop&quot;)]
+[assembly: AssemblyConfiguration(&quot;&quot;)]
+[assembly: AssemblyCompany(&quot;www.icsharpcode.net&quot;)]
+[assembly: AssemblyProduct(&quot;&quot;)]
+[assembly: AssemblyCopyright(&quot;(c) 2004 Mike Krueger&quot;)]
+[assembly: AssemblyTrademark(&quot;&quot;)]
+[assembly: AssemblyCulture(&quot;&quot;)]
+
+// The assembly version has following format :
+//
+// Major.Minor.Build.Revision
+//
+// You can specify all values by your own or you can build default build and revision
+// numbers with the '*' character (the default):
+
+[assembly: AssemblyVersion(&quot;1.0.*&quot;)]
+
+// The following attributes specify the key for the sign of your assembly. See the
+// .NET Framework documentation for more information about signing.
+// This is not required, if you don't want signing let these attributes like they're.
+[assembly: AssemblyDelaySign(false)]
+[assembly: AssemblyKeyFile(&quot;&quot;)]

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ChangeLog
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ChangeLog	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ChangeLog	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,4 @@
+
+	import from SD svn
+	not yet working and untested
+

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Gui/CompilerParametersPanel.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Gui/CompilerParametersPanel.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Gui/CompilerParametersPanel.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,40 @@
+// &lt;file&gt;
+//     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
+//     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
+//     &lt;owner name=&quot;Mike Krueger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;version value=&quot;$version&quot;/&gt;
+// &lt;/file&gt;
+
+using System;
+using System.IO;
+using Gtk;
+
+using MonoDevelop.Internal.Project;
+using MonoDevelop.Internal.ExternalTool;
+using MonoDevelop.Gui.Dialogs;
+using MonoDevelop.Core.Services;
+using MonoDevelop.Core.Properties;
+using MonoDevelop.Core.AddIns.Codons;
+
+namespace MonoDevelop.ILAsmBinding
+{
+	public class CompilerParametersPanel : AbstractOptionPanel
+	{
+		ILAsmCompilerParameters compilerParameters = null;
+		
+		public override void LoadPanelContents()
+		{
+			this.compilerParameters = (ILAsmCompilerParameters)((IProperties)CustomizationObject).GetProperty(&quot;Config&quot;);
+			
+			//System.Windows.Forms.PropertyGrid grid = new System.Windows.Forms.PropertyGrid();
+			//grid.Dock = DockStyle.Fill;
+			//grid.SelectedObjects = new object[] { compilerParameters};
+			//Controls.Add(grid);
+		}
+		
+		public override bool StorePanelContents()
+		{
+			return true;
+		}
+	}
+}

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmCompilerManager.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmCompilerManager.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmCompilerManager.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,174 @@
+// &lt;file&gt;
+//     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
+//     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
+//     &lt;owner name=&quot;Mike Krueger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;version value=&quot;$version&quot;/&gt;
+// &lt;/file&gt;
+
+using System;
+using System.Collections;
+using System.IO;
+using System.Diagnostics;
+using System.Text;
+using System.Text.RegularExpressions;
+using System.CodeDom.Compiler;
+using Gtk;
+
+using MonoDevelop.Services;
+using MonoDevelop.Core.Services;
+using MonoDevelop.Internal.Project;
+using MonoDevelop.Gui;
+
+namespace MonoDevelop.ILAsmBinding
+{
+	/// &lt;summary&gt;
+	/// Description of ILAsmCompilerManager.	
+	/// &lt;/summary&gt;
+	public class ILAsmCompilerManager
+	{
+		FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
+		
+		public string GetCompiledOutputName(string fileName)
+		{
+			return Path.ChangeExtension(fileName, &quot;.exe&quot;);
+		}
+		
+		public string GetCompiledOutputName(IProject project)
+		{
+			ILAsmProject p = (ILAsmProject)project;
+			ILAsmCompilerParameters compilerparameters = (ILAsmCompilerParameters)p.ActiveConfiguration;
+			string exe  = fileUtilityService.GetDirectoryNameWithSeparator(compilerparameters.OutputDirectory) + compilerparameters.OutputAssembly + &quot;.exe&quot;;
+			return exe;
+		}
+		
+		public bool CanCompile(string fileName)
+		{
+			return Path.GetExtension(fileName).ToUpper() == &quot;.IL&quot;;
+		}
+		
+		ICompilerResult Compile(ILAsmCompilerParameters compilerparameters, string[] fileNames)
+		{
+			// TODO: No response file possible ? @FILENAME seems not to work.
+			string output = String.Empty;
+			string error  = String.Empty;
+			StringBuilder parameters = new StringBuilder();
+			foreach (string fileName in fileNames) {
+				parameters.Append('&quot;');
+				parameters.Append(Path.GetFullPath(fileName));
+				parameters.Append(&quot;\&quot; &quot;);
+			}
+			
+			string outputFile = Path.GetFullPath(fileUtilityService.GetDirectoryNameWithSeparator(compilerparameters.OutputDirectory) + compilerparameters.OutputAssembly + &quot;.exe&quot;);
+			parameters.Append(&quot;/OUTPUT=\&quot;&quot; + outputFile + &quot;\&quot;&quot;);
+			parameters.Append(&quot; &quot;);
+			parameters.Append(compilerparameters.CurrentCompilerOptions.GenerateOptions());
+			string compilerName = GetCompilerName();
+			string outstr = compilerName + &quot; &quot; + parameters.ToString();
+			
+			TempFileCollection tf = new TempFileCollection();
+			Executor.ExecWaitWithCapture(outstr, Path.GetFullPath(compilerparameters.OutputDirectory), tf, ref output, ref error);
+			
+			ICompilerResult result = ParseOutput(tf, output);
+			
+			File.Delete(output);
+			File.Delete(error);
+			return result;
+		}
+		
+		public ICompilerResult CompileFile(string fileName, ILAsmCompilerParameters compilerparameters)
+		{
+			compilerparameters.OutputDirectory = Path.GetDirectoryName(fileName);
+			compilerparameters.OutputAssembly  = Path.GetFileNameWithoutExtension(fileName);
+			
+			return Compile(compilerparameters, new string[] { fileName });
+		}
+		
+		public ICompilerResult CompileProject(IProject project)
+		{
+			ILAsmProject            p                  = (ILAsmProject)project;
+			ILAsmCompilerParameters compilerparameters = (ILAsmCompilerParameters)p.ActiveConfiguration;
+			
+			ArrayList fileNames = new ArrayList();
+			
+			foreach (ProjectFile finfo in p.ProjectFiles) {
+				if (finfo.Subtype != Subtype.Directory) {
+					switch (finfo.BuildAction) {
+						case BuildAction.Compile:
+							fileNames.Add(finfo.Name);
+							break;
+//				TODO : Embedded resources ?		
+//						case BuildAction.EmbedAsResource:
+//							writer.WriteLine(&quot;\&quot;/res:&quot; + finfo.Name + &quot;\&quot;&quot;);
+//							break;
+					}
+				}
+			}
+			
+			return Compile(compilerparameters, (string[])fileNames.ToArray(typeof(string)));
+		}
+		
+		string GetCompilerName()
+		{
+			return &quot;ilasm&quot;;
+		}
+		
+		ICompilerResult ParseOutput(TempFileCollection tf, string file)
+		{
+			StringBuilder compilerOutput = new StringBuilder();
+			
+			StreamReader sr = File.OpenText(file);
+			
+			// skip fist whitespace line
+			sr.ReadLine();
+			
+			CompilerResults cr = new CompilerResults(tf);
+			
+			// we have 2 formats for the error output the csc gives :
+			Regex normalError  = new Regex(@&quot;(?&lt;file&gt;.*)\((?&lt;line&gt;\d+),(?&lt;column&gt;\d+)\):\s+(?&lt;error&gt;\w+)\s+(?&lt;number&gt;[\d\w]+):\s+(?&lt;message&gt;.*)&quot;, RegexOptions.Compiled);
+			Regex generalError = new Regex(@&quot;(?&lt;error&gt;.+)\s+(?&lt;number&gt;[\d\w]+):\s+(?&lt;message&gt;.*)&quot;, RegexOptions.Compiled);
+			
+			while (true) {
+				string curLine = sr.ReadLine();
+				compilerOutput.Append(curLine);
+				compilerOutput.Append('\n');
+				if (curLine == null) {
+					break;
+				}
+				// TODO : PARSE ERROR OUTPUT.
+				
+//				curLine = curLine.Trim();
+//				if (curLine.Length == 0) {
+//					continue;
+//				}
+//				
+//				CompilerError error = new CompilerError();
+//				
+//				// try to match standard errors
+//				Match match = normalError.Match(curLine);
+//				if (match.Success) {
+//					error.Column      = Int32.Parse(match.Result(&quot;${column}&quot;));
+//					error.Line        = Int32.Parse(match.Result(&quot;${line}&quot;));
+//					error.FileName    = Path.GetFullPath(match.Result(&quot;${file}&quot;));
+//					error.IsWarning   = match.Result(&quot;${error}&quot;) == &quot;warning&quot;; 
+//					error.ErrorNumber = match.Result(&quot;${number}&quot;);
+//					error.ErrorText   = match.Result(&quot;${message}&quot;);
+//				} else {
+//					match = generalError.Match(curLine); // try to match general csc errors
+//					if (match.Success) {
+//						error.IsWarning   = match.Result(&quot;${error}&quot;) == &quot;warning&quot;; 
+//						error.ErrorNumber = match.Result(&quot;${number}&quot;);
+//						error.ErrorText   = match.Result(&quot;${message}&quot;);
+//					} else { // give up and skip the line
+//						continue;
+////						error.IsWarning = false;
+////						error.ErrorText = curLine;
+//					}
+//				}
+//				
+//				cr.Errors.Add(error);
+			}
+			sr.Close();
+			return new DefaultCompilerResult(cr, compilerOutput.ToString());
+		}
+	}
+}

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmExecutionManager.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmExecutionManager.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmExecutionManager.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,56 @@
+// &lt;file&gt;
+//     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
+//     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
+//     &lt;owner name=&quot;Mike Krueger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;version value=&quot;$version&quot;/&gt;
+// &lt;/file&gt;
+
+using System;
+using System.IO;
+using System.Diagnostics;
+using System.Collections;
+using System.Reflection;
+using System.Resources;
+using System.Xml;
+using System.CodeDom.Compiler;
+using System.Threading;
+using Gtk;
+
+using MonoDevelop.Internal.Project;
+using MonoDevelop.Gui;
+using MonoDevelop.Services;
+using MonoDevelop.Core.Services;
+
+namespace MonoDevelop.ILAsmBinding
+{
+	/// &lt;summary&gt;
+	/// This class describes the main functionalaty of a language codon
+	/// &lt;/summary&gt;
+	public class ILAsmExecutionManager
+	{
+		public void Execute(string filename, bool debug)
+		{
+			string exe = Path.ChangeExtension(filename, &quot;.exe&quot;);
+			ProcessStartInfo psi = new ProcessStartInfo(&quot;\&quot;&quot; + exe + &quot;\&quot;&quot;);
+			psi.WorkingDirectory = Path.GetDirectoryName(exe);
+			psi.UseShellExecute = true;
+			
+			//DebuggerService debuggerService  = (DebuggerService)ServiceManager.Services.GetService(typeof(DebuggerService));
+			//debuggerService.StartWithoutDebugging(psi);
+		}
+		
+		public void Execute(IProject project, bool debug)
+		{
+			ILAsmCompilerParameters parameters = (ILAsmCompilerParameters)project.ActiveConfiguration;
+			FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
+			
+			string exe = Path.GetFullPath(Path.Combine(parameters.OutputDirectory, parameters.OutputAssembly) + &quot;.exe&quot;);
+			ProcessStartInfo psi = new ProcessStartInfo(&quot;\&quot;&quot; + exe  + &quot;\&quot;&quot;);
+			psi.WorkingDirectory = Path.GetDirectoryName(exe);
+			psi.UseShellExecute  = true;
+			
+			//DebuggerService debuggerService  = (DebuggerService)ServiceManager.Services.GetService(typeof(DebuggerService));
+			//debuggerService.StartWithoutDebugging(psi);
+		}
+	}
+}

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmLanguageBinding.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmLanguageBinding.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/ILAsmLanguageBinding.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,107 @@
+// &lt;file&gt;
+//     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
+//     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
+//     &lt;owner name=&quot;Mike Krueger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;version value=&quot;$version&quot;/&gt;
+// &lt;/file&gt;
+
+using System;
+using System.IO;
+using System.Diagnostics;
+using System.Collections;
+using System.Reflection;
+using System.Resources;
+using System.Xml;
+using System.CodeDom.Compiler;
+using System.Threading;
+using Gtk;
+
+using MonoDevelop.Internal.Project;
+using MonoDevelop.Internal.Templates;
+using MonoDevelop.Gui;
+
+namespace MonoDevelop.ILAsmBinding
+{
+	public class ILAsmLanguageBinding : ILanguageBinding
+	{
+		public const string LanguageName = &quot;ILAsm&quot;;
+		
+		ILAsmExecutionManager executionManager = new ILAsmExecutionManager();
+		ILAsmCompilerManager  compilerManager  = new ILAsmCompilerManager();
+		
+		public string Language {
+			get {
+				return LanguageName;
+			}
+		}
+		
+		public void Execute(string filename)
+		{
+			Execute (filename, false);
+		}
+	
+		public void Execute(string filename, bool debug)
+		{
+			Debug.Assert(executionManager != null);
+			executionManager.Execute(filename, debug);
+		}
+		
+		public void Execute (IProject project)
+		{
+			Execute (project, false);
+		}
+
+		public void DebugProject (IProject project)
+		{
+			Execute (project, true);
+		}
+
+		public void Execute(IProject project, bool debug)
+		{
+			Debug.Assert(executionManager != null);
+			executionManager.Execute(project, debug);
+		}
+		
+		public string GetCompiledOutputName(string fileName)
+		{
+			Debug.Assert(compilerManager != null);
+			return compilerManager.GetCompiledOutputName(fileName);
+		}
+		
+		public string GetCompiledOutputName(IProject project)
+		{
+			Debug.Assert(compilerManager != null);
+			return compilerManager.GetCompiledOutputName(project);
+		}
+		
+		public bool CanCompile(string fileName)
+		{
+			Debug.Assert(compilerManager != null);
+			return compilerManager.CanCompile(fileName);
+		}
+		
+		public ICompilerResult CompileFile(string fileName)
+		{
+			Debug.Assert(compilerManager != null);
+			ILAsmCompilerParameters param = new ILAsmCompilerParameters();
+			param.OutputAssembly = Path.ChangeExtension(fileName, &quot;.exe&quot;);
+			return compilerManager.CompileFile(fileName, param);
+		}
+		
+		public ICompilerResult CompileProject(IProject project)
+		{
+			Debug.Assert(compilerManager != null);
+			return compilerManager.CompileProject(project);
+		}
+		
+		public ICompilerResult RecompileProject(IProject project)
+		{
+			return CompileProject(project);
+		}
+		
+		public IProject CreateProject(ProjectCreateInformation info, XmlElement projectOptions)
+		{
+			return new ILAsmProject(info, projectOptions);
+		}
+	}
+}

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Makefile.am
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Makefile.am	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Makefile.am	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,34 @@
+
+CSC = mcs /debug
+ASSEMBLY = ILAsmBinding.dll
+
+DLLS = /r:../../../../build/bin/MonoDevelop.Core.dll \
+	/r:../../../../build/bin/MonoDevelop.Base.dll \
+	/r:../../../../build/bin/MonoDevelop.SourceEditor.dll \
+	/r:../../../../build/bin/MonoDevelop.Gui.Widgets.dll \
+	/r:gtk-sharp.dll
+
+FILES = \
+./Gui/CompilerParametersPanel.cs \
+./Project/CompilationTarget.cs \
+./Project/ILAsmProject.cs \
+./Project/ILAsmCompilerParameters.cs \
+./ILAsmCompilerManager.cs \
+./AssemblyInfo.cs \
+./ILAsmLanguageBinding.cs \
+./ILAsmExecutionManager.cs
+
+build_sources = $(addprefix $(srcdir)/, $(FILES))
+
+assemblydir = $(libdir)/monodevelop/AddIns/AddIns/BackendBindings
+assembly_DATA = $(ASSEMBLY)
+
+all: $(ASSEMBLY)
+
+$(ASSEMBLY): $(build_sources)
+	$(CSC) $(FILES) $(DLLS) /out:$(ASSEMBLY) /target:library \
+	&amp;&amp; cp $(ASSEMBLY) ../../../../build/AddIns/AddIns/BackendBindings/.
+
+CLEANFILES = $(ASSEMBLY)
+EXTRA_DIST = $(FILES)
+

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/CompilationTarget.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/CompilationTarget.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/CompilationTarget.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,11 @@
+using System;
+
+namespace MonoDevelop.ILAsmBinding
+{
+	public enum CompilationTarget
+	{
+		Exe, 
+		Dll,
+	}
+}
+

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmCompilerParameters.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmCompilerParameters.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmCompilerParameters.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,119 @@
+// &lt;file&gt;
+//     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
+//     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
+//     &lt;owner name=&quot;Mike Krueger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;version value=&quot;$version&quot;/&gt;
+// &lt;/file&gt;
+
+using System;
+using System.IO;
+using System.Text;
+using System.Xml;
+using System.Diagnostics;
+using System.ComponentModel;
+using MonoDevelop.Gui.Components;
+using MonoDevelop.Internal.Project;
+
+namespace MonoDevelop.ILAsmBinding
+{
+	/// &lt;summary&gt;
+	/// This class handles project specific compiler parameters
+	/// &lt;/summary&gt;
+	public class ILAsmCompilerParameters : AbstractProjectConfiguration
+	{
+		CompilerOptions compilerOptions = new CompilerOptions();
+		
+		[Browsable(false)]
+		public CompilerOptions CurrentCompilerOptions {
+			get {
+				return compilerOptions;
+			}
+		}
+		
+		[LocalizedProperty(&quot;Output path&quot;,
+			                   Description = &quot;The path where the assembly is created.&quot;)]
+		public string OutputPath {
+			get {
+				return OutputDirectory;
+			}
+			set {
+				OutputDirectory = value;
+			}
+		}
+		
+		[LocalizedProperty(&quot;Output assembly&quot;,
+		                   Description = &quot;The assembly name.&quot;)]
+		public string AssemblyName {
+			get {
+				return OutputAssembly;
+			}
+			set {
+				OutputAssembly = value;
+			}
+		}
+		
+		[DefaultValue(CompilationTarget.Exe)]
+		[LocalizedProperty(&quot;Compilation Target&quot;,
+		                   Description = &quot;The compilation target of the source code. (/DLL, /EXE)&quot;)]
+		public CompilationTarget CompilationTarget {
+			get {
+				return compilerOptions.compilationTarget;
+			}
+			set {
+				compilerOptions.compilationTarget = value;
+			}
+		}
+		
+		[DefaultValue(false)]
+		[LocalizedProperty(&quot;Include debug information&quot;,
+		                   Description = &quot;Specifies if debug information should be omited. (/DEBUG)&quot;)]
+		public bool IncludeDebugInformation {
+			get {
+				return compilerOptions.includeDebugInformation;
+			}
+			set {
+				compilerOptions.includeDebugInformation = value;
+			}
+		}
+		
+		public ILAsmCompilerParameters()
+		{
+		}
+		
+		public ILAsmCompilerParameters(string name)
+		{
+			this.name = name;
+		}
+		
+		[XmlNodeName(&quot;CompilerOptions&quot;)]
+		public class CompilerOptions
+		{
+			[XmlAttribute(&quot;compilationTarget&quot;)]
+			internal CompilationTarget compilationTarget = CompilationTarget.Exe;
+			
+			[XmlAttribute(&quot;includeDebugInformation&quot;)]
+			internal bool includeDebugInformation = false;
+			
+			public string GenerateOptions()
+			{
+				StringBuilder options = new StringBuilder();
+				switch (compilationTarget) {
+					//case CompilationTarget.Dll:
+					//	options.Append(&quot;/DLL &quot;);
+					//	break;
+					//case CompilationTarget.Exe:
+					//	options.Append(&quot;/EXE &quot;);
+					//	break;
+					default:
+						throw new System.NotSupportedException(&quot;Unsupported compilation target : &quot; + compilationTarget);
+				}
+				
+				if (includeDebugInformation) {
+					options.Append(&quot;/DEBUG &quot;);
+				}
+				
+				return options.ToString();
+			}
+		}
+	}
+}

Added: trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmProject.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmProject.cs	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/ILAsmBinding/Project/ILAsmProject.cs	2004-04-12 22:11:01 UTC (rev 1447)
@@ -0,0 +1,50 @@
+// &lt;file&gt;
+//     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
+//     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
+//     &lt;owner name=&quot;Mike Krueger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;version value=&quot;$version&quot;/&gt;
+// &lt;/file&gt;
+
+using System;
+using System.IO;
+using System.Collections;
+using System.Diagnostics;
+using System.ComponentModel;
+using System.Xml;
+
+using MonoDevelop.Internal.Project;
+using MonoDevelop.Internal.Templates;
+
+namespace MonoDevelop.ILAsmBinding
+{
+	public class ILAsmProject : AbstractProject
+	{
+		public override string ProjectType {
+			get {
+				return ILAsmLanguageBinding.LanguageName;
+			}
+		}
+		
+		public ILAsmProject()
+		{
+		}
+		
+		public override IConfiguration CreateConfiguration()
+		{
+			return new ILAsmCompilerParameters();
+		}
+		
+		public ILAsmProject(ProjectCreateInformation info, XmlElement projectOptions)
+		{
+			if (info != null) {
+				Name = info.ProjectName;
+				Configurations.Add(CreateConfiguration(&quot;Debug&quot;));
+				Configurations.Add(CreateConfiguration(&quot;Release&quot;));
+				foreach (ILAsmCompilerParameters parameter in Configurations) {
+					parameter.OutputDirectory = info.BinPath + Path.DirectorySeparatorChar + parameter.Name;
+					parameter.OutputAssembly  = Name;
+				}
+			}
+		}
+	}
+}

Modified: trunk/MonoDevelop/src/AddIns/BackendBindings/Makefile.am
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/Makefile.am	2004-04-12 22:04:12 UTC (rev 1446)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/Makefile.am	2004-04-12 22:11:01 UTC (rev 1447)
@@ -1 +1,3 @@
-SUBDIRS = CSharpBinding JavaBinding NemerleBinding
+
+SUBDIRS = CSharpBinding JavaBinding NemerleBinding ILAsmBinding
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001053.html">[Monodevelop-patches-list] r1446 - trunk/MonoDevelop
</A></li>
	<LI>Next message: <A HREF="001055.html">[Monodevelop-patches-list] r1448 - trunk/MonoDevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1054">[ date ]</a>
              <a href="thread.html#1054">[ thread ]</a>
              <a href="subject.html#1054">[ subject ]</a>
              <a href="author.html#1054">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
