<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2041 - in trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets: . FileSelector
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2041%20-%20in%20trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets%3A%20.%20FileSelector&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2041 - in trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets: . FileSelector</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2041%20-%20in%20trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets%3A%20.%20FileSelector&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2041 - in trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets: . FileSelector">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Wed Dec  1 00:51:55 EST 2004</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001646.html">[Monodevelop-patches-list] r2042 - in trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets: . FileSelector
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1645">[ date ]</a>
              <a href="thread.html#1645">[ thread ]</a>
              <a href="subject.html#1645">[ subject ]</a>
              <a href="author.html#1645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jluke
Date: 2004-12-01 00:51:55 -0500 (Wed, 01 Dec 2004)
New Revision: 2041

Modified:
   trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/ChangeLog
   trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/FileSelector/FileSelector.cs
Log:
2004-12-01  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;

        * FileSelector/FileSelector.cs: improve this to take advantage
        of the FileChooser and remove my old hacks that were likely buggy
        use a switch for adding the buttons
        add ~/Projects as a MD specific bookmark



Modified: trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/ChangeLog	2004-11-26 05:50:07 UTC (rev 2040)
+++ trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/ChangeLog	2004-12-01 05:51:55 UTC (rev 2041)
@@ -1,3 +1,10 @@
+2004-12-01  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
+
+	* FileSelector/FileSelector.cs: improve this to take advantage
+	of the FileChooser and remove my old hacks that were likely buggy
+	use a switch for adding the buttons
+	add ~/Projects as a MD specific bookmark
+
 2004-10-29  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at off.net</A>&gt;
 
 	* FileSelector/FileSelector.cs: Add proper Save buttons.

Modified: trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/FileSelector/FileSelector.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/FileSelector/FileSelector.cs	2004-11-26 05:50:07 UTC (rev 2040)
+++ trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets/FileSelector/FileSelector.cs	2004-12-01 05:51:55 UTC (rev 2041)
@@ -1,5 +1,4 @@
 using System;
-using System.IO;
 using Gtk;
 
 using MonoDevelop.Services;
@@ -7,13 +6,9 @@
 
 namespace MonoDevelop.Gui.Widgets
 {
-	// basically just to remember the last directory
-	// we could do some if GTK2.4 then use new FileChooser
-	// but that is probably to be hacky at best
 	public class FileSelector : FileChooserDialog
 	{
 		const string LastPathProperty = &quot;MonoDevelop.FileSelector.LastPath&quot;;
-		string lastPath;
 		PropertyService propertyService = (PropertyService) ServiceManager.GetService (typeof (PropertyService));
 
 		public FileSelector () : base (GettextCatalog.GetString (&quot;Open file ...&quot;), null, FileChooserAction.Open)
@@ -32,61 +27,43 @@
 
 		public FileSelector (string title, FileChooserAction action) : base (title, null, action)
 		{
-			if (action == FileChooserAction.SelectFolder) {
-				AddButton (Gtk.Stock.Cancel, ResponseType.Cancel);
-				AddButton (&quot;Select Folder&quot;, ResponseType.Ok);
-			} else if (action == FileChooserAction.Save) {
-				AddButton (Gtk.Stock.Cancel, ResponseType.Cancel);
-				AddButton (Gtk.Stock.Save, ResponseType.Ok);
+			switch (action) {
+				case FileChooserAction.SelectFolder:
+					AddButton (Gtk.Stock.Cancel, ResponseType.Cancel);
+					AddButton (&quot;Select Folder&quot;, ResponseType.Ok);
+					break;
+				case FileChooserAction.Save:
+					AddButton (Gtk.Stock.Cancel, ResponseType.Cancel);
+					AddButton (Gtk.Stock.Save, ResponseType.Ok);
+					break;
+				default:
+					break;
 			}
+
 			CommonSetup ();
 		}
 
 		void CommonSetup ()
 		{
 			// Restore the last active directory
-			string tmp = (string) propertyService.GetProperty (LastPathProperty);
-			if (tmp != null &amp;&amp; tmp.Length &gt; 0)
-			{
-				if (tmp.EndsWith (&quot;/&quot;))
-					lastPath = String.Format (&quot;{0}&quot;, tmp.Trim ());
-				else
-					lastPath = String.Format (&quot;{0}/&quot;, tmp.Trim ());
-			}
+			string last = (string) propertyService.GetProperty (LastPathProperty);
+			if (last != null &amp;&amp; last.Length &gt; 0)
+				this.SetCurrentFolder (last);
 			else
-			{
-				// FIXME: use ~/DefaultPath?
-				lastPath = Environment.GetEnvironmentVariable (&quot;HOME&quot;);
-			}
+				this.SetCurrentFolder (Environment.GetFolderPath (Environment.SpecialFolder.Personal));
 
-			// Set the dir here, must end in &quot;/&quot; to work right
-			this.SetFilename (lastPath);
+			// add ~/Projects as a MD bookmark
+			this.AddShortcutFolder (System.IO.Path.Combine (Environment.GetFolderPath (Environment.SpecialFolder.Personal), &quot;Projects&quot;));
 
-			// Basically need to track if the directory has
-			// been changed in the simplest way possible
-			// I think that this always changes when the dir does
-			this.CurrentFolderChanged += OnOptionListChanged;
+			// FIXME: only set this once per-dialog
+			// perhaps in Dispose ()? or only when a file or dir is selected
+			this.CurrentFolderChanged += OnCurrentFolderChanged;
 		}
 
-		void OnOptionListChanged (object o, EventArgs args)
+		void OnCurrentFolderChanged (object o, EventArgs args)
 		{
-			UpdateLastDir ();
+			propertyService.SetProperty (LastPathProperty, this.CurrentFolder);
 		}
-
-		void UpdateLastDir ()
-		{
-			if (this.Filename == null || this.Filename == &quot;&quot;)
-				return;
-			
-			if (this.Filename.EndsWith (&quot;/&quot;) || Directory.Exists (this.Filename))
-				lastPath = this.Filename;
-			else
-				lastPath = System.IO.Path.GetDirectoryName (this.Filename);
-		
-			// Console.WriteLine (&quot;storing: {0}&quot;, lastPath);
-			// FIXME: find a way to only set this once per-dialog
-			propertyService.SetProperty (LastPathProperty, lastPath);
-		}
 	}
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001646.html">[Monodevelop-patches-list] r2042 - in trunk/MonoDevelop/Core/src/Libraries/MonoDevelop.Gui.Widgets: . FileSelector
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1645">[ date ]</a>
              <a href="thread.html#1645">[ thread ]</a>
              <a href="subject.html#1645">[ subject ]</a>
              <a href="author.html#1645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
