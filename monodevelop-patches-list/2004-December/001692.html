<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2088 - in trunk/MonoDevelop/Core: build/AddIns src/AddIns/BackendBindings/CSharpBinding src/Main/Base src/Main/Base/Commands src/Main/Base/Gui/BrowserDisplayBinding src/Main/Base/Gui/Dialogs src/Main/Base/Gui/Pads/ProjectBrowser src/Main/Base/Gui/Workbench/Layouts src/Main/Base/Internal/Project/Combine src/Main/Base/Internal/Project/Project src/Main/Base/Services src/Main/Base/Services/ProcessService src/Main/Base/Services/Toolbar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2088%20-%20in%20trunk/MonoDevelop/Core%3A%20build/AddIns%20src/AddIns/BackendBindings/CSharpBinding%20src/Main/Base%20src/Main/Base/Commands%20src/Main/Base/Gui/BrowserDisplayBinding%20src/Main/Base/Gui/Dialogs%20src/Main/Base/Gui/Pads/ProjectBrowser%20src/Main/Base/Gui/Workbench/Layouts%20src/Main/Base/Internal/Project/Combine%20src/Main/Base/Internal/Project/Project%20src/Main/Base/Services%20src/Main/Base/Services/ProcessService%20src/Main/Base/Services/Toolbar&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001691.html">
   <LINK REL="Next"  HREF="001693.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2088 - in trunk/MonoDevelop/Core: build/AddIns src/AddIns/BackendBindings/CSharpBinding src/Main/Base src/Main/Base/Commands src/Main/Base/Gui/BrowserDisplayBinding src/Main/Base/Gui/Dialogs src/Main/Base/Gui/Pads/ProjectBrowser src/Main/Base/Gui/Workbench/Layouts src/Main/Base/Internal/Project/Combine src/Main/Base/Internal/Project/Project src/Main/Base/Services src/Main/Base/Services/ProcessService src/Main/Base/Services/Toolbar</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2088%20-%20in%20trunk/MonoDevelop/Core%3A%20build/AddIns%20src/AddIns/BackendBindings/CSharpBinding%20src/Main/Base%20src/Main/Base/Commands%20src/Main/Base/Gui/BrowserDisplayBinding%20src/Main/Base/Gui/Dialogs%20src/Main/Base/Gui/Pads/ProjectBrowser%20src/Main/Base/Gui/Workbench/Layouts%20src/Main/Base/Internal/Project/Combine%20src/Main/Base/Internal/Project/Project%20src/Main/Base/Services%20src/Main/Base/Services/ProcessService%20src/Main/Base/Services/Toolbar&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2088 - in trunk/MonoDevelop/Core: build/AddIns src/AddIns/BackendBindings/CSharpBinding src/Main/Base src/Main/Base/Commands src/Main/Base/Gui/BrowserDisplayBinding src/Main/Base/Gui/Dialogs src/Main/Base/Gui/Pads/ProjectBrowser src/Main/Base/Gui/Workbench/Layouts src/Main/Base/Internal/Project/Combine src/Main/Base/Internal/Project/Project src/Main/Base/Services src/Main/Base/Services/ProcessService src/Main/Base/Services/Toolbar">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Sun Dec 26 12:16:47 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="001691.html">[Monodevelop-patches-list] r2087 - in trunk/MonoDevelop/Core/src/Main/Base: . Gui/Pads Services/DispatchService
</A></li>
        <LI>Next message: <A HREF="001693.html">[Monodevelop-patches-list] r2089 - trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1692">[ date ]</a>
              <a href="thread.html#1692">[ thread ]</a>
              <a href="subject.html#1692">[ subject ]</a>
              <a href="author.html#1692">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tberman
Date: 2004-12-26 12:16:47 -0500 (Sun, 26 Dec 2004)
New Revision: 2088

Added:
   trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/
   trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessService.cs
   trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessWrapper.cs
Modified:
   trunk/MonoDevelop/Core/build/AddIns/ChangeLog
   trunk/MonoDevelop/Core/build/AddIns/SharpDevelopCore.addin.xml
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs
   trunk/MonoDevelop/Core/src/Main/Base/ChangeLog
   trunk/MonoDevelop/Core/src/Main/Base/Commands/MenuItemBuilders.cs
   trunk/MonoDevelop/Core/src/Main/Base/Gui/BrowserDisplayBinding/HtmlViewPane.cs
   trunk/MonoDevelop/Core/src/Main/Base/Gui/Dialogs/CommonAboutDialog.cs
   trunk/MonoDevelop/Core/src/Main/Base/Gui/Pads/ProjectBrowser/ProjectBrowserView.cs
   trunk/MonoDevelop/Core/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs
   trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Combine/CombineEntry.cs
   trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Project/ConvertXml.cs
   trunk/MonoDevelop/Core/src/Main/Base/Makefile.am
   trunk/MonoDevelop/Core/src/Main/Base/Services/Runtime.cs
   trunk/MonoDevelop/Core/src/Main/Base/Services/Toolbar/ToolbarService.cs
Log:
2004-12-21  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at off.net</A>&gt;

	* Services/Toolbar/ToolbarService.cs:
	* Gui/Workbench/Layouts/SdiWorkspaceLayout.cs:
	* Gui/Dialogs/CommonAboutDialog.cs:
	* Gui/Pads/ProjectBrowser/ProjectBrowserView.cs:
	* Gui/BrowserDisplayBinding/HtmlViewPane.cs:
	* Internal/Project/Project/ConvertXml.cs:
	* Internal/Project/Combine/CombineEntry.cs: Remove/Fix code causing
	warnings.

2004-12-21  Sander Rijken  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">sr+ximianbugs at d-90.nl</A>&gt;

	* Services/ProcessService/ProcessService.cs: 
	* Services/ProcessService/ProcessWrapper.cs:
	* Services/Runtime.cs: Add new ProcessService property.
	* Makefile.am: Add new files.
	* Commands/MenuItemBuilders.cs: Wire the console output of external
	tools to the output pad.

2004-12-21  Sander Rijken  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">sr+ximianbugs at d-90.nl</A>&gt;

	* SharpDevelopCore.addin.xml: Add ProcessService to services that 
	should be initialized.



Modified: trunk/MonoDevelop/Core/build/AddIns/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/build/AddIns/ChangeLog	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/build/AddIns/ChangeLog	2004-12-26 17:16:47 UTC (rev 2088)
@@ -1,3 +1,8 @@
+2004-12-21  Sander Rijken  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">sr+ximianbugs at d-90.nl</A>&gt;
+
+	* SharpDevelopCore.addin.xml: Add ProcessService to services that 
+	should be initialized.
+
 2004-12-11  Alexandre Gomes &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">alexmipego at hotmail.com</A>&gt;
 	
 	* SharpDevelopCode.addin.xml: Added menus entries for Indent and

Modified: trunk/MonoDevelop/Core/build/AddIns/SharpDevelopCore.addin.xml
===================================================================
--- trunk/MonoDevelop/Core/build/AddIns/SharpDevelopCore.addin.xml	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/build/AddIns/SharpDevelopCore.addin.xml	2004-12-26 17:16:47 UTC (rev 2088)
@@ -60,6 +60,8 @@
 		       class = &quot;MonoDevelop.Services.AmbienceService&quot;/&gt;
 		&lt;Class id    = &quot;MenuService&quot;
 		       class = &quot;MonoDevelop.Services.MenuService&quot;/&gt;
+		&lt;Class id    = &quot;ProcessService&quot;
+		       class = &quot;MonoDevelop.Services.ProcessService&quot;/&gt;
 	&lt;/Extension&gt;
 
 	&lt;Extension path = &quot;/SharpDevelop/Workbench/DisplayBindings&quot;&gt;

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/CSharpBindingCompilerManager.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -151,6 +151,8 @@
 					switch (lib.ReferenceType) {
 					case ReferenceType.Gac:
 						string pkg = sas.GetPackageFromFullName (lib.Reference);
+						if (pkg.Trim () == String.Empty)
+							continue;
 						if (pkg == &quot;MONO-SYSTEM&quot;) {
 							writer.WriteLine (&quot;\&quot;/r:&quot; + Path.GetFileName (lib.GetReferencedFileName (project)) + &quot;\&quot;&quot;);
 						} else if (!pkg_references.Contains (pkg)) {
@@ -352,6 +354,8 @@
 				switch (lib.ReferenceType) {
 				case ReferenceType.Gac:
 					string pkg = sas.GetPackageFromFullName (lib.Reference);
+					if (pkg.Trim == String.Empty)
+						continue;
 					if (pkg == &quot;MONO-SYSTEM&quot;) {
 						system_references.Add (Path.GetFileName (lib.GetReferencedFileName (project)));
 					} else if (!pkg_references.Contains (pkg)) {

Modified: trunk/MonoDevelop/Core/src/Main/Base/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/ChangeLog	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/ChangeLog	2004-12-26 17:16:47 UTC (rev 2088)
@@ -1,3 +1,23 @@
+2004-12-21  Todd Berman  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at off.net</A>&gt;
+
+	* Services/Toolbar/ToolbarService.cs:
+	* Gui/Workbench/Layouts/SdiWorkspaceLayout.cs:
+	* Gui/Dialogs/CommonAboutDialog.cs:
+	* Gui/Pads/ProjectBrowser/ProjectBrowserView.cs:
+	* Gui/BrowserDisplayBinding/HtmlViewPane.cs:
+	* Internal/Project/Project/ConvertXml.cs:
+	* Internal/Project/Combine/CombineEntry.cs: Remove/Fix code causing
+	warnings.
+
+2004-12-21  Sander Rijken  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">sr+ximianbugs at d-90.nl</A>&gt;
+
+	* Services/ProcessService/ProcessService.cs: 
+	* Services/ProcessService/ProcessWrapper.cs:
+	* Services/Runtime.cs: Add new ProcessService property.
+	* Makefile.am: Add new files.
+	* Commands/MenuItemBuilders.cs: Wire the console output of external
+	tools to the output pad.
+
 2004-12-21  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;
 
 	* Services/DispatchService/DispatchService.cs: Removed unneded check

Modified: trunk/MonoDevelop/Core/src/Main/Base/Commands/MenuItemBuilders.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Commands/MenuItemBuilders.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Commands/MenuItemBuilders.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -169,19 +169,11 @@
 					
 					// create the process
 					try {
-						ProcessStartInfo startinfo;
-						if (args == null || args.Length == 0) {
-							startinfo = new ProcessStartInfo(command);
-						} else {
-							startinfo = new ProcessStartInfo(command, args);
-						}
-						startinfo.UseShellExecute = false;
-						
-						startinfo.WorkingDirectory = stringParserService.Parse(tool.InitialDirectory);
-						
-						// FIXME: need to find a way to wire the console output into the output window if specified
-						Process.Start(startinfo);
-						
+						string workingDirectory = stringParserService.Parse(tool.InitialDirectory);
+						if (tool.UseOutputPad)
+							Runtime.ProcessService.StartProcess (command, args, workingDirectory, new ProcessEventHandler (OnStdOut), new ProcessEventHandler (OnStdErr), new EventHandler (OnExited));
+						else
+							Runtime.ProcessService.StartProcess (command, args, workingDirectory, new EventHandler (OnExited));
 					} catch (Exception ex) {
 						Runtime.MessageService.ShowError(ex, String.Format (GettextCatalog.GetString (&quot;External program execution failed.\nError while starting:\n '{0} {1}'&quot;), command, args));
 					}
@@ -189,6 +181,36 @@
 				}
 			}
 		}
+		
+		private void OnStdOut (object sender, string s)
+		{
+			lock (Runtime.TaskService.CompilerOutput)
+			{
+				Runtime.TaskService.CompilerOutput += s + Environment.NewLine;
+			}
+		}
+		
+		private void OnStdErr (object sender, string s)
+		{
+			lock (Runtime.TaskService.CompilerOutput)
+			{
+				Runtime.TaskService.CompilerOutput += s + Environment.NewLine;
+			}
+		}
+		
+		private void OnExited (object sender, EventArgs e)
+		{
+			ProcessWrapper wrapper = (ProcessWrapper)sender;
+			
+			lock (Runtime.TaskService.CompilerOutput)
+			{ 
+				if (wrapper.ExitCode == 0) {
+					Runtime.TaskService.CompilerOutput += string.Format(&quot;{0}Process {1} has completed succesfully.{0}&quot;, Environment.NewLine, wrapper.ProcessName); 
+				} else {
+					Runtime.TaskService.CompilerOutput += string.Format(&quot;{0}Process {1} has exited with errorcode {2}.{0}&quot;, Environment.NewLine, wrapper.ProcessName, wrapper.ExitCode);
+				}
+			}		
+		}
 	}
 	
 	public class OpenContentsMenuBuilder : ISubmenuBuilder

Modified: trunk/MonoDevelop/Core/src/Main/Base/Gui/BrowserDisplayBinding/HtmlViewPane.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Gui/BrowserDisplayBinding/HtmlViewPane.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Gui/BrowserDisplayBinding/HtmlViewPane.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -55,7 +55,7 @@
 					htmlViewPane.MozillaControl.OpenStream (&quot;<A HREF="file://&quot;,">file://&quot;,</A> &quot;text/html&quot;);
 					htmlViewPane.MozillaControl.AppendData (((Gtk.TextView)((Gtk.ScrolledWindow)parent.Control).Children[0]).Buffer.Text);
 					htmlViewPane.MozillaControl.CloseStream ();
-					Gtk.Timeout.Add (50, new Gtk.Function (checkFocus));
+					GLib.Timeout.Add (50, new GLib.TimeoutHandler (checkFocus));
 					
 				} catch {
 					Console.WriteLine (&quot;Gecko# tossed an exception&quot;);

Modified: trunk/MonoDevelop/Core/src/Main/Base/Gui/Dialogs/CommonAboutDialog.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Gui/Dialogs/CommonAboutDialog.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Gui/Dialogs/CommonAboutDialog.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -12,10 +12,10 @@
 using MonoDevelop.Core.Properties;
 using MonoDevelop.Core.Services;
 using MonoDevelop.Services;
-//using MonoDevelop.Gui.HtmlControl;
 
 using Gdk;
 using Gtk;
+using GLib;
 using Pango;
 
 namespace MonoDevelop.Gui.Dialogs
@@ -24,12 +24,12 @@
 	{
 		Pixbuf image;
 		int scroll = -220;
-		uint hndlr;
+		IdleHandler hndlr;
 		Pango.Font font;
 		bool initial = true;
 		Pango.Layout layout;
 		
-		internal uint Handler
+		internal IdleHandler Handler
 		{
 			get { return hndlr; }
 		}
@@ -65,8 +65,8 @@
 			
 			image = Runtime.Gui.Resources.GetBitmap (&quot;Icons.AboutImage&quot;);
 			
-			Gtk.Function ScrollHandler = new Gtk.Function (ScrollDown);
-			hndlr = Timeout.Add (30, ScrollHandler);
+			hndlr = new GLib.IdleHandler (ScrollDown);
+			GLib.Idle.Add (hndlr);
 		}
 
 		string CreditText {
@@ -121,7 +121,7 @@
 		
 		protected void OnExposed (object o, ExposeEventArgs args)
 		{
-			this.DrawImage ();	
+			this.DrawImage ();
 			this.DrawText ();
 		}
 
@@ -174,20 +174,8 @@
 		public new int Run ()
 		{
 			int tmp = base.Run ();
-			Timeout.Remove (aboutPictureScrollBox.Handler);
+			GLib.Idle.Remove (aboutPictureScrollBox.Handler);
 			return tmp;
 		}
-		
-		//private void OnPageChanged (object o, SwitchPageArgs args)
-		//{
-			//if (args.PageNum == 1)
-			//{
-			//	aatp.DelayedInitialize ();
-			//}
-			//else if (args.PageNum == 2)
-			//{
-			//	changelog.DelayedInitialize ();
-			//}
-		//}
 	}
 }

Modified: trunk/MonoDevelop/Core/src/Main/Base/Gui/Pads/ProjectBrowser/ProjectBrowserView.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Gui/Pads/ProjectBrowser/ProjectBrowserView.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Gui/Pads/ProjectBrowser/ProjectBrowserView.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -246,7 +246,7 @@
 
 		public void StealFocus ()
 		{
-			Gtk.Timeout.Add (20, new Gtk.Function (wantFocus));
+			GLib.Timeout.Add (20, new GLib.TimeoutHandler (wantFocus));
 		}
 		bool wantFocus ()
 		{

Modified: trunk/MonoDevelop/Core/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -411,7 +411,7 @@
 			SdiWorkspaceWindow sdiWorkspaceWindow = new SdiWorkspaceWindow(content, tabControl, tabLabel);
 
 			sdiWorkspaceWindow.CloseEvent += new EventHandler(CloseWindowEvent);
-			tabControl.AppendPage (sdiWorkspaceWindow, tabLabel);
+			tabControl.InsertPage (sdiWorkspaceWindow, tabLabel, -1);
 		
 			tabControl.ShowAll();
 			return sdiWorkspaceWindow;

Modified: trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Combine/CombineEntry.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Combine/CombineEntry.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Combine/CombineEntry.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -272,7 +272,6 @@
 	{
 		int Count { get; }
 		CombineEntry this [int n] { get; }
-		IEnumerator GetEnumerator ();
 	}
 	
 	public class CombineEntryCollection: ICombineEntryCollection

Modified: trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Project/ConvertXml.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Project/ConvertXml.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Internal/Project/Project/ConvertXml.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -114,17 +114,17 @@
 			
 			XPathDocument inputData = new XPathDocument(oXML);
 			
-			return xslt.Transform(inputData, xsltArgList);
+			return xslt.Transform(inputData, xsltArgList, new XmlSecureResolver (new XmlUrlResolver (), new PermissionSet (PermissionState.Unrestricted)));
 		}
 		
 		public static XmlReader TransformXmlToXml(XmlReader oXML, XmlReader XSLReader, XsltArgumentList xsltArgList)
 		{
 			XslTransform xslt = new XslTransform();
-			xslt.Load(XSLReader, new XmlUrlResolver());
+			xslt.Load(XSLReader, new XmlSecureResolver (new XmlUrlResolver (), new PermissionSet (PermissionState.Unrestricted)), null);
 			
 			XPathDocument inputData = new XPathDocument(oXML);
 			
-			return xslt.Transform(inputData, xsltArgList );
+			return xslt.Transform(inputData, xsltArgList, new XmlSecureResolver (new XmlUrlResolver (), new PermissionSet (PermissionState.Unrestricted)));
 		}
 		
 		/// &lt;summary&gt;

Modified: trunk/MonoDevelop/Core/src/Main/Base/Makefile.am
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Makefile.am	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Makefile.am	2004-12-26 17:16:47 UTC (rev 2088)
@@ -183,6 +183,8 @@
 Services/AmbienceService/CodeDOMGeneratorUtility.cs \
 Services/AmbienceService/NetAmbience.cs \
 Services/AmbienceService/IAmbience.cs \
+Services/ProcessService/ProcessService.cs \
+Services/ProcessService/ProcessWrapper.cs \
 Services/Project/ProjectEventArgs.cs \
 Services/Project/IProjectService.cs \
 Services/Project/ProjectRenameEventArgs.cs \

Added: trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessService.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessService.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessService.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -0,0 +1,59 @@
+// created on 12/17/2004 at 22:07
+using System;
+using System.Collections;
+using System.Threading;
+using System.Diagnostics;
+
+using MonoDevelop.Core.Services;
+
+namespace MonoDevelop.Services
+{
+	public class ProcessService : AbstractService
+	{
+		public void StartProcess (string command, string arguments, string workingDirectory, EventHandler exited) 
+		{
+			StartProcess (command, arguments, workingDirectory, null, null, exited);	
+		}
+		
+		public void StartProcess (string command, string arguments, string workingDirectory, ProcessEventHandler outputStreamChanged, ProcessEventHandler errorStreamChanged)
+		{	
+			StartProcess (command, arguments, workingDirectory, outputStreamChanged, errorStreamChanged, null);
+		}
+		
+		public void StartProcess (string command, string arguments, string workingDirectory, ProcessEventHandler outputStreamChanged, ProcessEventHandler errorStreamChanged, EventHandler exited)
+		{
+			if (command == null)
+				throw new ArgumentNullException(&quot;command&quot;);
+			
+			if (command.Length == 0)
+				throw new ArgumentException(&quot;command&quot;);
+		
+			ProcessWrapper p = new ProcessWrapper();
+
+			if (outputStreamChanged != null) {
+				p.OutputStreamChanged += outputStreamChanged;
+			}
+				
+			if (errorStreamChanged != null)
+				p.ErrorStreamChanged += errorStreamChanged;
+			
+			if (exited != null)
+				p.Exited += exited;
+				
+			if(arguments == null || arguments.Length == 0)
+				p.StartInfo = new ProcessStartInfo (command);
+			else
+				p.StartInfo = new ProcessStartInfo (command, arguments);
+			
+			if(workingDirectory != null &amp;&amp; workingDirectory.Length &gt; 0)
+				p.StartInfo.WorkingDirectory = workingDirectory;
+
+
+			p.StartInfo.RedirectStandardOutput = true;
+			p.StartInfo.RedirectStandardError = true;
+			p.StartInfo.UseShellExecute = false;
+			
+			p.Start ();
+		}
+	}
+}

Added: trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessWrapper.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessWrapper.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Services/ProcessService/ProcessWrapper.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -0,0 +1,67 @@
+// created on 12/18/2004 at 16:28
+using System;
+using System.Threading;
+using System.Diagnostics;
+
+namespace MonoDevelop.Services
+{
+	public delegate void ProcessEventHandler(object sender, string message);
+	
+	public class ProcessWrapper : Process
+	{
+		private Thread captureOutputThread;
+		private Thread captureErrorThread;
+		
+		public void Start ()
+		{
+			base.Start ();
+			
+			captureOutputThread = new Thread (new ThreadStart(CaptureOutput));
+			captureOutputThread.IsBackground = true;
+			captureOutputThread.Start ();
+			
+			captureErrorThread = new Thread (new ThreadStart(CaptureError));
+			captureErrorThread.IsBackground = true;
+			captureErrorThread.Start ();
+		}
+		
+		public void Abort ()
+		{
+			captureOutputThread.Abort ();
+			captureErrorThread.Abort ();
+		}
+		
+		private void CaptureOutput ()
+		{
+			string s;
+
+			while (OutputStreamChanged != null)
+			{
+				while ((s = StandardOutput.ReadLine()) != null) {
+					if (OutputStreamChanged != null)
+						OutputStreamChanged (this, s);
+				}
+				
+				Thread.Sleep (100);				
+			}
+		}
+		
+		private void CaptureError ()
+		{
+			string s;
+			
+			while (ErrorStreamChanged != null)
+			{
+				while ((s = StandardError.ReadLine()) != null) {
+					if (ErrorStreamChanged != null)
+						ErrorStreamChanged (this, s);
+				}					
+					
+				Thread.Sleep (100);
+			}
+		}
+	
+		public event ProcessEventHandler OutputStreamChanged;
+		public event ProcessEventHandler ErrorStreamChanged;
+	}
+}

Modified: trunk/MonoDevelop/Core/src/Main/Base/Services/Runtime.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Services/Runtime.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Services/Runtime.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -6,6 +6,7 @@
 {
 	public class Runtime
 	{
+		static ProcessService processService;
 		static PropertyService propertyService;
 		static AmbienceService ambienceService;
 		static DispatchService dispatchService;
@@ -21,6 +22,14 @@
 		static LanguageBindingService languageBindingService;
 		static SystemAssemblyService systemAssemblyService;
 		static FileUtilityService fileUtilityService;
+
+		public static ProcessService ProcessService {
+			get {
+				if (processService == null)
+					processService = (ProcessService) ServiceManager.GetService (typeof(ProcessService));
+				return processService;
+			}
+		}
 	
 		public static PropertyService Properties {
 			get {

Modified: trunk/MonoDevelop/Core/src/Main/Base/Services/Toolbar/ToolbarService.cs
===================================================================
--- trunk/MonoDevelop/Core/src/Main/Base/Services/Toolbar/ToolbarService.cs	2004-12-21 11:35:44 UTC (rev 2087)
+++ trunk/MonoDevelop/Core/src/Main/Base/Services/Toolbar/ToolbarService.cs	2004-12-26 17:16:47 UTC (rev 2088)
@@ -56,7 +56,8 @@
 				
 				if (childCodon.ToolTip != null) {
 					if (childCodon.ToolTip == &quot;-&quot;) {
-						bar.AppendSpace();
+						//bar.Insert (new SeparatorToolItem (), -1);
+						bar.AppendSpace ();
 						continue;
 					} else {
 						item = new SdToolbarCommand(childCodon.Conditions, owner, GettextCatalog.GetString (childCodon.ToolTip));


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001691.html">[Monodevelop-patches-list] r2087 - in trunk/MonoDevelop/Core/src/Main/Base: . Gui/Pads Services/DispatchService
</A></li>
	<LI>Next message: <A HREF="001693.html">[Monodevelop-patches-list] r2089 - trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1692">[ date ]</a>
              <a href="thread.html#1692">[ thread ]</a>
              <a href="subject.html#1692">[ subject ]</a>
              <a href="author.html#1692">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
