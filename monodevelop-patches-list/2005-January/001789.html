<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2185 - in trunk/MonoDevelop/Core/src: AddIns/BackendBindings/CSharpBinding AddIns/BackendBindings/CSharpBinding/Parser AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree AddIns/BackendBindings/VBNetBinding AddIns/BackendBindings/VBNetBinding/Parser ICSharpCode.SharpRefactory ICSharpCode.SharpRefactory/src/Lexer/Specials MonoDevelop.Base MonoDevelop.Base/Internal/Parser MonoDevelop.Base/Services/ParserService
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2185%20-%20in%20trunk/MonoDevelop/Core/src%3A%20AddIns/BackendBindings/CSharpBinding%20AddIns/BackendBindings/CSharpBinding/Parser%20AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree%20AddIns/BackendBindings/VBNetBinding%20AddIns/BackendBindings/VBNetBinding/Parser%20ICSharpCode.SharpRefactory%20ICSharpCode.SharpRefactory/src/Lexer/Specials%20MonoDevelop.Base%20MonoDevelop.Base/Internal/Parser%20MonoDevelop.Base/Services/ParserService&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001788.html">
   <LINK REL="Next"  HREF="001790.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2185 - in trunk/MonoDevelop/Core/src: AddIns/BackendBindings/CSharpBinding AddIns/BackendBindings/CSharpBinding/Parser AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree AddIns/BackendBindings/VBNetBinding AddIns/BackendBindings/VBNetBinding/Parser ICSharpCode.SharpRefactory ICSharpCode.SharpRefactory/src/Lexer/Specials MonoDevelop.Base MonoDevelop.Base/Internal/Parser MonoDevelop.Base/Services/ParserService</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2185%20-%20in%20trunk/MonoDevelop/Core/src%3A%20AddIns/BackendBindings/CSharpBinding%20AddIns/BackendBindings/CSharpBinding/Parser%20AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree%20AddIns/BackendBindings/VBNetBinding%20AddIns/BackendBindings/VBNetBinding/Parser%20ICSharpCode.SharpRefactory%20ICSharpCode.SharpRefactory/src/Lexer/Specials%20MonoDevelop.Base%20MonoDevelop.Base/Internal/Parser%20MonoDevelop.Base/Services/ParserService&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2185 - in trunk/MonoDevelop/Core/src: AddIns/BackendBindings/CSharpBinding AddIns/BackendBindings/CSharpBinding/Parser AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree AddIns/BackendBindings/VBNetBinding AddIns/BackendBindings/VBNetBinding/Parser ICSharpCode.SharpRefactory ICSharpCode.SharpRefactory/src/Lexer/Specials MonoDevelop.Base MonoDevelop.Base/Internal/Parser MonoDevelop.Base/Services/ParserService">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Fri Jan 28 19:13:31 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001788.html">[Monodevelop-patches-list] r2184 - in trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory: . src src/CodeDOM src/Lexer src/Parser/AST src/Parser/AST/TypeLevel src/Parser/generated
</A></li>
        <LI>Next message: <A HREF="001790.html">[Monodevelop-patches-list] r2186 - trunk/MonoDevelop/Core/src/MonoDevelop.Base/Services/ParserService
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1789">[ date ]</a>
              <a href="thread.html#1789">[ thread ]</a>
              <a href="subject.html#1789">[ subject ]</a>
              <a href="author.html#1789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jluke
Date: 2005-01-28 19:13:31 -0500 (Fri, 28 Jan 2005)
New Revision: 2185

Added:
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Destructor.cs
   trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/src/Lexer/Specials/TagComment.cs
Modified:
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Makefile.am
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/CSharpVisitor.cs
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/ExpressionFinder.cs
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Parser.cs
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Resolver.cs
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Class.cs
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/TypeVisitor.cs
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/ChangeLog
   trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/Parser/Parser.cs
   trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/Makefile.am
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/Internal/Parser/IParser.cs
   trunk/MonoDevelop/Core/src/MonoDevelop.Base/Services/ParserService/DefaultParserService.cs
Log:
more minor parser related updated from SD


Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog	2005-01-29 00:13:31 UTC (rev 2185)
@@ -1,3 +1,8 @@
+2005-01-28  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
+
+	* Parser/Parser.cs: update to CanParse
+	* Parser/*.cs: update some minor fixes from SD
+
 2005-01-27  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
 
 	* CSharpBindingCompilerManager.cs:

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Makefile.am
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Makefile.am	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Makefile.am	2005-01-29 00:13:31 UTC (rev 2185)
@@ -12,6 +12,7 @@
 FILES = \
 Gui/ChooseRuntimePanel.cs \
 Gui/CodeGenerationPanel.cs \
+Parser/SharpDevelopTree/Destructor.cs \
 Parser/SharpDevelopTree/Event.cs \
 Parser/SharpDevelopTree/Indexer.cs \
 Parser/SharpDevelopTree/Constructor.cs \

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/CSharpVisitor.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/CSharpVisitor.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/CSharpVisitor.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -105,6 +105,7 @@
 		{
 			DefaultRegion region = GetRegion(typeDeclaration.StartLocation, typeDeclaration.EndLocation);
 			Class c = new Class(cu, TranslateClassType(typeDeclaration.Type), typeDeclaration.Modifier, region);
+			
 			if (currentClass.Count &gt; 0) {
 				Class cur = ((Class)currentClass.Peek());
 				cur.InnerClasses.Add(c);
@@ -160,7 +161,6 @@
 		{
 			DefaultRegion region     = GetRegion(constructorDeclaration.StartLocation, constructorDeclaration.EndLocation);
 			DefaultRegion bodyRegion = GetRegion(constructorDeclaration.EndLocation, constructorDeclaration.Body != null ? constructorDeclaration.Body.EndLocation : new Point(-1, -1));
-			
 			Class c       = (Class)currentClass.Peek();
 			
 			Constructor constructor = new Constructor(constructorDeclaration.Modifier, region, bodyRegion);
@@ -177,7 +177,19 @@
 			return null;
 		}
 		
+		public override object Visit(AST.DestructorDeclaration destructorDeclaration, object data)
+		{
+			DefaultRegion region     = GetRegion(destructorDeclaration.StartLocation, destructorDeclaration.EndLocation);
+			DefaultRegion bodyRegion = GetRegion(destructorDeclaration.EndLocation, destructorDeclaration.Body != null ? destructorDeclaration.Body.EndLocation : new Point(-1, -1));
+			
+			Class c       = (Class)currentClass.Peek();
+			
+			Destructor destructor = new Destructor(c.Name, destructorDeclaration.Modifier, region, bodyRegion);
+			c.Methods.Add(destructor);
+			return null;
+		}
 		
+		
 		public override object Visit(AST.FieldDeclaration fieldDeclaration, object data)
 		{
 			DefaultRegion region     = GetRegion(fieldDeclaration.StartLocation, fieldDeclaration.EndLocation);

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/ExpressionFinder.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/ExpressionFinder.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/ExpressionFinder.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -41,6 +41,7 @@
 			this.initialOffset = offset;
 			StringBuilder outText = new StringBuilder();
 			int curOffset = 0;
+			
 			while (curOffset &lt;= initialOffset) {
 				char ch = text[curOffset];
 				
@@ -60,13 +61,9 @@
 					case '\'':
 						outText.Append(ch);
 						curOffset++;
-						// to read '&quot; and '\&quot; ... this should work for these cases
-						if (curOffset &lt;= initialOffset) {
-							outText.Append(text[curOffset++]);
+						if(! ReadChar(outText, text, ref curOffset)) {
+							return null;
 						}
-						if (curOffset &lt;= initialOffset) {
-							outText.Append(text[curOffset++]);
-						}
 						break;
 					case '&quot;':
 						outText.Append(ch);
@@ -114,6 +111,24 @@
 			return false;
 		}
 		
+		bool ReadChar(StringBuilder outText, string text, ref int curOffset)
+		{
+			char first = text[curOffset];
+			
+			if (curOffset &lt;= initialOffset) {
+				outText.Append(text[curOffset++]);
+			}
+			if (curOffset &lt;= initialOffset) {
+				outText.Append(text[curOffset++]);
+			}
+			
+			// special case: '\''
+			if(first == '\\' &amp;&amp; curOffset &lt;= initialOffset) {
+				outText.Append(text[curOffset++]);
+			}
+			return text[curOffset - 1] == '\'';
+		}
+		
 		bool ReadString(StringBuilder outText, string text, ref int curOffset)
 		{
 			while (curOffset &lt;= initialOffset) {

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Parser.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Parser.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Parser.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -20,6 +20,9 @@
 		///&lt;summary&gt;IParser Interface&lt;/summary&gt; 
 		string[] lexerTags;
 		public string[] LexerTags {
+			get {
+				return lexerTags;
+			}
 			set {
 				lexerTags = value;
 			}
@@ -29,6 +32,14 @@
 				return new ExpressionFinder();
 			}
 		}
+		public bool CanParse(string fileName)
+		{
+			return System.IO.Path.GetExtension(fileName).ToUpper() == &quot;.CS&quot;;
+		}
+		public bool CanParse(Project project)
+		{
+			return project.ProjectType == &quot;C#&quot;;
+		}
 		
 		void RetrieveRegions(CompilationUnit cu, SpecialTracker tracker)
 		{
@@ -113,13 +124,6 @@
 		{
 			return new Resolver (project).MonodocResolver (parserService, expression, caretLineNumber, caretColumn, fileName, fileContent);
 		}
-
-
-		public bool HandlesFileExtension(string fileExtension){
-			if(fileExtension == null) return false;
-			return (fileExtension.ToLower() == &quot;.cs&quot;);
-		}
-		
 		///////// IParser Interface END
 	}
 }

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Resolver.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Resolver.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Resolver.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -51,6 +51,8 @@
 		
 		bool showStatic = false;
 		
+		bool inNew = false;
+		
 		public bool ShowStatic {
 			get {
 				return showStatic;
@@ -186,6 +188,19 @@
 			if (expression == &quot;&quot;) {
 				return null;
 			}
+			// disable the code completion for numbers like 3.47
+			try {
+				int.Parse(expression);
+//				Console.WriteLine(expression);
+				return null;
+			} catch (Exception) {
+			}
+			if (expression.StartsWith(&quot;new &quot;)) {
+				inNew = true;
+				expression = expression.Substring(4);
+			} else {
+				inNew = false;
+			}
 			if (expression.StartsWith(&quot;using &quot;)) {
 				// expression[expression.Length - 1] != '.'
 				// the period that causes this Resove() is not part of the expression
@@ -686,7 +701,6 @@
 				return name;
 			}
 			if (unit == null) {
-//				Console.WriteLine(&quot;done, resultless&quot;);
 				return null;
 			}
 			foreach (IUsing u in unit.Usings) {
@@ -697,7 +711,6 @@
 					}
 				}
 			}
-//			Console.WriteLine(&quot;done, resultless&quot;);
 			return null;
 		}
 		
@@ -907,7 +920,7 @@
 		
 		public ArrayList CtrlSpace(IParserService parserService, int caretLine, int caretColumn, string fileName)
 		{
-			ArrayList result = new ArrayList();
+			ArrayList result = new ArrayList(TypeReference.PrimitiveTypes);
 			this.parserService = parserService;
 			this.caretLine = caretLine;
 			this.caretColumn = caretColumn;

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Class.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Class.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Class.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -1,5 +1,6 @@
 // created on 06.08.2003 at 12:37
 
+using System;
 using System.Diagnostics;
 
 using MonoDevelop.Internal.Parser;

Added: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Destructor.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Destructor.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/SharpDevelopTree/Destructor.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -0,0 +1,22 @@
+using System;
+using MonoDevelop.Internal.Parser;
+using ICSharpCode.SharpRefactory.Parser;
+
+namespace CSharpBinding.Parser.SharpDevelopTree
+{
+	public class Destructor : AbstractMethod
+	{
+		public void AddModifier(ModifierEnum m)
+		{
+			modifiers = modifiers | m;
+		}
+		
+		public Destructor(string className, Modifier m, IRegion region, IRegion bodyRegion)
+		{
+			FullyQualifiedName = &quot;~&quot; + className;
+			this.region     = region;
+			this.bodyRegion = bodyRegion;
+			modifiers = (ModifierEnum)m;
+		}
+	}
+}

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/TypeVisitor.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/TypeVisitor.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/CSharpBinding/Parser/TypeVisitor.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -23,6 +23,7 @@
 		
 		public override object Visit(PrimitiveExpression primitiveExpression, object data)
 		{
+//			Console.WriteLine(&quot;Visiting &quot; + primitiveExpression);
 			if (primitiveExpression.Value != null) {
 //				Console.WriteLine(&quot;Visiting &quot; + primitiveExpression.Value);
 				return new ReturnType(primitiveExpression.Value.GetType().FullName);
@@ -91,7 +92,13 @@
 			if (fieldReferenceExpression == null) {
 				return null;
 			}
-			
+			// int. generates a FieldreferenceExpression with TargetObject TypeReferenceExpression and no FieldName
+			if (fieldReferenceExpression.FieldName == null || fieldReferenceExpression.FieldName == &quot;&quot;) {
+				if (fieldReferenceExpression.TargetObject is TypeReferenceExpression) {
+					resolver.ShowStatic = true;
+					return new ReturnType(((TypeReferenceExpression)fieldReferenceExpression.TargetObject).TypeReference);
+				}
+			}
 			IReturnType returnType = fieldReferenceExpression.TargetObject.AcceptVisitor(this, data) as IReturnType;
 			if (returnType != null) {
 				string name = resolver.SearchNamespace(returnType.FullyQualifiedName, resolver.CompilationUnit);
@@ -129,7 +136,7 @@
 		
 		public override object Visit(IdentifierExpression identifierExpression, object data)
 		{
-			Console.WriteLine(&quot;visiting IdentifierExpression&quot;);
+			//Console.WriteLine(&quot;visiting IdentifierExpression&quot;);
 			if (identifierExpression == null) {
 				return null;
 			}
@@ -224,11 +231,14 @@
 		
 		public override object Visit(IndexerExpression indexerExpression, object data)
 		{
+			//Console.WriteLine(&quot;TypeVisiting IndexerExpression&quot;);
 			IReturnType type = (IReturnType)indexerExpression.TargetObject.AcceptVisitor(this, data);
+			//Console.WriteLine(&quot;Type is &quot; + type.FullyQualifiedName);
 			if (type == null) {
 				return null;
 			}
 			if (type.ArrayDimensions == null || type.ArrayDimensions.Length == 0) {
+				//Console.WriteLine(&quot;No Array, checking indexer&quot;);
 				// check if ther is an indexer
 				if (indexerExpression.TargetObject is ThisReferenceExpression) {
 					if (resolver.CallingClass == null) {
@@ -246,6 +256,7 @@
 			
 			// TODO: what is a[0] if a is pointer to array or array of pointer ? 
 			if (type.ArrayDimensions[type.ArrayDimensions.Length - 1] != indexerExpression.Indices.Count) {
+				//Console.WriteLine(&quot;Number of indices do not match the Array dimension&quot;);
 				return null;
 			}
 			int[] newArray = new int[type.ArrayDimensions.Length - 1];

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/ChangeLog	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/ChangeLog	2005-01-29 00:13:31 UTC (rev 2185)
@@ -1,3 +1,7 @@
+2005-01-28  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
+
+	* Parser/Parser.cs: update to CanParse
+
 2005-01-27  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
 
 	* VB.glade: update to new glade format

Modified: trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/Parser/Parser.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/Parser/Parser.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/AddIns/BackendBindings/VBNetBinding/Parser/Parser.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -40,6 +40,16 @@
 				return new ExpressionFinder();
 			}
 		}
+
+		public bool CanParse (string fileName)
+		{
+			return System.IO.Path.GetExtension (fileName).ToLower () == &quot;.vb&quot;;
+		}
+
+		public bool CanParse (Project project)
+		{
+			return project.ProjectType == &quot;VBNET&quot;;
+		}
 		
 		void RetrieveRegions(CompilationUnit cu, SpecialTracker tracker)
 		{
@@ -141,11 +151,6 @@
 			return new Resolver (project).MonodocResolver (parserService, expression, caretLineNumber, caretColumn, fileName, fileContent);
 		}
 		
-		
-		public bool HandlesFileExtension(string fileExtension){
-        	if(fileExtension == null) return false;
-			return (fileExtension.ToLower() == &quot;.vb&quot;);
-		}
 
 		
 		///////// IParser Interface END

Modified: trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/Makefile.am
===================================================================
--- trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/Makefile.am	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/Makefile.am	2005-01-29 00:13:31 UTC (rev 2185)
@@ -14,6 +14,7 @@
 src/Lexer/Specials/Comment.cs \
 src/Lexer/Specials/SpecialTracker.cs \
 src/Lexer/Specials/BlankLine.cs \
+src/Lexer/Specials/TagComment.cs \
 src/Parser/AST/DebugASTVisitor.cs \
 src/Parser/AST/Expressions/BaseReferenceExpression.cs \
 src/Parser/AST/Expressions/ParenthesizedExpression.cs \

Added: trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/src/Lexer/Specials/TagComment.cs
===================================================================
--- trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/src/Lexer/Specials/TagComment.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory/src/Lexer/Specials/TagComment.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -0,0 +1,30 @@
+using System;
+using System.Text;
+using System.CodeDom;
+using System.Collections;
+using System.Drawing;
+
+namespace ICSharpCode.SharpRefactory.Parser
+{
+	/// &lt;summary&gt;
+	/// Description of TagComment.	
+	/// &lt;/summary&gt;
+	public class TagComment : Comment
+	{
+		string tag;
+		
+		public string Tag {
+			get {
+				return tag;
+			}
+			set {
+				tag = value;
+			}
+		}
+		
+		public TagComment(string tag, string comment, Point startPosition) : base(CommentType.SingleLine, comment, startPosition)
+		{
+			this.tag = tag;
+		}
+	}
+}

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/ChangeLog	2005-01-29 00:13:31 UTC (rev 2185)
@@ -1,3 +1,9 @@
+2005-01-28  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
+
+	* Services/ParserService/DefaultParserService.cs:
+	* Parser/IParser: use CanParse () instead of HandlesFileExtension
+	to be consistent with what SD did upstream
+
 2005-01-27  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
 
 	* Gui/Dialogs/CommonAboutDialog.cs: use a timeout

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/Internal/Parser/IParser.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/Internal/Parser/IParser.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/Internal/Parser/IParser.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -118,16 +118,19 @@
 	public interface IParser {
 		
 		string[] LexerTags {
+			get;
 			set;
 		}
 		
 		IExpressionFinder ExpressionFinder {
 			get;
 		}
+
+		bool CanParse (string fileName);
+		bool CanParse (Project_ project);
 		
 		ICompilationUnitBase Parse(string fileName);
 		ICompilationUnitBase Parse(string fileName, string fileContent);
-		bool HandlesFileExtension(string fileExtension);
 		
 		/// &lt;summary&gt;
 		/// Resolves an expression.

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Base/Services/ParserService/DefaultParserService.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Base/Services/ParserService/DefaultParserService.cs	2005-01-28 07:20:57 UTC (rev 2184)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Base/Services/ParserService/DefaultParserService.cs	2005-01-29 00:13:31 UTC (rev 2185)
@@ -1167,7 +1167,7 @@
 			// HACK: Still a hack, but extensible
 			if (fileName != null) {
 				foreach(IParser p in parser){
-					if(p.HandlesFileExtension(Path.GetExtension(fileName))){
+					if(p.CanParse(Path.GetExtension(fileName))){
 						return p;
 					}
 				}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001788.html">[Monodevelop-patches-list] r2184 - in trunk/MonoDevelop/Core/src/ICSharpCode.SharpRefactory: . src src/CodeDOM src/Lexer src/Parser/AST src/Parser/AST/TypeLevel src/Parser/generated
</A></li>
	<LI>Next message: <A HREF="001790.html">[Monodevelop-patches-list] r2186 - trunk/MonoDevelop/Core/src/MonoDevelop.Base/Services/ParserService
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1789">[ date ]</a>
              <a href="thread.html#1789">[ thread ]</a>
              <a href="subject.html#1789">[ subject ]</a>
              <a href="author.html#1789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
