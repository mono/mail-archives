<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2214 - in trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor: . Gui Properties
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2214%20-%20in%20trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor%3A%20.%20Gui%20Properties&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001817.html">
   <LINK REL="Next"  HREF="001819.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2214 - in trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor: . Gui Properties</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2214%20-%20in%20trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor%3A%20.%20Gui%20Properties&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2214 - in trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor: . Gui Properties">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Mon Jan 31 18:17:28 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001817.html">[Monodevelop-patches-list] r2213 - in trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor: . Gui Gui/OptionPanels Properties
</A></li>
        <LI>Next message: <A HREF="001819.html">[Monodevelop-patches-list] r2215 - trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1818">[ date ]</a>
              <a href="thread.html#1818">[ thread ]</a>
              <a href="subject.html#1818">[ subject ]</a>
              <a href="author.html#1818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jluke
Date: 2005-01-31 18:17:28 -0500 (Mon, 31 Jan 2005)
New Revision: 2214

Modified:
   trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/ChangeLog
   trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/EditorBindings.glade
   trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorBuffer.cs
   trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorDisplayBinding.cs
   trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorView.cs
   trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Properties/TextEditorProperties.cs
Log:
underlining of errors


Modified: trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/ChangeLog	2005-01-31 21:14:42 UTC (rev 2213)
+++ trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/ChangeLog	2005-01-31 23:17:28 UTC (rev 2214)
@@ -1,7 +1,18 @@
 2005-01-31  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
 
 	* EditorBindings.glade:
+	* Gui/SourceEditorBuffer.cs:
 	* Gui/SourceEditorView.cs:
+	* Gui/OptionPanels/MarkersTextEditorPanel.cs:
+	* Gui/SourceEditorDisplayBinding.cs:
+	* Properties/TextEditorProperties.cs:
+	finish off underlining of errors, seems to
+	work alright
+
+2005-01-31  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
+
+	* EditorBindings.glade:
+	* Gui/SourceEditorView.cs:
 	* Gui/OptionPanels/BehaviorTextEditorPanel.cs:
 	* Gui/SourceEditorDisplayBinding.cs:
 	* Properties/TextEditorProperties.cs:

Modified: trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/EditorBindings.glade
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/EditorBindings.glade	2005-01-31 21:14:42 UTC (rev 2213)
+++ trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/EditorBindings.glade	2005-01-31 23:17:28 UTC (rev 2214)
@@ -845,7 +845,7 @@
 		  &lt;property name=&quot;spacing&quot;&gt;6&lt;/property&gt;
 
 		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkCheckButton&quot; id=&quot;showInvalidLinesCheckBox&quot;&gt;
+		    &lt;widget class=&quot;GtkCheckButton&quot; id=&quot;showErrorsCheckBox&quot;&gt;
 		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 		      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
 		      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_Underline errors&lt;/property&gt;
@@ -1023,7 +1023,7 @@
 			      &lt;/child&gt;
 
 			      &lt;child&gt;
-				&lt;widget class=&quot;GtkCheckButton&quot; id=&quot;showErrorsCheckBox&quot;&gt;
+				&lt;widget class=&quot;GtkCheckButton&quot; id=&quot;showInvalidLinesCheckBox&quot;&gt;
 				  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 				  &lt;property name=&quot;sensitive&quot;&gt;False&lt;/property&gt;
 				  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;

Modified: trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorBuffer.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorBuffer.cs	2005-01-31 21:14:42 UTC (rev 2213)
+++ trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorBuffer.cs	2005-01-31 23:17:28 UTC (rev 2214)
@@ -73,20 +73,22 @@
 		AtomicUndo atomic_undo;
 		SourceEditorView view;
 		int highlightLine = -1;
+		bool underlineErrors = true;
+		ArrayList points;
 
+		IParserService ps = (IParserService)ServiceManager.GetService (typeof (IParserService));
+
 		public SourceEditorView View
 		{
-			get {
-				return view;
-			}
-			set {
-				view = value;
-			}
+			get { return view; }
+			set { view = value; }
 		}
-		
-		
-		IParserService ps = (IParserService)ServiceManager.GetService (typeof (IParserService));
 
+		public bool UnderlineErrors {
+			get { return underlineErrors; }
+			set { underlineErrors = value; }
+		}
+
 		public SourceEditorBuffer (SourceEditorView view) : this ()
 		{
 			this.view = view;
@@ -101,54 +103,58 @@
 			complete_ahead.Foreground = &quot;grey&quot;;
 			TagTable.Add (complete_ahead);
 			compilation_error = new TextTag (&quot;compilation_error&quot;);
-			compilation_error.Underline = Pango.Underline.Single;
+			compilation_error.Underline = Pango.Underline.Error;
 			TagTable.Add (compilation_error);
 			complete_end = CreateMark (null, StartIter, true);
 			highlightLineTag = new TextTag (&quot;highlightLine&quot;);
 			highlightLineTag.Background = &quot;lightgrey&quot;;
 			TagTable.Add (highlightLineTag);
-			//ps.ParseInformationChanged += new ParseInformationEventHandler (parseChanged);
+
+			points = new ArrayList ();
+			ps.ParseInformationChanged += new ParseInformationEventHandler (ParseChanged);
+			GLib.Timeout.Add (50, new GLib.TimeoutHandler (DrawErrors));
 		}
 		
-			ArrayList points = new ArrayList ();
-		public void parseChanged (object o, ParseInformationEventArgs e)
+		public void ParseChanged (object o, ParseInformationEventArgs e)
 		{
 			if (view != null) {
-				if (view.ParentEditor.DisplayBinding.ContentName == e.FileName){
+				if (view.ParentEditor.DisplayBinding.ContentName == e.FileName) {
 					if (e.ParseInformation.MostRecentCompilationUnit.ErrorsDuringCompile) {
 						string[] errors = e.ParseInformation.MostRecentCompilationUnit.ErrorOutput.Split ('\n');
 						foreach (string error in errors) {
 							string[] pieces = error.Split (' ');
-							if (pieces.Length == 1) continue;
-							Console.WriteLine (&quot;line: {0} col: {1}&quot;, pieces[2], pieces[4]);
+							if (pieces.Length == 1)
+								continue;
 							int[] point = new int[2];
 							point[0] = Convert.ToInt32 (pieces[2]) - 1;
-							point[1] = Convert.ToInt32 (pieces[4]);
+							point[1] = Convert.ToInt32 (pieces[4]) - 1;
 							points.Add (point);
 						}
-						GLib.Idle.Add (new GLib.IdleHandler (addMarkup));
 					}
 					else {
-						//Clear errors
+						points.Clear ();
 					}
 				}
 			}
 		}
 
-		bool addMarkup ()
+		bool DrawErrors ()
 		{
+			// FIXME: clear old ones nicer
+			RemoveTag (compilation_error, StartIter, EndIter);
+			if (!underlineErrors)
+				return true;
+
 			foreach (int[] point in points) {
-				Console.WriteLine (&quot;line: {0} col: {1}&quot;, point[0], point[1]);
-				TextIter start = GetIterAtLine (point[0]);
-				Console.WriteLine (start.Line);
-				//start.LineOffset = point[1] - 1;
-				Console.WriteLine (start.Line);
+				//Console.WriteLine (&quot;Error is line: {0} col: {1}&quot;, point[0], point[1]);
+				// FIXME: maybe we can be more precise
+				TextIter start = GetIterAtLineOffset (point[0], point[1]);
 				TextIter end = start;
 				end.ForwardToLineEnd ();
 				ApplyTag (compilation_error, start, end);
 			}
-			points.Clear ();
-			return false;
+
+			return true;
 		}		
 		
 		public void MarkupLine (int linenumber)
@@ -325,7 +331,6 @@
 		{
 			get {
 				return true;
-				//return clipboard.WaitIsTextAvailable ();
 			}
 		}
 		

Modified: trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorDisplayBinding.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorDisplayBinding.cs	2005-01-31 21:14:42 UTC (rev 2213)
+++ trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorDisplayBinding.cs	2005-01-31 23:17:28 UTC (rev 2214)
@@ -519,6 +519,7 @@
 			se.View.InsertSpacesInsteadOfTabs = TextEditorProperties.ConvertTabsToSpaces;
 			se.View.AutoIndent = (TextEditorProperties.IndentStyle == IndentStyle.Auto);
 			se.View.AutoInsertTemplates = TextEditorProperties.AutoInsertTemplates;
+			se.Buffer.UnderlineErrors = TextEditorProperties.UnderlineErrors;
 			
 			//System.Console.WriteLine(e.Key + &quot; = &quot; + e.NewValue + &quot;(from &quot; + e.OldValue + &quot;)&quot; );
 					// The items below can't be done (since there is no support for it in gtksourceview)
@@ -526,7 +527,6 @@
 					// CANTDO: show tabs				Key = &quot;ShowTabs&quot;
 					// CANTDO eol makers				Key = &quot;ShowEOLMarkers&quot;
 					// CANTDO: show horizontal ruler	Key = &quot;ShowHRuler&quot;		
-					// CANDO in pango1.4: underline errors			Key = &quot;ShowErrors&quot;
 					// DONOTDO: auto insert braces		Key = &quot;AutoInsertCurlyBracket&quot;
 					// TODO: Show Invalid Lines			Key = &quot;ShowInvalidLines&quot;
 					// TODO: Code Folding				Key = &quot;EnableFolding&quot;
@@ -536,3 +536,4 @@
  		}
 	}
 }
+

Modified: trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorView.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorView.cs	2005-01-31 21:14:42 UTC (rev 2213)
+++ trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui/SourceEditorView.cs	2005-01-31 23:17:28 UTC (rev 2214)
@@ -42,7 +42,7 @@
 			get { return autoInsertTemplates; }
 			set { autoInsertTemplates = value; }
 		}
-		
+
 		public SourceEditorView (SourceEditorBuffer buf, SourceEditor parent)
 		{
 			this.ParentEditor = parent;

Modified: trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Properties/TextEditorProperties.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Properties/TextEditorProperties.cs	2005-01-31 21:14:42 UTC (rev 2213)
+++ trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Properties/TextEditorProperties.cs	2005-01-31 23:17:28 UTC (rev 2214)
@@ -281,6 +281,15 @@
 				properties.SetProperty(&quot;AutoInsertTemplates&quot;, value);
 			}
 		}
+
+		public static bool UnderlineErrors {
+			get {
+				return properties.GetProperty(&quot;ShowErrors&quot;, true);
+			}
+			set {
+				properties.SetProperty(&quot;ShowErrors&quot;, value);
+			}
+		}
 		
 		public static FontDescription Font {
 			get {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001817.html">[Monodevelop-patches-list] r2213 - in trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor: . Gui Gui/OptionPanels Properties
</A></li>
	<LI>Next message: <A HREF="001819.html">[Monodevelop-patches-list] r2215 - trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor/Gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1818">[ date ]</a>
              <a href="thread.html#1818">[ thread ]</a>
              <a href="subject.html#1818">[ subject ]</a>
              <a href="author.html#1818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
