<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2209 - in trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets: . FileBrowser
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2209%20-%20in%20trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets%3A%20.%20FileBrowser&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001812.html">
   <LINK REL="Next"  HREF="001814.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2209 - in trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets: . FileBrowser</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2209%20-%20in%20trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets%3A%20.%20FileBrowser&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2209 - in trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets: . FileBrowser">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Mon Jan 31 15:27:25 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001812.html">[Monodevelop-patches-list] r2208 - in trunk/MonoDevelop/Extras: . MonoDeveloperExtensions
</A></li>
        <LI>Next message: <A HREF="001814.html">[Monodevelop-patches-list] r2210 - trunk/MonoDevelop/Extras
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1813">[ date ]</a>
              <a href="thread.html#1813">[ thread ]</a>
              <a href="subject.html#1813">[ subject ]</a>
              <a href="author.html#1813">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jluke
Date: 2005-01-31 15:27:24 -0500 (Mon, 31 Jan 2005)
New Revision: 2209

Modified:
   trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/ChangeLog
   trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/FileBrowser/FileBrowser.cs
Log:
use ToolItem instead


Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/ChangeLog	2005-01-31 20:27:22 UTC (rev 2208)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/ChangeLog	2005-01-31 20:27:24 UTC (rev 2209)
@@ -1,3 +1,8 @@
+2005-01-31  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
+
+	* FileBrowser/FileBrowser.cs: use ToolItem
+	instead of action crapola
+
 2005-01-27  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">john.luke at gmail.com</A>&gt;
 
 	* Makefile.am:

Modified: trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/FileBrowser/FileBrowser.cs
===================================================================
--- trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/FileBrowser/FileBrowser.cs	2005-01-31 20:27:22 UTC (rev 2208)
+++ trunk/MonoDevelop/Core/src/MonoDevelop.Gui.Widgets/FileBrowser/FileBrowser.cs	2005-01-31 20:27:24 UTC (rev 2209)
@@ -33,11 +33,11 @@
 	{
 		public DirectoryChangedEventHandler DirectoryChangedEvent;
 
-		Gtk.UIManager uiManager;
+		private static Tooltips tips = new Tooltips ();
 		private Gtk.TreeView tv;
 		private Gtk.ScrolledWindow scrolledwindow;
-		private Gtk.Button upbutton, homebutton;
-		private Gtk.Entry entry;
+		private Gtk.ToolButton goUp, goHome;
+		private ToolbarEntry entry;
 		private IMessageService messageService;
 		private Gtk.CellRendererText text_render;
 		private ListStore store;
@@ -51,12 +51,6 @@
 
 		PropertyService PropertyService = (PropertyService) ServiceManager.GetService (typeof (PropertyService));
 
-		const string uiInfo = 
-			&quot;&lt;toolbar name=\&quot;toolbar\&quot;&gt;&quot; +
-			&quot;  &lt;toolitem name=\&quot;goUp\&quot; action=\&quot;goUp\&quot; /&gt;&quot; +
-			&quot;  &lt;toolitem name=\&quot;home\&quot; action=\&quot;home\&quot; /&gt;&quot; +
-			&quot;&lt;/toolbar&gt;&quot;;
-
 		public FileBrowser ()
 		{
 			if (!Vfs.Initialized) {
@@ -70,23 +64,25 @@
 			scrolledwindow.HscrollbarPolicy = PolicyType.Automatic;
 			scrolledwindow.ShadowType = ShadowType.In;
 
-			ActionEntry[] actions = new ActionEntry[]
-			{
-				new ActionEntry (&quot;goUp&quot;, Gtk.Stock.GoUp, null, null, GettextCatalog.GetString (&quot;Up one level&quot;), new EventHandler (OnUpClicked)),
-				new ActionEntry (&quot;home&quot;, Gtk.Stock.Home, null, null, GettextCatalog.GetString (&quot;Home&quot;), new EventHandler (OnHomeClicked))
-			};
+			Toolbar toolbar = new Toolbar ();
+			toolbar.IconSize = IconSize.SmallToolbar;
 
-			ActionGroup actionGroup = new ActionGroup (&quot;navbar&quot;);
-			actionGroup.Add (actions);
+			goUp = new ToolButton (Stock.GoUp);
+			goUp.Clicked += new EventHandler (OnGoUpClicked);
+			goUp.SetTooltip (tips, GettextCatalog.GetString (&quot;Go up&quot;), &quot;Go up&quot;);
+			toolbar.Insert (goUp, -1);
 
-			uiManager = new UIManager ();
-			uiManager.InsertActionGroup (actionGroup, 0);
-			uiManager.AddWidget += new AddWidgetHandler (OnUIAdd);
-			uiManager.AddUiFromString (uiInfo);
+			goHome = new ToolButton (Stock.Home);
+			goHome.Clicked += new EventHandler (OnGoHomeClicked);
+			goHome.SetTooltip (tips, GettextCatalog.GetString (&quot;Home&quot;), &quot;Home&quot;);
+			toolbar.Insert (goHome, -1);
 
-			Toolbar tb = uiManager.GetWidget (&quot;/ui/toolbar&quot;) as Toolbar;
-			tb.IconSize = Gtk.IconSize.SmallToolbar;
-			AddLocationEntry (tb);
+			entry = new ToolbarEntry ();
+			entry.Activated += new EventHandler (OnEntryActivated);
+			entry.SetTooltip (tips, GettextCatalog.GetString (&quot;Location&quot;), &quot;&quot;);
+			toolbar.Insert (entry, -1);
+			toolbar.ShowAll ();
+			this.PackStart (toolbar, false, true, 0);
 
 			IProperties p = (IProperties) PropertyService.GetProperty (&quot;SharpDevelop.UI.SelectStyleOptions&quot;, new DefaultProperties ());
 			ignoreHidden = !p.GetProperty (&quot;MonoDevelop.Gui.FileScout.ShowHidden&quot;, false);
@@ -167,11 +163,10 @@
 		{
 			store.Clear ();
 
-			ToolButton upbutton = uiManager.GetWidget (&quot;/ui/toolbar/goUp&quot;) as Gtk.ToolButton;
 			if (System.IO.Path.GetPathRoot (CurrentDir) == CurrentDir)
-				upbutton.Sensitive = false;
-			else if (upbutton.Sensitive == false)
-				upbutton.Sensitive = true;
+				goUp.Sensitive = false;
+			else if (goUp.Sensitive == false)
+				goUp.Sensitive = true;
 
 			DirectoryInfo di = new DirectoryInfo (CurrentDir);
 			DirectoryInfo[] dirs = di.GetDirectories ();
@@ -296,13 +291,13 @@
 			}
 		}
 		
-		private void OnUpClicked (object o, EventArgs args)
+		private void OnGoUpClicked (object o, EventArgs args)
 		{
 			if (System.IO.Path.GetPathRoot (CurrentDir) != CurrentDir)
 				CurrentDir = System.IO.Path.Combine (CurrentDir, &quot;..&quot;);
 		}
 		
-		private void OnHomeClicked (object o, EventArgs args)
+		private void OnGoHomeClicked (object o, EventArgs args)
 		{
 			CurrentDir = Environment.GetFolderPath (Environment.SpecialFolder.Personal);
 		}
@@ -448,21 +443,40 @@
 			return !hiddenfolders.Contains (folder);
 		} 
 
-		void OnUIAdd (object sender, AddWidgetArgs a)
+		void AddLocationEntry (Toolbar tb)
 		{
-			a.Widget.Show ();
-			this.PackStart (a.Widget, false, true, 0);
 		}
+	}
 
-		void AddLocationEntry (Toolbar tb)
+	public class ToolbarEntry : ToolItem
+	{
+		Entry entry;
+
+		public ToolbarEntry () : base ()
 		{
 			entry = new Entry ();
-			entry.Activated += new EventHandler (OnEntryActivated);
+			entry.Activated += new EventHandler (OnActivated);
+			this.Add (entry);
 			entry.Show ();
-			ToolItem item = new ToolItem ();
-			item.Add (entry);
-			tb.Add (item);
+			this.ShowAll ();
 		}
+
+		protected void OnActivated (object sender, EventArgs a)
+		{
+			if (Activated != null)
+				Activated (this, EventArgs.Empty);
+		}
+
+		public string Text {
+			get {
+				return entry.Text;
+			}
+			set {
+				entry.Text = value;
+			}
+		}
+
+		public event EventHandler Activated;
 	}
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001812.html">[Monodevelop-patches-list] r2208 - in trunk/MonoDevelop/Extras: . MonoDeveloperExtensions
</A></li>
	<LI>Next message: <A HREF="001814.html">[Monodevelop-patches-list] r2210 - trunk/MonoDevelop/Extras
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1813">[ date ]</a>
              <a href="thread.html#1813">[ thread ]</a>
              <a href="subject.html#1813">[ subject ]</a>
              <a href="author.html#1813">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
