<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r1148 - in trunk/MonoDevelop: build/data/templates/project/CSharp src/Main/Base/Gui/Pads/HelpBrowser src/Main/Base/Internal/Templates/ProjectTemplates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1148%20-%20in%20trunk/MonoDevelop%3A%20build/data/templates/project/CSharp%20src/Main/Base/Gui/Pads/HelpBrowser%20src/Main/Base/Internal/Templates/ProjectTemplates&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000753.html">
   <LINK REL="Next"  HREF="000755.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r1148 - in trunk/MonoDevelop: build/data/templates/project/CSharp src/Main/Base/Gui/Pads/HelpBrowser src/Main/Base/Internal/Templates/ProjectTemplates</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1148%20-%20in%20trunk/MonoDevelop%3A%20build/data/templates/project/CSharp%20src/Main/Base/Gui/Pads/HelpBrowser%20src/Main/Base/Internal/Templates/ProjectTemplates&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r1148 - in trunk/MonoDevelop: build/data/templates/project/CSharp src/Main/Base/Gui/Pads/HelpBrowser src/Main/Base/Internal/Templates/ProjectTemplates">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Thu Mar 11 16:50:12 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000753.html">[Monodevelop-patches-list] r1147 - trunk/MonoDevelop/build/data/templates/project/CSharp
</A></li>
        <LI>Next message: <A HREF="000755.html">[Monodevelop-patches-list] r1149 - in trunk/MonoDevelop: build/AddIns src/Main/Base src/Main/Base/Gui/Pads/HelpBrowser src/Main/Base/Services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#754">[ date ]</a>
              <a href="thread.html#754">[ thread ]</a>
              <a href="subject.html#754">[ subject ]</a>
              <a href="author.html#754">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tberman
Date: 2004-03-11 16:50:12 -0500 (Thu, 11 Mar 2004)
New Revision: 1148

Modified:
   trunk/MonoDevelop/build/data/templates/project/CSharp/GladeSharpProject.xpt
   trunk/MonoDevelop/src/Main/Base/Gui/Pads/HelpBrowser/HelpViewer.cs
   trunk/MonoDevelop/src/Main/Base/Internal/Templates/ProjectTemplates/ProjectDescriptor.cs
Log:
this makes erik's project work by default.
now we can use embed resources in project templates


Modified: trunk/MonoDevelop/build/data/templates/project/CSharp/GladeSharpProject.xpt
===================================================================
--- trunk/MonoDevelop/build/data/templates/project/CSharp/GladeSharpProject.xpt	2004-03-11 21:19:19 UTC (rev 1147)
+++ trunk/MonoDevelop/build/data/templates/project/CSharp/GladeSharpProject.xpt	2004-03-11 21:50:12 UTC (rev 1148)
@@ -35,7 +35,42 @@
 				&lt;Reference type=&quot;Gac&quot; refto=&quot;System.Drawing.dll&quot; /&gt;
 				&lt;Reference type=&quot;Gac&quot; refto=&quot;glade-sharp.dll&quot; /&gt;
 			&lt;/References&gt;
-		
+			
+			&lt;Resources&gt;
+&lt;File name=&quot;file.glade&quot;&gt;&lt;![CDATA[&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot;?&gt; &lt;!--*- mode: xml -*--&gt;
+&lt;!DOCTYPE glade-interface SYSTEM &quot;<A HREF="http://glade.gnome.org/glade-2.0.dtd&quot;">http://glade.gnome.org/glade-2.0.dtd&quot;</A>&gt;
+ 
+&lt;glade-interface&gt;
+&lt;requires lib=&quot;gnome&quot;/&gt;
+ 
+&lt;widget class=&quot;GtkWindow&quot; id=&quot;window1&quot;&gt;
+  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+  &lt;property name=&quot;title&quot; translatable=&quot;yes&quot;&gt;Glade Window&lt;/property&gt;
+ &lt;property name=&quot;window_position&quot;&gt;GTK_WIN_POS_CENTER&lt;/property&gt;
+  &lt;property name=&quot;modal&quot;&gt;False&lt;/property&gt;
+  &lt;property name=&quot;default_width&quot;&gt;256&lt;/property&gt;
+  &lt;property name=&quot;default_height&quot;&gt;256&lt;/property&gt;
+  &lt;property name=&quot;type&quot;&gt;GTK_WINDOW_TOPLEVEL&lt;/property&gt;
+  &lt;property name=&quot;resizable&quot;&gt;True&lt;/property&gt;
+  &lt;property name=&quot;destroy_with_parent&quot;&gt;False&lt;/property&gt;
+  &lt;signal name=&quot;delete_event&quot; handler=&quot;OnWindowDeleteEvent&quot; last_modification_time=&quot;${Date} ${Time}&quot;/&gt;
+ 
+  &lt;child&gt;
+    &lt;widget class=&quot;GtkButton&quot; id=&quot;button1&quot;&gt;
+      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Hello !&lt;/property&gt;
+      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
+      &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
+      &lt;signal name=&quot;clicked&quot; handler=&quot;OnButtonClickedEvent&quot; last_modification_time=&quot;${Date} ${Time}&quot;/&gt;
+    &lt;/widget&gt;
+  &lt;/child&gt;
+&lt;/widget&gt;
+ 
+&lt;/glade-interface&gt;
+
+]]&gt;&lt;/File&gt;
+			&lt;/Resources&gt;
 			&lt;Files&gt;
 				&lt;File name=&quot;Main.cs&quot;&gt;
 &lt;![CDATA[// project created on ${Date} at ${Time}
@@ -87,41 +122,7 @@
 
 ]]&gt;
 &lt;/File&gt;
-&lt;File name=&quot;file.glade&quot;&gt;&lt;![CDATA[&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot;?&gt; &lt;!--*- mode: xml -*--&gt;
-&lt;!DOCTYPE glade-interface SYSTEM &quot;<A HREF="http://glade.gnome.org/glade-2.0.dtd&quot;">http://glade.gnome.org/glade-2.0.dtd&quot;</A>&gt;
- 
-&lt;glade-interface&gt;
-&lt;requires lib=&quot;gnome&quot;/&gt;
- 
-&lt;widget class=&quot;GtkWindow&quot; id=&quot;window1&quot;&gt;
-  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-  &lt;property name=&quot;title&quot; translatable=&quot;yes&quot;&gt;Glade Window&lt;/property&gt;
- &lt;property name=&quot;window_position&quot;&gt;GTK_WIN_POS_CENTER&lt;/property&gt;
-  &lt;property name=&quot;modal&quot;&gt;False&lt;/property&gt;
-  &lt;property name=&quot;default_width&quot;&gt;256&lt;/property&gt;
-  &lt;property name=&quot;default_height&quot;&gt;256&lt;/property&gt;
-  &lt;property name=&quot;type&quot;&gt;GTK_WINDOW_TOPLEVEL&lt;/property&gt;
-  &lt;property name=&quot;resizable&quot;&gt;True&lt;/property&gt;
-  &lt;property name=&quot;destroy_with_parent&quot;&gt;False&lt;/property&gt;
-  &lt;signal name=&quot;delete_event&quot; handler=&quot;OnWindowDeleteEvent&quot; last_modification_time=&quot;${Date} ${Time}&quot;/&gt;
- 
-  &lt;child&gt;
-    &lt;widget class=&quot;GtkButton&quot; id=&quot;button1&quot;&gt;
-      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Hello !&lt;/property&gt;
-      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-      &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
-      &lt;signal name=&quot;clicked&quot; handler=&quot;OnButtonClickedEvent&quot; last_modification_time=&quot;${Date} ${Time}&quot;/&gt;
-    &lt;/widget&gt;
-  &lt;/child&gt;
-&lt;/widget&gt;
- 
-&lt;/glade-interface&gt;
-
-]]&gt;&lt;/File&gt;
-	
-			&lt;File name=&quot;AssemblyInfo.cs&quot;&gt;&lt;![CDATA[using System.Reflection;
+&lt;File name=&quot;AssemblyInfo.cs&quot;&gt;&lt;![CDATA[using System.Reflection;
 using System.Runtime.CompilerServices;
 
 // Information about this assembly is defined by the following

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Pads/HelpBrowser/HelpViewer.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Pads/HelpBrowser/HelpViewer.cs	2004-03-11 21:19:19 UTC (rev 1147)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Pads/HelpBrowser/HelpViewer.cs	2004-03-11 21:50:12 UTC (rev 1148)
@@ -26,9 +26,48 @@
 
 		public HelpViewer ()
 		{
+	                //html_viewer.LinkClicked += new LinkClickedHandler (LinkClicked);
+	                //html_viewer.UrlRequested += new UrlRequestedHandler (UrlRequested);
 			scroller.Add (html_viewer);
 		}
 
+		/*void UrlRequested (object sender, UrlRequestedArgs args)
+		{
+			Console.WriteLine (&quot;Image requested: &quot; + args.Url);
+			Stream s = help_tree.GetImage (args.Url);
+			
+			if (s == null)
+				s = GetResourceImage (&quot;monodoc.png&quot;);
+				byte [] buffer = new byte [8192];
+				int n;
+
+				while ((n = s.Read (buffer, 0, 8192)) != 0) {
+				args.Handle.Write (buffer, n);
+			}
+			args.Handle.Close (HTMLStreamStatus.Ok);
+		}
+
+		void LinkClicked (object o, LinkClickedArgs args)
+		{
+			LoadUrl (args.Url);
+		}
+ 
+		public void LoadUrl (string url)
+		{
+			if (url.StartsWith(&quot;#&quot;))
+			{
+				html_viewer.JumpToAnchor(url.Substring(1));
+				return;
+			}
+
+			Node node;
+			
+			string res = help_tree.RenderUrl (url, out node);
+			if (res != null) {
+				Render (res, node, url);
+			}
+                }*/
+
         	public void Render (string text, Node matched_node, string url)
         	{
         	        CurrentUrl = url;

Modified: trunk/MonoDevelop/src/Main/Base/Internal/Templates/ProjectTemplates/ProjectDescriptor.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Internal/Templates/ProjectTemplates/ProjectDescriptor.cs	2004-03-11 21:19:19 UTC (rev 1147)
+++ trunk/MonoDevelop/src/Main/Base/Internal/Templates/ProjectTemplates/ProjectDescriptor.cs	2004-03-11 21:50:12 UTC (rev 1148)
@@ -30,6 +30,7 @@
 		
 		ArrayList files      = new ArrayList(); // contains FileTemplate classes
 		ArrayList references = new ArrayList(); 
+		ArrayList resources = new ArrayList ();
 		
 		XmlElement projectOptions = null;
 		
@@ -52,6 +53,12 @@
 			}
 		}
 
+		public ArrayList Resources {
+			get {
+				return resources;
+			}
+		}
+
 		public XmlElement ProjectOptions {
 			get {
 				return projectOptions;
@@ -93,7 +100,34 @@
 			foreach (ProjectReference projectReference in references) {
 				project.ProjectReferences.Add(projectReference);
 			}
-			
+
+			foreach (FileDescriptionTemplate file in resources) {
+				string fileName = fileUtilityService.GetDirectoryNameWithSeparator(projectCreateInformation.ProjectBasePath) + stringParserService.Parse(file.Name, new string[,] { {&quot;ProjectName&quot;, projectCreateInformation.ProjectName} });
+				
+				ProjectFile resource = new ProjectFile (fileName);
+				resource.BuildAction = BuildAction.EmbedAsResource;
+				project.ProjectFiles.Add(resource);
+				
+				if (File.Exists(fileName)) {
+					IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+					if (!messageService.AskQuestion(&quot;File &quot; + fileName + &quot; already exists, do you want to overwrite\nthe existing file ?&quot;, &quot;File already exists&quot;)) {
+						continue;
+					}
+				}
+				
+				try {
+					if (!Directory.Exists(Path.GetDirectoryName(fileName))) {
+						Directory.CreateDirectory(Path.GetDirectoryName(fileName));
+					}
+					StreamWriter sr = File.CreateText(fileName);
+					sr.Write(stringParserService.Parse(file.Content, new string[,] { {&quot;ProjectName&quot;, projectCreateInformation.ProjectName}, {&quot;FileName&quot;, fileName}}));
+					sr.Close();
+				} catch (Exception ex) {
+					IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+					messageService.ShowError(ex, &quot;File &quot; + fileName + &quot; could not be written.&quot;);
+				}
+			}
+	
 			// Add Files
 			foreach (FileDescriptionTemplate file in files) {
 				string fileName = fileUtilityService.GetDirectoryNameWithSeparator(projectCreateInformation.ProjectBasePath) + stringParserService.Parse(file.Name, new string[,] { {&quot;ProjectName&quot;, projectCreateInformation.ProjectName} });
@@ -151,6 +185,13 @@
 					}
 				}
 			}
+			if (element[&quot;Resources&quot;] != null) {
+				foreach (XmlNode node in element[&quot;Resources&quot;].ChildNodes) {
+					if (node != null &amp;&amp; node.Name == &quot;File&quot;) {
+						projectDescriptor.resources.Add (new FileDescriptionTemplate (node.Attributes[&quot;name&quot;].InnerText, node.InnerText));
+					}
+				}
+			}
 			if (element[&quot;References&quot;] != null) {
 				foreach (XmlNode node in element[&quot;References&quot;].ChildNodes) {
 					if (node != null &amp;&amp; node.Name == &quot;Reference&quot;) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000753.html">[Monodevelop-patches-list] r1147 - trunk/MonoDevelop/build/data/templates/project/CSharp
</A></li>
	<LI>Next message: <A HREF="000755.html">[Monodevelop-patches-list] r1149 - in trunk/MonoDevelop: build/AddIns src/Main/Base src/Main/Base/Gui/Pads/HelpBrowser src/Main/Base/Services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#754">[ date ]</a>
              <a href="thread.html#754">[ thread ]</a>
              <a href="subject.html#754">[ subject ]</a>
              <a href="author.html#754">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
