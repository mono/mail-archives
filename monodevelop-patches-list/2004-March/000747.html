<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r1141 - in trunk/MonoDevelop: . src/AddIns/BackendBindings/CSharpBinding/Gui src/Main/Base/Commands src/Main/Base/Commands/ProjectBrowserCommands src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions src/Main/Base/Gui/Dialogs/ReferenceDialog src/Main/Base/Internal/Project/Combine src/Main/Base/Internal/Project/Project
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1141%20-%20in%20trunk/MonoDevelop%3A%20.%20src/AddIns/BackendBindings/CSharpBinding/Gui%20src/Main/Base/Commands%20src/Main/Base/Commands/ProjectBrowserCommands%20src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions%20src/Main/Base/Gui/Dialogs/ReferenceDialog%20src/Main/Base/Internal/Project/Combine%20src/Main/Base/Internal/Project/Project&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000777.html">
   <LINK REL="Next"  HREF="000748.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r1141 - in trunk/MonoDevelop: . src/AddIns/BackendBindings/CSharpBinding/Gui src/Main/Base/Commands src/Main/Base/Commands/ProjectBrowserCommands src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions src/Main/Base/Gui/Dialogs/ReferenceDialog src/Main/Base/Internal/Project/Combine src/Main/Base/Internal/Project/Project</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1141%20-%20in%20trunk/MonoDevelop%3A%20.%20src/AddIns/BackendBindings/CSharpBinding/Gui%20src/Main/Base/Commands%20src/Main/Base/Commands/ProjectBrowserCommands%20src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions%20src/Main/Base/Gui/Dialogs/ReferenceDialog%20src/Main/Base/Internal/Project/Combine%20src/Main/Base/Internal/Project/Project&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r1141 - in trunk/MonoDevelop: . src/AddIns/BackendBindings/CSharpBinding/Gui src/Main/Base/Commands src/Main/Base/Commands/ProjectBrowserCommands src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions src/Main/Base/Gui/Dialogs/ReferenceDialog src/Main/Base/Internal/Project/Combine src/Main/Base/Internal/Project/Project">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Wed Mar 10 23:21:10 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000777.html">[Monodevelop-patches-list] ASP.net Project Template
</A></li>
        <LI>Next message: <A HREF="000748.html">[Monodevelop-patches-list] r1142 - in trunk/MonoDevelop: data/resources/glade src/Main/Base/Gui/Dialogs/OptionPanels/IDEOptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#747">[ date ]</a>
              <a href="thread.html#747">[ thread ]</a>
              <a href="subject.html#747">[ subject ]</a>
              <a href="author.html#747">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jluke
Date: 2004-03-10 23:21:09 -0500 (Wed, 10 Mar 2004)
New Revision: 1141

Removed:
   trunk/MonoDevelop/FIND_PROBLEMS
Modified:
   trunk/MonoDevelop/ChangeLog
   trunk/MonoDevelop/TODO
   trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/Gui/OutputOptionsPanel.cs
   trunk/MonoDevelop/src/Main/Base/Commands/FileCommands.cs
   trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/CombineNodeCommands.cs
   trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/FolderNodeCommands.cs
   trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/ResourceFolderNodeCommands.cs
   trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions/DeployFileOptions.cs
   trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/ReferenceDialog/AssemblyReferencePanel.cs
   trunk/MonoDevelop/src/Main/Base/Internal/Project/Combine/Combine.cs
   trunk/MonoDevelop/src/Main/Base/Internal/Project/Project/AbstractProject.cs
Log:
    * *.cs: anywhere a FileSelection dialog is used wrap it in     using {}, remove some obsolete/leftover stuff from the SD port



Modified: trunk/MonoDevelop/ChangeLog
===================================================================
--- trunk/MonoDevelop/ChangeLog	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/ChangeLog	2004-03-11 04:21:09 UTC (rev 1141)
@@ -2,6 +2,8 @@
 
 	* README: add monodoc and debugger to list of deps
 	* configure.in: report Gtk#, monodoc, mono debugger results
+	* *.cs: anywhere a FileSelection dialog is used wrap it in
+	using {}, remove some obsolete/leftover stuff from the SD port
 
 2004-03-10  Todd Berman &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">tberman at sevenl.net</A>&gt;
 

Deleted: trunk/MonoDevelop/FIND_PROBLEMS
===================================================================

Modified: trunk/MonoDevelop/TODO
===================================================================
--- trunk/MonoDevelop/TODO	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/TODO	2004-03-11 04:21:09 UTC (rev 1141)
@@ -1,3 +1,6 @@
+NOTE: This file is deprecated please use bugzilla instead.
+<A HREF="http://bugzilla.ximian.com/">http://bugzilla.ximian.com/</A>
+
 Editor
 ------
 - Get code-folding working (not implemented in #d).

Modified: trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/Gui/OutputOptionsPanel.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/Gui/OutputOptionsPanel.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/AddIns/BackendBindings/CSharpBinding/Gui/OutputOptionsPanel.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -94,53 +94,56 @@
 			
 			void SelectFolder(object sender, EventArgs e)
 			{
-				FileSelection fdiag = new FileSelection (
-					&quot;${res:Dialog.Options.PrjOptions.Configuration.FolderBrowserDescription}&quot;);
+				using (FileSelection fdiag = new FileSelection (
+					&quot;${res:Dialog.Options.PrjOptions.Configuration.FolderBrowserDescription}&quot;)) {
+					if (fdiag.Run () == (int) ResponseType.Ok) {
+						outputDirectoryEntry.Text = fdiag.Filename;
+					}
 				
-				if (fdiag.Run () == (int) ResponseType.Ok) {
-				outputDirectoryEntry.Text = fdiag.Filename;				
+					fdiag.Hide ();
 				}
-				fdiag.Hide ();
-				fdiag.Dispose ();
 			}
 		
 			void SelectFile2(object sender, EventArgs e)
 			{
-				FileSelection fdiag = new FileSelection (&quot;&quot;);
-				//fdiag.Filter = StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
-				fdiag.SelectMultiple = false;
+				using (FileSelection fdiag = new FileSelection (&quot;&quot;)) {
+					//fdiag.Filter = StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
+					fdiag.SelectMultiple = false;
 				
-				if(fdiag.Run () == (int) ResponseType.Ok) {
-					executeBeforeEntry.Text = fdiag.Filename;
+					if(fdiag.Run () == (int) ResponseType.Ok) {
+						executeBeforeEntry.Text = fdiag.Filename;
+					}
+
+					fdiag.Hide ();
 				}
-				fdiag.Hide ();
-				fdiag.Dispose ();			
 			}
 			
 			void SelectFile3(object sender, EventArgs e)
 			{
-				FileSelection fdiag = new FileSelection (&quot;&quot;);
-				//fdiag.Filter = StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
-				fdiag.SelectMultiple = false;
+				using (FileSelection fdiag = new FileSelection (&quot;&quot;)) {
+					//fdiag.Filter = StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
+					fdiag.SelectMultiple = false;
 				
-				if(fdiag.Run () == (int) ResponseType.Ok) {
-					executeAfterEntry.Text = fdiag.Filename;
+					if(fdiag.Run () == (int) ResponseType.Ok) {
+						executeAfterEntry.Text = fdiag.Filename;
+					}
+
+					fdiag.Hide ();
 				}
-				fdiag.Hide ();
-				fdiag.Dispose ();
 			}
 		
 			void SelectFile4(object sender, EventArgs e)
 			{
-				FileSelection fdiag = new FileSelection (&quot;&quot;);
-				//fdiag.Filter = StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
-				fdiag.SelectMultiple = false;
+				using (FileSelection fdiag = new FileSelection (&quot;&quot;)) {
+					//fdiag.Filter = StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
+					fdiag.SelectMultiple = false;
 				
-				if(fdiag.Run () == (int) ResponseType.Ok) {
-					executeScriptEntry.Text = fdiag.Filename;
+					if(fdiag.Run () == (int) ResponseType.Ok) {
+						executeScriptEntry.Text = fdiag.Filename;
+					}
+
+					fdiag.Hide ();
 				}
-				fdiag.Hide ();
-				fdiag.Dispose ();
 			}
 		}
 

Modified: trunk/MonoDevelop/src/Main/Base/Commands/FileCommands.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Commands/FileCommands.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Commands/FileCommands.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -7,19 +7,12 @@
 
 using System;
 using System.IO;
-using System.Threading;
-using System.Drawing;
-using System.Drawing.Printing;
 using System.Collections;
-using System.ComponentModel;
-using System.Diagnostics;
 
 using MonoDevelop.Core.AddIns;
-
 using MonoDevelop.Core.Properties;
 using MonoDevelop.Core.AddIns.Codons;
 using MonoDevelop.Core.Services;
-
 using MonoDevelop.Services;
 using MonoDevelop.Internal.Project;
 using MonoDevelop.Gui;
@@ -43,10 +36,12 @@
 	{
 		public override void Run()
 		{
-			NewFileDialog nfd = new NewFileDialog();
-			nfd.ShowAll();
-			if (WorkbenchSingleton.Workbench.ActiveWorkbenchWindow != null) {
-				WorkbenchSingleton.Workbench.ActiveWorkbenchWindow.SelectWindow();
+			using (NewFileDialog nfd = new NewFileDialog()) {
+				nfd.ShowAll ();
+				if (WorkbenchSingleton.Workbench.ActiveWorkbenchWindow != null)
+				{
+					WorkbenchSingleton.Workbench.ActiveWorkbenchWindow.SelectWindow();
+				}
 			}
 		}
 	}
@@ -150,21 +145,22 @@
 						}
 					}*/
 					
-					Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save as...&quot;);
-					fdiag.Filename = window.ViewContent.ContentName;
-					int response = fdiag.Run ();
-					string filename = fdiag.Filename;
-					fdiag.Destroy ();
+					using (Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save as...&quot;)) {
+						fdiag.Filename = window.ViewContent.ContentName;
+						int response = fdiag.Run ();
+						string filename = fdiag.Filename;
+						fdiag.Hide ();
 					
-					if (response == (int)Gtk.ResponseType.Ok) {
-						IFileService fileService = (IFileService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IFileService));
-						FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
-						if (!fileUtilityService.IsValidFileName(filename)) {
-							IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
-							messageService.ShowMessage(&quot;File name &quot; + filename +&quot; is invalid&quot;);
-							return;
-						}
-						
+					
+						if (response == (int)Gtk.ResponseType.Ok) {
+							IFileService fileService = (IFileService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IFileService));
+							FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
+							if (!fileUtilityService.IsValidFileName(filename)) {
+								IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+								messageService.ShowMessage(&quot;File name &quot; + filename +&quot; is invalid&quot;);
+								return;
+							}
+
 						// save backup first
 						if((bool) PropertyService.GetProperty (&quot;SharpDevelop.CreateBackupCopy&quot;, false)) {
 							fileUtilityService.ObservedSave(new NamedFileOperationDelegate(window.ViewContent.Save), filename + &quot;~&quot;);
@@ -177,7 +173,7 @@
 							messageService.ShowMessage(filename, &quot;File saved&quot;);
 						}
 					}
-				//} USING
+				}
 			}
 		}
 	}
@@ -193,23 +189,33 @@
 					continue;
 				}
 				
-				if (content.ContentName == null) {
-					Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save File As...&quot;);
-					fdiag.Filename = System.Environment.GetEnvironmentVariable (&quot;HOME&quot;);
-					if (fdiag.Run () == (int)Gtk.ResponseType.Ok) {
-						string fileName = fdiag.Filename;
-						// currently useless, because the fdiag.FileName can't
-						// handle wildcard extensions :(
-						if (Path.GetExtension(fileName).StartsWith(&quot;?&quot;) || Path.GetExtension(fileName) == &quot;*&quot;) {
-							fileName = Path.ChangeExtension(fileName, &quot;&quot;);
+				if (content.ContentName == null)
+				{
+					using (Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save File As...&quot;))
+					{
+						fdiag.Filename = System.Environment.GetEnvironmentVariable (&quot;HOME&quot;);
+						if (fdiag.Run () == (int) Gtk.ResponseType.Ok)
+						{
+							string fileName = fdiag.Filename;
+
+							// currently useless
+							if (Path.GetExtension(fileName).StartsWith(&quot;?&quot;) || Path.GetExtension(fileName) == &quot;*&quot;)
+							{
+								fileName = Path.ChangeExtension(fileName, &quot;&quot;);
+							}
+
+							if (fileUtilityService.ObservedSave(new NamedFileOperationDelegate(content.Save), fileName) == FileOperationResult.OK)
+							{
+								IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+								messageService.ShowMessage(fileName, &quot;File saved&quot;);
+							}
 						}
-						if (fileUtilityService.ObservedSave(new NamedFileOperationDelegate(content.Save), fileName) == FileOperationResult.OK) {
-							IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
-							messageService.ShowMessage(fileName, &quot;File saved&quot;);
-						}
+					
+						fdiag.Hide ();
 					}
-					fdiag.Destroy ();
-				} else {
+				}
+				else
+				{
 					fileUtilityService.ObservedSave(new FileOperationDelegate(content.Save), content.ContentName);
 				}
 			}
@@ -222,37 +228,33 @@
 		
 		public override void Run()
 		{
-			Gtk.FileSelection fs = new Gtk.FileSelection (&quot;File to Open&quot;);
-			string defaultFolder = PropertyService.GetProperty(
-					&quot;MonoDevelop.Gui.Dialogs.NewProjectDialog.DefaultPath&quot;, 
+			using (Gtk.FileSelection fs = new Gtk.FileSelection (&quot;File to Open&quot;)) {
+				string defaultFolder = PropertyService.GetProperty(
+						&quot;MonoDevelop.Gui.Dialogs.NewProjectDialog.DefaultPath&quot;, 
 					System.IO.Path.Combine(System.Environment.GetFolderPath(System.Environment.SpecialFolder.Personal),
 						&quot;MonoDevelopProjects&quot;)).ToString();
-			fs.Complete (defaultFolder);
-			int response = fs.Run ();
-			string name = fs.Filename;
-			fs.Hide ();
-			fs.Destroy ();
+				fs.Complete (defaultFolder);
+				int response = fs.Run ();
+				string name = fs.Filename;
+				fs.Hide ();
 
-//			fdiag.AddExtension    = true;
-//			fdiag.Filter          = String.Join(&quot;|&quot;, (string[])(AddInTreeSingleton.AddInTree.GetTreeNode(&quot;/SharpDevelop/Workbench/Combine/FileFilter&quot;).BuildChildItems(this)).ToArray(typeof(string)));
-//			fdiag.Multiselect     = false;
-//			fdiag.CheckFileExists = true;
-			if (response == (int)Gtk.ResponseType.Ok) {
-				switch (Path.GetExtension(name).ToUpper()) {
-					case &quot;.CMBX&quot;: // Don't forget the 'recent' projects if you chance something here
-					case &quot;.PRJX&quot;:
-						IProjectService projectService = (IProjectService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IProjectService));
+				if (response == (int)Gtk.ResponseType.Ok) {
+					switch (Path.GetExtension(name).ToUpper()) {
+						case &quot;.CMBX&quot;: // Don't forget the 'recent' projects if you chance something here
+						case &quot;.PRJX&quot;:
+							IProjectService projectService = (IProjectService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IProjectService));
 
-						try {
-							projectService.OpenCombine(name);
-						} catch (Exception ex) {
-							CombineLoadError.HandleError(ex, name);
-						}
-						break;
-					default:
-						IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
-						messageService.ShowError(&quot;Can't open file &quot; + name + &quot;as project&quot;);
-						break;
+							try {
+								projectService.OpenCombine(name);
+							} catch (Exception ex) {
+								CombineLoadError.HandleError(ex, name);
+							}
+							break;
+						default:
+							IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+							messageService.ShowError(&quot;Can't open file &quot; + name + &quot;as project&quot;);
+							break;
+					}
 				}
 			}
 		}
@@ -302,45 +304,26 @@
 					if (window != null) {
 						for (int i = 0; i &lt; fileFilters.Length; ++i) {
 							if (fileFilters[i].IndexOf(Path.GetExtension(window.ViewContent.ContentName == null ? window.ViewContent.UntitledName : window.ViewContent.ContentName)) &gt;= 0) {
-#if !GTK
-								fdiag.FilterIndex = i + 1;
-#endif
 								break;
 							}
 						}
 					}
 				}
 
-				Gtk.FileSelection fs = new Gtk.FileSelection (&quot;File to Open&quot;);
-				string defaultFolder = PropertyService.GetProperty(
-					&quot;MonoDevelop.Gui.Dialogs.NewProjectDialog.DefaultPath&quot;, 
-					System.IO.Path.Combine(System.Environment.GetFolderPath(System.Environment.SpecialFolder.Personal),
-						&quot;MonoDevelopProjects&quot;)).ToString();
-				fs.Complete (defaultFolder);
-				int response = fs.Run ();
-				string name = fs.Filename;
-				fs.Destroy ();
+				using (Gtk.FileSelection fs = new Gtk.FileSelection (&quot;File to Open&quot;)) {
+					string defaultFolder = PropertyService.GetProperty(
+						&quot;MonoDevelop.Gui.Dialogs.NewProjectDialog.DefaultPath&quot;, 
+						System.IO.Path.Combine(System.Environment.GetFolderPath(System.Environment.SpecialFolder.Personal),
+							&quot;MonoDevelopProjects&quot;)).ToString();
+					fs.Complete (defaultFolder);
+					int response = fs.Run ();
+					string name = fs.Filename;
 
-#if !GTK
-				fdiag.Multiselect     = true;
-				fdiag.CheckFileExists = true;
-				
-				if (fdiag.ShowDialog() == DialogResult.OK) {
-#endif
 				if (response == (int)Gtk.ResponseType.Ok) {
 					IFileService fileService = (IFileService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IFileService));
-#if !GTK
-					foreach (string name in fdiag.FileNames) {
-#endif
-						Console.WriteLine (&quot;opening: &quot; + name);
 						fileService.OpenFile(name);
-#if !GTK
-					}
-#endif
 				}
-#if !GTK //} from using
 			}
-#endif
 		}
 	}
 	

Modified: trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/CombineNodeCommands.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/CombineNodeCommands.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/CombineNodeCommands.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -76,12 +76,9 @@
 			CombineBrowserNode node    = browser.SelectedNode as CombineBrowserNode;
 			
 			if (node != null) {
-				Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Add a Project&quot;);
-					//fdiag.AddExtension    = true;
+				using (Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Add a Project&quot;)) {
 					StringParserService stringParserService = (StringParserService)ServiceManager.Services.GetService(typeof(StringParserService));
-					//fdiag.Filter = stringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.ProjectFiles}|*.prjx|${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
 					fdiag.SelectMultiple = false;
-					//fdiag.CheckFileExists = true;
 					if (fdiag.Run () == (int) Gtk.ResponseType.Ok) {
 						object obj = node.Combine.AddEntry(fdiag.Filename);
 						if (obj is IProject) {
@@ -93,6 +90,7 @@
 					}
 
 					fdiag.Hide ();
+				}
 			}
 		}
 	}
@@ -106,12 +104,9 @@
 			CombineBrowserNode node    = browser.SelectedNode as CombineBrowserNode;
 			
 			if (node != null) {
-				Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Add a Combine&quot;);
-					//fdiag.AddExtension    = true;
+				using (Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Add a Combine&quot;)) {
 					StringParserService stringParserService = (StringParserService)ServiceManager.Services.GetService(typeof(StringParserService));
-					//fdiag.Filter = stringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.CombineFiles}|*.cmbx|${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
 					fdiag.SelectMultiple = false;
-					//fdiag.CheckFileExists = true;
 					if (fdiag.Run () == (int) Gtk.ResponseType.Ok) {
 						object obj = node.Combine.AddEntry(fdiag.Filename);
 						if (obj is IProject) {
@@ -121,7 +116,9 @@
 						}
 						projectService.SaveCombine();
 					}
+
 					fdiag.Hide ();
+				}
 			}
 		}
 	}

Modified: trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/FolderNodeCommands.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/FolderNodeCommands.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/FolderNodeCommands.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -39,21 +39,8 @@
 			
 			AbstractBrowserNode node = (AbstractBrowserNode)browser.SelectedNode;
 			
-			FileSelection fdiag  = new FileSelection (&quot;Add a file&quot;);
-			//fdiag.AddExtension    = true;
-			//string[] fileFilters  = (string[])(AddInTreeSingleton.AddInTree.GetTreeNode(&quot;/SharpDevelop/Workbench/FileFilter&quot;).BuildChildItems(this)).ToArray(typeof(string));
-			
-//	TODO : Set the file filters to the current project
-//				for (int i = 0; i &lt; fileFilters.Length; ++i) {
-//					if (fileFilters[i].IndexOf(Path.GetExtension(window.ViewContent.ContentName == null ? window.ViewContent.UntitledName : window.ViewContent.ContentName)) &gt;= 0) {
-//						fdiag.FilterIndex = i + 1;
-//						break;
-//					}
-//				}
-			
-			//fdiag.Filter          = String.Join(&quot;|&quot;, fileFilters);
+			using (FileSelection fdiag  = new FileSelection (&quot;Add a file&quot;)) {
 			fdiag.SelectMultiple = true;
-			//fdiag.CheckFileExists = true;
 			
 			int result = fdiag.Run ();
 			try {
@@ -83,8 +70,9 @@
 					}
 				}
 			} finally {
-				fdiag.Destroy ();
+				fdiag.Hide ();
 			}
+			}
 		}
 	}
 	

Modified: trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/ResourceFolderNodeCommands.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/ResourceFolderNodeCommands.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Commands/ProjectBrowserCommands/ResourceFolderNodeCommands.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -42,42 +42,42 @@
 			if (node != null) {
 				IProject project = ((ProjectBrowserNode) node.Parent).Project;
 				
-			show_dialog:
+				show_dialog:
 									
-				Gtk.FileSelection fs = new Gtk.FileSelection (&quot;File to Open&quot;);
-				fs.SelectMultiple = true;
-				fs.Filename = project.BaseDirectory;
-				int response = fs.Run ();
-				string [] files = fs.Selections;
+				using (Gtk.FileSelection fs = new Gtk.FileSelection (&quot;File to Open&quot;)) {
+					fs.SelectMultiple = true;
+					fs.Filename = project.BaseDirectory;
+					int response = fs.Run ();
+					string [] files = fs.Selections;
+					fs.Hide ();
+
+					if (response != (int)Gtk.ResponseType.Ok)
+						return;
 				
-				fs.Destroy ();
-				
-				if (response != (int)Gtk.ResponseType.Ok)
-					return;
-				
-				foreach (string file in files) {
-					if (! File.Exists (file)) {
-						IMessageService messageService = (IMessageService) ServiceManager.Services.GetService (typeof (IMessageService));
-						messageService.ShowError (String.Format (&quot;Resource file `{0}' does not exist&quot;, file));
-						goto show_dialog;
+					foreach (string file in files) {
+						if (! File.Exists (file)) {
+							IMessageService messageService = (IMessageService) ServiceManager.Services.GetService (typeof (IMessageService));
+							messageService.ShowError (String.Format (&quot;Resource file `{0}' does not exist&quot;, file));
+							goto show_dialog;
+						}
 					}
-				}
 				
+					IProjectService projectService = (IProjectService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IProjectService));
+					ResourceService resourceService = (ResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
 				
-				IProjectService projectService = (IProjectService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IProjectService));
-				ResourceService resourceService = (ResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
-				
-				foreach (string fileName in files) {
-					ProjectFile fileInformation = projectService.AddFileToProject(project, fileName, BuildAction.EmbedAsResource);
+					foreach (string fileName in files) {
+						ProjectFile fileInformation = projectService.AddFileToProject(project, fileName, BuildAction.EmbedAsResource);
 					
-					AbstractBrowserNode newResNode = new FileNode(fileInformation);
-					newResNode.Image = Stock.ResourceFileIcon;
-					node.Nodes.Add (newResNode);
+						AbstractBrowserNode newResNode = new FileNode(fileInformation);
+						newResNode.Image = Stock.ResourceFileIcon;
+						node.Nodes.Add (newResNode);
+					}
+
+					node.Expand();
+					projectService.SaveCombine();
 				}
-				node.Expand();
-				projectService.SaveCombine();
 			}
 		}
 	}
-	
 }
+

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions/DeployFileOptions.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions/DeployFileOptions.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/OptionPanels/ProjectOptions/DeployFileOptions.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -94,23 +94,23 @@
 			//FIXME : Finish details in this dialog.
 			void SelectScriptFileEvent(object sender, EventArgs e)
 			{
-				FileSelection fs = new FileSelection (&quot;Select your File&quot;); // Put correct title 
-				fs.Complete(&quot;*.txt&quot;);
-//				 fs.Complete(StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.ExecutableFiles}|*.exe;*.com;*.pif;*.bat;*.cmd|${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;));
-// 				fdiag.Filter = StringParserService.Parse(&quot;${res:SharpDevelop.FileFilter.ExecutableFiles}|*.exe;*.com;*.pif;*.bat;*.cmd|${res:SharpDevelop.FileFilter.AllFiles}|*.*&quot;);
-				if ( fs.Run () == (int) ResponseType.Ok) {
- 					deployScriptEntry.Text = fs.SelectionEntry.Text;
-				}
-				fs.Hide (); 
+				using (FileSelection fs = new FileSelection (&quot;Select your File&quot;)) { // Put correct title 
+					fs.Complete(&quot;*.txt&quot;);
+					if ( fs.Run () == (int) ResponseType.Ok) {
+ 						deployScriptEntry.Text = fs.SelectionEntry.Text;
+					}
+					fs.Hide ();
+				} 
 			}
 			
 			void SelectTargetFolderEvent(object sender, EventArgs e)
 			{
-				FileSelection fs = new FileSelection (&quot;${res:Dialog.Options.PrjOptions.DeployFile.FolderDialogDescription}&quot;); 
-				if ( fs.Run () == (int) ResponseType.Ok) {
-					deployTargetEntry.Text = fs.SelectionEntry.Text;
+				using (FileSelection fs = new FileSelection (&quot;${res:Dialog.Options.PrjOptions.DeployFile.FolderDialogDescription}&quot;)) {
+					if ( fs.Run () == (int) ResponseType.Ok) {
+						deployTargetEntry.Text = fs.SelectionEntry.Text;
+					}
+					fs.Hide ();
 				}
-				fs.Hide (); 
 			}
 			
 			void RadioButtonClicked(object sender, EventArgs e)

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/ReferenceDialog/AssemblyReferencePanel.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/ReferenceDialog/AssemblyReferencePanel.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Dialogs/ReferenceDialog/AssemblyReferencePanel.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -8,10 +8,6 @@
 using System;
 using System.IO;
 using System.Text;
-using System.Drawing;
-using System.Collections;
-using System.ComponentModel;
-using MSjogren.GacTool.FusionNative;
 using MonoDevelop.Internal.Project;
 using MonoDevelop.Core.Services;
 
@@ -37,32 +33,33 @@
 		{
 			// FIXME: il8n the dialog name
 			StringParserService stringParserService = (StringParserService)ServiceManager.Services.GetService(typeof(StringParserService));
-			FileSelection fdiag = new FileSelection(&quot;Find .Net Assembly&quot;);			
+			using (FileSelection fdiag = new FileSelection(&quot;Find .Net Assembly&quot;)) {
 			// FIXME: this should only allow dll's and exe's
-			fdiag.Complete(&quot;*&quot;);
-			fdiag.SelectMultiple = true;
-			int response = fdiag.Run();
-			string[] selectedFiles = new string[fdiag.Selections.Length];
-			fdiag.Selections.CopyTo(selectedFiles, 0);
-			fdiag.Destroy();
+			// fdiag.Complete(&quot;*&quot;);
+				fdiag.SelectMultiple = true;
+				int response = fdiag.Run();
+				string[] selectedFiles = new string[fdiag.Selections.Length];
+				fdiag.Selections.CopyTo(selectedFiles, 0);
+				fdiag.Hide ();
 			
-			if (response == (int) ResponseType.Ok) {
-				foreach (string file in selectedFiles) {
-					bool isAssembly = true;
-					try	{
-						System.Reflection.AssemblyName.GetAssemblyName(System.IO.Path.GetFullPath (file));
-					} catch (Exception assemblyExcep) {
-						isAssembly = false;
-					}
+				if (response == (int) ResponseType.Ok) {
+					foreach (string file in selectedFiles) {
+						bool isAssembly = true;
+						try	{
+							System.Reflection.AssemblyName.GetAssemblyName(System.IO.Path.GetFullPath (file));
+						} catch (Exception assemblyExcep) {
+							isAssembly = false;
+						}
 					
-					if (isAssembly) {
-					selectDialog.AddReference(ReferenceType.Assembly,
-											  System.IO.Path.GetFileName(file),
-											  file);
-					} else {
-						IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
-						// FIXME: il8n this
-						messageService.ShowError(&quot;File &quot; + file + &quot;is not a valid .Net Assembly&quot;);
+						if (isAssembly) {
+						selectDialog.AddReference(ReferenceType.Assembly,
+							System.IO.Path.GetFileName(file),
+							file);
+						} else {
+							IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+							// FIXME: il8n this
+							messageService.ShowError(&quot;File &quot; + file + &quot;is not a valid .Net Assembly&quot;);
+						}
 					}
 				}
 			}
@@ -70,7 +67,7 @@
 		
 		public void AddReference(object sender, EventArgs e)
 		{
-			System.Console.WriteLine(&quot;This panel will contain a file browser, but so long use the browse button :)&quot;);
+			//System.Console.WriteLine(&quot;This panel will contain a file browser, but so long use the browse button :)&quot;);
 		}
 	}
 }

Modified: trunk/MonoDevelop/src/Main/Base/Internal/Project/Combine/Combine.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Internal/Project/Combine/Combine.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Internal/Project/Combine/Combine.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -304,15 +304,17 @@
 		
 		public void SaveCombineAs()
 		{
-			Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save Combine As...&quot;);
-			fdiag.Filename = System.Environment.GetEnvironmentVariable (&quot;HOME&quot;);
-			if (fdiag.Run() == (int)Gtk.ResponseType.Ok) {
-				string filename = fdiag.Filename;
-				SaveCombine(filename);
-				IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
-				messageService.ShowMessage(filename, resourceService.GetString(&quot;Internal.Project.Combine.CombineSavedMessage&quot;));
+			using (Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save Combine As...&quot;)) {
+				fdiag.Filename = System.Environment.GetEnvironmentVariable (&quot;HOME&quot;);
+				if (fdiag.Run() == (int)Gtk.ResponseType.Ok) {
+					string filename = fdiag.Filename;
+					SaveCombine(filename);
+					IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+					messageService.ShowMessage(filename, resourceService.GetString(&quot;Internal.Project.Combine.CombineSavedMessage&quot;));
+				}
+				
+				fdiag.Hide ();
 			}
-			fdiag.Destroy ();
 		}
 
 		public object AddEntry(string filename)

Modified: trunk/MonoDevelop/src/Main/Base/Internal/Project/Project/AbstractProject.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Internal/Project/Project/AbstractProject.cs	2004-03-10 21:19:47 UTC (rev 1140)
+++ trunk/MonoDevelop/src/Main/Base/Internal/Project/Project/AbstractProject.cs	2004-03-11 04:21:09 UTC (rev 1141)
@@ -6,19 +6,17 @@
 // &lt;/file&gt;
 
 using System;
+using System.ComponentModel;
+using System.Diagnostics;
 using System.Globalization;
 using System.IO;
 using System.Collections;
 using System.Collections.Specialized;
-using System.Diagnostics;
 using System.Reflection;
-using System.ComponentModel;
 using System.Xml;
 
 using MonoDevelop.Core.Properties;
-
 using MonoDevelop.Core.AddIns;
-
 using MonoDevelop.Internal.Project.Collections;
 using MonoDevelop.Internal.Project;
 using MonoDevelop.Core.Services;
@@ -27,8 +25,6 @@
 
 namespace MonoDevelop.Internal.Project
 {
-	
-	
 	/// &lt;summary&gt;
 	/// External language bindings must extend this class
 	/// &lt;/summary&gt;
@@ -511,19 +507,21 @@
 		
 		public void SaveProjectAs()
 		{
-			Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save Project As...&quot;);
-			fdiag.Filename = System.Environment.GetEnvironmentVariable (&quot;HOME&quot;);
+			using (Gtk.FileSelection fdiag = new Gtk.FileSelection (&quot;Save Project As...&quot;)) {
+				fdiag.Filename = System.Environment.GetEnvironmentVariable (&quot;HOME&quot;);
 
-			if (fdiag.Run() == (int)Gtk.ResponseType.Ok) {
-				string filename = fdiag.Filename;
-				SaveProject(filename);
-				IResourceService resourceService = (IResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
-				IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
-				messageService.ShowMessage(filename, resourceService.GetString(&quot;Internal.Project.DefaultProject.ProjectSavedMessage&quot;));
+				if (fdiag.Run() == (int)Gtk.ResponseType.Ok) {
+					string filename = fdiag.Filename;
+					SaveProject(filename);
+					IResourceService resourceService = (IResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
+					IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+					messageService.ShowMessage(filename, resourceService.GetString(&quot;Internal.Project.DefaultProject.ProjectSavedMessage&quot;));
+				}
+				
+				fdiag.Hide ();
 			}
-			fdiag.Destroy ();
 		}
-		
+
 		public void CopyReferencesToOutputPath(bool force)
 		{
 			AbstractProjectConfiguration config = ActiveConfiguration as AbstractProjectConfiguration;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000777.html">[Monodevelop-patches-list] ASP.net Project Template
</A></li>
	<LI>Next message: <A HREF="000748.html">[Monodevelop-patches-list] r1142 - in trunk/MonoDevelop: data/resources/glade src/Main/Base/Gui/Dialogs/OptionPanels/IDEOptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#747">[ date ]</a>
              <a href="thread.html#747">[ thread ]</a>
              <a href="subject.html#747">[ subject ]</a>
              <a href="author.html#747">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
