<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r1199 - in trunk/MonoDevelop: . src/Libraries/MonoDevelop.Core/Services src/Main/Base/Commands src/Main/Base/Services
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1199%20-%20in%20trunk/MonoDevelop%3A%20.%20src/Libraries/MonoDevelop.Core/Services%20src/Main/Base/Commands%20src/Main/Base/Services&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000805.html">
   <LINK REL="Next"  HREF="000807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r1199 - in trunk/MonoDevelop: . src/Libraries/MonoDevelop.Core/Services src/Main/Base/Commands src/Main/Base/Services</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1199%20-%20in%20trunk/MonoDevelop%3A%20.%20src/Libraries/MonoDevelop.Core/Services%20src/Main/Base/Commands%20src/Main/Base/Services&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r1199 - in trunk/MonoDevelop: . src/Libraries/MonoDevelop.Core/Services src/Main/Base/Commands src/Main/Base/Services">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Fri Mar 19 23:28:51 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000805.html">[Monodevelop-patches-list] r1198 - in trunk/MonoDevelop/src/Main/Base: . Gui/Dialogs Gui/HtmlControl
</A></li>
        <LI>Next message: <A HREF="000807.html">[Monodevelop-patches-list] r1200 - in trunk/MonoDevelop: . build/AddIns data/resources/glade gdldock/gdl src/Main/Base src/Main/Base/Commands src/Main/Base/Gui src/Main/Base/Gui/Dialogs src/Main/Base/Gui/Workbench/Layouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#806">[ date ]</a>
              <a href="thread.html#806">[ thread ]</a>
              <a href="subject.html#806">[ subject ]</a>
              <a href="author.html#806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jba
Date: 2004-03-19 23:28:51 -0500 (Fri, 19 Mar 2004)
New Revision: 1199

Modified:
   trunk/MonoDevelop/ChangeLog
   trunk/MonoDevelop/src/Libraries/MonoDevelop.Core/Services/IMessageService.cs
   trunk/MonoDevelop/src/Main/Base/Commands/MenuItemBuilders.cs
   trunk/MonoDevelop/src/Main/Base/Services/MessageService.cs
Log:
last parts of bugfix for #53311 - tools prompt on launch for args, if set in options

Modified: trunk/MonoDevelop/ChangeLog
===================================================================
--- trunk/MonoDevelop/ChangeLog	2004-03-20 01:17:52 UTC (rev 1198)
+++ trunk/MonoDevelop/ChangeLog	2004-03-20 04:28:51 UTC (rev 1199)
@@ -1,3 +1,12 @@
+2004-03-20	John BouAntoun  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jba-mono at optusnet.com.au</A>&gt;
+
+	* src/Main/Base/Commands/MenuItemBuilders.cs : made it prompt 
+	user for launching exteranl tool if set in options
+	* src/Main/Base/Services/MessageService.cs: added generic 
+	text prompting dialog, GetTextResponse() for above change:
+	* src/Libraries/MonoDevelop.Core/Services/IMessageService.cs: 
+	added prototype for GetTextResponse() for above change:
+
 2004-03-19  John Luke  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jluke at cfl.rr.com</A>&gt;
 
 	* src/Main/Base/Gui/IProgressMonitor.cs:

Modified: trunk/MonoDevelop/src/Libraries/MonoDevelop.Core/Services/IMessageService.cs
===================================================================
--- trunk/MonoDevelop/src/Libraries/MonoDevelop.Core/Services/IMessageService.cs	2004-03-20 01:17:52 UTC (rev 1198)
+++ trunk/MonoDevelop/src/Libraries/MonoDevelop.Core/Services/IMessageService.cs	2004-03-20 04:28:51 UTC (rev 1199)
@@ -49,5 +49,9 @@
 		bool AskQuestionFormatted(string formatstring, params string[] formatitems);
 		bool AskQuestion(string question, string caption);
 		bool AskQuestionFormatted(string caption, string formatstring, params string[] formatitems);
+		
+		// used to return text input from a user in response to a question
+		string GetTextResponse(string question, string caption, string initialValue);
+		string GetTextResponse(string question, string caption);
 	}
 }

Modified: trunk/MonoDevelop/src/Main/Base/Commands/MenuItemBuilders.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Commands/MenuItemBuilders.cs	2004-03-20 01:17:52 UTC (rev 1198)
+++ trunk/MonoDevelop/src/Main/Base/Commands/MenuItemBuilders.cs	2004-03-20 04:28:51 UTC (rev 1199)
@@ -130,14 +130,34 @@
 			IProjectService projectService = (IProjectService)MonoDevelop.Core.Services.ServiceManager.Services.GetService(typeof(IProjectService));
 			StringParserService stringParserService = (StringParserService)ServiceManager.Services.GetService(typeof(StringParserService));
 			FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
+			MessageService messageService =(MessageService)ServiceManager.Services.GetService(typeof(MessageService));
 			
 			for (int i = 0; i &lt; ToolLoader.Tool.Count; ++i) {
 				if (item.Text == ToolLoader.Tool[i].ToString()) {
+					
 					ExternalTool tool = (ExternalTool)ToolLoader.Tool[i];
+					// set the command
 					string command = tool.Command;
-					string args    = stringParserService.Parse(tool.Arguments);
+					// set the args
+					string args = stringParserService.Parse(tool.Arguments);
+					// prompt for args if needed
+					if (tool.PromptForArguments) {
+						args = messageService.GetTextResponse(
+							&quot;Enter any arguments you want to use while launching tool, &quot; + tool.MenuCommand + &quot;:&quot;,
+							&quot;Command Arguments for &quot; + tool.MenuCommand,
+							args);
+							
+						// if user selected cancel string will be null
+						if (args == null) {
+							args = stringParserService.Parse(tool.Arguments);
+						}
+					}
+					
+					// debug command and args
 					Console.WriteLine(&quot;command : &quot; + command);
 					Console.WriteLine(&quot;args    : &quot; + args);
+					
+					// create the process
 					try {
 						ProcessStartInfo startinfo;
 						if (args == null || args.Length == 0) {
@@ -148,12 +168,10 @@
 						
 						startinfo.WorkingDirectory = stringParserService.Parse(tool.InitialDirectory);
 						
-						// FIXME: need to find a way to prompt for the user arguments						
 						// FIXME: need to find a way to wire the console output into the output window if specified
 						Process.Start(startinfo);
 						
-					} catch (Exception ex) {
-						IMessageService messageService =(IMessageService)ServiceManager.Services.GetService(typeof(IMessageService));
+					} catch (Exception ex) {						
 						messageService.ShowError(ex, &quot;External program execution failed.\nError while starting:\n '&quot; + command + &quot; &quot; + args + &quot;'&quot;);
 					}
 						break;

Modified: trunk/MonoDevelop/src/Main/Base/Services/MessageService.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Services/MessageService.cs	2004-03-20 01:17:52 UTC (rev 1198)
+++ trunk/MonoDevelop/src/Main/Base/Services/MessageService.cs	2004-03-20 04:28:51 UTC (rev 1199)
@@ -127,5 +127,47 @@
 				md.Hide ();
 			}
 		}
+		
+		// call this method to show a dialog and get a response value
+		// returns null if cancel is selected
+		public string GetTextResponse(string question, string caption, string initialValue)
+		{
+			string returnValue = null;
+			
+			using (Gtk.Dialog md = new Gtk.Dialog (caption, (Gtk.Window) WorkbenchSingleton.Workbench, Gtk.DialogFlags.Modal | Gtk.DialogFlags.DestroyWithParent)) {
+				// add a label with the question
+				Gtk.Label questionLabel = new Gtk.Label(question);
+				questionLabel.UseMarkup = true;
+				questionLabel.Xalign = 0.0F;
+				md.VBox.PackStart(questionLabel, true, false, 6);
+				
+				// add an entry with initialValue
+				Gtk.Entry responseEntry = (initialValue != null) ? new Gtk.Entry(initialValue) : new Gtk.Entry();
+				md.VBox.PackStart(responseEntry, false, true, 6);
+				
+				// add action widgets
+				md.AddActionWidget(new Gtk.Button(Gtk.Stock.Cancel), Gtk.ResponseType.Cancel);
+				md.AddActionWidget(new Gtk.Button(Gtk.Stock.Ok), Gtk.ResponseType.Ok);
+				
+				md.VBox.ShowAll();
+				md.ActionArea.ShowAll();
+				md.HasSeparator = false;
+				md.BorderWidth = 6;
+				
+				int response = md.Run ();
+				md.Hide ();
+				
+				if ((Gtk.ResponseType) response == Gtk.ResponseType.Ok) {
+					returnValue =  responseEntry.Text;
+				}
+			}
+			
+			return returnValue;
+		}
+		
+		public string GetTextResponse(string question, string caption)
+		{
+			return GetTextResponse(question, caption, string.Empty);
+		}
 	}
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000805.html">[Monodevelop-patches-list] r1198 - in trunk/MonoDevelop/src/Main/Base: . Gui/Dialogs Gui/HtmlControl
</A></li>
	<LI>Next message: <A HREF="000807.html">[Monodevelop-patches-list] r1200 - in trunk/MonoDevelop: . build/AddIns data/resources/glade gdldock/gdl src/Main/Base src/Main/Base/Commands src/Main/Base/Gui src/Main/Base/Gui/Dialogs src/Main/Base/Gui/Workbench/Layouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#806">[ date ]</a>
              <a href="thread.html#806">[ thread ]</a>
              <a href="subject.html#806">[ subject ]</a>
              <a href="author.html#806">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
