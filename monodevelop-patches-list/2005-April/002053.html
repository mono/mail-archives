<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2452 - trunk/MonoDevelop/Extras/MonoDeveloperExtensions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2452%20-%20trunk/MonoDevelop/Extras/MonoDeveloperExtensions&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002052.html">
   <LINK REL="Next"  HREF="002054.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2452 - trunk/MonoDevelop/Extras/MonoDeveloperExtensions</H1>
    <B>Lluis Sanchez &lt;lluis@ximian.com&gt;</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2452%20-%20trunk/MonoDevelop/Extras/MonoDeveloperExtensions&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2452 - trunk/MonoDevelop/Extras/MonoDeveloperExtensions">lluis at mono-cvs.ximian.com
       </A><BR>
    <I>Thu Apr 14 07:02:29 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002052.html">[Monodevelop-patches-list] r2451 - in trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Internal/ProgressMonitoring
</A></li>
        <LI>Next message: <A HREF="002054.html">[Monodevelop-patches-list] r2453 - in trunk/MonoDevelop: . contrib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2053">[ date ]</a>
              <a href="thread.html#2053">[ thread ]</a>
              <a href="subject.html#2053">[ subject ]</a>
              <a href="author.html#2053">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: lluis
Date: 2005-04-14 07:02:28 -0400 (Thu, 14 Apr 2005)
New Revision: 2452

Modified:
   trunk/MonoDevelop/Extras/MonoDeveloperExtensions/ChangeLog
   trunk/MonoDevelop/Extras/MonoDeveloperExtensions/MonoProject.cs
Log:
2005-04-07  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;

	* MonoProject.cs: Look for ChangeLog files in a more rational 
	(and faster) way.



Modified: trunk/MonoDevelop/Extras/MonoDeveloperExtensions/ChangeLog
===================================================================
--- trunk/MonoDevelop/Extras/MonoDeveloperExtensions/ChangeLog	2005-04-13 23:39:57 UTC (rev 2451)
+++ trunk/MonoDevelop/Extras/MonoDeveloperExtensions/ChangeLog	2005-04-14 11:02:28 UTC (rev 2452)
@@ -1,3 +1,8 @@
+2005-04-07  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;
+
+	* MonoProject.cs: Look for ChangeLog files in a more rational 
+	(and faster) way.
+
 2005-05-07  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;
 
 	* MonoProject.cs: Update the sources file when files are renamed.

Modified: trunk/MonoDevelop/Extras/MonoDeveloperExtensions/MonoProject.cs
===================================================================
--- trunk/MonoDevelop/Extras/MonoDeveloperExtensions/MonoProject.cs	2005-04-13 23:39:57 UTC (rev 2451)
+++ trunk/MonoDevelop/Extras/MonoDeveloperExtensions/MonoProject.cs	2005-04-14 11:02:28 UTC (rev 2452)
@@ -75,22 +75,30 @@
 			outFile = Path.Combine (basePath, aname);
 			FileName = mkfile.FileName;
 			
+			ArrayList checkedFolders = new ArrayList ();
+			
 			// Parse projects
 			string sources = outFile + &quot;.sources&quot;;
 			StreamReader sr = new StreamReader (sources);
 			string line;
 			while ((line = sr.ReadLine ()) != null) {
 				line = line.Trim (' ','\t');
-				if (line != &quot;&quot;) ProjectFiles.Add (new ProjectFile (Path.Combine (basePath, line)));
+				if (line != &quot;&quot;) {
+					string fname = Path.Combine (basePath, line);
+					ProjectFiles.Add (new ProjectFile (fname));
+					
+					string dir = Path.GetDirectoryName (fname);
+					if (!checkedFolders.Contains (dir)) {
+						checkedFolders.Add (dir);
+						fname = Path.Combine (dir, &quot;ChangeLog&quot;);
+						if (File.Exists (fname))
+							ProjectFiles.Add (new ProjectFile (fname, BuildAction.Exclude));
+					}
+				}
 			}
 			
 			sr.Close ();
 			
-/*			ArrayList files = new ArrayList ();
-			FindFiles (basePath, &quot;ChangeLog&quot;, files);
-			foreach (string file in files)
-				ProjectFiles.Add (new ProjectFile (file, BuildAction.Exclude));
-*/			
 			// Project references
 			string refs = mkfile.GetVariable (&quot;LIB_MCS_FLAGS&quot;);
 			if (refs == null || refs == &quot;&quot;) refs = mkfile.GetVariable (&quot;LOCAL_MCS_FLAGS&quot;);
@@ -123,13 +131,6 @@
 			Runtime.ProjectService.CombineOpened += new CombineEventHandler (CombineOpened);
 		}
 		
-		void FindFiles (string path, string name, ArrayList files)
-		{
-			files.AddRange (Directory.GetFiles (path, name));
-			foreach (string sd in Directory.GetDirectories (path))
-				FindFiles (sd, name, files);
-		}
-		
 		static Regex regexError = new Regex (@&quot;^(\s*(?&lt;file&gt;.*)\((?&lt;line&gt;\d*)(,(?&lt;column&gt;\d*))?\)\s+)*(?&lt;level&gt;\w+)\s*(?&lt;number&gt;.*):\s(?&lt;message&gt;.*)&quot;,
 				RegexOptions.Compiled | RegexOptions.ExplicitCapture);
 				


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002052.html">[Monodevelop-patches-list] r2451 - in trunk/MonoDevelop/Core/src/MonoDevelop.Base: . Internal/ProgressMonitoring
</A></li>
	<LI>Next message: <A HREF="002054.html">[Monodevelop-patches-list] r2453 - in trunk/MonoDevelop: . contrib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2053">[ date ]</a>
              <a href="thread.html#2053">[ thread ]</a>
              <a href="subject.html#2053">[ subject ]</a>
              <a href="author.html#2053">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
