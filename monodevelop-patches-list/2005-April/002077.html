<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r2476 - trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2476%20-%20trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002076.html">
   <LINK REL="Next"  HREF="002078.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r2476 - trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn</H1>
    <B>Lluis Sanchez &lt;lluis@ximian.com&gt;</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r2476%20-%20trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r2476 - trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn">lluis at mono-cvs.ximian.com
       </A><BR>
    <I>Mon Apr 25 16:36:07 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002076.html">[Monodevelop-patches-list] r2475 - in trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor: . Commands Gui Services
</A></li>
        <LI>Next message: <A HREF="002078.html">[Monodevelop-patches-list] r2477 - trunk/MonoDevelop/Core/src/AddIns/prj2make-sharp-lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2077">[ date ]</a>
              <a href="thread.html#2077">[ thread ]</a>
              <a href="subject.html#2077">[ subject ]</a>
              <a href="author.html#2077">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: lluis
Date: 2005-04-25 16:36:07 -0400 (Mon, 25 Apr 2005)
New Revision: 2476

Modified:
   trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/ChangeLog
   trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggerCommands.cs
   trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggingService.cs
   trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/Makefile.am
   trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/MonoDevelopDebugger.addin.xml
Log:
2005-04-25  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;

	* DebuggingService.cs: Dispose the output pad when the debug session
	ends. The Run method now takes a progress monitor and will stop if
	the monitor notifies a cancel request. The Run method is now also
	responsible of creating the output pad.
	
	* DebuggerCommands.cs:
	* MonoDevelopDebugger.addin.xml: Use the new syntax for defining
	commands. The DebugProject and DebugKillApplication commands have
	been moved to MonoDevelop.Base since may they be reused by other addins.



Modified: trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/ChangeLog
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/ChangeLog	2005-04-25 20:35:47 UTC (rev 2475)
+++ trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/ChangeLog	2005-04-25 20:36:07 UTC (rev 2476)
@@ -1,3 +1,15 @@
+2005-04-25  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">lluis at novell.com</A>&gt;
+
+	* DebuggingService.cs: Dispose the output pad when the debug session
+	ends. The Run method now takes a progress monitor and will stop if
+	the monitor notifies a cancel request. The Run method is now also
+	responsible of creating the output pad.
+	
+	* DebuggerCommands.cs:
+	* MonoDevelopDebugger.addin.xml: Use the new syntax for defining
+	commands. The DebugProject and DebugKillApplication commands have
+	been moved to MonoDevelop.Base since may they be reused by other addins.
+
 2005-04-19  Chris Toshok  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">toshok at ximian.com</A>&gt;
 
 	* Visualizers/TargetObjectProvider.cs: remove unnecessary using

Modified: trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggerCommands.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggerCommands.cs	2005-04-25 20:35:47 UTC (rev 2475)
+++ trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggerCommands.cs	2005-04-25 20:36:07 UTC (rev 2476)
@@ -3,65 +3,60 @@
 using MonoDevelop.Core.AddIns.Codons;
 using MonoDevelop.Services;
 using MonoDevelop.Core.Services;
+using MonoDevelop.Commands;
 
-namespace MonoDevelop.Debugger.Commands
+
+namespace MonoDevelop.Debugger
 {
+	public enum DebugCommands
+	{
+		ToggleRunning,
+		StepOver,
+		StepInto
+	}
+}
 
-	public class ToggleRunning : AbstractMenuCommand
+namespace MonoDevelop.Debugger.Commands
+{
+	public class ToggleRunning : CommandHandler
 	{
-		public override void Run ()
+		protected override void Run ()
 		{
 			if (Runtime.DebuggingService.IsRunning)
 				Runtime.DebuggingService.Pause ();
 			else
 				Runtime.DebuggingService.Resume ();
 		}
-	}
-
-	public class KillApplication : AbstractMenuCommand
-	{
-		public override void Run ()
+		
+		protected override void Update (CommandInfo info)
 		{
-			Runtime.DebuggingService.Stop();
+			info.Enabled = ((DebuggingService)Runtime.DebuggingService).Debugging;
 		}
 	}
 
-	public class StepOver : AbstractMenuCommand
+	public class StepOver : CommandHandler
 	{
-		public override void Run ()
+		protected override void Run ()
 		{
 			Runtime.DebuggingService.StepOver();
 		}
+		
+		protected override void Update (CommandInfo info)
+		{
+			info.Enabled = ((DebuggingService)Runtime.DebuggingService).Debugging;
+		}
 	}
 
-	public class StepInto : AbstractMenuCommand
+	public class StepInto : CommandHandler
 	{
-		public override void Run ()
+		protected override void Run ()
 		{
 			Runtime.DebuggingService.StepInto();
 		}
-	}
-
-	public class DebugProject : AbstractMenuCommand
-	{
-
-		public override void Run ()
+		
+		protected override void Update (CommandInfo info)
 		{
-			DebuggingService dbgr = (DebuggingService)Runtime.DebuggingService;
-			
-			if (Runtime.ProjectService.CurrentOpenCombine != null) {
-				if (Runtime.ProjectService.NeedsCompiling) {
-					Runtime.ProjectService.BuildActiveCombine ().WaitForCompleted ();
-				}
-#if NET_2_0
-				dbgr.AttributeHandler.Rescan();
-#endif
-
-				Runtime.ProjectService.CurrentOpenCombine.Debug (dbgr.DebugProgressMonitor);
-			}
-
+			info.Enabled = ((DebuggingService)Runtime.DebuggingService).Debugging;
 		}
-
 	}
-
 }

Modified: trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggingService.cs
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggingService.cs	2005-04-25 20:35:47 UTC (rev 2475)
+++ trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/DebuggingService.cs	2005-04-25 20:36:07 UTC (rev 2476)
@@ -54,6 +54,7 @@
 				StoppedEvent (this, new EventArgs ());
 			backend.Dispose ();
 			backend = null;
+			current_monitor.Dispose ();
 			current_monitor = null;
 #if NET_2_0
 			attr_handler = null;
@@ -75,19 +76,17 @@
 		}
 #endif
 
-		public IProgressMonitor DebugProgressMonitor {
-			get {
-				if (current_monitor != null)
-					return current_monitor;
+		public void CreateDebugConsole ()
+		{
+			if (current_monitor != null)
+				return;
 
-				current_monitor = Runtime.TaskService.GetOutputProgressMonitor (&quot;Debug Output&quot;,
-									MonoDevelop.Gui.Stock.OutputIcon,
-									true, true);
-				return current_monitor;
-			}
-                }
+			current_monitor = Runtime.TaskService.GetOutputProgressMonitor (&quot;Debug Output&quot;,
+								MonoDevelop.Gui.Stock.OutputIcon,
+								true, true);
+		}
 
-		private bool Debugging {
+		public bool Debugging {
 			get {
 				return backend != null &amp;&amp; proc != null &amp;&amp; proc.HasTarget;
 			}
@@ -299,17 +298,29 @@
 			proc.Continue (false);
 		}
 
-		public void Run (string[] argv)
+		public void Run (IProgressMonitor monitor, string[] argv)
 		{
 			if (Debugging)
 				return;
 
+#if NET_2_0
+			AttributeHandler.Rescan();
+#endif
+			CreateDebugConsole ();
+
 			backend = new DebuggerBackend ();
 			backend.ThreadManager.InitializedEvent += new ThreadEventHandler (initialized_event);
 			backend.ThreadManager.ThreadCreatedEvent += new ThreadEventHandler (thread_created);
 			backend.ThreadManager.ThreadExitedEvent += new ThreadEventHandler (thread_exited);
 			backend.Run (new ProcessStart (null, argv));
+			
+			monitor.CancelRequested += new MonitorHandler (OnCancelRequested);
 		}
+		
+		void OnCancelRequested (IProgressMonitor monitor)
+		{
+			Stop ();
+		}
 
 		public void Stop ()
 		{

Modified: trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/Makefile.am
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/Makefile.am	2005-04-25 20:35:47 UTC (rev 2475)
+++ trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/Makefile.am	2005-04-25 20:36:07 UTC (rev 2476)
@@ -6,6 +6,7 @@
 DLLS = $(GTK_SHARP_LIBS) \
 	$(MONO_DEBUGGER_LIBS) \
 	/r:$(top_builddir)/build/bin/MonoDevelop.Base.dll \
+	/r:$(top_builddir)/build/bin/MonoDevelop.Gui.Widgets.dll \
 	/r:$(top_builddir)/build/bin/MonoDevelop.Core.dll \
         /r:$(top_builddir)/build/bin/ICSharpCode.SharpRefactory.dll
 

Modified: trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/MonoDevelopDebugger.addin.xml
===================================================================
--- trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/MonoDevelopDebugger.addin.xml	2005-04-25 20:35:47 UTC (rev 2475)
+++ trunk/MonoDevelop/Core/src/AddIns/DebuggerAddIn/MonoDevelopDebugger.addin.xml	2005-04-25 20:36:07 UTC (rev 2476)
@@ -26,39 +26,30 @@
 		&lt;ContextPad id = &quot;MonoDevelop.Debugger.ThreadPad&quot; /&gt;
 	&lt;/Extension&gt;
 
-	&lt;Extension path=&quot;/SharpDevelop/Workbench/MainMenu/Run&quot;&gt;
-		&lt;MenuItem id = &quot;DebugProject&quot;
-		          _label = &quot;Debug Project&quot;
-		          insertafter = &quot;Run&quot;
-		          shortcut = &quot;Control|F5&quot;
-		          class = &quot;MonoDevelop.Debugger.Commands.DebugProject&quot;/&gt;
-	&lt;/Extension&gt;
-
-	&lt;Extension path=&quot;/SharpDevelop/Workbench/MainMenu&quot;&gt;
-		&lt;Conditional action = &quot;Exclude&quot; context = &quot;Debug&quot;&gt;
-			&lt;MenuItem id = &quot;DebugMenuThing&quot; _label = &quot;Debug&quot; insertafter = &quot;View&quot; insertbefore = &quot;Tools&quot;&gt;
-					&lt;MenuItem id = &quot;ToggleRunning&quot;
-						  _label = &quot;Pause/Resume&quot;
-						  shortcut = &quot;Control|F8&quot;
-						  class = &quot;MonoDevelop.Debugger.Commands.ToggleRunning&quot;/&gt;
-	
-					&lt;MenuItem id = &quot;DebugKillApplication&quot;
-						  _label = &quot;Kill Application&quot;
-						  class = &quot;MonoDevelop.Debugger.Commands.KillApplication&quot;/&gt;
+	&lt;Extension path = &quot;/SharpDevelop/Commands&quot;&gt;
+		&lt;Command id = &quot;MonoDevelop.Debugger.DebugCommands.ToggleRunning&quot;
+				defaultHandler = &quot;MonoDevelop.Debugger.Commands.ToggleRunning&quot;
+				_label = &quot;Pause/Resume&quot;
+				shortcut = &quot;Control|F8&quot; /&gt;
 		
-					&lt;MenuItem id = &quot;DebugSep1&quot; _label = &quot;-&quot; /&gt;
+		&lt;Command id = &quot;MonoDevelop.Debugger.DebugCommands.StepOver&quot;
+				defaultHandler = &quot;MonoDevelop.Debugger.Commands.StepOver&quot;
+				_label = &quot;Step Over&quot;
+				shortcut = &quot;F11&quot; /&gt;
 		
-					&lt;MenuItem id = &quot;DebugStepOver&quot;
-						  _label = &quot;Step Over&quot;
-					          shortcut = &quot;F11&quot;
-						  class = &quot;MonoDevelop.Debugger.Commands.StepOver&quot;/&gt;
-		
-					&lt;MenuItem id = &quot;DebugStepInto&quot;
-					          _label = &quot;Step Into&quot;
-					          shortcut = &quot;Control|F11&quot;
-					          class = &quot;MonoDevelop.Debugger.Commands.StepInto&quot;/&gt;
-			&lt;/MenuItem&gt;
-		&lt;/Conditional&gt;
+		&lt;Command id = &quot;MonoDevelop.Debugger.DebugCommands.StepInto&quot;
+				defaultHandler = &quot;MonoDevelop.Debugger.Commands.StepInto&quot;
+				_label = &quot;Step Into&quot;
+				shortcut = &quot;Control|F11&quot; /&gt;
 	&lt;/Extension&gt;
+	
+
+
+	&lt;Extension path=&quot;/SharpDevelop/Workbench/MainMenu/Run&quot;&gt;
+		&lt;CommandItem id = &quot;MonoDevelop.Debugger.DebugCommands.ToggleRunning&quot; insertafter=&quot;MonoDevelop.Commands.ProjectCommands.Stop&quot;/&gt;
+		&lt;SeparatorItem id = &quot;DebugSep1&quot; /&gt;
+		&lt;CommandItem id = &quot;MonoDevelop.Debugger.DebugCommands.StepOver&quot; /&gt;
+		&lt;CommandItem id = &quot;MonoDevelop.Debugger.DebugCommands.StepInto&quot; /&gt;
+	&lt;/Extension&gt;
 &lt;/AddIn&gt;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002076.html">[Monodevelop-patches-list] r2475 - in trunk/MonoDevelop/Core/src/AddIns/DisplayBindings/SourceEditor: . Commands Gui Services
</A></li>
	<LI>Next message: <A HREF="002078.html">[Monodevelop-patches-list] r2477 - trunk/MonoDevelop/Core/src/AddIns/prj2make-sharp-lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2077">[ date ]</a>
              <a href="thread.html#2077">[ thread ]</a>
              <a href="subject.html#2077">[ subject ]</a>
              <a href="author.html#2077">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
