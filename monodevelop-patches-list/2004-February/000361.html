<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r756 - in trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search: SearchStrategy TextIterator
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r756%20-%20in%20trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search%3A%20SearchStrategy%20TextIterator&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000360.html">
   <LINK REL="Next"  HREF="000362.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r756 - in trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search: SearchStrategy TextIterator</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r756%20-%20in%20trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search%3A%20SearchStrategy%20TextIterator&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r756 - in trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search: SearchStrategy TextIterator">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Mon Feb  2 18:21:20 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000360.html">[Monodevelop-patches-list] r755 - trunk/MonoDevelop/data/resources/glade
</A></li>
        <LI>Next message: <A HREF="000362.html">[Monodevelop-patches-list] r757 - in trunk/MonoDevelop/src/AddIns/DisplayBindings: EditorBindings EditorBindings/Search EditorBindings/Search/SearchStrategy EditorBindings/Search/TextIterator TextEditor TextEditor/Gui/Dialogs TextEditor/Search TextEditor/Search/TextIterator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#361">[ date ]</a>
              <a href="thread.html#361">[ thread ]</a>
              <a href="subject.html#361">[ subject ]</a>
              <a href="author.html#361">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: benm
Date: 2004-02-02 18:21:20 -0500 (Mon, 02 Feb 2004)
New Revision: 756

Modified:
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/BruteForceSearchStrategy.cs
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/KMPSearchStrategy.cs
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/RegExSearchStrategy.cs
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/WildcardSearchStrategy.cs
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ForwardTextIterator.cs
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ITextIterator.cs
Log:
refactorize

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/BruteForceSearchStrategy.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/BruteForceSearchStrategy.cs	2004-02-02 19:40:02 UTC (rev 755)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/BruteForceSearchStrategy.cs	2004-02-02 23:21:20 UTC (rev 756)
@@ -19,38 +19,32 @@
 	{
 		string searchPattern;
 		
-		bool MatchCaseSensitive(ITextBufferStrategy document, int offset, string pattern)
+		bool MatchCaseSensitive(ITextIterator iter, int offset, string pattern)
 		{
 			for (int i = 0; i &lt; pattern.Length; ++i) {
-				if (offset + i &gt;= document.Length || document.GetCharAt(offset + i) != pattern[i]) {
+				if (offset + i &gt;= iter.Length || iter.GetCharAt(offset + i) != pattern[i]) {
 					return false;
 				}
 			}
 			return true;
 		}
 		
-		bool MatchCaseInsensitive(ITextBufferStrategy document, int offset, string pattern)
+		bool MatchCaseInsensitive(ITextIterator iter, int offset, string pattern)
 		{
 			for (int i = 0; i &lt; pattern.Length; ++i) {
-				if (offset + i &gt;= document.Length || Char.ToUpper(document.GetCharAt(offset + i)) != pattern[i]) {
+				if (offset + i &gt;= iter.Length || Char.ToUpper(iter.GetCharAt(offset + i)) != pattern[i]) {
 					return false;
 				}
 			}
 			return true;
 		}
 		
-		bool IsWholeWordAt(ITextBufferStrategy document, int offset, int length)
-		{
-			return (offset - 1 &lt; 0 || Char.IsWhiteSpace(document.GetCharAt(offset - 1))) &amp;&amp;
-			       (offset + length + 1 &gt;= document.Length || Char.IsWhiteSpace(document.GetCharAt(offset + length)));
-		}
-		
 		int InternalFindNext(ITextIterator textIterator, SearchOptions options)
 		{
 			while (textIterator.MoveAhead(1)) {
-				if (options.IgnoreCase ? MatchCaseInsensitive(textIterator.TextBuffer, textIterator.Position, searchPattern) :
-				                         MatchCaseSensitive(textIterator.TextBuffer, textIterator.Position, searchPattern)) {
-					if (!options.SearchWholeWordOnly || IsWholeWordAt(textIterator.TextBuffer, textIterator.Position, searchPattern.Length)) {
+				if (options.IgnoreCase ? MatchCaseInsensitive(textIterator, textIterator.Position, searchPattern) :
+				                         MatchCaseSensitive(textIterator, textIterator.Position, searchPattern)) {
+					if (!options.SearchWholeWordOnly || textIterator.IsWholeWordAt (textIterator.Position, searchPattern.Length)) {
 						return textIterator.Position;
 					}
 				}

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/KMPSearchStrategy.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/KMPSearchStrategy.cs	2004-02-02 19:40:02 UTC (rev 755)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/KMPSearchStrategy.cs	2004-02-02 23:21:20 UTC (rev 756)
@@ -53,7 +53,7 @@
 					j = overlap[j];
 				}
 				if (++j &gt;= searchPattern.Length) {
-					if ((!options.SearchWholeWordOnly || SearchReplaceUtilities.IsWholeWordAt(textIterator.TextBuffer, textIterator.Position, searchPattern.Length))) {
+					if ((!options.SearchWholeWordOnly || textIterator.IsWholeWordAt (textIterator.Position, searchPattern.Length))) {
 						return textIterator.Position;
 					}
 					if (!textIterator.MoveAhead(j - overlap[j])) {
@@ -68,7 +68,7 @@
 		{
 			int offset = InternalFindNext(textIterator, options);
 			
-			if (offset + searchPattern.Length &gt;= textIterator.TextBuffer.Length) {
+			if (offset + searchPattern.Length &gt;= textIterator.Length) {
 				return FindNext(textIterator, options);
 			}
 			

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/RegExSearchStrategy.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/RegExSearchStrategy.cs	2004-02-02 19:40:02 UTC (rev 755)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/RegExSearchStrategy.cs	2004-02-02 23:21:20 UTC (rev 756)
@@ -28,7 +28,7 @@
 		
 		public ISearchResult FindNext(ITextIterator textIterator, SearchOptions options)
 		{
-			string document = textIterator.TextBuffer.GetText(0, textIterator.TextBuffer.Length);
+			string document = textIterator.FullDocumentText;
 			
 			while (textIterator.MoveAhead(1)) {
 				Match m = regex.Match(document, textIterator.Position);

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/WildcardSearchStrategy.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/WildcardSearchStrategy.cs	2004-02-02 19:40:02 UTC (rev 755)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/SearchStrategy/WildcardSearchStrategy.cs	2004-02-02 23:21:20 UTC (rev 756)
@@ -82,7 +82,7 @@
 			}
 		}
 		
-		bool Match(ITextBufferStrategy document, 
+		bool Match(ITextIterator iter, 
 		           int  offset, 
 		           bool ignoreCase,
 		           int  programStart)
@@ -91,11 +91,11 @@
 			curMatchEndOffset = -1;
 			
 			for (int pc = programStart; pc &lt; patternProgram.Count; ++pc) {
-				if (curOffset &gt;= document.Length) {
+				if (curOffset &gt;= iter.Length) {
 					return false;
 				}
 				
-				char    ch  = ignoreCase ? Char.ToUpper(document.GetCharAt(curOffset)) : document.GetCharAt(curOffset);
+				char    ch  = ignoreCase ? Char.ToUpper(iter.GetCharAt(curOffset)) : iter.GetCharAt(curOffset);
 				Command cmd = (Command)patternProgram[pc];
 				
 				switch (cmd.CommandType) {
@@ -105,8 +105,8 @@
 						}
 						break;
 					case CommandType.AnyZeroOrMore:
-						return Match(document, curOffset, ignoreCase, pc + 1) ||
-						       Match(document, curOffset + 1, ignoreCase, pc);
+						return Match(iter, curOffset, ignoreCase, pc + 1) ||
+						       Match(iter, curOffset + 1, ignoreCase, pc);
 					case CommandType.AnySingle:
 						break;
 					case CommandType.AnyDigit:
@@ -134,8 +134,8 @@
 		int InternalFindNext(ITextIterator textIterator, SearchOptions options)
 		{
 			while (textIterator.MoveAhead(1)) {
-				if (Match(textIterator.TextBuffer, textIterator.Position, options.IgnoreCase, 0)) {
-					if (!options.SearchWholeWordOnly || SearchReplaceUtilities.IsWholeWordAt(textIterator.TextBuffer, textIterator.Position, curMatchEndOffset - textIterator.Position)) {
+				if (Match(textIterator, textIterator.Position, options.IgnoreCase, 0)) {
+					if (!options.SearchWholeWordOnly || textIterator.IsWholeWordAt (textIterator.Position, curMatchEndOffset - textIterator.Position)) {
 						return textIterator.Position;
 					}
 				}

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ForwardTextIterator.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ForwardTextIterator.cs	2004-02-02 19:40:02 UTC (rev 755)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ForwardTextIterator.cs	2004-02-02 23:21:20 UTC (rev 756)
@@ -56,6 +56,20 @@
 			}
 		}
 		
+		public int Length { get { return textBuffer.Length; } }
+		public string FullDocumentText { get { return textBuffer.GetText (0, textBuffer.Length); } }
+		
+		// doesnt this feel like java ;-)
+		public char GetCharAt (int p)
+		{
+			return textBuffer.GetCharAt (p);
+		}
+		
+		public bool IsWholeWordAt (int offset, int length)
+		{
+			return SearchReplaceUtilities.IsWholeWordAt (textBuffer, offset, length);
+		}
+		
 		public ForwardTextIterator(ITextBufferStrategy textBuffer, int endOffset)
 		{
 			Debug.Assert(textBuffer != null);

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ITextIterator.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ITextIterator.cs	2004-02-02 19:40:02 UTC (rev 755)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Search/TextIterator/ITextIterator.cs	2004-02-02 23:21:20 UTC (rev 756)
@@ -16,13 +16,6 @@
 	public interface ITextIterator
 	{
 		/// &lt;value&gt;
-		/// The text buffer strategy
-		/// &lt;/value&gt;
-		ITextBufferStrategy TextBuffer {
-			get;
-		}
-		
-		/// &lt;value&gt;
 		/// Gets the current char this is the same as 
 		/// GetCharRelative(0)
 		/// &lt;/value&gt;
@@ -42,6 +35,13 @@
 			set;
 		}
 		
+		int Length { get; }
+		
+		string FullDocumentText { get; }
+		
+		bool IsWholeWordAt (int offset, int length);
+		char GetCharAt (int p);
+		
 		/// &lt;remarks&gt;
 		/// Gets a char relative to the current position (negative values
 		/// will work too).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000360.html">[Monodevelop-patches-list] r755 - trunk/MonoDevelop/data/resources/glade
</A></li>
	<LI>Next message: <A HREF="000362.html">[Monodevelop-patches-list] r757 - in trunk/MonoDevelop/src/AddIns/DisplayBindings: EditorBindings EditorBindings/Search EditorBindings/Search/SearchStrategy EditorBindings/Search/TextIterator TextEditor TextEditor/Gui/Dialogs TextEditor/Search TextEditor/Search/TextIterator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#361">[ date ]</a>
              <a href="thread.html#361">[ thread ]</a>
              <a href="subject.html#361">[ subject ]</a>
              <a href="author.html#361">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
