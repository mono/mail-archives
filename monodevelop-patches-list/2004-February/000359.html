<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r754 - in trunk/MonoDevelop: data/resources/glade src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r754%20-%20in%20trunk/MonoDevelop%3A%20data/resources/glade%20src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000358.html">
   <LINK REL="Next"  HREF="000360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r754 - in trunk/MonoDevelop: data/resources/glade src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r754%20-%20in%20trunk/MonoDevelop%3A%20data/resources/glade%20src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r754 - in trunk/MonoDevelop: data/resources/glade src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Mon Feb  2 04:39:27 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000358.html">[Monodevelop-patches-list] r753 - trunk/MonoDevelop
</A></li>
        <LI>Next message: <A HREF="000360.html">[Monodevelop-patches-list] r755 - trunk/MonoDevelop/data/resources/glade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#359">[ date ]</a>
              <a href="thread.html#359">[ thread ]</a>
              <a href="subject.html#359">[ subject ]</a>
              <a href="author.html#359">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jba
Date: 2004-02-02 04:39:27 -0500 (Mon, 02 Feb 2004)
New Revision: 754

Modified:
   trunk/MonoDevelop/data/resources/glade/texteditoraddin.glade
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs/ReplaceDialog.cs
Log:
added a 20 item find and replace history - saved to properties even

Modified: trunk/MonoDevelop/data/resources/glade/texteditoraddin.glade
===================================================================
--- trunk/MonoDevelop/data/resources/glade/texteditoraddin.glade	2004-02-02 05:49:59 UTC (rev 753)
+++ trunk/MonoDevelop/data/resources/glade/texteditoraddin.glade	2004-02-02 09:39:27 UTC (rev 754)
@@ -446,7 +446,7 @@
   &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
   &lt;property name=&quot;title&quot; translatable=&quot;yes&quot;&gt;Replace Dialog&lt;/property&gt;
   &lt;property name=&quot;type&quot;&gt;GTK_WINDOW_TOPLEVEL&lt;/property&gt;
-  &lt;property name=&quot;window_position&quot;&gt;GTK_WIN_POS_MOUSE&lt;/property&gt;
+  &lt;property name=&quot;window_position&quot;&gt;GTK_WIN_POS_NONE&lt;/property&gt;
   &lt;property name=&quot;modal&quot;&gt;False&lt;/property&gt;
   &lt;property name=&quot;resizable&quot;&gt;True&lt;/property&gt;
   &lt;property name=&quot;destroy_with_parent&quot;&gt;True&lt;/property&gt;
@@ -947,7 +947,7 @@
   &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
   &lt;property name=&quot;title&quot; translatable=&quot;yes&quot;&gt;Find Dialog&lt;/property&gt;
   &lt;property name=&quot;type&quot;&gt;GTK_WINDOW_TOPLEVEL&lt;/property&gt;
-  &lt;property name=&quot;window_position&quot;&gt;GTK_WIN_POS_MOUSE&lt;/property&gt;
+  &lt;property name=&quot;window_position&quot;&gt;GTK_WIN_POS_NONE&lt;/property&gt;
   &lt;property name=&quot;modal&quot;&gt;False&lt;/property&gt;
   &lt;property name=&quot;resizable&quot;&gt;True&lt;/property&gt;
   &lt;property name=&quot;destroy_with_parent&quot;&gt;True&lt;/property&gt;

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs/ReplaceDialog.cs
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs/ReplaceDialog.cs	2004-02-02 05:49:59 UTC (rev 753)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Dialogs/ReplaceDialog.cs	2004-02-02 09:39:27 UTC (rev 754)
@@ -9,6 +9,7 @@
 using System.IO;
 using System.Drawing;
 using System.ComponentModel;
+using System.Collections.Specialized;
 
 using ICSharpCode.SharpDevelop.Gui;
 using ICSharpCode.SharpDevelop.DefaultEditor.Gui.Editor;
@@ -24,18 +25,24 @@
 using Gtk;
 using Glade;
 
-using Assembly = System.Reflection.Assembly;
-
 namespace ICSharpCode.SharpDevelop.Gui.Dialogs
 {
 	public class ReplaceDialog
 	{
+		private const int HISTORY_LIMIT = 20;
+		private const char HISTORY_SEPARATOR_CHAR = (char) 10;
+		// regular members
 		public bool replaceMode;
+		StringCollection findHistory = new StringCollection();
+		StringCollection replaceHistory = new StringCollection();
+		
+		// services
 		ResourceService resourceService = (ResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
 		static PropertyService propertyService = (PropertyService)ServiceManager.Services.GetService(typeof(PropertyService));
 		static FileUtilityService fileUtilityService = (FileUtilityService)ServiceManager.Services.GetService(typeof(FileUtilityService));
 		StringParserService stringParserService = (StringParserService)ServiceManager.Services.GetService (typeof (StringParserService));
 		
+		// gtk widgets
 		[Glade.Widget] Gtk.Combo searchPatternComboBox;
 		[Glade.Widget] Gtk.Combo replacePatternComboBox;
 		[Glade.Widget] Gtk.Button findHelpButton;
@@ -115,10 +122,12 @@
 			}
 		}
 		
-		public ReplaceDialog(bool replaceMode)// : base (&quot;Find&quot;)
+		public ReplaceDialog(bool replaceMode)
 		{
+			// some members needed to initialise this dialog based on replace mode
 			this.replaceMode = replaceMode;
 			string dialogName = (replaceMode) ? &quot;ReplaceDialogWidget&quot; : &quot;FindDialogWidget&quot;;
+			
 			// we must do it from *here* otherwise, we get this assembly, not the caller
 			Glade.XML glade = new XML (null, &quot;texteditoraddin.glade&quot;, dialogName, null);
 			glade.Autoconnect (this);
@@ -135,6 +144,8 @@
 			//AcceptButton = (Button)ControlDictionary[&quot;findButton&quot;];
 			//CancelButton = (Button)ControlDictionary[&quot;closeButton&quot;];
 			
+			LoadHistoryValues();
+			
 			ignoreCaseCheckBox.Active = !SearchReplaceManager.SearchOptions.IgnoreCase;
 			searchWholeWordOnlyCheckBox.Active = SearchReplaceManager.SearchOptions.SearchWholeWordOnly;
 			
@@ -185,6 +196,7 @@
 			// insert event handlers
 			findButton.Clicked  += new EventHandler(FindNextEvent);
 			closeButton.Clicked += new EventHandler(CloseDialogEvent);
+			ReplaceDialogPointer.Close += new EventHandler(CloseDialogEvent);
 			ReplaceDialogPointer.DeleteEvent += new GtkSharp.DeleteEventHandler (OnDeleted);
 			
 			if (replaceMode) {
@@ -208,13 +220,16 @@
 			SearchReplaceManager.ReplaceDialog     = this;
 		}
 		
-		protected void OnClosed(EventArgs e)
+		protected void OnClosed()
 		{
-			SearchReplaceManager.ReplaceDialog     = null;
+			SaveHistoryValues();
+			
 		}
 		
 		void OnDeleted (object o, GtkSharp.DeleteEventArgs args)
 		{
+			// perform the standard closing windows event
+			OnClosed();
 			SearchReplaceManager.ReplaceDialog = null;
 		}
 
@@ -274,6 +289,8 @@
 			finally {
 				//Cursor = Cursors.Default;
 			}
+			
+			AddSearchHistoryItem(findHistory, searchPatternComboBox.Entry.Text);
 		}
 		
 		void ReplaceEvent(object sender, EventArgs e)
@@ -291,6 +308,8 @@
 			finally {
 				//Cursor = Cursors.Default;
 			}
+			
+			AddSearchHistoryItem(replaceHistory, replacePatternComboBox.Entry.Text);
 		}
 		
 		void ReplaceAllEvent(object sender, EventArgs e)
@@ -307,6 +326,8 @@
 			} finally {
 				//Cursor = Cursors.Default;
 			}
+			
+			AddSearchHistoryItem(replaceHistory, replacePatternComboBox.Entry.Text);
 		}
 		
 		void MarkAllEvent(object sender, EventArgs e)
@@ -323,12 +344,14 @@
 			} finally {
 				//Cursor = Cursors.Default;
 			}
+			
+			AddSearchHistoryItem(findHistory, searchPatternComboBox.Entry.Text);
 		}
 		
 		void CloseDialogEvent(object sender, EventArgs e)
 		{
 			ReplaceDialogPointer.Hide();
-			OnClosed (null);
+			OnClosed ();
 		}
 		
 		void SpecialSearchStrategyCheckBoxChangedEvent(object sender, EventArgs e)
@@ -338,6 +361,71 @@
 			}
 		}
 		
+		// generic method to add a string to a history item
+		private void AddSearchHistoryItem(StringCollection history, string toAdd)
+		{
+			// add the item to the find history
+			if (history.Contains(toAdd)) {
+				// remove it so it gets added at the top
+				history.Remove(toAdd);
+			}
+			// make sure there is only 20
+			if (history.Count == HISTORY_LIMIT) {
+				history.RemoveAt(HISTORY_LIMIT - 1);
+			}
+			history.Insert(0, toAdd);
+			
+			// update the drop down for the combobox
+			string[] stringArray = new string[history.Count];
+			history.CopyTo(stringArray, 0);
+			if (history == findHistory) {
+				searchPatternComboBox.SetPopdownStrings(stringArray);
+			} else if( history == replaceHistory) {
+				replacePatternComboBox.SetPopdownStrings(stringArray);
+			}
+		}
+		
+		// loads the history arrays from the property service
+		// NOTE: this dialog uses a newline character to separate search history strings in the properties file 
+		private void LoadHistoryValues()
+		{
+			object stringArray;
+			// set the history in properties
+			stringArray = propertyService.GetProperty(&quot;MonoDevelop.FindReplaceDialogs.FindHistory&quot;);
+		
+			if(stringArray != null) {
+				findHistory.AddRange(stringArray.ToString().Split(HISTORY_SEPARATOR_CHAR));
+				searchPatternComboBox.SetPopdownStrings(stringArray.ToString().Split(HISTORY_SEPARATOR_CHAR));
+			}
+			
+			// now do the replace history
+			if(replaceMode)	{					
+				stringArray = propertyService.GetProperty(&quot;MonoDevelop.FindReplaceDialogs.ReplaceHistory&quot;);
+				if(stringArray != null) {
+					replaceHistory.AddRange(stringArray.ToString().Split(HISTORY_SEPARATOR_CHAR));
+					replacePatternComboBox.SetPopdownStrings(stringArray.ToString().Split(HISTORY_SEPARATOR_CHAR));
+				}
+			}
+		}
+		
+		// saves the history arrays to the property service
+		// NOTE: this dialog uses a newline character to separate search history strings in the properties file
+		private void SaveHistoryValues()
+		{
+			string[] stringArray;
+			// set the history in properties
+			stringArray = new string[findHistory.Count];
+			findHistory.CopyTo(stringArray, 0);			
+			propertyService.SetProperty(&quot;MonoDevelop.FindReplaceDialogs.FindHistory&quot;, string.Join(HISTORY_SEPARATOR_CHAR.ToString(), stringArray));
+			
+			// now do the replace history
+			if(replaceMode)	{
+				stringArray = new string[replaceHistory.Count];
+				replaceHistory.CopyTo(stringArray, 0);				
+				propertyService.SetProperty(&quot;MonoDevelop.FindReplaceDialogs.ReplaceHistory&quot;, string.Join(HISTORY_SEPARATOR_CHAR.ToString(), stringArray));
+			}
+		}
+		
 		#region code to pretend to be a dialog (cause we can't inherit Dialog and use glade)
 		public void Present()
 		{
@@ -346,6 +434,8 @@
 		
 		public void Destroy()
 		{
+			// save the search and replace history to properties
+			OnClosed ();
 			ReplaceDialogPointer.Destroy();
 		}
 		


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000358.html">[Monodevelop-patches-list] r753 - trunk/MonoDevelop
</A></li>
	<LI>Next message: <A HREF="000360.html">[Monodevelop-patches-list] r755 - trunk/MonoDevelop/data/resources/glade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#359">[ date ]</a>
              <a href="thread.html#359">[ thread ]</a>
              <a href="subject.html#359">[ subject ]</a>
              <a href="author.html#359">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
