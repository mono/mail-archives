<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r777 - in trunk/MonoDevelop: build/AddIns src/AddIns/DisplayBindings/EditorBindings src/AddIns/DisplayBindings/EditorBindings/Gui src/AddIns/DisplayBindings/EditorBindings/Gui/Pads src/AddIns/DisplayBindings/TextEditor src/AddIns/DisplayBindings/TextEditor/Gui src/Main/Base/Gui/Workbench src/Main/Base/Gui/Workbench/Layouts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r777%20-%20in%20trunk/MonoDevelop%3A%20build/AddIns%20src/AddIns/DisplayBindings/EditorBindings%20src/AddIns/DisplayBindings/EditorBindings/Gui%20src/AddIns/DisplayBindings/EditorBindings/Gui/Pads%20src/AddIns/DisplayBindings/TextEditor%20src/AddIns/DisplayBindings/TextEditor/Gui%20src/Main/Base/Gui/Workbench%20src/Main/Base/Gui/Workbench/Layouts&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000381.html">
   <LINK REL="Next"  HREF="000383.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r777 - in trunk/MonoDevelop: build/AddIns src/AddIns/DisplayBindings/EditorBindings src/AddIns/DisplayBindings/EditorBindings/Gui src/AddIns/DisplayBindings/EditorBindings/Gui/Pads src/AddIns/DisplayBindings/TextEditor src/AddIns/DisplayBindings/TextEditor/Gui src/Main/Base/Gui/Workbench src/Main/Base/Gui/Workbench/Layouts</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r777%20-%20in%20trunk/MonoDevelop%3A%20build/AddIns%20src/AddIns/DisplayBindings/EditorBindings%20src/AddIns/DisplayBindings/EditorBindings/Gui%20src/AddIns/DisplayBindings/EditorBindings/Gui/Pads%20src/AddIns/DisplayBindings/TextEditor%20src/AddIns/DisplayBindings/TextEditor/Gui%20src/Main/Base/Gui/Workbench%20src/Main/Base/Gui/Workbench/Layouts&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r777 - in trunk/MonoDevelop: build/AddIns src/AddIns/DisplayBindings/EditorBindings src/AddIns/DisplayBindings/EditorBindings/Gui src/AddIns/DisplayBindings/EditorBindings/Gui/Pads src/AddIns/DisplayBindings/TextEditor src/AddIns/DisplayBindings/TextEditor/Gui src/Main/Base/Gui/Workbench src/Main/Base/Gui/Workbench/Layouts">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Wed Feb  4 00:11:25 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000381.html">[Monodevelop-patches-list] r776 - trunk/MonoDevelop/src/Main/Base/Gui/Pads
</A></li>
        <LI>Next message: <A HREF="000383.html">[Monodevelop-patches-list] r778 - trunk/MonoDevelop/src/AddIns/DisplayBindings/EditorBindings/Gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#382">[ date ]</a>
              <a href="thread.html#382">[ thread ]</a>
              <a href="subject.html#382">[ subject ]</a>
              <a href="author.html#382">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tberman
Date: 2004-02-04 00:11:25 -0500 (Wed, 04 Feb 2004)
New Revision: 777

Added:
   trunk/MonoDevelop/src/AddIns/DisplayBindings/EditorBindings/Gui/
   trunk/MonoDevelop/src/AddIns/DisplayBindings/EditorBindings/Gui/Pads/
   trunk/MonoDevelop/src/AddIns/DisplayBindings/EditorBindings/Gui/Pads/CompilerMessageView.cs
Removed:
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Pads/
Modified:
   trunk/MonoDevelop/build/AddIns/MonoDevelopEditorBindings.addin
   trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Makefile
   trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs
   trunk/MonoDevelop/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs
Log:
ben, this is a birthday present for you.

1) moved the Output tab to the EditorBindings.
2) now using a Gtk.TextView instead of the ported text editor.


Modified: trunk/MonoDevelop/build/AddIns/MonoDevelopEditorBindings.addin
===================================================================
--- trunk/MonoDevelop/build/AddIns/MonoDevelopEditorBindings.addin	2004-02-04 02:10:55 UTC (rev 776)
+++ trunk/MonoDevelop/build/AddIns/MonoDevelopEditorBindings.addin	2004-02-04 05:11:25 UTC (rev 777)
@@ -56,7 +56,7 @@
 	
 	&lt;Extension path = &quot;/SharpDevelop/Workbench/Views&quot;&gt;
 		&lt;Class id    = &quot;CompilerMessageView&quot; 
-		       class = &quot;ICSharpCode.SharpDevelop.Gui.Pads.CompilerMessageView&quot;/&gt;
+		       class = &quot;MonoDevelop.EditorBindings.Gui.Pads.CompilerMessageView&quot;/&gt;
 	&lt;/Extension&gt;
 
 	&lt;Extension path = &quot;/SharpDevelop/ViewContent/DefaultTextEditor/ContextMenu&quot;&gt;

Copied: trunk/MonoDevelop/src/AddIns/DisplayBindings/EditorBindings/Gui/Pads/CompilerMessageView.cs (from rev 776, trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Pads/CompilerMessageView.cs)
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Gui/Pads/CompilerMessageView.cs	2004-02-04 02:10:55 UTC (rev 776)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/EditorBindings/Gui/Pads/CompilerMessageView.cs	2004-02-04 05:11:25 UTC (rev 777)
@@ -0,0 +1,167 @@
+// &lt;file&gt;
+//     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt&quot;/">prj:///doc/copyright.txt&quot;/</A>&gt;
+//     &lt;license see=&quot;<A HREF="prj:///doc/license.txt&quot;/">prj:///doc/license.txt&quot;/</A>&gt;
+//     &lt;owner name=&quot;Mike Kr&#252;ger&quot; email=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">mike at icsharpcode.net</A>&quot;/&gt;
+//     &lt;version value=&quot;$version&quot;/&gt;
+// &lt;/file&gt;
+
+using System;
+using System.CodeDom.Compiler;
+using System.IO;
+using System.Diagnostics;
+using ICSharpCode.SharpDevelop.Services;
+
+using ICSharpCode.Core.Properties;
+using ICSharpCode.Core.Services;
+using ICSharpCode.SharpDevelop.Gui;
+
+namespace MonoDevelop.EditorBindings.Gui.Pads
+{
+	// Note: I moved the pads to this assembly, because I want no cyclic dll dependency
+	// on the ICSharpCode.TextEditor assembly.
+	
+	/// &lt;summary&gt;
+	/// This class displays the errors and warnings which the compiler outputs and
+	/// allows the user to jump to the source of the warnig / error
+	/// &lt;/summary&gt;
+	public class CompilerMessageView : IPadContent
+	{
+		Gtk.TextBuffer buffer;
+		Gtk.TextView textEditorControl;
+		Gtk.ScrolledWindow scroller;
+		//Panel       myPanel = new Panel();
+		ResourceService resourceService = (ResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
+		
+		public Gtk.Widget Control {
+			get {
+				return scroller;
+			}
+		}
+		
+		public string Title {
+			get {
+				return resourceService.GetString(&quot;MainWindow.Windows.OutputWindow&quot;);
+			}
+		}
+		
+		public string Icon {
+			get {
+				return &quot;Icons.16x16.OutputIcon&quot;;
+			}
+		}
+		
+		public void Dispose()
+		{
+		}
+		
+		public void RedrawContent()
+		{
+			OnTitleChanged(null);
+			OnIconChanged(null);
+		}
+		
+		public CompilerMessageView()
+		{
+			buffer = new Gtk.TextBuffer (new Gtk.TextTagTable ());
+			textEditorControl = new Gtk.TextView (buffer);
+			textEditorControl.Editable = false;
+			scroller = new Gtk.ScrolledWindow ();
+			scroller.Add (textEditorControl);
+			ResourceService resourceService = (ResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
+			
+			TaskService     taskService    = (TaskService)ICSharpCode.Core.Services.ServiceManager.Services.GetService(typeof(TaskService));
+			
+			taskService.CompilerOutputChanged += new EventHandler(SetOutput);
+		}
+		
+		void OnCombineOpen(object sender, CombineEventArgs e)
+		{
+			buffer.Text = String.Empty;
+		}
+		
+		void OnCombineClosed(object sender, CombineEventArgs e)
+		{
+			buffer.Text = String.Empty;
+		}
+		
+		void SelectMessageView(object sender, EventArgs e)
+		{
+			PropertyService propertyService = (PropertyService)ServiceManager.Services.GetService(typeof(PropertyService));
+			
+			if (WorkbenchSingleton.Workbench.WorkbenchLayout.IsVisible(this)) {
+				WorkbenchSingleton.Workbench.WorkbenchLayout.ActivatePad(this);
+			} else { 
+				if ((bool)propertyService.GetProperty(&quot;SharpDevelop.ShowOutputWindowAtBuild&quot;, true)) {
+					WorkbenchSingleton.Workbench.WorkbenchLayout.ShowPad(this);
+					WorkbenchSingleton.Workbench.WorkbenchLayout.ActivatePad(this);
+				}
+			}
+			
+		}
+		
+		void SetOutput2()
+		{
+			TaskService taskService = (TaskService)ICSharpCode.Core.Services.ServiceManager.Services.GetService(typeof(TaskService));
+			try {
+				buffer.Text = taskService.CompilerOutput;
+				UpdateTextArea();
+			} catch (Exception) {}
+			
+			System.Threading.Thread.Sleep(100);
+		}
+		
+		void UpdateTextArea()
+		{
+			buffer.MoveMark (buffer.InsertMark, buffer.EndIter);
+			textEditorControl.ScrollMarkOnscreen (buffer.InsertMark);
+		}
+		
+		string outputText = null;
+		void SetOutput(object sender, EventArgs e)
+		{
+			//Console.WriteLine(&quot;Create CompilerMessage View Handle:&quot; + textEditorControl.Handle);
+			//throw new Exception(&quot;Trace me...&quot;);
+			if (WorkbenchSingleton.Workbench.WorkbenchLayout.IsVisible(this)) {
+				SetOutput2();
+				outputText = null;
+			} else {
+				TaskService taskService = (TaskService)ICSharpCode.Core.Services.ServiceManager.Services.GetService(typeof(TaskService));
+				outputText = taskService.CompilerOutput;
+				UpdateTextArea();
+			}
+		}
+		
+		void ActivateTextBox(object sender, EventArgs e)
+		{
+			if (outputText != null &amp;&amp; textEditorControl.Visible) {
+				buffer.Text = outputText;
+				UpdateTextArea();
+				outputText = null;
+			}
+		}
+		
+		protected virtual void OnTitleChanged(EventArgs e)
+		{
+			if (TitleChanged != null) {
+				TitleChanged(this, e);
+			}
+		}
+		protected virtual void OnIconChanged(EventArgs e)
+		{
+			if (IconChanged != null) {
+				IconChanged(this, e);
+			}
+		}
+		public event EventHandler TitleChanged;
+		public event EventHandler IconChanged;
+
+		public void BringToFront()
+		{
+			if (!WorkbenchSingleton.Workbench.WorkbenchLayout.IsVisible(this)) {
+				WorkbenchSingleton.Workbench.WorkbenchLayout.ShowPad(this);
+			}
+			WorkbenchSingleton.Workbench.WorkbenchLayout.ActivatePad(this);
+		}
+
+	}
+}

Modified: trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Makefile
===================================================================
--- trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Makefile	2004-02-04 02:10:55 UTC (rev 776)
+++ trunk/MonoDevelop/src/AddIns/DisplayBindings/TextEditor/Makefile	2004-02-04 05:11:25 UTC (rev 777)
@@ -1,6 +1,5 @@
 SDDIR=../../../SharpDevelop/src/Main/Core
 SOURCES = \
-./Gui/Pads/CompilerMessageView.cs \
 ./Gui/Editor/ParserFoldingStrategy.cs \
 ./Gui/Editor/SharpDevelopTextEditorProperties.cs \
 ./Gui/Editor/SharpDevelopTextAreaControl.cs \

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs	2004-02-04 02:10:55 UTC (rev 776)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Workbench/DefaultWorkbench.cs	2004-02-04 05:11:25 UTC (rev 777)
@@ -575,7 +575,6 @@
 		
 		public void UpdateToolbars()
 		{
-#if GTK
 			foreach (Gtk.Toolbar toolbar in ToolBars) {
 				foreach (object item in toolbar.Children) {
 					if (item is IStatusUpdate) {
@@ -583,15 +582,6 @@
 					}
 				}
 			}
-#else
-			foreach (CommandBar commandBar in ToolBars) {
-				foreach (object item in commandBar.Items) {
-					if (item is IStatusUpdate) {
-						((IStatusUpdate)item).UpdateStatus();
-					}
-				}
-			}
-#endif
 		}
 		
 		// this method simply copies over the enabled state of the toolbar,
@@ -601,19 +591,11 @@
 		
 		void CreateToolBars()
 		{
-#if GTK
 			if (ToolBars == null) {
 				ToolbarService toolBarService = (ToolbarService)ICSharpCode.Core.Services.ServiceManager.Services.GetService(typeof(ToolbarService));
 				Gtk.Toolbar[] toolBars = toolBarService.CreateToolbars();
 				ToolBars = toolBars;
 			}
-#else
-			if (ToolBars == null) {
-				ToolbarService toolBarService = (ToolbarService)ICSharpCode.Core.Services.ServiceManager.Services.GetService(typeof(ToolbarService));
-				CommandBar[] toolBars = toolBarService.CreateToolbars();
-				ToolBars = toolBars;
-			}
-#endif
 		}
 		
 		public void UpdateViews(object sender, EventArgs e)

Modified: trunk/MonoDevelop/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs
===================================================================
--- trunk/MonoDevelop/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs	2004-02-04 02:10:55 UTC (rev 776)
+++ trunk/MonoDevelop/src/Main/Base/Gui/Workbench/Layouts/SdiWorkspaceLayout.cs	2004-02-04 05:11:25 UTC (rev 777)
@@ -187,7 +187,7 @@
 			};
 			string[] bottomContents = new string[] {
 				&quot;ICSharpCode.SharpDevelop.Gui.Pads.OpenTaskView&quot;,
-				&quot;ICSharpCode.SharpDevelop.Gui.Pads.CompilerMessageView&quot;
+				&quot;MonoDevelop.EditorBindings.Gui.Pads.CompilerMessageView&quot;
 			};
 			
 			foreach (string typeName in leftContents) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000381.html">[Monodevelop-patches-list] r776 - trunk/MonoDevelop/src/Main/Base/Gui/Pads
</A></li>
	<LI>Next message: <A HREF="000383.html">[Monodevelop-patches-list] r778 - trunk/MonoDevelop/src/AddIns/DisplayBindings/EditorBindings/Gui
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#382">[ date ]</a>
              <a href="thread.html#382">[ thread ]</a>
              <a href="subject.html#382">[ subject ]</a>
              <a href="author.html#382">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
