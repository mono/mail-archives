<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-patches-list] r1944 - in branches/MonoDevelop-plan-43: . src/Plugins src/Plugins/CSharp src/Plugins/Editor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1944%20-%20in%20branches/MonoDevelop-plan-43%3A%20.%20src/Plugins%20src/Plugins/CSharp%20src/Plugins/Editor&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001550.html">
   <LINK REL="Next"  HREF="001552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-patches-list] r1944 - in branches/MonoDevelop-plan-43: . src/Plugins src/Plugins/CSharp src/Plugins/Editor</H1>
    <B>commit-watcher at mono-cvs.ximian.com</B> 
    <A HREF="mailto:monodevelop-patches-list%40lists.ximian.com?Subject=%5BMonodevelop-patches-list%5D%20r1944%20-%20in%20branches/MonoDevelop-plan-43%3A%20.%20src/Plugins%20src/Plugins/CSharp%20src/Plugins/Editor&In-Reply-To="
       TITLE="[Monodevelop-patches-list] r1944 - in branches/MonoDevelop-plan-43: . src/Plugins src/Plugins/CSharp src/Plugins/Editor">commit-watcher at mono-cvs.ximian.com
       </A><BR>
    <I>Sun Aug 15 08:27:11 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="001550.html">[Monodevelop-patches-list] r1943 - in branches/MonoDevelop-plan-43: . src/Plugins/Editor
</A></li>
        <LI>Next message: <A HREF="001552.html">[Monodevelop-patches-list] r1945 - in branches/MonoDevelop-plan-43/src: Libraries Libraries/SharpRefactory Libraries/SharpRefactory/CodeDOM Libraries/SharpRefactory/Lexer Libraries/SharpRefactory/Lexer/Reader Libraries/SharpRefactory/Lexer/Specials Libraries/SharpRefactory/Parser Libraries/SharpRefactory/Parser/AST Libraries/SharpRefactory/Parser/AST/Expressions Libraries/SharpRefactory/Parser/AST/GlobalScope Libraries/SharpRefactory/Parser/AST/Statements Libraries/SharpRefactory/Parser/AST/TypeLevel Libraries/SharpRefactory/Parser/generated Libraries/SharpRefactory/Parser/generated/keywordlist Libraries/SharpRefactory/PrettyPrinter Libraries/SharpRefactory/VBConverter Plugins Plugins/CSharp Plugins/Parser Plugins/Parser/Collections Plugins/Parser/Implementations Plugins/Parser/ParserService Plugins/Parser/PersistenceLayer Plugins/Parser/ReflectionLayer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1551">[ date ]</a>
              <a href="thread.html#1551">[ thread ]</a>
              <a href="subject.html#1551">[ subject ]</a>
              <a href="author.html#1551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jzwart
Date: 2004-08-15 08:27:11 -0400 (Sun, 15 Aug 2004)
New Revision: 1944

Added:
   branches/MonoDevelop-plan-43/src/Plugins/CSharp/
   branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpFileNode.cs
   branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewer.cs
   branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewerFactory.cs
   branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.build
   branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.plugin.in
Modified:
   branches/MonoDevelop-plan-43/ChangeLog
   branches/MonoDevelop-plan-43/src/Plugins/Editor/EditorManager.cs
   branches/MonoDevelop-plan-43/src/Plugins/Editor/TextNodeViewer.cs
   branches/MonoDevelop-plan-43/src/Plugins/plugins.build
Log:
2004-08-15  Jeroen Zwartepoorte  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jeroen at xs4all.nl</A>&gt;

	* src/Plugins/plugins.build: add csharp.build.
	* src/Plugins/CSharp/*: new C# specific classes: CSharpNodeViewer and
	Factory and a CSharpFileNode. It should allow you to open a .cs file and
	have it highlighted properly in the editor, *if* gnome-vfs says the .cs
	file has a 'text/x-csharp' mimetype (which it doesn't here).
	* src/Plugins/Editor/EditorManager.cs: create a SourceBuffer for the
	EditorView.
	* src/Plugins/Editor/TextNodeViewer.cs: don't return a structure widget.



Modified: branches/MonoDevelop-plan-43/ChangeLog
===================================================================
--- branches/MonoDevelop-plan-43/ChangeLog	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/ChangeLog	2004-08-15 12:27:11 UTC (rev 1944)
@@ -1,5 +1,16 @@
 2004-08-15  Jeroen Zwartepoorte  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jeroen at xs4all.nl</A>&gt;
 
+	* src/Plugins/plugins.build: add csharp.build.
+	* src/Plugins/CSharp/*: new C# specific classes: CSharpNodeViewer and
+	Factory and a CSharpFileNode. It should allow you to open a .cs file and
+	have it highlighted properly in the editor, *if* gnome-vfs says the .cs
+	file has a 'text/x-csharp' mimetype (which it doesn't here).
+	* src/Plugins/Editor/EditorManager.cs: create a SourceBuffer for the
+	EditorView.
+	* src/Plugins/Editor/TextNodeViewer.cs: don't return a structure widget.
+
+2004-08-15  Jeroen Zwartepoorte  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jeroen at xs4all.nl</A>&gt;
+
 	* src/Plugins/Editor/TextNodeViewer.cs: Renamed EditorNodeViewer: better
 	name for a generic editor viewer.
 	* src/Plugins/Editor/TextNodeViewerFactory.cs: idem.

Added: branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpFileNode.cs
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpFileNode.cs	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpFileNode.cs	2004-08-15 12:27:11 UTC (rev 1944)
@@ -0,0 +1,33 @@
+//
+// CSharpFileNode.cs: Class for text files.
+//
+// Author:
+//   Jeroen Zwartepoorte &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jeroen at xs4all.nl</A>&gt;
+//
+// (C) Copyright Jeroen Zwartepoorte 2004
+//
+
+using MonoDevelop.Node;
+using log4net;
+
+namespace MonoDevelop.CSharp {
+	public class CSharpFileNode : TextFileNode {
+		static private readonly ILog log = LogManager.GetLogger (typeof (CSharpFileNode));
+	
+		public CSharpFileNode (Project project, Node parent, string filename)
+			: base (project, parent, filename)
+		{
+			log.Debug (&quot;Created instance of CSharpFileNode&quot;);
+		}
+
+		public static new void InitializePlugin (byte major, byte minor)
+		{
+			FileNode.RegisterFileNodeType (&quot;text/x-csharp&quot;, &quot;C# source file&quot;,
+						       typeof (CSharpFileNode), null);
+		}
+		
+		public static new void FinalizePlugin ()
+		{
+		}
+	}
+}

Added: branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewer.cs
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewer.cs	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewer.cs	2004-08-15 12:27:11 UTC (rev 1944)
@@ -0,0 +1,103 @@
+//
+// CSharpNodeViewer.cs: Node viewer for text/* mimetypes.
+//
+// Author:
+//   Jeroen Zwartepoorte &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jeroen at xs4all.nl</A>&gt;
+//
+// (C) Copyright Jeroen Zwartepoorte 2004
+//
+
+using System;
+using System.IO;
+using System.Text;
+using Gtk;
+using GtkSourceView;
+using MonoDevelop.Content;
+using MonoDevelop.Editor;
+using MonoDevelop.Node;
+using log4net;
+
+namespace MonoDevelop.CSharp {
+	public class CSharpNodeViewer : AbstractNodeViewer {
+		static private readonly ILog log = LogManager.GetLogger (typeof (CSharpNodeViewer));
+
+		private ScrolledWindow viewer;
+		private SourceBuffer buffer;
+		private EditorView editor;
+		private string description;
+		private string title;
+		private Gdk.Pixbuf icon;
+		private SourceLanguagesManager slm;
+	
+		public CSharpNodeViewer (Context context) : base (context)
+		{
+			viewer = new ScrolledWindow ();
+			viewer.ShadowType = ShadowType.In;
+			editor = EditorManager.CreateEditor ();
+			buffer = editor.Buffer as SourceBuffer;
+			viewer.Add (editor);
+			
+			slm = new SourceLanguagesManager ();
+			SourceLanguage lang = slm.GetLanguageFromMimeType (&quot;text/x-csharp&quot;);
+			if (lang != null) {
+				buffer.Highlight = true;
+				buffer.Language = lang;
+			} else {
+				log.Error (&quot;No SourceLanguage for 'text/x-csharp' mimetype&quot;);
+			}
+			
+			CSharpFileNode node = (CSharpFileNode)context.Node;
+			LoadText (node.Buffer.Reader);
+		}
+		
+		public override Widget StructureWidget {
+			get {
+				return null;
+			}
+		}
+	
+		public override Widget ViewerWidget {
+			get {
+				return viewer;
+			}
+		}
+	
+		public new string ViewerDescription {
+			get {
+				return description;
+			}
+		}
+	
+		public new string ViewerTitle {
+			get {
+				return title;
+			}
+		}
+	
+		public new Gdk.Pixbuf ViewerIcon {
+			get {
+				return icon;
+			}
+		}
+		
+		private void LoadText (Stream reader)
+		{
+			StreamReader sr = new StreamReader (reader);
+			string line;
+			buffer.Text = &quot;&quot;;
+			while ((line = sr.ReadLine ()) != null) {
+				log.Debug (line);
+				buffer.Text += line + &quot;\n&quot;;
+			}
+		}
+		
+		public static void InitializePlugin (byte major, byte minor)
+		{
+			ContentManager.AddNodeViewerFactory (new CSharpNodeViewerFactory ());
+		}
+		
+		public static void FinalizePlugin ()
+		{
+		}
+	}
+}

Added: branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewerFactory.cs
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewerFactory.cs	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/CSharp/CSharpNodeViewerFactory.cs	2004-08-15 12:27:11 UTC (rev 1944)
@@ -0,0 +1,30 @@
+//
+// CSharpNodeViewerFactory.cs: Node viewer factory for text/x-csharp mimetypes.
+//
+// Author:
+//   Jeroen Zwartepoorte &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">jeroen at xs4all.nl</A>&gt;
+//
+// (C) Copyright Jeroen Zwartepoorte 2004
+//
+
+using System;
+using MonoDevelop.Content;
+using MonoDevelop.Node;
+
+namespace MonoDevelop.CSharp {
+	public class CSharpNodeViewerFactory : INodeViewerFactory {
+		public CSharpNodeViewerFactory ()
+		{
+		}
+		
+		public bool CanDisplayNode (Node node)
+		{
+			return node is CSharpFileNode;
+		}
+		
+		public INodeViewer CreateNodeViewer (Context context)
+		{
+			return new CSharpNodeViewer (context);
+		}
+	}
+}

Added: branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.build
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.build	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.build	2004-08-15 12:27:11 UTC (rev 1944)
@@ -0,0 +1,33 @@
+&lt;?xml version=&quot;1.0&quot;?&gt;
+&lt;project name=&quot;monodevelop.plugins.csharp&quot; default=&quot;build&quot;&gt;
+    &lt;!-- build the project --&gt;
+    &lt;target name=&quot;build&quot; description=&quot;compiles the source code&quot;&gt;
+        &lt;property name=&quot;assemblyfile&quot; value=&quot;${path::combine(plugin.dir, 'csharp.dll')}&quot;/&gt;
+        &lt;csc target=&quot;library&quot; output=&quot;${assemblyfile}&quot; debug=&quot;${build.debug}&quot;&gt;
+            &lt;arg value=&quot;${gtk-sharp.libs}&quot;/&gt;
+            &lt;arg value=&quot;${gtksourceview-sharp.libs}&quot;/&gt;
+            &lt;sources&gt;
+                &lt;include name=&quot;*.cs&quot;/&gt;
+            &lt;/sources&gt;
+            &lt;references&gt;
+                &lt;include name=&quot;${lib.dir}/log4net.dll&quot;/&gt;
+                &lt;include name=&quot;${bin.dir}/monodevelop.exe&quot;/&gt;
+                &lt;include name=&quot;${lib.dir}/gdl-sharp.dll&quot;/&gt;
+                &lt;include name=&quot;${plugin.dir}/node.dll&quot;/&gt;
+                &lt;include name=&quot;${plugin.dir}/workbench.dll&quot;/&gt;
+                &lt;include name=&quot;${plugin.dir}/content.dll&quot;/&gt;
+                &lt;include name=&quot;${plugin.dir}/editor.dll&quot;/&gt;
+            &lt;/references&gt;
+        &lt;/csc&gt;
+        
+        &lt;!-- install the plugin file --&gt;
+        &lt;copy file=&quot;csharp.plugin.in&quot; tofile=&quot;csharp.plugin&quot;&gt;
+            &lt;filterchain&gt;
+                &lt;replacetokens&gt;
+                    &lt;token key=&quot;assembly&quot; value=&quot;${assemblyfile}&quot;/&gt;
+                &lt;/replacetokens&gt;
+            &lt;/filterchain&gt;
+        &lt;/copy&gt;
+        &lt;move file=&quot;csharp.plugin&quot; todir=&quot;${plugin.dir}&quot; overwrite=&quot;true&quot;/&gt;
+    &lt;/target&gt;
+&lt;/project&gt;

Added: branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.plugin.in
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.plugin.in	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/CSharp/csharp.plugin.in	2004-08-15 12:27:11 UTC (rev 1944)
@@ -0,0 +1,6 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;plugin version=&quot;1.0&quot;&gt;
+	&lt;assembly&gt;@assembly@&lt;/assembly&gt;
+	&lt;class name=&quot;MonoDevelop.CSharp.CSharpFileNode&quot;/&gt;
+	&lt;class name=&quot;MonoDevelop.CSharp.CSharpNodeViewer&quot;/&gt;
+&lt;/plugin&gt;

Modified: branches/MonoDevelop-plan-43/src/Plugins/Editor/EditorManager.cs
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/Editor/EditorManager.cs	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/Editor/EditorManager.cs	2004-08-15 12:27:11 UTC (rev 1944)
@@ -7,6 +7,8 @@
 // (C) Copyright Jeroen Zwartepoorte 2004
 //
 
+using GtkSourceView;
+
 namespace MonoDevelop.Editor {
 	public class EditorManager {
 		private int tabSize;
@@ -23,6 +25,7 @@
 			// FIXME: the following properties should be retrieved
 			// from the config system (GConf?).
 			editor.AutoIndent = true;
+			editor.Buffer = new SourceBuffer (new SourceTagTable ());
 			editor.InsertSpacesInsteadOfTabs = false;
 			editor.Margin = 80;
 			editor.ShowLineNumbers = true;

Modified: branches/MonoDevelop-plan-43/src/Plugins/Editor/TextNodeViewer.cs
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/Editor/TextNodeViewer.cs	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/Editor/TextNodeViewer.cs	2004-08-15 12:27:11 UTC (rev 1944)
@@ -19,8 +19,6 @@
 	public class TextNodeViewer : AbstractNodeViewer {
 		static private readonly ILog log = LogManager.GetLogger (typeof (TextNodeViewer));
 
-		private ScrolledWindow structure;
-		private TreeView tree;
 		private ScrolledWindow viewer;
 		private TextBuffer buffer;
 		private EditorView editor;
@@ -30,11 +28,6 @@
 	
 		public TextNodeViewer (Context context) : base (context)
 		{
-			structure = new ScrolledWindow ();
-			structure.ShadowType = ShadowType.In;
-			tree = new TreeView ();
-			structure.Add (tree);
-			
 			viewer = new ScrolledWindow ();
 			viewer.ShadowType = ShadowType.In;
 			editor = EditorManager.CreateEditor ();
@@ -47,7 +40,7 @@
 		
 		public override Widget StructureWidget {
 			get {
-				return structure;
+				return null;
 			}
 		}
 	

Modified: branches/MonoDevelop-plan-43/src/Plugins/plugins.build
===================================================================
--- branches/MonoDevelop-plan-43/src/Plugins/plugins.build	2004-08-15 11:29:29 UTC (rev 1943)
+++ branches/MonoDevelop-plan-43/src/Plugins/plugins.build	2004-08-15 12:27:11 UTC (rev 1944)
@@ -20,5 +20,7 @@
         &lt;nant buildfile=&quot;Content/content.build&quot; target=&quot;build&quot;/&gt;
         &lt;!-- build MonoDevelop.Editor assembly --&gt;
         &lt;nant buildfile=&quot;Editor/editor.build&quot; target=&quot;build&quot;/&gt;
+        &lt;!-- build MonoDevelop.CSharp assembly --&gt;
+        &lt;nant buildfile=&quot;CSharp/csharp.build&quot; target=&quot;build&quot;/&gt;
     &lt;/target&gt;
 &lt;/project&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001550.html">[Monodevelop-patches-list] r1943 - in branches/MonoDevelop-plan-43: . src/Plugins/Editor
</A></li>
	<LI>Next message: <A HREF="001552.html">[Monodevelop-patches-list] r1945 - in branches/MonoDevelop-plan-43/src: Libraries Libraries/SharpRefactory Libraries/SharpRefactory/CodeDOM Libraries/SharpRefactory/Lexer Libraries/SharpRefactory/Lexer/Reader Libraries/SharpRefactory/Lexer/Specials Libraries/SharpRefactory/Parser Libraries/SharpRefactory/Parser/AST Libraries/SharpRefactory/Parser/AST/Expressions Libraries/SharpRefactory/Parser/AST/GlobalScope Libraries/SharpRefactory/Parser/AST/Statements Libraries/SharpRefactory/Parser/AST/TypeLevel Libraries/SharpRefactory/Parser/generated Libraries/SharpRefactory/Parser/generated/keywordlist Libraries/SharpRefactory/PrettyPrinter Libraries/SharpRefactory/VBConverter Plugins Plugins/CSharp Plugins/Parser Plugins/Parser/Collections Plugins/Parser/Implementations Plugins/Parser/ParserService Plugins/Parser/PersistenceLayer Plugins/Parser/ReflectionLayer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1551">[ date ]</a>
              <a href="thread.html#1551">[ thread ]</a>
              <a href="subject.html#1551">[ subject ]</a>
              <a href="author.html#1551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-patches-list">More information about the Monodevelop-patches-list
mailing list</a><br>
</body></html>
