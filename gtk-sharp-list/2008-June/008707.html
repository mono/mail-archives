<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] pixbuf/pixbufloader from stream help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20pixbuf/pixbufloader%20from%20stream%20help&In-Reply-To=484467F2.1060307%40terra.cl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008706.html">
   <LINK REL="Next"  HREF="008715.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] pixbuf/pixbufloader from stream help</H1>
    <B>Mauricio Henriquez</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20pixbuf/pixbufloader%20from%20stream%20help&In-Reply-To=484467F2.1060307%40terra.cl"
       TITLE="[Gtk-sharp-list] pixbuf/pixbufloader from stream help">mhenriquezs at terra.cl
       </A><BR>
    <I>Tue Jun  3 09:39:40 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008706.html">[Gtk-sharp-list] Strange GdkSharp.PixbufDestroyNotifyWrapper error..
</A></li>
        <LI>Next message: <A HREF="008715.html">[Gtk-sharp-list] pixbuf/pixbufloader from stream help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8707">[ date ]</a>
              <a href="thread.html#8707">[ thread ]</a>
              <a href="subject.html#8707">[ subject ]</a>
              <a href="author.html#8707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Guys:

As I explain in my previous post, right now gtk#/mono have issues about 
build a pixbuf using the byte[] contrcutor, so I 'm searching for 
alternatives, right now focused in build the pixbuf from a stream adn I 
realy need some help becouse with diferent aproach I can't get it and 
obviously I'm doing something wrong.

First I try building a PixBufLoader from a byte[] buffer:
Gdk.PixbufLoader pbL = new PixbufLoader(buffer, ImageWidth, ImageHeight);
This allways return me &quot;Image has zero width&quot;, don't know what is my 
mistake...

Second: First be sure that the stream is correct using GDI+ :-S :
BitmapData bd = bitmapBuffer.LockBits(new System.Drawing.Rectangle(0, 0, 
ImageWidth, ImageHeight),
                                           ImageLockMode.WriteOnly, 
System.Drawing.Imaging.PixelFormat.Format24bppRgb);
Marshal.Copy(buffer,0,bd.Scan0,ImageWidth*ImageHeight*3);
bitmapBuffer.UnlockBits(bd);
MemoryStream mstr = new System.IO.MemoryStream();
bitmapBuffer.Save(mstr, System.Drawing.Imaging.ImageFormat.Bmp);
..then only for test:
System.Drawing.Image returnImage = System.Drawing.Image.FromStream(mstr);
returnImage.Save(&quot;testStr.bmp&quot;);
This work, so the stream is corect

Third try: Use the memory stream to try to build the Pixbuf or the 
Pixbufloader:
Gdk.PixbufLoader pbL = new PixbufLoader(mstr, ImageWidth, ImageHeight);
or
internalPixbuf = new Pixbuf(mstr, ImageWidth, ImageHeight);
or just: Gdk.Pixbuf pb = new Pixbuf(mstr);
Allways return me &quot;GLib.GException: Unrecognized image file format&quot;

Finall test: Try to use other type to build from stream like Gtk.Image:
Gtk.Image img = new Gtk.Image(mstr);
This seems to work, but I still can't get the pixbuf from this!!!, 
img.Pixbuf return null (I supose that is becouse the image is not 
builded from a pixbuf..)...

So the question is, how can I really build a pixbuf/pixbufloader from a 
stream and/or get the PixBuf from a Gtk.Image that was builded from a 
stream?

Please, please I really need some help here, this is driving me crazy, I 
need to get working this widget, previously in mono-1.2.6 I I only use 
ONE line to so this:

internalPixbuf = new Pixbuf(buffer, Colorspace.Rgb, false, 8, 
ImageWidth, ImageHeight, ImageWidth * 3, null); //buffer of byte[] type

I know with the &quot;byte[]&quot; bug/problem I really need an alternative, and I 
know that is posible to build this thing from a stream so please give 
any sugestion..

In advance, thank you very much...

Mauricio

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008706.html">[Gtk-sharp-list] Strange GdkSharp.PixbufDestroyNotifyWrapper error..
</A></li>
	<LI>Next message: <A HREF="008715.html">[Gtk-sharp-list] pixbuf/pixbufloader from stream help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8707">[ date ]</a>
              <a href="thread.html#8707">[ thread ]</a>
              <a href="subject.html#8707">[ subject ]</a>
              <a href="author.html#8707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
