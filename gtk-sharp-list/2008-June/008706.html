<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Strange GdkSharp.PixbufDestroyNotifyWrapper error..
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Strange%20GdkSharp.PixbufDestroyNotifyWrapper%20error..&In-Reply-To=930bfd5c0805311159y6e4aeee7x2fe82a794d4189f6%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008719.html">
   <LINK REL="Next"  HREF="008707.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Strange GdkSharp.PixbufDestroyNotifyWrapper error..</H1>
    <B>Mauricio Henriquez</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Strange%20GdkSharp.PixbufDestroyNotifyWrapper%20error..&In-Reply-To=930bfd5c0805311159y6e4aeee7x2fe82a794d4189f6%40mail.gmail.com"
       TITLE="[Gtk-sharp-list] Strange GdkSharp.PixbufDestroyNotifyWrapper error..">mhenriquezs at terra.cl
       </A><BR>
    <I>Mon Jun  2 17:36:50 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008719.html">[Gtk-sharp-list] Bindings troubles on Windows when	conecting	gsignals
</A></li>
        <LI>Next message: <A HREF="008707.html">[Gtk-sharp-list] pixbuf/pixbufloader from stream help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8706">[ date ]</a>
              <a href="thread.html#8706">[ thread ]</a>
              <a href="subject.html#8706">[ subject ]</a>
              <a href="author.html#8706">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys:

In a custom widget I use a pixbuf to update the image of the widget, I use:

internalPixbuf = new Pixbuf(buffer, Colorspace.Rgb, false, 8, 
ImageWidth, ImageHeight, ImageWidth * 3, null); //buffer of byte[]
but the app crash with:

ExcObject: System.InvalidProgramException: Invalid IL code in (wrapper 
native-to-managed) GdkSharp.PixbufDestroyNotifyWrapper:NativeCallback 
(intptr,intptr): IL_0030: call      0x00000006
 at (wrapper managed-to-native) 
System.Object:__icall_wrapper_mono_delegate_to_ftnptr (object)
at (wrapper managed-to-native) Gdk.Pixbuf:gdk_pixbuf_new_from_data 
(byte[],int,bool,int,int,int,int,GdkSharp.PixbufDestroyNotifyNative,intptr)
 at Gdk.Pixbuf..ctor (System.Byte[] data, Colorspace colorspace, Boolean 
has_alpha, Int32 bits_per_sample, Int32 width, Int32 height, Int32 
rowstride, Gdk.PixbufDestroyNotify destroy_fn) [0x00000]

I use GLib.ExceptionManager.UnhandledException to get that info :-S ...

The weird thing is that with exactly the same code with mono-1.2.6 work 
like a charm and now the problem show up after a update to 
mono-1.9.1-3.1...

Mike, from mono-devel mailing list tell me that this is a &quot;know issue&quot; 
(<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=362951">https://bugzilla.novell.com/show_bug.cgi?id=362951</A>), from that thread I 
read about a &quot;problem with the image&quot; (in my case a total crash..) and 
also talk about some patch and some fix needed in mono about the 
&quot;MarchalAs..&quot; for the byte[] type and the GC, but I'm really confuse if 
this is something that can be fixed (update soources from 
svn+patch+compilation don't seems to be a &quot;easy&quot; option) with other 
approach?
Also I try to use the PixbufLoader, but trying to build the pixbufloader 
with the (byte[], widht, height) constructor allways give me &quot;Image with 
zero width&quot; error..:-S, also try to use a MemoryStream to build the 
pixbufloader and the pixbuf with the same result..

there is some alternative?, is dificult to me to belive that this can't 
be handled in a diferent way, not posible to build the pixbuf beside a 
image from harddrive?, I use this custom widget with mono-1.2.6 (and the 
related version of gtk#) without any problem, and wait for a next RPM 
release for my fedora 8 is not a option for me...need to go back to 
mono-1.2.6?

any ideas?, sugestions?, prays?. black magic?, budu?

Thanks.

Mauricio

P.D: right now I'm using gtk-sharp2-100145-0.suse103.novell ..but same 
problem...

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008719.html">[Gtk-sharp-list] Bindings troubles on Windows when	conecting	gsignals
</A></li>
	<LI>Next message: <A HREF="008707.html">[Gtk-sharp-list] pixbuf/pixbufloader from stream help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8706">[ date ]</a>
              <a href="thread.html#8706">[ thread ]</a>
              <a href="subject.html#8706">[ subject ]</a>
              <a href="author.html#8706">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
