<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Updating a GUI widget from an async thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=Re%3A%20%5BGtk-sharp-list%5D%20Updating%20a%20GUI%20widget%20from%20an%20async%20thread&In-Reply-To=%3C1364999743686-4659218.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011238.html">
   <LINK REL="Next"  HREF="011225.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Updating a GUI widget from an async thread</H1>
    <B>neilt</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=Re%3A%20%5BGtk-sharp-list%5D%20Updating%20a%20GUI%20widget%20from%20an%20async%20thread&In-Reply-To=%3C1364999743686-4659218.post%40n4.nabble.com%3E"
       TITLE="[Gtk-sharp-list] Updating a GUI widget from an async thread">neilt at illinois.edu
       </A><BR>
    <I>Wed Apr  3 14:35:43 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="011238.html">[Gtk-sharp-list] Fonts in TreeView
</A></li>
        <LI>Next message: <A HREF="011225.html">[Gtk-sharp-list] Getting frames from a GIF animation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11224">[ date ]</a>
              <a href="thread.html#11224">[ thread ]</a>
              <a href="subject.html#11224">[ subject ]</a>
              <a href="author.html#11224">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I'm having trouble getting the output from a command line program to appear
in the main window of a form. For simplicity I'm just trying to get it to
appear in a label for now. When I run the function RunIt nothing from stdout
of the child process appears in the label, but ConsoleWriteline seems to
pick it up just fine. When it gets down to the while loop it updates the
label perfectly fine.

I've also noticed that the form seems to be locked while the child process
is running. When I was just using BackgroundWorker without
Application.Invoke the form updated from the child process and the while
loop, but the update was spotty and the application crashed sporadically.

Any suggestions are appreciated.

Thanks

namespace windowtest
{
public partial class MainWindow: Gtk.Window
{
    public MainWindow (): base (Gtk.WindowType.Toplevel)
    {
         Build ();
    }

    protected void OnDeleteEvent (object sender, DeleteEventArgs a)
    {
        Application.Quit ();
        a.RetVal = true;
    }

        public void RunIt ()
        {
            string prog = @&quot;C:/Program Files (x86)/Program/Program.exe&quot;;
            // Start the child process.
            System.Diagnostics.Process p = new System.Diagnostics.Process();
            p.StartInfo.UseShellExecute = false;
            p.StartInfo.Arguments = &quot;Program Arguments&quot;;
            p.StartInfo.RedirectStandardOutput = true;
            p.StartInfo.FileName = prog;
            p.StartInfo.CreateNoWindow = true;
            p.EnableRaisingEvents = true;
            // Redirect the output stream of the child process.
            p.OutputDataReceived += new DataReceivedEventHandler(
                delegate(object sender, DataReceivedEventArgs e)
                {
                    if (!String.IsNullOrEmpty(e.Data))
                    {
                        lblTest.Text = e.Data;
                        while (Gtk.Application.EventsPending ())
                            Gtk.Application.RunIteration ();
                        Console.WriteLine(e.Data);
                    }
                }
            );
            p.Start();
            p.BeginOutputReadLine();
            p.WaitForExit();
            p.Close();
            int i = 0;
            while (i &lt; 20)
            {
                lblTest.Text = i.ToString();
                while (Gtk.Application.EventsPending ())
                    Gtk.Application.RunIteration ();
                Console.WriteLine(i.ToString());
                i++;
                System.Threading.Thread.Sleep (100);
            }
            lblTest.Text = &quot;Test&quot;;
        }

        protected void OnButton4Clicked (object sender, EventArgs e)
        {
            System.ComponentModel.BackgroundWorker bw = new
System.ComponentModel.BackgroundWorker();
            bw.WorkerSupportsCancellation = true;
            bw.DoWork += new
System.ComponentModel.DoWorkEventHandler(TestInvoke);
            if (bw.IsBusy != true)
            {
                bw.RunWorkerAsync();
            }
        }
        private void TestInvoke(object sender,
System.ComponentModel.DoWorkEventArgs e)
        {
            Application.Invoke(delegate{ RunIt(); });
        }
}
}




--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Updating-a-GUI-widget-from-an-async-thread-tp4659218.html">http://mono.1490590.n4.nabble.com/Updating-a-GUI-widget-from-an-async-thread-tp4659218.html</A>
Sent from the Mono - Gtk# mailing list archive at Nabble.com.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011238.html">[Gtk-sharp-list] Fonts in TreeView
</A></li>
	<LI>Next message: <A HREF="011225.html">[Gtk-sharp-list] Getting frames from a GIF animation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11224">[ date ]</a>
              <a href="thread.html#11224">[ thread ]</a>
              <a href="subject.html#11224">[ subject ]</a>
              <a href="author.html#11224">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
