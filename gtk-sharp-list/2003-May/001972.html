<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Upcoming problems.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rachel%40nullenvoid.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001970.html">
   <LINK REL="Next"  HREF="001973.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Upcoming problems.
   </H1>
    <B>Rachel Hestilow
    </B> 
    <A HREF="mailto:rachel%40nullenvoid.com"
       TITLE="[Gtk-sharp-list] Upcoming problems.">rachel@nullenvoid.com
       </A><BR>
    <I>27 May 2003 16:33:07 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="001970.html">[Gtk-sharp-list] Upcoming problems.
</A></li>
        <LI> Next message: <A HREF="001973.html">[Gtk-sharp-list] Upcoming problems.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1972">[ date ]</a>
              <a href="thread.html#1972">[ thread ]</a>
              <a href="subject.html#1972">[ subject ]</a>
              <a href="author.html#1972">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-ZNVpocReCl/xiwer8ysT
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Tue, 2003-05-27 at 11:41, Mike Kestner wrote:
&gt;<i> Surely there are not 162 instances of const char * returns.  It seems to
</I>&gt;<i> me like the majority of string returns in gtk are owned by the caller.=20
</I>&gt;<i> We should only be changing the DllImports for those that aren't owned by
</I>&gt;<i> us.
</I>&gt;<i>=20
</I>&gt;<i> So that is going to require an audit of those API calls and some tagging
</I>&gt;<i> in the XML. Otherwise, we are going to leak all the owned strings. It
</I>&gt;<i> should be a pretty small change to the generator to handle a tag like
</I>&gt;<i> that.
</I>&gt;<i>=20
</I>&gt;<i> &gt; I've got some free time so I'll see if I can fix this tonight. Mike, I
</I>&gt;<i> &gt; know you had some more pending changes to the generator, so sorry in
</I>&gt;<i> &gt; advance if I cause any conflicts :-).
</I>&gt;<i>=20
</I>&gt;<i> If you have the time, great.  This will most likely be isolated to
</I>&gt;<i> Method.cs, and I don't think I've changed it much, if at all.
</I>&gt;<i>=20
</I>
I haven't committed my changes yet, but I think it's actually far
simpler than that for the autogenerated code. Here is what I did:

1) I created a new ConstStringGen class which sets MarshalReturnType to
IntPtr and outputs a call to PtrToStringAuto in FromNativeReturn.
2) I updated SymbolTable to use ConstStringGen for the const-char and
const-gchar cases. I also had to add a small hack in Trim to not remove
the const in this case (as otherwise it would go to the regular string
SimpleGen).

Combined with an audit of the glue, glib, and .custom sources, we're
left with 50 other functions which, on cursory glance, all return new
strings. So no metadata hacking is required.

All in all, I'm impressed with the generator refactoring, the actual
generator modifications only took half an hour. Kudos on the great
design, Mike.

Shall I commit?

-- Rachel



--=-ZNVpocReCl/xiwer8ysT
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.7 (GNU/Linux)

iD8DBQA+09mRapOJdUj74F4RArYcAJ9H3z+DED+nN8x4i2lADY9qk6M2pACg3FmB
ICKOz/64U8ylLC8DRBWJEqw=
=RbxC
-----END PGP SIGNATURE-----

--=-ZNVpocReCl/xiwer8ysT--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001970.html">[Gtk-sharp-list] Upcoming problems.
</A></li>
	<LI> Next message: <A HREF="001973.html">[Gtk-sharp-list] Upcoming problems.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1972">[ date ]</a>
              <a href="thread.html#1972">[ thread ]</a>
              <a href="subject.html#1972">[ subject ]</a>
              <a href="author.html#1972">[ author ]</a>
         </LI>
       </UL>
</body></html>
