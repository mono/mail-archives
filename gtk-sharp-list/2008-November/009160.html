<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Medsphere.Widgets.FBox crashes with	&quot;must	provide a protected or public IntPtr ctor&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Medsphere.Widgets.FBox%20crashes%20with%0A%09%22must%09provide%20a%20protected%20or%20public%20IntPtr%20ctor%22&In-Reply-To=491048A3.3000509%40gmx.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009159.html">
   <LINK REL="Next"  HREF="009162.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Medsphere.Widgets.FBox crashes with	&quot;must	provide a protected or public IntPtr ctor&quot;</H1>
    <B>Adam Tauno Williams</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Medsphere.Widgets.FBox%20crashes%20with%0A%09%22must%09provide%20a%20protected%20or%20public%20IntPtr%20ctor%22&In-Reply-To=491048A3.3000509%40gmx.net"
       TITLE="[Gtk-sharp-list] Medsphere.Widgets.FBox crashes with	&quot;must	provide a protected or public IntPtr ctor&quot;">adam at morrison-ind.com
       </A><BR>
    <I>Tue Nov  4 09:13:01 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="009159.html">[Gtk-sharp-list] Medsphere.Widgets.FBox crashes with &quot;must provide a protected or	public IntPtr ctor&quot;
</A></li>
        <LI>Next message: <A HREF="009162.html">[Gtk-sharp-list]  Glib Could Not Be Found ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9160">[ date ]</a>
              <a href="thread.html#9160">[ thread ]</a>
              <a href="subject.html#9160">[ subject ]</a>
              <a href="author.html#9160">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; I've create a widget that extends the very cool Medsphere FBox
</I>&gt;<i> &gt; And it works for awhile.  Then it crashes with -
</I>&gt;<i> &gt; Exception in Gtk# callback delegate
</I>&gt;<i> &gt;   Note: Applications can use GLib.ExceptionManager.UnhandledException to
</I>&gt;<i> &gt; handle the exception.
</I>&gt;<i> &gt; GLib.MissingIntPtrCtorException: GLib.Object subclass
</I>&gt;<i> &gt; Whitemice.ZOGI.GtkWidgets.PhoneTable must provide a protected or public
</I>&gt;<i> &gt; IntPtr ctor to support wrapping of native object handles.
</I>&gt;<i> &gt; It seems like it happens as soon as an FBox has been disposed.  Is there
</I>&gt;<i> &gt; something different with the Medsphere widgets?  I've bene using Gtk#
</I>&gt;<i> &gt; for years and never had to deal with an IntPtr.
</I>&gt;<i> Right, this errors occurs after the FBox has been disposed. Make sure 
</I>&gt;<i> that other Gtk+ classes are not holding references to this disposed 
</I>&gt;<i> object any more, otherwise you will run into errors in the callback 
</I>&gt;<i> functions(here Gtk.Container.Forall_cb).
</I>&gt;<i> As Forall executes a function for each of the container's children the 
</I>&gt;<i> disposed FBox is probably still a child of a container; you should call 
</I>&gt;<i> container.Remove(FBox).
</I>&gt;<i> I got the same error when I was disposing a TreeModel. I had to set 
</I>&gt;<i> TreeView.Model to null to eliminate the reference to the model in the 
</I>&gt;<i> tree view.
</I>
I managed to work around it.  I created finalizers to make sure the
widgets were removed from the parent container, and even that the FBox
inherited container itself was empty.  And still got the error (although
the finalizers did run).

So I just changed my widget to inherit from viewport and to insert the
FBox into itself.  Presto, no error.

  public class PhoneTable : Viewport
  {
    Medsphere.Widgets.FBox   f;
    
    public PhoneTable(Whitemice.ZOGI.Company company) : base()
    {
      f = new Medsphere.Widgets.FBox();
      ...
    }

    ~PhoneTable()
    {
      foreach(Widget w in f)
        this.Remove(w);
      this.Remove(f);
    }
  }

-- 
          Consonance: an Open Source .NET OpenGroupware client.
 Contact:<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">awilliam at whitemiceconsulting.com</A>   <A HREF="http://freshmeat.net/projects/consonance/">http://freshmeat.net/projects/consonance/</A>

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009159.html">[Gtk-sharp-list] Medsphere.Widgets.FBox crashes with &quot;must provide a protected or	public IntPtr ctor&quot;
</A></li>
	<LI>Next message: <A HREF="009162.html">[Gtk-sharp-list]  Glib Could Not Be Found ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9160">[ date ]</a>
              <a href="thread.html#9160">[ thread ]</a>
              <a href="subject.html#9160">[ subject ]</a>
              <a href="author.html#9160">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
