<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Gtk.Entry%20and%20Gtk.TextView%20%28MERGE%3F%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008793.html">
   <LINK REL="Next"  HREF="008792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)</H1>
    <B>Draekz</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Gtk.Entry%20and%20Gtk.TextView%20%28MERGE%3F%29&In-Reply-To="
       TITLE="[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)">draekz at gmail.com
       </A><BR>
    <I>Sun Jul  6 11:09:08 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008793.html">[Gtk-sharp-list] Gtk# class library refrence or manual?
</A></li>
        <LI>Next message: <A HREF="008792.html">[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8791">[ date ]</a>
              <a href="thread.html#8791">[ thread ]</a>
              <a href="subject.html#8791">[ subject ]</a>
              <a href="author.html#8791">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey all,

We are needing to create a widget that looks like a Gtk.Entry (Blue
highlighted border when selected, and roundish shadow type border etc) yet
we need to tools provided in the TextView.

We have been able to draw a similar border around the TextView (its not 100%
but its close) but we have been unable to get it to highlight the border
blue when selected.

Could someone with more experiencing drawing custom styles etc on widgets
help us to mimic the Entry for our TextView? Any help in the right direction
would be appreciated. Below we have provided the code we have so far (keep
in mind there are a few extra tidbits in this code that have nothing to do
with what i'm asking about, but its just text tags and stuff):

----------------------------------------

public class ViewEntryWidget : Bin
{
    const int _borderSize = 2;

    bool _editing;
    string _markup;
    TextView _view;

    TextTag _tagBold = new TextTag (&quot;bold&quot;);
    TextTag _tagItalic = new TextTag (&quot;italic&quot;);
    TextTag _tagUnderline = new TextTag (&quot;underline&quot;);
    TextTag _tagStrikethrough = new TextTag (&quot;strikethrough&quot;);
    TextTag _tagUri = new TextTag (&quot;uri&quot;);

    public string Text
    {
        get { return _markup; }
    }

    public ViewEntryWidget ()
    {
        Entry entry = new Entry ();

        _view = new TextView ();
        _view.AcceptsTab = false;
        _view.BorderWidth = 3;
        _view.CursorVisible = true;
        _view.Editable = true;
        // This is going to show white instead of gray, but it should be
using the theme color, not white.
        _view.ModifyBg (StateType.Normal, new Gdk.Color (255,255,255));

        _tagBold.Weight = Weight.Bold;
        _view.Buffer.TagTable.Add (_tagBold);

        _tagItalic.Style = Pango.Style.Italic;
        _view.Buffer.TagTable.Add (_tagItalic);

        _tagUnderline.Underline = Pango.Underline.Single;
        _view.Buffer.TagTable.Add (_tagUnderline);

        _tagStrikethrough.Strikethrough = true;
        _view.Buffer.TagTable.Add (_tagStrikethrough);

        //TODO: can this be gotten from the gtk theme?
        _tagUri.ForegroundGdk = new Gdk.Color (0, 0, 255);
        _tagUri.Underline = Pango.Underline.Single;
        _view.Buffer.TagTable.Add (_tagUri);

        _view.FocusInEvent += ViewFocusIn;
        _view.FocusOutEvent += ViewFocusOut;
        _view.KeyPressEvent += ViewKeyPress;
        Add (_view);

        _markup = string.Empty;

        _editing = false;
        SetContent ();
    }

    void SetContent ()
    {
        _view.Buffer.Clear ();

        if (string.IsNullOrEmpty (_markup))
            return;

        _view.Buffer.Text = _markup;
    }

    int PangoPixels (int p)
    {
        return ((int)(p) + 512) &gt;&gt; 10;
    }

    protected override void OnSizeRequested (ref Requisition requisition)
    {
        FontMetrics metrics = _view.PangoContext.GetMetrics
(_view.Style.FontDesc, _view.PangoContext.Language);

        int charPixels = (int)((Math.Max (metrics.ApproximateCharWidth,
metrics.ApproximateDigitWidth) + Pango.Scale.PangoScale - 1) /
Pango.Scale.PangoScale);

        requisition.Width = (charPixels * _view.Buffer.Text.Length) +
(_borderSize * 2);
        requisition.Height = PangoPixels (metrics.Ascent + metrics.Descent)
+ (int)(_view.BorderWidth * 2) + (_borderSize * 2);

        //Log.Debug (&quot;Requisition = {0}x{1}&quot;, requisition.Width,
requisition.Height);

        metrics.Dispose ();
    }

    protected override void OnSizeAllocated (Gdk.Rectangle allocation)
    {
        base.OnSizeAllocated (allocation);

        _view.SizeAllocate (new Gdk.Rectangle (allocation.X + _borderSize,
allocation.Y + _borderSize,
                                               allocation.Width - (2 *
_borderSize),
                                               allocation.Height - (2 *
_borderSize)));
    }

    protected override void OnRealized ()
    {
        base.OnRealized ();

        GdkWindow.Background = Style.Base (StateType.Prelight);
    }

    protected override void OnStyleSet (Gtk.Style previous_style)
    {
        base.OnStyleSet (previous_style);

        if (IsRealized &amp;&amp; (previous_style != null))
            GdkWindow.Background = Style.Base (StateType.Normal);
    }

    protected override bool OnExposeEvent (Gdk.EventExpose evnt)
    {
        //Gtk.Style.PaintFlatBox (Style, evnt.Window, StateType.Normal,
ShadowType.None, Allocation, this, &quot;entry_bg&quot;,
        //                        Allocation.X, Allocation.Y,
Allocation.Width, Allocation.Height);

        Gtk.Style.PaintShadow (Style, evnt.Window, StateType.Normal,
ShadowType.In, Allocation, this, &quot;entry&quot;,
                               Allocation.X, Allocation.Y, Allocation.Width,
Allocation.Height);

        //TODO: focus

        PropagateExpose (_view, evnt);

        return false;
    }

    void ViewFocusIn (object sender, FocusInEventArgs args)
    {
        QueueDraw ();

        if (!_editing)
        {
            _editing = true;
            SetContent ();
        }
    }

    void ViewFocusOut (object sender, FocusOutEventArgs args)
    {
        QueueDraw ();

        if (_editing)
        {
            _editing = false;
            _markup = _view.Buffer.Text;
            SetContent ();
        }
    }

    [GLib.ConnectBefore]
    void ViewKeyPress (object sender, KeyPressEventArgs args)
    {
        if (args.Event.Key == Gdk.Key.Return || args.Event.Key ==
Gdk.Key.KP_Enter)
        {
            // Treat enter as tab

            Toplevel.ChildFocus (DirectionType.TabForward);
            args.RetVal = true;
        }
    }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20080706/2e6cc446/attachment.html">http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20080706/2e6cc446/attachment.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008793.html">[Gtk-sharp-list] Gtk# class library refrence or manual?
</A></li>
	<LI>Next message: <A HREF="008792.html">[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8791">[ date ]</a>
              <a href="thread.html#8791">[ thread ]</a>
              <a href="subject.html#8791">[ subject ]</a>
              <a href="author.html#8791">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
