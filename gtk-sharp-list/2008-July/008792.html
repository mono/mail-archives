<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Gtk.Entry%20and%20Gtk.TextView%20%28MERGE%3F%29&In-Reply-To=b4deeed20807060809r1b804164ya598bb2ffe46debf%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008791.html">
   <LINK REL="Next"  HREF="008795.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)</H1>
    <B>Christian Hoff</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Gtk.Entry%20and%20Gtk.TextView%20%28MERGE%3F%29&In-Reply-To=b4deeed20807060809r1b804164ya598bb2ffe46debf%40mail.gmail.com"
       TITLE="[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)">christian_hoff at gmx.net
       </A><BR>
    <I>Sun Jul  6 12:42:27 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008791.html">[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)
</A></li>
        <LI>Next message: <A HREF="008795.html">[Gtk-sharp-list] Override of GtkContainerClass::remove
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8792">[ date ]</a>
              <a href="thread.html#8792">[ thread ]</a>
              <a href="subject.html#8792">[ subject ]</a>
              <a href="author.html#8792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Since this is a topic that most Gtk# developers(including me) are not 
familiar with, it might be best to write a mail to one of the Gtk+ 
mailing lists(<A HREF="http://www.gtk.org/mailing-lists.html">http://www.gtk.org/mailing-lists.html</A>) or to have a look 
at the Gtk+ documentation.

Christian

Draekz schrieb:
&gt;<i> Hey all,
</I>&gt;<i>
</I>&gt;<i> We are needing to create a widget that looks like a Gtk.Entry (Blue 
</I>&gt;<i> highlighted border when selected, and roundish shadow type border etc) 
</I>&gt;<i> yet we need to tools provided in the TextView.
</I>&gt;<i>
</I>&gt;<i> We have been able to draw a similar border around the TextView (its 
</I>&gt;<i> not 100% but its close) but we have been unable to get it to highlight 
</I>&gt;<i> the border blue when selected.
</I>&gt;<i>
</I>&gt;<i> Could someone with more experiencing drawing custom styles etc on 
</I>&gt;<i> widgets help us to mimic the Entry for our TextView? Any help in the 
</I>&gt;<i> right direction would be appreciated. Below we have provided the code 
</I>&gt;<i> we have so far (keep in mind there are a few extra tidbits in this 
</I>&gt;<i> code that have nothing to do with what i'm asking about, but its just 
</I>&gt;<i> text tags and stuff):
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------
</I>&gt;<i>
</I>&gt;<i> public class ViewEntryWidget : Bin
</I>&gt;<i> {
</I>&gt;<i>     const int _borderSize = 2;
</I>&gt;<i>    
</I>&gt;<i>     bool _editing;
</I>&gt;<i>     string _markup;
</I>&gt;<i>     TextView _view;
</I>&gt;<i>    
</I>&gt;<i>     TextTag _tagBold = new TextTag (&quot;bold&quot;);
</I>&gt;<i>     TextTag _tagItalic = new TextTag (&quot;italic&quot;);
</I>&gt;<i>     TextTag _tagUnderline = new TextTag (&quot;underline&quot;);
</I>&gt;<i>     TextTag _tagStrikethrough = new TextTag (&quot;strikethrough&quot;);
</I>&gt;<i>     TextTag _tagUri = new TextTag (&quot;uri&quot;);
</I>&gt;<i>    
</I>&gt;<i>     public string Text
</I>&gt;<i>     {
</I>&gt;<i>         get { return _markup; }
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     public ViewEntryWidget ()
</I>&gt;<i>     {
</I>&gt;<i>         Entry entry = new Entry ();
</I>&gt;<i>        
</I>&gt;<i>         _view = new TextView ();
</I>&gt;<i>         _view.AcceptsTab = false;
</I>&gt;<i>         _view.BorderWidth = 3;
</I>&gt;<i>         _view.CursorVisible = true;
</I>&gt;<i>         _view.Editable = true;
</I>&gt;<i>         // This is going to show white instead of gray, but it should 
</I>&gt;<i> be using the theme color, not white.
</I>&gt;<i>         _view.ModifyBg (StateType.Normal, new Gdk.Color (255,255,255));
</I>&gt;<i>        
</I>&gt;<i>         _tagBold.Weight = Weight.Bold;
</I>&gt;<i>         _view.Buffer.TagTable.Add (_tagBold);
</I>&gt;<i>
</I>&gt;<i>         _tagItalic.Style = Pango.Style.Italic;
</I>&gt;<i>         _view.Buffer.TagTable.Add (_tagItalic);
</I>&gt;<i>        
</I>&gt;<i>         _tagUnderline.Underline = Pango.Underline.Single;
</I>&gt;<i>         _view.Buffer.TagTable.Add (_tagUnderline);
</I>&gt;<i>        
</I>&gt;<i>         _tagStrikethrough.Strikethrough = true;
</I>&gt;<i>         _view.Buffer.TagTable.Add (_tagStrikethrough);
</I>&gt;<i>        
</I>&gt;<i>         //TODO: can this be gotten from the gtk theme?
</I>&gt;<i>         _tagUri.ForegroundGdk = new Gdk.Color (0, 0, 255);
</I>&gt;<i>         _tagUri.Underline = Pango.Underline.Single;
</I>&gt;<i>         _view.Buffer.TagTable.Add (_tagUri);
</I>&gt;<i>        
</I>&gt;<i>         _view.FocusInEvent += ViewFocusIn;
</I>&gt;<i>         _view.FocusOutEvent += ViewFocusOut;
</I>&gt;<i>         _view.KeyPressEvent += ViewKeyPress;
</I>&gt;<i>         Add (_view);
</I>&gt;<i>        
</I>&gt;<i>         _markup = string.Empty;
</I>&gt;<i>        
</I>&gt;<i>         _editing = false;
</I>&gt;<i>         SetContent ();
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     void SetContent ()
</I>&gt;<i>     {
</I>&gt;<i>         _view.Buffer.Clear ();
</I>&gt;<i>        
</I>&gt;<i>         if (string.IsNullOrEmpty (_markup))
</I>&gt;<i>             return;
</I>&gt;<i>        
</I>&gt;<i>         _view.Buffer.Text = _markup;
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     int PangoPixels (int p)
</I>&gt;<i>     {
</I>&gt;<i>         return ((int)(p) + 512) &gt;&gt; 10;
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     protected override void OnSizeRequested (ref Requisition requisition)
</I>&gt;<i>     {
</I>&gt;<i>         FontMetrics metrics = _view.PangoContext.GetMetrics 
</I>&gt;<i> (_view.Style.FontDesc, _view.PangoContext.Language);
</I>&gt;<i>        
</I>&gt;<i>         int charPixels = (int)((Math.Max 
</I>&gt;<i> (metrics.ApproximateCharWidth, metrics.ApproximateDigitWidth) + 
</I>&gt;<i> Pango.Scale.PangoScale - 1) / Pango.Scale.PangoScale);
</I>&gt;<i>        
</I>&gt;<i>         requisition.Width = (charPixels * _view.Buffer.Text.Length) + 
</I>&gt;<i> (_borderSize * 2);
</I>&gt;<i>         requisition.Height = PangoPixels (metrics.Ascent + 
</I>&gt;<i> metrics.Descent) + (int)(_view.BorderWidth * 2) + (_borderSize * 2);
</I>&gt;<i>        
</I>&gt;<i>         //Log.Debug (&quot;Requisition = {0}x{1}&quot;, requisition.Width, 
</I>&gt;<i> requisition.Height);
</I>&gt;<i>        
</I>&gt;<i>         metrics.Dispose ();
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     protected override void OnSizeAllocated (Gdk.Rectangle allocation)
</I>&gt;<i>     {
</I>&gt;<i>         base.OnSizeAllocated (allocation);
</I>&gt;<i>        
</I>&gt;<i>         _view.SizeAllocate (new Gdk.Rectangle (allocation.X + 
</I>&gt;<i> _borderSize, allocation.Y + _borderSize,
</I>&gt;<i>                                                allocation.Width - (2 * 
</I>&gt;<i> _borderSize),
</I>&gt;<i>                                                allocation.Height - (2 
</I>&gt;<i> * _borderSize)));
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     protected override void OnRealized ()
</I>&gt;<i>     {
</I>&gt;<i>         base.OnRealized ();
</I>&gt;<i>        
</I>&gt;<i>         GdkWindow.Background = Style.Base (StateType.Prelight);
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     protected override void OnStyleSet (Gtk.Style previous_style)
</I>&gt;<i>     {
</I>&gt;<i>         base.OnStyleSet (previous_style);
</I>&gt;<i>        
</I>&gt;<i>         if (IsRealized &amp;&amp; (previous_style != null))
</I>&gt;<i>             GdkWindow.Background = Style.Base (StateType.Normal);
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     protected override bool OnExposeEvent (Gdk.EventExpose evnt)
</I>&gt;<i>     {
</I>&gt;<i>         //Gtk.Style.PaintFlatBox (Style, evnt.Window, 
</I>&gt;<i> StateType.Normal, ShadowType.None, Allocation, this, &quot;entry_bg&quot;,
</I>&gt;<i>         //                        Allocation.X, Allocation.Y, 
</I>&gt;<i> Allocation.Width, Allocation.Height);
</I>&gt;<i>        
</I>&gt;<i>         Gtk.Style.PaintShadow (Style, evnt.Window, StateType.Normal, 
</I>&gt;<i> ShadowType.In, Allocation, this, &quot;entry&quot;,
</I>&gt;<i>                                Allocation.X, Allocation.Y, 
</I>&gt;<i> Allocation.Width, Allocation.Height);
</I>&gt;<i>        
</I>&gt;<i>         //TODO: focus
</I>&gt;<i>        
</I>&gt;<i>         PropagateExpose (_view, evnt);
</I>&gt;<i>        
</I>&gt;<i>         return false;
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     void ViewFocusIn (object sender, FocusInEventArgs args)
</I>&gt;<i>     {
</I>&gt;<i>         QueueDraw ();
</I>&gt;<i>        
</I>&gt;<i>         if (!_editing)
</I>&gt;<i>         {
</I>&gt;<i>             _editing = true;
</I>&gt;<i>             SetContent ();
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     void ViewFocusOut (object sender, FocusOutEventArgs args)
</I>&gt;<i>     {
</I>&gt;<i>         QueueDraw ();
</I>&gt;<i>        
</I>&gt;<i>         if (_editing)
</I>&gt;<i>         {
</I>&gt;<i>             _editing = false;
</I>&gt;<i>             _markup = _view.Buffer.Text;
</I>&gt;<i>             SetContent ();
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>    
</I>&gt;<i>     [GLib.ConnectBefore]
</I>&gt;<i>     void ViewKeyPress (object sender, KeyPressEventArgs args)
</I>&gt;<i>     {
</I>&gt;<i>         if (args.Event.Key == Gdk.Key.Return || args.Event.Key == 
</I>&gt;<i> Gdk.Key.KP_Enter)
</I>&gt;<i>         {
</I>&gt;<i>             // Treat enter as tab
</I>&gt;<i>            
</I>&gt;<i>             Toplevel.ChildFocus (DirectionType.TabForward);
</I>&gt;<i>             args.RetVal = true;
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Gtk-sharp-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">Gtk-sharp-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>
</I>&gt;<i>   
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008791.html">[Gtk-sharp-list] Gtk.Entry and Gtk.TextView (MERGE?)
</A></li>
	<LI>Next message: <A HREF="008795.html">[Gtk-sharp-list] Override of GtkContainerClass::remove
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8792">[ date ]</a>
              <a href="thread.html#8792">[ thread ]</a>
              <a href="subject.html#8792">[ subject ]</a>
              <a href="author.html#8792">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
