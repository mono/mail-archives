<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Convenience method for creating windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:federico%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="004870.html">
   <LINK REL="Next"  HREF="004869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Convenience method for creating windows
   </H1>
    <B>Federico Mena Quintero
    </B> 
    <A HREF="mailto:federico%40ximian.com"
       TITLE="[Gtk-sharp-list] Convenience method for creating windows">federico@ximian.com
       </A><BR>
    <I>Fri, 24 Sep 2004 12:50:45 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="004870.html">[Gtk-sharp-list] DataGrid like widget
</A></li>
        <LI> Next message: <A HREF="004869.html">[Gtk-sharp-list] Convenience method for creating windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4868">[ date ]</a>
              <a href="thread.html#4868">[ thread ]</a>
              <a href="subject.html#4868">[ subject ]</a>
              <a href="author.html#4868">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Right now, creating a Gdk.Window for a widget is a lot of work:

class MyWidget : Widget {
	protected override void OnRealized ()
	{
		WindowAttr attr;
		int attr_mask;

		base.OnRealized ();

		SetFlag (WidgetFlags.Realized);

		attr.WindowType = WindowType.Child;
		attr.X = Allocation.X;
		attr.Y = Allocation.Y;
		attr.Width = Allocation.Width;
		attr.Height = Allocation.Height;
		attr.Wclass = WindowClass.InputOutput;
		attr.Visual = Visual;
		attr.Colormap = Colormap;
		attr.EventMask = (Events |
				  EventMask.ExposureMask |
				  EventMask.ButtonPressMask |
				  EventMask.ButtonReleaseMask |
				  EventMask.PointerMotionMask |
				  EventMask.ScrollMask);

		attr_mask = (WindowAttributesType.X |
			     WindowAttributesType.Y |
			     WindowAttributesType.Visual |
			     WindowAttributesType.Colormap);

		GdkWindow = new Gdk.Window (ParentWindow, attr, attr_mask);
		GdkWindow.UserData = this.Handle;
	}
}

This is a lot of work, and has several flaky points:

1. Setting up the WindowAttr struct is painful, and you have to
coordinate it with the attr_mask.

2. You must remember to set the UserData of the window to
MyWidget.Handle; otherwise you won't get events from it.

Would it be good to have a convenience method for Widget:

namespace Gtk {
  public class Widget : ... {
    public Gdk.Window CreateSubwindow (Gdk.Window parent,
                                       int x, int y, 
                                       int width, int height,
                                       bool is_input_output,
                                       int extra_event_mask)
    {
            WindowAttr attr;
            int attr_mask;
            Gdk.Window window;

            if (parent == null)
                    throw new ArgumentNullException (&quot;parent&quot;);

	    if (width &lt; 1)
                    throw new ArgumentOutOfRangeException (&quot;width&quot;, width, &quot;must be greater than zero&quot;);

	    if (height &lt; 1)
                    throw new ArgumentOutOfRangeException (&quot;height&quot;, height, &quot;must be greater than zero&quot;);

            attr_mask = WindowAttributesType.X | WindowAttributesType.Y;

            attr.WindowType = WindowType.Child;
            attr.X = x;
            attr.Y = y;
            attr.Width = width;
            attr.Height = height;
            attr.EventMask = this.Events | extra_event_mask;
            
            if (is_input_output) {
                    attr.Wclass = WindowClass.InputOutput;
                    attr.Visual = this.Visual;
                    attr.Colormap = this.Colormap;
                    attr_mask |= WindowAttributesType.Visual | WindowAttributesType.Colormap;
            } else
                    attr.Wclass = WindowClass.InputOnly;

            window = new Gdk.Window (parent, attr, attr_mask);
            window.UserData = this.Handle;

            return window;
    }
}

With that, writing a realize method would be as simple as this:

class MyWidget : Widget {
	protected override void OnRealized ()
	{
                base.OnRealized ();
		SetFlag (WidgetFlags.Realized);

		GdkWindow = CreateSubwindow (ParentWindow,
                                             Allocation.X, Allocation.Y,
                                             Allocation.Width, Allocation.Height,
                                             true,
                                             (EventMask.ExposureMask |
                                              EventMask.ButtonPressMask |
				              EventMask.ButtonReleaseMask |
				              EventMask.PointerMotionMask |
				              EventMask.ScrollMask));
	}
}

If one needs to do exotic stuff like using a different visual/colormap,
or a non-default cursor, one can create the window by hand.

What do people think?  Would this be a useful addition?

  Federico


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="004870.html">[Gtk-sharp-list] DataGrid like widget
</A></li>
	<LI> Next message: <A HREF="004869.html">[Gtk-sharp-list] Convenience method for creating windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4868">[ date ]</a>
              <a href="thread.html#4868">[ thread ]</a>
              <a href="subject.html#4868">[ subject ]</a>
              <a href="author.html#4868">[ author ]</a>
         </LI>
       </UL>
</body></html>
