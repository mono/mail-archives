<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] unused g_signal_connect_data parameters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:danecek%40ucl.cas.cz">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001142.html">
   <LINK REL="Next"  HREF="001152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] unused g_signal_connect_data parameters
   </H1>
    <B>Petr Danecek
    </B> 
    <A HREF="mailto:danecek%40ucl.cas.cz"
       TITLE="[Gtk-sharp-list] unused g_signal_connect_data parameters">danecek@ucl.cas.cz
       </A><BR>
    <I>26 Feb 2003 14:03:16 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="001142.html">[Gtk-sharp-list] Popu window
</A></li>
        <LI> Next message: <A HREF="001152.html">[Gtk-sharp-list] Bonobo?  CORBA?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1151">[ date ]</a>
              <a href="thread.html#1151">[ thread ]</a>
              <a href="subject.html#1151">[ subject ]</a>
              <a href="author.html#1151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-a6FMhdg8u2UuqqQ4q+rK
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hello everybody,
I'd like to discuss the following problem concerning signal handlers in 
gtk#. 

So far the autogenerated handlers (such as
voidObjectTextIterstringintSignal) use for the argument &quot;flags&quot; to
g_signal_connect_data a default value 0. I think that it would be
helpful to pass other values as well - G_CONNECT_AFTER, for instance.

Now, how to do this? Bellow is my patch to generator/Signal.cs,
generator/SignalHandler.cs and api/gtk-api.xml. Obviously, the thing
needs to be done differently, because 1) gtk-api.xml is autogenerated
and 2) my solution takes advantage of xml attribute &quot;when&quot;, which seems
to be unused, but which purpose I do not know.

What do you think?
Petr



--=-a6FMhdg8u2UuqqQ4q+rK
Content-Disposition: attachment; filename=file.diff
Content-Type: text/x-patch; name=file.diff; charset=ISO-8859-2
Content-Transfer-Encoding: 7bit

Index: api/gtk-api.xml
===================================================================
RCS file: /cvs/public/gtk-sharp/api/gtk-api.xml,v
retrieving revision 1.26
diff -u -U2 -r1.26 gtk-api.xml
--- api/gtk-api.xml	22 Feb 2003 04:34:55 -0000	1.26
+++ api/gtk-api.xml	26 Feb 2003 12:56:09 -0000
@@ -6233,4 +6233,13 @@
         &lt;/parameters&gt;
       &lt;/signal&gt;
+      &lt;signal name=&quot;InsertTextAfter&quot; cname=&quot;insert_text&quot; when=&quot;AFTER&quot;&gt;
+        &lt;return-type type=&quot;void&quot;/&gt;
+        &lt;parameters&gt;
+          &lt;parameter type=&quot;GtkTextBuffer*&quot; name=&quot;buffer&quot;/&gt;
+          &lt;parameter type=&quot;GtkTextIter*&quot; name=&quot;pos&quot;/&gt;
+          &lt;parameter type=&quot;const-gchar*&quot; name=&quot;text&quot;/&gt;
+          &lt;parameter type=&quot;gint&quot; name=&quot;length&quot;/&gt;
+        &lt;/parameters&gt;
+      &lt;/signal&gt;
       &lt;signal name=&quot;PixbufInserted&quot; cname=&quot;insert_pixbuf&quot; when=&quot;LAST&quot;&gt;
         &lt;return-type type=&quot;void&quot;/&gt;
Index: generator/Signal.cs
===================================================================
RCS file: /cvs/public/gtk-sharp/generator/Signal.cs,v
retrieving revision 1.13
diff -u -U2 -r1.13 Signal.cs
--- generator/Signal.cs	26 Feb 2003 02:16:38 -0000	1.13
+++ generator/Signal.cs	26 Feb 2003 12:56:09 -0000
@@ -164,5 +164,8 @@
 			if (argsname != &quot;System.EventArgs&quot;)
 				sw.Write(&quot;,&quot; + container_type.NS.ToLower() + &quot;-sharp&quot;);
-			sw.WriteLine(&quot;\&quot;));\n\t\t\t\telse&quot;);
+			sw.Write(&quot;\&quot;)&quot;);
+			if ( this.elem.GetAttribute(&quot;when&quot;) == &quot;AFTER&quot; )
+				sw.Write(&quot;, 1&quot;);
+			sw.WriteLine(&quot;);\n\t\t\t\telse&quot;);
 			sw.WriteLine(&quot;\t\t\t\t\t((GtkSharp.SignalCallback) Signals [{0}]).AddDelegate (value);&quot;, cname);
 			sw.WriteLine(&quot;\t\t\t\tEventList.AddHandler(&quot; + cname + &quot;, value);&quot;);
Index: generator/SignalHandler.cs
===================================================================
RCS file: /cvs/public/gtk-sharp/generator/SignalHandler.cs,v
retrieving revision 1.21
diff -u -U2 -r1.21 SignalHandler.cs
--- generator/SignalHandler.cs	26 Feb 2003 02:16:38 -0000	1.21
+++ generator/SignalHandler.cs	26 Feb 2003 12:56:09 -0000
@@ -182,4 +182,15 @@
 			sw.WriteLine(&quot;\t\t}&quot;);
 			sw.WriteLine();
+			sw.Write(&quot;\t\tpublic &quot; + sname + &quot;(GLib.Object obj, IntPtr raw, &quot;);
+			sw.WriteLine(&quot;String name, Delegate eh, Type argstype, int flags) : base(obj, eh, argstype)&quot;);
+			sw.WriteLine(&quot;\t\t{&quot;);
+			sw.WriteLine(&quot;\t\t\tif (_Delegate == null) {&quot;);
+			sw.WriteLine(&quot;\t\t\t\t_Delegate = new &quot; + dname + &quot;(&quot; + cbname + &quot;);&quot;);
+			sw.WriteLine(&quot;\t\t\t}&quot;);
+			sw.WriteLine(&quot;\t\t\t_raw = raw;&quot;);
+			sw.Write(&quot;\t\t\t_HandlerID = g_signal_connect_data(raw, name, &quot;);
+			sw.WriteLine(&quot;_Delegate, _key, new IntPtr(0), flags);&quot;);
+			sw.WriteLine(&quot;\t\t}&quot;);
+			sw.WriteLine();
 			sw.WriteLine(&quot;\t\t[DllImport(\&quot;libgobject-2.0-0.dll\&quot;)]&quot;);
 			sw.WriteLine(&quot;\t\tstatic extern void g_signal_handler_disconnect (IntPtr instance, uint handler);&quot;);

--=-a6FMhdg8u2UuqqQ4q+rK--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001142.html">[Gtk-sharp-list] Popu window
</A></li>
	<LI> Next message: <A HREF="001152.html">[Gtk-sharp-list] Bonobo?  CORBA?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1151">[ date ]</a>
              <a href="thread.html#1151">[ thread ]</a>
              <a href="subject.html#1151">[ subject ]</a>
              <a href="author.html#1151">[ author ]</a>
         </LI>
       </UL>
</body></html>
