<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] GTK TreeView Callback Bug?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20GTK%20TreeView%20Callback%20Bug%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006349.html">
   <LINK REL="Next"  HREF="006350.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] GTK TreeView Callback Bug?</H1>
    <B>Marius M. M.</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20GTK%20TreeView%20Callback%20Bug%3F&In-Reply-To="
       TITLE="[Gtk-sharp-list] GTK TreeView Callback Bug?">devilx at gdesklets.org
       </A><BR>
    <I>Wed Aug 24 16:03:37 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="006349.html">[Gtk-sharp-list] Looking for pointers on debugging GTK#
</A></li>
        <LI>Next message: <A HREF="006350.html">[Gtk-sharp-list] Absolute positioning using Gtk.Fixed container
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6360">[ date ]</a>
              <a href="thread.html#6360">[ thread ]</a>
              <a href="subject.html#6360">[ subject ]</a>
              <a href="author.html#6360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

This is my first real C# application I'm trying to write and would like
to know, if that's a bug or if I just did something wrong. This is my
Code:

-----------------------------------------------------------------------------
using System;
using Gtk;
using Glade;
using GLib;

public class YstMain
{
	[Glade.Widget] Window frmMain;
	[Glade.Widget] ScrolledWindow swMystocks;
	TreeView tvMystocks = null;
	NodeStore StockStore = null;
	
	string [] myStocks;
	
	public static void Main (string[] args)
	{
		new YstMain(args);
	}

	public YstMain(string[] args) 
	{
		Application.Init ();
		Glade.XML gxml = new Glade.XML (null, &quot;gui.glade&quot;, &quot;frmMain&quot;, null);
		gxml.Autoconnect(this);
		
		tvMystocks = new TreeView(YstBuildNodeStore());
		tvMystocks.HeadersVisible = false;
		tvMystocks.AppendColumn(&quot;Stock&quot;, new CellRendererText(), &quot;text&quot;, 0);
		tvMystocks.Selection.Changed += new EventHandler
(OnMainMystocksSelection);
		swMystocks.Add(tvMystocks);		
		
		myStocks = YstLoadStocks();
		for(int i=0;i&lt;myStocks.Length;i++)	
			YstStoreAdd(myStocks[i]);

		frmMain.ShowAll();
		Application.Run ();	
	}
	
	public string[] YstLoadStocks()
	{
		string foo = YstSettings.Mystocks;
		string baa = foo.ToUpper();
		return baa.Split(',');
	}
	
	[TreeNode(ColumnCount=1)]
	private class YstTreeNode : TreeNode
	{
		string level;
		int count;
		
		public YstTreeNode(string level, int count)
		{
			this.level = level;
			this.count = count;
		}
		
		[TreeNodeValue(Column=0)]
		public string Level
		{
			get
			{
				return level;
			}
		}
		
		public int Count
		{
			get
			{
				return count;
			}
		}
	}
	
	private NodeStore YstBuildNodeStore()
	{
		StockStore = new NodeStore(typeof(YstTreeNode));
		return StockStore;
	}

	private void YstStoreAdd(string Stock)
	{
		ITreeNode node = new YstTreeNode(Stock,1);
		StockStore.AddNode(node);
		tvMystocks.QueueDraw();	
	}
	
	private void OnWindowDeleteEvent (object sender, DeleteEventArgs a) 
	{
		Application.Quit ();
		a.RetVal = true;
	}
	
	private void OnMainMystocksSelection (object sender, EventArgs a) 
	{
		TreeSelection ts = (TreeSelection) sender;
		TreeIter ti = new TreeIter();
		TreeModel tm;
 
		if (ts.GetSelected (out tm, out ti))
		{
			Console.WriteLine(tm.GetStringFromIter(ti));
		}
}
-----------------------------------------------------------------------------

For some reasons I do not understand, now the Callback
OnMainMystocksSelection is crashing my application. In the #mono channel
on the GIMPnet, I was told to try this code:

-----------------------------------------------------------------------------
	private void OnMainMystocksSelection (object sender, EventArgs a) 
	{
		TreeSelection ts = (TreeSelection) sender;
		ts.SelectedForeach(delegate (TreeModel model, TreePath path, TreeIter
iter){
			Console.WriteLine (model);
			Console.WriteLine (model.GetStringFromIter (iter));
		});
	}
-----------------------------------------------------------------------------

And check, if anything will be printen in the console. The result was
that nothing but this got printed:

-----------------------------------------------------------------------------
Unhandled Exception: System.NullReferenceException: Object reference not
set to an instance of an object
in &lt;0x0002f&gt; YstMain:&lt;#AnonymousMethod&gt;0 (Gtk.TreeModel,Gtk.TreePath,Gtk.TreeIter)
in &lt;0x0007f&gt; (wrapper delegate-invoke) System.MulticastDelegate:invoke_void_TreeModel_TreePath_TreeIter (Gtk.TreeModel,Gtk.TreePath,Gtk.TreeIter)
in &lt;0x00117&gt; GtkSharp.TreeSelectionForeachFuncWrapper:NativeCallback (intptr,intptr,Gtk.TreeIter&amp;,intptr)
in &lt;0x00037&gt; (wrapper native-to-managed) GtkSharp.TreeSelectionForeachFuncWrapper:NativeCallback (intptr,intptr,Gtk.TreeIter&amp;,intptr)
in (unmanaged) 0xb7118bbe
in &lt;0x00004&gt; (wrapper managed-to-native) Gtk.TreeSelection:gtk_tree_selection_selected_foreach (intptr,GtkSharp.TreeSelectionForeachFuncNative,intptr)
in &lt;0x00041&gt; Gtk.TreeSelection:SelectedForeach (Gtk.TreeSelectionForeachFunc)
in [0x00014] (at /home/devilx/MyProjects/yst/Main.cs:132) YstMain:OnMainMystocksSelection (object,System.EventArgs)
in &lt;0x00043&gt; (wrapper delegate-invoke) System.MulticastDelegate:invoke_void_object_EventArgs (object,System.EventArgs)
in &lt;0x00096&gt; GLib.Signal:voidObjectCallback (intptr,intptr)
in &lt;0x0002a&gt; (wrapper native-to-managed) GLib.Signal:voidObjectCallback (intptr,intptr)
in (unmanaged) 0xb6d4860a
in &lt;0x00004&gt; (wrapper managed-to-native) Gtk.Application:gtk_main ()
in &lt;0x00007&gt; Gtk.Application:Run ()
in [0x000d9] (at /home/devilx/MyProjects/yst/Main.cs:38) YstMain:.ctor (string[])
in [0x00001] (at /home/devilx/MyProjects/yst/Main.cs:19) YstMain:Main (string[])
-----------------------------------------------------------------------------

After I wrote that on #mono, I was told to ask here for help.
Could anybody please tell me what's wrong with the Code or if that's a Bug?
Thank you very much.

Goodbye.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006349.html">[Gtk-sharp-list] Looking for pointers on debugging GTK#
</A></li>
	<LI>Next message: <A HREF="006350.html">[Gtk-sharp-list] Absolute positioning using Gtk.Fixed container
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6360">[ date ]</a>
              <a href="thread.html#6360">[ thread ]</a>
              <a href="subject.html#6360">[ subject ]</a>
              <a href="author.html#6360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
