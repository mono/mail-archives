<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] SQLite Insert Statement With Parameters Generates SQL logic error or missing database
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20SQLite%20Insert%20Statement%20With%20Parameters%20Generates%0A%20SQL%20logic%20error%20or%20missing%20database&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010815.html">
   <LINK REL="Next"  HREF="010819.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] SQLite Insert Statement With Parameters Generates SQL logic error or missing database</H1>
    <B>Aaron Radich</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20SQLite%20Insert%20Statement%20With%20Parameters%20Generates%0A%20SQL%20logic%20error%20or%20missing%20database&In-Reply-To="
       TITLE="[Gtk-sharp-list] SQLite Insert Statement With Parameters Generates SQL logic error or missing database">aaron at radich.com
       </A><BR>
    <I>Mon Aug 22 17:26:09 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010815.html">[Gtk-sharp-list] Socket.id on mac
</A></li>
        <LI>Next message: <A HREF="010819.html">[Gtk-sharp-list] Gtk DrawingArea &amp; Double-Buffering with Cairo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10818">[ date ]</a>
              <a href="thread.html#10818">[ thread ]</a>
              <a href="subject.html#10818">[ subject ]</a>
              <a href="author.html#10818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to execute a SQL statement against a SQLite database with
parameters instead of embedding the parameter values directly into the
SQL command text (not using parameters).  I know my database is not read
only because I can do an insert without the parameters.  When I use the
parameters, though, I get the error below:  I've attached a snippet of
the insert code.  If you know what I'm doing wrong, I would greatly
appreciate a tip.  Thanks.

Aaron

Exception in Gtk# callback delegate
  Note: Applications can use GLib.ExceptionManager.UnhandledException to
handle the exception.
System.Reflection.TargetInvocationException: Exception has been thrown
by the target of an invocation. ---&gt;
Mono.Data.SqliteClient.SqliteExecutionException: SQL logic error or
missing database
  at Mono.Data.SqliteClient.SqliteCommand.ExecuteStatement (IntPtr
pStmt, System.Int32&amp; cols, System.IntPtr&amp; pazValue, System.IntPtr&amp;
pazColName) [0x0001f]
in /build/buildd/mono-2.6.7/mcs/class/Mono.Data.SqliteClient/Mono.Data.SqliteClient/SqliteCommand.cs:385 
  at Mono.Data.SqliteClient.SqliteCommand.ExecuteStatement (IntPtr
pStmt) [0x00000]
in /build/buildd/mono-2.6.7/mcs/class/Mono.Data.SqliteClient/Mono.Data.SqliteClient/SqliteCommand.cs:374 
  at Mono.Data.SqliteClient.SqliteCommand.ExecuteReader (CommandBehavior
behavior, Boolean want_results, System.Int32&amp; rows_affected) [0x000c3]
in /build/buildd/mono-2.6.7/mcs/class/Mono.Data.SqliteClient/Mono.Data.SqliteClient/SqliteCommand.cs:613 
  at Mono.Data.SqliteClient.SqliteCommand.ExecuteNonQuery () [0x00000]
in /build/buildd/mono-2.6.7/mcs/class/Mono.Data.SqliteClient/Mono.Data.SqliteClient/SqliteCommand.cs:501 
  at Foodle.SQLiteCommon.ScanHistoryGateway.InsertRecord
(Foodle.SQLiteCommon.ScanHistory recScanHistory) [0x0018e]
in /home/aaron/Foodle/GTK#/SQLiteCommon/ScanHistoryGateway.cs:231 
  at MainWindow.ProcessFoodleScan (System.String sUPCCode) [0x00080]
in /home/aaron/Foodle/GTK#/KitchenApp/KitchenApp/MainWindow.cs:1097 
  at MainWindow.OnKeyReleaseEvent (System.Object o,
Gtk.KeyReleaseEventArgs args) [0x00160]
in /home/aaron/Foodle/GTK#/KitchenApp/KitchenApp/MainWindow.cs:1030 
  at (wrapper managed-to-native)
System.Reflection.MonoMethod:InternalInvoke
(object,object[],System.Exception&amp;)
  at System.Reflection.MonoMethod.Invoke (System.Object obj,
BindingFlags invokeAttr, System.Reflection.Binder binder,
System.Object[] parameters, System.Globalization.CultureInfo culture)
[0x000d0]
in /build/buildd/mono-2.6.7/mcs/class/corlib/System.Reflection/MonoMethod.cs:213 
  --- End of inner exception stack trace ---


public int InsertRecord(ScanHistory recScanHistory)
{
   int iScanHistoryId = GetNextTableId();
                  
   try
   {
       if (this.Connection.State != System.Data.ConnectionState.Open)
         this.Connection.Open();
            
      IDbCommand objDbCommand = this.Connection.CreateCommand();
      
      // select the data from the db
      StringBuilder stbSQL = new StringBuilder();
      stbSQL.AppendLine(&quot;INSERT INTO ScanHistory &quot;);
      stbSQL.AppendLine(&quot;(ScanHistoryId, UPCCode, ScanDate, ItemId,
Quantity, Note) &quot;);
      stbSQL.AppendLine(&quot;VALUES
(:ScanHistoryId, :UPCCode, :ScanDate, :ItemId, :Quantity, :Note); &quot;);
                                 
      objDbCommand.CommandText = stbSQL.ToString();
            
      // assign the parameters
      // ScanHistoryId
      objDbCommand.Parameters.Add(new SqliteParameter(&quot;:ScanHistoryId&quot;,
recScanHistory.ScanHistoryId));
      // UPCCode
      objDbCommand.Parameters.Add(new SqliteParameter(&quot;:UPCCode&quot;,
recScanHistory.UPCCode));
      // ScanDate
      objDbCommand.Parameters.Add(new SqliteParameter(&quot;:ScanDate&quot;,
recScanHistory.ScanDate));
      // ItemId
      if (recScanHistory.ItemId &gt; 0)
         objDbCommand.Parameters.Add(new SqliteParameter(&quot;:ItemId&quot;,
recScanHistory.ItemId));
      else
         objDbCommand.Parameters.Add(new SqliteParameter(&quot;:ItemId&quot;,
DBNull.Value));
      // Quantity
      objDbCommand.Parameters.Add(new SqliteParameter(&quot;:Quantity&quot;,
recScanHistory.Quantity));
      // Note
      if (recScanHistory.Note != &quot;&quot;  &amp;&amp; recScanHistory.Note != null)
         objDbCommand.Parameters.Add(new SqliteParameter(&quot;:Note&quot;,
recScanHistory.Note));
      else
         objDbCommand.Parameters.Add(new SqliteParameter(&quot;:Note&quot;,
DBNull.Value));
            
      objDbCommand.Prepare();
            
      // execute the insert statement
      int iRowsAffected = objDbCommand.ExecuteNonQuery();
      if (iRowsAffected == 0)
         iScanHistoryId = 0;
                        
      // clean up
      objDbCommand.Dispose();
      objDbCommand = null;
                        
      stbSQL = null;
   }
   finally
   {
      // close the connection
      if (this.Connection.State != ConnectionState.Closed)
         this.Connection.Close();
   }
         
   return iScanHistoryId;
}


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20110822/e3cb789c/attachment.html">http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20110822/e3cb789c/attachment.html</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010815.html">[Gtk-sharp-list] Socket.id on mac
</A></li>
	<LI>Next message: <A HREF="010819.html">[Gtk-sharp-list] Gtk DrawingArea &amp; Double-Buffering with Cairo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10818">[ date ]</a>
              <a href="thread.html#10818">[ thread ]</a>
              <a href="subject.html#10818">[ subject ]</a>
              <a href="author.html#10818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
