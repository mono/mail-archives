<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Agressive ref-couting.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:hestilow%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000330.html">
   <LINK REL="Next"  HREF="000329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Agressive ref-couting.
   </H1>
    <B>Rachel Hestilow
    </B> 
    <A HREF="mailto:hestilow%40ximian.com"
       TITLE="[Gtk-sharp-list] Agressive ref-couting.">hestilow@ximian.com
       </A><BR>
    <I>11 Sep 2002 22:25:54 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="000330.html">[Gtk-sharp-list] Agressive ref-couting.
</A></li>
        <LI> Next message: <A HREF="000329.html">[Gtk-sharp-list] gnome-db sample
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#331">[ date ]</a>
              <a href="thread.html#331">[ thread ]</a>
              <a href="subject.html#331">[ subject ]</a>
              <a href="author.html#331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-pYn8WmTCnURXE8TIkQ/B
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Ah, I understand the problem I think. For some object fields we have to
write glue functions to return the field. None of these glue functions,
to my knowledge, ref the result. I'll whip up a patch to fix glue to ref
the return values.

-- Rachel

On Wed, 2002-09-11 at 21:24, Miguel de Icaza wrote:
&gt;<i> Hello!
</I>&gt;<i>=20
</I>&gt;<i> &gt; &gt;    The following patch makes mPhoto work again, when GC happens, we a=
</I>re
&gt;<i> &gt; &gt; destroying objects that we did not ref previously.
</I>&gt;<i> &gt;=20
</I>&gt;<i> &gt; I'm not sure this is the solution.  We shouldn't need to ref every
</I>&gt;<i> &gt; object, because we should own the vast majority of handles that are
</I>&gt;<i> &gt; returned by native methods.  Is this a situation where you are using
</I>&gt;<i> &gt; methods with &quot;const&quot; returns in the native library?
</I>&gt;<i>=20
</I>&gt;<i> The problem happens with GCs and Styles:
</I>&gt;<i>=20
</I>&gt;<i> static Gdk.GC EnsureGC (IntPtr raw) {
</I>&gt;<i>         if (raw =3D=3D IntPtr.Zero)
</I>&gt;<i>                 return null;
</I>&gt;<i>         Gdk.GC ret =3D (Gdk.GC) GLib.Object.GetObject (raw);
</I>&gt;<i>         if (ret =3D=3D null)
</I>&gt;<i>                 ret =3D new Gdk.GC (raw);
</I>&gt;<i>         return ret;
</I>&gt;<i> }
</I>&gt;<i>=20
</I>&gt;<i> [DllImport(&quot;gtksharpglue&quot;)]
</I>&gt;<i> static extern IntPtr gtksharp_gtk_style_get_white_gc (IntPtr style);
</I>&gt;<i>=20
</I>&gt;<i> public Gdk.GC WhiteGC {
</I>&gt;<i>         get { return EnsureGC (gtksharp_gtk_style_get_white_gc(Handle));
</I>&gt;<i> }
</I>&gt;<i>=20
</I>&gt;<i> The problem is that we are wrapping an object which is owned somewhere
</I>&gt;<i> else. =20
</I>&gt;<i>=20
</I>&gt;<i> Miguel
</I>&gt;<i>=20
</I>&gt;<i>=20
</I>&gt;<i>=20
</I>&gt;<i>=20
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Gtk-sharp-list maillist  -  <A HREF="mailto:Gtk-sharp-list@ximian.com">Gtk-sharp-list@ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>
</I>&gt;<i>=20
</I>

--=-pYn8WmTCnURXE8TIkQ/B
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.6 (GNU/Linux)
Comment: For info see <A HREF="http://www.gnupg.org">http://www.gnupg.org</A>

iD8DBQA9gAlCapOJdUj74F4RApQ3AKC+Fvtp0TbmYYkvoww83h5ebSvvWgCgjyDv
dqCHyxvMU2Bzi+G2vj8Bvs4=
=0UCF
-----END PGP SIGNATURE-----

--=-pYn8WmTCnURXE8TIkQ/B--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000330.html">[Gtk-sharp-list] Agressive ref-couting.
</A></li>
	<LI> Next message: <A HREF="000329.html">[Gtk-sharp-list] gnome-db sample
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#331">[ date ]</a>
              <a href="thread.html#331">[ thread ]</a>
              <a href="subject.html#331">[ subject ]</a>
              <a href="author.html#331">[ author ]</a>
         </LI>
       </UL>
</body></html>
