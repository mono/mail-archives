<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] The patch included in the Gtk# 0.10 installer for Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mathias.hasselmann%40gmx.de">
   <META NAME="robots" CONTENT="index,nofollow">
   
   
   <LINK REL="Next"  HREF="002117.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] The patch included in the Gtk# 0.10 installer for Windows
   </H1>
    <B>Mathias Hasselmann
    </B> 
    <A HREF="mailto:mathias.hasselmann%40gmx.de"
       TITLE="[Gtk-sharp-list] The patch included in the Gtk# 0.10 installer for Windows">mathias.hasselmann@gmx.de
       </A><BR>
    <I>Tue, 01 Jul 2003 23:20:10 +0200</I>
    <P><UL>
        
        <LI> Next message: <A HREF="002117.html">[Gtk-sharp-list] Problems with Gtk# 0.10 installer for Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2116">[ date ]</a>
              <a href="thread.html#2116">[ thread ]</a>
              <a href="subject.html#2116">[ subject ]</a>
              <a href="author.html#2116">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.
--------------080006000202000107090401
Content-Type: text/plain; charset=us-ascii; format=flowed
Content-Transfer-Encoding: 7bit

Mike Kestner wrote:
&gt;<i> On Mon, 2003-06-30 at 13:35, Mathias Hasselmann wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i>Maybe we should do this in Gtk.Application.Init() or do it as a static
</I>&gt;&gt;&gt;<i>constructor of Gtk.Application, so this happens automatically.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Since Application.cs is not auto-generated, this is even simpler.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Release 4 of the installer (gtk-sharp-0.10-win32-4.exe) already contains 
</I>&gt;&gt;<i>a patch doing exactly that.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Please submit this patch to the list so we can get it included in cvs.
</I>
Attached you'll find the patch that is used by the installer.
What does the patch:

  - addes some assembly information and strongly names the assemblies
  - the makefiles are fixed to build pure mingw32 libraries (which do not
    reference cygwin1.dll)
  - Glade# is added to list of assemblies built on win32 (guess the fixed
    libglade.mingw32.mak attached better schould better go to the
    libglade folks ;-)
  - Gtk.Application is tuned to fix environment on startup for win32.

Maybe I should create a second patch which also merges build.sh into
Gtk# CVS. What would be a good location?

	- gtk-sharp/build/win32/
	- gtk-sharp/win32/
	- gtk-sharp/installer.nsis/
	- ...

Where would you like to have it?

Ciao,
Mathias


--------------080006000202000107090401
Content-Type: text/plain;
 name=&quot;gtk-sharp-0.10-dotnet.diff&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;gtk-sharp-0.10-dotnet.diff&quot;

diff -ruN gtk-sharp-0.10/api/makefile.win32 gtk-sharp-0.10-dotnet/api/makefile.win32
--- gtk-sharp-0.10/api/makefile.win32	2002-10-27 03:30:50.000000000 +0100
+++ gtk-sharp-0.10-dotnet/api/makefile.win32	2003-06-29 02:18:03.000000000 +0200
@@ -1,6 +1,6 @@
 all: generated-stamp
 
-generated-stamp: atk-api.xml gdk-api.xml gdk-symbols.xml gtk-api.xml gtk-symbols.xml pango-api.xml ../generator/codegen.exe
-	../generator/codegen --generate atk-api.xml gdk-api.xml gdk-symbols.xml gtk-api.xml gtk-symbols.xml pango-api.xml
+generated-stamp: atk-api.xml gdk-api.xml gdk-symbols.xml gtk-api.xml gtk-symbols.xml pango-api.xml glade-api.xml ../generator/codegen.exe
+	../generator/codegen --generate atk-api.xml gdk-api.xml gdk-symbols.xml gtk-api.xml gtk-symbols.xml pango-api.xml glade-api.xml
 	touch generated-stamp
 
diff -ruN gtk-sharp-0.10/atk/AssemblyInfo.cs.in gtk-sharp-0.10-dotnet/atk/AssemblyInfo.cs.in
--- gtk-sharp-0.10/atk/AssemblyInfo.cs.in	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/atk/AssemblyInfo.cs.in	2003-06-28 22:31:56.000000000 +0200
@@ -0,0 +1,11 @@
+using System.Reflection;
+
+[assembly: AssemblyProduct(&quot;Gtk#&quot;)]
+[assembly: AssemblyVersion(&quot;((VERSION))&quot;)]
+[assembly: AssemblyCompany(&quot;<A HREF="http://gtk-sharp.sourceforge.net/"">http://gtk-sharp.sourceforge.net/&quot;</A>)]
+[assembly: AssemblyCopyright(&quot;((COPYRIGHT))&quot;)]
+[assembly: AssemblyTitle(&quot;ATK wrapper for .NET&quot;)]
+[assembly: AssemblyDescription(&quot;ATK is a libray providing accessability features.&quot;)]
+[assembly: AssemblyTrademark(&quot;Gtk# is released under the GNU Library General Public License (GNU LGPL).&quot;)]
+[assembly: AssemblyDelaySign(false)]
+[assembly: AssemblyKeyFile(&quot;../../gtksharp.snk&quot;)]
diff -ruN gtk-sharp-0.10/gdk/AssemblyInfo.cs.in gtk-sharp-0.10-dotnet/gdk/AssemblyInfo.cs.in
--- gtk-sharp-0.10/gdk/AssemblyInfo.cs.in	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/gdk/AssemblyInfo.cs.in	2003-06-28 22:57:04.000000000 +0200
@@ -0,0 +1,11 @@
+using System.Reflection;
+
+[assembly: AssemblyProduct(&quot;Gtk#&quot;)]
+[assembly: AssemblyVersion(&quot;((VERSION))&quot;)]
+[assembly: AssemblyCompany(&quot;<A HREF="http://gtk-sharp.sourceforge.net/"">http://gtk-sharp.sourceforge.net/&quot;</A>)]
+[assembly: AssemblyCopyright(&quot;((COPYRIGHT))&quot;)]
+[assembly: AssemblyTitle(&quot;GDK wrapper for .NET&quot;)]
+[assembly: AssemblyDescription(&quot;GDK is a utility library providing platform independent graphics functionality.&quot;)]
+[assembly: AssemblyTrademark(&quot;Gtk# is released under the GNU Library General Public License (GNU LGPL).&quot;)]
+[assembly: AssemblyDelaySign(false)]
+[assembly: AssemblyKeyFile(&quot;../../gtksharp.snk&quot;)]
diff -ruN gtk-sharp-0.10/glade/AssemblyInfo.cs.in gtk-sharp-0.10-dotnet/glade/AssemblyInfo.cs.in
--- gtk-sharp-0.10/glade/AssemblyInfo.cs.in	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/glade/AssemblyInfo.cs.in	2003-06-29 02:49:03.000000000 +0200
@@ -0,0 +1,11 @@
+using System.Reflection;
+
+[assembly: AssemblyProduct(&quot;Gtk#&quot;)]
+[assembly: AssemblyVersion(&quot;((VERSION))&quot;)]
+[assembly: AssemblyCompany(&quot;<A HREF="http://gtk-sharp.sourceforge.net/"">http://gtk-sharp.sourceforge.net/&quot;</A>)]
+[assembly: AssemblyCopyright(&quot;((COPYRIGHT))&quot;)]
+[assembly: AssemblyTitle(&quot;libglade wrapper for .NET&quot;)]
+[assembly: AssemblyDescription(&quot;Libglade is used to load graphical user interfaces designed with the GLADE interface builder.&quot;)]
+[assembly: AssemblyTrademark(&quot;Gtk# is released under the GNU Library General Public License (GNU LGPL).&quot;)]
+[assembly: AssemblyDelaySign(false)]
+[assembly: AssemblyKeyFile(&quot;../../gtksharp.snk&quot;)]
diff -ruN gtk-sharp-0.10/glade/Makefile.win32 gtk-sharp-0.10-dotnet/glade/Makefile.win32
--- gtk-sharp-0.10/glade/Makefile.win32	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/glade/Makefile.win32	2003-06-29 02:20:08.000000000 +0200
@@ -0,0 +1,8 @@
+all: windows
+
+windows:
+	$(CSC) /unsafe /target:library /r:../glib/glib-sharp.dll /r:../pango/pango-sharp.dll /r:../atk/atk-sharp.dll /r:../gdk/gdk-sharp.dll /r:../gtk/gtk-sharp.dll /out:glade-sharp.dll /recurse:*.cs
+
+docs:
+	$(CSC) /unsafe /target:library /r:../glib/glib-sharp.dll /r:../pango/pango-sharp.dll /r:../atk/atk-sharp.dll /r:../gdk/gdk-sharp.dll /r:../gtk/gtk-sharp.dll /doc:glade-sharp-docs.xml /out:glade-sharp.dll /recurse:*.cs
+
diff -ruN gtk-sharp-0.10/glib/AssemblyInfo.cs.in gtk-sharp-0.10-dotnet/glib/AssemblyInfo.cs.in
--- gtk-sharp-0.10/glib/AssemblyInfo.cs.in	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/glib/AssemblyInfo.cs.in	2003-06-28 22:32:01.000000000 +0200
@@ -0,0 +1,11 @@
+using System.Reflection;
+
+[assembly: AssemblyProduct(&quot;Gtk#&quot;)]
+[assembly: AssemblyVersion(&quot;((VERSION))&quot;)]
+[assembly: AssemblyCompany(&quot;<A HREF="http://gtk-sharp.sourceforge.net/"">http://gtk-sharp.sourceforge.net/&quot;</A>)]
+[assembly: AssemblyCopyright(&quot;((COPYRIGHT))&quot;)]
+[assembly: AssemblyTitle(&quot;GLib wrapper for .NET&quot;)]
+[assembly: AssemblyDescription(&quot;GLib is a general-purpose utility library, which provides many useful data types, macros, type conversions, string utilities, file utilities, a main loop abstraction, and so on.&quot;)]
+[assembly: AssemblyTrademark(&quot;Gtk# is released under the GNU Library General Public License (GNU LGPL).&quot;)]
+[assembly: AssemblyDelaySign(false)]
+[assembly: AssemblyKeyFile(&quot;../../gtksharp.snk&quot;)]
diff -ruN gtk-sharp-0.10/glue/makefile.win32 gtk-sharp-0.10-dotnet/glue/makefile.win32
--- gtk-sharp-0.10/glue/makefile.win32	2002-10-27 03:30:51.000000000 +0100
+++ gtk-sharp-0.10-dotnet/glue/makefile.win32	2003-06-29 01:25:17.000000000 +0200
@@ -1,7 +1,10 @@
-GTK_CFLAGS=`pkg-config --cflags gtk+-win32-2.0`
-GTK_LIBS=`pkg-config --libs gtk+-win32-2.0`
-CC=gcc -b i686-pc-mingw32
-DLLWRAP=dllwrap --mno-cygwin --target i386-mingw32 --export-all-symbols
+OTIMIZES=-O2 -mcpu=pentium4
+PLATFORM=-mno-cygwin -mms-bitfields -mwindows -mthreads
+
+GTK_CFLAGS=$(shell pkg-config --cflags gtk+-win32-2.0)
+GTK_LIBS=$(shell pkg-config --libs gtk+-win32-2.0)
+CFLAGS=$(PLATFORM) $(OPTIMIZES)
+CC=gcc 
 
 GLUE_OBJS = \
 	adjustment.o \
@@ -16,19 +19,15 @@
 	style.o \
 	type.o \
 	value.o \
-	widget.o \
-	win32dll.o
+	widget.o 
 
 all: gtksharpglue.dll
 
-
 %.o: %.c
 	$(CC) -c $(CFLAGS) $(GTK_CFLAGS) -o $@ $^ 
 
-
 gtksharpglue.dll: $(GLUE_OBJS)
-	$(DLLWRAP) --output-lib=libgtksharpglue.a --dllname=gtksharpglue.dll --driver-name=gcc --output-def=gtksharpglue.def $(GLUE_OBJS) $(GTK_LIBS)
-
+	$(CC) -shared -o gtksharpglue.dll $(PLATFORM) $(GLUE_OBJS) $(GTK_LIBS)
 
 clean:
 	rm -f gtksharpglue.dll *.o libgtksharpglue.a
diff -ruN gtk-sharp-0.10/gtk/Application.cs gtk-sharp-0.10-dotnet/gtk/Application.cs
--- gtk-sharp-0.10/gtk/Application.cs	2003-03-25 17:57:05.000000000 +0100
+++ gtk-sharp-0.10-dotnet/gtk/Application.cs	2003-06-28 20:03:41.000000000 +0200
@@ -18,7 +18,12 @@
 		private Application ()
 		{
 		}
-		
+
+		static Application ()
+		{
+			RuntimeEnvironment.Initialize();
+		}
+
 		[DllImport(&quot;libgtk-win32-2.0-0.dll&quot;)]
 		static extern void gtk_init (int argc, IntPtr argv);
 
diff -ruN gtk-sharp-0.10/gtk/AssemblyInfo.cs.in gtk-sharp-0.10-dotnet/gtk/AssemblyInfo.cs.in
--- gtk-sharp-0.10/gtk/AssemblyInfo.cs.in	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/gtk/AssemblyInfo.cs.in	2003-06-28 22:32:32.000000000 +0200
@@ -0,0 +1,11 @@
+using System.Reflection;
+
+[assembly: AssemblyProduct(&quot;Gtk#&quot;)]
+[assembly: AssemblyVersion(&quot;((VERSION))&quot;)]
+[assembly: AssemblyCompany(&quot;<A HREF="http://gtk-sharp.sourceforge.net/"">http://gtk-sharp.sourceforge.net/&quot;</A>)]
+[assembly: AssemblyCopyright(&quot;((COPYRIGHT))&quot;)]
+[assembly: AssemblyTitle(&quot;GTK+ wrapper for .NET&quot;)]
+[assembly: AssemblyDescription(&quot;GTK+ is a library for creating graphical user interfaces.&quot;)]
+[assembly: AssemblyTrademark(&quot;Gtk# is released under the GNU Library General Public License (GNU LGPL).&quot;)]
+[assembly: AssemblyDelaySign(false)]
+[assembly: AssemblyKeyFile(&quot;../../gtksharp.snk&quot;)]
diff -ruN gtk-sharp-0.10/gtk/RuntimeEnvironment.cs gtk-sharp-0.10-dotnet/gtk/RuntimeEnvironment.cs
--- gtk-sharp-0.10/gtk/RuntimeEnvironment.cs	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/gtk/RuntimeEnvironment.cs	2003-06-29 01:52:29.000000000 +0200
@@ -0,0 +1,189 @@
+/* Gtk# Runtime Environment Helper
+ * Copyright (C) 2003 by Mathias Hasselmann &lt;<A HREF="mailto:mathias@taschenorakel.de">mathias@taschenorakel.de</A>&gt;
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining
+ * a copy of this software and associated documentation files (the
+ * &quot;Software&quot;), to deal in the Software without restriction, including
+ * without limitation the rights to use, copy, modify, merge, publish,
+ * distribute, sublicense, and/or sell copies of the Software, and to
+ * permit persons to whom the Software is furnished to do so, subject to
+ * the following conditions:
+ * 
+ * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
+ * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+ * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+ * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
+ * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
+ * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
+ * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+
+using System;
+using System.IO;
+using System.Reflection;
+
+namespace Gtk
+{
+	/// &lt;summary&gt;
+	/// This class provides functionally to locate and initialize 
+	/// the Gtk# Runtime Environment
+	/// &lt;/summary&gt;
+	internal class RuntimeEnvironment
+	{
+		static Type registry = null;
+		static object localMachine = null;
+		static MethodInfo openSubKey = null;
+		static MethodInfo getValue = null;
+
+		/// &lt;summary&gt;
+		/// Modifies the value of an environment variable.
+		/// &lt;/summary&gt;
+		/// &lt;remarks&gt;
+		/// This method is available on Microsoft Windows only. Do not call 
+		/// on other platforms.
+		/// &lt;/remarks&gt;
+		[System.Runtime.InteropServices.DllImport(&quot;kernel32.dll&quot;)]
+		extern static bool SetEnvironmentVariable(string name, string value);
+
+		/// &lt;summary&gt;
+		/// Reads a value from the Microsoft Windows registry.
+		/// &lt;/summary&gt;
+		/// &lt;param name=&quot;subkey&quot;&gt;
+		/// Name of a registry key within the LOCAL_MACHINE hieve.
+		/// &lt;/param&gt;
+		/// &lt;param name=&quot;value&quot;&gt;
+		/// Name of a registry value to read or null to read the default value.
+		/// &lt;/param&gt;
+		/// &lt;returns&gt;
+		/// The value of the registry entry requested or null if no entry 
+		/// is found.
+		/// &lt;/returns&gt;
+		/// &lt;remarks&gt;
+		/// This method is initialized by &lt;see cref=&quot;InitializeWindowsRuntime&quot;/&gt;
+		/// and functional on Microsoft Windows only. Do not call on other
+		/// platforms.
+		/// &lt;/remarks&gt;
+		static object GetRegistryValue(string subkey, string value)
+		{
+			object key = openSubKey.Invoke(
+				localMachine, new object[] { subkey });
+
+			return null != key ?
+				getValue.Invoke(key, new object[] { value }) : null;
+		}
+
+		static void CheckLibraryExists(string directory, string library)
+		{
+			string filename = Path.Combine(directory, library);
+
+			if (!File.Exists(filename))
+				throw new FileNotFoundException(
+					&quot;Gtk# component not found.\r\nfilename: &quot; +
+					filename, filename);
+		}
+		
+		/// &lt;summary&gt;
+		/// Initializes the current process for Gtk# when running on 
+		/// Microsoft Windows.
+		/// &lt;/summary&gt;
+		/// &lt;exception cref=&quot;System.IO.FileNotFoundException&quot;&gt;
+		/// This exception is thrown if some components of the 
+		/// Gtk# Runtime Environment cannot be found. The exception
+		/// message should be displayed to the user since it's contains 
+		/// useful information about how to solve the problem.
+		/// &lt;/exception&gt;
+		/// &lt;remarks&gt;
+		/// Side effect: Some Windows specific variables are initialized 
+		/// in order to be able to use &lt;see cref=&quot;GetRegistryValue&quot;/&gt;.
+		/// &lt;/remarks&gt;
+		static void InitializeWindowsRuntime()
+		{
+			registry = Type.GetType(&quot;Microsoft.Win32.Registry&quot;);
+			localMachine = registry.GetField(&quot;LocalMachine&quot;).GetValue(null);
+
+			openSubKey = localMachine.GetType().GetMethod(
+				&quot;OpenSubKey&quot;, new Type[] { typeof(string) });
+			getValue = localMachine.GetType().GetMethod(
+				&quot;GetValue&quot;, new Type[] { typeof(string) });
+
+			Assembly gtkSharp = typeof(RuntimeEnvironment).Assembly;
+			string version = gtkSharp.GetName().Version.ToString(2);
+
+			string rkeyGtkPlus = &quot;SOFTWARE\\Gtk\\2.0&quot;;
+			string rkeyGtkSharp = &quot;SOFTWARE\\Gtk#\\&quot; + version;
+
+			string gtkPlusPath =
+				GetRegistryValue(rkeyGtkPlus, &quot;Path&quot;) as string;
+			string gtkSharpPath =
+				GetRegistryValue(rkeyGtkSharp, &quot;Path&quot;) as string;
+
+			if (null == gtkSharpPath)
+				throw new FileNotFoundException(
+				&quot;Cannot locate Gtk# components.&quot;);
+
+			if (null == gtkPlusPath)
+				gtkPlusPath = gtkSharpPath;
+
+			gtkSharpPath = Path.Combine(gtkSharpPath, &quot;lib&quot;);
+			gtkPlusPath = Path.Combine(gtkPlusPath, &quot;lib&quot;);
+
+			if (File.Exists(Path.Combine(
+				gtkSharpPath, &quot;libgtk-win32-2.0-0.dll&quot;)))
+				gtkPlusPath = gtkSharpPath;
+
+			CheckLibraryExists(gtkSharpPath, &quot;glib-sharp.dll&quot;);
+			CheckLibraryExists(gtkSharpPath, &quot;atk-sharp.dll&quot;);
+			CheckLibraryExists(gtkSharpPath, &quot;pango-sharp.dll&quot;);
+			CheckLibraryExists(gtkSharpPath, &quot;gdk-sharp.dll&quot;);
+			CheckLibraryExists(gtkSharpPath, &quot;gtk-sharp.dll&quot;);
+			CheckLibraryExists(gtkSharpPath, &quot;gtksharpglue.dll&quot;);
+
+			CheckLibraryExists(gtkPlusPath, &quot;libglib-2.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libgmodule-2.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libgobject-2.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libgthread-2.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libatk-1.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libpangowin32-1.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libgdk-win32-2.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libgdk_pixbuf-2.0-0.dll&quot;);
+			CheckLibraryExists(gtkPlusPath, &quot;libgtk-win32-2.0-0.dll&quot;);
+				
+			string pathExtensions = &quot;;&quot; + gtkSharpPath;
+
+			if (!gtkSharpPath.Equals(gtkPlusPath))
+				pathExtensions+= &quot;;&quot; + gtkSharpPath;
+			
+			SetEnvironmentVariable(&quot;PATH&quot;, 
+				Environment.GetEnvironmentVariable(&quot;PATH&quot;) +
+				pathExtensions);
+		}
+
+		/// &lt;summary&gt;
+		/// Initializes the current process to be able to locate all components
+		/// of the Gtk# Runtime Environment
+		/// &lt;/summary&gt;
+		/// &lt;exception cref=&quot;System.IO.FileNotFoundException&quot;&gt;
+		/// This exception is thrown if some components of the 
+		/// Gtk# Runtime Environment cannot be found. The exception
+		/// message should be displayed to the user since it's contains 
+		/// useful information about how to solve the problem.
+		/// &lt;/exception&gt;
+		public static void Initialize()
+		{
+			switch(Environment.OSVersion.Platform)
+			{
+				case PlatformID.Win32NT:
+				case PlatformID.Win32S:
+				case PlatformID.Win32Windows:
+					InitializeWindowsRuntime();
+					break;
+
+				default:
+					// nothing to do for other platforms
+					break;
+			}
+		}
+	}
+}
+
+// vim: ts=4 sw=4
diff -ruN gtk-sharp-0.10/makefile.win32 gtk-sharp-0.10-dotnet/makefile.win32
--- gtk-sharp-0.10/makefile.win32	2002-10-27 03:30:49.000000000 +0100
+++ gtk-sharp-0.10-dotnet/makefile.win32	2003-06-29 01:52:51.000000000 +0200
@@ -1,6 +1,6 @@
-DIRS=glue generator api glib pango atk gdk gtk sample
+DIRS=glue generator api glib pango atk gdk gtk glade sample
 ROOT=/cygdrive/$(subst \,/,$(subst :\,/,$(SYSTEMROOT)))
-CSC=$(ROOT)/microsoft.net/framework/v1.0.3705/csc.exe /d:WIN32
+CSC=$(ROOT)/microsoft.net/framework/v1.0.3705/csc.exe /nologo /d:WIN32 /optimize
 
 all: windows
 
diff -ruN gtk-sharp-0.10/pango/AssemblyInfo.cs.in gtk-sharp-0.10-dotnet/pango/AssemblyInfo.cs.in
--- gtk-sharp-0.10/pango/AssemblyInfo.cs.in	1970-01-01 01:00:00.000000000 +0100
+++ gtk-sharp-0.10-dotnet/pango/AssemblyInfo.cs.in	2003-06-28 22:32:56.000000000 +0200
@@ -0,0 +1,11 @@
+using System.Reflection;
+
+[assembly: AssemblyProduct(&quot;Pango#&quot;)]
+[assembly: AssemblyVersion(&quot;((VERSION))&quot;)]
+[assembly: AssemblyCompany(&quot;<A HREF="http://gtk-sharp.sourceforge.net/"">http://gtk-sharp.sourceforge.net/&quot;</A>)]
+[assembly: AssemblyCopyright(&quot;((COPYRIGHT))&quot;)]
+[assembly: AssemblyTitle(&quot;Pango wrapper for .NET&quot;)]
+[assembly: AssemblyDescription(&quot;Is a font rendering library.&quot;)]
+[assembly: AssemblyTrademark(&quot;Gtk# is released under the GNU Library General Public License (GNU LGPL).&quot;)]
+[assembly: AssemblyDelaySign(false)]
+[assembly: AssemblyKeyFile(&quot;../../gtksharp.snk&quot;)]
diff -ruN gtk-sharp-0.10/sample/makefile.win32 gtk-sharp-0.10-dotnet/sample/makefile.win32
--- gtk-sharp-0.10/sample/makefile.win32	2002-06-25 12:49:23.000000000 +0200
+++ gtk-sharp-0.10-dotnet/sample/makefile.win32	2003-06-29 02:52:37.000000000 +0200
@@ -1,9 +1,25 @@
 all: windows
 
-windows:
-	$(CSC) /unsafe /out:gtk-hello-world.exe /r:../glib/glib-sharp.dll /r:../atk/atk-sharp.dll /r:../gtk/gtk-sharp.dll /r:../gdk/gdk-sharp.dll HelloWorld.cs
-	$(CSC) /unsafe /out:button.exe /r:../glib/glib-sharp.dll /r:../atk/atk-sharp.dll /r:../gtk/gtk-sharp.dll ButtonApp.cs
-	$(CSC) /unsafe /out:menu.exe /r:../glib/glib-sharp.dll /r:../atk/atk-sharp.dll /r:../gtk/gtk-sharp.dll Menu.cs
+windows-functional: \
+	ButtonApp.exe \
+	CalendarApp.exe \
+	HelloWorld.exe \
+	Menu.exe \
+	Subclass.exe \
+
+windows-broken: \
+	ManagedTreeViewDemo.exe \
+	TreeViewDemo.exe \
+	Scribble.exe \
+	Size.exe
+
+#GladeTest.exe GladeViewer.exe
+#rsvg/svghelloworld.exe
+
+windows: windows-functional windows-broken
+
+%.exe: %.cs
+	$(CSC) /unsafe /out:$@ /r:../glib/glib-sharp.dll /r:../atk/atk-sharp.dll /r:../gtk/gtk-sharp.dll /r:../gdk/gdk-sharp.dll $^
 
 docs:
 	@echo &quot;No docs to make.&quot;

--------------080006000202000107090401
Content-Type: text/plain;
 name=&quot;libglade.mingw32.mak&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;libglade.mingw32.mak&quot;

PLATFORM=-mno-cygwin -mms-bitfields -mwindows -mthreads
OPTIMIZES=-O2 -mcpu=pentium
DEFINES=-DHAVE_CONFIG_H -DGLADE_LIBDIR='&quot;/target/build/lib&quot;'

INTL_CFLAGS=-I'/cygdrive/c/Programme/Gemeinsame Dateien/GTK/SDK/2.0/include'

GTK_CFLAGS=$(shell pkg-config --cflags gtk+-2.0)
GTK_LIBS=$(shell pkg-config --libs gtk+-2.0)

XML_CFLAGS=-I'../../libxml2-2.5.7.win32/include'
XML_LIBS=-L'../../libxml2-2.5.7.win32/lib' -lxml2

INCLUDES=-I. -I.. $(INTL_CFLAGS) $(GTK_CFLAGS) $(XML_CFLAGS)
LIBS=$(GTK_LIBS) $(XML_LIBS)

CFLAGS=$(PLATFORM) $(OPTIMIZES) $(DEFINES) $(INCLUDES)

all: libglade.dll

libglade.dll: glade-init.o glade-xml.o glade-gtk.o glade-parser.o
	gcc -shared -o $@ $(PLATFORM) $^ $(LIBS)

clean:
	rm -f *.o *.dll

--------------080006000202000107090401--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI> Next message: <A HREF="002117.html">[Gtk-sharp-list] Problems with Gtk# 0.10 installer for Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2116">[ date ]</a>
              <a href="thread.html#2116">[ thread ]</a>
              <a href="subject.html#2116">[ subject ]</a>
              <a href="author.html#2116">[ author ]</a>
         </LI>
       </UL>
</body></html>
