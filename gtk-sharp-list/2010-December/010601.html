<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Listening for DragDataReceived in a TreeView when	the Model is a TreeModelSort
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Listening%20for%20DragDataReceived%20in%20a%20TreeView%20when%0A%09the%20Model%20is%20a%20TreeModelSort&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010600.html">
   <LINK REL="Next"  HREF="010602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Listening for DragDataReceived in a TreeView when	the Model is a TreeModelSort</H1>
    <B>Matthew Pirocchi</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Listening%20for%20DragDataReceived%20in%20a%20TreeView%20when%0A%09the%20Model%20is%20a%20TreeModelSort&In-Reply-To="
       TITLE="[Gtk-sharp-list] Listening for DragDataReceived in a TreeView when	the Model is a TreeModelSort">matthew.pirocchi at gmail.com
       </A><BR>
    <I>Sun Dec 19 17:11:55 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010600.html">[Gtk-sharp-list] NodeView
</A></li>
        <LI>Next message: <A HREF="010602.html">[Gtk-sharp-list] gtk label : text wrapped and not fully displayed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10601">[ date ]</a>
              <a href="thread.html#10601">[ thread ]</a>
              <a href="subject.html#10601">[ subject ]</a>
              <a href="author.html#10601">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a TreeView whose Model is a TreeModelSort with a ListStore as its
child. I would like this TreeView to listen to DragDataReceived. However,
when I drag data to it, I get this warning:

(TestDragDrop:4706): Gtk-WARNING **: You must override the default
'drag_drop' handler on GtkTreeView when using models that don't support the
GtkTreeDragDest interface and enabling drag-and-drop. The simplest way to do
this is to connect to 'drag_drop' and call g_signal_stop_emission_by_name()
in your signal handler to prevent the default handler from running. Look at
the source code for the default handler in gtktreeview.c to get an idea what
your handler should do. (gtktreeview.c is in the GTK source code.) If you're
using GTK from a language other than C, there may be a more natural way to
override default handlers, e.g. via derivation.

I'm a bit lost on how to do thisin Gtk#. The message says &quot;If you're using
GTK from a language other than C, there may be a more natural way to
override default handlers, e.g. via derivation.&quot; Can someone point me to an
example of what this would look like? What exactly am I overriding? There is
no DragDrop method, and overriding OnDragDataReceived doesn't seem to work.
Alternatively, I could manually sort the ListStore, but that seems like a
really bad idea (especially since there doesn't seem to be any easy way to
swap elements).

Here is an example TreeView for reference:


using System;
using System.Linq;
using System.Text;
using Gtk;

namespace TestDragDrop
{
public class DestTreeView : TreeView
{
public DestTreeView ()
{
ListStore store = new ListStore (typeof (string));
TreeModelSort sort = new TreeModelSort (store) { DefaultSortFunc =
BarSortFunc };
Model = sort;
 TreeViewColumn column = new TreeViewColumn { Title = &quot;Bar&quot; };
CellRendererText cell = new CellRendererText ();
column.PackStart (cell, true);
column.SetCellDataFunc (cell, RenderBar);
AppendColumn (column);
 EnableModelDragDest (Constants.Targets, Gdk.DragAction.Link);
DragDataReceived += HandleDragDataReceived;
 store.AppendValues (&quot;bar1&quot;);
store.AppendValues (&quot;bar2&quot;);
}

string GetValueAtPos (int x, int y)
{
TreePath path;
TreeViewDropPosition pos;
if (!GetDestRowAtPos (x, y, out path, out pos))
return &quot;&quot;;
 TreeIter iter;
if (!Model.GetIter (out iter, path))
return &quot;&quot;;
 return (string) Model.GetValue (iter, 0);
}

void HandleDragDataReceived (object o, DragDataReceivedArgs args)
{
string text = System.Text.Encoding.UTF8.GetString (args.SelectionData.Data);
string val = GetValueAtPos (args.X, args.Y);
 Console.WriteLine (&quot;Data: '{0}'\nRow: '{1}'&quot;, text, val);
}

void RenderBar (TreeViewColumn column, CellRenderer renderer, TreeModel
model, TreeIter iter)
{
((CellRendererText) renderer).Text = (string) model.GetValue (iter, 0);
}

int BarSortFunc (TreeModel model, TreeIter iter1, TreeIter iter2)
{
string bar1 = (string) model.GetValue (iter1, 0);
string bar2 = (string) model.GetValue (iter2, 0);
 return bar1.CompareTo (bar2);
}
}
}


Thanks,
- Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20101219/d2f054d6/attachment.html">http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20101219/d2f054d6/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010600.html">[Gtk-sharp-list] NodeView
</A></li>
	<LI>Next message: <A HREF="010602.html">[Gtk-sharp-list] gtk label : text wrapped and not fully displayed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10601">[ date ]</a>
              <a href="thread.html#10601">[ thread ]</a>
              <a href="subject.html#10601">[ subject ]</a>
              <a href="author.html#10601">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
