<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Patch for problem with event handler callbacks when there is an Object
 as input parameter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:aleksey%40aleksey.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002358.html">
   <LINK REL="Next"  HREF="002278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Patch for problem with event handler callbacks when there is an Object
 as input parameter
   </H1>
    <B>Aleksey Sanin
    </B> 
    <A HREF="mailto:aleksey%40aleksey.com"
       TITLE="[Gtk-sharp-list] Patch for problem with event handler callbacks when there is an Object
 as input parameter">aleksey@aleksey.com
       </A><BR>
    <I>Thu, 14 Aug 2003 10:36:15 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="002358.html">[Gtk-sharp-list] patch fixing override issue for
 gtk-sharp/generator/Method.cs
</A></li>
        <LI> Next message: <A HREF="002278.html">[Gtk-sharp-list] Patch for problem with event handler
 callbacks when there is an Object as input parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2260">[ date ]</a>
              <a href="thread.html#2260">[ thread ]</a>
              <a href="subject.html#2260">[ subject ]</a>
              <a href="author.html#2260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.
--------------030507040203060002060006
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

About a week ago I have reported to the list a crash I have with 
RowActivated
callback in Gtk.TreeView when I use Gtk# compiled from CVS.

I have investigated this issue and found that it is a general problem with
*any* signal handler that has an object as an input parameter (SetMark
in Gtk.TextBuffer, etc.) thus I have opened a bug about that:
   
    <A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=47626">http://bugzilla.ximian.com/show_bug.cgi?id=47626</A>

Finally I was able to find the problem: the signal handler code assumed
that it owns the object reference passed in. Thus it destroyed the object
and later GTK crashed as soon as it tries to destroy the object itself.

The one line patch is trivial (see attached file). I would appreciate if 
someone
can check it in (and close the bug :) ). This problem is really annoying :)

Thanks,
Aleksey









--------------030507040203060002060006
Content-Type: text/plain;
 name=&quot;signal.diff&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;signal.diff&quot;

Index: generator/SignalHandler.cs
===================================================================
RCS file: /mono/gtk-sharp/generator/SignalHandler.cs,v
retrieving revision 1.29
diff -u -r1.29 SignalHandler.cs
--- generator/SignalHandler.cs	23 Jul 2003 17:19:19 -0000	1.29
+++ generator/SignalHandler.cs	14 Aug 2003 17:29:51 -0000
@@ -140,7 +140,7 @@
 						sw.WriteLine(&quot;\t\t\t\targs.Args[{0}] = null;&quot;, idx - 1);
 						sw.WriteLine(&quot;\t\t\telse {&quot;);
 						if (wrapper != null &amp;&amp; wrapper is ObjectGen)
-							sw.WriteLine(&quot;\t\t\t\targs.Args[&quot; + (idx-1) + &quot;] = GLib.Object.GetObject(arg&quot; + idx + &quot;, true);&quot;);
+							sw.WriteLine(&quot;\t\t\t\targs.Args[&quot; + (idx-1) + &quot;] = GLib.Object.GetObject(arg&quot; + idx + &quot;, false);&quot;);
 						else
 							sw.WriteLine(&quot;\t\t\t\targs.Args[&quot; + (idx-1) + &quot;] = &quot; + table.FromNative (ctype, &quot;arg&quot; + idx)  + &quot;;&quot;);
 						if ((wrapper != null &amp;&amp; (wrapper is OpaqueGen)) || table.IsManuallyWrapped (ctype)) {

--------------030507040203060002060006--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002358.html">[Gtk-sharp-list] patch fixing override issue for
 gtk-sharp/generator/Method.cs
</A></li>
	<LI> Next message: <A HREF="002278.html">[Gtk-sharp-list] Patch for problem with event handler
 callbacks when there is an Object as input parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2260">[ date ]</a>
              <a href="thread.html#2260">[ thread ]</a>
              <a href="subject.html#2260">[ subject ]</a>
              <a href="author.html#2260">[ author ]</a>
         </LI>
       </UL>
</body></html>
