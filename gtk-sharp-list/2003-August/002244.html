<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] glade# cross platform
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:d4ljoyn%40yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002242.html">
   <LINK REL="Next"  HREF="002247.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] glade# cross platform
   </H1>
    <B>Dave Joyner
    </B> 
    <A HREF="mailto:d4ljoyn%40yahoo.com"
       TITLE="[Gtk-sharp-list] glade# cross platform">d4ljoyn@yahoo.com
       </A><BR>
    <I>Thu, 7 Aug 2003 04:01:56 -0700 (PDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="002242.html">[Gtk-sharp-list] How the bindings work
</A></li>
        <LI> Next message: <A HREF="002247.html">[Gtk-sharp-list] glade# cross platform
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2244">[ date ]</a>
              <a href="thread.html#2244">[ thread ]</a>
              <a href="subject.html#2244">[ subject ]</a>
              <a href="author.html#2244">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--0-1861489592-1060254116=:25035
Content-Type: text/plain; charset=us-ascii

I'm trying to make sure that ui elements work on ..net, mono windows, and mono linux.
The .NET runtime requires that callback delegates use the stdcall calling convention. This is noted in the msdn, the mono FAQ, and there is a bugzilla entry for this topic as well.
 
The libglade callback for autoconnecting signal handlers doesn't use this convention, so .NET users might encounter strange behavior -- I've noticed that either not all handlers are actually connected or you'll get NullReference exception from gtk_main().  It's a stack corruption so the behavior is undefined.
 
I've confirmed this by changing the function signature in libglade-2.0.1 under windows, glade-xml.h:
 
typedef void (__stdcall *GladeXMLConnectFunc) (const gchar *handler_name,
         GObject *object,
         const gchar *signal_name,
         const gchar *signal_data,
         GObject *connect_object,
         gboolean after,
         gpointer user_data);
 
which represents this delegate in gtk#, XML.cs (XML.custom).
 
  delegate void RawXMLConnectFunc (string handler_name, IntPtr objekt, 
               string signal_name, string signal_data, 
               IntPtr connect_object, int after, IntPtr user_data);
   
Unfortunately, this breaks on mono windows.  So I currently have two versions of libglade -- one with the above modification that I place in the executable directory of a .NET application, the other in the windows PATH which is picked up by mono.
 
This is not an issue with  Linux.  I haven't come up with good permanent approach to this problem.  Can anyone else confirm this ?  If so, any solutions ?
 
Thank you
Dave Joyner


---------------------------------
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
--0-1861489592-1060254116=:25035
Content-Type: text/html; charset=us-ascii

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META http-equiv=Content-Type content=&quot;text/html; charset=iso-8859-1&quot;&gt;
&lt;META content=&quot;MSHTML 6.00.2800.1106&quot; name=GENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=#ffffff&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;I'm trying to make sure that ui elements work on 
..net, mono windows, and mono linux.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;The .NET runtime requires that callback delegates 
use the stdcall calling convention. This is noted in the msdn, the mono FAQ, and 
there is a bugzilla entry for this topic as well.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;The libglade callback for autoconnecting signal 
handlers doesn't use this convention, so .NET users might encounter strange 
behavior -- I've noticed that either not all handlers are actually connected or 
you'll get NullReference exception from gtk_main().&amp;nbsp; It's a stack 
corruption so the behavior is undefined.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;I've confirmed this by changing the 
function&amp;nbsp;signature&amp;nbsp;in libglade-2.0.1 under windows, 
glade-xml.h:&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;typedef void (__stdcall *GladeXMLConnectFunc) 
(const gchar *handler_name,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 
GObject *object,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; const gchar 
*signal_name,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; const gchar 
*signal_data,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; GObject 
*connect_object,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; gboolean 
after,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; gpointer 
user_data);&lt;/FONT&gt;&lt;/DIV&gt;&lt;FONT face=Arial size=2&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;which represents this delegate in gtk#, XML.cs (XML.custom).&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;delegate void RawXMLConnectFunc (string handler_name, IntPtr 
objekt, 
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 
string signal_name, string signal_data, 
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 
IntPtr connect_object, int after, IntPtr user_data);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;Unfortunately, this breaks on&amp;nbsp;mono windows.&amp;nbsp; So I currently have 
two versions of libglade -- one with the above modification that I place in the 
executable directory of a .NET application, the other in the windows PATH which 
is picked up by mono.&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;This is not an issue with &amp;nbsp;Linux.&amp;nbsp; I haven't come up with good 
permanent approach to this problem.&amp;nbsp; Can anyone else confirm this ?&amp;nbsp; 
If so, any solutions ?&lt;/DIV&gt;
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV&gt;Thank you&lt;/DIV&gt;
&lt;DIV&gt;Dave Joyner&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;
&lt;p&gt;&lt;hr SIZE=1&gt;
Do you Yahoo!?&lt;br&gt;
&lt;a href=&quot;<A HREF="http://us.rd.yahoo.com/evt=10469/*http://sitebuilder.yahoo.com"">http://us.rd.yahoo.com/evt=10469/*http://sitebuilder.yahoo.com&quot;</A>&gt;Yahoo! SiteBuilder&lt;/a&gt; - Free, easy-to-use web site design software
--0-1861489592-1060254116=:25035--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002242.html">[Gtk-sharp-list] How the bindings work
</A></li>
	<LI> Next message: <A HREF="002247.html">[Gtk-sharp-list] glade# cross platform
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2244">[ date ]</a>
              <a href="thread.html#2244">[ thread ]</a>
              <a href="subject.html#2244">[ subject ]</a>
              <a href="author.html#2244">[ author ]</a>
         </LI>
       </UL>
</body></html>
