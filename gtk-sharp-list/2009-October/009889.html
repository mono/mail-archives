<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] GIO# System.InvalidCastException in VolumeMonitor.MountAdded event
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20GIO%23%20System.InvalidCastException%20in%0A%20VolumeMonitor.MountAdded%20event&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009888.html">
   <LINK REL="Next"  HREF="009890.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] GIO# System.InvalidCastException in VolumeMonitor.MountAdded event</H1>
    <B>Chris Szikszoy</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20GIO%23%20System.InvalidCastException%20in%0A%20VolumeMonitor.MountAdded%20event&In-Reply-To="
       TITLE="[Gtk-sharp-list] GIO# System.InvalidCastException in VolumeMonitor.MountAdded event">chris at szikszoy.com
       </A><BR>
    <I>Fri Oct  9 16:54:25 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="009888.html">[Gtk-sharp-list] Gtk-sharp RedHat Linux installation
</A></li>
        <LI>Next message: <A HREF="009890.html">[Gtk-sharp-list] GIO# System.InvalidCastException in VolumeMonitor.MountAdded event
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9889">[ date ]</a>
              <a href="thread.html#9889">[ thread ]</a>
              <a href="subject.html#9889">[ subject ]</a>
              <a href="author.html#9889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I saw that GIO# bindings landed in the mainline gtk# branch recently and
wanted experiment to see if I could replace the old Gnome.VFS in my
application.  I've built the latest gtk# from svn and am running into a
problem with the VolumeMonitor.Mount* signals.  I keep getting an
InvalidCastException when trying to access args.Mount from any of the events
(MountAdded, MountRemoved, MountPreUnmount, MountChanged).

I've looked at the generated code and it seems to be failing at here:
public Mount Mount{
	get {
		return (GLib.Mount)GLib.SignalArgs.get_Args()[0];
	}
}

Try running this application to observe:
using System;
using GLib;
using Gtk;
namespace giotest
{
	class MainClass
	{
		public static void Main (string[] args)
		{
			Gtk.Application.Init ();
			
			VolumeMonitor mon = VolumeMonitor.Default;

			mon.MountAdded += delegate(object o, MountAddedArgs a) {
				Console.WriteLine (&quot;Mount Added: {0}&quot;, a.Mount.Name);
			};
			
			mon.MountRemoved += delegate(object o, MountRemovedArgs a) {
				Console.WriteLine (&quot;Mount removed: {0}&quot;, a.Mount.Name);
			};
			
			Gtk.Application.Run ();
		}
	}
}

The relevant parts of the exception are:
Marshaling mount-added signal
Exception in Gtk# callback delegate
  Note: Applications can use GLib.ExceptionManager.UnhandledException to
handle the exception.
System.Reflection.TargetInvocationException: Exception has been thrown by
the target of an invocation. ---&gt; System.InvalidCastException: Cannot cast
from source type to destination type.
  at GLib.MountAddedArgs.get_Mount () [0x00000] 
  at giotest.MainClass.&lt;Main&gt;m__0 (System.Object o, GLib.MountAddedArgs a)
[0x00000] in /home/chris/Projects/giotest/giotest/Main.cs:1 
  at (wrapper managed-to-native) System.Reflection.MonoMethod:InternalInvoke
(object,object[],System.Exception&amp;)
  at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags
invokeAttr, System.Reflection.Binder binder, System.Object[] parameters,
System.Globalization.CultureInfo culture) [0x00000] 
  --- End of inner exception stack trace ---

Should I file a bug?  I found the GTK# bugzilla at bugzilla.novell.com but I
wasn't sure if that was the right place.

Thanks in advance for all the help.
- Chris
-- 
View this message in context: <A HREF="http://www.nabble.com/GIO--System.InvalidCastException-in-VolumeMonitor.MountAdded-event-tp25815236p25815236.html">http://www.nabble.com/GIO--System.InvalidCastException-in-VolumeMonitor.MountAdded-event-tp25815236p25815236.html</A>
Sent from the Mono - Gtk# mailing list archive at Nabble.com.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009888.html">[Gtk-sharp-list] Gtk-sharp RedHat Linux installation
</A></li>
	<LI>Next message: <A HREF="009890.html">[Gtk-sharp-list] GIO# System.InvalidCastException in VolumeMonitor.MountAdded event
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9889">[ date ]</a>
              <a href="thread.html#9889">[ thread ]</a>
              <a href="subject.html#9889">[ subject ]</a>
              <a href="author.html#9889">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
