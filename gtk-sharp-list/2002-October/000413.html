<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Re: win32 patch stuffs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:vladimir%40pobox.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000484.html">
   <LINK REL="Next"  HREF="000414.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Re: win32 patch stuffs
   </H1>
    <B>Vladimir Vukicevic
    </B> 
    <A HREF="mailto:vladimir%40pobox.com"
       TITLE="[Gtk-sharp-list] Re: win32 patch stuffs">vladimir@pobox.com
       </A><BR>
    <I>08 Oct 2002 21:37:57 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="000484.html">[Gtk-sharp-list] first pass at win32 patch
</A></li>
        <LI> Next message: <A HREF="000414.html">[Gtk-sharp-list] final win32 patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#413">[ date ]</a>
              <a href="thread.html#413">[ thread ]</a>
              <a href="subject.html#413">[ subject ]</a>
              <a href="author.html#413">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-eLrs/A+pVv9mBcXDO3mI
Content-Type: text/plain
Content-Transfer-Encoding: 7bit


Ugh.  win32 patch got held up because it was too big.  URL to patch,
attached to this is a corrected glue/win32dl.c, and the following is the
text from the previous email.

Current problem: it looks like the dll has exports like &quot;_gtksharp_...&quot;,
and the runtime is trying to import &quot;gtksharp_...&quot;.  Hmm.

Url to patch: <A HREF="http://www.vlad1.com/~vladimir/win32.patch">http://www.vlad1.com/~vladimir/win32.patch</A>

Ok, there's a bunch of little changes in this patch, some correct, some
not so correct.  It builds, but executables still claim they can't find
gtksharpglue.dll.. i'm trying to figure that out now.  Anyway, here's a
general list of patches:

- glib/LibraryNames.cs has a set of const strings that define the dlls. 
Things like GLib.LibraryNames.GTK_LIB  (Yes, this should be in the
GtkSharp namespace, but I chose it wrong the first time and I didn't
want to re-sed everything.  Can easily be changed.)
        - sources/gtk-sharp.sources lib names changed to these strings
        - generator taught to not output &quot;&quot;s around &quot;library&quot; names that
start
with GLib (should be GtkSharp).
        - api/*.xml files are manually patched by this patch

- api/makefile.win32 added to generate code

- glue/makefile.win32 added to build a mingw32 DLL. this is MOSTLY
CORRECT, but it doesn't quite seem to work, or the dll's are not being
searched for correctly, or something.

- glue/win32dll.c - dll entry points.  this is the most likely culprit
in the dll not working; i'm looking up docs in a sec on how to do this
right, just wanted to get this patch out.

- generator/Parameters.cs: don't claim that params that have &quot;void&quot; as
the cstype are Valid (*** necessary for mcs now as well, since the void
type fix went in toady)

- generator/SignalHandler.cs: signal handler marshallers
(&quot;voidPropertyBlahSignal&quot;) or whatever are now put in the
GtkSharp.&lt;BaseNamespace&gt;Signals namespace instead of
GtkSharp.&lt;BaseNamespace&gt;.  This fixes the problem with csc of it
resolving namespaces against current ones (so you couldn't use
Gtk.Widget from GtkSharp.Gtk.xxx).

- generator/makefile.win32: removed codegen line, put it in the
api/makefile.win32

- various *.custom, glib/*.cs files: removed hard-coded library names
and changed to references of the const strings

- gtk/Table.custom: commented out the extra no-argument default
constructor, because one with the same signature but a different
protection level was being auto-generated.  mcs does not complain about
this, csc does -- most likely a mcs bug.  The default constructor here
is useful, but not horribly so.


That should be it.  I'm building with mingw32 installed from cygwin with
a full cygwin/gnu toolchain (but using mingw32 for the actual build
tools).  win32 libs of gtk+2 and related are from
<A HREF="http://www.gimp.org/~tml/gimp/win32/downloads.html">http://www.gimp.org/~tml/gimp/win32/downloads.html</A> .

        - Vlad


--=-eLrs/A+pVv9mBcXDO3mI
Content-Disposition: attachment; filename=win32dll.c
Content-Transfer-Encoding: quoted-printable
Content-Type: text/x-c; name=win32dll.c; charset=ANSI_X3.4-1968


#define WIN32_LEAN_AND_MEAN
#include &lt;windows.h&gt;
#undef WIN32_LEAN_AND_MEAN
#include &lt;stdio.h&gt;

BOOL APIENTRY DllMain (HINSTANCE hInst, DWORD reason, LPVOID reserved)
{
	return TRUE;
}


BOOL APIENTRY DllMainCRTStartup (HINSTANCE hInst, DWORD reason, LPVOID rese=
rved)
{
	return TRUE;
}

--=-eLrs/A+pVv9mBcXDO3mI--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000484.html">[Gtk-sharp-list] first pass at win32 patch
</A></li>
	<LI> Next message: <A HREF="000414.html">[Gtk-sharp-list] final win32 patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#413">[ date ]</a>
              <a href="thread.html#413">[ thread ]</a>
              <a href="subject.html#413">[ subject ]</a>
              <a href="author.html#413">[ author ]</a>
         </LI>
       </UL>
</body></html>
