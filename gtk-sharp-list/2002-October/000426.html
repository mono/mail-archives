<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Gtk# threading problem?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pbaena%40uol.com.ar">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000424.html">
   <LINK REL="Next"  HREF="000428.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Gtk# threading problem?
   </H1>
    <B>Pablo Baena
    </B> 
    <A HREF="mailto:pbaena%40uol.com.ar"
       TITLE="[Gtk-sharp-list] Gtk# threading problem?">pbaena@uol.com.ar
       </A><BR>
    <I>10 Oct 2002 03:09:26 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="000424.html">[Gtk-sharp-list] Gtk# threading problem?
</A></li>
        <LI> Next message: <A HREF="000428.html">[Gtk-sharp-list] Gtk# threading problem?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#426">[ date ]</a>
              <a href="thread.html#426">[ thread ]</a>
              <a href="subject.html#426">[ subject ]</a>
              <a href="author.html#426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-FlQBQhGwm+CZKX++ZZT1
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Should this work? Because it doesn't.

Thank you!!!
Pablo


namespace test
{
	using Gtk;
	using Gdk;
	using GtkSharp;
	using System;
	using System.IO;
	using System.Drawing;
	using System.Runtime.InteropServices;
	using System.Diagnostics;
	using System.Threading;
	using Gnome;
=09
	class mainone
	{
		public static void Main(string[] args)
		{
			test_threads tt =3D new test_threads(args);
		}
	}

	class test_threads
	{
		public Gnome.App window =3D null;
		TextView textview =3D null;
		ThreadNotify tn =3D null;=20
		string output=3Dnull;
					=09
		public test_threads(string[] args)
		{
			tn=3Dnew ThreadNotify(new ReadyEvent(show_status));

			Program kit =3D new Program (&quot;test&quot;, &quot;0.0.1&quot;, Modules.UI,
				args);
			window =3D new Gnome.App (&quot;test&quot;, &quot;Test&quot;);
			window.SetDefaultSize (250, 200);=09
			window.DeleteEvent +=3D new DeleteEventHandler (Window_Delete);
		=09
			VBox box1 =3D new VBox (false, 0);

			Button btn =3D new Button (&quot;Click Me&quot;);
			btn.Clicked +=3D new EventHandler (btn_click);
			box1.PackStart (btn, true, true, 4);

			ScrolledWindow sw =3D new ScrolledWindow ();
			textview =3D new TextView();
			textview.Editable =3D false;
			textview.WrapMode =3D Gtk.WrapMode.Char;
			textview.CursorVisible =3D false;
			sw.Add(textview);
			box1.PackStart (sw, true, true, 4);

			window.Contents=3Dbox1;
			window.ShowAll ();
			kit.Run();
		}=09

		void btn_click (object obj, EventArgs args)
		{
			Thread thr =3D new Thread (new ThreadStart (ThreadFunc));
			thr.Start ();
			Console.WriteLine (&quot;Button Clicked&quot;);
		}

		void Window_Delete (object obj, DeleteEventArgs args)
		{
			Application.Quit ();
			args.RetVal =3D true;
		}

		public void show_status()
		{
			TextBuffer buff =3D textview.Buffer;
			Console.WriteLine(&quot;showing: &quot;+output);
			buff.InsertAtCursor(output+'\n', -1);
		}
			=09
		public void ThreadFunc()
		{
			ProcessStartInfo psi =3D new ProcessStartInfo();
			psi.FileName=3D&quot;ls&quot;;
			psi.Arguments=3D&quot;/usr/share/doc&quot;;
			psi.WorkingDirectory=3D&quot;/tmp/&quot;;
			psi.RedirectStandardOutput=3Dtrue;
			Process p =3D Process.Start(psi);
			string tmp;
			while ((tmp =3D p.StandardOutput.ReadLine())!=3Dnull) {
				Console.WriteLine(&quot;sending: &quot;+tmp);
				output=3Dtmp;
				tn.WakeupMain();
				//show_status();
			}
		}
	}
}



On Wed, 2002-10-09 at 23:25, Miguel de Icaza wrote:

    &gt; What I found out is that getting all the gnome stuff from my program
    &gt; out, it does what it is meant. I mean, commenting all the gnome stuff
    &gt; from my program.=20
   =20
    You are using Gtk from two threads (one is the main loop, and you are
    pushing data onto a widget in the other).  Gtk is not thread safe, you
    can not do this.
   =20
    You need to have your thread load the data, and when it is ready to
    process it, wake up the main thread and have the main thread (which has
    the Gtk main loop) feed the data to the widget.
   =20
    Look at the ThreadNotify class in Gtk# which simplifies the complexicty
    of doing this.
   =20
    Miguel
   =20
    _______________________________________________
    Gtk-sharp-list maillist  -  <A HREF="mailto:Gtk-sharp-list@ximian.com">Gtk-sharp-list@ximian.com</A>

<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>


________________________________________________________________________


&lt;Tetsuo&gt; la vida es muy ironica vio?
&lt;Ranma&gt; sip la verdad que se nos esta cagando de risa!
&lt;Ranma&gt; y la voy a cagar a pi=F1as

--=-FlQBQhGwm+CZKX++ZZT1
Content-Type: text/html; charset=utf-8

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 TRANSITIONAL//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
  &lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; CHARSET=UTF-8&quot;&gt;
  &lt;META NAME=&quot;GENERATOR&quot; CONTENT=&quot;GtkHTML/1.0.4&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
Should this work? Because it doesn't.
&lt;BR&gt;

&lt;BR&gt;
Thank you!!!
&lt;BR&gt;
Pablo
&lt;BR&gt;

&lt;PRE&gt;namespace test
{
	using Gtk;
	using Gdk;
	using GtkSharp;
	using System;
	using System.IO;
	using System.Drawing;
	using System.Runtime.InteropServices;
	using System.Diagnostics;
	using System.Threading;
	using Gnome;
	
	class mainone
	{
		public static void Main(string[] args)
		{
			test_threads tt = new test_threads(args);
		}
	}

	class test_threads
	{
		public Gnome.App window = null;
		TextView textview = null;
		ThreadNotify tn = null; 
		string output=null;
						
		public test_threads(string[] args)
		{
			tn=new ThreadNotify(new ReadyEvent(show_status));

			Program kit = new Program (&amp;quot;test&amp;quot;, &amp;quot;0.0.1&amp;quot;, Modules.UI,
				args);
			window = new Gnome.App (&amp;quot;test&amp;quot;, &amp;quot;Test&amp;quot;);
			window.SetDefaultSize (250, 200);	
			window.DeleteEvent += new DeleteEventHandler (Window_Delete);
			
			VBox box1 = new VBox (false, 0);

			Button btn = new Button (&amp;quot;Click Me&amp;quot;);
			btn.Clicked += new EventHandler (btn_click);
			box1.PackStart (btn, true, true, 4);

			ScrolledWindow sw = new ScrolledWindow ();
			textview = new TextView();
			textview.Editable = false;
			textview.WrapMode = Gtk.WrapMode.Char;
			textview.CursorVisible = false;
			sw.Add(textview);
			box1.PackStart (sw, true, true, 4);

			window.Contents=box1;
			window.ShowAll ();
			kit.Run();
		}	

		void btn_click (object obj, EventArgs args)
		{
			Thread thr = new Thread (new ThreadStart (ThreadFunc));
			thr.Start ();
			Console.WriteLine (&amp;quot;Button Clicked&amp;quot;);
		}

		void Window_Delete (object obj, DeleteEventArgs args)
		{
			Application.Quit ();
			args.RetVal = true;
		}

		public void show_status()
		{
			TextBuffer buff = textview.Buffer;
			Console.WriteLine(&amp;quot;showing: &amp;quot;+output);
			buff.InsertAtCursor(output+'\n', -1);
		}
				
		public void ThreadFunc()
		{
			ProcessStartInfo psi = new ProcessStartInfo();
			psi.FileName=&amp;quot;ls&amp;quot;;
			psi.Arguments=&amp;quot;/usr/share/doc&amp;quot;;
			psi.WorkingDirectory=&amp;quot;/tmp/&amp;quot;;
			psi.RedirectStandardOutput=true;
			Process p = Process.Start(psi);
			string tmp;
			while ((tmp = p.StandardOutput.ReadLine())!=null) {
				Console.WriteLine(&amp;quot;sending: &amp;quot;+tmp);
				output=tmp;
				tn.WakeupMain();
				//show_status();
			}
		}
	}
}&lt;/PRE&gt;

&lt;BR&gt;

&lt;BR&gt;
On Wed, 2002-10-09 at 23:25, Miguel de Icaza wrote:
    &lt;BLOCKQUOTE&gt;
&lt;PRE&gt;&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&amp;gt; What I found out is that getting all the gnome stuff from my program&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&amp;gt; out, it does what it is meant. I mean, commenting all the gnome stuff&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&amp;gt; from my program. &lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;You are using Gtk from two threads (one is the main loop, and you are&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;pushing data onto a widget in the other).  Gtk is not thread safe, you&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;can not do this.&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;You need to have your thread load the data, and when it is ready to&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;process it, wake up the main thread and have the main thread (which has&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;the Gtk main loop) feed the data to the widget.&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;Look at the ThreadNotify class in Gtk# which simplifies the complexicty&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;of doing this.&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;Miguel&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;_______________________________________________&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;
&lt;FONT COLOR=&quot;#737373&quot;&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;Gtk-sharp-list maillist  -  <A HREF="mailto:Gtk-sharp-list@ximian.com">Gtk-sharp-list@ximian.com</A>&lt;/FONT&gt;&lt;/FONT&gt;&lt;/I&gt;&lt;/PRE&gt;
    &lt;/BLOCKQUOTE&gt;
&lt;A HREF=&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list"">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list&quot;</A>&gt;&lt;FONT SIZE=&quot;3&quot;&gt;&lt;I&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</FONT">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list&lt;/FONT</A>&gt;&lt;/I&gt;&lt;/A&gt;
&lt;TABLE CELLSPACING=&quot;0&quot; CELLPADDING=&quot;0&quot; WIDTH=&quot;100%&quot;&gt;
&lt;TR&gt;
&lt;TD&gt;

&lt;BR&gt;

&lt;HR&gt;

&lt;BR&gt;

&lt;PRE&gt;&amp;lt;Tetsuo&amp;gt; la vida es muy ironica vio?
&amp;lt;Ranma&amp;gt; sip la verdad que se nos esta cagando de risa!
&amp;lt;Ranma&amp;gt; y la voy a cagar a pi&amp;#241;as&lt;/PRE&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TABLE&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;

--=-FlQBQhGwm+CZKX++ZZT1--



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000424.html">[Gtk-sharp-list] Gtk# threading problem?
</A></li>
	<LI> Next message: <A HREF="000428.html">[Gtk-sharp-list] Gtk# threading problem?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#426">[ date ]</a>
              <a href="thread.html#426">[ thread ]</a>
              <a href="subject.html#426">[ subject ]</a>
              <a href="author.html#426">[ author ]</a>
         </LI>
       </UL>
</body></html>
