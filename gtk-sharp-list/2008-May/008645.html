<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Child windows in a seperate dll file.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Child%20windows%20in%20a%20seperate%20dll%20file.&In-Reply-To=16966107.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008642.html">
   <LINK REL="Next"  HREF="008646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Child windows in a seperate dll file.</H1>
    <B>Michael Hutchinson</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Child%20windows%20in%20a%20seperate%20dll%20file.&In-Reply-To=16966107.post%40talk.nabble.com"
       TITLE="[Gtk-sharp-list] Child windows in a seperate dll file.">m.j.hutchinson at gmail.com
       </A><BR>
    <I>Tue May  6 00:48:31 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008642.html">[Gtk-sharp-list] Gtk.TreePath double free	/	TreeModelImplementor
</A></li>
        <LI>Next message: <A HREF="008646.html">[Gtk-sharp-list] Need help .parsing desktop files!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8645">[ date ]</a>
              <a href="thread.html#8645">[ thread ]</a>
              <a href="subject.html#8645">[ subject ]</a>
              <a href="author.html#8645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Apr 29, 2008 at 1:42 PM, Induane &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">oldspiceap at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>  Greetings, I'm new to programming and thus to C#.  In fact I'm only a few
</I>&gt;<i>  weeks into my learning process.  I've written an app for work and now am
</I>&gt;<i>  rewriting it so that its not so hideous and ugly.  At the moment its at like
</I>&gt;<i>  8000 lines and all in one class with just a ton of methods.
</I>
Wow. that's pretty big. I generally find it's unusual for a file to
pass 1000 lines, and very rare to pass 2000.

I think your problem is that you are not structuring your code in an
object-oriented way. When your are designing your code, structure it
as objects with behaviors, properties etc inherent to those objects.
If there is common functionality that you need to share between
similar objects, put it in a base class, etc.

&gt;<i>  Anyways I've started rewriting it and decided to split the eventhandlers
</I>&gt;<i>  into their own dll file so that it would be easier to maintain and cleaner.
</I>
Why are you splitting event handlers into a separate dll file? What
kind of handlers are you splitting out? Event handlers are generally
pretty specific to the situation, so this doesn't make much sense to
me.

You can have more than one .cs file compile into a single dll or exe

&gt;<i>  This worked to a degree but I'd like to create dialogs that come up and
</I>&gt;<i>  unfortunately I cannot seem to make that happen as it cannot compile due to
</I>&gt;<i>  being unable to locate the parent window.
</I>
Note that the signature of an EventHandler (object sender, EventArgs
args) passes you the object that emitted the event as the first
argument.

&gt;<i>  I have the program split up into
</I>&gt;<i>  three files now:
</I>&gt;<i>
</I>&gt;<i>  First is a simple file for the exe:
</I>&gt;<i>
</I>&gt;<i>  using System;
</I>&gt;<i>  using drawInterface;
</I>&gt;<i>  // We'll be using these later I think.
</I>&gt;<i>  // using Gtk;
</I>&gt;<i>  // using GtkSharp;
</I>&gt;<i>
</I>&gt;<i>  namespace ApplicationWrapper
</I>&gt;<i>  {
</I>&gt;<i>
</I>&gt;<i>         class applicationWrapper
</I>&gt;<i>         {
</I>&gt;<i>
</I>&gt;<i>                 static void Main()
</I>&gt;<i>                 {
</I>&gt;<i>
</I>&gt;<i>                 sowInterface drawSow = new sowInterface();
</I>&gt;<i>                 drawSow.MainInterface();
</I>&gt;<i>
</I>&gt;<i>                 }
</I>&gt;<i>
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>  }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Simple enough even for someone as slow as me.  Now onto the code to draw the
</I>&gt;<i>  interface (almost nothing yet but its a rewrite ;) don't make fun!
</I>&gt;<i>
</I>&gt;<i>  using System;
</I>&gt;<i>  using Gtk;
</I>&gt;<i>  using GtkSharp;
</I>&gt;<i>  using eventHandlers;
</I>&gt;<i>
</I>&gt;<i>  namespace drawInterface
</I>&gt;<i>  {
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         public class sowInterface
</I>&gt;<i>         {
</I>&gt;<i>
</I>&gt;<i>                 public void MainInterface ()
</I>&gt;<i>
</I>&gt;<i>                         {
</I>&gt;<i>
</I>&gt;<i>                         Application.Init ();
</I>&gt;<i>
</I>&gt;<i>                         Window window = new Window (&quot;Statement of Work Generator&quot;);
</I>&gt;<i>
</I>&gt;<i>                         /* Set a handler for delete_event that immediately
</I>&gt;<i>                         * exits GTK. */
</I>&gt;<i>                         window.DeleteEvent += OnDelete;
</I>&gt;<i>
</I>&gt;<i>                         // sets windows size by default.  We'll see if we need this later on.
</I>&gt;<i>                         // window.SetDefaultSize (200,200);
</I>&gt;<i>
</I>&gt;<i>                         /* Set the border width of the window and show the window itself.*/
</I>&gt;<i>                         window.BorderWidth= 5;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>                         /* Create a big ass table and place it inside the main window.*/
</I>&gt;<i>                         Table table = new Table (26, 4, false);
</I>&gt;<i>                         table.SetColSpacing(0, 16);
</I>... snip
&gt;<i>
</I>&gt;<i>                         window.ShowAll();
</I>&gt;<i>                         Application.Run();
</I>&gt;<i>
</I>&gt;<i>                         }
</I>&gt;<i>
</I>&gt;<i>                         OnDelete2 OnDelete = new OnDelete2();
</I>&gt;<i>
</I>&gt;<i>                         /*
</I>&gt;<i>
</I>&gt;<i>                         // Handles exiting when you click the X button - temp disabled as trying
</I>&gt;<i>  to split into dll
</I>&gt;<i>                         static void OnDelete (object obj, DeleteEventArgs e)
</I>&gt;<i>                         {
</I>&gt;<i>                         Application.Quit();
</I>&gt;<i>                         }
</I>&gt;<i>
</I>&gt;<i>                         */
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  }
</I>
For a start, you could have this class subclass Gtk.Window.

public class MainInterface : Gtk.Window
{
    public MainInterface () : base (&quot;My window title&quot;)
    {
        //construct the GUI
        //hook up the event handlers
    }

    //define the event handlers
}

then your main class

public class MyApplication
{
    public static void Main ()
    {
        Application.Init ()
        MainWindow win = new MainWindow ();
        Application.Run ()
    }
}

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  and now the file I'm using for the event handler:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  using System;
</I>&gt;<i>  using Gtk;
</I>&gt;<i>  using GtkSharp;
</I>&gt;<i>
</I>&gt;<i>  namespace eventHandlers
</I>&gt;<i>  {
</I>&gt;<i>
</I>&gt;<i>         public class event_handlers
</I>&gt;<i>         {
</I>&gt;<i>
</I>&gt;<i>                 public static void OnDelete2 (object obj, DeleteEventArgs e)
</I>&gt;<i>                 {
</I>&gt;<i>                         /*
</I>&gt;<i>                         MessageDialog md = new MessageDialog (window,
</I>&gt;<i>                         DialogFlags.DestroyWithParent,
</I>&gt;<i>                         MessageType.Question,
</I>&gt;<i>                         ButtonsType.YesNo, &quot;Are you sure you want to quit?&quot;);
</I>&gt;<i>
</I>&gt;<i>                         ResponseType result = (ResponseType)md.Run ();
</I>&gt;<i>
</I>&gt;<i>                         if (result == ResponseType.Yes)
</I>&gt;<i>                         {
</I>&gt;<i>                         Application.Quit();
</I>&gt;<i>                         }
</I>&gt;<i>                         else
</I>&gt;<i>                         {
</I>&gt;<i>                         md.Destroy();
</I>&gt;<i>                         }
</I>&gt;<i>                         }
</I>&gt;<i>                         */
</I>&gt;<i>                         Application.Quit();
</I>&gt;<i>
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>  }
</I>
And again, you can encapsulate this into a class:

public class QuitDialog : MessageDialog
{
    public QuitDialog (Window parent)
        : base (window,
                   DialogFlags.DestroyWithParent,
                   MessageType.Question,
                   ButtonsType.YesNo,
                   &quot;Are you sure you want to quit?&quot;)
    {
    }

    public void RunDialog ()
    {
        ShowAll ();
        ResponseType result = (ResponseType)Run ();
        if (result == ResponseType.Yes) {
            Application.Quit();
        }
        Hide ();
    }

    public override Dispose ()
    {
        Destroy ();
        base.Dispose ();
    }
}

Note that this is a nice re-usable chunk of code that will go quite
nicely in its own file. You can compile it into your main exe or into
a separate dll if you want to share it between apps.

You can use this with

using (QuitDialog qd = new QuitDialog ((Window) sender)) {
    qd.RunDialog ();
}



&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  As you can see I've commented out the confirmation dialog box.  I had though
</I>&gt;<i>  instancing it in my main drawinterface would make it work but it doesn't.
</I>&gt;<i>  Can anyone point me in the right direction?
</I>
Look up the difference betwen static and instance members. A static
member in the event_handlers class has no way to access members of an
instance of the main app class without a pointer to that instance.

&gt;<i>  Also eventually part of the code will eventually have certain events calling
</I>&gt;<i>  methods that change the values and labels of other widgets so I need to
</I>&gt;<i>  figure out how to do that across libraries as well.
</I>
If your widgets are public properties of the main window, you can
access them via a pointer to an instance of that window, e.g.
  MainWindow main = (MainWindow)sender;
  main.SomeLabel.Text = &quot;Hello&quot;;

However, I strongly advise against breaking up a class into pieces
without fixing the inderlying structure. You should structure your
code into objects with the behaviours specific to those objects baked
into them.

&gt;<i>  Many thanks and kind regards.  Hopefully someone can point me in the right
</I>&gt;<i>  direction.
</I>
I suggest taking a look at MonoDevelop and its GTK# designer. It
designs widgets and windows based on these principles.

In particular <A HREF="http://www.monodevelop.com/Creating_custom_widgets_with_MonoDevelop">http://www.monodevelop.com/Creating_custom_widgets_with_MonoDevelop</A>

&gt;<i>
</I>&gt;<i>  Brant Watson
</I>&gt;<i>
</I>&gt;<i>  P.S. I've also attached an archive that includes my old (horrible) source
</I>&gt;<i>  code as well as the beginnings that are listed above and the makefile to
</I>&gt;<i>  compile the new version.  Eventually I'd like to add a preferences dialog as
</I>&gt;<i>  well and make that its own library so that it can be worked on
</I>&gt;<i>  independently.  So I'll need to be passing things back and fourth like a
</I>&gt;<i>  madman.
</I>&gt;<i>  <A HREF="http://www.nabble.com/file/p16966107/StatementofWork.tar.gz">http://www.nabble.com/file/p16966107/StatementofWork.tar.gz</A>
</I>&gt;<i>  StatementofWork.tar.gz
</I>&gt;<i>  --
</I>&gt;<i>  View this message in context: <A HREF="http://www.nabble.com/Child-windows-in-a-seperate-dll-file.-tp16966107p16966107.html">http://www.nabble.com/Child-windows-in-a-seperate-dll-file.-tp16966107p16966107.html</A>
</I>&gt;<i>  Sent from the Mono - Gtk# mailing list archive at Nabble.com.
</I>&gt;<i>
</I>&gt;<i>  _______________________________________________
</I>&gt;<i>  Gtk-sharp-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">Gtk-sharp-list at lists.ximian.com</A>
</I>&gt;<i>  <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>
</I>&gt;<i>
</I>


-- 
Michael Hutchinson
<A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008642.html">[Gtk-sharp-list] Gtk.TreePath double free	/	TreeModelImplementor
</A></li>
	<LI>Next message: <A HREF="008646.html">[Gtk-sharp-list] Need help .parsing desktop files!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8645">[ date ]</a>
              <a href="thread.html#8645">[ thread ]</a>
              <a href="subject.html#8645">[ subject ]</a>
              <a href="author.html#8645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
