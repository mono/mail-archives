<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] gtk-dotnet performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20gtk-dotnet%20performance&In-Reply-To=1141230387.2106.22.camel%40arroyo.homelinux.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006976.html">
   <LINK REL="Next"  HREF="006980.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] gtk-dotnet performance</H1>
    <B>Jonathan Resnick</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20gtk-dotnet%20performance&In-Reply-To=1141230387.2106.22.camel%40arroyo.homelinux.org"
       TITLE="[Gtk-sharp-list] gtk-dotnet performance">jresnick at gmail.com
       </A><BR>
    <I>Wed Mar  1 13:02:36 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="006976.html">[Gtk-sharp-list] gtk-dotnet performance
</A></li>
        <LI>Next message: <A HREF="006980.html">[Gtk-sharp-list] gtk-dotnet performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6979">[ date ]</a>
              <a href="thread.html#6979">[ thread ]</a>
              <a href="subject.html#6979">[ subject ]</a>
              <a href="author.html#6979">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Scott,

Thanks so much for taking a look at my sample.  I think the memory leak is
not so much a leak as just the latency of the garbage collector not being
able to recover the memory as fast as it is used up.

For that reason, it would really be best if I didn't have to create the
Graphics object inside of the loop, which is why I started looking at using
an intermediate Pixmap.  I'm surpised you're not seeing the 1 second times
that I observed when drawing to the Pixmap.  Not to be pedantic, but I
forgot to mention in my original post that you need to change the value
passed to the PictureArea() constructor, inside of the MainWindow()
constructor, to false in order for it to use the pixmap option.  If you have
a chance to try this and see if you observe the 1 second times, that would
be great.  I hope I'm not asking too much here... I just can't understand
why it should be any slower to copy an image to a Pixmap than directly to a
DrawingArea.

On the other hand, if you know of any other way to display a
System.Drawing.Bitmap inside a Gtk window that might work better, I'm open
to suggestions.

Thanks again,
Jonathan

 

-----Original Message-----
From: Scott Ellington [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">scottellington at comcast.net</A>] 
Sent: Wednesday, March 01, 2006 11:26 AM
To: Jonathan Resnick
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">gtk-sharp-list at lists.ximian.com</A>
Subject: Re: [Gtk-sharp-list] gtk-dotnet performance

Hi Jonathan,

I have just tried your test app and I am not seeing times near 1 second:

Frame 197: 116 msec
Frame 198: 148 msec
Frame 199: 106 msec

As for your first option, there is definitely a memory leak ocurring.  I
could not pinpoint where that is, but I believe you are incorrect in
thinking that it is the Gtk.DotNet.Graphics.FromDrawable (window) in the
Expose Event.  I do that exact thing with no such memory leak:

<A HREF="http://forge.novell.com/modules/xfmod/svn/svnbrowse.php?uri=filedetails.php%">http://forge.novell.com/modules/xfmod/svn/svnbrowse.php?uri=filedetails.php%</A>
3Frepname%3Dappomattox%26path%3D%252Ftrunk%252FAppomattox%252Fsrc%252FAppoma
ttox.Gui.Components%252FMapCanvas.cs

Scott

On Tue, 2006-02-28 at 22:07 -0500, Jonathan Resnick wrote:
&gt;<i> I am trying to port an open-source medical imaging application from 
</I>&gt;<i> .NET to Mono so that it can run on Linux. A large part of the codebase 
</I>&gt;<i> is based on the System.Drawing library - therefore I am trying to use 
</I>&gt;<i> the gtk-dotnet bridge so that GTK can be used as a front end. However, 
</I>&gt;<i> I'm having a hard time getting decent performance, and as far as I can 
</I>&gt;<i> tell, the problems seem to stem from the gtk-dotnet component.
</I>&gt;<i> 
</I>&gt;<i> I've attached a sample application that just tries to flip two 
</I>&gt;<i> System.Drawing.Bitmaps to a Gtk.DrawingArea, alternating them, in a 
</I>&gt;<i> tight loop. It measures the time taken for each flip and prints it to the
</I>console.
&gt;<i> 
</I>&gt;<i> On Linux, I observe the following behaviour:
</I>&gt;<i> 
</I>&gt;<i> 1. My first approach was to try drawing directly to the screen 
</I>&gt;<i> (_drawDirect = true in the OnExposeEvent handler). The performance is 
</I>&gt;<i> good for roughly the first 100 or so loop iterations, but then it 
</I>&gt;<i> quickly degrades. It seems as though the system starts to run out of 
</I>&gt;<i> memory, which seems to be caused by creating a Graphics object using 
</I>&gt;<i> Gtk.DotNet.Graphics.FromDrawable inside the OnExposeEvent handler.
</I>&gt;<i> 
</I>&gt;<i> 2. My second approach was to try drawing to an intermediate Pixmap 
</I>&gt;<i> (_drawDirect = false in the OnExposeEvent handler), so as to avoid 
</I>&gt;<i> having to create a Graphics object each time. In this case, the 
</I>&gt;<i> performance is constant over the entire duration of the loop. However, 
</I>&gt;<i> the performance is pretty bad, taking roughly 1 second per flip, which 
</I>&gt;<i> is not acceptable for our purposes (and I'm running it on a reasonably
</I>powerful laptop machine).
&gt;<i> 
</I>&gt;<i> If someone with a solid understanding of Gtk/Gdk could look at my 
</I>&gt;<i> sample code and point out to me where I'm going wrong, it would be a 
</I>&gt;<i> huge help in getting this application running on Linux.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> Jonathan
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Gtk-sharp-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">Gtk-sharp-list at lists.ximian.com</A> 
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006976.html">[Gtk-sharp-list] gtk-dotnet performance
</A></li>
	<LI>Next message: <A HREF="006980.html">[Gtk-sharp-list] gtk-dotnet performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6979">[ date ]</a>
              <a href="thread.html#6979">[ thread ]</a>
              <a href="subject.html#6979">[ subject ]</a>
              <a href="author.html#6979">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
