<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] [Patch] Make Gtk.ListStore implement IEnumerable
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:eric%40extremeboredom.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005842.html">
   <LINK REL="Next"  HREF="005836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] [Patch] Make Gtk.ListStore implement IEnumerable
   </H1>
    <B>Eric Butler
    </B> 
    <A HREF="mailto:eric%40extremeboredom.net"
       TITLE="[Gtk-sharp-list] [Patch] Make Gtk.ListStore implement IEnumerable">eric@extremeboredom.net
       </A><BR>
    <I>Tue, 03 May 2005 11:22:52 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="005842.html">[Gtk-sharp-list] Re: [PATCH] Basic FileChooserButton Support
</A></li>
        <LI> Next message: <A HREF="005836.html">[Gtk-sharp-list] [Patch] Make Gtk.ListStore implement
 IEnumerable
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5835">[ date ]</a>
              <a href="thread.html#5835">[ thread ]</a>
              <a href="subject.html#5835">[ subject ]</a>
              <a href="author.html#5835">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-5qCEcls8oH2nhWq/pPFN
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hey,

As inspired by the Improving Gtk# thread here is a patch that makes
ListStore implement IEnumerable. This allows you to do something like:

foreach (object[] row in trustedNodesListStore) {
Console.WriteLine(row[0].ToString());
}

Which, for a simple list, is much more friendly than trying to deal with
TreeIter.

I look forward to hear feedback.

Regards,
Eric

--=-5qCEcls8oH2nhWq/pPFN
Content-Disposition: attachment; filename=TreeEnumerator.patch
Content-Type: text/x-patch; name=TreeEnumerator.patch; charset=utf-8
Content-Transfer-Encoding: 7bit

Index: TreeEnumerator.cs
===================================================================
--- TreeEnumerator.cs	(revision 0)
+++ TreeEnumerator.cs	(revision 0)
@@ -0,0 +1,65 @@
+// TreeEnumerator.cs - .NET-style Enumerator for TreeModel classes
+//
+// Author: Eric Butler &lt;<A HREF="mailto:eric@extremeboredom.net">eric@extremeboredom.net</A>&gt;
+//
+// Copyright (c) 2005 Eric Butler
+//
+// This program is free software; you can redistribute it and/or
+// modify it under the terms of version 2 of the Lesser GNU General
+// Public License as published by the Free Software Foundation.
+//
+// This program is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+// Lesser General Public License for more details.
+//
+// You should have received a copy of the GNU Lesser General Public
+// License along with this program; if not, write to the
+// Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+// Boston, MA 02111-1307, USA.
+
+
+using System;
+using System.Collections;
+
+namespace Gtk
+{
+	public class TreeEnumerator : IEnumerator
+	{
+		Gtk.TreeIter iter;
+		Gtk.TreeModel model;
+		bool reset = true;
+		
+		public TreeEnumerator (TreeModel model)
+		{
+			this.model = model;
+		}
+		
+		public object Current
+		{
+			get {
+				object[] row = new object[model.NColumns];
+				for (int x = 0; x &lt; model.NColumns; x++) {
+					row[x] = model.GetValue(iter, x);
+				}
+				return row;
+			}
+		}
+		
+		public bool MoveNext()
+		{
+			if (reset == true) {
+				reset = false;
+				return model.GetIterFirst(out iter);
+			} else {
+				return model.IterNext(ref iter);
+			}
+		}
+		
+		public void Reset()
+		{
+			reset = true;
+		}
+	}
+}
+
Index: ListStore.custom
===================================================================
--- ListStore.custom	(revision 43951)
+++ ListStore.custom	(working copy)
@@ -198,3 +198,8 @@
 			gtk_tree_sortable_set_default_sort_func(Handle, sort_func_wrapper.NativeDelegate, (IntPtr) gch, DestroyHelper.NotifyHandler);
 		}
 
+		public IEnumerator GetEnumerator()
+		{
+			return new TreeEnumerator(this);
+		}
+
Index: Gtk.metadata
===================================================================
--- Gtk.metadata	(revision 43951)
+++ Gtk.metadata	(working copy)
@@ -179,6 +179,7 @@
   &lt;attr path=&quot;/api/namespace/object[@cname='GtkCombo']/method[@name='SetPopdownStrings']&quot; name=&quot;hidden&quot;&gt;1&lt;/attr&gt;
   &lt;attr path=&quot;/api/namespace/object[@cname='GtkComboBox']/method[@cname='gtk_combo_box_get_active_iter']/*/*[@type='GtkTreeIter*']&quot; name=&quot;pass_as&quot;&gt;out&lt;/attr&gt; 
   &lt;add-node path=&quot;/api/namespace/object[@cname='GtkContainer']&quot;&gt;&lt;implements&gt;&lt;interface name=&quot;IEnumerable&quot; /&gt;&lt;/implements&gt;&lt;/add-node&gt;
+  &lt;add-node path=&quot;/api/namespace/object[@name='ListStore']&quot;&gt;&lt;implements&gt;&lt;interface name=&quot;IEnumerable&quot; /&gt;&lt;/implements&gt;&lt;/add-node&gt;
   &lt;attr path=&quot;/api/namespace/object[@cname='GtkContainer']/method[@name='ChildGetProperty']&quot; name=&quot;hidden&quot;&gt;1&lt;/attr&gt;
   &lt;attr path=&quot;/api/namespace/object[@cname='GtkContainer']/method[@name='Forall']/*/*[@name='callback']&quot; name=&quot;scope&quot;&gt;call&lt;/attr&gt;
   &lt;attr path=&quot;/api/namespace/object[@cname='GtkContainer']/method[@name='Foreach']/*/*[@name='callback']&quot; name=&quot;scope&quot;&gt;call&lt;/attr&gt;
Index: Makefile.am
===================================================================
--- Makefile.am	(revision 43951)
+++ Makefile.am	(working copy)
@@ -27,7 +27,8 @@
 	Timeout.cs			\
 	TreeNodeAttribute.cs		\
 	TreeNode.cs			\
-	TreeNodeValueAttribute.cs
+	TreeNodeValueAttribute.cs	\
+	TreeEnumerator.cs

--=-5qCEcls8oH2nhWq/pPFN--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005842.html">[Gtk-sharp-list] Re: [PATCH] Basic FileChooserButton Support
</A></li>
	<LI> Next message: <A HREF="005836.html">[Gtk-sharp-list] [Patch] Make Gtk.ListStore implement
 IEnumerable
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5835">[ date ]</a>
              <a href="thread.html#5835">[ thread ]</a>
              <a href="subject.html#5835">[ subject ]</a>
              <a href="author.html#5835">[ author ]</a>
         </LI>
       </UL>
</body></html>
