<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Random NullReferenceExceptions in GLib
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tberman%40off.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005864.html">
   <LINK REL="Next"  HREF="005848.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Random NullReferenceExceptions in GLib
   </H1>
    <B>Todd Berman
    </B> 
    <A HREF="mailto:tberman%40off.net"
       TITLE="[Gtk-sharp-list] Random NullReferenceExceptions in GLib">tberman@off.net
       </A><BR>
    <I>Mon, 09 May 2005 21:57:42 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="005864.html">[Gtk-sharp-list] Random NullReferenceExceptions in GLib
</A></li>
        <LI> Next message: <A HREF="005848.html">[Gtk-sharp-list] Get colour of pixel in Gdk.Pixmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5859">[ date ]</a>
              <a href="thread.html#5859">[ thread ]</a>
              <a href="subject.html#5859">[ subject ]</a>
              <a href="author.html#5859">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-10tgmc4atgXuwZE5MnxC
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

On Fri, 2005-05-06 at 18:39 -0700, Todd Berman wrote:
&gt;<i> On Fri, 2005-05-06 at 17:00 -0700, Eric Butler wrote:
</I>&gt;<i> &gt; My program is randomly throwing the following exception. Since it is in
</I>&gt;<i> &gt; unmanaged code (and in the Gtk mainloop), I have no idea how to even
</I>&gt;<i> &gt; begin debugging this. Can anyone please help? This is with Gtk# trunk.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Unhandled Exception: System.NullReferenceException: Object reference not
</I>&gt;<i> &gt; set to an instance of an object
</I>&gt;<i> &gt; in (unmanaged) 0x8ac9250
</I>&gt;<i> &gt; in &lt;0x00004&gt; (wrapper managed-to-native) GLib.Object:g_object_unref
</I>&gt;<i> &gt; (intptr)
</I>&gt;<i> &gt; in [0x00099] (at /home/brady/sources/gtk-sharp/glib/Object.cs:65)
</I>&gt;<i> &gt; GLib.Object:PerformQueuedUnrefs ()
</I>&gt;<i> &gt; in &lt;0x00048&gt; (wrapper delegate-invoke)
</I>&gt;<i> &gt; System.MulticastDelegate:invoke_bool ()
</I>&gt;<i> &gt; in [0x0000d] (at /home/brady/sources/gtk-sharp/glib/Idle.cs:46)
</I>&gt;<i> &gt; IdleProxy:Handler ()
</I>&gt;<i> &gt; in &lt;0x00036&gt; (wrapper native-to-managed) IdleProxy:Handler ()
</I>&gt;<i> &gt; in (unmanaged) 0xb7f78a02
</I>&gt;<i> &gt; in &lt;0x00004&gt; (wrapper managed-to-native) Gtk.Application:gtk_main ()
</I>&gt;<i> &gt; in [0x00000] (at /home/brady/sources/gtk-sharp/gtk/Application.cs:99)
</I>&gt;<i> &gt; Gtk.Application:Run ()
</I>&gt;<i> &gt; in [0x002ce]
</I>&gt;<i> &gt; (at /home/brady/sources/FileFind.Meshwork.GtkClient/src/Main.cs:192)
</I>&gt;<i> &gt; gMeshwork:Go (string[])
</I>&gt;<i> &gt; in [0x00008]
</I>&gt;<i> &gt; (at /home/brady/sources/FileFind.Meshwork.GtkClient/src/Main.cs:72)
</I>&gt;<i> &gt; gMeshwork:Main (string[])
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks :(
</I>&gt;<i> 
</I>&gt;<i> I am actually starting to see this too, not sure what is going on at
</I>&gt;<i> all, and it is also exposing itself under win32, so it is not linux
</I>&gt;<i> specific. I am wondering what has recently changed.
</I>&gt;<i> 
</I>&gt;<i> --Todd
</I>

Mike, I was able to make a small test case that shows this bug.

If you click the button and make the dialog come up, and then close the
dialog, and click the button, it crashes. Sometimes it takes 3 or 4
times showing the dialog for it to crash, but it does happen for sure.

I get this error here:

<A HREF="mailto:tberman@photon">tberman@photon</A>% mono test.exe
[~/temp]
Exception while disposing a Gtk.TreeViewColumn in GTK#

Unhandled Exception: System.ExecutionEngineException: SIGILL
in &lt;0x00000&gt; &lt;unknown method&gt;
in (wrapper managed-to-native) GLib.Object:g_object_unref (intptr)
in &lt;0x00129&gt; GLib.Object:PerformQueuedUnrefs ()


Test case has been attached.


--Todd

--=-10tgmc4atgXuwZE5MnxC
Content-Disposition: attachment; filename=test.cs
Content-Type: text/x-csharp; name=test.cs; charset=us-ascii
Content-Transfer-Encoding: 7bit

using System;
using Gtk;

public class Driver
{
	public static void Main ()
	{
		Application.Init ();
		new Driver ();
		Application.Run ();
	}

	public Driver ()
	{
		Window wnd = new Window (&quot;Driver&quot;);
		Button btn = new Button (&quot;Click&quot;);
		wnd.Add (btn);
		btn.Clicked += new EventHandler (OnBtnClicked);
		wnd.ShowAll ();
	}

	private void OnBtnClicked (object o, EventArgs e)
	{
		CreateDialog ();
	}

	private Dialog CreateDialog ()
	{
		ListStore store = new ListStore (typeof (string));
		for (int i = 0; i &lt; 50; i++) {
			store.AppendValues (i.ToString ());
		}
		TreeView tv = new TreeView ();
		tv.Model = store;
		tv.AppendColumn (&quot;column&quot;, new CellRendererText (), new TreeCellDataFunc (RendererFunc));
		Dialog dlg = new Dialog ();
		ScrolledWindow scroller = new ScrolledWindow ();
		scroller.Add (tv);
		dlg.VBox.Add (scroller);
		dlg.ShowAll ();
		return dlg;
	}

	private void RendererFunc (TreeViewColumn col, CellRenderer renderer, TreeModel model, TreeIter iter)
	{
		CellRendererText text = renderer as CellRendererText;
		text.Text = (string)model.GetValue (iter, 0);
	}
}

--=-10tgmc4atgXuwZE5MnxC--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005864.html">[Gtk-sharp-list] Random NullReferenceExceptions in GLib
</A></li>
	<LI> Next message: <A HREF="005848.html">[Gtk-sharp-list] Get colour of pixel in Gdk.Pixmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5859">[ date ]</a>
              <a href="thread.html#5859">[ thread ]</a>
              <a href="subject.html#5859">[ subject ]</a>
              <a href="author.html#5859">[ author ]</a>
         </LI>
       </UL>
</body></html>
