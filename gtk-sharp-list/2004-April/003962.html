<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] DOM-like interface for Gtk#
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jannone%40inf.ufrgs.br">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003961.html">
   <LINK REL="Next"  HREF="003963.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] DOM-like interface for Gtk#
   </H1>
    <B>Rafael Jannone
    </B> 
    <A HREF="mailto:jannone%40inf.ufrgs.br"
       TITLE="[Gtk-sharp-list] DOM-like interface for Gtk#">jannone@inf.ufrgs.br
       </A><BR>
    <I>Thu, 29 Apr 2004 00:51:16 -0300</I>
    <P><UL>
        <LI> Previous message: <A HREF="003961.html">[Gtk-sharp-list] Missing .dll
</A></li>
        <LI> Next message: <A HREF="003963.html">[Gtk-sharp-list] Gtk html error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3962">[ date ]</a>
              <a href="thread.html#3962">[ thread ]</a>
              <a href="subject.html#3962">[ subject ]</a>
              <a href="author.html#3962">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-+8gUGUMJescVAvwCKTjd
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hi!

Are there any plans to bind a DOM-like interface for Gtk# widgets?

I hacked an ugly piece of code just to experiment with the idea (in attach).

It seems at first glance, that most of the work could be done by the
same translators currently generating the Gtk# bindings. Other way to
generate the required code could be done by using reflection over the
Gtk# classes.

Anyway, try this:

$ mcs -r:gtk-sharp.dll XUIDocTest.cs
$ mono XUIDocTest.exe form.xml

For those who didn't get it:

The loader will read the entire xml, but for each tag it will search for
any known corresponding widget (example: &quot;window&quot; -&gt; Gtk.Window).
Instead of creating the widget directly, it will create a specialized
XmlElement which contains the widget, providing an interface for
attribute manipulation, child appending, and so on.  In other words, a
one-night hack briefly inspired by the DOM API spec.

So you can do things like this:

XmlElement label = (XmlElement)doc.SelectSingleNode(&quot;//label&quot;);
label.SetAttribute(&quot;text&quot;, &quot;hardcoded text&quot;);

...and it will reflect directly on the widget: instant visual feedback,
much like you would do with Javascript + HTML.

Back to my question: are there any plans or interest to do something
like that? (specially with Javascript and Python running over Mono in the near future)

Cheers,
Rafael Jannone

--=-+8gUGUMJescVAvwCKTjd
Content-Disposition: attachment; filename=XUIDocTest.cs
Content-Type: text/x-csharp; name=XUIDocTest.cs; charset=ISO-8859-15
Content-Transfer-Encoding: 7bit

using System;
using System.Xml;

using Gtk;

public class XUIDocTest {

	public class XUIElement : XmlElement {
		public XUIElement(string prefix,
			string localName,
			string namespaceURI,
			XmlDocument doc) : base(prefix, localName, namespaceURI, doc) 
			{
			}

		public virtual void OnSetAttribute (string name, string value) {
		}

                public override void SetAttribute (string name, string value)
                {
			OnSetAttribute (name, value);
			base.SetAttribute (name, value);
                }

		public override string SetAttribute (string localName, string namespaceURI, string value) {
			OnSetAttribute (localName, value);
			return base.SetAttribute (localName, namespaceURI, value);
		}

		public override XmlAttribute SetAttributeNode (XmlAttribute newAttr) {
			OnSetAttribute (newAttr.LocalName, newAttr.Value);
			return base.SetAttributeNode (newAttr);
		}
	}

	public class XUIWidget : XUIElement {
		public XUIWidget(string prefix,
			string localName,
			string namespaceURI,
			XmlDocument doc) : base(prefix, localName, namespaceURI, doc) 
			{
			}

		public virtual Gtk.Widget GetWidget() {
			return null;
		}
	}


	public class XUIContainer : XUIWidget {
		public XUIContainer(string prefix,
			string localName,
			string namespaceURI,
			XmlDocument doc) : base(prefix, localName, namespaceURI, doc) 
			{
			}

		public override XmlNode InsertBefore (XmlNode newChild, XmlNode refChild) {
			XUIWidget widget = (XUIWidget)newChild;
			Gtk.Container container = (Gtk.Container)GetWidget();
			container.Add(widget.GetWidget());
			return base.InsertBefore(newChild, refChild);
		}
	}

	public class XUIWindowElement : XUIContainer {

		private Gtk.Window window;

		public XUIWindowElement(string prefix,
			string localName,
			string namespaceURI,
			XmlDocument doc) : base(prefix, localName, namespaceURI, doc) 
			{
				window = new Gtk.Window(&quot;XUI Window&quot;);
				window.Show();
			}

		public override Gtk.Widget GetWidget() {
			return window;
		}

		public override void OnSetAttribute (string name, string value) {
			switch (name) {
				case &quot;title&quot;:
					window.Title = value;
					break;
			}
		}
	}

	public class XUIVBoxElement : XUIContainer {

		private Gtk.VBox vbox;

		public XUIVBoxElement(string prefix,
			string localName,
			string namespaceURI,
			XmlDocument doc) : base(prefix, localName, namespaceURI, doc) 
			{
				vbox = new Gtk.VBox();
				vbox.Show();
			}

		public override Gtk.Widget GetWidget() {
			return vbox;
		}

		public override void OnSetAttribute (string name, string value) {
		}
	}

	public class XUIButtonElement : XUIContainer {

		private Gtk.Button button;

		public XUIButtonElement(string prefix,
			string localName,
			string namespaceURI,
			XmlDocument doc) : base(prefix, localName, namespaceURI, doc) 
			{
				button = new Gtk.Button(&quot;XUI Button&quot;);
				button.Show();
			}

		public override Gtk.Widget GetWidget() {
			return button;
		}

		public override void OnSetAttribute (string name, string value) {
			switch (name) {
				case &quot;label&quot;:
					button.Label = value;
					break;
			}
		}
	}

	public class XUILabelElement : XUIWidget {

		private Gtk.Label label;

		public XUILabelElement(string prefix,
			string localName,
			string namespaceURI,
			XmlDocument doc) : base(prefix, localName, namespaceURI, doc) 
			{
				label = new Gtk.Label(&quot;XUI Label&quot;);
				label.Show();
			}

		public override Gtk.Widget GetWidget() {
			return label;
		}

		public override void OnSetAttribute (string name, string value) {
			switch (name) {
				case &quot;text&quot;:
					label.Text = value;
					break;
			}
		}
	}

	public class XUIDocument : XmlDocument {
                public override XmlElement CreateElement (
                        string prefix,
                        string localName,
                        string namespaceURI)
                {
			XmlElement el;
			switch (localName) {
				case &quot;window&quot;:
					el = new XUIWindowElement(prefix, localName, namespaceURI, this);
					break;
				case &quot;vbox&quot;:
					el = new XUIVBoxElement(prefix, localName, namespaceURI, this);
					break;
				case &quot;button&quot;:
					el = new XUIButtonElement(prefix, localName, namespaceURI, this);
					break;
				case &quot;label&quot;:
					el = new XUILabelElement(prefix, localName, namespaceURI, this);
					break;
				default:
					el = base.CreateElement(prefix, localName, namespaceURI);
					break;
					
			}
			return el;
                }

	}

        public static void Main(string [] args) {
                try {
			Application.Init();

                        string url = (string)args[0];
                        XmlTextReader reader = new XmlTextReader(url);
                        XUIDocument doc = new XUIDocument();

                        Console.WriteLine(&quot;loading xml&quot;);
                        doc.Load(reader);
                        Console.WriteLine(&quot;ok!&quot;);

			XmlElement label = (XmlElement)doc.SelectSingleNode(&quot;//label&quot;);
			label.SetAttribute(&quot;text&quot;, &quot;hardcoded text&quot;);

			Application.Run();
                } catch (XmlException e) {
                        Console.WriteLine(e.Message);
                }
        }
}

--=-+8gUGUMJescVAvwCKTjd
Content-Disposition: attachment; filename=form.xml
Content-Type: text/xml; name=form.xml; charset=ISO-8859-15
Content-Transfer-Encoding: 7bit

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;window title=&quot;Test Program&quot;&gt;
	&lt;vbox&gt;
		&lt;label text=&quot;This is a test 1&quot; /&gt;
		&lt;label text=&quot;This is a test 2&quot; /&gt;
		&lt;button label=&quot;Ok!&quot; /&gt;
	&lt;/vbox&gt;
&lt;/window&gt;

--=-+8gUGUMJescVAvwCKTjd--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003961.html">[Gtk-sharp-list] Missing .dll
</A></li>
	<LI> Next message: <A HREF="003963.html">[Gtk-sharp-list] Gtk html error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3962">[ date ]</a>
              <a href="thread.html#3962">[ thread ]</a>
              <a href="subject.html#3962">[ subject ]</a>
              <a href="author.html#3962">[ author ]</a>
         </LI>
       </UL>
</body></html>
