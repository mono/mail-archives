<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] UIManager, et. al.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jeroen%40xs4all.nl">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003807.html">
   <LINK REL="Next"  HREF="003808.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] UIManager, et. al.
   </H1>
    <B>Jeroen Zwartepoorte
    </B> 
    <A HREF="mailto:jeroen%40xs4all.nl"
       TITLE="[Gtk-sharp-list] UIManager, et. al.">jeroen@xs4all.nl
       </A><BR>
    <I>Mon, 12 Apr 2004 21:05:08 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="003807.html">[Gtk-sharp-list] UIManager, et. al.
</A></li>
        <LI> Next message: <A HREF="003808.html">[Gtk-sharp-list] trace?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3809">[ date ]</a>
              <a href="thread.html#3809">[ thread ]</a>
              <a href="subject.html#3809">[ subject ]</a>
              <a href="author.html#3809">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Artum,

You might be interested to know that preliminary support for GTK 2.4 is
available on a branch of gtk-sharp: jeroen-gtk-2-4. The branch has
support for GtkUIManager amongst other new classes. Take a look at the
actions.cs sample.

Regards,

Jeroen

On Sat, 2004-04-10 at 13:44 +0700, Artem Popov wrote:

&gt;<i> Hello, I've recently been playing with gtk 2.4 stuff and tried wrapping
</I>&gt;<i> the new UIManager api (wrapper attached). I ran into a problem described
</I>&gt;<i> below (sorry for the long message).
</I>&gt;<i> 
</I>&gt;<i> this code worked as expected:
</I>&gt;<i> 
</I>&gt;<i> 	action = new Action (&quot;Save&quot;, &quot;_Save&quot;, &quot;&quot;, Gtk.Stock.Save);
</I>&gt;<i> 	action_group.AddAction (action);
</I>&gt;<i> 	action.Activated += new EventHandler (ActionHandler);
</I>&gt;<i> 
</I>&gt;<i> But I wanted to create actions from struct arrays like this:
</I>&gt;<i> 
</I>&gt;<i> 	ActionEntry[] actions =  {
</I>&gt;<i> 	new ActionEntry (&quot;Open&quot;, ... , callback),
</I>&gt;<i> 	new ActionEntry (&quot;Save&quot;, ... , callback),
</I>&gt;<i> 	};
</I>&gt;<i> 	...
</I>&gt;<i> 	action_group.AddActions (actions);
</I>&gt;<i> 
</I>&gt;<i> At first, that didn't work, because the generator didn't add GCallback
</I>&gt;<i> field in ActionEntry structs (there was an &quot;unknown type: GCallback&quot;
</I>&gt;<i> warning), so the structs in arrays with more than 1 struct were
</I>&gt;<i> &quot;shifted&quot;. As a workaround (for the generator to know about GCallback)
</I>&gt;<i> I've created a delegate like this:
</I>&gt;<i> 
</I>&gt;<i> 	namespace GLib { public delegate void Callback (); }
</I>&gt;<i> 
</I>&gt;<i> gclosure.h declares GCallback as typedef void (*GCallback) (void);
</I>&gt;<i> 
</I>&gt;<i> (in symbols):
</I>&gt;<i> &lt;symbol type=&quot;manual&quot; cname=&quot;GCallback&quot; name=&quot;GLib.Callback&quot;/&gt;
</I>&gt;<i> 
</I>&gt;<i> I've also written custom versions of Add*Actions. Works well, but it's
</I>&gt;<i> impossible to create one callback for several actions. gtk-demo makes it
</I>&gt;<i> this way:
</I>&gt;<i> 
</I>&gt;<i> 	static void activate_action (GtkAction *action) {...}
</I>&gt;<i> 	static void activate_radio_action (GtkAction *action, GtkRadioAction
</I>&gt;<i> *current)
</I>&gt;<i> 	{...}
</I>&gt;<i> 	static GtkActionEntry entries[] = {
</I>&gt;<i> 		{ &quot;New&quot;, ... , G_CALLBACK (activate_action) },
</I>&gt;<i> 		...
</I>&gt;<i> 	}
</I>&gt;<i> 	...
</I>&gt;<i> 	gtk_action_group_add_radio_actions (..., G_CALLBACK
</I>&gt;<i> (activate_radio_action), NULL);
</I>&gt;<i> 	...
</I>&gt;<i> 
</I>&gt;<i> See, here function with args is casted to (supposedly argless) GCallback
</I>&gt;<i> and the callback knows its action well. To allow simular behavior, I
</I>&gt;<i> pointed the generator to pass GCallback as a generic delegate:
</I>&gt;<i> &lt;symbol type=&quot;manual&quot; cname=&quot;GCallback&quot; name=&quot;System.Delegate&quot;/&gt;
</I>&gt;<i> 
</I>&gt;<i> This allows to run (working) code like this:
</I>&gt;<i> 	delegate void ActionCallback (IntPtr handle);
</I>&gt;<i> 	static void cb ()
</I>&gt;<i> 	{ ... }
</I>&gt;<i> 	static void cb2 (IntPtr handle)
</I>&gt;<i> 	{ Action action = new Action (handle); ... }
</I>&gt;<i> 	
</I>&gt;<i> 	ActionEntry[] actions =  {
</I>&gt;<i> 		new ActionEntry (..., new GLib.Callback (cb)),
</I>&gt;<i> 		new ActionEntry (..., new ActionCallback (cb2)),
</I>&gt;<i> 	};
</I>&gt;<i> 
</I>&gt;<i> &gt;From the gtk-demo it seems there also may be a delegate for (Action,
</I>&gt;<i> RadioAction) args, but as you can see they're passed as IntPtrs in the
</I>&gt;<i> code above.
</I>&gt;<i> 
</I>&gt;<i> Now I want the callbacks to be &quot;real&quot; ones with &quot;Action&quot; or object args.
</I>&gt;<i> And I don't want to have lots of &quot;void-(void)&quot; functions for every
</I>&gt;<i> imaginable task. I beleive there's a smart way to do this, but I don't
</I>&gt;<i> know gtk# internals well and probably I missed anything?
</I>&gt;<i> 
</I>&gt;<i> --Artem
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003807.html">[Gtk-sharp-list] UIManager, et. al.
</A></li>
	<LI> Next message: <A HREF="003808.html">[Gtk-sharp-list] trace?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3809">[ date ]</a>
              <a href="thread.html#3809">[ thread ]</a>
              <a href="subject.html#3809">[ subject ]</a>
              <a href="author.html#3809">[ author ]</a>
         </LI>
       </UL>
</body></html>
