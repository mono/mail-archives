<tt>
Hi&nbsp;Aaron.&lt;br&gt;&lt;br&gt;Well,&nbsp;about&nbsp;the&nbsp;performance&nbsp;of&nbsp;drawing,&nbsp;I&amp;#39;ve&nbsp;been&nbsp;working&nbsp;fulltime&nbsp;for&nbsp;two&nbsp;years&nbsp;now&nbsp;using&nbsp;C#&nbsp;building&nbsp;CASE&nbsp;tools&nbsp;in&nbsp;the&nbsp;OO-Method&nbsp;Research&nbsp;Group&nbsp;(Universidad&nbsp;de&nbsp;Valencia)&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;http://oomethod.dsic.upv.es/anonimo/index.aspx&quot;&gt;<br>
http://oomethod.dsic.upv.es/anonimo/index.aspx&lt;/a&gt;&nbsp;In&nbsp;fact.&nbsp;I&amp;#39;ve&nbsp;developed&nbsp;a&nbsp;C#&nbsp;Diagramming&nbsp;Engine&nbsp;for&nbsp;complex&nbsp;layout&nbsp;and<br>
entity&nbsp;hierarchies&nbsp;to&nbsp;support&nbsp;BPMN,&nbsp;UML,&nbsp;OOWS,&nbsp;i*,&nbsp;etc.&nbsp;so&nbsp;I&amp;#39;ve&nbsp;been<br>
fighting&nbsp;with&nbsp;drawing&nbsp;performance&nbsp;all&nbsp;the&nbsp;time.&nbsp;Although&nbsp;I&amp;#39;ve&nbsp;been<br>
using&nbsp;System.Drawing&nbsp;on&nbsp;both&nbsp;Windows&nbsp;and&nbsp;Linux&nbsp;platforms,&nbsp;almost&nbsp;the<br>
same&nbsp;tricks&nbsp;work&nbsp;with&nbsp;Cairo.&lt;br&gt;<br>
&lt;br&gt;I&nbsp;will&nbsp;not&nbsp;enter&nbsp;here&nbsp;about&nbsp;comparing&nbsp;Cairo&nbsp;against&nbsp;native&nbsp;System.Drawing,&nbsp;only&nbsp;showing&nbsp;some&nbsp;techniques&nbsp;you&nbsp;could&nbsp;use&nbsp;to&nbsp;improve&nbsp;2d&nbsp;image&nbsp;rendering&nbsp;performance.&lt;br&gt;&lt;br&gt;The&nbsp;current&nbsp;tricks&nbsp;I&nbsp;use&nbsp;are:&lt;br&gt;&lt;br&gt;*&nbsp;Use&nbsp;image&nbsp;blitting&nbsp;when&nbsp;possible:&nbsp;if&nbsp;you&nbsp;are&nbsp;drawing&nbsp;many&nbsp;complex&nbsp;shapes&nbsp;using&nbsp;paths,&nbsp;gradients&nbsp;and&nbsp;so&nbsp;on,&nbsp;try&nbsp;to&nbsp;cache&nbsp;the&nbsp;resulting&nbsp;image&nbsp;on&nbsp;to&nbsp;a&nbsp;buffer&nbsp;and&nbsp;redraw&nbsp;it&nbsp;only&nbsp;if&nbsp;needed.&nbsp;It&amp;#39;s&nbsp;faster&nbsp;to&nbsp;blit&nbsp;the&nbsp;cached&nbsp;buffer&nbsp;than&nbsp;to&nbsp;directly&nbsp;draw&nbsp;it&nbsp;every&nbsp;time&nbsp;(in&nbsp;native&nbsp;<br>
System.Drawing&nbsp;is&nbsp;extremely&nbsp;fast,&nbsp;in&nbsp;Cairo-based&nbsp;System&nbsp;Drawing...&nbsp;maybe&nbsp;it&nbsp;could&nbsp;be&nbsp;speed&nbsp;up&nbsp;it&nbsp;a&nbsp;bit&nbsp;using&nbsp;raw&nbsp;X&nbsp;image&nbsp;blitting).&lt;br&gt;&lt;br&gt;*&nbsp;Invalidation&nbsp;of&nbsp;areas&nbsp;are&nbsp;slow:&nbsp;is&nbsp;easy&nbsp;to&nbsp;drop&nbsp;performance&nbsp;if&nbsp;many&nbsp;invalidations&nbsp;are&nbsp;done&nbsp;so&nbsp;I&amp;#39;ve&nbsp;done&nbsp;what&nbsp;I&nbsp;call&nbsp;&amp;quot;The&nbsp;Invalidation&nbsp;Cache&amp;quot;.&nbsp;The&nbsp;idea&nbsp;is&nbsp;to&nbsp;catch&nbsp;all&nbsp;invalidated&nbsp;areas&nbsp;into&nbsp;a&nbsp;single&nbsp;big&nbsp;invalidation&nbsp;area,&nbsp;then&nbsp;invalidate&nbsp;this&nbsp;area&nbsp;just&nbsp;before&nbsp;to&nbsp;draw&nbsp;and&nbsp;clear&nbsp;out&nbsp;the&nbsp;&amp;quot;invalidation&nbsp;cache&amp;quot;&nbsp;for&nbsp;the&nbsp;next&nbsp;frame&nbsp;to&nbsp;be&nbsp;drawn.&nbsp;This&nbsp;greatly&nbsp;increases&nbsp;performance!<br>
&lt;br&gt;&lt;br&gt;*&nbsp;Draw&nbsp;only&nbsp;what&nbsp;is&nbsp;needed:&nbsp;in&nbsp;my&nbsp;case,&nbsp;I&nbsp;try&nbsp;to&nbsp;intersect&nbsp;expose&nbsp;events&nbsp;whit&nbsp;drawn&nbsp;entities&nbsp;to&nbsp;only&nbsp;draw&nbsp;what&nbsp;is&nbsp;needed&nbsp;and&nbsp;clip&nbsp;cached&nbsp;images&nbsp;of&nbsp;entities&nbsp;with&nbsp;the&nbsp;exposed&nbsp;areas&nbsp;before&nbsp;draw.&lt;br&gt;&lt;br&gt;*&nbsp;Use&nbsp;space&nbsp;partitioning&nbsp;techniques:&nbsp;2d&nbsp;space&nbsp;partitions&nbsp;are&nbsp;easy&nbsp;and&nbsp;fast,&nbsp;so&nbsp;intersection&nbsp;with&nbsp;entities&nbsp;in&nbsp;the&nbsp;drawing&nbsp;area&nbsp;are&nbsp;very&nbsp;very&nbsp;fast,&nbsp;although&nbsp;you&nbsp;must&nbsp;update&nbsp;the&nbsp;space&nbsp;partion&nbsp;buckets&nbsp;when&nbsp;you&nbsp;translate&nbsp;and&nbsp;or&nbsp;modify&nbsp;the&nbsp;outline&nbsp;(scale,&nbsp;shear,&nbsp;etc.)&nbsp;of&nbsp;an&nbsp;entity.<br>
&lt;br&gt;&lt;br&gt;Using&nbsp;all&nbsp;these&nbsp;techniques&nbsp;altogether&nbsp;makes&nbsp;a&nbsp;big&nbsp;difference.&nbsp;In&nbsp;fact,&nbsp;I&nbsp;run&nbsp;fullscreen&nbsp;applications&nbsp;at&nbsp;1440x900&nbsp;wit&nbsp;scrolling&nbsp;canvas&nbsp;(virtual&nbsp;size&nbsp;of&nbsp;5000x5000)&nbsp;at&nbsp;60fps&nbsp;both&nbsp;in&nbsp;Windows&nbsp;and&nbsp;Linux&nbsp;(using&nbsp;invalidations&nbsp;in&nbsp;windows&nbsp;and&nbsp;queueareas&nbsp;in&nbsp;gtk)&nbsp;and&nbsp;smooth&nbsp;entities&nbsp;movements&nbsp;with&nbsp;400+&nbsp;shapes&nbsp;with&nbsp;gradients,&nbsp;antialiasing&nbsp;and&nbsp;transparencies.&nbsp;In&nbsp;fact,&nbsp;I&nbsp;beat&nbsp;Java&amp;#39;s&nbsp;GEF,&nbsp;Poseidon&nbsp;and&nbsp;System&nbsp;Architect&nbsp;rendering&nbsp;canvas&nbsp;(all&nbsp;these&nbsp;without&nbsp;antialiasing&nbsp;and/or&nbsp;transparencies)&nbsp;in&nbsp;many&nbsp;test&nbsp;cases&nbsp;I&amp;#39;ve&nbsp;done.<br>
&lt;br&gt;&lt;br&gt;Hope&nbsp;this&nbsp;will&nbsp;help.&lt;br&gt;David&nbsp;Anes.&lt;br&gt;&lt;br&gt;PD:&nbsp;I&nbsp;think&nbsp;I&nbsp;must&nbsp;write&nbsp;some&nbsp;research&nbsp;papers&nbsp;about&nbsp;all&nbsp;these&nbsp;techniques&nbsp;joined&nbsp;together&nbsp;:D&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;2007/5/22,&nbsp;Michael&nbsp;Hutchinson&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:m.j.hutchinson@gmail.com&quot;&gt;<br>
m.j.hutchinson@gmail.com&lt;/a&gt;&amp;gt;:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;On&nbsp;5/22/07,&nbsp;Aaron&nbsp;Oxford&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:aaron@hardwarehookups.com.au&quot;&gt;<br>
aaron@hardwarehookups.com.au&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;I&nbsp;therefore&nbsp;submit&nbsp;the&nbsp;following&nbsp;very&nbsp;basic,&nbsp;more&nbsp;than&nbsp;likely&nbsp;biased,&lt;br&gt;&amp;gt;&nbsp;test&nbsp;comparing&nbsp;the&nbsp;three-fold&nbsp;path&nbsp;of&nbsp;fastly&nbsp;drawing&nbsp;under&nbsp;Gtk#&nbsp;-&lt;br&gt;&amp;gt;&nbsp;purely&nbsp;for&nbsp;interest&amp;#39;s&nbsp;sake.&nbsp;Just&nbsp;open&nbsp;the&nbsp;program&nbsp;and&nbsp;resize&nbsp;it,<br>
&lt;br&gt;&amp;gt;&nbsp;keeping&nbsp;it&nbsp;almost&nbsp;the&nbsp;same&nbsp;size&nbsp;but&nbsp;causing&nbsp;it&nbsp;to&nbsp;redraw&nbsp;and&nbsp;gather&lt;br&gt;&amp;gt;&nbsp;data&nbsp;over&nbsp;a&nbsp;long&nbsp;period.&nbsp;On&nbsp;my&nbsp;machine,&nbsp;(3800&nbsp;X2,&nbsp;7600GT,&nbsp;Server2k3,&lt;br&gt;&amp;gt;&nbsp;Gtk#2.8.3)&nbsp;redrawing&nbsp;overall&nbsp;happens&nbsp;at&nbsp;about&nbsp;1-2&nbsp;fps.&nbsp;The&nbsp;measured<br>
&lt;br&gt;&amp;gt;&nbsp;drawing&nbsp;times&nbsp;are:&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Gdk:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;324&nbsp;ms&nbsp;(3&nbsp;FPS)&lt;br&gt;&amp;gt;&nbsp;Cairo:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;292&nbsp;ms&nbsp;(3.5&nbsp;FPS)&lt;br&gt;&amp;gt;&nbsp;System.Drawing:&nbsp;24&nbsp;ms&nbsp;(Badooshka)&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;Ubuntu&nbsp;7.04&nbsp;(GTK&nbsp;2.10),&nbsp;on&nbsp;a&nbsp;4200+&nbsp;X2&nbsp;with&nbsp;a&nbsp;6600GT.&nbsp;Modifying<br>
&lt;br&gt;the&nbsp;program&nbsp;to&nbsp;divide&nbsp;my&nbsp;the&nbsp;number&nbsp;of&nbsp;expose&nbsp;events&nbsp;(i.e.&nbsp;to&nbsp;get&nbsp;an&lt;br&gt;average),&nbsp;and&nbsp;dividing&nbsp;by&nbsp;1e4&nbsp;to&nbsp;convert&nbsp;from&nbsp;100ns&nbsp;ticks&nbsp;to&nbsp;ms&nbsp;the&lt;br&gt;lowest&nbsp;averages&nbsp;I&nbsp;can&nbsp;reproduce&nbsp;are&nbsp;around&lt;br&gt;GDK:&nbsp;220&nbsp;ms&lt;br&gt;System.Drawing<br>
:&nbsp;200&nbsp;ms&lt;br&gt;Cairo:&nbsp;380&nbsp;ms&lt;br&gt;&lt;br&gt;So&nbsp;no,&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;look&nbsp;like&nbsp;your&nbsp;results&nbsp;are&nbsp;specific&nbsp;to&nbsp;Windows.&lt;br&gt;&lt;br&gt;OTOH,&nbsp;I&nbsp;find&nbsp;Gnumeric&nbsp;usably&nbsp;responsive,&nbsp;even&nbsp;on&nbsp;a&nbsp;1.4GHz&nbsp;Windows&nbsp;laptop.&lt;br&gt;&lt;br&gt;--&lt;br&gt;Michael&nbsp;Hutchinson&lt;br&gt;&lt;a&nbsp;href=&quot;http://mjhutchinson.com&quot;&gt;<br>
http://mjhutchinson.com&lt;/a&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Gtk-sharp-list&nbsp;maillist&amp;nbsp;&amp;nbsp;-&amp;nbsp;&amp;nbsp;&lt;a&nbsp;href=&quot;mailto:Gtk-sharp-list@lists.ximian.com&quot;&gt;Gtk-sharp-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/gtk-sharp-list&quot;&gt;<br>
http://lists.ximian.com/mailman/listinfo/gtk-sharp-list&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
