<tt>
On&nbsp;Tue,&nbsp;Mar&nbsp;8,&nbsp;2011&nbsp;at&nbsp;1:15&nbsp;PM,&nbsp;Lluis&nbsp;Sanchez&nbsp;Gual&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:slluis.devel@gmail.com&quot;&gt;slluis.devel@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
GObject&nbsp;doesn&amp;#39;t&nbsp;have&nbsp;a&nbsp;Dispose&nbsp;method&nbsp;and&nbsp;doesn&amp;#39;t&nbsp;use&nbsp;the&nbsp;IDispose&lt;br&gt;<br>
pattern,&nbsp;so&nbsp;we&nbsp;are&nbsp;free&nbsp;to&nbsp;give&nbsp;to&nbsp;Dispose&nbsp;the&nbsp;meaning&nbsp;that&nbsp;better&nbsp;fits&lt;br&gt;<br>
our&nbsp;needs.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Not&nbsp;exactly&nbsp;true.&nbsp; GObjectClass&nbsp;does&nbsp;have&nbsp;a&nbsp;dispose&nbsp;virtual&nbsp;method.&nbsp; It&nbsp;means&nbsp;something&nbsp;similar&nbsp;to&nbsp;the&nbsp;destroy&nbsp;signal&nbsp;on&nbsp;GtkObject/Widget.&nbsp; Release&nbsp;references&nbsp;that&nbsp;you&nbsp;hold.&nbsp; We&nbsp;do&nbsp;not&nbsp;hook&nbsp;into&nbsp;it&nbsp;on&nbsp;GLib.Object&nbsp;currently.&nbsp; Out&nbsp;GLib.Object.Dispose&nbsp;is&nbsp;all&nbsp;managed&nbsp;and&nbsp;invokes&nbsp;&amp;quot;unref&amp;quot;&nbsp;stuff.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
.NET&nbsp;developers&nbsp;expect&nbsp;Dispose&nbsp;to&nbsp;free&nbsp;all&nbsp;memory&nbsp;and&nbsp;resources&nbsp;hold&nbsp;by&lt;br&gt;<br>
an&nbsp;object,&nbsp;and&nbsp;the&nbsp;gtk&nbsp;method&nbsp;that&nbsp;better&nbsp;fits&nbsp;this&nbsp;definition&nbsp;is&lt;br&gt;<br>
Destroy.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Whatever&nbsp;we&nbsp;do&nbsp;has&nbsp;to&nbsp;work&nbsp;for&nbsp;non-Widgets&nbsp;too.&nbsp; There&nbsp;is&nbsp;no&nbsp;concept&nbsp;in&nbsp;GObject&nbsp;that&nbsp;says&nbsp;free&nbsp;all&nbsp;memory&nbsp;and&nbsp;resources.&nbsp; All&nbsp;we&nbsp;can&nbsp;say&nbsp;is&nbsp;&amp;quot;we&nbsp;are&nbsp;done&nbsp;with&nbsp;you,&nbsp;go&nbsp;away&nbsp;when&nbsp;you&nbsp;feel&nbsp;like&nbsp;it.&amp;quot;&nbsp; We&nbsp;currently&nbsp;map&nbsp;Dispose&nbsp;in&nbsp;GLib.Object&nbsp;to&nbsp;explicitly&nbsp;release&nbsp;our&nbsp;native&nbsp;toggle&nbsp;ref&nbsp;and&nbsp;SuppressFinalization.&nbsp; This&nbsp;is&nbsp;the&nbsp;closest&nbsp;we&nbsp;can&nbsp;get&nbsp;for&nbsp;non-widget&nbsp;GObjects.&nbsp; Therefore,&nbsp;we&nbsp;already&nbsp;have&nbsp;a&nbsp;forced&nbsp;&amp;quot;inconsistency&amp;quot;&nbsp;with&nbsp;the&nbsp;way&nbsp;.net&nbsp;users&nbsp;think. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
We&nbsp;can&nbsp;add&nbsp;another&nbsp;method&nbsp;for&nbsp;doing&nbsp;what&nbsp;Dispose&nbsp;currently&nbsp;does&nbsp;(such&nbsp;as&lt;br&gt;<br>
Detach&nbsp;or&nbsp;something&nbsp;like&nbsp;that).&nbsp;In&nbsp;any&nbsp;case,&nbsp;I&amp;#39;ve&nbsp;written&nbsp;thousands&nbsp;of&lt;br&gt;<br>
GTK#&nbsp;code&nbsp;in&nbsp;the&nbsp;past&nbsp;years,&nbsp;and&nbsp;I&nbsp;never&nbsp;had&nbsp;the&nbsp;need&nbsp;of&nbsp;such&nbsp;a&nbsp;method,&lt;br&gt;<br>
while&nbsp;I&amp;#39;ve&nbsp;had&nbsp;to&nbsp;write&nbsp;try/finally&nbsp;blocks&nbsp;to&nbsp;destroy&nbsp;dialogs&nbsp;many&lt;br&gt;<br>
times.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&amp;#39;ve&nbsp;never&nbsp;disposed&nbsp;a&nbsp;Gdk.Pixbuf,&nbsp;or&nbsp;a&nbsp;Pango.Layout? &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&amp;gt;&nbsp;It&nbsp;makes&nbsp;more&nbsp;sense&nbsp;to&nbsp;me&nbsp;that&nbsp;Destroy&nbsp;call&nbsp;Dispose,&nbsp;not&nbsp;vice-versa,&lt;br&gt;<br>
&amp;gt;&nbsp;and&nbsp;the&nbsp;using&nbsp;(FooDialog)&nbsp;pattern&nbsp;isn&amp;#39;t&nbsp;all&nbsp;that&nbsp;compelling&nbsp;to&nbsp;me.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Well,&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;matter&nbsp;which&nbsp;method&nbsp;calls&nbsp;which,&nbsp;since&nbsp;calling&nbsp;any&nbsp;of&lt;br&gt;<br>
them&nbsp;should&nbsp;have&nbsp;the&nbsp;same&nbsp;result.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;matters&nbsp;to&nbsp;the&nbsp;extent&nbsp;that&nbsp;we&nbsp;have&nbsp;to&nbsp;avoid&nbsp;cycles,&nbsp;which&nbsp;I&nbsp;believe&nbsp;your&nbsp;solution&nbsp;addresses. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
<br>
There&nbsp;is&nbsp;in&nbsp;fact&nbsp;another&nbsp;source&nbsp;of&nbsp;confusion&nbsp;here.&nbsp;If&nbsp;a&nbsp;widget&nbsp;subclass&lt;br&gt;<br>
needs&nbsp;to&nbsp;free&nbsp;its&nbsp;own&nbsp;resources,&nbsp;should&nbsp;it&nbsp;override&nbsp;Dispose&nbsp;or&lt;br&gt;<br>
OnDestroyed?&nbsp;It&amp;#39;s&nbsp;confusing,&nbsp;because&nbsp;Dispose&nbsp;is&nbsp;not&nbsp;always&nbsp;called&nbsp;when&lt;br&gt;<br>
destroying&nbsp;a&nbsp;widget,&nbsp;and&nbsp;OnDestroyed&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;Destroy&nbsp;is&lt;br&gt;<br>
explicitly&nbsp;called&nbsp;(that&nbsp;is,&nbsp;it&nbsp;won&amp;#39;t&nbsp;be&nbsp;called&nbsp;if&nbsp;a&nbsp;widget&nbsp;is&nbsp;finalized&lt;br&gt;<br>
because&nbsp;all&nbsp;references&nbsp;to&nbsp;it&nbsp;are&nbsp;freed).&nbsp;What&nbsp;we&nbsp;miss&nbsp;here,&nbsp;is&nbsp;a&nbsp;method&lt;br&gt;<br>
which&nbsp;is&nbsp;called&nbsp;when&nbsp;an&nbsp;object&nbsp;is&nbsp;finalized&nbsp;(in&nbsp;the&nbsp;gtk+&nbsp;sense),&nbsp;no&lt;br&gt;<br>
matter&nbsp;how.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;Dispose&nbsp;is&nbsp;not&nbsp;called&nbsp;on&nbsp;Destroy,&nbsp;that&amp;#39;s&nbsp;a&nbsp;bug.&nbsp; This&nbsp;may&nbsp;have&nbsp;been&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;past&nbsp;that&nbsp;got&nbsp;fixed&nbsp;over&nbsp;the&nbsp;course&nbsp;of&nbsp;the&nbsp;ref&nbsp;management&nbsp;saga&nbsp;over&nbsp;the&nbsp;last&nbsp;10&nbsp;years.&nbsp; I&nbsp;do&nbsp;recall&nbsp;it&nbsp;being&nbsp;a&nbsp;problem&nbsp;at&nbsp;one&nbsp;point.&nbsp; If&nbsp;it&nbsp;still&nbsp;exists,&nbsp;I&amp;#39;m&nbsp;interested&nbsp;in&nbsp;repro&nbsp;samples&nbsp;if&nbsp;they&nbsp;aren&amp;#39;t&nbsp;already&nbsp;filed. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
What&nbsp;I&nbsp;propose&nbsp;is&nbsp;implementing&nbsp;the&nbsp;Dispose&nbsp;pattern&nbsp;in&nbsp;this&nbsp;way:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; *&nbsp;Add&nbsp;a&nbsp;Dispose&nbsp;method&nbsp;which&nbsp;calls&nbsp;Destroy.&nbsp;That&nbsp;Dispose&nbsp;method&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; must&nbsp;be&nbsp;sealed.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Dispose&nbsp;must&nbsp;exist&nbsp;for&nbsp;non-Widget&nbsp;GLib.Objects.&nbsp; For&nbsp;it&nbsp;to&nbsp;exist&nbsp;on&nbsp;Widget,&nbsp;that&nbsp;means&nbsp;it&nbsp;has&nbsp;to&nbsp;be&nbsp;virtual&nbsp;on&nbsp;GLib.Object.&nbsp; I&nbsp;didn&amp;#39;t&nbsp;think&nbsp;you&nbsp;can&nbsp;&amp;quot;seal&amp;quot;&nbsp;an&nbsp;overridden&nbsp;method,&nbsp;but&nbsp;I&amp;#39;m&nbsp;not&nbsp;certain&nbsp;it&nbsp;would&nbsp;be&nbsp;necessary.&nbsp; Dispose&nbsp;implementors&nbsp;should&nbsp;always&nbsp;chain&nbsp;to&nbsp;base&nbsp;anyway,&nbsp;right?&nbsp; I&nbsp;thought&nbsp;it&nbsp;was&nbsp;fairly&nbsp;standard&nbsp;to&nbsp;post-call&nbsp;base.Dispose&nbsp;().&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&nbsp; &nbsp; &nbsp; *&nbsp;Add&nbsp;a&nbsp;new&nbsp;Dispose(bool&nbsp;disposing)&nbsp;method,&nbsp;protected&nbsp;and&nbsp;virtual.&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; *&nbsp;In&nbsp;the&nbsp;OnDestroyed&nbsp;handler,&nbsp;call&nbsp;Dispose(true),&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; GC.SuppressFinalize&nbsp;(this),&nbsp;and&nbsp;free&nbsp;the&nbsp;ref.&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; *&nbsp;In&nbsp;the&nbsp;GLib.Object&nbsp;finalizer,&nbsp;call&nbsp;Dispose(false)&nbsp;and&nbsp;free&nbsp;the&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; ref.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;No&nbsp;ref&nbsp;management&nbsp;can&nbsp;actually&nbsp;happen&nbsp;in&nbsp;the&nbsp;finalizer&nbsp;since&nbsp;it&nbsp;runs&nbsp;on&nbsp;another&nbsp;thread.&nbsp; Calling&nbsp;Dispose(false)&nbsp;then&nbsp;only&nbsp;perpetuates&nbsp;the&nbsp;life&nbsp;of&nbsp;the&nbsp;object.&nbsp; Right&nbsp;now&nbsp;we&nbsp;queue&nbsp;the&nbsp;ToggleRef&nbsp;for&nbsp;disposal&nbsp;in&nbsp;an&nbsp;idle&nbsp;handler&nbsp;from&nbsp;the&nbsp;finalizer&nbsp;to&nbsp;get&nbsp;it&nbsp;onto&nbsp;the&nbsp;gui&nbsp;thread.&nbsp; Queueing&nbsp;the&nbsp;object&nbsp;just&nbsp;to&nbsp;run&nbsp;Dispose&nbsp;would&nbsp;be&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;step&nbsp;backwards.&nbsp; I&nbsp;guess&nbsp;I&amp;#39;d&nbsp;like&nbsp;to&nbsp;understand&nbsp;what&nbsp;the&nbsp;use&nbsp;case&nbsp;is&nbsp;for&nbsp;stuff&nbsp;that&amp;#39;s&nbsp;happening&nbsp;in&nbsp;those&nbsp;Dispose&nbsp;handlers&nbsp;that&nbsp;would&nbsp;need&nbsp;to&nbsp;be&nbsp;invoked&nbsp;from&nbsp;the&nbsp;finalizer&nbsp;thread.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Implementing&nbsp;the&nbsp;pattern&nbsp;in&nbsp;this&nbsp;way,&nbsp;both&nbsp;Dispose&nbsp;and&nbsp;Destroy&nbsp;have&nbsp;the&lt;br&gt;<br>
same&nbsp;effect,&nbsp;and&nbsp;the&nbsp;Dispose(disposing)&nbsp;virtual&nbsp;method&nbsp;is&nbsp;always&nbsp;called&lt;br&gt;<br>
(either&nbsp;as&nbsp;a&nbsp;result&nbsp;of&nbsp;all&nbsp;references&nbsp;being&nbsp;freed&nbsp;or&nbsp;by&nbsp;an&nbsp;explicit&lt;br&gt;<br>
dispose).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;like&nbsp;the&nbsp;idea&nbsp;of&nbsp;Dispose&nbsp;invoking&nbsp;Destroy&nbsp;and&nbsp;doing&nbsp;the&nbsp;real&nbsp;dispose&nbsp;work&nbsp;in&nbsp;an&nbsp;internal&nbsp;Destroyed&nbsp;handler.&nbsp; We&nbsp;could&nbsp;make&nbsp;the&nbsp;current&nbsp;Dispose&nbsp;override&nbsp;in&nbsp;Gtk.Widget&nbsp;do&nbsp;that&nbsp;without&nbsp;chaining&nbsp;to&nbsp;base.Dispose,&nbsp;and&nbsp;have&nbsp;the&nbsp;Destroyed&nbsp;handler&nbsp;invoke&nbsp;base.Dispose,&nbsp;at&nbsp;least&nbsp;conceptually.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
About&nbsp;whether&nbsp;making&nbsp;Dispose/Destroy&nbsp;public&nbsp;or&nbsp;private,&nbsp;the&nbsp;framework&lt;br&gt;<br>
guidelines&nbsp;recommend&nbsp;using&nbsp;the&nbsp;framework&nbsp;terminology&nbsp;for&nbsp;&amp;#39;dispose&amp;#39;&lt;br&gt;<br>
methods,&nbsp;and&nbsp;implement&nbsp;IDisposable&nbsp;explicitly.&nbsp;However,&nbsp;IDisposable&nbsp;is&lt;br&gt;<br>
implemented&nbsp;by&nbsp;GLib.Object,&nbsp;which&nbsp;doesn&amp;#39;t&nbsp;have&nbsp;a&nbsp;Destroy&nbsp;method&nbsp;(Destroy&lt;br&gt;<br>
is&nbsp;defined&nbsp;by&nbsp;Gtk.Object/Widget),&nbsp;so&nbsp;making&nbsp;Dispose&nbsp;public&nbsp;may&nbsp;be&nbsp;a&lt;br&gt;<br>
better&nbsp;option&nbsp;in&nbsp;this&nbsp;case.&nbsp;In&nbsp;any&nbsp;case,&nbsp;I&nbsp;think&nbsp;it&nbsp;is&nbsp;ok&nbsp;having&nbsp;both&lt;br&gt;<br>
public.&nbsp;As&nbsp;Nicholas&nbsp;said,&nbsp;several&nbsp;.NET&nbsp;classes&nbsp;have&nbsp;Dispose/Close&lt;br&gt;<br>
methods,&nbsp;and&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;to&nbsp;cause&nbsp;confusion.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yeah,&nbsp;maybe&nbsp;we&nbsp;can&nbsp;make&nbsp;them&nbsp;coexist&nbsp;without&nbsp;confusing&nbsp;the&nbsp;heck&nbsp;out&nbsp;of&nbsp;everyone.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Mike&lt;/div&gt;&lt;/div&gt;<br>

</tt>
