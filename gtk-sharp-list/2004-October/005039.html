<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Problem with Gtk.Clipboard copy/paste
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:alf82%40freemail.gr">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005026.html">
   <LINK REL="Next"  HREF="005027.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Problem with Gtk.Clipboard copy/paste
   </H1>
    <B>alf
    </B> 
    <A HREF="mailto:alf82%40freemail.gr"
       TITLE="[Gtk-sharp-list] Problem with Gtk.Clipboard copy/paste">alf82@freemail.gr
       </A><BR>
    <I>Fri, 29 Oct 2004 17:43:08 +0300</I>
    <P><UL>
        <LI> Previous message: <A HREF="005026.html">[Gtk-sharp-list] How to reference an object, given it's name?
</A></li>
        <LI> Next message: <A HREF="005027.html">[Gtk-sharp-list] Re:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5039">[ date ]</a>
              <a href="thread.html#5039">[ thread ]</a>
              <a href="subject.html#5039">[ subject ]</a>
              <a href="author.html#5039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, 

I have been experimenting with the copy/paste clipboard features of Gtk#
and I have run into something that may be a bug. I am using Gtk# 1.0.2
and Mono 1.1.1.

For example:

&lt;-------------------------------------------------------------&gt;
using System;
using Gtk;

class CopyPasteTest:Gtk.Window {

Gtk.Clipboard clipboard;

static TargetEntry[] targets= new TargetEntry[]{
new TargetEntry(&quot;UTF8_STRING&quot;, 0, 0)};

public static void Main(string[] args)
{
	Application.Init ();
	new CopyPasteTest ();
	Application.Run ();
}

public CopyPasteTest () : base (&quot;CopyPasteTest&quot;)
{
	this.SetDefaultSize (400, 300);
	this.DeleteEvent += new DeleteEventHandler (OnDelete);

	clipboard=Gtk.Clipboard.Get(Gdk.Atom.Intern(&quot;CLIPBOARD&quot;, true));

	Button btn = new Button (&quot;Copy&quot;);
	btn.Clicked += new EventHandler (OnCopyClicked);
	Add(btn);

	this.ShowAll ();
}


void OnClipboardGet(Clipboard cb, ref SelectionData sd, uint i)
{
	Gdk.Atom atom=Gdk.Atom.Intern(&quot;UTF8_STRING&quot;,false);
	sd.Set(atom, 8, new byte[]{0x31,0x32,0x33});
} 

void OnClipboardClear(Clipboard cb)
{


}

void OnCopyClicked(object o, EventArgs args)
{
	clipboard.SetWithData(targets, new ClipboardGetFunc(OnClipboardGet),
new ClipboardClearFunc(OnClipboardClear));

	// this works fine 
	//clipboard.SetText(&quot;fff&quot;);
} 

void OnDelete (object o, DeleteEventArgs args)
{
	Application.Quit ();
}

}
&lt;-----------------------------------------------------&gt;

When I click on the copy button and try to paste in some other
application that accepts UTF8_STRING (eg gedit) my program crashes with:

Unhandled Exception: System.NullReferenceException: Object reference not
set to an instance of an object
in &lt;0xffa6e8e0&gt; (wrapper managed-to-native)
Gtk.SelectionData:gtk_selection_data_set (intptr,intptr,int,byte[],int)
in &lt;0x00004&gt; (wrapper managed-to-native)
Gtk.SelectionData:gtk_selection_data_set (intptr,intptr,int,byte[],int)
in &lt;0x0003e&gt; Gtk.SelectionData:Set (Gdk.Atom,int,byte[],int)
in &lt;0x0001d&gt; Gtk.SelectionData:Set (Gdk.Atom,int,byte[])
in [0x00025] (at /home/alf/Projects/CopyPasteTest/Main.cs:37)
CopyPasteTest:OnClipboardGet (Gtk.Clipboard,Gtk.SelectionData&amp;,uint)
in &lt;0x00076&gt; (wrapper delegate-invoke)
System.MulticastDelegate:invoke_void_Clipboard_SelectionData&amp;_uint
(Gtk.Clipboard,Gtk.SelectionData&amp;,uint)
in &lt;0x0007b&gt; GtkSharp.ClipboardGetFuncWrapper:NativeCallback
(intptr,intptr&amp;,uint,intptr)
in &lt;0x0009f&gt; (wrapper native-to-managed)
GtkSharp.ClipboardGetFuncWrapper:NativeCallback
(intptr,intptr&amp;,uint,intptr)
in &lt;0xff97bec1&gt; (wrapper managed-to-native) Gtk.Application:gtk_main ()
in &lt;0x00004&gt; (wrapper managed-to-native) Gtk.Application:gtk_main ()
in &lt;0x00007&gt; Gtk.Application:Run ()
in [0x0000b] (at /home/alf/Projects/CopyPasteTest/Main.cs:15)
CopyPasteTest:Main (string[])


If in the method OnCopyClicked() I use clipboard.SetText() instead of
clipboard.SetWithData() everything runs normally. Unfortunately, I need
to use other types besides the string type.

I would post this to bugzilla but I first wanted to make sure that 
this is not a problem with my code.

Any thoughts?

Thanks,
Alexandros


____________________________________________________________________
<A HREF="http://www.freemail.gr">http://www.freemail.gr</A> - δωρεάν υπηρεσία ηλεκτρονικού ταχυδρομείου.
<A HREF="http://www.freemail.gr">http://www.freemail.gr</A> - free email service for the Greek-speaking.

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005026.html">[Gtk-sharp-list] How to reference an object, given it's name?
</A></li>
	<LI> Next message: <A HREF="005027.html">[Gtk-sharp-list] Re:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5039">[ date ]</a>
              <a href="thread.html#5039">[ thread ]</a>
              <a href="subject.html#5039">[ subject ]</a>
              <a href="author.html#5039">[ author ]</a>
         </LI>
       </UL>
</body></html>
