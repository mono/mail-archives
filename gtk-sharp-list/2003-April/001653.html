<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> ColorSelection bug fixes (was Re: [Gtk-sharp-list] problem
 marshalling struct data)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pbaena%40uol.com.ar">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001648.html">
   <LINK REL="Next"  HREF="001607.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>ColorSelection bug fixes (was Re: [Gtk-sharp-list] problem
 marshalling struct data)
   </H1>
    <B>Pablo Baena
    </B> 
    <A HREF="mailto:pbaena%40uol.com.ar"
       TITLE="ColorSelection bug fixes (was Re: [Gtk-sharp-list] problem
 marshalling struct data)">pbaena@uol.com.ar
       </A><BR>
    <I>13 Apr 2003 19:32:53 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="001648.html">ColorSelection bug fixes (was Re: [Gtk-sharp-list] problem
 marshalling struct data)
</A></li>
        <LI> Next message: <A HREF="001607.html">[Gtk-sharp-list] Getting Keyboard Input
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1653">[ date ]</a>
              <a href="thread.html#1653">[ thread ]</a>
              <a href="subject.html#1653">[ subject ]</a>
              <a href="author.html#1653">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-I9Ip3j2fPypWeGN0M7Jh
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

I now see why you use unsafe.

You can change 

parsedColors = (IntPtr) ((int)parsedColors + sizeof(Gdk.Color));

with 

parsedColors = (IntPtr) ((int)parsedColors + Marshal.SizeOf(colors[i]));

then you can get rid of unsafe code.



On Sat, 2003-04-12 at 13:08, Lee Mallabone wrote:

&gt;<i> On Sat, 2003-04-12 at 03:24, Mike Kestner wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Only thing I can think of is to return an IntPtr, and in a .custom,
</I>&gt;<i> &gt; increment the pointer while iterating on n_color using Gdk.Color.New to
</I>&gt;<i> &gt; marshal the individual Colors. May need to go into unsafe mode to
</I>&gt;<i> &gt; increment the IntPtr, but I'm not sure off the top of my head.
</I>&gt;<i> 
</I>&gt;<i> I was trying to do that originally, but in a way that didn't actually
</I>&gt;<i> manipulate the IntPtr, so it didn't work.
</I>&gt;<i> 
</I>&gt;<i> It works now (though PaletteFromString is unsafe).
</I>&gt;<i> 
</I>&gt;<i> I've attached patches that fix up bugs in ColorSelection. They make
</I>&gt;<i> PaletteFromString() and PaletteToString have good method signatures as
</I>&gt;<i> well as making PreviousColor a single property. This resolves bugs
</I>&gt;<i> #27835 &amp; #38672.
</I>&gt;<i> 
</I>&gt;<i> Okay to commit?
</I>&gt;<i> 
</I>&gt;<i> I've also attached ColorSample.cs which is actually a visual test that
</I>&gt;<i> things work. I could probably turn this into an NUnit test without too
</I>&gt;<i> much trouble. Does Gtk# have a framework/suite setup for NUnit tests? If
</I>&gt;<i> not, is this worth putting on cvs anywhere, (it crashes without my
</I>&gt;<i> patches, works correctly with them).
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Lee.
</I>
-- 
Pablo Baena &lt;<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&gt;

--=-I9Ip3j2fPypWeGN0M7Jh
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: 7bit

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 TRANSITIONAL//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
  &lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; CHARSET=UTF-8&quot;&gt;
  &lt;META NAME=&quot;GENERATOR&quot; CONTENT=&quot;GtkHTML/1.1.7&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
I now see why you use unsafe.&lt;BR&gt;
&lt;BR&gt;
You can change &lt;BR&gt;
&lt;FONT SIZE=&quot;3&quot;&gt;&lt;TT&gt;&lt;BR&gt;
parsedColors = (IntPtr) ((int)parsedColors + sizeof(Gdk.Color));&lt;/TT&gt;&lt;/FONT&gt;&lt;BR&gt;
&lt;BR&gt;
with &lt;BR&gt;
&lt;BR&gt;
&lt;FONT SIZE=&quot;3&quot;&gt;&lt;TT&gt;parsedColors = (IntPtr) ((int)parsedColors + Marshal.SizeOf(colors[i]));&lt;BR&gt;
&lt;BR&gt;
then you can get rid of unsafe code.&lt;BR&gt;
&lt;BR&gt;
&lt;/TT&gt;&lt;/FONT&gt;&lt;BR&gt;
&lt;BR&gt;
On Sat, 2003-04-12 at 13:08, Lee Mallabone wrote:
&lt;BLOCKQUOTE TYPE=CITE&gt;
&lt;PRE&gt;&lt;FONT COLOR=&quot;#737373&quot; SIZE=&quot;3&quot;&gt;&lt;I&gt;On Sat, 2003-04-12 at 03:24, Mike Kestner wrote:

&amp;gt;<i> Only thing I can think of is to return an IntPtr, and in a .custom,
</I>&amp;gt;<i> increment the pointer while iterating on n_color using Gdk.Color.New to
</I>&amp;gt;<i> marshal the individual Colors. May need to go into unsafe mode to
</I>&amp;gt;<i> increment the IntPtr, but I'm not sure off the top of my head.
</I>
I was trying to do that originally, but in a way that didn't actually
manipulate the IntPtr, so it didn't work.

It works now (though PaletteFromString is unsafe).

I've attached patches that fix up bugs in ColorSelection. They make
PaletteFromString() and PaletteToString have good method signatures as
well as making PreviousColor a single property. This resolves bugs
#27835 &amp;amp; #38672.

Okay to commit?

I've also attached ColorSample.cs which is actually a visual test that
things work. I could probably turn this into an NUnit test without too
much trouble. Does Gtk# have a framework/suite setup for NUnit tests? If
not, is this worth putting on cvs anywhere, (it crashes without my
patches, works correctly with them).

Regards,

Lee.&lt;/I&gt;&lt;/FONT&gt;&lt;/PRE&gt;
&lt;/BLOCKQUOTE&gt;
&lt;PRE&gt;&lt;TABLE CELLSPACING=&quot;0&quot; CELLPADDING=&quot;0&quot; WIDTH=&quot;100%&quot;&gt;
&lt;TR&gt;
&lt;TD&gt;
-- &lt;BR&gt;
Pablo Baena &amp;lt;&lt;A HREF=&quot;mailto:<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&quot;&gt;<A HREF="mailto:pbaena@uol.com.ar">pbaena@uol.com.ar</A>&lt;/A&gt;&amp;gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TABLE&gt;
&lt;/PRE&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;

--=-I9Ip3j2fPypWeGN0M7Jh--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001648.html">ColorSelection bug fixes (was Re: [Gtk-sharp-list] problem
 marshalling struct data)
</A></li>
	<LI> Next message: <A HREF="001607.html">[Gtk-sharp-list] Getting Keyboard Input
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1653">[ date ]</a>
              <a href="thread.html#1653">[ thread ]</a>
              <a href="subject.html#1653">[ subject ]</a>
              <a href="author.html#1653">[ author ]</a>
         </LI>
       </UL>
</body></html>
