<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] TreeView &amp; Glade on win32 via .NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mariano.cano%40hispalinux.es">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001706.html">
   <LINK REL="Next"  HREF="001699.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] TreeView &amp; Glade on win32 via .NET
   </H1>
    <B>McP
    </B> 
    <A HREF="mailto:mariano.cano%40hispalinux.es"
       TITLE="[Gtk-sharp-list] TreeView &amp; Glade on win32 via .NET">mariano.cano@hispalinux.es
       </A><BR>
    <I>20 Apr 2003 21:02:15 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="001706.html">[Gtk-sharp-list] gapi_codegen.exe not working on PPC
</A></li>
        <LI> Next message: <A HREF="001699.html">[Gtk-sharp-list] TreeView &amp; Glade on win32 via .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1698">[ date ]</a>
              <a href="thread.html#1698">[ thread ]</a>
              <a href="subject.html#1698">[ subject ]</a>
              <a href="author.html#1698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Before answer, I have a question about getting the cursor in a TreeView.

In gtk+ we have in GtkTreeView this
(<A HREF="http://developer.gnome.org/doc/API/2.2/gtk/GtkTreeView.html#gtk-tree-view-get-cursor">http://developer.gnome.org/doc/API/2.2/gtk/GtkTreeView.html#gtk-tree-view-get-cursor</A>):
void gtk_tree_view_get_cursor(
	GtkTreeView *tree_view,
	GtkTreePath **path,
	GtkTreeViewColumn **focus_column);
Fills in path and focus_column with the current path and focus column.
If the cursor isn't currently set, then *path will be NULL. 
If no column currently has focus, then *focus_column will be NULL.

In gtk# gapi traduces it with:
public void GetCursor(Gtk.TreePath path, 
	Gtk.TreeViewColumn focus_column) 
{
   gtk_tree_view_get_cursor(Handle,path.Handle,focus_column.Handle);
}

Is this the correct traduction for pointers to pointers (**)?
With this code I have to create new TreePath and a new TreeViewColumn,
which will point to another path and column after the funcion (see
code).
Why don't use references ?

If I use GetCursor I have a System.NullReferenceException:
System.NullReferenceException: A null value was found where an object
instance was required
in (unmanaged) 06 Gtk.ListStore:gtk_tree_model_get_iter
(intptr,Gtk.TreeIter&amp;,intptr)
in &lt;0x00004&gt; 06 Gtk.ListStore:gtk_tree_model_get_iter
(intptr,Gtk.TreeIter&amp;,intptr)
in &lt;0x00042&gt; 00 Gtk.ListStore:GetIter (Gtk.TreeIter&amp;,Gtk.TreePath)
in &lt;0x0012c&gt; 00 .MultimediaTagger:TabPressed
(object,GtkSharp.KeyPressEventArgs)

This is the code
void TabPressed(object o, KeyPressEventArgs args)
{
	Gdk.EventKey key = args.Event;
	if(key.keyval == ((uint)Gdk.Key.Tab))
	{
		TreeIter iter;
		TreeView tree = (TreeView) o;
		// I have to create new objects
		TreePath path = new TreePath();
		TreeViewColumn col = new TreeViewColumn();

		tree.GetCursor(path,col);
		try{
			tree.Model.GetIter(out iter,path);
		}
		catch(System.Exception e)
		{
			Console.WriteLine(e);
			return;
		}
		......
	
	--------------------- THE ANSWER ----------------------

If you want to have two columns (one with a pixbuf and a label and the
other with a label), you have to do this:

note: columnId.Icon == ColumnId.Name

//Don't use Pixbuf type !!!
store = new TreeStore((int)TypeFundamentals.TypeString,
	(int)TypeFundamentals.TypeString);
tvFriendsLists = new TreeView(store); // Or tvFriendLists.Model = store, as you like

//the first column
TreeViewColumn labelColumn = new TreeViewColumn();
labelColumn.Title = &quot;Friends&quot;;

CellRenderer iconRenderer = new CellRendererPixbuf();
labelColumn.PackStart(iconRenderer, false);
//Don't use this, if you use it, it will display a warning.
//labelColumn.AddAttribute(iconRenderer, &quot;pixbuf&quot;, (int)ColumnId.Icon);

CellRenderer labelRenderer = new CellRendererText();
labelColumn.PackStart(labelRenderer, true);
labelColumn.AddAttribute(labelRenderer, &quot;text&quot;, (int)ColumnId.Name);

//Add the SetCellDataFunc (see down)
labelColumn.SetCellDataFunc(pixbuf_renderer,SetPixbufDelegate,IntPtr.Zero,null);

tvFriendsList.AppendColumn(labelColumn);

// let's build the column that stores the JIDs
TreeViewColumn labelColumn2 = new TreeViewColumn();
labelColumn2.Title = &quot;JID&quot;;

CellRenderer labelRenderer2 = new CellRendererText();
labelColumn2.PackStart(labelRenderer2, true);
labelColumn2.AddAttribute(labelRenderer2, &quot;text&quot;, (int)ColumnId.JID);

tvFriendsList.AppendColumn(labelColumn2);


//Now you can add a node
TreeModel model;
TreeIter parent = TreeIter.Zero, iter;
TreeSelection selection = tvFriendsList.Selection;

if (null != selection &amp;&amp; selection.GetSelected(out model, ref parent))
{
	store.Append(out iter, parent);
}
else
{
	store.Append(out iter);
}

//Only add the text
//store.SetValue(iter, (int)ColumnId.Icon, 
//	new Value(new Gdk.Pixbuf(&quot;test.png&quot;)));
store.SetValue(iter, (int)ColumnId.Name, new Value(&quot;Simon&quot;));
store.SetValue(iter, (int)ColumnId.JID, new Value(&quot;<A HREF="mailto:simon@wherever.com">simon@wherever.com</A>&quot;));


Now we have to add the correct pixbuf to each cell. You have to use
SetCellDataFunc. 
I'm working on a MP3-Ogg 'Tagger', and solved it with something like
this:

1) Declare a delegate function
TreeCellDataFunc SetPixbufDelegate = new TreeCellDataFunc(SetPixbuf);

2) Asign this function to the TreeViewColumn
col1.SetCellDataFunc(pixbuf_renderer,SetPixbufDelegate,IntPtr.Zero,null);

3) The function (this is the function I use)
static void SetPixbuf(TreeViewColumn tree_column, CellRenderer cell,
	TreeModel tree_model, TreeIter iter)
{
	GLib.Value mime;
	Gdk.Pixbuf pixbuf;
	
	tree_model.GetValue(iter,9,out mime);
	pixbuf=(Gdk.Pixbuf)pixbufHash[(string)mime];
	if(pixbuf!=null)
		cell.SetProperty(&quot;pixbuf&quot;, new Value(pixbuf));
}

-- 
McP &lt;<A HREF="mailto:mariano.cano@hispalinux.es">mariano.cano@hispalinux.es</A>&gt;


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001706.html">[Gtk-sharp-list] gapi_codegen.exe not working on PPC
</A></li>
	<LI> Next message: <A HREF="001699.html">[Gtk-sharp-list] TreeView &amp; Glade on win32 via .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1698">[ date ]</a>
              <a href="thread.html#1698">[ thread ]</a>
              <a href="subject.html#1698">[ subject ]</a>
              <a href="author.html#1698">[ author ]</a>
         </LI>
       </UL>
</body></html>
