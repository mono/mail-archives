<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> Ant: Re: Ant: Re: [Gtk-sharp-list] gtk-sharp.dll not working
	on linux because it references win32 dll's
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=Ant%3A%20Re%3A%20Ant%3A%20Re%3A%20%5BGtk-sharp-list%5D%20gtk-sharp.dll%20not%20working%0A%09on%20linux%20because%20it%20references%20win32%20dll%27s&In-Reply-To=20050718190341.26336.qmail%40web26705.mail.ukl.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006196.html">
   <LINK REL="Next"  HREF="006203.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Ant: Re: Ant: Re: [Gtk-sharp-list] gtk-sharp.dll not working
	on linux because it references win32 dll's</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=Ant%3A%20Re%3A%20Ant%3A%20Re%3A%20%5BGtk-sharp-list%5D%20gtk-sharp.dll%20not%20working%0A%09on%20linux%20because%20it%20references%20win32%20dll%27s&In-Reply-To=20050718190341.26336.qmail%40web26705.mail.ukl.yahoo.com"
       TITLE="Ant: Re: Ant: Re: [Gtk-sharp-list] gtk-sharp.dll not working
	on linux because it references win32 dll's">jonpryor at vt.edu
       </A><BR>
    <I>Mon Jul 18 21:10:48 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="006196.html">Ant: Re: Ant: Re: [Gtk-sharp-list] gtk-sharp.dll not working on linux
	because it references win32 dll's
</A></li>
        <LI>Next message: <A HREF="006203.html">Ant: Re: Ant: Re: Ant: Re: [Gtk-sharp-list] gtk-sharp.dll not working
	on linux because it references win32 dll's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6198">[ date ]</a>
              <a href="thread.html#6198">[ thread ]</a>
              <a href="subject.html#6198">[ subject ]</a>
              <a href="author.html#6198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2005-07-18 at 21:03 +0200, Jost Boekemeier wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> it's a simple:
</I>&gt;<i> 
</I>&gt;<i> System.Reflection.Assembly.load(&quot;gtk-sharp);
</I>
That's unlikely to work, as gtk-sharp is now in the GAC and the assembly
name you're providing lacks version information and other things.

Assembly.Load (&quot;foo&quot;) will only load foo.dll from the
System.AppDomain.CurrentDomain.SetupInformation.ApplicationBase
directory (and PrivateBinPath, PrivateBinPathProbe, and other similar
directories).

In short, Assembly.Load (&quot;gtk-sharp&quot;) WILL NOT WORK, and hasn't worked
ever since gtk-sharp.dll was placed in the GAC.

To load an Assembly located in the GAC, you need either
Assembly.LoadWithPartialName (which might not load the assembly you
want, and is [Obsolete] in .NET 2.0) or Assembly.Load (AssemblyName).
MSDN should have some examples for you.

&gt;<i> However, I don't understand why gtk-sharp doesn't
</I>&gt;<i> simply reference a bridge dll which might select the
</I>&gt;<i> appropriate native dll (windows or linux).
</I>
Because writing hundreds (yes, hundreds) of functions that do nothing
more than forward calls to another function are tedious and error-prone
to write and bloat memory requirements.  Do you really want a new
library with nothing more than:

	ReturnType
	gtksharp_gtk_function (Type1 arg1, Type2 arg2)
	{
		return gtk_function (arg1, arg2);
	}

This would eat disk space &amp; RAM for no real gain.

Instead, mono supports .config files for .dll assemblies (.NET doesn't).
These .config files can contain &lt;dllmap/&gt; entries to map a library name
used in a DllImport statement onto a *different* library name at
runtime.  This allows the an assembly to use the win32 names everywhere,
and a .config file can be provided so that mono loads the appropriate
library at runtime.  This is transparent to the app, and works fine with
Reflection and everything else.

In fact, if you get a DllImportAttribute via Reflection,
DllImportAttribute.Value will contain the remapped library name, *not*
the name that's in the IL (something put to use by mono-shlib-cop).

Best of all, it allows you to ship a single assembly that works on both
mono and .NET without needing conditional compilation &amp; a recompile.

&gt;<i>   If one currently looks at gtk-sharp dll (either via
</I>&gt;<i> reflection or via monodis), one sees that a lib*win32
</I>&gt;<i> is needed.
</I>
As stated above, when using reflection you get the remapped library
name, not the library name in the IL.  Monodis will obviously show you
the library name in the IL (it would be broken to do otherwise).

&gt;<i> So one could come to the conclusion that gtk-sharp only works on
</I>&gt;<i> windows platforms...
</I>
One could come to that conclusion, then wonder why there are more Linux
Gtk# apps than Windows ones. :-)

Thus proving that the obvious conclusion isn't always the correct one.

 - Jon


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006196.html">Ant: Re: Ant: Re: [Gtk-sharp-list] gtk-sharp.dll not working on linux
	because it references win32 dll's
</A></li>
	<LI>Next message: <A HREF="006203.html">Ant: Re: Ant: Re: Ant: Re: [Gtk-sharp-list] gtk-sharp.dll not working
	on linux because it references win32 dll's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6198">[ date ]</a>
              <a href="thread.html#6198">[ thread ]</a>
              <a href="subject.html#6198">[ subject ]</a>
              <a href="author.html#6198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
