<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] TextView utf8 string problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:przemos%40klub.chip.pl">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="004244.html">
   <LINK REL="Next"  HREF="004250.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] TextView utf8 string problem
   </H1>
    <B>Przemyslaw Sowa
    </B> 
    <A HREF="mailto:przemos%40klub.chip.pl"
       TITLE="[Gtk-sharp-list] TextView utf8 string problem">przemos@klub.chip.pl
       </A><BR>
    <I>Sun, 20 Jun 2004 12:59:28 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="004244.html">[Gtk-sharp-list] Mono Beta 3 and GTK# on Windows
</A></li>
        <LI> Next message: <A HREF="004250.html">[Gtk-sharp-list] Strange output working with Gtk.Image. Maybe a bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4251">[ date ]</a>
              <a href="thread.html#4251">[ thread ]</a>
              <a href="subject.html#4251">[ subject ]</a>
              <a href="author.html#4251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have problem with TextView and unicode strings. When I'm trying to add
some text with unicode character that is more then one byte long (for
example the biohazard sign \u2623 or any Polish letter) I gets error
message:

(&lt;unknown&gt;:1990): Gtk-CRITICAL **: file gtktextbuffer.c: line 557
(gtk_text_buffer_emit_insert): assertion `g_utf8_validate (text, len,
NULL)' failed

But when I add the same string to ListView everything is OK.

Here is a sample app that shows the problem:

-cut-
using System;
using Gtk;

namespace TextViewTest
{
class TextViewTestApp : Window
{
public static void Main(string[] args)
{
Application.Init ();
new TextViewTestApp ();
Application.Run ();
}

public TextViewTestApp () : base (&quot;TextViewTest Window&quot;)
{
// Create window and widgets
this.SetDefaultSize (400, 300);
this.DeleteEvent += new DeleteEventHandler (OnWindowDelete);
this.BorderWidth = 12;

HBox hbox = new HBox (true, 12);
this.Add (hbox);
ScrolledWindow scrolledWindow = new ScrolledWindow (null, null);
scrolledWindow.ShadowType = ShadowType.In;
hbox.PackStart (scrolledWindow);
TreeView treeview = new TreeView ();
treeview.HeadersVisible = false;
scrolledWindow.Add (treeview);

scrolledWindow = new ScrolledWindow (null, null);
scrolledWindow.ShadowType = ShadowType.In;
hbox.PackEnd (scrolledWindow);
TextView textview = new TextView ();
scrolledWindow.Add (textview);

// This is a string with unicode character
string unicodeString = &quot;biohazard sign \u2623&quot;;

// This line produces fallowing error message:
// (&lt;unknown&gt;:1965): Gtk-CRITICAL **: file gtktextbuffer.c:
// line 557 (gtk_text_buffer_emit_insert): assertion
// `g_utf8_validate (text, len, NULL)' failed
textview.Buffer.SetText (unicodeString);

// But adding the string to a TreeView works as expected
ListStore store = new ListStore (typeof (string));
  store.AppendValues (unicodeString);
treeview.Model = store;
treeview.AppendColumn (&quot;&quot;, new CellRendererText (), &quot;text&quot;, 0);

// Console (Gnome Terminal) displays the string correctly
Console.WriteLine (unicodeString);

this.ShowAll ();
}

void OnWindowDelete (object o, DeleteEventArgs args)
{
Application.Quit ();
}
}
}
-cut-

I don't know what is wrong with this code?

Przemyslaw Sowa



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="004244.html">[Gtk-sharp-list] Mono Beta 3 and GTK# on Windows
</A></li>
	<LI> Next message: <A HREF="004250.html">[Gtk-sharp-list] Strange output working with Gtk.Image. Maybe a bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4251">[ date ]</a>
              <a href="thread.html#4251">[ thread ]</a>
              <a href="subject.html#4251">[ subject ]</a>
              <a href="author.html#4251">[ author ]</a>
         </LI>
       </UL>
</body></html>
