<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Problem getting a TreePath from a	TreeModelSort by x and y coords
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Problem%20getting%20a%20TreePath%20from%20a%0A%09TreeModelSort%20by%20x%20and%20y%20coords&In-Reply-To=fbf8ec8d1002091624j347555c3k962f85cf985b4e77%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010092.html">
   <LINK REL="Next"  HREF="010104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Problem getting a TreePath from a	TreeModelSort by x and y coords</H1>
    <B>Michael Hutchinson</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Problem%20getting%20a%20TreePath%20from%20a%0A%09TreeModelSort%20by%20x%20and%20y%20coords&In-Reply-To=fbf8ec8d1002091624j347555c3k962f85cf985b4e77%40mail.gmail.com"
       TITLE="[Gtk-sharp-list] Problem getting a TreePath from a	TreeModelSort by x and y coords">m.j.hutchinson at gmail.com
       </A><BR>
    <I>Tue Feb  9 23:51:16 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010092.html">[Gtk-sharp-list] Problem getting a TreePath from a TreeModelSort by	x and y coords
</A></li>
        <LI>Next message: <A HREF="010104.html">[Gtk-sharp-list] Send keystroke to gtk window with proccess.start(xsendkeycode)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10095">[ date ]</a>
              <a href="thread.html#10095">[ thread ]</a>
              <a href="subject.html#10095">[ subject ]</a>
              <a href="author.html#10095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Feb 9, 2010 at 7:24 PM, Matthew Pirocchi
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">matthew.pirocchi at gmail.com</A>&gt; wrote:
&gt;<i> I have a ListStore that is filtered and then sorted. It looks
</I>&gt;<i> something like this:
</I>&gt;<i>
</I>&gt;<i> // Create a model for the cards
</I>&gt;<i> cardListStore = new ListStore (typeof (Card));
</I>&gt;<i>
</I>&gt;<i> // Set up the tree view
</I>&gt;<i> cardFilter = new TreeModelFilter (cardListStore, null);
</I>&gt;<i> cardFilter.VisibleFunc = new TreeModelFilterVisibleFunc (FilterCards);
</I>&gt;<i> cardSort = new TreeModelSort (cardFilter);
</I>&gt;<i> cardTreeView.Model = cardSort;
</I>&gt;<i>
</I>&gt;<i> I want to have a get a context menu specific for each row when I
</I>&gt;<i> right-click on it. My click handler looks something like this:
</I>&gt;<i>
</I>&gt;<i> [GLib.ConnectBeforeAttribute]
</I>&gt;<i> void HandleCardTreeViewButtonPressEvent (object o, ButtonPressEventArgs args)
</I>&gt;<i> {
</I>&gt;<i> &#160;if (args.Event.Button != 3)
</I>&gt;<i> &#160;return;
</I>&gt;<i>
</I>&gt;<i> &#160;TreePath path;
</I>&gt;<i> &#160;// If right click on empty space
</I>&gt;<i> &#160;if (!cardTreeView.GetPathAtPos (Convert.ToInt32 (args.Event.X),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Convert.ToInt32 (args.Event.Y),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; out path)) {
</I>&gt;<i> &#160;MakeCardEmptySpaceContextMenu ().Popup ();
</I>&gt;<i> &#160;return;
</I>&gt;<i> &#160;}
</I>&gt;<i>
</I>&gt;<i> &#160;TreeIter iter;
</I>&gt;<i> &#160;if (!cardListStore.GetIter (out iter, path))
</I>&gt;<i> &#160;return;
</I>&gt;<i>
</I>&gt;<i> &#160;Card card = (Card) cardListStore.GetValue (iter, 0);
</I>&gt;<i>
</I>&gt;<i> &#160;MakeCardContextMenu (card, iter).Popup ();
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> This works when the ListStore is not filtered or sorted. But when it
</I>&gt;<i> is, it gives the wrong row.
</I>&gt;<i>
</I>&gt;<i> For example, say the rows look like this before they are sorted:
</I>&gt;<i>
</I>&gt;<i> A
</I>&gt;<i> B
</I>&gt;<i> C
</I>&gt;<i>
</I>&gt;<i> And after they are sorted, they look like this:
</I>&gt;<i>
</I>&gt;<i> B
</I>&gt;<i> A
</I>&gt;<i> C
</I>&gt;<i>
</I>&gt;<i> Right-clicking on the second row (&quot;A&quot;) will give you &quot;B&quot;, because
</I>&gt;<i> that's where B was before the model was sorted. The same thing happens
</I>&gt;<i> for filtering. Say the model, after it is filtered, looks like this:
</I>&gt;<i>
</I>&gt;<i> A
</I>&gt;<i> C
</I>&gt;<i>
</I>&gt;<i> Right-clicking on the second row (&quot;C&quot;) would still give you &quot;B&quot;.
</I>&gt;<i>
</I>&gt;<i> Any idea how to work around this?
</I>
Since the model &quot;seen&quot; by the view is the sorted model, shouldn't you
get the value from that? i.e.

TreeIter iter;
if (!cardSort.GetIter (out iter, path))
    return;
Card card = (Card) cardSort.GetValue (iter, 0);

-- 
Michael Hutchinson
<A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010092.html">[Gtk-sharp-list] Problem getting a TreePath from a TreeModelSort by	x and y coords
</A></li>
	<LI>Next message: <A HREF="010104.html">[Gtk-sharp-list] Send keystroke to gtk window with proccess.start(xsendkeycode)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10095">[ date ]</a>
              <a href="thread.html#10095">[ thread ]</a>
              <a href="subject.html#10095">[ subject ]</a>
              <a href="author.html#10095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
