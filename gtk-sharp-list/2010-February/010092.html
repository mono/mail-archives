<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Problem getting a TreePath from a TreeModelSort by	x and y coords
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Problem%20getting%20a%20TreePath%20from%20a%20TreeModelSort%20by%0A%09x%20and%20y%20coords&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010091.html">
   <LINK REL="Next"  HREF="010095.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Problem getting a TreePath from a TreeModelSort by	x and y coords</H1>
    <B>Matthew Pirocchi</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Problem%20getting%20a%20TreePath%20from%20a%20TreeModelSort%20by%0A%09x%20and%20y%20coords&In-Reply-To="
       TITLE="[Gtk-sharp-list] Problem getting a TreePath from a TreeModelSort by	x and y coords">matthew.pirocchi at gmail.com
       </A><BR>
    <I>Tue Feb  9 19:24:45 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="010091.html">[Gtk-sharp-list] Strange Exceptioon in WebKit.WebView
</A></li>
        <LI>Next message: <A HREF="010095.html">[Gtk-sharp-list] Problem getting a TreePath from a	TreeModelSort by x and y coords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10092">[ date ]</a>
              <a href="thread.html#10092">[ thread ]</a>
              <a href="subject.html#10092">[ subject ]</a>
              <a href="author.html#10092">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a ListStore that is filtered and then sorted. It looks
something like this:

// Create a model for the cards
cardListStore = new ListStore (typeof (Card));

// Set up the tree view
cardFilter = new TreeModelFilter (cardListStore, null);
cardFilter.VisibleFunc = new TreeModelFilterVisibleFunc (FilterCards);
cardSort = new TreeModelSort (cardFilter);
cardTreeView.Model = cardSort;

I want to have a get a context menu specific for each row when I
right-click on it. My click handler looks something like this:

[GLib.ConnectBeforeAttribute]
void HandleCardTreeViewButtonPressEvent (object o, ButtonPressEventArgs args)
{
 if (args.Event.Button != 3)
  return;

 TreePath path;
 // If right click on empty space
 if (!cardTreeView.GetPathAtPos (Convert.ToInt32 (args.Event.X),
                                 Convert.ToInt32 (args.Event.Y),
                                 out path)) {
  MakeCardEmptySpaceContextMenu ().Popup ();
  return;
 }

 TreeIter iter;
 if (!cardListStore.GetIter (out iter, path))
  return;

 Card card = (Card) cardListStore.GetValue (iter, 0);

 MakeCardContextMenu (card, iter).Popup ();
}

This works when the ListStore is not filtered or sorted. But when it
is, it gives the wrong row.

For example, say the rows look like this before they are sorted:

A
B
C

And after they are sorted, they look like this:

B
A
C

Right-clicking on the second row (&quot;A&quot;) will give you &quot;B&quot;, because
that's where B was before the model was sorted. The same thing happens
for filtering. Say the model, after it is filtered, looks like this:

A
C

Right-clicking on the second row (&quot;C&quot;) would still give you &quot;B&quot;.

Any idea how to work around this?
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010091.html">[Gtk-sharp-list] Strange Exceptioon in WebKit.WebView
</A></li>
	<LI>Next message: <A HREF="010095.html">[Gtk-sharp-list] Problem getting a TreePath from a	TreeModelSort by x and y coords
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10092">[ date ]</a>
              <a href="thread.html#10092">[ thread ]</a>
              <a href="subject.html#10092">[ subject ]</a>
              <a href="author.html#10092">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
