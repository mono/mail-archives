<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Handling errors when generating binding	code	for asynchronous APIs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Handling%20errors%20when%20generating%20binding%0A%09code%09for%20asynchronous%20APIs&In-Reply-To=1202653671.8450.110.camel%40schtrumpf">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008416.html">
   <LINK REL="Next"  HREF="008418.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Handling errors when generating binding	code	for asynchronous APIs</H1>
    <B>Mike Kestner</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Handling%20errors%20when%20generating%20binding%0A%09code%09for%20asynchronous%20APIs&In-Reply-To=1202653671.8450.110.camel%40schtrumpf"
       TITLE="[Gtk-sharp-list] Handling errors when generating binding	code	for asynchronous APIs">mkestner at gmail.com
       </A><BR>
    <I>Sun Feb 10 11:30:58 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008416.html">[Gtk-sharp-list] Handling errors when generating binding	code	for asynchronous APIs
</A></li>
        <LI>Next message: <A HREF="008418.html">[Gtk-sharp-list] Handling errors when generating binding	code	for asynchronous APIs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8417">[ date ]</a>
              <a href="thread.html#8417">[ thread ]</a>
              <a href="subject.html#8417">[ subject ]</a>
              <a href="author.html#8417">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Sun, 2008-02-10 at 15:27 +0100, Philip Van Hoof wrote:

&gt;<i> The GError based error being passed to the callback (which in C is a
</I>&gt;<i> function pointer typedeffed as TnyGetMsgCallback) is not being converted
</I>&gt;<i> to an Exception type.
</I>
First, I'm not convinced there's a real advantage to using an exception
for this.  Throwing it is only going to result in the program exiting in
the virtual method marshaler's try/catch or if the user has connected to
GLib.ExceptionManager they'll get the exception there.  So throwing the
exception would just be additional overhead since they can just call the
error handler directly from the method implementation itself.

&gt;<i> My goal is to wrap the &quot;IntPtr err&quot; (which is the GError pointer in C)
</I>&gt;<i> with a factory's Create method that will create me the right managed
</I>&gt;<i> exception:
</I>&gt;<i> 
</I>&gt;<i> public class Tny.ExceptionFactory
</I>&gt;<i> {
</I>&gt;<i> 	static Tny.TException Create (IntPtr gerror) {
</I>&gt;<i> 		// Pseudo, to get the type I'll indeed need to make
</I>&gt;<i> 		// a small piece of glue code in C ...
</I>&gt;<i> 		if (gerror-&gt;type == TNY_ERROR_THIS)
</I>&gt;<i> 			return new Tny.ThisException (gerror);
</I>&gt;<i> 		if (gerror-&gt;type == TNY_ERROR_THAT)
</I>&gt;<i> 			return new Tny.ThatException (gerror);
</I>&gt;<i> 		...
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>
It sounds to me like an error string to enumeration mapping would be
equally as useful.  Regardless, if you are set on creating exceptions
for these, there is already a built in way to hook in a marshaling
method like the above to GAPI.

You will need to alter the type of the parameter to something GAPI
doesn't handle automatically, like TError, using metadata.  Also using
metadata, you need to add a generatable mapping for TError.  Two
possibilities are:

&lt;symbol type=&quot;manual&quot; cname=&quot;TError&quot; name=&quot;Tny.Error&quot;/&gt;&lt;/add-node&gt;

This assumes the existence of a Tny.Error type which has an IntPtr
Handle prop to marshal to native and a static Tny.Error New (IntPtr)
method to marshal from native.

As an alternative you could use MarshalGen via:

&lt;symbol type=&quot;marshal&quot; cname=&quot;GdkEvent&quot; name=&quot;Gdk.Event&quot;
marshal_type=&quot;IntPtr&quot; call_fmt=&quot;{0}.Handle&quot; from_fmt=&quot;Gdk.Event.GetEvent
({0})&quot; /&gt;

Which gives a bit more control over the way you implement your
marshaler.

You can add either of the above symbols to your API file with an
add-node rule in metadata:

&lt;add-node path=&quot;/api&quot;&gt;...

Mike



</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008416.html">[Gtk-sharp-list] Handling errors when generating binding	code	for asynchronous APIs
</A></li>
	<LI>Next message: <A HREF="008418.html">[Gtk-sharp-list] Handling errors when generating binding	code	for asynchronous APIs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8417">[ date ]</a>
              <a href="thread.html#8417">[ thread ]</a>
              <a href="subject.html#8417">[ subject ]</a>
              <a href="author.html#8417">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
