<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Sorting a TreeView with a filter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Sorting%20a%20TreeView%20with%20a%20filter&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008979.html">
   <LINK REL="Next"  HREF="008975.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Sorting a TreeView with a filter</H1>
    <B>Adam Tauno Williams</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20Sorting%20a%20TreeView%20with%20a%20filter&In-Reply-To="
       TITLE="[Gtk-sharp-list] Sorting a TreeView with a filter">awilliam at whitemice.org
       </A><BR>
    <I>Fri Sep 12 08:13:46 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="008979.html">[Gtk-sharp-list] Sorting a NodeStore/NodeView
</A></li>
        <LI>Next message: <A HREF="008975.html">[Gtk-sharp-list] Sorting a TreeView with a filter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8973">[ date ]</a>
              <a href="thread.html#8973">[ thread ]</a>
              <a href="subject.html#8973">[ subject ]</a>
              <a href="author.html#8973">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a rather complicated TreeView using a ListStore.  Filtering the
view works,  but I'm so far unable to get sorting to work.  I have a
sort object connected to the model and the filter object connected to
the sort object;  I'm found very similair constructs in other projects
(including Galaxium
&lt;<A HREF="http://code.google.com/p/galaxium/source/browse/trunk/src/Galaxium.Gui.Gtk/NewTreeView/GalaxiumTreeView.cs?r=551">http://code.google.com/p/galaxium/source/browse/trunk/src/Galaxium.Gui.Gtk/NewTreeView/GalaxiumTreeView.cs?r=551</A>&gt;) but it just doesn't sort.  My column-header-click happens when a column gets clicked but it doesn't sort,  the actual sort method never gets pinged.  Despite beng connect-before Gtk seems to be doing something before my column-header-clicked gets called.   Any pointers appreciated. 

What happens when a column header is clicked:
(Whitemice.Consonance:20431): Gtk-CRITICAL **:
gtk_tree_sortable_get_sort_column_id: assertion `GTK_IS_TREE_SORTABLE
(sortable)' failed
(Whitemice.Consonance:20431): Gtk-CRITICAL **:
gtk_tree_sortable_has_default_sort_func: assertion `GTK_IS_TREE_SORTABLE
(sortable)' failed
(Whitemice.Consonance:20431): Gtk-CRITICAL **:
gtk_tree_sortable_set_sort_column_id: assertion `GTK_IS_TREE_SORTABLE
(sortable)' failed
ColumnClicked
Sort Column:4 Order:Ascending

The actual sort method never gets called

&lt;object&gt;

      TreeView view;
      ListStore taskStore;
      TreeModelSort sortAdapter;
      TreeModelFilter  taskFilter;
		  int             sortColumn;
		  SortType        sortOrder;

    &lt;ctor&gt;
			taskStore = new Gtk.ListStore();
		  ...
			objectIdColumn = new Gtk.TreeViewColumn ();
			objectIdColumn.Title = &quot;Object Id&quot;;
			objectIdColumn.Reorderable = true;
			objectIdColumn.Resizable = true;
			objectIdColumn.Clickable = true;
			cell = new Gtk.CellRendererText ();
			objectIdColumn.PackStart(cell, true);
			objectIdColumn.SetCellDataFunc(cell, new
Gtk.TreeCellDataFunc(RenderObjectId));
			objectIdColumn.SortColumnId = 0;
			objectIdColumn.Clicked += new EventHandler(ColumnClicked);
			view.AppendColumn(objectIdColumn);
      ...
		  sortAdapter = new TreeModelSort(taskStore);
		  sortAdapter.SetSortFunc(-2, OrderTasks);
			taskFilter = new TreeModelFilter(sortAdapter, null);
			taskFilter.VisibleFunc = new
Gtk.TreeModelFilterVisibleFunc(TaskFilter);
			view.Model = taskFilter;
    &lt;/ctor&gt;

		[GLib.ConnectBefore]
		protected void ColumnClicked(object sender, EventArgs args)
		{
		  TreeViewColumn column;

      Console.WriteLine(&quot;ColumnClicked&quot;);
		  if (sender is Gtk.TreeViewColumn)
		  {
		    column = (sender as Gtk.TreeViewColumn);
		    if (column.SortColumnId == sortColumn)
		    {
		      if (sortOrder == SortType.Ascending)
		        sortOrder = SortType.Descending;
		      else sortOrder = SortType.Ascending;
		      column.SortOrder = sortOrder;
		      column.SortIndicator = true;
		    } else 
		      {
		        sortColumn = column.SortColumnId;
		        sortOrder = SortType.Ascending;
		        column.SortIndicator = true;
		      }
		    Console.WriteLine(&quot;Sort Column:{0} Order:{1}&quot;, sortColumn,
sortOrder);
		    sortAdapter.SetSortColumnId(sortColumn, sortOrder);
		    sortAdapter.ChangeSortColumn ();
		  }
		} // end ColumnClicked
		
protected int OrderTasks(TreeModel model, TreeIter t1, TreeIter t2)
{ 
//  ObjectId	0   Title 1     Project	2   Start	3
//  Creator	4   Status 5 Priority 6 End 7
//  Executant	8 Completed	9
Console.WriteLine(&quot;SimpleTaskList.OrderTasks&quot;);
 return 0;
}
    ...
&lt;/object&gt;

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008979.html">[Gtk-sharp-list] Sorting a NodeStore/NodeView
</A></li>
	<LI>Next message: <A HREF="008975.html">[Gtk-sharp-list] Sorting a TreeView with a filter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8973">[ date ]</a>
              <a href="thread.html#8973">[ thread ]</a>
              <a href="subject.html#8973">[ subject ]</a>
              <a href="author.html#8973">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
