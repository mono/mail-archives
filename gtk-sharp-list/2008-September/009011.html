<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] pinvoke and benchmarks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20pinvoke%20and%20benchmarks&In-Reply-To=48CA894D.9000105%40opengeomap.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009008.html">
   <LINK REL="Next"  HREF="008962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] pinvoke and benchmarks</H1>
    <B>Michael Hutchinson</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%20pinvoke%20and%20benchmarks&In-Reply-To=48CA894D.9000105%40opengeomap.org"
       TITLE="[Gtk-sharp-list] pinvoke and benchmarks">m.j.hutchinson at gmail.com
       </A><BR>
    <I>Tue Sep 16 23:02:59 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="009008.html">[Gtk-sharp-list] pinvoke and benchmarks
</A></li>
        <LI>Next message: <A HREF="008962.html">[Gtk-sharp-list]  Continer in Combo Box
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9011">[ date ]</a>
              <a href="thread.html#9011">[ thread ]</a>
              <a href="subject.html#9011">[ subject ]</a>
              <a href="author.html#9011">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Sep 12, 2008 at 11:22 AM, Martin (OpenGeoMap)
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">martin at opengeomap.org</A>&gt; wrote:
&gt;<i> Hi:
</I>&gt;<i>
</I>&gt;<i> Someone knows about the performance in a library used only with c# or
</I>&gt;<i> used thanks to other C API???
</I>&gt;<i>
</I>&gt;<i> I am working in a bindings to mono and .NET in c# for lidar data and i
</I>&gt;<i> see my program really really slowly in relationship with the C API.
</I>&gt;<i> We have created a C++ libvrary and a C API to used it with mono and python:
</I>&gt;<i> <A HREF="http://liblas.org/">http://liblas.org/</A>
</I>&gt;<i>
</I>&gt;<i> is it better used a library only created with C or the pinvoke is fast???
</I>&gt;<i> In my imagination i see the pinvoke system trying to find a funtion
</I>&gt;<i> every time and if i have 10 million of lidar data perhaps this is really
</I>&gt;<i> slowly....
</I>
The function lookup will only take place once for each function, so
you don't need to worry about that. However, AFAIK P/Invoke will cost
you somewhere around 50 cycles each time you cross the
managed/unmanaged boundary (for handling the managed stack,
exceptions, thread aborts etc), plus whatever it takes to marshal the
data strcutures in the arguments/return values. For this reason, you
should minimise managed/unmanaged transitions. It's often much faster
if you reimplement smaller methods in C#.

Another trick is zero-marshalling P/Invoke -- with a single call you
can pass over an IntPtr to a struct, then use unsafe (but still C#)
code to dereference and access the struct 's members directly. Note
that this only works for value types, i.e. not classes.

Looking at your LASPoint class, it looks like accessing every
property's getter/setter would cause a managed/unmanaged/managed
transition. If this is your primitive data type, it might be better to
use a struct for the LASPoint in the C API.

I imagine you'd get the best performance (and API) just by porting all
of libLAS to C#...

&gt;<i> Perhaps the C++ managed language is better than c# to create bindings:
</I>&gt;<i> <A HREF="http://msdn.microsoft.com/en-us/library/ms235281(VS.80">http://msdn.microsoft.com/en-us/library/ms235281(VS.80</A>).aspx
</I>&gt;<i>
</I>&gt;<i> , but i don&#180;t see the c++ in mono....
</I>&gt;<i> <A HREF="http://www.mono-project.com/Languages">http://www.mono-project.com/Languages</A>
</I>
There are a number of issues with implementing C++/CLI for Mono.
Firstly, implementing a C++ compiler isn't easy. Also, C++/CLI
normally produces &quot;mixed-mode&quot; assemblies that contain managed *and*
unmanaged code. Unmanaged code, of course, is not portable across
platforms. Mono can handle mixed-mode assemblies, but *only* on
Windows (or Wine).

Another option would be to use the MS C++/CLI compiler to generate
&quot;verifiable&quot; managed assemblies:
<A HREF="http://msdn.microsoft.com/en-us/library/85344whh(VS.80">http://msdn.microsoft.com/en-us/library/85344whh(VS.80</A>).aspx In theory
these would run on Mono, since they cannot contain any unmanaged code.
As with porting the C++ code to C#, this might well be the fastest
option. You could even decompile it to C# using reflector ;-)

-- 
Michael Hutchinson
<A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009008.html">[Gtk-sharp-list] pinvoke and benchmarks
</A></li>
	<LI>Next message: <A HREF="008962.html">[Gtk-sharp-list]  Continer in Combo Box
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9011">[ date ]</a>
              <a href="thread.html#9011">[ thread ]</a>
              <a href="subject.html#9011">[ subject ]</a>
              <a href="author.html#9011">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
