<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] 64bit Gtk# for windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%2064bit%20Gtk%23%20for%20windows&In-Reply-To=1221671505.3737.21.camel%40linux-wpou.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009025.html">
   <LINK REL="Next"  HREF="009026.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] 64bit Gtk# for windows</H1>
    <B>Jaroslav &#352;m&#237;d</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=%5BGtk-sharp-list%5D%2064bit%20Gtk%23%20for%20windows&In-Reply-To=1221671505.3737.21.camel%40linux-wpou.site"
       TITLE="[Gtk-sharp-list] 64bit Gtk# for windows">dataman64bit at gmail.com
       </A><BR>
    <I>Wed Sep 17 19:48:18 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="009025.html">[Gtk-sharp-list] 64bit Gtk# for windows
</A></li>
        <LI>Next message: <A HREF="009026.html">[Gtk-sharp-list] 64bit Gtk# for windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9024">[ date ]</a>
              <a href="thread.html#9024">[ thread ]</a>
              <a href="subject.html#9024">[ subject ]</a>
              <a href="author.html#9024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mike Kestner wrote:
&gt;<i> On Wed, 2008-09-17 at 18:25 +0200, Jaroslav &#352;m&#237;d wrote:
</I>&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yeah, sorry for that ... I'm already compilling GtkSharp assemblies
</I>&gt;&gt;<i> (sources are from SVN repo) on Windows x64 platform using my custom
</I>&gt;&gt;<i> makefiles. I've got glib-sharp, Mono.Cairo, pango-sharp, atk-sharp,
</I>&gt;&gt;<i> gdk-sharp and gtk-sharp already compiled - now it is time for gtkdotnet,
</I>&gt;&gt;<i> glade-sharp and maybe something else. I will upload it all tomorrow and
</I>&gt;&gt;<i> post a link here. I can provide those makefiles, but I doubt you want
</I>&gt;&gt;<i> them as you no longer want to support windows makefiles (stated in
</I>&gt;&gt;<i> /makefile.win32 in SVN).
</I>&gt;&gt;<i>      
</I>&gt;<i>
</I>&gt;<i> The reason we don't support win32 specific makefiles any more is because
</I>&gt;<i> we improved the automake-based build to the point it would support
</I>&gt;<i> win32.  So we want to support win32 make, just not via a redundant make
</I>&gt;<i> system which quickly gets out of date because it is not used regularly
</I>&gt;<i> in the development of the binding.
</I>&gt;<i>
</I>&gt;<i> Congrats on the progress.  The main &quot;extraordinary&quot; things you want to
</I>&gt;<i> keep in mind while building win64 assemblies are the following:
</I>&gt;<i>
</I>&gt;<i> You will need to have a -define:WIN64LONGS in your generator build.
</I>&gt;<i> That is the &quot;platform-specific&quot; piece of the assembly build which is
</I>&gt;<i> needed to adapt to win64 longs not being the same size as a pointer as
</I>&gt;<i> on other 64 bit platforms.  If you didn't define that in your generator
</I>&gt;<i> build, you will need to regenerate the sources for your assemblies once
</I>&gt;<i> it's been rebuilt.
</I>&gt;<i>
</I>&gt;<i> The other piece is the post-processing step which is performed by
</I>&gt;<i> gapi-cdecl-insert.  This piece could be tricky though, because somebody
</I>&gt;<i> already reported the existing tool does not work on the .Net 2.0 SDK
</I>&gt;<i> tools, and you mentioned that there isn't a 1.X SDK for win64.  The
</I>&gt;<i> purpose of the tool is to convert GLib.CDeclCallbackAttributes into the
</I>&gt;<i> IL necessary to identify callback delegates as CDECL calling convention,
</I>&gt;<i> something which is not possibly by adding standard attributes in .Net
</I>&gt;<i> 1.0.  Since we generate .Net 1.x compatible code in GAPI, we can't use
</I>&gt;<i> the 2.0 attribute to do this, so we have to disassembly the il, insert
</I>&gt;<i> the appropriate code, and then reassemble the assembly.
</I>&gt;<i>
</I>&gt;<i> My suspicion is that it might end up being easier to &quot;cross-compile&quot; the
</I>&gt;<i> assemblies on win32 against a 1.x SDK but add some configuration magic
</I>&gt;<i> to force the -define:WIN64LONGS bit.  The resulting assemblies should
</I>&gt;<i> then be copy deployable to win64.
</I>&gt;<i>
</I>&gt;<i> Mike
</I>&gt;<i>
</I>&gt;<i>    
</I>You are doing definitely doing something wrong. My error was due to 
GtkSharp bad understanding of gsize type present in glib. gsize in glib 
is typedefed to ulong ONLY when sizeof(long) == sizeof(size_t). But on 
64bit windows, where sizeof(size_t) and sizeof(long) are different, 
gsize is defined as unsigned long long of size equal to size of pointer 
but you suppose it is the same size as long. Therefore generator should 
not generate this on Win64:
internal delegate byte TextBufferSerializeFuncNative(IntPtr 
register_buffer, IntPtr content_buffer, IntPtr start, IntPtr end, out 
uint length, IntPtr user_data);
but
internal delegate byte TextBufferSerializeFuncNative(IntPtr 
register_buffer, IntPtr content_buffer, IntPtr start, IntPtr end, out 
long length, IntPtr user_data);

because length argument in gtk_text_buffer_serialize is gsize, not long!
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009025.html">[Gtk-sharp-list] 64bit Gtk# for windows
</A></li>
	<LI>Next message: <A HREF="009026.html">[Gtk-sharp-list] 64bit Gtk# for windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9024">[ date ]</a>
              <a href="thread.html#9024">[ thread ]</a>
              <a href="subject.html#9024">[ subject ]</a>
              <a href="author.html#9024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
