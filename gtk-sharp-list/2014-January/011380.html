<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] MailMessage class does not work in Linux,	but if Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=Re%3A%20%5BGtk-sharp-list%5D%20MailMessage%20class%20does%20not%20work%20in%20Linux%2C%0A%09but%20if%20Windows&In-Reply-To=%3CCANgiXaS7WGDC%3DbnX8N%2B9yHOTybMo3HRWSaWENpZbsewX_GSvSw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011378.html">
   <LINK REL="Next"  HREF="011381.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] MailMessage class does not work in Linux,	but if Windows</H1>
    <B>Adrian Eric</B> 
    <A HREF="mailto:gtk-sharp-list%40lists.ximian.com?Subject=Re%3A%20%5BGtk-sharp-list%5D%20MailMessage%20class%20does%20not%20work%20in%20Linux%2C%0A%09but%20if%20Windows&In-Reply-To=%3CCANgiXaS7WGDC%3DbnX8N%2B9yHOTybMo3HRWSaWENpZbsewX_GSvSw%40mail.gmail.com%3E"
       TITLE="[Gtk-sharp-list] MailMessage class does not work in Linux,	but if Windows">adrianeric40 at gmail.com
       </A><BR>
    <I>Fri Jan 17 21:05:23 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="011378.html">[Gtk-sharp-list] Modifying gtkrc for windows not working properly
</A></li>
        <LI>Next message: <A HREF="011381.html">[Gtk-sharp-list] MailMessage class does not work in Linux,	but if Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11380">[ date ]</a>
              <a href="thread.html#11380">[ thread ]</a>
              <a href="subject.html#11380">[ subject ]</a>
              <a href="author.html#11380">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can someone please tell me why the code below with doing well in Windows but
not in Linux?

In linux generate the error &quot;Message could not be sent.&quot;!!!. but not give
me more details.

First I thought the problem was the attachment, tried to remove these lines
of code but the problem persists.

from already thank you very much.

Saludos y muchas gracias!!.


public class enviar_email
    {
        Window ventana;

        public enviar_email(string[] para, string[] cc, string[] cco,
                            string asunto, string mensaje, string
caminoAdjunto,
                            string tipoDeDato, out bool enviadoOK)
        {
            //determino los datos del usuario
            DataTableReader reader = new
DataTableReader(MainWindow.tablaUsuarioActual);
            reader.Read();
            uint IdUsuario =  uint.Parse(reader[&quot;IdUsuario&quot;].ToString());
            string email_rtte = reader[&quot;email&quot;].ToString();
            string usuario_casilla = reader[&quot;usuarioEmail&quot;].ToString();
            string contrase&#241;a_casilla =
reader[&quot;contraseniaEmail&quot;].ToString();
            string servidorSMTP = reader[&quot;servidor_salida&quot;].ToString();
            string servidorAutentic =
reader[&quot;servidor_autenticacion&quot;].ToString();

            //verifico que existan los datos de usuario p/poder enviar
            if(email_rtte.Length == 0 | usuario_casilla.Length == 0 |
contrase&#241;a_casilla.Length == 0
               | servidorSMTP.Length == 0 | servidorAutentic.Length == 0)
            {
                muestraDialogo msjErrorEmail = new muestraDialogo(&quot;Falta
configuraci&#243;n&quot;, &quot;Los datos de configuraci&#243;n necesarios para enviar&quot; +
                                                                  &quot;\ncorreo
electr&#243;nico no estan completos. Dir&#237;jase a 'Configuraci&#243;n-Usuarios'&quot; +
                                                                  &quot;\npara
completar los datos faltantes.&quot;, MessageType.Warning);
                enviadoOK = false;
                return;

            }

            MailMessage mailMensaje = new MailMessage();
            mailMensaje.From = new MailAddress(email_rtte);

            if(para[0]!= &quot;vacio&quot;)
            {
                foreach(string Para in para )
                {
                    MailAddress mailAddressPara = new MailAddress(Para);
                    mailMensaje.To.Add(mailAddressPara);
                }

            }

            if(cc.Length != 0)
            {
                foreach(string conCopia in cc )
                {
                    if(conCopia == &quot;&quot;)
                        break;
                    MailAddress mailAddressCC = new MailAddress(conCopia);
                    mailMensaje.CC.Add(mailAddressCC);
                }

            }

            if(cco.Length != 0)
            {
                foreach(string conCopiaOculta in cco )
                {
                    if(conCopiaOculta == &quot;&quot;)
                        break;
                    MailAddress mailAddressCCO = new
MailAddress(conCopiaOculta);
                    mailMensaje.Bcc.Add(mailAddressCCO);
                }

            }


            //aislo el nombre del adjunto del camino pasado a la clase
            char caracterSeparador =
(MainWindow.separadorDir.ToCharArray())[0];
            int indiceFinal = caminoAdjunto.LastIndexOf(caracterSeparador);
            string nombreArchivo = caminoAdjunto.Substring(indiceFinal+1,
caminoAdjunto.Length-(indiceFinal+1));

            mailMensaje.Subject = asunto;
            Attachment adjunto = new Attachment(caminoAdjunto);
            mailMensaje.Attachments.Add(adjunto);

            //con la linea siguiente configuro la opcion de la confirmacion
de lectura
            //y a que direccion debera enviar dicha confirmacion
            mailMensaje.Headers.Add(&quot;Disposition-Notification-To&quot;,
usuario_casilla);
            SmtpClient cliente = new SmtpClient(servidorAutentic, 25);
            cliente.Credentials = new
System.Net.NetworkCredential(usuario_casilla, contrase&#241;a_casilla);


            try
            {
                cliente.Send(mailMensaje);

            }
            catch (SmtpException ex)
            {
                muestraDialogo dialogoError = new muestraDialogo(&quot;Error en
env&#237;o de e-mail&quot;,
                                                                 &quot;Hubo un
error en el intento de env&#237;o &quot; +
                                                                 &quot;del
correo electronico.&quot; +
                                                                 &quot;\nPor
favor pongase en contacto con el administrador&quot; +
                                                                 &quot;\ndel
sistema y comentele del error recibido.&quot; +
                                                                 &quot;\nMensaje
del error: &quot; + ex.Message,

MessageType.Error);
                enviadoOK = false;
                mailMensaje.Dispose();
                bool eliminado;
                EliminarArchivo eliminarFile = new
EliminarArchivo(caminoAdjunto, out eliminado);

                return;
            }

            MessageDialog dialogo = new
MessageDialog(ventana,DialogFlags.Modal, MessageType.Info,
                                                          ButtonsType.Ok,
&quot;El correo se envi&#243; satisfactoriamente.&quot;);
                dialogo.UseMarkup = true;
                dialogo.Title = &quot;&lt;b&gt;Informe de env&#237;o&lt;/b&gt;&quot;;
                dialogo.WindowPosition = WindowPosition.Center;
                dialogo.Run();
                dialogo.Hide();
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20140117/647774af/attachment.html">http://lists.ximian.com/pipermail/gtk-sharp-list/attachments/20140117/647774af/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011378.html">[Gtk-sharp-list] Modifying gtkrc for windows not working properly
</A></li>
	<LI>Next message: <A HREF="011381.html">[Gtk-sharp-list] MailMessage class does not work in Linux,	but if Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11380">[ date ]</a>
              <a href="thread.html#11380">[ thread ]</a>
              <a href="subject.html#11380">[ subject ]</a>
              <a href="author.html#11380">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">More information about the Gtk-sharp-list
mailing list</a><br>
</body></html>
