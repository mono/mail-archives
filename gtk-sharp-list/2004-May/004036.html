<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Using Pango to layout text oustise of GTK+
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:petermeyer99%40hotmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="004035.html">
   <LINK REL="Next"  HREF="004037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Using Pango to layout text oustise of GTK+
   </H1>
    <B>Peter Meyer
    </B> 
    <A HREF="mailto:petermeyer99%40hotmail.com"
       TITLE="[Gtk-sharp-list] Using Pango to layout text oustise of GTK+">petermeyer99@hotmail.com
       </A><BR>
    <I>Mon, 10 May 2004 03:25:28 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="004035.html">[Gtk-sharp-list] Trying to use GConf, and it wants a slash
</A></li>
        <LI> Next message: <A HREF="004037.html">[Gtk-sharp-list] DllNotFoundException libgtk-win32-2.0-0.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4036">[ date ]</a>
              <a href="thread.html#4036">[ thread ]</a>
              <a href="subject.html#4036">[ subject ]</a>
              <a href="author.html#4036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&lt;html&gt;&lt;div style='background-color:'&gt;&lt;DIV class=RTE&gt;Hi,&lt;/DIV&gt;
&lt;DIV class=RTE&gt;I am looking to use Pnago with a .NET application that uses WindowsForms as its UI layer. I thought I might be able to use GTK# as a wrapper for Pango in order to avoid to have to wrap it all for myself.&lt;/DIV&gt;
&lt;DIV class=RTE&gt;When I looked at GTK# I realized that the functions from the Pango win32 library are not mapped through GTK#. That is, there is no means to create a context or layout without getting the context from the GTK Widget, and no means to call the render functions that simply use an HDC (the Pango render functions are called as part of the GTK drawing).&lt;/DIV&gt;
&lt;DIV class=RTE&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV class=RTE&gt;So I tried the following, which doesn't work...&lt;/DIV&gt;
&lt;DIV class=RTE&gt;&amp;nbsp;&lt;/DIV&gt;
&lt;DIV class=RTE&gt;To get a context, I explicitly wrapped pango_win32_get_context via P/Invoke:&lt;/DIV&gt;
&lt;DIV class=RTE&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/DIV&gt;
&lt;DIV class=RTE&gt;&lt;PRE&gt;using Pango;&lt;/PRE&gt;&lt;PRE&gt;[DllImport(path+&quot;libpangowin32-1.0-0.dll&quot;, EntryPoint=&quot;pango_win32_get_context&quot;)]&lt;/PRE&gt;&lt;/DIV&gt;&lt;PRE class=RTE&gt;private static extern IntPtr PangoWin32GetContext();&lt;/PRE&gt;&lt;PRE class=RTE&gt;&lt;FONT color=#0000ff size=2&gt;&lt;P&gt;static&lt;/FONT&gt;&lt;FONT size=2&gt; &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;public&lt;/FONT&gt;&lt;FONT size=2&gt; Pango.Context CreateContext()&lt;/P&gt;&lt;P&gt;{&lt;/P&gt;&lt;P&gt;	IntPtr p = PangoWin32GetContext();&lt;/P&gt;&lt;P&gt;	Context c = &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;new&lt;/FONT&gt;&lt;FONT size=2&gt; Context(p);&lt;/P&gt;&lt;P&gt;	c.Language = Language.FromString(&quot;en_US&quot;);&lt;/P&gt;&lt;P&gt;	c.BaseDir = Pango.Direction.Ltr;&lt;/P&gt;&lt;P&gt;	FontDescription f = &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;new&lt;/FONT&gt;&lt;FONT size=2&gt; FontDescription();&lt;/P&gt;&lt;P&gt;	f.Family = &quot;TrebuchetMS&quot;;&lt;/P&gt;&lt;P&gt;	f.Style = Style.Normal;&lt;/P&gt;&lt;P&gt;	f.Variant = Variant.Normal;&lt;/P&gt;&lt;P&gt;	f.Weight = Weight.Normal;&lt;/P&gt;&lt;P&gt;	f.Size = (&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;int&lt;/FONT&gt;&lt;FONT size=2&gt;) (16 * Pango.Scale.PangoScale);&lt;/P&gt;&lt;P&gt;	f.Stretch = Stretch.Normal;&lt;/P&gt;&lt;P&gt;	c.FontDescription = f;&lt;/P&gt;&lt;P&gt;&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;	return&lt;/FONT&gt;&lt;FONT size=2&gt; c;&lt;/P&gt;&lt;P&gt;}&lt;/FONT&gt;&lt;/P&gt;&lt;/PRE&gt;&lt;PRE class=RTE&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/PRE&gt;
&lt;P class=RTE&gt;Then I create a Layout object as follows:&lt;/P&gt;
&lt;P class=RTE&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/P&gt;&lt;PRE class=RTE&gt;&lt;FONT size=2&gt;&lt;P&gt;SimplePangoWrapper.Init();&lt;/P&gt;&lt;P&gt;Context c = SimplePangoWrapper.CreateContext();&lt;/P&gt;&lt;P&gt;layout = &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;new&lt;/FONT&gt;&lt;FONT size=2&gt; Layout(c);&lt;/P&gt;&lt;P&gt;layout.Wrap = Pango.WrapMode.Word;&lt;/P&gt;&lt;P&gt;layout.FontDescription = FontDescription.FromString (&quot;TrebuchetMS 12&quot;);&lt;/P&gt;&lt;P&gt;layout.SetMarkup (&quot;Hello Pango.Layout&quot;);&lt;/P&gt;&lt;/FONT&gt;&lt;/PRE&gt;&lt;PRE class=RTE&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/PRE&gt;
&lt;P class=RTE&gt;SimplePangoWrapper.Init() calls the g_type_init() function in libgobject that otherwise would not be called, as I am not using any other part of GTK.&lt;/P&gt;
&lt;P class=RTE&gt;Then, in the OnPaint event handler of my Form, I call:&lt;/P&gt;
&lt;P class=RTE&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/P&gt;&lt;FONT size=2&gt;&lt;PRE&gt;Graphics g = e.Graphics;&lt;/PRE&gt;&lt;PRE&gt;g.Clear(System.Drawing.Color.Orange);&lt;/PRE&gt;&lt;PRE&gt;IntPtr hdc = &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;new&lt;/FONT&gt;&lt;FONT size=2&gt; IntPtr();&lt;/PRE&gt;&lt;PRE&gt;hdc = g.GetHdc();&lt;/PRE&gt;&lt;PRE&gt;HandleRef hr = &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;new&lt;/FONT&gt;&lt;FONT size=2&gt; HandleRef(g, hdc);&lt;/PRE&gt;&lt;PRE&gt;&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;try&lt;/FONT&gt;&lt;FONT size=2&gt; &lt;/PRE&gt;&lt;PRE&gt;{&lt;/PRE&gt;&lt;PRE&gt;	SimplePangoWrapper.RenderLayout(hr, layout, 10, 10);&lt;/PRE&gt;&lt;/FONT&gt;&lt;FONT size=2&gt;&lt;PRE&gt;}&lt;/PRE&gt;&lt;PRE&gt;&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;catch&lt;/FONT&gt;&lt;FONT size=2&gt; (Exception ex)&lt;/PRE&gt;&lt;PRE&gt;{&lt;/PRE&gt;&lt;PRE&gt;	Console.WriteLine(ex.ToString());&lt;/PRE&gt;&lt;PRE&gt;}&lt;/PRE&gt;&lt;PRE&gt;&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;finally&lt;/PRE&gt;&lt;/FONT&gt;&lt;FONT size=2&gt;&lt;PRE&gt;{&lt;/PRE&gt;&lt;PRE&gt;	g.ReleaseHdc(hdc);&lt;/PRE&gt;&lt;PRE&gt;}&lt;/PRE&gt;&lt;PRE&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/PRE&gt;
&lt;P&gt;Where RenderLayout is a call to:&lt;/P&gt;
&lt;P&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/P&gt;&lt;/FONT&gt;&lt;FONT size=2&gt;&lt;PRE&gt;[DllImport(path+&quot;libpangowin32-1.0-0.dll&quot;, EntryPoint=&quot;pango_win32_render_layout&quot;)]&lt;/PRE&gt;&lt;PRE&gt;&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;private&lt;/FONT&gt;&lt;FONT size=2&gt; &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;static&lt;/FONT&gt;&lt;FONT size=2&gt; &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;extern&lt;/FONT&gt;&lt;FONT size=2&gt; &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;void&lt;/FONT&gt;&lt;FONT size=2&gt; PangoWin32RenderLayout(HandleRef hdc,&lt;/PRE&gt;&lt;PRE&gt;						  HandleRef layout,&lt;/PRE&gt;&lt;PRE&gt;&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;						  int&lt;/FONT&gt;&lt;FONT size=2&gt; x,&lt;/PRE&gt;&lt;PRE&gt;&lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;						  int&lt;/FONT&gt;&lt;FONT size=2&gt; y);&lt;/FONT&gt;&lt;/PRE&gt;&lt;PRE&gt;&lt;FONT size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/PRE&gt;&lt;FONT size=2&gt;&lt;FONT color=#0000ff size=2&gt;&lt;PRE&gt;static&lt;/FONT&gt;&lt;FONT size=2&gt; &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;public&lt;/FONT&gt;&lt;FONT size=2&gt; &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;void&lt;/FONT&gt;&lt;FONT size=2&gt; RenderLayout(HandleRef hr, Layout layout, &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;int&lt;/FONT&gt;&lt;FONT size=2&gt; x, &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;int&lt;/FONT&gt;&lt;FONT size=2&gt; y)&lt;/PRE&gt;&lt;PRE&gt;{&lt;/PRE&gt;&lt;/FONT&gt;&lt;FONT size=2&gt;&lt;PRE&gt;	HandleRef hL = &lt;/FONT&gt;&lt;FONT color=#0000ff size=2&gt;new&lt;/FONT&gt;&lt;FONT size=2&gt; HandleRef(layout, layout.Handle);&lt;/FONT&gt;&lt;FONT color=#008000 size=2&gt;&lt;/PRE&gt;&lt;/FONT&gt;&lt;FONT size=2&gt;&lt;PRE&gt;	PangoWin32RenderLayout(hr, hL, x, y);&lt;/PRE&gt;&lt;PRE&gt;}&lt;/PRE&gt;&lt;PRE&gt;&lt;IMG height=2 src=&quot;<A HREF="http://graphics.hotmail.com/greypixel.gif"">http://graphics.hotmail.com/greypixel.gif&quot;</A> width=&quot;100%&quot; vspace=9&gt;&lt;/PRE&gt;
&lt;P&gt;So far so good. As far as I can tell in the debugger, the Layout object is created in a reasonable way and contains reasonable data. The hdc is correct and works when trying other hdc functions. Unfortunately, the call to pango_win32_Render_layout fails with a null pointer exception somewhere in the pango library, as far as I can tell.&lt;/P&gt;
&lt;P&gt;I don't know how to build a debug version of the pango library to work with GTKSharp. Is there any quick tip or hint someone can offer me how to make this work? Or is there a fundamental reason why it can't work?&lt;/P&gt;
&lt;P&gt;Thanks a lot!&lt;/P&gt;
&lt;P&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; PM&lt;/P&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/div&gt;&lt;br clear=all&gt;&lt;hr&gt;Enjoy 25MB of inbox storage and 10MB per file attachment  &lt;a href=&quot;<A HREF="http://g.msn.com/8HMAENCA/2746??PS=47575"">http://g.msn.com/8HMAENCA/2746??PS=47575&quot;</A>&gt;With MSN Premium &lt;/a&gt; Get 2 Months FREE* &lt;/html&gt;

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="004035.html">[Gtk-sharp-list] Trying to use GConf, and it wants a slash
</A></li>
	<LI> Next message: <A HREF="004037.html">[Gtk-sharp-list] DllNotFoundException libgtk-win32-2.0-0.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4036">[ date ]</a>
              <a href="thread.html#4036">[ thread ]</a>
              <a href="subject.html#4036">[ subject ]</a>
              <a href="author.html#4036">[ author ]</a>
         </LI>
       </UL>
</body></html>
