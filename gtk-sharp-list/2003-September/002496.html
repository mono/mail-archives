<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] GnomePrint patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mwh%40sysrq.dk">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002513.html">
   <LINK REL="Next"  HREF="002497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] GnomePrint patch
   </H1>
    <B>Martin Willemoes Hansen
    </B> 
    <A HREF="mailto:mwh%40sysrq.dk"
       TITLE="[Gtk-sharp-list] GnomePrint patch">mwh@sysrq.dk
       </A><BR>
    <I>Thu, 25 Sep 2003 17:15:54 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="002513.html">[Gtk-sharp-list] Added const-guchar to SymbolTable.cs
</A></li>
        <LI> Next message: <A HREF="002497.html">[Gtk-sharp-list] Pop up Menus
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2496">[ date ]</a>
              <a href="thread.html#2496">[ thread ]</a>
              <a href="subject.html#2496">[ subject ]</a>
              <a href="author.html#2496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-XUcmHdE7TNBPqgsG0iVu
Content-Type: multipart/alternative; boundary=&quot;=-cUMwFa+L61gHk0pDjCdq&quot;


--=-cUMwFa+L61gHk0pDjCdq
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hi!

I found that after adding the const-guchar* in the SymbolChanges two
modifications had to be made to get the build going. I have attached
thoese changes as well as the changes made to make GnomePrintUi use the
right library. The changes from modifying the gnomeprintui c src code is
also attached.

Okay to commit?
-- 
Martin Willemoes Hansen

--------------------------------------------------------
E-Mail	<A HREF="mailto:mwh@sysrq.dk">mwh@sysrq.dk</A>	Website	mwh.sysrq.dk
IRC     MWH, freenode.net
--------------------------------------------------------               


--=-cUMwFa+L61gHk0pDjCdq
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: 7bit

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 TRANSITIONAL//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
  &lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; CHARSET=UTF-8&quot;&gt;
  &lt;META NAME=&quot;GENERATOR&quot; CONTENT=&quot;GtkHTML/3.0.9&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
Hi!&lt;BR&gt;
&lt;BR&gt;
I found that after adding the const-guchar* in the SymbolChanges two modifications had to be made to get the build going. I have attached thoese changes as well as the changes made to make GnomePrintUi use the right library. The changes from modifying the gnomeprintui c src code is also attached.&lt;BR&gt;
&lt;BR&gt;
Okay to commit?&lt;BR&gt;
&lt;TABLE CELLSPACING=&quot;0&quot; CELLPADDING=&quot;0&quot; WIDTH=&quot;100%&quot;&gt;
&lt;TR&gt;
&lt;TD&gt;
&lt;PRE&gt;-- 
Martin Willemoes Hansen

--------------------------------------------------------
E-Mail	<A HREF="mailto:mwh@sysrq.dk">mwh@sysrq.dk</A>	Website	mwh.sysrq.dk
IRC     MWH, freenode.net
--------------------------------------------------------               
&lt;/PRE&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TABLE&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;

--=-cUMwFa+L61gHk0pDjCdq--

--=-XUcmHdE7TNBPqgsG0iVu
Content-Disposition: attachment; filename=GnomePrintChanges.diff
Content-Type: text/x-patch; name=GnomePrintChanges.diff; charset=iso-8859-1
Content-Transfer-Encoding: 7bit

? GnomePrintChanges.diff
Index: ChangeLog
===================================================================
RCS file: /cvs/public/gtk-sharp/ChangeLog,v
retrieving revision 1.475
diff -u -r1.475 ChangeLog
--- ChangeLog	24 Sep 2003 01:36:35 -0000	1.475
+++ ChangeLog	25 Sep 2003 15:25:21 -0000
@@ -1,3 +1,13 @@
+2003-09-25  Martin Willemoes Hansen  &lt;<A HREF="mailto:mwh@sysrq.dk">mwh@sysrq.dk</A>&gt;
+
+	* sources/gtk-sharp.sources: Fixed, wrong library used for libgnomeprintui
+	* api/gnome-api.xml: Ditto
+	* generator/SymbolTable.cs: Added mapping of const-guchar* to string
+	* sources/Gdk.metadata: Added rule to give correct type to 
+	  PixbufLoader.Write buf parameter
+	* sources/Gtk.metadata: Changed rule to give correct type to 
+	  HTMLStream.Write buffer parameter
+
 2003-09-23  John Luke  &lt;<A HREF="mailto:jluke@cfl.rr.com">jluke@cfl.rr.com</A>&gt;
 
 	* README:
Index: api/gdk-api.xml
===================================================================
RCS file: /cvs/public/gtk-sharp/api/gdk-api.xml,v
retrieving revision 1.25
diff -u -r1.25 gdk-api.xml
--- api/gdk-api.xml	16 Sep 2003 18:07:38 -0000	1.25
+++ api/gdk-api.xml	25 Sep 2003 15:25:24 -0000
@@ -4121,7 +4121,7 @@
       &lt;method name=&quot;Write&quot; cname=&quot;gdk_pixbuf_loader_write&quot;&gt;
         &lt;return-type type=&quot;gboolean&quot;/&gt;
         &lt;parameters&gt;
-          &lt;parameter type=&quot;const-guchar*&quot; name=&quot;buf&quot; array=&quot;1&quot;/&gt;
+          &lt;parameter type=&quot;guchar*&quot; name=&quot;buf&quot; array=&quot;1&quot;/&gt;
           &lt;parameter type=&quot;gsize&quot; name=&quot;count&quot;/&gt;
           &lt;parameter type=&quot;GError**&quot; name=&quot;error&quot;/&gt;
         &lt;/parameters&gt;
Index: api/gnome-api.xml
===================================================================
RCS file: /cvs/public/gtk-sharp/api/gnome-api.xml,v
retrieving revision 1.13
diff -u -r1.13 gnome-api.xml
--- api/gnome-api.xml	16 Sep 2003 18:07:38 -0000	1.13
+++ api/gnome-api.xml	25 Sep 2003 15:25:24 -0000
@@ -6258,7 +6258,27 @@
       &lt;/method&gt;
     &lt;/class&gt;
   &lt;/namespace&gt;
-  &lt;namespace name=&quot;Gnome&quot; library=&quot;gnomeprint-2-2&quot;&gt;
+  &lt;namespace name=&quot;Gnome&quot; library=&quot;gnomeprintui-2-2&quot;&gt;
+    &lt;enum name=&quot;PaperSelectorFlags&quot; cname=&quot;GnomePaperSelectorFlags&quot; type=&quot;enum&quot;&gt;
+      &lt;member cname=&quot;GNOME_PAPER_SELECTOR_MARGINS&quot; name=&quot;Margins&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PAPER_SELECTOR_FEED_ORIENTATION&quot; name=&quot;FeedOrientation&quot;/&gt;
+    &lt;/enum&gt;
+    &lt;enum name=&quot;PrintButtons&quot; cname=&quot;GnomePrintButtons&quot; type=&quot;enum&quot;&gt;
+      &lt;member cname=&quot;GNOME_PRINT_DIALOG_RESPONSE_PRINT&quot; name=&quot;Print&quot; value=&quot;1&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PRINT_DIALOG_RESPONSE_PREVIEW&quot; name=&quot;Preview&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PRINT_DIALOG_RESPONSE_CANCEL&quot; name=&quot;Cancel&quot;/&gt;
+    &lt;/enum&gt;
+    &lt;enum name=&quot;PrintDialogFlags&quot; cname=&quot;GnomePrintDialogFlags&quot; type=&quot;enum&quot;&gt;
+      &lt;member cname=&quot;GNOME_PRINT_DIALOG_RANGE&quot; name=&quot;Range&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PRINT_DIALOG_COPIES&quot; name=&quot;Copies&quot;/&gt;
+    &lt;/enum&gt;
+    &lt;enum name=&quot;PrintDialogRangeFlags&quot; cname=&quot;GnomePrintDialogRangeFlags&quot; type=&quot;enum&quot;&gt;
+      &lt;member cname=&quot;GNOME_PRINT_RANGE_CURRENT&quot; name=&quot;Current&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PRINT_RANGE_ALL&quot; name=&quot;All&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PRINT_RANGE_RANGE&quot; name=&quot;Range&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PRINT_RANGE_SELECTION&quot; name=&quot;Selection&quot;/&gt;
+      &lt;member cname=&quot;GNOME_PRINT_RANGE_SELECTION_UNSENSITIVE&quot; name=&quot;SelectionUnsensitive&quot;/&gt;
+    &lt;/enum&gt;
     &lt;enum name=&quot;PrintRangeType&quot; cname=&quot;GnomePrintRangeType&quot; type=&quot;enum&quot;&gt;
       &lt;member cname=&quot;GNOME_PRINT_RANGETYPE_NONE&quot; name=&quot;None&quot;/&gt;
       &lt;member cname=&quot;GNOME_PRINT_RANGETYPE_CUSTOM&quot; name=&quot;Custom&quot;/&gt;
@@ -6578,7 +6598,7 @@
     &lt;/object&gt;
     &lt;struct name=&quot;CanvasHacktextPriv&quot; cname=&quot;GnomeCanvasHacktextPriv&quot; opaque=&quot;true&quot;/&gt;
   &lt;/namespace&gt;
-  &lt;namespace name=&quot;Gnome&quot; library=&quot;gnomeprint-2.2&quot;&gt;
+  &lt;namespace name=&quot;Gnome&quot; library=&quot;gnomeprintui-2.2&quot;&gt;
     &lt;object name=&quot;GPAOptionMenu&quot; cname=&quot;GPAOptionMenu&quot; parent=&quot;GPAWidget&quot;&gt;
       &lt;field cname=&quot;menu&quot; type=&quot;GtkWidget*&quot;/&gt;
       &lt;field cname=&quot;node&quot; type=&quot;GPANode*&quot;/&gt;
Index: api/gtk-api.xml
===================================================================
RCS file: /cvs/public/gtk-sharp/api/gtk-api.xml,v
retrieving revision 1.47
diff -u -r1.47 gtk-api.xml
--- api/gtk-api.xml	20 Sep 2003 02:56:10 -0000	1.47
+++ api/gtk-api.xml	25 Sep 2003 15:25:28 -0000
@@ -14247,7 +14247,7 @@
       &lt;method name=&quot;Write&quot; cname=&quot;gtk_html_stream_write&quot;&gt;
         &lt;return-type type=&quot;void&quot;/&gt;
         &lt;parameters&gt;
-          &lt;parameter type=&quot;const-guchar*&quot; name=&quot;buffer&quot; array=&quot;1&quot;/&gt;
+          &lt;parameter type=&quot;guchar*&quot; name=&quot;buffer&quot; array=&quot;1&quot;/&gt;
           &lt;parameter type=&quot;size_t&quot; name=&quot;size&quot;/&gt;
         &lt;/parameters&gt;
       &lt;/method&gt;
Index: generator/SymbolTable.cs
===================================================================
RCS file: /cvs/public/gtk-sharp/generator/SymbolTable.cs,v
retrieving revision 1.47
diff -u -r1.47 SymbolTable.cs
--- generator/SymbolTable.cs	28 Aug 2003 16:49:29 -0000	1.47
+++ generator/SymbolTable.cs	25 Sep 2003 15:25:28 -0000
@@ -42,6 +42,7 @@
 			// Const returned strings must be generated 
 			// differently from memory-managed strings
 			AddType (new ConstStringGen (&quot;const-gchar&quot;));
+			AddType (new ConstStringGen (&quot;const-guchar&quot;));
 			AddType (new ConstStringGen (&quot;const-char&quot;));
 			AddType (new StringGen (&quot;gchar&quot;));
 			AddType (new SimpleGen (&quot;gfloat&quot;, &quot;float&quot;));
@@ -133,7 +134,11 @@
 			string trim_type = type.TrimEnd('*');
 
 			// HACK: Similar to above, but for const strings
-			if (trim_type == &quot;const-gchar&quot; || trim_type == &quot;const-char&quot;) return trim_type;
+			switch (trim_type) {
+			case &quot;const-gchar&quot;: return trim_type;
+			case &quot;const-guchar&quot;: return trim_type;
+			case &quot;const-char&quot;: return trim_type;
+			}
 			
 			if (trim_type.StartsWith(&quot;const-&quot;)) return trim_type.Substring(6);
 			return trim_type;
Index: sources/Gdk.metadata
===================================================================
RCS file: /cvs/public/gtk-sharp/sources/Gdk.metadata,v
retrieving revision 1.20
diff -u -r1.20 Gdk.metadata
--- sources/Gdk.metadata	16 Sep 2003 18:07:39 -0000	1.20
+++ sources/Gdk.metadata	25 Sep 2003 15:25:28 -0000
@@ -54,6 +54,20 @@
  &lt;/data&gt;
 &lt;/rule&gt;
 
+&lt;!-- type change --&gt;
+&lt;rule&gt;
+  &lt;class name=&quot;GdkPixbufLoader&quot;&gt;
+    &lt;method&gt;Write&lt;/method&gt;
+  &lt;/class&gt;
+  &lt;data&gt;
+    &lt;attribute target=&quot;param&quot;&gt;
+      &lt;filter level=&quot;name&quot;&gt;buf&lt;/filter&gt;
+      &lt;name&gt;type&lt;/name&gt;
+      &lt;value&gt;guchar*&lt;/value&gt;
+    &lt;/attribute&gt;
+  &lt;/data&gt;
+&lt;/rule&gt;
+
 &lt;!-- null args --&gt;
 &lt;rule&gt;
   &lt;class name=&quot;GdkPixmap&quot;&gt;
Index: sources/Gtk.metadata
===================================================================
RCS file: /cvs/public/gtk-sharp/sources/Gtk.metadata,v
retrieving revision 1.62
diff -u -r1.62 Gtk.metadata
--- sources/Gtk.metadata	20 Sep 2003 02:56:10 -0000	1.62
+++ sources/Gtk.metadata	25 Sep 2003 15:25:28 -0000
@@ -467,7 +467,7 @@
     &lt;attribute target=&quot;param&quot;&gt;
       &lt;filter level=&quot;name&quot;&gt;buffer&lt;/filter&gt;
       &lt;name&gt;type&lt;/name&gt;
-      &lt;value&gt;const-guchar*&lt;/value&gt;
+      &lt;value&gt;guchar*&lt;/value&gt;
     &lt;/attribute&gt;
   &lt;/data&gt;
 &lt;/rule&gt;
Index: sources/gtk-sharp.sources
===================================================================
RCS file: /cvs/public/gtk-sharp/sources/gtk-sharp.sources,v
retrieving revision 1.21
diff -u -r1.21 gtk-sharp.sources
--- sources/gtk-sharp.sources	16 Sep 2003 18:07:39 -0000	1.21
+++ sources/gtk-sharp.sources	25 Sep 2003 15:25:28 -0000
@@ -7,8 +7,8 @@
 libgnomecanvas-2.2.1/libgnomecanvas Gnome gnomecanvas-2
 libgnomeui-2.2.2/libgnomeui Gnome gnomeui-2
 libgnomeprint-2.2.1.3/libgnomeprint Gnome gnomeprint-2-2
-libgnomeprintui-2.2.1.3/libgnomeprintui Gnome gnomeprint-2-2
-libgnomeprintui-2.2.1.3/libgnomeprintui/gpaui Gnome gnomeprint-2.2
+libgnomeprintui-2.2.1.3/libgnomeprintui Gnome gnomeprintui-2-2
+libgnomeprintui-2.2.1.3/libgnomeprintui/gpaui Gnome gnomeprintui-2.2
 gtkhtml-3.0.8/src Gtk gtkhtml-3.0
 libglade-2.0.0/glade Glade libglade-2.0-0.dll
 libart_lgpl-2.3.10 Art art_lgpl

--=-XUcmHdE7TNBPqgsG0iVu
Content-Disposition: attachment; filename=gnome-print-dialog.h.diff
Content-Type: text/x-patch; name=gnome-print-dialog.h.diff; charset=iso-8859-1
Content-Transfer-Encoding: 7bit

--- gnome-print-dialog.h.old	2003-09-25 13:05:07.000000000 +0200
+++ gnome-print-dialog.h	2003-09-25 13:06:09.000000000 +0200
@@ -60,31 +60,31 @@
 /*
  * Flags for creation of range widget
  */
-enum GnomePrintDialogRangeFlags {
+typedef enum {
 	GNOME_PRINT_RANGE_CURRENT = (1 &lt;&lt; 0),
 	GNOME_PRINT_RANGE_ALL = (1 &lt;&lt; 1),
 	GNOME_PRINT_RANGE_RANGE = (1 &lt;&lt; 2),
 	GNOME_PRINT_RANGE_SELECTION = (1 &lt;&lt; 3),
 	GNOME_PRINT_RANGE_SELECTION_UNSENSITIVE  = (1 &lt;&lt; 4),
-};
+} GnomePrintDialogRangeFlags;
 
 /*
  * Flags to specify, whether we want range and copies widgets
  */
-enum GnomePrintDialogFlags {
+typedef enum {
 	GNOME_PRINT_DIALOG_RANGE = (1 &lt;&lt; 0),
 	GNOME_PRINT_DIALOG_COPIES = (1 &lt;&lt; 1)
-};
+} GnomePrintDialogFlags;
 
 /*
  * The button numbers corresponding to the standard buttons
  * Used with the GnomeDialog &quot;clicked&quot; signal.
  */
-enum GnomePrintButtons {
+typedef enum {
 	GNOME_PRINT_DIALOG_RESPONSE_PRINT = 1,
 	GNOME_PRINT_DIALOG_RESPONSE_PREVIEW,
 	GNOME_PRINT_DIALOG_RESPONSE_CANCEL = GTK_RESPONSE_CANCEL,
-};
+} GnomePrintButtons;
 
 GType gnome_print_dialog_get_type (void);
 

--=-XUcmHdE7TNBPqgsG0iVu
Content-Disposition: attachment; filename=gnome-print-paper-selector.h.diff
Content-Type: text/x-patch; name=gnome-print-paper-selector.h.diff; charset=iso-8859-1
Content-Transfer-Encoding: 7bit

--- gnome-print-paper-selector.h.old	2003-01-11 17:46:47.000000000 +0100
+++ gnome-print-paper-selector.h	2003-09-25 13:10:12.000000000 +0200
@@ -44,10 +44,10 @@
 #include &lt;glib-object.h&gt;
 #include &lt;libgnomeprint/gnome-print-config.h&gt;
 
-enum GnomePaperSelectorFlags {
+typedef enum {
 	GNOME_PAPER_SELECTOR_MARGINS = (1 &lt;&lt; 0),
 	GNOME_PAPER_SELECTOR_FEED_ORIENTATION = (1 &lt;&lt; 1)
-};
+} GnomePaperSelectorFlags;
 
 GType       gnome_paper_selector_get_type (void);
 GtkWidget * gnome_paper_selector_new (GnomePrintConfig *config);

--=-XUcmHdE7TNBPqgsG0iVu--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002513.html">[Gtk-sharp-list] Added const-guchar to SymbolTable.cs
</A></li>
	<LI> Next message: <A HREF="002497.html">[Gtk-sharp-list] Pop up Menus
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2496">[ date ]</a>
              <a href="thread.html#2496">[ thread ]</a>
              <a href="subject.html#2496">[ subject ]</a>
              <a href="author.html#2496">[ author ]</a>
         </LI>
       </UL>
</body></html>
