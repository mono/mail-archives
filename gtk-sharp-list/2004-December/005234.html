<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] SubWidget problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:danw%40novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005232.html">
   <LINK REL="Next"  HREF="005239.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] SubWidget problems
   </H1>
    <B>Dan Winship
    </B> 
    <A HREF="mailto:danw%40novell.com"
       TITLE="[Gtk-sharp-list] SubWidget problems">danw@novell.com
       </A><BR>
    <I>Wed, 15 Dec 2004 10:48:21 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="005232.html">[Gtk-sharp-list] SubWidget problems
</A></li>
        <LI> Next message: <A HREF="005239.html">[Gtk-sharp-list] SubWidget problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5234">[ date ]</a>
              <a href="thread.html#5234">[ thread ]</a>
              <a href="subject.html#5234">[ subject ]</a>
              <a href="author.html#5234">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2004-12-14 at 19:41 -0600, Sergio Duran wrote:
&gt;<i> I created a Widget (DBMenu) that inherits from Gtk.Menu, it works ok,
</I>&gt;<i> but sometimes it ends up reading an empty instance of itself, I set
</I>&gt;<i> some variables in the ctor, and I end up dealing with an instance with
</I>&gt;<i> those variables unitialized, I found some stuff that said one should
</I>&gt;<i> add a ctor(IntPtr x) but then it instantiates the class when it
</I>&gt;<i> shouldnt be doing it, apparently randomly so get some weird crashes.
</I>&gt;<i> 
</I>&gt;<i> I found some links that said that it is related to gtk and c#'s
</I>&gt;<i> garbage collection.
</I>
The issue is that for every Gtk# object, there are actually two
different &quot;objects&quot; created; the underlying C-based GObject, and the
C#/managed object that wraps it.

The problem is that when you add your DBMenu to a C-based container
widget, the container only keeps track of the GObject part, not the
managed part. So if there are no other references to the managed object,
it will get garbage collected, even though the C-based object is still
there.

So then if Gtk# finds a reference to the C-based object later, it needs
to create a new managed wrapper for it. This is what the IntPtr ctor is
for. However, as you've discovered, it's only safe to have an IntPtr
ctor if you can completely reconstruct the wrapper object's state from
the C-based object.

If you can't do that, the easiest thing to do is to make sure that
something somewhere in managed code keeps a reference to the DBMenu
object so that it won't be garbage collected.

The good news is that this problem will be fixed in Gtk# 2.0

-- Dan



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005232.html">[Gtk-sharp-list] SubWidget problems
</A></li>
	<LI> Next message: <A HREF="005239.html">[Gtk-sharp-list] SubWidget problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5234">[ date ]</a>
              <a href="thread.html#5234">[ thread ]</a>
              <a href="subject.html#5234">[ subject ]</a>
              <a href="author.html#5234">[ author ]</a>
         </LI>
       </UL>
</body></html>
