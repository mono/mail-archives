<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] reusing windows using attribute [Widget]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:nigel_benns%40rogers.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005215.html">
   <LINK REL="Next"  HREF="005214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] reusing windows using attribute [Widget]
   </H1>
    <B>Nigel Benns
    </B> 
    <A HREF="mailto:nigel_benns%40rogers.com"
       TITLE="[Gtk-sharp-list] reusing windows using attribute [Widget]">nigel_benns@rogers.com
       </A><BR>
    <I>Thu, 9 Dec 2004 10:40:34 -0500 (EST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="005215.html">[Gtk-sharp-list] reusing windows using attribute [Widget]
</A></li>
        <LI> Next message: <A HREF="005214.html">[Gtk-sharp-list] Rsvg#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5217">[ date ]</a>
              <a href="thread.html#5217">[ thread ]</a>
              <a href="subject.html#5217">[ subject ]</a>
              <a href="author.html#5217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Javier,

  This is caused because after you destroy and object you need to reload
its information from glade again, as it only binds to the objects after
the Autoconnect(this)

  If you have to destroy your window, redo the:
      Glade.XML gxml = new Glade.XML (null, &quot;gui.glade&quot;, null, null);
      gxml.Autoconnect (this); //you might be able to get away with just
this, I haven't tested it tho.

  The better idea in this situation would be to do what Francis was
suggesting and use Show and Hide.

  It would be a better implementation to wrap the seperate window in its
own class as Francis suggested as well. This would allow your program to
create multiple instances of the window (if you want that).

  //From here on is probably a whole bunch of crap you don't needed :P
  //But I'm bored!


  If you don't want that, make the class a Singleton.

eg:

  public class Window2 {

     private static Window2 win; //Keep the real instance private

     [Widget] Window window2; //The actual Gtk.Window from glade

     private static Object lockObject = &quot;Lock&quot;;

     private Window2() {

        Glade.XML gxml = new Glade.XML (null, &quot;gui.glade&quot;, null, null);
        gxml.Autoconnect (this);

     }

     public static Window2 Instance {

        get {


           //This is what guarantees that only one window will be created.
           lock(lockObject) { //Just in case it gets called at the same time

              if (win == null) win = new Window2();

           }

           return win;

        }

     }

     public void Show() {

        window2.ShowAll();

     }

     private void OnWindowDeleteEvent (object o, DeleteEventArgs args) {

        window2.Hide();

     }

  }

  and then to use it like:

  public void on_button1_clicked (object o, EventArgs args)
  {

     Window2 tmpWin = Window2.Instance;
     tmpWin.Show();

  }

  I'm doing this off the top of my head right now, so if it doesn't work
right off (and you actually want to use this :P) then send me back a
reply if you can't fix it.

  Now another idea as well that will work if you want to get the result of
a window and don't want to leave the function your are in, say for
entering a username and password for authentication before a required
action (which is exactly what I use it for).

Just slightly modify the Singleton class:

  public class AuthUser {

     private static AuthUser authUser; //Keep the real instance private
     private static Object lockObject = &quot;Lock&quot;;

     private static string username = &quot;&quot;, password = &quot;&quot;;

     [Widget] Dialog dlgAuth; // A Dialog with Ok, Cancel and 2 Entries
     [Widget] Entry entUser, entPass;

     private AuthUser() {

     }

     public static AuthUser Instance {

        get {


           //This is what guarantees that only one window will be created.
           lock(lockObject) { //Just in case it gets called at the same time

              if (win == null) win = new Window2();

           }

           return win;

        }

     }

     public string Username {

        get {

           return username;

        }

     }

     public string Password {

        get {

           return password;

        }

     }

     public void Authenticate() {

        Application.Init();
        Glade.XML gxml = new Glade.XML (null, &quot;gui.glade&quot;, null, null);
        gxml.Autoconnect (this);

        dlgAuth.ShowAll();
        Application.Run();

     }

     public void btnOkClicked (object o, EventArgs args) {

        username = entUser.Text;
        password = entPass.Text;

        Application.Quit();

     }

     private void OnWindowDeleteEvent (object o, DeleteEventArgs args) {

        Application.Quit();

     }

  }

Use this like:

   bool authorized = true;
   AuthUser tmpUser = AuthUser.Instance;

   try {

      //Check your authorization(assuming an error is thrown if your not
authorized)

   }
   catch {

      authorized = false;

   }

   while(!authorized) {

      tmpUser.Authenticate();
      /*Check the authorization again using:

        tmpUser.Username and tmpUser.Password

        and then set authorized = true if we are authorized;

   }

Its not perfect because I left out some stuff, but now you have a class
that an entire program can use to graphically authenticate whenever
needed. And because it runs within its own gtk_main_loop() it doesn't have
to wait for your application to be idle before it loads.

Now wasn't that a complete waist of time :)

&gt;<i> Hey
</I>&gt;<i>
</I>&gt;<i> I have the following program:
</I>&gt;<i> ----------
</I>&gt;<i> using System;
</I>&gt;<i> using Gtk;
</I>&gt;<i> using Glade;
</I>&gt;<i>
</I>&gt;<i> public class GladeApp
</I>&gt;<i> {
</I>&gt;<i> 	[Widget] Gtk.Window window1;
</I>&gt;<i> 	[Widget] Gtk.Window window2;
</I>&gt;<i> 	[Widget] Gtk.Button button1;
</I>&gt;<i>
</I>&gt;<i> 	public static void Main (string[] args)
</I>&gt;<i> 	{
</I>&gt;<i> 		new GladeApp (args);
</I>&gt;<i> 	}
</I>&gt;<i> 	public GladeApp (string[] args)
</I>&gt;<i> 	{
</I>&gt;<i> 		Application.Init();
</I>&gt;<i> 		Glade.XML gxml = new Glade.XML (null, &quot;gui.glade&quot;, null, null);
</I>&gt;<i> 		gxml.Autoconnect (this);
</I>&gt;<i> 		Application.Run();
</I>&gt;<i> 	}
</I>&gt;<i> 	public void OnWindowDeleteEvent (object o, DeleteEventArgs args)
</I>&gt;<i> 	{
</I>&gt;<i> 		Application.Quit ();
</I>&gt;<i> 		args.RetVal = true;
</I>&gt;<i> 	}
</I>&gt;<i> 	public void on_button1_clicked (object o, EventArgs args)
</I>&gt;<i> 	{
</I>&gt;<i> 		window2.Visible = true;
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i> ----------
</I>&gt;<i> gui.glade has two windows, &quot;window1&quot; and &quot;window2&quot;; &quot;window1&quot; has one
</I>&gt;<i> button &quot;button1&quot;; &quot;button1&quot; has one signal &quot;on_button1_clicked&quot; and
</I>&gt;<i> &quot;window2&quot; is not visible by default.
</I>&gt;<i>
</I>&gt;<i> The idea, is to have an event on &quot;window1&quot; that opens &quot;window2&quot;
</I>&gt;<i>
</I>&gt;<i> It work very well for me the first time, the problem comes when I close
</I>&gt;<i> &quot;window2&quot;, the window is destroyed and when I click on &quot;button1&quot; again
</I>&gt;<i> to re-open &quot;window2&quot;, it is empty.
</I>&gt;<i>
</I>&gt;<i> I have two ideas of how to work around this issue (please correct me if
</I>&gt;<i> I'm wrong)
</I>&gt;<i>
</I>&gt;<i> 1.- to have another class (one class per window) with it's own:
</I>&gt;<i>
</I>&gt;<i> Glade.XML gxml = new Glade.XML (null, &quot;gui.glade&quot;, &quot;window2&quot;, null);
</I>&gt;<i>
</I>&gt;<i> and instance this class every time I want to open &quot;window2&quot;
</I>&gt;<i>
</I>&gt;<i> 2.- to use gxml.GetWidget(&quot;window2&quot;); I don't like this one 'cause
</I>&gt;<i> GetWidget returns an object of type Gtk.Widget  :(
</I>&gt;<i>
</I>&gt;<i> Is there any way to re-open window2 also using the arrtribute [Widget]?
</I>&gt;<i> i.e. by not destroying the window, or re-instance it a second time ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i> --
</I>&gt;<i> Javier Díaz &lt;<A HREF="mailto:javierdiazm@yahoo.com.mx">javierdiazm@yahoo.com.mx</A>&gt;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Gtk-sharp-list maillist  -  <A HREF="mailto:Gtk-sharp-list@lists.ximian.com">Gtk-sharp-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>
</I>&gt;<i>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005215.html">[Gtk-sharp-list] reusing windows using attribute [Widget]
</A></li>
	<LI> Next message: <A HREF="005214.html">[Gtk-sharp-list] Rsvg#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5217">[ date ]</a>
              <a href="thread.html#5217">[ thread ]</a>
              <a href="subject.html#5217">[ subject ]</a>
              <a href="author.html#5217">[ author ]</a>
         </LI>
       </UL>
</body></html>
