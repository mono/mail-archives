<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] need help with TextBuffers and TextIters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:patrik%40olterman.se">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="002859.html">
   <LINK REL="Next"  HREF="002865.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] need help with TextBuffers and TextIters
   </H1>
    <B>Patrik Olterman
    </B> 
    <A HREF="mailto:patrik%40olterman.se"
       TITLE="[Gtk-sharp-list] need help with TextBuffers and TextIters">patrik@olterman.se
       </A><BR>
    <I>Fri, 21 Nov 2003 19:23:25 +0100</I>
    <P><UL>
        <LI> Previous message: <A HREF="002859.html">[Gtk-sharp-list] A simple xsl stylsheet to help glade users
 with the required c# code
</A></li>
        <LI> Next message: <A HREF="002865.html">[Gtk-sharp-list] need help with TextBuffers and TextIters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2864">[ date ]</a>
              <a href="thread.html#2864">[ thread ]</a>
              <a href="subject.html#2864">[ subject ]</a>
              <a href="author.html#2864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all 

I have for a while been working on a low end C# editor in GTK# 
I am struggling to make syntax highlighting to work due to the 
lack of documentation on TextIters and TextBuffers. The full code can be
found in a subversion repository on 
<A HREF="http://www.olterman.se:8080/repos/mono/ezsharp/ezsharp.cs">http://www.olterman.se:8080/repos/mono/ezsharp/ezsharp.cs</A>

heres what I have so far as to syntax highlighting as you can see its
far from perfect, right now it highlights oneline comments and strings
if there is only one string on a line. Hopefully this will give us a
working little editor and some documentation on buffers and iters.

Please help 
----------------------------------------------------------------------
  class Hilite 
  {
	public TextTagTable tt;
        public TextTag string_tag, comment_tag;
	public bool commentBit;

	public Hilite()
	{
	tt = new TextTagTable();
	// text tags for syntax highlighting
	// strings
       string_tag = new TextTag(null);
	string_tag.Foreground = &quot;blue&quot;;
      tt.Add(string_tag);
	// coments
       comment_tag = new TextTag(null);
	comment_tag.Foreground = &quot;darkgreen&quot;;
      tt.Add(comment_tag);
	}

	public void hilite_all()
	{
		
		//Console.WriteLine(&quot;Hilite event&quot;);
		TextIter begin = new TextIter();
		begin = App.editor.buf.StartIter;
		TextIter stop = new TextIter();
		stop = App.editor.buf.StartIter;
		stop.ForwardLine();
		//Console.WriteLine(buf.GetText(begin, stop, false));
		for (int i = 1; i &lt; App.editor.buf.LineCount; i++)
			{
			    // get the txt 
			     //Console.Write(buf.GetText(begin, stop, false));
			     string txt = App.editor.buf.GetText(begin, stop, true);
			    //
				if(txt != &quot;&quot;) {

					// checking for strings
					Regex reg_string = new Regex(&quot;(\&quot;.*\&quot;)&quot;);
					Match mat_string = reg_string.Match(txt);
					if(mat_string.Success==true) {
						char fnutt= '&quot;';
						TextIter begin_string = begin.Copy();
						TextIter stop_string = stop.Copy();
						while( true==true ) {
							begin_string.ForwardChar();
							string control = App.editor.buf.GetText(begin_string,
stop_string, true);
							if ( control[0] == fnutt ) {
								break;		
							}
						}
						while( true==true ) {
							stop_string.BackwardChar();
							string control = App.editor.buf.GetText(begin_string,
stop_string, true);
							int end = control.Length-1;
							if ( control[end] == fnutt ) {
								break;		
							}
						} 

						//applying string tag
						App.editor.buf.ApplyTag (string_tag, begin_string, stop_string);
					}	
					// checking for comments
					Regex reg_comment = new Regex(&quot;(\\s)*(//)&quot;); 
					Match mat_comment = reg_comment.Match(txt);
					if(mat_comment.Success==true) {
						string slash = &quot;//&quot;;
						TextIter begin_comment = begin.Copy();
						while( true==true ) {
							
							TextIter control_it = begin_comment.Copy();
							control_it.ForwardChar();
							control_it.ForwardChar();
							string control = App.editor.buf.GetText(begin_comment,
control_it, true);
							if ( control == slash ) {
								break;		
							}
						begin_comment.ForwardChar();
						}
						//applying comment tag
						App.editor.buf.ApplyTag (comment_tag, begin_comment, stop);
					}								
				}
			    // move iters forward one line 
				begin.ForwardLine();	
				stop.ForwardLine();
			}
		
		/*
		TextIter it_a = new TextIter();
		it_a = App.editor.buf.StartIter;
		TextIter it_b = new TextIter();
		it_b = App.editor.buf.StartIter;
		it_b.ForwardChar();
		TextIter it_end = new TextIter();
		it_end = App.editor.buf.EndIter;
		
		// looping through each char of the code
		while (it_b != it_end)
		{
		//Console.WriteLine(App.editor.buf.GetText(it_a, it_b, true));
		
		
		// moving iters forward
		it_a.ForwardChar();
		it_b.ForwardChar();
		}
		*/
	}
	
	public void hilite_last_word()
	{
	
	}

	public void hilite_remove()
	{
		TextIter first = new TextIter();
		first = App.editor.buf.StartIter;
		TextIter last = new TextIter();
		last = App.editor.buf.EndIter;

		App.editor.buf.RemoveAllTags(first, last);
	}
  }



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="002859.html">[Gtk-sharp-list] A simple xsl stylsheet to help glade users
 with the required c# code
</A></li>
	<LI> Next message: <A HREF="002865.html">[Gtk-sharp-list] need help with TextBuffers and TextIters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2864">[ date ]</a>
              <a href="thread.html#2864">[ thread ]</a>
              <a href="subject.html#2864">[ subject ]</a>
              <a href="author.html#2864">[ author ]</a>
         </LI>
       </UL>
</body></html>
