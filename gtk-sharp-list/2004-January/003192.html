<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] Re: ButtonPressEvent in 0.15
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tiago.lima%40vianw.pt">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="003190.html">
   <LINK REL="Next"  HREF="003166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] Re: ButtonPressEvent in 0.15
   </H1>
    <B>Tiago Lima
    </B> 
    <A HREF="mailto:tiago.lima%40vianw.pt"
       TITLE="[Gtk-sharp-list] Re: ButtonPressEvent in 0.15">tiago.lima@vianw.pt
       </A><BR>
    <I>Fri, 16 Jan 2004 10:17:09 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="003190.html">[Gtk-sharp-list] Re: ButtonPressEvent in 0.15
</A></li>
        <LI> Next message: <A HREF="003166.html">[Gtk-sharp-list] GTK#-0.15+Combo+Entry+mono-0.29+WINDOWS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3192">[ date ]</a>
              <a href="thread.html#3192">[ thread ]</a>
              <a href="subject.html#3192">[ subject ]</a>
              <a href="author.html#3192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, it works fine. Thanks !

	Tiago Lima

On Friday 16 January 2004 09:07, Ecmel Ercan wrote:
&gt;<i> &gt;&gt; I am developing an application and now I can't do context menus :(
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Please help,
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I made a workaround using 0.15 hope helps:
</I>&gt;<i>
</I>&gt;<i> using System;
</I>&gt;<i> using System.Collections;
</I>&gt;<i> using Gtk;
</I>&gt;<i> using GtkSharp;
</I>&gt;<i> using System.Runtime.InteropServices;
</I>&gt;<i>
</I>&gt;<i> public class ProjectTree : TreeView
</I>&gt;<i> {
</I>&gt;<i>     static GLib.GType gtype = GLib.GType.Invalid;
</I>&gt;<i>     public static new GLib.GType GType {
</I>&gt;<i>         get
</I>&gt;<i>         {
</I>&gt;<i>             if (gtype == GLib.GType.Invalid)
</I>&gt;<i>                 gtype = RegisterGType (typeof (ProjectTree));
</I>&gt;<i>             return gtype;
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>     public ProjectTree () : base (GType)
</I>&gt;<i>     {
</I>&gt;<i>
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>     /* This segfaults
</I>&gt;<i>     protected override bool OnButtonPressEvent (ref Gdk.EventButton evnt)
</I>&gt;<i>     {
</I>&gt;<i>         Console.WriteLine (&quot;Hello&quot;);
</I>&gt;<i>         base.OnButtonPressEvent (ref evnt);
</I>&gt;<i>         return false;
</I>&gt;<i>     }
</I>&gt;<i>     */
</I>&gt;<i>
</I>&gt;<i>     //
</I>&gt;<i>     // CONNECT_AFTER WORKAROUND
</I>&gt;<i>     // This Works
</I>&gt;<i>
</I>&gt;<i>     private Hashtable Signals = new Hashtable();
</I>&gt;<i>
</I>&gt;<i>     [GLib.Signal(&quot;button_press_event&quot;)]
</I>&gt;<i>     public new event ButtonPressEventHandler ButtonPressEvent
</I>&gt;<i>     {
</I>&gt;<i>         add
</I>&gt;<i>         {
</I>&gt;<i>             if (EventList[&quot;button_press_event&quot;] == null)
</I>&gt;<i>                 Signals[&quot;button_press_event&quot;] = new
</I>&gt;<i> boolObjectEventButtonSignal(this, Handle, &quot;button_press_event&quot;, value,
</I>&gt;<i> System.Type.GetType(&quot;GtkSharp.ButtonPressEventArgs,gtk-sharp&quot;)); else
</I>&gt;<i>                 ((GtkSharp.SignalCallback) Signals
</I>&gt;<i> [&quot;button_press_event&quot;]).AddDelegate (value);
</I>&gt;<i>
</I>&gt;<i>             EventList.AddHandler(&quot;button_press_event&quot;, value);
</I>&gt;<i>         }
</I>&gt;<i>         remove
</I>&gt;<i>         {
</I>&gt;<i>             EventList.RemoveHandler(&quot;button_press_event&quot;, value);
</I>&gt;<i>             GtkSharp.SignalCallback cb = Signals [&quot;button_press_event&quot;] as
</I>&gt;<i> GtkSharp.SignalCallback; if (cb == null)
</I>&gt;<i>                 return;
</I>&gt;<i>
</I>&gt;<i>             cb.RemoveDelegate (value);
</I>&gt;<i>
</I>&gt;<i>             if (EventList[&quot;button_press_event&quot;] == null)
</I>&gt;<i>             {
</I>&gt;<i>                 Signals.Remove(&quot;button_press_event&quot;);
</I>&gt;<i>                 cb.Dispose ();
</I>&gt;<i>             }
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>     private delegate bool boolObjectEventButtonDelegate(IntPtr arg0, ref
</I>&gt;<i> Gdk.EventButton arg1, int key);
</I>&gt;<i>
</I>&gt;<i>     private class boolObjectEventButtonSignal : SignalCallback
</I>&gt;<i>     {
</I>&gt;<i>         private static boolObjectEventButtonDelegate _Delegate;
</I>&gt;<i>
</I>&gt;<i>         private IntPtr _raw;
</I>&gt;<i>         private uint _HandlerID;
</I>&gt;<i>
</I>&gt;<i>         private static bool boolObjectEventButtonCallback(IntPtr arg0, ref
</I>&gt;<i> Gdk.EventButton arg1, int key) {
</I>&gt;<i>             if (!_Instances.Contains(key))
</I>&gt;<i>                 throw new Exception(&quot;Unexpected signal key &quot; + key);
</I>&gt;<i>
</I>&gt;<i>             boolObjectEventButtonSignal inst =
</I>&gt;<i> (boolObjectEventButtonSignal) _Instances[key]; SignalArgs args =
</I>&gt;<i> (SignalArgs) Activator.CreateInstance (inst._argstype); args.Args = new
</I>&gt;<i> object[1];
</I>&gt;<i>             args.Args[0] = arg1;
</I>&gt;<i>             object[] argv = new object[2];
</I>&gt;<i>             argv[0] = inst._obj;
</I>&gt;<i>             argv[1] = args;
</I>&gt;<i>             inst._handler.DynamicInvoke(argv);
</I>&gt;<i>             if (args.RetVal == null)
</I>&gt;<i>                 return false;
</I>&gt;<i>             return (bool) ((bool)args.RetVal);
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>         [DllImport(&quot;libgobject-2.0-0.dll&quot;)]
</I>&gt;<i>         static extern uint g_signal_connect_data(IntPtr obj, String name,
</I>&gt;<i> boolObjectEventButtonDelegate cb, int key, IntPtr p, int flags);
</I>&gt;<i>
</I>&gt;<i>         public boolObjectEventButtonSignal(GLib.Object obj, IntPtr raw,
</I>&gt;<i> String name, Delegate eh, Type argstype) : base(obj, eh, argstype) {
</I>&gt;<i>             if (_Delegate == null)
</I>&gt;<i>             {
</I>&gt;<i>                 _Delegate = new
</I>&gt;<i> boolObjectEventButtonDelegate(boolObjectEventButtonCallback); }
</I>&gt;<i>             _raw = raw;
</I>&gt;<i>             _HandlerID = g_signal_connect_data(raw, name, _Delegate, _key,
</I>&gt;<i> new IntPtr(0), 0); }
</I>&gt;<i>
</I>&gt;<i>         [DllImport(&quot;libgobject-2.0-0.dll&quot;)]
</I>&gt;<i>         static extern void g_signal_handler_disconnect (IntPtr instance,
</I>&gt;<i> uint handler);
</I>&gt;<i>
</I>&gt;<i>         [DllImport(&quot;libgobject-2.0-0.dll&quot;)]
</I>&gt;<i>         static extern bool g_signal_handler_is_connected (IntPtr instance,
</I>&gt;<i> uint handler);
</I>&gt;<i>
</I>&gt;<i>         protected override void Dispose (bool disposing)
</I>&gt;<i>         {
</I>&gt;<i>             _Instances.Remove(_key);
</I>&gt;<i>             if(_Instances.Count == 0)
</I>&gt;<i>                 _Delegate = null;
</I>&gt;<i>
</I>&gt;<i>             if (g_signal_handler_is_connected (_raw, _HandlerID))
</I>&gt;<i>                 g_signal_handler_disconnect (_raw, _HandlerID);
</I>&gt;<i>             base.Dispose (disposing);
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Gtk-sharp-list maillist  -  <A HREF="mailto:Gtk-sharp-list@lists.ximian.com">Gtk-sharp-list@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="003190.html">[Gtk-sharp-list] Re: ButtonPressEvent in 0.15
</A></li>
	<LI> Next message: <A HREF="003166.html">[Gtk-sharp-list] GTK#-0.15+Combo+Entry+mono-0.29+WINDOWS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3192">[ date ]</a>
              <a href="thread.html#3192">[ thread ]</a>
              <a href="subject.html#3192">[ subject ]</a>
              <a href="author.html#3192">[ author ]</a>
         </LI>
       </UL>
</body></html>
