<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] System.InvalidCastException
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:paulo.pires%40vodafone.pt">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005540.html">
   <LINK REL="Next"  HREF="005542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] System.InvalidCastException
   </H1>
    <B>Paulo Pires
    </B> 
    <A HREF="mailto:paulo.pires%40vodafone.pt"
       TITLE="[Gtk-sharp-list] System.InvalidCastException">paulo.pires@vodafone.pt
       </A><BR>
    <I>Tue, 15 Mar 2005 15:07:11 +0000</I>
    <P><UL>
        <LI> Previous message: <A HREF="005540.html">[Gtk-sharp-list] System.InvalidCastException
</A></li>
        <LI> Next message: <A HREF="005542.html">[Gtk-sharp-list] Creating modal dialogs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5541">[ date ]</a>
              <a href="thread.html#5541">[ thread ]</a>
              <a href="subject.html#5541">[ subject ]</a>
              <a href="author.html#5541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi again

According to jonp @ irc.us.gimp.org, this is a known bug where the
probable problem is that once I'm relying on the CanvasGroup to maintain
a reference to my object, and the GC can't see it, GC will simply
collect it although it's held by GTK+.

AFAIL this isn't in bugzilla, but I and jonp hope that this would be fix
in GTK# 2.0


Thanks a lot jonp,
Paulo Pires


Ter, 2005-03-15 =E0s 14:43 +0000, Paulo Pires escreveu:
&gt;<i>Hi list
</I>&gt;<i>
</I>&gt;<i>this seems odd!
</I>&gt;<i>
</I>&gt;<i>I'm still working around my Canvas, and what I couldn't do with
</I>&gt;<i>CanvasWidget, I'm doing with CanvasGroup. So, I've created an object,
</I>&gt;<i>wdgSemaphore, which derives from Gnome.CanvasGroup. So far, so good.
</I>&gt;<i>
</I>&gt;<i>The problem appears when I handle my Canvas.CanvasEvent with the
</I>&gt;<i>following code:
</I>&gt;<i>&lt;code&gt;
</I>&gt;<i>
</I>&gt;<i>private void OnCanvasEvent(object o, Gnome.CanvasEventArgs args)
</I>&gt;<i>	{
</I>&gt;<i>		Gdk.EventButton ev =3D new Gdk.EventButton (args.Event.Handle);
</I>&gt;<i>	=09
</I>&gt;<i>		Globals.LogLn(&quot;Type -&gt; &quot; + o.GetType());
</I>&gt;<i>	=09
</I>&gt;<i>		//Gnome.CanvasGroup item =3D (Gnome.CanvasGroup) o;
</I>&gt;<i>		wdgSemaphore item =3D (wdgSemaphore) o;
</I>&gt;<i>	=09
</I>&gt;<i>		Globals.LogLn(&quot;-&gt; &quot; + ev.Type);
</I>&gt;<i>	=09
</I>&gt;<i>		switch (ev.Type)
</I>&gt;<i>		{
</I>&gt;<i>			case Gdk.EventType.ButtonPress:
</I>&gt;<i>				if (ev.Button =3D=3D 1) {
</I>&gt;<i>					remember_x =3D ev.X;
</I>&gt;<i>					remember_y =3D ev.Y;
</I>&gt;<i>				} else if (ev.Button =3D=3D 3) {
</I>&gt;<i>					// destroy item and subsequent semaphore
</I>&gt;<i>					WorldToUI.RemoveSemaphore(item);
</I>&gt;<i>				}
</I>&gt;<i>				break;
</I>&gt;<i>			=09
</I>&gt;<i>			case Gdk.EventType.MotionNotify:
</I>&gt;<i>				Gdk.ModifierType state =3D (Gdk.ModifierType) ev.State;
</I>&gt;<i>				if ((state &amp; Gdk.ModifierType.Button1Mask) !=3D 0)
</I>&gt;<i>				{
</I>&gt;<i>					double new_x =3D ev.X, new_y =3D ev.Y;
</I>&gt;<i>					item.Move (new_x - remember_x, new_y - remember_y);
</I>&gt;<i>					remember_x =3D new_x;
</I>&gt;<i>					remember_y =3D new_y;
</I>&gt;<i>				}
</I>&gt;<i>				break;
</I>&gt;<i>			=09
</I>&gt;<i>			case Gdk.EventType.EnterNotify:
</I>&gt;<i>				break;
</I>&gt;<i>			=09
</I>&gt;<i>			case Gdk.EventType.LeaveNotify:
</I>&gt;<i>				break;
</I>&gt;<i>		}
</I>&gt;<i>	}
</I>&gt;<i>
</I>&gt;<i>&lt;/code&gt;
</I>&gt;<i>
</I>&gt;<i>That Global.LogLn, is outputting the type of o and then the
</I>&gt;<i>Gdk.Event.Type, and here it follows:
</I>&gt;<i>
</I>&gt;<i>(...)
</I>&gt;<i>
</I>&gt;<i>Type -&gt; TrafficMan.wdgSemaphore
</I>&gt;<i>-&gt; MotionNotify
</I>&gt;<i>Type -&gt; TrafficMan.wdgSemaphore
</I>&gt;<i>-&gt; MotionNotify
</I>&gt;<i>Type -&gt; TrafficMan.wdgSemaphore
</I>&gt;<i>-&gt; MotionNotify
</I>&gt;<i>Type -&gt; TrafficMan.wdgSemaphore
</I>&gt;<i>-&gt; LeaveNotify
</I>&gt;<i>Type -&gt; Gnome.CanvasGroup
</I>&gt;<i>
</I>&gt;<i>Unhandled Exception: System.InvalidCastException: Cannot cast from
</I>&gt;<i>source type to destination type.
</I>&gt;<i>
</I>&gt;<i>(...)
</I>&gt;<i>
</I>&gt;<i>What the hell is going on so that the type is changed on the Event?!
</I>&gt;<i>
</I>&gt;<i>Hugs
</I>&gt;<i>Paulo Pires
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Gtk-sharp-list maillist  -  <A HREF="mailto:Gtk-sharp-list@lists.ximian.com">Gtk-sharp-list@lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/gtk-sharp-list">http://lists.ximian.com/mailman/listinfo/gtk-sharp-list</A>
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005540.html">[Gtk-sharp-list] System.InvalidCastException
</A></li>
	<LI> Next message: <A HREF="005542.html">[Gtk-sharp-list] Creating modal dialogs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5541">[ date ]</a>
              <a href="thread.html#5541">[ thread ]</a>
              <a href="subject.html#5541">[ subject ]</a>
              <a href="author.html#5541">[ author ]</a>
         </LI>
       </UL>
</body></html>
