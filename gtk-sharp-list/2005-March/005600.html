<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Gtk-sharp-list] A first go at gtk-sharp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:brad%40getcoded.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="005599.html">
   <LINK REL="Next"  HREF="005601.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gtk-sharp-list] A first go at gtk-sharp
   </H1>
    <B>Brad Taylor
    </B> 
    <A HREF="mailto:brad%40getcoded.net"
       TITLE="[Gtk-sharp-list] A first go at gtk-sharp">brad@getcoded.net
       </A><BR>
    <I>Sat, 26 Mar 2005 12:49:04 -0800</I>
    <P><UL>
        <LI> Previous message: <A HREF="005599.html">[Gtk-sharp-list] A first go at gtk-sharp
</A></li>
        <LI> Next message: <A HREF="005601.html">[Gtk-sharp-list] A first go at gtk-sharp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5600">[ date ]</a>
              <a href="thread.html#5600">[ thread ]</a>
              <a href="subject.html#5600">[ subject ]</a>
              <a href="author.html#5600">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-E0iQFwO6XL2wvXXRtOTh
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Hi,

&gt;<i> I have created a first gtk-sharp program.Programming in C-sharp using
</I>&gt;<i> GTK is surprisingly easy once you get the hang of it. My program is a
</I>&gt;<i> tiny convers network client which uses networking and threading.  The
</I>&gt;<i> GTK GUI is updated using the recommended ThreadNotify function.
</I>&gt;<i>=20
</I>&gt;<i> Some parts I don't quite understand: why do I need &quot;Thread.Sleep (50)&quot;
</I>&gt;<i> in ReceiveChat ()? If I leave it out, the TextView gets updated  with
</I>&gt;<i> only part of the nework information,especially when received network
</I>&gt;<i> information consists of more than about 10 lines. Adding a Sleep here
</I>&gt;<i> would mean that a slower system would need more sleep than a fast
</I>&gt;<i> system. How do I avoid this?
</I>
What this looks like is a concurrency issue.  It seems that the call

  b.Insert (b.EndIter, data);

is being called and before it even finishes, ready () is called again.
Between the first call and the second call, internal variables are being
updated but text and the EndIter are not, giving the error=20

  (&lt;unknown&gt;:13364): Gtk-CRITICAL **: gtk_text_buffer_insert: assertion
`text !=3D NULL' failed

The sleep command gives the buffer enough time to update text and
doesn't pound gtk.  The way that I overcame the problem was to lock the
buffer on that first statement so that multiple instances of ready ()
couldn't update the buffer at the same time like so:

	private void ready ()
        {
                TextMark EndMark;

                lock (b) {
	                b.Insert (b.EndIter, data);
                }

                b.Insert (b.EndIter, &quot;\r\n&quot;);
                EndMark =3D b.CreateMark (&quot;end&quot;, b.EndIter, false);
                tv.ScrollToMark (EndMark, 0.4, true, 0.0, 1.0);
                b.DeleteMark (EndMark);
        }

This fixes the problem without a sleep, but does not visually change the
speed at which it updates.  Maybe somebody who has more knowledge about
the inner workings of gtk+ (like Todd, who surely will wake up from
troll mode just to slap me with a big fish) could clarify this.


Hope this helps.

-Brad

--=20
Brad Taylor
Genome Software LLC
<A HREF="http://www.getcoded.net">http://www.getcoded.net</A>

--=-E0iQFwO6XL2wvXXRtOTh
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.5 (GNU/Linux)

iD8DBQBCRcq/WZT8MXyJ2AURAqjDAKCVmuV8qaynZv5VfJkVMNLSLiX5/QCdGPbT
n6cRuXZ+cyMOidrlZEAwC2A=
=x9+L
-----END PGP SIGNATURE-----

--=-E0iQFwO6XL2wvXXRtOTh--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="005599.html">[Gtk-sharp-list] A first go at gtk-sharp
</A></li>
	<LI> Next message: <A HREF="005601.html">[Gtk-sharp-list] A first go at gtk-sharp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5600">[ date ]</a>
              <a href="thread.html#5600">[ thread ]</a>
              <a href="subject.html#5600">[ subject ]</a>
              <a href="author.html#5600">[ author ]</a>
         </LI>
       </UL>
</body></html>
