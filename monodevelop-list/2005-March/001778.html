<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] Import Visual Studio .NET Projects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:martinf%40mfconsulting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001766.html">
   <LINK REL="Next"  HREF="001783.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] Import Visual Studio .NET Projects
   </H1>
    <B>Francisco T. Martinez
    </B> 
    <A HREF="mailto:martinf%40mfconsulting.com"
       TITLE="[MonoDevelop] Import Visual Studio .NET Projects">martinf@mfconsulting.com
       </A><BR>
    <I>Wed, 16 Mar 2005 07:56:39 -0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="001766.html">[MonoDevelop] Import Visual Studio .NET Projects
</A></li>
        <LI> Next message: <A HREF="001783.html">[MonoDevelop] Import Visual Studio .NET Projects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1778">[ date ]</a>
              <a href="thread.html#1778">[ thread ]</a>
              <a href="subject.html#1778">[ subject ]</a>
              <a href="author.html#1778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.
--------------060706020907050904040704
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Francisco T. Martinez wrote:

&gt;<i> Hola:
</I>&gt;<i>
</I>&gt;<i> The MD add-in prj2make-sharp-lib needs love.  Over the next few days I 
</I>&gt;<i> am going to try to do my best to make some corrections and fixes.  
</I>
OK.  I have a decent cure for a lot of ailments in the included patch. 
Some of the highlights here are:

* Mono 2.0 has been commented out until further notice.
* Gtk# 2.0 is searched first for a match otherwise it goes to Gtk# 1.0
* Added Gecko# 2.0 (0.7) is searched first for a match otherwise it goes 
to Gecko# 1.0 (0.6)

I also folded in the changes that the patch in 
<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=73705">http://bugzilla.ximian.com/show_bug.cgi?id=73705</A> includes.

Paco



--------------060706020907050904040704
Content-Type: text/x-patch;
 name=&quot;prj2make-sharp-lib.diff&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;prj2make-sharp-lib.diff&quot;

Index: MsPrjHelper.cs
===================================================================
--- MsPrjHelper.cs	(revision 2360)
+++ MsPrjHelper.cs	(working copy)
@@ -187,7 +187,8 @@
 			{
 				slash = &quot;\\&quot;;
 			}
-    
+    		
+    		string origDir = Directory.GetCurrentDirectory();
 			try
 			{
 				string d = Path.GetDirectoryName(slnFile);
@@ -432,6 +433,10 @@
 				Console.WriteLine(&quot;EXCEPTION: {0}\n&quot;, e);
 				return &quot;&quot;;
 			}
+			finally
+			{
+				Directory.SetCurrentDirectory(origDir);
+			}
 		}
 		
 		public void CreatePrjxFromCsproj(string csprojFileName)
@@ -511,6 +516,7 @@
 			
 			Console.WriteLine(String.Format(&quot;Will create combine filename:{0}&quot;, cmbxFileName));
 
+			string origDir = Directory.GetCurrentDirectory();
 			try
 			{
 				string d = Path.GetDirectoryName(slnFileName);
@@ -615,6 +621,10 @@
 				Console.WriteLine(&quot;EXCEPTION: {0}\n&quot;, e);
 				return;
 			}
+			finally
+			{
+				Directory.SetCurrentDirectory(origDir);
+			}
 		}
 
 		protected MonoDevelop.Prj2Make.Schema.Prjx.Reference[] GetReferences(MonoDevelop.Prj2Make.Schema.Csproj.Reference[] References)
@@ -627,14 +637,26 @@
 					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;mono&quot;, &quot;libdir&quot;).TrimEnd(),
 					&quot;mono/1.0&quot;);
 
-			string strBasePathMono2_0 = Path.Combine(
-					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;mono&quot;, &quot;libdir&quot;).TrimEnd(),
-					&quot;mono/2.0&quot;);
-
+//			string strBasePathMono2_0 = Path.Combine(
+//					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;mono&quot;, &quot;libdir&quot;).TrimEnd(),
+//					&quot;mono/2.0&quot;);
+//
 			string strBasePathGtkSharp = Path.Combine(
-					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;mono&quot;, &quot;libdir&quot;).TrimEnd(),
+					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;gtk-sharp&quot;, &quot;libdir&quot;).TrimEnd(),
 					&quot;mono/gtk-sharp&quot;);
 
+			string strBasePathGtkSharp2_0 = Path.Combine(
+					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;gtk-sharp-2.0&quot;, &quot;libdir&quot;).TrimEnd(),
+					&quot;mono/gtk-sharp-2.0&quot;);
+
+			string strBasePathGeckoSharp = Path.Combine(
+					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;gecko-sharp&quot;, &quot;libdir&quot;).TrimEnd(),
+					&quot;mono/gecko-sharp&quot;);
+
+			string strBasePathGeckoSharp2_0 = Path.Combine(
+					MonoDevelop.Prj2Make.PkgConfigInvoker.GetPkgVariableValue(&quot;gecko-sharp-2.0&quot;, &quot;libdir&quot;).TrimEnd(),
+					&quot;mono/gecko-sharp-2.0&quot;);
+
 			if(References != null &amp;&amp; References.Length &gt; 0)
 			{
 				theReferences = new MonoDevelop.Prj2Make.Schema.Prjx.Reference[References.Length];
@@ -650,7 +672,7 @@
 				MonoDevelop.Prj2Make.Schema.Prjx.Reference rfOut = new MonoDevelop.Prj2Make.Schema.Prjx.Reference();
 				string strRefFileName;
 
-				if(rf.Package == null || rf.Package.CompareTo(&quot;&quot;) == 0)
+				if(rf.Package == null || rf.Package.Length == 0)
 				{
 					bool bIsWhereExpected = false;
 
@@ -667,15 +689,20 @@
 								rfOut.type = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceType.Gac;
 								rfOut.localcopy = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceLocalcopy.True;
 								bIsWhereExpected = true;
+								// increment the iterator value
+								theReferences[i++] = rfOut;
+								continue;
 							} catch (Exception exc) {
 								Console.WriteLine (&quot;Error doing Assembly.LoadFrom with File: {0}\nErr Msg: {1}&quot;,
 									strRefFileName,
 									exc.Message );
 							}
 						}
+					} else {					
+						//////////////////////////
+						// Check on Mono 1.0
+						strRefFileName = Path.Combine (strBasePathMono1_0, Path.GetFileName(rf.HintPath));
 
-						strRefFileName = Path.Combine (strBasePathMono2_0, Path.GetFileName(&quot;System.Xml.dll&quot;));
-
 						// Test to see if file exist in GAC location
 						if(System.IO.File.Exists(strRefFileName) == true) {
 							try {
@@ -683,15 +710,19 @@
 								rfOut.type = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceType.Gac;
 								rfOut.localcopy = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceLocalcopy.True;
 								bIsWhereExpected = true;
+								// increment the iterator value
+								theReferences[i++] = rfOut;
+								continue;
 							} catch (Exception exc) {
 								Console.WriteLine (&quot;Error doing Assembly.LoadFrom with File: {0}\nErr Msg: {1}&quot;,
 									strRefFileName,
 									exc.Message );
 							}
 						}
-					} else {
-						strRefFileName = Path.Combine (strBasePathMono1_0, Path.GetFileName(rf.HintPath));
 
+						//////////////////////////
+						// Check on Gtk# 2.0
+						strRefFileName = Path.Combine (strBasePathGtkSharp2_0, Path.GetFileName(rf.HintPath));
 
 						// Test to see if file exist in GAC location
 						if(System.IO.File.Exists(strRefFileName) == true) {
@@ -700,6 +731,9 @@
 								rfOut.type = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceType.Gac;
 								rfOut.localcopy = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceLocalcopy.True;
 								bIsWhereExpected = true;
+								// increment the iterator value
+								theReferences[i++] = rfOut;
+								continue;
 							} catch (Exception exc) {
 								Console.WriteLine (&quot;Error doing Assembly.LoadFrom with File: {0}\nErr Msg: {1}&quot;,
 									strRefFileName,
@@ -707,7 +741,9 @@
 							}
 						}
 
-						strRefFileName = Path.Combine (strBasePathMono2_0, Path.GetFileName(rf.HintPath));
+						//////////////////////////
+						// Check on Gtk# 1.0
+						strRefFileName = Path.Combine (strBasePathGtkSharp, Path.GetFileName(rf.HintPath));
 
 						// Test to see if file exist in GAC location
 						if(System.IO.File.Exists(strRefFileName) == true) {
@@ -716,15 +752,41 @@
 								rfOut.type = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceType.Gac;
 								rfOut.localcopy = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceLocalcopy.True;
 								bIsWhereExpected = true;
+								// increment the iterator value
+								theReferences[i++] = rfOut;
+								continue;
 							} catch (Exception exc) {
 								Console.WriteLine (&quot;Error doing Assembly.LoadFrom with File: {0}\nErr Msg: {1}&quot;,
 									strRefFileName,
 									exc.Message );
 							}
 						}
+						
+						//////////////////////////
+						// Check on Gecko# 2.0
+						strRefFileName = Path.Combine (strBasePathGeckoSharp2_0, Path.GetFileName(rf.HintPath));
 
-						strRefFileName = Path.Combine (strBasePathGtkSharp, Path.GetFileName(rf.HintPath));
+						// Test to see if file exist in GAC location
+						if(System.IO.File.Exists(strRefFileName) == true) {
+							try {
+								rfOut.refto = System.Reflection.Assembly.LoadFrom(strRefFileName).FullName;
+								rfOut.type = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceType.Gac;
+								rfOut.localcopy = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceLocalcopy.True;
+								bIsWhereExpected = true;
+								// increment the iterator value
+								theReferences[i++] = rfOut;
+								continue;
+							} catch (Exception exc) {
+								Console.WriteLine (&quot;Error doing Assembly.LoadFrom with File: {0}\nErr Msg: {1}&quot;,
+									strRefFileName,
+									exc.Message );
+							}
+						}
 
+						//////////////////////////
+						// Check on Gecko# 1.0
+						strRefFileName = Path.Combine (strBasePathGeckoSharp, Path.GetFileName(rf.HintPath));
+
 						// Test to see if file exist in GAC location
 						if(System.IO.File.Exists(strRefFileName) == true) {
 							try {
@@ -732,6 +794,9 @@
 								rfOut.type = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceType.Gac;
 								rfOut.localcopy = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceLocalcopy.True;
 								bIsWhereExpected = true;
+								// increment the iterator value
+								theReferences[i++] = rfOut;
+								continue;
 							} catch (Exception exc) {
 								Console.WriteLine (&quot;Error doing Assembly.LoadFrom with File: {0}\nErr Msg: {1}&quot;,
 									strRefFileName,
@@ -744,11 +809,11 @@
 							rfOut.refto = Path.GetFileName(rf.HintPath);
 							rfOut.type = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceType.Gac;
 							rfOut.localcopy = MonoDevelop.Prj2Make.Schema.Prjx.ReferenceLocalcopy.True;
+							// increment the iterator value
+							theReferences[i++] = rfOut;
+							continue;
 						}
 					}
-
-					// increment the iterator value
-					theReferences[i++] = rfOut;
 				}
 				else
 				{
@@ -864,7 +929,7 @@
 			ExecutionObj.consolepause = &quot;True&quot;;
 
 			// OutputObj member population
-			OutputObj.directory = ConfigBlock.OutputPath;
+			OutputObj.directory = ConfigBlock.OutputPath.Replace(&quot;\\&quot;, &quot;/&quot;);
 			OutputObj.assembly = AssemblyName;
 			OutputObj.executeScript = &quot;&quot;;
 			OutputObj.executeBeforeBuild = &quot;&quot;;
Index: MdPrjHelper.cs
===================================================================
--- MdPrjHelper.cs	(revision 2360)
+++ MdPrjHelper.cs	(working copy)
@@ -136,6 +136,7 @@
     			slash = &quot;\\&quot;;
     		}
     
+    		string origDir = Directory.GetCurrentDirectory();
     		try
     		{
     			string d = Path.GetDirectoryName(slnFile);
@@ -361,6 +362,10 @@
     			Console.WriteLine(&quot;EXCEPTION: {0}\n&quot;, e);
     			return &quot;&quot;;
     		}
+    		finally
+    		{
+    			Directory.SetCurrentDirectory(origDir);
+    		}
     		
    			return MakefileBuilder.ToString();
     	}

--------------060706020907050904040704--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001766.html">[MonoDevelop] Import Visual Studio .NET Projects
</A></li>
	<LI> Next message: <A HREF="001783.html">[MonoDevelop] Import Visual Studio .NET Projects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1778">[ date ]</a>
              <a href="thread.html#1778">[ thread ]</a>
              <a href="subject.html#1778">[ subject ]</a>
              <a href="author.html#1778">[ author ]</a>
         </LI>
       </UL>
</body></html>
