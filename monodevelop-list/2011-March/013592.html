<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] Using struct with socket C#
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20Using%20struct%20with%20socket%20C%23&In-Reply-To=AANLkTi%3D_%3DyQmmQJ_ix3yzJ%3Djoud96J5ApEpVw3Ttgm2U%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013585.html">
   <LINK REL="Next"  HREF="013593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] Using struct with socket C#</H1>
    <B>Leonel Florin Selles</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20Using%20struct%20with%20socket%20C%23&In-Reply-To=AANLkTi%3D_%3DyQmmQJ_ix3yzJ%3Djoud96J5ApEpVw3Ttgm2U%40mail.gmail.com"
       TITLE="[MonoDevelop] Using struct with socket C#">leonel06013 at cfg.jovenclub.cu
       </A><BR>
    <I>Sun Mar 27 16:04:27 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013585.html">[MonoDevelop] The graphical resource manager
</A></li>
        <LI>Next message: <A HREF="013593.html">[MonoDevelop] Using struct with socket C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13592">[ date ]</a>
              <a href="thread.html#13592">[ thread ]</a>
              <a href="subject.html#13592">[ subject ]</a>
              <a href="author.html#13592">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi friend:

Well I have a problem here, I'm creating a socket application that have a
server and a client, and they share information in form of struct, I mean,
the server send an struct to the client and the client work with that
information and forward this information in the same struct to the server,

I'm using the Marshal class to convert the struct into a byte[] and I
prove this between to different struct in the same program, but, when I
send the struct transform it in to byte[] to the client, it get the byte[]
but when i try to use the marshal class to restore the byte[] in to struct
the program closes without explanation, an example of what I'm doing

the struct I'm use

public struct cliente
	{
		public string clientName;
		public int clientPid;
		public string host;
		public string bd;
		public string user;
		public string pass;
		public string usersCheck;
		public bool systemTryIcon;
		public string adminpass;
		public signals orden;
	}

and the two method to convert struct to byte[], and byte[] to struct

public class dataManager
{
    public static byte[] structToByte (Object structura)
	{
        	int size = Marshal.SizeOf (structura);
		IntPtr apuntador = Marshal.AllocHGlobal (size);
		byte[] datos = new byte[size];

		Marshal.StructureToPtr (structura, apuntador, false);
		Marshal.Copy (apuntador, datos, 0, size);
		Marshal.FreeHGlobal (apuntador);

		return datos;
	}
     public static System.Object ByteToStruct (byte[] listaByte, Type
tipoStruct)
	{
		int size = Marshal.SizeOf (tipoStruct);
		if (size &gt; listaByte.Length)
			return null;
		IntPtr apuntador = Marshal.AllocHGlobal (size);
		System.Object objeto = new Object ();

		Marshal.Copy (listaByte, 0, apuntador, size);
		objeto = Marshal.PtrToStructure (apuntador, tipoStruct);
		Marshal.FreeHGlobal (apuntador);

		return objeto;
	}
}

and using Socket to create the server and to conect the client

the server

Socket socketServer = new Socket (AddressFamily.InterNetwork,
SocketType.Stream, ProtocolType.IP);
socketServer.Bind (new IPEndPoint (IPAddress.Any, puerto));
socketServer.Listen (100);

the client

ocket cliente = new Socket (AddressFamily.InterNetwork, SocketType.Stream,
ProtocolType.IP);
cliente.Connect (&quot;localhost&quot;, 4069);

//converting the struct to byte[]......

cliente.Send (sendData, 0, sendData.Length, SocketFlags.None);


what can you tell my about?

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013585.html">[MonoDevelop] The graphical resource manager
</A></li>
	<LI>Next message: <A HREF="013593.html">[MonoDevelop] Using struct with socket C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13592">[ date ]</a>
              <a href="thread.html#13592">[ thread ]</a>
              <a href="subject.html#13592">[ subject ]</a>
              <a href="author.html#13592">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
