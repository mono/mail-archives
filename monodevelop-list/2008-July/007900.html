<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] VersionControl Add-in for Perforce
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20VersionControl%20Add-in%20for%20Perforce&In-Reply-To=aec34c770807011905q158fd034pf6db958d0876fdc3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007899.html">
   <LINK REL="Next"  HREF="007901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] VersionControl Add-in for Perforce</H1>
    <B>Casey Marshall</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20VersionControl%20Add-in%20for%20Perforce&In-Reply-To=aec34c770807011905q158fd034pf6db958d0876fdc3%40mail.gmail.com"
       TITLE="[MonoDevelop] VersionControl Add-in for Perforce">cmarshall at pacificbiosciences.com
       </A><BR>
    <I>Tue Jul  1 22:40:47 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="007899.html">[MonoDevelop] VersionControl Add-in for Perforce
</A></li>
        <LI>Next message: <A HREF="007901.html">[MonoDevelop] VersionControl Add-in for Perforce
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7900">[ date ]</a>
              <a href="thread.html#7900">[ thread ]</a>
              <a href="subject.html#7900">[ subject ]</a>
              <a href="author.html#7900">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2008-07-01 at 22:05 -0400, Michael Hutchinson wrote:
&gt;<i> On Tue, Jul 1, 2008 at 7:56 PM, Casey Marshall
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">cmarshall at pacificbiosciences.com</A>&gt; wrote:
</I>&gt;<i> &gt; Hi.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm looking to implement a VersionControl Add-in for MonoDevelop that
</I>&gt;<i> &gt; uses Perforce as the back-end, and had a few questions about VC and
</I>&gt;<i> &gt; Add-in development:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   - First, has someone already written such a thing? (I'm assuming not,
</I>&gt;<i> &gt; given Google's silence).
</I>&gt;<i> 
</I>&gt;<i> Nope. the only (successful/released) version control addin that I know
</I>&gt;<i> of is the SVN one in trunk.
</I>&gt;<i> 
</I>&gt;<i> &gt;   - It doesn't look like there's any way for MonoDevelop to figure out
</I>&gt;<i> &gt; that a particular solution/project/file/etc. is already under version
</I>&gt;<i> &gt; control -- I only see hooks to &quot;checkout&quot; and &quot;publish&quot; code. If this
</I>&gt;<i> &gt; doesn't exist, that would obviously be a neat feature.
</I>&gt;<i> 
</I>&gt;<i> It does do that. The real fun is all in the Repository instances that
</I>&gt;<i> the VersionControlSystem returns, which has (among many other things)
</I>&gt;<i> an IsVersioned (string localPath) method.
</I>&gt;<i> 
</I>&gt;<i> Take a look at <A HREF="http://anonsvn.mono-project.com/viewcvs/trunk/monodevelop/main/src/addins/VersionControl/MonoDevelop.VersionControl/MonoDevelop.VersionControl/Repository.cs?view=markup">http://anonsvn.mono-project.com/viewcvs/trunk/monodevelop/main/src/addins/VersionControl/MonoDevelop.VersionControl/MonoDevelop.VersionControl/Repository.cs?view=markup</A>
</I>&gt;<i> and the SVN implementation:
</I>&gt;<i> <A HREF="http://anonsvn.mono-project.com/viewcvs/trunk/monodevelop/main/src/addins/VersionControl/MonoDevelop.VersionControl.Subversion/MonoDevelop.VersionControl.Subversion/SubversionRepository.cs?view=markup">http://anonsvn.mono-project.com/viewcvs/trunk/monodevelop/main/src/addins/VersionControl/MonoDevelop.VersionControl.Subversion/MonoDevelop.VersionControl.Subversion/SubversionRepository.cs?view=markup</A>
</I>&gt;<i> 
</I>&gt;<i> &gt;   - Related to that, how does the VC add-in know that a solution is
</I>&gt;<i> &gt; under version control?
</I>&gt;<i> 
</I>&gt;<i> By asking the version control addins if the project file is under
</I>&gt;<i> version control GetRepositoryReference in VersionControlService, and
</I>&gt;<i> using the first one that returns a non-null Repository.
</I>&gt;<i> 
</I>
Oh, sweet. Thanks for the tip.

&gt;<i> &gt;   - I'd like to add a simple preference pane, which lets you globally
</I>&gt;<i> &gt; enable the Add-in. I presume this is easy to do, I just haven't looked
</I>&gt;<i> &gt; hard enough yet at how to do it.
</I>&gt;<i> 
</I>&gt;<i> Yes, that's pretty easy, but why can't it just be enabled with the
</I>&gt;<i> addin manager?
</I>&gt;<i> 
</I>
Yeah, point.

&gt;<i> &gt;   - Does RequestWritePermission do what I hope it does? As in, if a file
</I>&gt;<i> &gt; needs to be written by MonoDevelop, will this be called if the file is
</I>&gt;<i> &gt; not writable? This is clearly desirable, here, since Perforce leaves
</I>&gt;<i> &gt; un-checked-out files read-only. I don't see any other command in
</I>&gt;<i> &gt; Repository that ties to a &quot;check out this file for editing.&quot; (which, of
</I>&gt;<i> &gt; course, VC systems that are better than Perforce don't usually have, but
</I>&gt;<i> &gt; I'm working with what I'm stuck with)
</I>&gt;<i> 
</I>&gt;<i> That's a good question. The Repository does have Lock/Unlock methods,
</I>&gt;<i> but I ahve no idea if they are actually used. I'm pretty sure that a
</I>&gt;<i> lot of code in MD wouldn't respect this.
</I>&gt;<i> 
</I>&gt;<i> That said, any patches needed to make it work properly would be welcome :)
</I>&gt;<i> 
</I>&gt;<i> [I can't actually find RequestWritePermission]
</I>&gt;<i> 
</I>
It's actually RequestFileWritePermission. Perforce has separate
lock/unlock commands, which I'd like to try to support, too.

This is probably most important for project files, which seem to get
written just by being used, and I think Visual Studio's Perforce
integration checks these out automatically. For checking out normal
files, just having an item in the contextual menu to check the file out
for edit would be OK.

Related to this, is there a mechanism for adding a verb to the version
control menu for &quot;open for edit&quot; commands?

(writing that last paragraph, it occurs to me that &quot;no, except for
modifying MD and submitting a patch&quot; might be the answer, which is
acceptable, too)

&gt;<i> &gt;   - Is there a simple way to get a &quot;console,&quot; or some way to print out
</I>&gt;<i> &gt; what p4 commands are being run? I think the IProgressMonitor plugs into
</I>&gt;<i> &gt; one, but I don't get passed one with every command -- I'm implementing
</I>&gt;<i> &gt; this by just using the `p4' command-line program, and I'd like to have
</I>&gt;<i> &gt; this for debugging and monitoring.
</I>&gt;<i> 
</I>&gt;<i> Well, there's MonoDevelop.LoggingService.LogDebug (which can be
</I>&gt;<i> enabled using environemnt variables and directed to the console, a
</I>&gt;<i> file, and/or the internal message pad)
</I>&gt;<i> System.Diagnostics.Debug.WriteLine might be more approprate since
</I>&gt;<i> references to it get ignored if you compile without /d:DEBUG.
</I>&gt;<i> 
</I>
I'll look at LogDebug. The idea here is to emulate the &quot;console&quot; output
you get in the perforce GUI -- it actually writes a log of all its
commands as if they were being done on the command line, so I'd want
this enabled all the time, and having them appear in the message pad is
ideal.

&gt;<i> Also, if you can P/Invoke into some stable library, that'll be a *lot*
</I>&gt;<i> faster than constantly forking command-line processes. Dunno if
</I>&gt;<i> perforce supports this or not.
</I>&gt;<i> 
</I>
I don't think there is any programmatic API, through I saw references to
COM bindings on Windows. And yes, I agree :-)

Thanks.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007899.html">[MonoDevelop] VersionControl Add-in for Perforce
</A></li>
	<LI>Next message: <A HREF="007901.html">[MonoDevelop] VersionControl Add-in for Perforce
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7900">[ date ]</a>
              <a href="thread.html#7900">[ thread ]</a>
              <a href="subject.html#7900">[ subject ]</a>
              <a href="author.html#7900">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
