<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] T4 add-in
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20T4%20add-in&In-Reply-To=FB64337B-9557-4476-95F7-27309E9D0DC5%40sent.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010353.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] T4 add-in</H1>
    <B>Michael Hutchinson</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20T4%20add-in&In-Reply-To=FB64337B-9557-4476-95F7-27309E9D0DC5%40sent.com"
       TITLE="[MonoDevelop] T4 add-in">m.j.hutchinson at gmail.com
       </A><BR>
    <I>Wed Sep 30 14:09:47 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="010353.html">[MonoDevelop] T4 add-in
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10360">[ date ]</a>
              <a href="thread.html#10360">[ thread ]</a>
              <a href="subject.html#10360">[ subject ]</a>
              <a href="author.html#10360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Sep 30, 2009 at 3:38 AM, Brett Michael &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">klunket at sent.com</A>&gt; wrote:
&gt;<i> I'm interested to extend the current T4 functionality in MonoDevelop.
</I>&gt;<i> However, upon searching for examples of making add-ins, etc, I noticed
</I>&gt;<i> a couple of plugins where people had used less than optimal APIs, etc,
</I>&gt;<i> because they didn't know other ones existed.
</I>
Hopefully this is easier to avoid now we have the API overview for
basic APIs <A HREF="http://monodevelop.com/Developers/Articles/API_Overview">http://monodevelop.com/Developers/Articles/API_Overview</A>

&gt;<i> So that I can research what it would take further, can someone point
</I>&gt;<i> me in the correct place that I would hook to do the following:
</I>&gt;<i>
</I>&gt;<i> * Add T4 as a new file type (with a post-selection screen like the MVC
</I>&gt;<i> View one to select a master page)
</I>
Adding new file templates is pretty straightforward. Just look at some
*.xft.xml files and how they're registered in the .addin.xml files.

The post-selection screen isn't so easy, as it involved defining a
custom template type. I'd recommend waiting for after MD 2.2, because
we want to overhaul the file/project templating system and make it
much easier to have more complex scenarios like that. What do you need
it for in this case?

&gt;<i> * Run T4 on any .tt files, whenever they are saved (or on a pre-build
</I>&gt;<i> event, before code is compiled).
</I>
To hook into the build, implement and register a
ProjectServiceExtension and override one of its virtual methods.
Here's an explanation of how it works:
<A HREF="http://foodformonkeys.blogspot.com/2007/04/horizontal-extensions.html">http://foodformonkeys.blogspot.com/2007/04/horizontal-extensions.html</A>
See the ASP.NET addin for an example, the VerifyCodeBehindBuildStep,
which ensures codebehind files are updated before building.

If you want to run the T4 files on save, it probably makes sense to
have the T4EditorExtension subscribe to the document save event. Don't
forget to unsubscribe when the extension's disposed. This would also
be the place to look at for code completion (I stubbed some of it
out).

Regarding running the files, it's probably best to keep it simple and
just invoke the bundled TextTransform.exe file on them, or use a very
basic templating host. I'm not sure I'd want to commit to a
MD-specific template host API yes, especially one that gives access to
the MD API yet. Take a look at
MonoDevelop.AspNet.Mvc.Gui.FolderCommandHandler.AddView for an example
of running a template, though for more generic running of templates
the functionality could be implemented as a public API on the
TextTemplatingService, which could keep a re-usable templating
AppDomain around, recycle it every 10 templates or so, or close it if
hasn't been used for a minute.

After the files are written, you'd want to notify MD that the files
have changed using FileService.NotifyFileChanged, so that things like
the C# parser can pick up the changes. Alternatively you could use the
MonoDevelop.DesignerSupport.OpenDocumentFileProvider to get a file
handle that would also allow you to write into files that are open in
the text editor, and would automatically perform this notification for
you.

&gt;<i> * Add a context-menu option to .tt files that runs T4 on them.
</I>
Define a command and register it on the project pad's file content
menu (/MonoDevelop/Ide/ContextMenu/ProjectPad) with an ProjectFile
ItemType condition. The command handler can operate on the
IdeApp.ProjectOperations.CurrentSelectedItem (so the command can be
keybound and invoked without the context menu). Additionally it should
set enabled/visible to false when the CurrentSelectedItem is not a tt
file.

See e.g. MonoDevelop.AspNet.Deployment.ProjectDeployHandler for a
simple command handler. See also the sample at
<A HREF="http://monodevelop.com/Developers/Articles/Creating_a_Simple_Add-in">http://monodevelop.com/Developers/Articles/Creating_a_Simple_Add-in</A>

&gt;<i> * Create a &quot;code-behind&quot; style file hanging under any .tt file that
</I>&gt;<i> has been generated. I.e. if test.tt has test.cs as output, it would
</I>&gt;<i> appear hanging beneath test.tt
</I>
When running the tt file, add the output file to the project and set
its DependsOn property to the parent tt file. You could query the
ProjectDomService for the T4ParsedDocument in order to inspect the
output directives and determine the output filename.

&gt;<i> Let me know if any of that doesn't make sense. Superficially it seems
</I>&gt;<i> like a reasonably easy plugin that might let me give back to my
</I>&gt;<i> favourite IDE.
</I>
All make sense to me. Thanks for looking at it!

IMO it would make sense to do this directly in the existing T4 addin
rather than creating a new addin. I might even be able to sneak it
into 2.2...

-- 
Michael Hutchinson
<A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010353.html">[MonoDevelop] T4 add-in
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10360">[ date ]</a>
              <a href="thread.html#10360">[ thread ]</a>
              <a href="subject.html#10360">[ subject ]</a>
              <a href="author.html#10360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
