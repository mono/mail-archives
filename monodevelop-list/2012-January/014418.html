<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] debug data inspection algorithm [why is it so slow and faulty]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=Re%3A%20%5BMonoDevelop%5D%20debug%20data%20inspection%20algorithm%20%5Bwhy%20is%20it%20so%0A%20slow%20and%20faulty%5D&In-Reply-To=%3CCAMga9iRqNQTADAV-BxSNSTG43OFJVq7pyM4Tyigx4RY0djpbWg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014414.html">
   <LINK REL="Next"  HREF="014419.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] debug data inspection algorithm [why is it so slow and faulty]</H1>
    <B>Michael Hutchinson</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=Re%3A%20%5BMonoDevelop%5D%20debug%20data%20inspection%20algorithm%20%5Bwhy%20is%20it%20so%0A%20slow%20and%20faulty%5D&In-Reply-To=%3CCAMga9iRqNQTADAV-BxSNSTG43OFJVq7pyM4Tyigx4RY0djpbWg%40mail.gmail.com%3E"
       TITLE="[MonoDevelop] debug data inspection algorithm [why is it so slow and faulty]">m.j.hutchinson at gmail.com
       </A><BR>
    <I>Thu Jan 26 22:23:36 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="014414.html">[MonoDevelop] debug data inspection algorithm [why is it so slow	and faulty]
</A></li>
        <LI>Next message: <A HREF="014419.html">[MonoDevelop] ASP.net repeater template
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14418">[ date ]</a>
              <a href="thread.html#14418">[ thread ]</a>
              <a href="subject.html#14418">[ subject ]</a>
              <a href="author.html#14418">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20 January 2012 16:23, Jonathan Shore &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">jonathan.shore at gmail.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I want to know more about the algorithm / approach used in monodevelop when inspecting the value of locals. &#160; The data inspection in MonoDevelop is peculiar in that it is extraordinarily slow.
</I>&gt;<i>
</I>&gt;<i> Very often the debugger says &quot;Evaluating ...&quot;. &#160; Sometimes observing an integer local can take many seconds to come back and other times is more-or-less immediate. &#160; &#160;This slows down debugging enormously.
</I>&gt;<i>
</I>&gt;<i> Worse, sometimes it &quot;gives up&quot; and indicates &quot;Timed out&quot;. &#160;The timeouts tend to happen in the context of the debugger attempting to render large data structures or data structures that have a large ToString() representation. &#160; The time to actually generate strings for these structures if often very small, but perhaps the UI has difficulties in digesting. &#160; &#160;Once a timeout occurs on one variable, subsequent variables in a view (such as Locals) will also timeout, probably due to an overall time-limit on variable resolution.
</I>&gt;<i>
</I>&gt;<i> This tends not to happen much with trivial programs, but very often in large codebases. &#160; It makes debugging very painful or in some cases unfeasible such that have to move to windows / visual studio for debugging. &#160; &#160;The problem is much worse when attaching to an embedded application via the socket-based protocol (as one might expect).
</I>&gt;<i>
</I>&gt;<i> What is going on with inspection? &#160;Is it walking the stack for each variable or something like that? &#160; &#160;If I understand this better then can offer a &quot;bug&quot; report / feature improvement request that is more finely targetted.
</I>
TBH, it is REALLY complicated.

Once the debugger is stopped, at minimum the debugger inspects the
stack locals and any parameters on the stack. It may also have to
inspect objects in referred to by watches or inspection tooltips.
Getting these primitives or object references is very fast. Where it
gets slow is rendering things for displaying them &quot;correctly&quot;.

Rendering an object by default requires a ToString invocation, and
rendering a property requires invoking the getter method. If the type
has a DebuggerDisplayAttribute, then rendering it may require property
invocations. These invocations are the things that time out
(MonoDevelop aborts them if they take too long). You can disable
implicit evaluations or change the timeout in the debugger
preferences.

I would strongly recommend making sure MD and Mono are fully updated
to take advantage of some recent changes we made to batch the transfer
of metadata, to reduce chatter and suspend/resume overhead by only
subscribing to a subset of type load events, and to transfer truncated
values from long strings. I'm not sure offhand whether these were
backported to 2.10.x, they might only be on master.

Here are some other things that could potentially be improved:
* Have MonoDevelop retrieve debugger/type metadata from local copies
of the assemblies, instead of over the wire. We tried this, the gain
over batched metadata didn't seem worth the complexity.
* Batching invocations and value retrieval to reduce wire chatter (for
embedded targets, each TCP request/response could be 10ms).
* Implement a simple IL interpreter so that a subset of methods (e.g.
trivial property getters) could be interpreted client-side instead of
requiring invocation on the target.

Since the debugger is TCP/IP based, you might be able to use a
WireShark trace to figure out exactly what is slow in your case.

-- 
Michael Hutchinson
<A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014414.html">[MonoDevelop] debug data inspection algorithm [why is it so slow	and faulty]
</A></li>
	<LI>Next message: <A HREF="014419.html">[MonoDevelop] ASP.net repeater template
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14418">[ date ]</a>
              <a href="thread.html#14418">[ thread ]</a>
              <a href="subject.html#14418">[ subject ]</a>
              <a href="author.html#14418">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
