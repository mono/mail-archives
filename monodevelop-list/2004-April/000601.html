<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] Re: Souce files are UTF-8... are we sure?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:gs234%40srcf.ucam.org">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000574.html">
   <LINK REL="Next"  HREF="000602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] Re: Souce files are UTF-8... are we sure?
   </H1>
    <B>Gaute B Strokkenes
    </B> 
    <A HREF="mailto:gs234%40srcf.ucam.org"
       TITLE="[MonoDevelop] Re: Souce files are UTF-8... are we sure?">gs234@srcf.ucam.org
       </A><BR>
    <I>Sat, 10 Apr 2004 17:57:28 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="000574.html">[MonoDevelop] Souce files are UTF-8... are we sure?
</A></li>
        <LI> Next message: <A HREF="000602.html">[MonoDevelop] Re: Souce files are UTF-8... are we sure?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#601">[ date ]</a>
              <a href="thread.html#601">[ thread ]</a>
              <a href="subject.html#601">[ subject ]</a>
              <a href="author.html#601">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On  8 apr 2004, <A HREF="mailto:steve@citygroup.ca">steve@citygroup.ca</A> wrote:

&gt;<i> // src/Addins/DisplayBindings/SourceEditor/SourceEditorBuffer.cs:
</I>&gt;<i> public static SourceEditorBuffer CreateTextBufferFromFile (string filename)
</I>&gt;<i> {
</I>&gt;<i>   FileStream fs = new FileStream(filename, FileMode.Open);
</I>&gt;<i>   fs.Position = 0;
</I>&gt;<i>   byte[] preamble = Encoding.UTF8.GetPreamble();
</I>&gt;<i>   for (int j = 0; j &lt; preamble.Length; j++)
</I>&gt;<i>   {
</I>&gt;<i>     if (preamble[j] != fs.ReadByte())
</I>&gt;<i>     {
</I>&gt;<i>       System.Console.WriteLine(&quot;CreateTextBufferFromFile(): file is not
</I>&gt;<i> UTF-8. Skipping.&quot;);
</I>&gt;<i>       return (null);
</I>&gt;<i>     }
</I>&gt;<i>   }
</I>&gt;<i>   System.Console.WriteLine(&quot;CreateTextBufferFromFile(): file is UTF-8.
</I>&gt;<i> Loading into sourcebuffer...&quot;);
</I>&gt;<i>   SourceEditorBuffer buff = new SourceEditorBuffer ();
</I>&gt;<i>   buff.LoadFile (filename);
</I>&gt;<i>   return buff;
</I>&gt;<i> }
</I>&gt;<i> // end
</I>
This is the wrong way to autodetect UTF-8 encoded text in general.  If
you must autodetect then the correct way in general is to scan through
the entire file and verify that all the bytes correspond to valid
UTF-8 sequences.  (Valid UTF-8 sequences are very distinctive, so this
is highly unlikely to give you false positives.)

&gt;<i> Just before submitting the System.Text bugreport, however, I tried
</I>&gt;<i> running the same test case using those 2 Windows files on this
</I>&gt;<i> FC1/mono box. Lo and behold, it recognizes the .txt as UTF-8 (which
</I>&gt;<i> was set in Notepad) just fine.
</I>
You are quite unlikely to find a tool other than Windows Notepad that
adds the UTF-8 BOM preamble to UTF-8 text files.  The practise is
disrecommended because a magic cookie at the front of each file just
isn't plain-text compatible and causes a world of trouble down the
line.  (As stated above, if you need to autodetect then you don't need
it anyway.)

Have a look at: <A HREF="http://www.cl.cam.ac.uk/~mgk25/unicode.html#linux">http://www.cl.cam.ac.uk/~mgk25/unicode.html#linux</A>

That site is an excellent resource for all things unicode in the free
and open source software world, by the way.

--
Gaute Strokkenes                        <A HREF="http://www.srcf.ucam.org/~gs234/">http://www.srcf.ucam.org/~gs234/</A>
..  So, if we convert SUPPLY-SIDE SOYBEAN FUTURES into
 HIGH-YIELD T-BILL INDICATORS, the PRE-INFLATIONARY risks
 will DWINDLE to a rate of 2 SHOPPING SPREES per EGGPLANT!!

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000574.html">[MonoDevelop] Souce files are UTF-8... are we sure?
</A></li>
	<LI> Next message: <A HREF="000602.html">[MonoDevelop] Re: Souce files are UTF-8... are we sure?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#601">[ date ]</a>
              <a href="thread.html#601">[ thread ]</a>
              <a href="subject.html#601">[ subject ]</a>
              <a href="author.html#601">[ author ]</a>
         </LI>
       </UL>
</body></html>
