<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] Re: More detailed build response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tberman%40sevenl.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000543.html">
   <LINK REL="Next"  HREF="000541.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] Re: More detailed build response
   </H1>
    <B>Todd Berman
    </B> 
    <A HREF="mailto:tberman%40sevenl.net"
       TITLE="[MonoDevelop] Re: More detailed build response">tberman@sevenl.net
       </A><BR>
    <I>Sun, 04 Apr 2004 16:00:02 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="000543.html">[MonoDevelop] Re: More detailed build response
</A></li>
        <LI> Next message: <A HREF="000541.html">[MonoDevelop] Error when compiling projects from within monodevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#544">[ date ]</a>
              <a href="thread.html#544">[ thread ]</a>
              <a href="subject.html#544">[ subject ]</a>
              <a href="author.html#544">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Comments inline

On Sun, 2004-04-04 at 14:28 -0400, Miguel de Icaza wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> &gt; //I assume by this you also mean probing for required assemblies.
</I>&gt;<i> &gt; //This is something we should add some automation for. For example, if
</I>&gt;<i> &gt; //I add gtksourceview-sharp as a reference to my project, the build
</I>&gt;<i> &gt; //system needs to be smart enough to add this to my build requirements
</I>&gt;<i> &gt; //
</I>&gt;<i> &gt; //What are we going to be doing to support existing auto* build
</I>&gt;<i> &gt; //systems. Will there be an easy way to run make on a certain
</I>&gt;<i> &gt; //directory?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; We want applications to be self contained, so running an application
</I>&gt;<i> &gt; within MonoDevelop will not cause a full make/make install process to be
</I>&gt;<i> &gt; triggered before it can be executed. 
</I>&gt;<i> 
</I>&gt;<i> Yes, that is what it means: to probe for functionality.
</I>&gt;<i> 
</I>&gt;<i> I have chosen pkg-config to probe, since it is something that the
</I>&gt;<i> configure script that we would generate could easily probe for, and
</I>&gt;<i> integrates with the existing probing systems.
</I>&gt;<i> 
</I>&gt;<i> The makefiles on each directory would be self-contained, so you can type
</I>&gt;<i> `make' to build that directory.
</I>&gt;<i> 
</I>&gt;<i> &gt; //Will this be accomplished with something similar to the build/
</I>&gt;<i> &gt; //directory in MD, or will we be doing something different?
</I>&gt;<i> 
</I>&gt;<i> I honestly need input here.  I would personally leave the binaries on
</I>&gt;<i> each directory, but this might not be ideal.
</I>&gt;<i> 
</I>&gt;<i> A few scenarios:
</I>&gt;<i> 
</I>&gt;<i> 	Visual Studio builds into Bin/Debug and Bin/Release, 
</I>&gt;<i> 	one per project.  I do not quite like this setup, I find it
</I>&gt;<i> 	too nested for my taste.
</I>&gt;<i> 
</I>
I agree with this completely

&gt;<i> 	Using a common directory for placing all the files like MD,
</I>&gt;<i> 	this seems fairly clean, but complicates the `run' target.
</I>&gt;<i> 
</I>
I think it simplifies the run target, but complicates the building, make
run for MD is basically a cd ; mono MonoDevelop.exe. it doesnt get much
simpler than that.

&gt;<i> 	Using the current directory to generate the .exe or .dll seems
</I>&gt;<i> 	the most Unix-y way of doing things.
</I>&gt;<i> 
</I>
Well, you have to keep in mind that peoples installed image (lets call
it mono.app just to draw the obvious parallel and make it easy to type,
and by this i mean their fake root, like MonoDevelop's build/) might
need to change over time, and requiring people to lose cvs history / do
surgery is not acceptable.

Also, having a mono.app type setup would allow for a simple xcopy deploy
(in 99% of the cases).

&gt;<i> &gt; //I think we should be adding a third file for this. Another thing
</I>&gt;<i> &gt; //to keep in mind with adding this info to the cmbx file is the
</I>&gt;<i> &gt; //ability to reuse projects.
</I>&gt;<i> &gt; //
</I>&gt;<i> &gt; //Projects themselves should be self contained and know how to build
</I>&gt;<i> &gt; //themselves, so that you can use them from multiple solutions.
</I>&gt;<i> 
</I>&gt;<i> I honestly do not know enough about .cmbx files, or the existing setup,
</I>&gt;<i> can you present what we have today?
</I>&gt;<i> 
</I>
Ok, here is the issue. Solutions (cmbx) contain projects. Projects build
a single assembly, either a dll or an exe. The project needs to know how
to build itself, the solution 'make' (both on the shell, and inside MD)
should just iterate through the projects, gather info, and write the
general solution wide stuff (configure, etc). or potentially the
solution would be basically a wrapper around descending into projects
and calling configure, or make, make install, etc.

Does that make sense?

&gt;<i> &gt; //I assume you mean that we can write one (huge) configure script
</I>&gt;<i> &gt; //that we package with MD and then copy into the solutions top
</I>&gt;<i> &gt; //level folder. If so, what are we planning on writing this in?
</I>&gt;<i> &gt; //Also, are we going to use standard configurelike switches, such
</I>&gt;<i> &gt; //as --prefix, --disable-xxxx, --enable-xxxx, etc.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; //Will this configure script allow for complicated conditional
</I>&gt;<i> &gt; //switching? (ie, if this lib is present, build yyy, if not, check
</I>&gt;<i> &gt; //for this other library, and do zzz, and if nothing is there, error
</I>&gt;<i> &gt; //out with this info).
</I>&gt;<i> 
</I>&gt;<i> Well, the configure script is automatically generated from the project
</I>&gt;<i> options: optional dependencies listed, libraries required, and projects
</I>&gt;<i> in the solution.  
</I>&gt;<i> 
</I>&gt;<i> The resulting output should be plain shell.   The resulting script
</I>&gt;<i> should use configure-like scripts, it only makes sense.
</I>&gt;<i> 
</I>&gt;<i> I do not know if we want to do more complicated conditional building
</I>&gt;<i> beyond a simple layer, because UI wise, we would enter research land,
</I>&gt;<i> and my intent is to have something working first.
</I>&gt;<i> 
</I>
Absolutely, but is there an intended eventual design to support
something like this, or is beyond the scope?

&gt;<i> Doing a setup that handles every possible combination in the world is
</I>&gt;<i> going to be a gargantuan task, so my focus on this design is to address
</I>&gt;<i> common setups, not every setup.
</I>
Keep in mind that this build system needs to be self hosting. Which
means it has to handle some non-normal stuff. Like installing into
different prefixes (handle gnome stuff), c code, gettext installation
(generating gmo files from po). I am potentially willing to have a build
system inside MD that is not and never will be self hosting. However
right now I see no benefit in breaking up the MonoDevelop module, as
that would start to require either svn parallel checkouts (ala monodoc/
mcs) or requiring make install.

&gt;<i> 
</I>&gt;<i> &gt; //What about when you need to use C, as many projects do (MD included)
</I>&gt;<i> &gt; //Will we attempt to rewrite auto* for them, or encourage the use of
</I>&gt;<i> &gt; //auto* seperately and add hooks?
</I>&gt;<i> &gt; //
</I>&gt;<i> &gt; //The ability to compile C is a must-have for this build system, as
</I>&gt;<i> &gt; //designing something that is unable to self host is not good.
</I>&gt;<i> 
</I>&gt;<i> If they can be built completely with the pkg-config results, that can be
</I>&gt;<i> handled.  If not, I would encourage the C components to be split into a
</I>&gt;<i> separate module, that can be pkg-config for, and that has all the
</I>&gt;<i> autoconf/automake bells and whistles it needs.
</I>&gt;<i> 
</I>
again, see above.

&gt;<i> &gt; //Why not allow for more targets? make dist seems reasonable, as does
</I>&gt;<i> &gt; //make test for running tests. Potentially allowing people to append
</I>&gt;<i> &gt; //content to the makefiles and add their own should be supported.
</I>&gt;<i> 
</I>&gt;<i> I guess it could be added, I do not see why not (other than UI issues,
</I>&gt;<i> and obscure side effects).
</I>&gt;<i> 
</I>
initially the ui could be as simple as a text box that adds text to the
end of the makefile. Potentially this could be greyed out with an
applicable warning about how you could break stuff, and to watch out,
dont screw with it without good reason, and whatever you are doing might
be something the current build system should do, so file a bug and see
what happens before screwing stuff up.

&gt;<i> &gt; 
</I>&gt;<i> &gt; //I assume there will be support for flagging files as 'dont build'?
</I>&gt;<i>
</I>&gt;<i> Can you give me an example?
</I>
Lets say inside a library i have a file that is a Main.cs to do some
testing using this library. Obviously I only want that build when my
build configuration is 'TestServer', or whatever. That would be a file
flagged as 'dont build this'.

That also brings up another point, currently we support n build
configurations. That is something that I think might be worth
supporting, any thoughts?

&gt;<i> 
</I>&gt;<i> &gt; //I assume there will be gui for all this, where will this gui be
</I>&gt;<i> &gt; //located?
</I>&gt;<i> 
</I>&gt;<i> This is autogenerated.  I do not understand your question.
</I>&gt;<i> 
</I>
I mean, have you thought at all about how you are going to arrange the
gui representation of this configurability, or is completely beyond the
current scope (i assume it is).

&gt;<i> &gt; //Will we add support for libraries that this build system produces
</I>&gt;<i> &gt; //to automatically produce an up to date .pc file and install it?
</I>&gt;<i> 
</I>&gt;<i> Fantastic idea.
</I>&gt;<i> 
</I>
Ok, this generating .pc file support needs to be project bound, not
solution bound. In fact, the more i think about this, most of this stuff
needs to be project bound, the solution is a simple wrapper with a
'default start target' attribute.

&gt;<i> 
</I>&gt;<i> &gt; //What exactly is the point of this file? to basically provide
</I>&gt;<i> &gt; //#if ENABLE_XXXX support?
</I>&gt;<i> 
</I>&gt;<i> Yup.
</I>&gt;<i> 
</I>&gt;<i> &gt; //What about make distcheck, considering that unless we rewrite auto*
</I>&gt;<i> &gt; //for the bundled c code, people using auto* for c might want to at
</I>&gt;<i> &gt; //least allow that code to be make distcheck'd somehow
</I>&gt;<i> &gt; //
</I>&gt;<i> &gt; //Also, i assume this will output a proper .tar.gz will all the
</I>&gt;<i> &gt; //needed stuff.
</I>&gt;<i> 
</I>&gt;<i> make distcheck is required when a human is required to intervene to
</I>&gt;<i> maintain the files that make up a distribution, to ensure that the human
</I>&gt;<i> did not make a mistake.
</I>&gt;<i> 
</I>&gt;<i> If we are not packaging things completely, it would be a build system
</I>&gt;<i> bug, not a user bug, so we must fix it ourselves.
</I>&gt;<i> 
</I>&gt;<i> That being said, we could have a target like `distcheck' aimed as a
</I>&gt;<i> regression test for our build setup.
</I>&gt;<i> 
</I>&gt;<i> &gt; //personally, i think this is *completely* outside the scope of a 
</I>&gt;<i> &gt; //build system.
</I>&gt;<i> &gt; //potentially providing hooks for this would be more than enough
</I>&gt;<i> &gt; //as every packagers requirements are completely different, and
</I>&gt;<i> &gt; //9 times out of 10, people dont package the apps they develop
</I>&gt;<i> &gt; //beyond simple tarballs.
</I>&gt;<i> 
</I>&gt;<i> Open Source developers do not package anything beyond simple tarballs.
</I>&gt;<i> 
</I>&gt;<i> Proprietary developers (which we hope to attract) would like to have a
</I>&gt;<i> way of building binary packages.
</I>&gt;<i> 
</I>&gt;<i> Either RPM or some other form of self-installable software, and I think
</I>&gt;<i> it is a big plus.
</I>&gt;<i> 
</I>
I agree here, but I think supporting tarballs should be our #1 goal, and
then add the rpms or other software later.

&gt;<i> Miguel
</I>
My question here:

//Also, how will items such as xml files, or images that need to be
//in a specific location be handled? I know below you address this
//partially with the ability to embed, but not all applications
//will want to use this functionality. And both should be supported

seemed to go unanswered.

Other misc things:

What about running multiple executables on one make run? That seems like
something that should at least be possible. make run should also be
potentially build configuration bound if we support multiple build
configurations. (Useful for stuff outside of debug and release, i
swear! ;) )

I know i am forgetting something else, but I will send a new email when
i figure it out :)

--Todd


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000543.html">[MonoDevelop] Re: More detailed build response
</A></li>
	<LI> Next message: <A HREF="000541.html">[MonoDevelop] Error when compiling projects from within monodevelop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#544">[ date ]</a>
              <a href="thread.html#544">[ thread ]</a>
              <a href="subject.html#544">[ subject ]</a>
              <a href="author.html#544">[ author ]</a>
         </LI>
       </UL>
</body></html>
