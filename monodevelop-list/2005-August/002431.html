<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] Dummy ODBC db provider for Mono.Data.Sql
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20Dummy%20ODBC%20db%20provider%20for%20Mono.Data.Sql&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002430.html">
   <LINK REL="Next"  HREF="002432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] Dummy ODBC db provider for Mono.Data.Sql</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20Dummy%20ODBC%20db%20provider%20for%20Mono.Data.Sql&In-Reply-To="
       TITLE="[MonoDevelop] Dummy ODBC db provider for Mono.Data.Sql">danielmorgan at verizon.net
       </A><BR>
    <I>Sun Aug 21 01:31:35 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002430.html">[MonoDevelop] Tests for Db providers in Mono.Data.Sql
</A></li>
        <LI>Next message: <A HREF="002432.html">[MonoDevelop] mac os x 10.4.2 monodevelop installation failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2431">[ date ]</a>
              <a href="thread.html#2431">[ thread ]</a>
              <a href="subject.html#2431">[ subject ]</a>
              <a href="author.html#2431">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have attached an ODBC db provider for MonoQuery add-in.

It is a dummy db provider since it does not have any implementation.  
Implementation would require someone to create various DllImports to 
ODBC to get various info such as tables and table columns.  
System.Data.Odbc does not expose this capability.

ODBC provider has not been added to the Makefile since it's not ready.

Can this be added to svn in MonoDevelop please?


-------------- next part --------------
//
// Provider/OdbcDbProvider.cs
//
// Authors:
//   Christian Hergert	&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">chris at mosaix.net</A>&gt;
//   Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">danielmorgan at verizon.net</A>&gt;
//
// Copyright (C) 2005 Mosaix Communications, Inc.
// Copyright (C) 2005 Daniel Morgan
//
// Permission is hereby granted, free of charge, to any person obtaining
// a copy of this software and associated documentation files (the
// &quot;Software&quot;), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do so, subject to
// the following conditions:
// 
// The above copyright notice and this permission notice shall be
// included in all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//

using System;
using System.Collections;
using System.Data;
using System.Text;
using System.Text.RegularExpressions;

using System.Data.Odbc;

namespace Mono.Data.Sql
{
	/// &lt;summary&gt;
	/// Mono.Data.Sql provider for PostgreSQL databases.
	/// &lt;/summary&gt;
	[Serializable]
	public class OdbcDbProvider : DbProviderBase
	{
		protected OdbcConnection connection = null;
		protected OdbcDataAdapter adapter = new OdbcDataAdapter();
		protected bool isConnectionStringWrong = false;
		
		/// &lt;summary&gt;
		/// Default Constructor
		/// &lt;/summary&gt;
		public OdbcDbProvider () : base ()
		{
		}
		
		public override string ProviderName {
			get {
				return &quot;Provider for ODBC Data Sources&quot;;
			}
		}
		
		/// &lt;summary&gt;
		/// Constructor with ADO.NET ODBC connection.
		/// &lt;/summary&gt;
		public OdbcDbProvider (OdbcConnection conn)
		{
			connection = conn;
		}
		
		/// &lt;summary&gt;
		/// ADO.NET Connection
		/// &lt;/summary&gt;
		public override IDbConnection Connection {
			get {
				if (connection == null)
					connection = new OdbcConnection();
				
				return (IDbConnection) connection;
			}
		}
		
		/// &lt;summary&gt;
		/// Connection String
		/// &lt;/summary&gt;
		public override string ConnectionString {
			get {
				return Connection.ConnectionString;
			}
			set {
				if (IsOpen == true)
					Close();
				
				Connection.ConnectionString = value;
				isConnectionStringWrong = false;
			}
		}
		
		/// &lt;summary&gt;
		/// Is the connection open
		/// &lt;/summary&gt;
		public override bool IsOpen {
			get {
				return Connection.State == ConnectionState.Open;
			}
		}
		
		/// &lt;summary&gt;
		/// Is the last used connection string wrong
		/// &lt;/summary&gt;
		public override bool IsConnectionStringWrong {
			get {
				return isConnectionStringWrong;
			}
		}
		
		/// &lt;summary&gt;
		/// Open the connection. Returns true on success.
		/// &lt;/summary&gt;
		public override bool Open()
		{
			try {
				Connection.Open();
			} catch {
				isConnectionStringWrong = true;
			}
			OnOpen ();
			return IsOpen;
		}
		
		/// &lt;summary&gt;
		/// Close the database connection.
		/// &lt;/summary&gt;
		public override void Close()
		{
			Connection.Close();
			OnClose();
		}
		
		/// &lt;summary&gt;
		/// Do we support the passed schema type
		/// &lt;/summary&gt;
		public override bool SupportsSchemaType(Type type)
		{
			if (type == typeof(TableSchema))
				return true;
			else if (type == typeof(ViewSchema))
				return true;
			else if (type == typeof(ProcedureSchema))
				return true;
			else if (type == typeof(AggregateSchema))
				return true;
			else if (type == typeof(GroupSchema))
				return true;
			else if (type == typeof(UserSchema))
				return true;
			else if (type == typeof(LanguageSchema))
				return true;
			else if (type == typeof(OperatorSchema))
				return true;
			else if (type == typeof(RoleSchema))
				return true;
			else if (type == typeof(SequenceSchema))
				return true;
			else if (type == typeof(DataTypeSchema))
				return true;
			else if (type == typeof(TriggerSchema))
				return true;
			else if (type == typeof(ColumnSchema))
				return true;
			else if (type == typeof(ConstraintSchema))
				return true;
			else if (type == typeof(RuleSchema))
				return true;
			else
				return false;
		}
		
		/// &lt;summary&gt;
		/// Thread safe SQL execution.
		/// &lt;/summary&gt;
		public override DataTable ExecuteSQL(string SQLText)
		{
			OdbcCommand command = new OdbcCommand();
			command.Connection = connection;
			command.CommandText = SQLText;

			DataSet resultSet = new DataSet ();

			lock(adapter) {
				adapter.SelectCommand = command;
				adapter.Fill(resultSet);
			}

			return resultSet.Tables[0];
		}
		
		/// &lt;summary&gt;
		/// Get a list of tables in the system.
		/// &lt;/summary&gt;
		public override TableSchema[] GetTables()
		{
			if (IsOpen == false &amp;&amp; Open () == false)
				throw new InvalidOperationException (&quot;Invalid connection&quot;);
			
			ArrayList collection = new ArrayList ();
			// TODO:
			return (TableSchema[]) collection.ToArray (typeof (TableSchema));
		}
		
		/// &lt;summary&gt;
		/// Get columns for a table.
		/// &lt;/summary&gt;
		public override ColumnSchema[] GetTableColumns(TableSchema table)
		{
			if (IsOpen == false &amp;&amp; Open () == false)
				throw new InvalidOperationException (&quot;Invalid connection&quot;);
			
			ArrayList collection = new ArrayList();
			// TODO:
			return (ColumnSchema[]) collection.ToArray(typeof(ColumnSchema));
		}

		/// &lt;summary&gt;
		/// Get a collection of views from the system.
		/// &lt;/summary&gt;
		public override ViewSchema[] GetViews()
		{
			ArrayList collection = new ArrayList();
			// TODO:
			return (ViewSchema[]) collection.ToArray (typeof (ViewSchema));
		}
		
		/// &lt;summary&gt;
		/// Get a collection of columns within a view
		/// &lt;/summary&gt;
		public override ColumnSchema[] GetViewColumns(ViewSchema view)
		{
			if (IsOpen == false &amp;&amp; Open() == false)
				throw new Exception (&quot;No connection to database&quot;);
			
			ArrayList collection = new ArrayList();
			// TODO:			
			
			return (ColumnSchema[]) collection.ToArray (typeof(ColumnSchema));
		}
		
		/// &lt;summary&gt;
		/// Get a collection of constraints within a a table.
		/// &lt;/summary&gt;
		public override ConstraintSchema[] GetTableConstraints (TableSchema table)
		{
			if (IsOpen == false &amp;&amp; Open () == false)
				throw new InvalidOperationException (&quot;Invalid connection&quot;);
			
			ArrayList collection = new ArrayList ();
			// TODO:			
			
			return (ConstraintSchema[]) collection.ToArray (typeof(ConstraintSchema));
		}
		
		public override UserSchema[] GetUsers ()
		{
			if (IsOpen == false &amp;&amp; Open () == false)
				throw new InvalidOperationException (&quot;Invalid connection&quot;);
			
			ArrayList collection = new ArrayList ();
			// TODO:			
			return (UserSchema[]) collection.ToArray (typeof (UserSchema));
		}
		
		public override ProcedureSchema[] GetProcedures ()
		{
			if (IsOpen == false &amp;&amp; Open () == false)
				throw new InvalidOperationException (&quot;Invalid connection&quot;);
			
			ArrayList collection = new ArrayList ();
			
			// TODO:			
			return (ProcedureSchema[]) collection.ToArray (typeof (ProcedureSchema)); 
		}
		
		public override ColumnSchema[] GetProcedureColumns (ProcedureSchema schema)
		{
			if (IsOpen == false &amp;&amp; Open () == false)
				throw new InvalidOperationException (&quot;Invalid connection&quot;);
			
			ArrayList collection = new ArrayList ();
			// TODO:						
			return (ColumnSchema[]) collection.ToArray (typeof (ColumnSchema));
		}
	}
}

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002430.html">[MonoDevelop] Tests for Db providers in Mono.Data.Sql
</A></li>
	<LI>Next message: <A HREF="002432.html">[MonoDevelop] mac os x 10.4.2 monodevelop installation failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2431">[ date ]</a>
              <a href="thread.html#2431">[ thread ]</a>
              <a href="subject.html#2431">[ subject ]</a>
              <a href="author.html#2431">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
