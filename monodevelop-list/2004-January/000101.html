<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] RE:more compilation problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tberman%40sevenl.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000099.html">
   <LINK REL="Next"  HREF="000102.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] RE:more compilation problems
   </H1>
    <B>Todd Berman
    </B> 
    <A HREF="mailto:tberman%40sevenl.net"
       TITLE="[MonoDevelop] RE:more compilation problems">tberman@sevenl.net
       </A><BR>
    <I>Wed, 21 Jan 2004 17:03:08 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="000099.html">[MonoDevelop] RE:more compilation problems
</A></li>
        <LI> Next message: <A HREF="000102.html">[MonoDevelop] Possible mono bug.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101">[ date ]</a>
              <a href="thread.html#101">[ thread ]</a>
              <a href="subject.html#101">[ subject ]</a>
              <a href="author.html#101">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>These are all legal in cvs, and the attribute has to be legal on .NET
cause its what #D uses and compiles with on windows :)

For MD you *must* be using mono and gtk-sharp from cvs for right now.

I know this is an inconveinence, but we needed patches in both to get
working what we have :)

--Todd

On Wed, 2004-01-21 at 16:37, Blair Jennings wrote:
&gt;<i> Here are the two main compile fixes. I came across these yesterday after 
</I>&gt;<i> doing a totally clean rebuild of my box (I have been out of town for the 
</I>&gt;<i> last week and a half). I checked the MenuItemCodon.cs against the .NET 
</I>&gt;<i> spec and the attribute was defined wrong (calling for as new char() is 
</I>&gt;<i> illegal in an attribute). The ConvertXml.cs issue is one of 
</I>&gt;<i> appropriateness the call in the one in the svn repository is .NET 
</I>&gt;<i> version 1.1 but mono 0.29 is still .NET 1.0 for the System.Xml.Xsl 
</I>&gt;<i> Namespace (I have confirmed this in the Ximian CVS for mcs).
</I>&gt;<i> 
</I>&gt;<i> Blair Jennings
</I>&gt;<i> 
</I>&gt;<i> ______________________________________________________________________
</I>&gt;<i> // &lt;file&gt;
</I>&gt;<i> //     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt"/">prj:///doc/copyright.txt&quot;/</A>&gt;
</I>&gt;<i> //     &lt;license see=&quot;<A HREF="prj:///doc/license.txt"/">prj:///doc/license.txt&quot;/</A>&gt;
</I>&gt;<i> //     &lt;owner name=&quot;Mike Krger&quot; email=&quot;<A HREF="mailto:mike@icsharpcode.net">mike@icsharpcode.net</A>&quot;/&gt;
</I>&gt;<i> //     &lt;version value=&quot;$version&quot;/&gt;
</I>&gt;<i> // &lt;/file&gt;
</I>&gt;<i> 
</I>&gt;<i> using System;
</I>&gt;<i> using System.IO;
</I>&gt;<i> using System.Xml;
</I>&gt;<i> using System.Xml.XPath;
</I>&gt;<i> using System.Xml.Xsl;
</I>&gt;<i> using System.Security;
</I>&gt;<i> using System.Security.Permissions;
</I>&gt;<i> 
</I>&gt;<i> namespace ICSharpCode.SharpDevelop.Internal.Project
</I>&gt;<i> {
</I>&gt;<i> 	/// &lt;summary&gt;
</I>&gt;<i> 	/// This class is used to convert xml files using xslt
</I>&gt;<i> 	/// &lt;/summary&gt;
</I>&gt;<i> 	public class ConvertXml
</I>&gt;<i> 	{
</I>&gt;<i> 		/// &lt;remarks&gt;
</I>&gt;<i> 		/// The main module loads the three required input vars
</I>&gt;<i> 		/// and performs the transform
</I>&gt;<i> 		/// &lt;/remarks&gt;
</I>&gt;<i> 		/// &lt;param name=&quot;args&quot;&gt;
</I>&gt;<i> 		/// arg1 - the input file (preferably VS.NET .csproj)
</I>&gt;<i> 		/// arg2 - path to XSL transform file
</I>&gt;<i> 		/// arg3 - path to output file (preferably SD .prjx)
</I>&gt;<i> 		/// &lt;/param&gt;
</I>&gt;<i> 		public static void Convert(string inputFile, string xslPath, string outputFile)
</I>&gt;<i> 		{
</I>&gt;<i> 			Convert(inputFile, xslPath, outputFile, null);
</I>&gt;<i> 		}
</I>&gt;<i> 		public static void Convert(string inputFile, string xslPath, string outputFile, XsltArgumentList xsltArgList)
</I>&gt;<i> 		{
</I>&gt;<i> 			// Transform the file
</I>&gt;<i> 			XmlReader reader = GetXML(inputFile);
</I>&gt;<i> 			XmlReader oTransformed = TransformXmlToXml(reader, xslPath, xsltArgList);
</I>&gt;<i> 			reader.Close();
</I>&gt;<i> 			
</I>&gt;<i> 			// Output results to file path
</I>&gt;<i> 			XmlDocument myDoc = new XmlDocument();
</I>&gt;<i> 			myDoc.Load(oTransformed);
</I>&gt;<i> 			myDoc.Save(outputFile);
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public static void Convert(string inputFile, XmlReader xslReader, string outputFile, XsltArgumentList xsltArgList)
</I>&gt;<i> 		{
</I>&gt;<i> 			// Transform the file
</I>&gt;<i> 			XmlReader reader = GetXML(inputFile);
</I>&gt;<i> 			XmlReader oTransformed = TransformXmlToXml(reader, xslReader, xsltArgList);
</I>&gt;<i> 			reader.Close();
</I>&gt;<i> 			
</I>&gt;<i> 			// Output results to file path
</I>&gt;<i> 			XmlDocument myDoc = new XmlDocument();
</I>&gt;<i> 			myDoc.Load(oTransformed);
</I>&gt;<i> 			myDoc.Save(outputFile);
</I>&gt;<i> 		}
</I>&gt;<i> 
</I>&gt;<i> 		public static string ConvertToString(string inputFile, string xslPath)
</I>&gt;<i> 		{
</I>&gt;<i> 			return ConvertToString(inputFile, xslPath, null);
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public static string ConvertToString(string inputFile, string xslPath, XsltArgumentList xsltArgList)
</I>&gt;<i> 		{
</I>&gt;<i> 			// Transform the file
</I>&gt;<i> 			XmlReader reader = GetXML(inputFile);
</I>&gt;<i> 			XmlReader oTransformed = TransformXmlToXml(reader, xslPath, xsltArgList);
</I>&gt;<i> 			reader.Close();
</I>&gt;<i> 			
</I>&gt;<i> 			// Output results to string
</I>&gt;<i> 			XmlDocument myDoc = new XmlDocument();
</I>&gt;<i> 			myDoc.Load(oTransformed);
</I>&gt;<i> 			StringWriter sw = new StringWriter();
</I>&gt;<i> 			myDoc.Save(sw);
</I>&gt;<i> 			return sw.ToString();
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public static string ConvertData(string inputXml, string xslPath, XsltArgumentList xsltArgList)
</I>&gt;<i> 		{
</I>&gt;<i> 			XmlReader reader = new XmlTextReader(new StringReader(inputXml));
</I>&gt;<i> 			XmlReader oTransformed = TransformXmlToXml(reader, xslPath, xsltArgList);
</I>&gt;<i> 			reader.Close();
</I>&gt;<i> 			
</I>&gt;<i> 			// Output results to string
</I>&gt;<i> 			XmlDocument myDoc = new XmlDocument();
</I>&gt;<i> 			myDoc.Load(oTransformed);
</I>&gt;<i> 			StringWriter sw = new StringWriter();
</I>&gt;<i> 			myDoc.Save(sw);
</I>&gt;<i> 			return sw.ToString();
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public static string ConvertData(string inputXml, XmlReader xslReader, XsltArgumentList xsltArgList)
</I>&gt;<i> 		{
</I>&gt;<i> 			XmlReader reader = new XmlTextReader(new StringReader(inputXml));
</I>&gt;<i> 			XmlReader oTransformed = TransformXmlToXml(reader, xslReader, xsltArgList);
</I>&gt;<i> 			reader.Close();
</I>&gt;<i> 			
</I>&gt;<i> 			// Output results to string
</I>&gt;<i> 			XmlDocument myDoc = new XmlDocument();
</I>&gt;<i> 			myDoc.Load(oTransformed);
</I>&gt;<i> 			StringWriter sw = new StringWriter();
</I>&gt;<i> 			myDoc.Save(sw);
</I>&gt;<i> 			return sw.ToString();
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public static XmlReader TransformXmlToXml(XmlReader oXML, string XSLPath, XsltArgumentList xsltArgList)
</I>&gt;<i> 		{
</I>&gt;<i> 			XslTransform xslt = new XslTransform();
</I>&gt;<i> 			xslt.Load(XSLPath);
</I>&gt;<i> 			
</I>&gt;<i> 			XPathDocument inputData = new XPathDocument(oXML);
</I>&gt;<i> 			xslt.XmlResolver = new XmlSecureResolver(new XmlUrlResolver(), new PermissionSet(PermissionState.Unrestricted));
</I>&gt;<i> 			
</I>&gt;<i> 			return xslt.Transform(inputData, xsltArgList);
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public static XmlReader TransformXmlToXml(XmlReader oXML, XmlReader XSLReader, XsltArgumentList xsltArgList)
</I>&gt;<i> 		{
</I>&gt;<i> 			XslTransform xslt = new XslTransform();
</I>&gt;<i> 			xslt.Load(XSLReader, new XmlSecureResolver(new XmlUrlResolver(), new PermissionSet(PermissionState.Unrestricted)), null);
</I>&gt;<i> 			
</I>&gt;<i> 			XPathDocument inputData = new XPathDocument(oXML);
</I>&gt;<i> 			xslt.XmlResolver = new XmlSecureResolver(new XmlUrlResolver(), new PermissionSet(PermissionState.Unrestricted));
</I>&gt;<i> 			return xslt.Transform(inputData, xsltArgList);
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		/// &lt;summary&gt;
</I>&gt;<i> 		/// GetXML returns an XmlReader dependent on the contents
</I>&gt;<i> 		/// of the passed input param.
</I>&gt;<i> 		/// GetXML checks for the following conditions:
</I>&gt;<i> 		/// blank string returns an empty XmlReader
</I>&gt;<i> 		/// less-than at start assumes an XML file
</I>&gt;<i> 		/// back-slash at start assumes UNC path
</I>&gt;<i> 		/// otherwise, URL is assumed
</I>&gt;<i> 		/// &lt;/summary&gt;
</I>&gt;<i> 		/// &lt;param name=&quot;strInput&quot;&gt;&lt;/param&gt;
</I>&gt;<i> 		/// &lt;returns&gt;&lt;/returns&gt;
</I>&gt;<i> 		public static XmlReader GetXML(string strInput)
</I>&gt;<i> 		{
</I>&gt;<i> 			// Check if string is blank
</I>&gt;<i> 			if (strInput.Length == 0) {
</I>&gt;<i> 				// Return the empty xml reader
</I>&gt;<i> 				return new XmlTextReader(&quot;&quot;);
</I>&gt;<i> 			} else {
</I>&gt;<i> 					// Check if string starts with &quot;&lt;&quot;
</I>&gt;<i> 					// If it does, it is an XML file
</I>&gt;<i> 					if (strInput.Substring(0,1) == &quot;&lt;&quot;)
</I>&gt;<i> 					{
</I>&gt;<i> 						//String could be an xml file - load
</I>&gt;<i> 						return new XmlTextReader(new StringReader(strInput));
</I>&gt;<i> 					}
</I>&gt;<i> 					else
</I>&gt;<i> 						{
</I>&gt;<i> 							// Assume this is a file path - return loaded XML
</I>&gt;<i> 							return new XmlTextReader(strInput);
</I>&gt;<i> 						}
</I>&gt;<i> 				}
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> ______________________________________________________________________
</I>&gt;<i> // &lt;file&gt;
</I>&gt;<i> //     &lt;copyright see=&quot;<A HREF="prj:///doc/copyright.txt"/">prj:///doc/copyright.txt&quot;/</A>&gt;
</I>&gt;<i> //     &lt;license see=&quot;<A HREF="prj:///doc/license.txt"/">prj:///doc/license.txt&quot;/</A>&gt;
</I>&gt;<i> //     &lt;owner name=&quot;Mike Krger&quot; email=&quot;<A HREF="mailto:mike@icsharpcode.net">mike@icsharpcode.net</A>&quot;/&gt;
</I>&gt;<i> //     &lt;version value=&quot;$version&quot;/&gt;
</I>&gt;<i> // &lt;/file&gt;
</I>&gt;<i> 
</I>&gt;<i> using System;
</I>&gt;<i> using System.Diagnostics;
</I>&gt;<i> using System.Collections;
</I>&gt;<i> using System.Reflection;
</I>&gt;<i> //using System.Windows.Forms;
</I>&gt;<i> 
</I>&gt;<i> using ICSharpCode.Core.Properties;
</I>&gt;<i> using ICSharpCode.Core.AddIns.Conditions;
</I>&gt;<i> 
</I>&gt;<i> using ICSharpCode.Core.Services;
</I>&gt;<i> 
</I>&gt;<i> using ICSharpCode.SharpDevelop.Services;
</I>&gt;<i> using ICSharpCode.SharpDevelop.Gui;
</I>&gt;<i> using ICSharpCode.SharpDevelop.Gui.Components;
</I>&gt;<i> using ICSharpCode.SharpDevelop.Commands;
</I>&gt;<i> 
</I>&gt;<i> namespace ICSharpCode.Core.AddIns.Codons
</I>&gt;<i> {
</I>&gt;<i> 	[CodonName(&quot;MenuItem&quot;)]
</I>&gt;<i> 	public class MenuItemCodon : AbstractCodon
</I>&gt;<i> 	{
</I>&gt;<i> 		[XmlMemberAttribute(&quot;label&quot;, IsRequired=true)]
</I>&gt;<i> 		string label       = null;
</I>&gt;<i> 		
</I>&gt;<i> 		[XmlMemberAttribute(&quot;description&quot;)]
</I>&gt;<i> 		string description = null;
</I>&gt;<i> 		
</I>&gt;<i> 		[XmlMemberArrayAttribute(&quot;shortcut&quot;,Separator='|')]
</I>&gt;<i> 		string[] shortcut    = null;
</I>&gt;<i> 		
</I>&gt;<i> 		[XmlMemberAttribute(&quot;icon&quot;)]
</I>&gt;<i> 		string icon        = null;
</I>&gt;<i> 		
</I>&gt;<i> 		[XmlMemberAttribute(&quot;link&quot;)]
</I>&gt;<i> 		string link        = null;
</I>&gt;<i> 		
</I>&gt;<i> 		public string Link {
</I>&gt;<i> 			get {
</I>&gt;<i> 				return link;
</I>&gt;<i> 			}
</I>&gt;<i> 			set {
</I>&gt;<i> 				link = value;
</I>&gt;<i> 			}
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public override bool HandleConditions {
</I>&gt;<i> 			get {
</I>&gt;<i> 				return true;
</I>&gt;<i> 			}
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public string Label {
</I>&gt;<i> 			get {
</I>&gt;<i> 				return label;
</I>&gt;<i> 			}
</I>&gt;<i> 			set {
</I>&gt;<i> 				label = value;
</I>&gt;<i> 			}
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public string Description {
</I>&gt;<i> 			get {
</I>&gt;<i> 				return description;
</I>&gt;<i> 			}
</I>&gt;<i> 			set {
</I>&gt;<i> 				description = value;
</I>&gt;<i> 			}
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public string Icon {
</I>&gt;<i> 			get {
</I>&gt;<i> 				return icon;
</I>&gt;<i> 			}
</I>&gt;<i> 			set {
</I>&gt;<i> 				icon = value;
</I>&gt;<i> 			}
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		public string[] Shortcut {
</I>&gt;<i> 			get {
</I>&gt;<i> 				return shortcut;
</I>&gt;<i> 			}
</I>&gt;<i> 			set {
</I>&gt;<i> 				shortcut = value;
</I>&gt;<i> 			}
</I>&gt;<i> 		}
</I>&gt;<i> 		
</I>&gt;<i> 		/// &lt;summary&gt;
</I>&gt;<i> 		/// Creates an item with the specified sub items. And the current
</I>&gt;<i> 		/// Condition status for this item.
</I>&gt;<i> 		/// &lt;/summary&gt;
</I>&gt;<i> 		public override object BuildItem(object owner, ArrayList subItems, ConditionCollection conditions)
</I>&gt;<i> 		{
</I>&gt;<i> 			Gtk.MenuItem newItem = null;
</I>&gt;<i> 			if (Label == &quot;-&quot;) {
</I>&gt;<i> 				newItem = new SdMenuSeparator(conditions, owner);
</I>&gt;<i> 			} else  if (Link != null) {
</I>&gt;<i> 				newItem = new SdMenuCommand(conditions, null, Label,  Link.StartsWith(&quot;http&quot;) ? (IMenuCommand)new GotoWebSite(Link) : (IMenuCommand)new GotoLink(Link));
</I>&gt;<i> 			} else {
</I>&gt;<i> 				object o = null;
</I>&gt;<i> 				if (Class != null) {
</I>&gt;<i> 					o = AddIn.CreateObject(Class);
</I>&gt;<i> 				}
</I>&gt;<i> 				if (o != null) {
</I>&gt;<i> 					if (o is IMenuCommand) {
</I>&gt;<i> 						IMenuCommand menuCommand = (IMenuCommand)o;
</I>&gt;<i> 						menuCommand.Owner = owner;
</I>&gt;<i> 						if (o is ICheckableMenuCommand) {
</I>&gt;<i> 							newItem = new SdMenuCheckBox(conditions, owner, Label, (ICheckableMenuCommand)menuCommand);
</I>&gt;<i> 						} else {
</I>&gt;<i> 							newItem = new SdMenuCommand(conditions, owner, Label, menuCommand);
</I>&gt;<i> 						}
</I>&gt;<i> 					} else if (o is ISubmenuBuilder) {
</I>&gt;<i> 						return o;
</I>&gt;<i> 					}
</I>&gt;<i> 				}
</I>&gt;<i> 			}
</I>&gt;<i> 			if (newItem == null) {
</I>&gt;<i> 				SdMenu newMenu = new SdMenu(conditions, owner, Label);
</I>&gt;<i> 				if (subItems != null &amp;&amp; subItems.Count &gt; 0) {
</I>&gt;<i> 					foreach (object item in subItems) {
</I>&gt;<i> 						if (item != null) {
</I>&gt;<i> 							newMenu.SubItems.Add(item);
</I>&gt;<i> 						}
</I>&gt;<i> 					}
</I>&gt;<i> 				}
</I>&gt;<i> 				newMenu.UpdateStatus ();
</I>&gt;<i> 				newItem = newMenu;
</I>&gt;<i> 			}
</I>&gt;<i> 			Debug.Assert(newItem != null);
</I>&gt;<i> 			
</I>&gt;<i> 			if (Icon != null &amp;&amp; newItem is SdMenuCommand) {
</I>&gt;<i> 				ResourceService resourceService = (ResourceService)ServiceManager.Services.GetService(typeof(IResourceService));
</I>&gt;<i> 				((SdMenuCommand)newItem).Image = resourceService.GetImage(Icon, Gtk.IconSize.Menu);
</I>&gt;<i> 			}
</I>&gt;<i> 			
</I>&gt;<i> 			if (newItem is SdMenuCommand) {
</I>&gt;<i> 				((SdMenuCommand)newItem).Description = description;
</I>&gt;<i> 			}
</I>&gt;<i> 			
</I>&gt;<i> 			if (Shortcut != null &amp;&amp; newItem is SdMenuCommand) {
</I>&gt;<i> 				try {
</I>&gt;<i> 					((SdMenuCommand)newItem).SetAccel (shortcut);
</I>&gt;<i> 					//foreach (string key in this.shortcut) {
</I>&gt;<i> 					//	((SdMenuCommand)newItem).Shortcut |= (System.Windows.Forms.Keys)Enum.Parse(typeof(System.Windows.Forms.Keys), key);
</I>&gt;<i> 					//}
</I>&gt;<i> 				} catch (Exception) {
</I>&gt;<i> 					//((SdMenuCommand)newItem).Shortcut = System.Windows.Forms.Keys.None;
</I>&gt;<i> 				}
</I>&gt;<i> 			}
</I>&gt;<i> 			//newItem.IsEnabled = true; //action != ConditionFailedAction.Disable;
</I>&gt;<i> 			return newItem;
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000099.html">[MonoDevelop] RE:more compilation problems
</A></li>
	<LI> Next message: <A HREF="000102.html">[MonoDevelop] Possible mono bug.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101">[ date ]</a>
              <a href="thread.html#101">[ thread ]</a>
              <a href="subject.html#101">[ subject ]</a>
              <a href="author.html#101">[ author ]</a>
         </LI>
       </UL>
</body></html>
