<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] RefactoringCommands: Encapsulate Fields	initial	implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20RefactoringCommands%3A%20Encapsulate%20Fields%0A%09initial%09implementation&In-Reply-To=8304962d0704240440o641379b2o3d92227c756116e9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005866.html">
   <LINK REL="Next"  HREF="005859.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] RefactoringCommands: Encapsulate Fields	initial	implementation</H1>
    <B>Lluis Sanchez</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20RefactoringCommands%3A%20Encapsulate%20Fields%0A%09initial%09implementation&In-Reply-To=8304962d0704240440o641379b2o3d92227c756116e9%40mail.gmail.com"
       TITLE="[MonoDevelop] RefactoringCommands: Encapsulate Fields	initial	implementation">lluis at ximian.com
       </A><BR>
    <I>Tue Apr 24 11:29:56 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="005866.html">[MonoDevelop] RefactoringCommands: Encapsulate Fields initial	implementation
</A></li>
        <LI>Next message: <A HREF="005859.html">[MonoDevelop] RefactoringCommands: Encapsulate Fields initial	implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5857">[ date ]</a>
              <a href="thread.html#5857">[ thread ]</a>
              <a href="subject.html#5857">[ subject ]</a>
              <a href="author.html#5857">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>El dt 24 de 04 del 2007 a les 13:40 +0200, en/na Miguel &#193;ngel P&#233;rez va
escriure:
&gt;<i> Hello all!
</I>&gt;<i> 
</I>&gt;<i> I have been doing some coding with the encapsulate field command and i
</I>&gt;<i> have got an initial implementation that generates the code for the
</I>&gt;<i> property and changes the visibility for the field if its public or
</I>&gt;<i> protected to private. 
</I>
Thanks for the patch!

&gt;<i> 
</I>&gt;<i> To do the code generation I've created an internal helper class named
</I>&gt;<i> CodeGeneratorHelper in the class CodeRefactorer
</I>&gt;<i> (Monodevelop.Ide.Projects.CodeGeneration namespace) that implements
</I>&gt;<i> it. 
</I>&gt;<i> I don't know if there is already some class that can generate CodeDom
</I>&gt;<i> namespace objects from an IMember so i have implemented something. 
</I>&gt;<i> 
</I>&gt;<i> What i haven't done is renaming the references to the property, since
</I>&gt;<i> is a thing that Lluis must know better than nobody, can you suggest
</I>&gt;<i> how it could be done?
</I>
You can use CodeRefactorer.FindMemberReferences to get a list of
references. However, this is not about renaming references, but about
changing a field reference by a property reference, and this is a
language-specific operation.

&gt;<i> 
</I>&gt;<i> I've also done some changes to BaseRefactorer class to allow a
</I>&gt;<i> parameter with the buffer to modify so the change is done to the
</I>&gt;<i> editor buffer instead of the file in disk. This makes necessary to
</I>&gt;<i> call the methods with an unboxing instead of using the interface
</I>&gt;<i> IRefactorer. 
</I>&gt;<i> It's look like this class could be improved with changes like this
</I>&gt;<i> that helps in the operations needed to implement more refactoring
</I>&gt;<i> commands.
</I>
CodeRefactorer has a TextFileProvider property which allows setting an
ITextFileProvider implementation. This interface implementation will
then be used by CodeRefactorer and RefactorerContext to get the files to
read or modify.

Notice that the follow method signature in BaseRefactorer is incorrect:

public CodeTypeMember RenameMember (RefactorerContext ctx, IClass cls, IMember member, string newName, IEditableTextFile file)

because the location of an IClass is language dependent. For example, if
cls is a partial class, RenameMember should rename the class in all
files that implement that class, so the 'file' parameter here doesn't
help.

If you want CodeRefactorer to modify files from the editor, you should
create a ITextFileProvider implementation which returns such files. You
can look in MonoDevelop.GtkCore for an example. Look for the class
OpenDocumentFileProvider. Maybe we should move this class to
MonoDevelop.Ide.Gui, so it can be reused.

I also agree with the comments by Ben. Also, it looks like the indenting
of the code is not consistent, maybe you are mixing tabs and spaces for
indenting?

Thanks!
Lluis.


</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005866.html">[MonoDevelop] RefactoringCommands: Encapsulate Fields initial	implementation
</A></li>
	<LI>Next message: <A HREF="005859.html">[MonoDevelop] RefactoringCommands: Encapsulate Fields initial	implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5857">[ date ]</a>
              <a href="thread.html#5857">[ thread ]</a>
              <a href="subject.html#5857">[ subject ]</a>
              <a href="author.html#5857">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
