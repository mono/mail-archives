<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] First go at unit tests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20First%20go%20at%20unit%20tests&In-Reply-To=455de9380512030558m785a6e9cydf117459953bb0e7%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002821.html">
   <LINK REL="Next"  HREF="002833.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] First go at unit tests</H1>
    <B>Lluis Sanchez</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20First%20go%20at%20unit%20tests&In-Reply-To=455de9380512030558m785a6e9cydf117459953bb0e7%40mail.gmail.com"
       TITLE="[MonoDevelop] First go at unit tests">lluis at ximian.com
       </A><BR>
    <I>Mon Dec  5 17:02:20 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002821.html">[MonoDevelop] First go at unit tests
</A></li>
        <LI>Next message: <A HREF="002833.html">[MonoDevelop] First go at unit tests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2832">[ date ]</a>
              <a href="thread.html#2832">[ thread ]</a>
              <a href="subject.html#2832">[ subject ]</a>
              <a href="author.html#2832">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jacob,

&gt;<i>         
</I>&gt;<i>         
</I>&gt;<i>         But the main reason is that it won't help in building up a
</I>&gt;<i>         test
</I>&gt;<i>         framework for Monodevelop. Your test would only be testing a
</I>&gt;<i>         particular
</I>&gt;<i>         implementation of the search engine, not the *MonoDevelop*
</I>&gt;<i>         search 
</I>&gt;<i>         engine. If that is what you want to do, ok, but I don't think
</I>&gt;<i>         it is the
</I>&gt;<i>         correct path.
</I>&gt;<i> 
</I>&gt;<i> That is actually what I wanted to do. Test a particular implementation
</I>&gt;<i> with a unit test.
</I>&gt;<i> And we then know that *MonoDevelop* search works if all the particular
</I>&gt;<i> implementations are tested individually.
</I>
I rather prefer one single test for all implementations, which defines
the expected common behavior.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         If we next month decide to drop the GtkSourceView based editor
</I>&gt;<i>         and
</I>&gt;<i>         implement our own manged editor, all those tests will be
</I>&gt;<i>         useless, and 
</I>&gt;<i>         we'll have nothing to ensure that the new editor does the
</I>&gt;<i>         search in the
</I>&gt;<i>         same way as the old did, and that there are not regressions.
</I>&gt;<i> 
</I>&gt;<i>  It is true that they will be useless but that argument goes for all
</I>&gt;<i> code that is thrown away.
</I>&gt;<i> But as long as we use the GtkSourceView based editor they will not be
</I>&gt;<i> useless.
</I>
If we write a test for the search engine, we don't need to throw it away
if we change a particular implementation. We are reusing the test and
making sure that everithing keeps working in the same way.

If we change the search engine, we need to throw away that test, of
course. But at least we would need to write only one new test, not one
for every implementation. That's a big win.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         &gt;         &gt; * Make the class public.
</I>&gt;<i>         
</I>&gt;<i>         Making a class public is a very serious decision. You are
</I>&gt;<i>         adding the 
</I>&gt;<i>         class to the public API, which means that users of that
</I>&gt;<i>         library may use
</I>&gt;<i>         that class, so you can't change it without breaking the binary
</I>&gt;<i>         compatiblity.
</I>&gt;<i>         
</I>&gt;<i>         So, if you make public an internal implementation class, it
</I>&gt;<i>         means that 
</I>&gt;<i>         changing the internal implementation might break assembly
</I>&gt;<i>         compatibility.
</I>&gt;<i>         And that's really bad.
</I>&gt;<i> 
</I>&gt;<i> I agree, it is also the option I like the least.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         &gt;         &gt; * Move the class somewhere else.
</I>&gt;<i>         
</I>&gt;<i>         I don't see how this can help. If you move the class to
</I>&gt;<i>         another assembly 
</I>&gt;<i>         you'll have to make it public so the original assembly can use
</I>&gt;<i>         it, and
</I>&gt;<i>         you'll have yet another assembly dependency.
</I>&gt;<i> 
</I>&gt;<i> The reason I added this option was that I did not think the search
</I>&gt;<i> algorithm belonged in a GUI class.
</I>&gt;<i> So moving it to another class that was not so bound to the GUI might
</I>&gt;<i> make it easier to test.
</I>
The MonoDevelop search algorithm is already independent from the GUI.
The algorithm is implemented in the DefaultFind class, in the
MonoDevelop.Ide.Gui.Search namespace (which has Gui in the name, but
this specific class has no GUI dependencies). This algorith uses a
combination of ISearchStrategy, IDocumentIterator and ITextIterator to
find text.

Some months ago I added a SearchNext() method in ITextIterator. The goal
of this method was to improve the performance of the search operation.
The problem was that the generic implementation of the search algorithm
was much slower than the native search method provided by GtkSourceView.

So, right now an ITextIterator implementation can provide native search
support through this method, and the main search algorithm will use it
if it can. It won't be always possible, since the MonoDevelop search
engine provides more search options than what GtkSourceView can provide
(for example, native search won't be used when looking for 'whole
word'). The search engine calls ITextIterator.SupportsSearch to find out
if the native search can be used for a particular search operation.

Of course, all this is completely transparent to the user of the search
engine API.

In summary, SourceViewTextIterator.SearchNext is a fast path
implementation of the search algorithm, and it certainly needs to belong
to a GUI class and depend on GtkSourceView.

&gt;<i>         
</I>&gt;<i>         I already said it many times, but here is it again: many of
</I>&gt;<i>         the
</I>&gt;<i>         MonoDevelop classes won't work without a properly initialized
</I>&gt;<i>         MonoDevelop runtime. So you must 'start' MonoDevelop to unit
</I>&gt;<i>         test them. 
</I>&gt;<i>         It doesn't mean that you have to do it manually, and I don't
</I>&gt;<i>         see the
</I>&gt;<i>         reason why it could not be part of the build.
</I>&gt;<i> 
</I>&gt;<i> Ok, so if I made some Test AddIn, I would like something like make
</I>&gt;<i> test to do something like this:
</I>&gt;<i> 
</I>&gt;<i> 1. Build the test AddIn and copy it to the AddIn directory.
</I>&gt;<i> 2. Launch MonoDevelop.
</I>&gt;<i> 3. Execute the code in the Test AddIn.
</I>&gt;<i> 4. Quit MonoDevelop.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Is this possible to do automatically? I am thinking of step 3.
</I>
Yes, all this can be done. Add-ins can define auto-start commands that
are executed at MD startup. The only issue to be solved would be how to
decide wether to run the tests or not, since if the addin is copied to
the addins dir it will always be loaded, even when not wanting to run
the test suite.

&gt;<i> 
</I>&gt;<i>         &gt;  Secondly it might be hard to test the internals of a class
</I>&gt;<i>         using only
</I>&gt;<i>         &gt; some public API. 
</I>&gt;<i>         
</I>&gt;<i>         Mono has around 13000 unit tests, all of them using
</I>&gt;<i>         exclusively public
</I>&gt;<i>         API, so it's not so hard...
</I>&gt;<i> 
</I>&gt;<i> Nope, it's not hard, we just need to find the right way to do it. :-) 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt; /Jacob
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt;         Lluis.
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt; 
</I>&gt;<i>         
</I>&gt;<i>         _______________________________________________
</I>&gt;<i>         Monodevelop-list mailing list
</I>&gt;<i>         <A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">Monodevelop-list at lists.ximian.com</A>
</I>&gt;<i>         <A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">http://lists.ximian.com/mailman/listinfo/monodevelop-list</A>
</I>&gt;<i> 
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002821.html">[MonoDevelop] First go at unit tests
</A></li>
	<LI>Next message: <A HREF="002833.html">[MonoDevelop] First go at unit tests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2832">[ date ]</a>
              <a href="thread.html#2832">[ thread ]</a>
              <a href="subject.html#2832">[ subject ]</a>
              <a href="author.html#2832">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
