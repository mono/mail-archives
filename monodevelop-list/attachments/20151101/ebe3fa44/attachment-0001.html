<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hey&nbsp;Guys,&nbsp;&lt;br&gt;&lt;br&gt;&lt;/div&gt;Romains&nbsp;suggestion&nbsp;was&nbsp;what&nbsp;I&nbsp;needed.&nbsp;The&nbsp;offending&nbsp;code&nbsp;is&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;SystemRename(string&nbsp;sourceFile,string&nbsp;destFile)&nbsp;in&nbsp;the&nbsp;file&nbsp;src/core/MonoDevelop.Core/MonoDevelop.Core/FileService.cs:&lt;br&gt;&lt;br&gt;else&nbsp;{&lt;br&gt;   &nbsp;if&nbsp;(Syscall.rename&nbsp;(sourceFile,&nbsp;destFile)&nbsp;!=&nbsp;0)&nbsp;{&nbsp;//Should&nbsp;this&nbsp;be&nbsp;Stdlib&nbsp;as&nbsp;well?&lt;br&gt;   &nbsp;   &nbsp;switch&nbsp;(Stdlib.GetLastError&nbsp;())&nbsp;{&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.EACCES:&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.EPERM:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;UnauthorizedAccessException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.EINVAL:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;InvalidOperationException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.ENOTDIR:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;DirectoryNotFoundException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.ENOENT:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;FileNotFoundException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.ENAMETOOLONG:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;PathTooLongException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;default:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;IOException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;}&lt;br&gt;   &nbsp;}&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Notice&nbsp;there&nbsp;is&nbsp;no&nbsp;case&nbsp;for&nbsp;ErrNo.EXDEV.&nbsp;I&nbsp;have&nbsp;added&nbsp;a&nbsp;new&nbsp;control&nbsp;case&nbsp;as&nbsp;such:&lt;br&gt;&lt;/div&gt;&lt;br&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;font&nbsp;face=&quot;Monospace&quot;&gt;<br>
&lt;span&nbsp;style=&quot;color:rgb(51,51,51)&quot;&gt;&lt;/span&gt;else&nbsp;{&lt;br&gt;   &nbsp;if&nbsp;(Stdlib.rename&nbsp;(sourceFile,&nbsp;destFile)&nbsp;!=&nbsp;0)&nbsp;{&lt;br&gt;   &nbsp;   &nbsp;switch&nbsp;(Stdlib.GetLastError&nbsp;())&nbsp;{&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.EACCES:&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.EPERM:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;UnauthorizedAccessException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.EINVAL:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;InvalidOperationException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.ENOTDIR:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;DirectoryNotFoundException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.ENOENT:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;FileNotFoundException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.ENAMETOOLONG:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;PathTooLongException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;case&nbsp;Errno.EXDEV:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;CrossFilesystemRename&nbsp;(sourceFile,&nbsp;destFile);&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;break;&lt;br&gt;   &nbsp;   &nbsp;default:&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;throw&nbsp;new&nbsp;IOException&nbsp;();&lt;br&gt;   &nbsp;   &nbsp;}&lt;br&gt;   &nbsp;}&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;With&nbsp;the&nbsp;new&nbsp;function&nbsp;here:&lt;br&gt;&lt;br&gt;private&nbsp;static&nbsp;void&nbsp;CrossFilesystemRename(string&nbsp;sourceFile,&nbsp;string&nbsp;destFile)&lt;br&gt;{&lt;br&gt;   &nbsp;//copy&nbsp;the&nbsp;existing&nbsp;destfile&nbsp;to&nbsp;tmp&lt;br&gt;   &nbsp;//move&nbsp;the&nbsp;sourceFile&nbsp;to&nbsp;the&nbsp;destFilename&lt;br&gt;   &nbsp;//delete&nbsp;the&nbsp;old&nbsp;destFile&nbsp;contents&lt;br&gt;   &nbsp;string&nbsp;tempFile&nbsp;=&nbsp;Path.Combine&nbsp;(&quot;/tmp/&quot;,&nbsp;Path.GetRandomFileName&nbsp;()&nbsp;+&nbsp;&quot;.tmp&quot;);&lt;br&gt;   &nbsp;try{&lt;br&gt;   &nbsp;   &nbsp;&lt;br&gt;   &nbsp;   &nbsp;InternalMoveFile&nbsp;(destFile,&nbsp;tempFile);&lt;br&gt;   &nbsp;   &nbsp;InternalMoveFile(sourceFile,destFile);&lt;br&gt;   &nbsp;   &nbsp;DeleteFile(tempFile);&lt;br&gt;   &nbsp;}&lt;br&gt;   &nbsp;catch&lt;br&gt;   &nbsp;{&lt;br&gt;   &nbsp;   &nbsp;if&nbsp;(!File.Exists&nbsp;(destFile))&nbsp;{&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;InternalMoveFile&nbsp;(tempFile,&nbsp;destFile);&lt;br&gt;   &nbsp;   &nbsp;}&lt;br&gt;&lt;br&gt;   &nbsp;   &nbsp;if&nbsp;(File.Exists&nbsp;(tempFile))&nbsp;{&lt;br&gt;   &nbsp;   &nbsp;   &nbsp;DeleteFile(tempFile);&lt;br&gt;   &nbsp;   &nbsp;}&lt;br&gt;&lt;br&gt;   &nbsp;   &nbsp;throw;&lt;br&gt;   &nbsp;}&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;Two&nbsp;things&nbsp;to&nbsp;note:&nbsp;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;1)&nbsp;I&nbsp;noticed&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;using&nbsp;Syscall.rename,&nbsp;when&nbsp;the&nbsp;rename&nbsp;function&nbsp;seems&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;StdLib.&nbsp;Syscall&nbsp;in&nbsp;fact&nbsp;seems&nbsp;to&nbsp;only&nbsp;have&nbsp;a&nbsp;reference&nbsp;to&nbsp;renameat&nbsp;not&nbsp;rename,&nbsp;so&nbsp;I&nbsp;changed&nbsp;FileService.cs&nbsp;to&nbsp;StdLib&nbsp;with&nbsp;no&nbsp;discernible&nbsp;difference.&nbsp;Does&nbsp;anyone&nbsp;have&nbsp;some&nbsp;input&nbsp;on&nbsp;this?&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;2)&nbsp;As&nbsp;you&nbsp;can&nbsp;see&nbsp;there&nbsp;is&nbsp;a&nbsp;horrible&nbsp;hard&nbsp;coded&nbsp;/tmp&nbsp;file&nbsp;path.&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;how&nbsp;to&nbsp;determine&nbsp;the&nbsp;temp&nbsp;directory&nbsp;in&nbsp;a&nbsp;unix&nbsp;system.&nbsp;That&nbsp;said&nbsp;in&nbsp;FreeBSD,&nbsp;/tmp&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;rootfs&nbsp;and&nbsp;seems&nbsp;to&nbsp;be&nbsp;pretty&nbsp;standard&nbsp;in&nbsp;Linux&nbsp;too:&nbsp;&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://docs.freebsd.org/doc/5.4-RELEASE/usr/share/doc/handbook/dirstructure.html&quot;&gt;https://docs.freebsd.org/doc/5.4-RELEASE/usr/share/doc/handbook/dirstructure.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;Does&nbsp;anyone&nbsp;have&nbsp;a&nbsp;different&nbsp;solution?&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;Anyway,&nbsp;this&nbsp;fixes&nbsp;the&nbsp;issue&nbsp;I&nbsp;was&nbsp;having.&nbsp;Thank&nbsp;you&nbsp;everyone&nbsp;for&nbsp;helping&nbsp;me&nbsp;pull&nbsp;this&nbsp;together.&nbsp;I&#39;ll&nbsp;look&nbsp;to&nbsp;submit&nbsp;a&nbsp;patch&nbsp;to&nbsp;Xamarin&nbsp;sometime&nbsp;later&nbsp;in&nbsp;the&nbsp;week.&nbsp;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;Cheers,&nbsp;&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;Russ&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;Monospace&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51)&quot;&gt;&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Nov&nbsp;1,&nbsp;2015&nbsp;at&nbsp;1:34&nbsp;AM,&nbsp;Romain&nbsp;Tartière&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:romain@blogreen.org&quot;&nbsp;target=&quot;_blank&quot;&gt;romain@blogreen.org&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi,&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
On&nbsp;Sat,&nbsp;Oct&nbsp;31,&nbsp;2015&nbsp;at&nbsp;09:48:03PM&nbsp;-0700,&nbsp;Russell&nbsp;Haley&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Any&nbsp;thoughts?&nbsp;I&nbsp;am&nbsp;guessing&nbsp;that&nbsp;the&nbsp;syscall.rename&nbsp;is&nbsp;doing&nbsp;something&lt;br&gt;<br>
&gt;&nbsp;other&nbsp;than&nbsp;an&nbsp;mv&nbsp;and&nbsp;zfs&nbsp;doesn&#39;t&nbsp;like&nbsp;it.&nbsp;Or&nbsp;conversly,&nbsp;zfs&nbsp;is&nbsp;doing&lt;br&gt;<br>
&gt;&nbsp;something&nbsp;funky&nbsp;and&nbsp;the&nbsp;mono&nbsp;wrapper&nbsp;library&nbsp;doesn&#39;t&nbsp;like&nbsp;it?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;rename(2)&nbsp;is&nbsp;intended&nbsp;to&nbsp;rename&nbsp;a&nbsp;link,&nbsp;so&nbsp;can&#39;t&nbsp;move&nbsp;a&nbsp;file&nbsp;from&nbsp;a&lt;br&gt;<br>
filesystem&nbsp;to&nbsp;another. &nbsp; mv(1)&nbsp;tries&nbsp;to&nbsp;rename(2)&nbsp;files,&nbsp;and&nbsp;if&nbsp;the&lt;br&gt;<br>
rename&nbsp;failed&nbsp;with&nbsp;EXDEV,&nbsp;attempts&nbsp;to&nbsp;create&nbsp;the&nbsp;target&nbsp;file,&nbsp;copy&nbsp;data&lt;br&gt;<br>
from&nbsp;the&nbsp;source&nbsp;file,&nbsp;copy&nbsp;permissions&nbsp;and&nbsp;unlink(2)&nbsp;the&nbsp;source&nbsp;(see&lt;br&gt;<br>
fastcopy()&nbsp;function&nbsp;in&nbsp;mv.c).&lt;br&gt;<br>
&lt;br&gt;<br>
Mono&nbsp;should&nbsp;have&nbsp;a&nbsp;similar&nbsp;behavior,&nbsp;and&nbsp;something&nbsp;may&nbsp;get&nbsp;wrong&nbsp;in&nbsp;this&lt;br&gt;<br>
logic. &nbsp;Maybe&nbsp;you&nbsp;can&nbsp;try&nbsp;to&nbsp;search&nbsp;what&nbsp;is&nbsp;happening&nbsp;there?&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
--&lt;br&gt;<br>
Romain&nbsp;Tartière&nbsp;&lt;romain@FreeBSD.org&gt; &nbsp;&lt;a&nbsp;href=&quot;http://people.FreeBSD.org/~romain/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://people.FreeBSD.org/~romain/&lt;/a&gt;&lt;br&gt;<br>
pgp:&nbsp;8234&nbsp;9A78&nbsp;E7C0&nbsp;B807&nbsp;0B59 &nbsp;80FF&nbsp;BA4D&nbsp;1D95&nbsp;5112&nbsp;336F&nbsp;(ID:&nbsp;0x5112336F)&lt;br&gt;<br>
(plain&nbsp;text&nbsp;=non-HTML=&nbsp;PGP/GPG&nbsp;encrypted/signed&nbsp;e-mail&nbsp;much&nbsp;appreciated)&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
