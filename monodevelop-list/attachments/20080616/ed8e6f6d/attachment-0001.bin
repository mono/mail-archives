
Property changes on: extras/ValaBinding
___________________________________________________________________
Name: svn:ignore
   - Makefile
Makefile.in
MonoDevelop.ValaBinding.pidb
ValaBinding.usertasks
ValaBinding.userprefs
configure
aclocal.m4
autom4te.cache
install-sh
missing
INSTALL
config.log
config.status

   + Makefile
Makefile.in
MonoDevelop.ValaBinding.pidb
ValaBinding.usertasks
ValaBinding.userprefs
configure
aclocal.m4
autom4te.cache
install-sh
missing
INSTALL
config.log
config.status
build


Index: extras/ValaBinding/Gui/EditPackagesDialog.cs
===================================================================
--- extras/ValaBinding/Gui/EditPackagesDialog.cs	(revision 105944)
+++ extras/ValaBinding/Gui/EditPackagesDialog.cs	(working copy)
@@ -32,6 +32,7 @@
 using System;
 using System.IO;
 using System.Collections.Generic;
+using System.Diagnostics;
 
 using Mono.Addins;
 
@@ -42,6 +43,8 @@
 {
 	public partial class EditPackagesDialog : Gtk.Dialog
 	{
+		private static string vapidir;
+
 		private Gtk.ListStore normalPackageListStore = new Gtk.ListStore (typeof(bool), typeof(string), typeof(string));
 		private Gtk.ListStore projectPackageListStore = new Gtk.ListStore (typeof(bool), typeof(string), typeof(string));
 		private Gtk.ListStore selectedPackageListStore = new Gtk.ListStore (typeof(string), typeof(string));
@@ -61,6 +64,20 @@
 		
 		const int SelectedPackageNameID = 0;
 		const int SelectedPackageVersionID = 1;
+
+		static EditPackagesDialog()
+		{
+			Process pkgconfig = new Process();
+			pkgconfig.StartInfo.FileName = "pkg-config";
+			pkgconfig.StartInfo.Arguments = "--variable=vapidir vala-1.0";
+			pkgconfig.StartInfo.CreateNoWindow = true;
+			pkgconfig.StartInfo.RedirectStandardOutput = true;
+			pkgconfig.StartInfo.UseShellExecute = false;
+			pkgconfig.Start();
+			vapidir = pkgconfig.StandardOutput.ReadToEnd().Trim();
+			pkgconfig.WaitForExit();
+			pkgconfig.Dispose();
+		}
 		
 		public EditPackagesDialog(ValaProject project)
 		{
@@ -231,7 +248,7 @@
 		
 		private string[] ScanDirs ()
 		{
-			return new string[]{ "/usr/share/vala/vapi" };
+			return new string[]{ vapidir };
 		}
 		
 		private void OnOkButtonClick (object sender, EventArgs e)
