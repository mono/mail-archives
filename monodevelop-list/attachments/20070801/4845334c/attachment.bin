Index: Core/src/MonoDevelop.Projects/MonoDevelop.Projects/CustomCommand.cs
===================================================================
--- Core/src/MonoDevelop.Projects/MonoDevelop.Projects/CustomCommand.cs	(revision 83204)
+++ Core/src/MonoDevelop.Projects/MonoDevelop.Projects/CustomCommand.cs	(working copy)
@@ -18,6 +18,9 @@
 		[ItemProperty ()]
 		string command;
 		
+		[ItemProperty ()]
+		string workingdir;
+		
 		[ItemProperty (DefaultValue = false)]
 		bool externalConsole;
 		
@@ -34,6 +37,11 @@
 			set { command = value; }
 		}
 		
+		public string WorkingDir {
+			get { return workingdir; }
+			set { workingdir = value; }
+		}
+		
 		public string Name {
 			get { return name; }
 			set { name = value; }
@@ -53,6 +61,7 @@
 		{
 			CustomCommand cmd = new CustomCommand ();
 			cmd.command = command;
+			cmd.workingdir = workingdir;
 			cmd.name = name;
 			cmd.externalConsole = externalConsole;
 			cmd.pauseExternalConsole = pauseExternalConsole;
@@ -66,19 +75,22 @@
 		}
 		
 		public void Execute (IProgressMonitor monitor, CombineEntry entry, ExecutionContext context)
-		{
-			monitor.Log.WriteLine (GettextCatalog.GetString ("Executing: {0}", command));
-			
+		{			
 			int i = command.IndexOf (' ');
 			string exe;
-			string args = "";
+			string args = string.Empty;
 			if (i == -1) {
 				exe = command;
 				args = string.Empty;
 			} else {
 				exe = command.Substring (0, i);
-				args = command.Substring (i + 1);
+				args = Runtime.StringParserService.Parse (command.Substring (i + 1));
 			}
+			
+			monitor.Log.WriteLine (GettextCatalog.GetString ("Executing: {0} {1}", exe, args));
+
+			string dir = (string.IsNullOrEmpty (workingdir) ? entry.BaseDirectory : Runtime.StringParserService.Parse (workingdir));
+			
 			string localPath = Path.Combine (entry.BaseDirectory, exe);
 			if (File.Exists (localPath))
 				exe = localPath;
@@ -92,14 +104,14 @@
 				else
 					console = context.ConsoleFactory.CreateConsole (!pauseExternalConsole);
 				IExecutionHandler handler = context.ExecutionHandlerFactory.CreateExecutionHandler ("Native");
-				oper = handler.Execute (exe, args, entry.BaseDirectory, console);
+				oper = handler.Execute (exe, args, dir, console);
 			}
 			else {
 				if (externalConsole) {
 					IConsole console = ExternalConsoleFactory.Instance.CreateConsole (!pauseExternalConsole);
-					oper = Runtime.ProcessService.StartConsoleProcess (exe, args, entry.BaseDirectory, console, null);
+					oper = Runtime.ProcessService.StartConsoleProcess (exe, args, dir, console, null);
 				} else {
-					oper = Runtime.ProcessService.StartProcess (exe, args, entry.BaseDirectory, monitor.Log, monitor.Log, null, false);
+					oper = Runtime.ProcessService.StartProcess (exe, args, dir, monitor.Log, monitor.Log, null, false);
 				}
 			}
 			
Index: Core/src/MonoDevelop.Projects/ChangeLog
===================================================================
--- Core/src/MonoDevelop.Projects/ChangeLog	(revision 83204)
+++ Core/src/MonoDevelop.Projects/ChangeLog	(working copy)
@@ -1,3 +1,9 @@
+2007-08-01  Marcos David Marín Amador <MarcosMarin@gmail.com>
+
+	* MonoDevelop.Projects/CustomCommand.cs: Added the working directory
+	  property which is now parsed to support variables. The arguments 
+	  int the command entry are also now parsed.
+
 2007-07-25  Lluis Sanchez Gual <lluis@novell.com> 
 
 	* MonoDevelop.Projects/CustomCommand.cs: Report custom command errors.
Index: Core/src/MonoDevelop.Projects.Gui/gtk-gui/objects.xml
===================================================================
--- Core/src/MonoDevelop.Projects.Gui/gtk-gui/objects.xml	(revision 83204)
+++ Core/src/MonoDevelop.Projects.Gui/gtk-gui/objects.xml	(working copy)
@@ -5,7 +5,7 @@
     <signals>
     </signals>
   </object>
-  <object type="MonoDevelop.Projects.Gui.Dialogs.OptionPanels.CustomCommandWidget" palette-category="widget" allow-children="false" base-type="Gtk.Bin" internal="true">
+  <object type="MonoDevelop.Projects.Gui.Dialogs.OptionPanels.CustomCommandWidget" palette-category="widget" allow-children="false" base-type="Gtk.Bin">
     <itemgroups>
     </itemgroups>
     <signals>
Index: Core/src/MonoDevelop.Projects.Gui/gtk-gui/MonoDevelop.Projects.Gui.Dialogs.OptionPanels.CustomCommandWidget.cs
===================================================================
--- Core/src/MonoDevelop.Projects.Gui/gtk-gui/MonoDevelop.Projects.Gui.Dialogs.OptionPanels.CustomCommandWidget.cs	(revision 83204)
+++ Core/src/MonoDevelop.Projects.Gui/gtk-gui/MonoDevelop.Projects.Gui.Dialogs.OptionPanels.CustomCommandWidget.cs	(working copy)
@@ -33,8 +33,14 @@
         
         private Gtk.Label label1;
         
+        private Gtk.Label label3;
+        
         private Gtk.Label labelName;
         
+        private Gtk.Entry workingdirEntry;
+        
+        private Gtk.Button workingdirQuickInsertButton;
+        
         private Gtk.HBox boxData;
         
         private Gtk.CheckButton checkExternalCons;
@@ -106,7 +112,7 @@
             w4.Expand = false;
             w4.Fill = false;
             // Container child vbox1.Gtk.Box+BoxChild
-            this.tableData = new Gtk.Table(((uint)(2)), ((uint)(3)), false);
+            this.tableData = new Gtk.Table(((uint)(3)), ((uint)(3)), false);
             this.tableData.Name = "tableData";
             this.tableData.RowSpacing = ((uint)(6));
             this.tableData.ColumnSpacing = ((uint)(6));
@@ -122,7 +128,7 @@
             w5.BottomAttach = ((uint)(2));
             w5.LeftAttach = ((uint)(2));
             w5.RightAttach = ((uint)(3));
-            w5.XOptions = ((Gtk.AttachOptions)(0));
+            w5.XOptions = ((Gtk.AttachOptions)(4));
             w5.YOptions = ((Gtk.AttachOptions)(4));
             // Container child tableData.Gtk.Table+TableChild
             this.entryCommand = new Gtk.Entry();
@@ -146,33 +152,70 @@
             this.tableData.Add(this.entryName);
             Gtk.Table.TableChild w7 = ((Gtk.Table.TableChild)(this.tableData[this.entryName]));
             w7.LeftAttach = ((uint)(1));
-            w7.RightAttach = ((uint)(3));
+            w7.RightAttach = ((uint)(2));
             w7.YOptions = ((Gtk.AttachOptions)(4));
             // Container child tableData.Gtk.Table+TableChild
             this.label1 = new Gtk.Label();
             this.label1.Name = "label1";
             this.label1.Xalign = 0F;
-            this.label1.LabelProp = MonoDevelop.Core.GettextCatalog.GetString("Command:");
+            this.label1.LabelProp = MonoDevelop.Core.GettextCatalog.GetString("Working Directory:");
             this.tableData.Add(this.label1);
             Gtk.Table.TableChild w8 = ((Gtk.Table.TableChild)(this.tableData[this.label1]));
-            w8.TopAttach = ((uint)(1));
-            w8.BottomAttach = ((uint)(2));
+            w8.TopAttach = ((uint)(2));
+            w8.BottomAttach = ((uint)(3));
             w8.XOptions = ((Gtk.AttachOptions)(4));
             w8.YOptions = ((Gtk.AttachOptions)(4));
             // Container child tableData.Gtk.Table+TableChild
+            this.label3 = new Gtk.Label();
+            this.label3.Name = "label3";
+            this.label3.Xalign = 0F;
+            this.label3.LabelProp = MonoDevelop.Core.GettextCatalog.GetString("Command:");
+            this.tableData.Add(this.label3);
+            Gtk.Table.TableChild w9 = ((Gtk.Table.TableChild)(this.tableData[this.label3]));
+            w9.TopAttach = ((uint)(1));
+            w9.BottomAttach = ((uint)(2));
+            w9.XOptions = ((Gtk.AttachOptions)(4));
+            w9.YOptions = ((Gtk.AttachOptions)(4));
+            // Container child tableData.Gtk.Table+TableChild
             this.labelName = new Gtk.Label();
             this.labelName.Name = "labelName";
             this.labelName.Xalign = 0F;
             this.labelName.LabelProp = MonoDevelop.Core.GettextCatalog.GetString("Name:");
             this.tableData.Add(this.labelName);
-            Gtk.Table.TableChild w9 = ((Gtk.Table.TableChild)(this.tableData[this.labelName]));
-            w9.XOptions = ((Gtk.AttachOptions)(4));
-            w9.YOptions = ((Gtk.AttachOptions)(4));
+            Gtk.Table.TableChild w10 = ((Gtk.Table.TableChild)(this.tableData[this.labelName]));
+            w10.XOptions = ((Gtk.AttachOptions)(4));
+            w10.YOptions = ((Gtk.AttachOptions)(4));
+            // Container child tableData.Gtk.Table+TableChild
+            this.workingdirEntry = new Gtk.Entry();
+            this.workingdirEntry.CanFocus = true;
+            this.workingdirEntry.Name = "workingdirEntry";
+            this.workingdirEntry.IsEditable = true;
+            this.workingdirEntry.InvisibleChar = '●';
+            this.tableData.Add(this.workingdirEntry);
+            Gtk.Table.TableChild w11 = ((Gtk.Table.TableChild)(this.tableData[this.workingdirEntry]));
+            w11.TopAttach = ((uint)(2));
+            w11.BottomAttach = ((uint)(3));
+            w11.LeftAttach = ((uint)(1));
+            w11.RightAttach = ((uint)(2));
+            w11.YOptions = ((Gtk.AttachOptions)(4));
+            // Container child tableData.Gtk.Table+TableChild
+            this.workingdirQuickInsertButton = new Gtk.Button();
+            this.workingdirQuickInsertButton.Name = "workingdirQuickInsertButton";
+            this.workingdirQuickInsertButton.UseUnderline = true;
+            this.workingdirQuickInsertButton.Label = " > ";
+            this.tableData.Add(this.workingdirQuickInsertButton);
+            Gtk.Table.TableChild w12 = ((Gtk.Table.TableChild)(this.tableData[this.workingdirQuickInsertButton]));
+            w12.TopAttach = ((uint)(2));
+            w12.BottomAttach = ((uint)(3));
+            w12.LeftAttach = ((uint)(2));
+            w12.RightAttach = ((uint)(3));
+            w12.XOptions = ((Gtk.AttachOptions)(4));
+            w12.YOptions = ((Gtk.AttachOptions)(4));
             this.vbox1.Add(this.tableData);
-            Gtk.Box.BoxChild w10 = ((Gtk.Box.BoxChild)(this.vbox1[this.tableData]));
-            w10.Position = 2;
-            w10.Expand = false;
-            w10.Fill = false;
+            Gtk.Box.BoxChild w13 = ((Gtk.Box.BoxChild)(this.vbox1[this.tableData]));
+            w13.Position = 2;
+            w13.Expand = false;
+            w13.Fill = false;
             // Container child vbox1.Gtk.Box+BoxChild
             this.boxData = new Gtk.HBox();
             this.boxData.Name = "boxData";
@@ -185,10 +228,10 @@
             this.checkExternalCons.DrawIndicator = true;
             this.checkExternalCons.UseUnderline = true;
             this.boxData.Add(this.checkExternalCons);
-            Gtk.Box.BoxChild w11 = ((Gtk.Box.BoxChild)(this.boxData[this.checkExternalCons]));
-            w11.Position = 0;
-            w11.Expand = false;
-            w11.Fill = false;
+            Gtk.Box.BoxChild w14 = ((Gtk.Box.BoxChild)(this.boxData[this.checkExternalCons]));
+            w14.Position = 0;
+            w14.Expand = false;
+            w14.Fill = false;
             // Container child boxData.Gtk.Box+BoxChild
             this.checkPauseCons = new Gtk.CheckButton();
             this.checkPauseCons.CanFocus = true;
@@ -197,15 +240,15 @@
             this.checkPauseCons.DrawIndicator = true;
             this.checkPauseCons.UseUnderline = true;
             this.boxData.Add(this.checkPauseCons);
-            Gtk.Box.BoxChild w12 = ((Gtk.Box.BoxChild)(this.boxData[this.checkPauseCons]));
-            w12.Position = 1;
-            w12.Expand = false;
-            w12.Fill = false;
+            Gtk.Box.BoxChild w15 = ((Gtk.Box.BoxChild)(this.boxData[this.checkPauseCons]));
+            w15.Position = 1;
+            w15.Expand = false;
+            w15.Fill = false;
             this.vbox1.Add(this.boxData);
-            Gtk.Box.BoxChild w13 = ((Gtk.Box.BoxChild)(this.vbox1[this.boxData]));
-            w13.Position = 3;
-            w13.Expand = false;
-            w13.Fill = false;
+            Gtk.Box.BoxChild w16 = ((Gtk.Box.BoxChild)(this.vbox1[this.boxData]));
+            w16.Position = 3;
+            w16.Expand = false;
+            w16.Fill = false;
             this.Add(this.vbox1);
             if ((this.Child != null)) {
                 this.Child.ShowAll();
@@ -213,6 +256,7 @@
             this.Show();
             this.comboType.Changed += new System.EventHandler(this.OnComboTypeChanged);
             this.buttonRemove.Clicked += new System.EventHandler(this.OnButtonRemoveClicked);
+            this.workingdirEntry.Changed += new System.EventHandler(this.OnWorkingdirEntryChanged);
             this.entryName.Changed += new System.EventHandler(this.OnEntryNameChanged);
             this.entryCommand.Changed += new System.EventHandler(this.OnEntryCommandChanged);
             this.buttonBrowse.Clicked += new System.EventHandler(this.OnButtonBrowseClicked);
Index: Core/src/MonoDevelop.Projects.Gui/gtk-gui/gui.stetic
===================================================================
--- Core/src/MonoDevelop.Projects.Gui/gtk-gui/gui.stetic	(revision 83204)
+++ Core/src/MonoDevelop.Projects.Gui/gtk-gui/gui.stetic	(working copy)
@@ -2,12 +2,13 @@
 <stetic-interface>
   <configuration>
     <images-root-path>../</images-root-path>
+    <target-gtk-version>2.10.0</target-gtk-version>
   </configuration>
   <import>
     <widget-library name="../../../../build/AddIns/MonoDevelop.Components.dll" />
     <widget-library name="../../../../build/AddIns/MonoDevelop.Projects.Gui.dll" />
   </import>
-  <widget class="Gtk.Bin" id="MonoDevelop.Projects.Gui.Dialogs.OptionPanels.CustomCommandWidget" design-size="418 152">
+  <widget class="Gtk.Bin" id="MonoDevelop.Projects.Gui.Dialogs.OptionPanels.CustomCommandWidget" design-size="492 208">
     <property name="MemberName" />
     <property name="CanFocus">True</property>
     <property name="Events">FocusChangeMask</property>
@@ -89,11 +90,14 @@
         <child>
           <widget class="Gtk.Table" id="tableData">
             <property name="MemberName" />
-            <property name="NRows">2</property>
+            <property name="NRows">3</property>
             <property name="NColumns">3</property>
             <property name="RowSpacing">6</property>
             <property name="ColumnSpacing">6</property>
             <child>
+              <placeholder />
+            </child>
+            <child>
               <widget class="Gtk.Button" id="buttonBrowse">
                 <property name="MemberName" />
                 <property name="CanFocus">True</property>
@@ -108,11 +112,11 @@
                 <property name="BottomAttach">2</property>
                 <property name="LeftAttach">2</property>
                 <property name="RightAttach">3</property>
-                <property name="AutoSize">False</property>
-                <property name="XOptions">0</property>
+                <property name="AutoSize">True</property>
+                <property name="XOptions">Fill</property>
                 <property name="YOptions">Fill</property>
                 <property name="XExpand">False</property>
-                <property name="XFill">False</property>
+                <property name="XFill">True</property>
                 <property name="XShrink">False</property>
                 <property name="YExpand">False</property>
                 <property name="YFill">True</property>
@@ -152,7 +156,7 @@
               </widget>
               <packing>
                 <property name="LeftAttach">1</property>
-                <property name="RightAttach">3</property>
+                <property name="RightAttach">2</property>
                 <property name="AutoSize">True</property>
                 <property name="YOptions">Fill</property>
                 <property name="XExpand">True</property>
@@ -167,6 +171,26 @@
               <widget class="Gtk.Label" id="label1">
                 <property name="MemberName" />
                 <property name="Xalign">0</property>
+                <property name="LabelProp" translatable="yes">Working Directory:</property>
+              </widget>
+              <packing>
+                <property name="TopAttach">2</property>
+                <property name="BottomAttach">3</property>
+                <property name="AutoSize">True</property>
+                <property name="XOptions">Fill</property>
+                <property name="YOptions">Fill</property>
+                <property name="XExpand">False</property>
+                <property name="XFill">True</property>
+                <property name="XShrink">False</property>
+                <property name="YExpand">False</property>
+                <property name="YFill">True</property>
+                <property name="YShrink">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="Gtk.Label" id="label3">
+                <property name="MemberName" />
+                <property name="Xalign">0</property>
                 <property name="LabelProp" translatable="yes">Command:</property>
               </widget>
               <packing>
@@ -201,6 +225,53 @@
                 <property name="YShrink">False</property>
               </packing>
             </child>
+            <child>
+              <widget class="Gtk.Entry" id="workingdirEntry">
+                <property name="MemberName" />
+                <property name="CanFocus">True</property>
+                <property name="IsEditable">True</property>
+                <property name="InvisibleChar">●</property>
+                <signal name="Changed" handler="OnWorkingdirEntryChanged" />
+              </widget>
+              <packing>
+                <property name="TopAttach">2</property>
+                <property name="BottomAttach">3</property>
+                <property name="LeftAttach">1</property>
+                <property name="RightAttach">2</property>
+                <property name="AutoSize">True</property>
+                <property name="YOptions">Fill</property>
+                <property name="XExpand">True</property>
+                <property name="XFill">True</property>
+                <property name="XShrink">False</property>
+                <property name="YExpand">False</property>
+                <property name="YFill">True</property>
+                <property name="YShrink">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="Gtk.Button" id="workingdirQuickInsertButton">
+                <property name="MemberName" />
+                <property name="Type">TextOnly</property>
+                <property name="Label"> &gt; </property>
+                <property name="UseUnderline">True</property>
+                <property name="IsDialogButton">False</property>
+              </widget>
+              <packing>
+                <property name="TopAttach">2</property>
+                <property name="BottomAttach">3</property>
+                <property name="LeftAttach">2</property>
+                <property name="RightAttach">3</property>
+                <property name="AutoSize">True</property>
+                <property name="XOptions">Fill</property>
+                <property name="YOptions">Fill</property>
+                <property name="XExpand">False</property>
+                <property name="XFill">True</property>
+                <property name="XShrink">False</property>
+                <property name="YExpand">False</property>
+                <property name="YFill">True</property>
+                <property name="YShrink">False</property>
+              </packing>
+            </child>
           </widget>
           <packing>
             <property name="Position">2</property>
Index: Core/src/MonoDevelop.Projects.Gui/ChangeLog
===================================================================
--- Core/src/MonoDevelop.Projects.Gui/ChangeLog	(revision 83204)
+++ Core/src/MonoDevelop.Projects.Gui/ChangeLog	(working copy)
@@ -1,3 +1,8 @@
+2007-08-01  Marcos David Marín Amador <MarcosMarin@gmail.com>
+
+	* MonoDevelop.Projects.Gui.Dialogs.OptionPanels/CustomCommandWidget.cs:
+	  Added support to enter the working directory.
+
 2007-07-18  Lluis Sanchez Gual <lluis@novell.com> 
 
 	* MonoDevelop.Projects.Gui.Completion/CompletionListWindow.cs,
Index: Core/src/MonoDevelop.Projects.Gui/MonoDevelop.Projects.Gui.Dialogs.OptionPanels/CustomCommandWidget.cs
===================================================================
--- Core/src/MonoDevelop.Projects.Gui/MonoDevelop.Projects.Gui.Dialogs.OptionPanels/CustomCommandWidget.cs	(revision 83204)
+++ Core/src/MonoDevelop.Projects.Gui/MonoDevelop.Projects.Gui.Dialogs.OptionPanels/CustomCommandWidget.cs	(working copy)
@@ -1,6 +1,7 @@
 
 using System;
 using MonoDevelop.Core;
+using MonoDevelop.Core.Gui.Components;
 using MonoDevelop.Projects;
 using MonoDevelop.Components;
 
@@ -12,6 +13,44 @@
 		CombineEntry entry;
 		bool updating;
 		
+		// snatched from MonoDevelop.Ide.Gui.OptionPanels/ExternalToolPanel.cs
+//		static string[,] argumentQuickInsertMenu = new string[,] {
+//			{GettextCatalog.GetString ("Item Path"), "${ItemPath}"},
+//			{GettextCatalog.GetString ("_Item Directory"), "${ItemDir}"},
+//			{GettextCatalog.GetString ("Item file name"), "${ItemFileName}"},
+//			{GettextCatalog.GetString ("Item extension"), "${ItemExt}"},
+//			{"-", ""},
+//			{GettextCatalog.GetString ("Current line"), "${CurLine}"},
+//			{GettextCatalog.GetString ("Current column"), "${CurCol}"},
+//			{GettextCatalog.GetString ("Current text"), "${CurText}"},
+//			{"-", ""},
+//			{GettextCatalog.GetString ("Target Path"), "${TargetPath}"},
+//			{GettextCatalog.GetString ("_Target Directory"), "${TargetDir}"},
+//			{GettextCatalog.GetString ("Target Name"), "${TargetName}"},
+//			{GettextCatalog.GetString ("Target Extension"), "${TargetExt}"},
+//			{"-", ""},
+//			{GettextCatalog.GetString ("_Project Directory"), "${ProjectDir}"},
+//			{GettextCatalog.GetString ("Project file name"), "${ProjectFileName}"},
+//			{"-", ""},
+//			{GettextCatalog.GetString ("_Solution Directory"), "${CombineDir}"},
+//			{GettextCatalog.GetString ("Solution File Name"), "${CombineFileName}"},
+//			{"-", ""},
+//			{GettextCatalog.GetString ("MonoDevelop Startup Directory"), "${StartupPath}"},
+//		};
+
+		static string[,] workingDirInsertMenu = new string[,] {
+			{GettextCatalog.GetString ("_Item Directory"), "${ItemDir}"},
+			{"-", ""},
+			{GettextCatalog.GetString ("_Target Directory"), "${TargetDir}"},
+			{GettextCatalog.GetString ("Target Name"), "${TargetName}"},
+			{"-", ""},
+			{GettextCatalog.GetString ("_Project Directory"), "${ProjectDir}"},
+			{"-", ""},
+			{GettextCatalog.GetString ("_Solution Directory"), "${CombineDir}"},
+			{"-", ""},
+			{GettextCatalog.GetString ("MonoDevelop Startup Directory"), "${StartupPath}"},
+		};
+		
 		public CustomCommandWidget (CombineEntry entry, CustomCommand cmd)
 		{
 			this.Build();
@@ -21,9 +60,12 @@
 				comboType.RemoveText (0);
 				updating = false;
 			}
+			
 			this.entry = entry;
 			UpdateControls ();
 			this.WidgetFlags |= Gtk.WidgetFlags.NoShowAll;
+			
+			new MenuButtonEntry (workingdirEntry, workingdirQuickInsertButton, workingDirInsertMenu);
 		}
 		
 		public CustomCommand CustomCommand {
@@ -48,6 +90,7 @@
 				checkExternalCons.Active = cmd.ExternalConsole;
 				checkPauseCons.Active = cmd.PauseExternalConsole;
 				checkPauseCons.Sensitive = cmd.ExternalConsole;
+				workingdirEntry.Text = cmd.WorkingDir;
 			}
 			updating = false;
 		}
@@ -121,6 +164,14 @@
 			if (CommandRemoved != null)
 				CommandRemoved (this, EventArgs.Empty);
 		}
+		
+		protected virtual void OnWorkingdirEntryChanged (object sender, System.EventArgs e)
+		{
+			if (!updating) {
+				cmd.WorkingDir = workingdirEntry.Text;
+				UpdateControls ();
+			}
+		}
 
 		public event EventHandler CommandCreated;
 		public event EventHandler CommandRemoved;
Index: Core/src/MonoDevelop.Ide/gtk-gui/gui.stetic
===================================================================
--- Core/src/MonoDevelop.Ide/gtk-gui/gui.stetic	(revision 83204)
+++ Core/src/MonoDevelop.Ide/gtk-gui/gui.stetic	(working copy)
@@ -40,6 +40,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label" translatable="yes">Search _Files</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="Active">True</property>
                     <signal name="Clicked" handler="OnToggleFilesClicked" />
                   </widget>
@@ -57,6 +58,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label" translatable="yes">Search _Types</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                     <signal name="Clicked" handler="OnToggleTypesClicked" />
                   </widget>
                   <packing>
@@ -162,7 +164,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
           <packing>
@@ -178,7 +180,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-open</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
             <signal name="Clicked" handler="HandleOpen" />
             <property name="label">gtk-open</property>
           </widget>
@@ -328,7 +330,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
           <packing>
@@ -344,7 +346,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-ok</property>
-            <property name="ResponseId">-5</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-ok</property>
           </widget>
           <packing>
@@ -453,7 +455,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-no</property>
-            <property name="ResponseId">-9</property>
+            <property name="IsDialogButton">False</property>
             <signal name="Clicked" handler="OnNoButtonClicked" />
             <property name="label">gtk-no</property>
           </widget>
@@ -470,7 +472,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-yes</property>
-            <property name="ResponseId">-8</property>
+            <property name="IsDialogButton">False</property>
             <signal name="Clicked" handler="OnYesButtonClicked" />
             <property name="label">gtk-yes</property>
           </widget>
@@ -980,7 +982,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <signal name="Clicked" handler="cancelClicked" />
             <property name="label">gtk-cancel</property>
           </widget>
@@ -993,7 +995,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-go-forward</property>
-            <property name="ResponseId">-1</property>
+            <property name="IsDialogButton">False</property>
             <signal name="Clicked" handler="OpenEvent" />
             <property name="label">gtk-go-forward</property>
           </widget>
@@ -1076,6 +1078,7 @@
           <widget class="Gtk.Button" id="button1548">
             <property name="MemberName" />
             <property name="CanFocus">True</property>
+            <signal name="Clicked" handler="OnButtonOkClicked" />
             <property name="Type">TextOnly</property>
             <property name="Label" translatable="yes">button1548</property>
             <property name="UseUnderline">True</property>
@@ -1170,7 +1173,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
           <packing>
@@ -1186,7 +1189,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-ok</property>
-            <property name="ResponseId">-5</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-ok</property>
           </widget>
           <packing>
@@ -1421,7 +1424,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
           <packing>
@@ -1437,7 +1440,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-ok</property>
-            <property name="ResponseId">-5</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-ok</property>
           </widget>
           <packing>
@@ -1561,6 +1564,7 @@
                         <property name="UseStock">True</property>
                         <property name="Type">StockItem</property>
                         <property name="StockId">gtk-remove</property>
+                        <property name="IsDialogButton">False</property>
                         <property name="label">gtk-remove</property>
                       </widget>
                       <packing>
@@ -1578,6 +1582,7 @@
                         <property name="UseStock">True</property>
                         <property name="Type">StockItem</property>
                         <property name="StockId">gtk-add</property>
+                        <property name="IsDialogButton">False</property>
                         <property name="label">gtk-add</property>
                       </widget>
                       <packing>
@@ -1686,7 +1691,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
           <packing>
@@ -1702,7 +1707,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-ok</property>
-            <property name="ResponseId">-5</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-ok</property>
           </widget>
           <packing>
@@ -1814,6 +1819,7 @@
                 <property name="Icon">stock:gtk-apply Button</property>
                 <property name="Label" translatable="yes">Apply</property>
                 <property name="UseUnderline">True</property>
+                <property name="IsDialogButton">False</property>
               </widget>
               <packing>
                 <property name="Position">2</property>
@@ -1899,6 +1905,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label" translatable="yes">Add Group</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="Position">0</property>
@@ -1913,6 +1920,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label" translatable="yes">Edit Group</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="Position">1</property>
@@ -1927,6 +1935,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label" translatable="yes">Remove Group</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="Position">2</property>
@@ -1990,6 +1999,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-add</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-add</property>
                   </widget>
                   <packing>
@@ -2005,6 +2015,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-edit</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-edit</property>
                   </widget>
                   <packing>
@@ -2020,6 +2031,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-remove</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-remove</property>
                   </widget>
                   <packing>
@@ -2706,6 +2718,7 @@
                     <property name="Icon">stock:gtk-go-forward Button</property>
                     <property name="Label" translatable="yes">_Next Tip</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                 </child>
                 <child>
@@ -2716,6 +2729,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-close</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-close</property>
                   </widget>
                   <packing>
@@ -2918,6 +2932,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-add</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-add</property>
                   </widget>
                   <packing>
@@ -2933,6 +2948,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-remove</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-remove</property>
                   </widget>
                   <packing>
@@ -2960,6 +2976,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-go-up</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-go-up</property>
                   </widget>
                   <packing>
@@ -2975,6 +2992,7 @@
                     <property name="UseStock">True</property>
                     <property name="Type">StockItem</property>
                     <property name="StockId">gtk-go-down</property>
+                    <property name="IsDialogButton">False</property>
                     <property name="label">gtk-go-down</property>
                   </widget>
                   <packing>
@@ -3083,6 +3101,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label"> &gt; </property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="LeftAttach">1</property>
@@ -3144,6 +3163,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label"> &gt; </property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="LeftAttach">1</property>
@@ -3375,7 +3395,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
           <packing>
@@ -3434,6 +3454,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label">&gt;</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="LeftAttach">2</property>
@@ -3493,6 +3514,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label">&gt;</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="TopAttach">1</property>
@@ -3682,7 +3704,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-close</property>
-            <property name="ResponseId">-7</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-close</property>
           </widget>
         </child>
@@ -3693,7 +3715,7 @@
             <property name="Type">TextOnly</property>
             <property name="Label" translatable="yes">_Mark All</property>
             <property name="UseUnderline">True</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
           </widget>
           <packing>
             <property name="Position">1</property>
@@ -3708,7 +3730,7 @@
             <property name="Icon">stock:gtk-find-and-replace Button</property>
             <property name="Label" translatable="yes">R_eplace All</property>
             <property name="UseUnderline">True</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
           </widget>
           <packing>
             <property name="Position">2</property>
@@ -3721,7 +3743,7 @@
             <property name="Icon">stock:gtk-find-and-replace Button</property>
             <property name="Label" translatable="yes">_Replace</property>
             <property name="UseUnderline">True</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
           </widget>
           <packing>
             <property name="Position">3</property>
@@ -3735,7 +3757,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-find</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-find</property>
           </widget>
           <packing>
@@ -3780,6 +3802,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label">...</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="TopAttach">3</property>
@@ -3847,6 +3870,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label">&gt;</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="LeftAttach">2</property>
@@ -3946,6 +3970,7 @@
                     <property name="Type">TextOnly</property>
                     <property name="Label">&gt;</property>
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                   </widget>
                   <packing>
                     <property name="TopAttach">1</property>
@@ -4150,7 +4175,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-stop</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-stop</property>
           </widget>
         </child>
@@ -4160,7 +4185,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-close</property>
-            <property name="ResponseId">-7</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-close</property>
           </widget>
           <packing>
@@ -4174,7 +4199,7 @@
             <property name="Icon">stock:gtk-find-and-replace Button</property>
             <property name="Label" translatable="yes">R_eplace All</property>
             <property name="UseUnderline">True</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
           </widget>
           <packing>
             <property name="Position">2</property>
@@ -4188,7 +4213,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-find</property>
-            <property name="ResponseId">0</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-find</property>
           </widget>
           <packing>
@@ -4314,6 +4339,7 @@
                 <property name="Type">TextOnly</property>
                 <property name="Label" translatable="yes">Add-in Manager...</property>
                 <property name="UseUnderline">True</property>
+                <property name="IsDialogButton">False</property>
                 <signal name="Clicked" handler="OnManageClicked" />
               </widget>
               <packing>
@@ -4462,6 +4488,7 @@
                         <property name="UseStock">True</property>
                         <property name="Type">StockItem</property>
                         <property name="StockId">gtk-edit</property>
+                        <property name="IsDialogButton">False</property>
                         <property name="label">gtk-edit</property>
                       </widget>
                     </child>
@@ -4471,6 +4498,7 @@
                         <property name="UseStock">True</property>
                         <property name="Type">StockItem</property>
                         <property name="StockId">gtk-remove</property>
+                        <property name="IsDialogButton">False</property>
                         <property name="label">gtk-remove</property>
                       </widget>
                       <packing>
@@ -4483,6 +4511,7 @@
                         <property name="UseStock">True</property>
                         <property name="Type">StockItem</property>
                         <property name="StockId">gtk-add</property>
+                        <property name="IsDialogButton">False</property>
                         <property name="label">gtk-add</property>
                       </widget>
                       <packing>
@@ -4842,6 +4871,7 @@
                     <property name="Icon">stock:gtk-go-forward Button</property>
                     <property name="Label" translatable="yes" />
                     <property name="UseUnderline">True</property>
+                    <property name="IsDialogButton">False</property>
                     <signal name="Clicked" handler="OnAddClicked" />
                   </widget>
                   <packing>
@@ -4856,6 +4886,7 @@
                     <property name="MemberName" />
                     <property name="Type">TextAndIcon</property>
                     <property name="Icon">stock:gtk-go-back SmallToolbar</property>
+                    <property name="IsDialogButton">False</property>
                     <signal name="Clicked" handler="OnRemoveClicked" />
                   </widget>
                   <packing>
@@ -4902,6 +4933,7 @@
                   <widget class="Gtk.Button" id="btnUp">
                     <property name="MemberName" />
                     <property name="Type">Custom</property>
+                    <property name="IsDialogButton">False</property>
                     <signal name="Clicked" handler="OnUpClicked" />
                     <child>
                       <widget class="Gtk.Image" id="image9">
@@ -4923,6 +4955,7 @@
                   <widget class="Gtk.Button" id="btnDown">
                     <property name="MemberName" />
                     <property name="Type">Custom</property>
+                    <property name="IsDialogButton">False</property>
                     <signal name="Clicked" handler="OnDownClicked" />
                     <child>
                       <widget class="Gtk.Image" id="image10">
@@ -4978,7 +5011,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
         </child>
@@ -4988,7 +5021,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-ok</property>
-            <property name="ResponseId">-5</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-ok</property>
           </widget>
           <packing>
@@ -5104,6 +5137,7 @@
                                 <property name="MemberName" />
                                 <property name="Tooltip">Remove</property>
                                 <property name="Type">Custom</property>
+                                <property name="IsDialogButton">False</property>
                                 <signal name="Clicked" handler="RemoveReference" />
                                 <child>
                                   <widget class="Gtk.Image" id="but">
@@ -5167,7 +5201,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
         </child>
@@ -5177,7 +5211,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-ok</property>
-            <property name="ResponseId">-5</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-ok</property>
           </widget>
           <packing>
@@ -5341,6 +5375,7 @@
                         <property name="Type">TextOnly</property>
                         <property name="Label" translatable="yes">Select _All</property>
                         <property name="UseUnderline">True</property>
+                        <property name="IsDialogButton">False</property>
                       </widget>
                     </child>
                     <child>
@@ -5349,6 +5384,7 @@
                         <property name="UseStock">True</property>
                         <property name="Type">StockItem</property>
                         <property name="StockId">gtk-clear</property>
+                        <property name="IsDialogButton">False</property>
                         <property name="label">gtk-clear</property>
                       </widget>
                       <packing>
@@ -5391,7 +5427,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-cancel</property>
-            <property name="ResponseId">-6</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-cancel</property>
           </widget>
         </child>
@@ -5403,7 +5439,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-ok</property>
-            <property name="ResponseId">-5</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-ok</property>
           </widget>
           <packing>
@@ -5556,7 +5592,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-no</property>
-            <property name="ResponseId">-9</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-no</property>
           </widget>
           <packing>
@@ -5571,7 +5607,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-yes</property>
-            <property name="ResponseId">-8</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-yes</property>
           </widget>
           <packing>
@@ -5588,7 +5624,7 @@
             <property name="UseStock">True</property>
             <property name="Type">StockItem</property>
             <property name="StockId">gtk-close</property>
-            <property name="ResponseId">-7</property>
+            <property name="IsDialogButton">False</property>
             <property name="label">gtk-close</property>
           </widget>
           <packing>
@@ -5878,4 +5914,4 @@
       </widget>
     </child>
   </widget>
-</stetic-interface>
\ No newline at end of file
+</stetic-interface>
