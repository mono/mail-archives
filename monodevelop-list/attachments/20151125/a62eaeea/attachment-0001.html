<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;ve&nbsp;posted&nbsp;a&nbsp;sample&nbsp;project&nbsp;that&nbsp;demonstrates&nbsp;this&nbsp;problem&nbsp;(or&nbsp;one&nbsp;very&nbsp;similar&nbsp;to&nbsp;it)&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;https://github.com/tomkcook/T4CSTest&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/tomkcook/T4CSTest&lt;/a&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;use&nbsp;it:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;Open&nbsp;the&nbsp;T4CSTest&nbsp;solution&nbsp;in&nbsp;MonoDevelop.&lt;/li&gt;&lt;li&gt;Restore&nbsp;packages&nbsp;for&nbsp;the&nbsp;T4CSTest&nbsp;project.&lt;/li&gt;&lt;li&gt;Build&nbsp;the&nbsp;T4CSTest&nbsp;project&nbsp;(this&nbsp;is&nbsp;a&nbsp;library&nbsp;that&nbsp;uses&nbsp;the&nbsp;Microsoft.CodeAnalysis.*&nbsp;assemblies). &nbsp;The&nbsp;Utilities&nbsp;class&nbsp;has&nbsp;a&nbsp;single&nbsp;method&nbsp;called&nbsp;GetFirstNamespace(string)&nbsp;that&nbsp;returns&nbsp;the&nbsp;code&nbsp;of&nbsp;the&nbsp;first&nbsp;namespace&nbsp;in&nbsp;the&nbsp;string&nbsp;it&nbsp;is&nbsp;passed.&lt;/li&gt;&lt;li&gt;Build&nbsp;the&nbsp;Templates&nbsp;project&nbsp;and&nbsp;run&nbsp;the&nbsp;resulting&nbsp;executable&nbsp;-&nbsp;this&nbsp;is&nbsp;a&nbsp;C#&nbsp;programme&nbsp;that&nbsp;shows&nbsp;that&nbsp;the&nbsp;GetFirstNamespace&nbsp;method&nbsp;working.&lt;/li&gt;&lt;li&gt;At&nbsp;the&nbsp;command-line:&lt;br&gt;cd&nbsp;T4CSTest/Templates&lt;br&gt;/usr/lib/monodevelop/AddIns/MonoDevelop.TextTemplating/TextTransform.exe&nbsp;-P=../T4CSTest/bin/Debug&nbsp;T4Template.tt&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;It&nbsp;produces&nbsp;the&nbsp;following&nbsp;output:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Invalid&nbsp;type&nbsp;Microsoft.CodeAnalysis.SyntaxTree&nbsp;for&nbsp;instance&nbsp;field&nbsp;Microsoft.CodeAnalysis.SyntaxNode:_syntaxTree<br>
Processing&nbsp;&#39;T4Template.tt&#39;&nbsp;failed.<br>
(0,0):&nbsp;ERROR&nbsp;Error&nbsp;running&nbsp;transform:&nbsp;System.Reflection.TargetInvocationException:&nbsp;Exception&nbsp;has&nbsp;been&nbsp;thrown&nbsp;by&nbsp;the&nbsp;target&nbsp;of&nbsp;an&nbsp;invocation.&nbsp;---&gt;&nbsp;System.TypeLoadException:&nbsp;Failure&nbsp;has&nbsp;occurred&nbsp;while&nbsp;loading&nbsp;a&nbsp;type.<br>
&nbsp;&nbsp;at&nbsp;T4CSTest.Utilities.GetFirstNamespace&nbsp;(System.String&nbsp;code)&nbsp;&lt;0x414484c0&nbsp;+&nbsp;0x0002f&gt;&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&nbsp;<br>
&nbsp;&nbsp;at&nbsp;Microsoft.VisualStudio.TextTemplating.GeneratedTextTransformation5c65abe6.TransformText&nbsp;()&nbsp;&lt;0x41447fa0&nbsp;+&nbsp;0x00087&gt;&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&nbsp;<br>
&nbsp;&nbsp;at&nbsp;(wrapper&nbsp;managed-to-native)&nbsp;System.Reflection.MonoMethod:InternalInvoke&nbsp;(System.Reflection.MonoMethod,object,object[],System.Exception&amp;)<br>
&nbsp;&nbsp;at&nbsp;System.Reflection.MonoMethod.Invoke&nbsp;(System.Object&nbsp;obj,&nbsp;BindingFlags&nbsp;invokeAttr,&nbsp;System.Reflection.Binder&nbsp;binder,&nbsp;System.Object[]&nbsp;parameters,&nbsp;System.Globalization.CultureInfo&nbsp;culture)&nbsp;&lt;0x7f32871ab780&nbsp;+&nbsp;0x000a1&gt;&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&nbsp;<br>
&nbsp;&nbsp;---&nbsp;End&nbsp;of&nbsp;inner&nbsp;exception&nbsp;stack&nbsp;trace&nbsp;---<br>
&nbsp;&nbsp;at&nbsp;System.Reflection.MonoMethod.Invoke&nbsp;(System.Object&nbsp;obj,&nbsp;BindingFlags&nbsp;invokeAttr,&nbsp;System.Reflection.Binder&nbsp;binder,&nbsp;System.Object[]&nbsp;parameters,&nbsp;System.Globalization.CultureInfo&nbsp;culture)&nbsp;&lt;0x7f32871ab780&nbsp;+&nbsp;0x000ef&gt;&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&nbsp;<br>
&nbsp;&nbsp;at&nbsp;System.Reflection.MethodBase.Invoke&nbsp;(System.Object&nbsp;obj,&nbsp;System.Object[]&nbsp;parameters)&nbsp;&lt;0x7f3286fe3cf0&nbsp;+&nbsp;0x0002a&gt;&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&nbsp;<br>
&nbsp;&nbsp;at&nbsp;Mono.TextTemplating.CompiledTemplate.Process&nbsp;()&nbsp;&lt;0x41447520&nbsp;+&nbsp;0x0036f&gt;&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&nbsp;<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Wed,&nbsp;25&nbsp;Nov&nbsp;2015&nbsp;at&nbsp;09:36&nbsp;Tom&nbsp;Cook&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:tom.k.cook@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;tom.k.cook@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;porting&nbsp;some&nbsp;T4&nbsp;templates&nbsp;from&nbsp;the&nbsp;Microsoft&nbsp;.NET&nbsp;Framework&nbsp;to&nbsp;Mono. &nbsp;They&nbsp;use&nbsp;an&nbsp;in-house&nbsp;assembly&nbsp;called&nbsp;DataModelDefinition,&nbsp;which&nbsp;in&nbsp;turn&nbsp;uses&nbsp;the&nbsp;Microsoft.CodeAnalysis&nbsp;and&nbsp;Microsoft.CodeAnalysis.CSharp&nbsp;assemblies&nbsp;to&nbsp;process&nbsp;some&nbsp;C#&nbsp;code.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;try&nbsp;to&nbsp;run&nbsp;one&nbsp;of&nbsp;these&nbsp;templates,&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;error:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;$&nbsp;TextTransform.exe&nbsp;-P=&lt;path&nbsp;to&nbsp;assemblies&gt;&nbsp;-o&nbsp;test.txt&nbsp;ProcessFiles.tt&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&lt;a&nbsp;bunch&nbsp;of&nbsp;expected&nbsp;output&nbsp;from&nbsp;my&nbsp;code&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Invalid&nbsp;type&nbsp;Microsoft.CodeAnalysis.SyntaxTree&nbsp;for&nbsp;instance&nbsp;field&nbsp;Microsoft.CodeAnalysis.SyntaxNode:_syntaxTree&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Invalid&nbsp;type&nbsp;Microsoft.CodeAnalysis.SyntaxNode&nbsp;for&nbsp;instance&nbsp;field&nbsp;Microsoft.CodeAnalysis.SyntaxToken:parent&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Failed&nbsp;to&nbsp;generate&nbsp;&lt;path&gt;/ProjectInfo.xml&nbsp;because&nbsp;:&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Could&nbsp;not&nbsp;load&nbsp;type&nbsp;&#39;Microsoft.CodeAnalysis.SyntaxToken&#39;&nbsp;from&nbsp;assembly&nbsp;&#39;Microsoft.CodeAnalysis,&nbsp;Version=0.6.0.0,&nbsp;Culture=neutral,&nbsp;PublicKeyToken=31bf3856ad364e35&#39;.&lt;/div&gt;&lt;div&gt;&gt; &lt;/div&gt;&lt;div&gt;&gt;&nbsp;Stack&nbsp;trace:&lt;/div&gt;&lt;div&gt;&gt;&nbsp; &nbsp;&lt;a&nbsp;bunch&nbsp;of&nbsp;files&nbsp;within&nbsp;the&nbsp;DataModelDefinition&nbsp;assembly&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;if&nbsp;I&nbsp;write&nbsp;a&nbsp;stand-alone&nbsp;console&nbsp;programme&nbsp;that&nbsp;references&nbsp;the&nbsp;same&nbsp;assemblies&nbsp;and&nbsp;invokes&nbsp;the&nbsp;same&nbsp;method,&nbsp;it&nbsp;works&nbsp;without&nbsp;a&nbsp;problem.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;could&nbsp;cause&nbsp;the&nbsp;failure&nbsp;to&nbsp;load&nbsp;these&nbsp;types?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;trying&nbsp;to&nbsp;put&nbsp;together&nbsp;a&nbsp;simple&nbsp;test&nbsp;case&nbsp;that&nbsp;demonstrates&nbsp;the&nbsp;problem;&nbsp;I&#39;ll&nbsp;get&nbsp;back&nbsp;when&nbsp;I&#39;ve&nbsp;got&nbsp;something&nbsp;together.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Tom&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
