<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> CSharp parser deep class searches [Was: [MonoDevelop]
	DefaultParserService: deep class yada yada]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=CSharp%20parser%20deep%20class%20searches%20%5BWas%3A%20%5BMonoDevelop%5D%0A%09DefaultParserService%3A%20deep%20class%20yada%20yada%5D&In-Reply-To=20050615131633.GA1933%40butchest.cubesearch.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002180.html">
   <LINK REL="Next"  HREF="002181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>CSharp parser deep class searches [Was: [MonoDevelop]
	DefaultParserService: deep class yada yada]</H1>
    <B>Peter Johanson</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=CSharp%20parser%20deep%20class%20searches%20%5BWas%3A%20%5BMonoDevelop%5D%0A%09DefaultParserService%3A%20deep%20class%20yada%20yada%5D&In-Reply-To=20050615131633.GA1933%40butchest.cubesearch.com"
       TITLE="CSharp parser deep class searches [Was: [MonoDevelop]
	DefaultParserService: deep class yada yada]">latexer at gentoo.org
       </A><BR>
    <I>Thu Jun 16 22:25:20 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002180.html">[MonoDevelop] DefaultParserService: deep class search in
	SearchType()
</A></li>
        <LI>Next message: <A HREF="002181.html">[MonoDevelop] Writing addins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2188">[ date ]</a>
              <a href="thread.html#2188">[ thread ]</a>
              <a href="subject.html#2188">[ subject ]</a>
              <a href="author.html#2188">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jun 15, 2005 at 06:16:33AM -0700, Peter Johanson wrote:
&gt;<i> Hey all,
</I>&gt;<i> 
</I>&gt;<i> Currently, if you have a project with a reference to gtk-sharp.dll, and
</I>&gt;<i> you instantiate a Gtk.Window, w, then trying to complete the members of
</I>&gt;<i> &quot;w.GdkWindow&quot; doesn't work (in either C# or Boo bindings, haven't
</I>
After talking with Lluis about this, he seemed to think that fixing this
in the various language bindings was better. Attached is a patch that
should do this for the C# resolver, I have an equivalent patch for boo
ready if people like this better. Thoughts?

-pete

-- 
Peter Johanson
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">latexer at gentoo.org</A>&gt;
-------------- next part --------------
Index: Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Resolver.cs
===================================================================
--- Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Resolver.cs	(revision 2602)
+++ Core/src/AddIns/BackendBindings/CSharpBinding/Parser/Resolver.cs	(working copy)
@@ -169,7 +169,7 @@
 				return null;
 			}
 			IReturnType retType = internalResolve (parserService, expression, caretLineNumber, caretColumn, fileName, fileContent);
-			IClass retClass = parserService.SearchType (project, retType.FullyQualifiedName, null, cu);
+			IClass retClass = parserService.GetClass (project, retType.FullyQualifiedName, true, true);
 			if (retClass == null) {
 				Console.WriteLine (&quot;Retclass was null&quot;);
 				return null;
@@ -716,7 +716,7 @@
 				return null;
 			}
 			IClass c;
-			c = parserService.GetClass(project, name);
+			c = parserService.GetClass(project, name, true, true);
 			if (c != null) {
 //				Console.WriteLine(&quot;Found!&quot;);
 				return c;
@@ -727,10 +727,15 @@
 				foreach (IUsing u in unit.Usings) {
 					if (u != null &amp;&amp; (u.Region == null || u.Region.IsInside(caretLine, caretColumn))) {
 //						Console.WriteLine(&quot;In UsingRegion&quot;);
-						c = parserService.SearchType(project, u, name);
-						if (c != null) {
-//							Console.WriteLine(&quot;SearchType Successfull!!!&quot;);
-							return c;
+						foreach (string str in u.Usings)
+						{
+							string possibleType = String.Concat(str, &quot;.&quot;, name);
+
+							c = parserService.GetClass(project, possibleType, true, true);
+							if (c != null) {
+	//							Console.WriteLine(&quot;SearchType Successfull!!!&quot;);
+								return c;
+							}
 						}
 					}
 				}
@@ -745,7 +750,7 @@
 			
 			do {
 				curnamespace += namespaces[i] + '.';
-				c = parserService.GetClass(project, curnamespace + name);
+				c = parserService.GetClass(project, curnamespace + name, true, true);
 				if (c != null) {
 					return c;
 				}
Index: Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog
===================================================================
--- Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog	(revision 2602)
+++ Core/src/AddIns/BackendBindings/CSharpBinding/ChangeLog	(working copy)
@@ -1,3 +1,8 @@
+2005-05-16  Peter Johanson  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">latexer at gentoo.org</A>&gt; 
+
+	* Parser/Resolver.cs: Make searches for classes deep searches, to
+	resolve types from assemblies referened by project references.
+
 2005-05-15  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-list">lluis at novell.com</A>&gt; 
 
 	* CSharp.glade: Several fixes to make the dialogs more conforming
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002180.html">[MonoDevelop] DefaultParserService: deep class search in
	SearchType()
</A></li>
	<LI>Next message: <A HREF="002181.html">[MonoDevelop] Writing addins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2188">[ date ]</a>
              <a href="thread.html#2188">[ thread ]</a>
              <a href="subject.html#2188">[ subject ]</a>
              <a href="author.html#2188">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
