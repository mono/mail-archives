<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [MonoDevelop] [Fwd: [Mono-patches] r100941 - in trunk/monodevelop/main/src:	addins/CBinding addins/CBinding/Gui addins/CSharpBinding	addins/CSharpBinding/Gui addins/MonoDevelop.SourceEditor2 addins/MonoDevelop.SourceEditor2/MonoDevelop.SourceEditor	addins/MonoDevelop.XmlEditor addins/MonoDevelop.XmlEditor/MonoDevelop.XmlEditor	core/MonoDevelop.Ide	core/MonoDevelop.Ide/MonoDevelop.Ide.Gui.Content]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20%5BFwd%3A%20%5BMono-patches%5D%20r100941%20-%20in%0A%20trunk/monodevelop/main/src%3A%09addins/CBinding%20addins/CBinding/Gui%0A%20addins/CSharpBinding%09addins/CSharpBinding/Gui%0A%20addins/MonoDevelop.SourceEditor2%0A%20addins/MonoDevelop.SourceEditor2/MonoDevelop.SourceEditor%09addins/MonoDevelop.XmlEditor%0A%20addins/MonoDevelop.XmlEditor/MonoDevelop.XmlEditor%09core/MonoDevelop.Ide%09core/MonoDevelop.Ide/MonoDevelop.Ide.Gui.Content%5D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007621.html">
   <LINK REL="Next"  HREF="007623.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[MonoDevelop] [Fwd: [Mono-patches] r100941 - in trunk/monodevelop/main/src:	addins/CBinding addins/CBinding/Gui addins/CSharpBinding	addins/CSharpBinding/Gui addins/MonoDevelop.SourceEditor2 addins/MonoDevelop.SourceEditor2/MonoDevelop.SourceEditor	addins/MonoDevelop.XmlEditor addins/MonoDevelop.XmlEditor/MonoDevelop.XmlEditor	core/MonoDevelop.Ide	core/MonoDevelop.Ide/MonoDevelop.Ide.Gui.Content]</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:monodevelop-list%40lists.ximian.com?Subject=%5BMonoDevelop%5D%20%5BFwd%3A%20%5BMono-patches%5D%20r100941%20-%20in%0A%20trunk/monodevelop/main/src%3A%09addins/CBinding%20addins/CBinding/Gui%0A%20addins/CSharpBinding%09addins/CSharpBinding/Gui%0A%20addins/MonoDevelop.SourceEditor2%0A%20addins/MonoDevelop.SourceEditor2/MonoDevelop.SourceEditor%09addins/MonoDevelop.XmlEditor%0A%20addins/MonoDevelop.XmlEditor/MonoDevelop.XmlEditor%09core/MonoDevelop.Ide%09core/MonoDevelop.Ide/MonoDevelop.Ide.Gui.Content%5D&In-Reply-To="
       TITLE="[MonoDevelop] [Fwd: [Mono-patches] r100941 - in trunk/monodevelop/main/src:	addins/CBinding addins/CBinding/Gui addins/CSharpBinding	addins/CSharpBinding/Gui addins/MonoDevelop.SourceEditor2 addins/MonoDevelop.SourceEditor2/MonoDevelop.SourceEditor	addins/MonoDevelop.XmlEditor addins/MonoDevelop.XmlEditor/MonoDevelop.XmlEditor	core/MonoDevelop.Ide	core/MonoDevelop.Ide/MonoDevelop.Ide.Gui.Content]">atsushi at ximian.com
       </A><BR>
    <I>Thu Apr 17 23:39:27 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="007621.html">[MonoDevelop] Same way for linux library as windows library
</A></li>
        <LI>Next message: <A HREF="007623.html">[MonoDevelop] I've been updating the pt_BR translation for	MonoDevelop's main tree, but...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7622">[ date ]</a>
              <a href="thread.html#7622">[ thread ]</a>
              <a href="subject.html#7622">[ subject ]</a>
              <a href="author.html#7622">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

I have one liner patch that fixes bogus attempt to jump to -1 when 
trying to jump to top (HOME). Feel free to commit ;)

Atsushi Eno

Modified: trunk/monodevelop/main/src/addins/CSharpBinding/Gui/CSharpTextEditorExtension.cs
===================================================================
--- trunk/monodevelop/main/src/addins/CSharpBinding/Gui/CSharpTextEditorExtension.cs	2008-04-16 19:46:03 UTC (rev 100940)
+++ trunk/monodevelop/main/src/addins/CSharpBinding/Gui/CSharpTextEditorExtension.cs	2008-04-16 20:12:45 UTC (rev 100941)
@@ -189,9 +189,9 @@
 			base.TextChanged (startIndex, endIndex);
 		}
 		
-		public override bool KeyPress (Gdk.Key key, Gdk.ModifierType modifier)
+		public override bool KeyPress (Gdk.Key key, char keyChar, Gdk.ModifierType modifier)
 		{
-			if ((char)(uint)key == ',') {
+			if (keyChar == ',') {
 				// Parameter completion
 				if (CanRunParameterCompletionCommand ())
 					RunParameterCompletionCommand ();
@@ -209,13 +209,12 @@
 				bool hadSelection = Editor.SelectionEndPosition != Editor.SelectionStartPosition;
 				
 				//pass through to the base class, which actually inserts the character
-				bool retval = base.KeyPress (key, modifier);
+				bool retval = base.KeyPress (key, keyChar, modifier);
 				UpdateSmartIndentEngine ();
 				
 				//handle inserted characters
 				bool reIndent = false;
-				char lastCharInserted = KeyToChar (key);
-				//System.Console.WriteLine (lastCharInserted);
+				char lastCharInserted = TranslateKeyCharForIndenter (key, keyChar, Editor.GetCharAt (Editor.CursorPosition - 1));
 				if (!(oldLine == Editor.CursorLine &amp;&amp; lastCharInserted == '\n') &amp;&amp; (oldBufLen != Editor.TextLength || lastCharInserted != '\0'))
 					DoPostInsertionSmartIndent (lastCharInserted, hadSelection, out reIndent);
 				
@@ -227,20 +226,24 @@
 					DoReSmartIndent ();
 				return retval;
 			}
-			return base.KeyPress (key, modifier);
+			return base.KeyPress (key, keyChar, modifier);
 		}
 		
-		char KeyToChar (Gdk.Key key)
+		static char TranslateKeyCharForIndenter (Gdk.Key key, char keyChar, char docChar)
 		{
+			char c = keyChar;
 			switch (key) {
+			case Gdk.Key.Return:
+			case Gdk.Key.KP_Enter:
+				return '\n';
 			case Gdk.Key.Tab:
 				return '\t';
-			case Gdk.Key.KP_Enter:
-			case Gdk.Key.Return:
-				return '\n';
 			default:
-				return (char) Gdk.Keyval.ToUnicode ((uint)key);
+				if (docChar == keyChar)
+					return keyChar;
+				break;
 			}
+			return '\0';
 		}
 		
 		void ResetSmartIndentEngineToCursor (int cursor)



-------------- next part --------------
A non-text attachment was scrubbed...
Name: csharptexteditor-jumptotop.patch
Type: text/x-patch
Size: 876 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/monodevelop-list/attachments/20080418/fa2fd7e7/attachment.bin">http://lists.ximian.com/pipermail/monodevelop-list/attachments/20080418/fa2fd7e7/attachment.bin</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007621.html">[MonoDevelop] Same way for linux library as windows library
</A></li>
	<LI>Next message: <A HREF="007623.html">[MonoDevelop] I've been updating the pt_BR translation for	MonoDevelop's main tree, but...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7622">[ date ]</a>
              <a href="thread.html#7622">[ thread ]</a>
              <a href="subject.html#7622">[ subject ]</a>
              <a href="author.html#7622">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-list">More information about the Monodevelop-list
mailing list</a><br>
</body></html>
