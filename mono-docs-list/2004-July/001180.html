<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-docs-list] Monodoc layout loading patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:peter%40newton.cx">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="001190.html">
   <LINK REL="Next"  HREF="001183.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-docs-list] Monodoc layout loading patch
   </H1>
    <B>Peter Williams
    </B> 
    <A HREF="mailto:peter%40newton.cx"
       TITLE="[Mono-docs-list] Monodoc layout loading patch">peter@newton.cx
       </A><BR>
    <I>Fri, 16 Jul 2004 18:35:09 -0400</I>
    <P><UL>
        <LI> Previous message: <A HREF="001190.html">[Mono-docs-list] Monodoc tree layout loading
</A></li>
        <LI> Next message: <A HREF="001183.html">[Mono-docs-list] Monodoc layout loading patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1180">[ date ]</a>
              <a href="thread.html#1180">[ thread ]</a>
              <a href="subject.html#1180">[ subject ]</a>
              <a href="author.html#1180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-mjLr0z8KPp82P0ocXAD8
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hi all,

Following up on my previous mail, here's a patch to allow a limited form
of what I wanted. It will allow you to put &lt;node&gt; elements in the
.sources file for a source; new nodes will be created below the
&quot;Various&quot; tree and your docs can land there.

This avoids the thornier issues of figuring out how to put sources in
the right order, although it also means that nodes without a source will
find their way into the tree. (For instance, I don't have the handbook
installed, so the Mono Handbook node in my monodoc is useless.)

Peter

-- 
Peter Williams                          <A HREF="mailto:peter@newton.cx">peter@newton.cx</A>

&quot;[Ninjas] are cool; and by cool, I mean totally sweet.&quot;
                              -- REAL Ultimate Power

--=-mjLr0z8KPp82P0ocXAD8
Content-Disposition: attachment; filename=third-party-docs.diff
Content-Type: text/x-patch; name=third-party-docs.diff; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

Index: browser/ChangeLog
===================================================================
RCS file: /cvs/public/monodoc/browser/ChangeLog,v
retrieving revision 1.130
diff -u -r1.130 ChangeLog
--- browser/ChangeLog	15 Jul 2004 22:02:28 -0000	1.130
+++ browser/ChangeLog	16 Jul 2004 21:30:21 -0000
@@ -1,3 +1,9 @@
+2004-07-16  Peter Williams  &lt;<A HREF="mailto:peter@newton.cx">peter@newton.cx</A>&gt;
+
+	* provider.cs: Allow sources to add nodes into the &quot;Various&quot; branch of the
+	documentation tree, so third-party libraries can show documentation in Monodoc
+	without needing to hack monodoc.xml
+
 2004-07-15  Peter Williams  &lt;<A HREF="mailto:peter@newton.cx">peter@newton.cx</A>&gt;
 
 	* ecmaspec-html.xsl: There are nested lists in the ECMA spec: see ecma334/10.8.xml.
Index: browser/provider.cs
===================================================================
RCS file: /cvs/public/monodoc/browser/provider.cs,v
retrieving revision 1.64
diff -u -r1.64 provider.cs
--- browser/provider.cs	21 Jun 2004 22:52:59 -0000	1.64
+++ browser/provider.cs	16 Jul 2004 21:30:21 -0000
@@ -692,6 +692,12 @@
 		root.name_to_node [&quot;root&quot;] = root;
 		root.Populate (root, nodes);
 
+		Node third_party = root.LookupEntryPoint (&quot;various&quot;);
+		if (third_party == null) {
+			Console.Error.WriteLine (&quot;No 'various' doc node! Check monodoc.xml!&quot;);
+			third_party = root;
+		}
+
 		//
 		// Load the sources
 		//
@@ -709,6 +715,11 @@
 				Console.Error.WriteLine (&quot;Error: Could not load source file {0}&quot;, file);
 				continue;
 			}
+
+			XmlNodeList extra_nodes = doc.SelectNodes (&quot;/monodoc/node&quot;);
+			if (extra_nodes.Count &gt; 0)
+				root.Populate (third_party, extra_nodes);
+
 			XmlNodeList sources = doc.SelectNodes (&quot;/monodoc/source&quot;);
 			if (sources == null){
 				Console.Error.WriteLine (&quot;Error: No &lt;source&gt; section found in the {0} file&quot;, file);
@@ -807,7 +818,7 @@
 				root.help_sources.Add (hs);
 				root.name_to_hs [path] = hs;
 
-				Node parent = (Node) root.name_to_node [path];
+				Node parent = root.LookupEntryPoint (path);
 				if (parent == null){
 					Console.Error.WriteLine (&quot;node `{0}' is not defined on the documentation map&quot;, path);
 					continue;

--=-mjLr0z8KPp82P0ocXAD8--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="001190.html">[Mono-docs-list] Monodoc tree layout loading
</A></li>
	<LI> Next message: <A HREF="001183.html">[Mono-docs-list] Monodoc layout loading patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1180">[ date ]</a>
              <a href="thread.html#1180">[ thread ]</a>
              <a href="subject.html#1180">[ subject ]</a>
              <a href="author.html#1180">[ author ]</a>
         </LI>
       </UL>
</body></html>
