Index: Monodoc/provider.cs
===================================================================
--- Monodoc/provider.cs	(revision 116332)
+++ Monodoc/provider.cs	(working copy)
@@ -339,7 +339,8 @@
 
 	public void Sort ()
 	{
-		nodes.Sort ();
+		if (nodes != null)
+			nodes.Sort ();
 	}
 
 	public string URL {
@@ -364,7 +365,15 @@
 
 	int IComparable.CompareTo (object obj)
 	{
-		Node other = (Node) obj;
+		Node other = obj as Node;
+		if (other == null)
+			return -1;
+
+		if (position < 0)
+			LoadNode ();
+		if (other.position < 0)
+			other.LoadNode ();
+
 		return String.CompareOrdinal(caption, other.caption);
 	}
 }
@@ -851,6 +860,7 @@
 				foreach (Node n in hs.Tree.Nodes){
 					parent.AddNode (n);
 				}
+				parent.Sort ();
 			}
 		}
 		
@@ -869,6 +879,9 @@
 		// Clean the tree
 		PurgeNode(root);
 
+		// Sort the top 3 levels of the tree
+		root.Sort ();
+
 		return root;
 	}
 	
@@ -949,7 +962,14 @@
 	void Populate (Node parent, XmlNodeList xml_node_list)
 	{
 		foreach (XmlNode xml_node in xml_node_list){
-			XmlAttribute e = xml_node.Attributes ["label"];
+			XmlAttribute e = xml_node.Attributes ["parent"];
+			if (e != null && name_to_node.ContainsKey (e.InnerText)) {
+				Node p = (Node) name_to_node [e.InnerText];
+				xml_node.Attributes.Remove (e);
+				Populate (p, xml_node.SelectNodes ("."));
+				continue;
+			}
+			e = xml_node.Attributes ["label"];
 			if (e == null){
 				Console.Error.WriteLine ("`label' attribute missing in <node>");
 				continue;
