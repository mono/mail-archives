<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-docs-list] Predefined docs patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mwh%40sysrq.dk">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000877.html">
   <LINK REL="Next"  HREF="000875.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-docs-list] Predefined docs patch
   </H1>
    <B>Martin Willemoes Hansen
    </B> 
    <A HREF="mailto:mwh%40sysrq.dk"
       TITLE="[Mono-docs-list] Predefined docs patch">mwh@sysrq.dk
       </A><BR>
    <I>Mon, 13 Oct 2003 15:32:44 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="000877.html">[Mono-docs-list] GTk monodoc issues.
</A></li>
        <LI> Next message: <A HREF="000875.html">[Mono-docs-list] Predefined docs patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#874">[ date ]</a>
              <a href="thread.html#874">[ thread ]</a>
              <a href="subject.html#874">[ subject ]</a>
              <a href="author.html#874">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-pGjIgsL2g8k/wtRpmDhQ
Content-Type: multipart/alternative; boundary=&quot;=-AIF1YZCWdTb6JNuWDmZZ&quot;


--=-AIF1YZCWdTb6JNuWDmZZ
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hi!

I was copying and pasting a lot when describing finalizers and the 3
internal constructors.
This patch will do the hard work in the updater.exe stage.

What do you think?
-- 
Martin Willemoes Hansen

--------------------------------------------------------
E-Mail	<A HREF="mailto:mwh@sysrq.dk">mwh@sysrq.dk</A>	Website	mwh.sysrq.dk
IRC     MWH, freenode.net
--------------------------------------------------------               


--=-AIF1YZCWdTb6JNuWDmZZ
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: 7bit

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 TRANSITIONAL//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
  &lt;META HTTP-EQUIV=&quot;Content-Type&quot; CONTENT=&quot;text/html; CHARSET=UTF-8&quot;&gt;
  &lt;META NAME=&quot;GENERATOR&quot; CONTENT=&quot;GtkHTML/3.0.9&quot;&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
Hi!&lt;BR&gt;
&lt;BR&gt;
I was copying and pasting a lot when describing finalizers and the 3 internal constructors.&lt;BR&gt;
This patch will do the hard work in the updater.exe stage.&lt;BR&gt;
&lt;BR&gt;
What do you think?&lt;BR&gt;
&lt;TABLE CELLSPACING=&quot;0&quot; CELLPADDING=&quot;0&quot; WIDTH=&quot;100%&quot;&gt;
&lt;TR&gt;
&lt;TD&gt;
&lt;PRE&gt;-- 
Martin Willemoes Hansen

--------------------------------------------------------
E-Mail	<A HREF="mailto:mwh@sysrq.dk">mwh@sysrq.dk</A>	Website	mwh.sysrq.dk
IRC     MWH, freenode.net
--------------------------------------------------------               
&lt;/PRE&gt;
&lt;/TD&gt;
&lt;/TR&gt;
&lt;/TABLE&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;

--=-AIF1YZCWdTb6JNuWDmZZ--

--=-pGjIgsL2g8k/wtRpmDhQ
Content-Disposition: attachment; filename=PredefinedDocType.diff
Content-Type: text/x-patch; name=PredefinedDocType.diff; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

? PredefinedDocType.diff
Index: ChangeLog
===================================================================
RCS file: /cvs/public/monodoc/generator/ChangeLog,v
retrieving revision 1.21
diff -u -r1.21 ChangeLog
--- ChangeLog	22 Jul 2003 02:26:05 -0000	1.21
+++ ChangeLog	13 Oct 2003 13:10:06 -0000
@@ -1,3 +1,8 @@
+2003-10-13  Martin Willemoes Hansen  &lt;<A HREF="mailto:mwh@sysrq.dk">mwh@sysrq.dk</A>&gt;
+
+	* updater.cs: Added predefined documentation for finalizers and
+	internal ctor's.
+
 2003-07-21  Duncan Mak  &lt;<A HREF="mailto:duncan@ximian.com">duncan@ximian.com</A>&gt;
 
 	* updater.cs: Fixed indentation from the previous commit and added
Index: updater.cs
===================================================================
RCS file: /cvs/public/monodoc/generator/updater.cs,v
retrieving revision 1.10
diff -u -r1.10 updater.cs
--- updater.cs	31 Jul 2003 04:59:42 -0000	1.10
+++ updater.cs	13 Oct 2003 13:10:06 -0000
@@ -821,8 +821,7 @@
                 XmlElement element = document.CreateElement (name);
 
                 if (text != null) {
-                        XmlText text_node = document.CreateTextNode (text);
-                        element.AppendChild (text_node);
+			element.InnerXml = text;
                 }
 
                 return element;
@@ -840,7 +839,7 @@
         static XmlElement AddDocsNode (XmlDocument document, Type return_value, ParameterInfo [] pi)
         {
                 XmlElement docs = document.CreateElement (&quot;Docs&quot;);
-                docs.AppendChild (AddElement (document, &quot;summary&quot;, EmptyString));
+                docs.AppendChild (AddElement (document, &quot;summary&quot;, GetSummary()));
 
                 if (pi != null)
                         foreach (ParameterInfo param in pi)
@@ -851,11 +850,34 @@
                 if (returns != null)
                         docs.AppendChild (returns);
 
-                docs.AppendChild (AddElement (document, &quot;remarks&quot;, EmptyString));
+                docs.AppendChild (AddElement (document, &quot;remarks&quot;, GetRemarks()));
 
                 return docs;
         }
 
+	static string predefined_doc_type = String.Empty;
+	static string GetSummary()
+	{
+		switch (predefined_doc_type) {
+		case &quot;Finalize&quot;: return &quot;Disposes the resources associated with the object.&quot;;
+		case &quot;CtorGType&quot;: return &quot;Internal constructor.&quot;;
+		case &quot;CtorIntPtr&quot;: return &quot;Internal constructor.&quot;;
+		case &quot;CtorProtected&quot;: return &quot;Internal constructor.&quot;;
+		default: return EmptyString;
+		}
+	}
+
+	static string GetRemarks()
+	{
+		switch (predefined_doc_type) {
+		case &quot;Finalize&quot;: return String.Empty;
+		case &quot;CtorGType&quot;: return &quot;This is a constructor used by derivative types that would have their own &lt;see cref=\&quot;T:GLib.Type\&quot; /&gt; assigned to it. This is not typically used by C# code.&quot;;
+		case &quot;CtorIntPtr&quot;: return &quot;This is an internal constructor, and should not be used by user code.&quot;;
+		case &quot;CtorProtected&quot;: return &quot;This is an internal constructor, and should not be used by user code.&quot;;
+		default: return EmptyString;
+		}
+	}
+
         static XmlElement AddDocsParamNode (XmlDocument document, ParameterInfo parameter)
         {
                 Type param_type = parameter.ParameterType;
@@ -868,6 +890,12 @@
                 param.AppendChild (text_node);
                 param.AppendChild (see_node);
 
+		if (predefined_doc_type == &quot;CtorGType&quot;) {
+			param.AppendChild (document.CreateTextNode (&quot; for the this type.&quot;));
+		} else if (predefined_doc_type == &quot;CtorIntPtr&quot;) {
+			param.AppendChild (document.CreateTextNode (&quot; to the C object.&quot;));
+		}
+
                 return param;
         }
 
@@ -888,7 +916,17 @@
                 XmlText text_node =  document.CreateTextNode (&quot;a &quot;);
                 param.AppendChild (text_node);
                 param.AppendChild (see_node);
-
+		
+		if (predefined_doc_type == &quot;CtorGType&quot;) {
+			param.AppendChild (document.CreateTextNode (&quot; created using the provided &quot;));
+			see_node = document.CreateElement (&quot;see&quot;);
+			see_node.SetAttribute (&quot;cref&quot;, &quot;T:GLib.Type&quot;);
+			param.AppendChild (see_node);
+			param.AppendChild (document.CreateTextNode (&quot;.&quot;));
+		} else if (predefined_doc_type == &quot;CtorIntPtr&quot;) {
+			param.AppendChild (document.CreateTextNode (&quot; wrapping the C object.&quot;));
+		}
+		
                 return param;
         }
 
@@ -988,8 +1026,10 @@
                 ParameterInfo [] parameters = method.GetParameters ();
 
                 member.AppendChild (AddReturnValue (document, return_type));
-                member.AppendChild (AddParameters (document, parameters));
-                member.AppendChild (AddDocsNode (document, return_type, parameters));
+		member.AppendChild (AddParameters (document, parameters));
+		predefined_doc_type = method.Name;
+		member.AppendChild (AddDocsNode (document, return_type, parameters));
+		predefined_doc_type = String.Empty;
         }
 
         static void AddConstructor (XmlElement members, ConstructorInfo constructor)
@@ -1017,8 +1057,22 @@
                 // constructors have an empty ReturnValue node.
                 member.AppendChild (document.CreateElement (&quot;ReturnValue&quot;));
                 member.AppendChild (AddParameters (document, parameters));
+		predefined_doc_type = GetKnownCtorType (signature, constructor.DeclaringType.Name);
                 member.AppendChild (AddDocsNode (document, return_type, parameters));
+		predefined_doc_type = String.Empty;
         }
+
+	static string GetKnownCtorType (string signature, string ctor_name)
+	{
+		if (signature == &quot;protected &quot; + ctor_name + &quot; (GLib.Type gtype);&quot;)
+			return &quot;CtorGType&quot;;
+		else if (signature == &quot;public &quot; + ctor_name + &quot; (IntPtr raw);&quot;)
+			return &quot;CtorIntPtr&quot;;
+		else if (signature == &quot;protected &quot; + ctor_name + &quot; ();&quot;)
+			return &quot;CtorProtected&quot;;
+		else
+			return String.Empty;
+	}
 
         static void AddProperty (XmlElement members, PropertyInfo property)
         {

--=-pGjIgsL2g8k/wtRpmDhQ--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000877.html">[Mono-docs-list] GTk monodoc issues.
</A></li>
	<LI> Next message: <A HREF="000875.html">[Mono-docs-list] Predefined docs patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#874">[ date ]</a>
              <a href="thread.html#874">[ thread ]</a>
              <a href="subject.html#874">[ subject ]</a>
              <a href="author.html#874">[ author ]</a>
         </LI>
       </UL>
</body></html>
