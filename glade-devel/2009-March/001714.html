<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-devel] Implementing preview feature in glade
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:glade-devel%40lists.ximian.com?Subject=%5BGlade-devel%5D%20Implementing%20preview%20feature%20in%20glade&In-Reply-To=2863ba060903241844t14a83600u3c4e9fde949c4b07%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001713.html">
   <LINK REL="Next"  HREF="001715.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-devel] Implementing preview feature in glade</H1>
    <B>Tristan Van Berkom</B> 
    <A HREF="mailto:glade-devel%40lists.ximian.com?Subject=%5BGlade-devel%5D%20Implementing%20preview%20feature%20in%20glade&In-Reply-To=2863ba060903241844t14a83600u3c4e9fde949c4b07%40mail.gmail.com"
       TITLE="[Glade-devel] Implementing preview feature in glade">tristan.van.berkom at gmail.com
       </A><BR>
    <I>Tue Mar 24 22:58:25 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001713.html">[Glade-devel] Implementing preview feature in glade
</A></li>
        <LI>Next message: <A HREF="001715.html">[Glade-devel] Implementing preview feature in glade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1714">[ date ]</a>
              <a href="thread.html#1714">[ thread ]</a>
              <a href="subject.html#1714">[ subject ]</a>
              <a href="author.html#1714">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/3/24 Marco Diego Aur&#233;lio Mesquita &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-devel">marcodiegomesquita at gmail.com</A>&gt;:
&gt;<i> Let's go slowly...
</I>&gt;<i>
</I>
Heh, I was surprised how quick you were starting out, figured I'd lay
it on ;-) ... ok ... have you dealt with any stdin/stdout piped ipc
programming before ? ... if not I can help you out with that its not
big a deal (we dont have anything fancy like dbus at our disposal
since were portable, but for our purposes some GIOChannels
on stdin/stdout will do the trick).

&gt;<i> 2009/3/24 Tristan Van Berkom &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-devel">tristan.van.berkom at gmail.com</A>&gt;:
</I>&gt;&gt;<i> [...]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So now you have a glade_project_save &amp; glade_project_save_full or
</I>&gt;&gt;<i> something, so your going to want to export glade_project_preview
</I>&gt;&gt;<i> (GladeProject *project, GladeWidget *widget),
</I>&gt;<i>
</I>&gt;<i> What? Why? Should I write a function called glade_project_preview?
</I>&gt;<i> What should I do with its parameters?
</I>
glade_project_preview() will be the entry point to spawn the preview,
we need an entry point in the core (glade3/gladeui/..) ... and then we
will access the feature either from the plugin (glade3/plugins/gtk+/...)
by way of action context menus... or we could also access it from the
frontend (glade3/src/...) by way of the project or view menu (or alternatively
in other frontends, like Anjuta).

&gt;&gt;<i> from here you'll want to add the io channel/spawn with pipes code, so from
</I>&gt;&gt;<i> there you can pass the buffer to the &quot;preview&quot; app via its stdin.
</I>&gt;<i>
</I>&gt;<i> I would like to let the preview be a modal option. So that the user
</I>&gt;<i> could edit the interface, then preview it, then close the preview to
</I>&gt;<i> continue editing it.
</I>
Hmmm, generally we dont like modal dialogs, I've gone to some
lengths to make sure the widget editor dialogs dont have to be
modal, there is also something tricky to that: writing portable
code that will make a window from a foreign process &quot;transient&quot;.

The main reason why I want the preview to be in a separate
process (btw) is because unfinished Glade files are untrusted; I'd
much rather crash a child process and report a usable error about
why GtkBuilder may have aborted than crash Glade in a preview
routine.

What if a preview could be updated ? (i.e. when the project changes
then the preview is updated, until the preview window is closed and
exits or is killed because a project was closed)... we can also
add &quot;raise-to-front&quot; commands to the preview process and avoid
spawning multiple previews for the same ancestry (may have
some issues when toplevels get parented... can get to that later)

Now, not all of this needs to be done at once ofcourse...

&gt;<i> Some doubts remain:
</I>&gt;<i> Where and how should I send my patch?
</I>
bugzilla.gnome.org, enter a bug for the glade3 product and Juan and I will
receive bugmail about it and track the patches etc.

&gt;<i> What to do with projects that do not have a toplevel widget?
</I>
The preview can create a toplevel and child the widget, a
prerequisite of glade_project_preview (GladeProject
*project,GladeWidget * widget) is
that (GTK_IS_WIDGET (widget-&gt;object) &amp;&amp; widget-&gt;parent == NULL)
(i.e. a preview is created for a GladeWidget which must be a toplevel
project object,
and it must wrap a GtkWidget).

&gt;<i> What to do with projects that have many toplevel widgets?
</I>
Another reason why we have the api that includes a widget specific parameter ;-)

&gt;<i> (It doesn't even work if the project doesn't have a widget called &quot;window1&quot;)
</I>
... And the GladeWidget parameter has a member widget-&gt;name, which will
be the name of the widget to display in the project ... look at bleeding edge
builder apis, if Im not mistaken your now allowed to build fragments of the UI
instead of the whole file (like we had with libglade).

Then I guess the best way to integrate the feature will be via an
&quot;important&quot; action in the plugin, actions are implemented at a
widget class level and available in the context menu in the workspace
or inspector; &quot;important&quot; ones also show up in the main toolbar.

The actions are outlined here actually:
   <A HREF="http://glade.gnome.org/docs/widgetclasses.html">http://glade.gnome.org/docs/widgetclasses.html</A>
(actually, if you havent seen the docs, you should check em
out/skim over them; I rewrote them last summer and they describe
the core/plugin relationship pretty well)

OK, so I said alot, what would we need I guess for a first revision
of preview ?
  - a preview main built and installed from glade3/gladeui (glade-3-preview ?)
  - a basic expandable protocol outline for communication between the glade core
    and the preview (luckily now we have portable GChildWatchSources which will
    make this easier...), this protocol has to implement only 2 commands:
      - the initial preview command along with the transmission of the
project glade
        file and the widget name to preview.
      - the kill command (which results in the preview exiting)
  - GladeProject to maintain a list of running previews and kill them
at close time,
    update it when they exit on their own (using GChildWatchSource)
  - An action in the GTK+ plugin in the base GtkWidget adaptor
definition to spawn
    the preview (i.e. one line in the catalog and a few added lines to
glade_gtk_widget_action_activate()
    in glade-gtk.c)

The hard part is the IPC, but since were not doing really time critical stuff
then synchronization shouldnt be a problem.

Anyway... let me know what you think...
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001713.html">[Glade-devel] Implementing preview feature in glade
</A></li>
	<LI>Next message: <A HREF="001715.html">[Glade-devel] Implementing preview feature in glade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1714">[ date ]</a>
              <a href="thread.html#1714">[ thread ]</a>
              <a href="subject.html#1714">[ subject ]</a>
              <a href="author.html#1714">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/glade-devel">More information about the Glade-devel
mailing list</a><br>
</body></html>
