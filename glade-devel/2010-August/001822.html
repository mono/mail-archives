<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-devel] Signal editor rework
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:glade-devel%40lists.ximian.com?Subject=%5BGlade-devel%5D%20Signal%20editor%20rework&In-Reply-To=f8eddeecb185362ff0187f3dcb1f5234.squirrel%40mail.jsschmid.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001819.html">
   <LINK REL="Next"  HREF="001823.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-devel] Signal editor rework</H1>
    <B>Tristan Van Berkom</B> 
    <A HREF="mailto:glade-devel%40lists.ximian.com?Subject=%5BGlade-devel%5D%20Signal%20editor%20rework&In-Reply-To=f8eddeecb185362ff0187f3dcb1f5234.squirrel%40mail.jsschmid.de"
       TITLE="[Glade-devel] Signal editor rework">tristan.van.berkom at gmail.com
       </A><BR>
    <I>Wed Aug 25 23:38:09 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001819.html">[Glade-devel] Signal editor rework
</A></li>
        <LI>Next message: <A HREF="001823.html">[Glade-devel] Signal editor rework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1822">[ date ]</a>
              <a href="thread.html#1822">[ thread ]</a>
              <a href="subject.html#1822">[ subject ]</a>
              <a href="author.html#1822">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Aug 11, 2010 at 6:18 PM, Johannes Schmid &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-devel">jhs at jsschmid.de</A>&gt; wrote:
&gt;<i> Hi!
</I>&gt;<i>
</I>&gt;<i> Code: <A HREF="http://git.gnome.org/browse/glade3/log/?h=signal-tree-model">http://git.gnome.org/browse/glade3/log/?h=signal-tree-model</A>
</I>&gt;<i>
</I>&gt;<i> Interesting parts:
</I>&gt;<i> *
</I>&gt;<i> <A HREF="http://git.gnome.org/browse/glade3/tree/gladeui/glade-signal-editor.c?h=signal-tree-model">http://git.gnome.org/browse/glade3/tree/gladeui/glade-signal-editor.c?h=signal-tree-model</A>
</I>&gt;<i> *
</I>&gt;<i> <A HREF="http://git.gnome.org/browse/glade3/tree/gladeui/glade-signal-model.c?h=signal-tree-model">http://git.gnome.org/browse/glade3/tree/gladeui/glade-signal-model.c?h=signal-tree-model</A>
</I>
Hi Johannes !
   I am sorry I did not give your branch more attention thus far, I'm
giving it a run down
right now and try to get the ball rolling again...

So here are some points I can spot so far...

  - Firstly I can see you went and implemented the GtkTreeIter-&gt;stamp a bit more
    robustly than in GladeProject, additionally the code needs to assert for
    any input iter: (iter-&gt;stamp == model-&gt;priv-&gt;stamp). I've already
done this for
    GladeProject and will commit that soon (it helped alot to debug...
unfortunately
    I could still not completely solve bug 627078 and have not
committed that yet,
    I'll commit the checking code now regardless).

  - Can you explain why the model-&gt;priv-&gt;stamp must be incremented
when the overall
    model data changes ? (it could be that GladeProject needs this
treatment too... or
    that the model's stamp should not change... I'm not sure).

  - The iter-&gt;stamp should be initialized to something random,
otherwise every model
    starts with stamp == 0 (possibly making the iter from the last
destroyed signal model
    appear &quot;valid&quot;)

  - I would prefer we stick with firing Glade's generic object
selection dialog to select
    the project object for a signal user data - I dont like the idea
of navigating recursive menus
    or dropping down a combo box with a possible &gt; 1000 objects to select.

I have to compile and run the code to say more, but my initial
feelings are that we
really need to stamp those iters and check the iters on every model input.

Cheers,
       -Tristan

&gt;<i>
</I>&gt;<i> Why?
</I>&gt;<i>
</I>&gt;<i> My starting idea was to be able to drag signal handlers from glade into
</I>&gt;<i> anjuta and automatically creating the prototypes. Some may have seen my
</I>&gt;<i> GUADEC lightning talk on that issue.
</I>&gt;<i>
</I>&gt;<i> So I looked at the SignalEditor and that was a big monolitic block with
</I>&gt;<i> many custom cell rendering methods with a backend based on a GtkTreeStore.
</I>&gt;<i> The GtkTreeStore meant that updating things was rather painful and that
</I>&gt;<i> the data structure of the GladeWidget was duplicated and had to be kept up
</I>&gt;<i> to date with the widget.
</I>&gt;<i>
</I>&gt;<i> So my idea was to use a custom GtkTreeModel instead that would use the
</I>&gt;<i> signal structure of the GladeWidget directly. I though about implementing
</I>&gt;<i> directly in glade-widget.c but realized pretty soon that this would bloat
</I>&gt;<i> that file two much and that it wouldn't be obvious that a GladeWidget
</I>&gt;<i> implements a GtkTreeModel.
</I>&gt;<i>
</I>&gt;<i> As such, I started on GladeSignalModel which is basically initialised
</I>&gt;<i> using a GladeWidget and displays it's data. In the model/view-concept this
</I>&gt;<i> holds the signal data which is taken from the GladeWidget directly without
</I>&gt;<i> duplicating it.
</I>&gt;<i>
</I>&gt;<i> This model implements the drag and drop stuff based on GtkTreeDragSource.
</I>&gt;<i> The most complicated thing in the tree model is that we need to take care
</I>&gt;<i> of dummy nodes that a used to enable the user to add new signals.
</I>&gt;<i>
</I>&gt;<i> The implementation of the GladeSignalEditor on top of that was trivial then.
</I>&gt;<i>
</I>&gt;<i> Status
</I>&gt;<i>
</I>&gt;<i> Everything is feature complete compared to the old GladeSignalEditor,
</I>&gt;<i> minus the deprecation warnings and the devhelp button. These are both not
</I>&gt;<i> difficult to add I just didn't come to it, yet.
</I>&gt;<i>
</I>&gt;<i> What needs to be improved?
</I>&gt;<i>
</I>&gt;<i> I don't like the way the GtkCellRendererCombo works for the object
</I>&gt;<i> selection with a real tree (not a list). I think that isn't convenient yet
</I>&gt;<i> and needs a better solution.
</I>&gt;<i>
</I>&gt;<i> Some horizontal space could be saved by using the &quot;Name&quot; column for both,
</I>&gt;<i> object names and signal-names instead of a additional &quot;Handler&quot; column.
</I>&gt;<i> This is quite easy to do.
</I>&gt;<i>
</I>&gt;<i> Conclusion:
</I>&gt;<i> While I didn't save as much code as I wanted to (mainly because of the
</I>&gt;<i> GObject template code necessary) I think the implementation is much
</I>&gt;<i> cleaner than the code before.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Johannes
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Glade-devel maillist &#160;- &#160;<A HREF="http://lists.ximian.com/mailman/listinfo/glade-devel">Glade-devel at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/glade-devel">http://lists.ximian.com/mailman/listinfo/glade-devel</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001819.html">[Glade-devel] Signal editor rework
</A></li>
	<LI>Next message: <A HREF="001823.html">[Glade-devel] Signal editor rework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1822">[ date ]</a>
              <a href="thread.html#1822">[ thread ]</a>
              <a href="subject.html#1822">[ subject ]</a>
              <a href="author.html#1822">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/glade-devel">More information about the Glade-devel
mailing list</a><br>
</body></html>
