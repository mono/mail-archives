<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-devel] [patch, glade3] close a project
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:pborelli%40katamail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000099.html">
   <LINK REL="Next"  HREF="000104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-devel] [patch, glade3] close a project
   </H1>
    <B>paolo borelli
    </B> 
    <A HREF="mailto:pborelli%40katamail.com"
       TITLE="[Glade-devel] [patch, glade3] close a project">pborelli@katamail.com
       </A><BR>
    <I>17 Apr 2003 15:17:52 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="000099.html">[Glade-devel] [patch, glade3] fix scrolled window
</A></li>
        <LI> Next message: <A HREF="000104.html">[Glade-devel] [patch, glade3] small cleanup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100">[ date ]</a>
              <a href="thread.html#100">[ thread ]</a>
              <a href="subject.html#100">[ subject ]</a>
              <a href="author.html#100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--=-Hd1ycMZ0e1CLV6To4anU
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Hi!

This patch is not submitted for inclusion yet (unless you think it's ok
as is)

The a attached patch is a first cut at adding the abilty to close a
project; what I am not sure about is what should be done when a project
is closed: for now what I do is
- remove the menu entry
- remove the projects from the projects list
- switch the  current project to the first in the list (unless there are
no more)
- refresh the main window title

A thing that it lacks for sure is that it does not close all windows of
the project... what about views?

Any suggestion, advices ?

ciao
	paolo

--=-Hd1ycMZ0e1CLV6To4anU
Content-Disposition: attachment; filename=close_project.patch
Content-Type: text/x-patch; name=close_project.patch; charset=UTF-8
Content-Transfer-Encoding: 7bit

diff -upr gnome2/glade3/src/glade-project.c glade3/src/glade-project.c
--- gnome2/glade3/src/glade-project.c	2003-04-17 09:51:55.000000000 +0200
+++ glade3/src/glade-project.c	2003-04-17 13:05:03.000000000 +0200
@@ -29,6 +29,7 @@
 #include &quot;glade.h&quot;
 #include &quot;glade-project.h&quot;
 #include &quot;glade-project-window.h&quot;
+#include &quot;glade-project-view.h&quot;
 #include &quot;glade-widget.h&quot;
 #include &quot;glade-widget-class.h&quot;
 #include &quot;glade-xml-utils.h&quot;
@@ -702,3 +703,36 @@ glade_project_save (GladeProject *projec
 	return TRUE;
 }
 
+
+/**
+ * glade_project_close:
+ * @project:
+ * 
+ * Close a project.
+ **/
+void
+glade_project_close (GladeProject *project)
+{
+	GladeProjectWindow *gpw;
+
+	g_return_if_fail (GLADE_IS_PROJECT (project));
+
+	gpw = glade_project_window_get ();
+
+	/* Remove the project from the /Project menu. */
+	gtk_item_factory_delete_entry (gpw-&gt;item_factory, &amp;(project-&gt;entry));
+
+	gpw-&gt;projects = g_list_remove (gpw-&gt;projects, project);
+
+	/* if no more projects */
+	if (gpw-&gt;projects == NULL) {
+		gpw-&gt;project = NULL;
+		glade_project_window_refresh_title (gpw);
+		return;
+	}
+	
+	glade_project_window_set_project (gpw, gpw-&gt;projects-&gt;data);
+
+}
+
+
diff -upr gnome2/glade3/src/glade-project.h glade3/src/glade-project.h
--- gnome2/glade3/src/glade-project.h	2003-04-17 09:51:55.000000000 +0200
+++ glade3/src/glade-project.h	2003-04-17 11:56:46.000000000 +0200
@@ -66,6 +66,7 @@ GladeProject *glade_project_new (gboolea
 /* Project operations */
 gboolean glade_project_save (GladeProject *project, const gchar *path);
 gboolean glade_project_open (const gchar *path);
+void     glade_project_close (GladeProject *project);
 
 
 /* Widget related stuff */
diff -upr gnome2/glade3/src/glade-project-window.c glade3/src/glade-project-window.c
--- gnome2/glade3/src/glade-project-window.c	2003-04-17 09:51:55.000000000 +0200
+++ glade3/src/glade-project-window.c	2003-04-17 11:59:00.000000000 +0200
@@ -226,6 +226,23 @@ gpw_confirm_close_project (GladeProject 
 }
 
 static void
+gpw_close_cb (void)
+{
+	GladeProject *project;
+	gboolean close;
+
+	project = glade_project_window_get_project ();
+
+	if (project-&gt;changed) {
+		close = gpw_confirm_close_project (project);
+			if (!close)
+				return;
+	}
+
+	glade_project_close (project);
+}
+
+static void
 gpw_quit_cb (void)
 {
 	GladeProjectWindow *gpw;
@@ -342,31 +359,32 @@ static GtkItemFactoryEntry menu_items[] 
   { &quot;/File/_Save&quot;,       &quot;&lt;control&gt;S&quot;,        gpw_save_cb,    3, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_SAVE },
   { &quot;/File/Save _As...&quot;, &quot;&lt;control&gt;&lt;shift&gt;S&quot;, gpw_save_as_cb, 4, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_SAVE_AS },
   { &quot;/File/sep2&quot;,        NULL,                NULL,           0, &quot;&lt;Separator&gt;&quot; },
-  { &quot;/File/_Quit&quot;,       &quot;&lt;control&gt;Q&quot;,        gpw_quit_cb,    5, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_QUIT },
+  { &quot;/File/_Close&quot;,      &quot;&lt;control&gt;W&quot;,        gpw_close_cb,   5, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_CLOSE },
+  { &quot;/File/_Quit&quot;,       &quot;&lt;control&gt;Q&quot;,        gpw_quit_cb,    6, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_QUIT },
 
   /* ============ EDIT ============ */
   { &quot;/Edit&quot;, NULL, 0, 0, &quot;&lt;Branch&gt;&quot; },
-  { &quot;/Edit/_Undo&quot;,   &quot;&lt;control&gt;Z&quot;, gpw_undo_cb,    6, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_UNDO },
-  { &quot;/Edit/_Redo&quot;,   &quot;&lt;control&gt;R&quot;, gpw_redo_cb,    7, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_REDO },
+  { &quot;/Edit/_Undo&quot;,   &quot;&lt;control&gt;Z&quot;, gpw_undo_cb,    7, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_UNDO },
+  { &quot;/Edit/_Redo&quot;,   &quot;&lt;control&gt;R&quot;, gpw_redo_cb,    8, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_REDO },
   { &quot;/Edit/sep1&quot;,    NULL,         NULL,           0, &quot;&lt;Separator&gt;&quot; },
-  { &quot;/Edit/C_ut&quot;,    NULL,         gpw_cut_cb,     8, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_CUT },
-  { &quot;/Edit/_Copy&quot;,   NULL,         gpw_copy_cb,    9, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_COPY },
-  { &quot;/Edit/_Paste&quot;,  NULL,         gpw_paste_cb,  10, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_PASTE },
-  { &quot;/Edit/_Delete&quot;, &quot;Delete&quot;,     gpw_delete_cb, 11, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_DELETE },
+  { &quot;/Edit/C_ut&quot;,    NULL,         gpw_cut_cb,     9, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_CUT },
+  { &quot;/Edit/_Copy&quot;,   NULL,         gpw_copy_cb,   10, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_COPY },
+  { &quot;/Edit/_Paste&quot;,  NULL,         gpw_paste_cb,  11, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_PASTE },
+  { &quot;/Edit/_Delete&quot;, &quot;Delete&quot;,     gpw_delete_cb, 12, &quot;&lt;StockItem&gt;&quot;, GTK_STOCK_DELETE },
 
   /* ============ VIEW ============ */
   { &quot;/View&quot;, NULL, 0, 0, &quot;&lt;Branch&gt;&quot; },
-  { &quot;/View/_Palette&quot;,         NULL, gpw_toggle_palette_cb,     12, &quot;&lt;ToggleItem&gt;&quot; },
-  { &quot;/View/Property _Editor&quot;, NULL, gpw_toggle_editor_cb,      13, &quot;&lt;ToggleItem&gt;&quot; },
-  { &quot;/View/_Widget Tree&quot;,     NULL, gpw_toggle_widget_tree_cb, 14, &quot;&lt;ToggleItem&gt;&quot; },
-  { &quot;/View/_Clipboard&quot;,       NULL, gpw_toggle_clipboard_cb,   15, &quot;&lt;ToggleItem&gt;&quot; },
+  { &quot;/View/_Palette&quot;,         NULL, gpw_toggle_palette_cb,     13, &quot;&lt;ToggleItem&gt;&quot; },
+  { &quot;/View/Property _Editor&quot;, NULL, gpw_toggle_editor_cb,      14, &quot;&lt;ToggleItem&gt;&quot; },
+  { &quot;/View/_Widget Tree&quot;,     NULL, gpw_toggle_widget_tree_cb, 15, &quot;&lt;ToggleItem&gt;&quot; },
+  { &quot;/View/_Clipboard&quot;,       NULL, gpw_toggle_clipboard_cb,   16, &quot;&lt;ToggleItem&gt;&quot; },
 
   /* =========== PROJECT ========== */
   { &quot;/Project&quot;, NULL, 0, 0, &quot;&lt;Branch&gt;&quot; },
 
   /* ============ HELP ============ */
   { &quot;/_Help&quot;,       NULL, NULL, 0, &quot;&lt;Branch&gt;&quot; },
-  { &quot;/Help/_About&quot;, NULL, gpw_about_cb, 16 },
+  { &quot;/Help/_About&quot;, NULL, gpw_about_cb, 17 },
 };
 
 /*
@@ -378,22 +396,23 @@ static const gchar *menu_tips[] =
 	N_(&quot;Create a new project file&quot;),	/* action 1 (New)  */
 	N_(&quot;Open a project file&quot;),		/* action 2 (Open) */
 	N_(&quot;Save the current project file&quot;),	/* action 3 (Save) */
-	N_(&quot;Save the current project file with a different name&quot;),	/* action 4 (Save as) */ 
-	N_(&quot;Quit the program&quot;),			/* action 5 (Quit) */
-
-	N_(&quot;Undo the last action&quot;),		/* action 6  (Undo) */ 
-	N_(&quot;Redo the last action&quot;),		/* action 7  (Redo) */
-	N_(&quot;Cut the selection&quot;),		/* action 8  (Cut)  */
-	N_(&quot;Copy the selection&quot;),		/* action 9  (Copy) */
-	N_(&quot;Paste the clipboard&quot;),		/* action 10 (Paste) */
-	N_(&quot;Delete the selection&quot;),		/* action 11 (Delete) */
-
-	N_(&quot;Change the visibility of the palette of widgets&quot;),	/* action 12 (Palette) */
-	N_(&quot;Change the visibility of the property editor&quot;),	/* action 13 (Editor) */
-	N_(&quot;Change the visibility of the project widget tree&quot;),	/* action 14 (Tree) */
-	N_(&quot;Change the visibility of the clipboard&quot;),		/* action 15 (Clipboard) */
+	N_(&quot;Save the current project file with a different name&quot;),	/* action 4 (Save as) */
+	N_(&quot;Close the current project file&quot;),	/* action 5 (Close) */
+	N_(&quot;Quit the program&quot;),			/* action 6 (Quit) */
+
+	N_(&quot;Undo the last action&quot;),		/* action 7  (Undo) */ 
+	N_(&quot;Redo the last action&quot;),		/* action 8  (Redo) */
+	N_(&quot;Cut the selection&quot;),		/* action 9  (Cut)  */
+	N_(&quot;Copy the selection&quot;),		/* action 10 (Copy) */
+	N_(&quot;Paste the clipboard&quot;),		/* action 11 (Paste) */
+	N_(&quot;Delete the selection&quot;),		/* action 12 (Delete) */
+
+	N_(&quot;Change the visibility of the palette of widgets&quot;),	/* action 13 (Palette) */
+	N_(&quot;Change the visibility of the property editor&quot;),	/* action 14 (Editor) */
+	N_(&quot;Change the visibility of the project widget tree&quot;),	/* action 15 (Tree) */
+	N_(&quot;Change the visibility of the clipboard&quot;),		/* action 16 (Clipboard) */
 
-	N_(&quot;About this application&quot;),		/* action 16 (About) */
+	N_(&quot;About this application&quot;),		/* action 17 (About) */
 };
 
 
@@ -997,11 +1016,7 @@ glade_project_window_set_project (GladeP
 	}
 	
 	gpw-&gt;project = project;
-	if (project) {
-		glade_project_window_refresh_title (gpw);
-	} else {
-		gtk_window_set_title (GTK_WINDOW (gpw-&gt;window), &quot;glade3&quot;);
-	}
+	glade_project_window_refresh_title (gpw);
 
 	list = gpw-&gt;views;
 	for (; list != NULL; list = list-&gt;next) {
@@ -1013,7 +1028,7 @@ glade_project_window_set_project (GladeP
 		g_signal_connect (G_OBJECT (project), &quot;selection_changed&quot;,
 				  G_CALLBACK (glade_project_window_selection_changed_cb),
 				  gpw);
-	
+
 	glade_project_selection_changed (project);
 }
 
@@ -1111,7 +1126,12 @@ void
 glade_project_window_refresh_title (GladeProjectWindow *gpw)
 {
 	gchar *title;
-	title = g_strdup_printf (&quot;glade3 - %s&quot;, gpw-&gt;project-&gt;name);
+
+	if (!gpw-&gt;project)
+		title = g_strdup_printf (&quot;glade3&quot;);
+	else
+		title = g_strdup_printf (&quot;glade3 - %s&quot;, gpw-&gt;project-&gt;name);
+
 	gtk_window_set_title (GTK_WINDOW (gpw-&gt;window), title);
 	g_free (title);
 }

--=-Hd1ycMZ0e1CLV6To4anU--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000099.html">[Glade-devel] [patch, glade3] fix scrolled window
</A></li>
	<LI> Next message: <A HREF="000104.html">[Glade-devel] [patch, glade3] small cleanup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100">[ date ]</a>
              <a href="thread.html#100">[ thread ]</a>
              <a href="subject.html#100">[ subject ]</a>
              <a href="author.html#100">[ author ]</a>
         </LI>
       </UL>
</body></html>
