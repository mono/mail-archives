<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-devel] [glade3, patch] load library module before calling *_get_type ()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bighead%40users.sourceforge.net">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000386.html">
   <LINK REL="Next"  HREF="000401.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-devel] [glade3, patch] load library module before calling *_get_type ()
   </H1>
    <B>bighead@users.sourceforge.net
    </B> 
    <A HREF="mailto:bighead%40users.sourceforge.net"
       TITLE="[Glade-devel] [glade3, patch] load library module before calling *_get_type ()">bighead@users.sourceforge.net
       </A><BR>
    <I>08 Jan 2004 12:53:07 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="000386.html">[Glade-devel] [glade3, patch] load library module before calling *_get_type ()
</A></li>
        <LI> Next message: <A HREF="000401.html">[Glade-devel] [glade3, patch] load library module before
 calling *_get_type ()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#389">[ date ]</a>
              <a href="thread.html#389">[ thread ]</a>
              <a href="subject.html#389">[ subject ]</a>
              <a href="author.html#389">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Nice :-) (although I didn't try this patch, you'll have to wait for others 
to commit).

Anyways hope you stick around glade-3 Tommi (could make you famous). :-)

Here's to another contributer. Yay!
Archit

Tommi Komulainen &lt;<A HREF="mailto:tommi.komulainen@nokia.com">tommi.komulainen@nokia.com</A>&gt; writes:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Please find attached a patch that moves loading of the library module
</I>&gt;<i> before the call to foo_get_type() that's supposedly in that library. 
</I>&gt;<i> With the patch I was able to get custom widgets to appear in glade
</I>&gt;<i> palette.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Tommi Komulainen &lt;<A HREF="mailto:tommi.komulainen@nokia.com">tommi.komulainen@nokia.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> --- ChangeLog	2003-11-29 15:44:43.000000000 +0200
</I>&gt;<i> +++ ChangeLog	2004-01-08 18:14:27.000000000 +0200
</I>&gt;<i> @@ -1,3 +1,9 @@
</I>&gt;<i> +2004-01-08  Tommi Komulainen  &lt;<A HREF="mailto:tommi.komulainen@nokia.com">tommi.komulainen@nokia.com</A>&gt;
</I>&gt;<i> +
</I>&gt;<i> +	* src/glade-widget-class.c: load the library module before attempting
</I>&gt;<i> +	to call *_get_type since the function could be located in dependent
</I>&gt;<i> +	libraries.
</I>&gt;<i> +
</I>&gt;<i>  2003-11-29  Paolo Borelli  &lt;<A HREF="mailto:pborelli@katamail.com">pborelli@katamail.com</A>&gt;
</I>&gt;<i>  
</I>&gt;<i>  	* widgets/gtkmenubar.xml: override fill_empty with ignore.
</I>&gt;<i> --- src/glade-widget-class.c	2003-11-19 18:24:10.000000000 +0200
</I>&gt;<i> +++ src/glade-widget-class.c	2004-01-08 16:34:05.000000000 +0200
</I>&gt;<i> @@ -498,6 +498,7 @@ glade_widget_class_new (const char *name
</I>&gt;<i>  	char *filename = NULL;
</I>&gt;<i>  	char *library = NULL;
</I>&gt;<i>  	char *init_function_name = NULL;
</I>&gt;<i> +	GModule *module = NULL;
</I>&gt;<i>  	GType parent_type;
</I>&gt;<i>  
</I>&gt;<i>  	g_return_val_if_fail (name != NULL, NULL);
</I>&gt;<i> @@ -526,10 +527,19 @@ glade_widget_class_new (const char *name
</I>&gt;<i>  			g_warning (_(&quot;Not enough memory.&quot;));
</I>&gt;<i>  			goto lblError;
</I>&gt;<i>  		}
</I>&gt;<i> +
</I>&gt;<i> +		module = g_module_open (library, G_MODULE_BIND_LAZY);
</I>&gt;<i> +		if (!module)
</I>&gt;<i> +		{
</I>&gt;<i> +			g_warning (_(&quot;Unable to open the module %s.&quot;), library);
</I>&gt;<i> +			goto lblError;
</I>&gt;<i> +		}
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i>  	widget_class = g_new0 (GladeWidgetClass, 1);
</I>&gt;<i>  
</I>&gt;<i> +	widget_class-&gt;module = module;
</I>&gt;<i> +
</I>&gt;<i>  	widget_class-&gt;generic_name = generic_name ? g_strdup (generic_name) : NULL;
</I>&gt;<i>  	widget_class-&gt;name = g_strdup (name);
</I>&gt;<i>  	widget_class-&gt;in_palette = generic_name ? TRUE : FALSE;
</I>&gt;<i> @@ -564,16 +574,6 @@ glade_widget_class_new (const char *name
</I>&gt;<i>  
</I>&gt;<i>  	widget_class-&gt;icon = glade_widget_class_create_icon (widget_class);
</I>&gt;<i>  
</I>&gt;<i> -	if (library)
</I>&gt;<i> -	{
</I>&gt;<i> -		widget_class-&gt;module = g_module_open (library, G_MODULE_BIND_LAZY);
</I>&gt;<i> -		if (!widget_class-&gt;module)
</I>&gt;<i> -		{
</I>&gt;<i> -			g_warning (_(&quot;Unable to open the module %s.&quot;), library);
</I>&gt;<i> -			goto lblError;
</I>&gt;<i> -		}
</I>&gt;<i> -	}
</I>&gt;<i> -
</I>&gt;<i>  	g_free (init_function_name);
</I>&gt;<i>  
</I>&gt;<i>  	for (parent_type = g_type_parent (widget_class-&gt;type);
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000386.html">[Glade-devel] [glade3, patch] load library module before calling *_get_type ()
</A></li>
	<LI> Next message: <A HREF="000401.html">[Glade-devel] [glade3, patch] load library module before
 calling *_get_type ()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#389">[ date ]</a>
              <a href="thread.html#389">[ thread ]</a>
              <a href="subject.html#389">[ subject ]</a>
              <a href="author.html#389">[ author ]</a>
         </LI>
       </UL>
</body></html>
