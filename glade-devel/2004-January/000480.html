<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Glade-devel] small patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:sridharinfinity%40yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000479.html">
   <LINK REL="Next"  HREF="000481.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Glade-devel] small patch
   </H1>
    <B>Sridhar R
    </B> 
    <A HREF="mailto:sridharinfinity%40yahoo.com"
       TITLE="[Glade-devel] small patch">sridharinfinity@yahoo.com
       </A><BR>
    <I>Wed, 14 Jan 2004 01:56:57 -0800 (PST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="000479.html">[Glade-devel] small patch
</A></li>
        <LI> Next message: <A HREF="000481.html">[Glade-devel] small patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#480">[ date ]</a>
              <a href="thread.html#480">[ thread ]</a>
              <a href="subject.html#480">[ subject ]</a>
              <a href="author.html#480">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>--- Paolo Borelli &lt;<A HREF="mailto:pborelli@katamail.com">pborelli@katamail.com</A>&gt; wrote:

&gt;<i> &gt; &gt; &gt; ***
</I>&gt;<i> ../../glade3.orig/src/glade-signal-editor.c
</I>&gt;<i> &gt; &gt; Mon
</I>&gt;<i> &gt; &gt; &gt; Jan 12 21:38:09 2004
</I>&gt;<i> &gt; &gt; &gt; --- glade-signal-editor.c       Mon Jan 12
</I>&gt;<i> &gt; &gt; 22:04:06
</I>&gt;<i> &gt; &gt; &gt; 2004
</I>&gt;<i> &gt; &gt; &gt; ***************
</I>&gt;<i> &gt; &gt; &gt; *** 158,161 ****
</I>&gt;<i> &gt; &gt; &gt; --- 158,162 ----
</I>&gt;<i> &gt; &gt; &gt;         GtkTreeIter *parent = NULL;
</I>&gt;<i> &gt; &gt; &gt;         GList *list = NULL;
</I>&gt;<i> &gt; &gt; &gt; +       GtkTreePath *path_first = NULL;
</I>&gt;<i> &gt; &gt; &gt;         GladeWidgetClassSignal *signal;
</I>&gt;<i> &gt; &gt; &gt;     
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; No need to initialize local vars to NULL as far
</I>&gt;<i> as I
</I>&gt;<i> &gt; &gt; can see, while you
</I>&gt;<i> &gt; &gt; are at it remove it also from the other vars;
</I>&gt;<i> &gt; &gt; beside, not related to
</I>&gt;<i> &gt; &gt; your code, but usually a TreeIter is allocated
</I>&gt;<i> on
</I>&gt;<i> &gt; &gt; the stack: i.e.
</I>&gt;<i> &gt; &gt; GtkTreeIter iter;
</I>&gt;<i> &gt; &gt; gtk_tree_functio (..., &amp;iter, ...);
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    I don't understand.
</I>&gt;<i> &gt; 
</I>&gt;<i> About the variables declaration you can omit the &quot;=
</I>&gt;<i> NULL;&quot;.
</I>&gt;<i> 
</I>&gt;<i> About the treeiter: I took a closer look at the code
</I>&gt;<i> and in this case I
</I>&gt;<i> have to admit the using a pointer to the iter is
</I>&gt;<i> correct since
</I>&gt;<i> glade_signal_editor_dialog_append_signal returns a
</I>&gt;<i> iter allocated in the
</I>&gt;<i> heap memory with g_new0. Not your fault, but as far
</I>&gt;<i> as I can see this
</I>&gt;<i> memory is leaked since there isn't a g_free (iter).
</I>&gt;<i> 
</I>&gt;<i> In general, if you look at the docs in gtk you'll
</I>&gt;<i> see that most of the
</I>&gt;<i> times, even if the iter is an object, it is used as
</I>&gt;<i> a local variable,
</I>&gt;<i> not as a pointer: i.e. GtkTreeIter iter; this means
</I>&gt;<i> that the memory for
</I>&gt;<i> the object is automatically allocated on the stack
</I>&gt;<i> when the function is
</I>&gt;<i> called and automatically freed when the function
</I>&gt;<i> ends. Of course since
</I>&gt;<i> some of the API need to get a pointer to iter, you
</I>&gt;<i> pass them the var
</I>&gt;<i> address, i.e. &amp;iter.
</I>&gt;<i> In our case using this approach would mean modify
</I>&gt;<i> the
</I>&gt;<i> glade_signal_editor_dialog_append_signal function to
</I>&gt;<i> take another iter
</I>&gt;<i> pointer as parameter instead of returning a newly
</I>&gt;<i> allocated iter, and
</I>&gt;<i> pass &amp;parent to it.
</I>&gt;<i> 
</I>&gt;<i> Hope this clear things a bit.
</I>
  Oh! I got the problem. I should have used 
gtk_tree_model_get_iter_first, instead of the one I
used before.

&gt;<i> &gt; &gt; &gt; ***************
</I>&gt;<i> &gt; &gt; &gt; *** 183,186 ****
</I>&gt;<i> &gt; &gt; &gt; --- 188,193 ----
</I>&gt;<i> &gt; &gt; &gt;         gint response;
</I>&gt;<i> &gt; &gt; &gt;   
</I>&gt;<i> &gt; &gt; &gt; +       g_assert(editor);
</I>&gt;<i> &gt; &gt; &gt; +       g_assert(editor-&gt;class);
</I>&gt;<i> &gt; &gt; &gt;         g_return_if_fail
</I>&gt;<i> (editor-&gt;class-&gt;signals
</I>&gt;<i> &gt; &gt; !=
</I>&gt;<i> &gt; &gt; &gt; NULL);
</I>&gt;<i> &gt; &gt; &gt;   
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Use g_return_if_fail instead of assert to check
</I>&gt;<i> &gt; &gt; function args.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   No.  If you have seen my bug report on glade3,
</I>&gt;<i> the
</I>&gt;<i> &gt; program actually segfaults.  But with these assert
</I>&gt;<i> &gt; statement, it shows the correct message as 'assert
</I>&gt;<i> &gt; failure', saving minutes of fiddling up with gdb.
</I>&gt;<i> &gt;   Any thoughts?
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> g_return_if_fail *are* asserts made exactly for this
</I>&gt;<i> use; when they fail
</I>&gt;<i> they print a critical message on the console and
</I>&gt;<i> then return so that the
</I>&gt;<i> function is not executed.
</I>
   But without the above two g_assert statements, the
statement
   g_return_if_fail (editor-&gt;class-&gt;signals);
  _will_ cause segfault, if either `editor` or `class`
is NULL!

&gt;<i> 
</I>&gt;<i> ciao
</I>&gt;<i> 	paolo
</I>&gt;<i> 
</I>

=====
Sridhar R 
Email: <A HREF="mailto:r_sridhar@users.sf.net">r_sridhar@users.sf.net</A>
WWW:   <A HREF="http://sridhar.has.it">http://sridhar.has.it</A>

__________________________________
Do you Yahoo!?
Yahoo! Hotjobs: Enter the &quot;Signing Bonus&quot; Sweepstakes
<A HREF="http://hotjobs.sweepstakes.yahoo.com/signingbonus">http://hotjobs.sweepstakes.yahoo.com/signingbonus</A>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000479.html">[Glade-devel] small patch
</A></li>
	<LI> Next message: <A HREF="000481.html">[Glade-devel] small patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#480">[ date ]</a>
              <a href="thread.html#480">[ thread ]</a>
              <a href="subject.html#480">[ subject ]</a>
              <a href="author.html#480">[ author ]</a>
         </LI>
       </UL>
</body></html>
