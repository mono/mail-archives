<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Cocoa-sharp] New patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cjcollier%40colliertech.org">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000071.html">
   <LINK REL="Next"  HREF="000078.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cocoa-sharp] New patch
   </H1>
    <B>C.J. Collier
    </B> 
    <A HREF="mailto:cjcollier%40colliertech.org"
       TITLE="[Cocoa-sharp] New patch">cjcollier@colliertech.org
       </A><BR>
    <I>Tue, 15 Jun 2004 10:11:02 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="000071.html">[Cocoa-sharp] test
</A></li>
        <LI> Next message: <A HREF="000078.html">[Cocoa-sharp] New patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76">[ date ]</a>
              <a href="thread.html#76">[ thread ]</a>
              <a href="subject.html#76">[ subject ]</a>
              <a href="author.html#76">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_0038_01C452C1.220E1310
Content-Type: multipart/alternative;
	boundary=&quot;----=_NextPart_001_0039_01C452C1.220E1310&quot;


------=_NextPart_001_0039_01C452C1.220E1310
Content-Type: text/plain;
	charset=&quot;us-ascii&quot;
Content-Transfer-Encoding: 7bit

It's still a little broken, but at least it's a little better.

 

            * genstubs.pl (parseMethod)

            - moved /* generated by */ comment to generation area

            - decoupled token gathering and stub file generation

            - Whining if we can't pare the method

            - not printing the method if it's an interface. duh :)

 

            * genstubs.pl (parseFile)

            - renamed FH -&gt; $fh

            - crated a %common hash to contain persistent data

            - not parsing file if it doesn't match /^NS.*\.h/

            - processing @objC list after we finish with the entire file

            - created stub for creating C Sharp wrapper


------=_NextPart_001_0039_01C452C1.220E1310
Content-Type: text/html;
	charset=&quot;us-ascii&quot;
Content-Transfer-Encoding: quoted-printable

&lt;html xmlns:o=3D&quot;urn:schemas-microsoft-com:office:office&quot; =
xmlns:w=3D&quot;urn:schemas-microsoft-com:office:word&quot; =
xmlns=3D&quot;<A HREF="http://www.w3.org/TR/REC-html40"">http://www.w3.org/TR/REC-html40&quot;</A>&gt;

&lt;head&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Dus-ascii&quot;&gt;
&lt;meta name=3DGenerator content=3D&quot;Microsoft Word 11 (filtered medium)&quot;&gt;
&lt;style&gt;
&lt;!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:&quot;Times New Roman&quot;;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:Arial;
	color:windowtext;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;}
div.Section1
	{page:Section1;}
--&gt;
&lt;/style&gt;

&lt;/head&gt;

&lt;body lang=3DEN-US link=3Dblue vlink=3Dpurple&gt;

&lt;div class=3DSection1&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;It&amp;#8217;s still a little broken, but at least =
it&amp;#8217;s a
little better&amp;#8230;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; * genstubs.pl (parseMethod)&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - moved /* generated by */ comment to generation
area&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - decoupled token gathering and stub file
generation&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - Whining if we can't pare the =
method&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - not printing the method if it's an interface.
duh :)&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; * genstubs.pl (parseFile)&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - renamed FH -&amp;gt; $fh&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - crated a %common hash to contain persistent
data&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - not parsing file if it doesn't match
/^NS.*\.h/&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - processing @objC list after we finish with the
entire file&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p class=3DMsoNormal&gt;&lt;font size=3D2 face=3DArial&gt;&lt;span =
style=3D'font-size:10.0pt;
font-family:Arial'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=
&amp;nbsp;&amp;nbsp; - created stub for creating C Sharp =
wrapper&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;/body&gt;

&lt;/html&gt;

------=_NextPart_001_0039_01C452C1.220E1310--

------=_NextPart_000_0038_01C452C1.220E1310
Content-Type: application/octet-stream;
	name=&quot;newdiff.diff&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;newdiff.diff&quot;

Index: genstubs.pl=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvs/public/cocoa-sharp/generator/genstubs.pl,v=0A=
retrieving revision 1.6=0A=
diff -b -u -r1.6 genstubs.pl=0A=
--- genstubs.pl	13 Jun 2004 23:29:07 -0000	1.6=0A=
+++ genstubs.pl	15 Jun 2004 16:01:04 -0000=0A=
@@ -23,17 +23,10 @@=0A=
     my $origmethod =3D shift();=0A=
     my $class      =3D shift();=0A=
     my $methodHash =3D shift();=0A=
-    my $objCHash   =3D shift();=0A=
     my @return     =3D ();=0A=
 =0A=
     chomp($origmethod);=0A=
 =0A=
-    # TODO: only overwrite to a section delimited by:=0A=
-    # /* GENERATED BY genstubs.pl     */=0A=
-    # /* END GENRATION BY genstubs.pl */=0A=
-=0A=
-#    print(&quot;$origmethod\n&quot;);=0A=
-=0A=
     # Check for unsupported methods and return commented function=0A=
     # Unsupported methods include:=0A=
     # &lt;.*&gt;=0A=
@@ -43,8 +36,7 @@=0A=
        # until then, comment such methods as UNSUPPORTED=0A=
        $origmethod =3D~ /\.\.\./=0A=
       ) {=0A=
-	$origmethod =3D~ s:/::g;=0A=
-	return &quot;/* UNSUPPORTED: \n$origmethod\n */\n\n&quot;;=0A=
+	return (&quot;unsupported&quot; =3D&gt; $origmethod);
     }=0A=
 =0A=
     # It seems that methods take one of two formats.  Zero arguments:=0A=
@@ -52,13 +44,18 @@=0A=
     # or N arguments=0A=
     # - (RETURNTYPE)MethodName:(TYPE0)Arg0 ... ArgNName:(TYPEN)ArgN;=0A=
 =0A=
-    $origmethod =3D~ /\s*([+-])\s*(?:\(([^\)]+)\))?(.+)/;=0A=
+    unless($origmethod =3D~ /\s*([+-])\s*(?:\(([^\)]+)\))?(.+)/ ){
+	print(&quot;Couldn't parse method: $origmethod\n&quot;);
+
+	return (&quot;unsupported&quot; =3D&gt; $origmethod);
+    }
 =0A=
     my $methodType =3D $1;=0A=
     my $retType =3D ($2 ? $2 : &quot;id&quot;);=0A=
     my $remainder =3D $3;=0A=
 =0A=
-    my $isClassMethod =3D (defined($methodType) ? ($methodType eq &quot;+&quot;) =
:<i> 0);=0A=
</I>+    my $isClassMethod =3D
+	(defined($methodType) ? ($methodType eq &quot;+&quot;) : 0);
 =0A=
     $retType =3D~ s/oneway //;=0A=
 =0A=
@@ -69,15 +66,9 @@=0A=
     # These arrays store our method names, their arg names and types=0A=
     my(@methodName, @name, @type);=0A=
 =0A=
-    my $message;=0A=
-    my $params;=0A=
-=0A=
     my $noarg_rx =3D '^\s*(\w+)\s*([;\{]|$)';=0A=
     my $arg_rx   =3D '(\w+):\s*(?:\(([^\)]+)\))?\s*(\w+)?(?:\s+|;)';=0A=
 =0A=
-    # The objc message we will be sending=0A=
-    my @message;=0A=
-=0A=
     # If there are no arguments (only matches method name)=0A=
     if($remainder =3D~ /$noarg_rx/){=0A=
 	push(@methodName, $1);=0A=
@@ -107,11 +98,19 @@=0A=
     # If we can't parse the method, complain=0A=
     }else{=0A=
 	print(&quot;Couldn't parse method: $origmethod\n&quot;);=0A=
-	return;=0A=
+	return(&quot;unsupported&quot; =3D&gt; $origmethod);
     }=0A=
 =0A=
-    my @params;=0A=
+    # Who receives this message?
+    # What object will we be sending messages to?
+    my($receiver, $logLine);
+
+    # The fully-qualified C function name separated by _s (:s don't =
work)
+    my $methodName =3D join(&quot;_&quot;,  $class, @methodName);
+
     # Build the params and message=0A=
+    my(@message, @params);
+
     if(int(@methodName) =3D=3D 1 &amp;&amp; int(@name) =3D=3D 0){=0A=
 	push(@message, $methodName[0]);=0A=
 =0A=
@@ -122,14 +121,15 @@=0A=
 	}=0A=
     }=0A=
 =0A=
-    # What object will we be sending messages to?=0A=
-    my($receiver, $logLine, $methodName);=0A=
+    # The objc message to send the object
+    my $message =3D join(&quot; &quot;,  @message);
 =0A=
     # If the method is a class method=0A=
     if($isClassMethod){=0A=
 	unshift(@params, &quot;Class CLASS&quot;);=0A=
 	$receiver =3D &quot;CLASS&quot;;=0A=
-	$logLine =3D &quot;\tif (!CLASS) CLASS =3D =
NSClassFromString(\@\&quot;$class\&quot;);\n&quot;;=0A=
+	$logLine =3D
+	    &quot;\tif (!CLASS) CLASS =3D NSClassFromString(\@\&quot;$class\&quot;);\n&quot;;
 	$class .=3D '_';=0A=
 =0A=
     # If the method is an instance method=0A=
@@ -137,34 +137,39 @@=0A=
 	unshift(@params, &quot;$class* THIS&quot;);=0A=
 	$receiver =3D &quot;THIS&quot;;=0A=
 	$logLine =3D &quot;&quot;;=0A=
+
     }=0A=
 =0A=
-    # The fully-qualified C function name separated by _s (:s don't =
work)=0A=
-    $methodName =3D join(&quot;_&quot;,  $class, @methodName);=0A=
+    # Add the log call
     $logLine .=3D &quot;\tNSLog(\@\&quot;$methodName: \%\@\\n\&quot;, $receiver);&quot;;=0A=
     =0A=
+    # The parameters to the C function
+    my $params     =3D join(&quot;, &quot;, @params);
+
     if(exists $methodHash-&gt;{$methodName}){=0A=
 	print(&quot;\t\tDuplicate method name: $methodName\n&quot;);=0A=
-	return ();=0A=
+	return (&quot;dup&quot;, $origmethod);
     }=0A=
     =0A=
     $methodHash-&gt;{$methodName} =3D &quot;1&quot;;=0A=
 =0A=
-    # The parameters to the C function=0A=
-    $params     =3D join(&quot;, &quot;, @params);=0A=
+    return ( &quot;method name&quot;        =3D&gt; $methodName,
+	     &quot;method parts&quot;       =3D&gt; [ @methodName ],
+	     &quot;arg names&quot;          =3D&gt; [ @name ],
+	     &quot;arg types&quot;          =3D&gt; [ @type ],
+	     &quot;message parts&quot;      =3D&gt; [ @message ],
+	     &quot;message&quot;            =3D&gt; $message,
+	     &quot;is class method&quot;    =3D&gt; $isClassMethod,
+	     &quot;log line&quot;           =3D&gt; $logLine,
+	     &quot;params&quot;             =3D&gt; $params,
+	     &quot;method name&quot;        =3D&gt; $methodName,
+	     &quot;receiver&quot;           =3D&gt; $receiver,
+	     &quot;return type&quot;        =3D&gt; $retType,
+	     &quot;param list&quot;         =3D&gt; [ @params ],
+	     &quot;original method&quot;    =3D&gt; $origmethod,
 =0A=
-    # The objc message to send the object=0A=
-    $message    =3D join(&quot; &quot;,  @message);=0A=
-=0A=
-    # Will we be returning?=0A=
-    my $retter =3D ($retType =3D~ /void/) ? &quot;&quot; : &quot;return &quot;;=0A=
-=0A=
-    # return the method we will be using=0A=
-    return ( &quot;$retType $methodName ($params) {&quot;,=0A=
-             $logLine,=0A=
-             &quot;\t${retter}[$receiver $message];&quot;,=0A=
-             &quot;}&quot;=0A=
 	   );=0A=
+
 }=0A=
 =0A=
 # Parse file=0A=
@@ -207,47 +212,34 @@=0A=
     my $isProtocol =3D 0;=0A=
     my $isInterface =3D 0;=0A=
     my $protocol;=0A=
-    my $interface =3D $name;=0A=
 =0A=
     my @imported =3D ();=0A=
     =0A=
-    push(@out, &quot;#import &lt;$dirpart/$name.h&gt;&quot;);=0A=
-    push(@out, &quot;#import &lt;Foundation/NSString.h&gt;&quot;);=0A=
+    push(@out,
+	 &quot;#import &lt;$dirpart/$name.h&gt;&quot;,
+	 &quot;#import &lt;Foundation/NSString.h&gt;&quot;,
+	 &quot;&quot;,
+	);
     =0A=
-    open(FILE, &quot;&lt;$filename&quot;) or die &quot;Couldn't open $filename: $!&quot;;=0A=
     my($class, $super, $protocols);=0A=
 =0A=
-    while(my $line =3D &lt;FILE&gt;) {=0A=
-	chomp $line;=0A=
-=0A=
-	commentsBeGone(\$line, \*FILE);=0A=
+    my @objC;
 =0A=
-	my %objC =3D=0A=
-	    ( class                =3D&gt; $class,=0A=
-	      super                =3D&gt; $super,=0A=
-	      &quot;method name&quot;        =3D&gt; undef,=0A=
-	      &quot;method parts&quot;       =3D&gt; [],=0A=
-	      &quot;arg names&quot;          =3D&gt; [],=0A=
-	      &quot;arg types&quot;          =3D&gt; [],=0A=
-	      &quot;is instance method&quot; =3D&gt; undef,=0A=
-	      receiver             =3D&gt; undef,=0A=
+    my %common =3D=20
+	( interface            =3D&gt; $name,
+	  super                =3D&gt; undef,
+	  isInterface          =3D&gt; undef,
+	  isProtocol           =3D&gt; undef,
 	    );=0A=
 =0A=
-	my %c =3D=0A=
-	    ( &quot;function name&quot; =3D&gt; undef,=0A=
-	      &quot;param types&quot;   =3D&gt; [],=0A=
-	      &quot;param names&quot;   =3D&gt; [],=0A=
-	      &quot;params&quot;        =3D&gt; undef,=0A=
-	      &quot;return type&quot;   =3D&gt; undef,=0A=
-	    );=0A=
+    open(my $fh, &quot;&lt;$filename&quot;) or die &quot;Couldn't open $filename: $!&quot;;
 =0A=
-	my %cSharp =3D=0A=
-	    ( class         =3D&gt; $class,=0A=
-	      super         =3D&gt; $super,=0A=
-	      &quot;method name&quot; =3D&gt; undef,=0A=
-	      &quot;arg names&quot;   =3D&gt; [],=0A=
-	      &quot;arg types&quot;   =3D&gt; [],=0A=
-	    );=0A=
+    while(my $line =3D &lt;$fh&gt;) {
+	chomp $line;
+
+	commentsBeGone(\$line, $fh);
+
+	my %objC;
 =0A=
 	# Traverse import lines=0A=
 	if($line =3D~ m:#import\s+[&lt;&quot;]([^&gt;&quot;]+)[&gt;&quot;]:){=0A=
@@ -293,25 +285,28 @@=0A=
 		    # Note that we have already imported this file=0A=
 		    $currentImports-&gt;{$fqImportFile} =3D 1;=0A=
 =0A=
+		    if($fqImportFile =3D~ /^NS.*\.h/ ){
 		    $imported{$fqImportFile} =3D=0A=
 			[ parseFile($fqImportFile, { %$currentImports }) ];=0A=
+		    }else{
+			$imported{$fqImportFile} =3D [];
+		    }
 =0A=
 		}=0A=
 	    }=0A=
 	# Determine the interface we are in=0A=
 	}elsif($line =3D~ /^\s*\@interface\s+(\w+)(.*)/){=0A=
-	    $isInterface =3D 1;=0A=
-	    $interface =3D $1;=0A=
+	    @common{'isInterface', 'interface'} =3D (1, $1);
 	    =0A=
 	    my $remainder =3D $2;=0A=
 =0A=
 	    $remainder =3D~ /\s*:\s*(\w+)\s*(?:&lt;([^&gt;]+)&gt;)?/;=0A=
 =0A=
 	    # Capture superclass and protocols=0A=
-	    ($super, $protocols) =3D ($1, $2);=0A=
+	    @common{'super', 'protocols'} =3D ($1, $2);
 =0A=
 	    # If the interface has a superclass=0A=
-	    if($super){=0A=
+	    if(exists $common{super} &amp;&amp; defined $common{super}){
 		# TODO: Do something in this case.=0A=
 	    }=0A=
 =0A=
@@ -319,7 +314,7 @@=0A=
 	    if($protocols){=0A=
 		my @protocols =3D split(/,\s*/, $protocols);=0A=
 =0A=
-		print(&quot; $interface implements: &quot;,=0A=
+		print(&quot; $common{interface} implements: &quot;,
 		      join(&quot;, &quot;, @protocols), &quot;\n&quot; );=0A=
 =0A=
 		# Place the protocol definitions directly into the interface=0A=
@@ -331,8 +326,10 @@=0A=
 =0A=
 		    foreach my $protoLine (@{ $protocols{$p} }){=0A=
 			push(@out,=0A=
-			     &quot;&quot;,=0A=
-			     parseMethod($protoLine, $interface, \%methods)=0A=
+			     genObjCStub( \%methods,
+					  parseMethod($protoLine,
+						      $common{interface})
+					)
 			    );=0A=
 		    }=0A=
 		}=0A=
@@ -345,6 +342,10 @@=0A=
 	    $remainder =3D~ /(\w+)\s*(?:&lt;([^&gt;]+)&gt;)?/;=0A=
 	    $protocol =3D $1;=0A=
 =0A=
+	    if($protocol eq $common{interface}){
+		$protocol .=3D '_';
+	    }
+
 	    # TODO: Do something with extended class information=0A=
 	    my $extendedClasses =3D $2;=0A=
 	    my @extendedClasses;=0A=
@@ -357,7 +358,7 @@=0A=
 =0A=
 	}elsif($line =3D~ /\@end/ ){=0A=
 =0A=
-	    ($class, $super) =3D (undef, undef);=0A=
+	    @common{'class', 'super'} =3D (undef, undef);
 =0A=
 	    if($isProtocol =3D=3D 1){=0A=
 		$protocols{$protocol} =3D [ @protocolOut ];=0A=
@@ -374,23 +375,41 @@=0A=
 =0A=
 	    # If the line doesn't end with a semicolon, whitespace, end of line=0A=
 	    # Do the following until it does=0A=
-	    while($line !~ /;\s*$ /x){ # Stupid emacs.=0A=
+	    while($line !~ /;\s*$/ ){
+
 		$line =3D~ <A HREF="s://.*::;=0A=">s://.*::;=0A=</A>
 		# Append the next line=0A=
-		$line .=3D &lt;FILE&gt;;=0A=
+		$line .=3D &lt;$fh&gt;;
 		# Remove trailing newline=0A=
 		chomp $line;=0A=
 		# Get rid of comments=0A=
-		commentsBeGone(\$line, \*FILE);=0A=
+		commentsBeGone(\$line, $fh);
 		# Replace { ... } with a semicolon=0A=
 		$line =3D~ s/\{[^\}]*\}/;/;=0A=
 	    }=0A=
 =0A=
-	    push(@protocolOut, $line)=0A=
-		if $isProtocol =3D=3D 1;=0A=
+	    if($isProtocol){
+		push(@protocolOut, $line);
+
+	    }else{
+		push(@objC,
+		     { parseMethod($line, $common{interface}, \%methods),
+		       %common=20
+		     });
+	    }
+	}
+    }
+
+    my @uniq;
+    # Generate the objC/C wrapper
+    foreach my $objC (@objC){
+	if(exists $objC-&gt;{unsupported}){
+	    push(@out, &quot;/* UNSUPPORTED: \n$objC-&gt;{unsupported}\n */\n\n&quot;);
+
+	}else{
+	    push(@out, genObjCStub(\%methods, %$objC));
+	    push(@uniq, $objC);
 =0A=
-	    push(@out, &quot;&quot;, parseMethod($line, $interface, \%methods, \%objC))=0A=
-		if $isInterface;=0A=
 	}=0A=
     }=0A=
 =0A=
@@ -403,6 +422,25 @@=0A=
     print OUT join($/, @out);=0A=
     close OUT;=0A=
 =0A=
+    my @csout;
+    # Generate the C# wrapper
+    foreach my $objC (@uniq){
+	push(@csout, genCSharpStub(getCSharpHash(%$objC)));
+    }
+
+    my $wrapperFile;
+    if($destdir eq &quot;appkit&quot;){
+	$wrapperFile =3D &quot;src/Apple.Appkit/$name.cs&quot;;
+    }elsif($destdir eq &quot;foundation&quot;){
+	$wrapperFile =3D &quot;src/Apple.Foundation/$name.cs&quot;;
+    }else{
+	print(&quot;This shouldn't happen.  \$destdir =3D '$destdir'\n&quot;);
+    }
+
+    open OUT, &quot;&gt;$wrapperFile&quot; or die &quot;Can't open $wrapperFile: $!&quot;;
+    print OUT join($/, @csout);
+    close OUT;
+
     my $numMethods =3D int(keys %methods);=0A=
     print &quot; $numMethods methods in $name.\n&quot;;=0A=
 =0A=
@@ -418,11 +456,11 @@=0A=
     opendir(my $dh, $sourcedir);=0A=
 =0A=
     my($name, $path, $suffix);=0A=
-    print &quot;Processing $sourcedir:\n&quot;;=0A=
+    print &quot;Processing directory: $sourcedir:\n&quot;;
 =0A=
     foreach my $filename (readdir($dh)) {=0A=
 	next if $filename =3D~ /^\./;=0A=
-	next unless $filename =3D~ /\.h$/;=0A=
+	next unless $filename =3D~ /^NS.*\.h$/;
 =0A=
 	($name, $path, $suffix) =3D fileparse(&quot;$sourcedir/$filename&quot;, &quot;.h&quot;);=0A=
 =0A=
@@ -450,7 +488,7 @@=0A=
 =0A=
     # Rid ourselves of multi-line comments=0A=
     if( $$line =3D~ m:/\*: ){=0A=
-	while( $$line !~ m:/\*.*\*/: ){=0A=
+	while( $$line !~ m:/\*.*\*/:){
 	    $$line .=3D &lt;$FH&gt;;=0A=
 	    chomp $$line;=0A=
 	}=0A=
@@ -497,3 +535,40 @@=0A=
 	$$line =3D~ <A HREF="s://.*::;=0A=">s://.*::;=0A=</A>
     }=0A=
 }=0A=
+
+sub genObjCStub {
+    my $metods =3D shift();
+    my %objC =3D @_;
+
+    if(exists $objC{dup}){
+	# Duplicate.  Don't return anything
+	return ();
+    }
+
+    # Will we be returning?
+    my $retter =3D ($objC{&quot;return type&quot;} =3D~ /void/) ? &quot;&quot; : &quot;return &quot;;
+
+    # Return the lines of the wrapper
+    return ( &quot;$objC{'return type'} $objC{'method name'} ($objC{params}) =
{&quot;,
+             $objC{&quot;log line&quot;},
+             &quot;\t${retter}[$objC{receiver} $objC{message}];&quot;,
+             &quot;}&quot;,
+	     &quot;&quot;,
+	   );
+}
+
+sub getCSharpHash {
+    my %objC =3D @_;
+
+    return (
+
+    );
+}
+
+sub genCSharpStub {
+    my %cSharp =3D @_;
+
+    return (
+
+    );
+}

------=_NextPart_000_0038_01C452C1.220E1310--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000071.html">[Cocoa-sharp] test
</A></li>
	<LI> Next message: <A HREF="000078.html">[Cocoa-sharp] New patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#76">[ date ]</a>
              <a href="thread.html#76">[ thread ]</a>
              <a href="subject.html#76">[ subject ]</a>
              <a href="author.html#76">[ author ]</a>
         </LI>
       </UL>
</body></html>
