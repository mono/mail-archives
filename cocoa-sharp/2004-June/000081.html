<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Cocoa-sharp] binding/glue problem with overwriting methods and calling super
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:umuff%40QUARK.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000086.html">
   <LINK REL="Next"  HREF="000082.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cocoa-sharp] binding/glue problem with overwriting methods and calling super
   </H1>
    <B>Urs Muff
    </B> 
    <A HREF="mailto:umuff%40QUARK.com"
       TITLE="[Cocoa-sharp] binding/glue problem with overwriting methods and calling super">umuff@QUARK.com
       </A><BR>
    <I>Tue, 15 Jun 2004 20:26:17 -0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="000086.html">[Cocoa-sharp] Binding thoughts.
</A></li>
        <LI> Next message: <A HREF="000082.html">[Cocoa-sharp] Recall: binding/glue problem with overwriting methods and calling
 super
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81">[ date ]</a>
              <a href="thread.html#81">[ thread ]</a>
              <a href="subject.html#81">[ subject ]</a>
              <a href="author.html#81">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C45349.4C710F94
Content-Type: text/plain

Ok the problem is the following:

To make it possible to have the objective-c runtime calling back into .Net
we did the following:
-	We generate a class on the fly that is named like the .Net class and
derived from the class named as parent class in .Net
-	We have an instance variable called mDelegate which can be set with
the @selector(initWithDelegate:) message
-	That delegate can be used to call back into the manage runtime from
unmanaged code, allowing to implement the two other messages each
dynamically created class implements
(@selector(methodSignatureFromSelector:), and @selector(forwardInvocation:))
-	To know how it is possible to handle objective-c messages you need
to understand low-level detail: the core message dispatcher will try
dispatching a message to it's given base, but if that base does not respond
to the given selector, it will send @selector(methodSignatureFromSelector:)
which will return the method signature including exact argument and return
type and size information to create an NSInvocation object that then will be
passed to @selector(forwardInvocation:) message.  If the former message
returns nil, the message is consider not implemented and an
doesNotRespondToSelector exception is thrown.
-	This implementation has been proven successful in the POC, but
reflecting deeper about what other cases are possible I found two problem
with this approach:  First, it does not allow overwriting an existing
message of a parent class, since that message will be found and the
@selector(forwardInvocation:) message will never be sent, since the original
message succeeded, ending up in the parents implementation rather then the
.Net implementation.  (This is very obvious when looking at some very common
initialization code
-	

------_=_NextPart_001_01C45349.4C710F94
Content-Type: text/html
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Dus-ascii&quot;&gt;
&lt;META NAME=3D&quot;Generator&quot; CONTENT=3D&quot;MS Exchange Server version =
5.5.2657.73&quot;&gt;
&lt;TITLE&gt;binding/glue problem with overwriting methods and calling =
super&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;

&lt;P ALIGN=3DLEFT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;Ok the problem is the =
following:&lt;/FONT&gt;&lt;/P&gt;

&lt;P ALIGN=3DLEFT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;To make it possible to =
have&lt;/FONT&gt; &lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;the&lt;/FONT&gt; &lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;objective&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;-c runtime =
calling back into .Net we did the following:&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/FONT&gt; &lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;We generate a class on the fly that is named =
like the .Net class and derived from the class named as parent class in =
.Net&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/FONT&gt; &lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;We have an instance variable called mDelegate =
which can be set with the&lt;/FONT&gt; &lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;@selector(&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;initWithDelegate:&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;)&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt; message&lt;/FONT&gt;
&lt;BR&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/FONT&gt; &lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;That delegate can be used to call back into the =
manage runtime from unmanaged code, allowing to implement the two other =
messages each dynamically created class implements (&lt;/FONT&gt;&lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;@selector(methodSignatureFromSelector:), and =
@selector(&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;forwardInvocation:&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;)&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;)&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/FONT&gt; &lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;To know how it is possible to handle =
objective-c messages you need to understand low-level detail: the core =
message dispatcher will try dispatching a message to it&lt;/FONT&gt;&lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;'&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;s given =
base, but if that base does not respond to the given selector, it will =
send&lt;/FONT&gt; &lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;@selector(methodSignatureFromSelector:)&lt;/FONT&gt;&lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt; which will return the method signature&lt;/FONT&gt; =
&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;including exact argument and return type =
and size information to create an NSInvocation object that then will be =
passed to&lt;/FONT&gt; &lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;@selector(&lt;/FONT&gt;&lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;forwardInvocation:&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;)&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt; message.&amp;nbsp; If =
the former message returns nil, the message is consider not implemented =
and an doesNotRespondToSelector exception is thrown.&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/FONT&gt; &lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;This implementation has been proven&lt;/FONT&gt; =
&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;successful&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt; in the POC, but reflecting deeper about what other =
cases are&lt;/FONT&gt; &lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;possible&lt;/FONT&gt;&lt;FONT =
SIZE=3D2 FACE=3D&quot;Arial&quot;&gt; I found two problem with this approach:&amp;nbsp; =
First, it does not allow overwriting an existing message of a parent =
class, since that message will be found and&lt;/FONT&gt; &lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;the&lt;/FONT&gt; &lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;@selector(&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;forwardInvocation:&lt;/FONT&gt;&lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;)&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt; message will =
never be sent, since the original message succeeded, ending up in the =
parents implementation rather the&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;n =
the .Net implementation.&amp;nbsp; (This is very obvious when looking at =
some very common&lt;/FONT&gt; &lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;initialization&lt;/FONT&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt; =
code&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/=
FONT&gt;=20
&lt;/P&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
------_=_NextPart_001_01C45349.4C710F94--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000086.html">[Cocoa-sharp] Binding thoughts.
</A></li>
	<LI> Next message: <A HREF="000082.html">[Cocoa-sharp] Recall: binding/glue problem with overwriting methods and calling
 super
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81">[ date ]</a>
              <a href="thread.html#81">[ thread ]</a>
              <a href="subject.html#81">[ subject ]</a>
              <a href="author.html#81">[ author ]</a>
         </LI>
       </UL>
</body></html>
