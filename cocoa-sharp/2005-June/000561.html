<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Cocoa-sharp] Patch: Tiger support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20Patch%3A%20Tiger%20support&In-Reply-To=42B9FD57.5070203%40imeem.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000560.html">
   <LINK REL="Next"  HREF="000562.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cocoa-sharp] Patch: Tiger support</H1>
    <B>Bryan Berg</B> 
    <A HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20Patch%3A%20Tiger%20support&In-Reply-To=42B9FD57.5070203%40imeem.com"
       TITLE="[Cocoa-sharp] Patch: Tiger support">bryan at imeem.com
       </A><BR>
    <I>Thu Jun 23 20:27:38 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000560.html">[Cocoa-sharp] Patch: Tiger support
</A></li>
        <LI>Next message: <A HREF="000562.html">[Cocoa-sharp] Patch: Tiger support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#561">[ date ]</a>
              <a href="thread.html#561">[ thread ]</a>
              <a href="subject.html#561">[ subject ]</a>
              <a href="author.html#561">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry to reply to my own post, but I've uploaded a new version of the 
patch that should address your concerns.

The patch is located here:

<A HREF="http://www.strangecargo.org/~bdb/cocoa-sharp/cocoa-sharp-tiger-20050623-04.diff">http://www.strangecargo.org/~bdb/cocoa-sharp/cocoa-sharp-tiger-20050623-04.diff</A>

This file does _not_ include the mapping.xml changes.  The generator 
output doesn't compile on the first try without those changes.  They are 
available, if you're interested, here:

<A HREF="http://www.strangecargo.org/~bdb/cocoa-sharp/cocoa-sharp-tiger-20050623-04-mapping.diff.gz">http://www.strangecargo.org/~bdb/cocoa-sharp/cocoa-sharp-tiger-20050623-04-mapping.diff.gz</A>

I'm going to add some additional comments to our comments below:

Bryan Berg wrote:
&gt;<i> kangaroo wrote:
</I>&gt;&gt;<i>1) Why all the method overrides?
</I>&gt;<i> Conflicts, as I recall.  ObjC can have methods which are both static and 
</I>&gt;<i> instance-bound with the same names.  I had to override a few in order 
</I>&gt;<i> for the generated code to be entirely correct (i.e., compile).
</I>
I have removed some of the ones which I've fixed in the code.  The ones 
that are there now are required for the three frameworks to generate and 
compile correctly.

As for the ones I've kept:

	* NSDatePickerCell has a selector that's defined (separately) for both 
classes and instance variables, and apparently, you can't do that in C#. 
  I added an override to remove the static one.

	* NSObjectController and NSPersistentDocument are one of the places 
where the AppKit is loosely dependant on the Core Data framework - we 
don't gen this framework yet (ever?, as it's 10.4 specific) - so, for 
now, the generator doesn't understand how to generate code for this type 
properly.

	* NSObject has accepts two finalize messages starting with 10.4(?). 
This conflicts with the Finalize() (or ~NSObject()) methods defined in 
the overrides; I overrided this to be a C# instance method, finalize(). 
  I overrided the +finalize method to finalizeClass().  Get rid of these 
if you want.  I'm not attached to them at all.

&gt;&gt;<i>2) all of the custom enums you have in that say generated; are they  
</I>&gt;&gt;<i>generated or hand made; if they're generated why would we add them to  
</I>&gt;&gt;<i>svn?
</I>&gt;<i> They were generated with hand modifications (constants that existed 
</I>&gt;<i> elsewhere in #defines, etc.)  I didn't think of the .addin trick that I 
</I>&gt;<i> then saw in a few other places (e.g. to handle UINT_MAX).  I can update 
</I>&gt;<i> the custom enums that I'd just overrided so they'll just work that way. 
</I>&gt;<i>   That is something I'd planned to do.
</I>
I used the .addin stuff to fix WebKit.NPNVariable and 
WebKit.NPPVariable, but I had to keep the overrides for the other enums:

	* NSPointingDeviceType, NSCalendarUnit, NSDateFormatterStyle, and all 
of the NSNumberFormatter* enums: these are enums which just bridge other 
frameworks' constants into Cocoa; it seems foolish to add an extra 
constant to an enum for _every_member_.

	* WebDrag{Source,Destination}Action: needed to be forced to be uint 
types, not int.

&gt;&gt;<i>3) could you please resend without the { } and whitespace changes?
</I>
This new diff should address this. Sorry, that was sloppy of me to have 
left that cruft in the previous patch.

&gt;&gt;<i>4) why :
</I>&gt;&gt;<i>-            Type.AddTypedef 
</I>&gt;&gt;<i>(&quot;NSApplicationDelegateReply&quot;,Type.FromDecl(&quot;int&quot;));
</I>&gt;&gt;<i>-            Type.AddTypedef 
</I>&gt;&gt;<i>(&quot;NSRequestUserAttentionType&quot;,Type.FromDecl(&quot;int&quot;));
</I>
One of the things I fixed/added in this patch is that previously the 
generator did not create enum classes for enums that were defined like this:

@interface NSBlah : NSObject {
	...
}
...
typedef enum NSBlahEnumeration {
	...
} NSBlahEnumeration;

@end

...the code simply discarded everything between the @interface and @end 
lines - we don't do that anymore.  We properly generate the correct 
enumerations for those two types - IMO those were only put in there as 
hacks to work around this behavior.  That's also why we have a lot more 
enums to override - there are a lot more enums being generated period.

&gt;&gt;<i>5) disabling noname enums I'm ok with; as long as they reference  
</I>&gt;&gt;<i>methods that call them are fixed up
</I>
If you agree with this, please delete all the 
generator/custom/enum*noname*, etc. cruft.  There are a few filenames 
with spaces in them, like enum _NSByteOrder, etc, which I don't think 
are even used anymore. If they could go away I'd appreciate it.

Also, in the last patch, some really embarassing prototype string 
parsing code slipped in - I've replaced this with some regex-fu, so it 
should be significantly cleaner (and should parse arrays a bit better).

If this meets approval, it would be great to have those two small 
previous patches integrated as well (output, frameworkdir).

Thank you,

-Bryan


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000560.html">[Cocoa-sharp] Patch: Tiger support
</A></li>
	<LI>Next message: <A HREF="000562.html">[Cocoa-sharp] Patch: Tiger support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#561">[ date ]</a>
              <a href="thread.html#561">[ thread ]</a>
              <a href="subject.html#561">[ subject ]</a>
              <a href="author.html#561">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">More information about the Cocoa-sharp
mailing list</a><br>
</body></html>
