<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Cocoa-sharp] Re: Cocoa# problem with UTF-8 strings...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:umuff%40QUARK.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000411.html">
   <LINK REL="Next"  HREF="000414.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cocoa-sharp] Re: Cocoa# problem with UTF-8 strings...
   </H1>
    <B>Urs Muff
    </B> 
    <A HREF="mailto:umuff%40QUARK.com"
       TITLE="[Cocoa-sharp] Re: Cocoa# problem with UTF-8 strings...">umuff@QUARK.com
       </A><BR>
    <I>Wed, 26 Jan 2005 13:31:45 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="000411.html">[Cocoa-sharp] Re: Cocoa# problem with UTF-8 strings...
</A></li>
        <LI> Next message: <A HREF="000414.html">[Cocoa-sharp] Cocoa 0.2 Release Update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#412">[ date ]</a>
              <a href="thread.html#412">[ thread ]</a>
              <a href="subject.html#412">[ subject ]</a>
              <a href="author.html#412">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I get
'Illegal instruction'
When trying to use this patch with monodoc (my only test client).

- Urs C. Muff
Software Architect       - Research Lab, Quark EIF
Quark Inc.
<A HREF="mailto:UMuff@Quark.Com">UMuff@Quark.Com</A>         - X6360
+1 (303) 894 3360

CONFIDENTIALITY NOTICE
This e-mail transmission and any documents, files, or previous e-mail
messages appended or attached to it, may contain information that is
confidential or legally privileged. If you are not the intended
recipient, or a person responsible for delivering it to the intended
recipient, you are hereby notified that you must not read this
transmission and that any disclosure, copying, printing, distribution,
or use of the information contained or attached to this transmission is
STRICTLY PROHIBITED. If you have received this transmission in error,
please immediately notify the sender by telephone (+1.303.894.3360) or
return e-mail message (<A HREF="mailto:umuff@quark.com">umuff@quark.com</A>) and delete the original
transmission, its attachments, and any copies without reading or saving
in any manner. Thank you.

-----Original Message-----
From: <A HREF="mailto:cocoa-sharp-admin@lists.ximian.com">cocoa-sharp-admin@lists.ximian.com</A>
[mailto:<A HREF="mailto:cocoa-sharp-admin@lists.ximian.com">cocoa-sharp-admin@lists.ximian.com</A>] On Behalf Of grompf
Sent: Wednesday, January 26, 2005 12:32 PM
To: Edward J.Sabol
Cc: <A HREF="mailto:cocoa-sharp@lists.ximian.com">cocoa-sharp@lists.ximian.com</A>
Subject: Re: [Cocoa-sharp] Re: Cocoa# problem with UTF-8 strings...

Edward,

     Please try your code against cocoa# from SVN with this patch
applied

Index: generator/custom/Foundation/TypeConverter.cs
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
--- ../cocoa-sharp/generator/custom/Foundation/TypeConverter.cs =20
(revision 38922)
+++ ../cocoa-sharp/generator/custom/Foundation/TypeConverter.cs =20
(working copy)
@@ -122,7 +122,7 @@
                                 return nsObj.Raw;
                         string str =3D obj as string;
                         if (str !=3D null)
-                               return new NSString(str).Raw;
+                               return =20
((NSString)(NSString.StringWithUTF8String (str))).Raw;
                         throw new Exception(&quot;Net2NS: not handled type =20
of object: &quot; + obj.GetType());
                 }
         }

On 26-Jan-05, at 3:12 AM, grompf wrote:


&gt;<i>
</I>&gt;<i> On 26-Jan-05, at 2:59 AM, Edward J. Sabol wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> I'm not sure that actually is nightly; adhamh can you confirm?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well, I have SVN now, so I could upgrade to the latest version if you
</I>
&gt;&gt;<i> think
</I>&gt;&gt;<i> that would help.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes definately run from SVN
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> Are you even sure NSOutlineView can take UTF8 without some
</I>custom-fu?
&gt;&gt;<i>
</I>&gt;&gt;<i> I have no idea. I would hope it could, assuming the NSStrings are =20
</I>&gt;&gt;<i> initialized
</I>&gt;&gt;<i> correctly. I think the Finder use NSOutlineView for &quot;View as List&quot; =20
</I>&gt;&gt;<i> and file
</I>&gt;&gt;<i> names are UTF-8, right? But the Finder probably subclasses the heck =20
</I>&gt;&gt;<i> out of
</I>&gt;&gt;<i> NSOutlineView, if it uses it at all, so I don't know. Anyway, if =20
</I>&gt;&gt;<i> there's
</I>&gt;&gt;<i> another NS control/view you'd like me to test it with that you know =20
</I>&gt;&gt;<i> handles
</I>&gt;&gt;<i> UTF-8 strings, I could probably attempt to do so...
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ok I think I know what the problem here is; our string hiding does
</I>&gt;<i> new NSString (str).Raw;
</I>&gt;<i>
</I>&gt;<i> which is:
</I>&gt;<i>
</I>&gt;<i> public NSString(string str) : =20
</I>&gt;<i> this((IntPtr)ObjCMessaging.objc_msgSend=20
</I>&gt;<i> (NSString_classPtr,&quot;stringWithCString:&quot;,typeof(IntPtr),typeof=20
</I>&gt;<i> (string),str),false) {}
</I>&gt;<i>
</I>&gt;<i> which in your case should be
</I>&gt;<i> stringWithUTF8String:
</I>&gt;<i>
</I>&gt;<i> We'll have a chat about this (me and urs) tomorrow and think about how
</I>
&gt;<i> to handle
</I>&gt;<i>
</I>&gt;<i> -kangaroo
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Cocoa-sharp mailing list
</I>&gt;<i> <A HREF="mailto:Cocoa-sharp@lists.ximian.com">Cocoa-sharp@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">http://lists.ximian.com/mailman/listinfo/cocoa-sharp</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> !DSPAM:41f74f7a287291865249173!
</I>&gt;<i>
</I>

_______________________________________________
Cocoa-sharp mailing list
<A HREF="mailto:Cocoa-sharp@lists.ximian.com">Cocoa-sharp@lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">http://lists.ximian.com/mailman/listinfo/cocoa-sharp</A>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000411.html">[Cocoa-sharp] Re: Cocoa# problem with UTF-8 strings...
</A></li>
	<LI> Next message: <A HREF="000414.html">[Cocoa-sharp] Cocoa 0.2 Release Update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#412">[ date ]</a>
              <a href="thread.html#412">[ thread ]</a>
              <a href="subject.html#412">[ subject ]</a>
              <a href="author.html#412">[ author ]</a>
         </LI>
       </UL>
</body></html>
