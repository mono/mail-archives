<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Cocoa-sharp] ObjectiveC.SendMessage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20ObjectiveC.SendMessage&In-Reply-To=43BC6CF1.8000902%40web.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000757.html">
   <LINK REL="Next"  HREF="000759.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cocoa-sharp] ObjectiveC.SendMessage</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20ObjectiveC.SendMessage&In-Reply-To=43BC6CF1.8000902%40web.de"
       TITLE="[Cocoa-sharp] ObjectiveC.SendMessage">lupus at ximian.com
       </A><BR>
    <I>Mon Jan  9 09:40:53 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000757.html">[Cocoa-sharp] ObjectiveC.SendMessage
</A></li>
        <LI>Next message: <A HREF="000759.html">[Cocoa-sharp] ObjectiveC.SendMessage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#758">[ date ]</a>
              <a href="thread.html#758">[ thread ]</a>
              <a href="subject.html#758">[ subject ]</a>
              <a href="author.html#758">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/05/06 Andreas F&#228;rber wrote:
&gt;<i> I've tried to rewrite the ObjCMessaging (see attached), attempting to 
</I>&gt;<i> simplify the arguments passed and to remove the dependency on 
</I>&gt;<i> Reflection.Emit by using &quot;params&quot; arrays for P/Invoke as well - is that 
</I>&gt;<i> not possible and thus the reason for the current implementation? It 
</I>[...]
&gt;<i> vararg parameters as specified by &quot;params&quot;? I have already set 
</I>&gt;<i> CharSet.Auto and tried Winapi and Cdecl calling conventions, where 
</I>&gt;<i> Microsoft says about Cdecl: &quot;This enables calling functions with 
</I>&gt;<i> *varargs*, which makes it appropriate to use for methods that accept a 
</I>&gt;<i> variable number of parameters, such as *Printf*.&quot; Yet below in an 
</I>&gt;<i> example they write C# did not support varargs and all arguments would 
</I>&gt;<i> have to be defined explicitly. If that is the problem, might an 
</I>&gt;<i> ICustomMarshaler class for object[] do the trick?
</I>
The C# params keyword has nothing to do with varargs, it is just a C#
compiler convention that has no effect on the underlying call
convention. So it can't be used.
Similarly ICustomMarshaler has nothing to do with the native call
convention so again is no solution here.
The microsoft remarks you report are only valid for x86, though we can
make the stuff work with some amount of slowdown in p/invoke calls
on most of the other architectures.
In the future we'll add support in mono to be able to use different
signatures for the same p/invoke method, so in that case you'll be able
to use the CLR vararg support (which is currently available for
non-pinvoke methods) also for this task. But this won't bring
significant benefits, so it's way down in the todo list.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">lupus at ximian.com</A>                             Monkeys do it better
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000757.html">[Cocoa-sharp] ObjectiveC.SendMessage
</A></li>
	<LI>Next message: <A HREF="000759.html">[Cocoa-sharp] ObjectiveC.SendMessage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#758">[ date ]</a>
              <a href="thread.html#758">[ thread ]</a>
              <a href="subject.html#758">[ subject ]</a>
              <a href="author.html#758">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">More information about the Cocoa-sharp
mailing list</a><br>
</body></html>
