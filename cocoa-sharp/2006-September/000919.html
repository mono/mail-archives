<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Cocoa-sharp] URL, URLRequest, WebScriptObject patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20URL%2C%20URLRequest%2C%20WebScriptObject%20patch&In-Reply-To=77f230a10609141253t1f095b8eidbbc44490a782404%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000918.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cocoa-sharp] URL, URLRequest, WebScriptObject patch</H1>
    <B>C.J. Adams-Collier</B> 
    <A HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20URL%2C%20URLRequest%2C%20WebScriptObject%20patch&In-Reply-To=77f230a10609141253t1f095b8eidbbc44490a782404%40mail.gmail.com"
       TITLE="[Cocoa-sharp] URL, URLRequest, WebScriptObject patch">cjcollier at colliertech.org
       </A><BR>
    <I>Sun Sep 17 12:00:55 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000918.html">[Cocoa-sharp] URL, URLRequest, WebScriptObject patch
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#919">[ date ]</a>
              <a href="thread.html#919">[ thread ]</a>
              <a href="subject.html#919">[ subject ]</a>
              <a href="author.html#919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Meet me on IRC to go over this.  I'm usually around.  say &quot;cj: ping&quot;
on #mono or #cocoa# and I should respond soon.

netshade wrote:
&gt;<i> Shoulda sent to list:
</I>&gt;<i>
</I>&gt;<i> Included
</I>&gt;<i>
</I>&gt;<i> Also, while working on my project, I successfully built a native
</I>&gt;<i> exec, packaged in an .app file, and relinked against included Mono
</I>&gt;<i> libs in &lt;app&gt;.app/Contents/Frameworks.    Was pretty gratifying to
</I>&gt;<i> build a drop-anywhere, no-mono-install necessary app. Is it just
</I>&gt;<i> common knowledge to use the tools avail to do that, or would it be
</I>&gt;<i> worthwhile for me to send an example to the list?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> CZ
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 9/14/06, *C.J. Adams-Collier* &lt; <A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">cjcollier at colliertech.org</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">cjcollier at colliertech.org</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Please include an overview in the root ChangeLog.  Geoff and I will
</I>&gt;<i> go over the patches tomorrow around noon, U.S. Pacific time
</I>&gt;<i>
</I>&gt;<i> netshade wrote:
</I>&gt;&gt;<i> Included is a patch against cocoa# and webkit# to add the
</I>&gt;&gt;<i> windowScriptObject prop to WebView, and to add loading by
</I>&gt;&gt;<i> URLRequest to WebFrame .  There is also a fix in ObjCClass
</I>&gt;&gt;<i> removing a reference to contains() on the registered class table,
</I>&gt;&gt;<i> when I imagine it should have been containsKey().
</I>&gt;<i>
</I>&gt;&gt;<i> Also included is a batch of new files, most of which honestly I
</I>&gt;&gt;<i> have no idea what they do.  However, in the course of working on
</I>&gt;&gt;<i> my own app, I got exceptions thrown by ObjCClass showing the
</I>&gt;&gt;<i> classes as missing.  Adding them seemed to shut it up.
</I>&gt;<i>
</I>&gt;&gt;<i> I should add that the reason I added these items was because I
</I>&gt;&gt;<i> wanted to bind a mono object to a Javascript variable in the
</I>&gt;&gt;<i> WebView.  I now have that working, and will give a quick overview
</I>&gt;&gt;<i>  on how to do it yourself:
</I>&gt;<i>
</I>&gt;&gt;<i> ( In the interests of time, skipping typical cocoa# setup junk)
</I>&gt;<i>
</I>&gt;&gt;<i> Create a class that subclasses Cocoa.Object.  Aside from your
</I>&gt;&gt;<i> constructors, add three methods ( stubbed below ):
</I>&gt;<i>
</I>&gt;&gt;<i> [Export(&quot;isSelectorExcludedFromWebScript:&quot;)] public static bool
</I>&gt;&gt;<i> _isSelectorExcludedFromWebScript(string selector) { return false;
</I>&gt;&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> [Export(&quot;webScriptNameForSelector:&quot;)] public static Cocoa.String
</I>&gt;&gt;<i> _webScriptNameForSelector(string selector){ return new
</I>&gt;&gt;<i> Cocoa.String(&quot;console&quot;); }
</I>&gt;<i>
</I>&gt;&gt;<i> [Export(&quot;console:&quot;)] public void console(IntPtr cob){
</I>&gt;&gt;<i> Cocoa.Object ob = Cocoa.Object.FromIntPtr(cob);
</I>&gt;&gt;<i> Console.WriteLine(&quot;FROM MONO &quot;+ob.ToString()); }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> The top two method exports (isSelectorExcludedFromwebScript and
</I>&gt;&gt;<i> webScriptNameForSelector) are taken from the informal WebKit
</I>&gt;&gt;<i> scripting protocol ( the googling for which should take you to
</I>&gt;&gt;<i> the official Apple docs ).  isSelectorExcludedFromWebScript: is
</I>&gt;&gt;<i> called to check if the method referred to by a given selector is
</I>&gt;&gt;<i> able to be called; in this case, we just return false and allow
</I>&gt;&gt;<i> every method in the class to be called.
</I>&gt;&gt;<i> webScriptNameForSelector: is called to ascertain what the
</I>&gt;&gt;<i> JavaScript name for a given method will be; if this method didn't
</I>&gt;&gt;<i> exist, all the methods in your class would be munged up according
</I>&gt;&gt;<i> to those scripting protocol docs I mentioned. ( Namely, colons :
</I>&gt;&gt;<i> would become underscores _ )
</I>&gt;<i>
</I>&gt;&gt;<i> Finally we export the console method to make it visible to
</I>&gt;&gt;<i> WebKit.
</I>&gt;<i>
</I>&gt;&gt;<i> This object you've created will be the object that you insert
</I>&gt;&gt;<i> into the WebView's javascript runtime.  In order to do that,
</I>&gt;&gt;<i> you'll need to edit your application controller ( or wherever
</I>&gt;&gt;<i> you're working with the WebView - and if you're lost, consult the
</I>&gt;&gt;<i> CocoaDoc application in SVN to figure out how to get a WebView in
</I>&gt;&gt;<i> your Cocoa# app and work with it ) to act as a delegate for the
</I>&gt;&gt;<i> WebView ( for reasons I'm about to mention ).
</I>&gt;<i>
</I>&gt;&gt;<i> In interface builder, create a connection between your webview
</I>&gt;&gt;<i> and your application controller ( or whatever ) by ctrl+clicking
</I>&gt;&gt;<i> on the webview and dragging the line that appears to the
</I>&gt;&gt;<i> controller.  Set the frameLoadDelegate of your WebView to the
</I>&gt;&gt;<i> application controller.  Then add a method similar to the
</I>&gt;&gt;<i> following to your application controller:
</I>&gt;<i>
</I>&gt;&gt;<i> [Export(&quot;webView:windowScriptObjectAvailable:&quot;)] public void
</I>&gt;&gt;<i> HandleLoad(WebView pane,WebScriptObject wso){ MyScriptableObject
</I>&gt;&gt;<i> ob = new MyScriptableObject(); //above would be the object you
</I>&gt;&gt;<i> created earlier
</I>&gt;<i>
</I>&gt;&gt;<i> wso.SetValueForKey(new Cocoa.String (&quot;logger&quot;),ob); }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> You'll also want to add a directive somewhere in here ( in a
</I>&gt;&gt;<i> method that responds to awakeFromNib:, for instance ) that tells
</I>&gt;&gt;<i> the WebFrame to load up an HTML file that has content similar to
</I>&gt;&gt;<i> the following:
</I>&gt;<i>
</I>&gt;&gt;<i> &lt;script language=&quot;JavaScript&quot;&gt; logger.console(&quot;.. to Objective C
</I>&gt;&gt;<i> to JavaScript&quot;); &lt;/script&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> You should see a line like this printed out to the console:
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> FROM MONO .. to Objective C to JavaScript
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Hope someone else finds this useful.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> CZ
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> ----------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> _______________________________________________ Cocoa-sharp
</I>&gt;&gt;<i> mailing list <A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">Cocoa-sharp at lists.ximian.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">Cocoa-sharp at lists.ximian.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">http://lists.ximian.com/mailman/listinfo/cocoa-sharp</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -- &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">cjcollier at colliertech.org</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">cjcollier at colliertech.org</A>&gt; &gt;
</I>&gt;<i> <A HREF="http://wp.colliertech.org/cj/">http://wp.colliertech.org/cj/</A> +1 206 226 5809
</I>&gt;<i>
</I>&gt;&gt;<i> ----------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> _______________________________________________ Cocoa-sharp
</I>&gt;&gt;<i> mailing list <A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">Cocoa-sharp at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">http://lists.ximian.com/mailman/listinfo/cocoa-sharp</A>
</I>&gt;<i>
</I>-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (Darwin)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org">http://enigmail.mozdev.org</A>

iD8DBQFFDXE2bS8rWWzCfqgRAiBkAKCXuVLXASJRkXsiVgE1p3xJ7S2vcACfeyon
X6wrS6Ux0ktCbpumacmANic=
=MA0I
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000918.html">[Cocoa-sharp] URL, URLRequest, WebScriptObject patch
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#919">[ date ]</a>
              <a href="thread.html#919">[ thread ]</a>
              <a href="subject.html#919">[ subject ]</a>
              <a href="author.html#919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">More information about the Cocoa-sharp
mailing list</a><br>
</body></html>
