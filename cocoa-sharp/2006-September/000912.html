<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Cocoa-sharp] URL, URLRequest, WebScriptObject patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20URL%2C%20URLRequest%2C%20WebScriptObject%20patch&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000902.html">
   <LINK REL="Next"  HREF="000914.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cocoa-sharp] URL, URLRequest, WebScriptObject patch</H1>
    <B>netshade</B> 
    <A HREF="mailto:cocoa-sharp%40lists.ximian.com?Subject=%5BCocoa-sharp%5D%20URL%2C%20URLRequest%2C%20WebScriptObject%20patch&In-Reply-To="
       TITLE="[Cocoa-sharp] URL, URLRequest, WebScriptObject patch">netshade at gmail.com
       </A><BR>
    <I>Tue Sep 12 14:13:13 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000902.html">[Cocoa-sharp] cocoa-sharp 0.9.3?
</A></li>
        <LI>Next message: <A HREF="000914.html">[Cocoa-sharp] URL, URLRequest, WebScriptObject patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#912">[ date ]</a>
              <a href="thread.html#912">[ thread ]</a>
              <a href="subject.html#912">[ subject ]</a>
              <a href="author.html#912">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Included is a patch against cocoa# and webkit# to add the windowScriptObject
prop to WebView, and to add loading by URLRequest to WebFrame .  There is
also a fix in ObjCClass removing a reference to contains() on the registered
class table, when I imagine it should have been containsKey().

Also included is a batch of new files, most of which honestly I have no idea
what they do.  However, in the course of working on my own app, I got
exceptions thrown by ObjCClass showing the classes as missing.  Adding them
seemed to shut it up.

I should add that the reason I added these items was because I wanted to
bind a mono object to a Javascript variable in the WebView.  I now have that
working, and will give a quick overview on how to do it yourself:

( In the interests of time, skipping typical cocoa# setup junk)

Create a class that subclasses Cocoa.Object.  Aside from your constructors,
add three methods ( stubbed below ):

[Export(&quot;isSelectorExcludedFromWebScript:&quot;)]
public static bool _isSelectorExcludedFromWebScript(string selector) {
return false;
}

[Export(&quot;webScriptNameForSelector:&quot;)]
public static Cocoa.String _webScriptNameForSelector(string selector){
     return new Cocoa.String(&quot;console&quot;);
}

[Export(&quot;console:&quot;)]
public void console(IntPtr cob){
       Cocoa.Object ob = Cocoa.Object.FromIntPtr(cob);
       Console.WriteLine(&quot;FROM MONO &quot;+ob.ToString());
}


The top two method exports (isSelectorExcludedFromwebScript and
webScriptNameForSelector) are taken from the informal WebKit scripting
protocol ( the googling for which should take you to the official Apple docs
).  isSelectorExcludedFromWebScript: is called to check if the method
referred to by a given selector is able to be called; in this case, we just
return false and allow every method in the class to be called.
webScriptNameForSelector: is called to ascertain what the JavaScript name
for a given method will be; if this method didn't exist, all the methods in
your class would be munged up according to those scripting protocol docs I
mentioned. ( Namely, colons : would become underscores _ )

Finally we export the console method to make it visible to WebKit.

This object you've created will be the object that you insert into the
WebView's javascript runtime.  In order to do that, you'll need to edit your
application controller ( or wherever you're working with the WebView - and
if you're lost, consult the CocoaDoc application in SVN to figure out how to
get a WebView in your Cocoa# app and work with it ) to act as a delegate for
the WebView ( for reasons I'm about to mention ).

In interface builder, create a connection between your webview and your
application controller ( or whatever ) by ctrl+clicking on the webview and
dragging the line that appears to the controller.  Set the frameLoadDelegate
of your WebView to the application controller.  Then add a method similar to
the following to your application controller:

        [Export(&quot;webView:windowScriptObjectAvailable:&quot;)]
        public void HandleLoad(WebView pane,WebScriptObject wso){
                MyScriptableObject ob = new MyScriptableObject();
                //above would be the object you created earlier

                wso.SetValueForKey(new Cocoa.String(&quot;logger&quot;),ob);
        }



You'll also want to add a directive somewhere in here ( in a method that
responds to awakeFromNib:, for instance ) that tells the WebFrame to load up
an HTML file that has content similar to the following:

&lt;script language=&quot;JavaScript&quot;&gt;
logger.console(&quot;.. to Objective C to JavaScript&quot;);
&lt;/script&gt;


You should see a line like this printed out to the console:

&gt;<i>FROM MONO .. to Objective C to JavaScript
</I>

Hope someone else finds this useful.


CZ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment.html">http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cocoa-webkit.patch
Type: application/octet-stream
Size: 5673 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment.obj">http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: WebScriptObject.cs
Type: application/octet-stream
Size: 1628 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0001.obj">http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0001.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ConcreteMutableData.cs
Type: application/octet-stream
Size: 295 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0002.obj">http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0002.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Enumerator.cs
Type: application/octet-stream
Size: 259 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0003.obj">http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0003.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: IdEnumerator.cs
Type: application/octet-stream
Size: 267 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0004.obj">http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0004.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PathStore2.cs
Type: application/octet-stream
Size: 259 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0005.obj">http://lists.ximian.com/pipermail/cocoa-sharp/attachments/20060912/80c195c6/attachment-0005.obj</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000902.html">[Cocoa-sharp] cocoa-sharp 0.9.3?
</A></li>
	<LI>Next message: <A HREF="000914.html">[Cocoa-sharp] URL, URLRequest, WebScriptObject patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#912">[ date ]</a>
              <a href="thread.html#912">[ thread ]</a>
              <a href="subject.html#912">[ subject ]</a>
              <a href="author.html#912">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/cocoa-sharp">More information about the Cocoa-sharp
mailing list</a><br>
</body></html>
