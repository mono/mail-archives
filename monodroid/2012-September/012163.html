<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Sensor Handler loses GREF handles
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Sensor%20Handler%20loses%20GREF%20handles&In-Reply-To=%3C1346777474691-5711686.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012175.html">
   <LINK REL="Next"  HREF="012164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Sensor Handler loses GREF handles</H1>
    <B>NebulaSleuth</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Sensor%20Handler%20loses%20GREF%20handles&In-Reply-To=%3C1346777474691-5711686.post%40n5.nabble.com%3E"
       TITLE="[mono-android] Sensor Handler loses GREF handles">nebulasleuth at excite.com
       </A><BR>
    <I>Tue Sep  4 16:51:14 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="012175.html">[mono-android] Android.Views.InflateException: unable to inflate Fragment inside Fragment
</A></li>
        <LI>Next message: <A HREF="012164.html">[mono-android] Sensor Handler loses GREF handles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12163">[ date ]</a>
              <a href="thread.html#12163">[ thread ]</a>
              <a href="subject.html#12163">[ subject ]</a>
              <a href="author.html#12163">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a problem where my application seems to lose GREF's very quickly.  I
tracked it down to the Sensor handler.  Basically after running for about an
20 minutes my application becomes unresponsive (very slow) and produces and
ANR dialog.  

The problem seems to be in my Sensor Handler, but for the life of me I don't
know what is wrong.  I have boiled it down to simply reading the X,Y,Z data.  

If I do that, a GREF gets lost and eventually, (within 15-20 minutes) I hit
the 46800 maximum GREF count which causes a full GC pass which frees some
up, then it hits the max again fairly quickly, and the process repeats. This
is causing the app to run VERY slow.

The code is very simple:

in OnResume():
            SensorManager sm =
(SensorManager)GetSystemService(SensorService);
            if (sm != null)
            {
                sm.RegisterListener(this,
sm.GetDefaultSensor(SensorType.Accelerometer), SensorDelay.Game);
            }

in OnPause():
            SensorManager sm =
(SensorManager)GetSystemService(SensorService);
            if (sm != null)
            {
                sm.UnregisterListener(this);
            }

and the handler:
        public void OnSensorChanged(SensorEvent sensorEvent)
        {
           // If I don't do the following three lines, GREF counts don't go
haywire
            float X = sensorEvent.Values[0];
            float Y = sensorEvent.Values[1];
            float Z = sensorEvent.Values[2];
            // sensorEvent.Dispose(); //Dispose does not seem to help
        }

Am I forgetting/missing something?  It seems pretty simple.

-Mike





--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/Sensor-Handler-loses-GREF-handles-tp5711686.html">http://mono-for-android.1047100.n5.nabble.com/Sensor-Handler-loses-GREF-handles-tp5711686.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012175.html">[mono-android] Android.Views.InflateException: unable to inflate Fragment inside Fragment
</A></li>
	<LI>Next message: <A HREF="012164.html">[mono-android] Sensor Handler loses GREF handles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12163">[ date ]</a>
              <a href="thread.html#12163">[ thread ]</a>
              <a href="subject.html#12163">[ subject ]</a>
              <a href="author.html#12163">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
