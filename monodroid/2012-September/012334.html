<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] ReaderWriterLockSlim - fully implemented?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20ReaderWriterLockSlim%20-%20fully%20implemented%3F&In-Reply-To=%3C2EA497CC-3145-4390-8A31-339A2C09BB1D%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012326.html">
   <LINK REL="Next"  HREF="012344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] ReaderWriterLockSlim - fully implemented?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20ReaderWriterLockSlim%20-%20fully%20implemented%3F&In-Reply-To=%3C2EA497CC-3145-4390-8A31-339A2C09BB1D%40xamarin.com%3E"
       TITLE="[mono-android] ReaderWriterLockSlim - fully implemented?">jonp at xamarin.com
       </A><BR>
    <I>Tue Sep 18 15:28:25 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="012326.html">[mono-android] ReaderWriterLockSlim - fully implemented?
</A></li>
        <LI>Next message: <A HREF="012344.html">[mono-android] ReaderWriterLockSlim - fully implemented?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12334">[ date ]</a>
              <a href="thread.html#12334">[ thread ]</a>
              <a href="subject.html#12334">[ subject ]</a>
              <a href="author.html#12334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Note: I'm not a ReaderWriterLockSlim expert, I just play one on TV (and ask around on IRC...)

I'm told that &quot;you can't do [what you're doing]&quot;; specifically, ReaderWriterLockSlim locks are per-thread. You can't acquire the lock on one thread and release it on another. Thus, IsWriteLockHeld should not be used for this purpose. (Assuming that we're reading the code properly...).

If we're misinterpreting your code, could you please provide a test project for diagnostic purposes?

Thanks,
 - Jon

On Sep 18, 2012, at 8:49 AM, Stephan Steiner &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">stephan.steiner at gmail.com</A>&gt; wrote:

&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I'm using this code
</I>&gt;<i> 
</I>&gt;<i> ReaderWriterLockSlim  myLock = new ReaderWriterLockSlim ();
</I>&gt;<i> 
</I>&gt;<i> public void StartLogin()
</I>&gt;<i> {
</I>&gt;<i> if (myLock.IsWriteLockHeld)
</I>&gt;<i> Log.Debug(tag, &quot;Login in progress&quot;);
</I>&gt;<i> else
</I>&gt;<i> {
</I>&gt;<i> try
</I>&gt;<i> {
</I>&gt;<i> myLock.EnterWriteLock();
</I>&gt;<i> // launch asynchronous process that will launch loginComplete when complete
</I>&gt;<i> }
</I>&gt;<i> catch (Exception e)
</I>&gt;<i> {
</I>&gt;<i> if (myLock.IsWriteLockHeld)
</I>&gt;<i> myLock.ExitWriteLock();
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> private void loginComplete()
</I>&gt;<i> {
</I>&gt;<i> try
</I>&gt;<i> {// do some processing
</I>&gt;<i> }
</I>&gt;<i> finally
</I>&gt;<i> {
</I>&gt;<i> if (myLock.IsWriteLockHeld)
</I>&gt;<i> myLock.ExitWriteLock();
</I>&gt;<i> }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> The first time round, this works as expected. The second time however,
</I>&gt;<i> myLock.IsWriteLockHeld will return true in the first line of StartLogin -
</I>&gt;<i> that is because in the finallyClause of loginComplete,
</I>&gt;<i> myLock.IsWriteLockHeld is false - so the lock is acquired, but never
</I>&gt;<i> released. I know that despite using callbacks and performing the actual
</I>&gt;<i> login in a background task, myLock is only declared once so I don't
</I>&gt;<i> understand why at one point in time it says the lock is acquired, and
</I>&gt;<i> another time it doesn't (to make matters worse, I have another method to
</I>&gt;<i> logs out and logs in again when I change my settings, and there,
</I>&gt;<i> loginLock.IsWriteLockHeld is false in StartLogin, but acquiring the lock
</I>&gt;<i> silently bombs the whole process (as before... nothing happens... the code
</I>&gt;<i> simply doesn't progress beyond loginLock.EnterWriteLock. If I replace
</I>&gt;<i> loginLock.EnterWriteLock with TryEnterWriteLock, then it returns false after
</I>&gt;<i> my timeout.
</I>&gt;<i> 
</I>&gt;<i> Have I picked another object that's only partially implemented?
</I>&gt;<i> 
</I>&gt;<i> Regards
</I>&gt;<i> Stephan
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/ReaderWriterLockSlim-fully-implemented-tp5711849.html">http://mono-for-android.1047100.n5.nabble.com/ReaderWriterLockSlim-fully-implemented-tp5711849.html</A>
</I>&gt;<i> Sent from the Mono for Android mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> 
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012326.html">[mono-android] ReaderWriterLockSlim - fully implemented?
</A></li>
	<LI>Next message: <A HREF="012344.html">[mono-android] ReaderWriterLockSlim - fully implemented?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12334">[ date ]</a>
              <a href="thread.html#12334">[ thread ]</a>
              <a href="subject.html#12334">[ subject ]</a>
              <a href="author.html#12334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
