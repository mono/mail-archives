<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] handling webservices with self-signed	certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20handling%20webservices%20with%20self-signed%0A%09certificates&In-Reply-To=%3C1365007705403-5713099.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013546.html">
   <LINK REL="Next"  HREF="013551.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] handling webservices with self-signed	certificates</H1>
    <B>Stephan Steiner</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20handling%20webservices%20with%20self-signed%0A%09certificates&In-Reply-To=%3C1365007705403-5713099.post%40n5.nabble.com%3E"
       TITLE="[mono-android] handling webservices with self-signed	certificates">stephan.steiner at gmail.com
       </A><BR>
    <I>Wed Apr  3 16:48:25 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="013546.html">[mono-android] handling webservices with self-signed	certificates
</A></li>
        <LI>Next message: <A HREF="013551.html">[mono-android] handling webservices with self-signed	certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13548">[ date ]</a>
              <a href="thread.html#13548">[ thread ]</a>
              <a href="subject.html#13548">[ subject ]</a>
              <a href="author.html#13548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hmm.. a short night's sleep seems to have changed the mood of my devices
somehow. Now they connect to <A HREF="https://www.google.com">https://www.google.com</A> with my code
(unchanged).

But it's still a nogo for my internal service. The internal service provides
an actual web interface (automated help provided by WCF), which is
accessible from the phone's browser (after the usual certificate warning),
so I suppose WCF services do something different in connection establishment
that mono cannot handle.

Since I cannot make the internal service publicly accessible, I wonder what
would help trace down the problem.

I went ahead installed mono 4 windows and created a simple program. After
the usual &quot;hey, this works with Microsoft.Net but won't even compile in
Xamarin Studio&quot; confusion, I came up with this (see end of mail). It works
if I run it with Microsoft.Net, and it throws a pretty similar error (see
very end of mail) running it with Mono, thus confirming that the problem
lies indeed with Mono's handling of the encrypted request.

I guess I have no choice but to write a repro server project (which has to
be run on windows running microsoft's .net runtime)

Regards
Stephan

public static void Main (string[] args)
		{
			Console.WriteLine (&quot;Hello World!&quot;);
			ServicePointManager.ServerCertificateValidationCallback +=
validatedCertificate;

			string address = @&quot;<A HREF="https://wsklo2059.ch.nextiraone-eu.ned:8090/IsAlive">https://wsklo2059.ch.nextiraone-eu.ned:8090/IsAlive</A>&quot;;
			Console.WriteLine(&quot;Sending request to &quot; + address);

			HttpWebRequest req = WebRequest.Create(new Uri(address)) as
HttpWebRequest;
			//req.Address = new Uri(address)
			//HttpWebRequest req = new HttpWebRequest(new Uri(address));
			WebResponse res = req.GetResponse();
			Console.WriteLine(&quot;Response received&quot;);

		}

		private static bool validatedCertificate(object sender, X509Certificate
certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
		{
			Console.WriteLine(&quot;validate cert called for &quot; + certificate.Subject);
			return true;
		}

And the error (validatedCertificate is never fired):

Unhandled Exception: System.Net.WebException: Error getting response stream
(Wri
te: BeginWrite failure): SendFailure ---&gt; System.IO.IOException: BeginWrite
fail
ure
  at System.Net.Sockets.NetworkStream.BeginWrite (System.Byte[] buffer,
Int32 of
fset, Int32 size, System.AsyncCallback callback, System.Object state)
[0x0007c]
in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\System\System.Net.S
ockets\NetworkStream.cs:258
  at Mono.Security.Protocol.Tls.RecordProtocol.BeginSendRecord (ContentType
cont
entType, System.Byte[] recordData, System.AsyncCallback callback,
System.Object
state) [0x00026] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\Mo
no.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:706
  at Mono.Security.Protocol.Tls.RecordProtocol.SendRecord (ContentType
contentTy
pe, System.Byte[] recordData) [0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\m
ono-2.10.9\mcs\class\Mono.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:
727
  at Mono.Security.Protocol.Tls.RecordProtocol.SendAlert
(Mono.Security.Protocol
.Tls.Alert alert) [0x00027] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\m
cs\class\Mono.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:625
  at Mono.Security.Protocol.Tls.RecordProtocol.SendAlert (AlertDescription
descr
iption) [0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\M
ono.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:596
  at Mono.Security.Protocol.Tls.SslStreamBase.AsyncHandshakeCallback
(IAsyncResu
lt asyncResult) [0x00037] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs
\class\Mono.Security\Mono.Security.Protocol.Tls\SslStreamBase.cs:104
  --- End of inner exception stack trace ---
  at System.Net.HttpWebRequest.EndGetResponse (IAsyncResult asyncResult)
[0x0006
c] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\System\System.Ne
t\HttpWebRequest.cs:831
  at System.Net.HttpWebRequest.GetResponse () [0x0000e] in
C:\cygwin\tmp\monobui
ld\build\BUILD\mono-2.10.9\mcs\class\System\System.Net\HttpWebRequest.cs:836
  at MonoHttpWebRequest.MainClass.Main (System.String[] args) [0x00000] in
&lt;file
name unknown&gt;:0
[ERROR] FATAL UNHANDLED EXCEPTION: System.Net.WebException: Error getting
respon
se stream (Write: BeginWrite failure): SendFailure ---&gt;
System.IO.IOException: B
eginWrite failure
  at System.Net.Sockets.NetworkStream.BeginWrite (System.Byte[] buffer,
Int32 of
fset, Int32 size, System.AsyncCallback callback, System.Object state)
[0x0007c]
in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\System\System.Net.S
ockets\NetworkStream.cs:258
  at Mono.Security.Protocol.Tls.RecordProtocol.BeginSendRecord (ContentType
cont
entType, System.Byte[] recordData, System.AsyncCallback callback,
System.Object
state) [0x00026] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\Mo
no.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:706
  at Mono.Security.Protocol.Tls.RecordProtocol.SendRecord (ContentType
contentTy
pe, System.Byte[] recordData) [0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\m
ono-2.10.9\mcs\class\Mono.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:
727
  at Mono.Security.Protocol.Tls.RecordProtocol.SendAlert
(Mono.Security.Protocol
.Tls.Alert alert) [0x00027] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\m
cs\class\Mono.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:625
  at Mono.Security.Protocol.Tls.RecordProtocol.SendAlert (AlertDescription
descr
iption) [0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\M
ono.Security\Mono.Security.Protocol.Tls\RecordProtocol.cs:596
  at Mono.Security.Protocol.Tls.SslStreamBase.AsyncHandshakeCallback
(IAsyncResu
lt asyncResult) [0x00037] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs
\class\Mono.Security\Mono.Security.Protocol.Tls\SslStreamBase.cs:104
  --- End of inner exception stack trace ---
  at System.Net.HttpWebRequest.EndGetResponse (IAsyncResult asyncResult)
[0x0006
c] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.10.9\mcs\class\System\System.Ne
t\HttpWebRequest.cs:831
  at System.Net.HttpWebRequest.GetResponse () [0x0000e] in
C:\cygwin\tmp\monobui
ld\build\BUILD\mono-2.10.9\mcs\class\System\System.Net\HttpWebRequest.cs:836
  at MonoHttpWebRequest.MainClass.Main (System.String[] args) [0x00000] in
&lt;file
name unknown&gt;:0



--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/handling-webservices-with-self-signed-certificates-tp5713085p5713099.html">http://mono-for-android.1047100.n5.nabble.com/handling-webservices-with-self-signed-certificates-tp5713085p5713099.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013546.html">[mono-android] handling webservices with self-signed	certificates
</A></li>
	<LI>Next message: <A HREF="013551.html">[mono-android] handling webservices with self-signed	certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13548">[ date ]</a>
              <a href="thread.html#13548">[ thread ]</a>
              <a href="subject.html#13548">[ subject ]</a>
              <a href="author.html#13548">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
