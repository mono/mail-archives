<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Using the new async code in the 4.7 branch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Using%20the%20new%20async%20code%20in%20the%204.7%20branch&In-Reply-To=%3C516DDD43.2030901%40all-the-johnsons.co.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013603.html">
   <LINK REL="Next"  HREF="013605.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Using the new async code in the 4.7 branch</H1>
    <B>Paul Johnson</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Using%20the%20new%20async%20code%20in%20the%204.7%20branch&In-Reply-To=%3C516DDD43.2030901%40all-the-johnsons.co.uk%3E"
       TITLE="[mono-android] Using the new async code in the 4.7 branch">paul at all-the-johnsons.co.uk
       </A><BR>
    <I>Tue Apr 16 23:22:43 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="013603.html">[mono-android] Setting Xam Studio so layouts are portrait
</A></li>
        <LI>Next message: <A HREF="013605.html">[mono-android] Using the new async code in the 4.7 branch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13604">[ date ]</a>
              <a href="thread.html#13604">[ thread ]</a>
              <a href="subject.html#13604">[ subject ]</a>
              <a href="author.html#13604">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've used async calls before now in a couple of different projects and 
wanted to see if the new async stuff in the 4.7 branch will make things 
simpler.

My old code looks like this
(in OnCreate)

Button login = FindViewById&lt;Button&gt; (Resource.Id.buttonSignIn);
login.Click += SignIn_Click;
MyEvents.UserSignIn_Completed += UserSignIn_Completed;

private void SignIn_Click(object src, EventArgs e)
{
	MyEvents.UserSignIn_Async (userId, userPwd);
}

private void UserSignIn_Completed (object sender, MyStuff_EventArgs_Bool e)
{
	string result = String.Format (&quot;Sign-in {0} successful&quot;, e.Result ? 
&quot;was&quot; : &quot;was NOT&quot;);
	try
	{
		if ( e.Success )
		{
			StartActivity(typeof(nextActivity);
		}
		else
		{
			result = String.Format (&quot;Something went wrong [{0}]&quot;, e.ErrorMessage);
		
			Console.WriteLine(&quot;Error message=&quot; + e.ErrorMessage);
		}
	}
	catch(Exception err)
	{
		Console.WriteLine(&quot;UserExists_Completed Exception:&quot; + err.Message);
	}
}

If I've read MSDN correctly, I should be able to transform that into 
something much simpler...

(in OnCreate)
login.Click += delegate
{
                 loginUser(username.Text, password.Text, mobile.Text);
};

private async void loginUser(string username, string password, string 
mobile)
{
       Task&lt;MyStuff_EventArgs_Bool&gt; getLoginTask = 
MyEvents.UserSignIn_Async(username, password);
       MyStuff_EventArgs_Bool e = await getLoginTask;
       if (e.Success)
       {
            StartActivity(typeof(FrontPage));
       } else
       {
            RunOnUiThread(() =&gt; GeneralUtils.Alert(context, 
Resource.String.errLoginTitle, e.ErrorMessage));
            return;
       }
}

The problem though is the UserSignIn_Async returns void and you can't 
have Task&lt;void&gt;. Changing the return type of the method to Task causes a 
problem at the caller line.

Can anyone point out what I've misinterpreted please as I'm pretty sure 
the new async code in Xam.Android will be much quicker than the old way 
and I'd rather be using that.

Paul
-- 
&quot;Space,&quot; it says, &quot;is big. Really big. You just won't believe how 
vastly, hugely, mindbogglingly big it is. I mean, you may think it's a 
long way down the road to the chemist's, but that's just peanuts to 
space, listen...&quot;
Hitch Hikers Guide to the Galaxy, a truly remarkable book!

</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013603.html">[mono-android] Setting Xam Studio so layouts are portrait
</A></li>
	<LI>Next message: <A HREF="013605.html">[mono-android] Using the new async code in the 4.7 branch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13604">[ date ]</a>
              <a href="thread.html#13604">[ thread ]</a>
              <a href="subject.html#13604">[ subject ]</a>
              <a href="author.html#13604">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
