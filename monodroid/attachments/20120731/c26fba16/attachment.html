<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:Calibri,&quot;Segoe&nbsp;UI&quot;,Meiryo,&quot;Microsoft&nbsp;YaHei&nbsp;UI&quot;,&quot;Microsoft&nbsp;JhengHei&nbsp;UI&quot;,&quot;Malgun&nbsp;Gothic&quot;,&quot;Khmer&nbsp;UI&quot;,&quot;Nirmala&nbsp;UI&quot;,Tunga,&quot;Lao&nbsp;UI&quot;,Ebrima,sans-serif;font-size:14.66px&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt;This&nbsp;seems&nbsp;to&nbsp;be&nbsp;vaguely&nbsp;related&nbsp;to&nbsp;one&nbsp;of&nbsp;my&nbsp;other&nbsp;projects&nbsp;(Android&nbsp;Play&nbsp;Expansions&nbsp;library).&nbsp;When&nbsp;using&nbsp;RemoteViews,&nbsp;the&nbsp;gref&nbsp;count&nbsp;went&nbsp;up&nbsp;like&nbsp;anything.&lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt; &lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt;Simply&nbsp;by&nbsp;doing ”expandedView.SetTextViewText”&nbsp;or&nbsp;“expandedView.SetViewVisibility”,&nbsp;where&nbsp;expandedView&nbsp;was&nbsp;a&nbsp;RemoteViews, caused&nbsp;the&nbsp;gref&nbsp;count&nbsp;to&nbsp;shoot&nbsp;up.&lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt;This&nbsp;was&nbsp;especially&nbsp;painful&nbsp;as&nbsp;this&nbsp;view&nbsp;was&nbsp;actually&nbsp;the&nbsp;download&nbsp;progress&nbsp;indicator&nbsp;on&nbsp;a&nbsp;notification.&nbsp;On&nbsp;slow&nbsp;connections&nbsp;the&nbsp;progress&nbsp;was&nbsp;reported&nbsp;far&nbsp;more&nbsp;times&nbsp;(smaller&nbsp;increments) and&nbsp;caused&nbsp;the&nbsp;device&nbsp;to&nbsp;run&nbsp;out&nbsp;of&nbsp;allocations.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt; &lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt;A&nbsp;work&nbsp;around&nbsp;was&nbsp;to&nbsp;try&nbsp;and&nbsp;only&nbsp;update&nbsp;the&nbsp;UI&nbsp;when&nbsp;there&nbsp;was&nbsp;a&nbsp;bigger&nbsp;increment.&nbsp;eg:&nbsp;10KB&nbsp;instead&nbsp;of&nbsp;every&nbsp;few&nbsp;bytes.&nbsp;Not&nbsp;too&nbsp;drastic,&nbsp;but&nbsp;it&nbsp;sometimes&nbsp;seems&nbsp;to&nbsp;allocate&nbsp;more&nbsp;than&nbsp;necessary?&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt; &lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt; &lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt;Matthew&lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt; &lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt; &lt;/div&gt;&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt;Sent&nbsp;from&nbsp;my&nbsp;&lt;a&nbsp;href=&quot;http://windows.microsoft.com/consumer-preview&quot;&gt;Windows&nbsp;8&nbsp;PC&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&nbsp;hide-outline&quot;&gt; &lt;/div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt; &lt;/div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;style=&quot;border-top-color:rgb(229,229,229);border-top-width:2px;border-top-style:solid&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;strong&gt;From:&lt;/strong&gt; Jonathan&nbsp;Pryor&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:jonp@xamarin.com&quot;&gt;jonp@xamarin.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;strong&gt;Sent:&lt;/strong&gt; 31&nbsp;July&nbsp;2012&nbsp;09:15:57&nbsp;PM&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;strong&gt;To:&lt;/strong&gt; Discussions&nbsp;related&nbsp;to&nbsp;Mono&nbsp;for&nbsp;Android&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:monodroid@lists.ximian.com&quot;&gt;monodroid@lists.ximian.com&lt;/a&gt;&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;strong&gt;Subject:&lt;/strong&gt; Re:&nbsp;[mono-android]&nbsp;How&nbsp;to&nbsp;handle&nbsp;garbage&nbsp;collection?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt; &lt;/div&gt;Which&nbsp;android&nbsp;version&nbsp;is&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Jul&nbsp;31,&nbsp;2012,&nbsp;at&nbsp;12:33&nbsp;PM,&nbsp;craig&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:craigrs84@gmail.com&quot;&gt;craigrs84@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;seems&nbsp;that&nbsp;there&nbsp;is&nbsp;some&nbsp;fundamental&nbsp;issue&nbsp;with&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;else&nbsp;some&nbsp;fundamental&nbsp;knowledge&nbsp;that&nbsp;I&nbsp;am&nbsp;lacking.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://docs.xamarin.com/android/advanced_topics/architecture&quot;&nbsp;target=&quot;_blank&quot;&gt;http://docs.xamarin.com/android/advanced_topics/architecture&lt;/a&gt;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://docs.xamarin.com/android/advanced_topics/garbage_collection&quot;&nbsp;target=&quot;_blank&quot;&gt;http://docs.xamarin.com/android/advanced_topics/garbage_collection&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;read&nbsp;the&nbsp;articles&nbsp;about&nbsp;Mono&nbsp;for&nbsp;Android&nbsp;GC&nbsp;on&nbsp;the&nbsp;support&nbsp;site&nbsp;but&nbsp;it&nbsp;didn&#39;t&nbsp;really&nbsp;help&nbsp;me&nbsp;to&nbsp;understand&nbsp;what&nbsp;is&nbsp;happening&nbsp;here.&lt;br&gt;<br>
&lt;br&gt;<br>
Let&#39;s&nbsp;try&nbsp;to&nbsp;clarify&nbsp;that.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Here&nbsp;is&nbsp;a&nbsp;very&nbsp;simplified&nbsp;version&nbsp;with&nbsp;source&nbsp;code&nbsp;that&nbsp;behaves&nbsp;the&nbsp;same&nbsp;way.&nbsp; Can&nbsp;you&nbsp;please&nbsp;take&nbsp;a&nbsp;look.&nbsp; Thanks.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;*Activity&nbsp;Code*&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://codeviewer.org/view/code:2890&quot;&nbsp;target=&quot;_blank&quot;&gt;http://codeviewer.org/view/code:2890&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;problem:&nbsp;as&nbsp;per&nbsp;the&nbsp;documentation,&nbsp;whenever&nbsp;you&nbsp;create&nbsp;a&nbsp;Java.Lang.Object&nbsp;subclass&nbsp;(e.g.&nbsp;TextView),&nbsp;you&nbsp;allocate&nbsp;a&nbsp;Java&nbsp;instance&nbsp;and&nbsp;a&nbsp;global&nbsp;reference&nbsp;(to&nbsp;associate&nbsp;the&nbsp;C#&nbsp;instance&nbsp;with&nbsp;the&nbsp;Java&nbsp;instance).&lt;br&gt;<br>
&lt;br&gt;<br>
Which&nbsp;brings&nbsp;us&nbsp;to:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;50;&nbsp;i++)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TextView&nbsp;v&nbsp;=&nbsp;new&nbsp;TextView(this);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;v.Text&nbsp;=&nbsp;(count&nbsp;*&nbsp;50&nbsp;+&nbsp;i).ToString();&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;layout.AddView(v);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;requires&nbsp;using&nbsp;50&nbsp;grefs&nbsp;(one&nbsp;per&nbsp;TextView).&nbsp;This&nbsp;is&nbsp;(in&nbsp;general)&nbsp;wasteful,&nbsp;as&nbsp;all&nbsp;50&nbsp;items&nbsp;won&#39;t&nbsp;be&nbsp;displayed&nbsp;at&nbsp;once;&nbsp;only&nbsp;~25&nbsp;will&nbsp;(depending&nbsp;in&nbsp;display&nbsp;size;&nbsp;I&nbsp;see&nbsp;25&nbsp;on&nbsp;my&nbsp;Galaxy&nbsp;Nexus,&nbsp;21&nbsp;on&nbsp;my&nbsp;API&nbsp;15&nbsp;emulator).&nbsp;Make&nbsp;the&nbsp;list&nbsp;longer&nbsp;and&nbsp;things&nbsp;only&nbsp;get&nbsp;worse:&nbsp;the&nbsp;number&nbsp;of&nbsp;items&nbsp;that&nbsp;can&nbsp;be&nbsp;displayed&nbsp;is&nbsp;fixed,&nbsp;while&nbsp;the&nbsp;number&nbsp;of&nbsp;items&nbsp;that&nbsp;can&nbsp;be&nbsp;in&nbsp;the&nbsp;list&nbsp;is&nbsp;variable.&nbsp;Requiring&nbsp;a&nbsp;gref&nbsp;for&nbsp;invisible&nbsp;items&nbsp;in&nbsp;the&nbsp;list&nbsp;is&nbsp;wasteful,&nbsp;and&nbsp;this&nbsp;is&nbsp;where&nbsp;BaseAdapter&nbsp;comes&nbsp;in.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
I&nbsp;found&nbsp;that&nbsp;adding&nbsp;an&nbsp;explicit&nbsp;GC.Collect()&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;Button.Click&nbsp;event&nbsp;handler&nbsp;caused&nbsp;the&nbsp;gref&nbsp;count&nbsp;to&nbsp;stabilize&nbsp;at&nbsp;61&nbsp;grefs.&nbsp;I&#39;m&nbsp;still&nbsp;not&nbsp;entirely&nbsp;sure&nbsp;how&nbsp;you&nbsp;got&nbsp;a&nbsp;2200+&nbsp;gref&nbsp;count&nbsp;on&nbsp;the&nbsp;emulator;&nbsp;that&#39;s&nbsp;puzzling.&nbsp;:-/&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
 -&nbsp;Jon&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Monodroid&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Monodroid@lists.ximian.com&quot;&gt;Monodroid@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
UNSUBSCRIBE&nbsp;INFORMATION:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/monodroid&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/monodroid&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>

</tt>
