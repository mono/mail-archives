<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Detecting and responding to image clicks in a	list view item.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Detecting%20and%20responding%20to%20image%20clicks%20in%20a%0A%09list%20view%20item.&In-Reply-To=%3CF9814535-6E46-4524-8DAA-02022E1D71DD%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011693.html">
   <LINK REL="Next"  HREF="011686.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Detecting and responding to image clicks in a	list view item.</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Detecting%20and%20responding%20to%20image%20clicks%20in%20a%0A%09list%20view%20item.&In-Reply-To=%3CF9814535-6E46-4524-8DAA-02022E1D71DD%40xamarin.com%3E"
       TITLE="[mono-android] Detecting and responding to image clicks in a	list view item.">jonp at xamarin.com
       </A><BR>
    <I>Wed Aug  8 00:16:01 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="011693.html">[mono-android] Detecting and responding to image clicks in a	list view item.
</A></li>
        <LI>Next message: <A HREF="011686.html">[mono-android]  Thread 0x0 may have been prematurely finalized
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11694">[ date ]</a>
              <a href="thread.html#11694">[ thread ]</a>
              <a href="subject.html#11694">[ subject ]</a>
              <a href="author.html#11694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 7, 2012, at 7:08 PM, Steven Pack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">steven_john_pack at yahoo.com.au</A>&gt; wrote:
&gt;<i> OK, last thing. When I delete the item, I want the listview to update and NOT scroll to the top. Recreating the adapter with the now updated list updates the view, but scrolls to the top (and is inefficient). All the SO articles and docco say to use ArrayAdapter&lt;T&gt;.NotifyDataSetChanged(). I find that method doesn't work as I expect though:
</I>&gt;<i> 
</I>&gt;<i> I can do along the lines of (sorry not on the coding computer):
</I>&gt;<i> 
</I>&gt;<i> lvHeadwords.Adapter = new MyCustomAdapterHeadwords(Headwords); //which inherits ArrayAdapter&lt;T&gt;
</I>&gt;<i> 
</I>&gt;<i> //Then in response to a delete click....
</I>&gt;<i> Headwords.RemoveAt(position)
</I>&gt;<i> (((MyCustomAdapterHeadwords)lvHeadwords.Adapter).NotifyDataSetChanged();
</I>&gt;<i> Assert.AreEqual(lvHeadwords.Adapter.Count, Headwords.Count); //Boom, they're not.... and the UI hasn't updated
</I>&gt;<i> 
</I>&gt;<i> That's supposed to work right?
</I>
In theory, yes. For you, apparently not. ;-)

Without a test case, all I can do is guess; I just have lots of guesses. :-)

In this case, here's what I know: the Java ArrayAdapter type has it's own List:

	<A HREF="https://github.com/android/platform_frameworks_base/blob/master/core/java/android/widget/ArrayAdapter.java#L48">https://github.com/android/platform_frameworks_base/blob/master/core/java/android/widget/ArrayAdapter.java#L48</A>

Specifically, ArrayAdapter.add(), ArrayAdapter.insert(), and (most importantly) ArrayAdapter.getCount() all use this internal list.

AdapterView, meanwhile, uses ArrayAdapter.getCount() to tell if anything has changed (search for getCount() and getItem()):

	<A HREF="https://github.com/android/platform_frameworks_base/blob/master/core/java/android/widget/AdapterView.java">https://github.com/android/platform_frameworks_base/blob/master/core/java/android/widget/AdapterView.java</A>

_Your_ adapter, however, doesn't override the Count property (see ListActivityRowArrayAdapter):

	<A HREF="http://lists.ximian.com/pipermail/monodroid/2012-August/011679.html">http://lists.ximian.com/pipermail/monodroid/2012-August/011679.html</A>

Result: Sure, you've modified _your_ list, but Android (1) doesn't see a change in count, and (2) doesn't see your new values.

There are three possible solutions that I see:

(1) Don't inherit ArrayAdapter&lt;T&gt;, inherit from BaseAdapter&lt;T&gt;. This will force you to implement the full abstraction, specifically the Count property, GetItem() method (i.e. the indexer), and the GetItemId() methods.

(2) Override the other ArrayAdapter&lt;T&gt; methods so that Android uses _your_ state, not the &quot;duplicate&quot; Java state. At minimum you'd need to override the Count property, you might want to consider overriding the HasStableIds and IsEmpty properties, and if you expect/require Java to call your Add() method, you'll need to override Add()/AddAll()/Insert()/etc. as well.

I suspect all you'll really need to do is override the Count property, though (1) would be better imho.

(3) Move your collection into Java, by using ArrayAdapter&lt;T&gt;.Add()/etc. instead of using a List&lt;Headword&gt; member. This isn't ideal, as each member you add will take out a gref (ouch).

 - Jon

</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011693.html">[mono-android] Detecting and responding to image clicks in a	list view item.
</A></li>
	<LI>Next message: <A HREF="011686.html">[mono-android]  Thread 0x0 may have been prematurely finalized
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11694">[ date ]</a>
              <a href="thread.html#11694">[ thread ]</a>
              <a href="subject.html#11694">[ subject ]</a>
              <a href="author.html#11694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
