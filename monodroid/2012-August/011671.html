<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] sqlite optimisation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20sqlite%20optimisation&In-Reply-To=%3CD7288FB06853A94A97C1246F644875300FFE2195%40exchange.kumulus.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011751.html">
   <LINK REL="Next"  HREF="011672.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] sqlite optimisation</H1>
    <B>Miha Markic</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20sqlite%20optimisation&In-Reply-To=%3CD7288FB06853A94A97C1246F644875300FFE2195%40exchange.kumulus.local%3E"
       TITLE="[mono-android] sqlite optimisation">Miha at rthand.com
       </A><BR>
    <I>Mon Aug  6 08:51:12 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="011751.html">[mono-android] sqlite optimisation
</A></li>
        <LI>Next message: <A HREF="011672.html">[mono-android] sqlite optimisation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11671">[ date ]</a>
              <a href="thread.html#11671">[ thread ]</a>
              <a href="subject.html#11671">[ subject ]</a>
              <a href="author.html#11671">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>FYI better if you put it into try/catch or using block, i.e.:
using (SqliteTransaction trans = connection.BeginTransaction())
{
...
 trans.Commit();
}

If Commit isn't called then Dispose will rollback.
Anyway, for real speed improvement try DbDataAdapter thing.

Miha

From: John Murray [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">john at murray.gb.com</A>]
Sent: Monday, August 06, 2012 10:48 AM
To: Miha Markic; <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>
Subject: RE: [mono-android] sqlite optimisation

Whoa - brilliant Miha - you have inadvertently given me the answer
Instead of just putting in
connection.BeginTransaction();
I need to create a var to hold the instance and then use that instance to commit after the loop thus
                                Var   thisinstance = connection.BeginTransaction();
                for (int go = 0; go &lt; selstr2.Count; go++)
                   {
                        //cc2 is the connection.command
                      cc2.CommandText = selstr2[go];   //array selstr contains insert statements
                      cc2.ExecuteNonQuery();
                   }
              thisinstance.Commit();


This delivers a significant speed improvement over the previous where it was committing each round of the loop.  I had tried all flavours of commit until you mentioned that the begintransation()  instance had a commit method
The above works beautifully
Thanks
John Murray




From: Miha Markic [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Miha at rthand.com</A>]&lt;mailto:[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Miha at rthand.com</A>]&gt;
Sent: 05 August 2012 14:01
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">john at murray.gb.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">john at murray.gb.com</A>&gt;; Discussions related to Mono for Android
Subject: RE: [mono-android] sqlite optimisation

Hi John,

BeginTransaction() returns you a SqliteTransaction instance which has both Commit() and Rollback() methods.
However, I doubt that transaction will speed up inserts. Instead, you might take a look at UpdateBatchSize property of the DbDataAdapter class.
<A HREF="http://msdn.microsoft.com/en-us/library/aadf8fk2.aspx">http://msdn.microsoft.com/en-us/library/aadf8fk2.aspx</A>
I suppose it works as well in M4A.

HTH,
Miha

From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>&gt; [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of John Murray
Sent: Sunday, August 05, 2012 1:13 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>&gt;
Subject: [mono-android] sqlite optimisation

I am using sqlite in monodroid - I am doing a bulk insert from an external source
I have read there is no inbuilt way of importing a whole xml file into the sqlite database
But one can optimise a loop which inserts line by line by using connection.BeginTransation()
Which is supposed to delay the commit until the loop is over then use setTransationSuccessful()
However in the monodroid library mono.data.sqlite.dll does not seem to contain the 'setTransactionSuccessful' method
Nor themethod endTransation())
Given the insert loop below can anyone tell me if I am barking up the wrong tree trying to stall the committing of inserts in this way?  Is there any other way to speed up a large insert loop like this?
If there is a method in Mono.Data.Sqlite for 'begintransaction()' where is the obverse 'endtransation' or 'settransationsuccessful()'
As you can see from code below I have also tried various forms of commit.
//==================================
// connection.BeginTransaction();
// connection is a straightforward sqlite connection the above code line is available in monodroid
// however without some commit or endtransation nothing gets written to the database
                for (int go = 0; go &lt; selstr2.Count; go++)
                   {

                        //cc2 is the connection.command
                      cc2.CommandText = selstr2[go];   //array selstr contains insert statements
                      cc2.ExecuteNonQuery();
                   }
               //connection.setTransationSuccessful();
               //cc2.Transaction.Commit();
     connection.Close();
//===========================================

I'd be grateful for any help at all -
John Murray



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/attachments/20120806/85358a1f/attachment.html">http://lists.ximian.com/pipermail/monodroid/attachments/20120806/85358a1f/attachment.html</A>&gt;
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011751.html">[mono-android] sqlite optimisation
</A></li>
	<LI>Next message: <A HREF="011672.html">[mono-android] sqlite optimisation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11671">[ date ]</a>
              <a href="thread.html#11671">[ thread ]</a>
              <a href="subject.html#11671">[ subject ]</a>
              <a href="author.html#11671">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
