<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] How to add a precompiled,	3rd party dll library to a mono droid (or mono touch) project?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20How%20to%20add%20a%20precompiled%2C%0A%093rd%20party%20dll%20library%20to%20a%20mono%20droid%20%28or%20mono%20touch%29%20project%3F&In-Reply-To=%3C6E5F6891-6159-4726-97C6-7D0041F40FE3%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011800.html">
   <LINK REL="Next"  HREF="011813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] How to add a precompiled,	3rd party dll library to a mono droid (or mono touch) project?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20How%20to%20add%20a%20precompiled%2C%0A%093rd%20party%20dll%20library%20to%20a%20mono%20droid%20%28or%20mono%20touch%29%20project%3F&In-Reply-To=%3C6E5F6891-6159-4726-97C6-7D0041F40FE3%40xamarin.com%3E"
       TITLE="[mono-android] How to add a precompiled,	3rd party dll library to a mono droid (or mono touch) project?">jonp at xamarin.com
       </A><BR>
    <I>Tue Aug 14 16:44:01 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="011800.html">[mono-android] How to add a precompiled, 3rd party dll library to a mono droid (or mono touch) project?
</A></li>
        <LI>Next message: <A HREF="011813.html">[mono-android] How to add a precompiled, 3rd party dll library to a mono droid (or mono touch) project?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11804">[ date ]</a>
              <a href="thread.html#11804">[ thread ]</a>
              <a href="subject.html#11804">[ subject ]</a>
              <a href="author.html#11804">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 14, 2012, at 9:15 AM, antoniolopes &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">lopes_manteigas at hotmail.com</A>&gt; wrote:
&gt;<i> We want to add  <A HREF="http://opencv.willowgarage.com/wiki/">http://opencv.willowgarage.com/wiki/</A> OpenCV  features in Mono for Android as we use them already in our app (using a wrapper of OpenCV to java called  <A HREF="https://code.google.com/p/javacv/">https://code.google.com/p/javacv/</A> JavaCV  - OpenCV is a c++ library). 
</I>&gt;<i> 
</I>&gt;<i> The wrapper that we want to use for our Mono for Android project is <A HREF="https://code.google.com/p/opencvsharp/">https://code.google.com/p/opencvsharp/</A> OpenCvSharp . This wrapper is written in C# and compiles and run on Unix Environment just adding the precompiled .dll references to the MonoDevelop project.
</I>
One problem will be the license: OpenCV# appears to be LGPL, which requires that you be able to update the LGPL library separately from your app. This isn't possible for Mono for Android apps, as the assemblies are embedded into the .apk and the .apk is signed to prevent modification. (As always, I'm not a lawyer, this is not legal advice, yadda yadda yadda, but I don't see how you can square this circle.)

Glancing through the opencvsharp sources, other potential problems include:

* Use of System.Drawing.dll: Mono for Android does not provide System.Drawing.dll, so any types/members that require it will need to be #if'd out, e.g. OpenCvSharp.IplImage.FromBitmap().

* Use of System.Windows.Forms.dll: Mono or Android does not provide System.Windows.Forms.dll, so any types/members that require it will need to be #if'd out, e.g. OpenCvSharp.Utilities.PInvokeHelper.DllImportError() (which uses MessageBox.Show()).

* OpenCvSharp is a DllImport wrapper over numerous native libraries such as opencv_core240 and opencv_imgproc240. You will need to recompile all of these libraries as armeabi(-v7a?) ELF shared libraries for use in your app. This in turn requires using the Android NDK, unless someone is already building &amp; distributing Android builds of these libraries...

&gt;<i> Being a noob in C# i would have thought that adding the reference dll in the Mono for Android project would do the trick but apparently it does not.
</I>
Mono for Android is a distinct &quot;profile,&quot; with an incompatible set of assemblies from regular .NET. Just as you can't use desktop .NET assemblies with .NET Compact Framework or Silverlight 3.0 (and 4.0 is iffy), you cannot use desktop .NET assemblies as-is with Mono for Android. You need to recompile your sources against the Mono for Android profile assemblies.

An easy way to do this is to take e.g. OpenCvSharp\OpenCvSharp.csproj and replace the line:

	&lt;Import Project=&quot;$(MSBuildToolsPath)\Microsoft.CSharp.targets&quot; /&gt; 

with:

	&lt;Import Project=&quot;$(MSBuildExtensionsPath)\Novell\Novell.MonoDroid.CSharp.targets&quot; /&gt;

Then modify &lt;TargetFrameworkVersion/&gt; to match the Android API level you wish to target, or delete the element entirely to target the default API level of 8.

Then, build:

	cd Path\To\OpenCvSharp
	msbuild

Shockingly (to me), with the above 2 changes OpenCvSharp.dll builds for me. Unfortunately the build is wrong [0], as it contains references to System.Windows.Forms.dll and System.Drawing.dll, neither of which are usable within a Mono for Android app. Edit the OpenCvSharp.csproj again, and remove the following elements:

	&lt;Reference Include=&quot;System.Drawing&quot; /&gt;
	&lt;Reference Include=&quot;System.Windows.Forms&quot; /&gt;

Rebuild, and I get 18 errors that need to be fixed before the assembly can even begin to be usable with Mono for Android.

Once fixed, &quot;all&quot; you'll need to do is reference your new OpenCvSharp.dll in your Mono for Android application project, then add the required native libraries (Build action: AndroidNativeLibrary) to the project and things will (hopefully) Just Work.

 - Jon

[0] $ monodis --assemblyref bin/Debug/OpenCvSharp.dll
AssemblyRef Table
1: Version=2.0.5.0
	Name=mscorlib
	Flags=0x00000000
	Public Key:
0x00000000: 7C EC 85 D7 BE A7 79 8E 
2: Version=2.0.5.0
	Name=System
	Flags=0x00000000
	Public Key:
0x00000000: 7C EC 85 D7 BE A7 79 8E 
3: Version=4.0.0.0
	Name=System.Windows.Forms
	Flags=0x00000000
	Public Key:
0x00000000: B7 7A 5C 56 19 34 E0 89 
4: Version=4.0.0.0
	Name=System.Drawing
	Flags=0x00000000
	Public Key:
0x00000000: B0 3F 5F 7F 11 D5 0A 3A 

</PRE>






































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011800.html">[mono-android] How to add a precompiled, 3rd party dll library to a mono droid (or mono touch) project?
</A></li>
	<LI>Next message: <A HREF="011813.html">[mono-android] How to add a precompiled, 3rd party dll library to a mono droid (or mono touch) project?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11804">[ date ]</a>
              <a href="thread.html#11804">[ thread ]</a>
              <a href="subject.html#11804">[ subject ]</a>
              <a href="author.html#11804">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
