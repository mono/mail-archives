<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Detecting and responding to image clicks in a list	view item.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Detecting%20and%20responding%20to%20image%20clicks%20in%20a%20list%0A%09view%20item.&In-Reply-To=%3C1344321563.95556.YahooMailNeo%40web120203.mail.ne1.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011701.html">
   <LINK REL="Next"  HREF="011752.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Detecting and responding to image clicks in a list	view item.</H1>
    <B>Steven Pack</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Detecting%20and%20responding%20to%20image%20clicks%20in%20a%20list%0A%09view%20item.&In-Reply-To=%3C1344321563.95556.YahooMailNeo%40web120203.mail.ne1.yahoo.com%3E"
       TITLE="[mono-android] Detecting and responding to image clicks in a list	view item.">steven_john_pack at yahoo.com.au
       </A><BR>
    <I>Tue Aug  7 06:39:23 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="011701.html">[mono-android] only calling code in spinner.ItemSelected handler from user input
</A></li>
        <LI>Next message: <A HREF="011752.html">[mono-android] Detecting and responding to image clicks in a list view item.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11679">[ date ]</a>
              <a href="thread.html#11679">[ thread ]</a>
              <a href="subject.html#11679">[ subject ]</a>
              <a href="author.html#11679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Hi all, long time no post.

I have a listview. and the items are defined as a textview with a cross image over on the right. Like this:

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;<A HREF="http://schemas.android.com/apk/res/android">http://schemas.android.com/apk/res/android</A>&quot;
&#160;&#160;&#160; android:orientation=&quot;horizontal&quot;
&#160;&#160;&#160; android:layout_width=&quot;fill_parent&quot;
&#160;&#160;&#160; android:layout_height=&quot;wrap_content&quot;&gt;
&#160;&#160;&#160; &lt;TextView
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:id=&quot;@+id/headword_textview&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:layout_gravity=&quot;fill_horizontal&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:layout_weight=&quot;1&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:layout_width=&quot;wrap_content&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:layout_height=&quot;fill_parent&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:padding=&quot;5dp&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:textColor=&quot;@android:color/black&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:textSize=&quot;16sp&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:contentDescription=&quot;Bookmark&quot; /&gt;
&#160;&#160;&#160; &lt;ImageView
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:id=&quot;@+id/delete_headword_list_item_button&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:layout_width=&quot;wrap_content&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:layout_height=&quot;wrap_content&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:padding=&quot;10dp&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:src=&quot;@drawable/clear&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:layout_gravity=&quot;center_vertical&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; android:contentDescription=&quot;Delete bookmark button&quot; /&gt;
&lt;/LinearLayout&gt;

The little cross is an image, and on clicking it, I'd like to delete the corresponding item from the list. My problem is detecting the image click. Or, more specifically, attaching and detaching the event handlers and getting the position right. My code works fine when there is only a single screen, but as I soon as the
 list is longer than a screen, and GetView keeps getting called, the event handler keeps getting re-attached, and then the positions don't match the index in the list.

Populating the listview is like this:

var adapter = new ListActivityRowArrayAdapter&lt;Headword&gt; (Registry.CustomTypeface, Registry.Settings.TextSize, this, Resource.Layout.headword_list_item, Resource.Id.headword_textview, Headwords);
lvHeadwords.Adapter = adapter;

The custom adapter, in which I customise the textview using some funky fonts and attach the event handler is like such:

public class ListActivityRowArrayAdapter&lt;T&gt; : ArrayAdapter&lt;T&gt;
&#160;&#160;&#160; &#160;&#160;&#160; {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; Typeface _typeface;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; float _textSize;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; HeadwordListActivityBase _activity;

&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; public ListActivityRowArrayAdapter (Typeface typeface, float textSize, HeadwordListActivityBase context, int resourceId, int textViewResourceId, ICollection&lt;T&gt; objects) 
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; : base (context, resourceId, textViewResourceId, objects.ToArray())
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; _activity = context;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; _typeface = typeface;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; _textSize = textSize;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; }

&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; public override View GetView (int position, View convertView, ViewGroup parent)
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; View row = base.GetView (position, convertView, parent);&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; 

&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; var textView = row.FindViewById(Resource.Id.headword_textview) as TextView;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; if (textView != null &amp;&amp; (textView.Typeface != _typeface || textView.TextSize != _textSize))
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; textView.SetTypeface (_typeface, 0);
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; textView.TextSize = _textSize;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; }

&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; var deleteImage = row.FindViewById(Resource.Id.delete_headword_list_item_button);
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; if (deleteImage != null)
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; _log.Debug(Tag, &quot;Attaching handler. Position is:&quot; + position);
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; deleteImage.Click += (sender, e) =&gt; _activity.DeleteItem(position);
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; }
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; return row;
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; }
&#160;&#160;&#160; &#160;&#160;&#160; }
&#160;&#160;&#160; }

and deleting the item:

void DeleteItem(int position)
&#160;&#160;&#160; &#160;&#160;&#160; {
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; _log.Debug(Tag, &quot;Deleting from position: &quot; + position);

&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; var item = Headwords[position];
&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; Headwords.Remove(item);

&#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; RefreshListView();
&#160;&#160;&#160; &#160;&#160;&#160; }


The DeleteItem method throws IndexOutOfRangeExceptions, firstly because it gets called multiple times and also because the position index doesn't actually represent the real index in the list somehow.

Any pointers would be appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/attachments/20120806/ffcec604/attachment-0001.html">http://lists.ximian.com/pipermail/monodroid/attachments/20120806/ffcec604/attachment-0001.html</A>&gt;
</PRE>














































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011701.html">[mono-android] only calling code in spinner.ItemSelected handler from user input
</A></li>
	<LI>Next message: <A HREF="011752.html">[mono-android] Detecting and responding to image clicks in a list view item.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11679">[ date ]</a>
              <a href="thread.html#11679">[ thread ]</a>
              <a href="subject.html#11679">[ subject ]</a>
              <a href="author.html#11679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
