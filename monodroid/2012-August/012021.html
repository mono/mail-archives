<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Object Reference not set... after GC_EXPLICIT on	bound object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Object%20Reference%20not%20set...%20after%20GC_EXPLICIT%20on%0A%09bound%20object&In-Reply-To=%3C18919CFC-4E64-4C84-8885-0AEA422D6190%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012018.html">
   <LINK REL="Next"  HREF="012023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Object Reference not set... after GC_EXPLICIT on	bound object</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Object%20Reference%20not%20set...%20after%20GC_EXPLICIT%20on%0A%09bound%20object&In-Reply-To=%3C18919CFC-4E64-4C84-8885-0AEA422D6190%40xamarin.com%3E"
       TITLE="[mono-android] Object Reference not set... after GC_EXPLICIT on	bound object">jonp at xamarin.com
       </A><BR>
    <I>Fri Aug 24 15:37:15 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="012018.html">[mono-android] Object Reference not set... after GC_EXPLICIT on	bound object
</A></li>
        <LI>Next message: <A HREF="012023.html">[mono-android] Object Reference not set... after GC_EXPLICIT on	bound object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12021">[ date ]</a>
              <a href="thread.html#12021">[ thread ]</a>
              <a href="subject.html#12021">[ subject ]</a>
              <a href="author.html#12021">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 24, 2012, at 11:03 AM, James Lavery &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">james at microsec.co.uk</A>&gt; wrote:
&gt;<i> ResultSetConnection does /not/ subclass Java.Lang.Object. It is a plain C# object.
</I>
A plain C# object with a finalizer [0]. You must be VERY CAREFUL when implementing finalizers:

	<A HREF="http://msdn.microsoft.com/en-us/library/b1yfkh5e(VS.100">http://msdn.microsoft.com/en-us/library/b1yfkh5e(VS.100</A>).aspx#sectionToggle1
&gt;<i> 	&#8226; An object's Finalize method should free any external resources that the object owns. Moreover, a Finalize method should release only resources that the object has held onto. The Finalize method should not reference any other objects.
</I>
Emphasis on &quot;external,&quot; which you should read as &quot;unmanaged types.&quot; ResultSet, PreparedStatement, etc. are managed types, and thus their lifetime is controlled by the GC. Also note the last sentence, &quot;The Finalize method should not reference any other objects.&quot;

FINALIZERS MUST NOT USE GC-CONTROLLED INSTANCES.

There is no ordering between finalizer invocation of instances [1]. Consequently, there is NO WAY to ensure that your ResultSetConnection instance is finalized _before_ the held e.g. ResultSet instance. What's probably happening to you is that the ResultSet instance is being finalized before your ResultSetConnection instance, and thus has it's Handle cleared out, so when you later attempt to call Close(), you're calling it on an invalid instance.

Again, Don't Do That&#8482;. In general, you should avoid finalizers, period, unless you really, _really_ can't avoid them.

 - Jon

[0] It's a &quot;finalizer&quot;, not a &quot;destructor&quot;: <A HREF="http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-334.pdf">http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-334.pdf</A> &#167;17.12:

&gt;<i> [Note: In the previous version of this standard, what is now referred to as a &quot;finalizer&quot; was called a &quot;destructor&quot;. Experience has shown that the term &quot;destructor&quot; caused confusion and often resulted to incorrect expectations, especially to programmers knowing C++. In C++, a destructor is called in a determinate manner, whereas, in C#, a finalizer is not. To get determinate behavior from C#, one should use Dispose. end note]
</I>
[1] OK, there is _a_ way to ensure some form of finalizer ordering by using CriticalFinalizerObject [2]. However, this only provides a loose ordering between &quot;normal&quot; finalizable instances and critical finalizable instances -- the critical ones are finalized _after_ the normal ones -- but it does nothing about ordering between instances within the same &quot;category.&quot;

This is still irrelevant, though, as Mono doesn't implement the &quot;delayed&quot; finalizer semantics for CriticalFinalizerObject.

[2] <A HREF="http://msdn.microsoft.com/en-us/library/system.runtime.constrainedexecution.criticalfinalizerobject.aspx">http://msdn.microsoft.com/en-us/library/system.runtime.constrainedexecution.criticalfinalizerobject.aspx</A>

</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012018.html">[mono-android] Object Reference not set... after GC_EXPLICIT on	bound object
</A></li>
	<LI>Next message: <A HREF="012023.html">[mono-android] Object Reference not set... after GC_EXPLICIT on	bound object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12021">[ date ]</a>
              <a href="thread.html#12021">[ thread ]</a>
              <a href="subject.html#12021">[ subject ]</a>
              <a href="author.html#12021">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
