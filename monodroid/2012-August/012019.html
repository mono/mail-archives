<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Unsafe code support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Unsafe%20code%20support&In-Reply-To=%3C577ECCAE-5E3C-4A21-B719-92D3873CB5A9%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012009.html">
   <LINK REL="Next"  HREF="012056.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Unsafe code support</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Unsafe%20code%20support&In-Reply-To=%3C577ECCAE-5E3C-4A21-B719-92D3873CB5A9%40xamarin.com%3E"
       TITLE="[mono-android] Unsafe code support">jonp at xamarin.com
       </A><BR>
    <I>Fri Aug 24 15:11:39 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="012009.html">[mono-android] Unsafe code support
</A></li>
        <LI>Next message: <A HREF="012056.html">[mono-android] Unsafe code support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12019">[ date ]</a>
              <a href="thread.html#12019">[ thread ]</a>
              <a href="subject.html#12019">[ subject ]</a>
              <a href="author.html#12019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 24, 2012, at 3:51 AM, Miljenko Cvjetko &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">mcvjetko at holisticware.net</A>&gt; wrote:
&gt;<i> If we look into
</I>&gt;<i> <A HREF="https://github.com/mono/mono/blob/master/mcs/class/System/System.Net.Sockets/Socket.cs">https://github.com/mono/mono/blob/master/mcs/class/System/System.Net.Sockets/Socket.cs</A>
</I>
Wrong branch; Mono for Android is based on Mono 2.10, not master:

	<A HREF="https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/System.Net.Sockets/Socket.cs">https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/System.Net.Sockets/Socket.cs</A>

I'm still not sure why line 1446 is still wrong, but it does show us what the issue is; he's calling:

	IOControl(IOControlCode.KeepAliveValues, tcpKeepAlive.ToArray(), null);

Which means he's calling the IOControl(IOControlCode, byte[], byte[]) overload:

	<A HREF="https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/System.Net.Sockets/Socket.cs#L1461">https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/System.Net.Sockets/Socket.cs#L1461</A>

This overload does nothing, and simply throws NotImplementedException, which is what he's seeing. Oops.

The fix is to do what master does: call the IOControl(int, byte[], byte[]) overload, which is implemented:

	IOControl ((int) IOControlCode.KeepAliveValues, tcpKeepAlive.ToArray(), null);

&gt;<i> No we can wonder if that is because MA is superset of Silverlight/Moonlight and Silverlight introduced sockets in v 4 as far as I can remember and probably has some restrictions. So the mono team decided to follow those restrictions what if hard to believe...
</I>
For future &quot;research&quot; purposes, when trying to determine which code is present in Mono for Android, you'll need to know:

1. The correct branch, in this case the mono-2-10 branch. (We'll eventually rebase atop 2.12, once that's out + ~6 months...)

2. Which files are included for a given assembly, which are listed in the mcs/class/ASSEMBLY/monodroid_ASSEMBLY.dll.sources file:

	<A HREF="https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/monodroid_System.dll.sources">https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/monodroid_System.dll.sources</A>

Note that csc has an extension to #include the contents of other files, so for System.dll we also need:

	<A HREF="https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/mobile_System.dll.sources">https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/mobile_System.dll.sources</A>

3. Which #defines are set, generally NET_2_0, NET_2_1, MOBILE, and MONODROID. Based on that we can see that the Socket(SocketInformation) constructor won't be provided:

	<A HREF="https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/System.Net.Sockets/Socket.cs#L184">https://github.com/mono/mono/blob/mono-2-10/mcs/class/System/System.Net.Sockets/Socket.cs#L184</A>

 - Jon

</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012009.html">[mono-android] Unsafe code support
</A></li>
	<LI>Next message: <A HREF="012056.html">[mono-android] Unsafe code support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12019">[ date ]</a>
              <a href="thread.html#12019">[ thread ]</a>
              <a href="subject.html#12019">[ subject ]</a>
              <a href="author.html#12019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
