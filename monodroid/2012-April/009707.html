<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] msbuild crash in ResolveLibraryProjectImports task in MFA v4.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20msbuild%20crash%20in%20ResolveLibraryProjectImports%0A%20task%20in%20MFA%20v4.1&In-Reply-To=%3C4F86B684.5080601%40veritas-vos-liberabit.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009706.html">
   <LINK REL="Next"  HREF="009709.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] msbuild crash in ResolveLibraryProjectImports task in MFA v4.1</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20msbuild%20crash%20in%20ResolveLibraryProjectImports%0A%20task%20in%20MFA%20v4.1&In-Reply-To=%3C4F86B684.5080601%40veritas-vos-liberabit.com%3E"
       TITLE="[mono-android] msbuild crash in ResolveLibraryProjectImports task in MFA v4.1">atsushieno at veritas-vos-liberabit.com
       </A><BR>
    <I>Thu Apr 12 11:03:32 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009706.html">[mono-android] msbuild crash in ResolveLibraryProjectImports task	in MFA v4.1
</A></li>
        <LI>Next message: <A HREF="009709.html">[mono-android] msbuild crash in ResolveLibraryProjectImports	task in MFA v4.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9707">[ date ]</a>
              <a href="thread.html#9707">[ thread ]</a>
              <a href="subject.html#9707">[ subject ]</a>
              <a href="author.html#9707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I think this is rather about general assembly resolution issue in this 
task, as it is designed to handle HintPath optionally (the task happened 
to work for you once you supplied it). I'll take care of it anyways.

It would be great if you can provide a reproducible project for us :)

Thanks for the feedback.

Atsushi Eno

mcleodia wrote:
&gt;<i> Hi guys
</I>&gt;<i>
</I>&gt;<i> I think I may have found a corner case in your build system.
</I>&gt;<i>
</I>&gt;<i> I have an scons based build system that dynamically outputs msbuild files
</I>&gt;<i> based on project dependencies and then fires them at msbuild to do its
</I>&gt;<i> magic.
</I>&gt;<i>
</I>&gt;<i> Since updating to the v4.1 alpha, I get a crash when trying to build an app
</I>&gt;<i> (build output below).
</I>&gt;<i>
</I>&gt;<i> I think this is because some of my project references are resolved using a
</I>&gt;<i> modified AssemblySearchPaths variable rather than a project reference, which
</I>&gt;<i> is probably what ResolveLibraryProjectImports is expecting.
</I>&gt;<i> In this case, OssToolkitDroid.dll is in fact built to
</I>&gt;<i> Z:\oss\Main\install\Android\release\lib\Linn, not
</I>&gt;<i> Z:\oss\Main\build\Android\release\Topology which is where the msbuild file
</I>&gt;<i> that fails is run from.
</I>&gt;<i>
</I>&gt;<i> Slightly unusual scenario, to be fair, as I'd imagine most projects out
</I>&gt;<i> there would use project references or manually add a reference in visual
</I>&gt;<i> studio and thus specify a hint path for the reference in the csproj file.
</I>&gt;<i> Injecting a hintpath for that reference does in fact fix the problem, albeit
</I>&gt;<i> at the cost of adding complexity to our build files.
</I>&gt;<i>
</I>&gt;<i> However, I believe that extending AssemblySearchPaths is a valid way of
</I>&gt;<i> referencing assemblies and therefore the task should support this way of
</I>&gt;<i> doing things too.
</I>&gt;<i>
</I>&gt;<i> What are your thoughts?
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Iain
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Snippet of msbuild file:
</I>&gt;<i>
</I>&gt;<i> &lt;Import
</I>&gt;<i> Project=&quot;$(MSBuildExtensionsPath)\Novell\Novell.MonoDroid.CSharp.targets&quot; /&gt;
</I>&gt;<i> &lt;Target Name=&quot;BeforeResolveReferences&quot;&gt;
</I>&gt;<i>      &lt;CreateProperty
</I>&gt;<i> Value=&quot;Z:\oss\Main\install\Android\release\lib\Linn;Z:\oss\Main\install\Android\release\lib;$(AssemblySearchPaths)&quot;&gt;
</I>&gt;<i>          &lt;Output TaskParameter=&quot;Value&quot; PropertyName=&quot;AssemblySearchPaths&quot; /&gt;
</I>&gt;<i>      &lt;/CreateProperty&gt;
</I>&gt;<i> &lt;/Target&gt;
</I>&gt;<i> &lt;ItemGroup&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;System&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;System.Xml&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;System.Core&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;OssControl&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;OssCore&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;OssDidlLite&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;OssServices&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;OssSysLib&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;OssTopology&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;OssToolkitDroid&quot;/&gt;
</I>&gt;<i>      &lt;Reference Include=&quot;Mono.Android&quot;/&gt;
</I>&gt;<i> &lt;/ItemGroup&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Stacktrace from msbuild as follows:
</I>&gt;<i>
</I>&gt;<i> &quot;Z:\oss\Main\build\Android\release\Topology\LinnTopology.csproj&quot; (default
</I>&gt;<i> target) (1) -&gt;
</I>&gt;<i> (_ExtractLibraryProjectImports target) -&gt;
</I>&gt;<i>    C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> The &quot;ResolveLibraryProjectImports&quot; task failed unexpectedly.\r
</I>&gt;<i> [Z:\oss\Main\build\Android\release\Topology\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> System.IO.FileNotFoundException: Could not find file
</I>&gt;<i> 'Z:\oss\Main\build\Android\release\Topology\OssToolkitDroid.dll'.\r
</I>&gt;<i> [Z:\oss\Main\build\Andro
</I>&gt;<i> id\release\Topology\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> File name:
</I>&gt;<i> 'Z:\oss\Main\build\Android\release\Topology\OssToolkitDroid.dll'\r
</I>&gt;<i> [Z:\oss\Main\build\Android\release\Topology\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)\r
</I>&gt;<i> [Z:\oss\Main\build\Android\release\Topology\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at System.IO.FileStream.Init(String path, FileMode mode, FileAccess access,
</I>&gt;<i> Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize
</I>&gt;<i> , FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean
</I>&gt;<i> bFromProxy, Boolean useLongPath)\r
</I>&gt;<i> [Z:\oss\Main\build\Android\release\Topology\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access,
</I>&gt;<i> FileShare share)\r [Z:\oss\Main\build\Android\release\Topology\Li
</I>&gt;<i> nnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at Mono.Cecil.ModuleDefinition.GetFileStream(String fileName, FileMode mode,
</I>&gt;<i> FileAccess access, FileShare share)\r [Z:\oss\Main\build\Android\
</I>&gt;<i> release\Topology\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at Mono.Cecil.ModuleDefinition.ReadModule(String fileName, ReaderParameters
</I>&gt;<i> parameters)\r [Z:\oss\Main\build\Android\release\Topology\LinnTopo
</I>&gt;<i> logy.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at Xamarin.Android.Tasks.ResolveLibraryProjectImports.Execute()\r
</I>&gt;<i> [Z:\oss\Main\build\Android\release\Topology\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at
</I>&gt;<i> Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute()\r
</I>&gt;<i> [Z:\oss\Main\build\Android\release\Topolog
</I>&gt;<i> y\LinnTopology.csproj]
</I>&gt;<i> C:\Program Files
</I>&gt;<i> (x86)\MSBuild\Novell\Novell.MonoDroid.Common.targets(378,2): error MSB4018:
</I>&gt;<i> at Microsoft.Build.Back
</I>&gt;<i> End.TaskBuilder.ExecuteInstantiatedTask(ITaskExecutionHost
</I>&gt;<i> taskExecutionHost, TaskLoggingContext taskLoggingContext, TaskHost taskHost,
</I>&gt;<i> ItemBucket bucket, TaskExecutionMode howToExecuteTask, Boolean&amp;  taskResult)
</I>&gt;<i> [Z:\oss\Main\build\Android
</I>&gt;<i> \release\Topology\LinnTopology.csproj]
</I>&gt;<i>
</I>&gt;<i> Stacktrace from visual studio if I open and try to build the generated
</I>&gt;<i> project:
</I>&gt;<i>
</I>&gt;<i> Error	3	The &quot;ResolveLibraryProjectImports&quot; task failed unexpectedly.
</I>&gt;<i> System.IO.FileNotFoundException: Could not find file
</I>&gt;<i> 'Z:\oss\Main\build\Android\release\Topology\OssToolkitDroid.dll'.
</I>&gt;<i> File name: 'Z:\oss\Main\build\Android\release\Topology\OssToolkitDroid.dll'
</I>&gt;<i>     at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)
</I>&gt;<i>     at System.IO.FileStream.Init(String path, FileMode mode, FileAccess
</I>&gt;<i> access, Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize,
</I>&gt;<i> FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean
</I>&gt;<i> bFromProxy, Boolean useLongPath)
</I>&gt;<i>     at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess
</I>&gt;<i> access, FileShare share)
</I>&gt;<i>     at Mono.Cecil.ModuleDefinition.GetFileStream(String fileName, FileMode
</I>&gt;<i> mode, FileAccess access, FileShare share)
</I>&gt;<i>     at Mono.Cecil.ModuleDefinition.ReadModule(String fileName,
</I>&gt;<i> ReaderParameters parameters)
</I>&gt;<i>     at Xamarin.Android.Tasks.ResolveLibraryProjectImports.Execute()
</I>&gt;<i>     at
</I>&gt;<i> Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute()
</I>&gt;<i>     at
</I>&gt;<i> Microsoft.Build.BackEnd.TaskBuilder.ExecuteInstantiatedTask(ITaskExecutionHost
</I>&gt;<i> taskExecutionHost, TaskLoggingContext taskLoggingContext, TaskHost taskHost,
</I>&gt;<i> ItemBucket bucket, TaskExecutionMode howToExecuteTask, Boolean&amp;  taskResult)
</I>&gt;<i> LinnTopology
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/msbuild-crash-in-ResolveLibraryProjectImports-task-in-MFA-v4-1-tp5635151p5635151.html">http://mono-for-android.1047100.n5.nabble.com/msbuild-crash-in-ResolveLibraryProjectImports-task-in-MFA-v4-1-tp5635151p5635151.html</A>
</I>&gt;<i> Sent from the Mono for Android mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i>
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009706.html">[mono-android] msbuild crash in ResolveLibraryProjectImports task	in MFA v4.1
</A></li>
	<LI>Next message: <A HREF="009709.html">[mono-android] msbuild crash in ResolveLibraryProjectImports	task in MFA v4.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9707">[ date ]</a>
              <a href="thread.html#9707">[ thread ]</a>
              <a href="subject.html#9707">[ subject ]</a>
              <a href="author.html#9707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
