<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] M4A Paths and reflection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20M4A%20Paths%20and%20reflection&In-Reply-To=%3C7CF48B0CB8988E45AC776D68479B14468941A82AFA%40MBX72.ad2.softcom.biz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009584.html">
   <LINK REL="Next"  HREF="009586.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] M4A Paths and reflection</H1>
    <B>Chris Tacke</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20M4A%20Paths%20and%20reflection&In-Reply-To=%3C7CF48B0CB8988E45AC776D68479B14468941A82AFA%40MBX72.ad2.softcom.biz%3E"
       TITLE="[mono-android] M4A Paths and reflection">ctacke at opennetcf.com
       </A><BR>
    <I>Tue Apr  3 17:22:42 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009584.html">[mono-android] Any ideas why this fails?
</A></li>
        <LI>Next message: <A HREF="009586.html">[mono-android] M4A Paths and reflection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9581">[ date ]</a>
              <a href="thread.html#9581">[ thread ]</a>
              <a href="subject.html#9581">[ subject ]</a>
              <a href="author.html#9581">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm having some...challenges...with assembly paths in M4A.  Let me describe what I'm doing, and what I'm seeing.  Some of the behavior I understand, some I don't.



I have three distinctly different scenarios where I'm having a problem, but they are all rooted in the same behavior - dynamically loading local configuration files and then dynamically loading compiled assemblies. Think of them as configuration and then plug ins, where we derive from a known interface, but the actual implementation could be in an assembly we know absolutely nothing about during compile time (i.e. no project reference).



For example, the OpenNETCF IoC library has the ability to load assemblies based on an XML configuration document.  Basically the config document is put into the same folder as the application and it describes modules to load (a la SCSF), something along these lines:




&lt;SolutionProfile&gt;
    &lt;Modules&gt;
        &lt;ModuleInfo AssemblyFile=&quot;ICM.Hosting.Module.dll&quot; /&gt;
        &lt;ModuleInfo AssemblyFile=&quot;ICM.Infrastructure.Supervisor.dll&quot; /&gt;
        &lt;ModuleInfo AssemblyFile=&quot;ICM.Simulation.Module.dll&quot;/&gt;
        &lt;ModuleInfo AssemblyFile=&quot;ICM.DataCollector.Module.dll&quot; /&gt;
    &lt;/Modules&gt;
&lt;/SolutionProfile&gt;


The AssemblyFile attributes name assemblies that are typically deployed with the app, and since no pathing is given with the assembly, it is assumed to be &quot;in the same folder as the executing application&quot;.  Each of these assemblies is loaded via Reflection and some interface methods are called to initialize the Module.



The pain point right now is finding the &quot;folder from which we are executing&quot;.  A call to Assembly.GetExecutingAssembly().GetName().CodeBase returns different things whether we're in Debug or Release, and the Release version looks to be a hard-coded path on the machine that actually built the Mono runtime.  Another one of our devs did some chatting with Jon Pryor (thanks again Jon!) and we now understand that the answer there is &quot;Don't do that!&quot;.  However, we still need this functional behavior.



If I include the XML file in my project, how do I &quot;find&quot; it and load it?  I can't use an Asset, because the IoC library actually knows nothing about its caller, except what it can divine through Reflection or Environment calls plus I really want to keep the code base platform-agnostic.  This is what I have so far, but as you can see, the Android stuff is just a placeholder.


    private bool LoadConfigFromFile()
    {
        string configPath;

        if (Environment.OSVersion.Platform == PlatformID.Unix)
        {
            // what goes here???
        }
        else
        {
            configPath = Path.GetDirectoryName(Assembly.GetExecutingAssembly().GetName().CodeBase);
            if (configPath.StartsWith(&quot;file:\\&quot;)) configPath = configPath.Substring(6);
        }
        configPath = Path.Combine(configPath, &quot;ProfileCatalog.xml&quot;);

        if (!File.Exists(configPath)) return false;

        return false;
    }


Is the solution, at this point anyway, to &quot;force&quot; the developer to use some magic path (something like /root/IoC)?  I'd love to allow them to set that path via a Configuration file, but that's a Catch-22.  I'm also thinking of adding a &quot;SetLoaderPath&quot; to the RootWorkItem in IoC, but if a user doesn't make that call, I'd like to have some sort of default.



I've got more questions regarding actual assembly loading, but I'll hold on those until I figure this part out.



As a separate, but probably equally import part of this is where on earth are my app files when I install an APK anyway?  I get the feeling they remain in the APK and are squirreled away somewhere on the device.  Is there any documentation online about the actual application and assembly startup/load process?



-----------------

Chris Tacke

President

OpenNETCF Consulting, LLC




-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/attachments/20120403/cbbce193/attachment-0001.html">http://lists.ximian.com/pipermail/monodroid/attachments/20120403/cbbce193/attachment-0001.html</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009584.html">[mono-android] Any ideas why this fails?
</A></li>
	<LI>Next message: <A HREF="009586.html">[mono-android] M4A Paths and reflection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9581">[ date ]</a>
              <a href="thread.html#9581">[ thread ]</a>
              <a href="subject.html#9581">[ subject ]</a>
              <a href="author.html#9581">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
