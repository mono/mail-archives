<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] JavaScript Interface
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20JavaScript%20Interface&In-Reply-To=1313153762345-4693178.post%40n5.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005854.html">
   <LINK REL="Next"  HREF="005856.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] JavaScript Interface</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20JavaScript%20Interface&In-Reply-To=1313153762345-4693178.post%40n5.nabble.com"
       TITLE="[mono-android] JavaScript Interface">jonp at xamarin.com
       </A><BR>
    <I>Fri Aug 12 10:27:30 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="005854.html">[mono-android] JavaScript Interface
</A></li>
        <LI>Next message: <A HREF="005856.html">[mono-android] Detecting Network connectivity state changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5858">[ date ]</a>
              <a href="thread.html#5858">[ thread ]</a>
              <a href="subject.html#5858">[ subject ]</a>
              <a href="author.html#5858">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 12, 2011, at 8:56 AM, malexandroni wrote:
&gt;<i> I tried the JS interface in Java and it works fine, but I tried to replicate the code in Mono for Android and it does not work. What am I doing wrong?
</I>
That won't work at this point in time. :-(

The problem is reflection: in order for the JavaScript to invoke the method on the provided Java object, Android uses Java reflection in order to see if the method exists, and if it does to then invoke the method. This works in Java because the JavaScriptInterface type has a `showToast` method.

This doesn't work in Mono for Android, because `mandroid` only generates Java method declarations for methods that override base class methods or implement interface methods. Consequently, your C# JavaScriptInterface.showToast() method isn't visible to the Java world, and things don't work. (To see what I mean, look at obj\Debug\android\src\**\JavaScriptInterface.java, and see what methods are present.)

We intent to support this in a future release (timeframe: unspecified), but that doesn't help _now_.

What will help now is a workaround: write your JavaScriptInterface type in a .java file, include the .java file in your project with a AndroidJavaSource Build action, and in Activity1.OnCreate(), do:

	IntPtr JavaScriptInterface_Class = JNIEnv.FindClass (&quot;the/package/for/JavaScriptInterface&quot;);
	// TODO: Update &quot;the/package/for&quot; as appropriate for your type.
	IntPtr JavaScriptInterface_ctor = JNIEnv.GetMethodID (JavaScriptInterface_Class, &quot;&lt;init&gt;&quot;, &quot;()V&quot;);
	IntPtr instance = JNIEnv.NewObject (JavaScriptInterface_Class, JavaScriptInterface_ctor);

	appView.AddJavascriptInterface (new Java.Lang.Object (instance), &quot;Android&quot;);

 - Jon

</PRE>













































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005854.html">[mono-android] JavaScript Interface
</A></li>
	<LI>Next message: <A HREF="005856.html">[mono-android] Detecting Network connectivity state changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5858">[ date ]</a>
              <a href="thread.html#5858">[ thread ]</a>
              <a href="subject.html#5858">[ subject ]</a>
              <a href="author.html#5858">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
