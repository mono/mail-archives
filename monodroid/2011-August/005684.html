<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Program stops
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Program%20stops&In-Reply-To=E1CBC5C516989341B7C5CED7961570B401A2FBF2%40EXCHANGE.designerware.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005683.html">
   <LINK REL="Next"  HREF="005685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Program stops</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Program%20stops&In-Reply-To=E1CBC5C516989341B7C5CED7961570B401A2FBF2%40EXCHANGE.designerware.local"
       TITLE="[mono-android] Program stops">jonp at xamarin.com
       </A><BR>
    <I>Thu Aug  4 17:05:36 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="005683.html">[mono-android] Program stops
</A></li>
        <LI>Next message: <A HREF="005685.html">[mono-android] Program stops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5684">[ date ]</a>
              <a href="thread.html#5684">[ thread ]</a>
              <a href="subject.html#5684">[ subject ]</a>
              <a href="author.html#5684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 4, 2011, at 4:29 PM, Tim Kelly wrote:
&gt;<i> However, on another note.  One of the things I took out of the proof was a HttpWebRequest and HttpWebResponse which hit the server.  So, I'm adding more logging and have found one thing. 
</I>&gt;<i>  
</I>&gt;<i> Repeatedly calling these cause the network to stop functioning until you reboot the emulator.  Calling the equivalent in java posses no issues.
</I>
I'm reminded of <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=648862#c9">https://bugzilla.novell.com/show_bug.cgi?id=648862#c9</A>

However, I see that you are disposing of `response` and other Stream instances, so I'm not sure where the leak is coming from. That said, you have lots of catch{} blocks; are those being hit? I ask because there are code paths where, if an exception were thrown, the stream wouldn't be closed:

	            Stream dataStream = request.GetRequestStream();
                    // Write the data to the request stream.
                    dataStream.Write(byteArray, 0, byteArray.Length);
                    // Close the Stream object.
                    dataStream.Close();

Instead, try:

	using (Stream dataStream = request.GetRequestStream())
		dataStream.WRite (byteArray, 0, byteArray.Length);

I would actually suggest using `using` more often, as I found that method hard to read (but that may be just me), e.g. a simple translation would be:

	private string GetData(string url, Boolean postData, String xmlData)
	{
		StringBuilder sb = new StringBuilder();
		try {
			using (var request = (HttpWebRequest) WebRequest.Create(url)) {
				request.ContentType = &quot;text/plain&quot;;
				if (postData) {
					request.Method = &quot;POST&quot;;
					byte[] data = Encoding.ASCII.GetBytes(xmlData);
					request.ContentLength = data.Length;
					using (o = request.GetRequestStream())
						o.Write (data, 0, data.Length);
				}
				using (var response = (HttpWebResponse) request.GetReponse())
				using (var resStream = response.GetResponseStream ()) {
					byte[] buf = new byte[4 * 1024];

					int count = 0;
					do {
						count = resStream.Read (buf, 0, buf.Length);
						if (count != 0)
							sb.Append (Encoding.ASCII.GetString(buf, 0, count));
					} while (count &gt; 0);
				}
			}
		} catch {}
		return sb.ToString ();
	}

 - Jon

</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005683.html">[mono-android] Program stops
</A></li>
	<LI>Next message: <A HREF="005685.html">[mono-android] Program stops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5684">[ date ]</a>
              <a href="thread.html#5684">[ thread ]</a>
              <a href="subject.html#5684">[ subject ]</a>
              <a href="author.html#5684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
