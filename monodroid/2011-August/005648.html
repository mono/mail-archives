<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] MAC Address
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20MAC%20Address&In-Reply-To=CABunV9V_bHvMrJJRrPxby55CKxtKHt4_%3DOF4cNiRX3q5vRDVLg%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005635.html">
   <LINK REL="Next"  HREF="005625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] MAC Address</H1>
    <B>Tim Kelly</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20MAC%20Address&In-Reply-To=CABunV9V_bHvMrJJRrPxby55CKxtKHt4_%3DOF4cNiRX3q5vRDVLg%40mail.gmail.com"
       TITLE="[mono-android] MAC Address">tim.kelly at DesignerWare.com
       </A><BR>
    <I>Tue Aug  2 14:31:22 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="005635.html">[mono-android] MAC Address
</A></li>
        <LI>Next message: <A HREF="005625.html">[mono-android] SetInterpolator ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5648">[ date ]</a>
              <a href="thread.html#5648">[ thread ]</a>
              <a href="subject.html#5648">[ subject ]</a>
              <a href="author.html#5648">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks, I'll have to look at this later.  Looks like I can check off the
business requirement for MAC Address, just not going to code it just
yet.

 

________________________________

From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Iain Mcleod
Sent: Tuesday, August 02, 2011 7:03 AM
To: Discussions related to Mono for Android
Subject: Re: [mono-android] MAC Address

 

Yes: I am doing the following to iterate the network interfaces.  This
code doesn't quite do what you need, but you should hopefully be able to
adapt it a little to get the mac address.

Basically, I'm using JNIEnv to invoke the native java methods as they
are currently not implemented as monodroid wrappers (due to Enumeration
being a generic interface).

Kind of like reflection, whereby I get a pointer to a method then invoke
it to get an intptr which I can then cast to a monodroid wrapped
instance.

 

Here are some links to help you get started:

<A HREF="http://android.xamarin.com/Documentation/API_Design#Java_Native_Interfac">http://android.xamarin.com/Documentation/API_Design#Java_Native_Interfac</A>
e_Support

<A HREF="http://journals.ecs.soton.ac.uk/java/tutorial/native1.1/implementing/met">http://journals.ecs.soton.ac.uk/java/tutorial/native1.1/implementing/met</A>
hod.html

 

Hope that helps.

 

Cheers

Iain

 

public static List&lt;NetworkInfoModel&gt; GetAllNetworkInterfaces()

        {

            // NetworkInfoModel is a class that we define.  You'll need
to define something similar.

            List&lt;NetworkInfoModel&gt; adaptors = new
List&lt;NetworkInfoModel&gt;();

 

            IntPtr networkInterfaceClass =
Android.Runtime.JNIEnv.FindClass(&quot;java/net/NetworkInterface&quot;);

            IntPtr getNetworkInterfacesMethod =
Android.Runtime.JNIEnv.GetStaticMethodID(networkInterfaceClass,
&quot;getNetworkInterfaces&quot;, &quot;()Ljava/util/Enumeration;&quot;);

            IntPtr networkInterfacesEnumeration =
Android.Runtime.JNIEnv.CallStaticObjectMethod(networkInterfaceClass,
getNetworkInterfacesMethod);

            

            IntPtr enumerationClass =
Android.Runtime.JNIEnv.FindClass(&quot;java/util/Enumeration&quot;);

            IntPtr hasMoreElementsMethod =
Android.Runtime.JNIEnv.GetMethodID(enumerationClass, &quot;hasMoreElements&quot;,
&quot;()Z&quot;);

            IntPtr nextElementMethod =
Android.Runtime.JNIEnv.GetMethodID(enumerationClass, &quot;nextElement&quot;,
&quot;()Ljava/lang/Object;&quot;);

            bool hasMoreInterfaces =
Android.Runtime.JNIEnv.CallBooleanMethod(networkInterfacesEnumeration,
hasMoreElementsMethod);

            while (hasMoreInterfaces)

            {

                IntPtr currentInterface =
Android.Runtime.JNIEnv.CallObjectMethod(networkInterfacesEnumeration,
nextElementMethod);

                hasMoreInterfaces =
Android.Runtime.JNIEnv.CallBooleanMethod(networkInterfacesEnumeration,
hasMoreElementsMethod);

 

                Java.Net.NetworkInterface adapter = new
Java.Lang.Object(currentInterface).JavaCast&lt;Java.Net.NetworkInterface&gt;()
;

 

 

                IntPtr getInetAddressesMethod =
Android.Runtime.JNIEnv.GetMethodID(networkInterfaceClass,
&quot;getInetAddresses&quot;, &quot;()Ljava/util/Enumeration;&quot;);

                IntPtr inetAddressesEnumeration =
Android.Runtime.JNIEnv.CallObjectMethod(currentInterface,
getInetAddressesMethod);

                

                bool hasMoreInetAddresses =
Android.Runtime.JNIEnv.CallBooleanMethod(inetAddressesEnumeration,
hasMoreElementsMethod);

                

                // the following methods require android 2.3 but this
isn't working with the current release of monodroid

 

                //IntPtr isLoopbackMethod =
Android.Runtime.JNIEnv.GetMethodID(networkInterfaceClass, &quot;isLoopback&quot;,
&quot;()Z&quot;);

                //bool isLoopback =
Android.Runtime.JNIEnv.CallBooleanMethod(currentInterface,
isLoopbackMethod);

                //IntPtr isUpMethod =
Android.Runtime.JNIEnv.GetMethodID(networkInterfaceClass, &quot;isUp&quot;,
&quot;()Z&quot;);

                //bool isUp =
Android.Runtime.JNIEnv.CallBooleanMethod(currentInterface, isUpMethod);

 

 

                while (hasMoreInetAddresses)

                {

                    IntPtr currentInetAddress =
Android.Runtime.JNIEnv.CallObjectMethod(inetAddressesEnumeration,
nextElementMethod);

                    hasMoreInetAddresses =
Android.Runtime.JNIEnv.CallBooleanMethod(inetAddressesEnumeration,
hasMoreElementsMethod);

 

                    Java.Net.InetAddress address = new
Java.Lang.Object(currentInetAddress).JavaCast&lt;Java.Net.InetAddress&gt;();

 

                    //if IPV4 and not loopback

                    IPAddress ipAddr;

                    bool success =
IPAddress.TryParse(address.HostAddress, out ipAddr);

                    if (success &amp;&amp; ipAddr.AddressFamily ==
AddressFamily.InterNetwork &amp;&amp; address.HostAddress != &quot;127.0.0.1&quot;)

                    {

                        adaptors.Add(new NetworkInfoModel(adapter.Name, 

                            adapter.DisplayName, 

                            ENetworkInterfaceType.eEthernet, 

                            ipAddr, 

                            null, 

                            ENetworkInterfaceComponent.eIPv4, 

                            string.Empty, 

                            EOperationalStatus.eUp, //TODO: assuming
interface is up for now

                            null,

                            null,

                            null,

                            null,

                            null,

                            null,

                            null,

                            new List&lt;IPAddress&gt;()

                            ));

                    }

                }

            }

 

            return adaptors;

        }

 

 

 

 

On 2 August 2011 05:54, Tim Kelly &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">tim.kelly at designerware.com</A>&gt; wrote:

Seems like I recall another message about the below code not working
because of intpr or something?  Anyway, I need the MACAdress anyone have
any ideas?

 

 

private String getMacAddress()

        {

            String macAddress = String.Empty;

            try

            {

                foreach (System.Net.NetworkInformation.NetworkInterface
networkInterface in
System.Net.NetworkInformation.NetworkInterface.GetAllNetworkInterfaces()
)

                {

                    try

                    {

                        if
(!String.IsNullOrEmpty(networkInterface.GetPhysicalAddress().ToString())
&amp;&amp; 

 
!networkInterface.GetPhysicalAddress().ToString().StartsWith(&quot;0000&quot;))

                        {

                            macAddress +=
(networkInterface.GetPhysicalAddress().ToString()) + &quot;-&quot;;

                        }

                    }

                    catch { }

                }

                if (!String.IsNullOrEmpty(macAddress))

                {

                    if (macAddress.EndsWith(&quot;-&quot;))

                    {

                        macAddress = macAddress.Substring(0,
macAddress.Length - 2);

                    }

                }

            }

            catch (Exception ex)

            {

                System.Diagnostics.StackTrace stackTrace = new
System.Diagnostics.StackTrace();

                String method = stackTrace.GetFrame(0).GetMethod().Name;

                log.writeLogInfo(&quot;ERROR &quot; + method + &quot;:&quot;, ex.Message +
System.Environment.NewLine + ex.StackTrace.ToString());

            }

            if (string.IsNullOrEmpty (macAddress)) 

            {

                macAddress = &quot;none&quot;;

            }

            return macAddress;

        }

 


_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110802/759d1847/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110802/759d1847/attachment-0001.html</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005635.html">[mono-android] MAC Address
</A></li>
	<LI>Next message: <A HREF="005625.html">[mono-android] SetInterpolator ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5648">[ date ]</a>
              <a href="thread.html#5648">[ thread ]</a>
              <a href="subject.html#5648">[ subject ]</a>
              <a href="author.html#5648">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
