<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] LREF overflow setting the Text property of a	TextView
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20LREF%20overflow%20setting%20the%20Text%20property%20of%20a%0A%09TextView&In-Reply-To=%3CDFEF59FE-D757-484D-80F1-BBEEE76BAF0F%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013796.html">
   <LINK REL="Next"  HREF="013798.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] LREF overflow setting the Text property of a	TextView</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20LREF%20overflow%20setting%20the%20Text%20property%20of%20a%0A%09TextView&In-Reply-To=%3CDFEF59FE-D757-484D-80F1-BBEEE76BAF0F%40xamarin.com%3E"
       TITLE="[mono-android] LREF overflow setting the Text property of a	TextView">jonp at xamarin.com
       </A><BR>
    <I>Thu May 30 16:36:51 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="013796.html">[mono-android] LREF overflow setting the Text property of a TextView
</A></li>
        <LI>Next message: <A HREF="013798.html">[mono-android] LREF overflow setting the Text property of a	TextView
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13797">[ date ]</a>
              <a href="thread.html#13797">[ thread ]</a>
              <a href="subject.html#13797">[ subject ]</a>
              <a href="author.html#13797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On May 30, 2013, at 11:50 AM, Daniele Salvatore Albano &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">d.albano at gmail.com</A>&gt; wrote:
&gt;<i> i'm experiencing a VERY strange bug: after a lot of tests i've founded the source of my problem and it appers to be a stupid line of code that i use to update a &quot;clock&quot; on the main activity.
</I>&gt;<i> 
</I>&gt;<i> dateTimeTextView.Text = DateTime.Now.ToString(&quot;dddd, dd MMMM yyyy HH:mm&quot;).ToUpper();
</I>&gt;<i> 
</I>&gt;<i> Here there is the error
</I>&gt;<i> JNI ERROR (app bug): local reference table overflow (max=512)
</I>
Can you provide a reproducible test case? And the full logcat output?

I'm not able to reproduce:

1. Take default template.
2. Edit Resources\layout\Main.axml file to add:

    &lt;TextView
        android:id=&quot;@+id/text&quot;
        android:layout_width=&quot;fill_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:text=&quot;@string/hello&quot; /&gt;

3. Change the Click event handler to:

            button.Click += delegate {
                button.Text = string.Format (&quot;{0} clicks!&quot;, count++);

                new Thread(() =&gt; {
                    for (int i = 0; i &lt; 600; ++i) {
                        RunOnUiThread(() =&gt; {
                            FindViewById&lt;TextView&gt;(Resource.Id.text).Text = string.Format (&quot;Updated: {0} times&quot;, i);
                        });
                    }
                    RunOnUiThread(() =&gt; {
                        button.Text = &quot;Complete&quot;;
                    });
                }).Start ();
            };

This should satisfy your &quot;Update a TextView from a thread using RunOnUiThread()&quot; description.

The above works without any errors.

Enabling lref logging may be helpful, though the lref count is known to be buggy (not sure why, not important enough to figure out yet, e.g. sometimes I see negative values...):

	# Note: VERY verbose; don't leave enabled for long periods of time...
	adb shell setprop debug.mono.log lref

 - Jon

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013796.html">[mono-android] LREF overflow setting the Text property of a TextView
</A></li>
	<LI>Next message: <A HREF="013798.html">[mono-android] LREF overflow setting the Text property of a	TextView
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13797">[ date ]</a>
              <a href="thread.html#13797">[ thread ]</a>
              <a href="subject.html#13797">[ subject ]</a>
              <a href="author.html#13797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
