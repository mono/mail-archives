<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] AutoCompleteTextView (con't)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20AutoCompleteTextView%20%28con%27t%29&In-Reply-To=%3C1368928118378-5713327.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013762.html">
   <LINK REL="Next"  HREF="013767.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] AutoCompleteTextView (con't)</H1>
    <B>gspro</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20AutoCompleteTextView%20%28con%27t%29&In-Reply-To=%3C1368928118378-5713327.post%40n5.nabble.com%3E"
       TITLE="[mono-android] AutoCompleteTextView (con't)">gspross at gmail.com
       </A><BR>
    <I>Sun May 19 01:48:38 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="013762.html">[mono-android] Missing icon preventing deploy to Play Store
</A></li>
        <LI>Next message: <A HREF="013767.html">[mono-android] AutoCompleteTextView (con't)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13766">[ date ]</a>
              <a href="thread.html#13766">[ thread ]</a>
              <a href="subject.html#13766">[ subject ]</a>
              <a href="author.html#13766">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I posted before regarding this question, but am still struggling. I created a
custom adapter to bind the autocomplete to an array list dynamically - a web
service is called after 2 characters are typed. The code is a combination of
the xamarin content control samples, and another sample on the web (sorry
OP, don't remember where it's from). So in the activity that hosts the
autocomplete textview, I create and bind the adapter, and in the
autocomplete textview's text changed event, I call the web service and bind
the results to the adapter  -adapter.add(myPoco). The service returns data,
but the adapter.count always remains zero, and the custom adapters
PerformFiltering event is never called. Here is the activity code followed
by the custom adapter code. I'm not sure where to put the code to call the
service. It would seem logical to put it in the text changed, but that's not
working:

 protected override void OnCreate(Bundle bundle)
        {
            base.OnCreate(bundle);
            this.SetContentView(Resource.Layout.login);
...

            AutoCompleteTextView act =
FindViewById&lt;AutoCompleteTextView&gt;(Resource.Id.txtEmailCopyToAC);
            
            //ContactAdapter 
            ca = new ContactAdapter(this,
global::Android.Resource.Layout.SimpleDropDownItem1Line);
            act.Adapter = ca;

            //act.Adapter = new ContactAdapter(this,
global::Android.Resource.Layout.SimpleDropDownItem1Line);
            act.TextChanged += act_TextChanged;
        }

        void act_TextChanged(object sender,
global::Android.Text.TextChangedEventArgs e)
        {
            
            if(((AutoCompleteTextView)sender).IsPerformingCompletion)
            {
                return;
            }
            if (e.Text.Count() &lt; 2)
            {
                return;
            }
            

            String searchChars = e.Text.ToString();
            ca.Clear();
            int companyId = 1;
            int acctId = 1;
            var contacts = Gateway.GetCompanyContacts(companyId, acctId);
            if (contacts.Count &gt; 0)
            {
                foreach (var c in contacts)
                {
                    global::Android.Util.Log.Warn(&quot;Disc.Android&quot;, &quot;record:&quot;
+ c.EmailAddress);
                    ca.Add(c);
                }
                
            }
        }

    }
}




//custom adapter:

using System;
using System.Collections.Generic;
using System.Linq;

using Android.App;
using Android.Content;
using Android.OS;
using Android.Runtime;
using Android.Views;
using Android.Widget;
using Android.Util;
using Android.Graphics;

using activeTRAC.DiSCMobile.Model;

namespace activeTRAC.DiSCMobile.Android.Support
{
    //class ContactAdapter&lt;T&gt; : ArrayAdapter&lt;EmailContactItem&gt;,IFilterable
    class ContactAdapter : ArrayAdapter&lt;EmailContactItem&gt;,IFilterable
    {
        LayoutInflater inflater;
        private List&lt;EmailContactItem&gt; _items;
        Filter filter;
        public ContactAdapter(Activity context, int textViewResourceId)//,
List&lt;EmailContactItem&gt; _items)
            : base(context, textViewResourceId)//, _items)
        {
            inflater = context.LayoutInflater;
            filter = new SuggestionsFilter(this);
            _items = new List&lt;EmailContactItem&gt;();
    
        }

        public override int Count
        {
            get { return _items.Count; }
        }
    
        public EmailContactItem GetItem(int position)
        {
            return _items[position];
        }
    
        public override View GetView(int position, View convertView,
ViewGroup parent)
        {
            View view = convertView;
            if (view == null)
                view =
inflater.Inflate(global::Android.Resource.Layout.SimpleDropDownItem1Line,
null);

            view.FindViewById&lt;TextView&gt;(Resource.Id.txtEmailCopyToAC).Text =
_items[position].EmailAddress;

            return view;
        }

        class SuggestionsFilter : Filter
        {
            //ContactAdapter&lt;EmailContactItem&gt; customAdapter;
            ContactAdapter customAdapter;
            public SuggestionsFilter(ContactAdapter adapter)
               // public SuggestionsFilter(ContactAdapter&lt;EmailContactItem&gt;
adapter)
                : base()
            {
                customAdapter = adapter;
            }
            protected override Filter.FilterResults
PerformFiltering(Java.Lang.ICharSequence constraint)
            {
                FilterResults results = new FilterResults();
                if (constraint != null)
                {
                    List&lt;EmailContactItem&gt; data = new
List&lt;EmailContactItem&gt;();
                    try
                    {
                        data = Gateway.GetCompanyContacts(1, 1);
                        
                    }
                    catch (Exception ex)
                    { 
                        //TODO: handle exception
                    }
                    Java.Lang.Object[] matchObjects;
                    matchObjects = new Java.Lang.Object[data.Count];
                    for(int i=0; i&lt;data.Count; i++)
                    {
                        matchObjects[i] = new
Java.Lang.String(data[i].EmailAddress);
                        //TODO: do something with the key
                    }
                    results.Values = matchObjects;
                    results.Count = matchObjects.Count();
                   
                }
                return results;
            }
            protected override void PublishResults(Java.Lang.ICharSequence
constraint, Filter.FilterResults results)
            {
                if (results != null &amp;&amp; results.Count &gt; 0)
                {
                    //customAdapter.notifyDataSetChanged();
                }
                else
                {
                    //customAdapter.notifyDataSetInvalidated();
                }

            }
        }
    }
}



--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/AutoCompleteTextView-con-t-tp5713327.html">http://mono-for-android.1047100.n5.nabble.com/AutoCompleteTextView-con-t-tp5713327.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013762.html">[mono-android] Missing icon preventing deploy to Play Store
</A></li>
	<LI>Next message: <A HREF="013767.html">[mono-android] AutoCompleteTextView (con't)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13766">[ date ]</a>
              <a href="thread.html#13766">[ thread ]</a>
              <a href="subject.html#13766">[ subject ]</a>
              <a href="author.html#13766">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
