<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] Jar files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Jar%20files&In-Reply-To=0d6101cbca5c%244c0be100%24e423a300%24%40tedneward.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003026.html">
   <LINK REL="Next"  HREF="003153.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] Jar files</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Jar%20files&In-Reply-To=0d6101cbca5c%244c0be100%24e423a300%24%40tedneward.com"
       TITLE="[Monodroid] Jar files">jpryor at novell.com
       </A><BR>
    <I>Fri Feb 11 22:36:34 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003026.html">[Monodroid] Jar files
</A></li>
        <LI>Next message: <A HREF="003153.html">[Monodroid] Jar files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3027">[ date ]</a>
              <a href="thread.html#3027">[ thread ]</a>
              <a href="subject.html#3027">[ subject ]</a>
              <a href="author.html#3027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To answer the original question, support for using Android.Runtime.JNIEnv with third party .jar files will require Preview 13:

	<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=661858">https://bugzilla.novell.com/show_bug.cgi?id=661858</A>

(because such support requires compiling the .jar files into .dex files for use by Dalvik, and that support didn't land in any form until today...)

The existing Build Action AndroidJavaSource support would support your providing your own .java files with 'native' method declarations, then including a native .so which would implement those methods (pretty much ye standard JNI usage), though you'd want to also use Build Action AndroidNativeLibrary to include the native library into the final .apk.

 - Jon

On Feb 11, 2011, at 9:26 PM, Ted Neward wrote:

&gt;<i> (I&#8217;m CCing the list again because hopefully the MonoDroid guys will catch me where I&#8217;m making bad assumptions. I have NOT done this before with Monodroid.)
</I>&gt;<i>  
</I>&gt;<i> JNI in Java is conceptually like P/Invoke in .NET, but without some of the nifty enhancements that make P/Invoke (relatively) easy to use. Let me explain the Java side of things, and then we can try to figure out how that maps to Android and then .NET.
</I>&gt;<i>  
</I>&gt;<i> Assuming that you want to call from Java to native code, you have to do a couple of things.
</I>&gt;<i>  
</I>&gt;<i> Java side:
</I>&gt;<i> 1) Declare a method in Java as &#8220;native&#8221;. This tells the JVM to do a runtime link by name to a native library, and serves as the method that the Java code will call. In general, to help avoid certain kinds of craziness, you&#8217;ll want this method to be a static method.
</I>&gt;<i> 2) Write a call to load the native library into the JVM by calling &#8220;System.loadLibrary(libName);&#8221;. Note that &#8220;libName&#8221; is the name minus any file adornments; so, for example, if you wanted to load USER32.DLL, you&#8217;d &#8220;loadLibrary(&#8220;USER32&#8221;);&#8221; (minus the .DLL). This is because different dynamic libraries have different filenames on different platforms (foo.dll on Windows vs. libFoo.so on Linux, for example).
</I>&gt;<i> 3) Compile the Java code. (If you run the Java code at this point, it&#8217;ll generate an &#8220;UnsatisfiedLinkError&#8221;.)
</I>&gt;<i>  
</I>&gt;<i> Native side:
</I>&gt;<i> 4) Create a C/C++ declaration by running &#8220;javah&#8221; (a Java utility) against the compiled Java source. This creates a .h file with the necessary C declaration. The declarations will be declared using a series of typedef&#8217;ed types defined in &#8220;jni.h&#8221;, which is in JDK/include, and which, for the most part, are isomorphic to standard C types. &#8220;jint&#8221;, for example, is a signed 32-bit integer that usually maps pretty easily over to a C compiler&#8217;s &#8220;int&#8221; type. &#8220;jobject&#8221; and &#8220;jstring&#8221;, however, are reference types and will need to use the JNI API to resolve&#8212;for simplest cases, avoid these in your Java native method declarations. (You certainly don&#8217;t have to, but trying to convert a jstring over to a const char* is a bitch and a half.)
</I>&gt;<i> 5) Create a C/C++ implementation of that declared method.
</I>&gt;<i> 6) Compile the C/C++ implementation into a DLL. Ensure the DLL is &#8220;discoverable&#8221; by the JVM&#8212;for the most part, standard &#8220;LoadLibrary&#8221; rules will apply here. There&#8217;s a Java property that can define additional directories where native libraries can be found, but that&#8217;s not relevant right now.
</I>&gt;<i> 7) Run the code; assuming your C/C++ code works correctly, all should be golden.
</I>&gt;<i>  
</I>&gt;<i> Android:
</I>&gt;<i> The Android JNI story is mostly similar, except that in order to build the Android native library, you&#8217;re going to need the Android NDK (Native Development Kit) to compile the native bits. There&#8217;s a good number of samples in the NDK, but basically the process is the same except it&#8217;s done as part of the Android build process, which takes care of a few niggling details (like using the right C/C++ compiler).<A HREF="http://developer.android.com/sdk/ndk">http://developer.android.com/sdk/ndk</A> is your friend here (if you&#8217;re a native Android developer).
</I>&gt;<i>  
</I>&gt;<i> MonoDroid:
</I>&gt;<i> Here&#8217;s where my expertise ends.  I&#8217;m guessing that the native library would still need to be compiled by the NDK, but setting up the C# declaration on the MonoDroid end (the &#8220;Java side&#8221; steps above) would be the part I don&#8217;t know. I&#8217;m guessing that MonoDroid will somehow read PInvoke declarations from C# and &#8220;do the right thing&#8221; to the Java/Dalvik bytecode declarations, but that&#8217;s pure guess on my part (and hence the reason I posted back to the list).
</I>&gt;<i>  
</I>&gt;<i> Ted Neward
</I>&gt;<i> Java, .NET, XML Services
</I>&gt;<i> Consulting, Teaching, Speaking, Writing
</I>&gt;<i> <A HREF="http://www.tedneward.com">http://www.tedneward.com</A>
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> From: Marcio Alexandroni [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">marcio at cialogica.com.br</A>] 
</I>&gt;<i> Sent: Friday, February 11, 2011 3:46 AM
</I>&gt;<i> To: Ted Neward
</I>&gt;<i> Subject: Re: [Monodroid] Jar files
</I>&gt;<i>  
</I>&gt;<i> Hi Ted, thanks for your help.
</I>&gt;<i> 
</I>&gt;<i> I don&#8217;t have any experience with Java, I'm a .NET developer, so I don't know where to start binding the Jar classes/methods to C# code with MonoDroid.
</I>&gt;<i> 
</I>&gt;<i> If you have any simple sample code you can send me to help me start, that would be great!
</I>&gt;<i> 
</I>&gt;<i> Thanks again.
</I>&gt;<i> 
</I>&gt;<i> Marcio Alexandroni
</I>&gt;<i>  ( (+55 11) 9989-8316
</I>&gt;<i> &lt;image001.png&gt; marcioalexandroni
</I>&gt;<i> -- 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> From: Ted Neward &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">ted at tedneward.com</A>&gt;
</I>&gt;<i> Date: Fri, 11 Feb 2011 03:36:01 -0800
</I>&gt;<i> To: Marcio Alexandroni &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">marcio at cialogica.com.br</A>&gt;
</I>&gt;<i> Subject: RE: [Monodroid] Jar files
</I>&gt;<i> 
</I>&gt;<i> I&#8217;ve done a ton of Java/JNI in the past, so I might be able to help if you&#8217;re not past this already.
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Ted Neward
</I>&gt;<i> Java, .NET, XML Services
</I>&gt;<i> Consulting, Teaching, Speaking, Writing
</I>&gt;<i> <A HREF="http://www.tedneward.com">http://www.tedneward.com</A> &lt;<A HREF="http://www.tedneward.com">http://www.tedneward.com</A>&gt; 
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Marcio Alexandroni
</I>&gt;<i> Sent: Sunday, February 06, 2011 6:11 AM
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> Subject: [Monodroid] Jar files
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Anyone tried the JNIEnv to use a 3rd party jar file? I would like to use a Java library from my MonoDroid project but I read the support will be available only after 1.0, so I'm looking on how to do it right now using the JNIEnv. 
</I>&gt;<i> 
</I>&gt;<i> If anyone has any sample code to share, that would be great.
</I>&gt;<i> 
</I>&gt;<i> Thanks.
</I>&gt;<i> 
</I>&gt;<i> Marcio Alexandroni
</I>&gt;<i>  ( (+55 11) 9989-8316
</I>&gt;<i> &lt;image001.png&gt;marcioalexandroni
</I>&gt;<i> --
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> 
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003026.html">[Monodroid] Jar files
</A></li>
	<LI>Next message: <A HREF="003153.html">[Monodroid] Jar files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3027">[ date ]</a>
              <a href="thread.html#3027">[ thread ]</a>
              <a href="subject.html#3027">[ subject ]</a>
              <a href="author.html#3027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
