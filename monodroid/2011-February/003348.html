<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] create a menu item
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20create%20a%20menu%20item&In-Reply-To=COL122-W57FAB1BC70BEACB77CB10DAEDC0%40phx.gbl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003343.html">
   <LINK REL="Next"  HREF="003349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] create a menu item</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20create%20a%20menu%20item&In-Reply-To=COL122-W57FAB1BC70BEACB77CB10DAEDC0%40phx.gbl"
       TITLE="[Monodroid] create a menu item">jpryor at novell.com
       </A><BR>
    <I>Sat Feb 26 19:41:41 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003343.html">[Monodroid] create a menu item
</A></li>
        <LI>Next message: <A HREF="003349.html">[Monodroid] create a menu item
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3348">[ date ]</a>
              <a href="thread.html#3348">[ thread ]</a>
              <a href="subject.html#3348">[ subject ]</a>
              <a href="author.html#3348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 26, 2011, at 3:58 PM, Wally McClure wrote:
&gt;<i> I'm not quite sure when this changover happened, so apologies if this happened before p13.
</I>
This is new to P13.

&gt;<i> I have some simple code that creates some menu items.  The code is:
</I>&gt;<i> 	menu.Add(MenuGroup, menuItemId + 20, menuItemOrder + 2, &quot;Menu item 1&quot;);
</I>&gt;<i> It now looks like I need to do this:
</I>&gt;<i> 	menu.Add(MenuGroup, menuItemId + 10, menuItemOrder + 1, str0);
</I>&gt;<i> 	Java.Lang.ICharsequence str = new Java.Lang.String(&quot;Menu item 1&quot;);
</I>
P13 requires that you change the itemId parameter (`menuItemId + 20` vs. `menuItemId + 10`)? That seems...odd.

I'm also not sure where str0 comes in...

I would suggest, though, that if you're not going to reuse the Java.Lang.String instance, that you dispose of it. This will allow the GC to release the instance faster:

	using (var s = new Java.Lang.String (&quot;Menu item 1&quot;))
		menu.Add(MenuGroup, menuItemId + 10, menuItemOrder + 1, s);

&gt;<i> The difference being that the ability to directly add a string as menu item has been removed and now I need to add these items based on adding an object that implements ICharSequence if I want to manually add a string.
</I>
Yes:

	<A HREF="http://monodroid.net/Releases/Previews/Preview_13#CharSequences">http://monodroid.net/Releases/Previews/Preview_13#CharSequences</A>

You, in fact, asked for this, though you may not have realized it:

	<A HREF="http://lists.ximian.com/mailman/private/monodroid/2011-February/002889.html">http://lists.ximian.com/mailman/private/monodroid/2011-February/002889.html</A>

In Preview 5 through Preview 12, the Java java.lang.CharSequence type was mapped to IEnumerable&lt;char&gt;. This had the useful property that .NET strings could be used as-is (yay), and we could support custom implementations such as Android.Text.SpannedString.

Unfortunately, this &quot;violated&quot; the assumption that a Text property would be of string type (it was instead IEnumerable&lt;char&gt;), so Preview 13 changes this so that:

  - Methods with ICharSequence parameters are overloaded to take both string and the new Java.Lang.ICharSequence type, e.g.
	Activity.OnChildTitleChanged(Activity, ICharSequence) [0]
	Activity.OnChildTitleChanged(Activity, string) [1]
  - Members which return ICharSequence are &quot;overloaded&quot; by appending &quot;Formatted&quot; to one of the member names:
	TextView.Text [2]
	TextView.TextFormatted [3]

Fairly straightforward...except for _interfaces_. MonoDroid cannot add or remove interface members. (We have some flexibility in how we expose them, e.g. converting methods into properties is fine, renaming members is fine, and we have some flexibility in the types that are exposed. Adding additional methods, as the above overloading technique requires, won't work.)

Which brings us to IMenu [4], which is an interface. Consequently, we can't overload the members as we can elsewhere, and the only IMenu.Add() method takes Java.Lang.ICharSequence, not string.

This is plausibly a bug; for interfaces, we could instead expose IEnumerable&lt;char&gt; (as we did before), which would allow implicit use of strings (as you desire), but then we get to IMenuItem [5], which would bring us full-circle: a type with a property (Title, in this case) which developers would expect to be of string type, but isn't.

We can't win for losing, now can we. :-/

 - Jon

[0] <A HREF="http://docs.monodroid.net/monodoc.ashx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,Java.Lang.ICharSequence">http://docs.monodroid.net/monodoc.ashx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,Java.Lang.ICharSequence</A>)

[1] <A HREF="http://docs.monodroid.net/index.aspx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,System.String">http://docs.monodroid.net/index.aspx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,System.String</A>)

[2] <A HREF="http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.Text">http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.Text</A>

[3] <A HREF="http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.TextFormatted">http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.TextFormatted</A>

[4] <A HREF="http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenu/*">http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenu/*</A>

[5] <A HREF="http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenuItem/*">http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenuItem/*</A>

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003343.html">[Monodroid] create a menu item
</A></li>
	<LI>Next message: <A HREF="003349.html">[Monodroid] create a menu item
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3348">[ date ]</a>
              <a href="thread.html#3348">[ thread ]</a>
              <a href="subject.html#3348">[ subject ]</a>
              <a href="author.html#3348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
