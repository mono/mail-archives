<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] Problems using WebClient.DownloadStringAsync
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Problems%20using%20WebClient.DownloadStringAsync&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003168.html">
   <LINK REL="Next"  HREF="003171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] Problems using WebClient.DownloadStringAsync</H1>
    <B>Thomas Due</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Problems%20using%20WebClient.DownloadStringAsync&In-Reply-To="
       TITLE="[Monodroid] Problems using WebClient.DownloadStringAsync">tho.due at gmail.com
       </A><BR>
    <I>Sun Feb 20 09:46:36 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003168.html">[Monodroid] Quick Hello! :)
</A></li>
        <LI>Next message: <A HREF="003171.html">[Monodroid] Problems using WebClient.DownloadStringAsync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3169">[ date ]</a>
              <a href="thread.html#3169">[ thread ]</a>
              <a href="subject.html#3169">[ subject ]</a>
              <a href="author.html#3169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am trying something really simple to get at feel for the AndroidMonodroid
model. I have spent several years on C# and consider myself somewhat
proficient.

This however, I cannot figure out.

I got a simple activity with two buttons and a TextView. See the attached
main.xml for the layout.

What I am trying to do, is simply to load an xml file from the internet into
the textview. One button does this synchronous using
Webclient.DownloadString. This works perfectly, although the fetching is
rather slow on a virtual device.

So, button2 is for asynchronous loading, and this fails. What happens, is I
get this:

UNHANDLED EXCEPTION:
&gt;<i> System.Reflection.TargetInvocationException
</I>

from VS2010 when debugging,

I close that dialog and continues and the app simply closes. The best I get
form the Device Logging is this:

I/ActivityManager(   57): Starting activity: Intent {
&gt;<i> act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER]
</I>&gt;<i> flg=0x10200000 cmp=due.cohstatus/monodroidapplication1.CohStatusActivity }
</I>&gt;<i> I/ActivityManager(   57): Start proc due.cohstatus for activity
</I>&gt;<i> due.cohstatus/monodroidapplication1.CohStatusActivity: pid=2432 uid=10029
</I>&gt;<i> gids={3003}
</I>&gt;<i> I/ActivityManager(   57): Starting activity: Intent {
</I>&gt;<i> act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER]
</I>&gt;<i> flg=0x10200000 cmp=due.cohstatus/monodroidapplication1.CohStatusActivity }
</I>&gt;<i> I/ActivityThread( 2432): Publishing provider due.cohstatus.__mono_init__:
</I>&gt;<i> mono.MonoRuntimeProvider
</I>&gt;<i> D/dalvikvm( 2432): Trying to load lib
</I>&gt;<i> /data/data/due.cohstatus/lib/libmonodroid.so 0x43d0c680
</I>&gt;<i> D/dalvikvm( 2432): Added shared lib
</I>&gt;<i> /data/data/due.cohstatus/lib/libmonodroid.so 0x43d0c680
</I>&gt;<i> D/dalvikvm( 2432): +++ not scanning '/system/lib/libwebcore.so' for 'init'
</I>&gt;<i> (wrong CL)
</I>&gt;<i> D/dalvikvm( 2432): +++ not scanning '/system/lib/libmedia_jni.so' for
</I>&gt;<i> 'init' (wrong CL)
</I>&gt;<i> D/dalvikvm( 2432): +++ not scanning '/system/lib/libexif.so' for 'init'
</I>&gt;<i> (wrong CL)
</I>&gt;<i> I/mkestner( 2432): environment does not support jni NewWeakGlobalRef
</I>&gt;<i> D/dalvikvm( 2432): GC freed 14184 objects / 504968 bytes in 90ms
</I>&gt;<i> D/dalvikvm( 2432): GC freed 10660 objects / 454376 bytes in 76ms
</I>&gt;<i> D/dalvikvm( 2432): +++ not scanning '/system/lib/libwebcore.so' for
</I>&gt;<i> 'register' (wrong CL)
</I>&gt;<i> D/dalvikvm( 2432): +++ not scanning '/system/lib/libmedia_jni.so' for
</I>&gt;<i> 'register' (wrong CL)
</I>&gt;<i> D/dalvikvm( 2432): +++ not scanning '/system/lib/libexif.so' for 'register'
</I>&gt;<i> (wrong CL)
</I>&gt;<i> D/dalvikvm( 2432): GC freed 11375 objects / 487192 bytes in 72ms
</I>&gt;<i> I/ActivityManager(   57): Displayed activity
</I>&gt;<i> due.cohstatus/monodroidapplication1.CohStatusActivity: 9053 ms (total 9053
</I>&gt;<i> ms)
</I>&gt;<i> E/mono    ( 2432): [0x407e78:] EXCEPTION handling:
</I>&gt;<i> System.Net.Sockets.SocketException: An address incompatible with the
</I>&gt;<i> requested protocol was used
</I>&gt;<i> D/dalvikvm(  137): GC freed 129 objects / 6096 bytes in 871ms
</I>&gt;<i> E/mono    ( 2432): [0x4229a0:] EXCEPTION handling:
</I>&gt;<i> Java.Lang.RuntimeException: Exception of type 'Java.Lang.RuntimeException'
</I>&gt;<i> was thrown.
</I>&gt;<i> E/mono    ( 2432): [0x4229a0:] EXCEPTION handling:
</I>&gt;<i> System.Reflection.TargetInvocationException: Exception has been thrown by
</I>&gt;<i> the target of an invocation.
</I>&gt;<i> E/mono    ( 2432):
</I>&gt;<i> E/mono    ( 2432): Unhandled Exception:
</I>&gt;<i> System.Reflection.TargetInvocationException: Exception has been thrown by
</I>&gt;<i> the target of an invocation. ---&gt; Java.Lang.RuntimeException: Exception of
</I>&gt;<i> type 'Java.Lang.RuntimeException' was thrown.
</I>&gt;<i> E/mono    ( 2432):   at Android.Runtime.JNIEnv.CallVoidMethod (IntPtr
</I>&gt;<i> jobject, IntPtr jmethod, Android.Runtime.JValue[] parms) [0x00000] in
</I>&gt;<i> &lt;filename unknown&gt;:0
</I>&gt;<i> E/mono    ( 2432):   at Android.Widget.TextView.set_Text (IEnumerable`1
</I>&gt;<i> value) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> E/mono    ( 2432):   at
</I>&gt;<i> monodroidapplication1.CohStatusActivity.&lt;LoadXmlASync&gt;b__2 (System.Object
</I>&gt;<i> sender, System.Net.DownloadStringCompletedEventArgs e) [0x00000] in
</I>&gt;<i> &lt;filename unknown&gt;:0
</I>&gt;<i> E/mono    ( 2432):   at System.Net.WebClient.OnDownloadStringCompleted
</I>&gt;<i> (System.Net.DownloadStringCompletedEventArgs args) [0x00000] in &lt;filename
</I>&gt;<i> unknown&gt;:0
</I>&gt;<i> E/mono    ( 2432):   at System.Net.WebClient.&lt;DownloadStringAsync&gt;m__E
</I>&gt;<i> (System.Object state) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> E/mono    ( 2432):   --- End of inner exception stack trace ---
</I>&gt;<i> E/mono    ( 2432):   at
</I>&gt;<i> System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary ()
</I>&gt;<i> [0x00000] in &lt;filename unkn
</I>&gt;<i> D/Zygote  (   30): Process 2432 exited cleanly (1)
</I>&gt;<i> I/ActivityManager(   57): Process due.cohstatus (pid 2432) has died.
</I>&gt;<i> I/WindowManager(   57): WIN DEATH: Window{43d80418
</I>&gt;<i> due.cohstatus/monodroidapplication1.CohStatusActivity paused=false}
</I>&gt;<i> I/UsageStats(   57): Unexpected resume of com.android.launcher while
</I>&gt;<i> already resumed in due.cohstatus
</I>&gt;<i> W/InputManagerService(   57): Got RemoteException sending setActive(false)
</I>&gt;<i> notification to pid 2432 uid 10029
</I>

So what is I doing wrong?

I have attached the project file itself, my code and layout.
--

Mvh
Thomas Due
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0001.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Activity1.cs
Type: application/octet-stream
Size: 2148 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0002.obj">http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0002.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MonoDroidApplication1.csproj
Type: application/octet-stream
Size: 3485 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0003.obj">http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0003.obj</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: main.xml
Type: text/xml
Size: 750 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0001.xml">http://lists.ximian.com/mailman/private/monodroid/attachments/20110220/61caf78a/attachment-0001.xml</A> 
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003168.html">[Monodroid] Quick Hello! :)
</A></li>
	<LI>Next message: <A HREF="003171.html">[Monodroid] Problems using WebClient.DownloadStringAsync
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3169">[ date ]</a>
              <a href="thread.html#3169">[ thread ]</a>
              <a href="subject.html#3169">[ subject ]</a>
              <a href="author.html#3169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
