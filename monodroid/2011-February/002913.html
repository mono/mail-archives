<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] PackageName isn't actually case sensitive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20PackageName%20isn%27t%20actually%20case%20sensitive&In-Reply-To=801A1AC4-6C6D-4093-AFCF-7A580A1E72F0%40novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002852.html">
   <LINK REL="Next"  HREF="002920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] PackageName isn't actually case sensitive</H1>
    <B>Stefan Rusek</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20PackageName%20isn%27t%20actually%20case%20sensitive&In-Reply-To=801A1AC4-6C6D-4093-AFCF-7A580A1E72F0%40novell.com"
       TITLE="[Monodroid] PackageName isn't actually case sensitive">stefan at rusek.org
       </A><BR>
    <I>Sun Feb  6 16:10:59 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002852.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
        <LI>Next message: <A HREF="002920.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2913">[ date ]</a>
              <a href="thread.html#2913">[ thread ]</a>
              <a href="subject.html#2913">[ subject ]</a>
              <a href="author.html#2913">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After thinking about this and rereading this thread several times. I think
we are making things more complicated than they really need to be. Android
(and AFAICT Java) use the same word package for two concepts. Often the apk
(or jar) file is referred to as a package and individual namespaces are also
referred to as packages. Android (also java) does not require that the
packages (namespaces) that you put inside a package (apk or jar) file match
the name of its container. Although android does provide some short-cuts for
referring to the apk package name from class name references within the
manifest xml file.

As far as this thread and bug is concerned I'm only care about the apk
package name. I could care less what namespace munging goes on to make
monodroid work.

It seems like the case that the current behavior is intended to prevent is
when a programmer creates a set of classes or namespaces which create a
case-folding conflict. It seems to me that instead of ToLower()ing all the
names, it would be more friendly in general to just check for case-folding
conflicts and creating a compilation error. This would allow for naming
rules more in-line with android naming rules, while preventing case-folding
violations.

That said, all I really want is to be able to give my monodroid apps the
same apk package name as my existing java apps (and preferrable not have to
use a stupid java-style namespace for my monodroid apps).

On Wed, Feb 2, 2011 at 21:19, Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">jpryor at novell.com</A>&gt; wrote:

&gt;<i> On Feb 2, 2011, at 2:38 PM, Stefan Rusek wrote:
</I>&gt;<i> &gt; Again, I wish to reiterate that I've used mixed case package names for
</I>&gt;<i> every android app I've written, both published and unpublished apps used
</I>&gt;<i> ant, Eclipse, and IntelliJ , and I've never had any of the case problems
</I>&gt;<i> you've expressed concerns about.
</I>&gt;<i>
</I>&gt;<i> These aren't concerns, these were actual issues that bit us. :-)
</I>&gt;<i>
</I>&gt;<i> TL;DR: I don't know of a reasonable way to support this that won't result
</I>&gt;<i> in pain and suffering, but I'm quite willing to find a way...
</I>&gt;<i>
</I>&gt;<i> That aside, the problems aren't in the use of ant, Eclipse, or IntelliJ,
</I>&gt;<i> the problem is threefold:
</I>&gt;<i>
</I>&gt;<i>  1. The package name is based on the namespaces used within the
</I>&gt;<i> application.
</I>&gt;<i>  2. Inconsistent capitalization of directory names, and
</I>&gt;<i>  3. Developing on Windows and OSX
</I>&gt;<i>
</I>&gt;<i> For (1), if the package name were com.example.Nifty, and all source code
</I>&gt;<i> were in the Nifty.App namespace, there would be no problem, as R.java would
</I>&gt;<i> be in the com.example.Nifty package, while the Java Proxy sources would be
</I>&gt;<i> in the nifty.app package -- no conflicts.  Unfortunately, I believe that it
</I>&gt;<i> will be fairly common for the namespace name and package name to be similar,
</I>&gt;<i> if only because our tooling does this by default.
</I>&gt;<i>
</I>&gt;<i> The inconsistent capitalization (2) can come in, as mentioned previously,
</I>&gt;<i> by having a package name of e.g. MonoDroid.Test, in which case `aapt` would
</I>&gt;<i> generate an R.java file into the MonoDroid.Test package, while monodroid
</I>&gt;<i> would have to place all generated sources into something with a lowercase
</I>&gt;<i> first letter, e.g. monodroid.test or monoDroid.test.  Either way, the
</I>&gt;<i> inconsistent capitalization, combined with a case insensitive filesystem
</I>&gt;<i> (3), results in broken .apks.
</I>&gt;<i>
</I>&gt;<i> (Use Linux, and things just work, but I doubt that saying &quot;Just Use Linux&quot;
</I>&gt;<i> is a viable solution. :-)
</I>&gt;<i>
</I>&gt;<i> That said, I'm not sure what an ideal solution would be.  A related issue
</I>&gt;<i> is with layout XML files, in which elements within the XML files correspond
</I>&gt;<i> to actual types.  Currently we lowercase the package names, resulting in XML
</I>&gt;<i> fragments such as [0]:
</I>&gt;<i>
</I>&gt;<i>    &lt;mono.samples.glcube.PaintingView ...
</I>&gt;<i>
</I>&gt;<i>  1. Would it work if we allowed mixed-case package names after the first
</I>&gt;<i> package-part?
</I>&gt;<i>
</I>&gt;<i>        &lt;mono.Samples.GLCube.PaintingView ...&gt;
</I>&gt;<i>
</I>&gt;<i>    It's entirely plausible that Android won't like that, but I haven't
</I>&gt;<i> tested.
</I>&gt;<i>
</I>&gt;<i>  2. Then there's the &quot;consistency&quot; angle -- the first package part would
</I>&gt;<i> need to be lowercase (original Factor #2), AND the type referenced is a Java
</I>&gt;<i> proxy for a managed type (Mono.Samples.GLCube.PaintingView, in the above
</I>&gt;<i> example).  I suspect that it would be very odd to developers that the first
</I>&gt;<i> namespace part would be lowercase/camelCased while the remaining parts were
</I>&gt;<i> unchanged, and they'd ask (rightfully) why they can't do:
</I>&gt;<i>
</I>&gt;<i>        &lt;Mono.Samples.GLCube.PaintingView ...&gt;
</I>&gt;<i>
</I>&gt;<i> Regardless, the major problem is how to avoid factors #3 and #4 in the
</I>&gt;<i> first place.  If our tooling just required that the first &quot;package part&quot; be
</I>&gt;<i> lowercase and ignored the casing for the rest, there's an implicit
</I>&gt;<i> requirement that the developer also be internally consistent; if not, things
</I>&gt;<i> break.  Consider:
</I>&gt;<i>
</I>&gt;<i>        &lt;!--  AndroidManifest.xml --&gt;
</I>&gt;<i>        &lt;manifest package=&quot;com.MyDemo&quot; ...
</I>&gt;<i>
</I>&gt;<i>        // C# source
</I>&gt;<i>        namespace com.MyDemo { public class A : Java.Lang.Object {} }
</I>&gt;<i>        namespace com.myDemo { public class B : Java.Lang.Object {} }
</I>&gt;<i>        namespace com.MYDEMO { public class C : Java.Lang.Object {} }
</I>&gt;<i>
</I>&gt;<i> Now, you can argue that developers shouldn't do that...but nothing stops
</I>&gt;<i> them.  If this were to happen, we'd have a com.MyDemo.R Java resource class,
</I>&gt;<i> plus generated Java sources com/MyDemo/A.java, com/myDemo/B.java, and
</I>&gt;<i> com/MYDEMO/C.java.  This WILL result in a broken .apk, and the developer
</I>&gt;<i> won't know until they try to run and go &quot;why the f*ck isn't this working?!&quot;
</I>&gt;<i> (which is how I ran across this in the first place...)
</I>&gt;<i>
</I>&gt;<i> Compare to the current &quot;lowercase package names&quot; approach, and the above
</I>&gt;<i> will compile and run without error.  However, you will break current
</I>&gt;<i> MonoDroid with:
</I>&gt;<i>
</I>&gt;<i>        namespace Foo { public class A : Java.Lang.Object {} }
</I>&gt;<i>        namespace foo { public class A : Java.Lang.Object {} }
</I>&gt;<i>
</I>&gt;<i> So it's not like the current approach is perfect either.
</I>&gt;<i>
</I>&gt;<i> Having thought through the issues while writing this response over the last
</I>&gt;<i> half hour, the only conclusion that comes to mind is to have monodroid
</I>&gt;<i> continue with the current &quot;lowercase package names in Java Proxies&quot;
</I>&gt;<i> algorithm, change the tooling so that the default package name differs from
</I>&gt;<i> the default namespace name, and adding logic to monodroid.exe to error out
</I>&gt;<i> if the package name is &quot;too similar&quot; to any namespace names found in the
</I>&gt;<i> assemblies.  In effect, it would codify an avoidance of issue (1) (above),
</I>&gt;<i> but I'm not sure how this would strike developers either.
</I>&gt;<i>
</I>&gt;<i> Alternative suggestions welcome.
</I>&gt;<i>
</I>&gt;<i>  - Jon
</I>&gt;<i>
</I>&gt;<i> [0]
</I>&gt;<i> <A HREF="https://github.com/mono/monodroid-samples/blob/master/GLCube/Resources/layout/main.xml">https://github.com/mono/monodroid-samples/blob/master/GLCube/Resources/layout/main.xml</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i>
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110206/4b71c1b6/attachment.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110206/4b71c1b6/attachment.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002852.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
	<LI>Next message: <A HREF="002920.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2913">[ date ]</a>
              <a href="thread.html#2913">[ thread ]</a>
              <a href="subject.html#2913">[ subject ]</a>
              <a href="author.html#2913">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
