<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] create a menu item
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20create%20a%20menu%20item&In-Reply-To=COL122-W34DDD234764CDCE061AA65AEDF0%40phx.gbl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003349.html">
   <LINK REL="Next"  HREF="003345.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] create a menu item</H1>
    <B>Milligan, Ryan</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20create%20a%20menu%20item&In-Reply-To=COL122-W34DDD234764CDCE061AA65AEDF0%40phx.gbl"
       TITLE="[Monodroid] create a menu item">Ryan.Milligan at wizards.com
       </A><BR>
    <I>Mon Feb 28 11:09:41 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003349.html">[Monodroid] create a menu item
</A></li>
        <LI>Next message: <A HREF="003345.html">[Monodroid] Android Activities and Google Maps API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3369">[ date ]</a>
              <a href="thread.html#3369">[ thread ]</a>
              <a href="subject.html#3369">[ subject ]</a>
              <a href="author.html#3369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That makes sense; however, if you can't add overloads, why not simply add extension methods? To make this scenario work for IMenu, you could just do this:

public interface IMenu
{
                // ...
                IMenuItem Add(Java.Lang.ICharSequence sequence);
}

public static class MenuHelpers
{
                public static IMenuItem Add(this IMenu menu, string sequence)
                {
                                using (var realSequence = new Java.Lang.String(sequence))
                                {
                                                return menu.Add(realSequence);
                                }
                }
}

This way we get the best of both worlds and maintain a reasonable amount of discoverability for the string overloads. If this doesn't go in the framework, I suspect many developers will just end doing it themselves anyway to avoid duplicating those using statements all over the place. The only flaw is that you can't add a property with extension methods - to have both a string property and an ICharSequence property, one of them will need to be an explicit get\set extension method pair. I think this still gives you better discoverability than what's there now, though.

                -- Ryan Milligan

From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Wally McClure
Sent: Saturday, February 26, 2011 8:06 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>
Subject: Re: [Monodroid] create a menu item

Thanks for the long explanation. I assumed it was my fault, it typically is.
I think I copied my lines in in reverse order, but I'm not sure that caused any issues in the translation.

Wally

&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">jpryor at novell.com</A>
</I>&gt;<i> Date: Sat, 26 Feb 2011 19:41:41 -0500
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Monodroid] create a menu item
</I>&gt;<i>
</I>&gt;<i> On Feb 26, 2011, at 3:58 PM, Wally McClure wrote:
</I>&gt;<i> &gt; I'm not quite sure when this changover happened, so apologies if this happened before p13.
</I>&gt;<i>
</I>&gt;<i> This is new to P13.
</I>&gt;<i>
</I>&gt;<i> &gt; I have some simple code that creates some menu items. The code is:
</I>&gt;<i> &gt;       menu.Add(MenuGroup, menuItemId + 20, menuItemOrder + 2, &quot;Menu item 1&quot;);
</I>&gt;<i> &gt; It now looks like I need to do this:
</I>&gt;<i> &gt;       menu.Add(MenuGroup, menuItemId + 10, menuItemOrder + 1, str0);
</I>&gt;<i> &gt;       Java.Lang.ICharsequence str = new Java.Lang.String(&quot;Menu item 1&quot;);
</I>&gt;<i>
</I>&gt;<i> P13 requires that you change the itemId parameter (`menuItemId + 20` vs. `menuItemId + 10`)? That seems...odd.
</I>&gt;<i>
</I>&gt;<i> I'm also not sure where str0 comes in...
</I>&gt;<i>
</I>&gt;<i> I would suggest, though, that if you're not going to reuse the Java.Lang.String instance, that you dispose of it. This will allow the GC to release the instance faster:
</I>&gt;<i>
</I>&gt;<i>          using (var s = new Java.Lang.String (&quot;Menu item 1&quot;))
</I>&gt;<i>                      menu.Add(MenuGroup, menuItemId + 10, menuItemOrder + 1, s);
</I>&gt;<i>
</I>&gt;<i> &gt; The difference being that the ability to directly add a string as menu item has been removed and now I need to add these items based on adding an object that implements ICharSequence if I want to manually add a string.
</I>&gt;<i>
</I>&gt;<i> Yes:
</I>&gt;<i>
</I>&gt;<i>          <A HREF="http://monodroid.net/Releases/Previews/Preview_13#CharSequences">http://monodroid.net/Releases/Previews/Preview_13#CharSequences</A>
</I>&gt;<i>
</I>&gt;<i> You, in fact, asked for this, though you may not have realized it:
</I>&gt;<i>
</I>&gt;<i>          <A HREF="http://lists.ximian.com/mailman/private/monodroid/2011-February/002889.html">http://lists.ximian.com/mailman/private/monodroid/2011-February/002889.html</A>
</I>&gt;<i>
</I>&gt;<i> In Preview 5 through Preview 12, the Java java.lang.CharSequence type was mapped to IEnumerable&lt;char&gt;. This had the useful property that .NET strings could be used as-is (yay), and we could support custom implementations such as Android.Text.SpannedString.
</I>&gt;<i>
</I>&gt;<i> Unfortunately, this &quot;violated&quot; the assumption that a Text property would be of string type (it was instead IEnumerable&lt;char&gt;), so Preview 13 changes this so that:
</I>&gt;<i>
</I>&gt;<i> - Methods with ICharSequence parameters are overloaded to take both string and the new Java.Lang.ICharSequence type, e.g.
</I>&gt;<i>          Activity.OnChildTitleChanged(Activity, ICharSequence) [0]
</I>&gt;<i>          Activity.OnChildTitleChanged(Activity, string) [1]
</I>&gt;<i> - Members which return ICharSequence are &quot;overloaded&quot; by appending &quot;Formatted&quot; to one of the member names:
</I>&gt;<i>          TextView.Text [2]
</I>&gt;<i>          TextView.TextFormatted [3]
</I>&gt;<i>
</I>&gt;<i> Fairly straightforward...except for _interfaces_. MonoDroid cannot add or remove interface members. (We have some flexibility in how we expose them, e.g. converting methods into properties is fine, renaming members is fine, and we have some flexibility in the types that are exposed. Adding additional methods, as the above overloading technique requires, won't work.)
</I>&gt;<i>
</I>&gt;<i> Which brings us to IMenu [4], which is an interface. Consequently, we can't overload the members as we can elsewhere, and the only IMenu.Add() method takes Java.Lang.ICharSequence, not string.
</I>&gt;<i>
</I>&gt;<i> This is plausibly a bug; for interfaces, we could instead expose IEnumerable&lt;char&gt; (as we did before), which would allow implicit use of strings (as you desire), but then we get to IMenuItem [5], which would bring us full-circle: a type with a property (Title, in this case) which developers would expect to be of string type, but isn't.
</I>&gt;<i>
</I>&gt;<i> We can't win for losing, now can we. :-/
</I>&gt;<i>
</I>&gt;<i> - Jon
</I>&gt;<i>
</I>&gt;<i> [0] <A HREF="http://docs.monodroid.net/monodoc.ashx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,Java.Lang.ICharSequence">http://docs.monodroid.net/monodoc.ashx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,Java.Lang.ICharSequence</A>)
</I>&gt;<i>
</I>&gt;<i> [1] <A HREF="http://docs.monodroid.net/index.aspx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,System.String">http://docs.monodroid.net/index.aspx?link=M:Android.App.Activity.OnChildTitleChanged(Android.App.Activity,System.String</A>)
</I>&gt;<i>
</I>&gt;<i> [2] <A HREF="http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.Text">http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.Text</A>
</I>&gt;<i>
</I>&gt;<i> [3] <A HREF="http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.TextFormatted">http://docs.monodroid.net/index.aspx?link=P:Android.Widget.TextView.TextFormatted</A>
</I>&gt;<i>
</I>&gt;<i> [4] <A HREF="http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenu/*">http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenu/*</A>
</I>&gt;<i>
</I>&gt;<i> [5] <A HREF="http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenuItem/*">http://docs.monodroid.net/index.aspx?link=T:Android.Views.IMenuItem/*</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i>
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110228/c1290a29/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110228/c1290a29/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003349.html">[Monodroid] create a menu item
</A></li>
	<LI>Next message: <A HREF="003345.html">[Monodroid] Android Activities and Google Maps API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3369">[ date ]</a>
              <a href="thread.html#3369">[ thread ]</a>
              <a href="subject.html#3369">[ subject ]</a>
              <a href="author.html#3369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
