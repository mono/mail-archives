<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] Jar files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Jar%20files&In-Reply-To=C97AB5CB.9FE5%25marcio%40cialogica.com.br">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003025.html">
   <LINK REL="Next"  HREF="003027.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] Jar files</H1>
    <B>Ted Neward</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Jar%20files&In-Reply-To=C97AB5CB.9FE5%25marcio%40cialogica.com.br"
       TITLE="[Monodroid] Jar files">ted at tedneward.com
       </A><BR>
    <I>Fri Feb 11 21:26:40 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003025.html">[Monodroid] Bonjour bindings?
</A></li>
        <LI>Next message: <A HREF="003027.html">[Monodroid] Jar files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3026">[ date ]</a>
              <a href="thread.html#3026">[ thread ]</a>
              <a href="subject.html#3026">[ subject ]</a>
              <a href="author.html#3026">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(I'm CCing the list again because hopefully the MonoDroid guys will catch me
where I'm making bad assumptions. I have NOT done this before with
Monodroid.)

 

JNI in Java is conceptually like P/Invoke in .NET, but without some of the
nifty enhancements that make P/Invoke (relatively) easy to use. Let me
explain the Java side of things, and then we can try to figure out how that
maps to Android and then .NET.

 

Assuming that you want to call from Java to native code, you have to do a
couple of things.

 

Java side:

1) Declare a method in Java as &quot;native&quot;. This tells the JVM to do a runtime
link by name to a native library, and serves as the method that the Java
code will call. In general, to help avoid certain kinds of craziness, you'll
want this method to be a static method.

2) Write a call to load the native library into the JVM by calling
&quot;System.loadLibrary(libName);&quot;. Note that &quot;libName&quot; is the name minus any
file adornments; so, for example, if you wanted to load USER32.DLL, you'd
&quot;loadLibrary(&quot;USER32&quot;);&quot; (minus the .DLL). This is because different dynamic
libraries have different filenames on different platforms (foo.dll on
Windows vs. libFoo.so on Linux, for example).

3) Compile the Java code. (If you run the Java code at this point, it'll
generate an &quot;UnsatisfiedLinkError&quot;.)

 

Native side:

4) Create a C/C++ declaration by running &quot;javah&quot; (a Java utility) against
the compiled Java source. This creates a .h file with the necessary C
declaration. The declarations will be declared using a series of typedef'ed
types defined in &quot;jni.h&quot;, which is in JDK/include, and which, for the most
part, are isomorphic to standard C types. &quot;jint&quot;, for example, is a signed
32-bit integer that usually maps pretty easily over to a C compiler's &quot;int&quot;
type. &quot;jobject&quot; and &quot;jstring&quot;, however, are reference types and will need to
use the JNI API to resolve-for simplest cases, avoid these in your Java
native method declarations. (You certainly don't have to, but trying to
convert a jstring over to a const char* is a bitch and a half.)

5) Create a C/C++ implementation of that declared method.

6) Compile the C/C++ implementation into a DLL. Ensure the DLL is
&quot;discoverable&quot; by the JVM-for the most part, standard &quot;LoadLibrary&quot; rules
will apply here. There's a Java property that can define additional
directories where native libraries can be found, but that's not relevant
right now.

7) Run the code; assuming your C/C++ code works correctly, all should be
golden.

 

Android:

The Android JNI story is mostly similar, except that in order to build the
Android native library, you're going to need the Android NDK (Native
Development Kit) to compile the native bits. There's a good number of
samples in the NDK, but basically the process is the same except it's done
as part of the Android build process, which takes care of a few niggling
details (like using the right C/C++ compiler).
<A HREF="http://developer.android.com/sdk/ndk">http://developer.android.com/sdk/ndk</A> is your friend here (if you're a native
Android developer).

 

MonoDroid:

Here's where my expertise ends.  I'm guessing that the native library would
still need to be compiled by the NDK, but setting up the C# declaration on
the MonoDroid end (the &quot;Java side&quot; steps above) would be the part I don't
know. I'm guessing that MonoDroid will somehow read PInvoke declarations
from C# and &quot;do the right thing&quot; to the Java/Dalvik bytecode declarations,
but that's pure guess on my part (and hence the reason I posted back to the
list).

 

Ted Neward

Java, .NET, XML Services

Consulting, Teaching, Speaking, Writing

<A HREF="http://www.tedneward.com">http://www.tedneward.com</A>

 

 

From: Marcio Alexandroni [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">marcio at cialogica.com.br</A>] 
Sent: Friday, February 11, 2011 3:46 AM
To: Ted Neward
Subject: Re: [Monodroid] Jar files

 

Hi Ted, thanks for your help.

I don't have any experience with Java, I'm a .NET developer, so I don't know
where to start binding the Jar classes/methods to C# code with MonoDroid.

If you have any simple sample code you can send me to help me start, that
would be great!

Thanks again.

Marcio Alexandroni
 ( (+55 11) 9989-8316
 marcioalexandroni
-- 




  _____  

From: Ted Neward &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">ted at tedneward.com</A>&gt;
Date: Fri, 11 Feb 2011 03:36:01 -0800
To: Marcio Alexandroni &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">marcio at cialogica.com.br</A>&gt;
Subject: RE: [Monodroid] Jar files

I've done a ton of Java/JNI in the past, so I might be able to help if
you're not past this already.
 

Ted Neward
Java, .NET, XML Services
Consulting, Teaching, Speaking, Writing
<A HREF="http://www.tedneward.com">http://www.tedneward.com</A> &lt;<A HREF="http://www.tedneward.com">http://www.tedneward.com</A>&gt; 

 

From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Marcio Alexandroni
Sent: Sunday, February 06, 2011 6:11 AM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
Subject: [Monodroid] Jar files

Hi,

Anyone tried the JNIEnv to use a 3rd party jar file? I would like to use a
Java library from my MonoDroid project but I read the support will be
available only after 1.0, so I'm looking on how to do it right now using the
JNIEnv. 

If anyone has any sample code to share, that would be great.

Thanks.

Marcio Alexandroni
 ( (+55 11) 9989-8316
marcioalexandroni
-- 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110211/f578a3e2/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110211/f578a3e2/attachment-0001.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 1720 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110211/f578a3e2/attachment-0001.png">http://lists.ximian.com/mailman/private/monodroid/attachments/20110211/f578a3e2/attachment-0001.png</A> 
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003025.html">[Monodroid] Bonjour bindings?
</A></li>
	<LI>Next message: <A HREF="003027.html">[Monodroid] Jar files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3026">[ date ]</a>
              <a href="thread.html#3026">[ thread ]</a>
              <a href="subject.html#3026">[ subject ]</a>
              <a href="author.html#3026">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
