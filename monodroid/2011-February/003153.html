<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] Jar files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Jar%20files&In-Reply-To=BBE3D6B3-AE50-4E73-B8DF-F98F53F7DA43%40novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003027.html">
   <LINK REL="Next"  HREF="003159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] Jar files</H1>
    <B>Hani Gobran</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Jar%20files&In-Reply-To=BBE3D6B3-AE50-4E73-B8DF-F98F53F7DA43%40novell.com"
       TITLE="[Monodroid] Jar files">hani at taxipass.com
       </A><BR>
    <I>Fri Feb 18 19:33:57 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003027.html">[Monodroid] Jar files
</A></li>
        <LI>Next message: <A HREF="003159.html">[Monodroid] Jar files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3153">[ date ]</a>
              <a href="thread.html#3153">[ thread ]</a>
              <a href="subject.html#3153">[ subject ]</a>
              <a href="author.html#3153">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jon,

Can you explain this a bit more.  I tried to follow this and looked at the
GoogleMap code/implementation but still am not sure I know what to do.  

I would like to add the PhoneGap framework and I add the jar code as a
AndroidNativeLibrary I get the following error:

C:\Program Files (x86)\MSBuild\Novell\monodroid.exe -v --nosign
--sdk-dir=&quot;C:\android-sdk-windows&quot; --builddir=&quot;C:\My
Projects\MonoDroid\TestMonoDroid\TestMonoDroid\obj\Debug\android&quot;
--framework-dir=&quot;C:\Program Files (x86)\Reference
Assemblies\Microsoft\Framework\MonoDroid\v2.1&quot; --framework-dir=&quot;C:\Program
Files (x86)\Reference Assemblies\Microsoft\Framework\MonoDroid\v1.0&quot;
-S=&quot;C:\My Projects\MonoDroid\TestMonoDroid\TestMonoDroid\obj\Debug\res&quot;
--package=&quot;com.taxipass.testmonodroid&quot; --abi=&quot;armeabi&quot;
--java-sdk-dir=&quot;C:\Program Files\Java\jdk1.6.0_21&quot; --debug
--manifest-template=&quot;C:\My
Projects\MonoDroid\TestMonoDroid\TestMonoDroid\Properties\AndroidManifest.xm
l&quot; --sdk-platform=&quot;7&quot; -nf=&quot;libs\phonegap.0.9.4.jar&quot; &quot;C:\My
Projects\MonoDroid\TestMonoDroid\TestMonoDroid\bin\Debug\TestMonoDroid.dll&quot;
&quot;C:\Program Files (x86)\Reference
Assemblies\Microsoft\Framework\MonoDroid\v2.1\Mono.Android.dll&quot; &quot;C:\Program
Files (x86)\Reference
Assemblies\Microsoft\Framework\MonoDroid\v1.0\mscorlib.dll&quot; &quot;C:\Program
Files (x86)\Reference
Assemblies\Microsoft\Framework\MonoDroid\v1.0\System.Core.dll&quot; &quot;C:\Program
Files (x86)\Reference
Assemblies\Microsoft\Framework\MonoDroid\v1.0\System.dll&quot; &quot;C:\Program Files
(x86)\Reference
Assemblies\Microsoft\Framework\MonoDroid\v1.0\System.Xml.dll&quot; &quot;C:\Program
Files (x86)\Reference
Assemblies\Microsoft\Framework\MonoDroid\v1.0\System.Xml.Linq.dll&quot; 
  monodroid: Could not determine the ABI for library
'libs\phonegap.0.9.4.jar.  Please use -nf=libs\phonegap.0.9.4.jar,ABI.


-Hani


-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Jonathan Pryor
Sent: Friday, February 11, 2011 7:37 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>
Subject: Re: [Monodroid] Jar files

To answer the original question, support for using Android.Runtime.JNIEnv
with third party .jar files will require Preview 13:

	<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=661858">https://bugzilla.novell.com/show_bug.cgi?id=661858</A>

(because such support requires compiling the .jar files into .dex files for
use by Dalvik, and that support didn't land in any form until today...)

The existing Build Action AndroidJavaSource support would support your
providing your own .java files with 'native' method declarations, then
including a native .so which would implement those methods (pretty much ye
standard JNI usage), though you'd want to also use Build Action
AndroidNativeLibrary to include the native library into the final .apk.

 - Jon

On Feb 11, 2011, at 9:26 PM, Ted Neward wrote:

&gt;<i> (I'm CCing the list again because hopefully the MonoDroid guys will catch
</I>me where I'm making bad assumptions. I have NOT done this before with
Monodroid.)
&gt;<i>  
</I>&gt;<i> JNI in Java is conceptually like P/Invoke in .NET, but without some of the
</I>nifty enhancements that make P/Invoke (relatively) easy to use. Let me
explain the Java side of things, and then we can try to figure out how that
maps to Android and then .NET.
&gt;<i>  
</I>&gt;<i> Assuming that you want to call from Java to native code, you have to do a
</I>couple of things.
&gt;<i>  
</I>&gt;<i> Java side:
</I>&gt;<i> 1) Declare a method in Java as &quot;native&quot;. This tells the JVM to do a
</I>runtime link by name to a native library, and serves as the method that the
Java code will call. In general, to help avoid certain kinds of craziness,
you'll want this method to be a static method.
&gt;<i> 2) Write a call to load the native library into the JVM by calling
</I>&quot;System.loadLibrary(libName);&quot;. Note that &quot;libName&quot; is the name minus any
file adornments; so, for example, if you wanted to load USER32.DLL, you'd
&quot;loadLibrary(&quot;USER32&quot;);&quot; (minus the .DLL). This is because different dynamic
libraries have different filenames on different platforms (foo.dll on
Windows vs. libFoo.so on Linux, for example).
&gt;<i> 3) Compile the Java code. (If you run the Java code at this point, it'll
</I>generate an &quot;UnsatisfiedLinkError&quot;.)
&gt;<i>  
</I>&gt;<i> Native side:
</I>&gt;<i> 4) Create a C/C++ declaration by running &quot;javah&quot; (a Java utility) against
</I>the compiled Java source. This creates a .h file with the necessary C
declaration. The declarations will be declared using a series of typedef'ed
types defined in &quot;jni.h&quot;, which is in JDK/include, and which, for the most
part, are isomorphic to standard C types. &quot;jint&quot;, for example, is a signed
32-bit integer that usually maps pretty easily over to a C compiler's &quot;int&quot;
type. &quot;jobject&quot; and &quot;jstring&quot;, however, are reference types and will need to
use the JNI API to resolve-for simplest cases, avoid these in your Java
native method declarations. (You certainly don't have to, but trying to
convert a jstring over to a const char* is a bitch and a half.)
&gt;<i> 5) Create a C/C++ implementation of that declared method.
</I>&gt;<i> 6) Compile the C/C++ implementation into a DLL. Ensure the DLL is
</I>&quot;discoverable&quot; by the JVM-for the most part, standard &quot;LoadLibrary&quot; rules
will apply here. There's a Java property that can define additional
directories where native libraries can be found, but that's not relevant
right now.
&gt;<i> 7) Run the code; assuming your C/C++ code works correctly, all should be
</I>golden.
&gt;<i>  
</I>&gt;<i> Android:
</I>&gt;<i> The Android JNI story is mostly similar, except that in order to build the
</I>Android native library, you're going to need the Android NDK (Native
Development Kit) to compile the native bits. There's a good number of
samples in the NDK, but basically the process is the same except it's done
as part of the Android build process, which takes care of a few niggling
details (like using the right C/C++
compiler).<A HREF="http://developer.android.com/sdk/ndk">http://developer.android.com/sdk/ndk</A> is your friend here (if
you're a native Android developer).
&gt;<i>  
</I>&gt;<i> MonoDroid:
</I>&gt;<i> Here's where my expertise ends.  I'm guessing that the native library
</I>would still need to be compiled by the NDK, but setting up the C#
declaration on the MonoDroid end (the &quot;Java side&quot; steps above) would be the
part I don't know. I'm guessing that MonoDroid will somehow read PInvoke
declarations from C# and &quot;do the right thing&quot; to the Java/Dalvik bytecode
declarations, but that's pure guess on my part (and hence the reason I
posted back to the list).
&gt;<i>  
</I>&gt;<i> Ted Neward
</I>&gt;<i> Java, .NET, XML Services
</I>&gt;<i> Consulting, Teaching, Speaking, Writing
</I>&gt;<i> <A HREF="http://www.tedneward.com">http://www.tedneward.com</A>
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> From: Marcio Alexandroni [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">marcio at cialogica.com.br</A>] 
</I>&gt;<i> Sent: Friday, February 11, 2011 3:46 AM
</I>&gt;<i> To: Ted Neward
</I>&gt;<i> Subject: Re: [Monodroid] Jar files
</I>&gt;<i>  
</I>&gt;<i> Hi Ted, thanks for your help.
</I>&gt;<i> 
</I>&gt;<i> I don't have any experience with Java, I'm a .NET developer, so I don't
</I>know where to start binding the Jar classes/methods to C# code with
MonoDroid.
&gt;<i> 
</I>&gt;<i> If you have any simple sample code you can send me to help me start, that
</I>would be great!
&gt;<i> 
</I>&gt;<i> Thanks again.
</I>&gt;<i> 
</I>&gt;<i> Marcio Alexandroni
</I>&gt;<i>  ( (+55 11) 9989-8316
</I>&gt;<i> &lt;image001.png&gt; marcioalexandroni
</I>&gt;<i> -- 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> From: Ted Neward &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">ted at tedneward.com</A>&gt;
</I>&gt;<i> Date: Fri, 11 Feb 2011 03:36:01 -0800
</I>&gt;<i> To: Marcio Alexandroni &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">marcio at cialogica.com.br</A>&gt;
</I>&gt;<i> Subject: RE: [Monodroid] Jar files
</I>&gt;<i> 
</I>&gt;<i> I've done a ton of Java/JNI in the past, so I might be able to help if
</I>you're not past this already.
&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Ted Neward
</I>&gt;<i> Java, .NET, XML Services
</I>&gt;<i> Consulting, Teaching, Speaking, Writing
</I>&gt;<i> <A HREF="http://www.tedneward.com">http://www.tedneward.com</A> &lt;<A HREF="http://www.tedneward.com">http://www.tedneward.com</A>&gt; 
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
</I>[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Marcio Alexandroni
&gt;<i> Sent: Sunday, February 06, 2011 6:11 AM
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> Subject: [Monodroid] Jar files
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Anyone tried the JNIEnv to use a 3rd party jar file? I would like to use a
</I>Java library from my MonoDroid project but I read the support will be
available only after 1.0, so I'm looking on how to do it right now using the
JNIEnv. 
&gt;<i> 
</I>&gt;<i> If anyone has any sample code to share, that would be great.
</I>&gt;<i> 
</I>&gt;<i> Thanks.
</I>&gt;<i> 
</I>&gt;<i> Marcio Alexandroni
</I>&gt;<i>  ( (+55 11) 9989-8316
</I>&gt;<i> &lt;image001.png&gt;marcioalexandroni
</I>&gt;<i> --
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> 
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>
_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003027.html">[Monodroid] Jar files
</A></li>
	<LI>Next message: <A HREF="003159.html">[Monodroid] Jar files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3153">[ date ]</a>
              <a href="thread.html#3153">[ thread ]</a>
              <a href="subject.html#3153">[ subject ]</a>
              <a href="author.html#3153">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
