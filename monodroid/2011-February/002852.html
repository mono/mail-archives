<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] PackageName isn't actually case sensitive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20PackageName%20isn%27t%20actually%20case%20sensitive&In-Reply-To=AANLkTi%3D6_rWV1TqUL1UNwmv_q%2Botz5cT0oUX%2B%3DsfiEF4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002851.html">
   <LINK REL="Next"  HREF="002913.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] PackageName isn't actually case sensitive</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20PackageName%20isn%27t%20actually%20case%20sensitive&In-Reply-To=AANLkTi%3D6_rWV1TqUL1UNwmv_q%2Botz5cT0oUX%2B%3DsfiEF4%40mail.gmail.com"
       TITLE="[Monodroid] PackageName isn't actually case sensitive">jpryor at novell.com
       </A><BR>
    <I>Wed Feb  2 15:19:40 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002851.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
        <LI>Next message: <A HREF="002913.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2852">[ date ]</a>
              <a href="thread.html#2852">[ thread ]</a>
              <a href="subject.html#2852">[ subject ]</a>
              <a href="author.html#2852">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 2, 2011, at 2:38 PM, Stefan Rusek wrote:
&gt;<i> Again, I wish to reiterate that I've used mixed case package names for every android app I've written, both published and unpublished apps used ant, Eclipse, and IntelliJ , and I've never had any of the case problems you've expressed concerns about.
</I>
These aren't concerns, these were actual issues that bit us. :-)

TL;DR: I don't know of a reasonable way to support this that won't result in pain and suffering, but I'm quite willing to find a way...

That aside, the problems aren't in the use of ant, Eclipse, or IntelliJ, the problem is threefold:

 1. The package name is based on the namespaces used within the application.
 2. Inconsistent capitalization of directory names, and
 3. Developing on Windows and OSX

For (1), if the package name were com.example.Nifty, and all source code were in the Nifty.App namespace, there would be no problem, as R.java would be in the com.example.Nifty package, while the Java Proxy sources would be in the nifty.app package -- no conflicts.  Unfortunately, I believe that it will be fairly common for the namespace name and package name to be similar, if only because our tooling does this by default.

The inconsistent capitalization (2) can come in, as mentioned previously, by having a package name of e.g. MonoDroid.Test, in which case `aapt` would generate an R.java file into the MonoDroid.Test package, while monodroid would have to place all generated sources into something with a lowercase first letter, e.g. monodroid.test or monoDroid.test.  Either way, the inconsistent capitalization, combined with a case insensitive filesystem (3), results in broken .apks.

(Use Linux, and things just work, but I doubt that saying &quot;Just Use Linux&quot; is a viable solution. :-)

That said, I'm not sure what an ideal solution would be.  A related issue is with layout XML files, in which elements within the XML files correspond to actual types.  Currently we lowercase the package names, resulting in XML fragments such as [0]:

    &lt;mono.samples.glcube.PaintingView ...

 1. Would it work if we allowed mixed-case package names after the first package-part?

	&lt;mono.Samples.GLCube.PaintingView ...&gt;

    It's entirely plausible that Android won't like that, but I haven't tested.

 2. Then there's the &quot;consistency&quot; angle -- the first package part would need to be lowercase (original Factor #2), AND the type referenced is a Java proxy for a managed type (Mono.Samples.GLCube.PaintingView, in the above example).  I suspect that it would be very odd to developers that the first namespace part would be lowercase/camelCased while the remaining parts were unchanged, and they'd ask (rightfully) why they can't do:

	&lt;Mono.Samples.GLCube.PaintingView ...&gt;

Regardless, the major problem is how to avoid factors #3 and #4 in the first place.  If our tooling just required that the first &quot;package part&quot; be lowercase and ignored the casing for the rest, there's an implicit requirement that the developer also be internally consistent; if not, things break.  Consider:

	&lt;!--  AndroidManifest.xml --&gt;
	&lt;manifest package=&quot;com.MyDemo&quot; ...

	// C# source
	namespace com.MyDemo { public class A : Java.Lang.Object {} }
	namespace com.myDemo { public class B : Java.Lang.Object {} }
	namespace com.MYDEMO { public class C : Java.Lang.Object {} }

Now, you can argue that developers shouldn't do that...but nothing stops them.  If this were to happen, we'd have a com.MyDemo.R Java resource class, plus generated Java sources com/MyDemo/A.java, com/myDemo/B.java, and com/MYDEMO/C.java.  This WILL result in a broken .apk, and the developer won't know until they try to run and go &quot;why the f*ck isn't this working?!&quot; (which is how I ran across this in the first place...)

Compare to the current &quot;lowercase package names&quot; approach, and the above will compile and run without error.  However, you will break current MonoDroid with:

	namespace Foo { public class A : Java.Lang.Object {} }
	namespace foo { public class A : Java.Lang.Object {} }

So it's not like the current approach is perfect either.

Having thought through the issues while writing this response over the last half hour, the only conclusion that comes to mind is to have monodroid continue with the current &quot;lowercase package names in Java Proxies&quot; algorithm, change the tooling so that the default package name differs from the default namespace name, and adding logic to monodroid.exe to error out if the package name is &quot;too similar&quot; to any namespace names found in the assemblies.  In effect, it would codify an avoidance of issue (1) (above), but I'm not sure how this would strike developers either.

Alternative suggestions welcome.

 - Jon

[0] <A HREF="https://github.com/mono/monodroid-samples/blob/master/GLCube/Resources/layout/main.xml">https://github.com/mono/monodroid-samples/blob/master/GLCube/Resources/layout/main.xml</A>

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002851.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
	<LI>Next message: <A HREF="002913.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2852">[ date ]</a>
              <a href="thread.html#2852">[ thread ]</a>
              <a href="subject.html#2852">[ subject ]</a>
              <a href="author.html#2852">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
