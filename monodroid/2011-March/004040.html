<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Antwort: Re: Problem with RunOnUiThread + Error	&quot;giving up&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Antwort%3A%20Re%3A%20Problem%20with%20RunOnUiThread%20%2B%20Error%0A%09%22giving%20up%22&In-Reply-To=7B73CDEB-8389-4ACD-8101-7E29148EA25B%40novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003823.html">
   <LINK REL="Next"  HREF="003821.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Antwort: Re: Problem with RunOnUiThread + Error	&quot;giving up&quot;</H1>
    <B>BernhardGessler at cs-ag.de</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Antwort%3A%20Re%3A%20Problem%20with%20RunOnUiThread%20%2B%20Error%0A%09%22giving%20up%22&In-Reply-To=7B73CDEB-8389-4ACD-8101-7E29148EA25B%40novell.com"
       TITLE="[mono-android] Antwort: Re: Problem with RunOnUiThread + Error	&quot;giving up&quot;">BernhardGessler at cs-ag.de
       </A><BR>
    <I>Wed Mar 30 19:13:15 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003823.html">[mono-android] Problem with RunOnUiThread
</A></li>
        <LI>Next message: <A HREF="003821.html">[mono-android] axml files issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4040">[ date ]</a>
              <a href="thread.html#4040">[ thread ]</a>
              <a href="subject.html#4040">[ subject ]</a>
              <a href="author.html#4040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

i've made some progress here. My Original Problem was that while a long 
enduring task i regularly (2-5 times per second) updated my UI like this:

                this._logic.LogAdded += (message) =&gt;
            {
                this.RunOnUiThread(() =&gt;
                {
                    this._textLog = FindViewById&lt;TextView&gt;(Resource.Id
.sync_textLog);
                    this._textLog.Text = DateTime.Now.ToShortTimeString() 
+ &quot;:&quot; + DateTime.Now.Second.ToString(&quot;D2&quot;) + &quot;  &quot; + message + Environment
.NewLine + this._textLog.Text;
                });
            };

i got the following error:

03-21 15:25:03.561  6101  6101 I MonoDroid: UNHANDLED EXCEPTION: 
System.NullReferenceException: Object reference not set to an instance of 
an object
03-21 15:25:03.561  6101  6101 I MonoDroid: at 
Java.Lang.Thread/RunnableImplementor.Run () &lt;0x000c4&gt;
03-21 15:25:03.561  6101  6101 I MonoDroid: at 
Java.Lang.IRunnableAdapter.n_Run (intptr,intptr) &lt;0x00037&gt;
03-21 15:25:03.561  6101  6101 I MonoDroid: at (wrapper dynamic-method) 
object.7ff79b2e-d6ec-474f-aeea-a56a20c8aa9d (intptr,intptr) &lt;0x0002b&gt;
03-21 15:25:03.639  6101  6101 E mono    : 
03-21 15:25:03.639  6101  6101 E mono    : Unhandled Exception: 
System.NullReferenceException: Object reference not set to an instance of 
an object
03-21 15:25:03.639  6101  6101 E mono    :   at 
Java.Lang.Thread+RunnableImplementor.Run () [0x00000] in &lt;filename 
unknown&gt;:0 
03-21 15:25:03.639  6101  6101 E mono    :   at 
Java.Lang.IRunnableAdapter.n_Run (IntPtr jnienv, IntPtr native__this) 
[0x00000] in &lt;filename unknown&gt;:0 
03-21 15:25:03.639  6101  6101 E mono    :   at (wrapper dynamic-method) 
object:7ff79b2e-d6ec-474f-aeea-a56a20c8aa9d (intptr,intptr)
03-21 15:25:03.671  1325  1478 I ActivityManager: Process CSMobile.UI (pid 
6101) has died.

Adding try/catch didn't help.
I then limited the Textlength in  in my TextView via 

           string log = this._textLog.Text;
                        if (log.Length &gt; 1000)
                        {
                            log = log.Substring(0, 999);
                        }
                        this._textLog.Text = log;

Since then I got no more NullReferenceExceptions. But now i'm getting a 
new error:

03-31 00:23:33.939  4067  4067 I dalvikvm: &quot;main&quot; prio=5 tid=1 RUNNABLE
03-31 00:23:33.939  4067  4067 I dalvikvm:   | group=&quot;main&quot; sCount=0 
dsCount=0 s=N obj=0x40020990 self=0xce50
03-31 00:23:33.939  4067  4067 I dalvikvm:   | sysTid=4067 nice=0 
sched=0/0 cgrp=default handle=-1345017744
03-31 00:23:33.939  4067  4067 I dalvikvm:   | schedstat=( 10213165196 
4036560128 7403 )
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
java.lang.Runtime.gc(Native Method)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
java.lang.System.gc(System.java:246)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
mono.java.lang.IRunnableAdapter.n_run(Native Method)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
mono.java.lang.IRunnableAdapter.run(IRunnableAdapter.java:9)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.os.Handler.handleCallback(Handler.java:587)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.os.Handler.dispatchMessage(Handler.java:92)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.os.Looper.loop(Looper.java:143)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.app.ActivityThread.main(ActivityThread.java:4717)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
java.lang.reflect.Method.invokeNative(Native Method)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
java.lang.reflect.Method.invoke(Method.java:521)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
com.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
dalvik.system.NativeStart.main(Native Method)
03-31 00:23:33.939  4067  4067 I dalvikvm: 
03-31 00:23:33.939  4067  4067 I dalvikvm: &quot;Thread-42&quot; prio=5 tid=8 
RUNNABLE JIT
03-31 00:23:33.939  4067  4067 I dalvikvm:   | group=&quot;main&quot; sCount=1 
dsCount=0 s=N obj=0x45bd8620 self=0x690a30
03-31 00:23:33.939  4067  4067 I dalvikvm:   | sysTid=4119 nice=0 
sched=0/0 cgrp=default handle=4259048
03-31 00:23:33.939  4067  4067 I dalvikvm:   | schedstat=( 652404783 
111968994 259 )
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.os.MessageQueue.enqueueMessage(MessageQueue.java:~208)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.os.Handler.sendMessageAtTime(Handler.java:457)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.os.Handler.sendMessageDelayed(Handler.java:430)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.os.Handler.post(Handler.java:248)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
android.app.Activity.runOnUiThread(Activity.java:3724)
03-31 00:23:33.939  4067  4067 I dalvikvm:   at 
dalvik.system.NativeStart.run(Native Method)

.
.
. (continues like this)

03-31 00:23:39.983  4067  4067 E dalvikvm: threadid=1: stuck on 
threadid=8, giving up
03-31 00:23:39.983  4067  4067 D dalvikvm: threadid=1: sending two 
SIGSTKFLTs to threadid=8 (tid=4119) to cause debuggerd dump
03-31 00:23:41.987  4067  4067 D dalvikvm: Sent, pausing to let debuggerd 
run
03-31 00:23:49.990  4067  4067 D dalvikvm: Continuing
03-31 00:23:49.990  4067  4067 E dalvikvm: VM aborting
03-31 00:23:50.022  1321  1321 I ActivityManager: Process CSMobile.UI (pid 
4067) has died.


If I comment out the whole RunOnUiThread no error appears.

I've managed to build a testscenario that throws both types of errors:

    public class Activity1 : Activity
    {
        TextView textview;
        private const int testCase = 0;

        protected override void OnCreate(Bundle bundle)
        {
            base.OnCreate(bundle);

            textview = new TextView(this);
            textview.Text = &quot;Working..&quot;;
            SetContentView(textview);

            ThreadPool.QueueUserWorkItem(o =&gt; MemUsage());
        }

        void MemUsage()
        {
            List&lt;string&gt; l = new List&lt;string&gt;();

            // Simulating Heavy Memory Usage
            for (int i = 0; i &lt; 1000000; i++)
            {
                string h = &quot;Hello&quot;;
                string w = &quot;World&quot;;

                int a = i + 2;

                l.Add(h + w + a);

                Log.Info(&quot;BUGTEST&quot;, i.ToString());

                if (i % 100 == 0) RunOnUiThread(() =&gt;
                {
                    string log = textview.Text;

                    if (testCase == 1)
                    {
                        if (log.Length &gt; 1000)
                        {
                            log = log.Substring(0, 999);
                        }
                    }

                    textview.Text = h + w + a + System.Environment.NewLine 
+ log;
                });
            }
        }

        public override void OnLowMemory()
        {
            Log.Info(&quot;BUGTEST&quot;, &quot;ON Low Memory&quot;);
        }
    }

Change testCase to 1 to get the second type of error. It doesn't seem to 
be a problem of low memory as the logentry in OnLowMemory() in never 
written.


Thanks for your help in advance

Bernhard Ge&#223;ler





Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">jpryor at novell.com</A>&gt; 
Gesendet von: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
21.03.2011 16:43
Bitte antworten an
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>


An
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>
Kopie
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">HagenBackhaus at cs-ag.de</A>
Thema
Re: [mono-android] Problem with RunOnUiThread






On Mar 21, 2011, at 11:16 AM, <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">BernhardGessler at cs-ag.de</A> wrote:
&gt;<i> in my app i run a backgroundthread according to the example on the 
</I>monodroid homepage: 
&gt;<i> 
</I><A HREF="http://mono-android.net/Documentation/Guides/Writing_Responsive_Applications">http://mono-android.net/Documentation/Guides/Writing_Responsive_Applications</A> 


Please file a complete test case so that we can investigate further.

 - Jon

_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110331/b7b2c561/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110331/b7b2c561/attachment-0001.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003823.html">[mono-android] Problem with RunOnUiThread
</A></li>
	<LI>Next message: <A HREF="003821.html">[mono-android] axml files issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4040">[ date ]</a>
              <a href="thread.html#4040">[ thread ]</a>
              <a href="subject.html#4040">[ subject ]</a>
              <a href="author.html#4040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
