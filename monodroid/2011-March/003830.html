<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] DrawLine problem with Paint.StrokeWidth = 1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20DrawLine%20problem%20with%20Paint.StrokeWidth%20%3D%201&In-Reply-To=01d401cbe7e7%2421c4d340%24654e79c0%24%40com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003825.html">
   <LINK REL="Next"  HREF="003841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] DrawLine problem with Paint.StrokeWidth = 1</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20DrawLine%20problem%20with%20Paint.StrokeWidth%20%3D%201&In-Reply-To=01d401cbe7e7%2421c4d340%24654e79c0%24%40com"
       TITLE="[mono-android] DrawLine problem with Paint.StrokeWidth = 1">jpryor at novell.com
       </A><BR>
    <I>Mon Mar 21 15:33:22 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003825.html">[mono-android] DrawLine problem with Paint.StrokeWidth = 1
</A></li>
        <LI>Next message: <A HREF="003841.html">[mono-android] DrawLine problem with Paint.StrokeWidth = 1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3830">[ date ]</a>
              <a href="thread.html#3830">[ thread ]</a>
              <a href="subject.html#3830">[ subject ]</a>
              <a href="author.html#3830">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mar 21, 2011, at 12:43 PM, Narc&#237;s Calvet wrote:
&gt;<i> Finally came up with the code example below which reproduces the text
</I>&gt;<i> problem with minSdkVersion attribute. At
</I>&gt;<i> <A HREF="http://www.steema.us/files/public/support/TextIssue.zip">http://www.steema.us/files/public/support/TextIssue.zip</A> you can download the
</I>&gt;<i> two screenshots I took. One has the minSdkVersion attribute and the other
</I>&gt;<i> not. Initializing the Paint object using the antialias flag doesn't help
</I>&gt;<i> either. Do you have any idea on what may be going on here?
</I>
Repeat after me: Android hates me.

Wait, wrong koan.

As suggested earlier, I surmised that Android goes to some degree of backward compatibility so that older apps will look &quot;right&quot; on more recent platforms, and that providing //uses-sdk/@android:minSdkVersion &quot;turns off&quot; this backward compatibility.

Eureka! Urls!

	<A HREF="http://developer.android.com/guide/practices/screens_support.html#attrs">http://developer.android.com/guide/practices/screens_support.html#attrs</A>
	<A HREF="http://developer.android.com/guide/topics/manifest/supports-screens-element.html">http://developer.android.com/guide/topics/manifest/supports-screens-element.html</A>

And probably hundreds of others that I'm not aware of.

That being the case, pay particular attention to the first URL above, particularly the table header:

	Attribute
	Description
	Default value, when minSdkVersion or targetSdkVersion is 4 or lower
	Default value, when minSdkVersion or targetSdkVersion is 5 or higher

In short, when it comes to screen handling, _lots_ of things changed at API level 5 (which you're targeting), in particular the //supports-screen/@android:anyDensity attribute (and others).

This is why when you're missing //uses-sdk you have ~52 lines shown, and when you have //uses-sdk you have ~77 lines shown: Android thinks you're an older program, and scales your output accordingly.

That background out of the way, what's the fix?

Manually manage DPI yourself, by scaling your output appropriately. For example, this works for me in MyControl.OnDraw, taking the number of lines shown down from ~72 to ~48:

	protected override void OnDraw(Canvas canvas)
	{
		base.OnDraw(canvas);

		Display disp = GetDisplay();

		var metrics = new DisplayMetrics();
		disp.GetMetrics (metrics);

		Paint p = new Paint();
		p.Color = Color.Lime;
		p.TextSize *= metrics.Density;

		int count = 0;

		for (int y = 0; y &lt; disp.Height; y=y+(int) (10*metrics.Density))
		{
			Random rand = new Random();
			canvas.DrawText(count.ToString() + &quot; - &quot; + rand.Next().ToString(), 100, y, p);
 			count++;
		}
	}

 - Jon

</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003825.html">[mono-android] DrawLine problem with Paint.StrokeWidth = 1
</A></li>
	<LI>Next message: <A HREF="003841.html">[mono-android] DrawLine problem with Paint.StrokeWidth = 1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3830">[ date ]</a>
              <a href="thread.html#3830">[ thread ]</a>
              <a href="subject.html#3830">[ subject ]</a>
              <a href="author.html#3830">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
