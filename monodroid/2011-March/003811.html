<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Googlemap sample and Java -&gt; MDr interop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Googlemap%20sample%20and%20Java%20-%3E%20MDr%20interop&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003822.html">
   <LINK REL="Next"  HREF="003812.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Googlemap sample and Java -&gt; MDr interop</H1>
    <B>Yann Schwartz</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Googlemap%20sample%20and%20Java%20-%3E%20MDr%20interop&In-Reply-To="
       TITLE="[mono-android] Googlemap sample and Java -&gt; MDr interop">abolibibelot at gmail.com
       </A><BR>
    <I>Mon Mar 21 09:13:15 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003822.html">[mono-android] BaseAdapter and JavaList problem
</A></li>
        <LI>Next message: <A HREF="003812.html">[mono-android] Custom Application Object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3811">[ date ]</a>
              <a href="thread.html#3811">[ thread ]</a>
              <a href="subject.html#3811">[ subject ]</a>
              <a href="author.html#3811">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i> On Mar 19, 2011, at 4:25 PM, Yann Schwartz wrote:
</I>&gt;<i> &gt;* I could write everything in Java *shudder* or have a nicely populated ArrayList&lt;OverlayItem&gt; sent from a .NET class instance (or from a static member of a .NET class, I'm not being difficult here) where the grunt work will be done.*
</I>&gt;<i> It'll be ugly, but you could create such a list in managed code by using Android.Runtime.JavaList&lt;Java.Lang.Object&gt; (which is implemented as a java.util.ArrayList), then using JNIEnv to create OverlayItem instances and set fields/etc:
</I>&gt;<i>
</I>&gt;<i> 	var list = new JavaList&lt;Java.Lang.Object&gt;();
</I>&gt;<i> 	IntPtr OverlayItem = JNIEnv.FindClass(&quot;com/google/android/maps/OverlayItem&quot;);
</I>&gt;<i> 	IntPtr ctor = JNIEnv.GetMethodId (OverlayItem, &quot;&lt;init&gt;&quot;, &quot;(...)V&quot;);	// TODO: prototype
</I>&gt;<i> 	// ...
</I>&gt;<i> 	IntPtr instance = JNIEnv.NewObject(OverlayItem, ctor /* ctor args... */);
</I>&gt;<i> 	list.Add(new Java.Lang.Object(instance));
</I>&gt;<i>
</I>&gt;<i> See also: <A HREF="http://mono-android.net/Documentation/API_Design#Jave_Native_Interface_Support">http://mono-android.net/Documentation/API_Design#Jave_Native_Interface_Support</A>
</I>&gt;<i>
</I>&gt;<i> You could then pass `list` via JNI to some Java method..
</I>&gt;<i>
</I>&gt;<i>
</I>After some harrowing time passed with javap and like, I've managed to follow
your advice. I took the GoogleMaps sample as a start and added a way to pass
a List&lt;Object&gt; from the C# Activity to the Java one. I build the overlays
inside the java activity (I did not feel brave enough to do it from the C#
code).

* The C# Activity (with the JNI call to the java communication class)

<A HREF="https://gist.github.com/878737">https://gist.github.com/878737</A>

I was pleasantly surprised on how well the .NET types were marshalled in the
List&lt;Object&gt;. On the other hand, JNI errors don't leave much clues to
investigate. And using javap on the .class files compiled in obj/Debug lets
you get those pesky JNI signatures without making you want to kill yourself.


* The Java Activity subclassing the MapActivity and adding overlays using
coordinates set from the C# side.

<A HREF="https://gist.github.com/878733">https://gist.github.com/878733</A>

Not much to say here, beside that you have to code in Java to appreciate
type inference, value types and [] operator overloading in C#...

* The placeholder Java class used for passing information (fugly but it
works for now)

<A HREF="https://gist.github.com/879415">https://gist.github.com/879415</A>

Adding your own java class works fine, but any compilation error is
advertised as a Signing Error and you have to walk through the extremely
long messagebox that appears then. It's actually too long to display in the
box (you can type Ctrl+C to get all the text though), a textbox could be
used here.

Anayway, thanks to your hints, and thanks to monodroid, I can display a map
a put stuff on it. Yay!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110321/b5fb7b5b/attachment.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110321/b5fb7b5b/attachment.html</A> 
</PRE>

















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003822.html">[mono-android] BaseAdapter and JavaList problem
</A></li>
	<LI>Next message: <A HREF="003812.html">[mono-android] Custom Application Object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3811">[ date ]</a>
              <a href="thread.html#3811">[ thread ]</a>
              <a href="subject.html#3811">[ subject ]</a>
              <a href="author.html#3811">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
