<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Problem with RunOnUiThread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Problem%20with%20RunOnUiThread&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003816.html">
   <LINK REL="Next"  HREF="003823.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Problem with RunOnUiThread</H1>
    <B>BernhardGessler at cs-ag.de</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Problem%20with%20RunOnUiThread&In-Reply-To="
       TITLE="[mono-android] Problem with RunOnUiThread">BernhardGessler at cs-ag.de
       </A><BR>
    <I>Mon Mar 21 11:16:15 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003816.html">[mono-android] Antwort: Re:  Custom Application Object
</A></li>
        <LI>Next message: <A HREF="003823.html">[mono-android] Problem with RunOnUiThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3820">[ date ]</a>
              <a href="thread.html#3820">[ thread ]</a>
              <a href="subject.html#3820">[ subject ]</a>
              <a href="author.html#3820">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

in my app i run a backgroundthread according to the example on the 
monodroid homepage:
<A HREF="http://mono-android.net/Documentation/Guides/Writing_Responsive_Applications">http://mono-android.net/Documentation/Guides/Writing_Responsive_Applications</A>

And i keep getting this error when repeatedly triggering events to the gui 
to display log-information:
03-21 15:25:03.100  6101  6101 I CSMOBILE: 15:25:03  Information: 10 
&#195;&#8222;nderungen vom Server erhalten
03-21 15:25:03.108  6101  6101 I CSMOBILE: 161
03-21 15:25:03.358  6101  6101 I CSMOBILE: 15:25:03  Information: 10 
&#195;&#8222;nderungen vom Server erhalten
03-21 15:25:03.366  6101  6101 I CSMOBILE: 162
03-21 15:25:03.475  6101  6101 I CSMOBILE: 15:25:03  Information: 10 
&#195;&#8222;nderungen vom Server erhalten
03-21 15:25:03.530  6101  6145 D dalvikvm: GC_EXPLICIT freed 337 objects / 
180632 bytes in 31ms
03-21 15:25:03.538  6101  6101 I CSMOBILE: 163
03-21 15:25:03.561  6101  6101 I MonoDroid: UNHANDLED EXCEPTION: 
System.NullReferenceException: Object reference not set to an instance of 
an object
03-21 15:25:03.561  6101  6101 I MonoDroid: at 
Java.Lang.Thread/RunnableImplementor.Run () &lt;0x000c4&gt;
03-21 15:25:03.561  6101  6101 I MonoDroid: at 
Java.Lang.IRunnableAdapter.n_Run (intptr,intptr) &lt;0x00037&gt;
03-21 15:25:03.561  6101  6101 I MonoDroid: at (wrapper dynamic-method) 
object.7ff79b2e-d6ec-474f-aeea-a56a20c8aa9d (intptr,intptr) &lt;0x0002b&gt;
03-21 15:25:03.639  6101  6101 E mono    : 
03-21 15:25:03.639  6101  6101 E mono    : Unhandled Exception: 
System.NullReferenceException: Object reference not set to an instance of 
an object
03-21 15:25:03.639  6101  6101 E mono    :   at 
Java.Lang.Thread+RunnableImplementor.Run () [0x00000] in &lt;filename 
unknown&gt;:0 
03-21 15:25:03.639  6101  6101 E mono    :   at 
Java.Lang.IRunnableAdapter.n_Run (IntPtr jnienv, IntPtr native__this) 
[0x00000] in &lt;filename unknown&gt;:0 
03-21 15:25:03.639  6101  6101 E mono    :   at (wrapper dynamic-method) 
object:7ff79b2e-d6ec-474f-aeea-a56a20c8aa9d (intptr,intptr)
03-21 15:25:03.671  1325  1478 I ActivityManager: Process CSMobile.UI (pid 
6101) has died.
03-21 15:25:03.678  1325  1464 I WindowManager: WIN DEATH: Window{45c85108 
CSMobile.UI/csmobile.ui.forms.SyncOptions paused=false}
03-21 15:25:03.678  1325  1460 I WindowManager: WIN DEATH: Window{45efe2b0 
CSMobile.UI/csmobile.ui.forms.Login paused=false}
03-21 15:25:03.678  1325  1522 I WindowManager: WIN DEATH: Window{45efeb88 
CSMobile.UI/csmobile.ui.forms.Sync paused=false}
03-21 15:25:03.686  1325  1478 I ActivityManager: Start proc CSMobile.UI 
for activity CSMobile.UI/csmobile.ui.forms.SyncOptions: pid=6146 uid=10094 
gids={3003}
03-21 15:25:03.694  1139  1139 D Zygote  : Process 6101 exited cleanly (1)

The whole situation works for about one to two minutes before the error 
occurs. Events are triggered 2 to 5 times per second.

My backgroundthread passes Information to my Log-Class:

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Genesis.Sync.ClientLib
{
    public enum LogType
    {
        Information = 1,
        Warning = 2,
        Error = 3
    }

    public class Log
    {
        public delegate void LogAddedEventHandler(string message);
        public static event LogAddedEventHandler LogAdded;

        public static void WriteLog(string logMessage)
        {
            WriteLog(LogType.Information, logMessage);
        }

        public static void WriteLog(Exception error)
        {
            WriteLog(LogType.Error, error.Message + Environment.NewLine + 
&quot;Stacktrace: &quot; + error.StackTrace);

            if (error.InnerException != null)
            {
                WriteLog(LogType.Error, &quot;Inner Exception: folgt&quot;);
                WriteLog(error.InnerException);
            }
        }

        public static void WriteLog(LogType type, string logMessage)
        {
            if (type &gt;= Settings.LogLevel)
            {
                if (LogAdded != null)
                {
                    LogAdded.Invoke(type + &quot;: &quot; + logMessage);
                }
            }
        }
    }
}

My BussinessLogic listens to the Log and triggers another event to send 
its status to the gui:
        public Sync_Logic()
        {
            Log.LogAdded += (message) =&gt;
            {
                if (this.LogAdded != null)
                {
                    this.LogAdded(message);
                }
            };
        }

My Gui handles the event like this:
            this._logic.LogAdded += (message) =&gt;
            {
                this.RunOnUiThread(() =&gt;
                {
                    Log.Info(&quot;CSMOBILE&quot;, DateTime.Now.ToShortTimeString() 
+ &quot;:&quot; + DateTime.Now.Second.ToString(&quot;D2&quot;) + &quot;  &quot; + message);
 
                    this._textLog = FindViewById&lt;TextView&gt;(Resource.Id
.sync_textLog);
                    this._textLog.Text = DateTime.Now.ToShortTimeString() 
+ &quot;:&quot; + DateTime.Now.Second.ToString(&quot;D2&quot;) + &quot;  &quot; + message + Environment
.NewLine + this._textLog.Text;

                    Log.Info(&quot;CSMOBILE&quot;, (count++).ToString());  
 
                });
            };

Adding try-catch didn't help:
            this._logic.LogAdded += (message) =&gt;
            {
                this.RunOnUiThread(() =&gt;
                {
                    try
                    {
                        Log.Info(&quot;CSMOBILE&quot;, DateTime
.Now.ToShortTimeString() + &quot;:&quot; + DateTime.Now.Second.ToString(&quot;D2&quot;) + &quot;  &quot; 
+ message);
 
                        this._textLog = FindViewById&lt;TextView&gt;(Resource.Id
.sync_textLog);
                        this._textLog.Text = DateTime
.Now.ToShortTimeString() + &quot;:&quot; + DateTime.Now.Second.ToString(&quot;D2&quot;) + &quot;  &quot; 
+ message + Environment.NewLine + this._textLog.Text;

                        Log.Info(&quot;CSMOBILE&quot;, (count++).ToString());    
                    }
                    catch (Exception)
                    {

                        Log.Info(&quot;CSMOBILE&quot;, &quot;Fehler bei Callback&quot;);
                    }
 
                });
            };

But if i remove the 2 lines filling the textView no error appears:
            this._logic.LogAdded += (message) =&gt;
            {
                this.RunOnUiThread(() =&gt;
                {
                    Log.Info(&quot;CSMOBILE&quot;, DateTime.Now.ToShortTimeString() 
+ &quot;:&quot; + DateTime.Now.Second.ToString(&quot;D2&quot;) + &quot;  &quot; + message);  
                    Log.Info(&quot;CSMOBILE&quot;, (count++).ToString());  
                });
            };

for the last few days I've tried everything i could imagine. But i wasn't 
able to resolve the problem. Would be great if anyone had a hint for me. 

Thanks for your help in advance
Bernhard Ge&#223;ler

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110321/03d06434/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110321/03d06434/attachment-0001.html</A> 
</PRE>













































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003816.html">[mono-android] Antwort: Re:  Custom Application Object
</A></li>
	<LI>Next message: <A HREF="003823.html">[mono-android] Problem with RunOnUiThread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3820">[ date ]</a>
              <a href="thread.html#3820">[ thread ]</a>
              <a href="subject.html#3820">[ subject ]</a>
              <a href="author.html#3820">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
