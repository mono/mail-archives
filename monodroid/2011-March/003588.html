<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Deleting textures to free up resources
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Deleting%20textures%20to%20free%20up%20resources&In-Reply-To=AANLkTinLpDcD3WTK9tjvukN4HzUmxgQBHkYk0Ud_Gn%2BO%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003584.html">
   <LINK REL="Next"  HREF="003586.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Deleting textures to free up resources</H1>
    <B>Kestutis Tauckela</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Deleting%20textures%20to%20free%20up%20resources&In-Reply-To=AANLkTinLpDcD3WTK9tjvukN4HzUmxgQBHkYk0Ud_Gn%2BO%40mail.gmail.com"
       TITLE="[mono-android] Deleting textures to free up resources">kestutis.tauckela at gmail.com
       </A><BR>
    <I>Thu Mar 10 15:53:10 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003584.html">[mono-android] Deleting textures to free up resources
</A></li>
        <LI>Next message: <A HREF="003586.html">[mono-android] XML Drawable Resource as background won't compile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3588">[ date ]</a>
              <a href="thread.html#3588">[ thread ]</a>
              <a href="subject.html#3588">[ subject ]</a>
              <a href="author.html#3588">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey again,

It looks like you should call bitmap.Dispose() instead of bitmap.Recycle()
for clean release of the resources.

Many thanks to ankit9 and jonp from MonoDroid chat for helping me to solve
this!

Cheers!
Kestutis Tauckela.
<A HREF="http://www.outlanderstudios.com/">http://www.outlanderstudios.com/</A>

On Thu, Mar 10, 2011 at 12:03 AM, Kestutis Tauckela &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">kestutis.tauckela at gmail.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm having problems deleting old textures via OpenGL ES. To test that, I
</I>&gt;<i> was using modified TexturedCube example. You can find original example here:
</I>&gt;<i> <A HREF="https://github.com/mono/monodroid-samples/tree/master/TexturedCube.">https://github.com/mono/monodroid-samples/tree/master/TexturedCube.</A>
</I>&gt;<i> The only difference I made was loading (creating) textured and destroying
</I>&gt;<i> them each time the cube was rendered. It was working slower (as expected),
</I>&gt;<i> but if the texture would be destroyed properly - the exmaple would still run
</I>&gt;<i> indefinitelly. Currently while using 256x256 texture it crashes after
</I>&gt;<i> exactly 130 successful creations and destructions of said textures (on
</I>&gt;<i> GalaxyS phone). Further tests shown that texture destruction code can be
</I>&gt;<i> skipped entirely and still produce same results. Which makes me think that
</I>&gt;<i> there might be some issues in destruction of the textures.
</I>&gt;<i>
</I>&gt;<i> Am I missing some destruction call to clean-up properly? Or is it a bug?
</I>&gt;<i>
</I>&gt;<i> BTW, the crash happens in the &quot;bitmap.Recycle();&quot; call. It looks like
</I>&gt;<i> bitmap object is not null, but not valid either. Is it another bug in
</I>&gt;<i> BitmapFactory.DecodeResource?
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i> Kestutis Tauckela.
</I>&gt;<i> <A HREF="http://www.outlanderstudios.com/">http://www.outlanderstudios.com/</A>
</I>&gt;<i>
</I>&gt;<i> Here are main functions from the code I was using:
</I>&gt;<i>         protected int LoadTexture (Context context, int resourceId)
</I>&gt;<i>         {
</I>&gt;<i>             int nTextureId = 0;
</I>&gt;<i>
</I>&gt;<i>             // create texture
</I>&gt;<i>             GL.Enable(All.Texture2D);
</I>&gt;<i>             GL.GenTextures(1, ref nTextureId);
</I>&gt;<i>             GL.BindTexture(All.Texture2D, nTextureId);
</I>&gt;<i>
</I>&gt;<i>             // setup texture parameters
</I>&gt;<i>             GL.TexParameterx(All.Texture2D, All.TextureMagFilter,
</I>&gt;<i> (int)All.Linear);
</I>&gt;<i>             GL.TexParameterx(All.Texture2D, All.TextureMinFilter,
</I>&gt;<i> (int)All.Linear);
</I>&gt;<i>             GL.TexParameterx(All.Texture2D, All.TextureWrapS,
</I>&gt;<i> (int)All.ClampToEdge);
</I>&gt;<i>             GL.TexParameterx(All.Texture2D, All.TextureWrapT,
</I>&gt;<i> (int)All.ClampToEdge);
</I>&gt;<i>
</I>&gt;<i>             int ww, hh;
</I>&gt;<i>             int [] pixels = GetTextureFromBitmapResource (context,
</I>&gt;<i> resourceId, out ww, out hh);
</I>&gt;<i>
</I>&gt;<i>             GL.TexImage2D (All.Texture2D, 0, (int)All.Rgba, ww, hh, 0,
</I>&gt;<i> All.Rgba, All.UnsignedByte, pixels);
</I>&gt;<i>
</I>&gt;<i>             return nTextureId;
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>         protected void DestroyTexture(ref int nTextureID)
</I>&gt;<i>         {
</I>&gt;<i>             GL.DeleteTextures(1, ref nTextureID);
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>         static int[] GetTextureFromBitmapResource(Context context, int
</I>&gt;<i> resourceId, out int width, out int height)
</I>&gt;<i>         {
</I>&gt;<i>             Bitmap bitmap = null;
</I>&gt;<i>             try {
</I>&gt;<i>                 bitmap = BitmapFactory.DecodeResource(context.Resources,
</I>&gt;<i> resourceId);
</I>&gt;<i>
</I>&gt;<i>                 width = bitmap.Width;
</I>&gt;<i>                 height = bitmap.Height;
</I>&gt;<i>
</I>&gt;<i>                 int [] pixels = new int [width * height];
</I>&gt;<i>
</I>&gt;<i>                 // Start writing from bottom row, to effectively flip it in
</I>&gt;<i> Y-axis
</I>&gt;<i>                 bitmap.GetPixels  (pixels, pixels.Length - width, -width,
</I>&gt;<i> 0, 0, width, height);
</I>&gt;<i>                 return pixels;
</I>&gt;<i>             }
</I>&gt;<i>             finally    {
</I>&gt;<i>                 if (bitmap != null) {
</I>&gt;<i>                     bitmap.Recycle();
</I>&gt;<i>                 }
</I>&gt;<i>             }
</I>&gt;<i>         }
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110310/df19ef06/attachment.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110310/df19ef06/attachment.html</A> 
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003584.html">[mono-android] Deleting textures to free up resources
</A></li>
	<LI>Next message: <A HREF="003586.html">[mono-android] XML Drawable Resource as background won't compile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3588">[ date ]</a>
              <a href="thread.html#3588">[ thread ]</a>
              <a href="subject.html#3588">[ subject ]</a>
              <a href="author.html#3588">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
