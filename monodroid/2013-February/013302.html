<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] KeyChain API on Android 4.1 and client certificate	authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20KeyChain%20API%20on%20Android%204.1%20and%20client%20certificate%0A%09authentication&In-Reply-To=%3C1360169467427-5712844.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013300.html">
   <LINK REL="Next"  HREF="013303.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] KeyChain API on Android 4.1 and client certificate	authentication</H1>
    <B>Nikola</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20KeyChain%20API%20on%20Android%204.1%20and%20client%20certificate%0A%09authentication&In-Reply-To=%3C1360169467427-5712844.post%40n5.nabble.com%3E"
       TITLE="[mono-android] KeyChain API on Android 4.1 and client certificate	authentication">anusev at gmail.com
       </A><BR>
    <I>Wed Feb  6 16:51:07 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="013300.html">[mono-android] Serializing State of Complex Class
</A></li>
        <LI>Next message: <A HREF="013303.html">[mono-android] KeyChain API on Android 4.1 and client certificate authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13302">[ date ]</a>
              <a href="thread.html#13302">[ thread ]</a>
              <a href="subject.html#13302">[ subject ]</a>
              <a href="author.html#13302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I need to issue HTTP requests against a server that requires authentication
with client certificates. So far (on Android 4.0), I've been using KeyChain
API to get the certificate and the associated private key:

         X509Certificate[] certificateChain =
KeyChain.GetCertificateChain(this, alias);
         IPrivateKey privateKey = KeyChain.GetPrivateKey(this, alias);

Then, I've used the following code to get raw representation of both the
certificate chain and the private key so that I can create .NET
X509Certificate2 instance out of them:

         KeyStore pkcs12KeyStore = KeyStore.GetInstance(&quot;PKCS12&quot;);
         pkcs12KeyStore.Load(null, null);
         pkcs12KeyStore.SetKeyEntry(alias, privateKey, null,
certificateChain);

         Java.Security.Cert.X509Certificate javaCertificate =
(Java.Security.Cert.X509Certificate)pkcs12KeyStore.GetCertificate(alias);

         PKCS8.PrivateKeyInfo privateKeyInfo = new
PKCS8.PrivateKeyInfo(privateKey.GetEncoded());
         RSA privatekeyRsa =
PKCS8.PrivateKeyInfo.DecodeRSA(privateKeyInfo.PrivateKey);

         X509Certificate2 certificate = new
X509Certificate2(javaCertificate.GetEncoded());
         certificate.PrivateKey = privatekeyRsa;        

I was then able to create and issue web requests with this certificate using
standard .NET's HttpWebRequest class:

         HttpWebRequest request = (HttpWebRequest)WebRequest.Create(@&quot;url&quot;);
         request.ClientCertificates.Add(certificate);

*Now, the problem:* On Android 4.1, this code stopped working. It is no
longer possible to get raw representation of private key
(privateKey.GetEncoded() returns null), therefore, I can no longer convert
it to .NET's X509Certificate2 instance.

Is there some alternative that would allow me to create X509Certificate2
with the KeyChain API?

Thank you very much for any input!



--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/KeyChain-API-on-Android-4-1-and-client-certificate-authentication-tp5712844.html">http://mono-for-android.1047100.n5.nabble.com/KeyChain-API-on-Android-4-1-and-client-certificate-authentication-tp5712844.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013300.html">[mono-android] Serializing State of Complex Class
</A></li>
	<LI>Next message: <A HREF="013303.html">[mono-android] KeyChain API on Android 4.1 and client certificate authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13302">[ date ]</a>
              <a href="thread.html#13302">[ thread ]</a>
              <a href="subject.html#13302">[ subject ]</a>
              <a href="author.html#13302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
