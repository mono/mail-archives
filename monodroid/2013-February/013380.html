<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Dynamic assembly loading issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Dynamic%20assembly%20loading%20issues&In-Reply-To=%3C9858C3C2-C30B-4F55-99E8-14F1EF84C66E%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013375.html">
   <LINK REL="Next"  HREF="013425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Dynamic assembly loading issues</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Dynamic%20assembly%20loading%20issues&In-Reply-To=%3C9858C3C2-C30B-4F55-99E8-14F1EF84C66E%40xamarin.com%3E"
       TITLE="[mono-android] Dynamic assembly loading issues">jonp at xamarin.com
       </A><BR>
    <I>Fri Feb 22 15:29:16 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="013375.html">[mono-android] Dynamic assembly loading issues
</A></li>
        <LI>Next message: <A HREF="013425.html">[mono-android] Dynamic assembly loading issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13380">[ date ]</a>
              <a href="thread.html#13380">[ thread ]</a>
              <a href="subject.html#13380">[ subject ]</a>
              <a href="author.html#13380">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 19, 2013, at 11:20 PM, Chris Tacke &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">ctacke at opennetcf.com</A>&gt; wrote:
&gt;<i> Yes, I've read the warning label, and I know that dynamically loading assemblies is somewhat discouraged.
</I>
I need to work on how I phrase this. Dynamically loading assemblies is fine, AS LONG AS said assembly is present at app packaging time. Otherwise, all bets are off.

&gt;<i> I thought, ok, maybe I can figure out the &quot;path&quot; to the folder from which I'm running, and then look for DLLs there and load that way.  Ha.  After several hours of trying to figure out a way to get the path that would work under Debug and Release, I came up with nothing but more grey hair.
</I>
This is addressed at:

	<A HREF="http://docs.xamarin.com/guides/android/advanced_topics/architecture#1-application-packages">http://docs.xamarin.com/guides/android/advanced_topics/architecture#1-application-packages</A>

TL;DR: in Release builds, assemblies are stored within the .apk; they do not exist on the file system.

&gt;<i> Sooooo......  any thoughts on how I might get the name of a DLL that I know is in my APK, but that I don't &quot;know&quot; the name of at build time (I'm loading them and looking for interfaces via reflection to detect their &quot;Adapterness&quot;).
</I>
I can think of a couple of ways, not necessarily good...

1. Provide a &quot;manifest&quot; with  your app which lists which assemblies you can load, and read said manifest at runtime instead of checking the filesystem.

(In effect, you're still hardcoding the assembly name, you're just hardcoding it in a config file instead of in source.)

You could also automate this somewhat (generate the manifest at build time based on filesystem contents of your build machine), but does entail extra logic.

2. Use a ZIP library (Java.Util.Zip? Ionic.Zip.dll?), open the .apk for your app (Context.ApplicationInfo.SourceDir), and look for all entries within the .apk which end in .dll.

Note: One of the new features in Xamarin.Android 4.6 is Bundle assemblies into Native code, the effect of which is to &quot;mkbundle&quot; the assemblies into a native library instead of storing them within the .apk as was previously done. Enabling this option will thus prevent traversing the .apk from finding your assemblies.

I'd suggest (1), myself.

 - Jon

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013375.html">[mono-android] Dynamic assembly loading issues
</A></li>
	<LI>Next message: <A HREF="013425.html">[mono-android] Dynamic assembly loading issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13380">[ date ]</a>
              <a href="thread.html#13380">[ thread ]</a>
              <a href="subject.html#13380">[ subject ]</a>
              <a href="author.html#13380">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
