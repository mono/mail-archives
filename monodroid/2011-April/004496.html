<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Crash in Bitmap.Compress()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Crash%20in%20Bitmap.Compress%28%29&In-Reply-To=003101cbfbbc%24735e62a0%245a1b27e0%24%40quebesystems.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004359.html">
   <LINK REL="Next"  HREF="004273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Crash in Bitmap.Compress()</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Crash%20in%20Bitmap.Compress%28%29&In-Reply-To=003101cbfbbc%24735e62a0%245a1b27e0%24%40quebesystems.com"
       TITLE="[mono-android] Crash in Bitmap.Compress()">jpryor at novell.com
       </A><BR>
    <I>Mon Apr 25 15:36:45 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004359.html">[mono-android] Crash in Bitmap.Compress()
</A></li>
        <LI>Next message: <A HREF="004273.html">[mono-android] Composite ListActivity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4496">[ date ]</a>
              <a href="thread.html#4496">[ thread ]</a>
              <a href="subject.html#4496">[ subject ]</a>
              <a href="author.html#4496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 15, 2011, at 6:28 PM, Dennis Quebe wrote:
&gt;<i> It reminds me of a problem that I had in the previous beta that I am unable to test if it is fixed in the release. I saw a bug about it relating to the Bitmap not releasing unmanaged resources. I had the same problem with BitmapMatrix, in that when I use BitmapMatrix, as a managed object, I expect that it will release the unmanaged resources by calling Dispose in its Finalizer, but I found it did not automatically release or call Dispose when left to the garbage collector. I opened a bug but closed it since it was a day or two later you provided the Release version. Thought I would retest.
</I>
The problem here is twofold:

 1. The GC only knows about memory it allocates, not memory handled by the Dalvik VM or unmanaged memory.
 2. The &quot;proper&quot; mechanism to inform the GC about &quot;memory pressure&quot; is GC.AddMemoryPressure(long), which isn't supported on Mono.

In short, if you allocate lots of &quot;large&quot; objects, where the memory isn't handled by Mono (e.g. large Java-side object graphs, Marshal.AllocHGlobal(), etc.), Mono's GC won't (and can't) know about it, and thus won't know that it should perform collections more frequently. Eventually it'll need to grab more memory from the OS w/o a corresponding full collection, and depending on various factors the process may instead exit (think OOM killer on desktop linux, etc., as -- by default -- desktop linux won't ever return NULL from malloc(3)).

Furthermore, with large Java-side object graphs, it's not easy to tell how big the object graph is (thus complicating the entire idea of calling GC.AddMemoryPressure() in the first place -- what value do you use?).

As a result, it behooves you to keep this in mind, and (if/when appropriate) explicitly dispose of all Java-side objects whenever possible.

 - Jon

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004359.html">[mono-android] Crash in Bitmap.Compress()
</A></li>
	<LI>Next message: <A HREF="004273.html">[mono-android] Composite ListActivity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4496">[ date ]</a>
              <a href="thread.html#4496">[ thread ]</a>
              <a href="subject.html#4496">[ subject ]</a>
              <a href="author.html#4496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
