<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] another Java versus C# how to
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20another%20Java%20versus%20C%23%20how%20to&In-Reply-To=014001cc03f7%24c2f826f0%2448e874d0%24%40gb.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004507.html">
   <LINK REL="Next"  HREF="004511.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] another Java versus C# how to</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20another%20Java%20versus%20C%23%20how%20to&In-Reply-To=014001cc03f7%24c2f826f0%2448e874d0%24%40gb.com"
       TITLE="[mono-android] another Java versus C# how to">jpryor at novell.com
       </A><BR>
    <I>Tue Apr 26 09:40:13 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004507.html">[mono-android] another Java versus C# how to
</A></li>
        <LI>Next message: <A HREF="004511.html">[mono-android] another Java versus C# how to
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4509">[ date ]</a>
              <a href="thread.html#4509">[ thread ]</a>
              <a href="subject.html#4509">[ subject ]</a>
              <a href="author.html#4509">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 26, 2011, at 5:53 AM, John Murray wrote:
&gt;<i> Too steeped in 30 years ago functional programming - I've been merrily
</I>&gt;<i> constructing listener methods when all I needed to do was create a class 
</I>
It's not just &quot;create a class,&quot; it's &quot;create a class that implements a specific interface&quot; (the interface being whatever the method you're invoking requires). Because you're implementing an interface...

&gt;<i> Just a couple of clarifiers - when one makes an anonymous class specific as
</I>&gt;<i> above it seems that the inbuilt method OnKey MUST be named exactly that ?
</I>
...you need to name your methods the same as what the interface requires. :-)

The C# language documentation on interfaces might be helpful:

	<A HREF="http://msdn.microsoft.com/en-us/library/87d83y5b(VS.80">http://msdn.microsoft.com/en-us/library/87d83y5b(VS.80</A>).aspx

Since IDialogInterfaceOnKeyListener has a `bool OnKey(IDialogInterface,int,KeyEvent)` method, you need to also provide a method with the same name and prototype (matching argument types and return type).

&gt;<i> One cannot play around with its name or parameters (I presume) but one can call the class whatever you like ?is that right ?
</I>
Correct, what matters is the member name and prototype, so that the compiler knows that you're implementing the interface (otherwise you'd get a compiler error if the name and/or prototype didn't match what the interface specifies).

&gt;<i> I presume these rules apply for any explicitly classed listeners 
</I>
These rules apply for any type implementing any interface.

&gt;<i> Note above I've created a constructor to get the context in so that I can
</I>&gt;<i> use Toast - I found I couldn't just use 'this' - I presume there are no more
</I>&gt;<i> elegant ways of doing this 
</I>
Depends on how functional you want to be. :-)

With 30 years of functional programming experience, I'd suggest that you do this:

	class OnKeyListener : Java.Lang.Object, IDialogInterfaceOnKeyListener {

		Func&lt;IDialogInterface, int, KeyEvent, bool&gt; onKey;

		public OnKeyListener (Func&lt;IDialogInterface, int, KeyEvent&gt; onKey)
		{
			this.onKey = onKey;
		}

		public bool OnKey(IDialogInterface dialog, int keyCode, KeyEvent e)
		{
			return onKey(dialog, keyCode, e);
		}
	}

Then you can use C#'s support for lambda delegates, which includes implicit capturing of variables (including `this`):

	var listener = new OnKeyListener((dialog, keyCode, e) =&gt; {
			Toast.MakeText(this, e.ToString(), ToastLength.Short).Show();
			if (keyCode == 66) {
				dialog.Cancel();
			}
			return true;
	});

This does require a (large) degree of comfort with anonymous delegates/lambda delegates, but it can allow for quite concise code.

&gt;<i> Finally an oddity - in the above the Toast only seems to get fired when I press the 'done' key (which incidentally turns out to be keycode 66 not 13 as an ancient programmer like me remembers from wordstar days) - I would have thought it would fire on any key pressed ?
</I>
From the documentation:

	<A HREF="http://developer.android.com/reference/android/content/DialogInterface.OnKeyListener.html#onKey(android.content.DialogInterface,">http://developer.android.com/reference/android/content/DialogInterface.OnKeyListener.html#onKey(android.content.DialogInterface,</A> int, android.view.KeyEvent)

The `keyCode` parameter is &quot;The code for the physical key that was pressed.&quot; As such, I imagine that there is no mapping between the keyCode value and character that is typed (e.g. ASCII 'B' has decimal value 66, and I doubt that 'B' is the Done button) ;-)

Instead, you should compare keyCode to one of the Keycode enumeration values:

	<A HREF="http://docs.mono-android.net/index.aspx?link=T%3aAndroid.Views.Keycode">http://docs.mono-android.net/index.aspx?link=T%3aAndroid.Views.Keycode</A>

In particular, Keycode.Enter has value 66, so what you should do is this:

	if (keyCode == (int) Keycode.Enter) {
		dialog.Cancel();
	}

(This also implies that we missed an int-&gt;enum conversion location, which isn't surprising...)

Alternatively, you can use `e.KeyCode`, which is of type Keycode so the cast to `int` wouldn't be necessary:

	if (e.KeyCode == Keycode.Enter) ...

 - Jon

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004507.html">[mono-android] another Java versus C# how to
</A></li>
	<LI>Next message: <A HREF="004511.html">[mono-android] another Java versus C# how to
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4509">[ date ]</a>
              <a href="thread.html#4509">[ thread ]</a>
              <a href="subject.html#4509">[ subject ]</a>
              <a href="author.html#4509">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
