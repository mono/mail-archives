<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Is this a bug (Rect)?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Is%20this%20a%20bug%20%28Rect%29%3F&In-Reply-To=BANLkTinyJUZ0GJEu%3D0hkvgkA3AcbRWcDKA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004106.html">
   <LINK REL="Next"  HREF="004108.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Is this a bug (Rect)?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Is%20this%20a%20bug%20%28Rect%29%3F&In-Reply-To=BANLkTinyJUZ0GJEu%3D0hkvgkA3AcbRWcDKA%40mail.gmail.com"
       TITLE="[mono-android] Is this a bug (Rect)?">jpryor at novell.com
       </A><BR>
    <I>Tue Apr  5 13:20:45 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004106.html">[mono-android] Is this a bug (Rect)?
</A></li>
        <LI>Next message: <A HREF="004108.html">[mono-android] Is this a bug (Rect)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4107">[ date ]</a>
              <a href="thread.html#4107">[ thread ]</a>
              <a href="subject.html#4107">[ subject ]</a>
              <a href="author.html#4107">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 5, 2011, at 12:44 PM, Aaron Knabb wrote:
&gt;<i> I was newing a bunch of Rect objects in order to do some simple math with them. Considering how frequently OnDraw gets called, I guess this left a bunch of Rect objects around in memory. If I either use a 'using' statement or just avoid allocating those Rects over and over again, the problem goes away. That leads to my question. Are we supposed to avoid allocating objects frequently, or just dispose of Rects, or is there something else going on?
</I>
So what's going on is this: every time you allocate an Android.Graphics.Rect type (as well as any other type which is wrapping a Java type), two objects are created:

 1. The Java object, in the Java heap.
 2. The Mono &quot;proxy&quot; object, in the Mono heap.

There is some work that is done to ensure that both objects stay alive, e.g. as long as the Mono GC refers to an object, the Java-side object will be kept alive (and vice versa, via the mandroid-generated proxies [0]).

Add on top the fact that GC's are by nature &quot;lazy&quot; (they only perform a collection &quot;on-demand&quot;, not when objects go out of scope), and it means that cross-VM garbage will stick around longer than &quot;normal.&quot; This is unavoidable.

As such, your approach of using `using` blocks is the best solution, as this will dispose of the Mono-side wrapper, which will allow the Java-VM to collect the object, preventing too many temporary objects from sticking around for too long.

&gt;<i> I kinda figured Rects where just some integers and didn't require disposal, but it seems I was wrong.
</I>
An Android.Graphics.Rect isn't a struct (value-type), it's a class. It behaves the same as every other exposed Java type.

 - Jon

[0] <A HREF="http://mono-android.net/Documentation/Tools/Mandroid.exe">http://mono-android.net/Documentation/Tools/Mandroid.exe</A>

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004106.html">[mono-android] Is this a bug (Rect)?
</A></li>
	<LI>Next message: <A HREF="004108.html">[mono-android] Is this a bug (Rect)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4107">[ date ]</a>
              <a href="thread.html#4107">[ thread ]</a>
              <a href="subject.html#4107">[ subject ]</a>
              <a href="author.html#4107">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
