<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Possible GC Bug?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Possible%20GC%20Bug%3F&In-Reply-To=AANLkTi%3Dnbjcdq5zJ%3D36oevj4uenEGf24cUPdOHVswEeZ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004102.html">
   <LINK REL="Next"  HREF="004105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Possible GC Bug?</H1>
    <B>Piotr Kryger</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Possible%20GC%20Bug%3F&In-Reply-To=AANLkTi%3Dnbjcdq5zJ%3D36oevj4uenEGf24cUPdOHVswEeZ%40mail.gmail.com"
       TITLE="[mono-android] Possible GC Bug?">piotr.kryger at gmail.com
       </A><BR>
    <I>Tue Apr  5 07:15:02 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004102.html">[mono-android] Antwort:  Key dispatching timed out
</A></li>
        <LI>Next message: <A HREF="004105.html">[mono-android] Odd IOnTouchListener Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4104">[ date ]</a>
              <a href="thread.html#4104">[ thread ]</a>
              <a href="subject.html#4104">[ subject ]</a>
              <a href="author.html#4104">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I found another strange thing, which imho can be somehow related to GC.
When using my LimitedSizeDictionary class (source code was attached to my
previous email), my app sometimes crashes
with following (or similar) log:

04-05 12:51:39.411: INFO/MonoDroid(1068): UNHANDLED EXCEPTION:
&gt;<i> System.NullReferenceException: Object reference not set to an instance of an
</I>&gt;<i> object
</I>&gt;<i> 04-05 12:51:39.411: INFO/MonoDroid(1068): at *System.Collections.Generic.Dictionary`2&lt;long,
</I>&gt;<i> Legimi.Android.Main.Adapters.VersionImageAdapter&gt;.ContainsKey (long)*&lt;0x00060&gt;
</I>&gt;<i> 04-05 12:51:39.411: INFO/MonoDroid(1068): at
</I>&gt;<i> Legimi.Core.Utils.Concurrent.LimitedSizeDictionary`2&lt;long,
</I>&gt;<i> Legimi.Android.Main.Adapters.VersionImageAdapter&gt;.set_Item
</I>&gt;<i> (long,Legimi.Android.Main.Adapters.VersionImageAdapter) &lt;0x00037&gt;
</I>&gt;<i> (...)
</I>&gt;<i> 04-05 12:51:39.411: INFO/MonoDroid(1068): at
</I>&gt;<i> Android.Widget.BaseAdapter.n_GetView_ILandroid_view_View_Landroid_view_ViewGroup_
</I>&gt;<i> (intptr,intptr,int,intptr,intptr) &lt;0x00093&gt;
</I>&gt;<i> 04-05 12:51:39.411: INFO/MonoDroid(1068): at (wrapper dynamic-method)
</I>&gt;<i> object.591f3cba-7972-418c-98f6-42976dd34fd1
</I>&gt;<i> (intptr,intptr,int,intptr,intptr) &lt;0x0004b&gt;
</I>&gt;<i>
</I>
Maybe its a result of bug in my application but I think I shouldn't be able
to get NullReferenceException from Dictionary.ContainsKey method (neither
msdn nor mono docs mention this is possible)

This happens rarely and in random way when running on Samsung Ace phone,
Android 2.2 (no debugger attached).

Regards,
Piotr

2011/3/29 Piotr Kryger &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">piotr.kryger at gmail.com</A>&gt;

&gt;<i> I found some strange behaviour, when I call GC.Collect() directly -
</I>&gt;<i> sometimes it causes my application to quit.
</I>&gt;<i> I'm able to reproduce this (on emulator and on device - both Android 2.2)
</I>&gt;<i> following these steps:
</I>&gt;<i>  - run attached project
</I>&gt;<i>  - click &quot;Run A&quot; button, activity A is launched
</I>&gt;<i>  - press back to return to main launcher activity
</I>&gt;<i>  - click &quot;Run A&quot; once again and application quits
</I>&gt;<i>
</I>&gt;<i> I don't get any exception, adb log looks like this:
</I>&gt;<i>
</I>&gt;&gt;<i> 03-29 08:37:16.010: INFO/TEST(331): create Activity1
</I>&gt;&gt;<i> 03-29 08:37:16.260: INFO/TEST(331): resumed Activity1
</I>&gt;&gt;<i> 03-29 08:37:16.340: WARN/InputManagerService(59): Got RemoteException
</I>&gt;&gt;<i> sending setActive(false) notification to pid 322 uid 10042
</I>&gt;&gt;<i> 03-29 08:37:21.150: INFO/ActivityManager(59): Starting activity: Intent {
</I>&gt;&gt;<i> cmp=GcTest.GcTest/gctest.A }
</I>&gt;&gt;<i> 03-29 08:37:21.310: INFO/monodroid(331): Activating instance of type
</I>&gt;&gt;<i> GcTest.A
</I>&gt;&gt;<i> 03-29 08:37:21.310: INFO/monodroid(331): signature
</I>&gt;&gt;<i> 03-29 08:37:21.390: INFO/TEST(331): create A
</I>&gt;&gt;<i> 03-29 08:37:21.459: INFO/TEST(331): collect
</I>&gt;&gt;<i> 03-29 08:37:21.610: DEBUG/dalvikvm(331): GC_EXPLICIT freed 7690 objects /
</I>&gt;&gt;<i> 380920 bytes in 63ms
</I>&gt;&gt;<i> 03-29 08:37:21.640: INFO/TEST(331): collect finished
</I>&gt;&gt;<i> 03-29 08:37:21.640: INFO/TEST(331): collect
</I>&gt;&gt;<i> 03-29 08:37:21.670: INFO/TEST(331): collect finished
</I>&gt;&gt;<i> 03-29 08:37:22.010: INFO/ActivityManager(59): Displayed activity
</I>&gt;&gt;<i> GcTest.GcTest/gctest.A: 764 ms (total 764 ms)
</I>&gt;&gt;<i> 03-29 08:37:23.280: WARN/KeyCharacterMap(331): No keyboard for id 0
</I>&gt;&gt;<i> 03-29 08:37:23.280: WARN/KeyCharacterMap(331): Using default keymap:
</I>&gt;&gt;<i> /system/usr/keychars/qwerty.kcm.bin
</I>&gt;&gt;<i> 03-29 08:37:23.389: INFO/TEST(331): resumed Activity1
</I>&gt;&gt;<i> 03-29 08:37:23.690: INFO/TEST(331): destroy A
</I>&gt;&gt;<i> 03-29 08:37:23.829: INFO/TEST(331): collect
</I>&gt;&gt;<i> 03-29 08:37:23.890: DEBUG/dalvikvm(331): GC_EXPLICIT freed 291 objects /
</I>&gt;&gt;<i> 10872 bytes in 53ms
</I>&gt;&gt;<i> 03-29 08:37:23.900: INFO/TEST(331): collect finished
</I>&gt;&gt;<i> 03-29 08:37:23.910: INFO/TEST(331): collect
</I>&gt;&gt;<i> 03-29 08:37:23.970: DEBUG/dalvikvm(331): GC_EXPLICIT freed 20 objects /
</I>&gt;&gt;<i> 656 bytes in 54ms
</I>&gt;&gt;<i> 03-29 08:37:23.990: INFO/TEST(331): collect finished
</I>&gt;&gt;<i> 03-29 08:37:24.700: INFO/ActivityManager(59): Starting activity: Intent {
</I>&gt;&gt;<i> cmp=GcTest.GcTest/gctest.A }
</I>&gt;&gt;<i> 03-29 08:37:24.779: INFO/monodroid(331): Activating instance of type
</I>&gt;&gt;<i> GcTest.A
</I>&gt;&gt;<i> 03-29 08:37:24.779: INFO/monodroid(331): signature
</I>&gt;&gt;<i> 03-29 08:37:24.790: INFO/TEST(331): create A
</I>&gt;&gt;<i> 03-29 08:37:24.800: INFO/TEST(331): collect
</I>&gt;&gt;<i> 03-29 08:37:24.870: DEBUG/dalvikvm(331): GC_EXPLICIT freed 170 objects /
</I>&gt;&gt;<i> 13664 bytes in 57ms
</I>&gt;&gt;<i> 03-29 08:37:24.890: INFO/TEST(331): collect finished
</I>&gt;&gt;<i> 03-29 08:37:24.910: DEBUG/Zygote(33): Process 331 terminated by signal
</I>&gt;&gt;<i> (11)
</I>&gt;&gt;<i> 03-29 08:37:24.920: INFO/ActivityManager(59): Process GcTest.GcTest (pid
</I>&gt;&gt;<i> 331) has died.
</I>&gt;&gt;<i> 03-29 08:37:24.940: INFO/WindowManager(59): WIN DEATH: Window{43fbeed8
</I>&gt;&gt;<i> GcTest.GcTest/gctest.Activity1 paused=false}
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Is this a bug or have I missed something?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Piotr
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110405/d9ea2f51/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110405/d9ea2f51/attachment-0001.html</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004102.html">[mono-android] Antwort:  Key dispatching timed out
</A></li>
	<LI>Next message: <A HREF="004105.html">[mono-android] Odd IOnTouchListener Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4104">[ date ]</a>
              <a href="thread.html#4104">[ thread ]</a>
              <a href="subject.html#4104">[ subject ]</a>
              <a href="author.html#4104">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
