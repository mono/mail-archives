<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] getting more information from contacts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20getting%20more%20information%20from%20contacts&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004555.html">
   <LINK REL="Next"  HREF="004547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] getting more information from contacts</H1>
    <B>John Murray</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20getting%20more%20information%20from%20contacts&In-Reply-To="
       TITLE="[mono-android] getting more information from contacts">john at murray.gb.com
       </A><BR>
    <I>Wed Apr 27 05:39:12 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004555.html">[mono-android] SQLite issue?
</A></li>
        <LI>Next message: <A HREF="004547.html">[mono-android] getting more information from contacts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4541">[ date ]</a>
              <a href="thread.html#4541">[ thread ]</a>
              <a href="subject.html#4541">[ subject ]</a>
              <a href="author.html#4541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Once again I'm up against a situation where Android examples do not help
because Mono seems to do things tantalisingly similar but different 

 

{this is a general negative - if Monodroid was supposed to leverage one's
small knowledge in c# then why does one seem to have to have aPhd in several
languages to understand how to achieve simple unambitious objectives??
Perhaps a question for the commercial people}

 

EXAMPLE 

]1) Greg Shackles has produced a good example of selecting a contact from
the internal contact database

-          Very good - but of course only useful if you want the
display_name or phonetic_name or when they were last contacted or something
equally obscure

-          If you want something useful like the address - you're on your
own 

Here's  my progress (or lack of it)

Using Gregs code.. thus 

            _button.Click += delegate

            {

                var intent = new Intent(Intent.ActionPick,
ContactsContract.Contacts.ContentUri); 

                StartActivityForResult(intent, PICK_CONTACT);

            };

Then an OnActivity result override 

protected override void  OnActivityResult(int requestCode, Result
resultCode, Intent data)

        {

               if (requestCode == PICK_CONTACT) 

            {

                string id = data.Data.LastPathSegment;

                var contacts =
ManagedQuery(ContactsContract.Contacts.ContentUri, null, &quot;_id = ?&quot;, new
string[] { id }, null);

                contacts.MoveToFirst();

                Array myarr =contacts.GetColumnNames();

 

               foreach ( string s in myarr )

               {

                   Toast.MakeText(this, s, ToastLength.Short).Show();

               }

                _contactName.Text = &quot;Got contact: &quot; +
contacts.GetString(contacts.GetColumnIndex(&quot;display_name&quot;));

            }

        }

 

(incidentally if you wonder why I put in a for next loop and toast to
display column names it is because the debugger is debuggered - whilst I
appreciate the improvements in the latest hotfix and whilst I can now step
through the debugger at a tolerable but very slow pace, one usually cannot
view variable values in a watch- one gets a timeout - &quot;this expression took
too long to evaluate&quot; - the joys of Mono)

 

 

Now try to find out the syntax of the ManagedQuery() from the documentation 

Type in Managedquery on MonoDroid documentation  - zilch

the 'hint' in VS2010 says its full namespace is
Android.Database.Icursor.Activity.ManagedQuery()

So go to
<A HREF="http://docs.mono-android.net/index.aspx?link=T%253AAndroid.Provider.Contacts">http://docs.mono-android.net/index.aspx?link=T%253AAndroid.Provider.Contacts</A>
Contract.RawContactsEntity

and there's no Icursor.Activity - so the trail goes cold in finding out what
the ManagedQuery wants as parameters in Monodroid 

Have to cut and paste and hope for the best

 

And still a far way from finding out how to extract an address 

 

I find from various experiments that the address details are held in a
different part of the contacts database or to use the parlance a different
Uri

The addresses are in
ContactsContract.CommonDataKinds.StructuredPostal.ContentUri,

Great,  now all I've got to do is replace the fist expression in the managed
query with this and provide a filter for the   ID,  I want, and hey presto !

Not so fast buster - this is where pioneering in Monodroid becomes more like
a religious penance

This bit of code looked like it might work 

 

ICursor cursor4 =
ManagedQuery(ContactsContract.CommonDataKinds.StructuredPostal.ContentUri,

                            null,

 
ContactsContract.CommonDataKinds.StructuredPostal.CONTACT_ID + &quot; = &quot; +
contactId, null, null);

 

Except that it's Android/Java code (adapted of course for the mono
idiosyncracies such as ICursor instead of Cursor)  - there are no constants
for CONTACT_ID

In VS2010 , type the above and intellisense offers only properties such as
City, postcode contenttype etc when one types a fullstop after
'StructuredPostal'. It offers NO field on which one might filter on ID.

So there appears to be no way of filtering on contact ID in Mono despite
what appears in the Android documentation

 

I cite the above to demonstrate just how time consuming and painful it can
be to find out how to do an obvious exercise such as extracting an address

Greg Shackles has gone further than most in explaining in depth how things
work but even  his example does not explain this 

 

I Know I am dreaming and getting delirious here but wouldn't it be nice if
one could just extract what one wanted using a simple sql statement a la
LINQ?

 

Anyway sorry about the moans - I've gnawed through a box of pencils and the
drinks cabinet is under padlock over the last 4 days on this so can someone
help?

Correct me if I  am wrong but there are simply NO mono examples of picking
contacts other than Greg's fine work? There's nothing about this on the
whole history of Ximian, nor on StaackOverflow and apart from previously
mentioned no  examples on Github

 

How does one access addresses (simply) and is there an sql way of doing it  

 

TIA 

John Murray

 

 

 

 

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110427/ba5af113/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110427/ba5af113/attachment-0001.html</A> 
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004555.html">[mono-android] SQLite issue?
</A></li>
	<LI>Next message: <A HREF="004547.html">[mono-android] getting more information from contacts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4541">[ date ]</a>
              <a href="thread.html#4541">[ thread ]</a>
              <a href="subject.html#4541">[ subject ]</a>
              <a href="author.html#4541">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
