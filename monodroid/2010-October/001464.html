<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] Services, help please. :(
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Services%2C%20help%20please.%20%3A%28&In-Reply-To=AANLkTik6q3phN2CKUcVyifZqHUE%3DHiAMevxg-gWxx4Ay%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001463.html">
   <LINK REL="Next"  HREF="001465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] Services, help please. :(</H1>
    <B>Alex Soto</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Services%2C%20help%20please.%20%3A%28&In-Reply-To=AANLkTik6q3phN2CKUcVyifZqHUE%3DHiAMevxg-gWxx4Ay%40mail.gmail.com"
       TITLE="[Monodroid] Services, help please. :(">alex at alexsoto.me
       </A><BR>
    <I>Thu Oct 21 09:37:35 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001463.html">[Monodroid] Services, help please. :(
</A></li>
        <LI>Next message: <A HREF="001465.html">[Monodroid] Services, help please. :(
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1464">[ date ]</a>
              <a href="thread.html#1464">[ thread ]</a>
              <a href="subject.html#1464">[ subject ]</a>
              <a href="author.html#1464">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Umm i dont think that having a roadmap with the supported things will do any good because we would focus just on those things and we would loose great ideas like this one, now the mono team knows about your request and i guess it will get supported in a near future

Alex


El 20/10/2010, a las 10:42 p.m., Greg Shackles &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">gshackles at gmail.com</A>&gt; escribi&#243;:

&gt;<i> I don't think services are supported yet (or any components other than activities).  See the comments in this bug I opened: <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=645234">https://bugzilla.novell.com/show_bug.cgi?id=645234</A>
</I>&gt;<i> 
</I>&gt;<i> - Greg
</I>&gt;<i> 
</I>&gt;<i> On Wed, Oct 20, 2010 at 11:21 PM, bryan costanich &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">b at wowzer.net</A>&gt; wrote:
</I>&gt;<i> Hey all,
</I>&gt;<i> 
</I>&gt;<i> I&#8217;m trying to create a service (following/porting the android sample <A HREF="http://developer.android.com/reference/android/app/Service.html">http://developer.android.com/reference/android/app/Service.html</A>). 
</I>&gt;<i> 
</I>&gt;<i> I&#8217;ve gotten everything to build and run, but for some reason, my OnServiceConnected method in my ServiceConnection class never runs. Here is my main activity (with ServiceConnection):
</I>&gt;<i> 
</I>&gt;<i> namespace Test_MediaPlayerService
</I>&gt;<i> {
</I>&gt;<i>     [Activity(Label = &quot;Service&quot;, MainLauncher = true)]
</I>&gt;<i>     public class Activity1 : Activity
</I>&gt;<i>    {
</I>&gt;<i>         protected ServiceConnection _serviceConnection;
</I>&gt;<i>         protected bool _isBound;
</I>&gt;<i> 
</I>&gt;<i>         public Activity1(IntPtr handle) : base(handle)
</I>&gt;<i>         {
</I>&gt;<i>             this._serviceConnection = new ServiceConnection(this);
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         protected override void OnCreate(Bundle bundle)
</I>&gt;<i>         {
</I>&gt;<i>             base.OnCreate(bundle);
</I>&gt;<i> 
</I>&gt;<i>             // Set our view from the &quot;main&quot; layout resource
</I>&gt;<i>            SetContentView(Resource.layout.main);
</I>&gt;<i> 
</I>&gt;<i>             // Get our button from the layout resource,
</I>&gt;<i>            // and attach an event to it
</I>&gt;<i>            Button button = FindViewById&lt;Button&gt;(Resource.id.myButton);
</I>&gt;<i> 
</I>&gt;<i>             button.Click += (s,e) =&gt; {
</I>&gt;<i>                 Toast.MakeText(this, &quot;button click&quot;, ToastLength.Short).Show();
</I>&gt;<i>                 this.BindService();
</I>&gt;<i>             };
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         protected void BindService()
</I>&gt;<i>         {
</I>&gt;<i>             // Establish a connection with the service.  We use an explicit
</I>&gt;<i>            // class name because we want a specific service implementation that
</I>&gt;<i>            // we know will be running in our own process (and thus won't be
</I>&gt;<i>            // supporting component replacement by other applications).
</I>&gt;<i>            BindService(new Intent(this, typeof(MediaPlayerService)), this._serviceConnection, Bind.AutoCreate);
</I>&gt;<i> 
</I>&gt;<i>             this._isBound = true;
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         protected void UnbindService()
</I>&gt;<i>         {
</I>&gt;<i>             this.UnbindService(this._serviceConnection);
</I>&gt;<i>             this._isBound = false;
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         protected override void OnDestroy()
</I>&gt;<i>         {
</I>&gt;<i>             base.OnDestroy();
</I>&gt;<i> 
</I>&gt;<i>             if (this._isBound)
</I>&gt;<i>             {
</I>&gt;<i>                 this.UnbindService();
</I>&gt;<i>             }
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         protected class ServiceConnection : Java.Lang.Object, IServiceConnection
</I>&gt;<i>        {
</I>&gt;<i>             public MediaPlayerService MediaPlayerService
</I>&gt;<i>             {
</I>&gt;<i>                 get { return this._mediaPlayerService; }
</I>&gt;<i>             }
</I>&gt;<i>             protected MediaPlayerService _mediaPlayerService;
</I>&gt;<i>             protected Activity _context = null;
</I>&gt;<i> 
</I>&gt;<i>             public ServiceConnection(Activity context)
</I>&gt;<i>             { this._context = context; }
</I>&gt;<i> 
</I>&gt;<i>             public void OnServiceConnected(ComponentName className, IBinder service)
</I>&gt;<i>             {
</I>&gt;<i>                 Toast.MakeText(this._context, &quot;About to Connect to Service&quot;, ToastLength.Short).Show();
</I>&gt;<i> 
</I>&gt;<i>                 // This is called when the connection with the service has been
</I>&gt;<i>                // established, giving us the service object we can use to
</I>&gt;<i>                // interact with the service.  Because we have bound to a explicit
</I>&gt;<i>                // service that we know is running in our own process, we can
</I>&gt;<i>                // cast its IBinder to a concrete class and directly access it.
</I>&gt;<i>                this._mediaPlayerService = ((MediaPlayerService.LocalBinder)service).GetService();
</I>&gt;<i> 
</I>&gt;<i>                 // Tell the user about this for our demo.
</I>&gt;<i>                Toast.MakeText(this._context, &quot;Connected to Service&quot;, ToastLength.Short).Show();
</I>&gt;<i>             }
</I>&gt;<i> 
</I>&gt;<i>             public void OnServiceDisconnected(ComponentName className) {
</I>&gt;<i>                 // This is called when the connection with the service has been
</I>&gt;<i>                // unexpectedly disconnected -- that is, its process crashed.
</I>&gt;<i>                // Because it is running in our same process, we should never
</I>&gt;<i>                // see this happen.
</I>&gt;<i>                this._mediaPlayerService = null;
</I>&gt;<i> 
</I>&gt;<i>                 Toast.MakeText(this._context, &quot;Disconnected from Service&quot;, ToastLength.Short).Show();
</I>&gt;<i> 
</I>&gt;<i>             }
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> And here&#8217;s my service class:
</I>&gt;<i> 
</I>&gt;<i> namespace Test_MediaPlayerService
</I>&gt;<i> {
</I>&gt;<i>     public class MediaPlayerService : Android.App.Service
</I>&gt;<i>    {
</I>&gt;<i>         protected NotificationManager _notificationManager;
</I>&gt;<i>         protected LocalBinder _binder;
</I>&gt;<i> 
</I>&gt;<i>         public class LocalBinder : Binder
</I>&gt;<i>        {
</I>&gt;<i>             MediaPlayerService _service;
</I>&gt;<i>             internal LocalBinder(MediaPlayerService service)
</I>&gt;<i>             {
</I>&gt;<i>                 this._service = service;
</I>&gt;<i>             }
</I>&gt;<i> 
</I>&gt;<i>             public MediaPlayerService GetService()
</I>&gt;<i>             {
</I>&gt;<i>                 return this._service;
</I>&gt;<i>             }
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         public MediaPlayerService()
</I>&gt;<i>         {
</I>&gt;<i>             this._binder = new LocalBinder(this);
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         public override IBinder OnBind(Intent intent)
</I>&gt;<i>         {
</I>&gt;<i>             return this._binder;
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         public override void OnDestroy()
</I>&gt;<i>         {
</I>&gt;<i>             base.OnDestroy();
</I>&gt;<i>             //---- cancel our notification
</I>&gt;<i>            //---- TODO: provide a unique id
</I>&gt;<i>            this._notificationManager.Cancel(666);
</I>&gt;<i>         }
</I>&gt;<i>         public override void OnCreate()
</I>&gt;<i>         {
</I>&gt;<i>             base.OnCreate();
</I>&gt;<i> 
</I>&gt;<i>             this._notificationManager = this.GetSystemService(NotificationService) as NotificationManager;
</I>&gt;<i>             if (this._notificationManager == null)
</I>&gt;<i>             { throw new Exception(&quot;couldn't get a reference to the notification service&quot;); }
</I>&gt;<i> 
</I>&gt;<i>             //---- show the service starting notification
</I>&gt;<i>            //this.ShowNotification();
</I>&gt;<i>        }
</I>&gt;<i> 
</I>&gt;<i>         public override void OnStart(Intent intent, int startId)
</I>&gt;<i>         {
</I>&gt;<i>             base.OnStart(intent, startId);
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>         public override StartCommandResult OnStartCommand(Intent intent, StartCommandFlags flags, int startId)
</I>&gt;<i>         {
</I>&gt;<i>             //---- this service should continue running until it's told to stop, so we make 
</I>&gt;<i>            // it a sticky service
</I>&gt;<i>            return StartCommandResult.Sticky;
</I>&gt;<i>         }
</I>&gt;<i>         
</I>&gt;<i>         //================================================================================
</I>&gt;<i>        /// &lt;summary&gt;
</I>&gt;<i>        /// Displays a notification
</I>&gt;<i>        /// &lt;/summary&gt;
</I>&gt;<i>        protected void ShowNotification() {
</I>&gt;<i>             // Set the icon, scrolling text and timestamp
</I>&gt;<i>            Notification notification = new Notification(Resource.drawable.icon, &quot;MediaPlayerService&quot;, DateTime.Now.ToJavaMilliseconds());
</I>&gt;<i>             
</I>&gt;<i>             // The PendingIntent to launch our activity if the user selects this notification
</I>&gt;<i>            PendingIntent contentIntent = PendingIntent.GetActivity(this, 0, new Intent(this, typeof(MediaPlayerService)), 0);
</I>&gt;<i> 
</I>&gt;<i>             // Set the info for the views that show in the notification panel.
</I>&gt;<i>            notification.SetLatestEventInfo(this, &quot;MPService&quot;, &quot;Service Running&quot;, contentIntent);
</I>&gt;<i> 
</I>&gt;<i>             // Send the notification.
</I>&gt;<i>            // We use a layout id because it is a unique number.  We use it later to cancel.
</I>&gt;<i>            // TODO: switch to a unique identifier
</I>&gt;<i>            this._notificationManager.Notify(666, notification);
</I>&gt;<i>             //mNM.notify(R.string.local_service_started, notification);
</I>&gt;<i>        }
</I>&gt;<i>         //================================================================================
</I>&gt;<i>    }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> Any ideas?
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20101021/b0dd0a85/attachment-0001.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20101021/b0dd0a85/attachment-0001.html</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001463.html">[Monodroid] Services, help please. :(
</A></li>
	<LI>Next message: <A HREF="001465.html">[Monodroid] Services, help please. :(
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1464">[ date ]</a>
              <a href="thread.html#1464">[ thread ]</a>
              <a href="subject.html#1464">[ subject ]</a>
              <a href="author.html#1464">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
