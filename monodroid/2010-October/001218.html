<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] SqlClient SqlConnection force close
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20SqlClient%20SqlConnection%20force%20close&In-Reply-To=4CAA71A4.3070503%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001217.html">
   <LINK REL="Next"  HREF="001219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] SqlClient SqlConnection force close</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20SqlClient%20SqlConnection%20force%20close&In-Reply-To=4CAA71A4.3070503%40gmail.com"
       TITLE="[Monodroid] SqlClient SqlConnection force close">jpryor at novell.com
       </A><BR>
    <I>Mon Oct  4 21:11:13 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001217.html">[Monodroid] SqlClient SqlConnection force close
</A></li>
        <LI>Next message: <A HREF="001219.html">[Monodroid] Problem playing media file from /raw directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1218">[ date ]</a>
              <a href="thread.html#1218">[ thread ]</a>
              <a href="subject.html#1218">[ subject ]</a>
              <a href="author.html#1218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Based on the exception trace, the problem is that
SqlConnection.SqlMonitorSocket wants to connect to the SQL Server
instance as (SocketType.Dgram, ProtocolType.Udp), which the
MonoDroid-profile Socket type doesn't support (SocketType.Dgram
generates the ArgumentException you see).

SqlConnection.SqlMonitorSocket is used to discover the port to use to
connect to the SQL Server instance (SqlConnection.cs:597) [0]:

        port = DiscoverTcpPortViaSqlMonitor (theServerName,
                        theInstanceName);

Consequently, the obvious workaround is to provide the port number to
connect to your SQL Server instance in the connection string.  This will
avoid the DiscoverTcpPortViaSqlMonitor() call (and corresponding
SqlMonitorSocket creation), and thus avoid the Socket creation.

 - Jon

[0]
<A HREF="http://github.com/mono/mono/blob/master/mcs/class/System.Data/System.Data.SqlClient/SqlConnection.cs#L597">http://github.com/mono/mono/blob/master/mcs/class/System.Data/System.Data.SqlClient/SqlConnection.cs#L597</A>

On Mon, 2010-10-04 at 20:30 -0400, Byron Blank wrote:
&gt;<i> I am getting an error and the application is force closing. I am
</I>&gt;<i> trying to get data from a table in a local SQL Express database using
</I>&gt;<i> the SqlClient classes. Here is the source code:
</I>&gt;<i> <A HREF="http://pastebin.com/avXtieet">http://pastebin.com/avXtieet</A>
</I>&gt;<i> 
</I>&gt;<i>  The error log is here: <A HREF="http://pastebin.com/fMHjQK9m">http://pastebin.com/fMHjQK9m</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Any ideas as to what is happening and are they and workarounds if any?
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>

</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001217.html">[Monodroid] SqlClient SqlConnection force close
</A></li>
	<LI>Next message: <A HREF="001219.html">[Monodroid] Problem playing media file from /raw directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1218">[ date ]</a>
              <a href="thread.html#1218">[ thread ]</a>
              <a href="subject.html#1218">[ subject ]</a>
              <a href="author.html#1218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
