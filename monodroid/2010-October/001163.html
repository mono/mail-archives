<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] Problem with Timer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Problem%20with%20Timer&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001208.html">
   <LINK REL="Next"  HREF="001167.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] Problem with Timer</H1>
    <B>Torello Querci</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Problem%20with%20Timer&In-Reply-To="
       TITLE="[Monodroid] Problem with Timer">tquerci at gmail.com
       </A><BR>
    <I>Sat Oct  2 13:17:04 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001208.html">[Monodroid] Nullreference excetion when trying to create SqliteConnection
</A></li>
        <LI>Next message: <A HREF="001167.html">[Monodroid] Dependency Injection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1163">[ date ]</a>
              <a href="thread.html#1163">[ thread ]</a>
              <a href="subject.html#1163">[ subject ]</a>
              <a href="author.html#1163">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm trying to use Timer on monodroid.

With Java.with java.util.Timer object no problem.
With monodroid, using System.Threading.Timer the tast task correctly
but get strange error.
I try to use the same method outside and from the timer routine but
inside the timer's routine I get an exception.

Here the logcat output get catch the exception and print with
Android.Util.Log method:

W/RSSReader(  906): News Look
W/RSSReader(  906): News Creation
W/RSSReader(  906): Exception ************* Message: Exception of type
'Java.Lang.NoClassDefFoundError' was thrown.
W/RSSReader(  906): Exception ************* StackTrace:   at
Android.Runtime.JNIEnv.FindClass (System.String classname) [0x00000]
in &lt;filename unknown&gt;:0
W/RSSReader(  906):   at Android.Runtime.JNIEnv.FindClass (System.Type
type) [0x00000] in &lt;filename unknown&gt;:0

Need I to fill a bug report or I wrong something? Here the complete source code:

using System;
using System.Threading;

using Android.App;
using Android.Content;
using Android.Runtime;
using Android.Views;
using Android.Widget;
using Android.OS;
using System.Xml;

namespace TestJLObject
{
    [Activity(Label = &quot;My Activity&quot;, MainLauncher = true)]
    public class Activity1 : Activity
    {
        int count = 1;

        public Activity1(IntPtr handle)
            : base(handle)
        {
        }

        Timer timer = null;

        protected override void OnCreate(Bundle bundle)
        {
            base.OnCreate(bundle);

            // Set our view from the &quot;main&quot; layout resource
            SetContentView(Resource.layout.main);

            // Get our button from the layout resource,
            // and attach an event to it
            Button button = FindViewById&lt;Button&gt;(Resource.id.myButton);

            button.Click += delegate { button.Text =
string.Format(&quot;{0} clicks!&quot;, count++); };

            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Syncr RSS read Start&quot;);
            RssReader.ReadNews();
            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Syncr RSS read End&quot;);
            timer = new Timer(timerCallback, null, 1000, 0);

        }

        private void timerCallback(Object obj)
        {
            try
            {
                Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Timer RSS Read Start&quot;);
                RssReader.ReadNews();
                Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Timer RSS Read End&quot;);
            }
            catch (Exception ex)
            {
                Android.Util.Log.W(&quot;RSSReader&quot;, &quot;UPDATE RSS exception.
Message: &quot; + ex.Message);
                Android.Util.Log.W(&quot;RSSReader&quot;, ex.StackTrace);
            }
        }
    }

    class RssReader
    {

        public const string FiorentinaItUrl =
@&quot;<A HREF="http://rss.feedsportal.com/c/32452/f/477065/index.rss&quot;;">http://rss.feedsportal.com/c/32452/f/477065/index.rss&quot;;</A>
        static private News[] news = null;

        static public void ReadNews()
        {
            XmlDocument doc = new XmlDocument();
            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Document creato&quot;);
            doc.Load(FiorentinaItUrl);
            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Document letto&quot;);

            XmlNodeList nodelist = doc.GetElementsByTagName(&quot;item&quot;);
            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Document analyze (there
is &quot; + nodelist.Count + &quot; elements).&quot;);

            // Read the list of nodes
            news = new News[nodelist.Count];

            int i = 0;
            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;News Look&quot;);
            foreach (XmlNode node in nodelist)
            {
                Android.Util.Log.W(&quot;RSSReader&quot;, &quot;News Creation&quot;);
                try
                {
                    News article = new News(node);

                    Android.Util.Log.W(&quot;RSSReader&quot;, &quot;News Assignment&quot;);

                    news[i++] = article;

                    Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Read &quot; + i + &quot; news.&quot;);
                }
                catch (Exception ex)
                {
                    Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Exception
************* Message: &quot;+ex.Message);
                    Android.Util.Log.W(&quot;RSSReader&quot;, &quot;Exception
************* StackTrace: &quot; + ex.StackTrace);
                }
            }
        }

        static public News News(int i)
        {
            if (i &lt; NumberOfNews)
            {
                return news[i];
            }
            return null;
        }

        static public News News(string title)
        {
            News ns = null;

            for (int i = 0; i &lt; NumberOfNews; ++i)
            {
                if (news[i].Title.Equals(title))
                {
                    ns = news[i];
                    break;
                }
            }
            return ns;
        }

        static public int NumberOfNews
        {
            get
            {
                int n = 0;

                if (news != null)
                {
                    n = news.Length;
                }

                return n;
            }
        }

        static public News NextNews { get; set; }

    }




    class News : Java.Lang.Object
    {
        public News(XmlNode node)
        {
            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;NEWS CREATION&quot;);
            if (node == null) return;

            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;NEWS ** title&quot;);

            XmlNodeList nodeList;
            nodeList = node.SelectNodes(&quot;.//title&quot;);
            if (nodeList != null &amp;&amp; nodeList.Count &gt; 0)
                Title = nodeList[0].ChildNodes[0].Value;

            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;NEWS ** link&quot;);

            nodeList = node.SelectNodes(&quot;.//link&quot;);
            if (nodeList != null &amp;&amp; nodeList.Count &gt; 0)
                Link = nodeList[0].ChildNodes[0].Value;

            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;NEWS ** pubdate&quot;);

            nodeList = node.SelectNodes(&quot;.//pubDate&quot;);
            if (nodeList != null &amp;&amp; nodeList.Count &gt; 0)
                PubblicationDate = nodeList[0].ChildNodes[0].Value;

            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;NEWS ** descrption&quot;);

            nodeList = node.SelectNodes(&quot;.//description&quot;);
            if (nodeList != null &amp;&amp; nodeList.Count &gt; 0)
                Description = nodeList[0].ChildNodes[0].Value;

            Android.Util.Log.W(&quot;RSSReader&quot;, &quot;NEWS ** isNews&quot;);

            IsNew = true;
        }

        public string Title { get; private set; }
        public string Link { get; private set; }
        public string PubblicationDate { get; private set; }
        public string Description { get; private set; }
        public bool IsNew { get; set; }

    }
}
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001208.html">[Monodroid] Nullreference excetion when trying to create SqliteConnection
</A></li>
	<LI>Next message: <A HREF="001167.html">[Monodroid] Dependency Injection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1163">[ date ]</a>
              <a href="thread.html#1163">[ thread ]</a>
              <a href="subject.html#1163">[ subject ]</a>
              <a href="author.html#1163">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
