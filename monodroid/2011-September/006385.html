<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] sharing violation trying to save a bitmap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20sharing%20violation%20trying%20to%20save%20a%20bitmap&In-Reply-To=CAJiYqXyS3Ch_4w1wM2R35XrRi093ZJZ8qQa78TY1t9SyN7dz_g%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006384.html">
   <LINK REL="Next"  HREF="006399.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] sharing violation trying to save a bitmap</H1>
    <B>John Murray</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20sharing%20violation%20trying%20to%20save%20a%20bitmap&In-Reply-To=CAJiYqXyS3Ch_4w1wM2R35XrRi093ZJZ8qQa78TY1t9SyN7dz_g%40mail.gmail.com"
       TITLE="[mono-android] sharing violation trying to save a bitmap">john at murray.gb.com
       </A><BR>
    <I>Fri Sep 23 13:38:31 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="006384.html">[mono-android] sharing violation trying to save a bitmap
</A></li>
        <LI>Next message: <A HREF="006399.html">[mono-android] Can not run Hello world monodrois sample on my device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6385">[ date ]</a>
              <a href="thread.html#6385">[ thread ]</a>
              <a href="subject.html#6385">[ subject ]</a>
              <a href="author.html#6385">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well not that I know of but I may have misunderstood 

There is one method which is called which 
= checks if the meteorological wind bitmap has already been downloaded and
saved to sdcard
= if it has it uses that 
= if not it downloads a new one and saves that (this is where the error
occurs

The overall methods is called as follows

ThreadPool.QueueUserWorkItem(o =&gt; getwindMethod(ds));

However there are 4 buttons which send a different parameter (date or
altitude) using 'ds' depending  on which button is pressed.
Does this constitute multiple threads?
I couldn&#146;t see that it would because only one button can be pressed at a
time and the previous procedure must have completed first.
Secondly this error occurs even if one only presses on button and starts one
thread?

Have I misunderstood how threading works ?
Can other threads be started even if the button is not pressed?

Many thanks anyway Sri I really appreciate your help 

John Murray 



-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of SRI
Sent: 23 September 2011 14:50
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">john at murray.gb.com</A>; Discussions related to Mono for Android
Subject: Re: [mono-android] sharing violation trying to save a bitmap

Hi

          Are you creating multiple Threads to call saveBMP, In that
case only you will see this type of jumping in code?

Best Regards,
Sridharan Srinivasan
Alias Sri.

On Fri, Sep 23, 2011 at 6:57 PM, John Murray &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">john at murray.gb.com</A>&gt; wrote:
&gt;<i> I cant understand what&#146;s going on here
</I>&gt;<i>
</I>&gt;<i> In MonoDevelop I just get an unhandled exception
</I>&gt;<i>
</I>&gt;<i> In Vis studio I get more of a clue as it says there&#146;s a sharing violation
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Weirdly stepping through in the debugger it seems to go round the loop
</I>twice
&gt;<i> (i.e. it steps down to Bitmap.compress then springs back to the
</I>File.Exists
&gt;<i> line and steps through it again
</I>&gt;<i>
</I>&gt;<i> hence one can understand that if the stream is already open there may be a
</I>&gt;<i> sharing issue
</I>&gt;<i>
</I>&gt;<i> But why does it go round twice?&#160; It gets to the line Bitmap.Compress()
</I>then
&gt;<i> loops back to File.Exists();
</I>&gt;<i>
</I>&gt;<i> If I remove the File.Exists code then it crashes out at Bitmap.Compress
</I>with
&gt;<i> the contradictory message
</I>&gt;<i>
</I>&gt;<i> &#147;System.IO.IOException: Win32 IO returned ERROR_SUCCESS&#148;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If the File.Exists code is left in I get a sharing violation when it gets
</I>to
&gt;<i> the Fielstream line
</I>&gt;<i>
</I>&gt;<i> Presumably because FS is still open having already run through that code
</I>&gt;<i> once before.
</I>&gt;<i>
</I>&gt;<i> What is going on &#150; why does it suddenly decide to revisit the earlier
</I>lines
&gt;<i> of code? Or run through a line of code twice?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> public static void saveBMP(Context cntxt,string filename)
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (File.Exists(filename))&#160;&#160;&#160;&#160; // shouldn't have to do this if
</I>&gt;<i> FileShare.Delete is working as I understand it
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; File.Delete(filename);&#160;&#160;&#160;&#160;&#160; // on second loop around it
</I>&gt;<i> deletes file but then there is an error with file does not exist
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; FileStream fs = new FileStream(filename, FileMode.Create,
</I>&gt;<i> FileAccess.Write, FileShare.Delete);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.IO.BufferedStream buf = new
</I>System.IO.BufferedStream(fs);
&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Bitmap bmp = WXclass5.windmap;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bmp.Compress(Bitmap.CompressFormat.Png, 90, buf);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fs.Close();
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; buf.Close();
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bmp = null;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //fout.Close();
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; WXclass5.pnglist = getlistpngs(cntxt);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i>
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>&gt;<i>
</I>&gt;<i>
</I>


-- 
Sridharan Srinivasan
Alias Sri
Ph:(65)98255785/(65)63922439
www.arshu.com
_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>

</PRE>








































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006384.html">[mono-android] sharing violation trying to save a bitmap
</A></li>
	<LI>Next message: <A HREF="006399.html">[mono-android] Can not run Hello world monodrois sample on my device
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6385">[ date ]</a>
              <a href="thread.html#6385">[ thread ]</a>
              <a href="subject.html#6385">[ subject ]</a>
              <a href="author.html#6385">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
