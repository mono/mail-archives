<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] NHibernate/activeRecord
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20NHibernate/activeRecord&In-Reply-To=AANLkTikpvOtYdZEVM5-xJHrcv9%3D7zSK9057KDVHADN1s%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000903.html">
   <LINK REL="Next"  HREF="000926.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] NHibernate/activeRecord</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20NHibernate/activeRecord&In-Reply-To=AANLkTikpvOtYdZEVM5-xJHrcv9%3D7zSK9057KDVHADN1s%40mail.gmail.com"
       TITLE="[Monodroid] NHibernate/activeRecord">jpryor at novell.com
       </A><BR>
    <I>Wed Sep 22 10:37:41 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000903.html">[Monodroid] NHibernate/activeRecord
</A></li>
        <LI>Next message: <A HREF="000926.html">[Monodroid] NHibernate/activeRecord
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#914">[ date ]</a>
              <a href="thread.html#914">[ thread ]</a>
              <a href="subject.html#914">[ subject ]</a>
              <a href="author.html#914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2010-09-22 at 07:48 -0400, David Pfeffer wrote:
&gt;<i> Why can't MonoDroid support proxies, etc.?
</I>
Profile size:

        <A HREF="http://lists.ximian.com/mailman/private/monodroid/2010-September/000690.html">http://lists.ximian.com/mailman/private/monodroid/2010-September/000690.html</A>

Between the runtime assemblies (mscorlib.dll, etc.), Mono.Android.dll,
and OpenTK.dll, we're already looking at an 18MB profile (*without*
debug info; including debug symbols, we're at 27MB), and since Android
is going for a multi-ABI approach (armeabi, armeabi-v7a, future x86
support), we're looking at libmono-2.0.so files of ~8.5MB per-ABI (or
~25MB total for all three ABIs [0]).

In short, for the shared runtime, if Mono.Android.dll is included, we're
looking at 52MB for armeabi+armeabi-v7a+x86, MonoDroid profile, and
debug symbols.  That's ~gigantic.

Fortunately the .apk is zip compressed, so the download size is much
smaller (~14MB for MonoRuntimeService-debug.apk containing support for 
3 ABIs and lacking Mono.Android.dll), but the contents currently need to
be extracted in order for anything to run, which is ~38.5MB (excluding
Mono.Android.dll) [2].

I have no idea how much bigger things would get if we added transparent
proxy + remoting support (which is what you're asking for), but
regardless we need to get things *smaller*, not bigger.

(Another approach is to skip the shared runtime idea and go for
MonoTouch-style embedding+linking, which should result in significantly
smaller assemblies at the cost of duplicate code if you have multiple
MonoDroid apps installed, AND there's still the problem that supporting
all 3 ABIs results in ~25MB [extracted] for native libraries...)

&gt;<i> I understand why it won't work in MonoTouch but for MonoDroid, we have
</I>&gt;<i> the full power of the Dalvik Java runtime. Java supports
</I>&gt;<i> introspection/reflection and stuff like that.
</I>
Should I laugh or cry?  This statement implies that our messaging has
gone terribly awry...

First of all, MonoDroid does NOT run atop Dalvik.  It runs
&quot;side-by-side&quot; with Dalvik; your C# code will run atop Mono, which does
the normal &quot;JIT thing&quot;, generating ARM assembler.

C# code does NOT get executed by Dalvik, nor will it ever be, so the
features present (and/or lacking) in Dalvik are completely irrelevant,
and makes about as much as sense embedding Lua and Mono into the same
address space then stating that Mono is running atop Lua.  Dalvik and
Mono share an address space, and MonoDroid contains glue code to
facilitate interaction between the two runtimes, but neither runs &quot;atop&quot;
the other:

        <A HREF="http://monodroid.net/Documentation/Architecture">http://monodroid.net/Documentation/Architecture</A>

Furthermore, the .NET equivalent to introspection/reflection is, of
vacourse, .NET Reflection, which is fully supported (which goes
considerably beyond what Java provides, via System.Reflection.Emit and
System.Linq.Expressions...), and Reflection isn't the issue, transparent
proxy support is, which is Remoting (or at least most of the Remoting
infrastructure).

I believe that the Java equivalent to Remoting is RMI (Remote Method
Invocation), and...surprise, surprise, Android does NOT include the
java.rmi package, so anything resembling transparent proxies aren't
present in Android anyway.

 - Jon

[0] This is the first time I've done this size investigation, and I'm
now very annoyed that Google is pursuing this multi-ABI approach.
Certainly it makes things more flexible, but if you need to provide ANY
amount of native code (e.g. FireFox [1]) it can *significantly* increase
package size, as providing libraries for EACH ABI can add up fast.
Alternatively, only one gets supported, which will result in &quot;failing&quot;
apps when attempting to run apps on a &quot;new&quot; ABI.

[1] For fun, FireFox uses libxul.so, which on my machine is 22MB in
size.  Can this be shrunk for use on mobile platforms?  I'll assume so,
but even if you can shrink it and the other native libraries used by
FireFox significantly, when you multiply that shrunken size by 3 you're
still looking at a large number.

[2] We are pursuing ways to minimize/remove the file extraction
requirement, but this is a work-in-progress...


</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000903.html">[Monodroid] NHibernate/activeRecord
</A></li>
	<LI>Next message: <A HREF="000926.html">[Monodroid] NHibernate/activeRecord
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#914">[ date ]</a>
              <a href="thread.html#914">[ thread ]</a>
              <a href="subject.html#914">[ subject ]</a>
              <a href="author.html#914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
