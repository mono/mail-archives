<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Hosting Mono code from native code?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Hosting%20Mono%20code%20from%20native%20code%3F&In-Reply-To=57BA2F36B2AD924398367288A0C1EAEA0757339A92%40imtcmetal.imtc.gatech.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006654.html">
   <LINK REL="Next"  HREF="006679.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Hosting Mono code from native code?</H1>
    <B>Jeremy Johnson</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20Hosting%20Mono%20code%20from%20native%20code%3F&In-Reply-To=57BA2F36B2AD924398367288A0C1EAEA0757339A92%40imtcmetal.imtc.gatech.edu"
       TITLE="[mono-android] Hosting Mono code from native code?">jeremy.johnson at imtc.gatech.edu
       </A><BR>
    <I>Wed Oct 12 10:01:50 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="006654.html">[mono-android] Interrupted Activities (states)
</A></li>
        <LI>Next message: <A HREF="006679.html">[mono-android] Hosting Mono code from native code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6655">[ date ]</a>
              <a href="thread.html#6655">[ thread ]</a>
              <a href="subject.html#6655">[ subject ]</a>
              <a href="author.html#6655">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>[I'm really sorry if this message shows up multiple times.  I'm having problems changing my email address with Nabble &amp; ths list, so there are a couple of copies awaiting moderation...  Grrr]

Thanks for the knowledge drop, guys.

So, if I elected to just build a 'normal' Mono for Android app and wanted to leverage a third-party graphing component such as aiCharts, I'd need to roll my own interop with JNI as documented here: 
<A HREF="http://docs.xamarin.com/android/advanced_topics/api_design#Java_Native_Interface_Support">http://docs.xamarin.com/android/advanced_topics/api_design#Java_Native_Interface_Support</A>

And additionally, I'm assuming I wouldn't be able to use the charting component in .AXML files, but rather would have to instantiate programically.

Am I anywhere near correct here?

Thanks!
Jeremy

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Jonathan Pryor
Sent: Monday, October 10, 2011 1:52 PM
To: Discussions related to Mono for Android
Subject: Re: [mono-android] Hosting Mono code from native code?

On Oct 9, 2011, at 11:37 AM, Holy Samosa wrote:
&gt;<i> My basic question is: can I build a native Android app that hosts a Mono assembly?  What if that assembly needs to make callbacks into the native code?
</I>
In theory, yes. I haven't tried this, but I don't see why it wouldn't work. You'd need to use the Mono Embedding API to initialize mono and load your assembly:

	<A HREF="http://www.mono-project.com/Embedding_Mono">http://www.mono-project.com/Embedding_Mono</A>

You'd need to dlopen() Mono for Android's libmonodroid.so in Release builds, then use dlsym() to load the appropriate export from libmonodroid.so at runtime (rather like LoadLibrary() + GetProcAddress()).

As for the assembly calling into native code, there's P/Invoke (specify the appropriate library name), and [DllImport(&quot;__Internal&quot;)] may be relevant, or you can use delegates/function pointers.

&gt;<i> Thus, I'm considering writing the app in Java and putting the .NET code in a library, if this is possible.
</I>
An alternate approach (which would be likely far easier to do) would be to write a &quot;normal&quot; Mono for Android app, including your custom Java code and packages, and have your Java code call into managed code via the generated Android Callable Wrappers. There are currently a number of limitations in this approach (e.g. you can't export arbitrary methods from managed code to Java), but it may be viable.

	<A HREF="http://docs.xamarin.com/android/advanced_topics/architecture">http://docs.xamarin.com/android/advanced_topics/architecture</A>
	<A HREF="http://docs.xamarin.com/android/advanced_topics/architecture/android_callable_wrappers">http://docs.xamarin.com/android/advanced_topics/architecture/android_callable_wrappers</A>
	<A HREF="http://docs.xamarin.com/android/advanced_topics/build_process#Java_Interop_Support">http://docs.xamarin.com/android/advanced_topics/build_process#Java_Interop_Support</A>

 - Jon
_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006654.html">[mono-android] Interrupted Activities (states)
</A></li>
	<LI>Next message: <A HREF="006679.html">[mono-android] Hosting Mono code from native code?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6655">[ date ]</a>
              <a href="thread.html#6655">[ thread ]</a>
              <a href="subject.html#6655">[ subject ]</a>
              <a href="author.html#6655">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
