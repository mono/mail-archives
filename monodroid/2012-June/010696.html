<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Click event in Custom Adapter fire multiple positions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Click%20event%20in%20Custom%20Adapter%20fire%20multiple%0A%20positions&In-Reply-To=%3C1DF0C46B645BCE45B14A8962D75989D71330A1F6%40PEGASUS.newlink.cz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010695.html">
   <LINK REL="Next"  HREF="010698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Click event in Custom Adapter fire multiple positions</H1>
    <B>Petr Slov&#225;&#269;ek</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Click%20event%20in%20Custom%20Adapter%20fire%20multiple%0A%20positions&In-Reply-To=%3C1DF0C46B645BCE45B14A8962D75989D71330A1F6%40PEGASUS.newlink.cz%3E"
       TITLE="[mono-android] Click event in Custom Adapter fire multiple positions">pslovacek at newlink.cz
       </A><BR>
    <I>Thu Jun  7 09:47:53 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010695.html">[mono-android] Click event in Custom Adapter fire multiple	positions
</A></li>
        <LI>Next message: <A HREF="010698.html">[mono-android] Click event in Custom Adapter fire multiple	positions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10696">[ date ]</a>
              <a href="thread.html#10696">[ thread ]</a>
              <a href="subject.html#10696">[ subject ]</a>
              <a href="author.html#10696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I had a similar problem when converting my Java app to Mono.

                check.Click += (sender, e) =&gt;
                {
                   ...
                };

This code will add a new event listener each time GetView function is called. In C# event can have more than one listener assigned. In this case if you'd move both event assignments to &quot;if (row == null)&quot; block it should fire just once.

Also you should consider a better optimization for a ListView. It really makes a difference especially for more complex ListView data. You can find more info here: <A HREF="http://syndicatex.com/programming/monodroid-list-optimization/">http://syndicatex.com/programming/monodroid-list-optimization/</A>

Petr

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Marcus
Sent: 7. &#269;ervna 2012 10:56
To: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid at lists.ximian.com</A>
Subject: [mono-android] Click event in Custom Adapter fire multiple positions

Hi, new to Mono for Android. Have problem with Click event in Custom Adapter.
I am using a custom adapter for a ListView where the layout states a button and a CheckBox on each row.  Upon clicking the button, the text on the button will change. Button and CheckBox is connected to .Click event inside GetView. 

Problem is, when clicking one button or checkbox, several click events for several buttons/checkboxes on different rows(positions) will fire, one after the other. This will happen when clicking some, but not all buttons/checkboxes(position 0 always bugs). 
I have worked allot with custom adapters in Java(Android) and have never seen this problem before. A bug or my code is faulty? Any thoughts on solution??
Using VS 2010 and Honeycomb project with latest updates for VS2010 and Monodroid.


Custom Adapter:  

public class IconAdapter : BaseAdapter
        {
            Activity cont;
            SplitActivity outerClass;
            public IconAdapter(Activity cont, int textViewResourceId, SplitActivity outerClass)
                :base()
            {
                this.cont = cont;
                this.outerClass = outerClass;
            }
			
            public override int Count {
	            get { return outerClass.items.Count; }
	        }
 	
	        public override Java.Lang.Object GetItem (int position) {
	            return null;
	        }
	 
	        public override long GetItemId (int position) {
	            return position;
	        }

            public override View GetView(int position, View convertView, ViewGroup parent)
            {
                var item = outerClass.items[position];
             //   var row = (convertView ??
cont.LayoutInflater.Inflate(Resource.Layout.main3, parent, false)) as LinearLayout;
			    View row = convertView;
			    if (row == null)
			    {
				   LayoutInflater inflater =
(LayoutInflater)cont.GetSystemService(Context.LayoutInflaterService);
				   row = inflater.Inflate(Resource.Layout.main3, null, false);                  
			    }
			    CheckBox check = row.FindViewById&lt;CheckBox&gt;(Resource.Id.checkBox1);			   
			    Button amount = row.FindViewById&lt;Button&gt;(Resource.Id.amountEdit);

		check.Text = &quot;   &quot; + item.tagId;		
                check.Checked = item.check;               
                amount.Text = item.amount;
				
                check.Click += (sender, e) =&gt;
                {
                    Toast.MakeText(cont, &quot;Checked&quot; + position, ToastLength.Short).Show();
                };

                amount.Click += (sender, e) =&gt;
                {
                    outerClass.onNewAmount(position);
                };
                return (row);
            }
        }


Layout for ListView:

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;<A HREF="http://schemas.android.com/apk/res/android">http://schemas.android.com/apk/res/android</A>&quot; 
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;

  &lt;CheckBox
      android:id=&quot;@+id/checkBox1&quot;
      android:layout_weight=&quot;2&quot;
      android:layout_width=&quot;0dp&quot;
      android:layout_height=&quot;wrap_content&quot;
      android:padding=&quot;20dp&quot;
      android:textSize=&quot;30dp&quot;
      android:text=&quot;CheckBox&quot; /&gt;
  &lt;Button
    android:id=&quot;@+id/amountEdit&quot;
    android:layout_weight=&quot;1&quot;
    android:layout_width=&quot;0dp&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:padding=&quot;20dp&quot;
    android:textSize=&quot;20sp&quot;
    /&gt;
&lt;/LinearLayout&gt;


Main Class:
 
namespace TagApp
{
    [Activity(Label = &quot;My Activity&quot;)]
    public class SplitActivity : Activity
    {
        List&lt;TagDetails&gt; items;
        CheckBox checkAll;
        private Button storeBtn;
        ListView lv;
        IconAdapter iconadapt;

        protected override void OnCreate(Bundle bundle)
        {
            base.OnCreate(bundle);
            SetContentView(Resource.Layout.main4);
            items = new List&lt;TagDetails&gt;();
            lv = FindViewById&lt;ListView&gt;(Resource.Id.my_list);
            storeBtn = FindViewById&lt;Button&gt;(Resource.Id.storeBtn);
            checkAll = FindViewById&lt;CheckBox&gt;(Resource.Id.checkBoxAll);  
			setupList();
            addToAdapter();
        }

		 public void addToAdapter()
        {
            iconadapt = new IconAdapter(this, Resource.Layout.main3, this);
            lv.Adapter = iconadapt;
        }

        public void onNewAmount(int position)
        {
            int inInt = Convert.ToInt32(items[position].amount);
            inInt++;
            string sInt = &quot;&quot; + inInt;
            items[position].amount = sInt;
            iconadapt.NotifyDataSetChanged();
        }

        public class IconAdapter : BaseAdapter
        {
			............
        }
		
		 public void setupList()
        {
            items.Add(new TagDetails() {Id = 0, amount = &quot;8&quot;, check = true});
			items.Add(new TagDetails() {Id = 0, tagId = &quot;tag0&quot;, amount = &quot;8&quot;, check = true});
			items.Add(new TagDetails() {Id = 1, tagId = &quot;tag1&quot;, amount = &quot;5&quot;, check = true});
			items.Add(new TagDetails() {Id = 2, tagId = &quot;tag2&quot;, amount = &quot;2&quot;, check = true});
			items.Add(new TagDetails() {Id = 3, tagId = &quot;tag3&quot;, amount = &quot;11&quot;, check = true});
			items.Add(new TagDetails() {Id = 4, tagId = &quot;tag4&quot;, amount = &quot;68&quot;, check = true});
			items.Add(new TagDetails() {Id = 5, tagId = &quot;tag5&quot;, amount = &quot;0&quot;, check = true});
        }

        class TagDetails
        {
            public int Id { get; set; }
            public string tagId { get; set; }
            public string amount { get; set; }
            public Boolean check { get; set; }
        }
    }
}


Main Class Layout:

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;<A HREF="http://schemas.android.com/apk/res/android">http://schemas.android.com/apk/res/android</A>&quot;
    android:orientation=&quot;vertical&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;

  &lt;LinearLayout
    style=&quot;@android:style/ButtonBar&quot;
    android:gravity=&quot;center_horizontal&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_width=&quot;match_parent&quot;&gt;

	&lt;Button
		android:id=&quot;@+id/storeBtn&quot;
		android:layout_width=&quot;match_parent&quot;
		android:layout_height=&quot;wrap_content&quot;
		android:text=&quot;STORE&quot;
		android:layout_marginLeft=&quot;30dp&quot;
		android:layout_marginBottom=&quot;5dp&quot;
		android:layout_marginRight=&quot;30dp&quot;
		android:background=&quot;#ffffff00&quot;
		android:textColor=&quot;#ff000000&quot;
		android:textSize=&quot;30sp&quot;
	/&gt;
  &lt;/LinearLayout&gt;

  &lt;LinearLayout
      android:layout_height=&quot;wrap_content&quot;
      android:layout_width=&quot;match_parent&quot;&gt;

	&lt;CheckBox
		android:id=&quot;@+id/checkBoxAll&quot;
		android:layout_weight=&quot;2&quot;
		android:layout_width=&quot;0dp&quot;
		android:layout_height=&quot;wrap_content&quot;
		android:padding=&quot;20dp&quot;
		android:textSize=&quot;30dp&quot;
		android:checked=&quot;true&quot;
		android:text=&quot;   Select All&quot; /&gt;

    &lt;TextView
		android:id=&quot;@+id/descriptionText&quot;
		android:layout_weight=&quot;1&quot;
		android:layout_width=&quot;0dp&quot;
		android:layout_height=&quot;wrap_content&quot;
		android:textSize=&quot;30dp&quot;
		android:text=&quot;Amount&quot;
    /&gt;
  &lt;/LinearLayout&gt;

  &lt;LinearLayout 
      android:layout_height=&quot;wrap_content&quot;
      android:layout_width=&quot;match_parent&quot;&gt;

    &lt;ListView
	 android:id=&quot;@+id/my_list&quot;
	 android:layout_width=&quot;match_parent&quot;
	 android:layout_height=&quot;match_parent&quot;&gt;
    &lt;/ListView&gt;
  &lt;/LinearLayout&gt;
&lt;/LinearLayout&gt;


--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/Click-event-in-Custom-Adapter-fire-multiple-positions-tp5710211.html">http://mono-for-android.1047100.n5.nabble.com/Click-event-in-Custom-Adapter-fire-multiple-positions-tp5710211.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010695.html">[mono-android] Click event in Custom Adapter fire multiple	positions
</A></li>
	<LI>Next message: <A HREF="010698.html">[mono-android] Click event in Custom Adapter fire multiple	positions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10696">[ date ]</a>
              <a href="thread.html#10696">[ thread ]</a>
              <a href="subject.html#10696">[ subject ]</a>
              <a href="author.html#10696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
