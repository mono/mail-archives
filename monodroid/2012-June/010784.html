<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] 4.2.2 Samsung Galaxy SII Turns off at runtime
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%204.2.2%20Samsung%20Galaxy%20SII%20Turns%20off%20at%20runtime&In-Reply-To=%3CC1F0A770-3BA2-44D7-AB5C-327B250846C2%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010781.html">
   <LINK REL="Next"  HREF="010793.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] 4.2.2 Samsung Galaxy SII Turns off at runtime</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%204.2.2%20Samsung%20Galaxy%20SII%20Turns%20off%20at%20runtime&In-Reply-To=%3CC1F0A770-3BA2-44D7-AB5C-327B250846C2%40xamarin.com%3E"
       TITLE="[mono-android] 4.2.2 Samsung Galaxy SII Turns off at runtime">jonp at xamarin.com
       </A><BR>
    <I>Tue Jun 12 13:58:43 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010781.html">[mono-android] 4.2.2 Samsung Galaxy SII Turns off at runtime
</A></li>
        <LI>Next message: <A HREF="010793.html">[mono-android] 4.2.2 Samsung Galaxy SII Turns off at runtime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10784">[ date ]</a>
              <a href="thread.html#10784">[ thread ]</a>
              <a href="subject.html#10784">[ subject ]</a>
              <a href="author.html#10784">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jun 12, 2012, at 7:19 AM, SweetLou wrote:
&gt;<i> I've been developing for my Motorola XOOM and my Samsung. Have for the past week just been debugging on the XOOM. Note that my application runs perfectly fine on it without crashes/freezes. However on my Samsung, the device freezes for a random amount of time for like 1 second, then actually
</I>&gt;<i> dies. Only output i get from debugger is The program 'Mono' has exited with code 255 (0xff).
</I>
Two things:

1. What is the output of the following command on each of your devices?

	adb shell getprop dalvik.vm.heapsize

I'll bet that they're not the same, and that the Xoom has a larger value than your Samsung.

2. View the Android Debug Log output:

	<A HREF="http://docs.xamarin.com/android/advanced_topics/android_debug_log">http://docs.xamarin.com/android/advanced_topics/android_debug_log</A>

I suspect that the Android Debug Log will contain GC_EXTERNAL_ALLOC messages, stating that it's run out of heap space, e.g.

	<A HREF="http://lists.ximian.com/pipermail/monodroid/2012-April/009717.html">http://lists.ximian.com/pipermail/monodroid/2012-April/009717.html</A>

If this is correct, the solution is to reduce lifetime of the managed wrapper (if possible; it should be here) by calling Dispose():

	<A HREF="http://docs.xamarin.com/android/advanced_topics/garbage_collection">http://docs.xamarin.com/android/advanced_topics/garbage_collection</A>

&gt;<i> I believe it's coming from this code snippet. My application is a image gallery in which i fetch byte arrays from a service.
</I>&gt;<i> 
</I>&gt;<i> // Code
</I>...
&gt;<i> //Decode the byte[] to the Bitmap
</I>&gt;<i> bitmap = Bitmap.CreateScaledBitmap(BitmapFactory.DecodeByteArray(byteArray, 0, byteArray.Length, op), imageWidth, imageHeight, true);
</I>
What is the lifetime of the `bitmap` instance, and does it need to live that long? Rephrased, what are you doing with it, and do you need to maintain a C# reference to it?

If you're doing something akin to:

	bitmap = GetBitmap ();
	canvas.SetBitmap (bitmap);
	// never use bitmap again...

then you should Dispose() of the bitmap ASAP:

	using (bitmap = GetBitmap ())
		canvas.SetBitmap (bitmap);

Disposing of the instance will allow Dalvik to collect the bitmap instance faster, and as Bitmap instances can be very large, allowing Dalvik to collect the Java-side data will reduce your memory footprint (and hopefully keep your app from crashing).

 - Jon

</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010781.html">[mono-android] 4.2.2 Samsung Galaxy SII Turns off at runtime
</A></li>
	<LI>Next message: <A HREF="010793.html">[mono-android] 4.2.2 Samsung Galaxy SII Turns off at runtime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10784">[ date ]</a>
              <a href="thread.html#10784">[ thread ]</a>
              <a href="subject.html#10784">[ subject ]</a>
              <a href="author.html#10784">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
