<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Larger memory footprint when using BitmapFactory.DecodeFile in C# (and huge memory for tiny image)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Larger%20memory%20footprint%20when%20using%0A%20BitmapFactory.DecodeFile%20in%20C%23%20%28and%20huge%20memory%20for%20tiny%20image%29&In-Reply-To=%3CCACWcBbn3zrYniOiaMkmfKvxy41BvUUByTT_8cAqPeWvKAZh48Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010878.html">
   <LINK REL="Next"  HREF="010883.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Larger memory footprint when using BitmapFactory.DecodeFile in C# (and huge memory for tiny image)</H1>
    <B>Tomasz Cielecki</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Larger%20memory%20footprint%20when%20using%0A%20BitmapFactory.DecodeFile%20in%20C%23%20%28and%20huge%20memory%20for%20tiny%20image%29&In-Reply-To=%3CCACWcBbn3zrYniOiaMkmfKvxy41BvUUByTT_8cAqPeWvKAZh48Q%40mail.gmail.com%3E"
       TITLE="[mono-android] Larger memory footprint when using BitmapFactory.DecodeFile in C# (and huge memory for tiny image)">tomasz at ostebaronen.dk
       </A><BR>
    <I>Mon Jun 18 11:52:42 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010878.html">[mono-android] Larger memory footprint when using BitmapFactory.DecodeFile in C# (and huge memory for tiny image)
</A></li>
        <LI>Next message: <A HREF="010883.html">[mono-android] Larger memory footprint when using BitmapFactory.DecodeFile in C# (and huge memory for tiny image)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10879">[ date ]</a>
              <a href="thread.html#10879">[ thread ]</a>
              <a href="subject.html#10879">[ subject ]</a>
              <a href="author.html#10879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As Darren said, loading a bitmap into memory decompresses it and
depending on what bitmap config you load it with it will take up more
memory than its compressed size on disk.

Take a look at
<A HREF="http://developer.android.com/reference/android/graphics/Bitmap.Config.html">http://developer.android.com/reference/android/graphics/Bitmap.Config.html</A>
<A HREF="http://androidapi.xamarin.com/?link=T%3aAndroid.Graphics.Bitmap%2bConfig%2f*">http://androidapi.xamarin.com/?link=T%3aAndroid.Graphics.Bitmap%2bConfig%2f*</A>

You have the possibility of loading the bitmap with 2 bits per pixel
or 4 bits per pixel either with or without the alpha channel.

A good idea if you are going to work with large image sizes which are
bigger than the screen bounds you probably want to scale that image
before displaying it on screen:
<A HREF="http://docs.xamarin.com/android/recipes/Resources/General/Loading_Large_Bitmaps_Efficiently">http://docs.xamarin.com/android/recipes/Resources/General/Loading_Large_Bitmaps_Efficiently</A>

On Mon, Jun 18, 2012 at 1:34 PM, Darren Abbott &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">darren at darrenabbott.com</A>&gt; wrote:
&gt;<i> How are you measuring the memory usage?&#160; Could you be including the Mono run
</I>&gt;<i> time in the C# calculation?
</I>&gt;<i>
</I>&gt;<i> The images you are loading are jpg compressed.&#160; Bitmap is an uncompressed
</I>&gt;<i> format.&#160; A little Googling showed a typical JPEG compression ratio of 10:1
</I>&gt;<i> to 20:1 without losing noticeable image quality.&#160; 60KB -&gt; 1 MB is in that
</I>&gt;<i> range.
</I>&gt;<i>
</I>&gt;<i> Darren
</I>&gt;<i>
</I>&gt;<i> On Jun 18, 2012 6:06 AM, &quot;Matthew Leibowitz&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">mattleibowmail at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I just want to see if anyone else has noticed that when loading images
</I>&gt;&gt;<i> into memory, the exact same C# code uses more memory to hold the images
</I>&gt;&gt;<i> (~1.5x the amount in Java).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This Java code results in a total memory size of 105.5 MB:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Bitmap[] bitmaps = new Bitmap[100];
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> for (int i = 0; i &lt; 100; i++)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> &#160;&#160;&#160; String root =
</I>&gt;&gt;<i> Environment.getExternalStorageDirectory().getAbsolutePath();
</I>&gt;&gt;<i> &#160;&#160;&#160; String imagePath = &quot;/evolution/threesixty/216/Edaphosaurus_001.jpg&quot;;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;&#160;&#160; bitmaps[i] = BitmapFactory.decodeFile(root + imagePath);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This C# code results in 148.1 MB:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Bitmap[]&#160;bitmaps&#160;=&#160;new&#160;Bitmap[100];
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> for&#160;(int&#160;i&#160;=&#160;0;&#160;i&#160;&lt;&#160;100;&#160;i++)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;string&#160;root&#160;=&#160;Environment.ExternalStorageDirectory.AbsolutePath;
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;string&#160;imagePath&#160;=&#160;&quot;/evolution/threesixty/216/Edaphosaurus_001.jpg&quot;;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;bitmaps[i]&#160;=&#160;BitmapFactory.DecodeFile(root&#160;+&#160;imagePath);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does anyone have any ideas as to why? I understand that the .NET wrappers
</I>&gt;&gt;<i> may use a little more to hold extra binding data or things, but surely not
</I>&gt;&gt;<i> that much?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also, as a side question:
</I>&gt;&gt;<i> Each image is only 60 KB on disk, why is the in-memory version 1 MB? I
</I>&gt;&gt;<i> know that my loading method does not do any sampling/density checking, but
</I>&gt;&gt;<i> that was not the aim. Surely loading a &lt;100KB image should not exceed 100KB
</I>&gt;&gt;<i> memory space?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i> Matthew
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Monodroid mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i>
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>&gt;<i>
</I>


-- 
Med Venlig Hilsen / With Best Regards
Tomasz Cielecki
<A HREF="http://ostebaronen.dk">http://ostebaronen.dk</A>
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010878.html">[mono-android] Larger memory footprint when using BitmapFactory.DecodeFile in C# (and huge memory for tiny image)
</A></li>
	<LI>Next message: <A HREF="010883.html">[mono-android] Larger memory footprint when using BitmapFactory.DecodeFile in C# (and huge memory for tiny image)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10879">[ date ]</a>
              <a href="thread.html#10879">[ thread ]</a>
              <a href="subject.html#10879">[ subject ]</a>
              <a href="author.html#10879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
