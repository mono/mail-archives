<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Copy from a file stream to another file stream interruped by 'INTERRUPTION_REQUESTED_HANDLE'
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Copy%20from%20a%20file%20stream%20to%20another%20file%20stream%0A%20interruped%20by%20%27INTERRUPTION_REQUESTED_HANDLE%27&In-Reply-To=%3C1339772416004-5710364.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010890.html">
   <LINK REL="Next"  HREF="010848.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Copy from a file stream to another file stream interruped by 'INTERRUPTION_REQUESTED_HANDLE'</H1>
    <B>klimaye</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Copy%20from%20a%20file%20stream%20to%20another%20file%20stream%0A%20interruped%20by%20%27INTERRUPTION_REQUESTED_HANDLE%27&In-Reply-To=%3C1339772416004-5710364.post%40n5.nabble.com%3E"
       TITLE="[mono-android] Copy from a file stream to another file stream interruped by 'INTERRUPTION_REQUESTED_HANDLE'">klimaye at gmail.com
       </A><BR>
    <I>Fri Jun 15 15:00:16 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010890.html">[mono-android] Crash on HTC
</A></li>
        <LI>Next message: <A HREF="010848.html">[mono-android] Copy from a file stream to another file stream	interruped by 'INTERRUPTION_REQUESTED_HANDLE'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10847">[ date ]</a>
              <a href="thread.html#10847">[ thread ]</a>
              <a href="subject.html#10847">[ subject ]</a>
              <a href="author.html#10847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are seeing the log below when a stream to stream copy is occurring over
the wireless.

The stream copy works fine for file size less than 10 mb. The file copy in
question is a 12 mb file.

It looks like the issue is happening in the framework level code.

Any pointers/help/workarounds would be great

Thanks

-----Code---------

public static void CopyStreamTo(this Stream input, Stream output)
        {
            //use 32kb blocks
            byte[] buffer = new byte[32 * 1024];
            int len;
            var streamLength = input.Length;
            Android.Util.Log.Info(&quot;app&quot;, string.Format(&quot;total input stream
length = {0}&quot;, streamLength));
            output.SetLength(streamLength);
            int counter = 0;
            while ((len = input.Read(buffer, 0, buffer.Length)) &gt; 0)
            {
                if (counter % 23 == 0)
                    Android.Util.Log.Info(&quot;app&quot;, string.Format(&quot;still
copying from stream to stream {0}&quot;, counter));
                output.Write(buffer, 0, len);
                counter++;
            }
}

----------------Log-----------
06-14 17:28:39.320 I/sssvida ( 3072): total input stream length = 12496896
..
..
06-14 17:28:42.930 I/app( 3072): still copying from stream to stream 1196
06-14 17:28:42.940 F/        ( 3072): * Assertion at
/Users/builder/data/lanes/monodroid-mac-4.2-series/804357b4/source/mono/mono/io-layer/wthreads.c:1343,
condition `prev_handle == INTERRUPTION_REQUESTED_HANDLE' not met
06-14 17:28:42.940 I/mono    ( 3072): Stacktrace:
06-14 17:28:42.940 I/mono    ( 3072): 
06-14 17:28:42.940 I/mono    ( 3072):   at System.Threading.Monitor.TryEnter
(object,int,bool&amp;) &lt;IL 0x00044, 0x001e3&gt;
06-14 17:28:42.940 I/mono    ( 3072):   at System.Threading.Monitor.Enter
(object,bool&amp;) &lt;IL 0x00003, 0x00053&gt;
06-14 17:28:42.940 I/mono    ( 3072):   at
System.Net.WebAsyncResult.get_IsCompleted () &lt;IL 0x0000c, 0x000b7&gt;
06-14 17:28:42.940 I/mono    ( 3072):   at
System.Net.WebConnectionStream.EndRead (System.IAsyncResult) &lt;IL 0x00030,
0x0023b&gt;
06-14 17:28:42.940 I/mono    ( 3072):   at
System.Net.WebConnectionStream.ReadCallbackWrapper (System.IAsyncResult) &lt;IL
0x0002b, 0x0019b&gt;
06-14 17:28:42.940 I/mono    ( 3072):   at System.Net.WebAsyncResult.CB
(object) &lt;IL 0x00007, 0x0005f&gt;
06-14 17:28:42.940 I/mono    ( 3072):   at (wrapper runtime-invoke)
&lt;Module&gt;.runtime_invoke_void__this___object (object,intptr,intptr,intptr)
&lt;IL 0x00052, 0xffffffff&gt;


--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/Copy-from-a-file-stream-to-another-file-stream-interruped-by-INTERRUPTION-REQUESTED-HANDLE-tp5710364.html">http://mono-for-android.1047100.n5.nabble.com/Copy-from-a-file-stream-to-another-file-stream-interruped-by-INTERRUPTION-REQUESTED-HANDLE-tp5710364.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010890.html">[mono-android] Crash on HTC
</A></li>
	<LI>Next message: <A HREF="010848.html">[mono-android] Copy from a file stream to another file stream	interruped by 'INTERRUPTION_REQUESTED_HANDLE'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10847">[ date ]</a>
              <a href="thread.html#10847">[ thread ]</a>
              <a href="subject.html#10847">[ subject ]</a>
              <a href="author.html#10847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
