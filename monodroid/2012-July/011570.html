<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] How to handle garbage collection?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20How%20to%20handle%20garbage%20collection%3F&In-Reply-To=%3C2C62538C-C6EB-4140-87B4-29F89769C204%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011565.html">
   <LINK REL="Next"  HREF="011573.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] How to handle garbage collection?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20How%20to%20handle%20garbage%20collection%3F&In-Reply-To=%3C2C62538C-C6EB-4140-87B4-29F89769C204%40xamarin.com%3E"
       TITLE="[mono-android] How to handle garbage collection?">jonp at xamarin.com
       </A><BR>
    <I>Tue Jul 31 19:15:41 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="011565.html">[mono-android] How to handle garbage collection?
</A></li>
        <LI>Next message: <A HREF="011573.html">[mono-android] How to handle garbage collection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11570">[ date ]</a>
              <a href="thread.html#11570">[ thread ]</a>
              <a href="subject.html#11570">[ subject ]</a>
              <a href="author.html#11570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Which android version is this?

On Jul 31, 2012, at 12:33 PM, craig &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">craigrs84 at gmail.com</A>&gt; wrote:
&gt;<i> It seems that there is some fundamental issue with garbage collection or else some fundamental knowledge that I am lacking.
</I>
	<A HREF="http://docs.xamarin.com/android/advanced_topics/architecture">http://docs.xamarin.com/android/advanced_topics/architecture</A>
	<A HREF="http://docs.xamarin.com/android/advanced_topics/garbage_collection">http://docs.xamarin.com/android/advanced_topics/garbage_collection</A>

&gt;<i> I've read the articles about Mono for Android GC on the support site but it didn't really help me to understand what is happening here. 
</I>
Let's try to clarify that.

&gt;<i> Here is a very simplified version with source code that behaves the same way.  Can you please take a look.  Thanks.
</I>&gt;<i> 
</I>&gt;<i> *Activity Code*
</I>&gt;<i> <A HREF="http://codeviewer.org/view/code:2890">http://codeviewer.org/view/code:2890</A>
</I>
The problem: as per the documentation, whenever you create a Java.Lang.Object subclass (e.g. TextView), you allocate a Java instance and a global reference (to associate the C# instance with the Java instance).

Which brings us to:

	for (int i = 0; i &lt; 50; i++)
	{
		TextView v = new TextView(this);
		v.Text = (count * 50 + i).ToString();
		layout.AddView(v);
	}

This requires using 50 grefs (one per TextView). This is (in general) wasteful, as all 50 items won't be displayed at once; only ~25 will (depending in display size; I see 25 on my Galaxy Nexus, 21 on my API 15 emulator). Make the list longer and things only get worse: the number of items that can be displayed is fixed, while the number of items that can be in the list is variable. Requiring a gref for invisible items in the list is wasteful, and this is where BaseAdapter comes in.

I found that adding an explicit GC.Collect() to the end of the Button.Click event handler caused the gref count to stabilize at 61 grefs. I'm still not entirely sure how you got a 2200+ gref count on the emulator; that's puzzling. :-/

 - Jon

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011565.html">[mono-android] How to handle garbage collection?
</A></li>
	<LI>Next message: <A HREF="011573.html">[mono-android] How to handle garbage collection?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11570">[ date ]</a>
              <a href="thread.html#11570">[ thread ]</a>
              <a href="subject.html#11570">[ subject ]</a>
              <a href="author.html#11570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
