<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] OpenGL API performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20OpenGL%20API%20performance&In-Reply-To=%3C000001cd6324%241025d620%2430718260%24%40thumbstar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011358.html">
   <LINK REL="Next"  HREF="011376.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] OpenGL API performance</H1>
    <B>l0nestar</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20OpenGL%20API%20performance&In-Reply-To=%3C000001cd6324%241025d620%2430718260%24%40thumbstar.com%3E"
       TITLE="[mono-android] OpenGL API performance">allan.bentham at thumbstar.com
       </A><BR>
    <I>Mon Jul 16 07:23:46 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="011358.html">[mono-android] OpenGL API performance
</A></li>
        <LI>Next message: <A HREF="011376.html">[mono-android] OpenGL API performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11374">[ date ]</a>
              <a href="thread.html#11374">[ thread ]</a>
              <a href="subject.html#11374">[ subject ]</a>
              <a href="author.html#11374">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That makes a huge difference. Thanks for that.

 

From: Jonathan Pryor-2 [via Mono for Android]
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">ml-node+s1047100n5710875h50 at n5.nabble.com</A>] 
Sent: 13 July 2012 16:07
To: l0nestar
Subject: Re: OpenGL API performance

 

On Jul 13, 2012, at 6:03 AM, l0nestar wrote: 
&gt;<i> I'm trying to optimise my test game. I'm using Android.Opengl.GLES11 to do
</I>all of my interaction with GL. However it seems to me that the cost for
calling the API is quite high. I assume that each call i make to GLES11 maps
to an equivalent java call, is there a cost associated with this transition?


Yes. It's...not cheap. 

Short version: if at all possible, use OpenTK or MonoGame. (This will also
result in code that is more portable to other platforms - Win!) 

Long version: All bindings of Java types involve lots of JNI glue code, via
the JNIEnv type: 

 
<A HREF="http://docs.xamarin.com/android/advanced_topics/Binding_Android_Types">http://docs.xamarin.com/android/advanced_topics/Binding_Android_Types</A>
        <A HREF="http://androidapi.xamarin.com/?link=T:Android.Runtime.JNIEnv">http://androidapi.xamarin.com/?link=T:Android.Runtime.JNIEnv</A>
 
<A HREF="http://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/functions.html">http://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/functions.html</A>

JNIEnv itself is fairly trivial: JNI provides a JNINativeInterface structure
pointer, which contains pointers to functions for all the JNI methods, e.g.:


        /* excerpted from &lt;jni.h&gt; */ 
        struct JNINativeInterface { 
                /* ... */ 
                jint (*GetVersion)(JNIEnv*); 
                jclass (*FindClass)(JNIEnv*, const char*, jobject, const
jbyte*, jsize); 
                /* ... */ 
        }; 

Invoking these is fairly straightforward: declare a C# &quot;mirror&quot; struct
declaration, wrap the function pointers into a delegate via
Marshal.GetDelegateForFunctionPointer(), then invoke the delegate (along
with parameter marshaling, etc.). A JNI method invoke thus consists of
invoking a delegate, which invokes a native function pointer, which calls
into Dalvik. 

Invocation thus has two sources of overhead: 

1. Mono's P/Invoke delegate invocation mechanism 
2. Dalvik's JNI mechanism. 

Mono's P/Invoke mechanism isn't that bad; if you have a C function which
does nothing, and a C# method which does nothing, and call each in a loop,
P/Invoke method invoke takes ~10x the time of a non-inlined C# method
invoke. Probably not noticeable, since normally your native method would
actually be doing something, not nothing... 

Dalvik's JNI overhead, on the other hand... Worst case, using JNI to invoke
an empty Java method, is 160x-280x the time of an equivalent non-inlined C#
method. For event-driven use this is acceptable -- you're usually invoking
Java methods which will actually Do Something, while waiting for user input
-- but OpenGL is another case entirely. 

This is why you should stick with OpenTK, as it's just direct P/Invokes into
libopengles.so/etc. This is the P/Invoke overhead case (10x), not the JNI
overhead case (160x). 

 - Jon 

_______________________________________________ 
Monodroid mailing list 
[hidden email] 

UNSUBSCRIBE INFORMATION: 
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>



  _____  

If you reply to this email, your message will be added to the discussion
below:

<A HREF="http://mono-for-android.1047100.n5.nabble.com/OpenGL-API-performance-tp57108">http://mono-for-android.1047100.n5.nabble.com/OpenGL-API-performance-tp57108</A>
63p5710875.html 

To unsubscribe from OpenGL API performance, click here
&lt;<A HREF="http://mono-for-android.1047100.n5.nabble.com/template/NamlServlet.jtp?macr">http://mono-for-android.1047100.n5.nabble.com/template/NamlServlet.jtp?macr</A>
o=unsubscribe_by_code&amp;node=5710863&amp;code=YWxsYW4uYmVudGhhbUB0aHVtYnN0YXIuY29t
fDU3MTA4NjN8MTUyNzI5ODQyMg==&gt; .
NAML 



--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/OpenGL-API-performance-tp5710863p5710891.html">http://mono-for-android.1047100.n5.nabble.com/OpenGL-API-performance-tp5710863p5710891.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/attachments/20120716/31951f35/attachment.html">http://lists.ximian.com/pipermail/monodroid/attachments/20120716/31951f35/attachment.html</A>&gt;
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011358.html">[mono-android] OpenGL API performance
</A></li>
	<LI>Next message: <A HREF="011376.html">[mono-android] OpenGL API performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11374">[ date ]</a>
              <a href="thread.html#11374">[ thread ]</a>
              <a href="subject.html#11374">[ subject ]</a>
              <a href="author.html#11374">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
