<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Can't create handler inside thread....sync	problem, why?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Can%27t%20create%20handler%20inside%20thread....sync%0A%09problem%2C%20why%3F&In-Reply-To=%3C813D894F-EA1E-4741-A345-A912F1361766%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011477.html">
   <LINK REL="Next"  HREF="011490.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Can't create handler inside thread....sync	problem, why?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Can%27t%20create%20handler%20inside%20thread....sync%0A%09problem%2C%20why%3F&In-Reply-To=%3C813D894F-EA1E-4741-A345-A912F1361766%40xamarin.com%3E"
       TITLE="[mono-android] Can't create handler inside thread....sync	problem, why?">jonp at xamarin.com
       </A><BR>
    <I>Mon Jul 23 20:08:30 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="011477.html">[mono-android] Can't create handler inside thread....sync problem,	why?
</A></li>
        <LI>Next message: <A HREF="011490.html">[mono-android] Can't create handler inside thread....sync	problem, why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11478">[ date ]</a>
              <a href="thread.html#11478">[ thread ]</a>
              <a href="subject.html#11478">[ subject ]</a>
              <a href="author.html#11478">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jul 23, 2012, at 3:49 PM, JLee wrote:
&gt;<i> I already found the solution (RunOnUIThread), but its import to my, to understand, why C#?, Mono?, Android? shows this behaviour.
</I>
All three?

Just like WPF and System.Windows.Forms, UI objects in Android may only be accessed from the UI thread.

ThreadPool threads will _never_ be the UI thread.

Consequently, if you do _anything_ on a non-UI thread, you must marshal the call back to the UI thread before doing anything to UI objects. (Again, same as with WinForms and WPF and Gtk# and MonoMac and Swing and...nearly every UI toolkit for the past 40 years except BeOS, really.)

Which brings us to events: in C#/.NET, events are raised on the thread raising the event. Thus, if you have:

	partial class MyActivity : Activity {
		public override void OnCreate(Bundle b)
		{
			// ...
			ThreadPool.QueueUserWorkItem (_ =&gt; LoadData ());
		}

		public event EventHandler MyEvent;

		void LoadData ()
		{
			var h = MyEvent;
			if (h != null)
				h (this, EventArgs.Empty);
		}
	}

LoadData() will be invoked on a ThreadPool thread, and thus the Activity.MyEvent event will be raised on a ThreadPool thread. C# will not do any thread marshaling for  you, nor will the default delegate framework. (Again, this is also true in WPF and WinForms...)

Java/Android is no different in this regard: neither Java nor Android will do any implicit marshaling to the UI thread (unless you use AsyncTask/etc.). If you create a new Thread, you need to marshal to the UI thread.

 - Jon

</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011477.html">[mono-android] Can't create handler inside thread....sync problem,	why?
</A></li>
	<LI>Next message: <A HREF="011490.html">[mono-android] Can't create handler inside thread....sync	problem, why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11478">[ date ]</a>
              <a href="thread.html#11478">[ thread ]</a>
              <a href="subject.html#11478">[ subject ]</a>
              <a href="author.html#11478">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
