<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] new project types in 4.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20new%20project%20types%20in%204.1&In-Reply-To=%3C3BC12E3A-EB66-4F08-B3FD-EE1870B6EF9E%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010032.html">
   <LINK REL="Next"  HREF="010056.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] new project types in 4.1</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20new%20project%20types%20in%204.1&In-Reply-To=%3C3BC12E3A-EB66-4F08-B3FD-EE1870B6EF9E%40xamarin.com%3E"
       TITLE="[mono-android] new project types in 4.1">jonp at xamarin.com
       </A><BR>
    <I>Thu May  3 03:03:43 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010032.html">[mono-android] new project types in 4.1
</A></li>
        <LI>Next message: <A HREF="010056.html">[mono-android] new project types in 4.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10033">[ date ]</a>
              <a href="thread.html#10033">[ thread ]</a>
              <a href="subject.html#10033">[ subject ]</a>
              <a href="author.html#10033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On May 2, 2012, at 3:45 AM, johnHolmes wrote:
&gt;<i> my first attempt to &quot;sanitize&quot; the return type was
</I>&gt;<i> 
</I>&gt;<i>        &lt;attr
</I>&gt;<i> path=&quot;/api/package[@name='com.openfeint.internal.vendor.org.codehaus.jackson']/class[@name='JsonNode']/method[@name='getElements']&quot;
</I>&gt;<i> name=&quot;managedReturn&quot;&gt;IEnumerable&lt;/attr&gt;
</I>&gt;<i> 
</I>&gt;<i> i will try with your suggested code. Just one thing, am I supposed to use &quot;*managedReturn*&quot; or &quot;*return*&quot; for the *name *attribute?
</I>
This is one of those things that we need to provide documentation &amp; guidance for. :-)

The //method/@return attribute and the //parameter/@type attributes are used to generate the JNI method signature, and thus it must match what JNI requires (or the method won't be found). Because Java generics are implemented via Type Erasure, these two attributes are identical:

	return=&quot;java.util.Iterator&quot;
	return=&quot;java.util.Iterator&lt;java.lang.Integer&gt;&quot;

For more on type erasure...go consult a decent Java 5.0 book, or see my diatribe:

	<A HREF="http://www.jprl.com/Blog/archive/development/2007/Aug-31.html">http://www.jprl.com/Blog/archive/development/2007/Aug-31.html</A>

The //method/@managedReturn attribute, if present, overrides the default return type (normally a PascalCased, .NET-ized version of the Java type name) and replaces it with a &quot;compatible&quot; managed equivalent.

What's a &quot;compatible&quot; type? Something that is _implicitly_ convertible from the generated Java type wrapper to the managed type.

The only place we use //method/@managedReturn is to &quot;work around&quot; Java's support for covariant return types. For example, android.text.SpannableStringBuilder.append() has a covariant return type and returns SpannableStringBuilder:

	<A HREF="http://developer.android.com/reference/android/text/SpannableStringBuilder.html#append(char">http://developer.android.com/reference/android/text/SpannableStringBuilder.html#append(char</A>)

By default, this would result in a C# method:

	public override SpannableStringBuilder Append(char text);

C#, unfortunately, doesn't support covariant return types and wants the return type to be IAppendable (or `override` to be removed). So we fix it up:

	&lt;attr
		path=&quot;/api/package[@name='android.text']/class[@name='SpannableStringBuilder']/method[@name='append']&quot;
		name=&quot;managedReturn&quot;&gt;Java.Lang.IAppendable&lt;/attr&gt;

Which results in the compatible type Java.Lang.IAppendable, which works because SpannableStringBuilder implements IAppendable. The result:

	<A HREF="http://androidapi.xamarin.com/?link=M%3aAndroid.Text.SpannableStringBuilder.Append(System.Char">http://androidapi.xamarin.com/?link=M%3aAndroid.Text.SpannableStringBuilder.Append(System.Char</A>)

As a variation on managedReturn, there's also an //method/@enumReturn attribute which is used for changing the return type from e.g. `int` to an enum type. We don't use these internally, opting instead to use Transform Files.

	<A HREF="http://docs.xamarin.com/android/tutorials/Binding_a_Java_Library_(.jar">http://docs.xamarin.com/android/tutorials/Binding_a_Java_Library_(.jar</A>)#Transform_Files

The transform files work by generating the //method/@enumReturn attribute, which our source code generator uses.

 - Jon

</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010032.html">[mono-android] new project types in 4.1
</A></li>
	<LI>Next message: <A HREF="010056.html">[mono-android] new project types in 4.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10033">[ date ]</a>
              <a href="thread.html#10033">[ thread ]</a>
              <a href="subject.html#10033">[ subject ]</a>
              <a href="author.html#10033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
