<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Wrong time in Callback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Wrong%20time%20in%20Callback&In-Reply-To=%3C18F7884E-EB38-4AD3-83D1-6647F815B999%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010135.html">
   <LINK REL="Next"  HREF="010137.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Wrong time in Callback</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Wrong%20time%20in%20Callback&In-Reply-To=%3C18F7884E-EB38-4AD3-83D1-6647F815B999%40xamarin.com%3E"
       TITLE="[mono-android] Wrong time in Callback">jonp at xamarin.com
       </A><BR>
    <I>Wed May 23 19:11:14 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010135.html">[mono-android] Wrong time in Callback
</A></li>
        <LI>Next message: <A HREF="010137.html">[mono-android] Animating using canvas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10485">[ date ]</a>
              <a href="thread.html#10485">[ thread ]</a>
              <a href="subject.html#10485">[ subject ]</a>
              <a href="author.html#10485">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On May 10, 2012, at 8:20 AM, H&#228;nke, Maik wrote:
&gt;<i> I tried to react to time changes, but in the callback I got the old time.
</I>
Let me see if I understand the scenario:

1. You launch your app, and access e.g. TimeZoneInfo.Local
2. You change your system timezone
3. Your app doesn't see the timezone change.

The problem is that we only lookup the timezone once, and cache that value:

	<A HREF="https://github.com/mono/mono/blob/master/mcs/class/System.Core/System/TimeZoneInfo.cs#L84">https://github.com/mono/mono/blob/master/mcs/class/System.Core/System/TimeZoneInfo.cs#L84</A>

Subsequent access to TimeZoneInfo.Local will have TimeZoneInfo.local as a non-null value, and thus the timezone won't be looked up again.

Oops.

Could you please file a bug with a test case so that we don't forget about fixing this?

The easiest way to workaround this would be to trigger a process restart if you notice that the timezone changes. (I didn't say &quot;best&quot;, I said &quot;easiest.&quot;)

Another approach may be to null out the TimeZoneInfo.local and TimeZoneInfo.ZoneInfoDB.defaultZone fields (yay Reflection?), which would should cause Mono to re-lookup the timezone the next time TimeZoneInfo.Local is accessed.

 - Jon

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010135.html">[mono-android] Wrong time in Callback
</A></li>
	<LI>Next message: <A HREF="010137.html">[mono-android] Animating using canvas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10485">[ date ]</a>
              <a href="thread.html#10485">[ thread ]</a>
              <a href="subject.html#10485">[ subject ]</a>
              <a href="author.html#10485">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
