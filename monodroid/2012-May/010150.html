<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Odd behavior when restarting app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Odd%20behavior%20when%20restarting%20app&In-Reply-To=%3C054d01cd2efa%244df1b400%24e9d51c00%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010149.html">
   <LINK REL="Next"  HREF="010135.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Odd behavior when restarting app</H1>
    <B>Randy Ficker</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Odd%20behavior%20when%20restarting%20app&In-Reply-To=%3C054d01cd2efa%244df1b400%24e9d51c00%24%40gmail.com%3E"
       TITLE="[mono-android] Odd behavior when restarting app">randyficker at gmail.com
       </A><BR>
    <I>Thu May 10 22:14:43 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="010149.html">[mono-android] Odd behavior when restarting app
</A></li>
        <LI>Next message: <A HREF="010135.html">[mono-android] Wrong time in Callback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10150">[ date ]</a>
              <a href="thread.html#10150">[ thread ]</a>
              <a href="subject.html#10150">[ subject ]</a>
              <a href="author.html#10150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Actually the work-around I presented here does not seem to work after all.
It does fix the bug, but Android doesn't always reset statics when the app
exits normally, so this can cause it to exit the app right after you launch
it.  Instead, it's necessary to keep track of the number of instances that
exist in memory:

 

 

    [Activity(MainLauncher = true)]

    public class Activity1 : Activity

    {

        private static int _numInstances = 0;

 

        protected override void OnCreate(Bundle bundle)

        {

            base.OnCreate(bundle);

 

            _numInstances++;

 

            if (_numInstances &gt; 1)

                this.Finish();

            else

            {

                var btn = new Button(this);

                btn.Text = &quot;One&quot;;

                btn.Click += (s, e) =&gt;
this.StartActivity(typeof(Activity2));

 

                SetContentView(btn);

            }

        }

 

        protected override void OnDestroy()

        {

            base.OnDestroy();

 

            _numInstances--;

        }

    }

 

 

From: Randy Ficker [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">randyficker at gmail.com</A>] 
Sent: Thursday, May 10, 2012 2:49 PM
To: 'Discussions related to Mono for Android'
Subject: RE: [mono-android] Odd behavior when restarting app

 

Hey Jon,

 

Thanks for the reply, but I think this issue is actually a new bug and not
the same bug as what you linked.  In case you didn't realize, both of the
links you gave me were written by me.

 

The differences are:

 

1.       That old bug did repro 100% of the time for me in 1.9.2, regardless
of the circumstances.  In this new bug, it works sometimes, but fails in
specific circumstances.  I do believe that old bug was fixed in 4.0.1 as the
bug describes, as everything worked great for me in 4.0.1.

2.       Under the old bug, the app was simply reverting to the first
activity.  That is, in the sample code below, Activity2 would simply be
getting deleted.    In this new bug, a new copy of the first activity is
created and pushed onto the stack.

 

The old bug was just a nuisance as it meant if the app was interrupted by a
phone call or something the user just lost their state and had to start
over.   However, this new bug is far worse, since it leaves the app sort of
in a corrupt state with activities all out of order.

 

With the steps outlined, I can repro this 100% of the time.  If you try my
steps and it doesn't repro for you, let me know and we can try to find the
difference between our environments.

 

I wish I could go back to an earlier version of MfA, but 4.0.6 has the fix
to allow ICS devices to use OpenTK apps, which is essential to me.  This
restarting bug is the only thing preventing me from releasing my app to ICS
users and they're growing restless J

 

The old bug was also impossible to work-around, since the activities were
actually getting deleted.  This new bug can actually be fixed if you
manually try to detect MfA creating a second instance of your main activity:

 

    [Activity(MainLauncher = true)]

    public class Activity1 : Activity

    {

        private static bool _exists = false;

 

        protected override void OnCreate(Bundle bundle)

        {

            Log.Info(&quot;&quot;, &quot;Activity1.OnCreate&quot;);

            base.OnCreate(bundle);

 

            if (_exists)

                this.Finish();

            else

            {

                _exists = true;

 

                var btn = new Button(this);

                btn.Text = &quot;One&quot;;

                btn.Click += (s, e) =&gt;
this.StartActivity(typeof(Activity2));

 

                SetContentView(btn);

            }

        }

    }

 

This is obviously pretty hacky, but it works.  With this code, the new copy
of Activity1 gets closed as soon as it's opened and the app works as
expected.  I'm still debating whether or not I should release my app this
way. 

 

 

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] On Behalf Of Jonathan Pryor
Sent: Thursday, May 10, 2012 1:08 PM
To: Discussions related to Mono for Android
Subject: Re: [mono-android] Odd behavior when restarting app

 

On May 10, 2012, at 5:15 AM, Randy Ficker wrote:

&gt;<i> After re-launching the app, I would expect to see Activity2 presented to
</I>the user.  Instead, it shows Activity1.  But the problem is much worse than
just seeing the wrong activity, since if the user presses Back they actually
go back to Activity2!  Going back again goes back to another copy of
Activity1.

 

This is known, but I haven't been able to figure out why it happens yet:

 

 
&lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/2011-November/006985.html">http://lists.ximian.com/pipermail/monodroid/2011-November/006985.html</A>&gt;
<A HREF="http://lists.ximian.com/pipermail/monodroid/2011-November/006985.html">http://lists.ximian.com/pipermail/monodroid/2011-November/006985.html</A>

                 &lt;<A HREF="http://bugzilla.xamarin.com/show_bug.cgi?id=1919">http://bugzilla.xamarin.com/show_bug.cgi?id=1919</A>&gt;
<A HREF="http://bugzilla.xamarin.com/show_bug.cgi?id=1919">http://bugzilla.xamarin.com/show_bug.cgi?id=1919</A>

 

Like you, I've had no luck getting a sample that repros 100% of the time,
which makes it rather difficult to figure out what's going wrong...

 

Sorry,

- Jon

 

_______________________________________________

Monodroid mailing list

 &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

 

UNSUBSCRIBE INFORMATION:

 &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>&gt;
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/attachments/20120510/ad295bd7/attachment-0001.html">http://lists.ximian.com/pipermail/monodroid/attachments/20120510/ad295bd7/attachment-0001.html</A>&gt;
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010149.html">[mono-android] Odd behavior when restarting app
</A></li>
	<LI>Next message: <A HREF="010135.html">[mono-android] Wrong time in Callback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10150">[ date ]</a>
              <a href="thread.html#10150">[ thread ]</a>
              <a href="subject.html#10150">[ subject ]</a>
              <a href="author.html#10150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
