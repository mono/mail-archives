<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] Binding Service to an Activity - Best Practices?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Binding%20Service%20to%20an%20Activity%20-%20Best%20Practices%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002717.html">
   <LINK REL="Next"  HREF="002716.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] Binding Service to an Activity - Best Practices?</H1>
    <B>Jon Dick</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20Binding%20Service%20to%20an%20Activity%20-%20Best%20Practices%3F&In-Reply-To="
       TITLE="[Monodroid] Binding Service to an Activity - Best Practices?">jondick at gmail.com
       </A><BR>
    <I>Wed Jan 26 14:06:38 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002717.html">[Monodroid] Interop with Java
</A></li>
        <LI>Next message: <A HREF="002716.html">[Monodroid] Potential bug with configuration project in Visual	Studio
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2715">[ date ]</a>
              <a href="thread.html#2715">[ thread ]</a>
              <a href="subject.html#2715">[ subject ]</a>
              <a href="author.html#2715">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Binding Services to Activity - Best Practice?

I've been wrestling with what the best way to bind my activity to a service
is.  In the java world, there seems to be a couple common ways:

   1. Create an anonymous type of BroadcastReceiver inside the Activity, so
   that you have access to the variables in the Activity's scope and can
   properly deal with them.  Here's an example of what i mean:

   <A HREF="http://stackoverflow.com/questions/4555215/android-broadcastreceiver-within-activity">http://stackoverflow.com/questions/4555215/android-broadcastreceiver-within-activity</A>
   They basically dynamically register and unregister the broadcast receiver
   on the resume and pause overrides of the activity.

   In C#, the best way to mimic this that I can think of is to subclass
   BroadcastReceiver, stick an event in the OnReceive override, then keep an
   instance of your subclassed receiver in your activity, and dynamically
   register and unregister it in the OnResume and OnPause.  This way doesn't
   sound terrible.

   2. Using Binder, and ServiceConnection to get the instance of the
   Service.  This doesn't really help with the communication from the Service
   back to the Activity though.  It's more useful to call a method on the
   service or inspect something on the service, if the Activity initiates it.

   This is easy enough to do in C#, and I've got an enhancement request
   filed with a suggestion for some reusable generics types to make this easier
   (ServiceBinder&lt;TService&gt; and ServiceConnection&lt;TService, TBinder&gt; - See:
   <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=665345">https://bugzilla.novell.com/show_bug.cgi?id=665345</A> ).
   This seems a bit clunky as well, and if you look at my enhancement, it
   still requires an event, to know when we actually have a good reference to
   the service instance.  I don't like this method very much, although I
   recognize it may be necessary to communicate with 3rd party services beyond
   our control (although I doubt that's a common use case).

I've sort of come up with my own way that seems to work, but I'd like some
opinions on any possible caveats I'm simply not seeing.  So here goes:

Declare a *public static event Action SomethingHappened;* in the Service.
 The Activity could then simply Register and unregister from the event in
the OnResume() and OnPause() overrides.  This would be quite elegant, I
think, but of course it uses a static event, which is probably not the best
practice.  I'm also not sure what implications this could have for multiple
instances of things.  If you had several instances of the Activity, all
instances would receive the event.  This could be useful or annoying,
depending on what you need for your application.

A slight variation of this would be to create the event at the instance
level, and use the ServiceConnection and Binder to get an instance of the
Service, and then subscribe to the instance's event.  This is a lot of
verbosity for not a lot of savings.  I think in most cases the static event
would be worth the cost, just for code readability.

Does anyone have an opinion on the subject?  I'd be curious to know what
other people are doing!

---
Jon (aka Redth)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110126/ddefb91f/attachment.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110126/ddefb91f/attachment.html</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002717.html">[Monodroid] Interop with Java
</A></li>
	<LI>Next message: <A HREF="002716.html">[Monodroid] Potential bug with configuration project in Visual	Studio
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2715">[ date ]</a>
              <a href="thread.html#2715">[ thread ]</a>
              <a href="subject.html#2715">[ subject ]</a>
              <a href="author.html#2715">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
