<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodroid] PackageName isn't actually case sensitive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20PackageName%20isn%27t%20actually%20case%20sensitive&In-Reply-To=AANLkTikg_EX6JfNZ_wWRVGYVFSMju125-mNVdg0OudCO%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002736.html">
   <LINK REL="Next"  HREF="002742.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodroid] PackageName isn't actually case sensitive</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5BMonodroid%5D%20PackageName%20isn%27t%20actually%20case%20sensitive&In-Reply-To=AANLkTikg_EX6JfNZ_wWRVGYVFSMju125-mNVdg0OudCO%40mail.gmail.com"
       TITLE="[Monodroid] PackageName isn't actually case sensitive">jpryor at novell.com
       </A><BR>
    <I>Fri Jan 28 10:36:23 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002736.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
        <LI>Next message: <A HREF="002742.html">[Monodroid] tab tutorial doesn't compile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2738">[ date ]</a>
              <a href="thread.html#2738">[ thread ]</a>
              <a href="subject.html#2738">[ subject ]</a>
              <a href="author.html#2738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 28, 2011, at 1:33 AM, Stefan Rusek wrote:
&gt;<i> I've published 3 apps to the Android market with mixed case package names, and haven't had a problem with any of them. A quick scan of the apps installed on my phone and at least 5 other developers are using mixed case package names. 
</I>&gt;<i> 
</I>&gt;<i> Error	1	System.InvalidOperationException: PackageName can only contain lowercase alphanumeric characters (regex: [a-z0-9.]).
</I>
This is due to a confluence of factors, none of which I like.  I deemed it the sanest solution.

TL;DR: it fixed a major bug.

Factor #1: for sanity, MonoDroid doesn't rely on the '.' prefix &quot;shortcut&quot; within &lt;activity/&gt; elements, but instead always fully qualifies everything.  Thus, instead of:

	&lt;activity android:name=&quot;.MyActivity&quot; /&gt;

monodroid generates:

	&lt;activity android:name=&quot;fully.qualified.MyActivity&quot; /&gt;

This is because it's simpler, and nicely handles the (degenerate?) case where the same type name is used in two separate namespaces.

The sole reason PascalCase package names work for you is because either (1) you're using the former and not the latter, or (2) you're using ~completely different package names for your R.java file vs. your Activities/Services/etc.

Factor #2: Android _requires_ that package names found in //activity/@android:name and related attributes start with a _lowercases_ letter:

	<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=634068#c2">https://bugzilla.novell.com/show_bug.cgi?id=634068#c2</A>

Consequently, monodroid lowercases all package names for generated Java sources.

Factor #3: Despite #2, `aapt package` is perfectly happy with having Uppercase letters in /manifest/@package, and thus when generating R.java (via `android package -J ...`) the package name could be PascalCase.  Consequently, it's entirely possible to place the aapt-generated R.java into a package that can't be referenced (in fully-qualified form) in //activity/@android:name.

Furthermore, note that we DO keep the R.java file around so that if you include custom Java sources in your project (Build Action: AndroidJavaSource) those custom sources can reference Android resources.

Factor #4: Case-insensitive filesystems, as found on Windows and OSX.

During processing, (2) will result in creating the source code:

	src/mono.samples.hello/MyActivity.java

During procesing, (3) will result in creating the source code:

	src/Mono.Samples.Hello/R.java

On Linux, this is perfectly fine.  On Windows/OSX, there is ONE directory (probably src/Mono.Samples.Hello, as it will be the first one created) and src/mono.samples.hello/MyActivity.java will be in the same directory as src/Mono.Samples.Hello/R.java.

We then compile with javac, and the ~same thing happens in the output `bin/classes` directory.

For reasons I never fully explored, when we have this scenario and build the final .apk, the classes.dex file within the .apk was _missing_ several of the types that should have been present.  I don't know if this is an issue with `dex`, or an issue with `aapt`, or if it's been fixed since (I was seeing this behavior with the Android 2.2 SDK, iirc), but the point remains...

If we allowed a mixed-case application package name, it was possible to create broken packages which wouldn't work properly, and this was (rightfully) regarded as a bug.  Requiring lowercase package names was the solution.

 - Jon

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002736.html">[Monodroid] PackageName isn't actually case sensitive
</A></li>
	<LI>Next message: <A HREF="002742.html">[Monodroid] tab tutorial doesn't compile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2738">[ date ]</a>
              <a href="thread.html#2738">[ thread ]</a>
              <a href="subject.html#2738">[ subject ]</a>
              <a href="author.html#2738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
