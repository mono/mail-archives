<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] get network interface list failure and P/Invoke	style workaround?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20get%20network%20interface%20list%20failure%20and%20P/Invoke%0A%09style%20workaround%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005494.html">
   <LINK REL="Next"  HREF="005583.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] get network interface list failure and P/Invoke	style workaround?</H1>
    <B>Iain Mcleod</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=%5Bmono-android%5D%20get%20network%20interface%20list%20failure%20and%20P/Invoke%0A%09style%20workaround%3F&In-Reply-To="
       TITLE="[mono-android] get network interface list failure and P/Invoke	style workaround?">mcleodia at gmail.com
       </A><BR>
    <I>Wed Jul 27 10:29:17 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="005494.html">[mono-android] ListView with group header
</A></li>
        <LI>Next message: <A HREF="005583.html">[mono-android] get network interface list failure and P/Invoke	style workaround?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5496">[ date ]</a>
              <a href="thread.html#5496">[ thread ]</a>
              <a href="subject.html#5496">[ subject ]</a>
              <a href="author.html#5496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi folks

I've just downloaded monodroid trial and am looking at feasibility of
porting some mono-based class libraries across.
They currently run on monotouch and compact framework so in theory they
shouldn't stretch the framework too much with anything too fancy like
lambdas etc.  They do compile successfully.

However I hit my first serious stumbling block fairly early on in the
runtime, where we obtain a list of network interfaces on the machine using
the framework method:
System.Net.NetworkInformation.GetAllNetworkInterfaces()

This crashes on monodroid and has already been logged as a bug, so fair
enough:
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=661106">https://bugzilla.novell.com/show_bug.cgi?id=661106</A>

So next up, I looked at conditional compilation and using the wrapped static
method java.net.NetworkInterface.getNetworkInterfaces()
However, this doesn't appear to be generated at all by mandroid in the
callable wrapper classes?? Are static methods not supported at present?

OK, so my next approach was a P/Invoke style call using JNIEnv (source code
at the bottom of this email).  This crashed out with a NoSuchMethodError
(stacktrace at the bottom of this email).  However a javap -s on Android.jar
suggests that the method does indeed exist there.  I'm fairly sure my syntax
is correct for the &quot;magic strings&quot; involved in the method signatures.
 Couldn't find any documentation on generics but again javap seemed to
suggest that the generic arguments are unspecified for these...  (although
if anyone can spot a doozy then fair enough!).

First question: Am I being stupid with my method signatures in the code?

Second question: If not, is there any other work around that anyone can
think of that I can try to get this functionality up and running?

Third question: Even if I manage to work around this issue, a large
proportion of our core code uses both tcp and udp socket comms.  Am I being
overly ambitious in thinking that this functionality is/will be supported in
the near future and would I perhaps be better with a rewrite in java?


Regards
Iain McLeod

-------------------------
--- stacktrace: ---
-------------------------
I/USERLOG ( 1112): java.lang.NoSuchMethodError: getNetworkInterfaces
...
I/USERLOG ( 1112): EXCEPTION CAUGHT: Java.Lang.NoSuchMethodError: Exception
of type 'Java.Lang.NoSuchMethodError' was thrown.
I/USERLOG ( 1112):   at Android.Runtime.JNIEnv.GetStaticMethodID (IntPtr
jclass, System.String name, System.String sig) [0x00024] in
/home/jpobst/Desktop/mondroid/Mono.Android/src/Runtime/JNIEnv.cs:861

---------------------------------
--- 'P/Invoke' source: ---
---------------------------------

IntPtr networkInterfaceClass =
Android.Runtime.JNIEnv.FindClass(&quot;java/net/NetworkInterface&quot;);
            IntPtr getNetworkInterfacesMethod =
Android.Runtime.JNIEnv.GetStaticMethodID(networkInterfaceClass,
&quot;getNetworkInterfaces&quot;, &quot;()Ljava/util/Enumeration&quot;);
            IntPtr enumeration =
Android.Runtime.JNIEnv.CallStaticObjectMethod(networkInterfaceClass,
getNetworkInterfacesMethod);

            IntPtr enumerationClass =
Android.Runtime.JNIEnv.FindClass(&quot;java/util/Enumeration&quot;);
            IntPtr hasMoreElementsMethod =
Android.Runtime.JNIEnv.GetMethodID(enumerationClass, &quot;hasMoreElements&quot;,
&quot;()Z&quot;);
            IntPtr nextElementMethod =
Android.Runtime.JNIEnv.GetMethodID(enumerationClass, &quot;nextElement&quot;,
&quot;()Ljava/lang/Object&quot;);
            bool hasMoreItems =
Android.Runtime.JNIEnv.CallBooleanMethod(enumeration,
hasMoreElementsMethod);
            while (hasMoreItems)
            {
                IntPtr current =
Android.Runtime.JNIEnv.CallObjectMethod(enumeration, nextElementMethod);
                Java.Net.NetworkInterface i = new
Java.Lang.Object(current).JavaCast&lt;Java.Net.NetworkInterface&gt;();
                UserLog.WriteLine(i.DisplayName);
                hasMoreItems =
Android.Runtime.JNIEnv.CallBooleanMethod(enumeration,
hasMoreElementsMethod);
            }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/mailman/private/monodroid/attachments/20110727/a11da9bc/attachment.html">http://lists.ximian.com/mailman/private/monodroid/attachments/20110727/a11da9bc/attachment.html</A> 
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005494.html">[mono-android] ListView with group header
</A></li>
	<LI>Next message: <A HREF="005583.html">[mono-android] get network interface list failure and P/Invoke	style workaround?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5496">[ date ]</a>
              <a href="thread.html#5496">[ thread ]</a>
              <a href="subject.html#5496">[ subject ]</a>
              <a href="author.html#5496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
