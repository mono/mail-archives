<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] JNI Help Please
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20JNI%20Help%20Please&In-Reply-To=%3CEF5A6A60-F632-4416-AEF6-903A81E0B116%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008725.html">
   <LINK REL="Next"  HREF="008727.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] JNI Help Please</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20JNI%20Help%20Please&In-Reply-To=%3CEF5A6A60-F632-4416-AEF6-903A81E0B116%40xamarin.com%3E"
       TITLE="[mono-android] JNI Help Please">jonp at xamarin.com
       </A><BR>
    <I>Fri Feb  3 19:16:38 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="008725.html">[mono-android] JNI Help Please
</A></li>
        <LI>Next message: <A HREF="008727.html">[mono-android] JNI Help Please
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8726">[ date ]</a>
              <a href="thread.html#8726">[ thread ]</a>
              <a href="subject.html#8726">[ subject ]</a>
              <a href="author.html#8726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It would be handy to have the .jar file to test against (or something with the same API). That said..

On Feb 3, 2012, at 1:51 PM, digitalml wrote:
&gt;<i> I used your code to call the jni_helper and initialize the reader; however,
</I>&gt;<i> the manged wrapper for the onReceiveMsgCardData() is never called.
</I>
Are you calling InitializeReader()? I'm sure you are, but it doesn't hurt to check...

&gt;<i> I can't figure out how to get the .net delegate to fire when the java version of onReceiveMsgCardData() fires.
</I>
Before n_OnReceiveMsgCardData() is invoked, Get_onReceiveMsgCardData_Handler() will be invoked, and Get_onReceiveMsgCardData_Handler() will only be invoked if:

1. There's an android callable wrapper which registers the onReceiveMsgCardData() method; the `MyJniHelper` class should do so.
2. The android callable wrapper instance is created. The android callable wrapper static constructor is responsible for registering the methods, so if you never instantiate a e.g. `MyJniHelper` instance, then the method will never be registered (and the method would never be invoked, as there's no instance to invoke it on).

Thus, at minimum your code will need to do:

	var h = new MyJniHelper();
	h.InitializeReader();

I would also suggest putting a trace into Get_onReceiveMsgCardData_Handler() to see if it's being invoked.

&gt;<i>        static IntPtr id_InitializeReader;
</I>&gt;<i>        public void InitializeReader(Activity act)
</I>&gt;<i>        {
</I>&gt;<i>            try
</I>&gt;<i>            {
</I>&gt;<i>                 if (id_InitializeReader == IntPtr.Zero)
</I>&gt;<i>                    id_InitializeReader = JNIEnv.GetMethodID(class_ref, &quot;InitializeReader&quot;, &quot;(Landroid/app/Activity;)V&quot;);
</I>&gt;<i>                JNIEnv.CallVoidMethod(Handle, id_InitializeReader, new JValue(act));
</I>&gt;<i>            }
</I>&gt;<i>            catch (Exception ex)
</I>&gt;<i>            {
</I>&gt;<i>                string err = ex.StackTrace;
</I>&gt;<i>            }
</I>&gt;<i>        }
</I>
1. Why are you wrapping InitializeReader() in a try/catch?
2. Why are you swallowing the exception?

If this throws, you want to know about it. :-)

The same is true for SwipeCard() -- in general, exceptions are exceptional; you want to know when they happen (and having the app die is a good way of knowing, at least during development), so that you can fix them.

Thanks,

 - Jon

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008725.html">[mono-android] JNI Help Please
</A></li>
	<LI>Next message: <A HREF="008727.html">[mono-android] JNI Help Please
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8726">[ date ]</a>
              <a href="thread.html#8726">[ thread ]</a>
              <a href="subject.html#8726">[ subject ]</a>
              <a href="author.html#8726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
