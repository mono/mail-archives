<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Excessive JNI global references (2001) on	hardware
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Excessive%20JNI%20global%20references%20%282001%29%20on%0A%09hardware&In-Reply-To=%3C05C52789-5766-4189-8576-CF7AC8D5756C%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008708.html">
   <LINK REL="Next"  HREF="008713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Excessive JNI global references (2001) on	hardware</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Excessive%20JNI%20global%20references%20%282001%29%20on%0A%09hardware&In-Reply-To=%3C05C52789-5766-4189-8576-CF7AC8D5756C%40xamarin.com%3E"
       TITLE="[mono-android] Excessive JNI global references (2001) on	hardware">jonp at xamarin.com
       </A><BR>
    <I>Fri Feb  3 15:00:22 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="008708.html">[mono-android] Excessive JNI global references (2001) on	hardware
</A></li>
        <LI>Next message: <A HREF="008713.html">[mono-android] Excessive JNI global references (2001) on hardware
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8709">[ date ]</a>
              <a href="thread.html#8709">[ thread ]</a>
              <a href="subject.html#8709">[ subject ]</a>
              <a href="author.html#8709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 3, 2012, at 7:54 AM, PVoLan wrote:
&gt;<i> Please, look at this test case <A HREF="https://github.com/PVoLan/TestAccelerometer">https://github.com/PVoLan/TestAccelerometer</A>
</I>
Your sample is is largely a simplified version of:

	<A HREF="http://bugzilla.xamarin.com/show_bug.cgi?id=1084">http://bugzilla.xamarin.com/show_bug.cgi?id=1084</A>

The current &quot;fix&quot; (workaround) is to dispose of `val` within SensorListener.OnSensorChanged():

	public void OnSensorChanged (SensorEvent e)
	{
		var val = e.Values;
		try {
			Android.Util.Log.Info(&quot;-------------&quot;,&quot;Works for: &quot; + (DateTime.Now - created));
			Android.Util.Log.Info(&quot;-------------&quot;,string.Format(&quot;X: {0} Y: {1} Z: {2}&quot;, val[0], val[1], val[2] ));
		} finally {
			((IDisposable) val).Dispose ();
		}
	}

A future release will improve matters by automatically calling GC.Collect() when we pass a certain gref threshold, but even that fix may not be ideal as it may result in too many collections (e.g. if you have an animation loop, you want to control when the GC runs), so explicitly disposing of wrappers may still be required even after the implicit GC.Collect() call is in place.

 - Jon

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008708.html">[mono-android] Excessive JNI global references (2001) on	hardware
</A></li>
	<LI>Next message: <A HREF="008713.html">[mono-android] Excessive JNI global references (2001) on hardware
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8709">[ date ]</a>
              <a href="thread.html#8709">[ thread ]</a>
              <a href="subject.html#8709">[ subject ]</a>
              <a href="author.html#8709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
