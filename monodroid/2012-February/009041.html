<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] FindViewById returning a ViewGroupInvoker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20FindViewById%20returning%20a%20ViewGroupInvoker&In-Reply-To=%3C2D034522-14A3-48B8-A6C5-B8D548A191B4%40xamarin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009039.html">
   <LINK REL="Next"  HREF="009044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] FindViewById returning a ViewGroupInvoker</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20FindViewById%20returning%20a%20ViewGroupInvoker&In-Reply-To=%3C2D034522-14A3-48B8-A6C5-B8D548A191B4%40xamarin.com%3E"
       TITLE="[mono-android] FindViewById returning a ViewGroupInvoker">jonp at xamarin.com
       </A><BR>
    <I>Thu Feb 23 02:28:48 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009039.html">[mono-android] FindViewById returning a ViewGroupInvoker
</A></li>
        <LI>Next message: <A HREF="009044.html">[mono-android] FindViewById returning a ViewGroupInvoker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9041">[ date ]</a>
              <a href="thread.html#9041">[ thread ]</a>
              <a href="subject.html#9041">[ subject ]</a>
              <a href="author.html#9041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 22, 2012, at 10:50 AM, Chris Tacke wrote:
&gt;<i> Later on in my app, I'd like to get hold of this MapView so I can zoom in on it, but I'm having difficulty.
</I>&gt;<i> 
</I>&gt;<i> My first attempt returned null:
</I>&gt;<i> 
</I>&gt;<i>            var m = m_layout.FindViewById&lt;MapView&gt;(Resource.Id.DriverMap);
</I>...
&gt;<i> So I tried this:
</I>&gt;<i> var m = m_layout.FindViewById(Resource.Id.DriverMap);
</I>
This doesn't make sense to me. :-/

View.FindViewById&lt;T&gt;(int) is (incorrectly!) this:

	public T FindViewById&lt;T&gt; (int id)
	{
		object view = this.FindViewById (id);

		return (T)view;
	}

I have no idea why View.FindViewById&lt;T&gt;(int) would return null while View.FindViewById(int) returns a non-null instance. I'd expect an InvalidCastException, since FindViewById&lt;T&gt;(int) is calling FindViewById(int)...

As I said, that implementation is incorrect. (Thanks for finding the bug! I fixed Activity but forgot about View...) It will be fixed in the 4.2 series so that FindViewById&lt;MapView&gt;() will work as expected. In the mean time...

&gt;<i> I run this:
</I>&gt;<i> 
</I>&gt;<i> var mt = m.GetType().Name;
</I>&gt;<i> 
</I>&gt;<i> And I get back &quot;ViewGroupInvoker&quot;
</I>
The problem here is a leaky abstraction: at present, our Java instance wrapper logic only knows about types from android.jar/Mono.Android.dll, and MapView isn't in android.jar, so it's not known. So we check the base type of MapView, find ViewGroup, which we _do_ know about, but it's abstract. &quot;Fortunately&quot; our plumbing generates &quot;Invoker&quot; types for abstract types and interfaces, so we construct a ViewGroupInvoker to hold thew MapView, as a MapView IS-A ViewGroup, and we return the invoker.

This still isn't entirely useful to you. The missing part you want/need is the Extensions.JavaCast&lt;T&gt;() extension method:

	<A HREF="http://androidapi.xamarin.com/?link=M:Android.Runtime.Extensions.JavaCast{TResult">http://androidapi.xamarin.com/?link=M:Android.Runtime.Extensions.JavaCast{TResult</A>}

Extensions.JavaCast&lt;T&gt;() is used to traverse (and type-check) the Java type system when the Mono for Android type system is dealing with incomplete information. You could thus do:

	MapView m = m_layout.FindViewById(Resource.Id.DriverMap).JavaCast&lt;MapView&gt;();

This would return a (far more useful) MapView instance instead of a ViewGroupInvoker instance.

Thanks,
 - Jon

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009039.html">[mono-android] FindViewById returning a ViewGroupInvoker
</A></li>
	<LI>Next message: <A HREF="009044.html">[mono-android] FindViewById returning a ViewGroupInvoker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9041">[ date ]</a>
              <a href="thread.html#9041">[ thread ]</a>
              <a href="subject.html#9041">[ subject ]</a>
              <a href="author.html#9041">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
