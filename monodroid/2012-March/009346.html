<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Asynchronous display pics into listview
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Asynchronous%20display%20pics%20into%20listview&In-Reply-To=%3CCANdg_tSBgoNn1uujQ3XiOOy_jNNyuxFDj3dH916FCB_isNfNhg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009343.html">
   <LINK REL="Next"  HREF="009349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Asynchronous display pics into listview</H1>
    <B>Stuart Lodge</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Asynchronous%20display%20pics%20into%20listview&In-Reply-To=%3CCANdg_tSBgoNn1uujQ3XiOOy_jNNyuxFDj3dH916FCB_isNfNhg%40mail.gmail.com%3E"
       TITLE="[mono-android] Asynchronous display pics into listview">me at slodge.com
       </A><BR>
    <I>Mon Mar 19 08:35:08 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009343.html">[mono-android] Asynchronous display pics into listview
</A></li>
        <LI>Next message: <A HREF="009349.html">[mono-android] Asynchronous display pics into listview
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9346">[ date ]</a>
              <a href="thread.html#9346">[ thread ]</a>
              <a href="subject.html#9346">[ subject ]</a>
              <a href="author.html#9346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There are several ways to get something like this to work.

One simple way is to maintain a dictionary of row numbers (position) to
ImageView's - that way the row number can be your unique number.

You do of course need to make sure that your dictionary is kept up to date
if your convertView's get reused.

e.g. you could do something like:

private Dictionary&lt;int, ImageView&gt; _imageLookup;

       public override View GetView(int position, View convertView,
ViewGroup parent)****

{****

lock(this)

{

var view = (convertView ??
inflater.Inflate(Resource.Layout.DialogCategoriesLigne, parent, false)) as
LinearLayout;****

var ImageItem =
view.FindViewById(Resource.Id.imageItemDialogCategoriesLigne) as ImageView;

foreach (var kvp in _imageLookup)

{

if (kvp.Value == ImageItem)

{

_imageLookup.Remove(kvp.Key);

break;

}

}

_imageLookup[position] = ImageItem;

KickOffAsyncSearchHere(position);



var Description =
view.FindViewById(Resource.Id.descriptionDialogCategoriesLigne) as TextView;
****

var Nbimages = view.FindViewById(Resource.Id.nbimgDialogCategoriesLigne) as
TextView;

ImageItem.SetImageResource(Resource.Drawable.DefaultImageMenu);****

Description.SetText(listetext[position].description);****

Nbimages.SetText(listetext[position].description);



return view****

}****

}

// async thread comes in here somehow
private void ImageSearchComplete(int position, Drawable drawable)
{
RunOnUIThread(() =&gt; UIImageSearchComplete(position drawable));
}

// called on UI thread - but use lock anyway
private void UIImageSearchComplete(int position, Drawable drawable)
{
lock (this)
{
ImageView imageView;
if (!_imageLookup.TryGetValue(position, out imageView)
return;
imageView.SetDrawable(drawable);
}



Another way to do this is to wrap up the logic inside a subclassed
ImageView. I've recently coded something like this for this class -
<A HREF="https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross.Binding/Android/Views/MvxHttpImageView.cs">https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross.Binding/Android/Views/MvxHttpImageView.cs</A>

Which internally uses this helper:
<A HREF="https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross/Platform/Images/MvxDynamicImageHelper.cs">https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross/Platform/Images/MvxDynamicImageHelper.cs</A>
-
which in turn uses a &quot;disk&quot; and in-memory caching framework - a bit  like
the code in monotouch.dialog

If you don't care abour disk and in-memory caching, then you should be able
to hack something up quite quickly.

Stuart


On 18 March 2012 17:37, Michel &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">michel.waast at gmail.com</A>&gt; wrote:

&gt;<i> Hello.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> To display asynchonous pics to my listview, with one or more http
</I>&gt;<i> connexions, i wrote a special thread, and change Imageitem.setImageDrawable.
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i> But there is a problem with this system.... i must put a unique id for
</I>&gt;<i> each ImageView in listview, load the item ImageView into a list, and just
</I>&gt;<i> view.Addview(Imageitem) if item imageview is not null to not do a new
</I>&gt;<i> ImageView() when Getview is call****
</I>&gt;<i>
</I>&gt;<i> But GREF inscrease :(, and application crash if i scroll lot of!****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> The best Getview to not have increase GREF (0 increase more), is :****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i>        public override View GetView(int position, View convertView,
</I>&gt;<i> ViewGroup parent)****
</I>&gt;<i>
</I>&gt;<i>         {****
</I>&gt;<i>
</I>&gt;<i>             var view = (convertView ??
</I>&gt;<i> inflater.Inflate(Resource.Layout.DialogCategoriesLigne, parent, false)) as
</I>&gt;<i> LinearLayout;****
</I>&gt;<i>
</I>&gt;<i>             var ImageItem =
</I>&gt;<i> view.FindViewById(Resource.Id.imageItemDialogCategoriesLigne) as ImageView;
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i>             var Description =
</I>&gt;<i> view.FindViewById(Resource.Id.descriptionDialogCategoriesLigne) as TextView;
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i>             var Nbimages =
</I>&gt;<i> view.FindViewById(Resource.Id.nbimgDialogCategoriesLigne) as TextView;****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ImageItem.SetImageResource(Resource.Drawable.DefaultImageMenu);****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Description.SetText(listetext[position].description);****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Nbimages.SetText(listetext[position].description);****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>                 ****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> return view****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> }****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i> The problem with it, i can't put a unique Id to my ImageItem, and in my
</I>&gt;<i> independant Thread, i can't change the pic.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> If i just do in my independant thread a ImageItem.setImageDrawable, all
</I>&gt;<i> pics are loaded in the first listview item....****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Somone have a idea ?****
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodroid mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>
</I>&gt;<i>
</I>&gt;<i> UNSUBSCRIBE INFORMATION:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/attachments/20120319/6bc86c2f/attachment-0001.html">http://lists.ximian.com/pipermail/monodroid/attachments/20120319/6bc86c2f/attachment-0001.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009343.html">[mono-android] Asynchronous display pics into listview
</A></li>
	<LI>Next message: <A HREF="009349.html">[mono-android] Asynchronous display pics into listview
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9346">[ date ]</a>
              <a href="thread.html#9346">[ thread ]</a>
              <a href="subject.html#9346">[ subject ]</a>
              <a href="author.html#9346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
