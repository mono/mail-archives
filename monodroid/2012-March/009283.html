<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Urban Airship Push Notifications - JNIENV
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Urban%20Airship%20Push%20Notifications%20-%20JNIENV&In-Reply-To=%3C1331413682583-5553668.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009279.html">
   <LINK REL="Next"  HREF="009284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Urban Airship Push Notifications - JNIENV</H1>
    <B>GavinBryan</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Urban%20Airship%20Push%20Notifications%20-%20JNIENV&In-Reply-To=%3C1331413682583-5553668.post%40n5.nabble.com%3E"
       TITLE="[mono-android] Urban Airship Push Notifications - JNIENV">gavinbryan at hotmail.com
       </A><BR>
    <I>Sat Mar 10 21:08:02 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009279.html">[mono-android] Occasional Receive Failure?
</A></li>
        <LI>Next message: <A HREF="009284.html">[mono-android] Urban Airship Push Notifications - JNIENV
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9283">[ date ]</a>
              <a href="thread.html#9283">[ thread ]</a>
              <a href="subject.html#9283">[ subject ]</a>
              <a href="author.html#9283">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm writing some Mono For Android code to use Urban Airship Push
Notifications (www.<A HREF="http://urbanairship.com">http://urbanairship.com</A>). I have downloaded the Urban
Airship sample java android project and can get everything working using
their Java project but need to create a Mono For Android project and make
some calls to their JAR file (urbanairship-lib-1.0.7.jar) which I have
included in my project and seem to be able to access the Java classes and
methods using JNIENV, although this is the first time I have used JNIENV and
feeling my way and not 100% I'm doing the right thing. I need to make the
Java calls listed below in C# using JNIENV which I've also started to do as
a test below but am getting an error when calling
JNIEnv.CallStaticVoidMethod, saying invalid application configuration which
reading up was suggesting that the airshipconfig.properties might not be
right but the file is the same as my Java Android project and works fine in
there. 

I've included airshipconfig.properties in my assets folder and is identical
settings to the Java project that I have working. I think it maybe where I'm
trying to return the AirshipConfigOptions from loaddefaultOptions method as
I'm not sure what call to make to return a AirshipConfigOptions type with
JNIENV

I was wondering if anyone else had used Urban Airship from Mono For Android
(I have Urban Airship working in MonoTouch fine and also have used C2DM
directly without Urban Airship and that works fine too) and think I could do
with help me with the JNIENV calls. I can provide more detail if anything is
missing here.

Thanks


-----------------------------------------&gt; Java Android Code
public class MyApplication extends Application {
    
    @Override
    public void onCreate() {

AirshipConfigOptions options =
AirshipConfigOptions.loadDefaultOptions(this);
UAirship.takeOff(this, options);

}

public static com.urbanairship.AirshipConfigOptions
loadDefaultOptions(android.content.Context context) { /* compiled code */ }

public static void takeOff(android.app.Application application,
com.urbanairship.AirshipConfigOptions airshipConfigOptions) { /* compiled
code */ }

-----------------------------------------&gt; C# Mono For Android Code

 private void Temp1()
    {
      IntPtr ip_airshipConfigOptions =
JNIEnv.FindClass(&quot;com/urbanairship/AirshipConfigOptions&quot;);

      if (ip_airshipConfigOptions == IntPtr.Zero)
      {
        throw new InvalidOperationException(&quot;Counldn't find java class !&quot;);
      }
           
      IntPtr methodId = JNIEnv.GetStaticMethodID(ip_airshipConfigOptions,
&quot;loadDefaultOptions&quot;,
&quot;(Landroid/content/Context;)Lcom/urbanairship/AirshipConfigOptions;&quot;);

      if (methodId == IntPtr.Zero)
      {
        throw new InvalidOperationException(&quot;Couldn't find java class !&quot;);
      }

      var methodPtr = JNIEnv.CallStaticObjectMethod(ip_airshipConfigOptions,
methodId, new JValue(this.Application));


      IntPtr ip_uairship = JNIEnv.FindClass(&quot;com/urbanairship/UAirship&quot;);

      if (ip_uairship == IntPtr.Zero)
      {
        throw new InvalidOperationException(&quot;Couldn't find java class !&quot;);
      }

      // Test different options ???
      IntPtr methodId2 = JNIEnv.GetStaticMethodID(ip_uairship, &quot;takeOff&quot;,
&quot;(Landroid/app/Application;Lcom/urbanairship/AirshipConfigOptions;)V&quot;);

      // Test different options ???
      IntPtr methodId3 = JNIEnv.GetStaticMethodID(ip_uairship, &quot;takeOff&quot;,
&quot;(Landroid/app/Application;)V&quot;);

      // Call UAirship.takeOff(this, options). Not sure if these parameters
are specified correctly
      JNIEnv.CallStaticVoidMethod(ip_uairship, methodId2, new
JValue(this.Application), new JValue(methodPtr));
   
    }

--
View this message in context: <A HREF="http://mono-for-android.1047100.n5.nabble.com/Urban-Airship-Push-Notifications-JNIENV-tp5553668p5553668.html">http://mono-for-android.1047100.n5.nabble.com/Urban-Airship-Push-Notifications-JNIENV-tp5553668p5553668.html</A>
Sent from the Mono for Android mailing list archive at Nabble.com.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009279.html">[mono-android] Occasional Receive Failure?
</A></li>
	<LI>Next message: <A HREF="009284.html">[mono-android] Urban Airship Push Notifications - JNIENV
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9283">[ date ]</a>
              <a href="thread.html#9283">[ thread ]</a>
              <a href="subject.html#9283">[ subject ]</a>
              <a href="author.html#9283">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
