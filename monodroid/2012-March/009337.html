<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] bug into listview (monodroid bug ?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20bug%20into%20listview%20%28monodroid%20bug%20%3F%29&In-Reply-To=%3C4f6317e8.e249b40a.33a4.ffff9f10%40mx.google.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009330.html">
   <LINK REL="Next"  HREF="009328.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] bug into listview (monodroid bug ?)</H1>
    <B>Michel</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20bug%20into%20listview%20%28monodroid%20bug%20%3F%29&In-Reply-To=%3C4f6317e8.e249b40a.33a4.ffff9f10%40mx.google.com%3E"
       TITLE="[mono-android] bug into listview (monodroid bug ?)">michel.waast at gmail.com
       </A><BR>
    <I>Fri Mar 16 10:37:11 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009330.html">[mono-android] bug into listview (monodroid bug ?)
</A></li>
        <LI>Next message: <A HREF="009328.html">[mono-android] continually installing runtime and framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9337">[ date ]</a>
              <a href="thread.html#9337">[ thread ]</a>
              <a href="subject.html#9337">[ subject ]</a>
              <a href="author.html#9337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I change all my code :) But I've a last problem I don't understand.

First, my items for the GetView are in a list&lt;&gt;, who contain :

A int for the Id of my ImageView,
A linearlayout (default null)
A TextView (default null)
A TextView(default null)
And a ImageView  (default null)


So now, in the View GetView, if linearlayout is null, I initialize it and
other properties, and put to the ImageView a
.SetImageResource(Resource.Drawable.DefaultImageMenu);

I've no problem, work very fine, very very fast. When I scroll, I see needed
items in View GetView, ok..

A the end of the View GetView, I've another List, who I put, if
ImageView.isShown(), for asynchronous download pics, the pic to change in
the ImageView (a permanent other thread who is launched at the beginning of
the application).

In this other thread, if ImageView.isShown(), he download the pic, and
change the pic by a
(ImageView)Imageview.FindViewById(Id)).SetImageDrawable(ImageFromInternet);

I don't understand why, after each changement of the pic, he return to the
View GetView for this item.

It's for me a problem because, when he return to the View GetView, he ask to
my other thread to rechange again the pic (who is already print to the
screen!), and when the other pic change the pic, he return to the View
GetView etc etc etc..

Someone have a idea?




-----Message d'origine-----
De&#160;: <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] De la part de Jonathan Pryor
Envoy&#233;&#160;: jeudi 15 mars 2012 15:32
&#192;&#160;: Discussions related to Mono for Android
Objet&#160;: Re: [mono-android] bug into listview (monodroid bug ?)

And for those not on #monodroid...

On Mar 15, 2012, at 7:07 AM, Michel wrote:
...
&gt;<i> -- Class ListViewCategories --
</I>&gt;<i> public class ListViewCategories : BaseAdapter
</I>...
&gt;<i> 		public override View GetView (int position, View
</I>convertView, ViewGroup parent)

The intent of the `convertView` parameter is to reuse an existing instance
that you allocated, thus reducing the number of objects that exist, reducing
memory pressure, and keeping performance up:

	
<A HREF="http://androidapi.xamarin.com/?link=M:Android.Widget.IAdapter.GetView">http://androidapi.xamarin.com/?link=M:Android.Widget.IAdapter.GetView</A>

	convertView:
		 The old view to reuse, if possible.

The problem? While `convertView` is checked:

&gt;<i>            View vi = convertView;
</I>&gt;<i>            if (convertView == null)
</I>&gt;<i>            {
</I>&gt;<i>                //Log.Debug(&quot;--&gt; ConvertView null&quot;);
</I>&gt;<i>                vi = inflater.Inflate(Resource.Layout.DialogCategories,
</I>null);
&gt;<i>               // Log.Debug(&quot;&lt;-- ConvertView null&quot;);
</I>&gt;<i>            }
</I>
...nothing is done with it. Instead, a new view is always created and
returned:

&gt;<i>            LinearLayout view = new LinearLayout(context);
</I>...
&gt;<i> 			return view;
</I>&gt;<i> 		}
</I>
The result, as you see, is a constantly increasing gref count.

There are two solutions here:

1. Call GC.Collect() more often so that the unused LinearLayout instances
will be collected. However, this may or may not work; it depends on what
Android does with the returned instances. If it retains a reference to all
of them, then they will never be collected.

2. Use the `convertView` parameter as it is intended: actually reuse the
view. For example, in this instance the `convertView` will likely be a
LinearLayout instance, as constructed by the GetView() method, so you could
grab the already existing TextView instances and change their strings
instead of creating a new LinearLayout + TextView object graph.

 - Jon

_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009330.html">[mono-android] bug into listview (monodroid bug ?)
</A></li>
	<LI>Next message: <A HREF="009328.html">[mono-android] continually installing runtime and framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9337">[ date ]</a>
              <a href="thread.html#9337">[ thread ]</a>
              <a href="subject.html#9337">[ subject ]</a>
              <a href="author.html#9337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
