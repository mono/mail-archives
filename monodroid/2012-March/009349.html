<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-android] Asynchronous display pics into listview
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Asynchronous%20display%20pics%20into%20listview&In-Reply-To=%3C4f673721.c268b40a.715b.ffff8a74%40mx.google.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009346.html">
   <LINK REL="Next"  HREF="009347.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-android] Asynchronous display pics into listview</H1>
    <B>Michel</B> 
    <A HREF="mailto:monodroid%40lists.ximian.com?Subject=Re%3A%20%5Bmono-android%5D%20Asynchronous%20display%20pics%20into%20listview&In-Reply-To=%3C4f673721.c268b40a.715b.ffff8a74%40mx.google.com%3E"
       TITLE="[mono-android] Asynchronous display pics into listview">michel.waast at gmail.com
       </A><BR>
    <I>Mon Mar 19 13:39:39 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="009346.html">[mono-android] Asynchronous display pics into listview
</A></li>
        <LI>Next message: <A HREF="009347.html">[mono-android] Calling System.Net.WebClient.DownloadData(string url) without INTERNET permission does'n cause any exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9349">[ date ]</a>
              <a href="thread.html#9349">[ thread ]</a>
              <a href="subject.html#9349">[ subject ]</a>
              <a href="author.html#9349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After search a lot for my problem, i see all work fine
  Just for my test, I
never scroll to see the result




 so i&#146;ve a last problem i don&#146;t
understand.

 

The first time the listview is call, all pics are loaded in the first line
.
But after, if I scroll down, picts are loaded in the good lines, and If I
scroll up, it&#146;s ok too


 

Have an idea?

 

 

De : <A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">monodroid-bounces at lists.ximian.com</A>] De la part de Stuart Lodge
Envoy&#233; : lundi 19 mars 2012 09:35
&#192; : Discussions related to Mono for Android
Objet : Re: [mono-android] Asynchronous display pics into listview

 

There are several ways to get something like this to work.

 

One simple way is to maintain a dictionary of row numbers (position) to
ImageView's - that way the row number can be your unique number.

 

You do of course need to make sure that your dictionary is kept up to date
if your convertView's get reused.

 

e.g. you could do something like:

 

private Dictionary&lt;int, ImageView&gt; _imageLookup;

 

       public override View GetView(int position, View convertView,
ViewGroup parent)

{

lock(this)

{

var view = (convertView ??
inflater.Inflate(Resource.Layout.DialogCategoriesLigne, parent, false)) as
LinearLayout;

var ImageItem =
view.FindViewById(Resource.Id.imageItemDialogCategoriesLigne) as ImageView;

foreach (var kvp in _imageLookup)

{

if (kvp.Value == ImageItem)

{

_imageLookup.Remove(kvp.Key);

break;

}

}

_imageLookup[position] = ImageItem;

KickOffAsyncSearchHere(position);

 

var Description =
view.FindViewById(Resource.Id.descriptionDialogCategoriesLigne) as TextView;

var Nbimages = view.FindViewById(Resource.Id.nbimgDialogCategoriesLigne) as
TextView;

ImageItem.SetImageResource(Resource.Drawable.DefaultImageMenu);

Description.SetText(listetext[position].description);

Nbimages.SetText(listetext[position].description);

 

return view

}

}

 

// async thread comes in here somehow

private void ImageSearchComplete(int position, Drawable drawable)

{

RunOnUIThread(() =&gt; UIImageSearchComplete(position drawable));

}

 

// called on UI thread - but use lock anyway

private void UIImageSearchComplete(int position, Drawable drawable)

{

lock (this)

{

ImageView imageView;

if (!_imageLookup.TryGetValue(position, out imageView)

return;

imageView.SetDrawable(drawable);

}

 

 

 

Another way to do this is to wrap up the logic inside a subclassed
ImageView. I've recently coded something like this for this class -
<A HREF="https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross.">https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross.</A>
Binding/Android/Views/MvxHttpImageView.cs

 

Which internally uses this helper:
<A HREF="https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross/">https://github.com/slodge/MvvmCross/blob/master/Cirrious/Cirrious.MvvmCross/</A>
Platform/Images/MvxDynamicImageHelper.cs - which in turn uses a &quot;disk&quot; and
in-memory caching framework - a bit  like the code in monotouch.dialog

 

If you don't care abour disk and in-memory caching, then you should be able
to hack something up quite quickly.

 

Stuart


 

On 18 March 2012 17:37, Michel &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">michel.waast at gmail.com</A>&gt; wrote:

Hello.

 

To display asynchonous pics to my listview, with one or more http
connexions, i wrote a special thread, and change Imageitem.setImageDrawable.

But there is a problem with this system.... i must put a unique id for each
ImageView in listview, load the item ImageView into a list, and just
view.Addview(Imageitem) if item imageview is not null to not do a new
ImageView() when Getview is call

But GREF inscrease :(, and application crash if i scroll lot of!

 

The best Getview to not have increase GREF (0 increase more), is :

 

       public override View GetView(int position, View convertView,
ViewGroup parent)

        {

            var view = (convertView ??
inflater.Inflate(Resource.Layout.DialogCategoriesLigne, parent, false)) as
LinearLayout;

            var ImageItem =
view.FindViewById(Resource.Id.imageItemDialogCategoriesLigne) as ImageView;

            var Description =
view.FindViewById(Resource.Id.descriptionDialogCategoriesLigne) as TextView;

            var Nbimages =
view.FindViewById(Resource.Id.nbimgDialogCategoriesLigne) as TextView;

 

 

 
ImageItem.SetImageResource(Resource.Drawable.DefaultImageMenu);

 
Description.SetText(listetext[position].description);

 
Nbimages.SetText(listetext[position].description);

 


 


 
return view

 
}

 


The problem with it, i can't put a unique Id to my ImageItem, and in my
independant Thread, i can't change the pic.

 

If i just do in my independant thread a ImageItem.setImageDrawable, all pics
are loaded in the first listview item....

 

Somone have a idea ?


_______________________________________________
Monodroid mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">Monodroid at lists.ximian.com</A>

UNSUBSCRIBE INFORMATION:
<A HREF="http://lists.ximian.com/mailman/listinfo/monodroid">http://lists.ximian.com/mailman/listinfo/monodroid</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/monodroid/attachments/20120319/73400355/attachment.html">http://lists.ximian.com/pipermail/monodroid/attachments/20120319/73400355/attachment.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009346.html">[mono-android] Asynchronous display pics into listview
</A></li>
	<LI>Next message: <A HREF="009347.html">[mono-android] Calling System.Net.WebClient.DownloadData(string url) without INTERNET permission does'n cause any exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9349">[ date ]</a>
              <a href="thread.html#9349">[ thread ]</a>
              <a href="subject.html#9349">[ subject ]</a>
              <a href="author.html#9349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodroid">More information about the Monodroid
mailing list</a><br>
</body></html>
