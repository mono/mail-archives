<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] [MonoMac] NSMutableDictionary FromObjectsAndKeys	problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoMac%5D%20NSMutableDictionary%20FromObjectsAndKeys%0A%09problem&In-Reply-To=1289864824.8527.6207.camel%40erandi.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003323.html">
   <LINK REL="Next"  HREF="003329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] [MonoMac] NSMutableDictionary FromObjectsAndKeys	problem</H1>
    <B>kjpou</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoMac%5D%20NSMutableDictionary%20FromObjectsAndKeys%0A%09problem&In-Reply-To=1289864824.8527.6207.camel%40erandi.site"
       TITLE="[Mono-osx] [MonoMac] NSMutableDictionary FromObjectsAndKeys	problem">kjpou at pt.lu
       </A><BR>
    <I>Tue Nov 16 00:08:17 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="003323.html">[Mono-osx] [MonoMac] NSMutableDictionary FromObjectsAndKeys problem
</A></li>
        <LI>Next message: <A HREF="003329.html">[Mono-osx] [MonoMac] NSMutableDictionary FromObjectsAndKeys	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3327">[ date ]</a>
              <a href="thread.html#3327">[ thread ]</a>
              <a href="subject.html#3327">[ subject ]</a>
              <a href="author.html#3327">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Miguel

Yes was running with latest version as of Sunday.  Updated this morning 
and the problem still existed.

I started looking at it and there are two ways of approaching the 
problem that I found.

1) The easiest was the following:

Add the following to foundation.cs for interface NSMutableDictionary 
specifying [New]

         [Export (&quot;dictionaryWithObjects:forKeys:&quot;)]
         [Static,New]
         NSMutableDictionary FromObjectsAndKeys (NSObject [] objects, 
NSObject [] Keys);

*** Note ***    If [New] is not specified it will not work correctly 
because it uses the base NSDictionary method and the Dictionary returned 
is not Mutable.

Also commenting out the following code in NSMutableDictionary.cs

         public static NSMutableDictionary FromObjectsAndKeys (NSObject 
[] objects, NSObject [] keys)
         {
             if (objects.Length != keys.Length)
                 throw new ArgumentException (&quot;objects and keys arrays 
have different sizes&quot;);
             return FromObjectsAndKeys (objects, keys);
         }

2)  The second approach was keeping the ArgumentException check in 
NSMutableDictionary.cs and defining a new internal method in foundation.cs

NSMutableDictionary.cs

         public static NSMutableDictionary FromObjectsAndKeys (NSObject 
[] objects, NSObject [] keys)
         {
             if (objects.Length != keys.Length)
                 throw new ArgumentException (&quot;objects and keys arrays 
have different sizes&quot;);
             return FromObjectsAndKeysInternal (objects, keys);
         }

foundation.cs

         [Export (&quot;dictionaryWithObjects:forKeys:&quot;)]
         [Static,Internal]
         NSMutableDictionary FromObjectsAndKeysInternal (NSObject [] 
objects, NSObject [] Keys);


I chose the second approach to keep the ArgumentException check in with 
the least amount of changes.

Either one works.

I have attached the diff if you choose the second one.

Shouldn't NSDictionary include the same ArgumentException check as 
NSMutableDictionary if that is the way you decide?  Just for consistency 
if anything.

Kenneth



On 11/16/10 12:47 AM, Miguel de Icaza wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;&gt;<i> I am working with a mutable dictionary with bindings to an ArrayController
</I>&gt;&gt;<i> and am having problems creating a NSMutableDictionary using the
</I>&gt;&gt;<i> FromObjectsAndKeys.
</I>&gt;<i> Are you running the latest version from GitHub?
</I>&gt;<i>
</I>&gt;<i> On Friday or so, Geoff fixed an important bug with arrays in the Monomac
</I>&gt;<i> runtime.
</I>&gt;<i>
</I>&gt;&gt;<i> It works for a NSDictionary but not when creating a NSMutableDictionary.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The example code below shows what I am talking about.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	var objects = new NSObject[3] {new NSString(&quot;AAAAA&quot;),
</I>&gt;&gt;<i> 						new NSString(&quot;BBBBB&quot;),
</I>&gt;&gt;<i> 						new NSString(&quot;CCCCCC&quot;)};
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	var keys = new NSObject[3] {new NSString(&quot;firstkey&quot;),
</I>&gt;&gt;<i> 						new NSString(&quot;secondkey&quot;),
</I>&gt;&gt;<i> 						new NSString(&quot;thirdkey&quot;)};
</I>&gt;&gt;<i> 			
</I>&gt;&gt;<i> 	var dict2 = NSDictionary.FromObjectsAndKeys(objects,keys);
</I>&gt;&gt;<i> 			
</I>&gt;&gt;<i> 	//var dict = NSMutableDictionary.FromObjectsAndKeys(objects, keys);
</I>&gt;&gt;<i> 	var dict = NSMutableDictionary.FromDictionary(dict2);
</I>&gt;&gt;<i> 			
</I>&gt;&gt;<i> 	myContentArray.AddObject(dict);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The implementation between NSDictionary.cs and NSMutableDictionary.cs are
</I>&gt;&gt;<i> different for that method and not sure why.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any help would be appreciated
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Kenneth
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----------------------------------
</I>&gt;&gt;<i> If you uncomment the //var dict =
</I>&gt;&gt;<i> NSMutableDictionary.FromObjectsAndKeys(objects, keys); it gives the
</I>&gt;&gt;<i> following error:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Stacktrace:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    at (wrapper managed-to-native)
</I>&gt;&gt;<i> MonoMac.ObjCRuntime.Messaging.IntPtr_objc_msgSend_IntPtr_IntPtr_int
</I>&gt;&gt;<i> (intptr,intptr,intptr,intptr,int)&lt;0x00004&gt;
</I>&gt;&gt;<i>    at (wrapper managed-to-native)
</I>&gt;&gt;<i> MonoMac.ObjCRuntime.Messaging.IntPtr_objc_msgSend_IntPtr_IntPtr_int
</I>&gt;&gt;<i> (intptr,intptr,intptr,intptr,int)&lt;0x00004&gt;
</I>&gt;&gt;<i>    at MonoMac.Foundation.NSMutableDictionary.FromObjectsAndKeys
</I>&gt;&gt;<i> (MonoMac.Foundation.NSObject[],MonoMac.Foundation.NSObject[],int)&lt;0x00067&gt;
</I>&gt;&gt;<i>    at MonoMac.Foundation.NSMutableDictionary.FromObjectsAndKeys
</I>&gt;&gt;<i> (MonoMac.Foundation.NSObject[],MonoMac.Foundation.NSObject[])&lt;0x00028&gt;
</I>&gt;&gt;<i>    at NSTableViewBinding.TestWindowController.AwakeFromNib ()&lt;0x001f8&gt;
</I>&gt;&gt;<i>    at (wrapper native-to-managed) object.92f48794-05ff-4e21-bcf0-61c0dd4bf42b
</I>&gt;&gt;<i> (MonoMac.Foundation.NSObject,MonoMac.ObjCRuntime.Selector)&lt;0x000cc&gt;
</I>&gt;&gt;<i>    at (wrapper managed-to-native)
</I>&gt;&gt;<i> MonoMac.ObjCRuntime.Messaging.IntPtr_objc_msgSendSuper (intptr,intptr)
</I>&gt;&gt;<i> &lt;0x00004&gt;
</I>&gt;&gt;<i>    at (wrapper managed-to-native)
</I>&gt;&gt;<i> MonoMac.ObjCRuntime.Messaging.IntPtr_objc_msgSendSuper (intptr,intptr)
</I>&gt;&gt;<i> &lt;0x00004&gt;
</I>&gt;&gt;<i>    at MonoMac.AppKit.NSWindowController.get_Window ()&lt;0x00079&gt;
</I>&gt;&gt;<i>    at NSTableViewBinding.TestWindowController.get_Window ()&lt;0x00012&gt;
</I>&gt;&gt;<i>    at NSTableViewBinding.AppDelegate.FinishedLaunching
</I>&gt;&gt;<i> (MonoMac.Foundation.NSObject)&lt;0x00038&gt;
</I>&gt;&gt;<i>    at (wrapper native-to-managed) object.00860f4e-27a8-4ca0-aa64-ae2828705416
</I>&gt;&gt;<i> (MonoMac.Foundation.NSObject,MonoMac.ObjCRuntime.Selector,MonoMac.Foundation.NSObject)
</I>&gt;&gt;<i> &lt;0x00118&gt;
</I>&gt;&gt;<i>    at (wrapper managed-to-native)
</I>&gt;&gt;<i> MonoMac.AppKit.NSApplication.NSApplicationMain (int,string[])&lt;0x00004&gt;
</I>&gt;&gt;<i>    at (wrapper managed-to-native)
</I>&gt;&gt;<i> MonoMac.AppKit.NSApplication.NSApplicationMain (int,string[])&lt;0x00004&gt;
</I>&gt;&gt;<i>    at MonoMac.AppKit.NSApplication.Main (string[])&lt;0x00015&gt;
</I>&gt;&gt;<i>    at NSTableViewBinding.MainClass.Main (string[])&lt;0x00015&gt;
</I>&gt;&gt;<i>    at (wrapper runtime-invoke)&lt;Module&gt;.runtime_invoke_void_object
</I>&gt;&gt;<i> (object,intptr,intptr,intptr)&lt;0x00043&gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: nsmutabledictionary.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20101116/41f14f53/attachment.pl">http://lists.ximian.com/pipermail/mono-osx/attachments/20101116/41f14f53/attachment.pl</A> 
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003323.html">[Mono-osx] [MonoMac] NSMutableDictionary FromObjectsAndKeys problem
</A></li>
	<LI>Next message: <A HREF="003329.html">[Mono-osx] [MonoMac] NSMutableDictionary FromObjectsAndKeys	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3327">[ date ]</a>
              <a href="thread.html#3327">[ thread ]</a>
              <a href="subject.html#3327">[ subject ]</a>
              <a href="author.html#3327">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
