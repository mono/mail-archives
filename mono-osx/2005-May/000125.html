<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Fwd: Re: [Mono-osx] Mono and OSX 10.4 (Tiger)]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monoosx%40adhamh.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000123.html">
   <LINK REL="Next"  HREF="000126.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Fwd: Re: [Mono-osx] Mono and OSX 10.4 (Tiger)]
   </H1>
    <B>Adhamh Findlay
    </B> 
    <A HREF="mailto:monoosx%40adhamh.com"
       TITLE="[Fwd: Re: [Mono-osx] Mono and OSX 10.4 (Tiger)]">monoosx@adhamh.com
       </A><BR>
    <I>Tue, 03 May 2005 20:01:51 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="000123.html">[Mono-osx] Installer on Tiger?
</A></li>
        <LI> Next message: <A HREF="000126.html">[Mono-osx] Mono 1.1.7 TEST dmg available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#125">[ date ]</a>
              <a href="thread.html#125">[ thread ]</a>
              <a href="subject.html#125">[ subject ]</a>
              <a href="author.html#125">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.
--------------050500080802040200000903
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit



-------- Original Message --------
Subject: 	Re: [Mono-osx] Mono and OSX 10.4 (Tiger)
Date: 	Tue, 03 May 2005 17:52:01 -0700
To: 	Baker, GJ (Gareth) &lt;<A HREF="mailto:g.j.baker@dl.ac.uk">g.j.baker@dl.ac.uk</A>&gt;
CC: 	<A HREF="mailto:mono-osx@lists.ximian.com">mono-osx@lists.ximian.com</A>
References: 
&lt;<A HREF="mailto:77673C9ECE12AB4791B5AC0A7BF40C8F1A58C3@exchange02.fed.cclrc.ac.uk">77673C9ECE12AB4791B5AC0A7BF40C8F1A58C3@exchange02.fed.cclrc.ac.uk</A>&gt; 
&lt;<A HREF="mailto:4277A301.9090201@adhamh.com">4277A301.9090201@adhamh.com</A>&gt;



So...

The output of:

&quot;otool -L 
/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO&quot;

Shows that several graphics libraries are now shipping with Tiger.  The 
attached build script needs to be modified to link against those.  And 
we don't need to build these ourselves anymore.

Adhamh Findlay wrote:

&gt;<i> This is happening when trying to install the provide binary or when 
</I>&gt;<i> compiling?
</I>&gt;<i>
</I>&gt;<i> I getting this error when compiling, which is very similar to you 
</I>&gt;<i> error.  I swamped right now, but I am trying to find time to fix this.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> + '[' '!' -d /Users/Shared/MonoBuild/pkg ']'
</I>&gt;<i> + mkdir -p /Users/Shared/MonoBuild/pkg
</I>&gt;<i> + 
</I>&gt;<i> PACKAGEMAKER=/Developer/Applications/Utilities/PackageMaker.app/Contents/MacOS/PackageMaker 
</I>&gt;<i>
</I>&gt;<i> + ditto /Library/Frameworks/Mono.framework 
</I>&gt;<i> /Users/Shared/MonoBuild/PKGROOT/Library/Frameworks/Mono.framework
</I>&gt;<i> + 
</I>&gt;<i> /Developer/Applications/Utilities/PackageMaker.app/Contents/MacOS/PackageMaker 
</I>&gt;<i> -build -p /Users/Shared/MonoBuild/pkg/MonoFramework-1.1.6.pkg -f 
</I>&gt;<i> /Users/Shared/MonoBuild/PKGROOT -r /Users/Shared/MonoBuild/resources 
</I>&gt;<i> -i /Users/Shared/MonoBuild/plists/Info.plist -d 
</I>&gt;<i> /Users/Shared/MonoBuild/plists/Description.plist
</I>&gt;<i> dyld: Symbol not found: __cg_jpeg_resync_to_restart
</I>&gt;<i>  Referenced from: 
</I>&gt;<i> /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO 
</I>&gt;<i>
</I>&gt;<i>  Expected in: 
</I>&gt;<i> /Library/Frameworks/Mono.framework/Versions/1.1.6/lib/libJPEG.dylib
</I>&gt;<i>
</I>&gt;<i> ./newbuild.sh: line 589:  8688 Trace/BPT trap          ${PACKAGEMAKER} 
</I>&gt;<i> -build -p ${BUILDROOT}/pkg/MonoFramework-${MONOVERSION}.pkg -f 
</I>&gt;<i> ${BUILDROOT}/PKGROOT -r ${RESOURCES} -i ${PLISTS}/Info.plist -d 
</I>&gt;<i> ${PLISTS}/Description.plist
</I>&gt;<i> + 
</I>&gt;<i> /Developer/Applications/Utilities/PackageMaker.app/Contents/MacOS/PackageMaker 
</I>&gt;<i> -build -p /Users/Shared/MonoBuild/Packages/Framework-1.1.4.pkg -f 
</I>&gt;<i> /Users/Shared/MonoBuild/PKGROOT -r /Users/Shared/MonoBuild/resources 
</I>&gt;<i> -i /Users/Shared/MonoBuild/plists/Info.plist -d 
</I>&gt;<i> /Users/Shared/MonoBuild/resources/Description.plist
</I>&gt;<i> dyld: Symbol not found: __cg_jpeg_resync_to_restart
</I>&gt;<i>  Referenced from: 
</I>&gt;<i> /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO 
</I>&gt;<i>
</I>&gt;<i>  Expected in: 
</I>&gt;<i> /Library/Frameworks/Mono.framework/Versions/1.1.6/lib/libJPEG.dylib
</I>&gt;<i>
</I>&gt;<i> ./newbuild.sh: line 589:  8690 Trace/BPT trap          ${PACKAGEMAKER} 
</I>&gt;<i> -build -p 
</I>&gt;<i> ${BUILDROOT}/Packages/${FRAMEWORKNAME}Framework-${VERSION}.pkg -f 
</I>&gt;<i> ${BUILDROOT}/PKGROOT -r ${BUILDROOT}/resources -i 
</I>&gt;<i> ${BUILDROOT}/plists/Info.plist -d 
</I>&gt;<i> ${BUILDROOT}/resources/Description.plist
</I>&gt;<i> + /usr/bin/hdiutil create -ov -srcfolder 
</I>&gt;<i> /Users/Shared/MonoBuild/pkg/MonoFramework-1.1.6.pkg -volname 
</I>&gt;<i> MonoFramework-1.1.6 /Users/Shared/MonoBuild/pkg/MonoFramework-1.1.6.dmg
</I>&gt;<i> dyld: Symbol not found: __cg_jpeg_resync_to_restart
</I>&gt;<i>  Referenced from: 
</I>&gt;<i> /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO 
</I>&gt;<i>
</I>&gt;<i>  Expected in: 
</I>&gt;<i> /Library/Frameworks/Mono.framework/Versions/1.1.6/lib/libJPEG.dylib
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Baker, GJ (Gareth) wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I've been having problems with installing Tiger and I think I've 
</I>&gt;&gt;<i> narrowed the problem down to libJPEG in the OSX Mono distribution.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I upgraded to Tiger but had a problem in that the system would hang 
</I>&gt;&gt;<i> after the logon screen. I ended up having to do a &quot;archive and 
</I>&gt;&gt;<i> install&quot; to get my system back. I started putting back things and as 
</I>&gt;&gt;<i> soon as I re-installed Mono the problems returned (no applications 
</I>&gt;&gt;<i> would launch and the hang after the logon screen).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This morning I launched the console before trying to install Mono 
</I>&gt;&gt;<i> again. The installation goes without any problems but when I try to 
</I>&gt;&gt;<i> launch any application this appears in the console window (same error 
</I>&gt;&gt;<i> from two applications):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> dyld: Symbol not found: __cg_jpeg_resync_to_restart
</I>&gt;&gt;<i>  Referenced from: 
</I>&gt;&gt;<i> /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Expected in: 
</I>&gt;&gt;<i> /Library/Frameworks/Mono.framework/Versions/Current/lib/libJPEG.dylib
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> May  2 08:27:04 Gareth-Bakers-Computer crashdump[365]: BBEdit Lite 
</I>&gt;&gt;<i> 6.1 for OS X crashed
</I>&gt;&gt;<i> May  2 08:27:04 Gareth-Bakers-Computer crashdump[365]: crash report 
</I>&gt;&gt;<i> written to: /Users/garethba/Library/Logs/CrashReporter/BBEdit Lite 
</I>&gt;&gt;<i> 6.1 for OS X.crash.log
</I>&gt;&gt;<i> dyld: Symbol not found: __cg_jpeg_resync_to_restart
</I>&gt;&gt;<i>  Referenced from: 
</I>&gt;&gt;<i> /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Expected in: 
</I>&gt;&gt;<i> /Library/Frameworks/Mono.framework/Versions/Current/lib/libJPEG.dylib
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> May  2 08:29:14 Gareth-Bakers-Computer crashdump[370]: DEVONthink 
</I>&gt;&gt;<i> crashed
</I>&gt;&gt;<i> May  2 08:29:14 Gareth-Bakers-Computer crashdump[370]: crash report 
</I>&gt;&gt;<i> written to: 
</I>&gt;&gt;<i> /Users/garethba/Library/Logs/CrashReporter/DEVONthink.crash.log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I uninstall Mono there is no sign of any libJPEG libraries that 
</I>&gt;&gt;<i> I can see - so I wonder if there is a name clash here?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regards
</I>&gt;&gt;<i> Gareth Baker
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-osx mailing list
</I>&gt;<i> <A HREF="mailto:Mono-osx@lists.ximian.com">Mono-osx@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">http://lists.ximian.com/mailman/listinfo/mono-osx</A>
</I>




--------------050500080802040200000903
Content-Type: text/plain; x-mac-type=&quot;0&quot;; x-mac-creator=&quot;0&quot;;
 name=&quot;newbuild.sh&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename=&quot;newbuild.sh&quot;

#!/bin/sh -x

#startup options
CLEAN=NO
CONFIGURE=$1
MAKE=$2
INSTALL=$3
MONOBUILDFILES=$4

BUILDROOT=/Users/Shared/MonoBuild
PLISTS=${BUILDROOT}/plists
RESOURCES=${BUILDROOT}/resources
MONOVERSION=1.1.6
FRAMEWORKPREFIX=/Library/Frameworks/Mono.framework
MONOPREFIX=/Library/Frameworks/Mono.framework/Versions/${MONOVERSION}
DEPS=${BUILDROOT}/Dependancies

export CFLAGS=&quot;-I${MONOPREFIX}/include&quot; 
export C_INCLUDE_FLAGS=&quot;-I${MONOPREFIX}/include&quot;
export CPATH=&quot;${MONOPREFIX}/include&quot;
export DYLD_LIBRARY_PATH=&quot;${MONOPREFIX}/lib&quot;
export LDFLAGS=&quot;-L${MONOPREFIX}/lib&quot;
export PATH=&quot;/usr/X11R6/bin/:${MONOPREFIX}/bin:$PATH&quot;
export PKG_CONFIG_PATH=&quot;/usr/X11R6/lib/pkgconfig/:$PKG_CONFIG_PATH&quot;
export ACLOCAL_FLAGS=&quot;-I ${MONOPREFIX}/share/aclocal/&quot;

#		if [ ! -d ${MONOPREFIX}/lib ]; then
mkdir -p ${MONOPREFIX}/lib
mkdir -p ${MONOPREFIX}/man
mkdir -p ${MONOPREFIX}/bin
#        fi

if [ ! -d ${DEPS} ]; then
    mkdir -p ${DEPS}
fi


fetch()
{
	cd ${DEPS}
	if [ ! -e ${DEPS}/$1 ];then
		curl -L --max-redirs 5 -s -O $2
		gnutar -xzf $3
	fi
}

if [ ! -e ${DEPS} ]; then
	mkdir -p ${DEPS}
fi

build()
{
	cd $1
	if [ ${CLEAN} == &quot;YES&quot; ]; then
		make clean
	fi
	if [ ${CONFIGURE} == &quot;YES&quot; ]; then
		if [ $2 == &quot;mono&quot; ]; then
		
			###############################################
#Create gacutil config files specific to OS X
cat &lt;&lt;EOF &gt; mcs/class/lib/default/System.Drawing.dll.config
&lt;configuration&gt;
        &lt;dllmap dll=&quot;gdiplus.dll&quot; target=&quot;/Library/Frameworks/Mono.framework/Versions/${MONOVERSION}/lib/libgdiplus.dylib&quot; /&gt;
&lt;/configuration&gt;
EOF

cat &lt;&lt;EOF &gt; mcs/class/lib/default/System.Windows.Forms.dll.config
&lt;configuration&gt;
        &lt;dllmap dll=&quot;gdiplus&quot; target=&quot;/Library/Frameworks/Mono.framework/Versions/${MONOVERSION}/lib/libgdiplus.dylib&quot; /&gt;
        &lt;dllmap dll=&quot;libX11&quot; target=&quot;/usr/X11R6/lib/libX11.dylib&quot; /&gt;
&lt;/configuration&gt;
EOF

			 ./configure --prefix=$MONOPREFIX --with-preview=yes 
		else
			./configure --prefix=$MONOPREFIX 
		fi
	fi
	if [ ${MAKE} == &quot;YES&quot; ]; then
		make 
	fi
	if [ ${INSTALL} == &quot;YES&quot; ]; then
		make install
	fi
}

#Function builds are the various packages included in the
#Mono.framework.
packages() 
{

# 
# #pkgconfig
# #################################################
# NAME=pkgconfig
# VERSION=0.15.0
# DISTNAME=${NAME}-${VERSION}.tar.gz
# URL=<A HREF="http://www.freedesktop.org/software/pkgconfig/releases/${DISTNAME}">http://www.freedesktop.org/software/pkgconfig/releases/${DISTNAME}</A>
# WORKSRCDIR=${NAME}-${VERSION}
# 
# echo &quot;Building ${NAME}&quot;
# fetch ${WORKSRCDIR} ${URL} ${DISTNAME}
# build ${WORKSRCDIR} ${NAME}
# echo &quot;Done with ${NAME}&quot;
# #################################################
# 
# #gettext
# #################################################
# NAME=gettext
# VERSION=0.14.1
# DISTNAME=${NAME}-${VERSION}.tar.gz
# URL=<A HREF="http://ftp.gnu.org/pub/gnu/gettext/${DISTNAME}">http://ftp.gnu.org/pub/gnu/gettext/${DISTNAME}</A>
# WORKSRCDIR=${NAME}-${VERSION}
# 
# echo &quot;Building ${NAME}&quot;
# fetch ${WORKSRCDIR} ${URL} ${DISTNAME}
# build ${WORKSRCDIR} ${NAME}
# echo &quot;Done with ${NAME}&quot;
# #################################################
# 
# #glib
# #################################################
# NAME=glib
# VERSION=2.6.3
# DISTNAME=${NAME}-${VERSION}.tar.gz
# URL=<A HREF="ftp://ftp.gtk.org/pub/gtk/v2.6/${DISTNAME}">ftp://ftp.gtk.org/pub/gtk/v2.6/${DISTNAME}</A>
# WORKSRCDIR=${NAME}-${VERSION}
# 
# echo &quot;Building ${NAME}&quot;
# fetch ${WORKSRCDIR} ${URL} ${DISTNAME}
# build ${WORKSRCDIR} ${NAME}
# echo &quot;Done with ${NAME}&quot;
# #################################################
# 
# #mono
# #################################################
# NAME=mono
# VERSION=${MONOVERSION}
# DISTNAME=${NAME}-${MONOVERSION}.tar.gz
# URL=<A HREF="http://www.go-mono.com/archive/${MONOVERSION}/${DISTNAME}">http://www.go-mono.com/archive/${MONOVERSION}/${DISTNAME}</A>
# WORKSRCDIR=${NAME}-${VERSION}
# 
# echo &quot;Building ${NAME}&quot;
# fetch ${WORKSRCDIR} ${URL} ${DISTNAME}
# build ${WORKSRCDIR} ${NAME}
# echo &quot;Done with ${NAME}&quot;
# 
# #################################################
# 

#JPEG
#################################################
PATCHDIR=${MONOBUILDFILES}/libgdiplus/jpeg/files
NAME=jpeg
VERSION=6b 
DISTNAME=${NAME}src.v${VERSION}.tar.gz
URL=<A HREF="ftp://ftp.uu.net/graphics/jpeg/${DISTNAME}">ftp://ftp.uu.net/graphics/jpeg/${DISTNAME}</A>
WORKSRCDIR=${NAME}-${VERSION}

fetch ${WORKSRCDIR} ${URL} ${DISTNAME}

cd ${WORKSRCDIR}
if [ ${CLEAN} == &quot;YES&quot; ]; then
	make clean
fi
if [ ${CONFIGURE} == &quot;YES&quot; ]; then
    patch config.guess ${PATCHDIR}/patch-config.guess
    patch config.sub ${PATCHDIR}/patch-config.sub
    patch ltmain.sh ${PATCHDIR}/patch-ltmain.sh
    patch ltconfig ${PATCHDIR}/patch-ltconfig

    sed -e 's/(prefix)\/man/(prefix)\/share\/man/g' makefile.cfg &gt; makefile.cfg.patched
    mv makefile.cfg.patched makefile.cfg

    ./configure --enable-shared --enable-static --prefix=${MONOPREFIX}  
fi
if [ ${MAKE} == &quot;YES&quot; ]; then
	make 
fi
if [ ${INSTALL} == &quot;YES&quot; ]; then
	make install
fi

################################
NAME=tiff
VERSION=3.7.1
DISTNAME=${NAME}-${VERSION}.tar.gz
URL=<A HREF="ftp://ftp.freebsd.org/pub/FreeBSD/ports/distfiles/${DISTNAME}">ftp://ftp.freebsd.org/pub/FreeBSD/ports/distfiles/${DISTNAME}</A>
WORKSRCDIR=${NAME}-${VERSION}

fetch ${WORKSRCDIR} ${URL} ${DISTNAME}
cd ${WORKSRCDIR}

if [ ${CLEAN} == &quot;YES&quot; ]; then
	make clean
fi
if [ ${CONFIGURE} == &quot;YES&quot; ]; then
    ./configure --prefix=${MONOPREFIX} --mandir=${MONOPREFIX}/share/man \
	--with-jpeg-include-dir=${MONOPREFIX}/include \
	--with-jpeg-lib-dir=${MONOPREFIX}/lib  
fi
if [ ${MAKE} == &quot;YES&quot; ]; then
	make 
fi
if [ ${INSTALL} == &quot;YES&quot; ]; then
	make install
fi

###############################################
NAME=libpng
VERSION=1.2.8
DISTNAME=${NAME}-${VERSION}-config.tar.gz

URL=<A HREF="http://easynews.dl.sourceforge.net/sourceforge/libpng/${DISTNAME}">http://easynews.dl.sourceforge.net/sourceforge/libpng/${DISTNAME}</A>
WORKSRCDIR=${NAME}-${VERSION}-config

echo &quot;Building ${NAME}&quot;
fetch ${WORKSRCDIR} ${URL} ${DISTNAME}
build ${WORKSRCDIR} ${NAME}
echo &quot;Done with ${NAME}&quot;

###############################################
NAME=libungif
VERSION=4.1.3
DISTNAME=${NAME}-${VERSION}.tar.gz
URL=<A HREF="http://easynews.dl.sourceforge.net/sourceforge/libungif/libungif-4.1.3.tar.gz">http://easynews.dl.sourceforge.net/sourceforge/libungif/libungif-4.1.3.tar.gz</A>
WORKSRCDIR=${NAME}-${VERSION}

echo &quot;Building ${NAME}&quot;
fetch ${WORKSRCDIR} ${URL} ${DISTNAME}
build ${WORKSRCDIR} ${NAME}
echo &quot;Done with ${NAME}&quot;

###############################################
NAME=libgdiplus
VERSION=1.1.5
DISTNAME=${NAME}-${VERSION}.tar.gz
URL=<A HREF="http://www.go-mono.com/archive/${VERSION}/${DISTNAME}">http://www.go-mono.com/archive/${VERSION}/${DISTNAME}</A>
WORKSRCDIR=${NAME}-${VERSION}

echo &quot;Building ${NAME}&quot;
fetch ${WORKSRCDIR} ${URL} ${DISTNAME}

cd ${WORKSRCDIR}
if [ ${CLEAN} == &quot;YES&quot; ]; then
	make clean
fi
if [ ${CONFIGURE} == &quot;YES&quot; ]; then
	./configure --prefix=${MONOPREFIX} --with-libjpeg --includedir=${MONOPREFIX}/include  
fi
if [ ${MAKE} == &quot;YES&quot; ]; then
	make 
fi
if [ ${INSTALL} == &quot;YES&quot; ]; then
	make install
fi

#cocoa#
#################################################
#PATCHDIR=${MONOBUILDFILES}/libgdiplus/jpeg/files
#<A HREF="http://www.go-mono.com/archive/1.1.4/cocoa-sharp-0.2.tgz">http://www.go-mono.com/archive/1.1.4/cocoa-sharp-0.2.tgz</A>
NAME=cocoa-sharp
VERSION=1.1.4 #Original Mono version, not cocoa# version
DISTNAME=${NAME}-0.2.tgz
URL=<A HREF="http://www.go-mono.com/archive/${VERSION}/${DISTNAME}">http://www.go-mono.com/archive/${VERSION}/${DISTNAME}</A>
WORKSRCDIR=${NAME}-${VERSION}

echo &quot;Building ${NAME}&quot;
fetch ${WORKSRCDIR} ${URL} ${DISTNAME}

cd ${NAME}
if [ ${CLEAN} == &quot;YES&quot; ]; then
	make clean
fi
if [ ${CONFIGURE} == &quot;YES&quot; ]; then
	./autogen.sh --prefix=${MONOPREFIX} --with-preview=yes
fi
if [ ${MAKE} == &quot;YES&quot; ]; then
	make 
fi
if [ ${INSTALL} == &quot;YES&quot; ]; then
	make install
fi

echo &quot;Done with ${NAME}&quot;

#################################################

}


framework()
{
###############################################
#Create the framework links, so that this is an OS X framework
if [ ${INSTALL} == &quot;YES&quot; ]; then
cd ${FRAMEWORKPREFIX}/Versions
if [ -e &quot;${FRAMEWORKPREFIX}/Versions/Current&quot; ]; then
	rm -r Current
fi

ln -sf ${MONOVERSION} Current
echo &quot;Creating framework links&quot;

cd ${FRAMEWORKPREFIX}

#ln -sf Versions/Current/Resources Resources
ln -sf Versions/Current/lib Libraries
ln -sf Versions/Current/include Headers
ln -sf Versions/Current/bin Commands


if [ -e Versions/Current/lib/libmono.dylib ];then
	ln -sf Libraries/libmono.dylib Mono
else
	echo &quot;/Library/Frameworks/Mono.framework/Libraries/libmono.dylib does not exist&quot;
fi


for i in \
  `ls -al ${MONOPREFIX}/bin | grep -v total | grep -v .exe | grep -vw &quot;\.&quot; |awk '{print $9}'`; do
  echo ${i}
  ln -sf ${MONOPREFIX}/bin/${i} /usr/bin/${i}
done
fi
}
###############################################
#create plist files that are needed by the Installer.

plists() 
{
if [ ! -d ${PLISTS} ]; then
	mkdir -p ${PLISTS}
fi

if [ ! -d ${RESOURCES} ]; then
    mkdir -p ${RESOURCES}
fi


cat &lt;&lt;EOF &gt; ${PLISTS}/Info.plist
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;<A HREF="http://www.apple.com/DTDs/PropertyList-1.0.dtd"">http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</A>&gt;
&lt;plist version=&quot;1.0&quot;&gt;
		&lt;dict&gt;
		&lt;key&gt;CFBundleGetInfoString&lt;/key&gt;
		&lt;string&gt;${MONOVERSION}&lt;/string&gt;
		&lt;key&gt;CFBundleIdentifier&lt;/key&gt;
		&lt;string&gt;com.ximian.mono&lt;/string&gt;
		&lt;key&gt;CFBundleName&lt;/key&gt;
		&lt;string&gt;Mono.framework&lt;/string&gt;
		&lt;key&gt;CFBundleShortVersionString&lt;/key&gt;
		&lt;string&gt;${MONOVERSION}&lt;/string&gt;
		&lt;key&gt;IFMajorVersion&lt;/key&gt;
		&lt;integer&gt;0&lt;/integer&gt;
		&lt;key&gt;IFMinorVersion&lt;/key&gt;
		&lt;integer&gt;0&lt;/integer&gt;
		&lt;key&gt;IFPkgFlagAllowBackRev&lt;/key&gt;
		&lt;false/&gt;
		&lt;key&gt;IFPkgFlagAuthorizationAction&lt;/key&gt;
		&lt;string&gt;AdminAuthorization&lt;/string&gt;
		&lt;key&gt;IFPkgFlagDefaultLocation&lt;/key&gt;
		&lt;string&gt;/&lt;/string&gt;
		&lt;key&gt;IFPkgFlagInstallFat&lt;/key&gt;
		&lt;false/&gt;
		&lt;key&gt;IFPkgFlagIsRequired&lt;/key&gt;
		&lt;false/&gt;
		&lt;key&gt;IFPkgFlagRelocatable&lt;/key&gt;
		&lt;false/&gt;
		&lt;key&gt;IFPkgFlagRestartAction&lt;/key&gt;
		&lt;string&gt;NoRestart&lt;/string&gt;
		&lt;key&gt;IFPkgFlagRootVolumeOnly&lt;/key&gt;
		&lt;true/&gt;
		&lt;key&gt;IFPkgFlagUpdateInstalledLanguages&lt;/key&gt;
		&lt;false/&gt;
		&lt;key&gt;IFPkgFormatVersion&lt;/key&gt;
		&lt;real&gt;0.10000000149011612&lt;/real&gt;
		&lt;/dict&gt;
&lt;/plist&gt;
EOF

cat &lt;&lt;EOF &gt; ${PLISTS}/version.plist
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;<A HREF="http://www.apple.com/DTDs/PropertyList-1.0.dtd"">http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</A>&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
	&lt;key&gt;BuildVersion&lt;/key&gt;
	&lt;string&gt;${MONOVERSION}&lt;/string&gt;
	&lt;key&gt;CFBundleShortVersionString&lt;/key&gt;
	&lt;string&gt;${MONOVERSION}&lt;/string&gt;
	&lt;key&gt;CFBundleVersion&lt;/key&gt;
	&lt;string&gt;${MONOVERSION}&lt;/string&gt;
	&lt;key&gt;ProjectName&lt;/key&gt;
	&lt;string&gt;Mono&lt;/string&gt;
	&lt;key&gt;SourceVersion&lt;/key&gt;
	&lt;string&gt;${MONOVERSION}&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF

cat &lt;&lt;EOF &gt; ${PLISTS}/Description.plist 
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;<A HREF="http://www.apple.com/DTDs/PropertyList-1.0.dtd"">http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</A>&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
		&lt;key&gt;IFPkgDescriptionDescription&lt;/key&gt;
		&lt;string&gt;Mono Framework ${MONOVERSION}&lt;/string&gt;
		&lt;key&gt;IFPkgDescriptionTitle&lt;/key&gt;
		&lt;string&gt;Mono Framework&lt;/string&gt;
		&lt;key&gt;IFPkgDescriptionVersion&lt;/key&gt;
		&lt;string&gt;${MONOVERSION}&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF

if [ ! -d ${FRAMEWORKPREFIX}/Versions/Current/Resoures ]; then
	mkdir -p ${FRAMEWORKPREFIX}/Versions/Current/Resources
fi

cp ${PLISTS}/*.plist ${FRAMEWORKPREFIX}/Versions/Current/Resources
cd ${FRAMEWORKPREFIX}
ln -sf ${FRAMEWORKPREFIX}/Versions/Current/Resources Resources
}

#####################################################
#Create the RTF files needed by the installer
#Should now be completly dynamic so versions will be correct
rtfs()
{
if [ ! -d ${RESOURCES} ]; then
    mkdir -p ${RESOURCES}
fi

cp ${PLISTS}/version.plist ${RESOURCES}/

cat &lt;&lt;EOF &gt; ${RESOURCES}/License.rtf
{\rtf1\mac\ansicpg10000\cocoartf102
{\fonttbl\f0\fswiss\fcharset77 Helvetica;}
{\colortbl;\red255\green255\blue255;}
\margl1440\margr1440\vieww9000\viewh9000\viewkind0
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f0\fs24 \cf0 The software included in the package is licensed under several different agreements.\\
\\
MIT License:\\
\\
<A HREF="http://www.opensource.org/licenses/mit-license.php\\">http://www.opensource.org/licenses/mit-license.php\\</A>
\\
LGPL:\\
\\
<A HREF="http://www.opensource.org/licenses/lgpl-license.php\\">http://www.opensource.org/licenses/lgpl-license.php\\</A>
\\
GPL:\\
\\
<A HREF="http://www.opensource.org/licenses/gpl-license.php}\\">http://www.opensource.org/licenses/gpl-license.php}\\</A>
}
EOF

cat &lt;&lt;EOF &gt; ${RESOURCES}/ReadMe.rtf
{\rtf1\mac\ansicpg10000\cocoartf102
{\fonttbl\f0\fswiss\fcharset77 Helvetica;\f1\fswiss\fcharset77 Helvetica-Bold;}
{\colortbl;\red255\green255\blue255;}
\margl1440\margr1440\vieww15940\viewh15760\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\ql\qnatural

\f0\fs24 \cf0 This README is for
\f1\b  Mono.framework ${MONOVERSION}
\f0\b0 .\\
\\
This is a repackaging of Mono environment from <A HREF="http://www.mono-project.com/about/index.html.">http://www.mono-project.com/about/index.html.</A>  The idea of this repackaging is to provide a native Mac OS X framework for doing Mono development.\\
\\
This package installs Mono and all of its dependencies inside of /Library/Frameworks/Mono.framework.  This behavior is likely to change with a future release so that depencancies will get their own frameworks.\\
\\
What gets installed inside Mono.framework?\\
\\
        pkgconfig-0.15.0\\
        gettext-0.14.1\\
        glib-2.6.3\\
        mono-${MONOVERSION}\\
        cocoa#-0.2\\
\\
Included in this version of the Mono.framework is Cocoa#.  Cocoa# is an API bridge that allows Mono developers to call Cocoa APIs while using Mono and C#.  A Cocoa# wiki is available at <A HREF="http://www.lormyr.com/cocoaSharp.\\">http://www.lormyr.com/cocoaSharp.\\</A>
\\
This uninstallMono.sh script is in the Resources directory of MonoFramework.pkg.\\
\\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural
\cf0 If you'd like to access the mono manpages you'll have to add /Library/Framework/Mono/Versions/Current/man to your manpath\\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\ql\qnatural
\cf0 \\
During the postinstall phase of the installation, links to /usr/bin are created for binaries installed into the Commands directory.  This is done to prevent requiring modifications to the \$PATH environmental variable.  Yes, we know that this is not typical for *NIX, but this is Mac OS X. \\
\\
A simple uninstallMono.sh script is included in the disk image.  This is shell script that must be run as root, and it will remove the Mono.framework and the links in /usr/bin.\\
\\
This package was created by the Cocoa# team.  Major contributors to this team include (in alphabetical order): \\
\\
Adhamh Findlay\\
Urs Muff\\
Geoff Norton\\
Andy Satori\\
\\
Questions or problems related directly to the Mono.framework should be addressed to <A HREF="mailto:mono-osx@lists.ximian.com.">mono-osx@lists.ximian.com.</A>\\
\\
Questions about Mono should be directed to an appropriate resource that can be found on <A HREF="http://www.mono-project.com/about.">http://www.mono-project.com/about.</A> \\
}
EOF

cat &lt;&lt;EOF &gt; ${RESOURCES}/Welcome.rtf
{\rtf1\mac\ansicpg10000\cocoartf102
{\fonttbl\f0\fnil\fcharset77 HelveticaNeue;\f1\fnil\fcharset77 HelveticaNeue-Bold;}
{\colortbl;\red255\green255\blue255;}
\margl1440\margr1440\vieww9000\viewh9000\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\ql\qnatural

\f0\fs36 \cf0 Welcome to 
\f1\b Mono.framework ${MONOVERSION}
\f0\b0  for OS X.\\
\\
\fs24 This version of Mono includes Cocoa#.  Please see the ReadMe for more details.\\
}
EOF


################################################
#Create the uninstall script
cat &lt;&lt;EOF &gt; ${RESOURCES}/uninstallMono.sh
#!/bin/sh -x

#This script removes Mono from an OS X System.  It must be run as root

rm -r /Library/Frameworks/Mono.framework

rm -r /Library/Receipts/MonoFramework-${MONOVERSION}.pkg

cd /usr/bin
for i in \`ls -al | grep Mono | awk '{print \$9}'\`; do
    rm \${i}
done
EOF
chmod 755 ${RESOURCES}/uninstallMono.sh
################################################

################################################
#Create the postflight script that will create links
#once the installer is done.

cat &lt;&lt;EOF &gt; ${RESOURCES}/postflight
#!/bin/sh -x
if [ -d /Library/Frameworks/Mono.framework/Commands ]; then
cd /Library/Frameworks/Mono.framework/Commands
for i in \`ls -al | grep -v .exe | awk '{print \$9}'\`; do 
    echo &quot;\${i}&quot;
    ln -sf \$PWD/\${i} /usr/bin/\${i}
done;
else 
    echo &quot;/Library/Frameworks/Mono.framework/Commands does not exist&quot;
    echo &quot;Can not create links to /usr/bin.&quot;
fi
EOF
chmod 755 ${RESOURCES}/postflight
}

################################################
#Create the pkg and dmg that will get posted.
dmg() {
if [ ! -d ${BUILDROOT}/PKGROOT ]; then
    mkdir -p ${BUILDROOT}/PKGROOT
fi

if [ ! -d ${BUILDROOT}/pkg ]; then
    mkdir -p ${BUILDROOT}/pkg
fi

PACKAGEMAKER=/Developer/Applications/Utilities/PackageMaker.app/Contents/MacOS/PackageMaker
ditto /Library/Frameworks/Mono.framework /Users/Shared/MonoBuild/PKGROOT/Library/Frameworks/Mono.framework

${PACKAGEMAKER} -build -p ${BUILDROOT}/pkg/MonoFramework-${MONOVERSION}.pkg -f ${BUILDROOT}/PKGROOT -r ${RESOURCES} -i ${PLISTS}/Info.plist -d ${PLISTS}/Description.plist 
${PACKAGEMAKER} -build -p ${BUILDROOT}/Packages/${FRAMEWORKNAME}Framework-${VERSION}.pkg -f ${BUILDROOT}/PKGROOT -r ${BUILDROOT}/resources -i ${BUILDROOT}/plists/Info.plist -d ${BUILDROOT}/resources/Description.plist

/usr/bin/hdiutil create -ov -srcfolder ${BUILDROOT}/pkg/MonoFramework-${MONOVERSION}.pkg -volname MonoFramework-${MONOVERSION} ${BUILDROOT}/pkg/MonoFramework-${MONOVERSION}.dmg
}

################################################
#Actualy calls the script funcations
packages
plists
rtfs
framework
dmg

--------------050500080802040200000903--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000123.html">[Mono-osx] Installer on Tiger?
</A></li>
	<LI> Next message: <A HREF="000126.html">[Mono-osx] Mono 1.1.7 TEST dmg available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#125">[ date ]</a>
              <a href="thread.html#125">[ thread ]</a>
              <a href="subject.html#125">[ subject ]</a>
              <a href="author.html#125">[ author ]</a>
         </LI>
       </UL>
</body></html>
