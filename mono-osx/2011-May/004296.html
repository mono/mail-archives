<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] NullReferenceExceptions due to	MonoMac.ObjCRuntime.GetNSObject()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20NullReferenceExceptions%20due%20to%0A%09MonoMac.ObjCRuntime.GetNSObject%28%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004554.html">
   <LINK REL="Next"  HREF="004297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] NullReferenceExceptions due to	MonoMac.ObjCRuntime.GetNSObject()</H1>
    <B>Dan Fry</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20NullReferenceExceptions%20due%20to%0A%09MonoMac.ObjCRuntime.GetNSObject%28%29&In-Reply-To="
       TITLE="[Mono-osx] NullReferenceExceptions due to	MonoMac.ObjCRuntime.GetNSObject()">dan at sonocent.com
       </A><BR>
    <I>Tue May  3 11:09:37 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004554.html">[Mono-osx] How to go from CFStringRef * to C# String
</A></li>
        <LI>Next message: <A HREF="004297.html">[Mono-osx] [ANN] Monobjc 3.0.1405.0 Release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4296">[ date ]</a>
              <a href="thread.html#4296">[ thread ]</a>
              <a href="subject.html#4296">[ subject ]</a>
              <a href="author.html#4296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm currently using MonoMac to port a Windows application to Mac OS X. 
Recently I've started building MonoMac myself from the sources on 
github, and had started to get NullReferenceExceptions at seemingly 
random times.

The cause was apparently 
MonoMac.ObjCRuntime.Runtime.GetNSObject(IntPtr), which was changed a 
while ago to return null if the WeakReference to the managed NSObject 
held in the object_map has been garbage collected - see this commit:

<A HREF="https://github.com/mono/monomac/commit/2482fd3eef1ac5825146456a5b9c99ec7609fee6">https://github.com/mono/monomac/commit/2482fd3eef1ac5825146456a5b9c99ec7609fee6</A>

The commit message says that it is OK to return null because the callers 
check for it, but as far as I can tell this does not seem to be the 
case. NSArray.ArrayFromHandle(IntPtr) is one example, but 
GetNSObject(IntPtr) is public so I presume any application code could 
call it and expect not to get null back.

I managed to fix the problem in my application by changing 
monomac/src/ObjCRuntime/Runtime.cs as shown in the attached diff.

I searched the bug database and the web and couldn't find any reference 
to this problem, which surprised me and made me wonder if I'm doing 
something wrong - I'm a complete newbie when it comes to git(hub)!

I'm not sure of the correct procedure for dealing with problems like 
this - should I submit a bug report? (I'm not sure whether that's only 
for official releases)

Thanks for your patience, any help would be greatly appreciated!

Dan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20110503/175c3a69/attachment.html">http://lists.ximian.com/pipermail/mono-osx/attachments/20110503/175c3a69/attachment.html</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Runtime.cs.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20110503/175c3a69/attachment.txt">http://lists.ximian.com/pipermail/mono-osx/attachments/20110503/175c3a69/attachment.txt</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004554.html">[Mono-osx] How to go from CFStringRef * to C# String
</A></li>
	<LI>Next message: <A HREF="004297.html">[Mono-osx] [ANN] Monobjc 3.0.1405.0 Release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4296">[ date ]</a>
              <a href="thread.html#4296">[ thread ]</a>
              <a href="subject.html#4296">[ subject ]</a>
              <a href="author.html#4296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
