<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] IOKit Enumeration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20IOKit%20Enumeration&In-Reply-To=E88A6FB0-BE07-4A34-B96D-F4B3AB99EA16%40novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001313.html">
   <LINK REL="Next"  HREF="001328.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] IOKit Enumeration</H1>
    <B>Joshua Perry</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20IOKit%20Enumeration&In-Reply-To=E88A6FB0-BE07-4A34-B96D-F4B3AB99EA16%40novell.com"
       TITLE="[Mono-osx] IOKit Enumeration">josh at 6bit.com
       </A><BR>
    <I>Tue Apr 15 10:49:05 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001313.html">[Mono-osx] IOKit Enumeration
</A></li>
        <LI>Next message: <A HREF="001328.html">[Mono-osx] IOKit Enumeration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1315">[ date ]</a>
              <a href="thread.html#1315">[ thread ]</a>
              <a href="subject.html#1315">[ subject ]</a>
              <a href="author.html#1315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Thanks for the input Geoff,

I wish I would have asked before I wrote the P/Invoke code, calling  
into CoreFoundation/IOKit is sure easier from C than P/Invoking it in  
C#!

This is my first contrib to mono so I'm trying to learn how things are  
done.  I need to shift my mindset from Usermode to Kernelmode if you  
will; since the code is going to be built as part of the framework it  
makes sense to use unmanaged code when appropriate.

The current SerialPort chooses between two ISerialStream  
implementations SerialPortStream and WinSerialStream.   
SerialPortStream is implemented by P/Invoking into MonoPosixHelper  
functions like serial_read and serial_write.  WinSerialStream is  
implemented by P/Invoking the Win32 API serial port and IO functions.   
Outside of enumerating IOKit objects to find the port /dev/ nodes, I  
believe that OSX is compatible with standard posix callsl though I'm  
not happy with the current Posix stream as Async operations are not  
implemented.  I would like to implement the async functionality and,  
from the look of things, moving the serial specific functions into io- 
layer would be the right thing to do.

In XplatUI.cs are you talking about the call to uname to check for  
&quot;Darwin&quot;?


We currently have 1 product for sale, an IO board with six 10Amp relay  
outputs and 12 ground-triggered inputs.  We are working on a few other  
products right now that we hope to release in the next couple of  
months.  These products will be 802.15.4 (ZigBee) wireless devices  
connected to a computer via a wireless gateway which will have an FTDI  
Serial to USB chip.  We are looking to provide low-cost Proximity card  
access hardware so that people can put them in their homes and small  
businesses; the wireless capabilities will let you retrofit doors  
without running any wires.

Josh

On Apr 14, 2008, at 9:21 PM, Geoff Norton wrote:

&gt;<i> Josh,
</I>&gt;<i>
</I>&gt;<i> On 14-Apr-08, at 8:20 PM, Joshua Perry wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hey guys,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I haven't had much time to work on this the last few months, but this
</I>&gt;&gt;<i> weekend I was finally able to enumerate RS232 ports using P/Invoke to
</I>&gt;&gt;<i> IOKit/CoreFoundation.  This would work for enumerating any items in  
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> IOKit database but I want to add support for
</I>&gt;&gt;<i> System.IO.Ports.SerialPort.GetPortNames() to Mono for OSX.  This  
</I>&gt;&gt;<i> works
</I>&gt;&gt;<i> quite well with any FTDI type chips that provide a virtual com-port  
</I>&gt;&gt;<i> for
</I>&gt;&gt;<i> communication, which is a common method of USB enabling devices.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Great.
</I>&gt;<i>
</I>&gt;&gt;<i> I do a lot of embedded development and talking to our hardware is
</I>&gt;&gt;<i> important, and in future products we would like to ship software  
</I>&gt;&gt;<i> for OSX
</I>&gt;&gt;<i> on Mono.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What do you guys make (for my personal curiousity) ?
</I>&gt;<i>
</I>&gt;&gt;<i> So before I start integrating this code into my local checkout, I  
</I>&gt;&gt;<i> wanted
</I>&gt;&gt;<i> to ask what the best method is for adding this to the Mono  
</I>&gt;&gt;<i> codebase.  Is
</I>&gt;&gt;<i> there a define for managed code on OSX builds?  I've noticed that a  
</I>&gt;&gt;<i> lot
</I>&gt;&gt;<i> of places a runtime check is used against  
</I>&gt;&gt;<i> Environment.OSVersion.Platform
</I>&gt;&gt;<i> to decide which logic to execute, is this the preferred method in
</I>&gt;&gt;<i> managed code as opposed to conditional compilation?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> There is a check you can lift in XplatUI.cs from  
</I>&gt;<i> Managed.Windows.Forms.
</I>&gt;<i>
</I>&gt;&gt;<i> Also, I have made some base classes that I use to manage reference
</I>&gt;&gt;<i> counting and to make the P/Invoke to CoreFoundation objects and IOKit
</I>&gt;&gt;<i> objects easier (e.g. CFString, CFMutableDictionary, IOObject).  Is  
</I>&gt;&gt;<i> there
</I>&gt;&gt;<i> an OSX helper library similar to PosixHelper that this code would  
</I>&gt;&gt;<i> go in?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Generally we'd push stuff like that down into unmanaged code, I'm  
</I>&gt;<i> pretty sure the existing serial implementation has some unmanaged  
</I>&gt;<i> code so cleaning up the interface to be generic icalls and then  
</I>&gt;<i> implementing platform specific stuff in io-layer is (probably)  
</I>&gt;<i> better.  Note I havn't looked at the code yet, so this may not hold  
</I>&gt;<i> true.
</I>&gt;<i>
</I>&gt;<i> -g
</I>&gt;<i>
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001313.html">[Mono-osx] IOKit Enumeration
</A></li>
	<LI>Next message: <A HREF="001328.html">[Mono-osx] IOKit Enumeration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1315">[ date ]</a>
              <a href="thread.html#1315">[ thread ]</a>
              <a href="subject.html#1315">[ subject ]</a>
              <a href="author.html#1315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
