<tt>
Mono&amp;#39;s&nbsp;RWLock&nbsp;uses&nbsp;CLR&nbsp;monitors,&nbsp;so&nbsp;it&amp;#39;s&nbsp;not&nbsp;trivial&nbsp;to&nbsp;improve&nbsp;over&nbsp;it.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;24,&nbsp;2009&nbsp;at&nbsp;1:19&nbsp;PM,&nbsp;LKeene&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:lionel.keene@gmail.com&quot;&gt;lionel.keene@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;br&gt;<br>
Hello&nbsp;fellow&nbsp;Mono+Mac&nbsp;coders.&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;ve&nbsp;had&nbsp;a&nbsp;couple&nbsp;of&nbsp;posts&nbsp;in&nbsp;the&nbsp;MacOS&nbsp;section&nbsp;of&nbsp;the&nbsp;Mono&nbsp;forum&nbsp;inquiring&lt;br&gt;<br>
about&nbsp;any&nbsp;known&nbsp;bottlenecks&nbsp;in&nbsp;Mono&nbsp;on&nbsp;OSX.&nbsp;This&nbsp;was&nbsp;due&nbsp;to&nbsp;some&nbsp;strange&lt;br&gt;<br>
behavior&nbsp;my&nbsp;WinForms&nbsp;app&nbsp;was&nbsp;delivering&nbsp;when&nbsp;running&nbsp;on&nbsp;Mac,&nbsp;whereas&nbsp;on&lt;br&gt;<br>
Windows&nbsp;and&nbsp;Linux&nbsp;all&nbsp;was&nbsp;well.&nbsp;I&amp;#39;ve&nbsp;finally&nbsp;tracked&nbsp;down&nbsp;the&nbsp;source&nbsp;and&nbsp;it&lt;br&gt;<br>
seems&nbsp;to&nbsp;be&nbsp;Mono&amp;#39;s&nbsp;implementation&nbsp;of&nbsp;the&nbsp;ReaderWriterLock&nbsp;class.&nbsp;I&amp;#39;m&nbsp;using&lt;br&gt;<br>
an&nbsp;asynchronous&nbsp;strategy&nbsp;to&nbsp;read/process&nbsp;binary&nbsp;files...essentially&nbsp;I&nbsp;have&lt;br&gt;<br>
one&nbsp;thread&nbsp;reading&nbsp;chunks&nbsp;from&nbsp;the&nbsp;disk&nbsp;and&nbsp;then&nbsp;passing&nbsp;it&nbsp;off&nbsp;to&nbsp;a&nbsp;cluster&lt;br&gt;<br>
of&nbsp;worker&nbsp;threads&nbsp;that&nbsp;process&nbsp;the&nbsp;data.&nbsp;While&nbsp;the&nbsp;worker&nbsp;threads&nbsp;process&lt;br&gt;<br>
the&nbsp;data,&nbsp;the&nbsp;read&nbsp;thread&nbsp;goes&nbsp;ahead&nbsp;and&nbsp;reads&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;etc.&nbsp;I&nbsp;use&lt;br&gt;<br>
the&nbsp;ReaderWriterLock&nbsp;to&nbsp;synchronize&nbsp;the&nbsp;operation.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;method&nbsp;is&nbsp;working&nbsp;very&nbsp;well&nbsp;on&nbsp;Windows&nbsp;and&nbsp;Linux&nbsp;i.e.&nbsp;I&nbsp;am&nbsp;able&nbsp;to&lt;br&gt;<br>
completely&nbsp;hide&nbsp;the&nbsp;processing&nbsp;time&nbsp;&amp;quot;inside&amp;quot;&nbsp;the&nbsp;latency&nbsp;of&nbsp;the&nbsp;read&lt;br&gt;<br>
operation&nbsp;on&nbsp;my&nbsp;Core&nbsp;i7.&nbsp;To&nbsp;process&nbsp;my&nbsp;entire&nbsp;binary&nbsp;test&nbsp;file&nbsp;takes&nbsp;approx.&lt;br&gt;<br>
0.4&nbsp;seconds&nbsp;on&nbsp;Win/Linux.&nbsp;The&nbsp;problem&nbsp;arises&nbsp;when&nbsp;running&nbsp;the&nbsp;same&nbsp;app&nbsp;on&lt;br&gt;<br>
Mac.&nbsp;The&nbsp;time&nbsp;goes&nbsp;from&nbsp;0.4&nbsp;sec&nbsp;to&nbsp;12+&nbsp;seconds.&nbsp;After&nbsp;looking&nbsp;everywhere&lt;br&gt;<br>
else&nbsp;for&nbsp;the&nbsp;bottleneck,&nbsp;out&nbsp;of&nbsp;desperation&nbsp;I&nbsp;dropped&nbsp;the&nbsp;number&nbsp;of&nbsp;worker&lt;br&gt;<br>
threads&nbsp;to&nbsp;1&nbsp;(now&nbsp;using&nbsp;1&nbsp;read&nbsp;thread&nbsp;and&nbsp;1&nbsp;worker&nbsp;thread,&nbsp;same&lt;br&gt;<br>
synchronization).&nbsp;The&nbsp;execution&nbsp;time&nbsp;on&nbsp;Win/Linux&nbsp;remains&nbsp;very&nbsp;similar&lt;br&gt;<br>
(around&nbsp;0.4&nbsp;secs)&nbsp;but&nbsp;the&nbsp;execution&nbsp;time&nbsp;on&nbsp;Mac&nbsp;drops&nbsp;from&nbsp;12&nbsp;secs&nbsp;to&nbsp;0.5&lt;br&gt;<br>
secs.&nbsp;Increasing&nbsp;the&nbsp;number&nbsp;of&nbsp;worker&nbsp;threads&nbsp;to&nbsp;7&nbsp;bumps&nbsp;up&nbsp;the&nbsp;execution&lt;br&gt;<br>
time&nbsp;to&nbsp;12+&nbsp;seconds&nbsp;again.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;don&amp;#39;t&nbsp;know&nbsp;what&nbsp;is&nbsp;causing&nbsp;this,&nbsp;but&nbsp;for&nbsp;now&nbsp;I&nbsp;would&nbsp;recommend&nbsp;anyone&lt;br&gt;<br>
trying&nbsp;to&nbsp;use&nbsp;the&nbsp;ReaderWriterLock&nbsp;class&nbsp;to&nbsp;consider&nbsp;&amp;quot;rolling&nbsp;their&nbsp;own&amp;quot;&nbsp;via&lt;br&gt;<br>
synchronization&nbsp;primitives.&lt;br&gt;<br>
&lt;br&gt;<br>
Anyone&nbsp;else&nbsp;see&nbsp;this&nbsp;behavior?&lt;br&gt;<br>
&lt;br&gt;<br>
-L&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://www.nabble.com/Massive%28%21%29-ReaderWriterLock-bottleneck-tp25577788p25577788.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.nabble.com/Massive%28%21%29-ReaderWriterLock-bottleneck-tp25577788p25577788.html&lt;/a&gt;&lt;br&gt;<br>
<br>
Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;OSX&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-osx&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-osx@lists.ximian.com&quot;&gt;Mono-osx@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-osx&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-osx&lt;/a&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
