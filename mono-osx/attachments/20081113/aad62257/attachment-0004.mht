[From nobody Thu Nov 13 15:10:34 2008
Subject: Re: Blast from the past ;-)
From: Dick Porter &lt;dick@ximian.com&gt;
To: Miguel de Icaza &lt;miguel@novell.com&gt;
In-Reply-To: &lt;1226451258.4483.141.camel@erandi.site&gt;
	(sfid-20081112_005912_784345_4C95AEE4)
References: &lt;1226451258.4483.141.camel@erandi.site&gt;
	(sfid-20081112_005912_784345_4C95AEE4)
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol=&quot;application/pgp-signature&quot;;
	boundary=&quot;=-/cj0yUe3u93iBTskYWh1&quot;
Message-Id: &lt;1226583266.19172.496.camel@hagbard.apathetic.discordia.org.uk&gt;
Mime-Version: 1.0
X-Mailer: Evolution 2.8.3 (2.8.3-2.fc6)
Date: Thu, 13 Nov 2008 13:34:30 +0000
X-Evolution-Format: text/plain
X-Evolution-Account: 1
X-Evolution-Transport: smtp://dick; auth=LOGIN@imap.novell.com/;
	use_ssl=when-possible
X-Evolution-Fcc: email://local@local/Sent/Ximian


--=-/cj0yUe3u93iBTskYWh1
Content-Type: multipart/mixed; boundary=&quot;=-zmfoBSjUu903E/ay6JUI&quot;


--=-zmfoBSjUu903E/ay6JUI
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Tue, 2008-11-11 at 19:54 -0500, Miguel de Icaza wrote:
&gt; Hey Dick!
&gt;=20
&gt;     Would you mind taking a look at this problem?

It appears that macosx does not like having the same file descriptor in
multiple 'struct pollfd's in a single call to poll(2).  I'm guessing
that the last one set overrides the previous ones (in the test case
here, that means the errors one wins.)

See the attached test case in C.  The select version works on linux and
macos; the poll version breaks on macos when the pollfds aren't merged,
and works when they are.

To fix this, we can try and merge the pollfds in the Select icall (by
scanning the previously assigned pollfds, potentially O(n^2)), or we
could just chalk it up to another incompatibility.

- Dick


--=-zmfoBSjUu903E/ay6JUI
Content-Disposition: attachment; filename=select.c
Content-Type: text/x-csrc; name=select.c; charset=utf-8
Content-Transfer-Encoding: base64

I2luY2x1ZGUgPHN5cy90eXBlcy5oPg0KI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4NCiNpbmNsdWRl
IDxuZXRpbmV0L2luLmg+DQojaW5jbHVkZSA8bmV0ZGIuaD4NCiNpbmNsdWRlIDxzeXMvc2VsZWN0
Lmg+DQojaW5jbHVkZSA8c3RkaW8uaD4NCiNpbmNsdWRlIDxzdGRsaWIuaD4NCiNpbmNsdWRlIDxw
b2xsLmg+DQoNCmludCBtYWluKGludCBhcmdjLCBjaGFyICoqYXJndikNCnsNCglpbnQgc29jazsN
CglzdHJ1Y3Qgc29ja2FkZHJfaW4gc2FkZHI7DQojaWZkZWYgV0lUSF9TRUxFQ1QNCglmZF9zZXQg
cmVhZCwgZXJyOw0KI2Vsc2UNCglzdHJ1Y3QgcG9sbGZkIHBmZHNbMl07DQoJaW50IG5mZHM7DQoj
ZW5kaWYNCg0KCXNvY2sgPSBzb2NrZXQgKEFGX0lORVQsIFNPQ0tfU1RSRUFNLCAwKTsNCglpZiAo
c29jayA8IDApIHsNCgkJcGVycm9yICgic29ja2V0Iik7DQoJCWV4aXQgKDEpOw0KCX0NCg0KCXNh
ZGRyLnNpbl9mYW1pbHkgPSBBRl9JTkVUOw0KCXNhZGRyLnNpbl9hZGRyLnNfYWRkciA9IElOQURE
Ul9BTlk7DQoJc2FkZHIuc2luX3BvcnQgPSBodG9ucyAoNTY1Nik7DQoNCglpZiAoYmluZCAoc29j
aywgKHN0cnVjdCBzb2NrYWRkciAqKSZzYWRkciwgc2l6ZW9mIChzYWRkcikpKSB7DQoJCXBlcnJv
ciAoImJpbmQiKTsNCgkJZXhpdCAoMSk7DQoJfQ0KDQoJbGlzdGVuIChzb2NrLCAxMCk7DQoNCiNp
ZiBXSVRIX1NFTEVDVA0KCUZEX1pFUk8gKCZyZWFkKTsNCglGRF9aRVJPICgmZXJyKTsNCglGRF9T
RVQgKHNvY2ssICZyZWFkKTsNCglGRF9TRVQgKHNvY2ssICZlcnIpOw0KDQoJaWYgKHNlbGVjdCAo
c29jayArIDEsICZyZWFkLCAwLCAmZXJyLCBOVUxMKSA8IDApIHsNCgkJcGVycm9yICgic2VsZWN0
Iik7DQoJCWV4aXQgKDEpOw0KCX0NCg0KCWlmIChGRF9JU1NFVCAoc29jaywgJnJlYWQpKSB7DQoJ
CXByaW50ZiAoInJlYWQgZXZlbnRcbiIpOw0KCX0gZWxzZSB7DQoJCXByaW50ZiAoIm5vIHJlYWQg
ZXZlbnRcbiIpOw0KCX0NCiNlbHNlDQojaWZkZWYgTUVSR0VEDQoJcGZkc1swXS5mZCA9IHNvY2s7
DQoJcGZkc1swXS5ldmVudHMgPSBQT0xMSU4gfCBQT0xMRVJSIHwgUE9MTEhVUCB8IFBPTExOVkFM
Ow0KCW5mZHMgPSAxOw0KI2Vsc2UNCglwZmRzWzBdLmZkID0gc29jazsNCglwZmRzWzBdLmV2ZW50
cyA9IFBPTExJTjsNCglwZmRzWzFdLmZkID0gc29jazsNCglwZmRzWzFdLmV2ZW50cyA9IFBPTExF
UlIgfCBQT0xMSFVQIHwgUE9MTE5WQUw7DQoJbmZkcyA9IDI7DQojZW5kaWYNCg0KCWlmIChwb2xs
IChwZmRzLCBuZmRzLCAtMSkgPCAwKSB7DQoJCXBlcnJvciAoInBvbGwiKTsNCgkJZXhpdCAoMSk7
DQoJfQ0KDQoJaWYgKHBmZHNbMF0ucmV2ZW50cyAmIFBPTExJTikgew0KCQlwcmludGYgKCJyZWFk
IGV2ZW50XG4iKTsNCgl9IGVsc2Ugew0KCQlwcmludGYgKCJubyByZWFkIGV2ZW50XG4iKTsNCgl9
DQojZW5kaWYNCg0KCWV4aXQgKDApOw0KfQ0KDQo=


--=-zmfoBSjUu903E/ay6JUI--

--=-/cj0yUe3u93iBTskYWh1
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (GNU/Linux)

iD8DBQBJHCzf5y3El+U5Mz8RAnWBAJ9xrAJfGA4CELH550k9g4FaXzUTvgCgo6Nz
+sTGzWoz877dOP6I+ETKIUI=
=YaNO
-----END PGP SIGNATURE-----

--=-/cj0yUe3u93iBTskYWh1--
]