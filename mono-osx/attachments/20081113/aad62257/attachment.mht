[From nobody Thu Nov 13 15:10:33 2008
Return-Path: &lt;miguel@novell.com&gt;
X-Original-To: dick@hagbard.apathetic.discordia.org.uk
Delivered-To: dick@hagbard.apathetic.discordia.org.uk
Received: from hagbard.apathetic.discordia.org.uk
	(hagbard.apathetic.discordia.org.uk [127.0.0.1]) by
	hagbard.apathetic.discordia.org.uk (Postfix) with ESMTP id 204F414C5B4B
	for &lt;dick@hagbard.apathetic.discordia.org.uk&gt;;
	Wed, 12 Nov 2008 00:59:12 +0000 (GMT)
X-Original-To: dick@ximian.com
Received: from skeptopotamus.ximian.com [130.57.169.16] by
	hagbard.apathetic.discordia.org.uk with POP3 (fetchmail-6.3.6) for
	&lt;dick@hagbard.apathetic.discordia.org.uk&gt; (single-drop);
	Wed, 12 Nov 2008 00:59:12 +0000 (GMT)
Received: from herald.ximian.com (frontgate.ximian.com [130.57.169.19]) by
	skeptopotamus.ximian.com (Postfix) with ESMTP id 4D3407406DC for
	&lt;dick@ximian.com&gt;; Tue, 11 Nov 2008 19:55:54 -0500 (EST)
Received: by herald.ximian.com (Postfix, from userid 2601) id 487F470033;
	Tue, 11 Nov 2008 19:55:54 -0500 (EST)
Received: from victor.provo.novell.com (victor.provo.novell.com
	[137.65.250.26]) by herald.ximian.com (Postfix) with ESMTP id
	6D01A70019
	for &lt;dick@ximian.com&gt;; Tue, 11 Nov 2008 19:55:53 -0500 (EST)
Received: from [164.99.121.39] (prv-ext-foundry1.gns.novell.com
	[137.65.251.240]) by victor.provo.novell.com with ESMTP;
	Tue, 11 Nov 2008 17:55:42 -0700
Subject: Blast from the past ;-)
From: Miguel de Icaza &lt;miguel@novell.com&gt;
To: Dick Porter &lt;dick@ximian.com&gt;
Content-Type: multipart/mixed; boundary=&quot;=-mJ8m3JPnr1NwlR+HB+cv&quot;
Organization: Novell, Inc.
Date: Tue, 11 Nov 2008 19:54:18 -0500
Message-Id: &lt;1226451258.4483.141.camel@erandi.site&gt;
	(sfid-20081112_005912_784345_4C95AEE4)
Mime-Version: 1.0
X-Mailer: Evolution 2.22.1.1
X-Spam-Checker-Version: SpamAssassin 3.0.3 (2005-04-27) on frontgate.ximian.com
X-Spam-Level: *
X-Spam-Status: No, score=1.3 required=5.0 tests=AWL,MY_OBFUX,RM_bw_Generic
	version=3.0.3
X-CRM114-Version: 20070301-BlameBaltar ( TRE 0.7.5 (LGPL) ) MR-BD9991E2
X-CRM114-CacheID: sfid-20081112_005912_784345_4C95AEE4
X-CRM114-Status: GOOD (  18.19  )
X-Hagbard-Spambayes-Classification: ham; 0.00
X-Evolution-Source: mbox:///var/mail/dick


--=-mJ8m3JPnr1NwlR+HB+cv
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Hey Dick!

    Would you mind taking a look at this problem?

Miguel.

--=-mJ8m3JPnr1NwlR+HB+cv
Content-Disposition: inline
Content-Description: Forwarded message - [Fwd: [Mono-osx] Socket.Select()
	behaviour difference between osx&lt;&gt;linux.]
Content-Type: message/rfc822

Return-path: &lt;lucas@mach8.nl&gt;
Received: from novell.com (kellin.provo.novell.com [130.57.1.151]) by
	lucius.provo.novell.com with ESMTP; Mon, 10 Nov 2008 02:48:23 -0700
Received: from ug-out-1314.google.com not authenticated [66.249.92.174] by
	novell.com with M+ Extreme Email Engine 2008.3.release; Mon, 10 Nov 2008
	02:48:20 -0700
X-MailFrom: lucas@mach8.nl
Received: by ug-out-1314.google.com with SMTP id j40so424665ugd.34 for
	&lt;miguel@novell.com&gt;; Mon, 10 Nov 2008 01:48:19 -0800 (PST)
Received: by 10.67.24.13 with SMTP id b13mr1891357ugj.25.1226310499183;
	Mon, 10 Nov 2008 01:48:19 -0800 (PST)
Return-Path: &lt;lucas@mach8.nl&gt;
Received: from lucas-meijers-macbook-pro.local
	(a80-101-180-216.adsl.xs4all.nl [80.101.180.216]) by mx.google.com with
	ESMTPS id b23sm7111832ugd.45.2008.11.10.01.48.18 (version=SSLv3
	cipher=RC4-MD5); Mon, 10 Nov 2008 01:48:18 -0800 (PST)
Message-ID: &lt;49180361.30702@mach8.nl&gt;
Date: Mon, 10 Nov 2008 10:48:17 +0100
From: Lucas Meijer &lt;lucas@mach8.nl&gt;
User-Agent: Thunderbird 2.0.0.17 (Macintosh/20080914)
MIME-Version: 1.0
To: Miguel de Icaza &lt;miguel@novell.com&gt;
Subject: [Fwd: [Mono-osx] Socket.Select() behaviour difference between
	osx&lt;&gt;linux.]
Content-Type: multipart/mixed; boundary=&quot;------------060803010809030209090008&quot;

This is a multi-part message in MIME format.
--------------060803010809030209090008
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: quoted-printable



--------------060803010809030209090008
Content-Type: message/rfc822;
	name=&quot;[Mono-osx] Socket.Select() behaviour difference between
	osx&lt;&gt;linux..eml&quot;
Content-Transfer-Encoding: 7bit
Content-Disposition: inline; filename*0=&quot;[Mono-osx] Socket.Select() behaviour
	difference between osx&lt;&quot;; filename*1=&quot;&gt;linux..eml&quot;

Return-Path: &lt;mono-osx-bounces@lists.ximian.com&gt;
X-Original-To: lucas@mach8.nl
Delivered-To: lucas@mach8.nl
Received: from 67.207.129.66 [67.207.129.66] by ijskast with IMAP
	(fetchmail-6.3.6) for &lt;lucas@localhost&gt; (single-drop); Mon, 30 Jun 2008
	10:27:17 +0200 (CEST)
Received: from lists.ximian.com (galactus.ximian.com [130.57.169.22]) by
	shockwaving.com (Postfix) with ESMTP id A159A395AB for &lt;lucas@mach8.nl&gt;;
	Mon, 30 Jun 2008 08:31:20 +0000 (UTC)
Received: from galactus.ximian.com (localhost.localdomain [127.0.0.1]) by
	lists.ximian.com (Postfix) with ESMTP id F0D601CFCAC; Mon, 30 Jun 2008
	04:31:18 -0400 (EDT)
X-Original-To: mono-osx@lists.ximian.com
Delivered-To: mono-osx@lists.ximian.com
Received: from herald.ximian.com (frontgate.ximian.com [130.57.169.19]) by
	lists.ximian.com (Postfix) with ESMTP id 449B51CFB2B for
	&lt;mono-osx@lists.ximian.com&gt;; Mon, 30 Jun 2008 04:31:17 -0400 (EDT)
Received: by herald.ximian.com (Postfix, from userid 2601) id 2F73F7004A;
	Mon, 30 Jun 2008 04:31:17 -0400 (EDT)
X-Greylist: delayed 639 seconds by postgrey-1.27 at frontgate.ximian.com;
	Mon, 30 Jun 2008 04:31:16 EDT
Received: from smtp-vbr11.xs4all.nl (smtp-vbr11.xs4all.nl [194.109.24.31])
	by herald.ximian.com (Postfix) with ESMTP id 47E5F70005 for
	&lt;mono-osx@lists.ximian.com&gt;; Mon, 30 Jun 2008 04:31:16 -0400 (EDT)
Received: from lucas-meijers-macbook-pro.local (lucas.demon.nl
	[212.238.157.102]) (authenticated bits=0) by smtp-vbr11.xs4all.nl
	(8.13.8/8.13.8) with ESMTP id m5U8Kaf0065286 for
	&lt;mono-osx@lists.ximian.com&gt;; Mon, 30 Jun 2008 10:20:36 +0200 (CEST)
	(envelope-from lucas@mach8.nl)
Message-ID: &lt;48689753.3070809@mach8.nl&gt;
Date: Mon, 30 Jun 2008 10:20:35 +0200
From: Lucas Meijer &lt;lucas@mach8.nl&gt;
User-Agent: Thunderbird 2.0.0.14 (Macintosh/20080421)
MIME-Version: 1.0
To: mono-osx@lists.ximian.com
Content-Type: multipart/mixed; boundary=&quot;------------020307070503040701010400&quot;
X-Virus-Scanned: by XS4ALL Virus Scanner
X-Spam-Checker-Version: SpamAssassin 3.0.3 (2005-04-27) on frontgate.ximian.com
X-Spam-Level: **
X-Spam-Status: No, score=2.2 required=5.0 tests=AWL, FORGED_RCVD_HELO,
	MY_OBFUX, RM_bw_Generic version=3.0.3
Subject: [Mono-osx] Socket.Select() behaviour difference between osx&lt;&gt;linux.
X-BeenThere: mono-osx@lists.ximian.com
X-Mailman-Version: 2.1.8
Precedence: list
List-Id: Discuss Mono on Mac OS X &lt;mono-osx.lists.ximian.com&gt;
List-Unsubscribe: &lt;http://lists.ximian.com/mailman/listinfo/mono-osx&gt;,
	&lt;mailto:mono-osx-request@lists.ximian.com?subject=unsubscribe&gt;
List-Archive: &lt;http://lists.ximian.com/pipermail/mono-osx&gt;
List-Post: &lt;mailto:mono-osx@lists.ximian.com&gt;
List-Help: &lt;mailto:mono-osx-request@lists.ximian.com?subject=help&gt;
List-Subscribe: &lt;http://lists.ximian.com/mailman/listinfo/mono-osx&gt;,
	&lt;mailto:mono-osx-request@lists.ximian.com?subject=subscribe&gt;
Sender: mono-osx-bounces@lists.ximian.com
Errors-To: mono-osx-bounces@lists.ximian.com

This is a multi-part message in MIME format.
--------------020307070503040701010400
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: quoted-printable

Hi,

It looks like Socket.Select() behaves differently on osx &lt;&gt; linux in the=20
case
where a socket instance is placed in both the readlist, and the errorlist.
On osx, after having called socket.Listen(),  calling Socket.Select()=20
with the socket
instance being in the read and errorlist,  the select call will return=20
once a connection
is established, however it will return with empty readlist and errorlists.

on linux, the resulting readlist is filled with the socket instance.=20
(Which I believe is the correct
behaviour)

Attached is a demo program that exhibits this behaviour for me.

Bye, Lucas

PS I hope it's okay to &quot;pre-report&quot; a bug on this list. I'd file an=20
official bug report, but I'm
new to mono, so I figured I'd check with people in the know if it's=20
really a bug or some
form of pilot error.


--------------020307070503040701010400
Content-Type: text/plain; x-mac-type=&quot;0&quot;; x-mac-creator=&quot;0&quot;; name=&quot;Bug2.cs&quot;
Content-Disposition: inline; filename=&quot;Bug2.cs&quot;
Content-Transfer-Encoding: quoted-printable

using System;
using System.Net;
using System.Net.Sockets;
using System.Collections.Generic;

public class Server
{
  static void Main()
  {
    Socket ms =3D new Socket(AddressFamily.InterNetwork, SocketType.Stream,=
 ProtocolType.Tcp);
    ms.Blocking =3D false;
    ms.Bind(new IPEndPoint(IPAddress.Any,5656));
    ms.Listen(10);
    Console.WriteLine(&quot;Waiting for incoming connection&quot;);
    List&lt;Socket&gt; readList =3D new List&lt;Socket&gt;();
    List&lt;Socket&gt; errorList =3D new List&lt;Socket&gt;();
    readList.Add(ms);

    //comment out the line below to make osx behave like linux.
    errorList.Add(ms);

    Socket.Select(readList,null,errorList,-1);
    if (readList.Count&gt;0)
      Console.WriteLine(&quot;read event&quot;);  //this happens on linux
    else
      Console.WriteLine(&quot;no read event&quot;);   //this happens on osx
  }
}



--------------020307070503040701010400
Content-Type: text/plain; charset=&quot;us-ascii&quot;
MIME-Version: 1.0
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

_______________________________________________
Mono-osx mailing list
Mono-osx@lists.ximian.com
http://lists.ximian.com/mailman/listinfo/mono-osx

--------------020307070503040701010400--

--------------060803010809030209090008--

--=-mJ8m3JPnr1NwlR+HB+cv--
]