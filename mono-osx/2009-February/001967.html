<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] NObjective and Inheritance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20NObjective%20and%20Inheritance&In-Reply-To=21192f970902061508q52da66c0r662fc021fec84c29%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001966.html">
   <LINK REL="Next"  HREF="001968.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] NObjective and Inheritance</H1>
    <B>Eugeny Grishul</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20NObjective%20and%20Inheritance&In-Reply-To=21192f970902061508q52da66c0r662fc021fec84c29%40mail.gmail.com"
       TITLE="[Mono-osx] NObjective and Inheritance">eugeny.grishul at gmail.com
       </A><BR>
    <I>Mon Feb  9 09:39:07 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001966.html">[Mono-osx] NObjective and Inheritance
</A></li>
        <LI>Next message: <A HREF="001968.html">[Mono-osx] NObjective and Inheritance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1967">[ date ]</a>
              <a href="thread.html#1967">[ thread ]</a>
              <a href="subject.html#1967">[ subject ]</a>
              <a href="author.html#1967">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,
Thanks for deep code review =)

Weaver pros and cons:
1) without inheritance proxy assemblies will be about 60M due to duplicated
methods
2) it will be used for Objective-C property accessors for same goal

Cons:
1) code produced by weaver is not verifiable. By spec CLI itself does not
allow for value type inheritance:

8.9.7.
...
3. A value type does not inherit; rather the base type specified in the
class definition defines the
base type of the boxed type.
4. The base type of a boxed type shall not have any fields.

8.9.10.
In their unboxed form value types do not inherit from any type. Boxed value
types shall inherit directly from
System.ValueType unless they are enumerations, in which case, they shall
inherit from System.Enum. Boxed
value types shall be sealed.

My approach is a violation of the spec. If you run &quot;peverify&quot; on the
assembly with one value type inheriting from another, it will tell you as
much =) If mono won't support value-type inheritace in future it will be bug
in ther JIT coz CLR implementation actually ALLOWS it.
2) Current Mono VES implementation have a bug related ot value type
inheritance and to workaround it don't allow objc proxies to be boxed.
Following code will crash JIT:

public void ButtonPressed( NSButton sender )
{
    Console.WriteLine( &quot;Pressed {0}&quot;, sender );
...
...

And workaround:
public void ButtonPressed( NSButton sender )
{
    Console.WriteLine( &quot;Pressed {0}&quot;, sender.ToString() );
...
...

About NObjectiveAST - it works like NRefactory and able to parse and save
AST tree to file. But if you want to extend interoping abilities of
resulting code then you should modify HeaderAnalyzer (
<A HREF="http://code.google.com/p/nobjective/source/browse/trunk/ProxyGenerator/HeaderAnalyzer.cs">http://code.google.com/p/nobjective/source/browse/trunk/ProxyGenerator/HeaderAnalyzer.cs</A>
) which is not part of NObjectiveAST. The goal of mine bridge is Objective-C
interop so I'll not plan to add support for automatical P/Invoke
generation.. My friend's dimpoma thesis is related with automatical P/Invoke
generation (he will use NObjectiveAST and test his work on creating Qt
bindings with full code coverage) and may be after 5 months of his work we
will see brialliant project..or not =) Anyway you can make patch and help to
improve project =)

WBR,
Eugeny Grishul


Martin Smith-8 wrote:
&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I was looking at the NObjective source code, and noticed that that
</I>&gt;<i> basically
</I>&gt;<i> all the proxies are generated as structs.  The compiled assembly then gets
</I>&gt;<i> passed to a code weaver which fills in the Objective-C class inheritance
</I>&gt;<i> structure. The code weaver basically uses Mono.Cecil to make structs
</I>&gt;<i> support
</I>&gt;<i> inheritance.
</I>&gt;<i> 
</I>&gt;<i> I guess this works, but the thing I'm wondering is: is it safe te rely on
</I>&gt;<i> the fact that the mono runtime can actually support inheritance for value
</I>&gt;<i> types?  Is this something that's supposed to be supported by the CLI but
</I>&gt;<i> just isnt supported by C#?  I'm assuming that there would be some serious
</I>&gt;<i> issues if all the proxies weren't the same size (i.e. with only an IntPtr
</I>&gt;<i> as
</I>&gt;<i> the instance data).
</I>&gt;<i> 
</I>&gt;<i> At any rate, cheers Eugeny.  You've created a pretty impressive layer
</I>&gt;<i> here.
</I>&gt;<i> Have you thought about extending NObjectiveAST to suport interoping some
</I>&gt;<i> of
</I>&gt;<i> the C-based functions (for example, NSMakeRect, or the CGContext*
</I>&gt;<i> methods).
</I>&gt;<i> 
</I>&gt;<i> Thanks again Eugeny for such great code!
</I>&gt;<i> Martin
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-osx mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">Mono-osx at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">http://lists.ximian.com/mailman/listinfo/mono-osx</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://www.nabble.com/NObjective-and-Inheritance-tp21882576p21914042.html">http://www.nabble.com/NObjective-and-Inheritance-tp21882576p21914042.html</A>
Sent from the Mono - OSX mailing list archive at Nabble.com.

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001966.html">[Mono-osx] NObjective and Inheritance
</A></li>
	<LI>Next message: <A HREF="001968.html">[Mono-osx] NObjective and Inheritance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1967">[ date ]</a>
              <a href="thread.html#1967">[ thread ]</a>
              <a href="subject.html#1967">[ subject ]</a>
              <a href="author.html#1967">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
