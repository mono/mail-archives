<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] [MonoMac] patch for MM-addin, Existing Framework
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoMac%5D%20patch%20for%20MM-addin%2C%20Existing%20Framework&In-Reply-To=AANLkTimvbjnUmZg0OOpb79fzYecXD8KGYZy213e7cqUQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003795.html">
   <LINK REL="Next"  HREF="003797.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] [MonoMac] patch for MM-addin, Existing Framework</H1>
    <B>Duane Wandless</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoMac%5D%20patch%20for%20MM-addin%2C%20Existing%20Framework&In-Reply-To=AANLkTimvbjnUmZg0OOpb79fzYecXD8KGYZy213e7cqUQ%40mail.gmail.com"
       TITLE="[Mono-osx] [MonoMac] patch for MM-addin, Existing Framework">duane at wandless.net
       </A><BR>
    <I>Thu Jan 27 09:12:07 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003795.html">[Mono-osx] [MonoMac] patch for MM-addin, Existing Framework
</A></li>
        <LI>Next message: <A HREF="003797.html">[Mono-osx] [MonoMac] patch for MM-addin, Existing Framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3796">[ date ]</a>
              <a href="thread.html#3796">[ thread ]</a>
              <a href="subject.html#3796">[ subject ]</a>
              <a href="author.html#3796">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Throwing may be better if the framework is missing.  I can be convinced.
No symlinking for now.

The &quot;relative path&quot; option is only while developing and has no impact when
running.  Once installed into Contents\Frameworks the reference is always
relative to the app location.

Incorporated most of your suggestions, out of time now have to get back to
the day job.  Also added the ability for the project pad to update as
frameworks are added/deleted.  This is the same basic method Web References
uses.

Did not move the generation of the file to OnBuild.  But it is better about
not requiring a build every time.

The generated path in the dlopen call is almost correct.  Currently it is
the FULL path to the &lt;proj&gt;.app\Contents\Frameworks location.  Which is
incorrect.  The call to dlopen should be relative to the .app's location.

Including the new files.

Even though I disagree in part to the overuse of var I did modify this code
to use it more.

I disagree with using var when the type is known.  To me that is exactly
when you should not use var and diminishes one of C#'s benefits, strong name
typing.  At least from readability.

I agree with this summary from <A HREF="http://www.infoq.com/news/2008/05/CSharp-var:">http://www.infoq.com/news/2008/05/CSharp-var:</A>

Overuse of var can make source code less readable for others. It is
recommended to use var only when it is necessary, that is, when the variable
will be used to store an anonymous type or a collection of anonymous types.

For example this line is completely vague:
var ls = conf.LaunchScript;

I do not know what ls is.  What is a LaunchScript, oh if I hover over it I
see it is a FilePath.  To be me that would much more readable and useful as:
FilePath ls = conf.LaunchScript;

That makes the code clear just from a glance.  Otherwise I have to research
to determine the type.  Maybe if you limit the use to var foo = new Foo ().
 But not everywhere especially when the assignment is vague.

Duane

On Wed, Jan 26, 2011 at 6:52 PM, Michael Hutchinson &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">m.j.hutchinson at gmail.com</A>&gt; wrote:

&gt;<i> On Wed, Jan 26, 2011 at 10:01 AM, Duane Wandless &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">duane at wandless.net</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Thanks, here is another update based on feedback.
</I>&gt;<i> &gt; Changes:
</I>&gt;<i> &gt; * renamed the menu item
</I>&gt;<i> &gt; * save to the project file as MSbuild items
</I>&gt;<i> &gt; * use CodeDOM to generate code
</I>&gt;<i> &gt; * generates MonoMacFrameworks.Initialize() in MonoMacFrameworks.cs
</I>&gt;<i> &gt; * saves to project whether relative or absolute path
</I>&gt;<i> &gt; * relies on MonoMac exporting dlopen and dlerror in
</I>&gt;<i> &gt; the MonoMac.ObjCRuntime.Dlfcn class
</I>&gt;<i> &gt; Issues:
</I>&gt;<i> &gt; * Project pad does not update when frameworks are added/deleted
</I>&gt;<i> &gt; * build must always be performed since build process modifies
</I>&gt;<i> &gt; MonoMacFrameworks.cs in wrong step
</I>&gt;<i> &gt; * UI needs more work
</I>&gt;<i>
</I>&gt;<i> Great, this is definitely moving quickly in the right direction :)
</I>&gt;<i>
</I>&gt;<i> A few more comments:
</I>&gt;<i> * your patch is missing the added files - it only has the modified files.
</I>&gt;<i> * please move the CodeDom code into a separate method
</I>&gt;<i> * you should update the generated file before the base.OnBuild call,
</I>&gt;<i> so it happens before the compilation
</I>&gt;<i> * it might be nice to update the generated code immediately after any
</I>&gt;<i> frameworks are added/removed. Not a must-have though.
</I>&gt;<i> * you should only copy the frameworks if they change
</I>&gt;<i> * the generated file should only be updated at build time if the
</I>&gt;<i> project file is newer than the generated file. GetNeedsBuilding should
</I>&gt;<i> check this too.
</I>&gt;<i> * don't hardcode CSharpCodeProvider, you can get the appropriate
</I>&gt;<i> language-specific CodeDomProvider from the DotNetProject.
</I>&gt;<i> * please use var when the type is obvious from the assignment,
</I>&gt;<i> especially newing, e.g. var foo = new FooBar (...);
</I>&gt;<i> * property initializers can be used to make CodeDom a bit nicer.
</I>&gt;<i> * if (Directory.Exists (destFramework) == true) should be if
</I>&gt;<i> (Directory.Exists (destFramework))
</I>&gt;<i> * wouldn't it be better to throw instead of writing a console message,
</I>&gt;<i> since missing frameworks will almost certainly break an app?
</I>&gt;<i> * partial modifiers are no longer needed
</I>&gt;<i> * string paths can be implicitly cast to/from MD's FilePath struct,
</I>&gt;<i> which neatens up path manipulation a bit
</I>&gt;<i> * should there be a distinction for &quot;local copy&quot; frameworks, like dll
</I>&gt;<i> references have? In both cases you need the loading code, but only for
</I>&gt;<i> local copy does the framework need to be copied into the app AFAIK.
</I>&gt;<i>
</I>&gt;<i> Re. Miguel's comments, it would be good to check for missing
</I>&gt;<i> frameworks when copying them and return errors in a BuildResult
</I>&gt;<i> instead of letting MD present the IO exception directly.
</I>&gt;<i>
</I>&gt;<i> I'm not sure about the symlinking, since the apps we build are
</I>&gt;<i> currently distributable without additional packaging steps, and
</I>&gt;<i> symlinking would break that. Frameworks won't really hurt build
</I>&gt;<i> iteration times if we fix it to to only copy frameworks when they
</I>&gt;<i> change.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Michael Hutchinson
</I>&gt;<i> <A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20110127/accccf86/attachment-0001.html">http://lists.ximian.com/pipermail/mono-osx/attachments/20110127/accccf86/attachment-0001.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: externalFrameworks3.zip
Type: application/zip
Size: 9612 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20110127/accccf86/attachment-0001.zip">http://lists.ximian.com/pipermail/mono-osx/attachments/20110127/accccf86/attachment-0001.zip</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: externalFrameworks3.diff
Type: application/octet-stream
Size: 12467 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20110127/accccf86/attachment-0001.obj">http://lists.ximian.com/pipermail/mono-osx/attachments/20110127/accccf86/attachment-0001.obj</A> 
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003795.html">[Mono-osx] [MonoMac] patch for MM-addin, Existing Framework
</A></li>
	<LI>Next message: <A HREF="003797.html">[Mono-osx] [MonoMac] patch for MM-addin, Existing Framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3796">[ date ]</a>
              <a href="thread.html#3796">[ thread ]</a>
              <a href="subject.html#3796">[ subject ]</a>
              <a href="author.html#3796">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
