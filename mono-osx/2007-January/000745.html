<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] Statics and Singletons with Dumbarton
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20Statics%20and%20Singletons%20with%20Dumbarton&In-Reply-To=44F72562-FD59-4B3C-874F-A73CC19607DE%40bleepconsulting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000746.html">
   <LINK REL="Next"  HREF="000747.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] Statics and Singletons with Dumbarton</H1>
    <B>Allan Hsu</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20Statics%20and%20Singletons%20with%20Dumbarton&In-Reply-To=44F72562-FD59-4B3C-874F-A73CC19607DE%40bleepconsulting.com"
       TITLE="[Mono-osx] Statics and Singletons with Dumbarton">allan at counterpop.net
       </A><BR>
    <I>Tue Jan  2 15:55:08 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000746.html">[Mono-osx] Statics and Singletons with Dumbarton [Solved with	patch]
</A></li>
        <LI>Next message: <A HREF="000747.html">[Mono-osx] Statics and Singletons with Dumbarton
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#745">[ date ]</a>
              <a href="thread.html#745">[ thread ]</a>
              <a href="subject.html#745">[ subject ]</a>
              <a href="author.html#745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jan 2, 2007, at 12:55 AM, R. Tyler Ballance wrote:

Sorry about the delay in replying, but I've been busy working/ 
traveling. If you need to call/access managed static methods, you  
should either instantiate a DBMonoClassRepresentation around your  
MonoClass* or use the C-style function calls defined in DBInvoke.h.  
Neither of these should require an object instance.

Here's the convention I use... If I need static functionality in a  
DBMonoObjectRepresentation subclass, I keep around a static  
MonoClass* or DBMonoClassRepresentation (depending on situation) that  
gets set in the ObjC class initializer. Any class methods in my  
subclass call through using either the DBMonoClassRepresentation  
object or the DBMonoClassX() functions in DBMonoInvoke.m. This is  
sort of what it looks like, but I'm writing it on the spot, so it may  
not work exactly right:

static MonoClass *_monoClass = NULL;

+ (void)initialize {
	if([self class] != [MyClass class])
		return;

	_monoClass = (whatever you need to do to get your MonoClass *,  
probably involves +[DBMonoEnvironment monoClassWithName:  
fromAssembly:]);
}

+ (NSString *)someStaticProperty {
	MonoString *monoString = DBMonoClassGetProperty(_monoClass,  
&quot;someStaticProperty&quot;);
	return [NSString stringWithMonoString:monoString];
}

Note that the method invocation functions in DBInvoke are vararg- 
based, so it may be easier to use a DBMonoClassRepresentation for  
your purposes, but the idea is the same.

	-Allan

&gt;<i> Ok, I apologize for the recent flood of emails, but i've been  
</I>&gt;<i> trying to tie some complex Cocoa and C# together recently.
</I>&gt;<i>
</I>&gt;<i> Singletons)
</I>&gt;<i>
</I>&gt;<i> 	There seems to be no reasonable means of implementing a singleton  
</I>&gt;<i> DBMonoObjectRepresentation as it stands now with Dumbarton. My C#  
</I>&gt;<i> singleton is relatively &quot;traditional&quot; in that it has a private  
</I>&gt;<i> constructor, and a static Iinstance property (i..e  
</I>&gt;<i> Object.Instance.ExecuteMethod()). Implementing a Cocoa singleton  
</I>&gt;<i> isn't hard, but initWithSignature and initWithMonoObject aren't  
</I>&gt;<i> exactly suitable. I attempted (in vain of course) to use  
</I>&gt;<i> getProperty to return a MonoObject to initWithMonoObject, which  
</I>&gt;<i> requires an instantiated DBMonoObjectRepresentation to function  
</I>&gt;<i> (d'oh).
</I>&gt;<i>
</I>&gt;<i> 	I had another property, and I found that if I used  
</I>&gt;<i> [[SingletonObject sharedObject] property]; it would call my default  
</I>&gt;<i> constructor, regardless of the private modifier (!).
</I>&gt;<i>  Whereas the code would be:
</I>&gt;<i>
</I>&gt;<i> - (NSString *)property
</I>&gt;<i> {
</I>&gt;<i> 	MonoString *monoString = (MonoString*)[self  
</I>&gt;<i> getProperty:&quot;someproperty&quot;];
</I>&gt;<i> 	return [NSString stringWithMonoString:monoString];
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> #pragma mark &quot;Singelton Methods&quot;
</I>&gt;<i> + (SingletonObject *)sharedObject
</I>&gt;<i> {
</I>&gt;<i> 	@synchronized(self)
</I>&gt;<i> 	{
</I>&gt;<i> 		if (instance == nil)
</I>&gt;<i> 		{
</I>&gt;<i> 			instance = [[self alloc] init];
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> 	return instance;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> And the C# code is somewhere along the lines of :
</I>&gt;<i> 		public static SingletonObject Instance
</I>&gt;<i> 		{
</I>&gt;<i> 			get
</I>&gt;<i> 			{
</I>&gt;<i> 				lock(internalLock)
</I>&gt;<i> 				{
</I>&gt;<i> 					if (instance == null)
</I>&gt;<i> 						instance = new SingletonObject();
</I>&gt;<i> 						
</I>&gt;<i> 					Console.WriteLine(&quot;Calling Instance Property&quot;);	
</I>&gt;<i> 					return instance;
</I>&gt;<i> 				}
</I>&gt;<i> 			}
</I>&gt;<i> 		}		
</I>&gt;<i> 		public string someproperty { get { return m_SomeProperty; } }
</I>&gt;<i>
</I>&gt;<i> 		private SingletonObject()
</I>&gt;<i> 		{
</I>&gt;<i> 			m_SomeProperty = this.GeneratePath();
</I>&gt;<i> 		}
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Dumbarton would violate the access modifier for the constructor,  
</I>&gt;<i> and call it, and then when I would call the property method in my  
</I>&gt;<i> Cocoa code, it'd function as expected. This seems like a subtle  
</I>&gt;<i> bug, or is it something that is &quot;allowed&quot; within the constraints of  
</I>&gt;<i> the Mono embedded runtime?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Statics)
</I>&gt;<i>
</I>&gt;<i> 	As far as I can tell there's not really a feasible way to call  
</I>&gt;<i> static methods through the Dumbarton bridge i.e. I cannot write:
</I>&gt;<i> Cocoa:
</I>&gt;<i> + (NSString *)getStringFromCSharp
</I>&gt;<i> {
</I>&gt;<i> 	MonoString *monoString = (MonoString*)[DBClass  
</I>&gt;<i> invokeStaticMethod:&quot;returnString&quot; withNumArgs:0]];
</I>&gt;<i> 	return [NSString stringWithMonoString:monoString];
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> C#:
</I>&gt;<i> public static string returnString()
</I>&gt;<i> {
</I>&gt;<i> 	return &quot;OMFG!&quot;;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> I've been looking through the embedding Mono examples to see if  
</I>&gt;<i> there's a good means of doing so with the embedded runtime but from  
</I>&gt;<i> the best that I can tell, almost all the calls require an  
</I>&gt;<i> instatiated MonoObject before invoking a method.
</I>&gt;<i>
</I>&gt;<i> It seems like having statics would fix my problem with singletons  
</I>&gt;<i> immediately, is there a piece of the puzzle I'm not seeing?
</I>&gt;<i>
</I>&gt;<i> If not, any pointers on where I could look to add this  
</I>&gt;<i> functionality to the bridge?
</I>
--
Allan Hsu &lt;allan at counterpop dot net&gt;
1E64 E20F 34D9 CBA7 1300  1457 AC37 CBBB 0E92 C779


</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000746.html">[Mono-osx] Statics and Singletons with Dumbarton [Solved with	patch]
</A></li>
	<LI>Next message: <A HREF="000747.html">[Mono-osx] Statics and Singletons with Dumbarton
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#745">[ date ]</a>
              <a href="thread.html#745">[ thread ]</a>
              <a href="subject.html#745">[ subject ]</a>
              <a href="author.html#745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
