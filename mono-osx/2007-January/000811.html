<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] [Mono-dev] OS X builds and -DUSE-MUNMAP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMono-dev%5D%20OS%20X%20builds%20and%20-DUSE-MUNMAP&In-Reply-To=46C57A95-0CA0-48C2-8C67-494486826386%40mac.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000821.html">
   <LINK REL="Next"  HREF="000773.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] [Mono-dev] OS X builds and -DUSE-MUNMAP</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMono-dev%5D%20OS%20X%20builds%20and%20-DUSE-MUNMAP&In-Reply-To=46C57A95-0CA0-48C2-8C67-494486826386%40mac.com"
       TITLE="[Mono-osx] [Mono-dev] OS X builds and -DUSE-MUNMAP">lupus at ximian.com
       </A><BR>
    <I>Fri Jan 26 13:32:29 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000821.html">[Mono-osx] [Mono-dev] OS X builds and -DUSE-MUNMAP
</A></li>
        <LI>Next message: <A HREF="000773.html">[Mono-osx] mkbundle error...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#811">[ date ]</a>
              <a href="thread.html#811">[ thread ]</a>
              <a href="subject.html#811">[ subject ]</a>
              <a href="author.html#811">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/24/07 Eoin Norris wrote:
&gt;<i> Hmm. I am not so sure that this has made it, or works as advertised.  
</I>&gt;<i> i can see - in loading in a very large xml file -
</I>[...]
&gt;<i> This bloats to 200MB when reading a 23MB xml file - mostly in  
</I>&gt;<i> doc.LoadXml(_libraryXmlString) as far as I can see ( although without  
</I>&gt;<i> a full debugger it is hard to tell) . I have also would do the same  
</I>&gt;<i> if it were read from disk at this point,   a process that is too slow  
</I>&gt;<i> in any case, so I load in the Cocoa layer instead.
</I>[...]
&gt;<i> The size increase is possibly a bug in itself, since the .Net side on  
</I>&gt;<i> windows doing similar code does not bloat to that level.
</I>&gt;<i> 
</I>&gt;<i> In any case the object that encapsulates this functionality does not  
</I>&gt;<i> need to hang around after it's contents are written to a different  
</I>&gt;<i> datastore.
</I>&gt;<i> 
</I>&gt;<i> so I blow it away like so
</I>&gt;<i> 
</I>&gt;<i> 	if (xmlString.Length != 0)
</I>&gt;<i> 		library.PopulateXMLString();
</I>&gt;<i> 
</I>&gt;<i> .. do stuff with the library contents
</I>&gt;<i> 
</I>&gt;<i> 	library = NULL;
</I>&gt;<i> 	GC.Collect();
</I>
Due to the way the current implementation of the GC and JIT works, this
doesn't have the effect of removing all the references to the library
object. A pattern that is much more likely to do it is to:

	void worker () {
		theType library = create_library ();
		library.PopulateXMLString ();
		// do something with library
	}

	void Main () {
		init ();
		worker ();
		GC.Collect ();
		do_something_else ();
	}

bacause in this case all references to library are in the stack frame of
the call to worker () and on return it is no more accessible.

&gt;<i> I should add this is really a deal breaker in terms of releasing the  
</I>&gt;<i> product, as you can imagine not releasing large amounts of memory is  
</I>&gt;<i> a big issue.
</I>
If it is a big issue you can likely file in bugzilla a complete test case
that we can use to reproduce the issue and eventually fix it. Until that
time it's hard for us to do anything to help you and consider that
USE_UNMAP may be of no help, depending on what the actual issue is
(which we can know only with a complete test).
Thanks.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">lupus at ximian.com</A>                             Monkeys do it better
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000821.html">[Mono-osx] [Mono-dev] OS X builds and -DUSE-MUNMAP
</A></li>
	<LI>Next message: <A HREF="000773.html">[Mono-osx] mkbundle error...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#811">[ date ]</a>
              <a href="thread.html#811">[ thread ]</a>
              <a href="subject.html#811">[ subject ]</a>
              <a href="author.html#811">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
