<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] Fwd:  (Solved) MonoMac bindings trouble
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=Re%3A%20%5BMono-osx%5D%20Fwd%3A%20%20%28Solved%29%20MonoMac%20bindings%20trouble&In-Reply-To=%3C664D6E25-7F7C-475B-AEAF-2C711D724841%40adaptiv.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004777.html">
   <LINK REL="Next"  HREF="004778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] Fwd:  (Solved) MonoMac bindings trouble</H1>
    <B>Raymond Reggers</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=Re%3A%20%5BMono-osx%5D%20Fwd%3A%20%20%28Solved%29%20MonoMac%20bindings%20trouble&In-Reply-To=%3C664D6E25-7F7C-475B-AEAF-2C711D724841%40adaptiv.nl%3E"
       TITLE="[Mono-osx] Fwd:  (Solved) MonoMac bindings trouble">raymond at adaptiv.nl
       </A><BR>
    <I>Thu Feb 23 20:25:48 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="004777.html">[Mono-osx] MonoMac bindings trouble
</A></li>
        <LI>Next message: <A HREF="004778.html">[Mono-osx] Adding a generic object list to combobox item list
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4806">[ date ]</a>
              <a href="thread.html#4806">[ thread ]</a>
              <a href="subject.html#4806">[ subject ]</a>
              <a href="author.html#4806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Solved the problem I was having.

In order to make my bindings work with the XCode xib editor, I extended and exported the bmac bindings from within the MonoMac project.  Vespertilio.Mac is my MonoMac solution, and Vespertilio.Presentation was generated by bmac.

namespace Vespertilio.Mac.Views
{
	[Register (&quot;TextView&quot;)]
	partial class TextView : Vespertilio.Presentation.TextView
	{
		public TextView(IntPtr handle) : base(handle)
		{
			
		}
	}
}

Now I can drag a custom view into the xib editor, change the class from NSView to TextView and bind it to my controller. However I'm still wondering why it won't work without this solution. 

Hope this helps anyone having similar problems.

I'm really starting to like MonoMac, a thank you to all the contributors!

Cheers,

Raymond

Begin forwarded message:

&gt;<i> From: Raymond Reggers &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">raymond at adaptiv.nl</A>&gt;
</I>&gt;<i> Subject: Re: [Mono-osx] MonoMac bindings trouble
</I>&gt;<i> Date: February 14, 2012 11:20:56 PM GMT+01:00
</I>&gt;<i> To: Duane Wandless &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">duane at wandless.net</A>&gt;
</I>&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">mono-osx at lists.ximian.com</A>
</I>&gt;<i> 
</I>&gt;<i> Ok I created the bindings by running this command on the file below:
</I>&gt;<i> 
</I>&gt;<i> mono bmac.exe ${ProjectDir}/Bindings/Vespertilio.Presentation.cs -r System.Drawing
</I>&gt;<i> 
</I>&gt;<i> using MonoMac.Foundation;
</I>&gt;<i> using MonoMac.AppKit;
</I>&gt;<i> 
</I>&gt;<i> namespace Vespertilio.Presentation {
</I>&gt;<i> 	
</I>&gt;<i> 	[BaseType(typeof(NSView))]
</I>&gt;<i> 	interface TextView
</I>&gt;<i> 	{
</I>&gt;<i> 		
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> And dlopen() is called before anything else, first line in Main(). The library gets loaded because I can see my custom view being displayed.
</I>&gt;<i> 
</I>&gt;<i> For example, I can do this (MainWindowController.cs):
</I>&gt;<i> 
</I>&gt;<i> public override void WindowDidLoad ()
</I>&gt;<i> {
</I>&gt;<i> 	base.WindowDidLoad();
</I>&gt;<i> 	Vespertilio.Presentation.TextView t = new Vespertilio.Presentation.TextView();
</I>&gt;<i> 	this.root.AddSubView(t);
</I>&gt;<i> 	t.setFrame(...
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> In this case root is simply a NSView with an outlet to MainWindowController.root.
</I>&gt;<i> 
</I>&gt;<i> BUT if I use interfacebuilder (well XCode now) and replace NSView with TextView and bind an outlet to MainWindowController.root. Then I get an InvalidCastException. If I remove the outlet, everything works and my custom view also shows. 
</I>&gt;<i> 
</I>&gt;<i> Hope this helps.
</I>&gt;<i> 
</I>&gt;<i> Thanks!
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Feb 14, 2012, at 8:26 PM, Duane Wandless wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> It might help if you show your bindings... and when did you call dlopen on the framework?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> dlopen(...
</I>&gt;&gt;<i> NSApplication.Init()
</I>&gt;&gt;<i> NSApplication.Main()
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Mon, Feb 13, 2012 at 9:14 PM, Raymond Reggers &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">raymond at adaptiv.nl</A>&gt; wrote:
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Got another question regarding bindings to my own obj-c classes, my situation and problem is like this:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> - I got an obj-c class named TextView which extends NSView, that I compiled into a Cocoa Framework.
</I>&gt;&gt;<i> - Loaded this Framework with Dlcfn.dlopen
</I>&gt;&gt;<i> - Created the bindings using bmac.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Now from c# I can create an instance from my TextView class, add it to an existing view. Works fine.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> But it seems my bindings do not work in a reverse manner. For example if I:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> - Add my TextView to MainWindow.xib using XCode.
</I>&gt;&gt;<i> - Create an outlet to MainWindowController.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> When launching the application, the TextView shows up correctly, but upon resolving the outlet I get a InvalidCastException (stacktrace below). So I tried something else:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> - Add my TextView into a NSView
</I>&gt;&gt;<i> - Create an outlet for the NSView (named it root)
</I>&gt;&gt;<i> - Access MainWindowController.root.Subviews[0]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> In the debugger this shows up as a NSView. And casting to TextView results in the same InvalidCastException. I must be doing something wrong with my bindings? Hope someone can help.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Kind regards,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Raymond
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Stacktrace:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> at (wrapper managed-to-native) object.__icall_wrapper_mono_object_castclass (object,intptr) &lt;0x00003&gt;
</I>&gt;&gt;<i> at MonoMac.ObjCRuntime.NSObjectMarshaler`1&lt;Vespertilio.Presentation.TextView&gt;.MarshalNativeToManaged (intptr) &lt;0x0004b&gt;
</I>&gt;&gt;<i> at (wrapper native-to-managed) object.[Vespertilio.Mac.MainWindowController.Void set_root(Vespertilio.Presentation.TextView)] (MonoMac.Foundation.NSObject,MonoMac.ObjCRuntime.Selector,Vespertilio.Presentation.TextView) &lt;IL 0x0004a, 0x001a0&gt;
</I>&gt;&gt;<i> at (wrapper managed-to-native) MonoMac.ObjCRuntime.Messaging.IntPtr_objc_msgSendSuper (intptr,intptr) &lt;0x00003&gt;
</I>&gt;&gt;<i> at MonoMac.AppKit.NSWindowController.get_Window () [0x0002b] in /Users/raymond/Documents/git/monomac/src/AppKit/NSWindowController.g.cs:371
</I>&gt;&gt;<i> at Vespertilio.Mac.MainWindowController.get_Window () [0x00000] in /Volumes/DATA/vespertilio/Vespertilio/Vespertilio.Mac/MainWindowController.cs:49
</I>&gt;&gt;<i> at Vespertilio.Mac.AppDelegate.FinishedLaunching (MonoMac.Foundation.NSObject) [0x0000b] in /Volumes/DATA/vespertilio/Vespertilio/Vespertilio.Mac/AppDelegate.cs:20
</I>&gt;&gt;<i> at (wrapper dynamic-method) object.[Vespertilio.Mac.AppDelegate.Void FinishedLaunching(MonoMac.Foundation.NSObject)] (MonoMac.Foundation.NSObject,MonoMac.ObjCRuntime.Selector,MonoMac.Foundation.NSObject) &lt;IL 0x00011, 0x00050&gt;
</I>&gt;&gt;<i> at (wrapper native-to-managed) object.[Vespertilio.Mac.AppDelegate.Void FinishedLaunching(MonoMac.Foundation.NSObject)] (MonoMac.Foundation.NSObject,MonoMac.ObjCRuntime.Selector,MonoMac.Foundation.NSObject) &lt;IL 0x0006a, 0x001fb&gt;
</I>&gt;&gt;<i> at (wrapper managed-to-native) MonoMac.AppKit.NSApplication.NSApplicationMain (int,string[]) &lt;0x00003&gt;
</I>&gt;&gt;<i> at MonoMac.AppKit.NSApplication.Main (string[]) [0x00000] in /Users/raymond/Documents/git/monomac/src/AppKit/NSApplication.cs:74
</I>&gt;&gt;<i> at Vespertilio.Mac.MainClass.Main (string[]) [0x0000f] in /Volumes/DATA/vespertilio/Vespertilio/Vespertilio.Mac/Main.cs:21
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-osx mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">Mono-osx at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">http://lists.ximian.com/mailman/listinfo/mono-osx</A>
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20120223/a3baa106/attachment-0001.html">http://lists.ximian.com/pipermail/mono-osx/attachments/20120223/a3baa106/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004777.html">[Mono-osx] MonoMac bindings trouble
</A></li>
	<LI>Next message: <A HREF="004778.html">[Mono-osx] Adding a generic object list to combobox item list
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4806">[ date ]</a>
              <a href="thread.html#4806">[ thread ]</a>
              <a href="subject.html#4806">[ subject ]</a>
              <a href="author.html#4806">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
