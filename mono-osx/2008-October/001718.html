<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] Invoke CIL/Managed Code from ObjC/XCode on Mac
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20Invoke%20CIL/Managed%20Code%20from%20ObjC/XCode%20on%20Mac&In-Reply-To=d57001c10810250622h181971c3w3e96e584af5da5d1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001697.html">
   <LINK REL="Next"  HREF="001731.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] Invoke CIL/Managed Code from ObjC/XCode on Mac</H1>
    <B>Kevin Heeney</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20Invoke%20CIL/Managed%20Code%20from%20ObjC/XCode%20on%20Mac&In-Reply-To=d57001c10810250622h181971c3w3e96e584af5da5d1%40mail.gmail.com"
       TITLE="[Mono-osx] Invoke CIL/Managed Code from ObjC/XCode on Mac">koheeney at gmail.com
       </A><BR>
    <I>Tue Oct 28 23:51:58 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001697.html">[Mono-osx] Invoke CIL/Managed Code from ObjC/XCode on Mac
</A></li>
        <LI>Next message: <A HREF="001731.html">[Mono-osx] Abort trap on ProcessName
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1718">[ date ]</a>
              <a href="thread.html#1718">[ thread ]</a>
              <a href="subject.html#1718">[ subject ]</a>
              <a href="author.html#1718">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you very much.  Between your post (Duane) and the post from  
Andreas (and the embed mono page at &lt;<A HREF="http://www.mono-project.com/">http://www.mono-project.com/</A> 
Embedding_Mono&gt;),  I have been able to successfully call my C#  
methods from ObjC in XCode as well as get return values from  
functions and values from public variables.  Now I am in the process  
of writing a couple of Objective-C wrapper classes to invoke methods  
in my C# classes.


Since I am doing my front end using Objective-C and my model in C#, I  
was going to write an Objective-C Wrapper generator in C# that would,  
via reflection, analyze my .NET classes and generate Objective-C code  
that I could use as wrappers to invoke those classes.  Atleast a  
simple version that would support primitive types.  Before I started  
on this, I wanted to see if anyone knows of something like this that  
has been done.  I have found plenty of ways to call Cocoa from C#,  
but I don't think I am aware of anything to go the other way.

Thanks again.
Kevin




On Oct 25, 2008, at 8:22 AM, Duane Wandless wrote:

&gt;<i> I will share what works for me.  First I use monobjc.  Great  
</I>&gt;<i> documentation.  Easy to use.  Well supported.   I am using the  
</I>&gt;<i> latest mono install 2.0, though this worked with 1.9 as well.  And  
</I>&gt;<i> I use Xcode 3.1.  I place my mono EXE in build/Debug/MyCocoa.app/ 
</I>&gt;<i> Content/Libraries, along with the Monobjc DLLs.  As you will see in  
</I>&gt;<i> the code (main.m) below, I load the EXE relative to the app bundle  
</I>&gt;<i> location.
</I>&gt;<i>
</I>&gt;<i> For me anyway I hit a bug in 2.0 that required me to load an EXE  
</I>&gt;<i> rather than a DLL.  In some ways the EXE is better.  I have a  
</I>&gt;<i> Program.cs (see below) that initializes the MonoObjc environment.   
</I>&gt;<i> It is important to load the MonoObjc environment prior to Cocoa  
</I>&gt;<i> setting up the IB references.  This way when the NIB file is loaded  
</I>&gt;<i> it will find your [ObjectiveCClass] references, see MainForm.cs  
</I>&gt;<i> below, which is snippets only.
</I>&gt;<i>
</I>&gt;<i> In my NIB file I have an object that has its class MonoMessage.  I  
</I>&gt;<i> hookup the array, tree, outline view, fields, etc to this object.   
</I>&gt;<i> At runtime they are hooked up to my mono class.  I have some objC  
</I>&gt;<i> code (MainDocument.m below) that sends messages to my mono class.   
</I>&gt;<i> And my mono class sends messages back to the objC world.
</I>&gt;<i>
</I>&gt;<i> We wanted the best of both worlds.  The power of C# and the ability  
</I>&gt;<i> to reuse the code on Mac and Windows.  But we also wanted the  
</I>&gt;<i> native build environment for the Leopard frontend.  So not only was  
</I>&gt;<i> using IB a requirement but so was writing the UI code in objC.   
</I>&gt;<i> Thanks to mono and monobjc we accomplished this with a very clean  
</I>&gt;<i> environment.
</I>&gt;<i>
</I>&gt;<i> You can also take the mono EXE and fully embed it within the cocoa  
</I>&gt;<i> app.  This way the end user is not required to install mono.  But  
</I>&gt;<i> that is a topic for a different thread.
</I>&gt;<i>
</I>&gt;<i> Other C Flags = -D_THREAD_SAFE -D_REENTRANT -I/Library/Frameworks/ 
</I>&gt;<i> Mono.framework/Versions/2.0/include/mono-1.0 -I/Library/Frameworks/ 
</I>&gt;<i> Mono.framework/Versions/2.0/include/glib-2.0 -I/Library/Frameworks/ 
</I>&gt;<i> Mono.framework/Versions/2.0/lib/glib-2.0/include
</I>&gt;<i> Other C++ Flags = $(OTHER_CFLAGS)
</I>&gt;<i> OTHER_LDFLAGS = -pthread -L/Library/Frameworks/Mono.framework/ 
</I>&gt;<i> Versions/Current/lib -lmono -lpthread -lm -lgthread-2.0 -lglib-2.0 - 
</I>&gt;<i> lintl <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">-rpath at loader_path</A>/../Libraries
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> main.m:
</I>&gt;<i> #import &lt;Cocoa/Cocoa.h&gt;
</I>&gt;<i> #include &lt;mono/jit/jit.h&gt;
</I>&gt;<i> #include &lt;mono/metadata/assembly.h&gt;
</I>&gt;<i> #include &lt;mono/metadata/mono-config.h&gt;
</I>&gt;<i>
</I>&gt;<i> int main(int argc, char *argv[])
</I>&gt;<i> {
</I>&gt;<i>     NSAutoreleasePool *pool;
</I>&gt;<i>     pool = [[NSAutoreleasePool alloc] init];
</I>&gt;<i>
</I>&gt;<i>     MonoDomain *domain;
</I>&gt;<i>     NSString *libraryPath = [[[NSBundle mainBundle] bundlePath]  
</I>&gt;<i> stringByAppendingPathComponent:@&quot;Contents/Libraries&quot;];
</I>&gt;<i>     NSString *sampleAssemblyPath = [libraryPath  
</I>&gt;<i> stringByAppendingPathComponent:@&quot;MacMonoClient.exe&quot;];
</I>&gt;<i>     NSLog(@&quot;libraryPath: %@&quot;, sampleAssemblyPath);
</I>&gt;<i>     mono_config_parse (&quot;config&quot;);
</I>&gt;<i>     domain = mono_jit_init ([sampleAssemblyPath UTF8String]);
</I>&gt;<i>     MonoAssembly *monoAssembly = mono_domain_assembly_open(domain,  
</I>&gt;<i> [sampleAssemblyPath UTF8String]);
</I>&gt;<i>     mono_jit_exec (domain, monoAssembly, 1, argv);
</I>&gt;<i>     NSLog(@&quot;sample assembly: %p&quot;, monoAssembly);
</I>&gt;<i>     [pool release];
</I>&gt;<i>
</I>&gt;<i>     return NSApplicationMain(argc, (const char **) argv);
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> Program.cs:
</I>&gt;<i> using System;
</I>&gt;<i> using Monobjc;
</I>&gt;<i> using Monobjc.Cocoa;
</I>&gt;<i>
</I>&gt;<i> namespace MacClient
</I>&gt;<i> {
</I>&gt;<i>     static class Program
</I>&gt;<i>     {
</I>&gt;<i>        public static void Main()
</I>&gt;<i>        {
</I>&gt;<i>             ObjectiveCRuntime.LoadFramework(&quot;Cocoa&quot;);
</I>&gt;<i>             ObjectiveCRuntime.LoadFramework(&quot;QTKit&quot;);
</I>&gt;<i>             ObjectiveCRuntime.Initialize();
</I>&gt;<i>        }
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> MainForm.cs:
</I>&gt;<i> using System;
</I>&gt;<i> using Monobjc;
</I>&gt;<i> using Monobjc.Cocoa;
</I>&gt;<i> using Monobjc.QuickTime;
</I>&gt;<i>
</I>&gt;<i> namespace MacClient
</I>&gt;<i> {
</I>&gt;<i>     [ObjectiveCClass(&quot;MonoMessage&quot;)]
</I>&gt;<i>     public class MyControl : NSObject
</I>&gt;<i>     {
</I>&gt;<i>         private static readonly Class ControllerClass =  
</I>&gt;<i> Class.GetClassFromType(typeof(MyControl));
</I>&gt;<i>
</I>&gt;<i>         public MyControl() { }
</I>&gt;<i>         public MyControl(IntPtr np) : base(np) { }
</I>&gt;<i>
</I>&gt;<i>         NSAutoreleasePool pool = new NSAutoreleasePool();
</I>&gt;<i>         ~MyControl()
</I>&gt;<i>         {
</I>&gt;<i>             pool.Drain();
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>         [ObjectiveCField]
</I>&gt;<i>         public NSArrayController projectsController;
</I>&gt;<i>         [ObjectiveCField(&quot;itemsController&quot;)]
</I>&gt;<i>         public NSTreeController folderContent;
</I>&gt;<i>         [ObjectiveCField]
</I>&gt;<i>         public NSOutlineView folderOutline;
</I>&gt;<i>
</I>&gt;<i>         [ObjectiveCMessage(&quot;init&quot;)]
</I>&gt;<i>         public override Id Init()
</I>&gt;<i>         {
</I>&gt;<i>             ObjectiveCRuntime.SendMessageSuper&lt;IntPtr&gt;(this,  
</I>&gt;<i> ControllerClass, &quot;init&quot;);
</I>&gt;<i>              
</I>&gt;<i> NSNotificationCenter.DefaultCenter.AddObserverSelectorNameObject 
</I>&gt;<i> (this, ObjectiveCRuntime.Selector(&quot;doAuth:&quot;), &quot;doAuth&quot;, null);
</I>&gt;<i>                  }
</I>&gt;<i>         [ObjectiveCMessage(&quot;awakeFromNib&quot;)]
</I>&gt;<i>         public void awakeFromNib()
</I>&gt;<i>         {
</I>&gt;<i>         }
</I>&gt;<i>         [ObjectiveCMessage(&quot;doAuth:&quot;)]
</I>&gt;<i>         public void SelectionChanged(NSNotification notification)
</I>&gt;<i>         {
</I>&gt;<i>             NSArray loginParms = notification.UserInfo.ObjectForKey 
</I>&gt;<i> (new NSString(&quot;params&quot;)).CastTo&lt;NSArray&gt;();
</I>&gt;<i>             Login(loginParms[0].CastTo&lt;NSString&gt;(), loginParms 
</I>&gt;<i> [1].CastTo&lt;NSString&gt;());
</I>&gt;<i>         }
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> MainDocument.m
</I>&gt;<i> - (IBAction)login:(id)sender
</I>&gt;<i> {
</I>&gt;<i>     NSLog(@&quot;Starting login process...&quot;);
</I>&gt;<i>
</I>&gt;<i>     NSString *username = [usernameTextField stringValue];
</I>&gt;<i>     NSString *password = [passwordTextField stringValue];
</I>&gt;<i>
</I>&gt;<i>     NSArray *loginParams = [NSArray arrayWithObjects:username,  
</I>&gt;<i> password, nil];
</I>&gt;<i>     NSDictionary* dict =  [NSDictionary  
</I>&gt;<i> dictionaryWithObject:loginParams forKey:@&quot;params&quot;];
</I>&gt;<i>     NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
</I>&gt;<i>     [nc postNotificationName:@&quot;doAuth&quot; object:nil userInfo:dict];
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> On Fri, Oct 24, 2008 at 10:13 PM, Kevin Heeney &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">koheeney at gmail.com</A>&gt;  
</I>&gt;<i> wrote:
</I>&gt;<i>    I think I have hit a wall.  I am fairly new to mono on mac;  
</I>&gt;<i> however am familiar with .NET and Objc/Cocoa.  I am unable to  
</I>&gt;<i> successfully 'embed mono' or call methods from my Mono dll in  
</I>&gt;<i> ObjC.  I have created a UI using Interface Builder and have my App  
</I>&gt;<i> Controller in ObjC ready to call my C# dll which contains my  
</I>&gt;<i> logic.  Cocoa# and ObjCSharp both claim to be 2 way bridges;  
</I>&gt;<i> however I can only find code for calling Cocoa from C# and not the  
</I>&gt;<i> other way around.  In addition, I cannot get the samples from  
</I>&gt;<i> &lt;<A HREF="http://www.mono-project.com/Embedding_Mono">http://www.mono-project.com/Embedding_Mono</A>&gt; on Embedding Mono to  
</I>&gt;<i> work in XCode.  My actual issue with the latter is I cannot get  
</I>&gt;<i> XCode to link to the mono framework.  I am getting errors like  
</I>&gt;<i> &quot;main.c:1: error: mono/jit/jit.h: No such file or directory&quot;.
</I>&gt;<i>    I am not sure what I am missing; it may be simple.
</I>&gt;<i>
</I>&gt;<i> Any guidance would be appreciated.
</I>&gt;<i> Thanks,
</I>&gt;<i> Kevin
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-osx mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">Mono-osx at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">http://lists.ximian.com/mailman/listinfo/mono-osx</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20081028/9c2cafbd/attachment.html">http://lists.ximian.com/pipermail/mono-osx/attachments/20081028/9c2cafbd/attachment.html</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001697.html">[Mono-osx] Invoke CIL/Managed Code from ObjC/XCode on Mac
</A></li>
	<LI>Next message: <A HREF="001731.html">[Mono-osx] Abort trap on ProcessName
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1718">[ date ]</a>
              <a href="thread.html#1718">[ thread ]</a>
              <a href="subject.html#1718">[ subject ]</a>
              <a href="author.html#1718">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
