<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] MonoMac parser.cs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20MonoMac%20parser.cs&In-Reply-To=t2rd57001c11004200631q9ce62456lf358e21619694f15%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002822.html">
   <LINK REL="Next"  HREF="002828.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] MonoMac parser.cs</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20MonoMac%20parser.cs&In-Reply-To=t2rd57001c11004200631q9ce62456lf358e21619694f15%40mail.gmail.com"
       TITLE="[Mono-osx] MonoMac parser.cs">miguel at novell.com
       </A><BR>
    <I>Tue Apr 20 10:03:36 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002822.html">[Mono-osx] MonoMac parser.cs
</A></li>
        <LI>Next message: <A HREF="002828.html">[Mono-osx] MonoMac parser.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2827">[ date ]</a>
              <a href="thread.html#2827">[ thread ]</a>
              <a href="subject.html#2827">[ subject ]</a>
              <a href="author.html#2827">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Duane,

I have taken parser.cs and extended it to handle categories.  To start I
&gt;<i> tested parsing NSArray.h.  This produced NSArray.cs and NSMutableArray.cs.
</I>&gt;<i> I have &quot;full&quot; bindings for these obj-c classes.
</I>&gt;<i>
</I>
We do not currently support a mapping to categories as they do not really
have a counter part in C#.

They are *similar* to interfaces, but they can be interfaces with optional
components so there is no direct mapping to them.

For the delegate pattern we settled on classes that have been labeled as
&quot;Models&quot; (read more about that on our binding page).

NSMutableArray:  <A HREF="http://monobin.com/__m335d328c">http://monobin.com/__m335d328c</A>
&gt;<i> NSArray:  <A HREF="http://monobin.com/__m36c66b6e">http://monobin.com/__m36c66b6e</A>
</I>

Nice.  For the particular case of Foundation, we have taken an approach to
only bind what is actually *required* as opposed to binding everything.
Many bits from Foundation make sense for Objective-C programmers as they are
dealing with a low-level language and are redundant with C#.

In the particular case of NSArray and NSMutableArray our runtime has been
extended to natively convert NSArrays to C# arrays and back so the only code
that we bound is the required interop code for NSArray.

So we suggest to work instead on the AppKit bindings.

However not all the bindings generated are valid.  For example I do not know
&gt;<i> how to generate a binding for this selector (note I do not use this
</I>&gt;<i> selector, just an example):
</I>&gt;<i> - (void)sortUsingFunction:(NSInteger (*)(id, id, void *))compare
</I>&gt;<i> context:(void *)context;
</I>&gt;<i>
</I>
Correct, the parser does the heavy lifting, but requires human intervention
to fix the output.

&gt;<i>
</I>&gt;<i> Then comes the question of constructors.  Take these two (the 2nd is not
</I>&gt;<i> really a constructor I know) from NSMutableArray for example:
</I>&gt;<i> + (id)arrayWithCapacity:(NSUInteger)numItems;
</I>&gt;<i> - (id)initWithCapacity:(NSUInteger)numItems;
</I>&gt;<i>
</I>&gt;<i> My parser exposes these as:
</I>&gt;<i>
</I>&gt;<i>         [Static]
</I>&gt;<i>         [Export (&quot;arrayWithCapacity:&quot;)]
</I>&gt;<i>         IntPtr ArrayWithCapacity (uint numItems);
</I>&gt;<i>
</I>&gt;<i>         [Export (&quot;initWithCapacity:&quot;)]
</I>&gt;<i>         IntPtr InitWithCapacity (uint numItems);
</I>&gt;<i>
</I>
This is a great question.

Factory methods should be declared as static methods, and we *typically* use
the FromXXXX or CreateXXX naming pattern for them, so the above would look
like this:

[Static, Export (&quot;arrayWithCapacity:&quot;)]
NSArray CreateArray (int items);

Notice that I took the liberty of changing the uint to int because that
makes the method CLS compliant.

In this case it is a debatable change as there could be arrays with more
than 2 gig elements, but in many other places in the API this is not the
case, uint has been used to get an extra bit that is not required.

So how can we support the extra 2 gigs of elements while still allowing
other languages the most common use case?  We keep the signature as it was
originally produced, and introduce a new overload:

[Static, Export (&quot;arrayWithCapacity:&quot;)]
NSArray CreateArray (uint items);

And then on a helper class in Foundation/NSArray.cs we would do:

partial class NSArray {
     static NSArray CreateArray (int items){
          if (items &lt; 0) throw new ArgumentException ();
          return CreateArray ((uint) items);
     }
}

Now to the second question:

First I do not think returning an IntPtr is correct.  It should return
&gt;<i> NSMutableArray.  But IntPtr follows what was started with MT.  Returning an
</I>&gt;<i> IntPtr will require calling GetNSObject which seems cumbersome.  Unless I'm
</I>&gt;<i> missing something.
</I>&gt;<i>
</I>
In the specific case of *constructors*  the binding generator recognizes the
pattern:

IntPtr Constructor (ARGS)

As being the constructor for the class.   This is required because
constructors generate different code than regular method bindings.

So you will see in all of our APIs that we expose that pattern, but that
this is never translated into an actual exposed IntPtr, it is always
translated into the correct method name.

Miguel.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20100420/c220c8aa/attachment-0001.html">http://lists.ximian.com/pipermail/mono-osx/attachments/20100420/c220c8aa/attachment-0001.html</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002822.html">[Mono-osx] MonoMac parser.cs
</A></li>
	<LI>Next message: <A HREF="002828.html">[Mono-osx] MonoMac parser.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2827">[ date ]</a>
              <a href="thread.html#2827">[ thread ]</a>
              <a href="subject.html#2827">[ subject ]</a>
              <a href="author.html#2827">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
