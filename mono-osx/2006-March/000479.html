<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] Universal Binary support for mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20Universal%20Binary%20support%20for%20mono&In-Reply-To=A4B17660-B74E-4DE3-AE79-733425DE8B64%40imeem.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000478.html">
   <LINK REL="Next"  HREF="000482.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] Universal Binary support for mono</H1>
    <B>Wade Berrier</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20Universal%20Binary%20support%20for%20mono&In-Reply-To=A4B17660-B74E-4DE3-AE79-733425DE8B64%40imeem.com"
       TITLE="[Mono-osx] Universal Binary support for mono">wberrier at novell.com
       </A><BR>
    <I>Tue Mar 28 15:52:53 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000478.html">[Mono-osx] Universal Binary support for mono
</A></li>
        <LI>Next message: <A HREF="000482.html">[Mono-osx] Universal Binary support for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#479">[ date ]</a>
              <a href="thread.html#479">[ thread ]</a>
              <a href="subject.html#479">[ subject ]</a>
              <a href="author.html#479">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Bryan,

Great work!  Here's how I'd suggest we proceed.

Let's try to get the newer build system running on your box.  I run all
the builds remotely, but I've been planning on enabling the system to
run locally.  Just haven't gotten there yet...

Make sure you check out the whole release module from svn.  Then, edit
release/packaging/conf/macos-10-ppc:  change target_host to:

target_host=localhost

Then, you'll have to set up ssh authorized_keys for your user to be able
to connect to the local machine without a password.  (Yeah, this is
kinda dumb, and that's what I mentioned above about fixing.  It's just
that I use all of these scripts to run all the builds for all the
platforms).

The other thing about my build system is that I use the linux noarch
rpms in the installers (mac, win32, and solaris).  This is so I don't
have to rebuild them all the time for each platform.  For now, you can
edit the new mac build script (packages_to_include) to only contain
mono-1.1.

Also, another thing, with the new mac build, I don't rebuild all deps
each time.  The new scripts will relocate them...  hmm... I'm hoping
install_name_tool and otool will work with fat binaries?

But, assuming it does work, we could just build the glib and the other
needed libraries once and post those builds as zipped up libraries.
(Look in release/packaging/defs/mono-1.1 under the macos-10-ppc sections
for what zip files I've posted and what I download each time).

Then, I think that the appropriate autotools magic needs to happen in
the mono build to take care of the changes.  We could do the patch each
time initially, but it'd be better to get it into HEAD.  But, if we do
the patching, the actual build is also listed in
release/packaging/defs/mono-1.1 under macos_10_ppc_ZIP_BUILD.  We would
probably just download the patches with wget from there and patch before
running ./configure, etc...

So, then we'd run ./build from release/packaging .  An example would be:

/build macos-10-ppc mono-1.1 1.1.13.4

Then the new mac build script simply takes files that were built
with ./build (or that are in the def file to be downloaded), lays them
down, and runs the necessary scripts to create the installer.

So, let's first try getting the new system working on your box.  It
hasn't really been used outside of my build machine.  But, I'm on IRC
(wberrier) and we should be able to get it up and running pretty
quickly.

Wade


On Thu, 2006-03-23 at 20:04 -0800, Bryan Berg wrote:
&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I'm pleased to share some work I've been doing on creating a
</I>&gt;<i> Universal Binary version of the Mono framework.  Attached is a set
</I>&gt;<i> of patches and shell scripts that will build Mono, its dependancies,
</I>&gt;<i> and related packages Universal. They do not build an installer yet
</I>&gt;<i> (though could be capable of doing so...  for some reason it just
</I>&gt;<i> doesn't seem to work.)
</I>&gt;<i> 
</I>&gt;<i> The scripts are available for download here:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.strangecargo.org/~bdb/mono/universal/build-20060323.tar.gz">http://www.strangecargo.org/~bdb/mono/universal/build-20060323.tar.gz</A>
</I>&gt;<i> 
</I>&gt;<i> They are modeled off of the older shell-script based build system.  I
</I>&gt;<i> wasn't able to easily get the newer build system to work properly, and
</I>&gt;<i> when I started, I wasn't even sure if this was possible, so I figured
</I>&gt;<i> I'd try to make some serious progress before attempting to integrate
</I>&gt;<i> with the newer build system.  I would be happy to help and/or take on
</I>&gt;<i> the work required to get Universal building into the upstream mono
</I>&gt;<i> builds, if I can get some guidance from Wade or someone who's worked
</I>&gt;<i> directly with it.
</I>&gt;<i> 
</I>&gt;<i> There are some important caveats:
</I>&gt;<i> 
</I>&gt;<i>    * First, there are new patches to both glib and mono to get them to
</I>&gt;<i>    cross-compile correctly.  libjpeg is also patched but was patched
</I>&gt;<i>    before as well.  The new patches largely remove AC_TRY_RUN from
</I>&gt;<i>    autoconf scripts.
</I>&gt;<i> 
</I>&gt;<i>      * mono: hardcode enabling of LARGE_FILE support.
</I>&gt;<i>      * mono: hardcode check for sizeof(sockaddr_un.sun_path) to be 104,
</I>&gt;<i>      my empirically discovered value on 10.4.5.
</I>&gt;<i>      * mono: remove $(LDFLAGS) from monoburg's build, because they
</I>&gt;<i>      contain cross-compile-specific stuff and monoburg runs at compile
</I>&gt;<i>      time.
</I>&gt;<i> 
</I>&gt;<i>      None of these are particularly good things to hard code, and we
</I>&gt;<i>      should almost certainly come up with a more permanent solution to
</I>&gt;<i>      them.
</I>&gt;<i> 
</I>&gt;<i>    * This script builds mono twice and mcs once, and uses genmdesc
</I>&gt;<i>    built on the native arch to create the cpu-*.h files for the
</I>&gt;<i>    non-native architectures.  Zoltan committed a patch to
</I>&gt;<i>    mini/mini-ops.h (r57962) which effectively broke the universal
</I>&gt;<i>    build.  I spoke with him on IRC and he said I could safely revert
</I>&gt;<i>    that file to r57961 and the build would work (which it did.)
</I>&gt;<i> 
</I>&gt;<i>    * The glib build generates an architecture-specific glibconfig.h
</I>&gt;<i>    file, and the build scripts split it into i386/ppc versions and
</I>&gt;<i>    then create an placeholder file that loads the correct
</I>&gt;<i>    architecture version at compile-time.
</I>&gt;<i> 
</I>&gt;<i>    * There is still an X11 dependancy -- make sure you have X11
</I>&gt;<i>    installed when you compile.
</I>&gt;<i> 
</I>&gt;<i>    * I've tested the script building on both i386 and ppc, so either
</I>&gt;<i>    platform should be able to build a fully universal mono.
</I>&gt;<i> 
</I>&gt;<i> I would love, love, love to see the 1.2 release end up as a universal
</I>&gt;<i> release, 1.1.14 (if there is one) would be even better!  As I said,
</I>&gt;<i> I'm very willing to do any integration work necessary.
</I>&gt;<i> 
</I>&gt;<i> If anyone gives this building a shot, let me know--also, if you have
</I>&gt;<i> any comments on the mono build patches (which are probably not
</I>&gt;<i> mainline appropriate) please let me know!
</I>&gt;<i> 
</I>&gt;<i> -Bryan
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20060328/2e635e3d/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-osx/attachments/20060328/2e635e3d/attachment-0001.bin</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000478.html">[Mono-osx] Universal Binary support for mono
</A></li>
	<LI>Next message: <A HREF="000482.html">[Mono-osx] Universal Binary support for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#479">[ date ]</a>
              <a href="thread.html#479">[ thread ]</a>
              <a href="subject.html#479">[ subject ]</a>
              <a href="author.html#479">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
