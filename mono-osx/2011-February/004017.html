<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] [MonoMac] OpenGL OpenTK proposal / compromise
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoMac%5D%20OpenGL%20OpenTK%20proposal%20/%20compromise&In-Reply-To=4D57EF1E.5050401%40pt.lu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004013.html">
   <LINK REL="Next"  HREF="004018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] [MonoMac] OpenGL OpenTK proposal / compromise</H1>
    <B>Geoff Norton</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoMac%5D%20OpenGL%20OpenTK%20proposal%20/%20compromise&In-Reply-To=4D57EF1E.5050401%40pt.lu"
       TITLE="[Mono-osx] [MonoMac] OpenGL OpenTK proposal / compromise">gnorton at novell.com
       </A><BR>
    <I>Mon Feb 14 12:07:13 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004013.html">[Mono-osx] [MonoMac] OpenGL OpenTK proposal / compromise
</A></li>
        <LI>Next message: <A HREF="004018.html">[Mono-osx] [MonoMac] OpenGL OpenTK proposal / compromise
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4017">[ date ]</a>
              <a href="thread.html#4017">[ thread ]</a>
              <a href="subject.html#4017">[ subject ]</a>
              <a href="author.html#4017">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Kenneth,

  I'd like to see this code.  I have a opentk repo on github:

<A HREF="http://github.com/kangaroo/opentk">http://github.com/kangaroo/opentk</A>

Could you fork it and land your patches?

Thanks

-g

On 2011-02-13, at 9:47 AM, kjpou wrote:

&gt;<i> Hello all
</I>&gt;<i> 
</I>&gt;<i> Have spent the last two days working on the OpenTK.  Ended in 
</I>&gt;<i> frustration basically.
</I>&gt;<i> 
</I>&gt;<i> Here is what I have:
</I>&gt;<i> 
</I>&gt;<i> OpenTK.Graphics.CoreOpenGL
</I>&gt;<i> 
</I>&gt;<i> Basically all the mappings, delegates, helper methods, ErrorHelper.  It 
</I>&gt;<i> was a copy from the windows OpenTK.Graphics.OpenGL.  The bindings are 
</I>&gt;<i> all there and can load them all from a CglContext which is a new 
</I>&gt;<i> Platform backend OpenGL context I created.
</I>&gt;<i> 
</I>&gt;<i> There are something like 2700 method bindings that are delivered with 
</I>&gt;<i> the Windows OpenGL implementation of which only about 600 are used on 
</I>&gt;<i> the mac.
</I>&gt;<i> 
</I>&gt;<i> I have a platform backend hacked together.  When I say hacked I mean 
</I>&gt;<i> hacked but it all loads fine.  No GUI implementation as it uses the 
</I>&gt;<i> current context created from NSOpenGLContext.  That part works.
</I>&gt;<i> 
</I>&gt;<i> OpenTK.Platform.MacOS
</I>&gt;<i> 
</I>&gt;<i> -&gt; CocoaBindings
</I>&gt;<i> ---&gt; Cgl
</I>&gt;<i> 
</I>&gt;<i> -&gt; CglContext
</I>&gt;<i> -&gt; CocoaApplication
</I>&gt;<i> -&gt; CocoaGLNative
</I>&gt;<i> -&gt; CocoaWindowInfo
</I>&gt;<i> 
</I>&gt;<i> You can create a context.
</I>&gt;<i> 
</I>&gt;<i>                         OpenTK.Platform.IWindowInfo windowInfo
</I>&gt;<i>                                 = 
</I>&gt;<i> OpenTK.Platform.Utilities.CreateMacOSCocoaWindowInfo( mGLContext.Handle );
</I>&gt;<i> 
</I>&gt;<i>                         OpenTK.ContextHandle handle = new 
</I>&gt;<i> OpenTK.ContextHandle( mGLContext.Handle );
</I>&gt;<i> 
</I>&gt;<i>                         OpenTK.Graphics.GraphicsContext context =
</I>&gt;<i>                                 new 
</I>&gt;<i> OpenTK.Graphics.GraphicsContext(handle, windowInfo);
</I>&gt;<i> 
</I>&gt;<i>                        context.MakeCurrent( windowInfo );
</I>&gt;<i> 
</I>&gt;<i> When it starts calling the Delegates for example.
</I>&gt;<i> 
</I>&gt;<i>                         ErrorCode theError = ErrorCode.NoError;
</I>&gt;<i>                         theError = GL.GetError ();
</I>&gt;<i>                         GL.ReadBuffer (ReadBufferMode.Front);
</I>&gt;<i> 
</I>&gt;<i> It is erroring out with errors for the native bindings which I can not 
</I>&gt;<i> figure out because of the all the Delegate calls.  If you call the 
</I>&gt;<i> GLCore methods directly it all works fine but using the OpenTK Delegate 
</I>&gt;<i> way it is not working.
</I>&gt;<i> 
</I>&gt;<i> If someone wants to take what I have and try to get it all working you 
</I>&gt;<i> are more than welcome.  Either way those 600 +/- OpenGL calls are going 
</I>&gt;<i> to have to be gone through and culled out.
</I>&gt;<i> 
</I>&gt;<i> In about one hour I ripped all the mappings from the OpenTK for Cocoa 
</I>&gt;<i> that I wrote and placed them in a separate project with some small 
</I>&gt;<i> modifications and got two MonoMac OpenGL samples working.  One hour vs 
</I>&gt;<i> two days hummmm really a no brainer there for where I would prefer to 
</I>&gt;<i> spend my time.
</I>&gt;<i> 
</I>&gt;<i> I am in the process of going through by hand and only implementing those 
</I>&gt;<i> 600 or so methods by hand to get a MonoMac.CoreOpenGL bindings working 
</I>&gt;<i> based on that one hours work.  Basing it on what I learned from the 
</I>&gt;<i> OpenTK I can have it mapping exactly the same way so if someone gets the 
</I>&gt;<i> OpenTK working it should be just a change of library.  What I mean by 
</I>&gt;<i> that is that all one would have to do to use the OpenTK is include it in 
</I>&gt;<i> the project because the naming of the parameters will be exactly the 
</I>&gt;<i> same as those you will already be using for the MonoMac.CoreOpenGL bindings.
</I>&gt;<i> 
</I>&gt;<i> So the following code below would work with OpenTK as well as the 
</I>&gt;<i> MonoMac.CoreOpenGL bindings.  Technically the same code would work for 
</I>&gt;<i> any other OpenTK based program as well.
</I>&gt;<i> 
</I>&gt;<i>                         ErrorCode theError = ErrorCode.NoError;
</I>&gt;<i> 
</I>&gt;<i>                         // select front buffer as our source for pixel data
</I>&gt;<i>                         GL.ReadBuffer (ReadBufferMode.Front);
</I>&gt;<i> 
</I>&gt;<i>                         //Read OpenGL context pixels directly.
</I>&gt;<i> 
</I>&gt;<i>                         // For extra safety, save &amp; restore OpenGL 
</I>&gt;<i> states that are changed
</I>&gt;<i>                         GL.PushClientAttrib 
</I>&gt;<i> (ClientAttribMask.ClientPixelStoreBit);
</I>&gt;<i> 
</I>&gt;<i>                         GL.PixelStore 
</I>&gt;<i> (PixelStoreParameter.PackAlignment, 4); /* Force 4-byte alignment */
</I>&gt;<i>                         GL.PixelStore 
</I>&gt;<i> (PixelStoreParameter.PackRowLength, 0);
</I>&gt;<i>                         GL.PixelStore 
</I>&gt;<i> (PixelStoreParameter.PackSkipRows, 0);
</I>&gt;<i>                         GL.PixelStore 
</I>&gt;<i> (PixelStoreParameter.PackSkipPixels, 0);
</I>&gt;<i>                         // Read a block of pixels from the frame buffer
</I>&gt;<i>                         GL.ReadPixels (0, 0, bufferWidth, bufferHeight, 
</I>&gt;<i> PixelFormat.Bgra, PixelType.UnsignedInt8888Reversed, buffer);
</I>&gt;<i> 
</I>&gt;<i>                         GL.PopClientAttrib ();
</I>&gt;<i> 
</I>&gt;<i>                         theError = GL.GetError ();
</I>&gt;<i>                         if (theError != ErrorCode.NoError)
</I>&gt;<i>                                 Console.WriteLine (&quot;OpenGL error {0}&quot;, 
</I>&gt;<i> theError);
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Now before I go through with this would like to know if this is an 
</I>&gt;<i> acceptable compromise and would it be worth the effort to be included 
</I>&gt;<i> within the MonoMac bindings.
</I>&gt;<i> 
</I>&gt;<i> If you want the code that I have begun for OpenTK let me know.
</I>&gt;<i> 
</I>&gt;<i> Kenneth
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-osx mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">Mono-osx at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">http://lists.ximian.com/mailman/listinfo/mono-osx</A>
</I>
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004013.html">[Mono-osx] [MonoMac] OpenGL OpenTK proposal / compromise
</A></li>
	<LI>Next message: <A HREF="004018.html">[Mono-osx] [MonoMac] OpenGL OpenTK proposal / compromise
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4017">[ date ]</a>
              <a href="thread.html#4017">[ thread ]</a>
              <a href="subject.html#4017">[ subject ]</a>
              <a href="author.html#4017">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
