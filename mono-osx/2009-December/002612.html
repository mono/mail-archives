<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] [MonoDevelop]  Debug embedded OSX app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoDevelop%5D%20%20Debug%20embedded%20OSX%20app&In-Reply-To=4ff6082e0912140555m66e5440bk936d927b2ab94eb1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002611.html">
   <LINK REL="Next"  HREF="002610.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] [MonoDevelop]  Debug embedded OSX app</H1>
    <B>Duane Wandless</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20%5BMonoDevelop%5D%20%20Debug%20embedded%20OSX%20app&In-Reply-To=4ff6082e0912140555m66e5440bk936d927b2ab94eb1%40mail.gmail.com"
       TITLE="[Mono-osx] [MonoDevelop]  Debug embedded OSX app">duane at wandless.net
       </A><BR>
    <I>Mon Dec 14 10:09:50 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002611.html">[Mono-osx] [MonoDevelop]  Debug embedded OSX app
</A></li>
        <LI>Next message: <A HREF="002610.html">[Mono-osx] Call for Talks - FOSDEM 2010 (Mono devroom)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2612">[ date ]</a>
              <a href="thread.html#2612">[ thread ]</a>
              <a href="subject.html#2612">[ subject ]</a>
              <a href="author.html#2612">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The box.net file is my project to create the 2 addins required to enable
debugging an embedded application using MD 2.2RC and Mono 2.6RC.

IMPORTANT:  For some reason only right clicking in the Solution explorer and
selecting Debug Item works.  I did not even attempt to investigate this.  In
other words the menu items Run | Debug and Run | Run do not work.  And right
clicking in the solution explorer and selecting Run Item does not work
either.

<A HREF="http://www.box.net/shared/lskor4zxgc">http://www.box.net/shared/lskor4zxgc</A>

You must edit EmbeddedSoftDebuggerSession.cs and change this line:
var psi = new ProcessStartInfo (&quot;open&quot;, &quot;&lt;full path to your&gt;.app&quot;)

Then build both projects.  Then from the command line go into the repos
directory and type:
./clean
./docopy

This will create a MD addin repository in the directory three.

Then go to MD and click Tools | Addin Manager.  Click Repositories.  Click
Add.  Check Register a local repository.  Select the directory three.  Click
Install Addins.  At this point you should have two options.  Debugging and
Embedded.  Install both.  Restart MD.

Create a new project and select EmbeddedProject.  You can change this to be
a DLL or EXE based on how you are embedding.

You can modify an existing project (at least this worked for me) to be an
EmbeddedProject by editing the csproj file directly.  Add this line after
the &lt;ProjectGuid&gt; entry:

 &lt;ProjectTypeGuids&gt;{84408980-E7F5-11DE-B313-B87456D89593};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}&lt;/ProjectTypeGuids&gt;

Best of luck!
Duane

On Mon, Dec 14, 2009 at 8:55 AM, ptr &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">ptrajkumar at gmail.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sat, Dec 12, 2009 at 11:55 AM, Duane Wandless &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">duane at wandless.net</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Here is my create process code.  Is this the code in question?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                         Process browser;
</I>&gt;&gt;<i> var psi = new ProcessStartInfo (&quot;open&quot;,
</I>&gt;&gt;<i> &quot;/Users/me/Src/sandbox/nov05/svn/working/PFiles/build/Debug/PFiles.app&quot;) {
</I>&gt;&gt;<i>  UseShellExecute = false,
</I>&gt;&gt;<i> RedirectStandardOutput = false,
</I>&gt;&gt;<i> RedirectStandardError = true,
</I>&gt;&gt;<i>  };
</I>&gt;&gt;<i> psi.EnvironmentVariables.Add (&quot;MOON_SOFT_DEBUG&quot;,
</I>&gt;&gt;<i> string.Format (&quot;transport=dt_socket,address={0}:{1}&quot;, dsi.Address,
</I>&gt;&gt;<i> dsi.DebugPort));
</I>&gt;&gt;<i>  browser = Process.Start (psi);
</I>&gt;&gt;<i> ConnectOutput (browser.StandardOutput, false);
</I>&gt;&gt;<i>  ConnectOutput (browser.StandardError, true);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I did modify the Waiting for debugger to connect message to print out both
</I>&gt;&gt;<i> DebugPort and OutputPort.  OutputPort is zero.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> protected override string GetListenMessage (RemoteDebuggerStartInfo dsi)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>  return string.Format(&quot;Waiting for debugger to connect at
</I>&gt;&gt;<i> {0}:dbg{1}:con{2}&quot;, dsi.Address, dsi.DebugPort, dsi.OutputPort);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Duane
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Sat, Dec 12, 2009 at 11:12 AM, Geoff Norton &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">gnorton at novell.com</A>&gt;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Duane,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   How are you initializing the remove debug agent?  It sounds like you're
</I>&gt;&gt;&gt;<i> listening for a console connection as well, but not connecting to that port.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -g
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 2009-12-12, at 10:49 AM, Duane Wandless wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm finally very close to enabling the soft debugger for embedded OSX
</I>&gt;&gt;&gt;<i> applications.  Any help would be greatly appreciated.  I am blocked on the
</I>&gt;&gt;&gt;<i> MD debugger not responding to the remote app.  Is this issue related to the
</I>&gt;&gt;&gt;<i> debugger needing to be signed or something similar?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I now can invoke the debugger and have it launch my cocoa app.  I see the
</I>&gt;&gt;&gt;<i> Waiting for debugger to connect message.  And in the console I see these 2
</I>&gt;&gt;&gt;<i> lines and no other errors:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 12/12/09 9:44:04 AM Firewall[72] mono is listening from 127.0.0.1:10001proto=6
</I>&gt;&gt;&gt;<i> 12/12/09 9:44:04 AM Firewall[72] mono is listening from 127.0.0.1:52690proto=6
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> But the invoked app hangs with this call stack:
</I>&gt;&gt;&gt;<i> #0  0x97c056ca in recvfrom$NOCANCEL$UNIX2003 ()
</I>&gt;&gt;&gt;<i> #1  0x97c6fe99 in recv ()
</I>&gt;&gt;&gt;<i> #2  0x00a9e906 in transport_connect (host=0x150c440 &quot;127.0.0.1&quot;,
</I>&gt;&gt;&gt;<i> port=10001) at debugger-agent.c:1003
</I>&gt;&gt;&gt;<i> #3  0x00a9e12d in finish_agent_init (on_startup=1) at
</I>&gt;&gt;&gt;<i> debugger-agent.c:809
</I>&gt;&gt;&gt;<i> #4  0x00a9df90 in mono_debugger_agent_init () at debugger-agent.c:763
</I>&gt;&gt;&gt;<i> #5  0x009d6b20 in mini_init (filename=0x150c100
</I>&gt;&gt;&gt;<i> &quot;/Users/me/Src/sandbox/dec10/svn/my_files/PFiles/build/Debug/PFiles.app/Contents/Libraries/MacMonoClient.exe&quot;,
</I>&gt;&gt;&gt;<i> runtime_version=0x0) at mini.c:5109
</I>&gt;&gt;&gt;<i> #6  0x00a5e59a in mono_jit_init (file=0x150c100
</I>&gt;&gt;&gt;<i> &quot;/Users/me/Src/sandbox/dec10/svn/my_files/PFiles/build/Debug/PFiles.app/Contents/Libraries/MacMonoClient.exe&quot;)
</I>&gt;&gt;&gt;<i> at driver.c:1892
</I>&gt;&gt;&gt;<i> #7  0x0004fbf7 in InitMono (argc=1, argv=0xbffff644) at
</I>&gt;&gt;&gt;<i> /Users/me/Src/sandbox/nov05/svn/InitMono/initmono.m:42
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> To get the call stack I launch a dummy app and then launch the real app
</I>&gt;&gt;&gt;<i> from within xcode that attempts to connect.  And yes I did try launching the
</I>&gt;&gt;&gt;<i> real app directly as well with:
</I>&gt;&gt;&gt;<i> var psi = new ProcessStartInfo (&quot;open&quot;,
</I>&gt;&gt;&gt;<i> &quot;/Users/me/Src/sandbox/nov05/svn/working/PFiles/build/Debug/PFiles.app&quot;)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If I cancel in the MD debugger connecting window I get this immediately
</I>&gt;&gt;&gt;<i> from the xcode app:
</I>&gt;&gt;&gt;<i> debugger-agent: DWP handshake failed.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I disabled the Firewall just in case with no change.  But since the cocoa
</I>&gt;&gt;&gt;<i> app responds to the cancel from MD I believe the connection is sort of
</I>&gt;&gt;&gt;<i> established.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Here is my init code:
</I>&gt;&gt;&gt;<i> MonoDomain *domain;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> NSString *libraryPath = [[[NSBundle mainBundle] bundlePath]
</I>&gt;&gt;&gt;<i> stringByAppendingPathComponent:@&quot;Contents/Libraries&quot;];
</I>&gt;&gt;&gt;<i>  NSString *sampleAssemblyPath = [libraryPath
</I>&gt;&gt;&gt;<i> stringByAppendingPathComponent:@&quot;MacMonoClient.exe&quot;];
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> NSLog(@&quot;libraryPath: %@&quot;, sampleAssemblyPath);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> mono_config_parse (&quot;config&quot;);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         NSLog(@&quot;about to check for MOON_SOFT_DEBUG&quot;);
</I>&gt;&gt;&gt;<i> const gchar *soft_debug;
</I>&gt;&gt;&gt;<i>  soft_debug = g_getenv (&quot;MOON_SOFT_DEBUG&quot;);
</I>&gt;&gt;&gt;<i> if (soft_debug != NULL) {
</I>&gt;&gt;&gt;<i>  NSLog(@&quot;we have MOON_SOFT_DEBUG %s&quot;, soft_debug);
</I>&gt;&gt;&gt;<i> gchar *opt = g_strdup_printf (&quot;--debugger-agent=%s&quot;, soft_debug);
</I>&gt;&gt;&gt;<i>  mono_jit_parse_options (1, &amp;opt);
</I>&gt;&gt;&gt;<i> g_free (opt);
</I>&gt;&gt;&gt;<i> }
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> mono_debug_init (MONO_DEBUG_FORMAT_MONO);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> domain = mono_jit_init ([sampleAssemblyPath UTF8String]);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;<i> Duane
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hey Duane
</I>&gt;<i>
</I>&gt;<i>     Did you get this to work on MAC, If so I was wondering if you like to
</I>&gt;<i> share it with everybody ? There is hardly any documentation anywhere so I
</I>&gt;<i> don't even know where to start ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i> Raj
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-osx/attachments/20091214/c4e63dbc/attachment-0001.html">http://lists.ximian.com/pipermail/mono-osx/attachments/20091214/c4e63dbc/attachment-0001.html</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002611.html">[Mono-osx] [MonoDevelop]  Debug embedded OSX app
</A></li>
	<LI>Next message: <A HREF="002610.html">[Mono-osx] Call for Talks - FOSDEM 2010 (Mono devroom)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2612">[ date ]</a>
              <a href="thread.html#2612">[ thread ]</a>
              <a href="subject.html#2612">[ subject ]</a>
              <a href="author.html#2612">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
