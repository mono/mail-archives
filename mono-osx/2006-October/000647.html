<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-osx] How to add mono/dumbarton as a bundled framework
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20How%20to%20add%20mono/dumbarton%20as%20a%20bundled%20framework&In-Reply-To=ED326676-AE5C-472C-BB57-15A463140F8E%40counterpop.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000642.html">
   <LINK REL="Next"  HREF="000648.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-osx] How to add mono/dumbarton as a bundled framework</H1>
    <B>Eoin Norris</B> 
    <A HREF="mailto:mono-osx%40lists.ximian.com?Subject=%5BMono-osx%5D%20How%20to%20add%20mono/dumbarton%20as%20a%20bundled%20framework&In-Reply-To=ED326676-AE5C-472C-BB57-15A463140F8E%40counterpop.net"
       TITLE="[Mono-osx] How to add mono/dumbarton as a bundled framework">e.norris at mac.com
       </A><BR>
    <I>Mon Oct 30 09:23:32 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000642.html">[Mono-osx] How to add mono/dumbarton as a bundled framework
</A></li>
        <LI>Next message: <A HREF="000648.html">[Mono-osx] How to add mono/dumbarton as a bundled framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#647">[ date ]</a>
              <a href="thread.html#647">[ thread ]</a>
              <a href="subject.html#647">[ subject ]</a>
              <a href="author.html#647">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hmm, I have some of this working but I am stumped by this problem in  
my app ( it did not happen in the DBCocoaExampel I was prototyping)

The executable, Dumbarton dylib, and various mono libs  have been  
changed via install_name_tool to pick up bundled dylib versions.  
However on run I get this:

Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
Reading symbols for shared libraries ........... done
Reading symbols for shared libraries ... done
Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
Reading symbols for shared libraries . done
The assembly mscorlib.dll was not found or could n

&quot;The assembly mscorlib.dll was not found or could not be loaded.
It should have been installed in the `/Library/Frameworks/ 
Mono.framework/Versions/1.1.17.1/lib/mono/1.0/mscorlib.dll' directory.&quot;

i think this is happening in the actual mono layer after the dylibs  
have been linked against.  I mean, mscorlib is not an object file,  
but possibly a compiled assemby. Any idea how to redirect the mono  
layers to point to this in a build script without installing anything  
in /Library/Frameworks/Mono.framework/ - I mean, if I have to do that  
I should just use a full installer.


-- Eoin


On 25 Oct 2006, at 11:30, Allan Hsu wrote:

&gt;<i> Sorry I didn't get back to you when you sent me this question  
</I>&gt;<i> yesterday, but, ironically, I was at the Mono developer's meeting  
</I>&gt;<i> in Boston and there was no internet access:)
</I>&gt;<i>
</I>&gt;<i> Here is how we do it at imeem:
</I>&gt;<i>
</I>&gt;<i> We build our own universal version of Mono because there are a  
</I>&gt;<i> couple problems right now with the current release builds of Mono  
</I>&gt;<i> for OS X. Hopefully, after talking to Wade and Miguel this week  
</I>&gt;<i> (and some followup work), we'll fix the current problems with  
</I>&gt;<i> linking against the official builds as well as seeing what can be  
</I>&gt;<i> done about getting official universal install packages. For now, if  
</I>&gt;<i> you're just testing, you could probably just use one of the older  
</I>&gt;<i> platform-specific release builds that links properly.
</I>&gt;<i>
</I>&gt;<i> We include the Dumbarton framework project file in our main Xcode  
</I>&gt;<i> project file, done by &quot;add-&gt;existing files...&quot; in the context menu  
</I>&gt;<i> for the main project in &quot;Groups &amp; Files&quot;. It's important that you  
</I>&gt;<i> either set your default build products folder in Xcode or manually  
</I>&gt;<i> set the the build products folder in your project, the Dumbarton  
</I>&gt;<i> project, and the Judy project inside Dumbarton all to the same folder.
</I>&gt;<i>
</I>&gt;<i> In our release builds, we copy the Dumbarton framework and portions  
</I>&gt;<i> of Mono into the application bundle. In order to fix the sorts of  
</I>&gt;<i> linking problems you're experiencing, we use install_name_tool to  
</I>&gt;<i> change the install names referenced by the application executable  
</I>&gt;<i> and all of the dynamic librariesto @executable_path relative  
</I>&gt;<i> install names. So instead of what you're trying to do, we link to  
</I>&gt;<i> the Mono libraries in /Library/Frameworks/Mono/ and the included  
</I>&gt;<i> Dumbarton framework project at build time, copy them into the  
</I>&gt;<i> application bundle, and then rewrite the install names of the  
</I>&gt;<i> copied libraries. The install_name_tool manpage explains how to use  
</I>&gt;<i> the tool in detail.
</I>&gt;<i>
</I>&gt;<i> At runtime, you'll have to tell Dumbarton where to look for your  
</I>&gt;<i> embedded version of Mono, otherwise the runtime will not look in  
</I>&gt;<i> your application bundle for the GAC. This is the code that we use:
</I>&gt;<i>
</I>&gt;<i> NSString *libraryPath = [[[NSBundle mainBundle] bundlePath]  
</I>&gt;<i> stringByAppendingPathComponent:@&quot;Contents/Libraries&quot;];
</I>&gt;<i> NSString *monoRootPath = [libraryPath  
</I>&gt;<i> stringByAppendingPathComponent:@&quot;Mono&quot;];
</I>&gt;<i> [DBMonoEnvironment setAssemblyRoot:[monoRootPath  
</I>&gt;<i> stringByAppendingPathComponent:@&quot;lib&quot;]];
</I>&gt;<i> [DBMonoEnvironment setConfigDir:[monoRootPath  
</I>&gt;<i> stringByAppendingPathComponent:@&quot;etc&quot;]];
</I>&gt;<i>
</I>&gt;<i> We don't do anything with weak linking.
</I>&gt;<i>
</I>&gt;<i> I hope this helps. I just returned from Boston a few hours ago and  
</I>&gt;<i> I'm very tired, so I may have missed something. I've been meaning  
</I>&gt;<i> to write some tools to make this process easier and include samples  
</I>&gt;<i> with the Dumbarton example code, but I haven't gotten around to it  
</I>&gt;<i> yet.
</I>&gt;<i>
</I>&gt;<i> 	-Allan
</I>&gt;<i>
</I>&gt;<i> On Oct 25, 2006, at 2:04 AM, Eoin Norris wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This query is more for people who have used ObjectiveC# or Dumbarton.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have created an application that runs on my Intel box, talking via
</I>&gt;&gt;<i> dumbarton to the mono layer , and back. Mono does the business code
</I>&gt;&gt;<i> and all UI is in Cocoa.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I need to get to beta test sometime next week - with external testers
</I>&gt;&gt;<i> - and I need to either bite the bullet and bundle the frameworks
</I>&gt;&gt;<i> within the bundle ( preferably a universal version) or just do it via
</I>&gt;&gt;<i> an installer, installing the frameworks in /Library/Frameworks -
</I>&gt;&gt;<i> which is ugly for the Mac.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I thought I had a fair idea how to do this, however I ran into
</I>&gt;&gt;<i> dumbarton problems.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The developer documentation from apple suggests that you should build
</I>&gt;&gt;<i> the frameworks within the project. This not what I want to do with
</I>&gt;&gt;<i> the mono framework, specially as I am unsure how to build it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So for now I link against the mono 1.1.17.1  version ( which is intel
</I>&gt;&gt;<i> only on my machine) without building it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So the final build phase is:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1) copy dumbarton.framework and mono.framework to the application
</I>&gt;&gt;<i> bundle/contents/frameworks/ directory via a script
</I>&gt;&gt;<i> 2) add -weak-link dumbarton and -weak-link mono to the linker flags
</I>&gt;&gt;<i> 3) Change the mono specific  linker flags ( which i dont really
</I>&gt;&gt;<i> understand) to point to the bundled frameworks
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> i.e. -L&quot;$TARGET_BUILD_DIR/$FULL_PRODUCT_NAME/Contents/Frameworks/
</I>&gt;&gt;<i> Mono.framework/Versions/Current/lib/pkgconfig/../../lib&quot; and
</I>&gt;&gt;<i> -L&quot;&quot;$TARGET_BUILD_DIR/$FULL_PRODUCT_NAME/Contents/Frameworks/
</I>&gt;&gt;<i> Mono.framework/Versions/Current/lib&quot; -lmono -lm -lgmodule-2.0 -
</I>&gt;&gt;<i> lgthread-2.0 -lglib-2.0 -lintl -liconv
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So that is the main target sorted I think, but I am not exactly sure.
</I>&gt;&gt;<i> However I add Dumbarton as a bundled framework too, but do not build
</I>&gt;&gt;<i> it either.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On launching the result is :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> dyld: Library not loaded: /Library/Frameworks/Mono.framework/ 
</I>&gt;&gt;<i> Versions/
</I>&gt;&gt;<i> 1.1.17.1/lib/libmono.0.0.0.dylib
</I>&gt;&gt;<i>    Referenced from: /Library/Frameworks/Dumbarton.framework/Versions/
</I>&gt;&gt;<i> A/Dumbarton
</I>&gt;&gt;<i>    Reason: image not found
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> clearly a reference to the mono.framework from dumbarton. This gives
</I>&gt;&gt;<i> rise to a circular problem, how do I build the dumbarton framework to
</I>&gt;&gt;<i> point to a mono.framework ( weak-linked?) within a bundle which would
</I>&gt;&gt;<i> not have been built yet, until after it the dumbarton framework is
</I>&gt;&gt;<i> linked ( I think it is clear tha I have probably have to build
</I>&gt;&gt;<i> dumbarton as part of my project.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks in advance
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-osx mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">Mono-osx at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-osx">http://lists.ximian.com/mailman/listinfo/mono-osx</A>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Allan Hsu &lt;allan at counterpop dot net&gt;
</I>&gt;<i> 1E64 E20F 34D9 CBA7 1300  1457 AC37 CBBB 0E92 C779
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000642.html">[Mono-osx] How to add mono/dumbarton as a bundled framework
</A></li>
	<LI>Next message: <A HREF="000648.html">[Mono-osx] How to add mono/dumbarton as a bundled framework
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#647">[ date ]</a>
              <a href="thread.html#647">[ thread ]</a>
              <a href="subject.html#647">[ subject ]</a>
              <a href="author.html#647">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-osx">More information about the Mono-osx
mailing list</a><br>
</body></html>
