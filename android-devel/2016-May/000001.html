<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [android-devel] mandroid not yet open source?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:android-devel%40lists.xamarin.com?Subject=Re%3A%20%5Bandroid-devel%5D%20mandroid%20not%20yet%20open%20source%3F&In-Reply-To=%3C933125F7-EA2F-4A3E-8943-F6709A54F42E%40vt.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000000.html">
   <LINK REL="Next"  HREF="000002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[android-devel] mandroid not yet open source?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:android-devel%40lists.xamarin.com?Subject=Re%3A%20%5Bandroid-devel%5D%20mandroid%20not%20yet%20open%20source%3F&In-Reply-To=%3C933125F7-EA2F-4A3E-8943-F6709A54F42E%40vt.edu%3E"
       TITLE="[android-devel] mandroid not yet open source?">jonpryor at vt.edu
       </A><BR>
    <I>Fri May  6 12:36:14 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="000000.html">[android-devel] mandroid not yet open source?
</A></li>
        <LI>Next message: <A HREF="000002.html">[android-devel] Contributing to Xamarin Open Source SDKs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1">[ date ]</a>
              <a href="thread.html#1">[ thread ]</a>
              <a href="subject.html#1">[ subject ]</a>
              <a href="author.html#1">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On May 5, 2016, at 8:43 PM, Hans Schmidt &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/android-devel">hans.schmidt9306 at gmail.com</A>&gt; wrote:
&gt;<i> I compiled the recently open sourced Xamarin.Android code from github on Linux (current ubuntu). Then if I try to compile an app with xbuild, I get the following error:
</I>&gt;<i> 
</I>&gt;<i> : error XA0020: Could not find mandroid!
</I>&gt;<i>     Task &quot;ResolveSdks&quot; execution &#8212; FAILED
</I>
`mandroid` is two different things, because&#8230;naming is hard?

There's mandroid.exe&#8230;which is dead. (DEAD! Huzzah!) It was responsible for various forms of license checking and &#8220;protected&#8221; the mono runtimes (&#8230;because it would otherwise be too hard to `unzip` the .apk and grab libmonosgen-2.0.so?).

(Look, I just *implemented* the logic, I didn&#8217;t agree with all of it. ;-)

Anyway, mandroid.exe&#8217;s license checking purpose was killed in C6SR3 (Xamarin.Android 6.0.3) and C7 (Xamarin.Android 6.1), and the open-sourced code is based on master (to eventually be C8/Xamarin.Android 6.2?).

The *other* mandroid is $prefix/lib/mandroid, which stores various utilities such as class-parse.exe, and this is what the XA0020 error is trying to complain about:

	<A HREF="https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Tasks/Tasks/ResolveSdksTask.cs#L129">https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Tasks/Tasks/ResolveSdksTask.cs#L129</A>

However, what it&#8217;s *actually* looking for is $prefix/bin/generator:

	<A HREF="https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Utilities/MonoDroidSdk.cs#L25-L38">https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Utilities/MonoDroidSdk.cs#L25-L38</A>
	<A HREF="https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Utilities/Sdks/MonoDroidSdkBase.cs#L37-L66">https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Utilities/Sdks/MonoDroidSdkBase.cs#L37-L66</A>
	<A HREF="https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Utilities/Sdks/MonoDroidSdkUnix.cs#L38-L42">https://github.com/xamarin/xamarin-android/blob/59ec488/src/Xamarin.Android.Build.Utilities/Sdks/MonoDroidSdkUnix.cs#L38-L42</A>

Same basic *idea*, though: to verify that the Xamarin.Android SDK is sane, we check for a file&#8230;which doesn&#8217;t exist, because nothing creates it.

(Because I was in a rush, never built this on Linux, and don&#8217;t have a &#8220;clean&#8221; OS X environment for testing either&#8230;)

You should be able to hack it to make it work; PR&#8217;s welcome, or wait until one of us gets around to it. As a vague guess for a starting point, what you&#8217;d need to do is:

1. *Fully* build external/Java.Interop. The default xamarin-android build only includes pieces of it.
2. Copy external/Java.Interop/bin/$(Configuration) into bin/$(Configuration)/lib/mandroid
3. Create bin/$(Configuration)/bin/generator, as a shell-script to invoke bin/$(Configuration)/lib/mandroid/generator.exe
4. Profit by using tools/scripts/xabuild.

Then there&#8217;s the closely related question of how to *properly* build this; should this be make(1)-based, and done in the Makefile, or can we get MSBuild/xbuild to do this for us? I&#8217;d like to keep as much in MSBuild as possible&#8230;but we&#8217;re dealing with shell scripts, which will need to be +x, so it&#8217;s probably easier/saner to require Makefile there&#8230;

 - Jon

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000000.html">[android-devel] mandroid not yet open source?
</A></li>
	<LI>Next message: <A HREF="000002.html">[android-devel] Contributing to Xamarin Open Source SDKs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1">[ date ]</a>
              <a href="thread.html#1">[ thread ]</a>
              <a href="subject.html#1">[ subject ]</a>
              <a href="author.html#1">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/android-devel">More information about the android-devel
mailing list</a><br>
</body></html>
