<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] HttpWebRequest Allocates Multiple Threads	per Request
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20HttpWebRequest%20Allocates%20Multiple%0A%20Threads%09per%20Request&In-Reply-To=%3COF16F3B466.7F7776AD-ON86257AFA.006282CA-86257AFA.006287A5%40ni.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001772.html">
   <LINK REL="Next"  HREF="001781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] HttpWebRequest Allocates Multiple Threads	per Request</H1>
    <B>Sean Reque</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20HttpWebRequest%20Allocates%20Multiple%0A%20Threads%09per%20Request&In-Reply-To=%3COF16F3B466.7F7776AD-ON86257AFA.006282CA-86257AFA.006287A5%40ni.com%3E"
       TITLE="[Mono-aspnet-list] HttpWebRequest Allocates Multiple Threads	per Request">sean.reque at ni.com
       </A><BR>
    <I>Mon Jan 21 17:56:12 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001772.html">[Mono-aspnet-list] HttpWebRequest Allocates Multiple Threads	per Request
</A></li>
        <LI>Next message: <A HREF="001781.html">[Mono-aspnet-list] System.NullReferenceException: Object reference not set to an instance of an object at System.Web.SessionState.SessionInProcHandler.GetItemInternal (System.Web.HttpContext context, System.String id, System.Boolean&amp; locked, System.TimeSpan&amp; lockAge, System.Object&amp; lockId, System.Web.SessionState.SessionStateActions&amp; actions, Boolean exclusive) [0x00000] in &lt;filename unknown&gt;:0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1773">[ date ]</a>
              <a href="thread.html#1773">[ thread ]</a>
              <a href="subject.html#1773">[ subject ]</a>
              <a href="author.html#1773">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Robert.

Thanks for the response.

My problem is that for our application, we've ran into problems with 
standard library functions using the global thread pool, where eventually 
threads in our application would hang indefinitely. We saw this when using 
the Begin* I/O functions on System.Diagnostics.Process objects. As soon as 
we switched to managing our own threads and using the synchronous methods, 
our application no longer hung.

I am unfortunately again seeing hangs when switching from using a web 
client based on curl and native code to System.Net.WebRequest.. Further 
investigation revealed that we are inadvertently once again using 
asynchronous I/O operations. I'm not an expert on the subject, but I poked 
around mcs/class/System/System.Net/HttpWebRequest.cs and the code does not 
look exception safe to me. There are several places where monitors are 
entered and methods subsequently called without a try/catch block, so that 
if any of them threw, a deadlock would seem likely to occur.

I think our solutions for now are going to have to be 
        1. Continue to rely on native code for web requests.
        2. Investigate writing our own simple library for doing web 
requests.
        3. Investigate using a java web client library through IKVM, such 
as Apache HttpClient.

  Sean



From:   Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">robertj at gmx.net</A>&gt;
To:     <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">mono-aspnet-list at lists.ximian.com</A>, 
Date:   01/21/2013 11:39 AM
Subject:        Re: [Mono-aspnet-list] HttpWebRequest Allocates Multiple 
Threads per Request
Sent by:        <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">mono-aspnet-list-bounces at lists.ximian.com</A>



On 21.01.2013 17:11, Sean Reque wrote:
&gt;<i> I noticed today in a debugger session that  performing a simple POST
</I>&gt;<i> request with HttpWebRequest  allocates three new threads. Examining the
</I>&gt;<i> source code reveals that the synchronous methods GetRequestStream() and
</I>&gt;<i> GetResponseStream() use the asynchronous versions of themselves 
</I>underneath
&gt;<i> the hood.
</I>&gt;<i> Allocating three threads per request is unacceptable for my application.
</I>&gt;<i> Is there any way to work around this so that making synchronous requests
</I>&gt;<i> does not allocate new threads?
</I>
The threads you're seeing belong to the thread &amp; I/O pools. They
are allocated once and then reused. There is no way to disable
this behavior.

Robert



_______________________________________________
Mono-aspnet-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">Mono-aspnet-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">http://lists.ximian.com/mailman/listinfo/mono-aspnet-list</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20130121/f01e3469/attachment.html">http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20130121/f01e3469/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001772.html">[Mono-aspnet-list] HttpWebRequest Allocates Multiple Threads	per Request
</A></li>
	<LI>Next message: <A HREF="001781.html">[Mono-aspnet-list] System.NullReferenceException: Object reference not set to an instance of an object at System.Web.SessionState.SessionInProcHandler.GetItemInternal (System.Web.HttpContext context, System.String id, System.Boolean&amp; locked, System.TimeSpan&amp; lockAge, System.Object&amp; lockId, System.Web.SessionState.SessionStateActions&amp; actions, Boolean exclusive) [0x00000] in &lt;filename unknown&gt;:0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1773">[ date ]</a>
              <a href="thread.html#1773">[ thread ]</a>
              <a href="subject.html#1773">[ subject ]</a>
              <a href="author.html#1773">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
