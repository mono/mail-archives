<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] nginx + multiple fastcgi-mono-server4 instance =&gt; WebResource.axd 404 error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20nginx%20%2B%20multiple%20fastcgi-mono-server4%0A%20instance%20%3D%3E%20WebResource.axd%20404%20error&In-Reply-To=%3C50E4342B.1080503%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001748.html">
   <LINK REL="Next"  HREF="001750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] nginx + multiple fastcgi-mono-server4 instance =&gt; WebResource.axd 404 error</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20nginx%20%2B%20multiple%20fastcgi-mono-server4%0A%20instance%20%3D%3E%20WebResource.axd%20404%20error&In-Reply-To=%3C50E4342B.1080503%40gmail.com%3E"
       TITLE="[Mono-aspnet-list] nginx + multiple fastcgi-mono-server4 instance =&gt; WebResource.axd 404 error">kornelpal at gmail.com
       </A><BR>
    <I>Wed Jan  2 13:20:43 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001748.html">[Mono-aspnet-list] nginx + multiple fastcgi-mono-server4 instance	=&gt; WebResource.axd 404 error
</A></li>
        <LI>Next message: <A HREF="001750.html">[Mono-aspnet-list] nginx + multiple fastcgi-mono-server4 instance =&gt; WebResource.axd 404 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1749">[ date ]</a>
              <a href="thread.html#1749">[ thread ]</a>
              <a href="subject.html#1749">[ subject ]</a>
              <a href="author.html#1749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Based on the source code of Mono's 
System.Web.Handlers.AssemblyResourceLoader I think that the 
implementation is flawed.

I am going to describe the problem, but I think that you should file a 
bug report.

Although it is using a hashing algorithm that always results in the same 
hash for the same script resource, hashes are not generated and stored 
in the dictionaries unless a link is generated, thus a resource is not 
available until a link to it was generated by the same AppDomain before.

As such even AppDomain restarts can trigger the problem, although a 
simple refresh on the page fixes it by generating hashes for the web 
resources that subsequently can be retrieved from the server, provided 
that there is only one AppDomain (one process, one server) serving the 
requests.

As I see at least the assembly name should be included in the query 
string, resource hashes can be regenerated based on 
WebResourceAttributes of the assembly.

To prevent loading arbitrary assemblies, the assembly name should be 
encrypted using the machine key and also should be signed using HMAC to 
avoid padding oracle vulnerability similar to CVE-2010-3332 that the MS 
implementation had (encrypted view state, forms authentication cookie, 
and WebResource.axd were all affected).

Kornel

On 1/2/2013 12:34 PM, Ovidiu Deac wrote:
&gt;<i> I'm running nginx which does load balancing over several instances of
</I>&gt;<i> fastcgi-mono-server4
</I>&gt;<i>
</I>&gt;<i> Apparently when a webresource link is handled by a different
</I>&gt;<i> fastcgi-mono-server than the one which originally produced the link it
</I>&gt;<i> returns a 404 error.
</I>&gt;<i>
</I>&gt;<i> I have set a persistent machinekey as recommended for webfarms but the
</I>&gt;<i> problem still remains.
</I>&gt;<i>
</I>&gt;<i> Any idea what else could be wrong?
</I>&gt;<i>
</I>&gt;<i> If it makes any difference: the application is written with
</I>&gt;<i> F#/WebSharper and we disabled the session state and the forms
</I>&gt;<i> authentication.
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-aspnet-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">Mono-aspnet-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">http://lists.ximian.com/mailman/listinfo/mono-aspnet-list</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001748.html">[Mono-aspnet-list] nginx + multiple fastcgi-mono-server4 instance	=&gt; WebResource.axd 404 error
</A></li>
	<LI>Next message: <A HREF="001750.html">[Mono-aspnet-list] nginx + multiple fastcgi-mono-server4 instance =&gt; WebResource.axd 404 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1749">[ date ]</a>
              <a href="thread.html#1749">[ thread ]</a>
              <a href="subject.html#1749">[ subject ]</a>
              <a href="author.html#1749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
