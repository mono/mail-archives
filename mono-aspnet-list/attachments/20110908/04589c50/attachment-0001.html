<tt>
&lt;font&nbsp;color='black'&nbsp;size='2'&nbsp;face='Arial,&nbsp;Helvetica,&nbsp;sans-serif'&gt;&lt;font&nbsp;color=&quot;black&quot;&nbsp;face=&quot;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;size=&quot;2&quot;&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-family:arial,helvetica;font-size:10pt;color:black&quot;&gt;<br>
<br>
<br>
&lt;div&nbsp;id=&quot;AOLMsgPart_1_3b9b48c9-893b-4a57-b51f-65d1b84dae3b&quot;&gt;<br>
<br>
&lt;font&nbsp;color=&quot;black&quot;&nbsp;face=&quot;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;size=&quot;2&quot;&gt;&lt;font&nbsp;color=&quot;black&quot;&nbsp;face=&quot;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;size=&quot;2&quot;&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&nbsp;&lt;br&gt;<br>
<br>
<br>
<br>
&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&gt;&nbsp;Hi,&lt;br&gt;<br>
<br>
<br>
in&nbsp;an&nbsp;ASP.NET&nbsp;MVC&nbsp;3&nbsp;application&nbsp;I'm&nbsp;sending&nbsp;emails&nbsp;with&nbsp;an&nbsp;activation&nbsp;link&nbsp;to&nbsp;subscribers.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
I&nbsp;want&nbsp;them&nbsp;to&nbsp;be&nbsp;logged&nbsp;in&nbsp;automatically&nbsp;after&nbsp;clicking&nbsp;the&nbsp;link&nbsp;when&nbsp;the&nbsp;activation&nbsp;was&nbsp;successful.&lt;br&gt;<br>
<br>
<br>
(I&nbsp;do&nbsp;not&nbsp;want&nbsp;to&nbsp;use&nbsp;redirect&nbsp;for&nbsp;several&nbsp;reasons&nbsp;(omitted&nbsp;for&nbsp;brevity))&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
&lt;font&gt;&lt;font&nbsp;color=&quot;black&quot;&nbsp;face=&quot;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;size=&quot;2&quot;&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;request&nbsp;authorization&nbsp;takes&nbsp;place&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;request,&nbsp;so&nbsp;&lt;/font&gt;&lt;/font&gt;when&nbsp;I&nbsp;set&nbsp;the&nbsp;Authorization&nbsp;Cookie&nbsp;&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;(&nbsp;FormsAuthentication.SetAuthCookie(email,&nbsp;false);&nbsp;)&lt;br&gt;<br>
<br>
<br>
the&nbsp;authorization&nbsp;has&nbsp;already&nbsp;happened&nbsp;before&nbsp;that&nbsp;and&nbsp;the&nbsp;request&nbsp;isn't&nbsp;authorized&nbsp;and&nbsp;while&nbsp;technically&nbsp;being&nbsp;logged&nbsp;in&nbsp;a&nbsp;user&nbsp;get's&nbsp;the&nbsp;visual&nbsp;cue&nbsp;that&nbsp;he's&nbsp;not&nbsp;and&nbsp;even&nbsp;the&nbsp;link&nbsp;to&nbsp;the&nbsp;login-form&nbsp;gets&nbsp;rendered.&nbsp;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
On&nbsp;my&nbsp;Windows-development&nbsp;machine&nbsp;the&nbsp;solution&nbsp;from&nbsp;Branislav&nbsp;(code&nbsp;below)&lt;br&gt;<br>
<br>
<br>
http://stackoverflow.com/questions/2105391/how-to-set-request-isauthenticated-to-true-when-not-using-formsauthentication-red/2108227#2108227&lt;br&gt;<br>
<br>
<br>
works&nbsp;perfectly,&nbsp;but&nbsp;it&nbsp;doesn't&nbsp;work&nbsp;on&nbsp;Mono.&nbsp;(xsp4&nbsp;&amp;amp;&nbsp;fastcgi-mono-server4)&lt;br&gt;<br>
<br>
<br>
The&nbsp;solution&nbsp;is&nbsp;calling&nbsp;RenewCurrentUser&nbsp;before&nbsp;returning&nbsp;the&nbsp;View.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
&lt;font&gt;&lt;font&nbsp;color=&quot;black&quot;&nbsp;face=&quot;Arial,&nbsp;Helvetica,&nbsp;sans-serif&quot;&nbsp;size=&quot;2&quot;&gt;1.&nbsp;It&nbsp;would&nbsp;be&nbsp;great&nbsp;if&nbsp;someone&nbsp;could&nbsp;tell&nbsp;me&nbsp;what&nbsp;I&nbsp;need&nbsp;to&nbsp;change&nbsp;in&nbsp;RenewCurrentUser&nbsp;so&nbsp;that&nbsp;it&nbsp;works&nbsp;on&nbsp;Mono&nbsp;as&nbsp;well.&lt;/font&gt;&lt;/font&gt;&lt;br&gt;<br>
<br>
<br>
2.&nbsp;Background&nbsp;info&nbsp;about&nbsp;the&nbsp;difference&nbsp;in&nbsp;behavior&nbsp;would&nbsp;also&nbsp;be&nbsp;very&nbsp;interesting.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
Best&nbsp;regards,&lt;br&gt;<br>
<br>
<br>
Carson&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;void&nbsp;RenewCurrentUser()&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;System.Web.HttpCookie&nbsp;authCookie&nbsp;=&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;System.Web.HttpContext.Current.Request.Cookies[FormsAuthentication.FormsCookieName];&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(authCookie&nbsp;!=&nbsp;null)&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;FormsAuthenticationTicket&nbsp;authTicket&nbsp;=&nbsp;null;&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;authTicket&nbsp;=&nbsp;FormsAuthentication.Decrypt(authCookie.Value);&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(authTicket&nbsp;!=&nbsp;null&nbsp;&amp;amp;&amp;amp;&nbsp;!authTicket.Expired)&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;FormsAuthenticationTicket&nbsp;newAuthTicket&nbsp;=&nbsp;authTicket;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(FormsAuthentication.SlidingExpiration)&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;newAuthTicket&nbsp;=&nbsp;FormsAuthentication.RenewTicketIfOld(authTicket);&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;string&nbsp;userData&nbsp;=&nbsp;newAuthTicket.UserData;&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;string[]&nbsp;roles&nbsp;=&nbsp;userData.Split(',');&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;System.Web.HttpContext.Current.User&nbsp;=&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;new&nbsp;System.Security.Principal.GenericPrincipal(new&nbsp;FormsIdentity(newAuthTicket),&nbsp;roles);&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
<br>
<br>
<br>
&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&nbsp;style=&quot;clear:both&quot;&gt;&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;/font&gt;&lt;/font&gt;<br>
&lt;/div&gt;<br>
<br>
&nbsp;&lt;!--&nbsp;end&nbsp;of&nbsp;AOLMsgPart_1_3b9b48c9-893b-4a57-b51f-65d1b84dae3b&nbsp;--&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;/font&gt;&lt;/font&gt;
</tt>
