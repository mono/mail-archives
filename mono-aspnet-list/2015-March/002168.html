<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] asp.net mvc web api with mono: JSON results contain no null for nullable types
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20asp.net%20mvc%20web%20api%20with%20mono%3A%20JSON%20results%0A%20contain%20no%20null%20for%20nullable%20types&In-Reply-To=%3C1426184503872-4665627.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] asp.net mvc web api with mono: JSON results contain no null for nullable types</H1>
    <B>marcelbeck</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20asp.net%20mvc%20web%20api%20with%20mono%3A%20JSON%20results%0A%20contain%20no%20null%20for%20nullable%20types&In-Reply-To=%3C1426184503872-4665627.post%40n4.nabble.com%3E"
       TITLE="[Mono-aspnet-list] asp.net mvc web api with mono: JSON results contain no null for nullable types">marcel.beck at taicanet.com
       </A><BR>
    <I>Thu Mar 12 18:21:43 UTC 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2168">[ date ]</a>
              <a href="thread.html#2168">[ thread ]</a>
              <a href="subject.html#2168">[ subject ]</a>
              <a href="author.html#2168">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

i have a problem with mono and json results and i don&#180;t find any solution
for it. I asked it at stack overflow and paste the text here. So, for a
better formatted version of the question, see:


<A HREF="http://stackoverflow.com/questions/29017201/asp-net-mvc-web-api-with-mono-json-results-contain-no-null-for-nullable-types">http://stackoverflow.com/questions/29017201/asp-net-mvc-web-api-with-mono-json-results-contain-no-null-for-nullable-types</A>


Hi,

i have a problem that drives me crazy. I build a asp.net mvc web api project
in visual studio 2013 on a windows 8.1 machine. It targets .net framework
4.0 (i choose this explicitly because it fits mono 3.2.8 perfect). I create
the project with visual studio empty template, and VS installed the
appropriate nuget packages for me.

Then i installed mono 3.2.8 on ubuntu 14.04 LTS via apt-get install
mono-complete. XSP is used as the web server. Nothing special done on both
systems or the project. When code-changes are done, i deploy in VS the
project to a folder and copy it to the ubuntu machine. Restart XSP and it
runs.

All works really fine since a long time (8 months and many code lines).

But now i had to change my model, used as the JSON transport object, so that
every bool or int is now nullable (bool? instead of bool). After i changed
the properties of the model, and run the web api on the windows machine per
F5, the JSON result in the browser (firefox or chrome, both show in every
cases always the same results) contains &quot;MyBoolValue: null&quot; whenever the C#
model property was null.

Perfect. Thats what i expected and what i want.

Now i copied the deploy to my ubuntu machine and let it run, as every time.
But in the browser result there are no nulls ! Every &quot;bool?&quot; which where
null in the model, not exists in the json result at all. Every &quot;double?&quot; is
set to &quot;0.0&quot;. I dont understand that ???

So i tried to set the JSON SerializeSettings (but i think &quot;including nulls&quot;
is the default, so it is senseless):

        var f = new JsonMediaTypeFormatter();

        f.SerializerSettings.NullValueHandling =
Newtonsoft.Json.NullValueHandling.Include;

        config.Formatters.Add(f);

But that produced the following error on the asp.net engine:

System.MissingMethodException Method not found:
'System.Net.Http.Formatting.JsonMediaTypeFormatter.get_SerializerSettings'.

Description: HTTP 500.Error processing request. Details: Non-web exception.
Exception origin (name of application or object): HHS.June.WebApi. Exception
stack trace: at HHS.June.WebApi.MvcApplication.Application_Start ()
[0x00000] in :0 at (wrapper managed-to-native)
System.Reflection.MonoMethod:InternalInvoke
(System.Reflection.MonoMethod,object,object[],System.Exception&amp;) at
System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags
invokeAttr, System.Reflection.Binder binder, System.Object[] parameters,
System.Globalization.CultureInfo culture) [0x00000] in :0 Version
Information: 3.2.8 (Debian 3.2.8+dfsg-4ubuntu1); ASP.NET Version:
4.0.30319.17020

I tried it 6 ours, installing the Newtonsoft.JSON in the gac, changed
versions, tried some web.config things, google google google, try to
understand what and why the mono json serializer is doing what he is doing.

It drives me crazy. Is anybody out there who know or understand or have at
least an idea, how i can get a JSON response with &quot;MyValue: null&quot; when using
nullable types in c# under mono ?

Every tip is very very appreciated :)




--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/asp-net-mvc-web-api-with-mono-JSON-results-contain-no-null-for-nullable-types-tp4665627.html">http://mono.1490590.n4.nabble.com/asp-net-mvc-web-api-with-mono-JSON-results-contain-no-null-for-nullable-types-tp4665627.html</A>
Sent from the Mono - ASP.NET mailing list archive at Nabble.com.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2168">[ date ]</a>
              <a href="thread.html#2168">[ thread ]</a>
              <a href="subject.html#2168">[ subject ]</a>
              <a href="author.html#2168">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
