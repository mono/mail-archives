<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] issues with intermittent apache hangups
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20issues%20with%20intermittent%20apache%20hangups&In-Reply-To=20110411150306.3dfe24fe%40twistedcode.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001241.html">
   <LINK REL="Next"  HREF="001243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] issues with intermittent apache hangups</H1>
    <B>Dan</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20issues%20with%20intermittent%20apache%20hangups&In-Reply-To=20110411150306.3dfe24fe%40twistedcode.net"
       TITLE="[Mono-aspnet-list] issues with intermittent apache hangups">parnham at gmail.com
       </A><BR>
    <I>Wed Apr 13 09:42:05 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001241.html">[Mono-aspnet-list] issues with intermittent apache hangups
</A></li>
        <LI>Next message: <A HREF="001243.html">[Mono-aspnet-list] issues with intermittent apache hangups
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1242">[ date ]</a>
              <a href="thread.html#1242">[ thread ]</a>
              <a href="subject.html#1242">[ subject ]</a>
              <a href="author.html#1242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Marek,

Thanks for all your help so far.

I've applied the patch (0eff07d0fc4ef1ef3c584e71a8dd54ab708543e8) both on my
development machine (to run further mprof tests) and on our test server. The
local tests still show many thousands of cache items being generated,
although I believe at a slightly slower rate.

The test server has also been set running again for the past couple of days,
although I think the app got restarted at some point (probably killed by the
system when it started demanding too much memory). Just watching it for the
past two hours it has gone from 19.7% to 26.8% memory usage (1GB of memory
available in this old test machine), and is still creeping up. This problem
will cause us major issues in a production kiosk system, since it will reach
the point where the web app response slows to a halt and then eventually
gets killed by the os and restarted by apache. 

Unless this can be resolved properly, we may have to resort to setting up a
cron job that will automatically force the web server to restart on a
regular basis, but we really do not want to have to do that!

Regards,
Dan


Marek Habersack wrote:
&gt;<i> 
</I>&gt;<i> On Tue, 5 Apr 2011 15:24:25 -0500 (CDT)
</I>&gt;<i> Dan &amp;lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">parnham at gmail.com</A>&amp;gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hey Dan,
</I>&gt;<i> 
</I>&gt;<i> The issue here was the way the in-proc session handler handled item
</I>&gt;<i> timeout reset. It would first
</I>&gt;<i> remove the item from the cache (it uses an internal instance of the Cache
</I>&gt;<i> class) and then insert
</I>&gt;<i> it back in the cache. With a big number of items, that would grow the
</I>&gt;<i> timed items priority queue
</I>&gt;<i> heap much more than was necessary and generate a lot of duplicate internal
</I>&gt;<i> cache items. The effects
</I>&gt;<i> would be different depending on the application's usage of session data.
</I>&gt;<i> I've just committed a possible fix for the issue to Mono's master branch
</I>&gt;<i> (I haven't committed it to
</I>&gt;<i> the mono-2-10 branch since it is a potentially breaking change which needs
</I>&gt;<i> to be tested in real
</I>&gt;<i> life first) in commit 0eff07d0fc4ef1ef3c584e71a8dd54ab708543e8 (tests have
</I>&gt;<i> been committed in
</I>&gt;<i> c00c5d00fddf18969c9869492f7e1235d960076b if you're interested). The fix
</I>&gt;<i> applies cleanly to the 2.10
</I>&gt;<i> branch, so please apply it and test with your application to see whether
</I>&gt;<i> it fixed the issue. Please
</I>&gt;<i> let me know about the results, thanks :)
</I>&gt;<i> 
</I>&gt;<i> marek
</I>&gt;<i> 
</I>

--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/issues-with-intermittent-apache-hangups-tp3264509p3447198.html">http://mono.1490590.n4.nabble.com/issues-with-intermittent-apache-hangups-tp3264509p3447198.html</A>
Sent from the Mono - ASP.NET mailing list archive at Nabble.com.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001241.html">[Mono-aspnet-list] issues with intermittent apache hangups
</A></li>
	<LI>Next message: <A HREF="001243.html">[Mono-aspnet-list] issues with intermittent apache hangups
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1242">[ date ]</a>
              <a href="thread.html#1242">[ thread ]</a>
              <a href="subject.html#1242">[ subject ]</a>
              <a href="author.html#1242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
