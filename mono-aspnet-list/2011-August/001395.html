<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] FluentNHibernate InvalidCastException at	creating SessionFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20FluentNHibernate%20InvalidCastException%20at%0A%09creating%20SessionFactory&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001398.html">
   <LINK REL="Next"  HREF="001396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] FluentNHibernate InvalidCastException at	creating SessionFactory</H1>
    <B>gajcz</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20FluentNHibernate%20InvalidCastException%20at%0A%09creating%20SessionFactory&In-Reply-To="
       TITLE="[Mono-aspnet-list] FluentNHibernate InvalidCastException at	creating SessionFactory">gajczewski at gmail.com
       </A><BR>
    <I>Fri Aug 26 08:00:13 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001398.html">[Mono-aspnet-list] ASP.NET MVC 3
</A></li>
        <LI>Next message: <A HREF="001396.html">[Mono-aspnet-list] FluentNHibernate InvalidCastException at creating SessionFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1395">[ date ]</a>
              <a href="thread.html#1395">[ thread ]</a>
              <a href="subject.html#1395">[ subject ]</a>
              <a href="author.html#1395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm trying to introduce Fluent NHibernate in my .NET MVC 3 project but I
found some problem with Npgsql library. When the connection is being
configured and set up for the first time I receive following exception:

*FluentNHiberante.Cfg.FluentConfigurationException*
Message:
An invalid or incomplete configuration was used while creating a
SessionFactory. Check PotentialReasons collection, and InnerException for
more detail.
Stack Trace:
  at FluentNHibernate.Cfg.FluentConfiguration.BuildSessionFactory ()
[0x00000] in &lt;filename unknown&gt;:0 
  at OnlineJudge.Web.Controllers.NHibernateHelper..cctor () [0x00013] in
/.../*NHibernateHelper.cs:34*

Inner Exception:
*System.InvalidCastException*
Message:
Cannot cast from source type to destination type.
Stack Trace:
  at
NHibernate.Tool.hbm2ddl.SuppliedConnectionProviderConnectionHelper.Prepare
() [0x00000] in &lt;filename unknown&gt;:0 
  at NHibernate.Tool.hbm2ddl.SchemaMetadataUpdater.GetReservedWords
(NHibernate.Dialect.Dialect dialect, IConnectionHelper connectionHelper)
[0x00000] in &lt;filename unknown&gt;:0 
  at NHibernate.Tool.hbm2ddl.SchemaMetadataUpdater.Update (ISessionFactory
sessionFactory) [0x00000] in &lt;filename unknown&gt;:0 
  at NHibernate.Impl.SessionFactoryImpl..ctor (NHibernate.Cfg.Configuration
cfg, IMapping mapping, NHibernate.Cfg.Settings settings,
NHibernate.Event.EventListeners listeners) [0x00000] in &lt;filename unknown&gt;:0 
  at NHibernate.Cfg.Configuration.BuildSessionFactory () [0x00000] in
&lt;filename unknown&gt;:0 
  at FluentNHibernate.Cfg.FluentConfiguration.BuildSessionFactory ()
[0x00000] in &lt;filename unknown&gt;:0


The exception occurs inside my NHibernateHelper class where I've got:

var databaseConfiguration =
PostgreSQLConfiguration.PostgreSQL82.ConnectionString(connectionString);

sessionFactory = Fluently.Configure()
                .Database(databaseConfiguration)
                .Mappings(m =&gt;
                    {
                       
m.FluentMappings.AddFromAssemblyOf&lt;Models.MyClass&gt;();
                    })
                .BuildSessionFactory();

In Web.config I've got appropriate section for DbProviderFactory:
&lt;system.data&gt;
  &lt;DbProviderFactories&gt;
    &lt;add name=&quot;Npgsql Data Provider&quot; invariant=&quot;Npgsql&quot; support=&quot;FF&quot;
description=&quot;.Net Framework Data Provider for Postgresql Server&quot;
type=&quot;Npgsql.NpgsqlFactory, Npgsql, Version=4.0.0.0, Culture=neutral,
PublicKeyToken=5d8b90d52f46fda7&quot; /&gt;
  &lt;/DbProviderFactories&gt;
&lt;/system.data&gt;


It all works on Windows when I've got &quot;Version=2.0.11.0&quot; instead of
&quot;Version=4.0.0.0&quot; which is on Linux.

Also before using NHibernate the Npgsql worked fine on both systems:
var connection = new NpgsqlConnection(connectionString);
npgsqlConnection.Open();
...


I also tried to get NpgsqlFactory on my own:
var factory = Npgsql.NpgsqlFactory.Instance;
var connection = factory.CreateConnection();
...
or:
var factory = DbProviderFactories.GetFactory(&quot;Npgsql&quot;);
var connection = factory.CreateConnection();
...
and in both cases the same InvalidCastException was thrown, so maybe it's
the same issue.


Does anyone know where is the problem or what I'm doing wrong? Any idea what
can it be and maybe where is better to ask for help?

Versions I use:
- OpenSUSE 11.3
- Mono 2.10.2 (default)
- mono-data-postgresql 2.10.2-36.1 (default)
- PostgreSQL 8.4
- NHiberante 3.1 (Fluent 1.2)

--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/FluentNHibernate-InvalidCastException-at-creating-SessionFactory-tp3770661p3770661.html">http://mono.1490590.n4.nabble.com/FluentNHibernate-InvalidCastException-at-creating-SessionFactory-tp3770661p3770661.html</A>
Sent from the Mono - ASP.NET mailing list archive at Nabble.com.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001398.html">[Mono-aspnet-list] ASP.NET MVC 3
</A></li>
	<LI>Next message: <A HREF="001396.html">[Mono-aspnet-list] FluentNHibernate InvalidCastException at creating SessionFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1395">[ date ]</a>
              <a href="thread.html#1395">[ thread ]</a>
              <a href="subject.html#1395">[ subject ]</a>
              <a href="author.html#1395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
