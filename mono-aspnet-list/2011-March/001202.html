<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] Problems configuring apache2 + mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20Problems%20configuring%20apache2%20%2B%20mono&In-Reply-To=4D91BF9B.2060701%40marzoa.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001201.html">
   <LINK REL="Next"  HREF="001203.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] Problems configuring apache2 + mono</H1>
    <B>Daniel J. Summers</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20Problems%20configuring%20apache2%20%2B%20mono&In-Reply-To=4D91BF9B.2060701%40marzoa.com"
       TITLE="[Mono-aspnet-list] Problems configuring apache2 + mono">daniel.summers.2415 at gmail.com
       </A><BR>
    <I>Tue Mar 29 09:19:04 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001201.html">[Mono-aspnet-list] Problems configuring apache2 + mono
</A></li>
        <LI>Next message: <A HREF="001203.html">[Mono-aspnet-list] Problems configuring apache2 + mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1202">[ date ]</a>
              <a href="thread.html#1202">[ thread ]</a>
              <a href="subject.html#1202">[ subject ]</a>
              <a href="author.html#1202">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Mar 29, 2011 at 11:16 AM, Francisco M. Marzoa Alonso &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">francisco at marzoa.com</A>&gt; wrote:

&gt;<i> I get the following message on /var/log/apache2/error.log
</I>&gt;<i>
</I>&gt;<i> &quot;Failed to connect to mod-mono-server after several attempts to spawn
</I>&gt;<i> the process.&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>
&gt;<i> &gt; But when I create a mono aplication on /etc/mono-server2/ it does not
</I>&gt;<i> &gt; run as expected. I've created one file called fake.domain.com.webapp
</I>&gt;<i> &gt; with the following contents:
</I>&gt;<i>
</I>
I have had little success trying to get the .webapp files working.  (Maybe
someone can chime in and enlighten me too!)  As a shot in the dark, try
putting &quot;MonoSetServerAlias default&quot; in your location config.  However, I
have gotten it to work using two different processes.

The first results in a mono server process for each domain.  The upside to
this is that each domain is free to serve pages from different server
instances; the downside is that you use a good bit more memory.  To do this,
I use a virtual host config similar to this one:

&lt;VirtualHost *:80&gt;
  ServerName   djs-consulting.johnson
  DocumentRoot /var/www/dev/djsconsulting

  # Mono config
  MonoDebug         djs  false
  MonoSetEnv        djs  MONO_IOMAP=all
  MonoServerPath    djs  /usr/bin/mod-mono-server2
  MonoApplications  djs
 &quot;djs-consulting.johnson:/:/var/www/dev/djsconsulting&quot;

  &lt;Directory /var/www/dev/djsconsulting&gt;
    MonoSetServerAlias djs
    SetHandler mono
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;

The second parameter to the Mono statements give it a server alias; then, in
the Directory directive, I tell it to use that server alias.

The other way (and the way I'm running on my production web server) uses
just one Mono server instance to serve many domains.  Since Apache controls
the spawning of it, I really don't know how I'd &quot;restart&quot; just one domain.
 To do this, I have the following in
/etc/mono-server2/mono_server2_hosts.conf.

&lt;IfModule mod_mono.c&gt;
  MonoUnixSocket default /tmp/.mod_mono_server4
  MonoServerPath default &quot;/opt/mono-2.10/bin/mod-mono-server4&quot;
  AddType application/x-asp-net .aspx .ashx .asmx .ascx .asax .config .ascx
  MonoSetEnv default
MONO_IOMAP=all;PATH=/opt/mono-2.10/bin:$PATH;LD_LIBRARY_PATH=/opt/mono-2.10/lib:$LD_LIBRARY_PATH
  MonoApplications default
&quot;vpr.johnson:/:/var/www/dev/vpr,techblog.johnson:/:/var/www/dev/techblog&quot;
&lt;/IfModule&gt;

(A side note - I'm running a compiled-by-me version of Mono 2.10; if you're
using 2.8 or earlier, the MonoUnixSocket and MonoServerPath should point to
*-server2, and you won't need the MonoSetEnv directive past the word &quot;all&quot;.)

Then, as an example, the vpr.johnson virtual host file looks like this:

&lt;VirtualHost *:80&gt;
  ServerName   vpr.johnson
  DocumentRoot /var/www/dev/vpr

  &lt;Location &quot;/&quot;&gt;
    SetHandler mono
    SetOutputFilter DEFLATE
    SetEnvIfNoCase Request_URI &quot;\.(?:gif|jpe?g|png)$&quot; no-gzip dont-vary
  &lt;/Location&gt;
  &lt;IfModule mod-deflate.c&gt;
    AddOutputFilterByType DEFLATE text/html text/plain text/xml
text/javascript
  &lt;/IfModule&gt;
&lt;/VirtualHost&gt;

(&quot;johnson&quot; is my development machine, and I've set aliases in /etc/hosts
that point things like vpr.johnson to 127.0.0.1 - it keeps the virtual
structure the way it runs in production.)

Like I said above, this second way is the configuration I'm using on the
server that is actually serving the content, and it's working great.  I
would like to see if I could make the .webapp version work, but for now,
I've found that the latter config meets my needs, and it's the same
complexity as the FastCGI config I used to run, so at least it's no more
complex.  :)

-- 
*Daniel J. Summers*
*Owner, DJS Consulting*
E-mail &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">daniel.summers.2415 at gmail.com</A>&gt; &#8226; Website &lt;<A HREF="http://djs-consulting.com">http://djs-consulting.com</A>&gt;
 &#8226; Support &lt;<A HREF="http://support.djs-consulting.com">http://support.djs-consulting.com</A>&gt; &#8226; Tech
Blog&lt;<A HREF="http://techblog.djs-consulting.com">http://techblog.djs-consulting.com</A>&gt;

GEEKCODE 3.12 GCS/IT d s-:+ a C++ P--- L++ E--- W++ N++ o? K- w !O M--
V PS+ PE++ Y? PGP- t+ 5? X+ R* tv b+ DI++ D+ G- e&lt;++ h---- r+++ y++++
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20110329/28664ca4/attachment-0001.html">http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20110329/28664ca4/attachment-0001.html</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001201.html">[Mono-aspnet-list] Problems configuring apache2 + mono
</A></li>
	<LI>Next message: <A HREF="001203.html">[Mono-aspnet-list] Problems configuring apache2 + mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1202">[ date ]</a>
              <a href="thread.html#1202">[ thread ]</a>
              <a href="subject.html#1202">[ subject ]</a>
              <a href="author.html#1202">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
