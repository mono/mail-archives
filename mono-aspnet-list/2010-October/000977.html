<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] ASP.NET initial compile time on OS X
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20ASP.NET%20initial%20compile%20time%20on%20OS%20X&In-Reply-To=AANLkTikgXjkYmfARLsDjQuf%3DgKkm9KadJchwdA309FVy%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000978.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] ASP.NET initial compile time on OS X</H1>
    <B>Francois Rouaix</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20ASP.NET%20initial%20compile%20time%20on%20OS%20X&In-Reply-To=AANLkTikgXjkYmfARLsDjQuf%3DgKkm9KadJchwdA309FVy%40mail.gmail.com"
       TITLE="[Mono-aspnet-list] ASP.NET initial compile time on OS X">francois.rouaix at gmail.com
       </A><BR>
    <I>Fri Oct  1 22:52:35 EDT 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000978.html">[Mono-aspnet-list] How to run mono as cgi?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#977">[ date ]</a>
              <a href="thread.html#977">[ thread ]</a>
              <a href="subject.html#977">[ subject ]</a>
              <a href="author.html#977">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, replying to myself here for the record.
The story seems to be that System.Web depends on System.Drawing, which in
turns requires Gdiplus initialization, which in turn requires some
initialization in fontconfig. The mod-mono-server2 process runs under _www
on Mac OS X. The initialization of fontconfig scans a bunch of cache files
in /usr/X11/var/cache/fontconfig which are root:wheel 644 (directory 755).
All of the &quot;open&quot; system calls on the cache files fail due to permissions
(still unclear to me based on the Instruments trace).

As a workaround, chmod all the cache files to 666 and the directory
/usr/X11/var/cache/fontconfig to 777.
On the first compilation run of an ASP.NET site, all fonts of the system
will be scanned (1+ minute) and the caches will be recreated (unfortunately
they now belong to _www:wheel with 600 permissions again, so who knows what
else is broken?).
Next compilations of ASP.NET sites will now be reasonably fast (in the order
of seconds instead of 1+ minute).

My debugging was on Mac OS X 10.6.4, Mono 2.6.7.
Would still appreciate a better explanation/workaround if available, notably
because I'm not happy with system wide caches belonging to _www with a 600
mask...

HTH,
--f


On Thu, Sep 30, 2010 at 6:43 AM, Francois Rouaix
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">francois.rouaix at gmail.com</A>&gt;wrote:

&gt;<i> Hello folks,
</I>&gt;<i> I'm debugging an ASP.NET app on my Mac with mod_mono and was surprised
</I>&gt;<i> with a very high (2 minutes) initial compile time for the first page
</I>&gt;<i> displayed. This is a fairly simple app, which very little logic in ASP.NET pages
</I>&gt;<i> themselves (most of the code is in DLL).
</I>&gt;<i> I ran Instruments on the Mono process running mod-mono-server2 and
</I>&gt;<i> discovered that the top consumers of CPU are TT_Load_Simple_Glyph from
</I>&gt;<i> libfreetype (12 seconds) and inflate_fast in the kernel (8 seconds)  - which
</I>&gt;<i> I presume has to do with font file decompression of font files.
</I>&gt;<i> I'm running 2.6.7.
</I>&gt;<i> Any clue of why I should be spending 20 seconds in reading font files for a
</I>&gt;<i> web app? (the total cost is most likely much high due to IO on all the
</I>&gt;<i> fonts).
</I>&gt;<i> --f
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20101001/fe9eafaa/attachment.html">http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20101001/fe9eafaa/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000978.html">[Mono-aspnet-list] How to run mono as cgi?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#977">[ date ]</a>
              <a href="thread.html#977">[ thread ]</a>
              <a href="subject.html#977">[ subject ]</a>
              <a href="author.html#977">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
