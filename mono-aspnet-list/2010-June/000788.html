<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] Socket error sending secured mail.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20Socket%20error%20sending%20secured%20mail.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000785.html">
   <LINK REL="Next"  HREF="000789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] Socket error sending secured mail.</H1>
    <B>APS</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=%5BMono-aspnet-list%5D%20Socket%20error%20sending%20secured%20mail.&In-Reply-To="
       TITLE="[Mono-aspnet-list] Socket error sending secured mail.">dev.malst at apsystems.it
       </A><BR>
    <I>Fri Jun  4 04:50:44 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000785.html">[Mono-aspnet-list] Every WebRequest freezes my application
</A></li>
        <LI>Next message: <A HREF="000789.html">[Mono-aspnet-list] Socket error sending secured mail.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#788">[ date ]</a>
              <a href="thread.html#788">[ thread ]</a>
              <a href="subject.html#788">[ subject ]</a>
              <a href="author.html#788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm sorry but maybe I'm missing something. I used field specification 
to set the port so it's not 25

msg.Fields[&quot; 
<A HREF="http://schemas.microsoft.com/cdo/configuration/smtpserverport&quot;]">http://schemas.microsoft.com/cdo/configuration/smtpserverport&quot;]</A> = 465;

I looked at System.Web.Mail.SmtpClient source code and it reads those 
fields from message to set socket connection so it should work, if it 
uses port 25 it should give a timeout error, not an immediately 
socket exception I think.
Field specification works in MS.NET even if not using exchange server 
(The same code works against google in windows environment).
Maybe is one of the most items of MS.NET that does not match the 
aspected behavior but looking at Mono source code it should use those 
fields, unless there's some problem with TLS. I tried  your code on 
2.4.2.3 VM and it waits indefinitely, I've to restart apache. Maybe 
it's because I don't use Mono 2.6 but this version it's pretty new, 
in FAQ there's no version specified, I thought it could be used also 
with older versions, it's a problem for me to update.

At 13.10 03/06/2010, you wrote:
&gt;<i>On 03.06.2010 11:10, APS wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm trying so send secured mail with mono using System.Web.Mail in aspnet.
</I>&gt;<i> &gt; I read this
</I>&gt;<i> &gt; 
</I>&gt;<i> &lt;<A HREF="http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F">http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F</A>&gt;<A HREF="http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F">http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F</A>
</I>&gt;<i> &gt; and I made the described operations but when I try to send the mail I
</I>&gt;<i> &gt; always immediately obtain
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; System.Web.HttpException: Connection refused ---&gt;
</I>&gt;<i>
</I>&gt;<i>This is expected because you're actually connecting on port 25.
</I>&gt;<i>
</I>&gt;<i> &gt; System.Web.Mail.MailMessage msg = new System.Web.Mail.MailMessage();
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; msg.From = &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">test at gmail.com</A>&quot;;
</I>&gt;<i> &gt; msg.To = &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">test at gmail.com</A>&quot;;
</I>&gt;<i> &gt; msg.Subject = &quot;test&quot;;
</I>&gt;<i> &gt; msg.Body = &quot;test&quot;;
</I>&gt;<i> &gt; msg.BodyFormat = System.Web.Mail.MailFormat.Html;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; msg.Fields[&quot;<A HREF="http://schemas.microsoft.com/cdo/configuration/smtpserver&quot;]">http://schemas.microsoft.com/cdo/configuration/smtpserver&quot;]</A>
</I>&gt;<i> &gt; = &quot;smtp.gmail.com&quot;;
</I>&gt;<i>
</I>&gt;<i>This fields base configuration is of no use unless you're relaying
</I>&gt;<i>the mail through a Microsoft Exchange saver.
</I>&gt;<i>
</I>&gt;<i>You're supposed to do something like that (code borrowed
</I>&gt;<i>from Abe Gillespie/Mono list):
</I>&gt;<i>
</I>&gt;<i>          static void SendEmail()
</I>&gt;<i>          {
</I>&gt;<i>              var sender = &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">sender at gmail.com</A>&quot;;
</I>&gt;<i>              var email = &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">receiver at mail.com</A>&quot;;
</I>&gt;<i>
</I>&gt;<i>              var from = new MailAddress(sender, &quot;Sender&quot;);
</I>&gt;<i>              var to = new MailAddress(email);
</I>&gt;<i>              var mail = new MailMessage(from, to);
</I>&gt;<i>
</I>&gt;<i>              // Set the content.
</I>&gt;<i>              mail.Subject = &quot;Subject&quot;;
</I>&gt;<i>              mail.Body = &quot;Body&quot;;
</I>&gt;<i>
</I>&gt;<i>              // Send the message.
</I>&gt;<i>              SmtpClient smtp = new SmtpClient(&quot;smtp.gmail.com&quot;, 587);
</I>&gt;<i>              smtp.EnableSsl = true;
</I>&gt;<i>              smtp.Credentials = new NetworkCredential(sender, &quot;password&quot;);
</I>&gt;<i>              smtp.Send(mail);
</I>&gt;<i>           }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>You'll need Mono 2.6.x (or 2.4 + Mono.Security.dll from 2.6,
</I>&gt;<i>at you own risk) and don't forget to import the
</I>&gt;<i>certs as described here
</I>&gt;<i><A HREF="http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F.">http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F.</A>
</I>&gt;<i>
</I>&gt;<i>Robert
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-aspnet-list mailing list
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">Mono-aspnet-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">http://lists.ximian.com/mailman/listinfo/mono-aspnet-list</A>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>Il messaggio e' stato analizzato alla ricerca di virus o
</I>&gt;<i>contenuti pericolosi da MailScanner, ed e'
</I>&gt;<i>risultato non infetto.
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20100604/74d1b2b1/attachment.html">http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20100604/74d1b2b1/attachment.html</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000785.html">[Mono-aspnet-list] Every WebRequest freezes my application
</A></li>
	<LI>Next message: <A HREF="000789.html">[Mono-aspnet-list] Socket error sending secured mail.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#788">[ date ]</a>
              <a href="thread.html#788">[ thread ]</a>
              <a href="subject.html#788">[ subject ]</a>
              <a href="author.html#788">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
