<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] Mono + Nginx + Open BSD
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20Mono%20%2B%20Nginx%20%2B%20Open%20BSD&In-Reply-To=%3CCAFZWd4brNpfzeAvVJMUCsfsUMywSJiNQogB3_fc4p_A7YSVVTA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001875.html">
   <LINK REL="Next"  HREF="001870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] Mono + Nginx + Open BSD</H1>
    <B>Gee</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20Mono%20%2B%20Nginx%20%2B%20Open%20BSD&In-Reply-To=%3CCAFZWd4brNpfzeAvVJMUCsfsUMywSJiNQogB3_fc4p_A7YSVVTA%40mail.gmail.com%3E"
       TITLE="[Mono-aspnet-list] Mono + Nginx + Open BSD">g.plumb at gmail.com
       </A><BR>
    <I>Wed May 15 18:23:52 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001875.html">[Mono-aspnet-list] Mono + Nginx + Open BSD
</A></li>
        <LI>Next message: <A HREF="001870.html">[Mono-aspnet-list] Application randomly stops with	get_InputValidationEnabled () is inaccessible exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1878">[ date ]</a>
              <a href="thread.html#1878">[ thread ]</a>
              <a href="subject.html#1878">[ subject ]</a>
              <a href="author.html#1878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all

It turns out that OpenBSD chroots nginx - so my path /tmp/xxx is outside of
the jail (which is why the socket is not found).  The solution was easy
enough - point to a path inside the jail - which for reference is:

/var/www/&lt;blah&gt;

Thanks to everyone who posted suggestions!  :-)


Thanks
G



On 8 May 2013 23:26, Jesse Pasichnyk &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">jesse at pasichnyk.net</A>&gt; wrote:

&gt;<i>  Hrm, in addition to the sockets I have a folder &#8220;www-data-temp-aspnet-0&#8221;
</I>&gt;<i> in /tmp, as well as some other random named folders (e.g., 7fff3bc1).  All
</I>&gt;<i> my files are owned as www-data:, which is what my fastcgi runs as.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Not sure if that helps, but I&#8217;m on Linux as well, so not sure what else
</I>&gt;<i> might be the issue.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> -****
</I>&gt;<i>
</I>&gt;<i> Jesse****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> *From:* Gee [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">g.plumb at gmail.com</A>]
</I>&gt;<i> *Sent:* Wednesday, May 08, 2013 1:12 PM
</I>&gt;<i> *To:* Jesse Pasichnyk
</I>&gt;<i> *Cc:* Daniel Lo Nigro; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">mono-aspnet-list at lists.ximian.com</A>
</I>&gt;<i>
</I>&gt;<i> *Subject:* Re: [Mono-aspnet-list] Mono + Nginx + Open BSD****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Hi Jesse****
</I>&gt;<i>
</I>&gt;<i> Thanks for getting back to me so quickly  :-)****
</I>&gt;<i>
</I>&gt;<i> Sadly, /tmp is also owned by root and its permissions (and its children)
</I>&gt;<i> match the socket's  :-(****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> On 8 May 2013 21:02, Jesse Pasichnyk &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">jesse at pasichnyk.net</A>&gt; wrote:****
</I>&gt;<i>
</I>&gt;<i>   Check your actual /tmp folder permissions.  I believe some other folder
</I>&gt;<i> gets creates there that requires write access as well.
</I>&gt;<i>
</I>&gt;<i> Sent from my Windows Phone****
</I>&gt;<i>   ------------------------------
</I>&gt;<i>
</I>&gt;<i> *From: *Gee &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">g.plumb at gmail.com</A>&gt;
</I>&gt;<i> *Sent: *5/8/2013 12:49 PM
</I>&gt;<i> *To: *Daniel Lo Nigro &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">lists at dan.cx</A>&gt;
</I>&gt;<i> *Cc: *<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">mono-aspnet-list at lists.ximian.com</A>
</I>&gt;<i> *Subject: *Re: [Mono-aspnet-list] Mono + Nginx + Open BSD****
</I>&gt;<i>
</I>&gt;<i> Hi all
</I>&gt;<i>
</I>&gt;<i> So this is what I did...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> For sanity's sake:
</I>&gt;<i> chown root /tmp/fastcgi-mono-socket
</I>&gt;<i> chmod 777 /tmp/fastcgi-mono-socket
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> To see permissions on the socket
</I>&gt;<i> ls -la /tmp/fastcgi-mono-socket:
</I>&gt;<i>
</I>&gt;<i> Output:
</I>&gt;<i> srwxrwxrwx  1  root  wheel  0 May  8 16:01 fastcgi-mono-socket
</I>&gt;<i>
</I>&gt;<i> grep wheel /etc/group
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> To see contents of group 'wheel':
</I>&gt;<i> cat /etc/group | grep --regex &quot;^xxx:.*&quot; | awk -F: '{print $4}'
</I>&gt;<i>
</I>&gt;<i> Output:
</I>&gt;<i> root
</I>&gt;<i>
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i> So I really have no idea what else I can do at this point.****
</I>&gt;<i>
</I>&gt;<i> Do anyone have any ideas?
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i> G****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> On 8 May 2013 14:50, Daniel Lo Nigro &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">lists at dan.cx</A>&gt; wrote:****
</I>&gt;<i>
</I>&gt;<i>  Hmm... I would have expected a &quot;Permission denied&quot; rather than a &quot;No
</I>&gt;<i> such file or directory&quot; if it was a permissions issue. Maybe BSD handles
</I>&gt;<i> this differently to Linux though.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> On Wed, May 8, 2013 at 5:11 PM, Ovidiu D &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">ovidiudeac at gmail.com</A>&gt; wrote:****
</I>&gt;<i>
</I>&gt;<i>  I'm not a BSD user so I don't know for sure but apparently the unix
</I>&gt;<i> sockets permissions behave differently compared to Linux . See this:
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/5977556/how-can-i-change-the-permissions-of-a-linux-socket-file">http://stackoverflow.com/questions/5977556/how-can-i-change-the-permissions-of-a-linux-socket-file</A>
</I>&gt;<i> ****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Anyway, having both the client and the server of the socket running with
</I>&gt;<i> the same user should help here.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> On Wed, May 8, 2013 at 9:58 AM, Ovidiu D &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">ovidiudeac at gmail.com</A>&gt; wrote:****
</I>&gt;<i>
</I>&gt;<i>  Looking again at our upstart scripts I see that we start the fastcgi
</I>&gt;<i> server using the same user as nginx. Can you do that?****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> If it doesn't work can you post the whole startup script for your fastcgi
</I>&gt;<i> server?****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> On Wed, May 8, 2013 at 1:58 AM, Gee &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">g.plumb at gmail.com</A>&gt; wrote:****
</I>&gt;<i>
</I>&gt;<i>    Hi Ovidiu****
</I>&gt;<i>
</I>&gt;<i> I tried TCP earlier to little avail.****
</I>&gt;<i>
</I>&gt;<i> *However*****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I tried it again anyway (just to say that I did it again) and I got a
</I>&gt;<i> YSOD/Exception (which is a start!).  After tweaking Web.config and
</I>&gt;<i> restarting nginx - my hello world actually printed 'hello world'.  It's
</I>&gt;<i> almost sad how much joy this brought me!  :-)****
</I>&gt;<i>
</I>&gt;<i> Now I know TCP does actually work (although I am not sure why it does
</I>&gt;<i> now), I can set about solving why the unix socket is behaving so
</I>&gt;<i> strangely.  I suspect that you (and the others earlier in this thread) are
</I>&gt;<i> indeed all correct about the permissions issue.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I have set about resolving it, but I can't see to get past it.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I have chmod '777' (for now) - to no avail.****
</I>&gt;<i>
</I>&gt;<i> I ran chmod a+rwx as well - to no avail.****
</I>&gt;<i>
</I>&gt;<i> I even tried a different path - sadly, to no avail!****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I am sure I am missing something obvious, although I have no idea what it
</I>&gt;<i> could be... :-(****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Any advice would be hugely appreciated!****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Thanks****
</I>&gt;<i>
</I>&gt;<i> G****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> On 7 May 2013 20:57, Ovidiu D &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">ovidiudeac at gmail.com</A>&gt; wrote:****
</I>&gt;<i>
</I>&gt;<i>  I'm pretty sure that you have a permission problem here. You should
</I>&gt;<i> double check that both the users of the nginx and mono fastcgi server
</I>&gt;<i> processes have rw access to that socket.****
</I>&gt;<i>
</I>&gt;<i> For debugging purposes you can also try to use a TCP socket instead of a
</I>&gt;<i> unix socket and once your setup works you can move back to unix sockets.**
</I>&gt;<i> **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> On Tue, May 7, 2013 at 9:56 PM, Gee &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">g.plumb at gmail.com</A>&gt; wrote:****
</I>&gt;<i>
</I>&gt;<i>   Hi ****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I am having trouble getting Mono to work with nginx.  I installed my OS
</I>&gt;<i> (OpenBSD 5.3) and set up ports.  I built mono, mono-xsp and nginx - all
</I>&gt;<i> without incident.  All three appear to be working OK, but not in
</I>&gt;<i> conjunction.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> I am trying to run a *very* simple MVC3 app - it is literally a hello
</I>&gt;<i> world controller (no fancy code whatsoever) - but I keep getting a 502 (Bad
</I>&gt;<i> gateway).  In the log, I see the following:****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> [crit] 31764#0: *1 connect() to unix:/tmp/fastcgi.socket failed (2: No
</I>&gt;<i> such file or directory) while connecting to upstream,****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> The frustrating thing here is that /tmp/fastcgi.socket does actually
</I>&gt;<i> exist.  I tried 'touch' and making sure 'www' and 'wheel' have the
</I>&gt;<i> appropriate permissions (which they do).  The result of 'ls -la
</I>&gt;<i> /tmp/fastcgi.socket' revealed nothing awry.  I tried using a different path
</I>&gt;<i> (such as '/home/socket' and '/home/fastcgi.socket'), but all to no avail.*
</I>&gt;<i> ***
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Does anyone have any ideas/hints?  Could this be a bug in the port?****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> To try and save time, here is my config:****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> worker_processes  1;****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> events {****
</I>&gt;<i>
</I>&gt;<i>     worker_connections  1024;****
</I>&gt;<i>
</I>&gt;<i> }****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> http {****
</I>&gt;<i>
</I>&gt;<i>     include       mime.types;****
</I>&gt;<i>
</I>&gt;<i>     default_type  application/octet-stream;****
</I>&gt;<i>
</I>&gt;<i>     ****
</I>&gt;<i>
</I>&gt;<i>     ****
</I>&gt;<i>
</I>&gt;<i>     server {****
</I>&gt;<i>
</I>&gt;<i>         listen 80;****
</I>&gt;<i>
</I>&gt;<i>         access_log   /home/www/nginx.log;****
</I>&gt;<i>
</I>&gt;<i>         error_log    /home/www/errors.log;****
</I>&gt;<i>
</I>&gt;<i>         ****
</I>&gt;<i>
</I>&gt;<i>         # root /home/www/test;****
</I>&gt;<i>
</I>&gt;<i>         # index index.html index.htm index.aspx default.aspx;****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i>         location ^~ /Scripts/ { }****
</I>&gt;<i>
</I>&gt;<i>         location ^~ /Content/ { }****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i>         location / {****
</I>&gt;<i>
</I>&gt;<i>             root /home/www/test;****
</I>&gt;<i>
</I>&gt;<i>             # fastcgi_index /Home/Index;****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i>             fastcgi_pass   unix:/tmp/fastcgi.socket;****
</I>&gt;<i>
</I>&gt;<i>             # include        fastcgi_params;****
</I>&gt;<i>
</I>&gt;<i>             include /etc/nginx/fastcgi_params;****
</I>&gt;<i>
</I>&gt;<i>         }****
</I>&gt;<i>
</I>&gt;<i>     }****
</I>&gt;<i>
</I>&gt;<i> }****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Thanks!****
</I>&gt;<i>
</I>&gt;<i> G****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-aspnet-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">Mono-aspnet-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list****">http://lists.ximian.com/mailman/listinfo/mono-aspnet-list****</A>
</I>&gt;<i>
</I>&gt;<i>  ** **
</I>&gt;<i>
</I>&gt;<i>  ** **
</I>&gt;<i>
</I>&gt;<i>  ** **
</I>&gt;<i>
</I>&gt;<i>  ** **
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-aspnet-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">Mono-aspnet-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list****">http://lists.ximian.com/mailman/listinfo/mono-aspnet-list****</A>
</I>&gt;<i>
</I>&gt;<i>  ** **
</I>&gt;<i>
</I>&gt;<i>  ** **
</I>&gt;<i>
</I>&gt;<i>  ** **
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20130515/15ecfa2f/attachment-0001.html">http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20130515/15ecfa2f/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001875.html">[Mono-aspnet-list] Mono + Nginx + Open BSD
</A></li>
	<LI>Next message: <A HREF="001870.html">[Mono-aspnet-list] Application randomly stops with	get_InputValidationEnabled () is inaccessible exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1878">[ date ]</a>
              <a href="thread.html#1878">[ thread ]</a>
              <a href="subject.html#1878">[ subject ]</a>
              <a href="author.html#1878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
