<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-aspnet-list] How to backup PostgreSql database from browser in MVC2 application on Mono in Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20How%20to%20backup%20PostgreSql%20database%20from%0A%20browser%20in%20MVC2%20application%20on%20Mono%20in%20Linux&In-Reply-To=%3CCAHM2DbQjzGipePp%2BBkMkToR_-LtRg2kM0wNcudSScX7rjM6UMw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001548.html">
   <LINK REL="Next"  HREF="001552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-aspnet-list] How to backup PostgreSql database from browser in MVC2 application on Mono in Linux</H1>
    <B>Daniel J. Summers</B> 
    <A HREF="mailto:mono-aspnet-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-aspnet-list%5D%20How%20to%20backup%20PostgreSql%20database%20from%0A%20browser%20in%20MVC2%20application%20on%20Mono%20in%20Linux&In-Reply-To=%3CCAHM2DbQjzGipePp%2BBkMkToR_-LtRg2kM0wNcudSScX7rjM6UMw%40mail.gmail.com%3E"
       TITLE="[Mono-aspnet-list] How to backup PostgreSql database from browser in MVC2 application on Mono in Linux">daniel.summers.2415 at gmail.com
       </A><BR>
    <I>Sat Mar 24 16:23:18 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001548.html">[Mono-aspnet-list] How to backup PostgreSql database from	browser in MVC2 application on Mono in Linux
</A></li>
        <LI>Next message: <A HREF="001552.html">[Mono-aspnet-list] How to backup PostgreSql database from	browser in MVC2 application on Mono in Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1549">[ date ]</a>
              <a href="thread.html#1549">[ thread ]</a>
              <a href="subject.html#1549">[ subject ]</a>
              <a href="author.html#1549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm not at home, so it's tough to look up - can you specify the response
output stream as the target for the standard output redirection for the
process?  If so, that would connect the two, and you'd likely not even need
to read from the process and write to the output.  You might need to fiddle
with the flush interval for the stream, so it doesn't try to accrue the
whole result before writing it.

Alternately, if you can't do that, get rid of the &quot;var b2&quot; declaration and
just write the process.StandardOutput.ReadToEnd() call; you don't need to
allocate that space to write it.  You can also call Response.Flush() after
each write; this will send the current buffer to the browser, which frees
that memory (or at least makes it available to be freed).

This is an interesting piece of code.  On-demand downloadable Postgres
backups would be pretty cool.  :)  Be sure to post the final working code!
On Mar 24, 2012 9:53 AM, &quot;Andrus&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">kobruleht2 at hot.ee</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>  <A HREF="http://msdn.microsoft.com/en-**us/library/system.web.**httpserverutility.">http://msdn.microsoft.com/en-**us/library/system.web.**httpserverutility.</A>
</I>&gt;&gt;<i> **scripttimeout.aspx&lt;<A HREF="http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.scripttimeout.aspx">http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.scripttimeout.aspx</A>&gt;
</I>&gt;&gt;<i> Looks like you could set it as part of the Action. :)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I tried code below but it tries to read whole result to memory and causes
</I>&gt;<i> out of memory exception.
</I>&gt;<i> How to change it to be pipe ?
</I>&gt;<i>
</I>&gt;<i> Andrus.
</I>&gt;<i>
</I>&gt;<i>   [Authorize]
</I>&gt;<i>   public class BackupController : ControllerBase
</I>&gt;<i>   {
</I>&gt;<i>       [AcceptVerbs(HttpVerbs.Get)]
</I>&gt;<i>       public ActionResult BackupPipe()
</I>&gt;<i>       {
</I>&gt;<i>           Response.ClearContent();
</I>&gt;<i>           Response.AddHeader(&quot;content-**disposition&quot;,
</I>&gt;<i> string.Format(&quot;attachment; filename=\&quot;backup.backup\&quot;&quot;);
</I>&gt;<i>           Response.ContentType = &quot;application/backup&quot;;
</I>&gt;<i>           using (var process = new Process())
</I>&gt;<i>           {
</I>&gt;<i>               process.StartInfo.Arguments =&quot; -ib -Z6 -Fc -h \&quot;1.2.3.4\&quot; -U
</I>&gt;<i> \&quot;&quot;;
</I>&gt;<i>               process.StartInfo.FileName = &quot;usr/bin/pgsql/pg_dump&quot;;
</I>&gt;<i>               process.StartInfo.**UseShellExecute = false;
</I>&gt;<i>               process.StartInfo.**RedirectStandardOutput = true;
</I>&gt;<i>               Server.ScriptTimeout = 8*60*60; // 8 hours
</I>&gt;<i>               process.Start();
</I>&gt;<i>               while (!process.HasExited)
</I>&gt;<i>               {
</I>&gt;<i>                   var b = process.StandardOutput.**ReadToEnd();
</I>&gt;<i>                   Response.Write(b);
</I>&gt;<i>                   Thread.Sleep(2000);
</I>&gt;<i>               }
</I>&gt;<i>               process.WaitForExit();
</I>&gt;<i>               if (process.ExitCode != 0)
</I>&gt;<i>               {
</I>&gt;<i>                   return new ContentResult()
</I>&gt;<i>                   {
</I>&gt;<i>                       Content = &quot;Error &quot; + process.ExitCode.ToString()
</I>&gt;<i>                   };
</I>&gt;<i>               }
</I>&gt;<i>               var b2 = process.StandardOutput.**ReadToEnd();
</I>&gt;<i>               Response.Write(b2);
</I>&gt;<i>               process.Close();
</I>&gt;<i>               Response.End();
</I>&gt;<i>               return null;
</I>&gt;<i>           }
</I>&gt;<i>       }
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> Mono-aspnet-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">Mono-aspnet-list at lists.ximian.</A>**com &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">Mono-aspnet-list at lists.ximian.com</A>&gt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/**mailman/listinfo/mono-aspnet-**list&lt;http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">http://lists.ximian.com/**mailman/listinfo/mono-aspnet-**list&lt;http://lists.ximian.com/mailman/listinfo/mono-aspnet-list</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20120324/d247fbce/attachment.html">http://lists.ximian.com/pipermail/mono-aspnet-list/attachments/20120324/d247fbce/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001548.html">[Mono-aspnet-list] How to backup PostgreSql database from	browser in MVC2 application on Mono in Linux
</A></li>
	<LI>Next message: <A HREF="001552.html">[Mono-aspnet-list] How to backup PostgreSql database from	browser in MVC2 application on Mono in Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1549">[ date ]</a>
              <a href="thread.html#1549">[ thread ]</a>
              <a href="subject.html#1549">[ subject ]</a>
              <a href="author.html#1549">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-aspnet-list">More information about the Mono-aspnet-list
mailing list</a><br>
</body></html>
