<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dotnet-runtime-dev] Span&lt;T&gt; Spec
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:dotnet-runtime-dev%40lists.dot.net?Subject=Re%3A%20%5BDotnet-runtime-dev%5D%20Span%3CT%3E%20Spec&In-Reply-To=%3CCABoMf7%3Dgwg1u2CY26E1No9wedGw3giFaDbDg%2BNDxXHrKYiMTPQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000026.html">
   <LINK REL="Next"  HREF="000024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dotnet-runtime-dev] Span&lt;T&gt; Spec</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:dotnet-runtime-dev%40lists.dot.net?Subject=Re%3A%20%5BDotnet-runtime-dev%5D%20Span%3CT%3E%20Spec&In-Reply-To=%3CCABoMf7%3Dgwg1u2CY26E1No9wedGw3giFaDbDg%2BNDxXHrKYiMTPQ%40mail.gmail.com%3E"
       TITLE="[Dotnet-runtime-dev] Span&lt;T&gt; Spec">miguel.de.icaza at gmail.com
       </A><BR>
    <I>Mon Oct 24 16:13:54 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000026.html">[Dotnet-runtime-dev] Span&lt;T&gt; Spec
</A></li>
        <LI>Next message (by thread): <A HREF="000024.html">[Dotnet-runtime-dev] Span&lt;T&gt; Spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21">[ date ]</a>
              <a href="thread.html#21">[ thread ]</a>
              <a href="subject.html#21">[ subject ]</a>
              <a href="author.html#21">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

This is an excellent proposal.

Some comments here:

*Problematic Construct*

In a few places in the text, constructs like this are shown:

var bytesFromStringSlice = &quot;content-length:123&quot;.Slice(15).As&lt;byte&gt;();


That does not look like it will build with the proposal as-is.

It is a little confusing for a couple of reasons, this would assume some
sort of implicit conversion from string to some data type which has a Slice
method, followed by some sort of As&lt;byte&gt; cast.

Perhaps the intention was to make strings implicitly convertible to
ReadOnlySpan&lt;byte&gt;?   In that case, the As&lt;byte&gt; would be redundant.   And
in that case, the question is whether the string is encoded in UTF-16 or
UTF-8.   The sample seems to imply that it would be UTF-16.

If the intention is to extend the C# language for this sort of conversions,
I would like to make the default UTF-8 instead (these is a separate thread
[1] which introduces implicit conversions from strings to byte arrays and
byte pointers).

*Native Code Interop *

The proposal mentions a potential benefit of Span&lt;T&gt; for interop, but does
not go into the details.  I assume that the intention is to add support for
P/Invoke to marshal Span&lt;T&gt; as a pointer to the start of T and in the cases
where the contents point to a managed object that the object would be
pinned?

*Choosing the Span&lt;T&gt; implementation (Platform Support Plans)*

There will be two implementations of Span&lt;T&gt;, one for existing platforms,
and one for platforms that have been updated to have &quot;ref T&quot; pointers.   I
wonder what the plan will be to ship this out.

With my mobile hat on, my desire would be to have the Nuget for Span&lt;T&gt;
forward on mobile to the mobile implementations so we can start with the
lesser implementation and have control of when to upgrade to the lighter
implementation when the support rolls in.

*99% and 1%*

I do not know how many of our users will be 99% vs 1% users of Span, I
would hate the numbers on this doc and the portrayal of our users to
established through this.

In my experience, there are many times in application code where I could
have used Span&lt;T&gt; over the years, and I was not likely building
high-performance code.   It would just have been tremendously useful.

*Question: Conversions*

On the source code, it says that the Cast&lt;U,T&gt; will be enforced by a Roslyn
analyzer.   I do not understand why the &quot;where&quot; clause in the generic is
insufficient.

[1]
<A HREF="http://lists.dot.net/pipermail/dotnet-runtime-dev/2016-September/000013.html">http://lists.dot.net/pipermail/dotnet-runtime-dev/2016-September/000013.html</A>

Miguel.




On Fri, Oct 21, 2016 at 7:28 PM, Immo Landwerth via Dotnet-runtime-dev &lt;
<A HREF="http://lists.dot.net/mailman/listinfo/dotnet-runtime-dev">dotnet-runtime-dev at lists.dot.net</A>&gt; wrote:

&gt;<i> Krzysztof has uploaded the proposed spec for Span&lt;T&gt; here:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://github.com/dotnet/corefxlab/blob/master/docs/Span.md">https://github.com/dotnet/corefxlab/blob/master/docs/Span.md</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Questions or concerns?
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Dotnet-runtime-dev mailing list
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/dotnet-runtime-dev">Dotnet-runtime-dev at lists.dot.net</A>
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/dotnet-runtime-dev">http://lists.dot.net/mailman/listinfo/dotnet-runtime-dev</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/dotnet-runtime-dev/attachments/20161024/c26f1eb2/attachment.html">http://lists.dot.net/pipermail/dotnet-runtime-dev/attachments/20161024/c26f1eb2/attachment.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000026.html">[Dotnet-runtime-dev] Span&lt;T&gt; Spec
</A></li>
	<LI>Next message (by thread): <A HREF="000024.html">[Dotnet-runtime-dev] Span&lt;T&gt; Spec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21">[ date ]</a>
              <a href="thread.html#21">[ thread ]</a>
              <a href="subject.html#21">[ subject ]</a>
              <a href="author.html#21">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/dotnet-runtime-dev">More information about the Dotnet-runtime-dev
mailing list</a><br>
</body></html>
