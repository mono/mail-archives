<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-vb] Patch for mbas for ByRef parameters from a DLL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bernard%40ugs.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000218.html">
   <LINK REL="Next"  HREF="000219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-vb] Patch for mbas for ByRef parameters from a DLL
   </H1>
    <B>Bernie Solomon
    </B> 
    <A HREF="mailto:bernard%40ugs.com"
       TITLE="[mono-vb] Patch for mbas for ByRef parameters from a DLL">bernard@ugs.com
       </A><BR>
    <I>Tue, 3 Aug 2004 17:05:47 -0700</I>
    <P><UL>
        <LI> Previous message: <A HREF="000218.html">[mono-vb] Patch for mbas for ByRef parameters from a DLL
</A></li>
        <LI> Next message: <A HREF="000219.html">[mono-vb] Patches for bugs 62234 and 62235
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#221">[ date ]</a>
              <a href="thread.html#221">[ thread ]</a>
              <a href="subject.html#221">[ subject ]</a>
              <a href="author.html#221">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a multi-part message in MIME format.

------=_NextPart_000_0007_01C4797C.1F145BB0
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: 7bit

This is my proposed test for my change. Just posting it because of
the Makefile changes and if they are OK. I have added some source
for support DLLs and have them built first and referenced by the later
.EXE builds.

I also attach the new test files which are really simple so far.

Note I may not check in the enum bit of the change as I've found
other issues with enum handling and suspect it is in the wrong place
(my guess is the enum type should be preserved longer than it
seems to be at the moment).

Bernie Solomon
----- Original Message ----- 
From: &quot;Jambunathan Jambunathan&quot; &lt;<A HREF="mailto:kjambunathan@novell.com">kjambunathan@novell.com</A>&gt;
To: &lt;<A HREF="mailto:mono-vb@lists.ximian.com">mono-vb@lists.ximian.com</A>&gt;; &lt;<A HREF="mailto:bernard@ugs.com">bernard@ugs.com</A>&gt;
Sent: Tuesday, August 03, 2004 2:43 AM
Subject: Re: [mono-vb] Patch for mbas for ByRef parameters from a DLL


&gt;<i> &gt; Also I was trying to get the tests going as they were before
</I>&gt;<i> &gt; changing them and found that seem to fail compilation
</I>&gt;<i> &gt; for me (e.g. LongTypeCharTestA.vb).
</I>&gt;<i> 
</I>&gt;<i> It apparently has nothing to do with your patch. The test fails
</I>&gt;<i> in my work area as well and my work area doesn't have your
</I>&gt;<i> patch.
</I>&gt;<i> 
</I>&gt;<i> &gt; confused as to what the current state of tests was and how
</I>&gt;<i> &gt; I could tell if I broke anything.
</I>&gt;<i> 
</I>&gt;<i> Under mcs/btests there is Readme that should provide some
</I>&gt;<i> information to go about. This is just a bare bone doc and we 
</I>&gt;<i> are exploring ways of running/reporting of test cases
</I>&gt;<i> better.
</I>&gt;<i> 
</I>&gt;<i> Currently there are number of test cases that break. One 
</I>&gt;<i> approach that you could take is run a 'make all' under mcs/btests
</I>&gt;<i> and save the results.out file and then diff this against the new  
</I>&gt;<i> results.out after yourchanges. 
</I>&gt;<i> 
</I>&gt;<i> This is the approach we take. Painful but that's the way it is now.
</I>&gt;<i> 
</I>&gt;<i> &gt; I can check in the code without the tests but thought I'd
</I>&gt;<i> &gt; try and do both at once.
</I>&gt;<i> 
</I>&gt;<i> The right way to go.
</I>&gt;<i> 
</I>&gt;<i> So hope to see your patches and test cases soon.
</I>&gt;<i> 
</I>&gt;<i> Thanks a lot.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Jambunathan K.
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt;&gt; &quot;Bernie Solomon&quot; &lt;<A HREF="mailto:bernard@ugs.com">bernard@ugs.com</A>&gt; 8/2/2004 10:15:49 PM &gt;&gt;&gt;
</I>&gt;<i> There were a couple of reasons I hadn't checked this in yet.
</I>&gt;<i> 
</I>&gt;<i> Being a little busy was one but there were some technical
</I>&gt;<i> reasons too.
</I>&gt;<i> 
</I>&gt;<i> In order to check in tests I need to modify the test setup
</I>&gt;<i> so that there are some separate DLLs built as well as individual
</I>&gt;<i> EXEs and I hadn't got round to do that yet (my original tests
</I>&gt;<i> I did by hand).
</I>&gt;<i> 
</I>&gt;<i> Also I was trying to get the tests going as they were before
</I>&gt;<i> changing them and found that seem to fail compilation
</I>&gt;<i> for me (e.g. LongTypeCharTestA.vb) and was then a little
</I>&gt;<i> confused as to what the current state of tests was and how
</I>&gt;<i> I could tell if I broke anything. Can you explain the setup or
</I>&gt;<i> is it my setup is broken and this should compile?
</I>&gt;<i> 
</I>&gt;<i> I can check in the code without the tests but thought I'd
</I>&gt;<i> try and do both at once.
</I>&gt;<i> 
</I>&gt;<i> Bernie
</I>&gt;<i> 
</I>&gt;<i> ----- Original Message ----- 
</I>&gt;<i> From: &quot;Jambunathan Jambunathan&quot; &lt;<A HREF="mailto:kjambunathan@novell.com">kjambunathan@novell.com</A>&gt;
</I>&gt;<i> To: &lt;<A HREF="mailto:mono-vb@lists.ximian.com">mono-vb@lists.ximian.com</A>&gt;; &lt;<A HREF="mailto:bernard@ugsolutions.com">bernard@ugsolutions.com</A>&gt;
</I>&gt;<i> Sent: Monday, August 02, 2004 5:24 AM
</I>&gt;<i> Subject: Re: [mono-vb] Patch for mbas for ByRef parameters from a DLL
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; Bernie
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; We can integrate this patch in to cvs on behalf of you. But 
</I>&gt;<i> &gt; nevertheless if you could mail us your test cases we will be
</I>&gt;<i> &gt; reassured that the patch really works.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I am sure you have test samples that you used for testing the
</I>&gt;<i> &gt; patch still lurking in your work area. Just grab it and mail across 
</I>&gt;<i> &gt; to us.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks once again for the patch.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; Jambunathan K.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt;&gt;&gt; &quot;Bernie Solomon&quot; &lt;<A HREF="mailto:bernard@ugsolutions.com">bernard@ugsolutions.com</A>&gt; 7/28/2004 11:37:12 PM
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; Here's a refinement which also allows use of enums declared in other
</I>&gt;<i> &gt; DLLs
</I>&gt;<i> &gt; (includes
</I>&gt;<i> &gt; the previous patch too).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Bernie
</I>&gt;<i> &gt; ----- Original Message ----- 
</I>&gt;<i> &gt; From: &quot;Solomon, Bernard&quot; &lt;<A HREF="mailto:bernard.solomon@ugs.com">bernard.solomon@ugs.com</A>&gt;
</I>&gt;<i> &gt; To: &lt;<A HREF="mailto:mono-vb@lists.ximian.com">mono-vb@lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; Sent: Wednesday, July 28, 2004 10:37 AM
</I>&gt;<i> &gt; Subject: [mono-vb] Patch for mbas for ByRef parameters from a DLL
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [mono-vb] Patch for mbas for ByRef parameters from a DLLI attach a
</I>&gt;<i> &gt; patch so
</I>&gt;<i> &gt; that you can call methods in a referenced DLL that take
</I>&gt;<i> &gt; reference parameters and things compile. To do this I have made
</I>&gt;<i> &gt; ReflectionParameters return similar data to InternalParameters for
</I>&gt;<i> &gt; ByRef
</I>&gt;<i> &gt; parameters - and also use them when GetFullParameters doesn't return
</I>&gt;<i> &gt; anything (presumably currently you can't call a method with optional
</I>&gt;<i> &gt; parameters in a different DLL).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Since I haven't done anything inside mbas before I may not have done
</I>&gt;<i> &gt; this in
</I>&gt;<i> &gt; the right way. But if it is OK I can commit this.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Presumably a test case might be good but I am not quite sure where
</I>&gt;<i> to
</I>&gt;<i> &gt; add
</I>&gt;<i> &gt; this.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Bernie Solomon
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-vb mailing list
</I>&gt;<i> &gt; <A HREF="mailto:Mono-vb@lists.ximian.com">Mono-vb@lists.ximian.com</A> 
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">http://lists.ximian.com/mailman/listinfo/mono-vb</A> 
</I>&gt;<i> &gt; 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-vb mailing list
</I>&gt;<i> <A HREF="mailto:Mono-vb@lists.ximian.com">Mono-vb@lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">http://lists.ximian.com/mailman/listinfo/mono-vb</A>
</I>&gt;<i> 
</I>------=_NextPart_000_0007_01C4797C.1F145BB0
Content-Type: text/plain;
	name=&quot;Import1.vb&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;Import1.vb&quot;

Imports System=0A=
Imports Dll1=0A=
=0A=
Module Test=0A=
Sub Main=0A=
    Dim i As Integer=0A=
    Dll1.OutInt(i)=0A=
    If i &lt;&gt; 123 Then=0A=
        Throw New Exception(&quot;#A1: Wrong value returned: &quot; &amp; i.ToString())=0A=
    End If=0A=
End Sub=0A=
End Module=0A=

------=_NextPart_000_0007_01C4797C.1F145BB0
Content-Type: text/plain;
	name=&quot;Dll1.vb&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;Dll1.vb&quot;

Imports System=0A=
=0A=
Public Class Dll1=0A=
=0A=
Public Shared Sub OutInt(ByRef i As Integer)=0A=
    i =3D 123=0A=
End Sub=0A=
=0A=
End Class=0A=
=0A=
=0A=

------=_NextPart_000_0007_01C4797C.1F145BB0
Content-Type: text/plain;
	name=&quot;btests.diff.txt&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;btests.diff.txt&quot;

Index: Makefile=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvs/public/mcs/btests/Makefile,v=0A=
retrieving revision 1.8=0A=
diff -u -p -r1.8 Makefile=0A=
--- Makefile	11 Jun 2004 09:22:59 -0000	1.8=0A=
+++ Makefile	3 Aug 2004 22:47:52 -0000=0A=
@@ -1,7 +1,8 @@=0A=
 thisdir =3D btests=0A=
 SUBDIRS =3D =0A=
 TEST_RUNTIME =3D mono=0A=
-COMPILER_FLAGS =3D /libpath:../class/lib/default/ /imports:System=0A=
+COMPILER_FLAGS =3D /libpath:../class/lib/default/ /imports:System =0A=
+EXE_FLAGS =3D /r:./Dll1.dll=0A=
 INTERNAL_MBAS =3D $(TEST_RUNTIME) --debug ../mbas/mbas.exe --stacktrace =
$(COMPILER_FLAGS)=0A=
 #INTERNAL_MBAS =3D vbc $(COMPILER_FLAGS)=0A=
 all: test-compiler-jit =0A=
@@ -37,15 +38,34 @@ run-test-local: test-compiler-jit =0A=
 test-compiler-jit: test-compiler-jit-real =
test-compiler-jit-ngtive_compile \=0A=
 test-compiler-jit-ngtive_run=0A=
 =0A=
-=0A=
-test-compiler-jit-real:=0A=
-	@rm -f *.exe *.out ; \=0A=
-	/bin/echo &quot;********** Positive Tests ************&quot; &gt; results.out; \=0A=
+test-dlls:=0A=
+	@rm -f *.dll *.out ; \=0A=
+	/bin/echo &quot;********** Support DLLs ************&quot; &gt; results.out; \=0A=
+	/bin/echo &quot;********** Support DLLs ************&quot; ; \=0A=
+	for i in $(TEST_DLL_SOURCES) ; do \=0A=
+		/bin/echo -n -e =
&quot;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
\n$$i: &quot; &gt;&gt; results.out; \=0A=
+		/bin/echo -n &quot;$$i: &quot;; \=0A=
+		if $(INTERNAL_MBAS) /target:library $$i.vb 1&gt;output ; then \=0A=
+			/bin/echo &quot;COMPILED OK&quot; &gt;&gt; results.out; \=0A=
+			/bin/echo &quot;COMPILED OK&quot; ;\=0A=
+			true ; \=0A=
+		else \=0A=
+			/bin/echo  -e &quot;FAILED COMPILATION&quot; &gt;&gt; results.out; \=0A=
+			cat output &gt;&gt; results.out; \=0A=
+			/bin/echo FAILED COMPILATION ;  \=0A=
+			continue;\=0A=
+		fi ; \=0A=
+	done; \=0A=
+	/bin/echo =
&quot;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
&quot; &gt;&gt; results.out=0A=
+=0A=
+test-compiler-jit-real: test-dlls=0A=
+	@rm -f *.exe ; \=0A=
+	/bin/echo &quot;********** Positive Tests ************&quot; &gt;&gt; results.out; \=0A=
 	/bin/echo &quot;********** Positive Tests ************&quot; ; \=0A=
 	for i in $(TEST_SOURCES) ; do \=0A=
 		/bin/echo -n -e =
&quot;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
\n$$i: &quot; &gt;&gt; results.out; \=0A=
 	    /bin/echo -n &quot;$$i: &quot;; \=0A=
-	    if $(INTERNAL_MBAS) $$i.vb 1&gt;output ; then \=0A=
+	    if $(INTERNAL_MBAS) $(EXE_FLAGS) $$i.vb 1&gt;output ; then \=0A=
             /bin/echo -n &quot;COMPILED OK : &quot; &gt;&gt; results.out; \=0A=
 	        /bin/echo -n &quot;COMPILED OK : &quot; ;\=0A=
 			true ; \=0A=
Index: Test.Sources=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
RCS file: /cvs/public/mcs/btests/Test.Sources,v=0A=
retrieving revision 1.20=0A=
diff -u -p -r1.20 Test.Sources=0A=
--- Test.Sources	1 Aug 2004 13:49:31 -0000	1.20=0A=
+++ Test.Sources	3 Aug 2004 22:47:52 -0000=0A=
@@ -1,4 +1,11 @@=0A=
 #=0A=
+# Support DLL source files go here=0A=
+#=0A=
+=0A=
+TEST_DLL_SOURCES =3D \=0A=
+Dll1=0A=
+=0A=
+#=0A=
 # All positive test cases goes here=0A=
 #=0A=
 =0A=
@@ -11,6 +18,7 @@ Test1 \=0A=
 Test2 \=0A=
 misc2 \=0A=
 Identifier \=0A=
+Import1 \=0A=
 IntegerTypeCharTest\=0A=
 IntegerTypeCharTestA \=0A=
 IntegerTypeCharTestB \=0A=

------=_NextPart_000_0007_01C4797C.1F145BB0--


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000218.html">[mono-vb] Patch for mbas for ByRef parameters from a DLL
</A></li>
	<LI> Next message: <A HREF="000219.html">[mono-vb] Patches for bugs 62234 and 62235
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#221">[ date ]</a>
              <a href="thread.html#221">[ thread ]</a>
              <a href="subject.html#221">[ subject ]</a>
              <a href="author.html#221">[ author ]</a>
         </LI>
       </UL>
</body></html>
