<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-vb] Need a second opinion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-vb%40lists.ximian.com?Subject=%5Bmono-vb%5D%20Need%20a%20second%20opinion&In-Reply-To=4C535EEB.4060005%40hailmail.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001200.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-vb] Need a second opinion</H1>
    <B>Rolf Bjarne Kvinge</B> 
    <A HREF="mailto:mono-vb%40lists.ximian.com?Subject=%5Bmono-vb%5D%20Need%20a%20second%20opinion&In-Reply-To=4C535EEB.4060005%40hailmail.net"
       TITLE="[mono-vb] Need a second opinion">rolflists at ya.com
       </A><BR>
    <I>Mon Aug  2 08:20:29 EDT 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001200.html">[mono-vb] Performance testing in Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1199">[ date ]</a>
              <a href="thread.html#1199">[ thread ]</a>
              <a href="subject.html#1199">[ subject ]</a>
              <a href="author.html#1199">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The simple answer is that if it works on windows but not in mono, it's
generally a mono bug and you should file a bug (<A HREF="http://bugzilla.novell.com">http://bugzilla.novell.com</A>).

Of course things aren't always simple, but I don't know anything about the
area you're asking about, so I can't be more specific. I'd file a bug in any
case, worst case it'll just be closed as not being a bug.

Rolf

&gt;<i>-----Original Message-----
</I>&gt;<i>From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">mono-vb-bounces at lists.ximian.com</A> [mailto:mono-vb-
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">bounces at lists.ximian.com</A>] On Behalf Of Quandary
</I>&gt;<i>Sent: s&#225;bado, 31 de julio de 2010 1:23
</I>&gt;<i>To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">mono-vb at lists.ximian.com</A>
</I>&gt;<i>Subject: [mono-vb] Need a second opinion
</I>&gt;<i>
</I>&gt;<i>  I'd like to have a second opinon on encoding problem:
</I>&gt;<i>
</I>&gt;<i>Basically it's C# and not VB, but since it concerns the mono-runtime, it's
</I>just
&gt;<i>as relevant here.
</I>&gt;<i>
</I>&gt;<i>I've downloaded and tried to run
</I>&gt;<i><A HREF="http://www.lumisoft.ee/lswww/Download/Downloads/MailServer/">http://www.lumisoft.ee/lswww/Download/Downloads/MailServer/</A>
</I>&gt;<i>on my Ubuntu 10.04 server.
</I>&gt;<i>
</I>&gt;<i>The author claims he has tested it on Suse Linux with the  0.94 release,
</I>and
&gt;<i>that it worked.
</I>&gt;<i>However, I had to correct all the bugs listed here to get the latest
</I>version
&gt;<i>working:
</I>&gt;<i><A HREF="http://www.lumisoft.ee/Forum/default.aspx?g=posts&amp;t=673">http://www.lumisoft.ee/Forum/default.aspx?g=posts&amp;t=673</A>
</I>&gt;<i>&lt;<A HREF="http://www.lumisoft.ee/Forum/default.aspx?g=posts&amp;t=673">http://www.lumisoft.ee/Forum/default.aspx?g=posts&amp;t=673</A>&gt;
</I>&gt;<i>
</I>&gt;<i>I was debugging (without step-through...) this issue all friday evening,
</I>until I
&gt;<i>found the reason.
</I>&gt;<i>It turned out the &quot;bug&quot; was the way the Mailserver's developer converted
</I>&gt;<i>the HmacMd5 to a hex string...
</I>&gt;<i>Now in my opinion, his line:
</I>&gt;<i>return
</I>&gt;<i>Encoding.Default.GetString(kMd5.ComputeHash(Encoding.ASCII.GetBytes(ha
</I>&gt;<i>shKey)));
</I>&gt;<i>is plain wrong, because this causes the byte array to be converted into a
</I>&gt;<i>different encoding on each operating system (1252 on my windows 7,
</I>&gt;<i>UTF-8 on Ubuntu), and the mailserver's programmer then calculates the hex
</I>&gt;<i>string from the string hash with the operating-system specific encoding.
</I>&gt;<i>
</I>&gt;<i>Now since it works with the encoding change on Windows (but not on Linux),
</I>&gt;<i>I'm not sure anymore whether I am right, or whether the server's
</I>&gt;<i>programmer is right, which would mean that the encoding-bug is a bug in
</I>&gt;<i>mono.
</I>&gt;<i>
</I>&gt;<i>I've isolated the code in question below, just switch bCorrectedVersion
</I>&gt;<i>between true and false, and watch how the hash is different on Windows vs.
</I>&gt;<i>Linux when one switches bCorrectedVersion to false...
</I>&gt;<i>BTW, this is the hash used to authenticate pop3/smtp, so it definitely is
</I>not
&gt;<i>good when it's different...
</I>&gt;<i>(That was the issue that kept all my get/send mail request to and from the
</I>&gt;<i>server failing, because authentication failed...)
</I>&gt;<i>
</I>&gt;<i>Who is right ?
</I>&gt;<i>
</I>&gt;<i>Below is the code in question to reproduce the issue:
</I>&gt;<i>
</I>&gt;<i>private void button1_Click(object sender, EventArgs e)
</I>&gt;<i>         {
</I>&gt;<i>             string m_Key = &quot;TestKey1&quot;;
</I>&gt;<i>             string result_Password = &quot;TestUser1&quot;;
</I>&gt;<i>             string hash = &quot;&quot;;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>             bool bCorrectedVersion = true;
</I>&gt;<i>             if(bCorrectedVersion)
</I>&gt;<i>                 hash = HmacMd5_corrected(m_Key, result_Password);
</I>&gt;<i>             else
</I>&gt;<i>                 hash = Net_Utils_ToHex(HmacMd5(m_Key, result_Password));
</I>&gt;<i>
</I>&gt;<i>             this.textBox2.Text = &quot;Hash: &quot; + hash;
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>         public static string Net_Utils_ToHex(string text)
</I>&gt;<i>         {
</I>&gt;<i>             if (text == null)
</I>&gt;<i>             {
</I>&gt;<i>                 throw new ArgumentNullException(&quot;text&quot;);
</I>&gt;<i>             }
</I>&gt;<i>             // Default encoding: Windows 1252, Linux UTF-8
</I>&gt;<i>             return
</I>&gt;<i>BitConverter.ToString(Encoding.Default.GetBytes(text)).ToLower().Replace(&quot;
</I>&gt;<i>-&quot;,&quot;&quot;);
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         // corrected version of original
</I>&gt;<i>         private string HmacMd5_corrected(string hashKey, string text)
</I>&gt;<i>         {
</I>&gt;<i>             System.Security.Cryptography.HMACMD5 kMd5 = new
</I>&gt;<i>System.Security.Cryptography.HMACMD5(Encoding.Default.GetBytes(text));
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>             string strHash = &quot;&quot;;
</I>&gt;<i>             foreach (byte x in
</I>&gt;<i>kMd5.ComputeHash(Encoding.ASCII.GetBytes(hashKey)))
</I>&gt;<i>             {
</I>&gt;<i>                 strHash += x.ToString(&quot;x2&quot;);
</I>&gt;<i>
</I>&gt;<i>             }
</I>&gt;<i>             return strHash;
</I>&gt;<i>             //return
</I>&gt;<i>Encoding.Default.GetString(kMd5.ComputeHash(Encoding.ASCII.GetBytes(ha
</I>&gt;<i>shKey)));
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         // original
</I>&gt;<i>         private string HmacMd5(string hashKey, string text)
</I>&gt;<i>         {
</I>&gt;<i>             System.Security.Cryptography.HMACMD5 kMd5 = new
</I>&gt;<i>System.Security.Cryptography.HMACMD5(Encoding.Default.GetBytes(text));
</I>&gt;<i>
</I>&gt;<i>             return
</I>&gt;<i>Encoding.Default.GetString(kMd5.ComputeHash(Encoding.ASCII.GetBytes(ha
</I>&gt;<i>shKey)));
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-vb mailing list
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">Mono-vb at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">http://lists.ximian.com/mailman/listinfo/mono-vb</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001200.html">[mono-vb] Performance testing in Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1199">[ date ]</a>
              <a href="thread.html#1199">[ thread ]</a>
              <a href="subject.html#1199">[ subject ]</a>
              <a href="author.html#1199">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-vb">More information about the Mono-vb
mailing list</a><br>
</body></html>
