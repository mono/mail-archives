<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-vb] Implementation of Financial vb module
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:Rob.Tillie%40Student.tUL.EDU">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000078.html">
   <LINK REL="Next"  HREF="000080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-vb] Implementation of Financial vb module
   </H1>
    <B>Rob.Tillie@Student.tUL.EDU
    </B> 
    <A HREF="mailto:Rob.Tillie%40Student.tUL.EDU"
       TITLE="[mono-vb] Implementation of Financial vb module">Rob.Tillie@Student.tUL.EDU
       </A><BR>
    <I>Mon, 14 Jun 2004 20:14:59 +0200</I>
    <P><UL>
        <LI> Previous message: <A HREF="000078.html">[mono-vb] FileSystem implementation
</A></li>
        <LI> Next message: <A HREF="000080.html">[mono-vb] Implementation of Financial vb module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79">[ date ]</a>
              <a href="thread.html#79">[ thread ]</a>
              <a href="subject.html#79">[ subject ]</a>
              <a href="author.html#79">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_000_01C4523B.80DC8420
Content-Type: text/plain

Here's a repost, I corrected all the formatting things and added the error
messages to VBUtils.txt.
No repost for the unit tests.

Could someone plz commit?

Greetz,
-- Rob.

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Andreas Nahr [mailto:<A HREF="mailto:ClassDevelopment@A-SoftTech.com">ClassDevelopment@A-SoftTech.com</A>]
</I>&gt;<i> Sent: Monday, June 14, 2004 12:45 AM
</I>&gt;<i> To: <A HREF="mailto:Rob.Tillie@Student.tUL.EDU">Rob.Tillie@Student.tUL.EDU</A>; <A HREF="mailto:mono-vb@lists.ximian.com">mono-vb@lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [mono-vb] Implementation of Financial vb module
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I've just looked over your patch from the formatting point of view (some
</I>&gt;<i> examples):
</I>&gt;<i> 
</I>&gt;<i> -namespace Microsoft.VisualBasic
</I>&gt;<i> +namespace Microsoft.VisualBasic
</I>&gt;<i> + &lt;-- Line not needed
</I>&gt;<i>  {
</I>&gt;<i>   [StandardModule]
</I>&gt;<i>   sealed public class Financial {
</I>&gt;<i> @@ -19,32 +43,331 @@
</I>&gt;<i>    private Financial() {} &lt;-- Extend to three lines
</I>&gt;<i> 
</I>&gt;<i> +  public static System.Double DDB (System.Double Cost, System.Double
</I>&gt;<i> Salvage, System.Double Life, System.Double Period,
</I>&gt;<i> [System.Runtime.InteropServices.Optional]
</I>&gt;<i> [System.ComponentModel.DefaultValue(2)] System.Double Factor)
</I>&gt;<i> Should be:
</I>&gt;<i> +  public static double DDB (double Cost, double Salvage, double Life,
</I>&gt;<i> double Period, [Optional, DefaultValue (2)] double Factor)
</I>&gt;<i> 
</I>&gt;<i> throw new ArgumentException (&quot;Argument 'Per' is not valid&quot;);
</I>&gt;<i> Should be:
</I>&gt;<i> throw new ArgumentException (Locale.GetText (&quot;Invalid argument value.&quot;),
</I>&gt;<i> &quot;Per&quot;);
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Also Tab is correct for spacing, however at various places tabs and spaces
</I>&gt;<i> are mixed, but only tabs should be used.
</I>&gt;<i> 
</I>&gt;<i> Andreas
</I>&gt;<i> 
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i> From: &lt;<A HREF="mailto:Rob.Tillie@Student.tUL.EDU">Rob.Tillie@Student.tUL.EDU</A>&gt;
</I>&gt;<i> To: &lt;<A HREF="mailto:mono-vb@lists.ximian.com">mono-vb@lists.ximian.com</A>&gt;
</I>&gt;<i> Sent: Saturday, June 12, 2004 1:17 PM
</I>&gt;<i> Subject: [mono-vb] Implementation of Financial vb module
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; Hello all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Because of the complexity of FileSystem, I implemented Financial first
</I>&gt;<i> &gt; together with unit tests, to get a feel for Mono and its formatting.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It is largely copied from the MainSoft code, but I corrected a few
</I>&gt;<i> &gt; implementation differences with MS.NET.
</I>&gt;<i> &gt; Everything works like on MS.NET now.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Because this is my first contribution, I would love to get some feedback
</I>&gt;<i> on
</I>&gt;<i> &gt; what I have done wrong, especially concerning formatting.
</I>&gt;<i> &gt; I used the tab character now for tabs, couldn't figure out if I was
</I>&gt;<i> supposed
</I>&gt;<i> &gt; to use tab character or spaces.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The formatting of FileSystem is pretty screwed up, could someone fix
</I>&gt;<i> this
</I>&gt;<i> or
</I>&gt;<i> &gt; could I post a formatting patch?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Greetz,
</I>&gt;<i> &gt; -- Rob.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>

------_=_NextPart_000_01C4523B.80DC8420
Content-Type: application/octet-stream;
	name=&quot;Financial.patch&quot;
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename=&quot;Financial.patch&quot;

Index: Financial.cs
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
RCS file: =
/mono/mcs/class/Microsoft.VisualBasic/Microsoft.VisualBasic/Financial.cs=
,v
retrieving revision 1.4
diff -u -r1.4 Financial.cs
--- Financial.cs	31 May 2004 05:35:21 -0000	1.4
+++ Financial.cs	14 Jun 2004 18:11:08 -0000
@@ -3,14 +3,39 @@
 //
 // Author:
 //   Chris J Breisch (<A HREF="mailto:cjbreisch@altavista.net">cjbreisch@altavista.net</A>)=20
+//   Rob Tillie (<A HREF="mailto:Rob@flep-tech.nl">Rob@flep-tech.nl</A>)
 //
 // (C) 2002 Chris J Breisch
-//
+// (C) 2004 Rob Tillie
+// (C) 2002-2003 MainSoft
+ /*
+  * Copyright (c) 2002-2003 Mainsoft Corporation.
+  *
+  * Permission is hereby granted, free of charge, to any person =
obtaining a
+  * copy of this software and associated documentation files (the =
&quot;Software&quot;),
+  * to deal in the Software without restriction, including without =
limitation
+  * the rights to use, copy, modify, merge, publish, distribute, =
sublicense,
+  * and/or sell copies of the Software, and to permit persons to whom =
the
+  * Software is furnished to do so, subject to the following =
conditions:
+  *=20
+  * The above copyright notice and this permission notice shall be =
included in
+  * all copies or substantial portions of the Software.
+  *=20
+  * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, =
EXPRESS OR
+  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF =
MERCHANTABILITY,
+  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT =
SHALL THE
+  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR =
OTHER
+  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, =
ARISING
+  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR =
OTHER
+  * DEALINGS IN THE SOFTWARE.
+  */
=20
 using System;
+using System.ComponentModel;
+using System.Runtime.InteropServices;
 using Microsoft.VisualBasic.CompilerServices;
=20
-namespace Microsoft.VisualBasic=20
+namespace Microsoft.VisualBasic=20
 {
 	[StandardModule]=20
 	sealed public class Financial {
@@ -19,32 +44,347 @@
 		private Financial() {} // prevent public default constructor
 		// Properties
 		// Methods
-		[MonoTODO]
-		public static System.Double DDB (System.Double Cost, System.Double =
Salvage, System.Double Life, System.Double Period, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(2)] System.Double Factor) { throw =
new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double FV (System.Double Rate, System.Double =
NPer, System.Double Pmt, [System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] System.Double PV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] Microsoft.VisualBasic.DueDate =
Due) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double IPmt (System.Double Rate, System.Double =
Per, System.Double NPer, System.Double PV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] System.Double FV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] Microsoft.VisualBasic.DueDate =
Due) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double IRR (ref System.Double[] ValueArray, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0.1)] System.Double Guess) { throw =
new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double MIRR (ref System.Double[] ValueArray, =
System.Double FinanceRate, System.Double ReinvestRate) { throw new =
NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double NPer (System.Double Rate, System.Double =
Pmt, System.Double PV, [System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] System.Double FV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] Microsoft.VisualBasic.DueDate =
Due) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double NPV (System.Double Rate, ref =
System.Double[] ValueArray) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double Pmt (System.Double Rate, System.Double =
NPer, System.Double PV, [System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] System.Double FV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] Microsoft.VisualBasic.DueDate =
Due) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double PPmt (System.Double Rate, System.Double =
Per, System.Double NPer, System.Double PV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] System.Double FV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] Microsoft.VisualBasic.DueDate =
Due) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double PV (System.Double Rate, System.Double =
NPer, System.Double Pmt, [System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] System.Double FV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] Microsoft.VisualBasic.DueDate =
Due) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double Rate (System.Double NPer, System.Double =
Pmt, System.Double PV, [System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] System.Double FV, =
[System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0)] Microsoft.VisualBasic.DueDate =
Due, [System.Runtime.InteropServices.Optional] =
[System.ComponentModel.DefaultValue(0.1)] System.Double Guess) { throw =
new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double SLN (System.Double Cost, System.Double =
Salvage, System.Double Life) { throw new NotImplementedException (); }
-		[MonoTODO]
-		public static System.Double SYD (System.Double Cost, System.Double =
Salvage, System.Double Life, System.Double Period) { throw new =
NotImplementedException (); }
+		public static double DDB (double Cost, double Salvage, double Life, =
double Period,=20
+					  [Optional, DefaultValue (2)] double Factor)
+		{=20
+			// LAMESPEC: MSDN says Life and Factor only throws exception if &lt; =
0, but Implementation throws exception if &lt;=3D 0
+			if (Cost &lt; 0
+			    || Salvage &lt; 0
+			    || Life &lt;=3D 0
+			    || Period &lt; 0
+			    || Factor &lt;=3D 0
+			    || Period &gt; Life)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;Factor&quot;));
+		=09
+			return (((Cost - Salvage) * Factor) / Life) * Period;
+		}
+	=09
+		public static double FV (double Rate, double NPer, double Pmt,=20
+					 [Optional, DefaultValue (0)] double PV,=20
+					 [Optional, DefaultValue (0)] DueDate Due)
+		{=20
+			Pmt =3D -Pmt;
+			PV =3D -PV;
+			double currentRate =3D Math.Pow (Rate + 1, NPer);
+			double sum =3D 0;
+		=09
+			if (Rate !=3D 0)
+				sum =3D Pmt * ((currentRate - 1) / Rate);
+			else
+				sum =3D Pmt * NPer;
+=09
+			if (Due =3D=3D DueDate.BegOfPeriod)
+				sum *=3D (1 + Rate);
+		=09
+			return PV * currentRate + sum;
+		}
+	=09
+		public static double IPmt (double Rate, double Per, double NPer, =
double PV,=20
+					   [Optional, DefaultValue (0)] double FV,=20
+					   [Optional, DefaultValue (0)] DueDate Due)
+		{=20
+			double totalFutureVal;
+			double totalPaymentValue;
+			double numberOfPeriods;
+		=09
+			if ((Per &lt;=3D 0) || (Per &gt;=3D (NPer + 1)))
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;Per&quot;));
+			if ((Due =3D=3D DueDate.BegOfPeriod) &amp;&amp; (Per =3D=3D 1))
+				return 0;
+		=09
+			totalPaymentValue =3D Pmt (Rate, NPer, PV, FV, Due);
+			if (Due =3D=3D DueDate.BegOfPeriod)
+				PV =3D (PV + totalPaymentValue);
+		=09
+			numberOfPeriods =3D Per - ((int)Due) - 1;
+			totalFutureVal =3D
+				Financial.FV (Rate, numberOfPeriods, totalPaymentValue, PV, =
DueDate.EndOfPeriod);
+		=09
+			return (totalFutureVal * Rate);
+		}
+	=09
+		public static double IRR (ref double[] ValueArray, [Optional, =
DefaultValue (0.1)] double Guess)=20
+		{=20
+			double origPV, updatedPV, updateGuess, tmp;
+			double rateDiff =3D 0.0;
+			double pvDiff =3D 0.0;
+			int length;
+		=09
+			// MS.NET 2.0 docs say that Guess may not be &lt;=3D -1
+			if (Guess &lt;=3D -1)       =20
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;Guess&quot;));       =20
+			try {
+				length =3D ValueArray.GetLength(0);
+			}
+			catch {
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;ValueArray&quot;));
+			}
+			if (length &lt; 2)       =20
+			    throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;ValueArray&quot;));      =20
+		=09
+			origPV =3D NPV (Guess, ref ValueArray);
+			updateGuess =3D (origPV &gt; 0) ? Guess + 0.00001 : Guess - 0.00001;   =

+		=09
+			if (updateGuess &lt; -1)
+			    throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;Rate&quot;));
+		=09
+			rateDiff =3D  updateGuess - Guess;      =20
+			updatedPV =3D NPV (updateGuess, ref ValueArray);
+			pvDiff =3D updatedPV - origPV;
+			for (int i =3D 0; i &lt; 20; i++) {
+				Guess =3D (updateGuess &gt; Guess) ? (Guess - 0.00001) : (Guess + =
0.00001);
+				origPV =3D NPV (Guess, ref ValueArray);
+				rateDiff =3D  updateGuess - Guess;
+				pvDiff =3D updatedPV - origPV;  =20
+				if (pvDiff =3D=3D 0)
+					throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue&quot;));
+				Guess =3D updateGuess - (rateDiff * updatedPV / pvDiff);
+				if (Guess &lt; -1)
+				Guess =3D -1;
+				origPV =3D NPV (Guess, ref ValueArray);
+				if ((Math.Abs (origPV) &lt; 0.0000001) &amp;&amp; (Math.Abs (rateDiff) &lt; =
0.00001))
+					return Guess;
+			=09
+				tmp =3D Guess;
+				Guess =3D updateGuess;
+				updateGuess =3D tmp;
+				tmp =3D origPV;
+				origPV =3D updatedPV;
+				updatedPV =3D tmp;
+			}
+			double origPVAbs =3D Math.Abs (origPV);
+			double updatedPVAbs =3D Math.Abs (updatedPV);
+			if ((origPVAbs &lt; 0.0000001) &amp;&amp; (updatedPVAbs &lt; 0.0000001))
+			    return (origPVAbs &lt; updatedPVAbs) ? Guess : updateGuess;
+			else if (origPVAbs &lt; 0.0000001)
+			    return  Guess;
+			else if (updatedPVAbs &lt; 0.0000001)
+			    return updateGuess;
+			else               =20
+			    throw new ArgumentException(Utils.GetResourceString =
(&quot;Argument_InvalidValue&quot;));
+		}
+	=09
+		public static double MIRR (ref double[] ValueArray, double =
FinanceRate, double ReinvestRate)
+		{=20
+			double [] array =3D ValueArray;
+			double loansVal =3D 0;
+			double assetsVal =3D 0;
+			double currentLoanRate =3D 1;
+			double currentAssetsRate =3D 1;
+			double totalInterestRate =3D 0;
+			int arrayLength =3D 0;
+			if (array.Rank !=3D 1)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_RankEQOne1&quot;, &quot;ValueArray&quot;));
+			else if (FinanceRate =3D=3D -1)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;FinanceRate&quot;));
+			else if (ReinvestRate =3D=3D -1)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;ReinvestRate&quot;));
+		=09
+			arrayLength =3D array.Length;
+			if (arrayLength &lt; 2)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;ValueArray&quot;));
+		=09
+			for (int i =3D 0; i &lt; arrayLength; i++) {
+				currentLoanRate *=3D (1 + FinanceRate);
+				currentAssetsRate *=3D (1 + ReinvestRate);
+				if (array [i] &lt; 0)
+				loansVal +=3D (array [i] / currentLoanRate);
+				else if (array [i] &gt; 0)
+				assetsVal +=3D (array [i] / currentAssetsRate);
+			}
+		=09
+			if (loansVal =3D=3D 0)
+				throw new DivideByZeroException (Utils.GetResourceString =
(&quot;Financial_CalcDivByZero&quot;));
+		=09
+			totalInterestRate =3D
+				((-assetsVal * Math.Pow (ReinvestRate + 1, arrayLength))
+				/ (loansVal * (FinanceRate + 1)));
+			if (totalInterestRate &lt; 0)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue&quot;));
+		=09
+			return (Math.Pow (totalInterestRate, 1 / (double) (arrayLength - =
1))) - 1;
+		}
+	=09
+		public static double NPer (double Rate, double Pmt, double PV,=20
+					   [Optional, DefaultValue (0)] double FV,=20
+					   [Optional, DefaultValue (0)] DueDate Due)
+		{=20
+			double totalIncomeFromFlow, sumOfPvAndPayment, =
currentValueOfPvAndPayment;
+			if (Rate =3D=3D 0 &amp;&amp; Pmt =3D=3D 0)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;Pmt&quot;));
+			else if (Rate =3D=3D 0)
+				return (- (PV + FV) / Pmt);
+			// MainSoft had Rate &lt; -1, but MS.NET 2.0 Doc says Rate should not =
be &lt;=3D -1
+			else if (Rate &lt;=3D -1)
+				throw new ArgumentException(Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;Rate&quot;));
+			totalIncomeFromFlow =3D (Pmt / Rate);
+			if (Due =3D=3D DueDate.BegOfPeriod)
+			totalIncomeFromFlow *=3D (1 + Rate);
+		=09
+			sumOfPvAndPayment =3D (-FV + totalIncomeFromFlow);
+			currentValueOfPvAndPayment =3D (PV + totalIncomeFromFlow);
+			if ((sumOfPvAndPayment &lt; 0) &amp;&amp; (currentValueOfPvAndPayment &lt; 0)) {
+				sumOfPvAndPayment =3D -sumOfPvAndPayment;
+				currentValueOfPvAndPayment =3D -currentValueOfPvAndPayment;
+			}
+			else if ((sumOfPvAndPayment &lt;=3D 0) || (currentValueOfPvAndPayment =
&lt; 0))
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Financial_CannotCalculateNPer&quot;));
+		=09
+			double totalInterestRate =3D sumOfPvAndPayment / =
currentValueOfPvAndPayment;
+			return Math.Log (totalInterestRate) / Math.Log (Rate + 1);
+		}
+	=09
+		public static double NPV (double Rate, ref double[] ValueArray)=20
+		{=20
+			if (ValueArray =3D=3D null)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidNullValue1&quot;, &quot;ValueArray&quot;));
+		=09
+			double [] arr =3D ValueArray;
+			if (arr.Rank !=3D 1)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_RankEQOne1&quot;, &quot;ValueArray&quot;));
+			if (Rate =3D=3D -1)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;Rate&quot;));
+			int length =3D arr.Length;
+			if (length &lt; 0)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;ValueArray&quot;));
+		=09
+			double currentValue =3D 0;
+			double currentRate =3D 1;
+			double sum =3D 0;
+			for (int index =3D 0; index &lt; length; index++) {
+				currentValue =3D arr [index];
+				currentRate *=3D (1 + Rate);
+				sum +=3D (currentValue / currentRate);
+			}
+			return sum;
+		}
+	=09
+		public static double Pmt (double Rate, double NPer, double PV,=20
+					  [Optional, DefaultValue (0)] double FV,=20
+					  [Optional, DefaultValue (0)] DueDate Due)
+		{=20
+			PV =3D -PV;
+			FV =3D -FV;
+			if (NPer =3D=3D 0)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Argument_InvalidValue1&quot;, &quot;NPer&quot;));
+		=09
+			double totalFutureVal =3D 0;
+			double geometricSum =3D 0;=20
+			if (Rate =3D=3D 0) {
+				totalFutureVal =3D FV + PV;
+				geometricSum =3D NPer;
+			}
+			else if (Due =3D=3D DueDate.EndOfPeriod) {
+				double totalRate =3D Math.Pow (Rate + 1, NPer);
+				totalFutureVal =3D FV + PV * totalRate;
+				geometricSum =3D (totalRate - 1) / Rate;
+			}
+			else if (Due =3D=3D DueDate.BegOfPeriod) {
+				double totalRate =3D Math.Pow (Rate + 1, NPer);
+				totalFutureVal =3D FV + PV * totalRate;
+				geometricSum =3D ((1 + Rate) * (totalRate - 1)) / Rate;       =20
+			}
+			return (totalFutureVal) / geometricSum;=20
+		}
+	=09
+		public static double PPmt (double Rate, double Per, double NPer, =
double PV,=20
+					   [Optional, DefaultValue (0)] double FV,=20
+					   [Optional, DefaultValue (0)] DueDate Due)
+		{=20
+			if ((Per &lt;=3D 0) || (Per &gt;=3D (NPer + 1)))
+				throw new ArgumentException(Utils.GetResourceString =
(&quot;PPMT_PerGT0AndLTNPer&quot;, &quot;Per&quot;));
+			double interestPayment =3D IPmt (Rate, Per, NPer, PV, FV, Due);
+			double totalPayment =3D Pmt (Rate, NPer, PV, FV, Due);
+			return (totalPayment - interestPayment);
+		}
+	=09
+		public static double PV (double Rate, double NPer, double Pmt,=20
+					 [Optional, DefaultValue (0)] double FV,=20
+					 [Optional, DefaultValue (0)] DueDate Due)
+		{=20
+			Pmt =3D -Pmt;
+			FV =3D -FV;
+			double currentRate =3D 1;
+			double sum =3D 0;
+			for (int index =3D 1; index &lt;=3D NPer; index++) {
+				currentRate *=3D (1 + Rate);
+				sum +=3D (Pmt / currentRate);
+			}
+		=09
+			if (Due =3D=3D DueDate.BegOfPeriod)
+				sum *=3D (1 + Rate);
+			return sum + FV / currentRate;   =20
+		}
+	=09
+		public static double Rate (double NPer, double Pmt, double PV,=20
+					   [Optional, DefaultValue (0)] double FV,=20
+					   [Optional, DefaultValue (0)] DueDate Due,=20
+					   [Optional, DefaultValue (0.1)] double Guess)
+		{=20
+			double updatedGuess, tmp, origFv, updatedFv;
+			double rateDiff =3D 0.0;
+			double fvDiff =3D 0.0;
+		=09
+			if (NPer &lt; 0)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Rate_NPerMustBeGTZero&quot;));
+			origFv =3D -Financial.FV (Guess, NPer, Pmt, PV, Due) + FV;
+			updatedGuess =3D (origFv &gt; 0) ? (Guess / 2) : (Guess * 2);
+			rateDiff =3D updatedGuess - Guess;
+			updatedFv =3D -Financial.FV (updatedGuess, NPer, Pmt, PV, Due) + =
FV;
+			fvDiff =3D updatedFv - origFv;
+			for (int i =3D 0; i &lt; 20; i++) {
+				Guess +=3D (updatedGuess &gt; Guess) ? -0.00001 : 0.00001;
+				origFv =3D -Financial.FV (Guess, NPer, Pmt, PV, Due) + FV;
+				rateDiff =3D updatedGuess - Guess;
+				fvDiff =3D updatedFv - origFv;
+				if (fvDiff =3D=3D 0)
+					throw new ArgumentException (Utils.GetResourceString =
(&quot;Financial_CalcDivByZero&quot;));
+				Guess =3D updatedGuess - (rateDiff * updatedFv / fvDiff);
+				origFv =3D -Financial.FV (Guess, NPer, Pmt, PV, Due) + FV;
+				if (Math.Abs (origFv) &lt; 0.0000001)
+					return Guess;
+				tmp =3D Guess;
+				Guess =3D updatedGuess;
+				updatedGuess =3D tmp;
+				tmp =3D origFv;
+				origFv =3D updatedFv;
+				updatedFv =3D tmp;
+			}
+			double origFVAbs =3D Math.Abs (origFv);
+			double updatedFVAbs =3D Math.Abs (updatedFv);
+			if ((origFVAbs &lt; 0.0000001) &amp;&amp; (updatedFVAbs &lt; 0.0000001))
+				return (origFVAbs &lt; updatedFVAbs) ? Guess : updatedGuess;
+			else if (origFVAbs &lt; 0.0000001)
+				return Guess;
+			else if (updatedFVAbs &lt; 0.0000001)
+				return updatedGuess;
+			else
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Financial_CannotCalculateRate&quot;));=20
+		}
+	=09
+		public static double SLN (double Cost, double Salvage, double Life)
+		{=20
+			if (Life =3D=3D 0)
+				throw new ArgumentException (Utils.GetResourceString =
(&quot;Financial_LifeNEZero&quot;));
+		=09
+			return (Cost - Salvage) / Life;
+		}
+	=09
+		public static double SYD (double Cost, double Salvage, double Life, =
double Period)=20
+		{=20
+			if (Period &lt;=3D 0)
+				throw new ArgumentException =
(Utils.GetResourceString(&quot;Financial_ArgGTZero1&quot;, &quot;Period&quot;));
+			else if (Salvage &lt; 0)
+				throw new ArgumentException =
(Utils.GetResourceString(&quot;Financial_ArgGEZero1&quot;, &quot;Salvage&quot;));
+			else if (Period &gt; Life)
+				throw new ArgumentException =
(Utils.GetResourceString(&quot;Financial_PeriodLELife&quot;));
+		=09
+			double depreciation =3D  (Cost - Salvage);
+			double sumOfDigits =3D (Life + 1) * Life / 2;
+			double currentPeriodPart =3D Life + 1 - Period ;=20
+		=09
+			return depreciation * currentPeriodPart / sumOfDigits;
+		}
 		// Events
-	};
+	}
 }

------_=_NextPart_000_01C4523B.80DC8420
Content-Type: application/octet-stream;
	name=&quot;VBUtils.txt.patch&quot;
Content-Disposition: attachment;
	filename=&quot;VBUtils.txt.patch&quot;

Index: VBUtils.txt
===================================================================
RCS file: /mono/mcs/class/Microsoft.VisualBasic/Microsoft.VisualBasic/VBUtils.txt,v
retrieving revision 1.1
diff -u -r1.1 VBUtils.txt
--- VBUtils.txt	7 Jun 2004 08:44:52 -0000	1.1
+++ VBUtils.txt	14 Jun 2004 18:04:04 -0000
@@ -120,16 +120,16 @@
 UseFilePutObject = FIXME: UseFilePutObject
 
 # Errors in Financial.java
-Argument_RankEQOne1 = FIXME: Argument_RankEQOne1 |1
-Financial_CalcDivByZero = FIXME: Financial_CalcDivByZero
-Financial_CannotCalculateNPer = FIXME: Financial_CannotCalculateNPer
-PPMT_PerGT0AndLTNPer = FIXME: PPMT_PerGT0AndLTNPer |1
-Rate_NPerMustBeGTZero = FIXME: Rate_NPerMustBeGTZero
-Financial_CannotCalculateRate = FIXME: Financial_CannotCalculateRate
-Financial_LifeNEZero = FIXME: Financial_LifeNEZero
-Financial_ArgGTZero1 = FIXME: Financial_ArgGTZero1 |1
-Financial_ArgGEZero1 = FIXME: Financial_ArgGEZero1 |1
-Financial_PeriodLELife = FIXME: Financial_PeriodLELife
+Argument_RankEQOne1 = Rank of |1 does not equal 1.
+Financial_CalcDivByZero = Division by zero has occurred.
+Financial_CannotCalculateNPer = Cannot calculate NPer.
+PPMT_PerGT0AndLTNPer = |1 value invalid, it must be greater than 1 and smaller than NPer.
+Rate_NPerMustBeGTZero = Rate must be less than or equal to 0.
+Financial_CannotCalculateRate = Cannot calculate Rate.
+Financial_LifeNEZero = Life cannot be zero.
+Financial_ArgGTZero1 = |1 must be greater than 0.
+Financial_ArgGEZero1 = |1 must be greater than or equal to 0.
+Financial_PeriodLELife = Period must be greater than Life.
 
 # Errors in FlowControl.java
 ForLoop_CommonType3 = FIXME: ForLoop_CommonType3 |1 |2 |3

------_=_NextPart_000_01C4523B.80DC8420--

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000078.html">[mono-vb] FileSystem implementation
</A></li>
	<LI> Next message: <A HREF="000080.html">[mono-vb] Implementation of Financial vb module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79">[ date ]</a>
              <a href="thread.html#79">[ thread ]</a>
              <a href="subject.html#79">[ subject ]</a>
              <a href="author.html#79">[ author ]</a>
         </LI>
       </UL>
</body></html>
