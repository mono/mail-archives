<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-vb] patch for Microsoft.VisualBasic.CompilerServices.Utils
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-vb%40lists.ximian.com?Subject=%5Bmono-vb%5D%20patch%20for%20Microsoft.VisualBasic.CompilerServices.Utils&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000595.html">
   <LINK REL="Next"  HREF="000600.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-vb] patch for Microsoft.VisualBasic.CompilerServices.Utils</H1>
    <B>Max V. Irgiznov</B> 
    <A HREF="mailto:mono-vb%40lists.ximian.com?Subject=%5Bmono-vb%5D%20patch%20for%20Microsoft.VisualBasic.CompilerServices.Utils&In-Reply-To="
       TITLE="[mono-vb] patch for Microsoft.VisualBasic.CompilerServices.Utils">xeon at ulsu.ru
       </A><BR>
    <I>Fri Mar 16 03:47:06 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000595.html">[mono-vb] [SPAM DETECT] Re:  Mono VB and MonoDevelop
</A></li>
        <LI>Next message: <A HREF="000600.html">[mono-vb] patch for Microsoft.VisualBasic.CompilerServices.Utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#598">[ date ]</a>
              <a href="thread.html#598">[ thread ]</a>
              <a href="subject.html#598">[ subject ]</a>
              <a href="author.html#598">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, mono-vb.

I call upon you to patch for
Class Microsoft.VisualBasic.CompilerServices.Utils

that supports method GetResourceString (ByVal ResourceKey As String, ByVal ParamArray Args As
String ()) As String


Index: Utils.vb
===================================================================
--- Utils.vb    (revision 74452)
+++ Utils.vb    (working copy)
@@ -29,16 +29,212 @@
 ' WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 
 Imports System
+Imports System.Resources
+Imports System.Reflection
+Imports System.Threading
 Imports System.Runtime.InteropServices
 
 Namespace Microsoft.VisualBasic.CompilerServices
     &lt;System.ComponentModel.EditorBrowsable(ComponentModel.EditorBrowsableState.Never)&gt; _
     Public NotInheritable Class Utils
 
+        Private Shared m_TriedLoadingResourceManager As Boolean
+        Private Shared m_VBAResourceManager As ResourceManager
+        Private Shared ReadOnly ResourceManagerSyncObj As Object
+
         Private Sub New()
             'Nobody should see constructor
         End Sub
+        '----------------------------------
+        Shared Sub New()
+            Utils.ResourceManagerSyncObj = New Object
+        End Sub
 
+        Friend Enum vbErrors
+            ' Fields
+            Abort = &amp;H11F
+            AccessViolation = -2147467261
+            ActionNotSupported = &amp;H1BD
+            AdviseLimit = &amp;H60
+            AmbiguousName = &amp;H802C
+            ArrayLocked = 10
+            BadCallToFriendFunction = &amp;H61
+            BadFileMode = &amp;H36
+            BadFileNameOrNumber = &amp;H34
+            BadFunctionId = &amp;H8006
+            BadLibId = &amp;H88C3
+            BadModuleKind = &amp;H88BD
+            BadPatStr = &amp;H5D
+            BadRecordLen = &amp;H3B
+            BadRecordNum = &amp;H3F
+            BadTypeId = &amp;H88C2
+            BrokenLibRef = &amp;H88CD
+            BufferTooSmall = &amp;H8016
+            CantContinue = &amp;H11
+            CantCreateObject = &amp;H1AD
+            CantCreateTmpFile = &amp;H142
+            CantEvalWatch = &amp;H9C65
+            CantFindDllEntryPoint = &amp;HE741
+            CantPassPrivateObject = &amp;H62
+            CantSaveFileToTemp = &amp;H2DF
+            CantUseNull = &amp;H5E
+            CircularType = &amp;H9C84
+            CodeResourceLockError = &amp;H1C7
+            CodeResourceNotFound = &amp;H1C6
+            CompileError = &amp;H9C64
+            DevUnavailable = &amp;H44
+            DifferentDrive = &amp;H4A
+            DiskFull = &amp;H3D
+            DiskNotReady = &amp;H47
+            DivByZero = 11
+            DLLBadCallingConv = &amp;H31
+            DLLCallException = &amp;H63
+            DLLLoadErr = &amp;H30
+            DoesntImplementICollection = 100
+            DuplicateKey = &amp;H1C9
+            ElementNotFound = &amp;H802B
+            EndOfFile = &amp;H3E
+            Eof = &amp;H88C4
+            ExpectedFuncNotModule = &amp;H88C7
+            ExpectedFuncNotProject = &amp;H88C9
+            ExpectedFuncNotRecord = &amp;H88C8
+            ExpectedFuncNotVar = &amp;H88CA
+            ExpectedTokens = &amp;H9C6F
+            ExpectedTypeNotProj = &amp;H88CB
+            ExprTooComplex = &amp;H10
+            FileAlreadyExists = &amp;H3A
+            FileAlreadyOpen = &amp;H37
+            FileLockViolation = &amp;H8007
+            FileNotFound = &amp;H35
+            FileNotFoundWithName = &amp;H9D33
+            FuncArityMismatch = 450
+            GetNotSupported = &amp;H18A
+            GetNotSupportedAtRuntime = &amp;H189
+            IdentNotMember = &amp;H1CD
+            IdTooLong = &amp;H9C6D
+            IllegalChar = &amp;H9C6C
+            IllegalFor = &amp;H5C
+            IllegalFuncCall = 5
+            InconsistentPropFuncs = &amp;H9C83
+            IncorrectTypeChar = &amp;H9C6A
+            InternalError = &amp;H33
+            InvalidClipboardFormat = 460
+            InvalidDllFunctionName = &amp;H1C5
+            InvalidFileFormat = &amp;H141
+            InvalidNumLit = &amp;H9C6B
+            InvalidOrdinal = &amp;H1C4
+            InvalidPicture = &amp;H1E1
+            InvalidPropertyArrayIndex = &amp;H17D
+            InvalidPropertyValue = 380
+            InvalidResourceFormat = &amp;H145
+            InvalidState = &amp;H8029
+            InvalidTypeInfoKind = &amp;H88D1
+            InvalidTypeLibFunction = &amp;H88D2
+            InvalidTypeLibVariable = &amp;H1CA
+            InvDataRead = &amp;H8018
+            IOError = &amp;H39
+            LastTrappable = &amp;H2EA
+            LibNotRegistered = &amp;H801D
+            LocaleSettingNotSupported = &amp;H1BF
+            LostTLB = &amp;H1BA
+            MissingEndBrack = &amp;H9C69
+            MissingVbaTypeLib = &amp;H9C66
+            ModNameConflict = &amp;H802D
+            ModuleAsType = &amp;H88D0
+            NamedArgsNotSupported = &amp;H1BE
+            NamedParamNotFound = &amp;H1C0
+            NeedPropertyArrayIndex = &amp;H181
+            NoContainingLib = &amp;H88C1
+            None = 0
+            NoSuchControlOrProperty = &amp;H1A7
+            NotEnum = &amp;H1C3
+            NotObject = &amp;H1A8
+            NotYetImplemented = &amp;H8000
+            ObjDoesNotSupportEvents = &amp;H1CB
+            ObjNotRegistered = &amp;H1CF
+            ObjNotSet = &amp;H5B
+            OLEAutomationError = 440
+            OLEFileNotFound = &amp;H1B0
+            OLENoDefault = &amp;H1BB
+            OLENoPropOrMethod = &amp;H1B6
+            OLENotSupported = 430
+            OperationNotAllowedInDll = &amp;H9C63
+            OutOfBounds = 9
+            OutOfMemory = 7
+            OutOfStack = &amp;H1C
+            OutOfStrSpace = 14
+            Overflow = 6
+            ParameterNotOptional = &amp;H1C1
+            PathFileAccess = &amp;H4B
+            PathNotFound = &amp;H4C
+            PermissionDenied = 70
+            PrinterError = &amp;H1E2
+            PropertyNotFound = &amp;H1A6
+            QualifiedNameDisallowed = &amp;H8028
+            ReadFault = &amp;H8004
+            RegistryAccess = &amp;H801C
+            ReplacementsTooLong = &amp;H2EA
+            ResumeWOErr = 20
+            ReturnWOGoSub = 3
+            SearchTextNotFound = &amp;H2E8
+            SeekErr = &amp;H8003
+            ServerNotFound = &amp;H1CE
+            SetNotPermitted = &amp;H183
+            SetNotSupported = &amp;H17F
+            SetNotSupportedAtRuntime = &amp;H17E
+            ShareRequired = &amp;H8015
+            SizeTooBig = &amp;H88C5
+            StatementTooComplex = &amp;H9C6E
+            TooManyClients = &amp;H2F
+            TooManyFiles = &amp;H43
+            TypeMismatch = 13
+            UndefinedProc = &amp;H23
+            UndefinedType = &amp;H8027
+            UNDONE = &amp;H1D
+            UnknownLcid = &amp;H802E
+            UnsuitableFuncPropMatch = &amp;H88CC
+            UnsupFormat = &amp;H8019
+            UnsupportedTypeLibFeature = &amp;H88CE
+            Usage = &amp;H801F
+            UserDefined = &amp;H5F
+            UserInterrupt = &amp;H12
+            UserReset = &amp;H9C68
+            WriteFault = &amp;H8005
+            WrongTypeKind = &amp;H802A
+        End Enum
+
+        Friend Shared ReadOnly Property VBAResourceManager() As ResourceManager
+            Get
+                If (Utils.m_VBAResourceManager Is Nothing) Then
+                    Dim expression As Object = Utils.ResourceManagerSyncObj
+                    ObjectFlowControl.CheckForSyncLockOnValueType(expression)
+                    SyncLock expression
+                        If Not Utils.m_TriedLoadingResourceManager Then
+                            Try
+                                Utils.m_VBAResourceManager = New ResourceManager(&quot;Microsoft.VisualBasic&quot;, Assembly.GetExecutingAssembly)
+                            Catch exception As StackOverflowException
+                                Throw exception
+                            Catch exception2 As OutOfMemoryException
+                                Throw exception2
+                            Catch exception3 As Threading.ThreadAbortException
+                                Throw exception3
+                            Catch exception6 As Exception
+                            End Try
+                            Utils.m_TriedLoadingResourceManager = True
+                        End If
+                    End SyncLock
+                End If
+                Return Utils.m_VBAResourceManager
+            End Get
+        End Property
+
+        Friend Shared Function GetCultureInfo() As Globalization.CultureInfo
+            Return Thread.CurrentThread.CurrentCulture
+        End Function
+
+
+        '---------------------------------
+
         Public Shared Function CopyArray(ByVal arySrc As System.Array, ByVal aryDest As System.Array) As System.Array
 
             If arySrc Is Nothing Then
@@ -75,11 +271,81 @@
         Public Shared Sub ThrowException(ByVal hr As Integer)
             Throw New NotImplementedException
         End Sub
-#If NET_2_0 Then
+
+        Friend Shared Function GetResourceString(ByVal ResourceId As vbErrors) As String
+            Return Utils.GetResourceString((&quot;ERR&quot; &amp; Conversions.ToString(CInt(ResourceId))))
+        End Function
+
+        &lt;ComponentModel.EditorBrowsable(ComponentModel.EditorBrowsableState.Never)&gt; _
+        Friend Shared Function GetResourceString(ByVal ResourceKey As String) As String
+            Dim text2 As String
+            If (Utils.VBAResourceManager Is Nothing) Then
+                Return &quot;Message text unavailable.  Resource file 'Microsoft.VisualBasic resources' not found.&quot;
+            End If
+            Try
+                text2 = Utils.VBAResourceManager.GetString(ResourceKey, Utils.GetCultureInfo)
+                If (text2 Is Nothing) Then
+                    text2 = &quot;Application-defined or object-defined error.&quot;                    
+                End If
+            Catch exception As StackOverflowException
+                Throw exception
+            Catch exception2 As OutOfMemoryException
+                Throw exception2
+            Catch exception3 As ThreadAbortException
+                Throw exception3
+            Catch exception6 As Exception
+                text2 = &quot;Message text unavailable.  Resource file 'Microsoft.VisualBasic resources' not found.&quot;
+            End Try
+            Return text2
+        End Function
+
+        Friend Shared Function GetResourceString(ByVal ResourceKey As String, ByVal NotUsed As Boolean) As String
+            Dim text2 As String
+            If (Utils.VBAResourceManager Is Nothing) Then
+                Return &quot;Message text unavailable.  Resource file 'Microsoft.VisualBasic resources' not found.&quot;
+            End If
+
+            Try
+                text2 = Utils.VBAResourceManager.GetString(ResourceKey, Utils.GetCultureInfo)
+                If (text2 Is Nothing) Then
+                    text2 = Utils.VBAResourceManager.GetString(ResourceKey)
+                End If
+            Catch exception As StackOverflowException
+                Throw exception
+            Catch exception2 As OutOfMemoryException
+                Throw exception2
+            Catch exception3 As ThreadAbortException
+                Throw exception3
+            Catch exception6 As Exception
+                text2 = Nothing
+            End Try
+
+            Return text2
+        End Function
+
         Public Shared Function GetResourceString(ByVal ResourceKey As String, ByVal ParamArray Args As String()) As String
-            Throw New NotImplementedException
+            Dim left As String = Nothing
+            Dim format As String = Nothing
+
+            Try
+                format = Utils.GetResourceString(ResourceKey)
+                left = String.Format(Thread.CurrentThread.CurrentUICulture, format, Args)
+            Catch exception As StackOverflowException
+                Throw exception
+            Catch exception2 As OutOfMemoryException
+                Throw exception2
+            Catch exception3 As ThreadAbortException
+                Throw exception3
+            Catch exception4 As Exception
+
+            End Try
+
+            If (Operators.CompareString(left, &quot;&quot;, False) &lt;&gt; 0) Then
+                Return left
+            End If
+            Return format
         End Function
-#End If
+
     End Class
 
 End Namespace 


-- 
Sincerely,
 Max V. Irgiznov    System Administrator of Ulyanovsk State University
 mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-vb">xeon at ulsu.ru</A>

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000595.html">[mono-vb] [SPAM DETECT] Re:  Mono VB and MonoDevelop
</A></li>
	<LI>Next message: <A HREF="000600.html">[mono-vb] patch for Microsoft.VisualBasic.CompilerServices.Utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#598">[ date ]</a>
              <a href="thread.html#598">[ thread ]</a>
              <a href="subject.html#598">[ subject ]</a>
              <a href="author.html#598">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-vb">More information about the Mono-vb
mailing list</a><br>
</body></html>
