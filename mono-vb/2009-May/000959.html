<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mono-vb] VBNC30390 Compile Error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-vb%40lists.ximian.com?Subject=%5Bmono-vb%5D%20VBNC30390%20Compile%20Error&In-Reply-To=49E8914E.8060407%40math.uiuc.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000974.html">
   <LINK REL="Next"  HREF="000960.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mono-vb] VBNC30390 Compile Error</H1>
    <B>John Lenz</B> 
    <A HREF="mailto:mono-vb%40lists.ximian.com?Subject=%5Bmono-vb%5D%20VBNC30390%20Compile%20Error&In-Reply-To=49E8914E.8060407%40math.uiuc.edu"
       TITLE="[mono-vb] VBNC30390 Compile Error">jlenz2 at math.uiuc.edu
       </A><BR>
    <I>Sat May 16 00:40:17 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000974.html">[mono-vb] FileSystem.FileOpen
</A></li>
        <LI>Next message: <A HREF="000960.html">[mono-vb] VBNC30390 Compile Error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#959">[ date ]</a>
              <a href="thread.html#959">[ thread ]</a>
              <a href="subject.html#959">[ subject ]</a>
              <a href="author.html#959">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/17/2009 09:25 AM, John Lenz wrote:
&gt;<i> On 04/17/2009 03:09 AM, Rolf Bjarne Kvinge wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When attempting to compile a large vb.net project here at work with
</I>&gt;&gt;&gt;<i> mono, I got a really weird error.  I was able to strip it down to the
</I>&gt;&gt;&gt;<i> attached file, the error comes about when there are two private
</I>&gt;&gt;&gt;<i> subclasses of some class.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am using the mono-basic code from Mono 2.4, and I get the following
</I>&gt;&gt;&gt;<i> error.   The file compiles without errors in Visual Studio.  As I
</I>&gt;&gt;&gt;<i> mention
</I>&gt;&gt;&gt;<i> in the comment, changing Bar to a public class makes the file compile
</I>&gt;&gt;&gt;<i> without any errors.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Visual Basic.Net Compiler version 0.0.0.5914 (Mono 2.4 - r) Copyright
</I>&gt;&gt;&gt;<i> (C) 2004-2008 Rolf Bjarne Kvinge. All rights reserved.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> /home/john/test.vb (28,26) : Error VBNC30390: 'Bar.Testing' is not
</I>&gt;&gt;<i> accessible because it is 'Public'.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, this is really weird.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However you seem to have forgotten to attach the file ;-)
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> I attached it, but maybe the list killed the attachment.  Here it is inline
</I>&gt;<i> 
</I>&gt;<i> Option Strict On
</I>&gt;<i> 
</I>&gt;<i> Public Class Foo
</I>&gt;<i> 
</I>&gt;<i>   'Changing Bar to a public class fixes the problem
</I>&gt;<i>   Private Class Bar
</I>&gt;<i>     Public Function Testing() As Integer
</I>&gt;<i>           Return 12
</I>&gt;<i>     End Function
</I>&gt;<i>   End Class
</I>&gt;<i> 
</I>&gt;<i>   Private b As Bar
</I>&gt;<i> 
</I>&gt;<i>   Public Sub New()
</I>&gt;<i>     b = New Bar()
</I>&gt;<i>   End Sub
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>   Private Class Baz
</I>&gt;<i> 
</I>&gt;<i>      Private parent As Foo
</I>&gt;<i> 
</I>&gt;<i>      Public Sub New(ByVal p As Foo)
</I>&gt;<i>         parent = p
</I>&gt;<i>      End Sub
</I>&gt;<i> 
</I>&gt;<i>      Public Function Test(ByVal i As Integer) As Integer
</I>&gt;<i>          Return parent.b.Testing() + i
</I>&gt;<i>      End Function
</I>&gt;<i> 
</I>&gt;<i>   End Class
</I>&gt;<i> 
</I>&gt;<i>   Public Function Test(ByVal i As Integer) As Integer
</I>&gt;<i>       Dim b As New Baz(Me)
</I>&gt;<i>       return b.Test(i)
</I>&gt;<i>   End Function
</I>&gt;<i> End Class
</I>

The following patch against mono-basic-2.4 fixes the problem for me.

Index: mono-basic-2.4/vbnc/vbnc/source/General/Helper.vb
===================================================================
--- mono-basic-2.4.orig/vbnc/vbnc/source/General/Helper.vb	2009-05-15 23:33:04.000000000 -0500
+++ mono-basic-2.4/vbnc/vbnc/source/General/Helper.vb	2009-05-15 23:30:28.000000000 -0500
@@ -1981,8 +1981,6 @@

         'If the called type is not a nested type it is accessible.
         If CalledType.DeclaringType Is Nothing Then Return True
-        'If the called type is a private nested type it is inaccessible
-        If CalledType.IsNestedPrivate Then Return Helper.CompareType(CalledType.DeclaringType, CallerType)

         'Add all the surrounding types of the caller type to a list.
         Dim callerHierarchy As New Generic.List(Of Type)
@@ -1996,6 +1994,10 @@
         Do Until tmpCaller Is Nothing
             If callerHierarchy.Contains(tmpCaller) Then
                 'We've reached a common surrounding type.
+
+                'The caller can descend once into a private type, check that here.
+                If CalledType.IsNestedPrivate Then Return Helper.CompareType(CalledType.DeclaringType, tmpCaller)
+
                 'No matter what accessibility level this type has
                 'it is accessible.
                 Return True
@@ -2007,6 +2009,9 @@
             tmpCaller = tmpCaller.DeclaringType
         Loop

+        'If the called type is a private nested type it is inaccessible
+        If CalledType.IsNestedPrivate Then Return Helper.CompareType(CalledType.DeclaringType, CallerType)
+
         'There is no common surrounding type, and the access level of all
         'surrounding types of the called types are non-private, so the type
         'is accessible.
@@ -4023,4 +4028,4 @@
         End Select
         Return False
     End Function
-End Class
\ No newline at end of file
+End Class
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000974.html">[mono-vb] FileSystem.FileOpen
</A></li>
	<LI>Next message: <A HREF="000960.html">[mono-vb] VBNC30390 Compile Error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#959">[ date ]</a>
              <a href="thread.html#959">[ thread ]</a>
              <a href="subject.html#959">[ subject ]</a>
              <a href="author.html#959">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-vb">More information about the Mono-vb
mailing list</a><br>
</body></html>
