<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] __MonoCS__ no longer defined?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20__MonoCS__%20no%20longer%20defined%3F&In-Reply-To=%3CCAC9RQtjE%2B7_vDhrSDTFe0Xv1ttn-rGX9iy%3DFdY_jxz2jfup-2g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="044105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] __MonoCS__ no longer defined?</H1>
    <B>Greg Young</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20__MonoCS__%20no%20longer%20defined%3F&In-Reply-To=%3CCAC9RQtjE%2B7_vDhrSDTFe0Xv1ttn-rGX9iy%3DFdY_jxz2jfup-2g%40mail.gmail.com%3E"
       TITLE="[Mono-dev] __MonoCS__ no longer defined?">gregoryyoung1 at gmail.com
       </A><BR>
    <I>Wed Jan  4 21:17:51 UTC 2017</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="044105.html">[Mono-dev] __MonoCS__ no longer defined?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44104">[ date ]</a>
              <a href="thread.html#44104">[ thread ]</a>
              <a href="subject.html#44104">[ subject ]</a>
              <a href="author.html#44104">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I just pulled master today and am suddenly getting loads of errors in
our unit test suite how kernel32 is not defined. EG Exception below.
However all places where this is used are wrapped with

I was building on master recently without any issues. It appears
__MonoCS__ is not defined?!

        public static uint GetDriveSectorSize(string path)
        {
#if !__MonoCS__ &amp;&amp; !USE_UNIX_IO
            //snip
            WinNative.GetDiskFreeSpace(Path.GetPathRoot(path), out
dontcare, out size, out dontcare, out dontcare);
#else
            //snip
#endif
        }

We are seeing this everywhere we have __MonoCS__


So I decided to write a test:

➜  ConsoleApplication cat ConsoleApplication/Program.cs
using System;
using System.Collections.Generic;

namespace ConsoleApplication
{
    internal class Program
    {
        public static void Main(string[] args)
        {
#if __MonoCS__
    Console.WriteLine(&quot;shitbird&quot;);
#else
    Console.WriteLine(&quot;wtf?&quot;);
#endif
        }
    }
}%


➜  ConsoleApplication xbuild --version
XBuild Engine Version 14.0
Mono, Version 4.9.0.0
Copyright (C) 2005-2013 Various Mono authors
MSBUILD: error MSBUILD0000: Project file '--version' not found.
➜  ConsoleApplication xbuild ConsoleApplication.sln
XBuild Engine Version 14.0
Mono, Version 4.9.0.0
Copyright (C) 2005-2013 Various Mono authors

Build started 1/4/2017 9:16:26 PM.
__________________________________________________
Project &quot;/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication.sln&quot;
(default target(s)):
Target ValidateSolutionConfiguration:
Building solution configuration &quot;Debug|Any CPU&quot;.
Target Build:
Project &quot;/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication/ConsoleApplication.csproj&quot;
(default target(s)):
Target PrepareForBuild:
Configuration: Debug Platform: AnyCPU
Target GenerateSatelliteAssemblies:
No input files were specified for target GenerateSatelliteAssemblies, skipping.
Target CoreCompile:
Tool /opt/mono/lib/mono/4.5/csc.exe execution started with arguments:
/noconfig /debug:portable /debug:portable /optimize-
/out:obj/Debug/ConsoleApplication.exe Program.cs
Properties/AssemblyInfo.cs
obj/Debug/.NETFramework,Version=v4.5.AssemblyAttribute.cs /target:exe
/define:&quot;DEBUG;TRACE&quot; /nostdlib /platform:AnyCPU
/reference:/opt/mono/lib/mono/4.5-api/System.dll
/reference:/opt/mono/lib/mono/4.5-api/System.Xml.Linq.dll
/reference:/opt/mono/lib/mono/4.5-api/System.Data.DataSetExtensions.dll
/reference:/opt/mono/lib/mono/4.5-api/System.Data.dll
/reference:/opt/mono/lib/mono/4.5-api/System.Xml.dll
/reference:/opt/mono/lib/mono/4.5-api/System.Core.dll
/reference:/opt/mono/lib/mono/4.5-api//mscorlib.dll /warn:4
Microsoft (R) Visual C# Compiler version 2.0.0.61205
Copyright (C) Microsoft Corporation. All rights reserved.
Target DeployOutputFiles:
Copying file from
'/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication/obj/Debug/ConsoleApplication.pdb'
to '/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication/bin/Debug/ConsoleApplication.pdb'
Copying file from
'/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication/obj/Debug/ConsoleApplication.exe'
to '/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication/bin/Debug/ConsoleApplication.exe'
Done building project
&quot;/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication/ConsoleApplication.csproj&quot;.
Done building project
&quot;/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication.sln&quot;.

Build succeeded.
0 Warning(s)
0 Error(s)

Time Elapsed 00:00:01.9957420
➜  ConsoleApplication mono ./ConsoleApplication/bin/Debug/ConsoleApplication.exe
wtf?

And it appears __MonoCS__ is no longer defined


System.DllNotFoundException: KERNEL32
  at (wrapper managed-to-native)
EventStore.Core.TransactionLog.Unbuffered.WinNative:GetDiskFreeSpace
(string,uint&amp;,uint&amp;,uint&amp;,uint&amp;)
  at EventStore.Core.TransactionLog.Unbuffered.NativeFile.GetDriveSectorSize
(System.String path) [0x00006] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
  at EventStore.Core.TransactionLog.Unbuffered.UnbufferedFileStream.Create
(System.String path, System.IO.FileMode mode, System.IO.FileAccess
acc, System.IO.FileShare share, System.Boolean sequential,
System.Int32 internalWriteBufferSize, System.Int32
internalReadBufferSize, System.Boolean writeThrough, System.UInt32
minBlockSize) [0x00000] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
  at EventStore.Core.Index.PTable.CacheMidpointsAndVerifyHash
(System.Int32 depth) [0x0002e] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
  at EventStore.Core.Index.PTable..ctor (System.String filename,
System.Guid id, System.Int32 initialReaders, System.Int32 maxReaders,
System.Int32 depth) [0x002a5] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
  at EventStore.Core.Index.PTable.FromMemtable
(EventStore.Core.Index.IMemTable table, System.String filename,
System.Int32 cacheDepth) [0x0018d] in
&lt;d6d24c88c72345b79de5eca974e19875&gt;:0
  at EventStore.Core.Index.TableIndex.ReadOffQueue () [0x000b3] in
&lt;d6d24c88c72345b79de5eca974e19875&gt;:0



-- 
Studying for the Turing test
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="044105.html">[Mono-dev] __MonoCS__ no longer defined?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44104">[ date ]</a>
              <a href="thread.html#44104">[ thread ]</a>
              <a href="subject.html#44104">[ subject ]</a>
              <a href="author.html#44104">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
