<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] __MonoCS__ no longer defined?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20__MonoCS__%20no%20longer%20defined%3F&In-Reply-To=%3CCAB%3DRytWZvnWoikGqDjUn8aLU%3D-ei5FidF%2BVKkBkn-aAW_QAtdw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044113.html">
   <LINK REL="Next"  HREF="044114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] __MonoCS__ no longer defined?</H1>
    <B>Marek Safar</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20__MonoCS__%20no%20longer%20defined%3F&In-Reply-To=%3CCAB%3DRytWZvnWoikGqDjUn8aLU%3D-ei5FidF%2BVKkBkn-aAW_QAtdw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] __MonoCS__ no longer defined?">marek.safar at gmail.com
       </A><BR>
    <I>Wed Jan  4 22:17:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044113.html">[Mono-dev] __MonoCS__ no longer defined?
</A></li>
        <LI>Next message (by thread): <A HREF="044114.html">[Mono-dev] Mono bindings for libnice?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44109">[ date ]</a>
              <a href="thread.html#44109">[ thread ]</a>
              <a href="subject.html#44109">[ subject ]</a>
              <a href="author.html#44109">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is not breaking change. __MonoCS__ is/was intended to be used for Mono
C# compiler
workarounds only [0]. It was never intended to be used for platform
detection and we advertised it that way.

Your code would break same way if someone compiled it on Windows and copied
it over to
non-Windows platform which itself is quite common thing.

Marek

[0]
<A HREF="http://www.mono-project.com/docs/faq/technical/#how-can-i-detect-if-my-code-is-compiled-by-the-mono-mcs-compiler">http://www.mono-project.com/docs/faq/technical/#how-can-i-detect-if-my-code-is-compiled-by-the-mono-mcs-compiler</A>

On Wed, Jan 4, 2017 at 10:30 PM, Greg Young &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>&gt; wrote:

&gt;<i> This is a rather large breaking change no?
</I>&gt;<i>
</I>&gt;<i> On Wed, Jan 4, 2017 at 11:25 PM, Jon Purdy &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">jopur at microsoft.com</A>&gt; wrote:
</I>&gt;<i> &gt; __MonoCS__ is defined by mcs. Master is now using csc (Roslyn) on most
</I>&gt;<i> &gt; systems. You can configure with --with-csc=mcs to keep using mcs, or
</I>&gt;<i> maybe
</I>&gt;<i> &gt; define __MonoCS__ yourself (not sure if this would break anything).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 1/4/17, 1:17 PM, &quot;Mono-devel-list on behalf of Greg Young&quot;
</I>&gt;<i> &gt; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.dot.net</A> on behalf of
</I>&gt;<i> &gt; <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt;I just pulled master today and am suddenly getting loads of errors in
</I>&gt;<i> &gt;&gt;our unit test suite how kernel32 is not defined. EG Exception below.
</I>&gt;<i> &gt;&gt;However all places where this is used are wrapped with
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;I was building on master recently without any issues. It appears
</I>&gt;<i> &gt;&gt;__MonoCS__ is not defined?!
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;        public static uint GetDriveSectorSize(string path)
</I>&gt;<i> &gt;&gt;        {
</I>&gt;<i> &gt;&gt;#if !__MonoCS__ &amp;&amp; !USE_UNIX_IO
</I>&gt;<i> &gt;&gt;            //snip
</I>&gt;<i> &gt;&gt;            WinNative.GetDiskFreeSpace(Path.GetPathRoot(path), out
</I>&gt;<i> &gt;&gt;dontcare, out size, out dontcare, out dontcare);
</I>&gt;<i> &gt;&gt;#else
</I>&gt;<i> &gt;&gt;            //snip
</I>&gt;<i> &gt;&gt;#endif
</I>&gt;<i> &gt;&gt;        }
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;We are seeing this everywhere we have __MonoCS__
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;So I decided to write a test:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;?  ConsoleApplication cat ConsoleApplication/Program.cs
</I>&gt;<i> &gt;&gt;using System;
</I>&gt;<i> &gt;&gt;using System.Collections.Generic;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;namespace ConsoleApplication
</I>&gt;<i> &gt;&gt;{
</I>&gt;<i> &gt;&gt;    internal class Program
</I>&gt;<i> &gt;&gt;    {
</I>&gt;<i> &gt;&gt;        public static void Main(string[] args)
</I>&gt;<i> &gt;&gt;        {
</I>&gt;<i> &gt;&gt;#if __MonoCS__
</I>&gt;<i> &gt;&gt;    Console.WriteLine(&quot;shitbird&quot;);
</I>&gt;<i> &gt;&gt;#else
</I>&gt;<i> &gt;&gt;    Console.WriteLine(&quot;wtf?&quot;);
</I>&gt;<i> &gt;&gt;#endif
</I>&gt;<i> &gt;&gt;        }
</I>&gt;<i> &gt;&gt;    }
</I>&gt;<i> &gt;&gt;}%
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;?  ConsoleApplication xbuild --version
</I>&gt;<i> &gt;&gt;XBuild Engine Version 14.0
</I>&gt;<i> &gt;&gt;Mono, Version 4.9.0.0
</I>&gt;<i> &gt;&gt;Copyright (C) 2005-2013 Various Mono authors
</I>&gt;<i> &gt;&gt;MSBUILD: error MSBUILD0000: Project file '--version' not found.
</I>&gt;<i> &gt;&gt;?  ConsoleApplication xbuild ConsoleApplication.sln
</I>&gt;<i> &gt;&gt;XBuild Engine Version 14.0
</I>&gt;<i> &gt;&gt;Mono, Version 4.9.0.0
</I>&gt;<i> &gt;&gt;Copyright (C) 2005-2013 Various Mono authors
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;Build started 1/4/2017 9:16:26 PM.
</I>&gt;<i> &gt;&gt;__________________________________________________
</I>&gt;<i> &gt;&gt;Project
</I>&gt;<i> &gt;&gt;&quot;/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication.sln&quot;
</I>&gt;<i> &gt;&gt;(default target(s)):
</I>&gt;<i> &gt;&gt;Target ValidateSolutionConfiguration:
</I>&gt;<i> &gt;&gt;Building solution configuration &quot;Debug|Any CPU&quot;.
</I>&gt;<i> &gt;&gt;Target Build:
</I>&gt;<i> &gt;&gt;Project
</I>&gt;<i> &gt;&gt;&quot;/home/greg/src/shitbird/ConsoleApplication/
</I>&gt;<i> ConsoleApplication/ConsoleAppl
</I>&gt;<i> &gt;&gt;ication.csproj&quot;
</I>&gt;<i> &gt;&gt;(default target(s)):
</I>&gt;<i> &gt;&gt;Target PrepareForBuild:
</I>&gt;<i> &gt;&gt;Configuration: Debug Platform: AnyCPU
</I>&gt;<i> &gt;&gt;Target GenerateSatelliteAssemblies:
</I>&gt;<i> &gt;&gt;No input files were specified for target GenerateSatelliteAssemblies,
</I>&gt;<i> &gt;&gt;skipping.
</I>&gt;<i> &gt;&gt;Target CoreCompile:
</I>&gt;<i> &gt;&gt;Tool /opt/mono/lib/mono/4.5/csc.exe execution started with arguments:
</I>&gt;<i> &gt;&gt;/noconfig /debug:portable /debug:portable /optimize-
</I>&gt;<i> &gt;&gt;/out:obj/Debug/ConsoleApplication.exe Program.cs
</I>&gt;<i> &gt;&gt;Properties/AssemblyInfo.cs
</I>&gt;<i> &gt;&gt;obj/Debug/.NETFramework,Version=v4.5.AssemblyAttribute.cs /target:exe
</I>&gt;<i> &gt;&gt;/define:&quot;DEBUG;TRACE&quot; /nostdlib /platform:AnyCPU
</I>&gt;<i> &gt;&gt;/reference:/opt/mono/lib/mono/4.5-api/System.dll
</I>&gt;<i> &gt;&gt;/reference:/opt/mono/lib/mono/4.5-api/System.Xml.Linq.dll
</I>&gt;<i> &gt;&gt;/reference:/opt/mono/lib/mono/4.5-api/System.Data.DataSetExtensions.dll
</I>&gt;<i> &gt;&gt;/reference:/opt/mono/lib/mono/4.5-api/System.Data.dll
</I>&gt;<i> &gt;&gt;/reference:/opt/mono/lib/mono/4.5-api/System.Xml.dll
</I>&gt;<i> &gt;&gt;/reference:/opt/mono/lib/mono/4.5-api/System.Core.dll
</I>&gt;<i> &gt;&gt;/reference:/opt/mono/lib/mono/4.5-api//mscorlib.dll /warn:4
</I>&gt;<i> &gt;&gt;Microsoft (R) Visual C# Compiler version 2.0.0.61205
</I>&gt;<i> &gt;&gt;Copyright (C) Microsoft Corporation. All rights reserved.
</I>&gt;<i> &gt;&gt;Target DeployOutputFiles:
</I>&gt;<i> &gt;&gt;Copying file from
</I>&gt;<i> &gt;&gt;'/home/greg/src/shitbird/ConsoleApplication/
</I>&gt;<i> ConsoleApplication/obj/Debug/C
</I>&gt;<i> &gt;&gt;onsoleApplication.pdb'
</I>&gt;<i> &gt;&gt;to
</I>&gt;<i> &gt;&gt;'/home/greg/src/shitbird/ConsoleApplication/
</I>&gt;<i> ConsoleApplication/bin/Debug/C
</I>&gt;<i> &gt;&gt;onsoleApplication.pdb'
</I>&gt;<i> &gt;&gt;Copying file from
</I>&gt;<i> &gt;&gt;'/home/greg/src/shitbird/ConsoleApplication/
</I>&gt;<i> ConsoleApplication/obj/Debug/C
</I>&gt;<i> &gt;&gt;onsoleApplication.exe'
</I>&gt;<i> &gt;&gt;to
</I>&gt;<i> &gt;&gt;'/home/greg/src/shitbird/ConsoleApplication/
</I>&gt;<i> ConsoleApplication/bin/Debug/C
</I>&gt;<i> &gt;&gt;onsoleApplication.exe'
</I>&gt;<i> &gt;&gt;Done building project
</I>&gt;<i> &gt;&gt;&quot;/home/greg/src/shitbird/ConsoleApplication/
</I>&gt;<i> ConsoleApplication/ConsoleAppl
</I>&gt;<i> &gt;&gt;ication.csproj&quot;.
</I>&gt;<i> &gt;&gt;Done building project
</I>&gt;<i> &gt;&gt;&quot;/home/greg/src/shitbird/ConsoleApplication/ConsoleApplication.sln&quot;.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;Build succeeded.
</I>&gt;<i> &gt;&gt;0 Warning(s)
</I>&gt;<i> &gt;&gt;0 Error(s)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;Time Elapsed 00:00:01.9957420
</I>&gt;<i> &gt;&gt;?  ConsoleApplication mono
</I>&gt;<i> &gt;&gt;./ConsoleApplication/bin/Debug/ConsoleApplication.exe
</I>&gt;<i> &gt;&gt;wtf?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;And it appears __MonoCS__ is no longer defined
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;System.DllNotFoundException: KERNEL32
</I>&gt;<i> &gt;&gt;  at (wrapper managed-to-native)
</I>&gt;<i> &gt;&gt;EventStore.Core.TransactionLog.Unbuffered.WinNative:GetDiskFreeSpace
</I>&gt;<i> &gt;&gt;(string,uint&amp;,uint&amp;,uint&amp;,uint&amp;)
</I>&gt;<i> &gt;&gt;  at
</I>&gt;<i> &gt;&gt;EventStore.Core.TransactionLog.Unbuffered.NativeFile.GetDriveSectorSize
</I>&gt;<i> &gt;&gt;(System.String path) [0x00006] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
</I>&gt;<i> &gt;&gt;  at EventStore.Core.TransactionLog.Unbuffered.
</I>&gt;<i> UnbufferedFileStream.Create
</I>&gt;<i> &gt;&gt;(System.String path, System.IO.FileMode mode, System.IO.FileAccess
</I>&gt;<i> &gt;&gt;acc, System.IO.FileShare share, System.Boolean sequential,
</I>&gt;<i> &gt;&gt;System.Int32 internalWriteBufferSize, System.Int32
</I>&gt;<i> &gt;&gt;internalReadBufferSize, System.Boolean writeThrough, System.UInt32
</I>&gt;<i> &gt;&gt;minBlockSize) [0x00000] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
</I>&gt;<i> &gt;&gt;  at EventStore.Core.Index.PTable.CacheMidpointsAndVerifyHash
</I>&gt;<i> &gt;&gt;(System.Int32 depth) [0x0002e] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
</I>&gt;<i> &gt;&gt;  at EventStore.Core.Index.PTable..ctor (System.String filename,
</I>&gt;<i> &gt;&gt;System.Guid id, System.Int32 initialReaders, System.Int32 maxReaders,
</I>&gt;<i> &gt;&gt;System.Int32 depth) [0x002a5] in &lt;d6d24c88c72345b79de5eca974e19875&gt;:0
</I>&gt;<i> &gt;&gt;  at EventStore.Core.Index.PTable.FromMemtable
</I>&gt;<i> &gt;&gt;(EventStore.Core.Index.IMemTable table, System.String filename,
</I>&gt;<i> &gt;&gt;System.Int32 cacheDepth) [0x0018d] in
</I>&gt;<i> &gt;&gt;&lt;d6d24c88c72345b79de5eca974e19875&gt;:0
</I>&gt;<i> &gt;&gt;  at EventStore.Core.Index.TableIndex.ReadOffQueue () [0x000b3] in
</I>&gt;<i> &gt;&gt;&lt;d6d24c88c72345b79de5eca974e19875&gt;:0
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;--
</I>&gt;<i> &gt;&gt;Studying for the Turing test
</I>&gt;<i> &gt;&gt;_______________________________________________
</I>&gt;<i> &gt;&gt;Mono-devel-list mailing list
</I>&gt;<i> &gt;&gt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;<i> &gt;&gt;<A HREF="https://na01.safelinks.protection.outlook.com/?url=">https://na01.safelinks.protection.outlook.com/?url=</A>
</I>&gt;<i> http%3A%2F%2Flists.dot.
</I>&gt;<i> &gt;&gt;net%2Fmailman%2Flistinfo%2Fmono-devel-list&amp;data=02%
</I>&gt;<i> 7C01%7Cjopur%40microsof
</I>&gt;<i> &gt;&gt;t.com%7Cc47bb70efa0e47145d8a08d434e729a5%7C72f988bf86f141af91ab2d7cd011
</I>&gt;<i> db4
</I>&gt;<i> &gt;&gt;7%7C1%7C0%7C636191614832257156&amp;sdata=UqAocpYwtgbnVJc%
</I>&gt;<i> 2FsmvGH7XPnO42jk5Ivf9
</I>&gt;<i> &gt;&gt;AEd8sojQ%3D&amp;reserved=0
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Studying for the Turing test
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">http://lists.dot.net/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20170104/09eee62f/attachment-0001.html">http://lists.dot.net/pipermail/mono-devel-list/attachments/20170104/09eee62f/attachment-0001.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044113.html">[Mono-dev] __MonoCS__ no longer defined?
</A></li>
	<LI>Next message (by thread): <A HREF="044114.html">[Mono-dev] Mono bindings for libnice?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44109">[ date ]</a>
              <a href="thread.html#44109">[ thread ]</a>
              <a href="subject.html#44109">[ subject ]</a>
              <a href="author.html#44109">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
