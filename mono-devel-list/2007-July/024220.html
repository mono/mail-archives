<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Possible Crypto bug found...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Possible%20Crypto%20bug%20found...&In-Reply-To=9220B2717B028A44B29333A6C62DBA70062BD280%40gvlexch04.is.l-3com.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024215.html">
   <LINK REL="Next"  HREF="024221.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Possible Crypto bug found...</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Possible%20Crypto%20bug%20found...&In-Reply-To=9220B2717B028A44B29333A6C62DBA70062BD280%40gvlexch04.is.l-3com.com"
       TITLE="[Mono-dev] Possible Crypto bug found...">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Thu Jul 19 21:29:33 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024215.html">[Mono-dev] Possible Crypto bug found...
</A></li>
        <LI>Next message: <A HREF="024221.html">[Mono-dev] Possible Crypto bug found...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24220">[ date ]</a>
              <a href="thread.html#24220">[ thread ]</a>
              <a href="subject.html#24220">[ subject ]</a>
              <a href="author.html#24220">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

This is a known &quot;issue&quot;. The sample code doesn't check for
ICryptoTransform.CanReuseTransform and this value is different between
Mono and MS.

Actually the code is somewhat dangerous as you can't be sure what
implementation will be used at runtime, because implementation can be
remapped using CryptoConfig. This means that someone else (with a custom
machine.config could be using another Rijndael implementation and the
code would fail under MS runtime too).

&lt;note-to-self&gt;a gendarme rule to check for this would be
nice&lt;/note-to-self&gt;

Sebastien

On Thu, 2007-07-19 at 12:21 -0500, Stutzman, JL Jason @ IS wrote:
&gt;<i> Using the sample code found below:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.obviex.com/samples/EncryptionWithSalt.aspx">http://www.obviex.com/samples/EncryptionWithSalt.aspx</A>
</I>&gt;<i> 
</I>&gt;<i> In the sample there is a loop that encrypts and decrypts several times.
</I>&gt;<i> If I add an extra encrypt in the loop before doing a decrypt:
</I>&gt;<i> 
</I>&gt;<i> cipherText = rijndaelKey.Encrypt(plainText);
</I>&gt;<i> cipherText = rijndaelKey.Encrypt(plainText);
</I>&gt;<i> 
</I>&gt;<i> then the Decrypt throws and exception on mono (which is not exactly
</I>&gt;<i> relevant, just pointing to the real problem):
</I>&gt;<i> 
</I>&gt;<i> System.OverflowException: Number overflow.
</I>&gt;<i>   at &lt;0x00000&gt; &lt;unknown method&gt;
</I>&gt;<i>   at (wrapper managed-to-native)
</I>&gt;<i> System.Object:__icall_wrapper_mono_array_new_specific (intptr,int)
</I>&gt;<i>   at RijndaelEnhanced.DecryptToBytes (System.Byte[] cipherTextBytes)
</I>&gt;<i> [0x00000] 
</I>&gt;<i>   at RijndaelEnhanced.Decrypt (System.Byte[] cipherTextBytes) [0x00000] 
</I>&gt;<i>   at RijndaelEnhancedTest.Main (System.String[] args) [0x00000] 
</I>&gt;<i> 
</I>&gt;<i> However if I recreate the encryptor and decryptor each time, the sample
</I>&gt;<i> works.
</I>&gt;<i> 
</I>&gt;<i> What seems to be happening is that the decryptor is not working
</I>&gt;<i> properly. The reason for this error is that the array trying to be
</I>&gt;<i> created is a negative size :)...but that is because the salt length is
</I>&gt;<i> greater than the decrypted size. My point is that the sample is showing
</I>&gt;<i> differences between the two runtimes.
</I>&gt;<i> 
</I>&gt;<i> On MS I don't have to recreate the encryptor/decryptor each time. Is
</I>&gt;<i> this known? Is the goal for crypto stuff to work the same as MS?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Jae
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024215.html">[Mono-dev] Possible Crypto bug found...
</A></li>
	<LI>Next message: <A HREF="024221.html">[Mono-dev] Possible Crypto bug found...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24220">[ date ]</a>
              <a href="thread.html#24220">[ thread ]</a>
              <a href="subject.html#24220">[ subject ]</a>
              <a href="author.html#24220">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
