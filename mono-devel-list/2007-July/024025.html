<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Walking all managed objects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Walking%20all%20managed%20objects&In-Reply-To=C595A4C1-30CA-48EA-8096-006C54BB9423%40otee.dk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024017.html">
   <LINK REL="Next"  HREF="024038.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Walking all managed objects</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Walking%20all%20managed%20objects&In-Reply-To=C595A4C1-30CA-48EA-8096-006C54BB9423%40otee.dk"
       TITLE="[Mono-dev] Walking all managed objects">lupus at ximian.com
       </A><BR>
    <I>Tue Jul  3 05:27:17 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024017.html">[Mono-dev] Walking all managed objects
</A></li>
        <LI>Next message: <A HREF="024038.html">[Mono-dev] Walking all managed objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24025">[ date ]</a>
              <a href="thread.html#24025">[ thread ]</a>
              <a href="subject.html#24025">[ subject ]</a>
              <a href="author.html#24025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/02/07 Joachim Ante wrote:
&gt;<i> Is there any way from managed or unmanaged code to iterate through  
</I>&gt;<i> all allocated managed objects?
</I>&gt;<i> I presume the Garbage collector must have this data somewhere?
</I>
It does, but the way it does it is not exposed and it will never be
exposed (because it's an internal detail and the user can't perform
the same traversal safely). You can implement something similar
using reflection or the embedded API, by looking at the fields
and iterating their values, though handling recursive references would
be a pain in managed code and not really safe if done in unmanaged code
(you can't stop the world and this means the mutator threads can change
references under you or a GC can happen or many other things can go
wrong...). You'll be able to do this only for GC root you keep track of
yourself, though.

&gt;<i> I basically want to see which objects are being referenced and then  
</I>&gt;<i> unload some unmanaged data based on it.
</I>&gt;<i> I don't want to override the finalizer for performance reasons. In  
</I>&gt;<i> our situation there are specific times where i can just spend a bunch  
</I>&gt;<i> of time on cleanup.
</I>
It sounds like you want to get weak references to the interesting
objects (mono_gchandle_new_weakref() in the embedded API or the
low-level GCHandle in managed code) and put them in an array:
when the time comes you iterate the handles and check the ones that
have a null target, meaning the object was collected and perform your
cleanup, including freeing the GC handle. This lets you decide when to
do the cleanup which seems to be one of your concerns (this solution
should be a little cheaper than finalizers and definitely cheaper than
doing the tarversal yourself or using the profiler interface as was
suggested which have the additional issues detailed above).

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024017.html">[Mono-dev] Walking all managed objects
</A></li>
	<LI>Next message: <A HREF="024038.html">[Mono-dev] Walking all managed objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24025">[ date ]</a>
              <a href="thread.html#24025">[ thread ]</a>
              <a href="subject.html#24025">[ subject ]</a>
              <a href="author.html#24025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
