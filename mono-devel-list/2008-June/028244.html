<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Implement support for mixed-mode assemblies on Windows x64 as well
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Implement%20support%20for%20mixed-mode%20assemblies%20on%0A%20Windows%20x64%20as%20well&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028242.html">
   <LINK REL="Next"  HREF="028245.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Implement support for mixed-mode assemblies on Windows x64 as well</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Implement%20support%20for%20mixed-mode%20assemblies%20on%0A%20Windows%20x64%20as%20well&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] Implement support for mixed-mode assemblies on Windows x64 as well">kornelpal at gmail.com
       </A><BR>
    <I>Mon Jun 16 15:56:59 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028242.html">[Mono-dev] DataSet / DataTable xsd fix wrt Locale and	UseCurrentLocale
</A></li>
        <LI>Next message: <A HREF="028245.html">[Mono-dev] gmcs:compiler &gt; &quot;Cannot convert type `lambda expression'	to `System.Action'&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28244">[ date ]</a>
              <a href="thread.html#28244">[ thread ]</a>
              <a href="subject.html#28244">[ subject ]</a>
              <a href="author.html#28244">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The attached patch makes some modifications to enable mixed-mode 
assembly support on Windows x64 as well.

I already update mixed-mode tests to support x64 and are working with 
this patch.

domain.c: Avoid system error message boxes.

assembly.c: Use __ImageBase instead of mono_module_handle that is 
defined by the linker; no initialization required.

image.c: mono_image_open_from_module_handle: Replace ref_count argument 
with has_entry_point. Handle do_mono_image_load fauilre correctly.

mono_image_open_full, mono_image_close: Use has_entry_point instead of 
coff_attributes.

coree.c: _CorValidateImage: Convert platform independent PE32 images to 
PE32+ on 64-bit Windows that makes the OS able to load CIL images as 
modules.

MonoFixupCorEE: Export Address Table RVAs are 32-bit unsigned integers 
so memory has to be allocated for trampolines (x64) or procedure labels 
(IA64) up to 4 GB away from image base address. IA64 version is not 
tested but was very easy to implement and should work if we ever need it.

Also contains some work to make MonoFixupCorEE reversible when unloading 
mono.dll but that's not implemented yet.

Please test the attached patch and if you like it, please approve it.

Korn&#233;l
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: mixed-mode-x64.diff.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080616/87256f72/attachment-0001.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080616/87256f72/attachment-0001.txt</A> 
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028242.html">[Mono-dev] DataSet / DataTable xsd fix wrt Locale and	UseCurrentLocale
</A></li>
	<LI>Next message: <A HREF="028245.html">[Mono-dev] gmcs:compiler &gt; &quot;Cannot convert type `lambda expression'	to `System.Action'&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28244">[ date ]</a>
              <a href="thread.html#28244">[ thread ]</a>
              <a href="subject.html#28244">[ subject ]</a>
              <a href="author.html#28244">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
