<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [Fwd: [Mono-patches] r106626 - in	trunk/mcs/class/System.Configuration: .	System.Configuration	Test/System.Configuration Test/standalone]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BFwd%3A%20%5BMono-patches%5D%20r106626%20-%20in%0A%09trunk/mcs/class/System.Configuration%3A%20.%09System.Configuration%0A%09Test/System.Configuration%20Test/standalone%5D&In-Reply-To=4863748B.1070108%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028320.html">
   <LINK REL="Next"  HREF="028323.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [Fwd: [Mono-patches] r106626 - in	trunk/mcs/class/System.Configuration: .	System.Configuration	Test/System.Configuration Test/standalone]</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BFwd%3A%20%5BMono-patches%5D%20r106626%20-%20in%0A%09trunk/mcs/class/System.Configuration%3A%20.%09System.Configuration%0A%09Test/System.Configuration%20Test/standalone%5D&In-Reply-To=4863748B.1070108%40ximian.com"
       TITLE="[Mono-dev] [Fwd: [Mono-patches] r106626 - in	trunk/mcs/class/System.Configuration: .	System.Configuration	Test/System.Configuration Test/standalone]">gert.driesen at telenet.be
       </A><BR>
    <I>Thu Jun 26 07:04:47 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028320.html">[Mono-dev] [Fwd: [Mono-patches] r106626 - in trunk/mcs/class/System.Configuration: .	System.Configuration Test/System.Configuration Test/standalone]
</A></li>
        <LI>Next message: <A HREF="028323.html">[Mono-dev] [Fwd: [Mono-patches] r106626 - in trunk/mcs/class/System.Configuration: .	System.Configuration Test/System.Configuration Test/standalone]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28321">[ date ]</a>
              <a href="thread.html#28321">[ thread ]</a>
              <a href="subject.html#28321">[ subject ]</a>
              <a href="author.html#28321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Atsushi,

This change is necessary for compatibility with MS and should not affect
performance at all.

Lazy initialization of ClientConfigurationSystem actually improves startup
time, and fixes the t28 standalone test.

It also removes the dependency on internal hacks (which were necessary for
the 1.0 profile), and instead relies on the implementation of
IConfigErrorInfo for retrieving filename/linenumber info.

My changes do not block future performance improvements. You'll just have to
implement IConfigErrorInfo on your XmlNodeReader-based implementation.

I wouldn't see why reverting this patch is necessary as it:

* improves compatibility with MS
* adds unit tests to verify this
* fixes a few minor issues

while still allowing for a different internal implementation.

If any patch with such characteristics would be removed, then nothing much
would be left ;-)

Gert

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Atsushi Eno
Sent: donderdag 26 juni 2008 12:51
To: 'mono-devel-list'
Subject: [Mono-dev] [Fwd: [Mono-patches] r106626 - in
trunk/mcs/class/System.Configuration: . System.Configuration
Test/System.Configuration Test/standalone]

Man, I don't think this is a good change. We (in Boston) are talking
about sys.configuration optimization, and will likely have to eliminate
XmlTextReader dependency (actually I have such a change possibly
to switch to XmlNodeReader at some stage). Your change would make
performance worse, or at least block significant performance
improvements.

I see almost no benefits and will revert unless you claim very
important improvements.

Atsushi Eno


-------- Original Message --------
Subject: [Mono-patches] r106626 - in 
trunk/mcs/class/System.Configuration: .	System.Configuration 
Test/System.Configuration Test/standalone
Date: Thu, 26 Jun 2008 06:31:08 -0400 (EDT)
From: Gert Driesen (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>) 
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-patches-list at lists.ximian.com</A>&gt;
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-patches at lists.ximian.com</A>, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ximian.monolist at gmail.com</A>, 
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-svn-patches-garchive-20758 at googlegroups.com</A>

Author: gert
Date: 2008-06-26 06:31:07 -0400 (Thu, 26 Jun 2008)
New Revision: 106626

Added:
 
trunk/mcs/class/System.Configuration/System.Configuration/ConfigXmlTextReade
r.cs
 
trunk/mcs/class/System.Configuration/Test/System.Configuration/Configuration
ErrorsExceptionTest.cs
    trunk/mcs/class/System.Configuration/Test/standalone/Assert.cs
Modified:
    trunk/mcs/class/System.Configuration/ChangeLog
    trunk/mcs/class/System.Configuration/System.Configuration.dll.sources
 
trunk/mcs/class/System.Configuration/System.Configuration/AppSettingsSection
.cs
    trunk/mcs/class/System.Configuration/System.Configuration/ChangeLog
 
trunk/mcs/class/System.Configuration/System.Configuration/ClientConfiguratio
nSystem.cs
    trunk/mcs/class/System.Configuration/System.Configuration/ConfigInfo.cs
 
trunk/mcs/class/System.Configuration/System.Configuration/Configuration.cs
 
trunk/mcs/class/System.Configuration/System.Configuration/ConfigurationEleme
nt.cs
 
trunk/mcs/class/System.Configuration/System.Configuration/ConfigurationError
sException.cs
 
trunk/mcs/class/System.Configuration/System.Configuration/ConfigurationLocat
ion.cs
 
trunk/mcs/class/System.Configuration/System.Configuration/ConfigurationSecti
on.cs
 
trunk/mcs/class/System.Configuration/System.Configuration_test.dll.sources
    trunk/mcs/class/System.Configuration/Test/System.Configuration/ChangeLog
    trunk/mcs/class/System.Configuration/Test/standalone/ChangeLog
    trunk/mcs/class/System.Configuration/Test/standalone/Makefile
    trunk/mcs/class/System.Configuration/Test/standalone/t28.cs
    trunk/mcs/class/System.Configuration/Test/standalone/t42.cs
Log:
* ConfigurationErrorsExceptionTest.cs: Added tests for ctors and
GetFilename/GetLineNumber overloads.
* System.Configuration_test.dll.sources: added
ConfigurationErrorsExceptionTest.cs.
* System.Configuration.dll.sources: added ConfigXmlTextReader.cs.
* ConfigurationElement.cs: Use ConfigurationErrorsException instead of
ConfigurationException, and pass reader to ConfigurationErrorsException
ctor to allow for file/linenumber info in exception message.
* ConfigurationErrorsException.cs: Removed local bareMessage field, and
use base.BareMessage field instead. Fixed Message property to only add
filename if not null or zero-length string, and only add line if not
zero. In GetFilename/GetLineNumber overloads, only try to get info if
node/reader implements IConfigErrorInfo.
* ConfigurationSection.cs: Use ConfigXmlTextReader instead of
XmlTextReader to allow for file/linenumber info in exception messages.
* ConfigXmlTextReader.cs: Added XmlTextReader that implements
IConfigErrorInfo.
* ConfigurationLocation.cs: Use ConfigXmlTextReader instead of
XmlTextReader to allow for file/linenumber info in exception messages.
* ClientConfigurationSystem.cs: Perform lazy initialization and
wrap exceptions in ConfigurationErrorsException. Fixes standalone test
t28.
* Configuration.cs: Use ConfigXmlTextReader instead of XmlTextReader
to allow for file/linenumber info in exception messages.
* ConfigInfo.cs: Fixed ThrowException to use file/number info available
in XmlTextReader for exception message.
* AppSettingsSection.cs: Use ConfigXmlTextReader instead of
XmlTextReader to allow for file/linenumber info in exception messages.
* Assert.cs: added.
* Makefile: added Assert.cs, and explicitly specify output file.
* t28.cs: Improved test.


_______________________________________________
Mono-devel-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028320.html">[Mono-dev] [Fwd: [Mono-patches] r106626 - in trunk/mcs/class/System.Configuration: .	System.Configuration Test/System.Configuration Test/standalone]
</A></li>
	<LI>Next message: <A HREF="028323.html">[Mono-dev] [Fwd: [Mono-patches] r106626 - in trunk/mcs/class/System.Configuration: .	System.Configuration Test/System.Configuration Test/standalone]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28321">[ date ]</a>
              <a href="thread.html#28321">[ thread ]</a>
              <a href="subject.html#28321">[ subject ]</a>
              <a href="author.html#28321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
