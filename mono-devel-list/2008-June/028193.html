<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono C# Serial Port problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20C%23%20Serial%20Port%20problem&In-Reply-To=17753378.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028190.html">
   <LINK REL="Next"  HREF="028164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono C# Serial Port problem</H1>
    <B>Leszek Ciesielski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20C%23%20Serial%20Port%20problem&In-Reply-To=17753378.post%40talk.nabble.com"
       TITLE="[Mono-dev] Mono C# Serial Port problem">skolima at gmail.com
       </A><BR>
    <I>Tue Jun 10 11:37:06 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028190.html">[Mono-dev] Mono C# Serial Port problem
</A></li>
        <LI>Next message: <A HREF="028164.html">[Mono-dev] [PATCH] Implement Thread.BeginThreadAffinity and EndThreadAffinity methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28193">[ date ]</a>
              <a href="thread.html#28193">[ thread ]</a>
              <a href="subject.html#28193">[ subject ]</a>
              <a href="author.html#28193">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The RecievedEvent is not implemented (check the exception...). If you
need to monitor the serial port for incoming data, create a separate
thread for handling the port and use the blocking Read methods.
Remember not to use the port outside the thread that has created it.

Please note that MSDN states that the SerialPort class is not
thread-safe, then happily ignores this and keeps tossing it between
threads in every example.

On Tue, Jun 10, 2008 at 1:42 PM, PaceyIV &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">paceynet at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Uhm...
</I>&gt;<i>
</I>&gt;<i> Now I try the code below. It works on Microsoft Visual Studio, but not in
</I>&gt;<i> mono on Ubuntu.
</I>&gt;<i> It compile it, but when I try to run it I get this error:
</I>&gt;<i>
</I>&gt;<i> Unhandled Exception: System.NotImplementedException: The requested feature
</I>&gt;<i> is not implemented.
</I>&gt;<i>  at System.IO.Ports.SerialPort.set_ReceivedBytesThreshold (Int32 value)
</I>&gt;<i> [0x00012] in
</I>&gt;<i> /build/buildd/mono-1.2.6+dfsg/mcs/class/System/System.IO.Ports/SerialPort.cs:410
</I>&gt;<i>  at (wrapper remoting-invoke-with-check)
</I>&gt;<i> System.IO.Ports.SerialPort:set_ReceivedBytesThreshold (int)
</I>&gt;<i>  at ConsoleApplication1.Program.Main (System.String[] args) [0x0004f] in
</I>&gt;<i> /home/paceyiv/programmazione/mono/Microsoft/Microsoft/Main.cs:29
</I>&gt;<i>
</I>&gt;<i> So I comment the line!
</I>&gt;<i> I think don't work the SerialDataReceivedEventHandler. I can write code to
</I>&gt;<i> read the byte from serial and the device respond, but the Serial Data
</I>&gt;<i> Received Event newer works on mono.
</I>&gt;<i>
</I>&gt;<i> What's wrong?
</I>&gt;<i>
</I>&gt;<i> using System;
</I>&gt;<i> using System.Collections.Generic;
</I>&gt;<i> //using System.Linq;
</I>&gt;<i> using System.Text;
</I>&gt;<i> using System.IO;
</I>&gt;<i> using System.IO.Ports;
</I>&gt;<i> using System.Threading;
</I>&gt;<i>
</I>&gt;<i> namespace ConsoleApplication1
</I>&gt;<i> {
</I>&gt;<i>    class Program
</I>&gt;<i>    {
</I>&gt;<i>        static System.IO.Ports.SerialPort rs232;
</I>&gt;<i>
</I>&gt;<i>        static string dati;
</I>&gt;<i>
</I>&gt;<i>        static void Main(string[] args)
</I>&gt;<i>        {
</I>&gt;<i>            // Setup RS-232
</I>&gt;<i>                        rs232 = new SerialPort(&quot;/dev/ttyUSB0&quot;, 9600);
</I>&gt;<i>                        // for Win
</I>&gt;<i>            //rs232 = new SerialPort(&quot;COM3&quot;, 9600);
</I>&gt;<i>            rs232.BaudRate = 9600;
</I>&gt;<i>            rs232.Parity = Parity.None;
</I>&gt;<i>            rs232.DataBits = 8;
</I>&gt;<i>            rs232.StopBits = StopBits.One;
</I>&gt;<i>            rs232.Handshake = Handshake.None;
</I>&gt;<i>
</I>&gt;<i>                        //rs232.ReadTimeout = 2000;
</I>&gt;<i>                        //rs232.ReadBufferSize = 1024;
</I>&gt;<i>            //rs232.ReceivedBytesThreshold = 1; // This don't work in mono!
</I>&gt;<i>            rs232.DataReceived +=
</I>&gt;<i>                new SerialDataReceivedEventHandler(rs232_DataReceived); //
</I>&gt;<i> This don't work in mono!
</I>&gt;<i>
</I>&gt;<i>            // Open SerialPort
</I>&gt;<i>                        try
</I>&gt;<i>                        {
</I>&gt;<i>                                rs232.Open();
</I>&gt;<i>                                // Do I really need this?
</I>&gt;<i>                                //rs232.DiscardInBuffer();
</I>&gt;<i>                                //rs232.DiscardOutBuffer();
</I>&gt;<i>
</I>&gt;<i>                                // Dealy for my specific device
</I>&gt;<i>                                Thread.Sleep(1500);
</I>&gt;<i>                        }
</I>&gt;<i>                        catch (System.IO.IOException ioe)
</I>&gt;<i>                        {
</I>&gt;<i>                                Console.Write(ioe.Message);
</I>&gt;<i>                                Environment.Exit(1);
</I>&gt;<i>                        }
</I>&gt;<i>
</I>&gt;<i>                        // survive to Microsoft :)
</I>&gt;<i>                        //CheckForIllegalCrossThreadCalls = false;
</I>&gt;<i>
</I>&gt;<i>                        // Send command to read some date from the device
</I>&gt;<i>            rs232.WriteLine(&quot;A&quot;);
</I>&gt;<i>
</I>&gt;<i>            string m;
</I>&gt;<i>            bool continua = true;
</I>&gt;<i>            while (continua)
</I>&gt;<i>            {
</I>&gt;<i>                m = Console.ReadLine();
</I>&gt;<i>                if (m==&quot;q&quot;)
</I>&gt;<i>                {
</I>&gt;<i>                    continua = false;
</I>&gt;<i>                }
</I>&gt;<i>            }
</I>&gt;<i>
</I>&gt;<i>        }
</I>&gt;<i>
</I>&gt;<i>        static void rs232_DataReceived(object sender,
</I>&gt;<i> SerialDataReceivedEventArgs e)
</I>&gt;<i>        {
</I>&gt;<i>            dati += rs232.ReadExisting();
</I>&gt;<i>            if (dati.Contains(&quot;$&quot;))
</I>&gt;<i>            {
</I>&gt;<i>                Console.WriteLine(dati);
</I>&gt;<i>            }
</I>&gt;<i>        }
</I>&gt;<i>    }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://www.nabble.com/Mono-C--Serial-Port-problem-tp17241892p17753378.html">http://www.nabble.com/Mono-C--Serial-Port-problem-tp17241892p17753378.html</A>
</I>&gt;<i> Sent from the Mono - Dev mailing list archive at Nabble.com.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>


-- 
MS-DOS user since 5.0
Windows user since 3.11
Linux user since kernel 2.4
Novell Netware user since 2.2
WARCRAFT user since 1.0
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028190.html">[Mono-dev] Mono C# Serial Port problem
</A></li>
	<LI>Next message: <A HREF="028164.html">[Mono-dev] [PATCH] Implement Thread.BeginThreadAffinity and EndThreadAffinity methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28193">[ date ]</a>
              <a href="thread.html#28193">[ thread ]</a>
              <a href="subject.html#28193">[ subject ]</a>
              <a href="author.html#28193">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
