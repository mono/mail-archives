<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Mono DTrace provider v2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Mono%20DTrace%20provider%20v2&In-Reply-To=0610BF94-DE71-4CB9-80A0-EB5372694781%40web.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028146.html">
   <LINK REL="Next"  HREF="028128.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Mono DTrace provider v2</H1>
    <B>Zoltan Varga</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Mono%20DTrace%20provider%20v2&In-Reply-To=0610BF94-DE71-4CB9-80A0-EB5372694781%40web.de"
       TITLE="[Mono-dev] [PATCH] Mono DTrace provider v2">vargaz at gmail.com
       </A><BR>
    <I>Tue Jun  3 12:32:15 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028146.html">[Mono-dev]  gdal/mono/linux; Native bindings, PInvoke, and tracking TypeLoader exceptions
</A></li>
        <LI>Next message: <A HREF="028128.html">[Mono-dev] [PATCH] Mono DTrace provider v3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28126">[ date ]</a>
              <a href="thread.html#28126">[ thread ]</a>
              <a href="subject.html#28126">[ subject ]</a>
              <a href="author.html#28126">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

  Wouldn't be easier to pass the DTRACE and DTRACEFLAGS arguments to the
prelink.sh script in Makefile.am as well, instead of creating it from
an .in file ?
Other than that, I think this is ok to check in. I still don't like
the makefile changes,
but at least they are inside an ifdef, so they won't break anything.

                               Zoltan

On Sat, May 31, 2008 at 12:09 AM, Andreas F&#228;rber &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">andreas.faerber at web.de</A>&gt; wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> Here's an updated version of my patch, adding initial DTrace support to the
</I>&gt;<i> Mono runtime.
</I>&gt;<i>
</I>&gt;<i> A new hand-crafted header file has been added, which is to be included in
</I>&gt;<i> place of the generated header file. It defines MONO_PROBE_* macros as
</I>&gt;<i> requested by Zoltan. The generated header file is then only needed iff
</I>&gt;<i> DTrace is enabled.
</I>&gt;<i>
</I>&gt;<i> Ugly build steps for Solaris were moved to a shell script. It extracts
</I>&gt;<i> object files from their library to a temporary directory, patches them and
</I>&gt;<i> puts them back in. This helps keep Makefiles clean and provides a one-stop
</I>&gt;<i> resource to fix things, should they break. Tested on OpenSolaris 2008.05
</I>&gt;<i> i86. (Warning: I am not experienced in writing shell scripts.)
</I>&gt;<i>
</I>&gt;<i> It appears the problem with the gc-end probe on Solaris was due to some kind
</I>&gt;<i> of compiler optimization or the like. Adding a trailing sleep(0) call made
</I>&gt;<i> it work; I have limited this workaround to when the gc-end probe is enabled
</I>&gt;<i> on Solaris, to minimize the impact. Better ideas welcome. If we do stick
</I>&gt;<i> with it and it turns out this is needed in more void functions, we could
</I>&gt;<i> consider turning this into a MONO_PROBE_* macro to keep source files clean.
</I>&gt;<i>
</I>&gt;<i> Signed-off-by: Andreas Faerber &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">andreas.faerber at web.de</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Change Log v2:
</I>&gt;<i>
</I>&gt;<i> * dtrace-prelink.sh.in: New
</I>&gt;<i>  Script to prevent ugly Solaris hacks in Makefiles.
</I>&gt;<i>
</I>&gt;<i> * configure.in:
</I>&gt;<i>  Prepare support for OSX/x86_64 (untested)
</I>&gt;<i>  Output dtrace-prelink.sh script.
</I>&gt;<i>
</I>&gt;<i> * data/mono.d: Renamed (from mono-trace.d)
</I>&gt;<i>  Added standard Mono header.
</I>&gt;<i>  Added generation argument to gc-{begin,end} probes.
</I>&gt;<i>  Added explicit stability attributes.
</I>&gt;<i>
</I>&gt;<i> * mono/utils/dtrace.h: New
</I>&gt;<i>  Wrapper around generated mono/utils/mono-dtrace.h.
</I>&gt;<i>  Define MONO_PROBE_* macros.
</I>&gt;<i>
</I>&gt;<i> * mono/utils/Makefile.am:
</I>&gt;<i>  We no longer need to postprocess the generated header file.
</I>&gt;<i>
</I>&gt;<i> * mono/metadata/Makefile.am,
</I>&gt;<i>  mono/mini/Makefile.am:
</I>&gt;<i>  Use new dtrace-prelink.sh script.
</I>&gt;<i>
</I>&gt;<i> * mono/mini/mini.c,
</I>&gt;<i>  mono/metadata/boehm-gc.c:
</I>&gt;<i>  Use new macros
</I>&gt;<i>
</I>&gt;<i> * mono/metadata/boehm-gc.c:
</I>&gt;<i>  Add workaround to make gc-end probe work on Solaris.
</I>&gt;<i>
</I>&gt;<i> Andreas
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028146.html">[Mono-dev]  gdal/mono/linux; Native bindings, PInvoke, and tracking TypeLoader exceptions
</A></li>
	<LI>Next message: <A HREF="028128.html">[Mono-dev] [PATCH] Mono DTrace provider v3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28126">[ date ]</a>
              <a href="thread.html#28126">[ thread ]</a>
              <a href="subject.html#28126">[ subject ]</a>
              <a href="author.html#28126">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
