<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] How to create trampolines for	mono_marshal_get_vtfixup_ftnptr?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20to%20create%20trampolines%20for%0A%09mono_marshal_get_vtfixup_ftnptr%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028142.html">
   <LINK REL="Next"  HREF="028160.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] How to create trampolines for	mono_marshal_get_vtfixup_ftnptr?</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20to%20create%20trampolines%20for%0A%09mono_marshal_get_vtfixup_ftnptr%3F&In-Reply-To="
       TITLE="[Mono-dev] How to create trampolines for	mono_marshal_get_vtfixup_ftnptr?">kornelpal at gmail.com
       </A><BR>
    <I>Thu Jun  5 04:33:03 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028142.html">[Mono-dev]  [PATCH] Marshaling structs on Winx64
</A></li>
        <LI>Next message: <A HREF="028160.html">[Mono-dev] Using the mono parser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28144">[ date ]</a>
              <a href="thread.html#28144">[ thread ]</a>
              <a href="subject.html#28144">[ subject ]</a>
              <a href="author.html#28144">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Current implementation of mono_image_fixup_vtable calls
mono_marshal_get_vtfixup_ftnptr that JITs a wrapper. The problem
however is that the wrapper has to know the types uses used as
arguments and return value that means that the assembly has to be
loaded before mono_marshal_get_vtfixup_ftnptr is called.

mono_image_fixup_vtable should be called when loading the image and
the assembly should not be loaded by LoadLibray to any AppDomain.

I would like to only create a trampline in mono_image_fixup_vtable
that will load the assembly and will create a wrapper using
mono_marshal_get_vtfixup_ftnptr. This should also enable implementing
proper AppDomain handling for VTFIXUP_TYPE_FROM_UNMANAGED and
VTFIXUP_TYPE_FROM_UNMANAGED_RETAIN_APPDOMAIN.

I have no problem in creating a trampoline function for calling
mono_marshal_get_vtfixup_ftnptr but I don't know how to replace the
trampline with the actual wrapper with respect to concurency handling.

Could you please point me to some existing code in the runtime already
doing similar things?

Thanks.

Korn&#233;l
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028142.html">[Mono-dev]  [PATCH] Marshaling structs on Winx64
</A></li>
	<LI>Next message: <A HREF="028160.html">[Mono-dev] Using the mono parser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28144">[ date ]</a>
              <a href="thread.html#28144">[ thread ]</a>
              <a href="subject.html#28144">[ subject ]</a>
              <a href="author.html#28144">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
