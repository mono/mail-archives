<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono.Simd Acceleration Attributes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono.Simd%20Acceleration%20Attributes&In-Reply-To=8cca42d80811070714r811f842ob6d9bcfc9ce0eb56%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029699.html">
   <LINK REL="Next"  HREF="029746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono.Simd Acceleration Attributes</H1>
    <B>russell.kay at realtimeworlds.com</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono.Simd%20Acceleration%20Attributes&In-Reply-To=8cca42d80811070714r811f842ob6d9bcfc9ce0eb56%40mail.gmail.com"
       TITLE="[Mono-dev] Mono.Simd Acceleration Attributes">russell.kay at realtimeworlds.com
       </A><BR>
    <I>Mon Nov 10 07:04:38 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="029699.html">[Mono-dev] Mono.Simd Acceleration Attributes
</A></li>
        <LI>Next message: <A HREF="029746.html">[Mono-dev] Mono.Simd Acceleration Attributes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29745">[ date ]</a>
              <a href="thread.html#29745">[ thread ]</a>
              <a href="subject.html#29745">[ subject ]</a>
              <a href="author.html#29745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rodrigo,

 

My only problem with this is the language is tied to the x86
architecture, when Altivec or Paired Single  etc are added for PowerPC
then these attributes are nonsensical and will mean nothing to the user.
This would be better done in a static location (rather than spread over
the libraries) and split into a machine agnostic (Simd acceleration ON)
and a machine specific manner (sse1 - 4.2 active).

 

My 2c


Russell

 

________________________________

From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Rodrigo
Kumpera
Sent: 07 November 2008 15:15
To: Christophe Guillon
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-dev] Mono.Simd Acceleration Attributes

 

Hi Christophe,



2008/11/7 Christophe Guillon &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">christophe.guillon.perso at gmail.com</A>&gt;

Thank you for the explanation. It confirms my point and it seems that we
agree.

For the user guide aspect:


&gt;<i>2) the attributes on the methods are never inspected by the runtime:
</I>&gt;<i>they are there to guide the programmers using Mono.Simd in determining
</I>&gt;<i>what kind of optimizations are usually available or currently enabled.
</I>
If it is indeed &quot;just&quot; a guide to the user of Mono.Simd, thus why
putting it in the library and coupling this with the specific
architecture (SSE2 or other). The fact that it is an AddWithSaturation
on a Vector16b is sufficient for the semantic. Then a note in the mono
VM documentation can tell that on SSE2 architectures -O=simd will select
the corresponding SSE2 op is sufficient. Optionaly a note in the library
documentation can tell that mono &quot;normally&quot; should catch such calls on
SSE2 architectures.


We want to expose this information on the documentation as well and
instead of having to dig this information twice we are planning on
generating this part of the docs.

 

	
	
	For the choice of the accelerated or not accelerated mode at
runtime:
	&gt;       static readonly bool use_mono_simd =
(SimdRuntime.AccelMode &amp; AccelMode.SSE2) != &gt;0;

	
	&gt;      ...
	&gt;       if (use_mono_simd)
	&gt;               // simd codepath
	&gt;       else
	&gt;               //scalar codepath

	If it is actually to overcome a temporary inneficiency due to
some copy, it is imho far too intrusive in the user code. Here the user
clearly wrote a code that is dependent on some &quot;external&quot; context, but
instead of querying the actual VM runtime, or simply a user defined
variable that can be found in some configuration file of the
application, the query is on the Mono.Simd library itself.
	While in fact the library itself as no knowledge of the actual
efficiency of the running VM.


There are two good reasons for using this approach, the first one is
because the user requires the best performance in all situations and
want to know if it's method will be optimized or not.

The second reason happens when there are many different ways to
implement a given function, each one using different instruction sets
and the user wants to have improved performance on newer processors.

For example, there are 3 ways to implement dot product using Mono.Simd:

1) Only using sse1 and sse2 which takes 5 instructions (1 mul, 2 add and
2 shuffle)
2) Using sse3, which takes 3 instructions (1 mul, 2 hadd)
3) Using sse4.2 which takes 1 instruction (dotp) -- sse4.2 still not
supported by Mono.Simd.

For some users having this option is important and this is the main
objective of the runtime query capabilities.



	
	
	Thus I fully agree with this (which is my point):

	
	&quot;Note that we may eventually either return the attribute not
based on the
	metadata in the assembly, but based on the runtime
understanding: this
	will avoid the need to have an updated Mono.Simd assembly when
new
	optimizations are added. Just use the b pattern if you want to
avoid
	that issue and remember that you don't usually need to check all
the
	methods, but just the ones you actually need to be optimized.&quot;

	All the question there is, whether or not there is a way to get
from the runtime this information and by which mean?
	Is it possible to have attributes attached (or simulated) by the
runtime?


The SimdRuntime.AccelMode property queries the runtime for the supported
instruction sets. You might look
at the implementation and get puzzled by the fact that it returns
AccelMode.None, but in fact this is a &quot;magic method&quot;
that the runtime takes special care and make sure it returns the right
thing.


Thanks for taking your time looking at the Mono.Simd library :)


Cheers,
Rodrigo

____________________________________________________________________
This email has been scanned by the MessageLabs Email Security System


____________________________________________________________________
DISCLAIMER

This message and any attachments contain privileged and confidential information intended for the use of the addressee named above. If you are not the intended recipient of this message, you are hereby notified that any use, dissemination, distribution or reproduction of this message is prohibited. Please note that we cannot guarantee that this message or any attachment is virus free or that it has not been intercepted and amended. The views of the author may not necessarily reflect those of Realtime Worlds Ltd.

 

Realtime Worlds Ltd is registered in Scotland, number 225628. Registered Office: 152 West Marketgait, Dundee, DD1 1NJ.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20081110/fb8bed69/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20081110/fb8bed69/attachment.html</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029699.html">[Mono-dev] Mono.Simd Acceleration Attributes
</A></li>
	<LI>Next message: <A HREF="029746.html">[Mono-dev] Mono.Simd Acceleration Attributes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29745">[ date ]</a>
              <a href="thread.html#29745">[ thread ]</a>
              <a href="subject.html#29745">[ subject ]</a>
              <a href="author.html#29745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
