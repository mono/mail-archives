<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] making mono builds reproducible (xamarin bz #26842)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20making%20mono%20builds%20reproducible%20%28xamarin%20bz%20%2326842%29&In-Reply-To=%3CDUB130-W36B294C1B134AF125CDB49E82F0%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042774.html">
   <LINK REL="Next"  HREF="042776.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] making mono builds reproducible (xamarin bz #26842)</H1>
    <B>Alexander K&#246;plinger</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20making%20mono%20builds%20reproducible%20%28xamarin%20bz%20%2326842%29&In-Reply-To=%3CDUB130-W36B294C1B134AF125CDB49E82F0%40phx.gbl%3E"
       TITLE="[Mono-dev] making mono builds reproducible (xamarin bz #26842)">alex.koeplinger at outlook.com
       </A><BR>
    <I>Tue Feb 17 12:03:20 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="042774.html">[Mono-dev] making mono builds reproducible (xamarin bz #26842)
</A></li>
        <LI>Next message: <A HREF="042776.html">[Mono-dev] making mono builds reproducible (xamarin bz #26842)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42775">[ date ]</a>
              <a href="thread.html#42775">[ thread ]</a>
              <a href="subject.html#42775">[ subject ]</a>
              <a href="author.html#42775">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>FYI, roslyn made the switch to being deterministic by default in April last year: <A HREF="https://github.com/dotnet/roslyn/commit/04462c44e30dfa91267581abdb029f3102796486">https://github.com/dotnet/roslyn/commit/04462c44e30dfa91267581abdb029f3102796486</A>
 
Quoting from the commit:
&quot;(1) The timestamp in the header is replaced with 0 (which is specifically allowed by the spec)
 (2) The module version ID Guid (Mvid) is computed by hashing the contents of the generated assembly (with zero
      where the Mvid will go for the purposes of computing the hash)
 
The name of the &quot;private implementation details&quot; class no longer includes the Mvid.&quot;
-- Alex
 
&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jeroen at sumatra.nl</A>
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dkg at fifthhorseman.net</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">marek.safar at gmail.com</A>
</I>&gt;<i> Date: Tue, 17 Feb 2015 11:12:14 +0000
</I>&gt;<i> CC: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">henrik at logibit.se</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">directhex at apebox.org</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">reproducible-builds at lists.alioth.debian.org</A>
</I>&gt;<i> Subject: Re: [Mono-dev] making mono builds reproducible (xamarin bz #26842)
</I>&gt;<i> 
</I>&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I'm not a big fan of using an environment variable for this, but I won't oppose it. In the mean time, I've added a new public API (ModuleBuilder.__PEHeaderTimeDateStamp) to specify the time stamp. There is already a public API to specify the module version GUID.
</I>&gt;<i> 
</I>&gt;<i> As Miguel said, hard coding the GUID violates the spec and can lead to weird problems. I think the proper solution is to base the GUID on a SHA1 of the contents of the assembly. However, this is non-trivial, so it will take some time to develop a complete solution. This will be an opt-in feature, so it will also need to be supported by mcs or an environment variable.
</I>&gt;<i> 
</I>&gt;<i> Marek, what do you think about adding an mcs switch to facilitate reproducible builds?
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Jeroen
</I>&gt;<i> 
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: Daniel Kahn Gillmor [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dkg at fifthhorseman.net</A>]
</I>&gt;<i> &gt; Sent: Monday, February 16, 2015 23:20
</I>&gt;<i> &gt; To: mono development list
</I>&gt;<i> &gt; Cc: Jeroen Frijters; Jo Shields; Debian Reproducible Builds; Henrik
</I>&gt;<i> &gt; Feldt
</I>&gt;<i> &gt; Subject: making mono builds reproducible (xamarin bz #26842)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Hi Mono folks--
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; some good discussion has come up on the xamarin bugtracker about being
</I>&gt;<i> &gt; able to make builds using the mono toolchain reproducible:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    <A HREF="https://bugzilla.xamarin.com/show_bug.cgi?id=26842">https://bugzilla.xamarin.com/show_bug.cgi?id=26842</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Jo Shields offered a one-liner fix to PEWriter.cs to allow the use of an
</I>&gt;<i> &gt; environment variable to fix the timestamp epoch, but made it clear that
</I>&gt;<i> &gt; more feedback is needed, so i'm raising it here:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; from:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    public DWORD TimeDateStamp = (uint)(DateTime.UtcNow - new
</I>&gt;<i> &gt; DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc)).TotalSeconds;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; to:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;    public DWORD TimeDateStamp =
</I>&gt;<i> &gt; Environment.GetEnvironmentVariable(&quot;IKVM_WRITER_TIMESTAMP_EPOCH&quot;) !=
</I>&gt;<i> &gt; null ?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; uint.Parse(Environment.GetEnvironmentVariable(&quot;IKVM_WRITER_TIMESTAMP_EPO
</I>&gt;<i> &gt; CH&quot;)) :
</I>&gt;<i> &gt;                                 (uint)(DateTime.UtcNow - new
</I>&gt;<i> &gt; DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc)).TotalSeconds;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; (i'm not sure whether the integer number of seconds is the best form for
</I>&gt;<i> &gt; the environment variable, or whether it would be better to parse a
</I>&gt;<i> &gt; standard date string -- from debian's perspective, we can deal with
</I>&gt;<i> &gt; either, of course)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; And this still doesn't solve the secondary issue of the assembly GUID,
</I>&gt;<i> &gt; as Jo noted.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Any thoughts about how to best enable binary-reproducible builds from
</I>&gt;<i> &gt; the mono toolchain if the invoker requests them?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;         --dkg
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I> 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20150217/4016e17f/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20150217/4016e17f/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042774.html">[Mono-dev] making mono builds reproducible (xamarin bz #26842)
</A></li>
	<LI>Next message: <A HREF="042776.html">[Mono-dev] making mono builds reproducible (xamarin bz #26842)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42775">[ date ]</a>
              <a href="thread.html#42775">[ thread ]</a>
              <a href="subject.html#42775">[ subject ]</a>
              <a href="author.html#42775">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
