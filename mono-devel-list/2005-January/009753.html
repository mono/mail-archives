<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] VM differences with java
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20VM%20differences%20with%20java&In-Reply-To=9ac79a71050111115152b3912%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009746.html">
   <LINK REL="Next"  HREF="009759.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] VM differences with java</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20VM%20differences%20with%20java&In-Reply-To=9ac79a71050111115152b3912%40mail.gmail.com"
       TITLE="[Mono-devel-list] VM differences with java">lupus at ximian.com
       </A><BR>
    <I>Wed Jan 12 10:17:17 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009746.html">[Mono-devel-list] VM differences with java
</A></li>
        <LI>Next message: <A HREF="009759.html">[Mono-devel-list] VM differences with java
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9753">[ date ]</a>
              <a href="thread.html#9753">[ thread ]</a>
              <a href="subject.html#9753">[ subject ]</a>
              <a href="author.html#9753">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/11/05 Peter Gerdes wrote:
&gt;<i> I apoligize if this is a silly quesiton but I have been thinking of
</I>&gt;<i> getting involved in the low level code generation algorithms for
</I>
Nice. We have some docs in mono/docs you might want to read.
Though I guess I should review them since they may have bitrotted.

&gt;<i> 1)  Is there any reason not to have the JIT compiler cache the native
</I>&gt;<i> code snippets/SSA tree after being run and then reload them if
</I>&gt;<i> appropriate?
</I>
The native code can be saved using the aot compiler (there is also some
experimental code to do this automatically).
As for the intermediate representation: the IL metadata is alread a compact
representation that's good enough. Saving and restoring the ssa-based internal
representation would take too much effort to code and it would take more
time to process than the IL code, so I don't think it's worth it.

&gt;<i> 2) Does anyone have any advice on what are the best papers to read on
</I>&gt;<i> the code generation system.  I have been plowing through several BURS
</I>&gt;<i> related papers but figured some advice from people who know might be
</I>&gt;<i> helpfull.
</I>
I actually never found good papers on code generation (or at least
they don't have useful details to help build a working codegen).
Feel free to ask questions on this list if you need details of how the
mono code works.

&gt;<i> 3) Did any of the dynamic/profiling  optimizations ever make it into
</I>&gt;<i> the code generation?
</I>
SVN has the infrastructure to get the data and soon we'll be able to
replace already compiled methods with new methods implementation.
After that, someone will have to implement the code
to analize the data and trigger the recompilation.

&gt;<i> Finally, out of curiosity since the CIL instruction set seems so
</I>&gt;<i> similar to the JVM bytecodes what was the motivation to write your own
</I>&gt;<i> full JIT system rather than expanding an existing JVM or even
</I>&gt;<i> translating CIL instructions to java bytecodes?  Since you now seem to
</I>&gt;<i> be faster than any opensource JVM implementation it is all irrelevant
</I>&gt;<i> now but I'm just curious if there was any particular reason which
</I>&gt;<i> would have made this impractical.
</I>
The JVM requires a much simpler JIT than mono needs to implement the 
ECMA specs, since the java bytecode is less complex than IL bytecode.
As such, any JVM jit would need significant changes to be able to execute
IL bytecode and the open source jits were coded with lots of assumptions
about the JVM, which is expected. At the time there were two types of OSS
java jits:
	*) kaffe: highly portable, but also low-performing
	*) some fast jits which worked only on some risc platforms
	*) lisp/functional related jits

The reason we didn't use the kaffe codebase is that we want mono to
be a system component on unix systems: as such it needs to be able to
generate fast code and with low overhead. This is also why we don't spend
resources on the interpreter: an interpreter, even if it's made fast,
has no place as a pervasive system component as we want mono to be.
Besides, at this time, the mono jit has been ported to 5-6 architectures
and it's reasonably portable, so there is no point in writing an interp
for portability. We expect 2 or 3 additional ports by the end of the year, too.
The reason we didn't use the risc-based jits is the same reason they were
developed in the first place: writing a jit for a risc system is much easier
than writing it for x86. But people use x86 systems and we wanted to
solve the hard poroblems first:-)
There are some very advanced jits for functional languages, but
they are usually not written in C, so they are of little use for us.

I think we are on a good path to achieve our goals: mono 1.0 is a good
enough system for desktop applications and experimetal servers. mono 1.2
is good for small and medium server apps and it also has changes to
more easily scale down for embedded use. mono 2.0 will cover a wide
range of application scenarios, from smp systems to GUI clients to
embedded applications.

If we were to start writing a jit now, we'd take a serious look at
llvm. While it is far from being able to execute IL code, it seems to be
a good starting point (well, once you decide you want to pay the C++ 
baggage tax:-). But as you point out, at this point this is moot: we are
not done yet, but we have a more portable JIT, we're adding optimizations.
Mono is becoming the reference JIT in the free software world, in fact it
would be good if someone were to write a book on jit internals based on 
mono for the academic world: it would help tremendously.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009746.html">[Mono-devel-list] VM differences with java
</A></li>
	<LI>Next message: <A HREF="009759.html">[Mono-devel-list] VM differences with java
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9753">[ date ]</a>
              <a href="thread.html#9753">[ thread ]</a>
              <a href="subject.html#9753">[ subject ]</a>
              <a href="author.html#9753">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
