<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Alias analysis
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Alias%20analysis&In-Reply-To=1106784058.8848.4.camel%40omega.maurer">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010076.html">
   <LINK REL="Next"  HREF="010090.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Alias analysis</H1>
    <B>Massimiliano Mantione</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Alias%20analysis&In-Reply-To=1106784058.8848.4.camel%40omega.maurer"
       TITLE="[Mono-devel-list] Alias analysis">massi at ximian.com
       </A><BR>
    <I>Thu Jan 27 05:23:25 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010076.html">[Mono-devel-list] Alias analysis
</A></li>
        <LI>Next message: <A HREF="010090.html">[Mono-devel-list] Alias analysis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10088">[ date ]</a>
              <a href="thread.html#10088">[ thread ]</a>
              <a href="subject.html#10088">[ subject ]</a>
              <a href="author.html#10088">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 2005-01-27 at 01:00, Ben Maurer wrote:
&gt;<i> On Thu, 2005-01-27 at 00:44 +0100, Zoltan Varga wrote:
</I>&gt;<i> &gt;  Wouldn't be easier to just disable optimizations on variables whose address is
</I>&gt;<i> &gt; taken ? It usually happens in unsafe code, and with taking addresses
</I>&gt;<i> &gt; of valuetypes.
</I>&gt;<i> 
</I>&gt;<i> I like this approach better as well.
</I>
Well, actually I also wanted to do it in some cases.

For instance, in the end I got convinced that it could be nice
to be able to apply SSA only to a subset of the variables (the
ones that are not aliased in an incontrollable way, and are not
used in exception handlers).
This would mean that all variables would need a flag that states
if SSA has been applied to them or not, and all SSA based code
should handle variables without that flag as &quot;unknown values&quot;
(like if they were the unpredictable result of a function call).
We would basically get rid of the disable_ssa flag in MonoCompile
because we would handle it on a per variable basis.

Maybe a similar approach could be used in other (non SSA based)
optimizations as well.

In any case, the code that performs the optimizations should be
modified, because it must be made aware of this new flag, so that
problematic variables will be ignored.
Always thinking about SSA, this would mean touching many places:
first the SSA construction and destruction code, and then deadce,
abcrem and ssapre.

As I said, I am convinced this should be done, only I didn't
want to do it immediately.
Instead, I needed proper tracking of aliasing to have accurate
liveness information in order to implement deadce without SSA
(in order to make inlining effective without SSA...).

Even if my explanation was long, the approach in itself is not
that hard, it is more &quot;alias tracking&quot; than alias analysis.
As a result, every variable and instruction would be flagged
correctly, that's all.
And I would provide some utility to handle call instructions
appropriately (case [a] of my explanation), and to find all
variables affected by cases [b] and [c].
Then, each individual optimization could use those flags and
utility functions as it seems best for the developer of that
optimization... one possible approach would be disabling the
optimization for individual variables, another would be making
use of the utility functions to handle accesses through aliases
properly. It would also be possible to have mixed approaches if
we see it's better doing so.

One of the nice things of this approach is that all the existing
code would continue to work using the old LOAD and STORE flags.
It can then be migrated incrementally into making good use of the
new flags... if this &quot;good use&quot; means &quot;disable the optimization
for individual variables, because it's not worth handling uses
through aliases&quot;, fine :-)

But for deadce without SSA I really wanted to have more accurate
liveness information, and I have the suspect that this would be
useful also for the new regalloc, so I still think this kind of
&quot;alias tracker&quot; is worth doing.

&gt;<i> Maybe some effort should be made to make the valuetype operations
</I>&gt;<i> &quot;smarter&quot; for example in this code:
</I>&gt;<i> 
</I>&gt;<i> struct X {
</I>&gt;<i> ...
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> if (foo) {
</I>&gt;<i>     X x = new X (blah);
</I>&gt;<i>     // do stuff with x
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> if (bar) {
</I>&gt;<i>     X y = new X (baz);
</I>&gt;<i>    // do stuff with y
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> We could assign x and y the same stack slot, even though ldarga is
</I>&gt;<i> probably executed on both of them.
</I>
If I understood what you mean, to solve this you need accurate
liveness information, so that you know that when you assign 'y',
'x' is already dead, so its storage on the stack can be recycled.
And this is also why I think that improving liveness will help
the regalloc...

Extending my approach to handle case [c] in the case of value
types would give you exactly this ;-)
(if you look at my explanation, you'll see that I say that in case
[c] there are subcases, but for now I was ignoring them)

Thanks for the comments, and I hope I've been able to clarify
something...

Ciao,
  Massi



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010076.html">[Mono-devel-list] Alias analysis
</A></li>
	<LI>Next message: <A HREF="010090.html">[Mono-devel-list] Alias analysis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10088">[ date ]</a>
              <a href="thread.html#10088">[ thread ]</a>
              <a href="subject.html#10088">[ subject ]</a>
              <a href="author.html#10088">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
