<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: [Bug 71001][Nor] Changed - xsp.exe virtual size grows without bound -- large messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BBug%2071001%5D%5BNor%5D%20Changed%20-%20xsp.exe%20virtual%20size%20grows%20without%20bound%20--%20large%20messages&In-Reply-To=1103533139.6016.15.camel%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010194.html">
   <LINK REL="Next"  HREF="010190.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: [Bug 71001][Nor] Changed - xsp.exe virtual size grows without bound -- large messages</H1>
    <B>jrodman at mono-list.spamportal.net</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BBug%2071001%5D%5BNor%5D%20Changed%20-%20xsp.exe%20virtual%20size%20grows%20without%20bound%20--%20large%20messages&In-Reply-To=1103533139.6016.15.camel%40localhost.localdomain"
       TITLE="[Mono-devel-list] Re: [Bug 71001][Nor] Changed - xsp.exe virtual size grows without bound -- large messages">jrodman at mono-list.spamportal.net
       </A><BR>
    <I>Mon Jan 31 19:14:25 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010194.html">[Mono-devel-list] Compiling latest svn code
</A></li>
        <LI>Next message: <A HREF="010190.html">[Mono-devel-list] Re: [Bug 71001][Nor] Changed - xsp.exe	virtual size grows without bound -- large messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10188">[ date ]</a>
              <a href="thread.html#10188">[ thread ]</a>
              <a href="subject.html#10188">[ subject ]</a>
              <a href="author.html#10188">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jan 31, 2005 at 02:34:56PM -0500, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bugzilla-daemon at bugzilla.ximian.com</A> wrote:
&gt;<i> -Status: REOPENED   
</I>&gt;<i> -Resolution: 
</I>&gt;<i> +Status: RESOLVED   
</I>&gt;<i> +Resolution: NOTABUG
</I>&gt;<i>  Severity: Unknown
</I>&gt;<i>  Priority: Normal
</I>&gt;<i>  Component: misc
</I>&gt;<i>  AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-bugs at ximian.com</A>                            
</I>&gt;<i>  ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jrodman at ximian-bugzilla.spamportal.net</A>               
</I>&gt;<i>  QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-bugs at ximian.com</A>
</I>&gt;<i> @@ -97,6 +97,22 @@
</I>&gt;<i>  decent amount of uptime or scalability.
</I>&gt;<i>  
</I>&gt;<i>  Nevertheless, we appreciate this issue being investigated and look
</I>&gt;<i>  forward to answers to the questions above.
</I>&gt;<i>  
</I>&gt;<i>  Thanks!
</I>&gt;<i> +
</I>&gt;<i> +------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at ximian.com</A>  2005-01-31 14:34 -------
</I>&gt;<i> +It is not solvable in the short term.
</I>&gt;<i> +
</I>&gt;<i> +Our GC engine is conservative non-moving, while the Microsoft one
</I>&gt;<i> +is a moving GC which can compact the heap when pieces become unused.
</I>&gt;<i> +
</I>&gt;<i> +It is our plan to address this issue in the long term, but in the
</I>&gt;<i> +short term (Mono 1.2) this will not be solved.
</I>&gt;<i> +
</I>&gt;<i> +This means that Mono has the same problems than an equivalent C or
</I>&gt;<i> +C++ application would (as they do not have compatcing memory 
</I>&gt;<i> +management units either), so you must take the same care that you
</I>&gt;<i> +would with C or C++ when dealing with heap fragmentation.
</I>&gt;<i> +
</I>&gt;<i> +Miguel.
</I>
In an attempt to avoid contention over the bug status in bugzilla, while
still not really understanding the problem, I'm replying to the mono
development list.  I hope this is not a problem.

We are currently using the soap interface to provide remote access to a
network service.  Files are submitted, processed, and then reports are
made available.  A few other miscellaneous things can be done along the
way.  

Our goals with this interface are that it be well supported by existing
tools and lanauges, and that it be easy to use.  To this end we are
using SOAP and we are trying to make the steps of the process as simple
as possible.

To this end, we have implemented the submission of a file as a single
function call, rather than a series of calls with state management that
will be difficult to implement in the particular environment a customer
may happen to be using.  This is leading to significant heap growth.

Since complicating the API is undesirable due to the arbitrary
implementers who are unlikely to be seasoned developers, I want to
understand what is causing the fragmentation.  The pattern is: allocate
a large buffer.  Pass this buffer via soap.  Deallocate large buffer.

If I pass the same data with the exact same size repeatedly, I would not
expect to see fragmentation.  Even if the large (say 1MB) buffer is
partially occupied by other datastructures, I do not see why this should
lead to excessive growth, as the 1MB buffer should leave plenty of space
for arbitrary datastructures to live inside.  Further, if it were simply
a matter of fragmentation, I would expect to see the virtual size grow a
good deal, but not so much the resident set size, which also grows at an
alarming rate.  Why do the fragmented pages for the old data not grow
stale?  One would think that with 4k pages that most of the fragmented
space would be able to be swapped out.


Is this behavior pattern resulting solely from my naive allocation, and
subsequent freeing, of large buffers?  Or does it have something to do
with the behavior of the XML serialization?  This email from Gonzalo
suggested so. 

&gt;<i> On Fri, 2004-12-17 at 17:44 +0100, Lluis Sanchez wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My guess is that this is a GC issue. Although the amount of memory
</I>&gt;<i> &gt; used is high, in my tests it looks steady. I'm pretty sure that MS
</I>&gt;<i> &gt; needs to allocate as much memory, but their GC may be performing
</I>&gt;<i> &gt; better.  Sending big chunks of byte arrays as parameters is not a
</I>&gt;<i> &gt; good idea, it has a lot of memory and processing overhead.
</I>&gt;<i> 
</I>&gt;<i> Yes it is. It has to do with code in system.xml that is fine when a
</I>&gt;<i> text element is 'small' but does too many allocations/reallocations
</I>&gt;<i> when the size is big. I already have a simple test case for this and
</I>&gt;<i> will check it on windows and post the details in bugzilla.
</I>&gt;<i> 
</I>&gt;<i> -Gonzalo
</I>
If your response in the bug is the result of further investigation,
sorry for bringing this up, but it is not clear to me at this time where
this XML issue is resolved.  I will be making another attempt at finding
it in Subversion later today, but I am still learning how to effectively
locate patches in this tool and project and have not succeeded so far.
For example, I do not know if people always mean the main trunk  when
they say &quot;fixed in subversion&quot;.


I'm sorry if this is starting to feel like a technical support request,
but the meat of it is that my program has no lasting allocated
datastructures, and thus I do not see how my code can thus be
responsible for any unbounded increasing fragmentation issue, let alone
memory which does not go stale over time.  Are we certain this is not a
library problem?


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010194.html">[Mono-devel-list] Compiling latest svn code
</A></li>
	<LI>Next message: <A HREF="010190.html">[Mono-devel-list] Re: [Bug 71001][Nor] Changed - xsp.exe	virtual size grows without bound -- large messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10188">[ date ]</a>
              <a href="thread.html#10188">[ thread ]</a>
              <a href="subject.html#10188">[ subject ]</a>
              <a href="author.html#10188">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
