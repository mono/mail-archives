<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Performance issues with security permissions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Performance%20issues%20with%20security%20permissions&In-Reply-To=1106680599.12687.273.camel%40pollux.novell">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010026.html">
   <LINK REL="Next"  HREF="010032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Performance issues with security permissions</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Performance%20issues%20with%20security%20permissions&In-Reply-To=1106680599.12687.273.camel%40pollux.novell"
       TITLE="[Mono-devel-list] Performance issues with security permissions">lupus at ximian.com
       </A><BR>
    <I>Tue Jan 25 16:15:49 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010026.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
        <LI>Next message: <A HREF="010032.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10030">[ date ]</a>
              <a href="thread.html#10030">[ thread ]</a>
              <a href="subject.html#10030">[ subject ]</a>
              <a href="author.html#10030">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/25/05 Sebastien Pouliot wrote:
&gt;<i> * So the only thing creating the permission object does (without
</I>&gt;<i> --security) is more memory allocations, additional garbage collection...
</I>&gt;<i> All bad for Mono's performance. So the pattern was changed to something
</I>&gt;<i> like:
</I>&gt;<i> 
</I>&gt;<i> 	public static string GetEnvironmentVariable (string name)
</I>&gt;<i> 	{
</I>&gt;<i> 		if (SecurityManager.SecurityEnabled) {
</I>&gt;<i> 			new EnvironmentPermission 
</I>
Yep, this looks good: it's the reason I insisted we'd use the
--security option.

&gt;<i> * Now the property value for SecurityManager.SecurityEnabled reside in
</I>&gt;<i> unmanaged code (so it can be used over there and so we can't reflect on
</I>&gt;<i> the field to change its value). This means an internal call each time.
</I>&gt;<i> 
</I>&gt;<i> To avoid this the JIT _could_ produce code to replace SystemManager.
</I>&gt;<i> SecurityEnabled by false when --security isn't enabled. In this case the
</I>&gt;<i> permission creation/demand would be treated as dead code (and possibly
</I>&gt;<i> totally removed by optimizations).
</I>&gt;<i> 
</I>&gt;<i> 	??? is it worth it ???
</I>
Yes, it is. We'll do two things: if --security is not provided,
the call will be changed to a false boolean value. I committed last week
a change that will enable the code to be removed in this case also
when the default optimization options are used (I needed it to remove
code as well in some experimental code I had written).
The other thing is: if --security is provided, the icall will be
changed to a simple load from the memory location where the flag is stored,
so it will be quite fast to execute. This could be optimized so
that once the value is set to false we always return a false boolean
constant (if we agree that in that case results should be considered 
undefined).

&gt;<i>         * Another example is demanding a permission that is already
</I>&gt;<i>         demanded by something else down the execution stack. This is why
</I>&gt;<i>         Environment.CurrentDirectory doesn't check for PathDiscovery
</I>&gt;<i>         permissions because System.IO.Directory already does the job.
</I>
A demand () in a call frame could mark the callframe if it succedes
and an new demand would need to wlak the stack just to that point
(this doesn't get rid of the obj creation ovehead, though...).

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010026.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
	<LI>Next message: <A HREF="010032.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10030">[ date ]</a>
              <a href="thread.html#10030">[ thread ]</a>
              <a href="subject.html#10030">[ subject ]</a>
              <a href="author.html#10030">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
