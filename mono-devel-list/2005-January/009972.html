<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] GC Profiling Interfaces
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20GC%20Profiling%20Interfaces&In-Reply-To=1106498021.14342.69.camel%40omega.maurer">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009970.html">
   <LINK REL="Next"  HREF="009975.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] GC Profiling Interfaces</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20GC%20Profiling%20Interfaces&In-Reply-To=1106498021.14342.69.camel%40omega.maurer"
       TITLE="[Mono-devel-list] [PATCH] GC Profiling Interfaces">lupus at ximian.com
       </A><BR>
    <I>Sun Jan 23 13:03:45 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009970.html">[Mono-devel-list] [PATCH] GC Profiling Interfaces
</A></li>
        <LI>Next message: <A HREF="009975.html">[Mono-devel-list] [PATCH] GC Profiling Interfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9972">[ date ]</a>
              <a href="thread.html#9972">[ thread ]</a>
              <a href="subject.html#9972">[ subject ]</a>
              <a href="author.html#9972">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/23/05 Ben Maurer wrote:
&gt;<i> This interface is not designed to be useful for a different gc impl. It
</I>&gt;<i> doesn't handle moving objects *at all*.
</I>
That's what I said: the interface is misdesigned.

&gt;<i> A profiler for Mono 1.2 is unlikely to be useful for 2.0 (Or whenever we
</I>&gt;<i> get a moving gc). Even if the api were designed so that the profiler
</I>&gt;<i> were correct, the things one wants to look at in each impl are very
</I>&gt;<i> different.
</I>
In this case we are talking about something that is common for any GC:
the list of objects that survived a GC. Getting a callback for each
live object is the right interface for this and you can build on that.

&gt;<i> I'd also like to get boehm specific stuff (eg, number of blocks
</I>&gt;<i> blacklisted). Maybe these functions need to be put somewhere else...
</I>
This is something completely unrelated, which can be implemented in other
ways, like generalized counters: they don't belong in the profiling
interface. I'll add some code maybe next week for it: I need to check
if what I have can be also used to implement the PerformanceCounters stuff
in System or corlib.

&gt;<i> &gt; As for knowing that an object died vs knowing which objects are alive, it's
</I>&gt;<i> &gt; a simple difference which you could do when post processing, too, if needed.
</I>&gt;<i> &gt; Either way, we may consider exporting such an ugly interface only if
</I>&gt;<i> &gt; the overhead with the heap walk is significant.
</I>&gt;<i> 
</I>&gt;<i> Maybe, considering dependency on the gc impl, we should consider this a
</I>&gt;<i> private contract with the gc profiler? 
</I>
Maybe, considering that implementing and switching to a moving
and generational GC in a few months will be hard already, we should not
introduce new interfaces that won't work when we can implement an
interface that does. I'm not concerned about the code in your profiler here,
I know it will never work as is with a moving GC: the issue is the API
interface. The heap walk is something that can be supported, your hackish
function can't.

&gt;<i> &gt; enum {
</I>&gt;<i> &gt; 	/* maybe also add suspend and resume events */
</I>&gt;<i> &gt; 	MONO_GC_EVENT_START,
</I>&gt;<i> &gt; 	MONO_GC_EVENT_RECLAIM,
</I>&gt;<i> &gt; 	MONO_GC_EVENT_END
</I>&gt;<i> &gt; };
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; typedef void (*MonoProfileGCFunc)         (MonoProfiler *prof, int event_type, int gen_num);
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Of course for the current GC the generation number will be always 0, but
</I>&gt;<i> &gt; the interface will work with the new GC. Note also that the generation number
</I>&gt;<i> &gt; is not needed, since you can easily keep your counter when the MONO_GC_EVENT_START
</I>&gt;<i> &gt; event is received.
</I>&gt;<i> 
</I>&gt;<i> So MONO_GC_EVENT_RECLAIM would be like the one that allows me to see the
</I>&gt;<i> mark bits?
</I>
It will be the event when you'll be able to request a heap walk to the GC,
with a callback for each object.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009970.html">[Mono-devel-list] [PATCH] GC Profiling Interfaces
</A></li>
	<LI>Next message: <A HREF="009975.html">[Mono-devel-list] [PATCH] GC Profiling Interfaces
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9972">[ date ]</a>
              <a href="thread.html#9972">[ thread ]</a>
              <a href="subject.html#9972">[ subject ]</a>
              <a href="author.html#9972">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
