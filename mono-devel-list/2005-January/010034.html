<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Escape Analysis
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Escape%20Analysis&In-Reply-To=1106684904.4177.31.camel%40matrix">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010027.html">
   <LINK REL="Next"  HREF="010031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Escape Analysis</H1>
    <B>Willibald Krenn</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Escape%20Analysis&In-Reply-To=1106684904.4177.31.camel%40matrix"
       TITLE="[Mono-devel-list] Escape Analysis">Willibald.Krenn at gmx.at
       </A><BR>
    <I>Tue Jan 25 17:36:50 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010027.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
        <LI>Next message: <A HREF="010031.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10034">[ date ]</a>
              <a href="thread.html#10034">[ thread ]</a>
              <a href="subject.html#10034">[ subject ]</a>
              <a href="author.html#10034">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

Massimiliano Mantione schrieb:
&gt;<i> A couple of things...
</I>&gt;<i> 
</I>&gt;<i> 1st, I like the idea of Escape Analysis a lot.
</I>&gt;<i> Even without having seen any paper about it, this is an obvious
</I>&gt;<i> optimization... it's true that a generational GC would help as
</I>&gt;<i> well, but this is a more &quot;direct&quot; approach to the problem (in any
</I>&gt;<i> case complementary to a generational GC).
</I>&gt;<i> In any case it's something I'd like to see, if nobody implements
</I>&gt;<i> it eventually (after the more urgent things that I should do) I
</I>&gt;<i> would do it myself.
</I>
Yes, it sounds quite promising, but AFAIK it's also quite dependand on 
inlining. (Because lots of functions return newly allocated objects and 
stack allocation of objects can only be made if the lifetime of an 
object remains within a single function, obviously: You can not 'remote' 
or return a stack allocated object.)


&gt;<i> But (2nd) I cannot see how Paolo is blocking you.
</I>
Well, actually he's not blocking me, but I had the impression that he 
had significant reworks of the trampolines (et al.) in the pipeline. So 
I figured it would be better to wait (until these changes are made) 
before fussing too much with low-level-mono internals.

Anyways, currently  I'm not that far, as I'm coding the Phase Shift 
Detection (= monitor samples and tell when hot methods have 
significantly changed ) and try to come up with some good balance to 
trigger re-compilation activities.
I'm also investigating what type of sampling profiler I should use:
  - My own one (low-profile; max 100 samples per second or so; basically 
just a thread that sends SIGPROF signals to threads that have profiling 
turned on)
  - Paolo's highly accurate one.
  - or some mixture between the two.

BTW: At the moment I'm testing with some custom C# application server 
(1) but I'm always looking for good suggestions regarding test 
applications.. (GTK# doesn't work here - seems I'm not up to date with 
all the libs. :-( )

&gt;<i> It is probably true that Escape Analysis is expensive, so it
</I>&gt;<i> makes sense only with profile guided optimizations, but this is
</I>&gt;<i> not a good reason not to code it now, knowing that sooner or
</I>&gt;<i> later we *will* have that... and moreover, couldn't it be used
</I>&gt;<i> with AOT anyway?
</I>
Interferes a little bit with my plan:
(1.) Get the basic framework ready (profiler, phase change pred., 
picker, static predictor, optimizer)
(2.) Apply _existing_ optimiziations dynamically in some sane manner to 
non-static methods (change VMTs)
(3.) Add new optimization:
candidates: Devirtualization (incl. inlining), Escape Analysis,  profile 
guided code positioning, whatever...
(4.) ask community for comments and inclusion...
(5.) go (3.)

First iteration will end beginning April.. Points 1 and 2 I'd like to 
have in a first working version end of next week. Thereafter I'll 
probably look into the different optimizations and decide which one gets 
to honor of being implemented.

At least that's the plan if I'm not spending too much time writing e-mails,
   Willi


(1) For the interested reader:
Basically my application server is an object persistent framework on top 
of a firebird database that is called via some remoting interface: 
<A HREF="http://www.wpkrenn.net/pmwiki/pmwiki.php/Willi/LiberLinux">http://www.wpkrenn.net/pmwiki/pmwiki.php/Willi/LiberLinux</A>
It's also my first 'success' story of porting a .NET webservice to 
Linux, as everything was developed on windows using C#/Delphi and now 
also runs on Mono/Kylix.. (Agreed, the client looks _way_ better when 
running on XP..)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010027.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
	<LI>Next message: <A HREF="010031.html">[Mono-devel-list] Performance issues with security permissions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10034">[ date ]</a>
              <a href="thread.html#10034">[ thread ]</a>
              <a href="subject.html#10034">[ subject ]</a>
              <a href="author.html#10034">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
