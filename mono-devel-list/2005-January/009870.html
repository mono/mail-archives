<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] XSP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20XSP&In-Reply-To=41EC59E2.1030106%40gmx.at">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009852.html">
   <LINK REL="Next"  HREF="009892.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] XSP</H1>
    <B>Willibald Krenn</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20XSP&In-Reply-To=41EC59E2.1030106%40gmx.at"
       TITLE="[Mono-devel-list] XSP">Willibald.Krenn at gmx.at
       </A><BR>
    <I>Tue Jan 18 15:25:47 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009852.html">[Mono-devel-list] XSP
</A></li>
        <LI>Next message: <A HREF="009892.html">[Mono-devel-list] XSP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9870">[ date ]</a>
              <a href="thread.html#9870">[ thread ]</a>
              <a href="subject.html#9870">[ subject ]</a>
              <a href="author.html#9870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Willibald Krenn schrieb:
&gt;<i> Hi!
</I>&gt;<i> 
</I>&gt;<i> I'm still trying to get the xsp demo running here. After recompiling 
</I>&gt;<i> mono without ICU, the 'Security' problem went away, but therefore I've 
</I>&gt;<i> got another one:
</I>&gt;<i> 
</I>&gt;<i> System.Runtime.Remoting.RemotingException: Configuration file 
</I>&gt;<i> '/usr/etc/mono/1.0/machine.config' could not be loaded: Expected element
</I>&gt;<i> in &lt;0x00158&gt; System.Web.HttpRuntime:OnFirstRequestStart 
</I>&gt;<i> (System.Web.HttpContext)
</I>&gt;<i> in &lt;0x00151&gt; System.Web.HttpRuntime:InternalExecuteRequest 
</I>&gt;<i> (System.Web.HttpWorkerRequest)
</I>&gt;<i> 
</I>&gt;<i> Anyone knows _what_ element is expected?
</I>
Solved the problem by changing (just a copy-and paste from the diff, so 
you get the idea) RemotingConfiguration.cs:

Index: class/corlib/System.Runtime.Remoting/RemotingConfiguration.cs
===================================================================
--- class/corlib/System.Runtime.Remoting/RemotingConfiguration.cs 
(revision 39101)
+++ class/corlib/System.Runtime.Remoting/RemotingConfiguration.cs 
(working copy)
@@ -388,12 +388,14 @@
  	internal class RReader : MiniParser.IReader {
  		private string xml; // custom remoting config file
  		private int pos;
+		private int len;

  		public RReader (string filename)
  		{
  			try {
  				StreamReader sr = new StreamReader (filename);
  				xml = sr.ReadToEnd ();
+				len = xml.Length;
  				sr.Close ();
  			}
  			catch {
@@ -403,7 +405,7 @@

  		public int Read () {
  			try {
-				return (int) xml[pos++];
+				return len == pos ? -1 : (int) xml[pos++];
  			}
  			catch {
  				return -1;

I did not investigate, why the exception is not thrown (or thrown too 
late, or..).

I've also done some mods to MiniParser.cs so that the error messages are 
delivering more information. (Such as line-number, col. number and the 
stack contents)

Index: class/corlib/Mono.Xml/MiniParser.cs
===================================================================
--- class/corlib/Mono.Xml/MiniParser.cs	(revision 39101)
+++ class/corlib/Mono.Xml/MiniParser.cs	(working copy)
@@ -262,14 +262,14 @@
  	};

  	protected static string[] errors = {
-		/* 0 */ &quot;Expected element&quot;,
-		/* 1 */ &quot;Invalid character in tag&quot;,
-		/* 2 */ &quot;No '='&quot;,
-		/* 3 */ &quot;Invalid character entity&quot;,
-		/* 4 */ &quot;Invalid attr value&quot;,
-		/* 5 */ &quot;Empty tag&quot;,
-		/* 6 */ &quot;No end tag&quot;,
-		/* 7 */ &quot;Bad entity ref&quot;
+		/* 0 */ &quot;Expected element: Line {0}; Col: {1}\n Stack: {2}&quot;,
+		/* 1 */ &quot;Invalid character in tag: Line {0}; Col: {1}\n Stack: {2}&quot;,
+		/* 2 */ &quot;No '=' : Line {0}; Col: {1}\n Stack: {2}&quot;,
+		/* 3 */ &quot;Invalid character entity: Line {0}; Col: {1}\n Stack: {2}&quot;,
+		/* 4 */ &quot;Invalid attr value: Line {0}; Col: {1}\n Stack: {2}&quot;,
+		/* 5 */ &quot;Empty tag: Line {0}; Col: {1}\n Stack: {2}&quot;,
+		/* 6 */ &quot;No end tag: Line {0}; Col: {1}\n Stack: {2}&quot;,
+		/* 7 */ &quot;Bad entity ref: Line {0}; Col: {1}\n Stack: {2}&quot;
  	};

  	protected int line;
@@ -363,7 +363,15 @@
  				if (stateCode == 0xFF) {
  					FatalErr(&quot;State dispatch error.&quot;);
  				} else {
-					FatalErr(errors[stateCode ^ 0x80]);
+					string stackStr = &quot;&quot;;
+					if (tagStack.Count &gt; 0) {
+						System.Collections.IEnumerator tagEnum = tagStack.GetEnumerator ();
+						while (tagEnum.MoveNext()) {
+							stackStr = stackStr +&quot;; &quot;+ tagEnum.Current;
+						}
+					} else
+						stackStr = &quot;Empty&quot;;
+					FatalErr( String.Format (errors[stateCode ^ 0x80], this.line, 
this.col, stackStr));
  				}
  			}


Willi
P.S.: I had to disable ICU - seems the SuSE 9.0 AMD64 version just 
prevents mono from running correctly...


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009852.html">[Mono-devel-list] XSP
</A></li>
	<LI>Next message: <A HREF="009892.html">[Mono-devel-list] XSP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9870">[ date ]</a>
              <a href="thread.html#9870">[ thread ]</a>
              <a href="subject.html#9870">[ subject ]</a>
              <a href="author.html#9870">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
