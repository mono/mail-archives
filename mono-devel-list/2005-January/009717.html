<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20OCI_SUCCES_WITH_INFO%20with%20System.Data.OracleClient&In-Reply-To=A84902DE9AD8784285B1AC7F5DFD28763A4E9D%40master.intra.cloudseven.nl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009716.html">
   <LINK REL="Next"  HREF="009727.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20OCI_SUCCES_WITH_INFO%20with%20System.Data.OracleClient&In-Reply-To=A84902DE9AD8784285B1AC7F5DFD28763A4E9D%40master.intra.cloudseven.nl"
       TITLE="[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient">danielmorgan at verizon.net
       </A><BR>
    <I>Sun Jan  9 22:58:35 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009716.html">[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
</A></li>
        <LI>Next message: <A HREF="009727.html">[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9717">[ date ]</a>
              <a href="thread.html#9717">[ thread ]</a>
              <a href="subject.html#9717">[ subject ]</a>
              <a href="author.html#9717">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks!

I have committed your patch into svn trunk HEAD.

I created a test case and ran it on .NET 1.1 and Mono 1.1.3 (with latest svn changes for OracleClient).
I had also added the ability for raising an InfoMessage event on the OracleConnection for warnings.  However, your test case did not produce an InfoMessage on .NET 1.1.  So, this baffles me.  

Here is the test case I created that can be found in TestOracleClient.cs

		static void NullAggregateTest (OracleConnection con)
		{
			Console.WriteLine(&quot;  Drop table MONO_TEST_TABLE3...&quot;);
			OracleCommand cmd2 = con.CreateCommand ();

			try {
				cmd2.CommandText = &quot;DROP TABLE MONO_TEST_TABLE3&quot;;
				cmd2.ExecuteNonQuery ();
			}
			catch(OracleException oe1) {
				// ignore if table already exists
			}

			Console.WriteLine(&quot;  Create table MONO_TEST_TABLE3...&quot;);
						
			cmd2.CommandText = &quot;CREATE TABLE MONO_TEST_TABLE3 (&quot; +
				&quot; COL1 VARCHAR2(8), &quot;+
				&quot; COL2 VARCHAR2(32))&quot;;

			cmd2.ExecuteNonQuery ();

			Console.WriteLine(&quot;  Insert some rows into table MONO_TEST_TABLE3...&quot;);
			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('1','one')&quot;;
			cmd2.ExecuteNonQuery ();

			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('1','uno')&quot;;
			cmd2.ExecuteNonQuery ();
			
			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('3','three')&quot;;
			cmd2.ExecuteNonQuery ();
			
			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('3', null)&quot;;
			cmd2.ExecuteNonQuery ();

			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('3','few')&quot;;
			cmd2.ExecuteNonQuery ();
			cmd2.CommandText = &quot;SELECT COL1, COUNT(COL2) AS MAX_COL1 FROM MONO_TEST_TABLE3 GROUP BY COL1&quot;;
			OracleDataReader reader = cmd2.ExecuteReader ();
			Console.WriteLine (&quot; Read...&quot;);
			while (reader.Read ()) {

				object obj0 = reader.GetValue (0);
				Console.WriteLine(&quot;Value 0: &quot; + obj0.ToString ());
				object obj1 = reader.GetValue (1);
				Console.WriteLine(&quot;Value 1: &quot; + obj1.ToString ());
			
				Console.WriteLine (&quot; Read...&quot;);
			}

			Console.WriteLine (&quot; No more records.&quot;);
		}

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>] On Behalf Of Joost Evertse
Sent: Sunday, January 09, 2005 4:36 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: [Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient


When I used this query (entry_text is a CLOB column) in a webpage with System.Data.OracleClient i receveid an ORA-24347 Exception during Fetch() String sql = ( &quot; select c.entry_title, d.entry_text,c.entry_created_on,c.entry_id,c.comment_count &quot; +

&quot; from &quot; + 

&quot; (select * from &quot; + 

&quot; (SELECT a.entry_title,a.entry_created_on, a.entry_id, count(b.COMMENT_ENTRY_ID) comment_count &quot; +

&quot; FROM mt.mt_entry a,mt.mt_comments b &quot; +

&quot; where a.entry_author_id = 1 &quot; +

&quot; and a.ENTRY_ID= b.COMMENT_ENTRY_ID(+) &quot; +

&quot; group by a.entry_title,a.entry_created_on, a.entry_id &quot; +

&quot; order by entry_created_on desc, entry_id desc) &quot; +

&quot; where rownum &lt;11 ) c, &quot; +

&quot; mt.mt_entry d &quot; +

&quot; where c.entry_id = d.entry_id &quot; + 

&quot; order by entry_created_on desc, entry_id desc &quot;);

I looked it up on Oracle Metalink and found this:
 
Error: ORA-24347 
Text: Warning of a NULL column in an aggregate function  
--------------------------------------------------------------------------- 
Cause: A null column was processed by an aggregate function  
Action: An OCI_SUCCESS_WITH_INFO is returned.
*** Important: The notes below are for experienced users - See [NOTE:22080.1] 

Explanation: 

  This error is introduced in Oracle8i and is a warning. If an OCI 

  client executes a statement in which an AGGREGATE function  

  processes a NULL value then a warning is signalled to indicate  

  this. The OCI function will return OCI_SUCCESS_WITH_INFO. In  

  many cases the client does not care about this and so should 

  ignore this particular warning and continue as normal. 

  If upgrading from OCI 8.0 to 8.1 you may need to modify the OCI code 

  to cope with this new warning if the code treats OCI_SUCCESS_WITH_INFO 

  as a failure scenario. 

  

  

I looked in the System.Data.OracleClient code and found that adding this in OciStatementHandle.cs made my code work: 

  public bool Fetch ()
                {
                        int status = 0; 

                        if (this.disposed) ^M
                        {
                                throw new InvalidOperationException (&quot;StatementHandle is already disposed.&quot;);
                        } 

                        status = OciCalls.OCIStmtFetch (Handle,
                                ErrorHandle.Handle,
                                1,
                                2,
                                0); 

                        switch (status) {
                        case OciGlue.OCI_NO_DATA:
                                moreResults = false;
                                break;
                        case OciGlue.OCI_DEFAULT:
                                moreResults = true;
                                break;
                        case OciGlue.OCI_SUCCESS_WITH_INFO:
                                moreResults = true;
                                break;
                        default:
                                OciErrorInfo info = ErrorHandle.HandleError ();
                                throw new OracleException (info.ErrorCode, info.ErrorMessage);
                        } 

                        return moreResults;
                }


I guess it's not pretty, but if it's just a warning condition, i thought, just add it, continue as normal :) 

regards, 

Joost Evertse 

  

  

2uXf)+2uXX&#794;&amp;rX&#794;&amp;r+wjzY


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009716.html">[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
</A></li>
	<LI>Next message: <A HREF="009727.html">[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9717">[ date ]</a>
              <a href="thread.html#9717">[ thread ]</a>
              <a href="subject.html#9717">[ subject ]</a>
              <a href="author.html#9717">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
