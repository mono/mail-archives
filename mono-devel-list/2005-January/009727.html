<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20OCI_SUCCES_WITH_INFO%20with%20System.Data.OracleClient&In-Reply-To=000001c4f6c8%24a8ebe320%246401a8c0%40danpc">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009717.html">
   <LINK REL="Next"  HREF="009718.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient</H1>
    <B>Joost Evertse</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20OCI_SUCCES_WITH_INFO%20with%20System.Data.OracleClient&In-Reply-To=000001c4f6c8%24a8ebe320%246401a8c0%40danpc"
       TITLE="[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient">j.evertse at cloudseven.nl
       </A><BR>
    <I>Mon Jan 10 17:27:27 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="009717.html">[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
</A></li>
        <LI>Next message: <A HREF="009718.html">[Mono-devel-list] domain.c assertion error (runtimesecurityframe_class)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9727">[ date ]</a>
              <a href="thread.html#9727">[ thread ]</a>
              <a href="subject.html#9727">[ subject ]</a>
              <a href="author.html#9727">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Daniel,

Running the piece of code you send below on my machine (before the patch)

[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">root at smp</A> Test]# mono test.exe
  Drop table MONO_TEST_TABLE3...
  Create table MONO_TEST_TABLE3...
  Insert some rows into table MONO_TEST_TABLE3...
 Read...

Unhandled Exception: System.Data.OracleClient.OracleException: 
ORA-24347: Warning of a NULL column in an aggregate function

in &lt;0x00127&gt; System.Data.OracleClient.Oci.OciStatementHandle:Fetch ()
in &lt;0x0001a&gt; System.Data.OracleClient.OracleDataReader:Read ()
in &lt;0x0005d&gt; (wrapper remoting-invoke-with-check) 
System.Data.OracleClient.OracleDataReader:Read ()
in &lt;0x00266&gt; TestClob:NullAggregateTest 
(System.Data.OracleClient.OracleConnection)
in &lt;0x00041&gt; TestClob:Main (string[])

and after the patch:
[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">root at smp</A> Test]# mono test.exe
  Drop table MONO_TEST_TABLE3...
  Create table MONO_TEST_TABLE3...
  Insert some rows into table MONO_TEST_TABLE3...
 Read...
Value 0: 1
Value 1: 2
 Read...
Value 0: 3
Value 1: 2
 Read...
 No more records.

Some more information:
Oracle version: Oracle8i Enterprise Edition Release 8.1.7.0.0
Client: Release 8.1.7.0.0
Mono runtime :version 1.0.5
Mono C# compiler version 1.0.5.0



Daniel Morgan wrote:

&gt;<i>Thanks!
</I>&gt;<i>
</I>&gt;<i>I have committed your patch into svn trunk HEAD.
</I>&gt;<i>
</I>&gt;<i>I created a test case and ran it on .NET 1.1 and Mono 1.1.3 (with latest svn changes for OracleClient).
</I>&gt;<i>I had also added the ability for raising an InfoMessage event on the OracleConnection for warnings.  However, your test case did not produce an InfoMessage on .NET 1.1.  So, this baffles me.  
</I>&gt;<i>
</I>&gt;<i>Here is the test case I created that can be found in TestOracleClient.cs
</I>&gt;<i>
</I>&gt;<i>		static void NullAggregateTest (OracleConnection con)
</I>&gt;<i>		{
</I>&gt;<i>			Console.WriteLine(&quot;  Drop table MONO_TEST_TABLE3...&quot;);
</I>&gt;<i>			OracleCommand cmd2 = con.CreateCommand ();
</I>&gt;<i>
</I>&gt;<i>			try {
</I>&gt;<i>				cmd2.CommandText = &quot;DROP TABLE MONO_TEST_TABLE3&quot;;
</I>&gt;<i>				cmd2.ExecuteNonQuery ();
</I>&gt;<i>			}
</I>&gt;<i>			catch(OracleException oe1) {
</I>&gt;<i>				// ignore if table already exists
</I>&gt;<i>			}
</I>&gt;<i>
</I>&gt;<i>			Console.WriteLine(&quot;  Create table MONO_TEST_TABLE3...&quot;);
</I>&gt;<i>						
</I>&gt;<i>			cmd2.CommandText = &quot;CREATE TABLE MONO_TEST_TABLE3 (&quot; +
</I>&gt;<i>				&quot; COL1 VARCHAR2(8), &quot;+
</I>&gt;<i>				&quot; COL2 VARCHAR2(32))&quot;;
</I>&gt;<i>
</I>&gt;<i>			cmd2.ExecuteNonQuery ();
</I>&gt;<i>
</I>&gt;<i>			Console.WriteLine(&quot;  Insert some rows into table MONO_TEST_TABLE3...&quot;);
</I>&gt;<i>			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('1','one')&quot;;
</I>&gt;<i>			cmd2.ExecuteNonQuery ();
</I>&gt;<i>
</I>&gt;<i>			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('1','uno')&quot;;
</I>&gt;<i>			cmd2.ExecuteNonQuery ();
</I>&gt;<i>			
</I>&gt;<i>			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('3','three')&quot;;
</I>&gt;<i>			cmd2.ExecuteNonQuery ();
</I>&gt;<i>			
</I>&gt;<i>			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('3', null)&quot;;
</I>&gt;<i>			cmd2.ExecuteNonQuery ();
</I>&gt;<i>
</I>&gt;<i>			cmd2.CommandText = &quot;INSERT INTO MONO_TEST_TABLE3 (COL1, COL2) VALUES ('3','few')&quot;;
</I>&gt;<i>			cmd2.ExecuteNonQuery ();
</I>&gt;<i>			cmd2.CommandText = &quot;SELECT COL1, COUNT(COL2) AS MAX_COL1 FROM MONO_TEST_TABLE3 GROUP BY COL1&quot;;
</I>&gt;<i>			OracleDataReader reader = cmd2.ExecuteReader ();
</I>&gt;<i>			Console.WriteLine (&quot; Read...&quot;);
</I>&gt;<i>			while (reader.Read ()) {
</I>&gt;<i>
</I>&gt;<i>				object obj0 = reader.GetValue (0);
</I>&gt;<i>				Console.WriteLine(&quot;Value 0: &quot; + obj0.ToString ());
</I>&gt;<i>				object obj1 = reader.GetValue (1);
</I>&gt;<i>				Console.WriteLine(&quot;Value 1: &quot; + obj1.ToString ());
</I>&gt;<i>			
</I>&gt;<i>				Console.WriteLine (&quot; Read...&quot;);
</I>&gt;<i>			}
</I>&gt;<i>
</I>&gt;<i>			Console.WriteLine (&quot; No more records.&quot;);
</I>&gt;<i>		}
</I>&gt;<i>
</I>&gt;<i>-----Original Message-----
</I>&gt;<i>From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>] On Behalf Of Joost Evertse
</I>&gt;<i>Sent: Sunday, January 09, 2005 4:36 PM
</I>&gt;<i>To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i>Subject: [Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>When I used this query (entry_text is a CLOB column) in a webpage with System.Data.OracleClient i receveid an ORA-24347 Exception during Fetch() String sql = ( &quot; select c.entry_title, d.entry_text,c.entry_created_on,c.entry_id,c.comment_count &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; from &quot; + 
</I>&gt;<i>
</I>&gt;<i>&quot; (select * from &quot; + 
</I>&gt;<i>
</I>&gt;<i>&quot; (SELECT a.entry_title,a.entry_created_on, a.entry_id, count(b.COMMENT_ENTRY_ID) comment_count &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; FROM mt.mt_entry a,mt.mt_comments b &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; where a.entry_author_id = 1 &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; and a.ENTRY_ID= b.COMMENT_ENTRY_ID(+) &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; group by a.entry_title,a.entry_created_on, a.entry_id &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; order by entry_created_on desc, entry_id desc) &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; where rownum &lt;11 ) c, &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; mt.mt_entry d &quot; +
</I>&gt;<i>
</I>&gt;<i>&quot; where c.entry_id = d.entry_id &quot; + 
</I>&gt;<i>
</I>&gt;<i>&quot; order by entry_created_on desc, entry_id desc &quot;);
</I>&gt;<i>
</I>&gt;<i>I looked it up on Oracle Metalink and found this:
</I>&gt;<i> 
</I>&gt;<i>Error: ORA-24347 
</I>&gt;<i>Text: Warning of a NULL column in an aggregate function  
</I>&gt;<i>--------------------------------------------------------------------------- 
</I>&gt;<i>Cause: A null column was processed by an aggregate function  
</I>&gt;<i>Action: An OCI_SUCCESS_WITH_INFO is returned.
</I>&gt;<i>*** Important: The notes below are for experienced users - See [NOTE:22080.1] 
</I>&gt;<i>
</I>&gt;<i>Explanation: 
</I>&gt;<i>
</I>&gt;<i>  This error is introduced in Oracle8i and is a warning. If an OCI 
</I>&gt;<i>
</I>&gt;<i>  client executes a statement in which an AGGREGATE function  
</I>&gt;<i>
</I>&gt;<i>  processes a NULL value then a warning is signalled to indicate  
</I>&gt;<i>
</I>&gt;<i>  this. The OCI function will return OCI_SUCCESS_WITH_INFO. In  
</I>&gt;<i>
</I>&gt;<i>  many cases the client does not care about this and so should 
</I>&gt;<i>
</I>&gt;<i>  ignore this particular warning and continue as normal. 
</I>&gt;<i>
</I>&gt;<i>  If upgrading from OCI 8.0 to 8.1 you may need to modify the OCI code 
</I>&gt;<i>
</I>&gt;<i>  to cope with this new warning if the code treats OCI_SUCCESS_WITH_INFO 
</I>&gt;<i>
</I>&gt;<i>  as a failure scenario. 
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>I looked in the System.Data.OracleClient code and found that adding this in OciStatementHandle.cs made my code work: 
</I>&gt;<i>
</I>&gt;<i>  public bool Fetch ()
</I>&gt;<i>                {
</I>&gt;<i>                        int status = 0; 
</I>&gt;<i>
</I>&gt;<i>                        if (this.disposed) ^M
</I>&gt;<i>                        {
</I>&gt;<i>                                throw new InvalidOperationException (&quot;StatementHandle is already disposed.&quot;);
</I>&gt;<i>                        } 
</I>&gt;<i>
</I>&gt;<i>                        status = OciCalls.OCIStmtFetch (Handle,
</I>&gt;<i>                                ErrorHandle.Handle,
</I>&gt;<i>                                1,
</I>&gt;<i>                                2,
</I>&gt;<i>                                0); 
</I>&gt;<i>
</I>&gt;<i>                        switch (status) {
</I>&gt;<i>                        case OciGlue.OCI_NO_DATA:
</I>&gt;<i>                                moreResults = false;
</I>&gt;<i>                                break;
</I>&gt;<i>                        case OciGlue.OCI_DEFAULT:
</I>&gt;<i>                                moreResults = true;
</I>&gt;<i>                                break;
</I>&gt;<i>                        case OciGlue.OCI_SUCCESS_WITH_INFO:
</I>&gt;<i>                                moreResults = true;
</I>&gt;<i>                                break;
</I>&gt;<i>                        default:
</I>&gt;<i>                                OciErrorInfo info = ErrorHandle.HandleError ();
</I>&gt;<i>                                throw new OracleException (info.ErrorCode, info.ErrorMessage);
</I>&gt;<i>                        } 
</I>&gt;<i>
</I>&gt;<i>                        return moreResults;
</I>&gt;<i>                }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I guess it's not pretty, but if it's just a warning condition, i thought, just add it, continue as normal :) 
</I>&gt;<i>
</I>&gt;<i>regards, 
</I>&gt;<i>
</I>&gt;<i>Joost Evertse 
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>2uXf)+2uXX&#794;&amp;rX&#794;&amp;r+wjzY
</I>&gt;<i>
</I>&gt;<i>------------------------------------------------------------
</I>&gt;<i>Mail was checked for spam by the Freeware Edition of No Spam Today!
</I>&gt;<i>The Freeware Edition is free for personal and non-commercial use.
</I>&gt;<i>You can remove this notice by purchasing a full license! To order
</I>&gt;<i>or to find out more please visit: <A HREF="http://www.no-spam-today.com">http://www.no-spam-today.com</A>
</I>&gt;<i>  
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009717.html">[Mono-devel-list] OCI_SUCCES_WITH_INFO with System.Data.OracleClient
</A></li>
	<LI>Next message: <A HREF="009718.html">[Mono-devel-list] domain.c assertion error (runtimesecurityframe_class)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9727">[ date ]</a>
              <a href="thread.html#9727">[ thread ]</a>
              <a href="subject.html#9727">[ subject ]</a>
              <a href="author.html#9727">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
