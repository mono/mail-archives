<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Redirect certain string constructors to	CreateString
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Redirect%20certain%20string%20constructors%20to%0A%09CreateString&In-Reply-To=003801c6a67a%24943ec380%240100a8c0%40kornelpal.hu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019401.html">
   <LINK REL="Next"  HREF="019445.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Redirect certain string constructors to	CreateString</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Redirect%20certain%20string%20constructors%20to%0A%09CreateString&In-Reply-To=003801c6a67a%24943ec380%240100a8c0%40kornelpal.hu"
       TITLE="[Mono-dev] [PATCH] Redirect certain string constructors to	CreateString">lupus at ximian.com
       </A><BR>
    <I>Mon Jul 17 06:32:40 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019401.html">[Mono-dev] [PATCH] Redirect certain string constructors to	CreateString
</A></li>
        <LI>Next message: <A HREF="019445.html">[Mono-dev] [PATCH] Redirect certain string constructors	toCreateString
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19444">[ date ]</a>
              <a href="thread.html#19444">[ thread ]</a>
              <a href="subject.html#19444">[ subject ]</a>
              <a href="author.html#19444">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/13/06 Korn&#233;l P&#225;l wrote:
&gt;<i> I reallized that simply redirecting the method may not be a good solution 
</I>&gt;<i> because the .ctor method is lost from the stack trace this way. And I think 
</I>&gt;<i> other problems may occur altough I never experienced such problems.
</I>&gt;<i> 
</I>&gt;<i> I attached an extended version of the previous patch that creates a wrapper.
</I>&gt;<i> 
</I>&gt;<i> In addition now CreateString () methods are properly implemented and I've 
</I>&gt;<i> patched ASCIIEncoding and Latin1Encoding classes so that their GetString () 
</I>&gt;<i> methods no longer recurse to CreateString () methods.
</I>
I had a change similar to this in my long-term todo list, long term
because to improve performance it will need the changes in the GC that
allow object allocation completely in managed code. This way the string
ctors won't need to perform the managed &lt;&gt; unmanaged transitions.
The change would involve all the string ctors, of course.
Since the change would need to improve performance, using a wrapper
is not allowed, instead the Create* methods would have the same
signature as our currently used internal string ctors (taking a fake
string this first argument and returning the string instead of void).
The JIT will automatically use the method headers from the Create*
methods for the implementation of the string ctors internal calls
with trivial changes to the runtime. This implementation should cover
your needs and it will avoid having a wrapper in the middle of
performance-sensitive code.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019401.html">[Mono-dev] [PATCH] Redirect certain string constructors to	CreateString
</A></li>
	<LI>Next message: <A HREF="019445.html">[Mono-dev] [PATCH] Redirect certain string constructors	toCreateString
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19444">[ date ]</a>
              <a href="thread.html#19444">[ thread ]</a>
              <a href="subject.html#19444">[ subject ]</a>
              <a href="author.html#19444">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
