<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Edit and Continue / Function body rewrite
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Edit%20and%20Continue%20/%20Function%20body%20rewrite&In-Reply-To=44AEB6F0.10008%40fluggo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019296.html">
   <LINK REL="Next"  HREF="019302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Edit and Continue / Function body rewrite</H1>
    <B>David Srbecky</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Edit%20and%20Continue%20/%20Function%20body%20rewrite&In-Reply-To=44AEB6F0.10008%40fluggo.com"
       TITLE="[Mono-dev] Edit and Continue / Function body rewrite">dsrbecky at gmail.com
       </A><BR>
    <I>Fri Jul  7 18:38:53 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019296.html">[Mono-dev] Edit and Continue / Function body rewrite
</A></li>
        <LI>Next message: <A HREF="019302.html">[Mono-dev] Edit and Continue / Function body rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19301">[ date ]</a>
              <a href="thread.html#19301">[ thread ]</a>
              <a href="subject.html#19301">[ subject ]</a>
              <a href="author.html#19301">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Here is a longer description of how I want to make the basic Edit and 
Continue work. My questions are at the end.

Microsoft's .NET runtime will run the modifiable application and the IDE 
with debugger (SharpDevelop).

Mono will be used to do the System.Reflection.Emit stuff - compile the 
application for the first time (gmcs) and then to generate the IL code 
updates.

I will need to use some communication between the runtimes - eg network 
connection. Here is how I imagine the communication could work:

1) MS -&gt; Mono: &quot;Complie program Foo to assembly Foo.exe&quot;
2) Mono -&gt; MS: &quot;Compilation successful. 0 errors&quot;
3) MS executes Foo.exe
4) MS -&gt; Mono: &quot;Change function Main to '{return 1;}'&quot;
5) Mono -&gt; MS: &quot;The new IL code is ...........&quot;
6) MS applies the the new IL code

I have managed to get 1-3 working without any problems. I have also 
managed to change a running program under MS runtime by handwriting the 
new IL code.

Now I need to patch Mono's System.Reflection.Emit so that I can use it 
to easily produce the new IL code and metadata. (I do not think that I 
can get all I need from Microsoft's System.Reflection.Emit and I want to 
use Mono's System.Reflection.Emit anyway because I am told that gmcs 
likes it more)


Right now, I am just investing whether the Edit and Continue is 
possible. If it is, may plan is to:

A) Define 'update' format - probably XML document

B) Modify SharpDevelop so that it can take the update and apply it to 
the running program

C) Make it possible to produce 'updates' with Mono's 
System.Reflection.Emit - the format of data it produces does not matter 
- I just need to be able to collect it and then convert it to the XML

D) Make a simple sample application that uses Mono's 
System.Reflection.Emit to create the XML 'update'

E) Change gmcs so that after whole compilation it can take source code 
for body of a single method and generate 'update' using Mono's 
System.Reflection.Emit

F) Modify SharpDevelop so that it can work with symbols produced by gmcs

I handle A, B, D and F myself. I would really appreciate your help with 
C and E. I had a few long discussions about the gmcs with Marek Safar 
and I hope he could help me with that.




So back to patching System.Reflection.Emit:

If I want to change a function in a running program, what do I need?
- whole IL code of the new function
- new TypeRef and MemberRef rows in metadata (if new external functions
are called)
- String heap (if new string is used in function)
- Anything else???

How can I get these from Mono's System.Reflection.Emit? Is there 
actually any patching necessary or can I get these already?



Thank you very much,
David Srbecky



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019296.html">[Mono-dev] Edit and Continue / Function body rewrite
</A></li>
	<LI>Next message: <A HREF="019302.html">[Mono-dev] Edit and Continue / Function body rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19301">[ date ]</a>
              <a href="thread.html#19301">[ thread ]</a>
              <a href="subject.html#19301">[ subject ]</a>
              <a href="author.html#19301">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
