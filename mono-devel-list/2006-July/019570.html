<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Assembly.GetEntryAssembly() returns null
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Assembly.GetEntryAssembly%28%29%20returns%20null&In-Reply-To=340e8e120607260432u361edd51xdbc272f366592d04%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019562.html">
   <LINK REL="Next"  HREF="019588.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Assembly.GetEntryAssembly() returns null</H1>
    <B>Janne Rantala</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Assembly.GetEntryAssembly%28%29%20returns%20null&In-Reply-To=340e8e120607260432u361edd51xdbc272f366592d04%40mail.gmail.com"
       TITLE="[Mono-dev] Assembly.GetEntryAssembly() returns null">janne.rantala at gmail.com
       </A><BR>
    <I>Wed Jul 26 13:16:23 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019562.html">[Mono-dev] Assembly.GetEntryAssembly() returns null
</A></li>
        <LI>Next message: <A HREF="019588.html">[Mono-dev] Assembly.GetEntryAssembly() returns null
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19570">[ date ]</a>
              <a href="thread.html#19570">[ thread ]</a>
              <a href="subject.html#19570">[ subject ]</a>
              <a href="author.html#19570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2006/7/26, Janne Rantala &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">janne.rantala at gmail.com</A>&gt;:
&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I've loaded assembly (compiled in VS.NET) in embedded environment. This
</I>&gt;<i> assembly is supposed to work as a client for web service. However this does
</I>&gt;<i> not work because Assembly.GetEntryAssembly returns null when called from
</I>&gt;<i> managed code. This causes ConfigurationManager to throw ArgumentException
</I>&gt;<i> stating that &quot;exePath must be specified when not running inside a stand
</I>&gt;<i> alone exe&quot;.
</I>&gt;<i>
</I>&gt;<i> MSDN
</I>&gt;<i> <A HREF="http://msdn2.microsoft.com/en-us/library/system.reflection.assembly.getentryassembly.aspxsays">http://msdn2.microsoft.com/en-us/library/system.reflection.assembly.getentryassembly.aspxsays</A> that
</I>&gt;<i>
</I>&gt;<i> &quot;Return Value
</I>&gt;<i> The Assembly that is the process executable in the default application
</I>&gt;<i> domain, or the first executable that was executed by
</I>&gt;<i> AppDomain.ExecuteAssembly. Can return a null reference (Nothing in
</I>&gt;<i> Visual Basic) when called from unmanaged code.&quot;
</I>&gt;<i>
</I>&gt;<i> But since this call is made from managed code it should return something
</I>&gt;<i> else than null? Both Assembly.GetCallingAssembly() and
</I>&gt;<i> Assembly.GetExecutingAssembly return the assembly I've loaded.
</I>&gt;<i>
</I>&gt;<i> Is this a bug?
</I>&gt;<i>
</I>&gt;<i> Here's the full stack trace if it's any help:
</I>&gt;<i>
</I>&gt;<i> Unhandled Exception: System.TypeInitializationException : An exception was
</I>&gt;<i> thrown
</I>&gt;<i>  by the type initializer for System.Net.WebRequest ---&gt;
</I>&gt;<i> System.ArgumentException
</I>&gt;<i>
</I>&gt;<i> : exePath must be specified when not running inside a stand alone exe.
</I>&gt;<i>   at
</I>&gt;<i> System.Configuration.ConfigurationManager.OpenExeConfigurationInternal(Con
</I>&gt;<i> figurationUserLevel userLevel, System.Reflection.Assemblycalling_assembly, Syst
</I>&gt;<i> em.String exePath) [0x00000]
</I>&gt;<i>   at
</I>&gt;<i> System.Configuration.ClientConfigurationSystem.System.Configuration.Interna
</I>&gt;<i> l.IInternalConfigSystem.GetSection (System.String configKey) [0x00000]
</I>&gt;<i>   at System.Configuration.ConfigurationManager.GetSection (System.Stringsection
</I>&gt;<i> Name) [0x00000]
</I>&gt;<i>   at System.Net.WebRequest..cctor () [0x00000] --- End of inner exception
</I>&gt;<i> stack
</I>&gt;<i> trace ---
</I>&gt;<i>
</I>&gt;<i>   at &lt;0x00000&gt; &lt;unknown method&gt;
</I>&gt;<i>   at System.Web.Services.Protocols.WebClientProtocol.GetWebRequest (
</I>&gt;<i> System.Uri u
</I>&gt;<i> ri) [0x00000]
</I>&gt;<i>   at System.Web.Services.Protocols.HttpWebClientProtocol.GetWebRequest (
</I>&gt;<i> System.U
</I>&gt;<i> ri uri) [0x00000]
</I>&gt;<i>   at System.Web.Services.Protocols.SoapHttpClientProtocol.GetWebRequest(System.
</I>&gt;<i> Uri uri) [0x00000]
</I>&gt;<i>   at
</I>&gt;<i> System.Web.Services.Protocols.SoapHttpClientProtocol.GetRequestForMessage(
</I>&gt;<i> System.Uri uri, System.Web.Services.Protocols.SoapClientMessage message)
</I>&gt;<i> [0x0000
</I>&gt;<i> 0]
</I>&gt;<i>   at System.Web.Services.Protocols.SoapHttpClientProtocol.Invoke (
</I>&gt;<i> System.String
</I>&gt;<i> method_name, System.Object[] parameters) [0x00000]
</I>&gt;<i>   at WSTest.net.xmethods.www.CurrencyExchangeService.getRate (
</I>&gt;<i> System.String coun
</I>&gt;<i> try1, System.String country2) [0x00000]
</I>&gt;<i>   at (wrapper remoting-invoke-with-check)
</I>&gt;<i> WSTest.net.xmethods.www.CurrencyExchan
</I>&gt;<i> geService:getRate (string,string)
</I>&gt;<i>   at WSTest.Class1.WebServiceTest () [0x00000]
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Janne
</I>&gt;<i>
</I>
Looks like the only place entry assembly is being set is
mono_runtime_exec_main, which means that every time object is created I must
also call Main method. Is this the way it is supposed to be? I'd imagine
especially in embedded environment objects would be created without calling
Main methods at all.

Doing the mono_runtime_exec_main -call solves problem having
GetEntryAssembly returning null and it also sets the
AppDomain.CurrentDomain.SetupInformation.ConfigurationFile.

Janne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060726/d22524e5/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060726/d22524e5/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019562.html">[Mono-dev] Assembly.GetEntryAssembly() returns null
</A></li>
	<LI>Next message: <A HREF="019588.html">[Mono-dev] Assembly.GetEntryAssembly() returns null
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19570">[ date ]</a>
              <a href="thread.html#19570">[ thread ]</a>
              <a href="subject.html#19570">[ subject ]</a>
              <a href="author.html#19570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
