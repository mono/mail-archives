<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono.Cecil: Full names of generic types
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono.Cecil%3A%20Full%20names%20of%20generic%20types&In-Reply-To=44C490EE.2090307%40evain.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019518.html">
   <LINK REL="Next"  HREF="019523.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono.Cecil: Full names of generic types</H1>
    <B>Matej Urbas</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono.Cecil%3A%20Full%20names%20of%20generic%20types&In-Reply-To=44C490EE.2090307%40evain.net"
       TITLE="[Mono-dev] Mono.Cecil: Full names of generic types">matej.urbas at gmail.com
       </A><BR>
    <I>Mon Jul 24 06:11:12 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019518.html">[Mono-dev] Mono.Cecil: Full names of generic types
</A></li>
        <LI>Next message: <A HREF="019523.html">[Mono-dev] Mono.Cecil: Full names of generic types
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19522">[ date ]</a>
              <a href="thread.html#19522">[ thread ]</a>
              <a href="subject.html#19522">[ subject ]</a>
              <a href="author.html#19522">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2006-07-24 at 11:20 +0200, Jb Evain wrote:
&gt;<i> You can find constructed generic types (GenericInstanceType) and 
</I>&gt;<i> constructed generic methods (GenericInstanceMethod).
</I>&gt;<i> 
</I>&gt;<i> They both implement IGenericInstance wich provides a collection of 
</I>&gt;<i> argument. An argument is a TypeReference, which is the base class for 
</I>&gt;<i> any kinf of type (hence, it could be a TypeDefinition as well as another 
</I>&gt;<i> GenericInstanceType).
</I>
Thanks! I figured that out yesterday, just before I wanted to start
writing the 'name parser' :D


I have one question though:

Suppose we have such a TypeReference: SomeType`2&lt;int, T&gt;[][]

Here is what I do to get all info about &quot;SomeType`2&quot; out of there:

I have a loop that goes like this:

Check if the TypeReference is of any of these types:

 1. ArrayType
 2. GenericInstanceType
 3. ReferenceType
 4. PointerType
 5. None of the above

if we stumble on either of cases 1-4, we can cast the TypeReference to
either of them and gather whatever additional info they have (e.g.:
ArrayType gives us info about the Rank, GenericInstanceType gives us
info about GenericAttributes, ReferenceType tells us that the type is
passed ByRef and PointerType gives us the level of indirection).

Moreover, each of the above types has a property named 'ElementType'
which is the one I use to gather all info about the type.

Now in the 5th case, we have only the plain type - without the array
modifier or any generic attributes - which is our end point...

Here is what my algorithm would do (looking at SomeType`2&lt;int, T&gt;[][]):

Step 1: current type is an ArrayType - get its rank &lt;-- now visit its
ElementType
Step 2: current type is an ArrayType - get its rank &lt;-- now visit its
ElementType
Step 3: current type is a GenericInstanceType - traverse its
GenericArguments &lt;--- now visit its ElementType
Step 4: current type falls into the 5th case (its neither an ArrayType
or GenericInstanceType or whatever) - it is simply a TypeReference: with
the name &quot;SomeType`2&quot; &lt;--- without any decorations... &lt;--- I store this
name in MonoDevelop

My question is if there are any other possible TypeReference types
(other then the 4 mentioned above)? Did I miss something?

&gt;<i> 
</I>&gt;<i> &gt; You see, the GenericParameters collection of the 'match' parameter is 
</I>&gt;<i> &gt; empty and its full name has the generic parameters already appended 
</I>&gt;<i> &gt; (i.e.: &lt;T&gt;). Now, in monodevelop I have to extract generic parameters of 
</I>&gt;<i> &gt; such parameters but it seems like there is no other way but to parse 
</I>&gt;<i> &gt; them from the 'full name' string... In fact, one can tell that a method 
</I>&gt;<i> &gt; parameter is generic only if one searches for a &amp;gt; or &amp;lt; character 
</I>&gt;<i> &gt; in its name... I would really like to see those parameters specified in 
</I>&gt;<i> &gt; a collection rather than appended to the string. What can I do about it?
</I>&gt;<i> 
</I>&gt;<i> You can check:
</I>&gt;<i> 
</I>&gt;<i> MethodReference ref = ...;
</I>&gt;<i> GenericInstanceMethod gim = ref as GenericInstanceMethod;
</I>&gt;<i> if (gim != null) {
</I>&gt;<i> 	foreach (TypeReference argument in gim.Arguments) {
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>
I see. Do you have a case where we would stumble upon a MethodReference?
I mean, if we go through all types in the MainModule of an assembly,
would we find a method reference with actual arguments specified? Do you
have a C# example of such an occurrence?

&gt;<i> 
</I>&gt;<i> &gt; 3. Oh, and to what extent is Mono.Cecil compatible with 
</I>&gt;<i> &gt; System.Reflection? E.g.: are the Mono.Cecil.GenericParamAttributes and 
</I>&gt;<i> &gt; System.Reflection.GenericParameterAttributes cast safe? - I mean, can 
</I>&gt;<i> &gt; they be cast from one-another and still preserve the expected information?
</I>&gt;<i> 
</I>&gt;<i> Check that the values are the same before doing so. In theory, it &quot;may&quot; 
</I>&gt;<i> work.
</I>
Will do that.

Thank you very much!


BTW, Cecil rocks! Great work!


Enjoy,
---
Matej


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019518.html">[Mono-dev] Mono.Cecil: Full names of generic types
</A></li>
	<LI>Next message: <A HREF="019523.html">[Mono-dev] Mono.Cecil: Full names of generic types
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19522">[ date ]</a>
              <a href="thread.html#19522">[ thread ]</a>
              <a href="subject.html#19522">[ subject ]</a>
              <a href="author.html#19522">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
