<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Incremental C# compiler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Incremental%20C%23%20compiler&In-Reply-To=dd99b8c80607120755v2b8887a9p84b07ded680824a5%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019374.html">
   <LINK REL="Next"  HREF="019377.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Incremental C# compiler</H1>
    <B>David Srbecky</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Incremental%20C%23%20compiler&In-Reply-To=dd99b8c80607120755v2b8887a9p84b07ded680824a5%40mail.gmail.com"
       TITLE="[Mono-dev] Incremental C# compiler">dsrbecky at gmail.com
       </A><BR>
    <I>Wed Jul 12 11:25:46 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019374.html">[Mono-dev] Incremental C# compiler
</A></li>
        <LI>Next message: <A HREF="019377.html">[Mono-dev] Incremental C# compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19375">[ date ]</a>
              <a href="thread.html#19375">[ thread ]</a>
              <a href="subject.html#19375">[ subject ]</a>
              <a href="author.html#19375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Addition of new members should not a problem since it does not involve 
invalidation of metadata. Deletion must be forbidden. This could lead to 
simple form of updating: changed source files are send to the complier 
which will compile them and merge them into the exiting tree overriding 
any exiting members. Thus if only one method is changed, the IDE can 
strip out any other methods from the source file so that compiler does 
not have to compile them again.

I would not support renaming as it is basically equivalent to deletion 
and addition - you have to check that no-one is using the old name 
anymore and thus you have to do semantic analysis on everything again.

David

Rafael Teixeira wrote:
&gt;<i> On 7/12/06, David Srbecky &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dsrbecky at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Thank you,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So semantic analysis is the part that takes vast majority of the time
</I>&gt;&gt;<i> and the problem is that gmcs can not easily invalidate previously added
</I>&gt;&gt;<i> metadata. Right?
</I>&gt;<i> 
</I>&gt;<i> That is my bird's view understanding, but it surely is a very simplified 
</I>&gt;<i> view.
</I>&gt;<i> 
</I>&gt;&gt;<i> What if we add the constraint that only the bodies of methods can
</I>&gt;&gt;<i> change? The metadata of the new code would be determined on the first
</I>&gt;&gt;<i> run and then it would never change and thus it would not need to be
</I>&gt;&gt;<i> invalidated. Also the preciously done semantic analysis for any
</I>&gt;&gt;<i> unchanged functions would still be valid.
</I>&gt;<i> 
</I>&gt;<i> That surely would be a good start, but day-to-day use of
</I>&gt;<i> edit-an-continue normally entails adding methods/properties, besides
</I>&gt;<i> changing methods/acessors internals, so probably a class recompile
</I>&gt;<i> would be a better target, the constrain being that no breaking of ABI
</I>&gt;<i> (just additions/internal changes) would be acceptable.
</I>&gt;<i> 
</I>&gt;<i> Also some refactorings may be possible should be supported like
</I>&gt;<i> renaming methods (very easy for the private members, harder for the
</I>&gt;<i> internal/protected/public sets).
</I>&gt;<i> 
</I>&gt;<i> Fun,
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> David
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Rafael Teixeira wrote:
</I>&gt;&gt;<i> &gt; Lexing and parsing normally are very fast and depend only on the size
</I>&gt;&gt;<i> &gt; of the code being parsed. Semantic analysis is normally the most time
</I>&gt;&gt;<i> &gt; consuming step as loading referenced assemblies and sifting around the
</I>&gt;&gt;<i> &gt; huge metadata to resolve symbols and types is really the meat of the
</I>&gt;&gt;<i> &gt; compiler, also, new &quot;compiled&quot; code is &quot;appended&quot; to this metadata/AST
</I>&gt;&gt;<i> &gt; what increases the complexity of resolving symbols over time. Emission
</I>&gt;&gt;<i> &gt; of code is done in memory first so it is fast. Saving to disk is slow
</I>&gt;&gt;<i> &gt; but depends on emitted code size.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; For incremental compiling, caching the metadata, would make everything
</I>&gt;&gt;<i> &gt; very fast, as normally very little would be changed from one
</I>&gt;&gt;<i> &gt; compilation to the other. But gmcs would have to invalidate only part
</I>&gt;&gt;<i> &gt; of the metadata/AST, what it wasn't built for.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Hope it helps,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; On 7/12/06, David Srbecky &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dsrbecky at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt; Hello,
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; It seems that my whole Edit and Continue effort boils down just to one
</I>&gt;&gt;<i> &gt;&gt; thing: Being able to recompile as quickly as possible.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; The idea is that gmcs would not be used as a command line tool but 
</I>&gt;&gt;<i> as a
</I>&gt;&gt;<i> &gt;&gt; library. After compilation it would keep all usefully data in 
</I>&gt;&gt;<i> memory so
</I>&gt;&gt;<i> &gt;&gt; it could use them during an incremental compilation. For example, I do
</I>&gt;&gt;<i> &gt;&gt; not think that it is necessary do parse again file that have not 
</I>&gt;&gt;<i> changed.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; I actually do not know what takes so long on compilation. Can anyone
</I>&gt;&gt;<i> &gt;&gt; give me a rough estimate on how long the compiling stages take please?
</I>&gt;&gt;<i> &gt;&gt; - lexing, parsing, semantic analysis and such
</I>&gt;&gt;<i> &gt;&gt; - emission of code to System.Reflection.Emit
</I>&gt;&gt;<i> &gt;&gt; - Saving of the assembly on disk
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; David
</I>&gt;&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;&gt;<i> &gt;&gt; Mono-devel-list mailing list
</I>&gt;&gt;<i> &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019374.html">[Mono-dev] Incremental C# compiler
</A></li>
	<LI>Next message: <A HREF="019377.html">[Mono-dev] Incremental C# compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19375">[ date ]</a>
              <a href="thread.html#19375">[ thread ]</a>
              <a href="subject.html#19375">[ subject ]</a>
              <a href="author.html#19375">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
