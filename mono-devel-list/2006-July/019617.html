<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] patch for X509Certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20patch%20for%20X509Certificate&In-Reply-To=44CDB646.9020906%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019616.html">
   <LINK REL="Next"  HREF="019618.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] patch for X509Certificate</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20patch%20for%20X509Certificate&In-Reply-To=44CDB646.9020906%40ximian.com"
       TITLE="[Mono-dev] patch for X509Certificate">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Mon Jul 31 08:31:03 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019616.html">[Mono-dev] patch for X509Certificate
</A></li>
        <LI>Next message: <A HREF="019618.html">[Mono-dev] patch for X509Certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19617">[ date ]</a>
              <a href="thread.html#19617">[ thread ]</a>
              <a href="subject.html#19617">[ subject ]</a>
              <a href="author.html#19617">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Atsushi,

On Mon, 2006-07-31 at 16:50 +0900, Atsushi Eno wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I have some X509Certificate fixes for constructors and Equals(),
</I>
Looks fine :)

Please move the new tests, in X509CertificateTest.cs, between the &quot;NON
GENERATED CODE&quot; comments (near the start of the file) in case I
regenerate the file someday.

&gt;<i> attached (ChangeLog inclusive). Please review it.
</I>
and update the dates in the ChangeLog entries.

Thanks
Sebastien

&gt;<i> 
</I>&gt;<i> Atsushi Eno
</I>&gt;<i> plain text document attachment (x509-cert-fixes.patch)
</I>&gt;<i> Index: System.Security.Cryptography.X509Certificates/ChangeLog
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- System.Security.Cryptography.X509Certificates/ChangeLog	(revision 63029)
</I>&gt;<i> +++ System.Security.Cryptography.X509Certificates/ChangeLog	(working copy)
</I>&gt;<i> @@ -1,3 +1,11 @@
</I>&gt;<i> +2006-03-31  Atsushi Enomoto  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushi at ximian.com</A>&gt;
</I>&gt;<i> +
</I>&gt;<i> +	* X509Certificate.cs :
</I>&gt;<i> +	  In 2.0 IntPtr constructor reject IntPtr.Zero as invalid handle.
</I>&gt;<i> +	  In 2.0 copy constructor rejects null argument.
</I>&gt;<i> +	  Equals() should return false if the argument cert is null.
</I>&gt;<i> +	  Also if both x509 and raw data are null it caused NRE.
</I>&gt;<i> +
</I>&gt;<i>  2005-11-09  Sebastien Pouliot  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&gt;
</I>&gt;<i>  
</I>&gt;<i>  	* X509ContentType.cs: Removed extra [Serializable] (2.0).
</I>&gt;<i> Index: System.Security.Cryptography.X509Certificates/X509Certificate.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- System.Security.Cryptography.X509Certificates/X509Certificate.cs	(revision 63029)
</I>&gt;<i> +++ System.Security.Cryptography.X509Certificates/X509Certificate.cs	(working copy)
</I>&gt;<i> @@ -160,11 +160,20 @@
</I>&gt;<i>  				Marshal.Copy (cc.pbCertEncoded, data, 0, (int)cc.cbCertEncoded);
</I>&gt;<i>  				x509 = new Mono.Security.X509.X509Certificate (data);
</I>&gt;<i>  			}
</I>&gt;<i> +#if NET_2_0
</I>&gt;<i> +			else
</I>&gt;<i> +				throw new ArgumentException (&quot;Invalid handle.&quot;);
</I>&gt;<i> +#endif
</I>&gt;<i>  			// IntPtr.Zero results in an &quot;empty&quot; certificate instance
</I>&gt;<i>  		}
</I>&gt;<i>  	
</I>&gt;<i>  		public X509Certificate (System.Security.Cryptography.X509Certificates.X509Certificate cert) 
</I>&gt;<i>  		{
</I>&gt;<i> +#if NET_2_0
</I>&gt;<i> +			if (cert == null)
</I>&gt;<i> +				throw new ArgumentNullException ();
</I>&gt;<i> +#endif
</I>&gt;<i> +
</I>&gt;<i>  			if (cert != null) {
</I>&gt;<i>  				byte[] data = cert.GetRawCertData ();
</I>&gt;<i>  				if (data != null)
</I>&gt;<i> @@ -262,7 +271,9 @@
</I>&gt;<i>  						return false;
</I>&gt;<i>  				}
</I>&gt;<i>  			}
</I>&gt;<i> -			return (x509.RawData == null);
</I>&gt;<i> +			else
</I>&gt;<i> +				return false;
</I>&gt;<i> +			return x509 == null || (x509.RawData == null);
</I>&gt;<i>  		}
</I>&gt;<i>  	
</I>&gt;<i>  		// LAMESPEC: This is the equivalent of the &quot;thumbprint&quot; that can be seen
</I>&gt;<i> Index: Test/System.Security.Cryptography.X509Certificates/X509CapiTest.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- Test/System.Security.Cryptography.X509Certificates/X509CapiTest.cs	(revision 63029)
</I>&gt;<i> +++ Test/System.Security.Cryptography.X509Certificates/X509CapiTest.cs	(working copy)
</I>&gt;<i> @@ -157,6 +157,9 @@
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i>  		[Test]
</I>&gt;<i> +#if NET_2_0
</I>&gt;<i> +		[ExpectedException (typeof (ArgumentException))]
</I>&gt;<i> +#endif
</I>&gt;<i>  		public void ConstructorIntPtrZero ()
</I>&gt;<i>  		{
</I>&gt;<i>  			X509Certificate spc = new X509Certificate (IntPtr.Zero);
</I>&gt;<i> Index: Test/System.Security.Cryptography.X509Certificates/ChangeLog
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- Test/System.Security.Cryptography.X509Certificates/ChangeLog	(revision 63029)
</I>&gt;<i> +++ Test/System.Security.Cryptography.X509Certificates/ChangeLog	(working copy)
</I>&gt;<i> @@ -1,3 +1,9 @@
</I>&gt;<i> +2006-03-31  Atsushi Enomoto  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushi at ximian.com</A>&gt;
</I>&gt;<i> +
</I>&gt;<i> +	* X509CapiTest.cs : ConstructorIntPtrZero() is valid only under 1.x.
</I>&gt;<i> +	* X509CertificateTest.cs :
</I>&gt;<i> +	  Added tests for equality and null certificate constructor.
</I>&gt;<i> +
</I>&gt;<i>  2005-09-25  Sebastien Pouliot  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&gt;
</I>&gt;<i>  
</I>&gt;<i>  	* X509CapiTest.cs: Update the test cases as the 1.x date/time bug 
</I>&gt;<i> Index: Test/System.Security.Cryptography.X509Certificates/X509CertificateTest.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- Test/System.Security.Cryptography.X509Certificates/X509CertificateTest.cs	(revision 63029)
</I>&gt;<i> +++ Test/System.Security.Cryptography.X509Certificates/X509CertificateTest.cs	(working copy)
</I>&gt;<i> @@ -973,7 +973,37 @@
</I>&gt;<i>  	//Assertion.AssertEquals (&quot;ToString(true)&quot;, tsa, x509.ToString (true));
</I>&gt;<i>  }
</I>&gt;<i>  
</I>&gt;<i> +[Test]
</I>&gt;<i> +public void Equality ()
</I>&gt;<i> +{
</I>&gt;<i> +	// copy from Certificate1()
</I>&gt;<i> +	byte[] cert = { 0x30,0x82,0x01,0xFF,0x30,0x82,0x01,0x6C,0x02,0x05,0x02,0x72,0x00,0x06,0xE8,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x01,0x02,0x05,0x00,0x30,0x5F,0x31,0x0B,0x30,0x09,0x06,0x03,0x55,0x04,0x06,0x13,0x02,0x55,0x53,0x31,0x20,0x30,0x1E,0x06,0x03,0x55,0x04,0x0A,0x13,0x17,0x52,0x53,0x41,0x20,0x44,0x61,0x74,0x61,0x20,0x53,0x65,0x63,0x75,0x72,0x69,0x74,0x79,0x2C,0x20,0x49,0x6E,0x63,0x2E,0x31,0x2E,0x30,0x2C,0x06,0x03,0x55,0x04,0x0B,0x13,0x25,0x53,0x65,0x63,0x75,0x72,0x65,0x20,0x53,0x65,0x72,0x76,
</I>&gt;<i> +		0x65,0x72,0x20,0x43,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x69,0x6F,0x6E,0x20,0x41,0x75,0x74,0x68,0x6F,0x72,0x69,0x74,0x79,0x30,0x1E,0x17,0x0D,0x39,0x36,0x30,0x33,0x31,0x32,0x31,0x38,0x33,0x38,0x34,0x37,0x5A,0x17,0x0D,0x39,0x37,0x30,0x33,0x31,0x32,0x31,0x38,0x33,0x38,0x34,0x36,0x5A,0x30,0x61,0x31,0x0B,0x30,0x09,0x06,0x03,0x55,0x04,0x06,0x13,0x02,0x55,0x53,0x31,0x13,0x30,0x11,0x06,0x03,0x55,0x04,0x08,0x13,0x0A,0x43,0x61,0x6C,0x69,0x66,0x6F,0x72,0x6E,0x69,0x61,0x31,0x14,0x30,0x12,0x06,0x03,
</I>&gt;<i> +		0x55,0x04,0x0A,0x13,0x0B,0x43,0x6F,0x6D,0x6D,0x65,0x72,0x63,0x65,0x4E,0x65,0x74,0x31,0x27,0x30,0x25,0x06,0x03,0x55,0x04,0x0B,0x13,0x1E,0x53,0x65,0x72,0x76,0x65,0x72,0x20,0x43,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x69,0x6F,0x6E,0x20,0x41,0x75,0x74,0x68,0x6F,0x72,0x69,0x74,0x79,0x30,0x70,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x01,0x01,0x05,0x00,0x03,0x5F,0x00,0x30,0x5C,0x02,0x55,0x2D,0x58,0xE9,0xBF,0xF0,0x31,0xCD,0x79,0x06,0x50,0x5A,0xD5,0x9E,0x0E,0x2C,0xE6,0xC2,0xF7,0xF9,
</I>&gt;<i> +		0xD2,0xCE,0x55,0x64,0x85,0xB1,0x90,0x9A,0x92,0xB3,0x36,0xC1,0xBC,0xEA,0xC8,0x23,0xB7,0xAB,0x3A,0xA7,0x64,0x63,0x77,0x5F,0x84,0x22,0x8E,0xE5,0xB6,0x45,0xDD,0x46,0xAE,0x0A,0xDD,0x00,0xC2,0x1F,0xBA,0xD9,0xAD,0xC0,0x75,0x62,0xF8,0x95,0x82,0xA2,0x80,0xB1,0x82,0x69,0xFA,0xE1,0xAF,0x7F,0xBC,0x7D,0xE2,0x7C,0x76,0xD5,0xBC,0x2A,0x80,0xFB,0x02,0x03,0x01,0x00,0x01,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x01,0x02,0x05,0x00,0x03,0x7E,0x00,0x54,0x20,0x67,0x12,0xBB,0x66,0x14,0xC3,0x26,0x6B,0x7F,
</I>&gt;<i> +		0xDA,0x4A,0x25,0x4D,0x8B,0xE0,0xFD,0x1E,0x53,0x6D,0xAC,0xA2,0xD0,0x89,0xB8,0x2E,0x90,0xA0,0x27,0x43,0xA4,0xEE,0x4A,0x26,0x86,0x40,0xFF,0xB8,0x72,0x8D,0x1E,0xE7,0xB7,0x77,0xDC,0x7D,0xD8,0x3F,0x3A,0x6E,0x55,0x10,0xA6,0x1D,0xB5,0x58,0xF2,0xF9,0x0F,0x2E,0xB4,0x10,0x55,0x48,0xDC,0x13,0x5F,0x0D,0x08,0x26,0x88,0xC9,0xAF,0x66,0xF2,0x2C,0x9C,0x6F,0x3D,0xC3,0x2B,0x69,0x28,0x89,0x40,0x6F,0x8F,0x35,0x3B,0x9E,0xF6,0x8E,0xF1,0x11,0x17,0xFB,0x0C,0x98,0x95,0xA1,0xC2,0xBA,0x89,0x48,0xEB,0xB4,0x06,0x6A,0x22,0x54,
</I>&gt;<i> +		0xD7,0xBA,0x18,0x3A,0x48,0xA6,0xCB,0xC2,0xFD,0x20,0x57,0xBC,0x63,0x1C };
</I>&gt;<i>  
</I>&gt;<i> +	X509Certificate x509 = new X509Certificate (cert);
</I>&gt;<i> +	Assert.IsFalse (x509.Equals (null), &quot;#1&quot;);
</I>&gt;<i> +
</I>&gt;<i> +#if !NET_2_0
</I>&gt;<i> +	X509Certificate nullobj = new X509Certificate (IntPtr.Zero);
</I>&gt;<i> +	Assert.IsFalse (x509.Equals (nullobj), &quot;#2&quot;);
</I>&gt;<i> +	Assert.IsFalse (nullobj.Equals (null), &quot;#3&quot;);
</I>&gt;<i> +	Assert.IsFalse (nullobj.Equals (x509), &quot;#4&quot;);
</I>&gt;<i> +#endif
</I>&gt;<i> +}
</I>&gt;<i> +
</I>&gt;<i> +[Test]
</I>&gt;<i> +#if NET_2_0
</I>&gt;<i> +[ExpectedException (typeof (ArgumentNullException))]
</I>&gt;<i> +#endif
</I>&gt;<i> +public void ConstructorX509CertificateNull ()
</I>&gt;<i> +{
</I>&gt;<i> +	X509Certificate nullcopy = new X509Certificate ((X509Certificate) null);
</I>&gt;<i> +}
</I>&gt;<i> +
</I>&gt;<i>  // Number of certificates: 12
</I>&gt;<i>  // Number of invalid certificates: 1
</I>&gt;<i>  }
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019616.html">[Mono-dev] patch for X509Certificate
</A></li>
	<LI>Next message: <A HREF="019618.html">[Mono-dev] patch for X509Certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19617">[ date ]</a>
              <a href="thread.html#19617">[ thread ]</a>
              <a href="subject.html#19617">[ subject ]</a>
              <a href="author.html#19617">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
