<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Building with Visual Studio 2005
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Building%20with%20Visual%20Studio%202005&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019329.html">
   <LINK REL="Next"  HREF="019360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Building with Visual Studio 2005</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Building%20with%20Visual%20Studio%202005&In-Reply-To="
       TITLE="[Mono-dev] Building with Visual Studio 2005">kornelpal at gmail.com
       </A><BR>
    <I>Mon Jul 10 07:21:01 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019329.html">[Mono-dev] Building with Visual Studio 2005
</A></li>
        <LI>Next message: <A HREF="019360.html">[Mono-dev] Bug in DataGrid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19330">[ date ]</a>
              <a href="thread.html#19330">[ thread ]</a>
              <a href="subject.html#19330">[ subject ]</a>
              <a href="author.html#19330">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I never tried to compile Mono with Visual Studio 2005 so I don't know what 
exactly is wrong but the problem is the following:

The GC (Garbage Collector) has to know about each thread in order to 
function. Under UNIX this requires to use custom thread functions that 
notify the GC.

Under Windows the problem is easier to solve because DllMain (DLL entry 
point function) gets notification when a thread was created so that the GC 
can be notified. But this requires to have a DLL that notifies the GC. 
Unfortunately there is no such notification for EXE images.

The solution is that mono.exe is only a stub that calls an entry point in 
mono-1.dll and everything else is done in mono-1.dll so that mono-1.dll 
receives thread creation notifications in its DllMain.

If mono.exe is compiled without having mono-1.dll or mono-1.dll entry point 
is not set to DllMain in win32_threads.c threads won't be registered with 
GC. If you supress such warings/errors the problem still won't be solved.

For more information see DLL_THREAD_ATTACH in
<A HREF="http://msdn.microsoft.com/library/en-us/dllproc/base/dllmain.asp">http://msdn.microsoft.com/library/en-us/dllproc/base/dllmain.asp</A>
and see DllMain in
mono\libgc\win32_threads.c

Korn&#233;l

----- Original Message ----- 
From: &quot;Janne Rantala&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">janne.rantala at gmail.com</A>&gt;
To: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Monday, July 10, 2006 12:38 PM
Subject: Re: [Mono-dev] Building with Visual Studio 2005


&gt;<i> 2006/7/10, Rusmin Susanto &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">rusminsusanto at yahoo.com</A>&gt;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hello.
</I>&gt;&gt;<i> I am trying to build Mono with Visual Studio 2005. I managed to build it.
</I>&gt;&gt;<i> However, when I run mono, I got the following error message:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;Thread %p calling into managed code is not registered with the GC. On
</I>&gt;&gt;<i> UNIX, this can be fixed by #include-ing &lt; gc.h&gt; before &lt;pthread.h&gt; in the
</I>&gt;&gt;<i> file &quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> After debugging, I found that the following function returns 0 because
</I>&gt;&gt;<i> both GC_DLL and GC_INSIDE_DLL are not defined. This function should 
</I>&gt;&gt;<i> return
</I>&gt;&gt;<i> 1.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> int GC_thread_is_registered (void)
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> #if defined(GC_DLL) || defined(GC_INSIDE_DLL)
</I>&gt;&gt;<i>  /* Registered by DllMain */
</I>&gt;&gt;<i>  return 1;
</I>&gt;&gt;<i> #else
</I>&gt;&gt;<i>  /* FIXME: */
</I>&gt;&gt;<i>  return 0;
</I>&gt;&gt;<i> #endif
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I try to modify the code and guess where to define GC_DLL and
</I>&gt;&gt;<i> GC_INSIDE_DLL. But still no luck so far.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can someone tell me what's wrong? Where should I define GC_DLL and
</I>&gt;&gt;<i> GC_INSIDE_DLL ? Or what should I do?
</I>&gt;&gt;<i> Thanks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Rusmin
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------
</I>&gt;&gt;<i> Yahoo! Music Unlimited - Access over 1 million songs. Try it 
</I>&gt;&gt;<i> free.&lt;<A HREF="http://pa.yahoo.com/*http://us.rd.yahoo.com/evt=36035/*http://music.yahoo.com/unlimited/+%0A">http://pa.yahoo.com/*http://us.rd.yahoo.com/evt=36035/*http://music.yahoo.com/unlimited/+%0A</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi!
</I>&gt;<i>
</I>&gt;<i> I used to get the same error. I've just commented those lines from
</I>&gt;<i> threads.cand at least I've been able to run embedded samples without
</I>&gt;<i> problems. This
</I>&gt;<i> is what Sebastien Pouliot replied me at the time:
</I>&gt;<i>
</I>&gt;<i> &quot;Yes, I'm unsure right now if it's a configuration problem (wrong define)
</I>&gt;<i> or if some recent changes broke this.
</I>&gt;<i>
</I>&gt;<i> To run the sample I used the debugger to bypass the check (you could
</I>&gt;<i> also comment the code). After that I didn't have any problem running the
</I>&gt;<i> embed sample.&quot;
</I>&gt;<i>
</I>&gt;<i> So can't really say if it's good solution or not.
</I>&gt;<i>
</I>&gt;<i> Janne
</I>&gt;<i>
</I>

--------------------------------------------------------------------------------


&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019329.html">[Mono-dev] Building with Visual Studio 2005
</A></li>
	<LI>Next message: <A HREF="019360.html">[Mono-dev] Bug in DataGrid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19330">[ date ]</a>
              <a href="thread.html#19330">[ thread ]</a>
              <a href="subject.html#19330">[ subject ]</a>
              <a href="author.html#19330">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
