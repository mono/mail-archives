<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Jagged arrays over multidimensional arrays
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Jagged%20arrays%20over%20multidimensional%20arrays&In-Reply-To=8cca42d80903240802j43e34568saa89d41037528301%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031509.html">
   <LINK REL="Next"  HREF="031510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Jagged arrays over multidimensional arrays</H1>
    <B>Stifu</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Jagged%20arrays%20over%20multidimensional%20arrays&In-Reply-To=8cca42d80903240802j43e34568saa89d41037528301%40mail.gmail.com"
       TITLE="[Mono-dev] Jagged arrays over multidimensional arrays">stifu at free.fr
       </A><BR>
    <I>Tue Mar 24 12:13:05 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031509.html">[Mono-dev] Jagged arrays over multidimensional arrays
</A></li>
        <LI>Next message: <A HREF="031510.html">[Mono-dev] Jagged arrays over multidimensional arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31512">[ date ]</a>
              <a href="thread.html#31512">[ thread ]</a>
              <a href="subject.html#31512">[ subject ]</a>
              <a href="author.html#31512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I wanted to try the oabcrem parameter, but first wanted to run the program
again without it... and jagged arrays appeared faster 3 times in a row,
after which multidimensional arrays were faster again. I guess my test
doesn't have enough iterations or isn't reliable enough, or Mono is too
random, I don't know.
So I guess I shouldn't feel bad about changing my multidimensional arrays to
jagged arrays anyway, if the performance difference between arrays with Mono
is so slight and not always consistent.

Anyway, can't wait to see what effects the new GC will have on performances.
:<i>)
</I>Gotta wait for Mono 2.8 (if the roadmap doesn't change), which may be there
sometimes in 2010...

Thanks for your answers.


Rodrigo Kumpera wrote:
&gt;<i> 
</I>&gt;<i> Your code is testing two things.
</I>&gt;<i> First GC performance, which mono lags behind but work on this is ramping
</I>&gt;<i> up
</I>&gt;<i> fast.
</I>&gt;<i> Second arrays bound elimination, which we don't perform by default.
</I>&gt;<i> 
</I>&gt;<i> Running your code with -Oabcrem might improve things.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, Mar 24, 2009 at 11:53 AM, Stifu &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">stifu at free.fr</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Microsoft (through MSDN and FxCop) recommends using jagged arrays
</I>&gt;&gt;<i> (likeThis[][]) over multidimensional arrays(likeThat[,]), because they're
</I>&gt;&gt;<i> usually faster, basically (especially if the sub arrays in your jagged
</I>&gt;&gt;<i> array
</I>&gt;&gt;<i> don't all have the same size). See:
</I>&gt;&gt;<i> <A HREF="http://msdn.microsoft.com/en-us/library/ms182277.aspx">http://msdn.microsoft.com/en-us/library/ms182277.aspx</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I made a simple test program that initializes arrays to check the speed
</I>&gt;&gt;<i> difference, and I could see that with a simple initialization loop,
</I>&gt;&gt;<i> jagged
</I>&gt;&gt;<i> arrays were indeed a bit faster than multidimensional ones (even if all
</I>&gt;&gt;<i> sub
</I>&gt;&gt;<i> arrays in the jagged array have the same size, as with a multidimensional
</I>&gt;&gt;<i> one).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But before changing all the multidimensional arrays to jagged arrays in
</I>&gt;&gt;<i> my
</I>&gt;&gt;<i> application, I thought I'd check Mono... with which jagged arrays are
</I>&gt;&gt;<i> slower
</I>&gt;&gt;<i> than multidimensional ones, unlike with .NET.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is it worth filing a bug report for a performance issue like this one?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> For more details on the way .NET generates code for jagged and
</I>&gt;&gt;<i> multidimensional arrays:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://www.guidanceshare.com/wiki/.NET_2.0_Performance_Guidelines_-_Arrays#Use_Jagged_Arrays_Instead_of_Multidimensional_Arrays">http://www.guidanceshare.com/wiki/.NET_2.0_Performance_Guidelines_-_Arrays#Use_Jagged_Arrays_Instead_of_Multidimensional_Arrays</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> About the tests I ran on my computer:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> .NET (2.0) results:
</I>&gt;&gt;<i> Multidimensional arrays: 02.89 seconds
</I>&gt;&gt;<i> Jagged arrays: 02.74 seconds
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Mono (2.4 RC3) results:
</I>&gt;&gt;<i> Multidimensional arrays: 04.57 seconds
</I>&gt;&gt;<i> Jagged arrays: 04.94 seconds
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And here's the test program (feel free to raise the &quot;iterations&quot; value, I
</I>&gt;&gt;<i> set it to only 3000 because my computer is quite old):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> using System;
</I>&gt;&gt;<i> using System.Windows.Forms;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> namespace Arrays
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>        public partial class MainForm : Form
</I>&gt;&gt;<i>        {
</I>&gt;&gt;<i>                public MainForm()
</I>&gt;&gt;<i>                {
</I>&gt;&gt;<i>                        InitializeComponent();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                        int iterations = 3000;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                        DateTime start = DateTime.Now;
</I>&gt;&gt;<i>                        for(int i = 0; i &lt; iterations; i++)
</I>&gt;&gt;<i>                        {
</I>&gt;&gt;<i>                                int[,] multiDimensionalArray = new
</I>&gt;&gt;<i> int[128,
</I>&gt;&gt;<i> 128];
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                for(int y = 0; y &lt; 128; y++)
</I>&gt;&gt;<i>                                {
</I>&gt;&gt;<i>                                        for(int x = 0; x &lt; 128; x++)
</I>&gt;&gt;<i>                                        {
</I>&gt;&gt;<i>                                                multiDimensionalArray[y,
</I>&gt;&gt;<i> x]
</I>&gt;&gt;<i> = 5;
</I>&gt;&gt;<i>                                        }
</I>&gt;&gt;<i>                                }
</I>&gt;&gt;<i>                        }
</I>&gt;&gt;<i>                        TimeSpan duration = DateTime.Now - start;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                        start = DateTime.Now;
</I>&gt;&gt;<i>                        for(int i = 0; i &lt; iterations; i++)
</I>&gt;&gt;<i>                        {
</I>&gt;&gt;<i>                                int[][] jaggedArray = new int[128][];
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                for(int y = 0; y &lt; 128; y++)
</I>&gt;&gt;<i>                                {
</I>&gt;&gt;<i>                                        jaggedArray[y] = new int[128];
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                        for(int x = 0; x &lt; 128; x++)
</I>&gt;&gt;<i>                                        {
</I>&gt;&gt;<i>                                                jaggedArray[y][x] = 5;
</I>&gt;&gt;<i>                                        }
</I>&gt;&gt;<i>                                }
</I>&gt;&gt;<i>                        }
</I>&gt;&gt;<i>                        TimeSpan duration2 = DateTime.Now - start;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                        MessageBox.Show(String.Format(
</I>&gt;&gt;<i>                                &quot;Multidimensional array : {0}\n&quot; +
</I>&gt;&gt;<i>                                &quot;Jagged array : {1}&quot;,
</I>&gt;&gt;<i>                                duration.ToString(),
</I>&gt;&gt;<i>                                duration2.ToString()));
</I>&gt;&gt;<i>                }
</I>&gt;&gt;<i>        }
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> View this message in context:
</I>&gt;&gt;<i> <A HREF="http://www.nabble.com/Jagged-arrays-over-multidimensional-arrays-tp22682187p22682187.html">http://www.nabble.com/Jagged-arrays-over-multidimensional-arrays-tp22682187p22682187.html</A>
</I>&gt;&gt;<i> Sent from the Mono - Dev mailing list archive at Nabble.com.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://www.nabble.com/Jagged-arrays-over-multidimensional-arrays-tp22682187p22683908.html">http://www.nabble.com/Jagged-arrays-over-multidimensional-arrays-tp22682187p22683908.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031509.html">[Mono-dev] Jagged arrays over multidimensional arrays
</A></li>
	<LI>Next message: <A HREF="031510.html">[Mono-dev] Jagged arrays over multidimensional arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31512">[ date ]</a>
              <a href="thread.html#31512">[ thread ]</a>
              <a href="subject.html#31512">[ subject ]</a>
              <a href="author.html#31512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
