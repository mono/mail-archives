<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] csharp tab completion.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20csharp%20tab%20completion.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031381.html">
   <LINK REL="Next"  HREF="031356.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] csharp tab completion.</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20csharp%20tab%20completion.&In-Reply-To="
       TITLE="[Mono-dev] csharp tab completion.">miguel at novell.com
       </A><BR>
    <I>Thu Mar 12 12:51:47 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031381.html">[Mono-dev] Re moting between dotnet framework and mono framework
</A></li>
        <LI>Next message: <A HREF="031356.html">[Mono-dev] csharp tab completion.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31355">[ date ]</a>
              <a href="thread.html#31355">[ thread ]</a>
              <a href="subject.html#31355">[ subject ]</a>
              <a href="author.html#31355">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    I cooked this patch on my last trip and just got it polished enough
that it is worth posting to the mailing list.

    A feature frequently requested is for the `csharp' interactive shell
is to provide bash-like tab completion so that you can quickly explore
the API without having to look things up.    The getline.cs library
already provided a mechanism for doing tab completion, but the support
was not implemented.

    The challenge was to reuse the current gmcs parser without having to
dramatically modify it and still provide completions.   The support
works like this.

    The parser and tokenizer work together so that the tokenizer upon
reaching the end of the input generates the following tokens:
GENERATE_COMPLETION followed by as many COMPLETE_COMPLETION token and
finally the EOF token.

    GENERATE_COMPLETION needs to be handled in every production where
the user is likely to press the TAB key in the shell (or in the future
the GUI, or an explicit request in an IDE).   COMPLETE_COMPLETION must
be handled throughout the grammar to provide a way of completing the
parsed expression.  See below for details. 

    For the member access case, I have added productions that mirror the
non-completing productions, for example:

  primary_expression DOT IDENTIFIER GENERATE_COMPLETION 
  {
	LocatedToken lt = (LocatedToken) $3;
	$$ = new CompletionMemberAccess ((Expression) $1, lt.Value, lt.Location);
  }

This mirrors:

  primary_expression DOT IDENTIFIER opt_type_argument_list
  {
	LocatedToken lt = (LocatedToken) $3;
	$$ = new MemberAccess ((Expression) $1, lt.Value, (TypeArguments) $4, lt.Location);
  }

   The CompletionMemberAccess is a new kind of Mono.CSharp.Expression
that does the actual lookup.   It internally mimics some of the
MemberAccess code but has been tuned for this particular use.

   After this initial token is processed GENERATE_COMPLETION the
tokenizer will emit COMPLETE_COMPLETION tokens.   This is done to help
the parser basically produce a valid result from the partial input it
received.    For example it is able to produce a valid AST from &quot;(x&quot;
even if no parenthesis has been closed.   This is achieved by sprinkling
the grammar with productions that can cope with this &quot;winding down&quot;
token, for example this is what parenthesized_expression looks like now:

parenthesized_expression
	: OPEN_PARENS expression CLOSE_PARENS
	  {
		$$ = new ParenthesizedExpression ((Expression) $2);
	  }
	//
	// New production
	//
	| OPEN_PARENS expression COMPLETE_COMPLETION
	  {
		$$ = new ParenthesizedExpression ((Expression) $2);
	  }
	;

    Once we have wrapped up everything we generate the last EOF token.

    When the AST is complete we actually trigger the regular semantic
analysis process.   The DoResolve method of each node in our abstract
syntax tree will compute the result and communicate the possible
completions by throwing an exception of type CompletionResult.

    This is the bit that I am not very comfortable with, I had to
provide both the prefix string and the results to allow the completion
engine to render things properly.

    So for example if the user type &quot;T&quot; and the completion is &quot;ToString&quot;
we return &quot;oString&quot;.

    Attached is the patch for review.

Future Work:

&#65279;    I have only implemented support for completion right now in two
spots: declared variables and member access, so stuff like foo.&lt;TAB&gt;
will produce the completions for foo properly and foo.T&lt;TAB&gt; will
produce the completions for anything in foo that starts with a T.   

    &#65279;There are many other places missing (using declarations, type
parameters for example, and I am sure there are many other opportunities
missing), I might add those in the future if there is enough interest,
or even better, you can get yourself started with compiler technology
and email us patches ;-)

GSharp:

    The GUI version perhaps needs to implement this in a GUI-ish way
when the user presses a dot for example, or when the user presses a
hotkey.   The GUI version also has the benefit that it can distinguish
the user pressing tab from the user pasting some text with a tab.
 
Miguel

-------------- next part --------------
A non-text attachment was scrubbed...
Name: auto-complete-csharp
Type: text/x-patch
Size: 22688 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090312/22213c6b/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090312/22213c6b/attachment-0001.bin</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031381.html">[Mono-dev] Re moting between dotnet framework and mono framework
</A></li>
	<LI>Next message: <A HREF="031356.html">[Mono-dev] csharp tab completion.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31355">[ date ]</a>
              <a href="thread.html#31355">[ thread ]</a>
              <a href="subject.html#31355">[ subject ]</a>
              <a href="author.html#31355">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
