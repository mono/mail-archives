<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mkbundle &amp; Assembly.GetEntryAssembly()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20mkbundle%20%26%20Assembly.GetEntryAssembly%28%29&In-Reply-To=%3CCAAZEOjuRXe4VTz1dVd7Bs2EHbRW4wROSXFOo6BGZ%2BynQYUuu7g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044322.html">
   <LINK REL="Next"  HREF="044324.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mkbundle &amp; Assembly.GetEntryAssembly()</H1>
    <B>Rick Tillery</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20mkbundle%20%26%20Assembly.GetEntryAssembly%28%29&In-Reply-To=%3CCAAZEOjuRXe4VTz1dVd7Bs2EHbRW4wROSXFOo6BGZ%2BynQYUuu7g%40mail.gmail.com%3E"
       TITLE="[Mono-dev] mkbundle &amp; Assembly.GetEntryAssembly()">rtillerywork at gmail.com
       </A><BR>
    <I>Tue May 16 00:48:57 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044322.html">[Mono-dev] mkbundle &amp; Assembly.GetEntryAssembly()
</A></li>
        <LI>Next message (by thread): <A HREF="044324.html">[Mono-dev] mkbundle &amp; Assembly.GetEntryAssembly()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44323">[ date ]</a>
              <a href="thread.html#44323">[ thread ]</a>
              <a href="subject.html#44323">[ subject ]</a>
              <a href="author.html#44323">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks! That looks like it might work in C# (we don't really have any C in
this project). I'll give it a try.

However, I respectfully disagree that the path to the assembly is a good
choice. I understand that the Linux binary isn't the same as the .Net
assembly, but the EXE file is not there at all.

Worse, if I place the properly signed EXE in the directory on the target
machine with the Linux binary (at the path provided by GetEntryAssembly()),
the validation passes. This occurs even if the Linux binary has no code
from the EXE (just the same name at mkbundle time). That's not really a
very good validation.

Given that I can identify which platform I'm on, I can modify the
validation code to recognize the container/binary differences. But that has
to start with being able to locate the actual file that is the entry point.
(Your suggestion may get us there. Thanks again.)

With a path to the actual entry point, I'm guessing I'll have the choice of
locating the embedded EXE PE/COFF within the ELF &amp; checking it as usual, or
introducing a new signing/validation approach on the Linux ELF binary
level. (Not sure of the implications of these two approaches yet.)

Rick

On May 15, 2017 7:17 PM, &quot;Robert Jordan&quot; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt; wrote:

&gt;<i> On 15.05.2017 21:14, Rick Tillery wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> The problem is that this means the entry assembly being returned is not
</I>&gt;&gt;<i> the actual entry point, and I don't see a way to determine the assembly
</I>&gt;&gt;<i> that is the correct entry point.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is by design. From the point of view of the Mono runtime,
</I>&gt;<i> the entry assembly is actually that one that was passed to mkbundle.
</I>&gt;<i>
</I>&gt;<i> It would make little sense to modify the code base of the
</I>&gt;<i> main assembly to point to the native executable of the bundle,
</I>&gt;<i> because you won't be able to load this file anyway, as
</I>&gt;<i> it isn't an assembly anymore.
</I>&gt;<i>
</I>&gt;<i> If you're only interested in the code base path you may want to
</I>&gt;<i> look how it's done natively:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/933850/how-do-i-find-the-">http://stackoverflow.com/questions/933850/how-do-i-find-the-</A>
</I>&gt;<i> location-of-the-executable-in-c
</I>&gt;<i>
</I>&gt;<i> Robert
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">http://lists.dot.net/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20170515/c0b09708/attachment.html">http://lists.dot.net/pipermail/mono-devel-list/attachments/20170515/c0b09708/attachment.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044322.html">[Mono-dev] mkbundle &amp; Assembly.GetEntryAssembly()
</A></li>
	<LI>Next message (by thread): <A HREF="044324.html">[Mono-dev] mkbundle &amp; Assembly.GetEntryAssembly()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44323">[ date ]</a>
              <a href="thread.html#44323">[ thread ]</a>
              <a href="subject.html#44323">[ subject ]</a>
              <a href="author.html#44323">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
