<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Using valgrind with Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Using%20valgrind%20with%20Mono&In-Reply-To=%3CCAJR-0p8jsby1EA0LdtfeB%3DQsGXAgL%2Brafd8a6c7cVvusniQYVQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043573.html">
   <LINK REL="Next"  HREF="043575.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Using valgrind with Mono</H1>
    <B>Zoltan Varga</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Using%20valgrind%20with%20Mono&In-Reply-To=%3CCAJR-0p8jsby1EA0LdtfeB%3DQsGXAgL%2Brafd8a6c7cVvusniQYVQ%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Using valgrind with Mono">vargaz at gmail.com
       </A><BR>
    <I>Sun Mar 27 22:44:51 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043573.html">[Mono-dev] Using valgrind with Mono
</A></li>
        <LI>Next message: <A HREF="043575.html">[Mono-dev] Using valgrind with Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43574">[ date ]</a>
              <a href="thread.html#43574">[ thread ]</a>
              <a href="subject.html#43574">[ subject ]</a>
              <a href="author.html#43574">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

  Fixed the last one in:
<A HREF="https://github.com/mono/mono/commit/b97ac0023256bf7d915552f5f24a7742b28c32b7">https://github.com/mono/mono/commit/b97ac0023256bf7d915552f5f24a7742b28c32b7</A>

The first two are leaks, but they should be small and bounded. Will look
into fixing them to decrease the noise.

          Zoltan

On Sun, Mar 27, 2016 at 6:23 PM, Zinkevicius, Matt &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">matt.zinkevicius at hpe.com</A>
&gt;<i> wrote:
</I>
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Our backend service running on Mono 4.2.2 on Linux is experiencing an
</I>&gt;<i> unmanaged memory leak. When running our stress tests for several hours, we
</I>&gt;<i> see the managed heap sit around 50 MB, while private memory keeps growing
</I>&gt;<i> until the process is killed because of OOM. I am therefore attempting to
</I>&gt;<i> use valgrind to find the culprit, but I am getting so many leaks detected
</I>&gt;<i> that I think many must be false positives, so I thought I would ask here
</I>&gt;<i> for some guidance about which are safe to suppress or any other valgrind +
</I>&gt;<i> mono tricks you can share.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The vast majority of leaks reported have call stacks that closely match
</I>&gt;<i> one of the following:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ==16846== 4 bytes in 1 blocks are definitely lost in loss record 74 of
</I>&gt;<i> 19,903
</I>&gt;<i>
</I>&gt;<i> ==16846==    at 0x4C26FEF: calloc (vg_replace_malloc.c:711)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x62D1D9: monoeg_malloc0 (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x4870F2: decode_exception_debug_info (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x488975: mono_aot_find_jit_info (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x53C3A7: mono_jit_info_table_find_internal (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x493C04: mini_jit_info_table_find_ext (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x4988FB: mini_add_method_trampoline (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x499067: common_call_trampoline_inner (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x403217C: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x10D3FB63: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x10D3F41B: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x10D3F117: ???
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ==16846== 12 bytes in 1 blocks are definitely lost in loss record 1,172 of
</I>&gt;<i> 19,903
</I>&gt;<i>
</I>&gt;<i> ==16846==    at 0x4C2828A: malloc (vg_replace_malloc.c:299)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x62D221: monoeg_malloc (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x55B8EF: mono_metadata_type_dup (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x49FC4B: get_shared_gparam (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x49FE70: get_shared_inst (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x4A073A: mini_get_shared_method_full (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x414723: lookup_method (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x4147FA: mono_jit_compile_method_with_opt (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x414B9A: mono_jit_compile_method (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x498DA4: common_call_trampoline_inner (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x403405C: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x10D2DCA7: ???
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ==16846== 10 bytes in 1 blocks are definitely lost in loss record 739 of
</I>&gt;<i> 19,903
</I>&gt;<i>
</I>&gt;<i> ==16846==    at 0x4C2828A: malloc (vg_replace_malloc.c:299)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x62D221: monoeg_malloc (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x62BA8C: monoeg_g_utf16_to_utf8 (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x5A8646: mono_string_to_utf8_checked (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x5A885B: mono_string_to_utf8 (in /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x52DE3C: ves_icall_Type_GetNestedTypes (in
</I>&gt;<i> /usr/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x120D4256: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0xE338A78:
</I>&gt;<i> System_Type_GetMember_string_System_Reflection_BindingFlags (type.cs:806)
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x40C09EF: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x1259A6AF: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x73: ???
</I>&gt;<i>
</I>&gt;<i> ==16846==    by 0x141D191D: ???
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Are these valid leaks or is valgrind confused/misconfigured? I am using
</I>&gt;<i> the following command:
</I>&gt;<i>
</I>&gt;<i> valgrind --tool=memcheck -v --leak-check=full --log-file=val.txt
</I>&gt;<i> --smc-check=all mono program.exe
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for any input you can offer,
</I>&gt;<i>
</I>&gt;<i> Matt Zinkevicius
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20160327/c0aa8825/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20160327/c0aa8825/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043573.html">[Mono-dev] Using valgrind with Mono
</A></li>
	<LI>Next message: <A HREF="043575.html">[Mono-dev] Using valgrind with Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43574">[ date ]</a>
              <a href="thread.html#43574">[ thread ]</a>
              <a href="subject.html#43574">[ subject ]</a>
              <a href="author.html#43574">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
