<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Cross%20Platform%20on%20Linux/Windows%20with%20Mono.Posix%0A%20reference%20on%20Linux&In-Reply-To=%3C45E8A49DE8DF9B4E9A8038276F135D3A6003EFFF%40RWC-EXCH02.trionworld.priv%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043586.html">
   <LINK REL="Next"  HREF="043593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux</H1>
    <B>Chris Swiedler</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Cross%20Platform%20on%20Linux/Windows%20with%20Mono.Posix%0A%20reference%20on%20Linux&In-Reply-To=%3C45E8A49DE8DF9B4E9A8038276F135D3A6003EFFF%40RWC-EXCH02.trionworld.priv%3E"
       TITLE="[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux">cswiedler at trionworlds.com
       </A><BR>
    <I>Tue Mar 29 15:58:37 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043586.html">[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
</A></li>
        <LI>Next message: <A HREF="043593.html">[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43588">[ date ]</a>
              <a href="thread.html#43588">[ thread ]</a>
              <a href="subject.html#43588">[ subject ]</a>
              <a href="author.html#43588">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Why not just include references to Mono.Posix.dll in the Windows build? You don't have to install the full framework. We have a similar issue with server apps that are developed on Windows and run on Linux. We just put a win32 build of Mono into our source tree and added Mono.Posix as a reference. Everywhere we invoke any Posix code, we just wrap the statements in something like &quot;if  (Environment.OSVersion.Platform == PlatformID.Unix)&quot;. 

chris

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Edward Ned Harvey (mono)
Sent: Tuesday, March 29, 2016 5:49 AM
To: Greg Young &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>&gt;; Jason Curl &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jcurlnews at arcor.de</A>&gt;
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux

&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> 
</I>&gt;<i> [mailto:mono-devel-list- <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of Greg 
</I>&gt;<i> Young
</I>&gt;<i> 
</I>&gt;<i> &lt;Reference Include=&quot;Mono.Posix&quot; Condition=&quot; '$(OS)' != 'Windows_NT' &quot; 
</I>&gt;<i> /&gt;
</I>
(for clarification of my previous response, because I was asked for clarification off-list)

If you have some code that calls Mono.Posix.Something(), and you have a conditional reference to Mono.Posix in the project, then you're able to build on Mono, but on windows, without the reference, your call to Mono.Posix.Something() will not compile, which prevents you from building, even though at runtime you might never make that call. In order to compile on windows, you'll need to comment-out your Mono.Posix.Something() line, via #if or [Conditional], which means you need a compiler symbol to indicate whether you're building on mono or windows. This could be either separate project files, or multiple build configurations. (Or dynamically generated project files).

Maybe you can have a conditional reference to Mono.Posix on mono, and have a separate conditional reference to ../../ExtraClassLibraries/Mono.Posix.dll on windows, with copy-to-destination, so you can get the same code to build on both mono and windows, resulting in an effectively identical cross-platform binary... But I'm almost certain I recall somebody on this list telling me, that the JIT compiler can or will or might in the future, eagerly link assemblies at runtime (or just before runtime), so the Mono.Posix.dll file must be present on windows at runtime in order to avoid runtime exceptions, even though the runtime code execution will never execute that path.

You avoid all these problems by abstracting the functionality you want into an interface or abstract class, and using a factory to perform a runtime dynamic load of a mono-specific or windows-specific assembly with a derivative class. You can build the mono-specific assembly on mono, or maybe you can use the double-conditional described above and get the mono-specific assembly to also be buildable on windows. No need to copy Mono.Posix.dll to the destination, because Mono.Posix will only be called at runtime when run on mono.
_______________________________________________
Mono-devel-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043586.html">[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
</A></li>
	<LI>Next message: <A HREF="043593.html">[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43588">[ date ]</a>
              <a href="thread.html#43588">[ thread ]</a>
              <a href="subject.html#43588">[ subject ]</a>
              <a href="author.html#43588">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
