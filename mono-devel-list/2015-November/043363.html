<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Crash running C code built on OS X El Capitan in Xcode 7
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Crash%20running%20C%20code%20built%20on%20OS%20X%20El%20Capitan%20in%0A%20Xcode%207&In-Reply-To=%3CD25CFED3.1B05D%25martin.potter%40faithlife.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043362.html">
   <LINK REL="Next"  HREF="043364.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Crash running C code built on OS X El Capitan in Xcode 7</H1>
    <B>Martin Potter</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Crash%20running%20C%20code%20built%20on%20OS%20X%20El%20Capitan%20in%0A%20Xcode%207&In-Reply-To=%3CD25CFED3.1B05D%25martin.potter%40faithlife.com%3E"
       TITLE="[Mono-dev] Crash running C code built on OS X El Capitan in Xcode 7">Martin.Potter at faithlife.com
       </A><BR>
    <I>Mon Nov  2 22:24:15 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="043362.html">[Mono-dev] Crash running C code built on OS X El Capitan in Xcode 7
</A></li>
        <LI>Next message: <A HREF="043364.html">[Mono-dev] GC safepoint code breakage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43363">[ date ]</a>
              <a href="thread.html#43363">[ thread ]</a>
              <a href="subject.html#43363">[ subject ]</a>
              <a href="author.html#43363">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We ran into a similar problem with running Mono embedded in our
application. I would guess that this is an issue with the version of
pthread_getspecific that gets used when running from Xcode with LLDB
attached when launching on 10.11. We have been running a custom version of
Mono with a patch that allows us to run with LLDB attached at launch, but
I submitted a pull request earlier today that was pulled into master so it
should be fixed at some point in the future.

&#8249; Martin

On 11/2/15, 6:37 AM, &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> on behalf
of Jonathan Mitchell&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> on behalf
of <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonathan at mugginsoft.com</A>&gt; wrote:

&gt;<i>The following C test code calls the current Mono 4.2.1-91 framework.
</I>&gt;<i>It builds and runs fine within Xcode 6.4 on 10.10.
</I>&gt;<i>
</I>&gt;<i>It fails if I build and run it on OS X 10.11 using Xcode 7.1 -
</I>&gt;<i>EXC_BAD_ACCESS in mono_jit_runtime_invoke() when calling
</I>&gt;<i>AssemblyName:GetName()
</I>&gt;<i>However the built binary runs fine outside of the Xcode environment.
</I>&gt;<i>
</I>&gt;<i>This obviously makes life difficult.
</I>&gt;<i>It seems logical to infer that the Xcode IDE is the issue here and I have
</I>&gt;<i>posted to the Xcode list.
</I>&gt;<i>
</I>&gt;<i>However, maybe there is more to this than I can detect.
</I>&gt;<i>Perhaps the code below is somehow suspect.
</I>&gt;<i>Any comments would be appreciated.
</I>&gt;<i>
</I>&gt;<i>Jonathan
</I>&gt;<i>
</I>&gt;<i>// Link against both Mono and CoreFoundation.
</I>&gt;<i>// Header search path set to
</I>&gt;<i>/Library/Frameworks/Mono.framework/Headers/Mono-2.0
</I>&gt;<i>// Architecture i386.
</I>&gt;<i>#include &lt;stdio.h&gt;
</I>&gt;<i>#import &lt;mono/jit/jit.h&gt;
</I>&gt;<i>#import &lt;mono/metadata/metadata.h&gt;
</I>&gt;<i>#import &lt;mono/metadata/debug-helpers.h&gt;
</I>&gt;<i>
</I>&gt;<i>MonoObject *invokeName(MonoObject *object, char *name);
</I>&gt;<i>
</I>&gt;<i>int main(int argc, const char * argv[]) {
</I>&gt;<i>
</I>&gt;<i>   // init
</I>&gt;<i>   MonoDomain *domain = mono_jit_init_version(&quot;Dubrovnik&quot;, &quot;v4.0.30319&quot;);
</I>&gt;<i>   MonoAssembly *assembly = mono_domain_assembly_open(domain, &quot;mscorlib&quot;);
</I>&gt;<i>
</I>&gt;<i>   // returns System.Reflection.Assembly
</I>&gt;<i>   MonoReflectionAssembly *assemblyObject =
</I>&gt;<i>mono_assembly_get_object(domain, assembly);
</I>&gt;<i>
</I>&gt;<i>   // returns System.Reflection.AssemblyName
</I>&gt;<i>   MonoObject *assemblyNameObject = invokeName((MonoObject
</I>&gt;<i>*)assemblyObject, &quot;:GetName()&quot;);
</I>&gt;<i>
</I>&gt;<i>   // returns System.Version
</I>&gt;<i>   MonoObject *versionObject = invokeName(assemblyNameObject,
</I>&gt;<i>&quot;:get_Version()&quot;);
</I>&gt;<i>
</I>&gt;<i>   // Returns System.String
</I>&gt;<i>   MonoObject *stringObject = invokeName(versionObject, &quot;:ToString()&quot;);
</I>&gt;<i>   printf(&quot;Version : %s\n&quot;, mono_string_to_utf8((MonoString
</I>&gt;<i>*)stringObject));
</I>&gt;<i>
</I>&gt;<i>   return 0;
</I>&gt;<i>}
</I>&gt;<i>
</I>&gt;<i>MonoObject *invokeName(MonoObject *object, char *name)
</I>&gt;<i>{
</I>&gt;<i>   MonoClass *klass = mono_object_get_class(object);
</I>&gt;<i>
</I>&gt;<i>   MonoMethodDesc *methodDesc = mono_method_desc_new(name, 1);
</I>&gt;<i>   MonoMethod *meth = NULL;
</I>&gt;<i>   while (klass != NULL) {
</I>&gt;<i>       meth = mono_method_desc_search_in_class(methodDesc, klass);
</I>&gt;<i>       if(meth != NULL) {
</I>&gt;<i>           meth = mono_object_get_virtual_method(object, meth);
</I>&gt;<i>           break;
</I>&gt;<i>       }
</I>&gt;<i>       klass = mono_class_get_parent(klass);
</I>&gt;<i>   }
</I>&gt;<i>   MonoObject *monoException = NULL;
</I>&gt;<i>   MonoObject *resultObject = mono_runtime_invoke(meth, object, NULL,
</I>&gt;<i>&amp;monoException);
</I>&gt;<i>
</I>&gt;<i>   klass = mono_object_get_class(resultObject);
</I>&gt;<i>   printf(&quot;invokeName returned : %s\n&quot;, mono_class_get_name(klass));
</I>&gt;<i>
</I>&gt;<i>   return resultObject;
</I>&gt;<i>}
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Do not post admin requests to the list. They will be ignored.
</I>&gt;<i>Xcode-users mailing list      (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Xcode-users at lists.apple.com</A>)
</I>&gt;<i>Help/Unsubscribe/Update your Subscription:
</I>&gt;<i><A HREF="https://lists.apple.com/mailman/options/xcode-users/jonathan%40mugginsoft.">https://lists.apple.com/mailman/options/xcode-users/jonathan%40mugginsoft.</A>
</I>&gt;<i>com
</I>&gt;<i>
</I>&gt;<i>This email sent to <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonathan at mugginsoft.com</A>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-devel-list mailing list
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043362.html">[Mono-dev] Crash running C code built on OS X El Capitan in Xcode 7
</A></li>
	<LI>Next message: <A HREF="043364.html">[Mono-dev] GC safepoint code breakage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43363">[ date ]</a>
              <a href="thread.html#43363">[ thread ]</a>
              <a href="subject.html#43363">[ subject ]</a>
              <a href="author.html#43363">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
