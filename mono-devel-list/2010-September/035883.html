<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Stability regression on recent git head
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Stability%20regression%20on%20recent%20git%20head&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035884.html">
   <LINK REL="Next"  HREF="035885.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Stability regression on recent git head</H1>
    <B>Dick Porter</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Stability%20regression%20on%20recent%20git%20head&In-Reply-To="
       TITLE="[Mono-dev] Stability regression on recent git head">dporter at codicesoftware.com
       </A><BR>
    <I>Wed Sep 15 06:55:54 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035884.html">[Mono-dev] Current status of global regalloc (regalloc2.c)
</A></li>
        <LI>Next message: <A HREF="035885.html">[Mono-dev] Stability regression on recent git head
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35883">[ date ]</a>
              <a href="thread.html#35883">[ thread ]</a>
              <a href="subject.html#35883">[ subject ]</a>
              <a href="author.html#35883">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all

We've been testing the sgen GC with our server, as part of the effort to
stabilise it.  Recently however we've noticed that the runtime has been
very unstable, in particular using the _Boehm_ GC.

I can start our server with this morning's git head runtime, with Boehm
GC, and as soon as I issue a client command (which uses remoting) I get
the following stack trace on the server:

Plastic SCM daemon up. 3.0.187.2 1151 ms startup time
Stacktrace:

  at (wrapper managed-to-native) Mono.Unix.UnixSignal.WaitAny
(intptr[],int,int) &lt;0x00003&gt;
  at (wrapper managed-to-native) Mono.Unix.UnixSignal.WaitAny
(intptr[],int,int) &lt;0x00003&gt;
  at Mono.Unix.UnixSignal.WaitAny (Mono.Unix.UnixSignal[],int) &lt;0x0011e&gt;
  at Mono.Unix.UnixSignal.WaitAny (Mono.Unix.UnixSignal[]) &lt;0x00012&gt;
  at Codice.CM.Daemon.Daemon.HandleSignals () &lt;0x0013a&gt;
  at Codice.CM.Daemon.Daemon.LaunchUnixDaemon
(Codice.CM.Server.ISystemRunner,string) &lt;0x00036&gt;
  at xy.c (Codice.CM.Server.SystemRunner) &lt;0x0005f&gt;
  at xy.a (an) &lt;0x0035c&gt;
  at xy.a (string[]) &lt;0x000b1&gt;
  at (wrapper runtime-invoke) &lt;Module&gt;.runtime_invoke_int_object
(object,intptr,intptr,intptr) &lt;0x0008f&gt;


This is 100% repeatable, with the identical stack trace every time.
Interestingly, it doesn't happen with the sgen GC though I have seen
this stack trace appear intermittently with sgen, which suggests to me
that there might be some memory corruption going on that is more likely
to be tickled by the Boehm GC.

The actual line of code that triggers the segfault is in
mono/support/signal.c, in wait_for_any():

diff --git a/support/signal.c b/support/signal.c
index abd7638..a7f97fa 100644
--- a/support/signal.c
+++ b/support/signal.c
@@ -351,7 +351,7 @@ wait_for_any (signal_info** signals, int count, int
*currfd,
                        ptv = &amp;tv;
                }
                r = poll (fd_structs, count, timeout);
-       } while (keep_trying (r) &amp;&amp; !shutting_down ());
+       } while (keep_trying (r) /*&amp;&amp; !shutting_down ()*/);

        idx = -1;
        if (r == 0)

Commenting out the delegate call cures the crash for me.

I reopened bug <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=592981">https://bugzilla.novell.com/show_bug.cgi?id=592981</A> with these traces, but
as no-one has commented on it in a couple of weeks I'm highlighting it here too.

- Dick


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035884.html">[Mono-dev] Current status of global regalloc (regalloc2.c)
</A></li>
	<LI>Next message: <A HREF="035885.html">[Mono-dev] Stability regression on recent git head
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35883">[ date ]</a>
              <a href="thread.html#35883">[ thread ]</a>
              <a href="subject.html#35883">[ subject ]</a>
              <a href="author.html#35883">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
