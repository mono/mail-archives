<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] HttpListener https bug?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20HttpListener%20https%20bug%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035826.html">
   <LINK REL="Next"  HREF="035844.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] HttpListener https bug?</H1>
    <B>salar2k</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20HttpListener%20https%20bug%3F&In-Reply-To="
       TITLE="[Mono-dev] HttpListener https bug?">salar2k at gmail.com
       </A><BR>
    <I>Mon Sep  6 01:11:11 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035826.html">[Mono-dev] Error during make of fresh mono from git
</A></li>
        <LI>Next message: <A HREF="035844.html">[Mono-dev] HttpListener https bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35827">[ date ]</a>
              <a href="thread.html#35827">[ thread ]</a>
              <a href="subject.html#35827">[ subject ]</a>
              <a href="author.html#35827">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I'm trying to use Mono HttpListener but after some test I'm running into an
issue with HttpS.
The project works well with simple http requests but just doesn't serve
https.

Here is what I've done to use it (win7), first try to create certificate
files:

makecert -r -pe -n &quot;CN=SALARPC&quot; -b 01/01/2000 -e 01/01/2040 -eku
1.3.6.1.5.5.7.3.1 -ss my -sr localMachine -sky exchange -sp &quot;Microsoft RSA
SChannel Cryptographic Provider&quot; -sy 12 -sv local.pvk local.cer

(this is microsoft makecert application)

I've create certifications without password.
and registration of files to the port:

httpcfg -add -port 9667 -pvk local.pvk -cert local.cer

All is done successfully.
Unfortunately it doesn't response to https port.
(note: actually httpcfg copies cer and pvk files for port 9667 to here:
C:\Users\USERNAME\AppData\Roaming\.mono\httplistener)

Second try with openssl and pvktool:

    openssl genrsa -des3 -out localhost.pem 2048
    openssl rsa -in localhost.pem -out localhost.pem.nopass
    openssl req -new -key localhost.pem.nopass -out localhost.csr
    
    pvk -in localhost.pem.nopass -topvk -nocrypt -out localhost.pvk
    
    httpcfg -del -port 9667
    httpcfg -add -port 9667 -pvk localhost.pvk -cert localhost.crt

Still no luck with httplistener and https!

Debugging the mono code I realize that it throws internally an exception
during reading the request (HttpConnection.cs) which says &quot;The
authentication or decryption has failed.&quot;:

    System.IO.IOException was caught
      Message=The authentication or decryption has failed.
      Source=Mono.HttpListener
      StackTrace:
           at Mono.Security.Protocol.Tls.SslStreamBase.EndRead(IAsyncResult
asyncResult)
           at Mono.Net.HttpConnection.OnRead(IAsyncResult ares)
      InnerException: Mono.Security.Protocol.Tls.TlsException
           Message=A message could not be decoded because some field was out
of the specified range or the length of the message was incorrect.
           Source=Mono.HttpListener

Am I doing something wrong! What's the problem?
Or this is a bug?
[Mono-2.6.7 - windows 7]

-- 
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/HttpListener-https-bug-tp2527913p2527913.html">http://mono.1490590.n4.nabble.com/HttpListener-https-bug-tp2527913p2527913.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035826.html">[Mono-dev] Error during make of fresh mono from git
</A></li>
	<LI>Next message: <A HREF="035844.html">[Mono-dev] HttpListener https bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35827">[ date ]</a>
              <a href="thread.html#35827">[ thread ]</a>
              <a href="subject.html#35827">[ subject ]</a>
              <a href="author.html#35827">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
