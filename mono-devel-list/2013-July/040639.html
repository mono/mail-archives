<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Unix console implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Unix%20console%20implementation&In-Reply-To=%3CCACk-zm-Yj9aiYp9ppH%2B2euGALTwUQG0fNsPz_tzETmKAGRfkVA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040637.html">
   <LINK REL="Next"  HREF="040648.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Unix console implementation</H1>
    <B>Greg Najda</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Unix%20console%20implementation&In-Reply-To=%3CCACk-zm-Yj9aiYp9ppH%2B2euGALTwUQG0fNsPz_tzETmKAGRfkVA%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Unix console implementation">gregnajda at gmail.com
       </A><BR>
    <I>Wed Jul 31 03:05:04 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040637.html">[Mono-dev] FIXED:  Problems with html in ListItems
</A></li>
        <LI>Next message: <A HREF="040648.html">[Mono-dev] error executing the compiled EXE edited Mono Inside Windows Environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40639">[ date ]</a>
              <a href="thread.html#40639">[ thread ]</a>
              <a href="subject.html#40639">[ subject ]</a>
              <a href="author.html#40639">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm attempting to fix <A HREF="https://bugzilla.xamarin.com/show_bug.cgi?id=12552and">https://bugzilla.xamarin.com/show_bug.cgi?id=12552and</A>
<A HREF="https://bugzilla.xamarin.com/show_bug.cgi?id=12551.">https://bugzilla.xamarin.com/show_bug.cgi?id=12551.</A> Console, ConsoleDriver,
and the IConsoleDriver implementations make the flawed assumption that &quot;is
console&quot; is a simple boolean value when standard input or standard output
can be redirected to a file or a pipeline independently of each other.

I got rid of NullConsoleDriver and made WindowsConsoleDriver do the right
thing depending on whether or not standard input or standard output is a
console. This was straightforward; For example,
WindowsConsoleDriver.KeyAvailable does the usual if standard input is a
console, if not it returns false (which should throw an exception instead
as per
<A HREF="http://msdn.microsoft.com/en-us/library/system.console.keyavailable.aspxbut">http://msdn.microsoft.com/en-us/library/system.console.keyavailable.aspxbut</A>
that's for another commit...).

I am running into some trouble doing the same with TermInfoDriver. It looks
like mono disables the normal echoing of console input characters to the
console and handles that logic itself, echoing input characters to standard
output, instead letting the terminal take care of it. This is quite
problematic if standard output is redirected but standard input is not.

Why does this matter? Here's one use case. A program wants to read in a
password from the user. If standard input is a console, the program uses
ReadKey(true) to read the password without displaying it on the screen.
Consider what happens if the user wants to run output through tee. What
should happen is that everything is the same except that any output the
program itself outputted should go to the file specified to tee. For
example:

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">greg at Kubuntu</A>:~$ echo &quot;abc&quot; &gt; test.txt
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">greg at Kubuntu</A>:~$ sudo cat test.txt | tee sudo_output.txt
[sudo] password for greg:
abc

As another example

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">greg at Kubuntu</A>:~$ cat - &gt; test_cat_output.txt

Even though standard output is redirected to a file, standard input is
still echoed to the console.

Taking over the job of echoing input characters instead of letting the
terminal handle it strikes me as an odd design. What's the reason for this
approach? Is there a solution to the problem of allowing one of
input/output to be redirected and letting the one using the console to
still function correctly that does not involve rewriting large parts of
TermInfoDriver and associated internal calls?

- Greg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130730/3e6a5166/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130730/3e6a5166/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040637.html">[Mono-dev] FIXED:  Problems with html in ListItems
</A></li>
	<LI>Next message: <A HREF="040648.html">[Mono-dev] error executing the compiled EXE edited Mono Inside Windows Environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40639">[ date ]</a>
              <a href="thread.html#40639">[ thread ]</a>
              <a href="subject.html#40639">[ subject ]</a>
              <a href="author.html#40639">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
