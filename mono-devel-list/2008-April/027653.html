<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] SIGILL in finally clause without catch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SIGILL%20in%20finally%20clause%20without%20catch&In-Reply-To=89476A28-7EE6-4958-B128-3DD93AE63460%40christian-stuempel.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027652.html">
   <LINK REL="Next"  HREF="027619.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] SIGILL in finally clause without catch</H1>
    <B>Zoltan Varga</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SIGILL%20in%20finally%20clause%20without%20catch&In-Reply-To=89476A28-7EE6-4958-B128-3DD93AE63460%40christian-stuempel.de"
       TITLE="[Mono-dev] SIGILL in finally clause without catch">vargaz at gmail.com
       </A><BR>
    <I>Fri Apr 25 08:30:40 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027652.html">[Mono-dev] SIGILL in finally clause without catch
</A></li>
        <LI>Next message: <A HREF="027619.html">[Mono-dev] Mono on Nokia 770
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27653">[ date ]</a>
              <a href="thread.html#27653">[ thread ]</a>
              <a href="subject.html#27653">[ subject ]</a>
              <a href="author.html#27653">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

SIGILL means invalid instruction encountered by the cpu. Currently,
mono converts
this to an exception which can be caught and ignored. This behaviour
might change
in the future, cause we already handle SIGSEGV and SIGABRT by aborting the
process.

                 Zoltan

On Fri, Apr 25, 2008 at 1:51 PM, Christian St&#252;mpel
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mail at christian-stuempel.de</A>&gt; wrote:
&gt;<i> Hi Zoltan,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; the (managed-to-native) wrapper. So the problem is usually in the native
</I>&gt;<i> code.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>  But then why does introducing the &quot;catch&quot; and rethrowing resolve the
</I>&gt;<i> matter?
</I>&gt;<i>
</I>&gt;<i>  platform is Mac OS X i386.
</I>&gt;<i>
</I>&gt;<i>         Christian
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Am 25.04.2008 um 12:01 schrieb Zoltan Varga:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;                                      Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  Mono throws that exception when it receives a SIGILL signal while
</I>&gt;<i> &gt; executing some
</I>&gt;<i> &gt; code. If it receives it while executing native code, it appears that
</I>&gt;<i> &gt; it is thrown by
</I>&gt;<i> &gt; the (managed-to-native) wrapper. So the problem is usually in the native
</I>&gt;<i> code.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What platform/os is this ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;               Zoltan
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2008/4/23 Christian St&#252;mpel &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mail at christian-stuempel.de</A>&gt;:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; In code I have to port from MS .NET to mono I observed several SIGILL
</I>&gt;<i> &gt; &gt; crashes at points in code, where calls to external code are made within
</I>&gt;<i> a
</I>&gt;<i> &gt; &gt; try block followed by a finally but *without* a catch statement.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  try {
</I>&gt;<i> &gt; &gt;  unrar.dosomething();
</I>&gt;<i> &gt; &gt;  throw new Exception(&quot;test&quot;);
</I>&gt;<i> &gt; &gt;  }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  // no catch here
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  finally
</I>&gt;<i> &gt; &gt;  {
</I>&gt;<i> &gt; &gt;  unrar.close(); // calls unmanaged code
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The unmanaged code called in unrar.dosomething() is C++ code compiled
</I>&gt;<i> with
</I>&gt;<i> &gt; &gt; exceptions enabled but it does not throw the exception, but the managed
</I>&gt;<i> code
</I>&gt;<i> &gt; &gt; that follows. The call to unrar.close() (which does not throw any
</I>&gt;<i> exception)
</I>&gt;<i> &gt; &gt; in the finally clause crashes with:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; System.ExecutionEngineException: SIGILL  at (wrapper managed-to-native)
</I>&gt;<i> &gt; &gt; NntpApp.nntp.rar.Unrar:RARCloseArchive (intptr)  at
</I>&gt;<i> &gt; &gt; NntpApp.nntp.rar.Unrar.Close () [0x00000]   at
</I>&gt;<i> &gt; &gt; usenextapp.FilegroupPreview.ExtractFileFromRar (System.String path)
</I>&gt;<i> &gt; &gt; [0x00000]
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The SIGILL does not appear if I catch the exception and rethrow it in
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; finally clause
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  Exception e=null;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  try {
</I>&gt;<i> &gt; &gt;  unmanaged1();
</I>&gt;<i> &gt; &gt;  throw new Exception(&quot;test&quot;);
</I>&gt;<i> &gt; &gt;  }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  catch(Exception ex)
</I>&gt;<i> &gt; &gt;  {
</I>&gt;<i> &gt; &gt;  e= ex;
</I>&gt;<i> &gt; &gt;  }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;  finally
</I>&gt;<i> &gt; &gt;  {
</I>&gt;<i> &gt; &gt;  cleanup();
</I>&gt;<i> &gt; &gt;  if (e!=null)
</I>&gt;<i> &gt; &gt;  throw e;
</I>&gt;<i> &gt; &gt;  }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Any thoughts on that?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Christian St&#252;mpel
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt;  Mono-devel-list mailing list
</I>&gt;<i> &gt; &gt;  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt;  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027652.html">[Mono-dev] SIGILL in finally clause without catch
</A></li>
	<LI>Next message: <A HREF="027619.html">[Mono-dev] Mono on Nokia 770
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27653">[ date ]</a>
              <a href="thread.html#27653">[ thread ]</a>
              <a href="subject.html#27653">[ subject ]</a>
              <a href="author.html#27653">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
