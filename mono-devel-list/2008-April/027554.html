<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono on wine redux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20on%20wine%20redux&In-Reply-To=480738D40200004F0002103D%40lucius.provo.novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027549.html">
   <LINK REL="Next"  HREF="027561.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono on wine redux</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20on%20wine%20redux&In-Reply-To=480738D40200004F0002103D%40lucius.provo.novell.com"
       TITLE="[Mono-dev] Mono on wine redux">Miguel at novell.com
       </A><BR>
    <I>Thu Apr 17 13:47:32 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027549.html">[Mono-dev] HOW WOULD BE THE CONVERSION OF THIS CODE IN MONO	USING PINVOKE? I have problems in the structure.
</A></li>
        <LI>Next message: <A HREF="027561.html">[Mono-dev] [PATCH] Add mixed-mode assembly support on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27554">[ date ]</a>
              <a href="thread.html#27554">[ thread ]</a>
              <a href="subject.html#27554">[ subject ]</a>
              <a href="author.html#27554">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wow.

Well, that was fast.   Congrats Kornel!
 
-----Original Message-----
From: Korn&#233;l P&#225;l &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at gmail.com</A>&gt;
Cc:  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
To: Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Miguel at novell.com</A>&gt;

Sent: 4/17/2008 3:17:24 AM
Subject: Re: [Mono-dev] Mono on wine redux

Hi,

&gt;<i> From: &quot;Miguel de Icaza&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at novell.com</A>&gt;
</I>&gt;&gt;<i> But what percent of .net apps are pure?  If that fraction is small,
</I>&gt;&gt;<i> as I suspect it is, then for Mono to really rock the world, it's going
</I>&gt;&gt;<i> to have to tackle impure apps, too.  That is of course incredibly 
</I>&gt;&gt;<i> difficult,
</I>&gt;&gt;<i> and would require considerable cooperation between the Mono and Wine 
</I>&gt;&gt;<i> projects.
</I>&gt;<i>
</I>&gt;<i> It is very hard to run into a mixed-mode assembly in the wild;   They do
</I>&gt;<i> happen, but they are rare.   I can only think of three projects that had
</I>&gt;<i> needed them in the history of Mono.
</I>
I've done some work on this. And actually I managed to run mixed-mode 
assemblies.

Note that it is only possible on Windows because native code is usually 
platform (arch and OS as well) dependent.

I implemented support for loading image files using LoadLibrary so that the 
NT loader will take care of the image patching. I also had to patch the 
in-memory image of mscoree.dll so that export address table point to 
functions in mono.dll that is required for LoadLibrary support. This also 
will enable Wine (and Windows is someone is willing to replace or modify his 
on-disk mscoree.dll image) to execute managed images using CreateProcess 
without creating a mono.exe child process. This was the hardest part.

IJW thunks (managed-to-native) are really P/Invoke methods with function RVA 
stored in method body RVA so it was very easy to implement, I only had to 
remove code preventing IJW from work.

V-table fixups (native-to-managed) are not difficult either but requires 
it's own wrapper methods so my current implementation probably will need 
improvements.

Note that this still will not make Mono able to use MSVCRT because that uses 
unmanaged API of .NET Framework that isn't implemented by Mono.

I am stilll working on a cleaned-up patch but will send to the list soon.

Korn&#233;l 


</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027549.html">[Mono-dev] HOW WOULD BE THE CONVERSION OF THIS CODE IN MONO	USING PINVOKE? I have problems in the structure.
</A></li>
	<LI>Next message: <A HREF="027561.html">[Mono-dev] [PATCH] Add mixed-mode assembly support on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27554">[ date ]</a>
              <a href="thread.html#27554">[ thread ]</a>
              <a href="subject.html#27554">[ subject ]</a>
              <a href="author.html#27554">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
