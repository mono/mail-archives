<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] BackgroundWorker.CancelAsync() behaves incorrectly?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20BackgroundWorker.CancelAsync%28%29%20behaves%20incorrectly%3F&In-Reply-To=16364523.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027636.html">
   <LINK REL="Next"  HREF="027640.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] BackgroundWorker.CancelAsync() behaves incorrectly?</H1>
    <B>Achille Fouilleul</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20BackgroundWorker.CancelAsync%28%29%20behaves%20incorrectly%3F&In-Reply-To=16364523.post%40talk.nabble.com"
       TITLE="[Mono-dev] BackgroundWorker.CancelAsync() behaves incorrectly?">achille.fouilleul at gambro.com
       </A><BR>
    <I>Thu Apr 24 05:46:45 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027636.html">[Mono-dev] socket read timeout
</A></li>
        <LI>Next message: <A HREF="027640.html">[Mono-dev] [PATCH] Add mixed-mode assembly support on Windows	(now build with cygwin as well)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27677">[ date ]</a>
              <a href="thread.html#27677">[ thread ]</a>
              <a href="subject.html#27677">[ subject ]</a>
              <a href="author.html#27677">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Jordan Callicoat wrote:
&gt;<i> 
</I>&gt;<i> I guess nobody is using BackgroundWorker in mono then?
</I>&gt;<i> 
</I>
I am. Anyway, this is not the only problem with it.

Please have a look at the code below:
<A HREF="http://anonsvn.mono-project.com/source/trunk/mcs/class/System/System.ComponentModel/BackgroundWorker.cs">http://anonsvn.mono-project.com/source/trunk/mcs/class/System/System.ComponentModel/BackgroundWorker.cs</A>

In the CompleteWorker method, &quot;this.async&quot; is assigned to null _after_  this
statement:

async.PostOperationCompleted (callback, e);

Therefore, OnRunWorkerCompleted may be (always in my case) executed
_before_, and will see IsBusy as True whereas it should be False.

The test case below prints True on .NET and False on Mono.
Reversing the order of those two statements seems to fix the issue.

<A HREF="http://www.nabble.com/file/p16848603/bgw.cs">http://www.nabble.com/file/p16848603/bgw.cs</A> bgw.cs 
-- 
View this message in context: <A HREF="http://www.nabble.com/BackgroundWorker.CancelAsync%28%29-behaves-incorrectly--tp16216320p16848603.html">http://www.nabble.com/BackgroundWorker.CancelAsync%28%29-behaves-incorrectly--tp16216320p16848603.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027636.html">[Mono-dev] socket read timeout
</A></li>
	<LI>Next message: <A HREF="027640.html">[Mono-dev] [PATCH] Add mixed-mode assembly support on Windows	(now build with cygwin as well)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27677">[ date ]</a>
              <a href="thread.html#27677">[ thread ]</a>
              <a href="subject.html#27677">[ subject ]</a>
              <a href="author.html#27677">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
