<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] possible bug in static constructor evaluation order
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20possible%20bug%20in%20static%20constructor%20evaluation%20order&In-Reply-To=25400-42365%40sneakemail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000636.html">
   <LINK REL="Next"  HREF="000642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] possible bug in static constructor evaluation order</H1>
    <B>Michal Moskal</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20possible%20bug%20in%20static%20constructor%20evaluation%20order&In-Reply-To=25400-42365%40sneakemail.com"
       TITLE="[Mono-devel-list] possible bug in static constructor evaluation order">malekith at pld-linux.org
       </A><BR>
    <I>Sun May  4 17:29:31 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000636.html">[Mono-devel-list] possible bug in static constructor  evaluation order
</A></li>
        <LI>Next message: <A HREF="000642.html">[Mono-devel-list] possible bug in static constructor  evaluation order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#638">[ date ]</a>
              <a href="thread.html#638">[ thread ]</a>
              <a href="subject.html#638">[ subject ]</a>
              <a href="author.html#638">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, May 04, 2003 at 03:20:09PM -0500, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">2a5gjx302 at sneakemail.com</A> wrote:
&gt;<i> My C# specification (the 'C# Language Specification.doc' file 
</I>&gt;<i> distributed with VS.NET) does not have a section 17.11. The entire 
</I>&gt;<i> section 17 is about attributes. 
</I>
Hmm, I should have given a link:
<A HREF="http://www.jaggersoft.com/csharp_standard/17.11.htm">http://www.jaggersoft.com/csharp_standard/17.11.htm</A>

&gt;<i> I should point out that, as far as I understand it, this is no bug. The 
</I>&gt;<i> specification does not state precisely when static construction occurs, 
</I>&gt;<i> only that it must occur prior to any use of the class. 
</I>&gt;<i>
</I>&gt;<i> My specification states these things: 
</I>&gt;<i> - A static constructor for a type is run at most once per application 
</I>&gt;<i> domain. 
</I>&gt;<i> - Static variables come into existence at some undetermined time prior 
</I>&gt;<i> to the execution of the static constructor. 
</I>&gt;<i> - The static field variable initializers of a class correspond to a 
</I>&gt;<i> sequence of assignments that are executed at an 
</I>&gt;<i> implementation-dependent time prior to the static constructor of the 
</I>&gt;<i> class (if any) and prior to the first use of a static field of that 
</I>&gt;<i> class.
</I>
Ok, modulo ^^^^:

  If a class contains any static fields with initializers, those
  initializers are executed in textual order immediately prior to
                               ^^^^^^^^^^^^^
  executing the static constructor.
  

&gt;<i> ..and most importantly: 
</I>&gt;<i> 
</I>&gt;<i> The exact timing of static constructor execution is 
</I>&gt;<i> implementation-dependent, but is subject to the following rules: 
</I>&gt;<i> - The static constructor for a class executes before any instance of 
</I>&gt;<i> the class is created. 
</I>&gt;<i> - The static constructor for a class executes before any of the static 
</I>&gt;<i> members for the class are referenced. 
</I>&gt;<i> - The static constructor for a class executes after the static field 
</I>&gt;<i> initializers (if any) for the class. 
</I>&gt;<i> - The static constructor for a class executes at most one time during a 
</I>&gt;<i> single program instantiation.
</I>
Consider Example in <A HREF="http://www.jaggersoft.com/csharp_standard/17.11.htm.">http://www.jaggersoft.com/csharp_standard/17.11.htm.</A>
It *must* produce output:

Init A  
A.F  
Init B  
B.F  

But according to what you wrote, it could be also:

Init A
Init B
A.F
B.F

or:

Init B
Init A
A.F
B.F

This is where I took impression that static constructors are executed
just before first access to class.

Also Paragraph 6 states:

(1) The static constructor for a class executes at most once in a given
application domain. (2) The execution of a static constructor is triggered
by the first of the following events to occur within an application
domain:

    * (3) An instance of the class is created.
    * (4) Any of the static members of the class are referenced. 

I would interpret 'A is triggered by B' as: A occurs just before B.

Ah, and what do I need it for. I want to formally define some aspects of
class loading using operational semantics, so I need precise rules.

-- 
:<i> Michal Moskal :: <A HREF="http://www.kernel.pl/~malekith">http://www.kernel.pl/~malekith</A> : GCS {C,UL}++++$ a? !tv
</I>:<i> PLD Linux ::::::::: Wroclaw University, CS Dept : {E-,w}-- {b++,e}&gt;+++ h
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000636.html">[Mono-devel-list] possible bug in static constructor  evaluation order
</A></li>
	<LI>Next message: <A HREF="000642.html">[Mono-devel-list] possible bug in static constructor  evaluation order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#638">[ date ]</a>
              <a href="thread.html#638">[ thread ]</a>
              <a href="subject.html#638">[ subject ]</a>
              <a href="author.html#638">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
