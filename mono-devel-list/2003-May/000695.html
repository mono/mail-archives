<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Problems with the new jit and proxies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Problems%20with%20the%20new%20jit%20and%20proxies&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000694.html">
   <LINK REL="Next"  HREF="000698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Problems with the new jit and proxies</H1>
    <B>Lluis Sanchez</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Problems%20with%20the%20new%20jit%20and%20proxies&In-Reply-To="
       TITLE="[Mono-devel-list] Problems with the new jit and proxies">lluis at ideary.com
       </A><BR>
    <I>Thu May  8 19:49:22 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000694.html">[Mono-devel-list] FW: xslt.dll missing and version question...
</A></li>
        <LI>Next message: <A HREF="000698.html">[Mono-devel-list] Problems with the new jit and proxies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#695">[ date ]</a>
              <a href="thread.html#695">[ thread ]</a>
              <a href="subject.html#695">[ subject ]</a>
              <a href="author.html#695">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've been tracking down a couple of problems that mini has with transparent
proxies:

1) It crashes when creating a proxy based on an interface. This is because
the method mono_jit_create_remoting_trampoline in mini.c checks if the
provided method is from a marshalbyref or object class. If it is not, it
does not create the remoting trampoline. Since the method is from an
interface, the trampoline is not created and it fails. If I remove the check
it works. In the old jit this check wasn't there, but I guess there is a
good reason for it.

2) When creating a remote object using new, the constructor call does not go
through the proxy. The runtime makes a direct call to the object (which does
not exist, because it is a proxy) and crashes. It is because the method
mono_emit_method_call_spilled for generating the constructor call in the
CEE_NEWOBJ case is invoked with a NULL value in the &quot;this&quot; parameter:

mono_emit_method_call_spilled (cfg, bblock, cmethod, sp, ip, NULL);

Later, mono_emit_method_call should create a remoting wrapper for the
method, but it doesn't do it because &quot;this&quot; is null. Changing NULL to sp[0]
makes it work, but it is just a &quot;guessed&quot; solution :-)

There are other weird problems that I'm still trying to isolate.

- Lluis


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000694.html">[Mono-devel-list] FW: xslt.dll missing and version question...
</A></li>
	<LI>Next message: <A HREF="000698.html">[Mono-devel-list] Problems with the new jit and proxies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#695">[ date ]</a>
              <a href="thread.html#695">[ thread ]</a>
              <a href="subject.html#695">[ subject ]</a>
              <a href="author.html#695">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
