<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] possible bug in static constructor  evaluation order
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20possible%20bug%20in%20static%20constructor%0A%20%20evaluation%20order&In-Reply-To=20030504212646.GA30167%40roke.freak">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000638.html">
   <LINK REL="Next"  HREF="000646.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] possible bug in static constructor  evaluation order</H1>
    <B>2a5gjx302 at sneakemail.com</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20possible%20bug%20in%20static%20constructor%0A%20%20evaluation%20order&In-Reply-To=20030504212646.GA30167%40roke.freak"
       TITLE="[Mono-devel-list] possible bug in static constructor  evaluation order">2a5gjx302 at sneakemail.com
       </A><BR>
    <I>Sun May  4 23:07:44 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000638.html">[Mono-devel-list] possible bug in static constructor evaluation order
</A></li>
        <LI>Next message: <A HREF="000646.html">[Mono-devel-list] possible bug in static constructor evaluation order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#642">[ date ]</a>
              <a href="thread.html#642">[ thread ]</a>
              <a href="subject.html#642">[ subject ]</a>
              <a href="author.html#642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 11:29 PM 04/05/2003 +0200, you wrote:
[snip]
&gt;<i>Also Paragraph 6 states:
</I>&gt;<i>
</I>&gt;<i>(1) The static constructor for a class executes at most once in a given
</I>&gt;<i>application domain. (2) The execution of a static constructor is triggered
</I>&gt;<i>by the first of the following events to occur within an application
</I>&gt;<i>domain:
</I>&gt;<i>
</I>&gt;<i>    * (3) An instance of the class is created.
</I>&gt;<i>    * (4) Any of the static members of the class are referenced. 
</I>&gt;<i>
</I>&gt;<i>I would interpret 'A is triggered by B' as: A occurs just before B.
</I>I should point out that this does not mean that there aren't any other
possible implementation-dependent triggers. Also, if people rely on the
ECMA spec, then their code may not run as expected when/if compiled with
Microsoft's compiler. While of course this just means that the Microsoft
compiler does not follow the final spec (not surprising, as it was created
before the final spec), the Microsoft compiler did come first and should be
authoritative reference (aside from bugs), rather than the specification,
which does not match it. The current specification as worded, the way you
interpret it, requires that compilers emit complex locking code and check
on every method call to see if the class has been statically initialized
yet (the locking isn't complex from the point of view of the code to
implement it, but it is definitely a performance concern). The current
specification does not prevent compilers or interpreters from statically
initializing classes when they are loaded, it simply does not specify or
recommend in either way.

On a personal/opiniated note, I can't imagine why they would add this, as
well as the textual order thing you mentioned earlier, to the
specification. For instance, file specification order would be preferable
for static field initializers as it would allow people to depend on the
values for earlier initializers in subsequent initializers in an
easy-to-follow order in the file. Oh well, just my two cents.

&gt;<i>Ah, and what do I need it for. I want to formally define some aspects of
</I>&gt;<i>class loading using operational semantics, so I need precise rules.
</I>&gt;<i>
</I>&gt;<i>-- 
</I>&gt;:<i> Michal Moskal :: <A HREF="http://www.kernel.pl/~malekith">http://www.kernel.pl/~malekith</A> : GCS {C,UL}++++$ a? !tv
</I>&gt;:<i> PLD Linux ::::::::: Wroclaw University, CS Dept : {E-,w}-- {b++,e}&gt;+++ h
</I>
Jonathan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000638.html">[Mono-devel-list] possible bug in static constructor evaluation order
</A></li>
	<LI>Next message: <A HREF="000646.html">[Mono-devel-list] possible bug in static constructor evaluation order
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#642">[ date ]</a>
              <a href="thread.html#642">[ thread ]</a>
              <a href="subject.html#642">[ subject ]</a>
              <a href="author.html#642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
