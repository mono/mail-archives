<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] OracleClient.Oci and GC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20OracleClient.Oci%20and%20GC&In-Reply-To=%3CCACmR%2BBDOQp1myaPYXK_HuVRZNp5c-ZRwkim7K-h2AS86hFBYng%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041864.html">
   <LINK REL="Next"  HREF="041866.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] OracleClient.Oci and GC</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20OracleClient.Oci%20and%20GC&In-Reply-To=%3CCACmR%2BBDOQp1myaPYXK_HuVRZNp5c-ZRwkim7K-h2AS86hFBYng%40mail.gmail.com%3E"
       TITLE="[Mono-dev] OracleClient.Oci and GC">kumpera at gmail.com
       </A><BR>
    <I>Fri Aug 22 15:31:47 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041864.html">[Mono-dev] OracleClient.Oci and GC
</A></li>
        <LI>Next message: <A HREF="041866.html">[Mono-dev] OracleClient.Oci and GC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41865">[ date ]</a>
              <a href="thread.html#41865">[ thread ]</a>
              <a href="subject.html#41865">[ subject ]</a>
              <a href="author.html#41865">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Neale,

You can safely pass interior pointers to pinvoke without fearing the object
been collected for the duration of the call.
Mind that you have to correctly use specify in/out/ref depending on the
copy semantics you need.

Problems only arise when native keeps that pointer after the call finishes,
this can result in the object been moved
as the GC has no visibility into the native heap.

For those cases you can either create a pinning GC handle to the victim
object or you can allocate a chunk of native
memory that will be shared between managed and native to store the desired
value. Both options suck, TBH.

I'd say go with the native chunk of code if you can't lexically scope the
pinning regions, it will be more reliable as
failing to dispose the object won't lead to permanent leaks.











On Fri, Aug 22, 2014 at 11:11 AM, Neale Ferguson &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">NealeFerguson at verizon.net</A>&gt;
wrote:

&gt;<i> Is that just a comment on my ref IntPtr question or the use of ref with
</I>&gt;<i> the OCIxxxx stuff in general?
</I>&gt;<i>
</I>&gt;<i> On Aug 22, 2014, at 10:45 AM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Mono does conservative scanning of the native stack, so once the pointer
</I>&gt;<i> has crossed over to native, the containing object will remain pinned.
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140822/c8bfd7da/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140822/c8bfd7da/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041864.html">[Mono-dev] OracleClient.Oci and GC
</A></li>
	<LI>Next message: <A HREF="041866.html">[Mono-dev] OracleClient.Oci and GC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41865">[ date ]</a>
              <a href="thread.html#41865">[ thread ]</a>
              <a href="subject.html#41865">[ subject ]</a>
              <a href="author.html#41865">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
