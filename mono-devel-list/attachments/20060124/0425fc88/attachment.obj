Index: ObjectStateFormatter.cs
===================================================================
--- ObjectStateFormatter.cs	(revision 55787)
+++ ObjectStateFormatter.cs	(working copy)
@@ -662,25 +662,26 @@
 				Color c = (Color) o;
 				
 				if (!c.IsKnownColor) {
-					w.Write (PrimaryId);
-					w.Write(c.IsEmpty);
-					if (!c.IsEmpty)
+					if (c.IsEmpty)
+						w.Write (TertiaryId);
+					else {
+						w.Write (PrimaryId);
 						w.Write (c.ToArgb ());
+					}
 				} else {
 					w.Write (SecondaryId);
-					w.Write(c.IsEmpty);
-					if (!c.IsEmpty)
-						w.Write ((int) c.ToKnownColor ());
+					w.Write ((int) c.ToKnownColor ());
 				}
 			}
 			
 			protected override object Read (byte token, BinaryReader r, ReaderContext ctx)
 			{
-				bool isEmpty = r.ReadBoolean();
 				if (token == PrimaryId)
-					return isEmpty ? Color.Empty : Color.FromArgb (r.ReadInt32 ());
+					return Color.FromArgb (r.ReadInt32 ());
+				else if (token == SecondaryId)
+					return Color.FromKnownColor ((KnownColor) r.ReadInt32 ());
 				else
-					return isEmpty ? Color.Empty : Color.FromKnownColor ((KnownColor) r.ReadInt32 ());
+					return Color.Empty;
 			}
 			
 			protected override Type Type {
@@ -688,7 +689,7 @@
 			}
 			
 			protected override int NumberOfIds {
-				get { return 2; }
+				get { return 3; }
 			}
 		}
 		
