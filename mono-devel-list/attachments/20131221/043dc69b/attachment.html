<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;anything&nbsp;simular&nbsp;to&nbsp;MEM_RESERVE&nbsp;and&nbsp;MEM_COMMIT&nbsp;from&nbsp;Windows&nbsp;(flags&nbsp;for&nbsp;VirtualAlloc/VirtualAllocEx),&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;to&nbsp;properly&nbsp;reserve&nbsp;a&nbsp;large&nbsp;block&nbsp;of&nbsp;virtual&nbsp;address&nbsp;space.&nbsp;BTW,&nbsp;windows&nbsp;threads&nbsp;reserve&nbsp;a&nbsp;lot&nbsp;of&nbsp;address&nbsp;space&nbsp;using&nbsp;MEM_RESERVE&nbsp;and&nbsp;then&nbsp;use&nbsp;SEH/VEH&nbsp;to&nbsp;detect,&nbsp;when&nbsp;memory&nbsp;should&nbsp;be&nbsp;commited,&nbsp;so&nbsp;it&nbsp;uses&nbsp;the&nbsp;same&nbsp;&quot;overcommit&quot;&nbsp;mechanics.&nbsp;You&nbsp;can&nbsp;create&nbsp;a&nbsp;lot&nbsp;of&nbsp;threads&nbsp;with&nbsp;large&nbsp;stacks,&nbsp;try&nbsp;to&nbsp;use&nbsp;it&nbsp;and&nbsp;get&nbsp;out&nbsp;of&nbsp;memory&nbsp;exception&nbsp;when,&nbsp;actually,&nbsp;trying&nbsp;to&nbsp;push&nbsp;something&nbsp;on&nbsp;your&nbsp;stack.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2013/12/21&nbsp;james&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:james@mansionfamily.plus.com&quot;&nbsp;target=&quot;_blank&quot;&gt;james@mansionfamily.plus.com&lt;/a&gt;&gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;20/12/2013&nbsp;09:27,&nbsp;Marek&nbsp;Habersack&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Unix&nbsp;systems&nbsp;work&nbsp;based&nbsp;on&nbsp;a&nbsp;bit&nbsp;different&nbsp;principle&nbsp;than&nbsp;the&nbsp;Windows&nbsp;ones.&nbsp;Namely,&nbsp;as&nbsp;Nikita&nbsp;mentions&nbsp;in&nbsp;his&nbsp;other&nbsp;mail,&nbsp;the&nbsp;virtual&nbsp;memory&nbsp;is&nbsp;nearly&nbsp;free&nbsp;of&nbsp;any&nbsp;limits&nbsp;-&nbsp;your&nbsp;process&nbsp;reserves&nbsp;the&nbsp;right&nbsp;to&nbsp;use&nbsp;that&nbsp;much&nbsp;memory,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;actually&nbsp;use&nbsp;(&quot;commit&quot;)&nbsp;it&nbsp;physically.&nbsp;The&nbsp;virtual&nbsp;memory&nbsp;reservation&nbsp;is&nbsp;merely&nbsp;a&nbsp;hint&nbsp;of&nbsp;what&nbsp;can&nbsp;be&nbsp;consumed&nbsp;by&nbsp;the&nbsp;program,&nbsp;should&nbsp;it&nbsp;need&nbsp;it.&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
I&nbsp;really&nbsp;think&nbsp;this&nbsp;ought&nbsp;to&nbsp;be&nbsp;challenged.&nbsp; No&nbsp;least&nbsp;because&nbsp;I&nbsp;recently&nbsp;ran&nbsp;into&nbsp;an&nbsp;issue&nbsp;on&nbsp;some&nbsp;production&nbsp;RedHat&nbsp;servers&nbsp;which&nbsp;had&nbsp;memory_overcommit&nbsp;set&nbsp;to&nbsp;&#39;2&#39;.&lt;br&gt;<br>
&lt;br&gt;<br>
Historically,&nbsp;UNIX&nbsp;systems&nbsp;DID&nbsp;behave&nbsp;like&nbsp;Windows.&nbsp; And&nbsp;some&nbsp;of&nbsp;them&nbsp;still&nbsp;do.&nbsp; They&nbsp;require&nbsp;that&nbsp;a&nbsp;request&nbsp;for&nbsp;VM&nbsp;can&nbsp;be&nbsp;satisfied&nbsp;from&nbsp;the&nbsp;free&nbsp;physical+virtual&nbsp;memory.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;default&nbsp;is&nbsp;now&nbsp;to&nbsp;allow&nbsp;lazy&nbsp;programming&nbsp;that&nbsp;treats&nbsp;virtual&nbsp;address&nbsp;space&nbsp;as&nbsp;free,&nbsp;as&nbsp;you&nbsp;note&nbsp;-&nbsp;but&nbsp;the&nbsp;flip&nbsp;side&nbsp;is&nbsp;that&nbsp;programs&nbsp;can&nbsp;ask&nbsp;the&nbsp;OS&nbsp;for&nbsp;memory,&nbsp;be&nbsp;given&nbsp;it&nbsp;without&nbsp;error,&nbsp;and&nbsp;then&nbsp;find&nbsp;that&nbsp;they&nbsp;are&nbsp;summarily&nbsp;terminated&nbsp;if&nbsp;they&nbsp;try&nbsp;to&nbsp;use&nbsp;it.&nbsp;Or&nbsp;that&nbsp;some&nbsp;other&nbsp;process&nbsp;is&nbsp;summarily&nbsp;terminated.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
This&nbsp;mechanism&nbsp;came&nbsp;about&nbsp;in&nbsp;AIX&nbsp;first&nbsp;I&nbsp;believe,&nbsp;an&nbsp;Linux&nbsp;copied&nbsp;it.&nbsp; Solaris&nbsp;held&nbsp;out&nbsp;for&nbsp;a&nbsp;long&nbsp;time&nbsp;with&nbsp;&#39;proper&#39;&nbsp;behaviour,&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;whether&nbsp;it&nbsp;allows&nbsp;overcommit&nbsp;now.&lt;br&gt;<br>
&lt;br&gt;<br>
Whether&nbsp;or&nbsp;not&nbsp;you&nbsp;think&nbsp;allowing&nbsp;overcommit&nbsp;is&nbsp;a&nbsp;good&nbsp;idea&nbsp;is&nbsp;very&nbsp;much&nbsp;dependent&nbsp;on&nbsp;whether&nbsp;you&nbsp;think&nbsp;a&nbsp;good&nbsp;return&nbsp;from&nbsp;malloc&nbsp;should&nbsp;allow&nbsp;you&nbsp;to&nbsp;use&nbsp;the&nbsp;memory&nbsp;you&nbsp;just&nbsp;asked&nbsp;for.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;fairness,&nbsp;the&nbsp;problem&nbsp;is&nbsp;typically&nbsp;worst&nbsp;in&nbsp;multi-threaded&nbsp;programs&nbsp;that&nbsp;can&#39;t&nbsp;handle&nbsp;segmented&nbsp;thread&nbsp;stacks&nbsp;-&nbsp;they&nbsp;have&nbsp;to&nbsp;reserve&nbsp;enough&nbsp;space&nbsp;for&nbsp;reasonable&nbsp;levels&nbsp;of&nbsp;stack&nbsp;depth&nbsp;and&nbsp;stack-local&nbsp;data&nbsp;so&nbsp;they&nbsp;have&nbsp;to&nbsp;reserve&nbsp;VM&nbsp;space&nbsp;to&nbsp;ensure&nbsp;that&nbsp;malloc&nbsp;doesn&#39;t&nbsp;place&nbsp;another&nbsp;block&nbsp;after&nbsp;the&nbsp;heap&nbsp;that&#39;s&nbsp;actually&nbsp;in&nbsp;use.&nbsp; Laziness&nbsp;is&nbsp;actually&nbsp;allocating&nbsp;the&nbsp;space&nbsp;and&nbsp;relying&nbsp;on&nbsp;the&nbsp;OS&nbsp;to&nbsp;allow&nbsp;overcommit&nbsp;and&nbsp;not&nbsp;actually&nbsp;back&nbsp;such&nbsp;memory&nbsp;until&nbsp;needed,&nbsp;rather&nbsp;than&nbsp;just&nbsp;reserving&nbsp;a&nbsp;VM&nbsp;range&nbsp;and&nbsp;allocating&nbsp;on&nbsp;fault.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
The&nbsp;prod&nbsp;servers&nbsp;I&nbsp;had&nbsp;showed&nbsp;no&nbsp;use&nbsp;of&nbsp;swap,&nbsp;about&nbsp;6gig&nbsp;out&nbsp;of&nbsp;32&nbsp;physical&nbsp;in&nbsp;use&nbsp;(with&nbsp;the&nbsp;rest&nbsp;as&nbsp;buffers)&nbsp;-&nbsp;and&nbsp;thread&nbsp;starts&nbsp;and&nbsp;allocs&nbsp;were&nbsp;failing.&nbsp; Needless&nbsp;to&nbsp;say&nbsp;all&nbsp;the&nbsp;machines&nbsp;we&#39;d&nbsp;used&nbsp;for&nbsp;dev,&nbsp;qa,&nbsp;and&nbsp;load&nbsp;testing&nbsp;had&nbsp;overcommit&nbsp;0&nbsp;and&nbsp;we&nbsp;got&nbsp;mugged&nbsp;as&nbsp;a&nbsp;result.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
