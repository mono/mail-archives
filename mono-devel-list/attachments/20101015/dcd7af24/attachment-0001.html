<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&nbsp;http-equiv=Content-Type&gt;<br>
&lt;META&nbsp;name=GENERATOR&nbsp;content=&quot;MSHTML&nbsp;8.00.7600.16671&quot;&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;The&nbsp;SystemResPool&nbsp;<br>
class&nbsp;(in&nbsp;Theme.cs)&nbsp;is&nbsp;quite&nbsp;heavily&nbsp;used&nbsp;across&nbsp;managed&nbsp;windows&nbsp;forms.&nbsp;Yet,&nbsp;it&nbsp;<br>
still&nbsp;use&nbsp;the&nbsp;old&nbsp;Hashtable&nbsp;(instead&nbsp;of&nbsp;Dictionary)&nbsp;and&nbsp;mainly&nbsp;some&nbsp;of&nbsp;its&nbsp;<br>
internal&nbsp;caching&nbsp;dictionary&nbsp;uses&nbsp;strings&nbsp;as&nbsp;key&nbsp;(ex:&nbsp;to&nbsp;get&nbsp;the&nbsp;cached&nbsp;pen&nbsp;for&nbsp;a&nbsp;<br>
given&nbsp;color,&nbsp;it&nbsp;converts&nbsp;the&nbsp;color&nbsp;to&nbsp;a&nbsp;string&nbsp;rather&nbsp;than&nbsp;using&nbsp;its&nbsp;Argb&nbsp;as&nbsp;a&nbsp;<br>
key).&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;Here&amp;nbsp;is&nbsp;the&nbsp;<br>
modified&nbsp;code&nbsp;(sorry,&nbsp;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;I'm&nbsp;<br>
sending&nbsp;this&nbsp;code&nbsp;on&nbsp;the&nbsp;fly&nbsp;as&nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;I'm&nbsp;not&nbsp;on&nbsp;a&nbsp;computer&nbsp;right&nbsp;now,&nbsp;<br>
and&nbsp;so&nbsp;has&nbsp;no&nbsp;access&nbsp;to&nbsp;any&nbsp;diff&nbsp;program&nbsp;nor&nbsp;can&nbsp;run&nbsp;the&nbsp;Mono's&nbsp;unit&nbsp;<br>
tests).&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;Note&nbsp;also&nbsp;that&nbsp;the&nbsp;<br>
CPColor&nbsp;(in&nbsp;Theme.cs)&nbsp;used&nbsp;as&nbsp;key&nbsp;of&nbsp;a&nbsp;dictionary/hashtable&nbsp;in&nbsp;SystemResPool,&nbsp;<br>
should&nbsp;have&nbsp;its&nbsp;Equals&nbsp;and&nbsp;GetHashCode&nbsp;overloaded,&nbsp;for&nbsp;better&nbsp;performance&nbsp;(if&nbsp;<br>
not,&nbsp;the&nbsp;methods&nbsp;of&nbsp;the&nbsp;ValueType&nbsp;class&nbsp;are&nbsp;used,&nbsp;which&nbsp;use&nbsp;<br>
reflection).&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;Cheers,&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;Lionel&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;&amp;nbsp;internal&nbsp;class&nbsp;<br>
SystemResPool&lt;BR&gt;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;private&nbsp;Dictionary&amp;lt;int,&nbsp;Pen&amp;gt;&nbsp;pens&nbsp;<br>
=&nbsp;new&nbsp;Dictionary&amp;lt;int,&nbsp;Pen&amp;gt;();&lt;BR&gt;&amp;nbsp;&amp;nbsp;private&nbsp;Dictionary&amp;lt;long,&nbsp;<br>
Pen&amp;gt;&nbsp;dashpens&nbsp;=&nbsp;new&nbsp;Dictionary&amp;lt;long,&nbsp;Pen&amp;gt;();&lt;BR&gt;&amp;nbsp;&amp;nbsp;private&nbsp;<br>
Dictionary&amp;lt;long,&nbsp;Pen&amp;gt;&nbsp;sizedpens&nbsp;=&nbsp;new&nbsp;Dictionary&amp;lt;long,&nbsp;<br>
Pen&amp;gt;();&lt;BR&gt;&amp;nbsp;&amp;nbsp;private&nbsp;Dictionary&amp;lt;int,&nbsp;SolidBrush&amp;gt;&nbsp;solidbrushes&nbsp;<br>
=&nbsp;new&nbsp;Dictionary&amp;lt;int,&nbsp;<br>
SolidBrush&amp;gt;();&lt;BR&gt;&amp;nbsp;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;[...]&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;public&nbsp;<br>
Pen&nbsp;GetPen(Color&nbsp;color)&lt;BR&gt;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;int&nbsp;hash&nbsp;=&nbsp;<br>
color.ToArgb();&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;lock&nbsp;<br>
(pens)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pen&nbsp;<br>
res;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&nbsp;(pens.TryGetValue(hash,&nbsp;out&nbsp;<br>
res))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;res;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pen&nbsp;pen&nbsp;=&nbsp;new&nbsp;<br>
Pen(color);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;pens.Add(hash,&nbsp;<br>
pen);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
pen;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;}&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;public&nbsp;<br>
Pen&nbsp;GetDashPen(Color&nbsp;color,&nbsp;DashStyle&nbsp;<br>
dashStyle)&lt;BR&gt;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;//string&nbsp;hash&nbsp;=&nbsp;<br>
color.ToString()&nbsp;+&nbsp;dashStyle;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;long&nbsp;hash&nbsp;=&nbsp;color.ToArgb()&nbsp;<br>
&amp;lt;&amp;lt;&nbsp;32&nbsp;+&nbsp;(int)dashStyle;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;lock&nbsp;<br>
(dashpens)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pen&nbsp;<br>
res;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&nbsp;(dashpens.TryGetValue(hash,&nbsp;out&nbsp;<br>
res))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;res;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pen&nbsp;pen&nbsp;=&nbsp;new&nbsp;<br>
Pen(color);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;pen.DashStyle&nbsp;=&nbsp;<br>
dashStyle;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;dashpens[hash]&nbsp;=&nbsp;<br>
pen;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
pen;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;}&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;public&nbsp;<br>
Pen&nbsp;GetSizedPen(Color&nbsp;color,&nbsp;int&nbsp;<br>
size)&lt;BR&gt;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;//string&nbsp;hash&nbsp;=&nbsp;color.ToString()&nbsp;+&nbsp;<br>
size;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;long&nbsp;hash&nbsp;=&nbsp;color.ToArgb()&nbsp;&amp;lt;&amp;lt;&nbsp;32&nbsp;+&nbsp;<br>
size;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;lock&nbsp;<br>
(sizedpens)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pen&nbsp;<br>
res;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&nbsp;(sizedpens.TryGetValue(hash,&nbsp;out&nbsp;<br>
res))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;res;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pen&nbsp;pen&nbsp;=&nbsp;new&nbsp;Pen(color,&nbsp;<br>
size);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sizedpens[hash]&nbsp;=&nbsp;<br>
pen;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
pen;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;}&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;public&nbsp;<br>
SolidBrush&nbsp;GetSolidBrush(Color&nbsp;color)&lt;BR&gt;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;int&nbsp;<br>
hash&nbsp;=&nbsp;color.ToArgb();&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;lock&nbsp;<br>
(solidbrushes)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SolidBrush&nbsp;<br>
res;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&nbsp;(solidbrushes.TryGetValue(hash,&nbsp;out&nbsp;<br>
res))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;res;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SolidBrush&nbsp;brush&nbsp;=&nbsp;new&nbsp;<br>
SolidBrush(color);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;solidbrushes.Add(hash,&nbsp;<br>
brush);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
brush;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;}&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Arial&gt;&lt;SPAN&nbsp;<br>
class=802020914-15102010&gt;&amp;nbsp;&amp;nbsp;[...]&lt;BR&gt;&amp;nbsp;&amp;nbsp;&lt;BR&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
