Index: ChangeLog
===================================================================
--- ChangeLog	(revision 88376)
+++ ChangeLog	(working copy)
@@ -1,3 +1,9 @@
+2007-10-30 Arina Itkes <arinai@mainsoft.com>
+
+	* SmtpClient.cs: Fix of SmtpClient.Read() method:
+	Added check of string position before calling 
+	Substring and IndexOf methods of string.
+
 2007-10-23  Atsushi Enomoto  <atsushi@ximian.com>
 
 	* SmtpClient.cs : small async refactory.
Index: SmtpClient.cs
===================================================================
--- SmtpClient.cs	(revision 88376)
+++ SmtpClient.cs	(working copy)
@@ -370,7 +370,7 @@
 				if (ln != 0)
 					ln++;
 				
-				if (ln > extens.Length)
+				if (ln + 4 >= extens.Length)
 					break;
 				
 				if (extens.Substring (ln, 4) == "AUTH" &&
@@ -403,10 +403,10 @@
 							break;
 						}
 					}
-				} else if (extens.Substring (ln, 8) == "STARTTLS") {
+				} else if (ln + 8 < extens.Length && extens.Substring (ln, 8) == "STARTTLS") {
 					canStartTLS = true;
 				}
-			} while ((ln = extens.IndexOf ('\n', ln)) != -1);
+			} while (ln < extens.Length && ((ln = extens.IndexOf ('\n', ln)) != -1));
 		}
 
 		public void Send (MailMessage message)
