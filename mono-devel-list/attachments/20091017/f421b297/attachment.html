<tt>
Your&nbsp;code&nbsp;does&nbsp;a&nbsp;lot&nbsp;of&nbsp;things&nbsp;in&nbsp;a&nbsp;non&nbsp;optimal&nbsp;way.&lt;br&gt;First,&nbsp;due&nbsp;to&nbsp;the&nbsp;calling&nbsp;convention&nbsp;mono&nbsp;uses,&nbsp;having&nbsp;a&nbsp;method&nbsp;call&nbsp;in&nbsp;between&nbsp;Simd&nbsp;code&lt;br&gt;causes&nbsp;all&nbsp;simd&nbsp;variables&nbsp;to&nbsp;be&nbsp;spill&nbsp;on&nbsp;stack.&nbsp;This&nbsp;causes&nbsp;passing&nbsp;a&nbsp;Vecto4f&nbsp;do&nbsp;be&nbsp;2x&nbsp;slower&nbsp;than&lt;br&gt;<br>
passing&nbsp;a&nbsp;double&nbsp;since&nbsp;16&nbsp;bytes&nbsp;have&nbsp;to&nbsp;be&nbsp;pushed&nbsp;to&nbsp;the&nbsp;stack.&lt;br&gt;&lt;br&gt;A&nbsp;few&nbsp;more&nbsp;comments&nbsp;inline.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Oct&nbsp;1,&nbsp;2009&nbsp;at&nbsp;12:23&nbsp;PM,&nbsp;jetthink&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jetthink@gmail.com&quot;&gt;jetthink@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;br&gt;<br>
Hi,&lt;br&gt;<br>
&nbsp; I&nbsp;have&nbsp;converted&nbsp;exp_ps(from&nbsp;&lt;a&nbsp;href=&quot;http://gruntthepeon.free.fr/ssemath/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://gruntthepeon.free.fr/ssemath/&lt;/a&gt;)&nbsp;to&lt;br&gt;<br>
Mono.&lt;br&gt;<br>
using&nbsp;System;&lt;br&gt;<br>
using&nbsp;Mono.Simd;&lt;br&gt;<br>
&lt;br&gt;<br>
public&nbsp;static&nbsp;class&nbsp;Myext{&lt;br&gt;<br>
&nbsp; &nbsp; public&nbsp;static&nbsp;unsafe&nbsp;Vector4i&nbsp;LogicalLeftShift(this&nbsp;Vector4i&nbsp;v1,&nbsp;int&lt;br&gt;<br>
amount)&lt;br&gt;<br>
&nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Vector4i&nbsp;res&nbsp;=&nbsp;new&nbsp;Vector4i();&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; int*&nbsp;a&nbsp;=&nbsp;(int*)&amp;amp;v1;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; int*&nbsp;b&nbsp;=(int*)&amp;amp;res;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;4;&nbsp;++i)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *b++&nbsp;=&nbsp;(int)((uint)(*a++)&nbsp;&amp;lt;&amp;lt;&nbsp;amount);&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;res;&lt;br&gt;<br>
&nbsp; &nbsp; }&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;There&nbsp;are&nbsp;2&nbsp;issues&nbsp;here,&nbsp;first,&nbsp;by&nbsp;taking&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;variable&nbsp;you&nbsp;ruin&nbsp;any&nbsp;change&nbsp;the&nbsp;JIT&lt;br&gt;has&nbsp;to&nbsp;keep&nbsp;it&nbsp;on&nbsp;a&nbsp;register&nbsp;-&nbsp;this&nbsp;is&nbsp;a&nbsp;current&nbsp;limitation&nbsp;of&nbsp;mono&amp;#39;s&nbsp;JIT.&lt;br&gt;&lt;br&gt;Second,&nbsp;why&nbsp;can&amp;#39;t&nbsp;you&nbsp;just&nbsp;use&nbsp;a&nbsp;regular&nbsp;vector&nbsp;shift?&nbsp;&amp;quot;v1&nbsp;&amp;lt;&amp;lt;&nbsp;amount&amp;quot;&nbsp;would&nbsp;have&nbsp;the&nbsp;same&nbsp;result.&nbsp;&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp; &nbsp; public&nbsp;static&nbsp;unsafe&nbsp;Vector4ui&nbsp;LogicalLeftShift(this&nbsp;Vector4ui&nbsp;v1,&nbsp;int&lt;br&gt;<br>
amount)&lt;br&gt;<br>
&nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Vector4ui&nbsp;res&nbsp;=&nbsp;new&nbsp;Vector4ui();&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; uint*&nbsp;a&nbsp;=&nbsp;(uint*)&amp;amp;v1;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; uint*&nbsp;b&nbsp;=(uint*)&amp;amp;res;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;4;&nbsp;++i)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *b++&nbsp;=&nbsp;((uint)(*a++)&nbsp;&amp;lt;&amp;lt;&nbsp;amount);&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;res;&lt;br&gt;<br>
&nbsp; &nbsp; }&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Just&nbsp;use&nbsp;the&nbsp;left&nbsp;shift&nbsp;operation&nbsp;here&nbsp;&amp;quot;v1&nbsp;&amp;lt;&amp;lt;&nbsp;amount&amp;quot;.&lt;br&gt;&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&nbsp; &nbsp; public&nbsp;static&nbsp;unsafe&nbsp;Vector4f&nbsp;Cast2Vector4f(this&nbsp;Vector4i&nbsp;v1)&lt;br&gt;<br>
&nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Vector4f&nbsp;res&nbsp;=&nbsp;new&nbsp;Vector4f();&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; int*&nbsp;a&nbsp;=&nbsp;(int*)&amp;amp;v1;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; float*&nbsp;b&nbsp;=&nbsp;(float*)&amp;amp;res;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;4;&nbsp;++i)&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *b++&nbsp;=&nbsp;((float)(*a++));&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;res;&lt;br&gt;<br>
&nbsp; &nbsp; }&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Here&nbsp;you&amp;#39;re&nbsp;hitting&nbsp;a&nbsp;limitation&nbsp;of&nbsp;Mono.Simd&nbsp;as&nbsp;it&nbsp;lacks&nbsp;an&nbsp;intrinsic&nbsp;to&nbsp;perform&nbsp;this&nbsp;conversion&nbsp;using&lt;br&gt;an&nbsp;SSE&nbsp;instruction.&nbsp;This&nbsp;have&nbsp;to&nbsp;be&nbsp;addressed.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_0p5&nbsp;=&nbsp;new&nbsp;Vector4f(0.5f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4ui&nbsp;v4sui_0x7f&nbsp;=&nbsp;new&nbsp;Vector4ui(0x7f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4i&nbsp;v4si_0x7f&nbsp;=&nbsp;new&nbsp;Vector4i(0x7f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_one&nbsp;=&nbsp;Vector4f.One;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_exp_hi&nbsp;=&nbsp;new&nbsp;Vector4f(88.3762626647949f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_exp_lo&nbsp;=&nbsp;new&nbsp;Vector4f(-88.3762626647949f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_LOG2EF&nbsp;=&nbsp;new&nbsp;Vector4f(1.44269504088896341f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_C1&nbsp;=&nbsp;new&nbsp;Vector4f(0.693359375f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_C2&nbsp;=&nbsp;new&nbsp;Vector4f(-2.12194440e-4f);&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_p0&nbsp;=&nbsp;new&nbsp;Vector4f(1.9875691500E-4f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_p1&nbsp;=&nbsp;new&nbsp;Vector4f(1.3981999507E-3f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_p2&nbsp;=&nbsp;new&nbsp;Vector4f(8.3334519073E-3f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_p3&nbsp;=&nbsp;new&nbsp;Vector4f(4.1665795894E-2f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_p4&nbsp;=&nbsp;new&nbsp;Vector4f(1.6666665459E-1f);&lt;br&gt;<br>
&nbsp; &nbsp; static&nbsp;Vector4f&nbsp;v4sf_cephes_exp_p5&nbsp;=&nbsp;new&nbsp;Vector4f(5.0000001201E-1f);&lt;br&gt;<br>
&nbsp; &nbsp; public&nbsp;static&nbsp;Vector4f&nbsp;ExpSSE(Vector4f&nbsp;x)&lt;br&gt;<br>
&nbsp; &nbsp; {&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; //Vector4f&nbsp;tmp&nbsp;=&nbsp; Vector4f.Zero;&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Vector4f&nbsp;fx&nbsp;=&nbsp;Vector4f.Zero;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; Vector4i&nbsp;emm0;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; x&nbsp;=&nbsp;VectorOperations.Min(x,&nbsp;v4sf_exp_hi);&lt;br&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp; x&nbsp;=&nbsp;VectorOperations.Max(x,&nbsp;v4sf_exp_lo);&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;You&nbsp;can&nbsp;use&nbsp;those&nbsp;methods&nbsp;as&nbsp;extension&nbsp;methods&nbsp;&amp;quot;x.Min(v4sf_exp_hi)&amp;quot;&lt;br&gt;It&nbsp;might&nbsp;be&nbsp;faster&nbsp;to&nbsp;explicitly&nbsp;create&nbsp;the&nbsp;constant&nbsp;instead&nbsp;of&nbsp;loading&nbsp;it&nbsp;of&nbsp;a&lt;br&gt;<br>
static&nbsp;variable.&nbsp;This&nbsp;is&nbsp;specially&nbsp;true&nbsp;for&nbsp;single&nbsp;variable&nbsp;constructors.&lt;br&gt;&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;doing&nbsp;this&nbsp;experiment,&nbsp;there&nbsp;are&nbsp;certainly&nbsp;some&nbsp;remaining&nbsp;work&nbsp;&lt;br&gt;left&nbsp;to&nbsp;do&nbsp;on&nbsp;Mono.Simd&nbsp;and&nbsp;it&nbsp;does&nbsp;show&nbsp;it.&lt;br&gt;&lt;br&gt;&lt;br&gt;Rodrigo&nbsp;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
