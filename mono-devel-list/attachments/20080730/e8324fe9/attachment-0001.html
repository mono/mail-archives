<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Zoltan,&lt;br&gt;&lt;br&gt;It&amp;#39;s&nbsp;only&nbsp;doable&nbsp;to&nbsp;encode&nbsp;some&nbsp;very&nbsp;simple&nbsp;icalls&nbsp;with&nbsp;IL.&nbsp;I&nbsp;have&nbsp;the&nbsp;feeling&nbsp;that&lt;br&gt;we&nbsp;get&nbsp;an&nbsp;order&nbsp;of&nbsp;magnitude&nbsp;code&nbsp;increase&nbsp;for&nbsp;going&nbsp;from&nbsp;C/C#&nbsp;to&nbsp;emitting&nbsp;IL.&lt;br&gt;&lt;br&gt;OTOH,&nbsp;for&nbsp;things&nbsp;like&nbsp;UnsafeAddrOfPinnedArrayElement,&nbsp;the&nbsp;code&nbsp;is&nbsp;so&nbsp;straight&lt;br&gt;<br>
forward&nbsp;that&nbsp;gcc&nbsp;will&nbsp;hardly&nbsp;do&nbsp;much&nbsp;better&nbsp;than&nbsp;mono&amp;#39;s&nbsp;JIT.&lt;br&gt;&lt;br&gt;Anyway,&nbsp;allowing&nbsp;M2M&nbsp;frames&nbsp;to&nbsp;be&nbsp;considered&nbsp;for&nbsp;inlining&nbsp;is&nbsp;the&nbsp;way&nbsp;to&nbsp;go&lt;br&gt;or&nbsp;should&nbsp;we&nbsp;use&nbsp;a&nbsp;new&nbsp;wrapper&nbsp;type?&lt;br&gt;&lt;br&gt;Rodrigo&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Wed,&nbsp;Jul&nbsp;30,&nbsp;2008&nbsp;at&nbsp;9:22&nbsp;AM,&nbsp;Zoltan&nbsp;Varga&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:vargaz@gmail.com&quot;&gt;vargaz@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;This&nbsp;patch&nbsp;replaces&nbsp;a&nbsp;small,&nbsp;fast,&nbsp;simple&nbsp;piece&nbsp;of&nbsp;code&lt;br&gt;<br>
in&nbsp;mono_emit_inst_for_method&nbsp;()&nbsp;with&nbsp;something&nbsp;far&nbsp;more&nbsp;complex.&nbsp;Also,&lt;br&gt;<br>
about&nbsp;replacing&lt;br&gt;<br>
icalls&nbsp;with&nbsp;generated&nbsp;IL&nbsp;code:&lt;br&gt;<br>
-&nbsp;the&nbsp;code&nbsp;to&nbsp;generate&nbsp;the&nbsp;icalls&nbsp;is&nbsp;usually&nbsp;much&nbsp;bigger&nbsp;and&nbsp;more&lt;br&gt;<br>
complex&nbsp;than&nbsp;the&nbsp;icall&lt;br&gt;<br>
&nbsp;&amp;nbsp;itself.&lt;br&gt;<br>
-&nbsp;it&nbsp;replaces&nbsp;code&nbsp;generated&nbsp;by&nbsp;the&nbsp;gcc&nbsp;optimizing&nbsp;C&nbsp;compiler&nbsp;with&lt;br&gt;<br>
code&nbsp;generated&nbsp;by&nbsp;out&nbsp;JIT,&lt;br&gt;<br>
&nbsp;&amp;nbsp;which&nbsp;is&nbsp;of&nbsp;much&nbsp;lower&nbsp;quality.&nbsp;So&nbsp;even&nbsp;tough&nbsp;we&nbsp;incur&nbsp;a&lt;br&gt;<br>
managed-to-native&nbsp;transition&lt;br&gt;<br>
overhead&nbsp;by&nbsp;calling&nbsp;native&nbsp;code,&nbsp;we&nbsp;get&nbsp;some&nbsp;(or&nbsp;all)&nbsp;of&nbsp;it&nbsp;back&nbsp;by&lt;br&gt;<br>
having&nbsp;gcc&nbsp;compiled&nbsp;code&lt;br&gt;<br>
&nbsp;&amp;nbsp;in&nbsp;the&nbsp;icall.&lt;br&gt;<br>
-&nbsp;as&nbsp;rodrigo&nbsp;said,&nbsp;every&nbsp;new&nbsp;type&nbsp;of&nbsp;wrapper&nbsp;function&nbsp;adds&nbsp;some&lt;br&gt;<br>
complexity&nbsp;to&nbsp;our&nbsp;AOT&lt;br&gt;<br>
compiler&nbsp;which&nbsp;has&nbsp;to&nbsp;know&nbsp;about&nbsp;them.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;I&amp;#39;m&nbsp;not&nbsp;against&nbsp;adding&nbsp;the&nbsp;_ability_&nbsp;to&nbsp;implement&nbsp;icalls&nbsp;in&nbsp;IL,&nbsp;but&lt;br&gt;<br>
I&amp;#39;m&nbsp;against&nbsp;using&nbsp;it&nbsp;in&lt;br&gt;<br>
situations&nbsp;where&nbsp;it&nbsp;just&nbsp;makes&nbsp;things&nbsp;more&nbsp;complex.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;Zoltan&lt;br&gt;<br>
&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
