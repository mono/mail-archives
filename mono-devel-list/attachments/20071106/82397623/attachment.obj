#!perl # -*- tab-width: 4; fill-column: 80 -*-

############################################################
#
# This script will install Moonlight on Feisty
#
# Sledgehammer perl script based on this description:
#
# http://groups.google.com/group/mono-olive/msg/34a446ebd5c54d8e
#
# by chris.hamons@gmail.com
#
# typed up by psmaas@opera.com
#
############################################################

use strict;
use Cwd;

my $cwd     = getcwd;
my $basedir = $cwd."/mono";

mkdir $basedir, 0755;
chdir $basedir;

system("svn co svn://anonsvn.mono-project.com/source/trunk/mcs");
system("svn co svn://anonsvn.mono-project.com/source/trunk/mono");
system("svn co svn://anonsvn.mono-project.com/source/trunk/gtk-sharp");
system("svn co svn://anonsvn.mono-project.com/source/trunk/gnome-sharp");
system("svn co svn://anonsvn.mono-project.com/source/trunk/olive");
system("svn co svn://anonsvn.mono-project.com/source/trunk/moon");
system("svn co svn://anonsvn.mono-project.com/source/trunk/monodoc");
system("sudo apt-get install libavcodec0d libavformat0d libgtk2.0-dev libnspr-dev firefox-dev libavcodec-dev libavformat-dev libasound2-dev librsvg2-dev");
system("sudo apt-get install autoconf automake libtool build-essential bison");
system("sudo apt-get install prevu");
system("sudo prevu-init");

print "\n\tEdit /etc/apt/sources.list as root and add \n";
print "\tdeb-src http://us.archive.ubuntu.com/ubuntu gutsy main universe restricted multiverse\n";
print "\tWhen you are ready to continue type yes : ";

my $answer = <STDIN>;
chomp($answer);

($answer eq "yes") or die "\nInstallation interrupted\n";

system("sudo apt-get update");
system("prevu libswscale-dev");
system("cd /var/cache/prevu/feisty-debs; sudo dpkg -i *.deb");
system("sudo apt-get install mono-mcs");

chdir $basedir."/mono";
system("./autogen.sh --prefix=/usr --with-moonlight=yes");
system("make");
system("sudo apt-get remove mono-mcs");
system("sudo apt-get autoremove");
system("sudo make install");
chdir $basedir."/olive";
system("./configure --prefix=/usr");
system("make");
system("sudo make install");
chdir $basedir."/gtk-sharp";
system("./boostrap-2.10 --prefix=/usr");
system("make");
system("sudo make install");
chdir $basedir."/monodoc";
system("./autogen.sh --prefix=/usr");
system("make");
system("sudo make install");
chdir $basedir."/gnome-sharp";
system("./bootstrap-2.16 --prefix=/usr");
system("make");
system("sudo make install");
chdir $basedir."/moon";
system("./autogen.sh --prefix=/usr");
system("make");
system("sudo make install");
system("cd /usr/local/lib/moon/plugin; sudo cp *.so moonlight.exe /usr/lib/mozilla-firefox/plugins");
system("sudo ln -s /usr/local/lib/mono /usr/lib/mono/3.0");

print "\n\tLaunch Firefox\n";
print "\tIn the address bar, about:plugins\n";
print "\tConfirm WPFe plugin is there\n"; 
print "\tWoot! You should be good.\n";
