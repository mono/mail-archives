<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;As&nbsp;a&nbsp;follow-up,&nbsp;I&nbsp;ran&nbsp;the&nbsp;code&nbsp;below&nbsp;using&nbsp;strace&nbsp;on&nbsp;Ubuntu&nbsp;16.04&nbsp;and&nbsp;found&nbsp;the&nbsp;same&nbsp;behavior&nbsp;as&nbsp;I&nbsp;see&nbsp;on&nbsp;CentOS&nbsp;7&nbsp;(i.e.&nbsp;waiting&nbsp;for&nbsp;the&nbsp;event&nbsp;blocks).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;checking&nbsp;again&nbsp;on&nbsp;CentOS&nbsp;6,&nbsp;I&nbsp;find&nbsp;that&nbsp;the&nbsp;gettimeofday()&nbsp;calls&nbsp;DO&nbsp;end,&nbsp;after&nbsp;being&nbsp;called&nbsp;excatly&nbsp;3,303&nbsp;times&nbsp;(same&nbsp;number&nbsp;seen&nbsp;on&nbsp;a&nbsp;couple&nbsp;of&nbsp;VMs). &nbsp;Then&nbsp;the&nbsp;futex()&nbsp;blocking&nbsp;call&nbsp;is&nbsp;reached.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;certainly&nbsp;excessive,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;means&nbsp;that&nbsp;once&nbsp;the&nbsp;futex()&nbsp;call&nbsp;is&nbsp;reached,&nbsp;the&nbsp;process&nbsp;blocks,&nbsp;as&nbsp;expected.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;it&nbsp;appears&nbsp;that&nbsp;gettimeofday()&nbsp;does&nbsp;not&nbsp;appear&nbsp;at&nbsp;all&nbsp;on&nbsp;the&nbsp;CentOS&nbsp;7&nbsp;or&nbsp;Ubuntu&nbsp;16.04&nbsp;traces.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Rick&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Aug&nbsp;30,&nbsp;2017&nbsp;at&nbsp;9:24&nbsp;AM,&nbsp;Rick&nbsp;Tillery&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rtillerywork@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rtillerywork@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;still&nbsp;trying&nbsp;to&nbsp;determine&nbsp;which&nbsp;FileSystemWatcher&nbsp;backend&nbsp;is&nbsp;being&nbsp;used&nbsp;in&nbsp;different&nbsp;distros&nbsp;and&nbsp;versions.&nbsp;I&nbsp;was&nbsp;trying&nbsp;to&nbsp;see&nbsp;if&nbsp;strace&nbsp;could&nbsp;help.&nbsp;But&nbsp;I&#39;m&nbsp;seeing&nbsp;something&nbsp;strange.&nbsp;Using&nbsp;the&nbsp;code&nbsp;below,&nbsp;which&nbsp;just&nbsp;blocks,&nbsp;waiting&nbsp;on&nbsp;an&nbsp;event&nbsp;(in&nbsp;the&nbsp;example,&nbsp;one&nbsp;which&nbsp;never&nbsp;triggers),&nbsp;and&nbsp;then&nbsp;running&nbsp;with&nbsp;strace,&nbsp;after&nbsp;initialization,&nbsp;I&nbsp;get&nbsp;constant&nbsp;getimeofday()&nbsp;calls&nbsp;in&nbsp;CentOS&nbsp;6:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;#&nbsp;strace&nbsp;mono&nbsp;wait.exe&lt;/div&gt;&lt;div&gt;&lt;div&gt;...&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;gettimeofday({1504101194,&nbsp;148314},&nbsp;NULL)&nbsp;=&nbsp;0&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;gettimeofday({1504101194,&nbsp;148370},&nbsp;NULL)&nbsp;=&nbsp;0&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;gettimeofday({1504101194,&nbsp;148480},&nbsp;NULL)&nbsp;=&nbsp;0&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;gettimeofday({1504101194,&nbsp;148501},&nbsp;NULL)&nbsp;=&nbsp;0&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;gettimeofday({1504101194,&nbsp;148521},&nbsp;NULL)&nbsp;=&nbsp;0&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;...&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;CentOS&nbsp;7,&nbsp;after&nbsp;initialization,&nbsp;the&nbsp;output&nbsp;pauses,&nbsp;as&nbsp;expected:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;div&gt;#&nbsp;strace&nbsp;mono&nbsp;wait.exe&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;...&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;write(1,&nbsp;&quot;Waiting&nbsp;for&nbsp;activity\n&quot;,&nbsp;21Waiting&nbsp;for&nbsp;activity&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;)&nbsp; =&nbsp;21&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;futex(0xb84c6c,&nbsp;FUTEX_WAIT_PRIVATE,&nbsp;1,&nbsp;NULL[CURSOR&nbsp;HERE]&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Source&nbsp;code&nbsp;(wait.cs):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;using&nbsp;System;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;using&nbsp;System.Threading;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;//&nbsp;Compile&nbsp;with&nbsp;&quot;mcs&nbsp;wait.cs&quot;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;public&nbsp;class&nbsp;Wait&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;{&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp;private&nbsp;static&nbsp;ManualResetEvent&nbsp;signal&nbsp;=&nbsp;new&nbsp;ManualResetEvent(false);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp;public&nbsp;static&nbsp;int&nbsp;Main()&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;while&nbsp;(true)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;Waiting&nbsp;for&nbsp;activity&quot;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;signal.WaitOne();&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;Activity&nbsp;detected&quot;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;signal.Reset();&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;0;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&#39;s&nbsp;going&nbsp;on&nbsp;here?&nbsp;Why&nbsp;is&nbsp;there&nbsp;activity&nbsp;in&nbsp;CentOS&nbsp;6,&nbsp;while&nbsp;the&nbsp;process&nbsp;should&nbsp;be&nbsp;blocked&nbsp;and&nbsp;waiting?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Rick&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Aug&nbsp;29,&nbsp;2017&nbsp;at&nbsp;4:05&nbsp;PM,&nbsp;Rick&nbsp;Tillery&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rtillerywork@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rtillerywork@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;In &lt;a&nbsp;href=&quot;http://www.mono-project.com/docs/faq/technical/#what-are-the-issues-with-filesystemwatcher&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.mono-project.com&lt;wbr&gt;/docs/faq/technical/#what-are-&lt;wbr&gt;the-issues-with-filesystemwatc&lt;wbr&gt;her&lt;/a&gt;,&nbsp;it&nbsp;mentions:&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin:0px&nbsp;0px&nbsp;1.25rem;padding:0px;font-family:&quot;Helvetica&nbsp;Neue&quot;,Helvetica,Helvetica,Arial,sans-serif;line-height:1.6&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;The&nbsp;Mono&nbsp;implementation&nbsp;of&nbsp;FileSystemWatcher&nbsp;has&nbsp;a&nbsp;number&nbsp;of&nbsp;backends,&nbsp;the&nbsp;most&nbsp;optimal&nbsp;one,&nbsp;the&nbsp;one&nbsp;with&nbsp;fewer&nbsp;dependencies&nbsp;is&nbsp;the&nbsp;inotify-backend&nbsp;(available&nbsp;in&nbsp;Mono&nbsp;1.1.17&nbsp;and&nbsp;newer&nbsp;versions).&lt;/font&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin:0px&nbsp;0px&nbsp;1.25rem;padding:0px;font-family:&quot;Helvetica&nbsp;Neue&quot;,Helvetica,Helvetica,Arial,sans-serif;line-height:1.6&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;With&nbsp;this&nbsp;backend&nbsp;the&nbsp;kernel&nbsp;provides&nbsp;Mono&nbsp;with&nbsp;updates&nbsp;on&nbsp;any&nbsp;changes&nbsp;to&nbsp;files&nbsp;on&nbsp;the&nbsp;file&nbsp;system&nbsp;but&nbsp;it&nbsp;requires&nbsp;an&nbsp;inotify-enabled&nbsp;kernel,&nbsp;which&nbsp;only&nbsp;newer&nbsp;Linux&nbsp;distributions&nbsp;ship.&lt;/font&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin:0px&nbsp;0px&nbsp;1.25rem;padding:0px;font-family:&quot;Helvetica&nbsp;Neue&quot;,Helvetica,Helvetica,Arial,sans-serif;line-height:1.6&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;In&nbsp;older&nbsp;Linux&nbsp;systems,&nbsp;you&nbsp;must&nbsp;have&nbsp;installed&nbsp;FAM&nbsp;or&nbsp;Gamin&nbsp;(it&nbsp;will&nbsp;work&nbsp;with&nbsp;either&nbsp;one).&nbsp;You&nbsp;might&nbsp;need&nbsp;the&nbsp;-devel&nbsp;packets&nbsp;installed.&lt;/font&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin:0px&nbsp;0px&nbsp;1.25rem;padding:0px;font-family:&quot;Helvetica&nbsp;Neue&quot;,Helvetica,Helvetica,Arial,sans-serif;line-height:1.6&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;For&nbsp;the&nbsp;*BSD&nbsp;family,&nbsp;there’s&nbsp;a&nbsp;Kqueue&nbsp;based&nbsp;implementation&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;when&nbsp;detected&nbsp;at&nbsp;runtime.&lt;/font&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;box-sizing:border-box;margin:0px&nbsp;0px&nbsp;1.25rem;padding:0px;font-family:&quot;Helvetica&nbsp;Neue&quot;,Helvetica,Helvetica,Arial,sans-serif;line-height:1.6&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;If&nbsp;none&nbsp;of&nbsp;the&nbsp;above&nbsp;work,&nbsp;Mono&nbsp;falls&nbsp;back&nbsp;to&nbsp;polling&nbsp;the&nbsp;directories&nbsp;for&nbsp;changes,&nbsp;which&nbsp;far&nbsp;from&nbsp;optimal.&lt;/font&gt;&lt;/p&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;Is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;determine,&nbsp;on&nbsp;a&nbsp;given&nbsp;system,&nbsp;which&nbsp;backend&nbsp;is&nbsp;being&nbsp;used?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Specifically,&nbsp;I&nbsp;have&nbsp;to&nbsp;support&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;Linux&nbsp;distros&nbsp;and&nbsp;versions&nbsp;going&nbsp;back&nbsp;a&nbsp;number&nbsp;of&nbsp;years,&nbsp;so&nbsp;I&nbsp;need&nbsp;to&nbsp;know&nbsp;that&nbsp;none&nbsp;of&nbsp;them&nbsp;are&nbsp;using&nbsp;polling.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Rick&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
