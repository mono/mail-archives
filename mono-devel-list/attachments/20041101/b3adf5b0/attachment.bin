Index: browser/ChangeLog
===================================================================
RCS file: /cvs/public/monodoc/browser/ChangeLog,v
retrieving revision 1.138
diff -u -r1.138 ChangeLog
--- browser/ChangeLog	6 Sep 2004 13:41:20 -0000	1.138
+++ browser/ChangeLog	1 Nov 2004 10:51:15 -0000
@@ -1,3 +1,9 @@
+2004-11-01  Richard Torkar <richard.torkar@htu.se>
+
+	* index.cs: Make sure we catch the System.UnauthorizedAccessException 
+	that is thrown when the user has no write permissions to store the 
+	index file when using "monodoc --make-index".
+
 2004-09-06  Joshua Tauberer  <tauberer@for.net>
 
 	Editing of ECMA-style documentation directly off of the
Index: browser/index.cs
===================================================================
RCS file: /cvs/public/monodoc/browser/index.cs,v
retrieving revision 1.8
diff -u -r1.8 index.cs
--- browser/index.cs	24 Jul 2003 02:59:16 -0000	1.8
+++ browser/index.cs	1 Nov 2004 10:51:15 -0000
@@ -251,23 +251,32 @@
 	{
 		Encoding utf8 = new UTF8Encoding (false, true);
 
-		using (FileStream fs = File.OpenWrite (filename)){
-			BinaryWriter writer = new BinaryWriter (fs, utf8);
-		
-			writer.Write (new byte [] { (byte) 'M', (byte) 'o', (byte) 'i', (byte) 'x'});
+		// If the user doesn't have write access to the path then an
+		// exception will be thrown
+		try {	
+			using (FileStream fs = File.OpenWrite (filename)){
+				BinaryWriter writer = 
+						new BinaryWriter (fs, utf8);
+				writer.Write (new byte [] { (byte) 'M', 
+						(byte) 'o', (byte) 'i', 
+						(byte) 'x'});
 
-			// Leave room for pointer
-			fs.Position = 8;
+				// Leave room for pointer
+				fs.Position = 8;
 
-			SaveStringTable (fs, writer);
-			SaveTopics (fs, writer);
+				SaveStringTable (fs, writer);
+				SaveTopics (fs, writer);
 
-			// index_position is set here
+				// index_position is set here
 			
-			SaveIndexEntries (fs, writer);
+				SaveIndexEntries (fs, writer);
 
-			fs.Position = 4;
-			writer.Write (index_position);
+				fs.Position = 4;
+				writer.Write (index_position);
+			}
+		} catch(System.UnauthorizedAccessException suae) {
+			Console.WriteLine ("\nMonodoc has no write permissions to write {0}", filename);
+			Console.WriteLine ("Please re-run this command as root (superuser)\n");
 		}
 	}
 }
