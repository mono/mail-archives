<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.2800.1141&quot;&nbsp;name=GENERATOR&gt;<br>
&lt;STYLE&gt;&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;bgColor=#e2f8fe&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;believe&nbsp;that&nbsp;this&nbsp;patch&nbsp;also&nbsp;addresses&nbsp;a&nbsp;problem&nbsp;<br>
on&nbsp;os/x.&nbsp;I&nbsp;have&nbsp;been&nbsp;debugging&nbsp;handles.c&nbsp;and&nbsp;wait.c.&nbsp;The&nbsp;pthread_wait_*&nbsp;calls&nbsp;<br>
are&nbsp;returning&nbsp;an&nbsp;'invalid&nbsp;argument'&nbsp;return&nbsp;code&nbsp;when&nbsp;being&nbsp;called&nbsp;by&nbsp;the&nbsp;<br>
_wapi_*wait&nbsp;functions.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;In&nbsp;a&nbsp;nutshell,&nbsp;since&nbsp;these&nbsp;calls&nbsp;were&nbsp;correctly&nbsp;<br>
generating&nbsp;the&nbsp;timeout&nbsp;threshold&nbsp;(abstime),&nbsp;I&nbsp;was&nbsp;thinking&nbsp;that&nbsp;the&nbsp;remaining&nbsp;<br>
two&nbsp;params&nbsp;(condition&nbsp;and&nbsp;mutex)&nbsp;were&nbsp;somehow&nbsp;invalid.&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;This&nbsp;resulted&nbsp;in&nbsp;a&nbsp;pegged-cpu&nbsp;situation&nbsp;in&nbsp;OS/X&nbsp;<br>
when&nbsp;falling&nbsp;back&nbsp;to&nbsp;non-shared&nbsp;handles.&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;BLOCKQUOTE&nbsp;dir=ltr&nbsp;<br>
style=&quot;PADDING-RIGHT:&nbsp;0px;&nbsp;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#000000&nbsp;2px&nbsp;solid;&nbsp;MARGIN-RIGHT:&nbsp;0px&quot;&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;FONT:&nbsp;10pt&nbsp;arial&quot;&gt;-----&nbsp;Original&nbsp;Message&nbsp;-----&nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;<br>
&nbsp;&nbsp;style=&quot;BACKGROUND:&nbsp;#e4e4e4;&nbsp;FONT:&nbsp;10pt&nbsp;arial;&nbsp;font-color:&nbsp;black&quot;&gt;&lt;B&gt;From:&lt;/B&gt;&nbsp;<br>
&nbsp;&nbsp;&lt;A&nbsp;title=bernard@ugsolutions.com&nbsp;href=&quot;mailto:bernard@ugsolutions.com&quot;&gt;Bernie&nbsp;<br>
&nbsp;&nbsp;Solomon&lt;/A&gt;&nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;FONT:&nbsp;10pt&nbsp;arial&quot;&gt;&lt;B&gt;To:&lt;/B&gt;&nbsp;&lt;A&nbsp;<br>
&nbsp;&nbsp;title=mono-devel-list@lists.ximian.com&nbsp;<br>
&nbsp;&nbsp;href=&quot;mailto:mono-devel-list@lists.ximian.com&quot;&gt;mono-devel-list@lists.ximian.com&lt;/A&gt;&nbsp;<br>
&nbsp;&nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;FONT:&nbsp;10pt&nbsp;arial&quot;&gt;&lt;B&gt;Sent:&lt;/B&gt;&nbsp;Tuesday,&nbsp;July&nbsp;22,&nbsp;2003&nbsp;5:29&nbsp;<br>
PM&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;FONT:&nbsp;10pt&nbsp;arial&quot;&gt;&lt;B&gt;Subject:&lt;/B&gt;&nbsp;[Mono-devel-list]&nbsp;handles.c&nbsp;<br>
&nbsp;&nbsp;patch&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;BR&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;eventually&nbsp;realized&nbsp;that&nbsp;one&nbsp;reason&nbsp;things&nbsp;were&nbsp;<br>
&nbsp;&nbsp;slow&nbsp;for&nbsp;me&nbsp;is&nbsp;that&nbsp;the&nbsp;thread&nbsp;management&nbsp;thread&nbsp;was&nbsp;in&nbsp;a&nbsp;busy&nbsp;loop&nbsp;because&nbsp;<br>
&nbsp;&nbsp;mutexes&nbsp;weren't&nbsp;initialized&nbsp;so&nbsp;calls&nbsp;continually&nbsp;failed.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;am&nbsp;not&nbsp;100%&nbsp;sure&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;fix&nbsp;but&nbsp;it&nbsp;<br>
&nbsp;&nbsp;addresses&nbsp;my&nbsp;test&nbsp;case.&nbsp;I&nbsp;am&nbsp;currently&nbsp;configuring&nbsp;with&nbsp;shared&nbsp;handles&nbsp;<br>
&nbsp;&nbsp;disabled.&nbsp;The&nbsp;fix&nbsp;makes&nbsp;everything&nbsp;twice&nbsp;as&nbsp;fast&nbsp;for&nbsp;me&nbsp;having&nbsp;removed&nbsp;a&nbsp;busy&nbsp;<br>
&nbsp;&nbsp;thread.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;assume&nbsp;this&nbsp;matters&nbsp;on&nbsp;HP&nbsp;because&nbsp;initializing&nbsp;<br>
&nbsp;&nbsp;mutexes&nbsp;to&nbsp;zeroes&nbsp;isn't&nbsp;the&nbsp;right&nbsp;thing&nbsp;to&nbsp;do&nbsp;yet&nbsp;presumably&nbsp;is&nbsp;OK&nbsp;on&nbsp;other&nbsp;<br>
&nbsp;&nbsp;platforms.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Bernie&nbsp;<br>
Solomon&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
