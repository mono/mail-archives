Index: ChangeLog
===================================================================
RCS file: /cvs/public/mono/mono/metadata/ChangeLog,v
retrieving revision 1.1028
diff -u -r1.1028 ChangeLog
--- ChangeLog	22 Jul 2003 19:18:06 -0000	1.1028
+++ ChangeLog	23 Jul 2003 01:44:10 -0000
@@ -1,3 +1,10 @@
+2003-07-23  Gonzalo Paniagua Javier <gonzalo@ximian.com>
+
+	* exception.c:
+	* exception.h:
+	* icall.c:
+	* object.h: fill in the type name for TypeLoadException.
+
 2003-07-22  Martin Baulig  <martin@ximian.com>
 
 	* mono-debug-debugger.c: Reworked the type support a bit more;
Index: exception.c
===================================================================
RCS file: /cvs/public/mono/mono/metadata/exception.c,v
retrieving revision 1.14
diff -u -r1.14 exception.c
--- exception.c	11 Feb 2003 15:10:40 -0000	1.14
+++ exception.c	23 Jul 2003 01:44:10 -0000
@@ -189,10 +189,16 @@
 }
 
 MonoException *
-mono_get_exception_type_load ()
+mono_get_exception_type_load (MonoString *type_name)
 {
-	return mono_exception_from_name (mono_defaults.corlib, "System",
-					 "TypeLoadException");
+	MonoTypeLoadException *exc;
+	
+	exc = (MonoTypeLoadException *) mono_exception_from_name (mono_defaults.corlib,
+					"System",
+					"TypeLoadException");
+
+	exc->type_name = type_name;
+	return (MonoException *) exc;
 }
 
 MonoException *
Index: exception.h
===================================================================
RCS file: /cvs/public/mono/mono/metadata/exception.h,v
retrieving revision 1.14
diff -u -r1.14 exception.h
--- exception.h	11 Feb 2003 15:10:40 -0000	1.14
+++ exception.h	23 Jul 2003 01:44:10 -0000
@@ -59,7 +59,7 @@
 mono_get_exception_array_type_mismatch (void);
 
 MonoException *
-mono_get_exception_type_load           (void);
+mono_get_exception_type_load           (MonoString *type_name);
 
 MonoException *
 mono_get_exception_missing_method      (void);
Index: icall.c
===================================================================
RCS file: /cvs/public/mono/mono/metadata/icall.c,v
retrieving revision 1.318
diff -u -r1.318 icall.c
--- icall.c	22 Jul 2003 13:59:00 -0000	1.318
+++ icall.c	23 Jul 2003 01:44:12 -0000
@@ -835,7 +835,7 @@
 		g_list_free (info.modifiers);
 		g_list_free (info.nested);
 		if (throwOnError) /* uhm: this is a parse error, though... */
-			mono_raise_exception (mono_get_exception_type_load ());
+			mono_raise_exception (mono_get_exception_type_load (name));
 
 		return NULL;
 	}
@@ -860,7 +860,7 @@
 	g_list_free (info.nested);
 	if (!type) {
 		if (throwOnError)
-			mono_raise_exception (mono_get_exception_type_load ());
+			mono_raise_exception (mono_get_exception_type_load (name));
 
 		return NULL;
 	}
@@ -2203,7 +2203,7 @@
 		g_list_free (info.modifiers);
 		g_list_free (info.nested);
 		if (throwOnError) /* uhm: this is a parse error, though... */
-			mono_raise_exception (mono_get_exception_type_load ());
+			mono_raise_exception (mono_get_exception_type_load (name));
 		/*g_print ("failed parse\n");*/
 		return NULL;
 	}
@@ -2214,7 +2214,7 @@
 	g_list_free (info.nested);
 	if (!type) {
 		if (throwOnError)
-			mono_raise_exception (mono_get_exception_type_load ());
+			mono_raise_exception (mono_get_exception_type_load (name));
 		/* g_print ("failed find\n"); */
 		return NULL;
 	}
Index: object.h
===================================================================
RCS file: /cvs/public/mono/mono/metadata/object.h,v
retrieving revision 1.97
diff -u -r1.97 object.h
--- object.h	3 Jul 2003 15:27:23 -0000	1.97
+++ object.h	23 Jul 2003 01:44:12 -0000
@@ -162,6 +162,12 @@
 } MonoArgumentException;
 
 typedef struct {
+	MonoSystemException base;
+	MonoString *msg;
+	MonoString *type_name;
+} MonoTypeLoadException;
+
+typedef struct {
 	MonoObject   object;
 	MonoObject  *async_state;
 	MonoObject  *handle;
