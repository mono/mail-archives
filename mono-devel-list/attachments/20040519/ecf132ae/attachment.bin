Index: metadata/ChangeLog
===================================================================
RCS file: /cvs/public/mono/mono/metadata/ChangeLog,v
retrieving revision 1.1596
diff -u -u -r1.1596 ChangeLog
--- metadata/ChangeLog	19 May 2004 17:59:26 -0000	1.1596
+++ metadata/ChangeLog	19 May 2004 22:07:28 -0000
@@ -1,3 +1,8 @@
+2004-05-19  Miguel de Icaza  <miguel@ximian.com>
+
+	* icall.c (mono_type_get): Add new public method for the embedding
+	API. 
+
 2004-05-19  Gonzalo Paniagua Javier <gonzalo@ximian.com>
 
 	* icall.c: new signature for Process_Start.
Index: metadata/icall.c
===================================================================
RCS file: /cvs/public/mono/mono/metadata/icall.c,v
retrieving revision 1.479
diff -u -u -r1.479 icall.c
--- metadata/icall.c	19 May 2004 17:59:26 -0000	1.479
+++ metadata/icall.c	19 May 2004 22:07:28 -0000
@@ -930,26 +930,18 @@
 	mono_image_build_metadata (mb);
 }
 
-static MonoReflectionType*
-ves_icall_type_from_name (MonoString *name,
-			  MonoBoolean throwOnError,
-			  MonoBoolean ignoreCase)
+static MonoReflectionType *
+type_from_name (const char *str, MonoBoolean ignoreCase)
 {
-	gchar *str;
 	MonoType *type = NULL;
 	MonoAssembly *assembly;
 	MonoTypeNameParse info;
 
 	MONO_ARCH_SAVE_REGS;
 
-	str = mono_string_to_utf8 (name);
 	if (!mono_reflection_parse_type (str, &info)) {
-		g_free (str);
 		g_list_free (info.modifiers);
 		g_list_free (info.nested);
-		if (throwOnError) /* uhm: this is a parse error, though... */
-			mono_raise_exception (mono_get_exception_type_load (name));
-
 		return NULL;
 	}
 
@@ -968,18 +960,42 @@
 	if (!info.assembly.name && !type) /* try mscorlib */
 		type = mono_reflection_get_type (NULL, &info, ignoreCase);
 
-	g_free (str);
 	g_list_free (info.modifiers);
 	g_list_free (info.nested);
-	if (!type) {
-		if (throwOnError)
-			mono_raise_exception (mono_get_exception_type_load (name));
-
+	if (!type) 
 		return NULL;
-	}
 
 	return mono_type_get_object (mono_domain_get (), type);
 }
+
+MonoReflectionType *
+mono_type_get (const char *str)
+{
+	char *copy = g_strdup (str);
+	MonoReflectionType *type = type_from_name (copy, FALSE);
+
+	g_free (copy);
+	return type;
+}
+
+static MonoReflectionType*
+ves_icall_type_from_name (MonoString *name,
+			  MonoBoolean throwOnError,
+			  MonoBoolean ignoreCase)
+{
+	char *str = mono_string_to_utf8 (name);
+	MonoReflectionType *type;
+
+	type = type_from_name (str, ignoreCase);
+	g_free (str);
+	if (type == NULL){
+		if (throwOnError)
+			mono_raise_exception (mono_get_exception_type_load (name));
+	}
+	
+	return type;
+}
+
 
 static MonoReflectionType*
 ves_icall_type_from_handle (MonoType *handle)
Index: metadata/reflection.c
===================================================================
RCS file: /cvs/public/mono/mono/metadata/reflection.c,v
retrieving revision 1.335
diff -u -u -r1.335 reflection.c
--- metadata/reflection.c	11 May 2004 11:48:31 -0000	1.335
+++ metadata/reflection.c	19 May 2004 22:07:28 -0000
@@ -5265,7 +5265,8 @@
  * See also mono_type_get_name () below.
  */
 int
-mono_reflection_parse_type (char *name, MonoTypeNameParse *info) {
+mono_reflection_parse_type (char *name, MonoTypeNameParse *info)
+{
 
 	char *start, *p, *w, *last_point, *startn;
 	int in_modifiers = 0;
Index: mini/jit.h
===================================================================
RCS file: /cvs/public/mono/mono/mini/jit.h,v
retrieving revision 1.1
diff -u -u -r1.1 jit.h
--- mini/jit.h	28 May 2003 09:33:15 -0000	1.1
+++ mini/jit.h	19 May 2004 22:07:28 -0000
@@ -19,5 +19,8 @@
 void        
 mono_jit_cleanup           (MonoDomain *domain);
 
+MonoReflectionType *
+mono_type_get              (const char *type);
+
 #endif
 
