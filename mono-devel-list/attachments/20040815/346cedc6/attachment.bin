/*
 *	Filename: Test5.cs
 *	Description: Test case for GETing via Proxy to https
 *	Compile with: mcs -g /target:exe /out:Test5.exe /r:System.dll Test5.cs
 */

using System;
using System.Net;

public class TrustAllCerts : System.Net.ICertificatePolicy
{
	public TrustAllCerts()
	{
	}

	public bool CheckValidationResult(ServicePoint sp,
		 System.Security.Cryptography.X509Certificates.X509Certificate cert,WebRequest req, int problem)
	{
	  	return true;
	}
}

class X
{
	static void Main (string [] args)
	{
		// Accept all certificates	
		ServicePointManager.CertificatePolicy = new TrustAllCerts(); 

		Uri u = new Uri("https://banking.53.com");
	
		HttpWebRequest wreq = (HttpWebRequest) WebRequest.Create(u);
		try
		{
			wreq.Proxy = new WebProxy("127.0.0.1", 8888);
			wreq.Method = "GET";

			Console.WriteLine("Get Response");
			HttpWebResponse wresp = (HttpWebResponse) wreq.GetResponse();
			if (wreq.HaveResponse)
			{
				Console.WriteLine("Received Response");
			}
			wresp.Close();

			wresp = null;

			wreq = null;
		}
		catch (Exception ex)
		{
			Console.WriteLine("Exception:\n{0}\n{1}", ex.Message, ex.StackTrace);
		}
	}
};
