commit cb56e9c354235bc7226560b33b4f074d63a4dcb2
Author: Stephane Delcroix <stephane@delcroix.org>
Date:   Thu Dec 3 12:43:43 2009 +0100

    2009-12-3  Stephane Delcroix  <stephane@delcroix.org>
    
    	* Catalog.cs: P/Invoke d(n)gettext

diff --git a/class/Mono.Posix/Mono.Unix/Catalog.cs b/class/Mono.Posix/Mono.Unix/Catalog.cs
index d835fec..c79d49b 100644
--- a/class/Mono.Posix/Mono.Unix/Catalog.cs
+++ b/class/Mono.Posix/Mono.Unix/Catalog.cs
@@ -93,6 +93,9 @@ namespace Mono.Unix {
 	
 		[DllImport("intl")]
 		static extern IntPtr gettext (IntPtr instring);
+
+		[DllImport("intl")]
+		static extern IntPtr dgettext (IntPtr domain, IntPtr instring);
 		
 		public static String GetString (String s)
 		{
@@ -108,18 +111,39 @@ namespace Mono.Unix {
 				UnixMarshal.FreeHeap (ints);
 			}
 		}
+		
+		public static String GetString (String domain, String s)
+		{
+			IntPtr ints = UnixMarshal.StringToHeap (s);
+			IntPtr dom = UnixMarshal.StringToHeap (domain);
+			try {
+				// (d)gettext(3) returns the input pointer if no translation is found
+				IntPtr r = dgettext (dom, ints);
+				if (r != ints)
+					return UnixMarshal.PtrToStringUnix (r);
+				return s;
+			}
+			finally {
+				UnixMarshal.FreeHeap (dom);
+				UnixMarshal.FreeHeap (ints);
+			}
+		}
 	
 		[DllImport("intl")]
 		static extern IntPtr ngettext (IntPtr singular, IntPtr plural, Int32 n);
 		
-		public static String GetPluralString (String s, String p, Int32 n)
+		[DllImport("intl")]
+		static extern IntPtr dngettext (IntPtr domain, IntPtr singular, IntPtr plural, Int32 n);
+		
+		public static String GetPluralString (String domain, String s, String p, Int32 n)
 		{
 			IntPtr ints, intp, _ignore;
 			MarshalStrings (s, out ints, p, out intp, null, out _ignore);
+			IntPtr dom = UnixMarshal.StringToHeap (domain);
 
 			try {
-				// ngettext(3) returns an input pointer if no translation is found
-				IntPtr r = ngettext (ints, intp, n);
+				// (d)ngettext(3) returns an input pointer if no translation is found
+				IntPtr r = dngettext (dom, ints, intp, n);
 				if (r == ints)
 					return s;
 				if (r == intp)
@@ -129,6 +153,7 @@ namespace Mono.Unix {
 			finally {
 				UnixMarshal.FreeHeap (ints);
 				UnixMarshal.FreeHeap (intp);
+				UnixMarshal.FreeHeap (dom);
 			}
 		}
 	}
diff --git a/class/Mono.Posix/Mono.Unix/ChangeLog b/class/Mono.Posix/Mono.Unix/ChangeLog
index 3901ef4..463c07c 100644
--- a/class/Mono.Posix/Mono.Unix/ChangeLog
+++ b/class/Mono.Posix/Mono.Unix/ChangeLog
@@ -1,3 +1,7 @@
+2009-12-3  Stephane Delcroix  <stephane@delcroix.org>
+
+	* Catalog.cs: P/Invoke d(n)gettext
+
 2009-03-23  Jonathan Pryor  <jpryor@novell.com>
 
 	* UnixDriveInfo.cs: UnixDriveInfo.AvailableFreeSpace needs to return 
