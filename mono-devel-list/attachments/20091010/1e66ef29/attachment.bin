using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;

namespace PerfMon
{
    class NetworkInterface
    {
        private PerformanceCounter pcr;
        private PerformanceCounter pcs;
        private PerformanceCounter pct;

        public NetworkInterface(string name)
        {
            Name = name;

            pcr = new PerformanceCounter("Network Interface", "Bytes Received/sec", name);
						pcr.NextValue();

            pcs = new PerformanceCounter("Network Interface", "Bytes Sent/sec", name);
						pcs.NextValue();

            pct = new PerformanceCounter("Network Interface", "Bytes Total/sec", name);
						pct.NextValue();
        }

        public string Name { get; set; }

        public double BytesReceivedPerSec
        {
            get
            {
                return pcr.NextValue();
            }
        }

        public double BytesSentPerSec
        {
            get
            {
							return pcs.NextValue();
            }
        }

        public double BytesTotalPerSec
        {
            get
            {
							return pct.NextValue();
            }
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            PerformanceCounterCategory category = new PerformanceCounterCategory("Network Interface");

            List<NetworkInterface> networkInterfaces = new List<NetworkInterface>();
            foreach (string name in category.GetInstanceNames())
            {
                Console.WriteLine(name);
                networkInterfaces.Add(new NetworkInterface(name));
            }

            while (true)
            {
                foreach (NetworkInterface ni in networkInterfaces)
                {
									Console.WriteLine("{0}: Bytes Received/sec: {1}, Bytes Sent/sec: {2}, Bytes Total/sec: {3}", ni.Name, ni.BytesReceivedPerSec, ni.BytesSentPerSec, ni.BytesTotalPerSec);
                }

                Console.WriteLine();
                System.Threading.Thread.Sleep(2000);
            }

            Console.ReadKey();
        }
    }
}



