<tt>
Well,&nbsp;&amp;#39;N&amp;#39;&nbsp;could&nbsp;be&nbsp;computed&nbsp;by&nbsp;asking&nbsp;what&nbsp;percent&nbsp;bloat&nbsp;is&nbsp;&amp;#39;OK&amp;#39;&nbsp;or&nbsp;it&nbsp;could&nbsp;be&nbsp;computed&nbsp;by&nbsp;asking&nbsp;&amp;#39;What&nbsp;%&nbsp;speedup&nbsp;do&nbsp;we&nbsp;want&nbsp;to&nbsp;make&nbsp;this&nbsp;a&nbsp;worthwhile&nbsp;tradeoff&amp;#39;.&lt;br&gt;&lt;br&gt;Currently&nbsp;a&nbsp;string&nbsp;has&nbsp;these&nbsp;two&nbsp;fields,&nbsp;an&nbsp;int&nbsp;and&nbsp;a&nbsp;char.&nbsp;Add&nbsp;in&nbsp;the&nbsp;object&nbsp;overhead&nbsp;of&nbsp;(i&nbsp;think)&nbsp;12&nbsp;bytes&nbsp;per&nbsp;object,&nbsp;you&amp;#39;re&nbsp;up&nbsp;to&nbsp;18&nbsp;bytes&nbsp;straight&nbsp;off&nbsp;for&nbsp;a&nbsp;zero&nbsp;length&nbsp;string.&nbsp;Lets&nbsp;assume&nbsp;that&nbsp;you&amp;#39;re&nbsp;only&nbsp;going&nbsp;to&nbsp;precalculate&nbsp;the&nbsp;hashcode&nbsp;for&nbsp;strings&nbsp;greater&nbsp;than&nbsp;length&nbsp;4.<br>
&lt;br&gt;&lt;br&gt;So,&nbsp;take&nbsp;the&nbsp;case&nbsp;of&nbsp;a&nbsp;string&nbsp;of&nbsp;length&nbsp;5.&nbsp;This&nbsp;puts&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;string&nbsp;at&nbsp;18&nbsp;+&nbsp;5*2&nbsp;=&nbsp;28&nbsp;bytes.&nbsp;Adding&nbsp;4&nbsp;bytes&nbsp;to&nbsp;this&nbsp;is&nbsp;15%&nbsp;extra&nbsp;memory&nbsp;usage.&nbsp;As&nbsp;string&nbsp;length&nbsp;goes&nbsp;up,&nbsp;this&nbsp;%&nbsp;goes&nbsp;down.&lt;br&gt;&lt;br&gt;I&amp;#39;m&nbsp;unsure&nbsp;what&nbsp;%&nbsp;speedup&nbsp;precalculating&nbsp;the&nbsp;hashcode&nbsp;would&nbsp;result&nbsp;in,&nbsp;but&nbsp;i&amp;#39;m&nbsp;sure&nbsp;someone&nbsp;could&nbsp;run&nbsp;a&nbsp;few&nbsp;benchmarks&nbsp;if&nbsp;they&nbsp;have&nbsp;the&nbsp;time&nbsp;free.&nbsp;You&nbsp;could&nbsp;say&nbsp;that&nbsp;you&nbsp;want&nbsp;at&nbsp;least&nbsp;a&nbsp;5x&nbsp;or&nbsp;maybe&nbsp;10x&nbsp;improvement&nbsp;before&nbsp;it&nbsp;becomes&nbsp;worthwhile,&nbsp;this&nbsp;would&nbsp;then&nbsp;put&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;string&nbsp;length&nbsp;to&nbsp;make&nbsp;it&nbsp;worthwhile.<br>
&lt;br&gt;&lt;br&gt;Alan.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Dec&nbsp;1,&nbsp;2007&nbsp;5:29&nbsp;PM,&nbsp;Robert&nbsp;Jordan&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:robertj@gmx.net&quot;&gt;robertj@gmx.net&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hi&nbsp;Alan,&lt;br&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;Alan&nbsp;McGovern&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;Also,&nbsp;just&nbsp;looking&nbsp;at&nbsp;the&nbsp;string&nbsp;source&nbsp;a&nbsp;bit&nbsp;more&nbsp;closely,&nbsp;it&nbsp;has&nbsp;a&lt;br&gt;&amp;gt;&nbsp;GetCaseInsensitiveHashcode&nbsp;method&nbsp;too,&nbsp;so&nbsp;i&amp;#39;d&nbsp;assume&nbsp;that&nbsp;would&nbsp;need&nbsp;to&nbsp;be&lt;br&gt;<br>
&amp;gt;&nbsp;cached&nbsp;too&nbsp;which&nbsp;would&nbsp;mean&nbsp;8&nbsp;bytes&nbsp;would&nbsp;be&nbsp;needed.&nbsp;This&nbsp;wouldn&amp;#39;t&nbsp;scale&lt;br&gt;&amp;gt;&nbsp;well.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Fair&nbsp;enough.&nbsp;Twas&nbsp;just&nbsp;an&nbsp;idea.&lt;br&gt;&lt;br&gt;&lt;/div&gt;nah,&nbsp;don&amp;#39;t&nbsp;give&nbsp;up&nbsp;too&nbsp;early!&nbsp;:)&nbsp;If&nbsp;the&nbsp;string&nbsp;is&nbsp;longer&nbsp;than&nbsp;&amp;quot;n&amp;quot;,<br>
&lt;br&gt;you&nbsp;could&nbsp;allocate&nbsp;4&nbsp;or&nbsp;even&nbsp;8&nbsp;additional&nbsp;bytes&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&lt;br&gt;array&nbsp;for&nbsp;lazily&nbsp;computed&nbsp;hash&nbsp;codes.&lt;br&gt;&lt;br&gt;Open&nbsp;questions:&lt;br&gt;&lt;br&gt;-&nbsp;What&amp;#39;s&nbsp;the&nbsp;optimal&nbsp;&amp;quot;n&amp;quot;&nbsp;for&nbsp;all&nbsp;common&nbsp;application&nbsp;classes&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;mono&nbsp;is&nbsp;used&nbsp;for?&nbsp;:)&nbsp;It&nbsp;looks&nbsp;like&nbsp;it&nbsp;should&nbsp;be&nbsp;dynamically<br>
&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;computed&nbsp;&amp;amp;&nbsp;adjusted&nbsp;based&nbsp;on&nbsp;profiling&nbsp;data&nbsp;collected&nbsp;at&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;runtime.&lt;br&gt;&lt;br&gt;-&nbsp;What&amp;#39;s&nbsp;the&nbsp;real&nbsp;gain&nbsp;of&nbsp;this&nbsp;optimization?&nbsp;If&nbsp;&amp;quot;n&amp;quot;&nbsp;tends&nbsp;to&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;be&nbsp;really&nbsp;large&nbsp;(say&nbsp;1-4KB),&nbsp;what&amp;#39;s&nbsp;the&nbsp;probability&nbsp;of<br>
&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;such&nbsp;large&nbsp;strings&nbsp;being&nbsp;used&nbsp;as&nbsp;a&nbsp;hash&nbsp;key?&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;This&nbsp;question&nbsp;can&nbsp;be&nbsp;reduced&nbsp;to&nbsp;&amp;quot;how&nbsp;frequently&nbsp;is&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;s.GetHashCode&nbsp;called,&nbsp;where&nbsp;s.Length&nbsp;&amp;gt;&nbsp;n&amp;quot;.&lt;br&gt;&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;In&nbsp;mono&amp;#39;s&nbsp;class&nbsp;libs&nbsp;sources&nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;place&nbsp;(I&nbsp;know<br>
&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;of)&nbsp;where&nbsp;large&nbsp;strings&nbsp;are&nbsp;potentially&nbsp;hashed:&nbsp;Sys.Web&amp;#39;s&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;cache&nbsp;management.&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;&lt;br&gt;Robert&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list<br>
&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
