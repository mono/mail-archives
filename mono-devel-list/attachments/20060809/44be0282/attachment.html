<tt>
Here&nbsp;is&nbsp;another&nbsp;patch&nbsp;for&nbsp;COM&nbsp;Interop.&lt;br&gt;&lt;br&gt;1.&nbsp;Corrected&nbsp;marshalling&nbsp;when&nbsp;MarshalAs&nbsp;is&nbsp;specified&nbsp;as&nbsp;IDispatch&nbsp;or&nbsp;IUnknown.&lt;br&gt;2.&nbsp;Added&nbsp;null&nbsp;checks&nbsp;to&nbsp;marshalling&nbsp;code&lt;br&gt;3.&nbsp;Added&nbsp;is_com_object&nbsp;field&nbsp;to&nbsp;classes.&nbsp;This&nbsp;is&nbsp;required&nbsp;because&nbsp;it&nbsp;is&nbsp;possible&nbsp;to&nbsp;derive&nbsp;from&nbsp;a&nbsp;ComImport&nbsp;attributed&nbsp;type.&nbsp;Thus&nbsp;the&nbsp;current&nbsp;type&nbsp;where&nbsp;the&nbsp;method&nbsp;is&nbsp;defined&nbsp;is&nbsp;not&nbsp;marked&nbsp;with&nbsp;the&nbsp;attribute,&nbsp;but&nbsp;a&nbsp;supertype&nbsp;is.<br>
&lt;br&gt;4.&nbsp;Added&nbsp;tests&nbsp;and&nbsp;fixed&nbsp;QueryInterface&nbsp;implementation&nbsp;so&nbsp;that&nbsp;test&nbsp;runs&nbsp;successfully&nbsp;on&nbsp;.Net.&lt;br&gt;5.&nbsp;Fixed&nbsp;cominterop_get_com_slot_for_method&nbsp;to&nbsp;look&nbsp;on&nbsp;interface&nbsp;where&nbsp;method&nbsp;is&nbsp;defined,&nbsp;not&nbsp;on&nbsp;implementing&nbsp;class,&nbsp;for&nbsp;attributes.<br>
&lt;br&gt;&lt;br&gt;The&nbsp;only&nbsp;minor&nbsp;thing&nbsp;is&nbsp;whether&nbsp;I&nbsp;should&nbsp;have&nbsp;IsCOMObjectImpl&nbsp;be&nbsp;an&nbsp;internal&nbsp;call&nbsp;and&nbsp;simply&nbsp;check&nbsp;the&nbsp;is_com_object&nbsp;flag&nbsp;of&nbsp;the&nbsp;class?&nbsp;This&nbsp;seems&nbsp;to&nbsp;make&nbsp;sense,&nbsp;but&nbsp;not&nbsp;sure&nbsp;whether&nbsp;I&nbsp;should&nbsp;add&nbsp;an&nbsp;internal&nbsp;call&nbsp;if&nbsp;I&nbsp;can&nbsp;do&nbsp;it&nbsp;in&nbsp;managed&nbsp;(albeit&nbsp;less&nbsp;efficiently).<br>
&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Jonathan&lt;br&gt;<br>

</tt>
