<tt>
&lt;html&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;id=&quot;owaParaStyle&quot;&gt;P&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px<br>
}<br>
&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;fPStyle=&quot;1&quot;&nbsp;ocsi=&quot;0&quot;&gt;<br>
&lt;div&nbsp;style=&quot;direction:&nbsp;ltr;font-family:&nbsp;Tahoma;color:&nbsp;#000000;font-size:&nbsp;10pt;&quot;&gt;<br>
&lt;div&nbsp;style=&quot;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px&quot;&gt;Hi&nbsp;Greg,&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px&quot;&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px&quot;&gt;Great&nbsp;input.&nbsp;I&nbsp;have&nbsp;not&nbsp;gotten&nbsp;that&nbsp;far&nbsp;yet.&nbsp;Also&nbsp;the&nbsp;cache&nbsp;level&nbsp;is&nbsp;very&nbsp;naïve.&nbsp;Everything&nbsp;caches&nbsp;except&nbsp;Bypass&nbsp;cache&nbsp;which&nbsp;doesn't&nbsp;cache.&nbsp;To&nbsp;check&nbsp;the&nbsp;headers&nbsp;it&nbsp;would&nbsp;check&nbsp;the&nbsp;WebResponse&nbsp;Headers&nbsp;property&nbsp;coming<br>
&nbsp;into&nbsp;TryInsert&nbsp;in&nbsp;&lt;font&nbsp;face=&quot;Consolas&quot;&gt;DirectoryBackedResponseCache.cs&lt;/font&gt;&nbsp;.&nbsp;I&nbsp;would&nbsp;combine&nbsp;the&nbsp;result&nbsp;of&nbsp;checking&nbsp;the&nbsp;header&nbsp;with&nbsp;the&nbsp;conditional&nbsp;ShouldCache&nbsp;which&nbsp;also&nbsp;needs&nbsp;work.&nbsp;&nbsp;What&nbsp;we&nbsp;are&nbsp;looking&nbsp;for&nbsp;is&nbsp;comments&nbsp;like&nbsp;this,&nbsp;about&nbsp;what&nbsp;you&nbsp;think<br>
&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;a&nbsp;usable&nbsp;implementation,&nbsp;gotchas,&nbsp;things&nbsp;to&nbsp;look&nbsp;out&nbsp;for.&nbsp;Also&nbsp;if&nbsp;we&nbsp;are&nbsp;on&nbsp;the&nbsp;wrong&nbsp;track&nbsp;doing&nbsp;it&nbsp;this&nbsp;way&nbsp;I&nbsp;don't&nbsp;want&nbsp;to&nbsp;waste&nbsp;time&nbsp;doing&nbsp;something&nbsp;which&nbsp;will&nbsp;not&nbsp;be&nbsp;useful.&nbsp;Assuming&nbsp;I'm&nbsp;not&nbsp;on&nbsp;the&nbsp;wrong&nbsp;path,&nbsp;I&nbsp;will&nbsp;add&nbsp;the&nbsp;header&nbsp;check<br>
&nbsp;next.&nbsp;This&nbsp;is&nbsp;the&nbsp;kind&nbsp;of&nbsp;feedback&nbsp;we&nbsp;need.&nbsp;I&nbsp;only&nbsp;tried&nbsp;to&nbsp;make&nbsp;a&nbsp;prototype&nbsp;of&nbsp;how&nbsp;caching&nbsp;could&nbsp;work&nbsp;and&nbsp;then&nbsp;did&nbsp;some&nbsp;performance&nbsp;measurements.&nbsp;Obviously&nbsp;didn't&nbsp;add&nbsp;any&nbsp;of&nbsp;the&nbsp;details&nbsp;yet.&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;viable&nbsp;approach&nbsp;I&nbsp;will&nbsp;continue&nbsp;to&nbsp;fill&nbsp;out&nbsp;the&nbsp;implementation<br>
&nbsp;guided&nbsp;by&nbsp;research&nbsp;and&nbsp;suggestions.&nbsp;Probably&nbsp;want&nbsp;to&nbsp;limit&nbsp;it&nbsp;to&nbsp;what&nbsp;we&nbsp;really&nbsp;need&nbsp;to&nbsp;have.&nbsp;Any&nbsp;other&nbsp;suggestions,&nbsp;comments,&nbsp;criticism&nbsp;would&nbsp;be&nbsp;greatly&nbsp;appreciated.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px&quot;&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px&quot;&gt;Thanks,&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;FONT-SIZE:&nbsp;16px;&nbsp;FONT-FAMILY:&nbsp;Times&nbsp;New&nbsp;Roman;&nbsp;COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRpF947956&quot;&nbsp;style=&quot;DIRECTION:&nbsp;ltr&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;size=&quot;2&quot;&nbsp;face=&quot;Tahoma&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;Greg&nbsp;Young&nbsp;[gregoryyoung1@gmail.com]&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Tuesday,&nbsp;June&nbsp;04,&nbsp;2013&nbsp;6:49&nbsp;PM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;Mark&nbsp;Lintner&lt;br&gt;<br>
&lt;b&gt;Cc:&lt;/b&gt;&nbsp;mono-devel-list@lists.ximian.com&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[Mono-dev]&nbsp;mono&nbsp;WebResponse&nbsp;caching&lt;br&gt;<br>
&lt;/font&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;would&nbsp;expect&nbsp;this&nbsp;to&nbsp;look&nbsp;at&nbsp;http&nbsp;caching&nbsp;headers&nbsp;in&nbsp;response&nbsp;when&nbsp;caching&nbsp;such&nbsp;as&nbsp;expiration,&nbsp;whether&nbsp;something&nbsp;is&nbsp;cachable&nbsp;(public/private)&nbsp;&lt;span&gt;&lt;/span&gt;etc&nbsp;but&nbsp;don't&nbsp;see&nbsp;any&nbsp;of&nbsp;that&nbsp;code&nbsp;(or&nbsp;maybe&nbsp;I&nbsp;missed&nbsp;it).&nbsp;Can&nbsp;you&nbsp;point&nbsp;to&nbsp;where&nbsp;it&nbsp;is&nbsp;in&nbsp;your<br>
&nbsp;implementation?&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Tuesday,&nbsp;June&nbsp;4,&nbsp;2013,&nbsp;Mark&nbsp;Lintner&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;PADDING-LEFT:&nbsp;1ex;&nbsp;MARGIN:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;BORDER-LEFT:&nbsp;#ccc&nbsp;1px&nbsp;solid&quot;&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;Tahoma;&nbsp;DIRECTION:&nbsp;ltr&quot;&gt;<br>
&lt;p&gt;We&nbsp;have&nbsp;noticed&nbsp;that&nbsp;parts&nbsp;of&nbsp;the&nbsp;Mono&nbsp;Web&nbsp;functionality&nbsp;are&nbsp;not&nbsp;yet&nbsp;implemented.&nbsp;We&nbsp;are&nbsp;hoping&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;add&nbsp;some&nbsp;of&nbsp;these&nbsp;missing&nbsp;pieces.&nbsp;Caching&nbsp;of<br>
&lt;/p&gt;<br>
&lt;p&gt;HttpWebResponses&nbsp;is&nbsp;the&nbsp;first&nbsp;one&nbsp;we&nbsp;took&nbsp;a&nbsp;look&nbsp;at.&nbsp;It&nbsp;would&nbsp;appear&nbsp;that&nbsp;Microsoft&nbsp;takes&nbsp;advantage&nbsp;of&nbsp;the&nbsp;internet&nbsp;explorer&nbsp;caching.&nbsp;Since&nbsp;it&nbsp;would&nbsp;appear<br>
&lt;/p&gt;<br>
&lt;p&gt;that&nbsp;an&nbsp;HttpWebResponse&nbsp;is&nbsp;fully&nbsp;populated&nbsp;when&nbsp;it&nbsp;is&nbsp;returned&nbsp;from&nbsp;the&nbsp;cache&nbsp;and&nbsp;the&nbsp;only&nbsp;content&nbsp;in&nbsp;the&nbsp;urls&nbsp;that&nbsp;are&nbsp;cached&nbsp;are&nbsp;the&nbsp;bytes&nbsp;that&nbsp;come&nbsp;in&nbsp;on<br>
&lt;/p&gt;<br>
&lt;p&gt;the&nbsp;wire,&nbsp;Microsoft&nbsp;must&nbsp;return&nbsp;things&nbsp;from&nbsp;the&nbsp;cache&nbsp;at&nbsp;a&nbsp;very&nbsp;low&nbsp;level&nbsp;and&nbsp;and&nbsp;let&nbsp;the&nbsp;response&nbsp;populate&nbsp;the&nbsp;normal&nbsp;way.&nbsp;This&nbsp;did&nbsp;not&nbsp;seem&nbsp;possible&nbsp;to<br>
&lt;/p&gt;<br>
&lt;p&gt;emulate&nbsp;when&nbsp;I&nbsp;looked&nbsp;at&nbsp;mono.&nbsp;I&nbsp;also&nbsp;wanted&nbsp;to&nbsp;cache&nbsp;to&nbsp;a&nbsp;directory&nbsp;so&nbsp;that&nbsp;the&nbsp;urls&nbsp;can&nbsp;be&nbsp;inspected&nbsp;or&nbsp;deleted.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&nbsp;After&nbsp;looking&nbsp;at&nbsp;the&nbsp;code&nbsp;for&nbsp;awhile&nbsp;I&nbsp;realized&nbsp;that&nbsp;I&nbsp;could&nbsp;save&nbsp;additional&nbsp;information&nbsp;from&nbsp;the&nbsp;response,&nbsp;ie:&nbsp;headercollection,&nbsp;cookiecontainer,&nbsp;Status<br>
&lt;/p&gt;<br>
&lt;p&gt;code&nbsp;etc&nbsp;in&nbsp;the&nbsp;same&nbsp;file&nbsp;as&nbsp;the&nbsp;responsestream.&nbsp;A&nbsp;response&nbsp;can&nbsp;be&nbsp;serialized&nbsp;but&nbsp;not&nbsp;all&nbsp;of&nbsp;it,&nbsp;most&nbsp;importantly&nbsp;the&nbsp;responsestream&nbsp;is&nbsp;not&nbsp;serialized.&nbsp;I<br>
&lt;/p&gt;<br>
&lt;p&gt;wrote&nbsp;a&nbsp;prototype&nbsp;with&nbsp;some&nbsp;helper&nbsp;functions,&nbsp;the&nbsp;only&nbsp;change&nbsp;to&nbsp;existing&nbsp;mono&nbsp;code&nbsp;would&nbsp;be&nbsp;in&nbsp;&nbsp;HttpWebRequest.GetResponse.&nbsp;Before&nbsp;calling&nbsp;BeginGetResponse<br>
&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;call&nbsp;a&nbsp;function&nbsp;that&nbsp;tries&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;url&nbsp;from&nbsp;the&nbsp;cache.&nbsp;If&nbsp;it&nbsp;is&nbsp;not&nbsp;there,&nbsp;BeginGetResponse&nbsp;is&nbsp;called&nbsp;as&nbsp;normal,&nbsp;the&nbsp;response&nbsp;is&nbsp;grabbed&nbsp;from<br>
&lt;/p&gt;<br>
&lt;p&gt;EndGetResponse&nbsp;and&nbsp;passed&nbsp;to&nbsp;a&nbsp;method&nbsp;to&nbsp;insert&nbsp;into&nbsp;the&nbsp;cache.&nbsp;This&nbsp;insert&nbsp;method&nbsp;will&nbsp;open&nbsp;a&nbsp;filename&nbsp;in&nbsp;a&nbsp;directory&nbsp;designated&nbsp;as&nbsp;mono_cache&nbsp;with&nbsp;the&nbsp;name<br>
&lt;/p&gt;<br>
&lt;p&gt;produced&nbsp;by&nbsp;calling&nbsp;HttpUtility.Encode&nbsp;so&nbsp;it&nbsp;is&nbsp;a&nbsp;legal&nbsp;filename.&nbsp;Also&nbsp;you&nbsp;can&nbsp;only&nbsp;read&nbsp;from&nbsp;the&nbsp;responsestream&nbsp;once,&nbsp;which&nbsp;means&nbsp;that&nbsp;if&nbsp;read&nbsp;from&nbsp;it,&nbsp;save<br>
&lt;/p&gt;<br>
&lt;p&gt;it&nbsp;to&nbsp;a&nbsp;file,&nbsp;then&nbsp;the&nbsp;responsestream&nbsp;is&nbsp;no&nbsp;longer&nbsp;accessible&nbsp;from&nbsp;the&nbsp;WebResponse&nbsp;when&nbsp;it&nbsp;is&nbsp;returned&nbsp;to&nbsp;the&nbsp;calling&nbsp;code.&nbsp;If&nbsp;sream&nbsp;copy&nbsp;worked&nbsp;it&nbsp;could&nbsp;be<br>
&lt;/p&gt;<br>
&lt;p&gt;used&nbsp;here.&nbsp;One&nbsp;way&nbsp;to&nbsp;fix&nbsp;the&nbsp;problem&nbsp;is&nbsp;to&nbsp;call&nbsp;GetResponseStream(),&nbsp;read&nbsp;it&nbsp;to&nbsp;the&nbsp;end,&nbsp;which&nbsp;produces&nbsp;a&nbsp;string,&nbsp;then&nbsp;finally&nbsp;convert&nbsp;the&nbsp;string&nbsp;to&nbsp;bytes.<br>
&lt;/p&gt;<br>
&lt;p&gt;Then&nbsp;you&nbsp;can&nbsp;serialize&nbsp;the&nbsp;bytes&nbsp;to&nbsp;the&nbsp;open&nbsp;file,&nbsp;serialize&nbsp;the&nbsp;headercollection&nbsp;and&nbsp;ultimately&nbsp;individually&nbsp;add&nbsp;any&nbsp;field&nbsp;you&nbsp;want&nbsp;in&nbsp;the&nbsp;response&nbsp;when&nbsp;it<br>
&lt;/p&gt;<br>
&lt;p&gt;is&nbsp;retrieved&nbsp;from&nbsp;the&nbsp;cache,&nbsp;then&nbsp;close&nbsp;the&nbsp;file.&nbsp;Then&nbsp;create&nbsp;a&nbsp;new&nbsp;WebConnectionData&nbsp;instance&nbsp;and&nbsp;populate&nbsp;it&nbsp;with&nbsp;headers&nbsp;and&nbsp;all&nbsp;the&nbsp;relevent&nbsp;fields&nbsp;from<br>
&lt;/p&gt;<br>
&lt;p&gt;the&nbsp;old&nbsp;response,&nbsp;finally&nbsp;passing&nbsp;the&nbsp;bytes&nbsp;of&nbsp;data&nbsp;to&nbsp;a&nbsp;memory&nbsp;stream&nbsp;constructor&nbsp;and&nbsp;assign&nbsp;it&nbsp;to&nbsp;the&nbsp;WebConnectionData's&nbsp;stream&nbsp;member.&nbsp;Then&nbsp;I&nbsp;construct&nbsp;a<br>
&lt;/p&gt;<br>
&lt;p&gt;new&nbsp;HttpWebResponse,&nbsp;passing&nbsp;the&nbsp;WebConnectionData&nbsp;and&nbsp;other&nbsp;arguments&nbsp;which&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;existing&nbsp;request&nbsp;and&nbsp;the&nbsp;recently&nbsp;retrieved&nbsp;response.&nbsp;The<br>
&lt;/p&gt;<br>
&lt;p&gt;response&nbsp;is&nbsp;then&nbsp;returned&nbsp;to&nbsp;getResponse&nbsp;then&nbsp;finally&nbsp;to&nbsp;the&nbsp;calling&nbsp;code,&nbsp;good&nbsp;as&nbsp;new.&nbsp;Next&nbsp;time&nbsp;the&nbsp;url&nbsp;is&nbsp;requested&nbsp;the&nbsp;cached&nbsp;file&nbsp;is&nbsp;deserialized,&nbsp;one<br>
&lt;/p&gt;<br>
&lt;p&gt;member&nbsp;at&nbsp;a&nbsp;time&nbsp;then&nbsp;a&nbsp;WebConnectionData&nbsp;is&nbsp;setup&nbsp;and&nbsp;finally,&nbsp;a&nbsp;HttpWebResponse&nbsp;is&nbsp;constructed&nbsp;with&nbsp;the&nbsp;info&nbsp;read&nbsp;from&nbsp;the&nbsp;file,&nbsp;the&nbsp;WebConnectionData&nbsp;and<br>
&lt;/p&gt;<br>
&lt;p&gt;from&nbsp;the&nbsp;members&nbsp;of&nbsp;the&nbsp;new&nbsp;request.&nbsp;I&nbsp;concentrated&nbsp;on&nbsp;prototyping&nbsp;caching&nbsp;of&nbsp;HttpWebResponses.&nbsp;Only&nbsp;a&nbsp;simple&nbsp;cache&nbsp;algorithm,&nbsp;no&nbsp;Ftp,&nbsp;no&nbsp;File&nbsp;etc.&nbsp;No&nbsp;cache<br>
&lt;/p&gt;<br>
&lt;p&gt;aging&nbsp;etc.&nbsp;There&nbsp;are&nbsp;many&nbsp;other&nbsp;things&nbsp;that&nbsp;would&nbsp;have&nbsp;to&nbsp;be&nbsp;done&nbsp;for&nbsp;this&nbsp;to&nbsp;be&nbsp;usable.<br>
&lt;br&gt;<br>
&nbsp;&nbsp;Using&nbsp;the&nbsp;prototype&nbsp;I&nbsp;requested&nbsp;&lt;a&nbsp;href=&quot;http://www.google.com&quot;&nbsp;target=&quot;_blank&quot;&gt;<br>
www.google.com&lt;/a&gt;&nbsp;and&nbsp;it&nbsp;took&nbsp;.1601419&nbsp;sec&nbsp;to&nbsp;retrieve&nbsp;and&nbsp;cache&nbsp;it,&nbsp;including&nbsp;all&nbsp;the&nbsp;mechanics&nbsp;described&nbsp;above.&nbsp;The<br>
&lt;/p&gt;<br>
&lt;p&gt;second&nbsp;time&nbsp;returning&nbsp;it&nbsp;from&nbsp;the&nbsp;cache,&nbsp;building&nbsp;the&nbsp;HttpWebResponse&nbsp;took&nbsp;.0007671.&nbsp;This&nbsp;is&nbsp;a&nbsp;288&nbsp;times&nbsp;speedup.&nbsp;That&nbsp;kind&nbsp;of&nbsp;performance&nbsp;increase,&nbsp;from&nbsp;a<br>
&lt;/p&gt;<br>
&lt;p&gt;prototype&nbsp;that&nbsp;is&nbsp;not&nbsp;yet&nbsp;optimized,&nbsp;is&nbsp;compelling.&nbsp;I&nbsp;must&nbsp;add&nbsp;that&nbsp;I&nbsp;measured&nbsp;the&nbsp;same&nbsp;experiment&nbsp;with&nbsp;google&nbsp;under&nbsp;the&nbsp;.Net&nbsp;4.5&nbsp;implementation&nbsp;and&nbsp;the<br>
&lt;/p&gt;<br>
&lt;p&gt;speedup&nbsp;is&nbsp;769x.&nbsp;Obviously&nbsp;thats&nbsp;something&nbsp;to&nbsp;work&nbsp;toward.&nbsp;Even&nbsp;falling&nbsp;short&nbsp;of&nbsp;that&nbsp;level&nbsp;of&nbsp;speedup,&nbsp;some&nbsp;implementation&nbsp;of&nbsp;response&nbsp;caching&nbsp;for&nbsp;mono<br>
&lt;/p&gt;<br>
&lt;p&gt;would&nbsp;greatly&nbsp;benefit&nbsp;the&nbsp;users&nbsp;who&nbsp;need&nbsp;better&nbsp;performance&nbsp;of&nbsp;services,&nbsp;rest&nbsp;etc.<br>
&lt;/p&gt;<br>
&lt;p&gt;So&nbsp;far&nbsp;this&nbsp;is&nbsp;the&nbsp;only&nbsp;mono&nbsp;code&nbsp;that&nbsp;would&nbsp;change&nbsp;to&nbsp;support&nbsp;caching,&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
from&nbsp;HttpWebRequest.cs:&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;public&nbsp;override&nbsp;WebResponse&nbsp;GetResponse()&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;{&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;WebResponse&nbsp;response&nbsp;=&nbsp;ResponseCache.TryRetrieve&nbsp;(this);&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;if&nbsp;(response&nbsp;==&nbsp;null)&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;{&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;&nbsp;WebAsyncResult&nbsp;result&nbsp;=&nbsp;(WebAsyncResult)&nbsp;BeginGetResponse&nbsp;(null,&nbsp;null);&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;EndGetResponse&nbsp;(result);&nbsp;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;&nbsp;response.IsFromCache&nbsp;=&nbsp;false;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;&nbsp;HttpWebResponse&nbsp;response2&nbsp;=&nbsp;ResponseCache.TryInsert&nbsp;((HttpWebRequest)this,&nbsp;(HttpWebResponse)response);&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;&nbsp;response.Close&nbsp;();&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;response2;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;}&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;&nbsp;return&nbsp;response;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&nbsp;}&lt;/p&gt;<br>
&lt;p&gt;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&gt;The&nbsp;code&nbsp;can&nbsp;stand&nbsp;some&nbsp;improvement.&nbsp;It&nbsp;is&nbsp;a&nbsp;prototype&nbsp;and&nbsp;it&nbsp;shows.&nbsp;&nbsp;I&nbsp;have&nbsp;included&nbsp;the&nbsp;file&nbsp;ResponseCache.cs&nbsp;which&nbsp;the&nbsp;above<br>
&lt;/p&gt;<br>
&lt;p&gt;code&nbsp;hooks&nbsp;into.&nbsp;We&nbsp;were&nbsp;wondering&nbsp;whether&nbsp;anyone&nbsp;has&nbsp;tried&nbsp;to&nbsp;implement&nbsp;response&nbsp;caching&nbsp;before&nbsp;and&nbsp;whether&nbsp;there&nbsp;is&nbsp;any&nbsp;intent&nbsp;to&nbsp;in&nbsp;the&nbsp;future.&nbsp;What&nbsp;are<br>
&lt;/p&gt;<br>
&lt;p&gt;your&nbsp;thoughts&nbsp;about&nbsp;the&nbsp;approach&nbsp;described&nbsp;above&nbsp;and&nbsp;shown&nbsp;in&nbsp;the&nbsp;ResponseCache.cs&nbsp;file&nbsp;and&nbsp;the&nbsp;3&nbsp;other&nbsp;files&nbsp;I&nbsp;included.&nbsp;Bear&nbsp;in&nbsp;mind&nbsp;it<br>
&lt;/p&gt;<br>
&lt;p&gt;would&nbsp;be&nbsp;refactored&nbsp;so&nbsp;that&nbsp;it&nbsp;fit&nbsp;into&nbsp;the&nbsp;mono&nbsp;architecture&nbsp;a&nbsp;bit&nbsp;better,&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;generalized,&nbsp;different&nbsp;strategies&nbsp;for&nbsp;different&nbsp;concrete&nbsp;response<br>
&lt;/p&gt;<br>
&lt;p&gt;types&nbsp;need&nbsp;to&nbsp;be&nbsp;plugged&nbsp;in,&nbsp;configuration.&nbsp;and&nbsp;a&nbsp;plethora&nbsp;of&nbsp;things&nbsp;I&nbsp;missed.&nbsp;If&nbsp;you&nbsp;feel&nbsp;this&nbsp;approach&nbsp;has&nbsp;merit&nbsp;I&nbsp;can&nbsp;detail&nbsp;all&nbsp;that&nbsp;seperatly.&nbsp;If&nbsp;you<br>
&lt;/p&gt;<br>
&lt;p&gt;feel&nbsp;a&nbsp;different&nbsp;approach&nbsp;would&nbsp;work&nbsp;better,&nbsp;please&nbsp;let&nbsp;us&nbsp;know,&nbsp;in&nbsp;the&nbsp;end&nbsp;were&nbsp;looking&nbsp;to&nbsp;make&nbsp;mono&nbsp;more&nbsp;robust&nbsp;in&nbsp;some&nbsp;of&nbsp;the&nbsp;ways&nbsp;that&nbsp;are&nbsp;expected&nbsp;but<br>
&lt;/p&gt;<br>
&lt;p&gt;not&nbsp;yet&nbsp;implemented.&nbsp;&lt;br&gt;<br>
&nbsp;The&nbsp;main&nbsp;thing&nbsp;I&nbsp;want&nbsp;to&nbsp;show&nbsp;here&nbsp;is&nbsp;how&nbsp;it&nbsp;is&nbsp;possible,&nbsp;to&nbsp;wedge&nbsp;a&nbsp;cache&nbsp;strategy&nbsp;into&nbsp;mono's&nbsp;request&nbsp;pipeline&nbsp;without&nbsp;changing&nbsp;or&nbsp;destabilizing<br>
&lt;/p&gt;<br>
&lt;p&gt;mono&nbsp;itself.&nbsp;The&nbsp;cache&nbsp;implementation&nbsp;could&nbsp;change&nbsp;also,&nbsp;which&nbsp;is&nbsp;one&nbsp;way&nbsp;that&nbsp;this&nbsp;is&nbsp;code&nbsp;falls&nbsp;short&nbsp;is&nbsp;it&nbsp;totally&nbsp;violates&nbsp;open-closed.&nbsp;&nbsp;Is&nbsp;this&nbsp;a<br>
&lt;/p&gt;<br>
&lt;p&gt;viable&nbsp;approach?&nbsp;There&nbsp;would&nbsp;of&nbsp;course&nbsp;be&nbsp;much&nbsp;more&nbsp;to&nbsp;do,&nbsp;that&nbsp;I&nbsp;have&nbsp;not&nbsp;even&nbsp;mentioned&nbsp;here.&nbsp;Your&nbsp;comments&nbsp;would&nbsp;be&nbsp;appreciated.&lt;/p&gt;<br>
&lt;p&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;span&nbsp;style=&quot;FONT-SIZE:&nbsp;11pt&quot;&gt;The&nbsp;files&nbsp;can&nbsp;be&nbsp;found&nbsp;here.&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;span&nbsp;style=&quot;FONT-SIZE:&nbsp;11pt&quot;&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://pastebin.com/FCefsiDx&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pastebin.com/FCefsiDx&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://pastebin.com/8qBh8mMW&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pastebin.com/8qBh8mMW&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://pastebin.com/xVKLaidG&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pastebin.com/xVKLaidG&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://pastebin.com/NMVNv30T&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pastebin.com/NMVNv30T&lt;/a&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;span&nbsp;style=&quot;FONT-SIZE:&nbsp;11pt&quot;&gt;&lt;/span&gt;&lt;/font&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;span&nbsp;style=&quot;FONT-SIZE:&nbsp;11pt&quot;&gt;&lt;/span&gt;&lt;/font&gt;&nbsp;&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Le&nbsp;doute&nbsp;n'est&nbsp;pas&nbsp;une&nbsp;condition&nbsp;agréable,&nbsp;mais&nbsp;la&nbsp;certitude&nbsp;est&nbsp;absurde.&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
