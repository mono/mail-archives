<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Hello&nbsp;all,&lt;br&gt;<br>
&lt;br&gt;<br>
I've&nbsp;taken&nbsp;some&nbsp;time&nbsp;to&nbsp;dig&nbsp;again&nbsp;into&nbsp;this&nbsp;issue&nbsp;and&nbsp;tried&nbsp;to&nbsp;answer<br>
some&nbsp;points&nbsp;mentioned&nbsp;in&nbsp;the&nbsp;thread&nbsp;(please&nbsp;correct&nbsp;me&nbsp;if&nbsp;I'm&nbsp;wrong!).<br>
Attached&nbsp;are&nbsp;the&nbsp;patch&nbsp;for&nbsp;DateTime.cs&nbsp;(nothing&nbsp;really&nbsp;changed&nbsp;since<br>
March)&nbsp;and&nbsp;the&nbsp;unit&nbsp;test.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;b&gt;-&nbsp;DateTime&nbsp;managed&nbsp;as&nbsp;a&nbsp;PrimitiveType&nbsp;by&nbsp;the&nbsp;BinaryFormatter?&lt;/b&gt;&lt;br&gt;<br>
I've&nbsp;not&nbsp;seen&nbsp;any&nbsp;indication&nbsp;on&nbsp;the&nbsp;fact&nbsp;.NET2.0's&nbsp;BinaryFormatter<br>
would&nbsp;not&nbsp;manage&nbsp;DateTime&nbsp;as&nbsp;a&nbsp;ISerializable&nbsp;but&nbsp;as&nbsp;a&nbsp;PrimitiveType.<br>
When&nbsp;you&nbsp;look&nbsp;at&nbsp;the&nbsp;binary&nbsp;array&nbsp;generated&nbsp;by&nbsp;the&nbsp;BinaryFormatter,&nbsp;you<br>
do&nbsp;have&nbsp;a&nbsp;two&nbsp;int64:&nbsp;the&nbsp;ticks&nbsp;and&nbsp;a&nbsp;int64&nbsp;in&nbsp;which&nbsp;you&nbsp;have&nbsp;both&nbsp;the<br>
ticks&nbsp;and&nbsp;the&nbsp;kind&nbsp;(as&nbsp;used&nbsp;in&nbsp;my&nbsp;patch).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;b&gt;-&nbsp;How&nbsp;.NET&nbsp;2.0&nbsp;stores&nbsp;DateTime&nbsp;internally?&lt;/b&gt;&lt;br&gt;<br>
To&nbsp;quote&nbsp;MSDN's&nbsp;page&nbsp;on&nbsp;DateTime:&lt;br&gt;<br>
&lt;blockquote&gt;<br>
&nbsp;&nbsp;&lt;h4&nbsp;class=&quot;subHeading&quot;&nbsp;xmlns=&quot;&quot;&gt;&lt;small&gt;Version&nbsp;Considerations&lt;/small&gt;&lt;/h4&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&gt;<br>
&nbsp;&nbsp;&lt;div&nbsp;class=&quot;subSection&quot;&nbsp;xmlns=&quot;&quot;&gt;&lt;small&gt;&nbsp;&lt;/small&gt;<br>
&nbsp;&nbsp;&lt;p&gt;&lt;small&gt;Prior&nbsp;to&nbsp;the&nbsp;.NET&nbsp;Framework&nbsp;version&nbsp;2.0,&nbsp;the&nbsp;&lt;b&gt;DateTime&lt;/b&gt;<br>
structure&nbsp;contains&nbsp;a&nbsp;64-bit&nbsp;field&nbsp;composed&nbsp;of&nbsp;an&nbsp;unused&nbsp;2-bit&nbsp;field<br>
concatenated&nbsp;with&nbsp;a&nbsp;private&nbsp;Ticks&nbsp;field,&nbsp;which&nbsp;is&nbsp;a&nbsp;62-bit&nbsp;unsigned<br>
field&nbsp;that&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;ticks&nbsp;that&nbsp;represent&nbsp;the&nbsp;date&nbsp;and<br>
time.&nbsp;The&nbsp;value&nbsp;of&nbsp;the&nbsp;Ticks&nbsp;field&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;the&nbsp;&lt;a<br>
&nbsp;href=&quot;P_System_DateTime_Ticks.htm&quot;&gt;Ticks&lt;/a&gt;&nbsp;property.&lt;/small&gt;&lt;/p&gt;<br>
&nbsp;&nbsp;&lt;small&gt;&nbsp;&lt;/small&gt;<br>
&nbsp;&nbsp;&lt;p&gt;&lt;small&gt;Starting&nbsp;with&nbsp;the&nbsp;.NET&nbsp;Framework&nbsp;2.0,&nbsp;the&nbsp;&lt;b&gt;DateTime&lt;/b&gt;<br>
structure&nbsp;contains&nbsp;a&nbsp;64-bit&nbsp;field&nbsp;composed&nbsp;of&nbsp;a&nbsp;private&nbsp;Kind&nbsp;field<br>
concatenated&nbsp;with&nbsp;the&nbsp;Ticks&nbsp;field.&nbsp;The&nbsp;Kind&nbsp;field&nbsp;is&nbsp;a&nbsp;2-bit&nbsp;field&nbsp;that<br>
indicates&nbsp;whether&nbsp;the&nbsp;&lt;b&gt;DateTime&lt;/b&gt;&nbsp;structure&nbsp;represents&nbsp;a&nbsp;local<br>
time,&nbsp;a&nbsp;Coordinated&nbsp;Universal&nbsp;Time&nbsp;(UTC),&nbsp;or&nbsp;whether&nbsp;UTC&nbsp;or&nbsp;local&nbsp;time<br>
is&nbsp;not&nbsp;specified.&nbsp;The&nbsp;Kind&nbsp;field&nbsp;is&nbsp;used&nbsp;to&nbsp;handle&nbsp;conversions&nbsp;between<br>
local&nbsp;and&nbsp;UTC&nbsp;time,&nbsp;but&nbsp;not&nbsp;time&nbsp;comparisons&nbsp;or&nbsp;arithmetic.&nbsp;The&nbsp;value<br>
of&nbsp;the&nbsp;Kind&nbsp;field&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;the&nbsp;&lt;a<br>
&nbsp;href=&quot;P_System_DateTime_Kind.htm&quot;&gt;Kind&lt;/a&gt;&nbsp;property.&lt;/small&gt;&lt;/p&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
If&nbsp;you&nbsp;want&nbsp;more&nbsp;details,&nbsp;see&nbsp;the&nbsp;#region&nbsp;ISerializable&amp;nbsp;&nbsp;at&nbsp;the&nbsp;bottom<br>
of&nbsp;DateTime.cs&nbsp;-&nbsp;it's&nbsp;commented&nbsp;there.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;b&gt;-&nbsp;Version&nbsp;compatibility&lt;/b&gt;&lt;br&gt;<br>
&quot;Will&nbsp;this&nbsp;break&nbsp;with&nbsp;older&nbsp;Mono&nbsp;implementations,&nbsp;say&nbsp;with&nbsp;data&nbsp;that<br>
was&nbsp;stored&nbsp;with&nbsp;old&nbsp;versions?&nbsp;It&nbsp;seems&nbsp;like&nbsp;you&nbsp;put&nbsp;some&nbsp;effort&nbsp;on&nbsp;not<br>
breaking.&quot;&lt;br&gt;<br>
No&nbsp;that&nbsp;won't&nbsp;break.&nbsp;My&nbsp;patch&nbsp;ensure&nbsp;backward&nbsp;compatibility,&nbsp;namely:&lt;br&gt;<br>
&lt;ul&gt;<br>
&nbsp;&nbsp;&lt;li&gt;Mono&nbsp;CLR&nbsp;1.1&nbsp;is&nbsp;not&nbsp;concerned&nbsp;by&nbsp;my&nbsp;patch&nbsp;(it&nbsp;could&nbsp;be)&nbsp;and<br>
remains&nbsp;not&nbsp;compatible&nbsp;with&nbsp;MS&nbsp;.NET&nbsp;1.1&nbsp;and&nbsp;2.x&lt;i&gt;&lt;b&gt;&lt;/b&gt;&lt;b&gt;&lt;/b&gt;&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/li&gt;<br>
&nbsp;&nbsp;&lt;li&gt;Mono&nbsp;CLR&nbsp;2.x&nbsp;not&nbsp;patched&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/li&gt;<br>
&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;is&nbsp;not&nbsp;compatible&nbsp;with&nbsp;MS&nbsp;.NET&nbsp;2.x&nbsp;(in&nbsp;both&nbsp;ways)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;is&nbsp;not&nbsp;able&nbsp;to&nbsp;deserialize&nbsp;data&nbsp;serialized&nbsp;with&nbsp;Mono&nbsp;CLR&nbsp;2.x<br>
patched&nbsp;(since&nbsp;the&nbsp;latter&nbsp;serializes&nbsp;its&nbsp;data&nbsp;by&nbsp;using&nbsp;MS&nbsp;.NET&nbsp;2.x<br>
format)&lt;/li&gt;<br>
&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&lt;li&gt;Mono&nbsp;for&nbsp;CLR&nbsp;2.x&nbsp;patched&lt;/li&gt;<br>
&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;serializes&nbsp;its&nbsp;data&nbsp;by&nbsp;using&nbsp;MS&nbsp;.NET&nbsp;2.x&nbsp;format&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;is&nbsp;able&nbsp;to&nbsp;read&nbsp;DateTime&nbsp;serialized&nbsp;with&nbsp;MS&nbsp;.NET&nbsp;1.1&nbsp;and&nbsp;2.x<br>
formats&nbsp;(MS&nbsp;.NET&nbsp;2.x&nbsp;has&nbsp;the&nbsp;same&nbsp;backward&nbsp;compatibility)&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;is&nbsp;able&nbsp;to&nbsp;read&nbsp;DateTime&nbsp;serialized&nbsp;with&nbsp;Mono&nbsp;for&nbsp;CLR&nbsp;1.x&nbsp;not<br>
patched&nbsp;and&nbsp;2.x&nbsp;not&nbsp;patched&nbsp;&lt;/li&gt;<br>
&nbsp;&nbsp;&lt;/ul&gt;<br>
&lt;/ul&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;b&gt;-&nbsp;Unit&nbsp;test&lt;/b&gt;&lt;br&gt;<br>
&quot;Would&nbsp;you&nbsp;mind&nbsp;providing&nbsp;NUnit&nbsp;test&nbsp;cases&nbsp;that&nbsp;would&nbsp;exercise&nbsp;the<br>
various&nbsp;binary&nbsp;formats?&nbsp;You&nbsp;could&nbsp;bundle&nbsp;the&nbsp;stuff&nbsp;as&nbsp;a&nbsp;binary&nbsp;blob&nbsp;in<br>
an&nbsp;array&nbsp;and&nbsp;test&nbsp;the&nbsp;various&nbsp;code&nbsp;paths.&quot;&lt;br&gt;<br>
Done.&nbsp;See&nbsp;DataTimeTest.cs&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;b&gt;-&nbsp;Soap&nbsp;issue&lt;/b&gt;&lt;br&gt;<br>
My&nbsp;hack&nbsp;works&nbsp;but&nbsp;it&nbsp;should&nbsp;be&nbsp;considered&nbsp;as&nbsp;temporary,&nbsp;as&nbsp;long&nbsp;as&nbsp;the<br>
issue&nbsp;in&nbsp;the&nbsp;Soap&nbsp;Serializer&nbsp;itself&nbsp;has&nbsp;not&nbsp;been&nbsp;solved.&nbsp;I'm&nbsp;missing<br>
both&nbsp;time&nbsp;and&nbsp;knowledge&nbsp;of&nbsp;the&nbsp;Soap&nbsp;serialization's&nbsp;internal&nbsp;mechanism<br>
to&nbsp;handle&nbsp;this...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
Lionel&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
