<tt>
<br>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
<br>
&lt;META&nbsp;content=&quot;text/html;&nbsp;charset=gb2312&quot;&nbsp;http-equiv=Content-Type&gt;<br>
&lt;META&nbsp;name=GENERATOR&nbsp;content=&quot;MSHTML&nbsp;8.00.7600.16625&quot;&gt;<br>
On&nbsp;Sun,&nbsp;2010-09-26&nbsp;at&nbsp;01:33&nbsp;-0700,&nbsp;oken&nbsp;wrote:&nbsp;<br>
&lt;DIV&nbsp;class=shrinkable-quote&gt;&lt;div&nbsp;class='shrinkable-quote'&gt;&lt;BR&gt;&amp;gt;&nbsp;#define&nbsp;VS(fun)&nbsp;\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;do{\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
GpStatus&nbsp;status&nbsp;=&nbsp;fun;&nbsp;\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;if&nbsp;(Ok&nbsp;!=&nbsp;status)&nbsp;\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;{\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
assert(!&quot;invalid&nbsp;status&quot;);\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;return&nbsp;status;\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;}\&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
}while(0)&nbsp;&lt;BR&gt;&amp;gt;&nbsp;int&nbsp;width&nbsp;=&nbsp;1000;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;int&nbsp;height&nbsp;=&nbsp;1000;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
GpStatus&nbsp;status&nbsp;=&nbsp;Ok;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;BYTE&nbsp;*scan0&nbsp;=&nbsp;NULL;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
VS(GdipCreateBitmapFromScan0(width,&nbsp;height,&nbsp;width&nbsp;*&nbsp;4,&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
PixelFormat32bppARGB,&nbsp;scan0,&nbsp;&amp;amp;m_bmp));&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
VS(GdipGetImageGraphicsContext(m_bmp,&nbsp;&amp;amp;m_pGraphics));&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
VS(GdipGraphicsClear(m_pGraphics,&nbsp;0xffffffff));&nbsp;&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
VS(GdipCreatePen1(0xa0f0a000,&nbsp;(REAL)2.0,&nbsp;UnitPixel,&nbsp;&amp;amp;m_pPen));&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
VS(GdipCreateSolidFill(0xa00000ff,&nbsp;&amp;amp;m_pSolidBrush));&nbsp;&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;<br>
VS(GdipSetPenColor(m_pPen,&nbsp;0xff0000ff));&nbsp;&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;<br>
&amp;lt;&nbsp;nTimes&nbsp;;&nbsp;i++)&nbsp;&lt;BR&gt;&amp;gt;&nbsp;{&nbsp;&lt;BR&gt;&amp;gt;&nbsp;VS(GdipDrawLine(m_pGraphics,&nbsp;m_pPen,&nbsp;100,&nbsp;<br>
100,&nbsp;500,&nbsp;500));&nbsp;&lt;BR&gt;&amp;gt;&nbsp;}&nbsp;&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;I&nbsp;also&nbsp;find&nbsp;that&nbsp;libgdiplus's&nbsp;<br>
performance&nbsp;is&nbsp;slow.&nbsp;&lt;/DIV&gt;&lt;/div&gt;libgdiplus&nbsp;main&nbsp;goal&nbsp;is&nbsp;compatibility,&nbsp;it's&nbsp;an&nbsp;<br>
extra&nbsp;layer&nbsp;on&nbsp;top&nbsp;of&nbsp;&lt;BR&gt;cairo&nbsp;and&nbsp;will&nbsp;never&nbsp;be&nbsp;a&nbsp;racing&nbsp;horse.&nbsp;OTOH&nbsp;your&nbsp;<br>
contributions&nbsp;to&nbsp;help&nbsp;&lt;BR&gt;performance,&nbsp;without&nbsp;hurting&nbsp;compatibility,&nbsp;is&nbsp;<br>
welcome.&nbsp;&lt;BR&gt;&lt;BR&gt;&amp;gt;&nbsp;In&nbsp;my&nbsp;example,&nbsp;drawing&nbsp;1000&nbsp;lines&nbsp;takes&nbsp;me&nbsp;5,000ms!&nbsp;<br>
&lt;BR&gt;&amp;gt;&nbsp;I&nbsp;find&nbsp;it&nbsp;that&nbsp;most&nbsp;of&nbsp;the&nbsp;time&nbsp;is&nbsp;consumed&nbsp;by&nbsp;&quot;cairo_stroke&quot;&nbsp;in&nbsp;<br>
&lt;BR&gt;&amp;gt;&nbsp;stroke_graphics_with_pen&nbsp;(GpGraphics&nbsp;*graphics,&nbsp;GpPen&nbsp;*pen).&nbsp;&lt;BR&gt;&amp;gt;&nbsp;I&nbsp;<br>
am&nbsp;calling&nbsp;libgdiplus's&nbsp;API&nbsp;under&nbsp;wine!&nbsp;&lt;BR&gt;&amp;gt;&nbsp;How&nbsp;to&nbsp;improve&nbsp;the&nbsp;performance?&nbsp;<br>
&lt;BR&gt;&lt;BR&gt;Does&nbsp;not&nbsp;wine&nbsp;ship&nbsp;its&nbsp;own&nbsp;libgdiplus&nbsp;?&nbsp;If&nbsp;you're&nbsp;using&nbsp;their&nbsp;version&nbsp;<br>
&lt;BR&gt;then&nbsp;you&nbsp;should&nbsp;ask&nbsp;them&nbsp;about&nbsp;their&nbsp;performance&nbsp;advice.&nbsp;&lt;BR&gt;&lt;BR&gt;If&nbsp;you're&nbsp;<br>
using&nbsp;Mono's&nbsp;libgdiplus&nbsp;then&nbsp;make&nbsp;sure&nbsp;you're&nbsp;using&nbsp;the&nbsp;latest&nbsp;&lt;BR&gt;(not&nbsp;the&nbsp;<br>
embedded)&nbsp;cairo.&nbsp;That&nbsp;will&nbsp;bring&nbsp;you&nbsp;all&nbsp;the&nbsp;performance&nbsp;work&nbsp;&lt;BR&gt;done&nbsp;by&nbsp;the&nbsp;<br>
cairo&nbsp;folks&nbsp;since&nbsp;cairo&nbsp;1.6.&nbsp;&lt;BR&gt;&lt;BR&gt;Sebastien&nbsp;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;Yes,&nbsp;I&nbsp;am&nbsp;using&nbsp;the&nbsp;<br>
latest&nbsp;cairo(1.8.10).&nbsp;It&nbsp;works&nbsp;faster&nbsp;than&nbsp;the&nbsp;embedded&nbsp;one.&nbsp;But&nbsp;not&nbsp;as&nbsp;I&nbsp;<br>
expect.&lt;BR&gt;It's&nbsp;very&nbsp;slow&nbsp;to&nbsp;draw&nbsp;lines&nbsp;on&nbsp;a&nbsp;WIN32&nbsp;surface.&lt;BR&gt;&lt;BR&gt;In&nbsp;my&nbsp;<br>
experience,&nbsp;tips&nbsp;to&nbsp;improve&nbsp;the&nbsp;performance&nbsp;of&nbsp;libgdiplus:&lt;BR&gt;1.&amp;nbsp;using&nbsp;the&nbsp;<br>
following&amp;nbsp;method&nbsp;to&nbsp;modify&nbsp;GpStatus&nbsp;cairo_SetGraphicsClip&nbsp;(GpGraphics&nbsp;<br>
*graphics)&nbsp;which&nbsp;is&nbsp;in&nbsp;graphics-cairo.c,&amp;nbsp;or&nbsp;cairo_clip&nbsp;is&nbsp;very&nbsp;slow.&lt;BR&gt;&quot;&nbsp;<br>
The&nbsp;trick&nbsp;to&nbsp;get&nbsp;fast&nbsp;clipping&nbsp;is&nbsp;to&nbsp;ensure&nbsp;the&nbsp;path&nbsp;is&nbsp;always&nbsp;aligned&nbsp;with&nbsp;<br>
integer&nbsp;positions&nbsp;on&nbsp;the&nbsp;device-pixel&nbsp;grid.&nbsp;And&nbsp;the&nbsp;easiest&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;to&nbsp;<br>
use&nbsp;an&nbsp;identity&nbsp;transformation,&nbsp;(&lt;CODE&gt;cairo_identity_matrix&lt;/CODE&gt;),&nbsp;and&nbsp;<br>
construct&nbsp;the&nbsp;path&nbsp;by&nbsp;calling&nbsp;&lt;CODE&gt;cairo_rectangle&lt;/CODE&gt;&nbsp;with&nbsp;integer&nbsp;<br>
values.&quot;&lt;BR&gt;&lt;A&nbsp;<br>
href=&quot;http://cairographics.org/FAQ/#clipping_performance&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;http://cairographics.org/FAQ/#clipping_performance&lt;/A&gt;&lt;BR&gt;2.do&nbsp;<br>
not&nbsp;use&nbsp;antialias&nbsp;whenever&nbsp;possible&lt;BR&gt;for&nbsp;example,&nbsp;GpStatus&nbsp;status&nbsp;=&nbsp;<br>
gdip_plot_path&nbsp;(graphics,&nbsp;path,&nbsp;TRUE);&nbsp;in&nbsp;cairo_FillPath&nbsp;should&nbsp;change&nbsp;TRUE&nbsp;to&nbsp;<br>
FALSE&lt;BR&gt;3.Do&nbsp;not&nbsp;stroke&amp;nbsp;whenever&nbsp;possible&lt;BR&gt;for&nbsp;example,&nbsp;GpStatus&nbsp;status&nbsp;<br>
=&nbsp;fill_graphics_with_brush&nbsp;(graphics,&nbsp;brush,&nbsp;TRUE);&amp;nbsp;in&nbsp;cairo_FillPath&nbsp;<br>
should&nbsp;change&nbsp;TRUE&nbsp;to&nbsp;FALSE&lt;BR&gt;&lt;BR&gt;They&nbsp;help&nbsp;improve&nbsp;the&nbsp;performance&nbsp;a&nbsp;lot,&nbsp;at&nbsp;<br>
lease&nbsp;in&nbsp;my&nbsp;test&nbsp;cases!&lt;BR&gt;&lt;BR&gt;_______________________________________________&nbsp;<br>
&lt;BR&gt;Mono-devel-list&nbsp;mailing&nbsp;list&nbsp;&lt;BR&gt;&lt;A&nbsp;href=&quot;/user/SendEmail.jtp?type=node&amp;amp;node=2715324&amp;amp;i=0&amp;by-user=t&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;<br>
target=_top&nbsp;link=&quot;external&quot;&gt;[hidden&nbsp;email]&lt;/A&gt;&nbsp;&lt;BR&gt;&lt;A&nbsp;<br>
href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;<br>
target=_top&nbsp;link=&quot;external&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/A&gt;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;<br>
&lt;HR&nbsp;color=#cccccc&nbsp;SIZE=1&nbsp;noShade&gt;<br>
<br>
&lt;DIV&nbsp;style=&quot;FONT:&nbsp;11px&nbsp;tahoma,geneva,helvetica,arial,sans-serif;&nbsp;COLOR:&nbsp;#666666&quot;&gt;View&nbsp;<br>
message&nbsp;@&nbsp;&lt;A&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/libgdiplus-drawing-performance-tp1537623p2715324.html?by-user=t&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;http://mono.1490590.n4.nabble.com/libgdiplus-drawing-performance-tp1537623p2715324.html&lt;/A&gt;&nbsp;<br>
&lt;BR&gt;To&nbsp;unsubscribe&nbsp;from&nbsp;libgdiplus&nbsp;drawing&nbsp;performance,&nbsp;&lt;A&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/template/TplServlet.jtp?tpl=unsubscribe_by_code&amp;amp;node=1537623&amp;amp;code=b2tlbmppYW5AMTYzLmNvbXwxNTM3NjIzfC0xODA5NDUwNTUw&amp;by-user=t&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;click&nbsp;<br>
here&lt;/A&gt;.&nbsp;&lt;/DIV&gt;&lt;BR&gt;<br>
<br>
&lt;br&gt;&lt;hr&nbsp;align=&quot;left&quot;&nbsp;width=&quot;300&quot;&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/libgdiplus-drawing-performance-tp1537623p2715378.html&quot;&gt;Re:&nbsp;libgdiplus&nbsp;drawing&nbsp;performance&lt;/a&gt;&lt;br&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/Mono-Dev-f1517221.html&quot;&gt;Mono&nbsp;-&nbsp;Dev&nbsp;mailing&nbsp;list&nbsp;archive&lt;/a&gt;&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>

</tt>
