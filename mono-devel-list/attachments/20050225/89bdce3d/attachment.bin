Index: mono/metadata/domain.c
===================================================================
--- mono/metadata/domain.c	(revision 41202)
+++ mono/metadata/domain.c	(working copy)
@@ -105,11 +105,9 @@
 gint32
 mono_domain_get_tls_offset (void)
 {
-	int offset = -1;
+	intptr_t offset;
 	MONO_THREAD_VAR_OFFSET (tls_appdomain, offset);
-/*	__asm ("jmp 1f; .section writetext, \"awx\"; 1: movl $tls_appdomain@ntpoff, %0; jmp 2f; .previous; 2:"
-		: "=r" (offset));*/
-	return offset;
+	return (gint32) offset;
 }

 static MonoJitInfoTable *
Index: mono/metadata/threads.c
===================================================================
--- mono/metadata/threads.c	(revision 41202)
+++ mono/metadata/threads.c	(working copy)
@@ -148,9 +148,9 @@
 gint32
 mono_thread_get_tls_offset (void)
 {
-	int offset;
+	intptr_t offset;
 	MONO_THREAD_VAR_OFFSET (tls_current_object,offset);
-	return offset;
+	return (gint32) offset;
 }

 /* handle_store() and handle_remove() manage the array of threads that
Index: mono/mini/mini.c
===================================================================
--- mono/mini/mini.c	(revision 41202)
+++ mono/mini/mini.c	(working copy)
@@ -7264,9 +7280,9 @@
 gint32
 mono_get_lmf_tls_offset (void)
 {
-	int offset;
+	intptr_t offset;
 	MONO_THREAD_VAR_OFFSET(mono_lmf_addr,offset);
-	return offset;
+	return (gint32) offset;
 }

 MonoLMF **
Index: mono/mini/mini-amd64.c
===================================================================
--- mono/mini/mini-amd64.c	(revision 41202)
+++ mono/mini/mini-amd64.c	(working copy)
@@ -5684,10 +5684,17 @@
 	if (!tls_offset_inited) {
 		tls_offset_inited = TRUE;

+		#if defined(PIC)
 		lmf_tls_offset = read_tls_offset_from_method (mono_get_lmf_addr);
 		appdomain_tls_offset = read_tls_offset_from_method (mono_domain_get);
 		//thread_tls_offset = read_tls_offset_from_method (mono_thread_current);
-	}
+		#endif
+		#if !defined(PIC)
+		appdomain_tls_offset = mono_domain_get_tls_offset ();
+		lmf_tls_offset = mono_get_lmf_tls_offset ();
+		thread_tls_offset = mono_thread_get_tls_offset ();
+		#endif
+	}

 #ifdef MONO_ARCH_SIGSEGV_ON_ALTSTACK

Index: mono/utils/mono-compiler.h
===================================================================
--- mono/utils/mono-compiler.h	(revision 41202)
+++ mono/utils/mono-compiler.h	(working copy)
@@ -10,17 +10,19 @@
 #if HAVE_TLS_MODEL_ATTR

 #if defined(PIC) && defined(__x86_64__)
-#define MONO_TLS_FAST
+#define MONO_TLS_FAST
 #else
 #define MONO_TLS_FAST __attribute__((tls_model("local-exec")))
 #endif

 #else
-#define MONO_TLS_FAST
+#define MONO_TLS_FAST
 #endif

 #if defined(__GNUC__) && defined(__i386__)
 #define MONO_THREAD_VAR_OFFSET(var,offset) __asm ("jmp 1f; .section writetext, \"awx\"; 1: movl $" #var "@ntpoff, %0; jmp 2f; .previous; 2:" : "=r" (offset));
+#elif defined(__GNUC__) && defined(__x86_64__) && !defined(PIC)
+#define MONO_THREAD_VAR_OFFSET(var,offset) __asm ("jmp 1f; .section writetext, \"awx\"; 1: movq $" #var "@tpoff, %0; jmp 2f; .previous; 2:" : "=r" (offset));
 #else
 #define MONO_THREAD_VAR_OFFSET(var,offset) (offset) = -1
 #endif
