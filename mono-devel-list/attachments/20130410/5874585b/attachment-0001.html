<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style&gt;Hi&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&#39;ve&nbsp;had&nbsp;a&nbsp;problems&nbsp;with&nbsp;FileStream&nbsp;under&nbsp;Mono&nbsp;(different&nbsp;versions,&nbsp;both&nbsp;2.10.x&nbsp;and&nbsp;3.0.x).&nbsp;It&nbsp;seems&nbsp;like&nbsp;some&nbsp;internal&nbsp;positioning&nbsp;problem,&nbsp;because&nbsp;instead&nbsp;of&nbsp;overwriting&nbsp;some&nbsp;parts&nbsp;of&nbsp;file,&nbsp;it&nbsp;just&nbsp;appends&nbsp;written&nbsp;data.&nbsp;It&nbsp;is&nbsp;very&nbsp;critical&nbsp;that&nbsp;the&nbsp;amount&nbsp;of&nbsp;bytes&nbsp;written&nbsp;is&nbsp;larger&nbsp;than&nbsp;internal&nbsp;buffer&nbsp;size.&nbsp;I&#39;ve&nbsp;managed&nbsp;to&nbsp;create&nbsp;small&nbsp;isolated&nbsp;test&nbsp;case&nbsp;that&nbsp;shows&nbsp;both&nbsp;what&nbsp;is&nbsp;necessary&nbsp;for&nbsp;bug&nbsp;to&nbsp;occur&nbsp;and&nbsp;easy&nbsp;workaround&nbsp;for&nbsp;that.&nbsp;But&nbsp;hopefully&nbsp;this&nbsp;will&nbsp;be&nbsp;fixed&nbsp;as&nbsp;this&nbsp;is&nbsp;core&nbsp;functionality.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&#39;ve&nbsp;filed&nbsp;a&nbsp;bug&nbsp;report&nbsp;here: &lt;a&nbsp;href=&quot;https://bugzilla.xamarin.com/show_bug.cgi?id=11699&quot;&gt;https://bugzilla.xamarin.com/show_bug.cgi?id=11699&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;using&nbsp;System;&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp;using&nbsp;System.IO;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;using&nbsp;NUnit.Framework;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;[TestFixture]&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;public&nbsp;class&nbsp;mono_filestream_bug&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;[Test]&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;public&nbsp;void&nbsp;show_time()&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const&nbsp;int&nbsp;pos&nbsp;=&nbsp;1;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const&nbsp;int&nbsp;bufferSize&nbsp;=&nbsp;128;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var&nbsp;filename&nbsp;=&nbsp;Path.GetTempFileName();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;File.WriteAllBytes(filename,&nbsp;new&nbsp;byte[pos&nbsp;+&nbsp;1]);&nbsp;//&nbsp;init&nbsp;file&nbsp;with&nbsp;zeros&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var&nbsp;bytes&nbsp;=&nbsp;new&nbsp;byte[bufferSize&nbsp;+&nbsp;1&nbsp;/*&nbsp;THIS&nbsp;IS&nbsp;WHAT&nbsp;MAKES&nbsp;A&nbsp;BIG&nbsp;DIFFERENCE&nbsp;*/];&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;new&nbsp;Random().NextBytes(bytes);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;using&nbsp;(var&nbsp;file&nbsp;=&nbsp;new&nbsp;FileStream(filename,&nbsp;FileMode.Open,&nbsp;FileAccess.ReadWrite,&nbsp;FileShare.Read,&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bufferSize,&nbsp;FileOptions.SequentialScan))&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;file.Read(new&nbsp;byte[pos],&nbsp;0,&nbsp;pos);&nbsp;//&nbsp;THIS&nbsp;READ&nbsp;IS&nbsp;CRITICAL,&nbsp;WITHOUT&nbsp;IT&nbsp;EVERYTHING&nbsp;WORKS&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Assert.AreEqual(pos,&nbsp;file.Position);&nbsp;//&nbsp;!!!&nbsp;here&nbsp;it&nbsp;says&nbsp;position&nbsp;is&nbsp;correct,&nbsp;but&nbsp;writes&nbsp;at&nbsp;different&nbsp;position&nbsp;!!!&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;file.Position&nbsp;=&nbsp;pos;&nbsp;//&nbsp;!!!&nbsp;this&nbsp;fixes&nbsp;test&nbsp;!!!&lt;/div&gt;&lt;div&gt;<br>
<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;file.Write(bytes,&nbsp;0,&nbsp;bytes.Length);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Assert.AreEqual(pos&nbsp;+&nbsp;bytes.Length,&nbsp;file.Length);&nbsp;--&nbsp;fails&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;using&nbsp;(var&nbsp;filestream&nbsp;=&nbsp;File.Open(filename,&nbsp;FileMode.Open,&nbsp;FileAccess.Read))&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var&nbsp;bb&nbsp;=&nbsp;new&nbsp;byte[bytes.Length];&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;filestream.Position&nbsp;=&nbsp;pos;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;filestream.Read(bb,&nbsp;0,&nbsp;bb.Length);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Assert.AreEqual(bytes,&nbsp;bb);&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Best&nbsp;regards,&lt;div&gt;Andrii&nbsp;Nakryiko&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
