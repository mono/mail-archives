<tt>
&lt;p&gt;I&nbsp;am&nbsp;writing&nbsp;OpenTK,&nbsp;a&nbsp;game&nbsp;development&nbsp;toolkit&nbsp;which&nbsp;makes&nbsp;extensive&nbsp;use&nbsp;of&nbsp;P/Invoke&nbsp;calls.&nbsp;On&nbsp;the&nbsp;Windows&nbsp;platform,&nbsp;I&nbsp;encountered&nbsp;some&nbsp;strange&nbsp;behavior&nbsp;regarding&nbsp;the&nbsp;MSG&nbsp;struct.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;In&nbsp;winuser.h,&nbsp;MSG&nbsp;is&nbsp;defined&nbsp;like&nbsp;this:<br>
&lt;/p&gt;&lt;p&gt;typedef&nbsp;struct&nbsp;tagMSG&nbsp;{&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hwnd;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;UINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;WPARAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wParam;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;LPARAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lParam;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;POINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pt;&lt;br&gt;#ifdef&nbsp;_MAC&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lPrivate;<br>
&lt;br&gt;#endif&lt;br&gt;}&amp;nbsp;MSG;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;The&nbsp;C#&nbsp;equivalent,&nbsp;as&nbsp;suggested&nbsp;at&nbsp;the&nbsp;.Net&nbsp;dev&nbsp;forums,&nbsp;would&nbsp;look&nbsp;like&nbsp;this:&lt;/p&gt;&lt;p&gt;[StructLayout(LayoutKind.Sequential),&nbsp;CLSCompliant(false)]&lt;br&gt;public&nbsp;struct&nbsp;MSG&lt;br&gt;{&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;IntPtr&nbsp;HWnd;<br>
&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;WindowMessage&nbsp;Message;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;IntPtr&nbsp;WParam;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;IntPtr&nbsp;LParam;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;uint&nbsp;Time;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;POINT&nbsp;Point;&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;override&nbsp;string&nbsp;ToString()&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&lt;br&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;String.Format(&amp;quot;msg=0x{0:x}&nbsp;({1})&nbsp;hwnd=0x{2:x}&nbsp;wparam=0x{3:x}&nbsp;lparam=0x{4:x}&nbsp;pt=0x{5:x}&amp;quot;,&nbsp;(int)Message,&nbsp;Message.ToString(),&nbsp;HWnd.ToInt32(),&nbsp;WParam.ToInt32(),&nbsp;LParam.ToInt32(),&nbsp;Point);&lt;br&gt;<br>
&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;}&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;However,&nbsp;Mono&amp;#39;s&nbsp;implementation&nbsp;in&nbsp;xplatui&nbsp;adds&nbsp;one&nbsp;more&nbsp;field&nbsp;to&nbsp;the&nbsp;struct:&lt;/p&gt;&lt;p&gt;[StructLayout(LayoutKind.Sequential),&nbsp;CLSCompliant(false)]&lt;br&gt;public&nbsp;struct&nbsp;MSG&lt;br&gt;{&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;IntPtr&nbsp;HWnd;<br>
&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;WindowMessage&nbsp;Message;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;IntPtr&nbsp;WParam;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;IntPtr&nbsp;LParam;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;uint&nbsp;Time;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;POINT&nbsp;Point;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&nbsp;public&nbsp;object&nbsp;RefObject;&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;override&nbsp;string&nbsp;ToString()<br>
&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;String.Format(&amp;quot;msg=0x{0:x}&nbsp;({1})&nbsp;hwnd=0x{2:x}&nbsp;wparam=0x{3:x}&nbsp;lparam=0x{4:x}&nbsp;pt=0x{5:x}&amp;quot;,&nbsp;(int)Message,&nbsp;Message.ToString(),&nbsp;HWnd.ToInt32(),&nbsp;WParam.ToInt32(),&nbsp;LParam.ToInt32<br>
(),&nbsp;Point);&lt;br&gt;&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;}&lt;br&gt;My&nbsp;guess&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;used&nbsp;for&nbsp;some&nbsp;kind&nbsp;of&nbsp;synchronization,&nbsp;but&nbsp;will&nbsp;this&nbsp;not&nbsp;corrupt&nbsp;the&nbsp;stack?&nbsp;Both&nbsp;seem&nbsp;to&nbsp;work&nbsp;correctly&nbsp;for&nbsp;extended&nbsp;periods&nbsp;of&nbsp;time&nbsp;on&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;platforms,&nbsp;which&nbsp;I&nbsp;find&nbsp;a&nbsp;little&nbsp;strange.&nbsp;Which&nbsp;is&nbsp;the&nbsp;correct&nbsp;one?&nbsp;What&nbsp;is&nbsp;RefObject&nbsp;doing&nbsp;there?<br>
&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;p&gt;Stephen&nbsp;A&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;<br>

</tt>
