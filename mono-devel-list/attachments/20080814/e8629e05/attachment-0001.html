<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Casey,&lt;br&gt;&lt;br&gt;We&nbsp;did&nbsp;a&nbsp;lot&nbsp;of&nbsp;work&nbsp;fixing&nbsp;many&nbsp;kinds&nbsp;of&nbsp;memory&nbsp;leaks&nbsp;under&nbsp;the&nbsp;runtime&nbsp;and&nbsp;JIT.&lt;br&gt;There&nbsp;are&nbsp;a&nbsp;few&nbsp;know&nbsp;issues,&nbsp;but&nbsp;none&nbsp;that&nbsp;would&nbsp;show&nbsp;in&nbsp;valgrind&nbsp;like&nbsp;this.&nbsp;And&nbsp;none&lt;br&gt;that&nbsp;would&nbsp;leak&nbsp;that&nbsp;much.&lt;br&gt;<br>
&lt;br&gt;I&amp;#39;ll&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;this&nbsp;issue&nbsp;in&nbsp;the&nbsp;comming&nbsp;days&nbsp;to&nbsp;see&nbsp;if&nbsp;I&nbsp;can&nbsp;narrow&nbsp;it&nbsp;down.&lt;br&gt;&lt;br&gt;In&nbsp;the&nbsp;mean&nbsp;time,&nbsp;do&nbsp;you&nbsp;mind&nbsp;sending&nbsp;the&nbsp;whole&nbsp;valgrind&nbsp;report?&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Rodrigo&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Thu,&nbsp;Aug&nbsp;14,&nbsp;2008&nbsp;at&nbsp;3:07&nbsp;PM,&nbsp;Casey&nbsp;Marshall&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:casey.s.marshall@gmail.com&quot;&gt;casey.s.marshall@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
I&amp;#39;ve&nbsp;been&nbsp;seeing&nbsp;a&nbsp;memory&nbsp;leak&nbsp;--&nbsp;or,&nbsp;maybe&nbsp;instead,&nbsp;&amp;quot;unbounded&nbsp;memory&lt;br&gt;<br>
growth&amp;quot;&nbsp;--&nbsp;while&nbsp;running&nbsp;MonoDevelop&nbsp;(SVN&nbsp;code&nbsp;of&nbsp;MD,&nbsp;mono-2-0&nbsp;SVN&nbsp;of&lt;br&gt;<br>
Mono).&nbsp;I&amp;#39;ve&nbsp;been&nbsp;running&nbsp;it&nbsp;under&nbsp;valgrind,&nbsp;and&nbsp;after&nbsp;running&nbsp;it&lt;br&gt;<br>
overnight,&nbsp;I&nbsp;find&nbsp;traces&nbsp;like&nbsp;this&nbsp;in&nbsp;the&nbsp;output:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;862,223,392&nbsp;bytes&nbsp;in&nbsp;1,737,838&nbsp;blocks&nbsp;are&nbsp;still&nbsp;reachable&nbsp;in&nbsp;loss&nbsp;record&nbsp;238&nbsp;of&nbsp;238&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;at&nbsp;0x4C21F8F:&nbsp;memalign&nbsp;(vg_replace_malloc.c:460)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x4C22028:&nbsp;posix_memalign&nbsp;(vg_replace_malloc.c:569)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x507D299:&nbsp;(within&nbsp;/usr/lib/libglib-2.0.so.0.1600.4)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x507E0F0:&nbsp;g_slice_alloc&nbsp;(in&nbsp;/usr/lib/libglib-2.0.so.0.1600.4)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x506035D:&nbsp;g_list_prepend&nbsp;(in&nbsp;/usr/lib/libglib-2.0.so.0.1600.4)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x432953:&nbsp;mono_arch_get_allocatable_int_vars&nbsp;(mini-amd64.c:910)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x5579A9:&nbsp;mini_method_compile&nbsp;(mini.c:12490)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x558CF8:&nbsp;mono_jit_compile_method&nbsp;(mini.c:12819)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x42C5A2:&nbsp;mono_magic_trampoline&nbsp;(mini-trampolines.c:249)&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x415B164:&nbsp;???&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x8FCA917:&nbsp;???&lt;br&gt;<br>
&amp;gt;&nbsp;==7947==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x85E7E9F:&nbsp;???&lt;br&gt;<br>
&lt;br&gt;<br>
(there&nbsp;are&nbsp;many&nbsp;other&nbsp;traces,&nbsp;but&nbsp;they&amp;#39;re&nbsp;all&nbsp;two&nbsp;orders&nbsp;of&nbsp;magnitude&lt;br&gt;<br>
smaller,&nbsp;in&nbsp;terms&nbsp;of&nbsp;memory&nbsp;size)&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;ran&nbsp;the&nbsp;same&nbsp;test&nbsp;again,&nbsp;this&nbsp;time&nbsp;with&nbsp;--optimize=-linears&nbsp;(which&nbsp;is&lt;br&gt;<br>
where&nbsp;at&nbsp;least&nbsp;the&nbsp;above&nbsp;trace&nbsp;came&nbsp;from)&nbsp;and&nbsp;without&nbsp;--debug,&nbsp;and&lt;br&gt;<br>
memory&nbsp;still&nbsp;grew,&nbsp;but&nbsp;not&nbsp;quite&nbsp;as&nbsp;quickly.&nbsp;I&nbsp;got&nbsp;another&nbsp;valgrind&lt;br&gt;<br>
trace&nbsp;out&nbsp;of&nbsp;that&nbsp;run:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;794,797,632&nbsp;bytes&nbsp;in&nbsp;1,601,948&nbsp;blocks&nbsp;are&nbsp;still&nbsp;reachable&nbsp;in&nbsp;loss&nbsp;record&nbsp;238&nbsp;of&nbsp;238&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;at&nbsp;0x4C21F8F:&nbsp;memalign&nbsp;(vg_replace_malloc.c:460)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x4C22028:&nbsp;posix_memalign&nbsp;(vg_replace_malloc.c:569)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x507D299:&nbsp;(within&nbsp;/usr/lib/libglib-2.0.so.0.1600.4)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x507E0F0:&nbsp;g_slice_alloc&nbsp;(in&nbsp;/usr/lib/libglib-2.0.so.0.1600.4)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x506035D:&nbsp;g_list_prepend&nbsp;(in&nbsp;/usr/lib/libglib-2.0.so.0.1600.4)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x52AF25:&nbsp;mono_allocate_stack_slots_full&nbsp;(mini.c:9812)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x432320:&nbsp;mono_arch_allocate_vars&nbsp;(mini-amd64.c:1137)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x558127:&nbsp;mini_method_compile&nbsp;(mini.c:12525)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x559419:&nbsp;mono_jit_compile_method&nbsp;(mini.c:12836)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x42C5E2:&nbsp;mono_magic_trampoline&nbsp;(mini-trampolines.c:249)&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x415B164:&nbsp;???&lt;br&gt;<br>
&amp;gt;&nbsp;==5807==&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;by&nbsp;0x8BA4AAB:&nbsp;???&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;valgrind&nbsp;just&nbsp;didn&amp;#39;t&nbsp;capture&nbsp;this&nbsp;one&nbsp;the&nbsp;first&nbsp;time,&nbsp;but&nbsp;it&nbsp;was&lt;br&gt;<br>
a&nbsp;factor&nbsp;in&nbsp;the&nbsp;memory&nbsp;growth.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;suppose&nbsp;that&nbsp;because&nbsp;MonoDevelop&nbsp;uses&nbsp;a&nbsp;fair&nbsp;amount&nbsp;of&nbsp;dynamic&nbsp;code,&lt;br&gt;<br>
it&nbsp;uses&nbsp;the&nbsp;JIT&nbsp;a&nbsp;lot,&nbsp;which&nbsp;seems&nbsp;to&nbsp;be&nbsp;provoking&nbsp;this.&nbsp;I&nbsp;personally&lt;br&gt;<br>
can&amp;#39;t&nbsp;figure&nbsp;out&nbsp;why&nbsp;this&nbsp;memory&nbsp;is&nbsp;still&nbsp;reachable&nbsp;--&nbsp;these&nbsp;are&nbsp;all&lt;br&gt;<br>
GLists,&nbsp;and&nbsp;it&nbsp;looks&nbsp;like&nbsp;they&nbsp;are&nbsp;passed&nbsp;to&nbsp;g_list_free&nbsp;at&nbsp;the&nbsp;end.&nbsp;I&lt;br&gt;<br>
suppose&nbsp;either&nbsp;some&nbsp;nodes&nbsp;are&nbsp;being&nbsp;lost&nbsp;after&nbsp;sorting,&nbsp;or&nbsp;something&lt;br&gt;<br>
more&nbsp;subtle&nbsp;is&nbsp;going&nbsp;on.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;glib&nbsp;version&nbsp;2.16.4-0ubuntu2,&nbsp;on&nbsp;Ubuntu&nbsp;8.04,&nbsp;amd64.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
