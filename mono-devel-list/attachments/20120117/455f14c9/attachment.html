<tt>
&lt;html&nbsp;xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&nbsp;xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&nbsp;xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot;&nbsp;xmlns:m=&quot;http://schemas.microsoft.com/office/2004/12/omml&quot;&nbsp;xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;meta&nbsp;name=Generator&nbsp;content=&quot;Microsoft&nbsp;Word&nbsp;12&nbsp;(filtered&nbsp;medium)&quot;&gt;&lt;style&gt;&lt;!--<br>
/*&nbsp;Font&nbsp;Definitions&nbsp;*/<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:Wingdings;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:5&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0;}<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:Wingdings;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:5&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0;}<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:Calibri;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:2&nbsp;15&nbsp;5&nbsp;2&nbsp;2&nbsp;2&nbsp;4&nbsp;3&nbsp;2&nbsp;4;}<br>
/*&nbsp;Style&nbsp;Definitions&nbsp;*/<br>
p.MsoNormal,&nbsp;li.MsoNormal,&nbsp;div.MsoNormal<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin:0cm;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-bottom:.0001pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-size:11.0pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;}<br>
a:link,&nbsp;span.MsoHyperlink<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-priority:99;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:blue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text-decoration:underline;}<br>
a:visited,&nbsp;span.MsoHyperlinkFollowed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-priority:99;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:purple;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text-decoration:underline;}<br>
p.MsoListParagraph,&nbsp;li.MsoListParagraph,&nbsp;div.MsoListParagraph<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-priority:34;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-top:0cm;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-right:0cm;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-bottom:0cm;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-left:36.0pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-bottom:.0001pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-size:11.0pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;}<br>
span.E-MailFormatvorlage17<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-type:personal-compose;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:windowtext;}<br>
.MsoChpDefault<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-type:export-only;}<br>
@page&nbsp;WordSection1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{size:612.0pt&nbsp;792.0pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin:70.85pt&nbsp;70.85pt&nbsp;2.0cm&nbsp;70.85pt;}<br>
div.WordSection1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{page:WordSection1;}<br>
/*&nbsp;List&nbsp;Definitions&nbsp;*/<br>
@list&nbsp;l0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-list-id:761491803;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-list-type:hybrid;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-list-template-ids:403742614&nbsp;256415706&nbsp;67567619&nbsp;67567621&nbsp;67567617&nbsp;67567619&nbsp;67567621&nbsp;67567617&nbsp;67567619&nbsp;67567621;}<br>
@list&nbsp;l0:level1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-level-start-at:0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-level-number-format:bullet;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-level-text:-;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-level-tab-stop:none;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-level-number-position:left;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text-indent:-18.0pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-fareast-font-family:Calibri;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mso-bidi-font-family:&quot;Times&nbsp;New&nbsp;Roman&quot;;}<br>
ol<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin-bottom:0cm;}<br>
ul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin-bottom:0cm;}<br>
--&gt;&lt;/style&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapedefaults&nbsp;v:ext=&quot;edit&quot;&nbsp;spidmax=&quot;1026&quot;&nbsp;/&gt;<br>
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapelayout&nbsp;v:ext=&quot;edit&quot;&gt;<br>
&lt;o:idmap&nbsp;v:ext=&quot;edit&quot;&nbsp;data=&quot;1&quot;&nbsp;/&gt;<br>
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;&lt;/head&gt;&lt;body&nbsp;lang=DE&nbsp;link=blue&nbsp;vlink=purple&gt;&lt;div&nbsp;class=WordSection1&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;Hi&nbsp;everyone,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;we&nbsp;hit&nbsp;a&nbsp;problem&nbsp;concerning&nbsp;EventWaitHandle.WaitOne(timeout)&nbsp;in&nbsp;conjunction&nbsp;with&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;changing&nbsp;system&nbsp;time&nbsp;during&nbsp;long&nbsp;timeouts.&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;The&nbsp;problem&nbsp;only&nbsp;exists&nbsp;using&nbsp;named&nbsp;events.&nbsp;After&nbsp;a&nbsp;short&nbsp;analysis&nbsp;I&nbsp;think&nbsp;I&nbsp;found&nbsp;the&nbsp;main&nbsp;problem:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoListParagraph&gt;&lt;span&nbsp;lang=EN-US&gt;In&nbsp;the&nbsp;io-layer&nbsp;&nbsp;the&nbsp;WaitForSingleObjectEx&nbsp;method&nbsp;uses&nbsp;&lt;i&gt;_wapi_calc_timeout&lt;/i&gt;&nbsp;(from&nbsp;misc.c)&nbsp;to&nbsp;compute&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoListParagraph&gt;&lt;span&nbsp;lang=EN-US&gt;an&nbsp;absolute&nbsp;time&nbsp;from&nbsp;the&nbsp;given&nbsp;timeout,&nbsp;but&nbsp;the&nbsp;absolute&nbsp;timeout&nbsp;is&nbsp;computed&nbsp;using&nbsp;&#8220;&lt;i&gt;gettimeofday&lt;/i&gt;&#8221;.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoListParagraph&gt;&lt;span&nbsp;lang=EN-US&gt;That&nbsp;will&nbsp;cause&nbsp;problems&nbsp;if&nbsp;the&nbsp;system&nbsp;clock&nbsp;changes&nbsp;during&nbsp;checking&nbsp;(named&nbsp;events&nbsp;spin&nbsp;through&nbsp;fake&nbsp;timeouts&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoListParagraph&gt;&lt;span&nbsp;lang=EN-US&gt;until&nbsp;the&nbsp;absolute&nbsp;timeout&nbsp;seems&nbsp;to&nbsp;be&nbsp;reached).&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unnamed&nbsp;events&nbsp;also&nbsp;use&nbsp;the&nbsp;&lt;i&gt;_wapi_calc_timeout&lt;/i&gt;&nbsp;method&nbsp;to&nbsp;compute&nbsp;the&nbsp;absolute&nbsp;timeout.&nbsp;This&nbsp;timeout&nbsp;is&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='text-indent:35.4pt'&gt;&lt;span&nbsp;lang=EN-US&gt;then&nbsp;used&nbsp;in&nbsp;&lt;i&gt;mono_cond_timedwait&lt;/i&gt;&nbsp;(but&nbsp;this&nbsp;only&nbsp;wraps&nbsp;&#8220;normal&#8221;&nbsp;pthread&nbsp;conditions).&nbsp;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='text-indent:35.4pt'&gt;&lt;span&nbsp;lang=EN-US&gt;So&nbsp;I&nbsp;prepared&nbsp;a&nbsp;patch&nbsp;(see&nbsp;attached&nbsp;files)&nbsp;using&nbsp;&lt;i&gt;clock_gettime(CLOCK_MONOTONIC,..)&lt;/i&gt;&nbsp;instead&nbsp;of&nbsp;gettimeofday,&nbsp;but&nbsp;this&nbsp;also&nbsp;requires&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='text-indent:35.4pt'&gt;&lt;span&nbsp;lang=EN-US&gt;a&nbsp;change&nbsp;for&nbsp;unnamed&nbsp;events,&nbsp;because&nbsp;the&nbsp;pthreads&nbsp;condition&nbsp;needs&nbsp;to&nbsp;know&nbsp;what&nbsp;kind&nbsp;of&nbsp;clock&nbsp;provides&nbsp;the&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='text-indent:35.4pt'&gt;&lt;span&nbsp;lang=EN-US&gt;absolute&nbsp;timeout.&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;This&nbsp;seems&nbsp;to&nbsp;fix&nbsp;the&nbsp;issue&nbsp;for&nbsp;us.&nbsp;&nbsp;Is&nbsp;this&nbsp;an&nbsp;appropriate&nbsp;way&nbsp;to&nbsp;fix&nbsp;this?&nbsp;What&nbsp;do&nbsp;you&nbsp;think.&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;i&gt;&lt;span&nbsp;lang=EN-US&gt;_wapi_calc_timeout&nbsp;&lt;/span&gt;&lt;/i&gt;&lt;span&nbsp;lang=EN-US&gt;is&nbsp;also&nbsp;used&nbsp;in&nbsp;some&nbsp;other&nbsp;timeout&nbsp;relevant&nbsp;functions,&nbsp;but&nbsp;I&nbsp;just&nbsp;found&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;the&nbsp;&#8220;faketimeout&#8221;&nbsp;way&nbsp;of&nbsp;checking&nbsp;the&nbsp;absolute&nbsp;timeout&nbsp;and&nbsp;the&nbsp;&lt;i&gt;mono_cond_timed_wait.&lt;o:p&gt;&lt;/o:p&gt;&lt;/i&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;Or&nbsp;do&nbsp;I&nbsp;miss&nbsp;some&nbsp;occurrences/cases&nbsp;checking&nbsp;the&nbsp;absolute&nbsp;timeout.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;Thanks&nbsp;for&nbsp;looking&nbsp;at&nbsp;this.&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;CU&nbsp;Mirko&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoListParagraph&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;lang=EN-US&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;___________________________________________________&lt;br&gt;<br>
&lt;br&gt;<br>
SMA&nbsp;Solar&nbsp;Technology&nbsp;AG&lt;br&gt;<br>
Aufsichtsrat:&nbsp;Guenther&nbsp;Cramer&nbsp;(Vorsitzender)&lt;br&gt;<br>
Vorstand:&nbsp;Juergen&nbsp;Dolle,&nbsp;Roland&nbsp;Grebe,&nbsp;Pierre-Pascal&nbsp;Urbon,&nbsp;Marko&nbsp;Werner&lt;br&gt;<br>
Handelsregister:&nbsp;Amtsgericht&nbsp;Kassel&nbsp;HRB&nbsp;3972&lt;br&gt;<br>
Sitz&nbsp;der&nbsp;Gesellschaft:&nbsp;34266&nbsp;Niestetal&lt;br&gt;<br>
USt-ID-Nr.&nbsp;DE&nbsp;113&nbsp;08&nbsp;59&nbsp;54&lt;br&gt;<br>
WEEE-Reg.-Nr.&nbsp;DE&nbsp;95881150&lt;br&gt;<br>
___________________________________________________&lt;/font&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
