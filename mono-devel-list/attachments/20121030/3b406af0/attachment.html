<tt>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Patch&nbsp;applied.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;Marek&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
I&#39;m&nbsp;trying&nbsp;to&nbsp;bundle&nbsp;an&nbsp;application&nbsp;that&nbsp;uses&nbsp;the&nbsp;mcs,&nbsp;that&#39;s&nbsp;why&nbsp;I&nbsp;need&nbsp;to&lt;br&gt;<br>
bundle&nbsp;mcs&nbsp;as&nbsp;well.&lt;br&gt;<br>
When&nbsp;I&nbsp;tried&nbsp;I&#39;ve&nbsp;get&nbsp;the&nbsp;following&nbsp;exception:&lt;br&gt;<br>
&lt;br&gt;<br>
[ERROR]&nbsp;FATAL&nbsp;UNHANDLED&nbsp;EXCEPTION:&nbsp;System.ArgumentOutOfRangeException:&lt;br&gt;<br>
Cannot&nbsp;be&nbsp;negative.&lt;br&gt;<br>
 &nbsp;at&nbsp;System.String.Substring&nbsp;(Int32&nbsp;startIndex,&nbsp;Int32&nbsp;length)&nbsp;[0x00000]&nbsp;in&lt;br&gt;<br>
&lt;filename&nbsp;unknown&gt;:0&lt;br&gt;<br>
 &nbsp;at&nbsp;Mono.CSharp.StaticLoader..ctor&nbsp;(Mono.CSharp.StaticImporter&nbsp;importer,&lt;br&gt;<br>
Mono.CSharp.CompilerContext&nbsp;compiler)&nbsp;[0x00000]&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&lt;br&gt;<br>
 &nbsp;at&nbsp;Mono.CSharp.Driver.Compile&nbsp;()&nbsp;[0x00000]&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&lt;br&gt;<br>
 &nbsp;at&nbsp;Mono.CSharp.Driver.Main&nbsp;(System.String[]&nbsp;args)&nbsp;[0x00000]&nbsp;in&nbsp;&lt;filename&lt;br&gt;<br>
unknown&gt;:0&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;code&nbsp;causing&nbsp;this&nbsp;is&nbsp;in&nbsp;ikvm.cs:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; var&nbsp;corlib_path&nbsp;=&nbsp;Path.GetDirectoryName&nbsp;(typeof&lt;br&gt;<br>
(object).Assembly.Location);&lt;br&gt;<br>
 &nbsp; string&nbsp;fx_path&nbsp;=&nbsp;corlib_path.Substring&nbsp;(0,&nbsp;corlib_path.LastIndexOf&lt;br&gt;<br>
(Path.DirectorySeparatorChar));&lt;br&gt;<br>
 &nbsp; if&nbsp;(compiler.Settings.StdLib)&nbsp;{&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;mcs&nbsp;is&nbsp;bundled&nbsp;corlib_path&nbsp;is&nbsp;empty&nbsp;and&nbsp;this&nbsp;cause&nbsp;the&lt;br&gt;<br>
corlib_path.LastIndexOf&nbsp;to&nbsp;return&nbsp;a&nbsp;-1,&nbsp;but&lt;br&gt;<br>
both&nbsp;corlib_path&nbsp;and&nbsp;fx_path&nbsp;are&nbsp;used&nbsp;only&nbsp;inside&nbsp;the&nbsp;&quot;if&lt;br&gt;<br>
(compiler.Setting.StdLib)&quot;&nbsp;then&nbsp;branch.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;then&nbsp;tried&nbsp;moving&nbsp;the&nbsp;two&nbsp;lines&nbsp;inside&nbsp;the&nbsp;if&nbsp;body.&nbsp;Passed&nbsp;-nostdlib&nbsp;to&lt;br&gt;<br>
the&nbsp;mcs&nbsp;during&nbsp;compilation&nbsp;and&nbsp;an&nbsp;explicit&nbsp;reference&nbsp;to&nbsp;a&nbsp;mscorlib.dll&nbsp;file.&lt;br&gt;<br>
In&nbsp;this&nbsp;way&nbsp;everything&nbsp;works.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;thus&nbsp;propose&nbsp;to&nbsp;apply&nbsp;the&nbsp;patch&nbsp;that&nbsp;I&#39;m&nbsp;attaching.&lt;br&gt;<br>
&lt;br&gt;<br>
Just&nbsp;out&nbsp;of&nbsp;curiosity,&nbsp;is&nbsp;there&nbsp;any&nbsp;reason&nbsp;for&nbsp;which&nbsp;fx_path&nbsp;is&nbsp;not&nbsp;computed&lt;br&gt;<br>
using&nbsp;Path.GetDirectoryName(corlib_path)&nbsp;(and&nbsp;for&nbsp;which&nbsp;corlib_path&nbsp;is&nbsp;not&lt;br&gt;<br>
checked&nbsp;to&nbsp;be&nbsp;not&nbsp;empty)?&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks.&lt;br&gt;<br>
--Tommaso&lt;br&gt;<br>
&lt;br&gt;<br>
mcs.nostdlib.patch&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/file/n4657173/mcs.nostdlib.patch&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mono.1490590.n4.nabble.com/file/n4657173/mcs.nostdlib.patch&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://mono.1490590.n4.nabble.com/patch-to-make-mcs-bundlable-tp4657173.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mono.1490590.n4.nabble.com/patch-to-make-mcs-bundlable-tp4657173.html&lt;/a&gt;&lt;br&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;Dev&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
