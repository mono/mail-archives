<tt>
&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;6/21/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Paolo&nbsp;Molaro&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:lupus@ximian.com&quot;&gt;lupus@ximian.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
On&nbsp;06/20/07&nbsp;Rodrigo&nbsp;Kumpera&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;The&nbsp;attached&nbsp;patch&nbsp;does&nbsp;the&nbsp;following:&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-implement&nbsp;all&nbsp;field&nbsp;load/store&nbsp;verifications&lt;br&gt;&amp;gt;&nbsp;-fixes&nbsp;a&nbsp;small&nbsp;typo&nbsp;in&nbsp;a&nbsp;class.c&nbsp;comment&lt;br&gt;&amp;gt;&nbsp;-function&nbsp;pointer&nbsp;validation&nbsp;now&nbsp;handles&nbsp;call&nbsp;convention<br>
&lt;br&gt;&amp;gt;&nbsp;-fixed:&nbsp;brtrue/false&nbsp;flaged&nbsp;unmanaged&nbsp;pointers&nbsp;as&nbsp;invalid&nbsp;types&nbsp;(now&nbsp;just&lt;br&gt;&amp;gt;&nbsp;flags&nbsp;as&nbsp;unverifiable)&lt;br&gt;&lt;br&gt;&amp;gt;&nbsp;Index:&nbsp;verify.c&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;<br>
&amp;gt;&nbsp;---&nbsp;verify.c&amp;nbsp;&amp;nbsp;(revision&nbsp;80327)&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;verify.c&amp;nbsp;&amp;nbsp;(working&nbsp;copy)&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-2359,6&nbsp;+2362,156&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;void&lt;br&gt;&amp;gt;&nbsp;+do_push_static_field&nbsp;(VerifyContext&nbsp;*ctx,&nbsp;int&nbsp;token,&nbsp;gboolean&nbsp;take_addr)<br>
&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClassField&nbsp;*field;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClass&nbsp;*klass;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;field&nbsp;=&nbsp;mono_field_from_token&nbsp;(ctx-&amp;gt;image,&nbsp;token,&nbsp;&amp;amp;klass,&nbsp;ctx-&amp;gt;generic_context);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!field)&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ADD_VERIFY_ERROR&nbsp;(ctx,&nbsp;g_strdup_printf&nbsp;(&amp;quot;Cannot&nbsp;load&nbsp;field&nbsp;from&nbsp;token&nbsp;0x%08x&nbsp;at&nbsp;0x%04x&amp;quot;,&nbsp;token,&nbsp;ctx-&amp;gt;ip_offset));&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!(field-&amp;gt;type-&amp;gt;attrs&nbsp;&amp;amp;&nbsp;FIELD_ATTRIBUTE_STATIC))&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ADD_VERIFY_ERROR&nbsp;(ctx,&nbsp;g_strdup_printf&nbsp;(&amp;quot;Cannot&nbsp;load&nbsp;non&nbsp;static&nbsp;field&nbsp;at&nbsp;0x%04x&amp;quot;,&nbsp;ctx-&amp;gt;ip_offset));&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(take_addr&nbsp;&amp;amp;&amp;amp;&nbsp;(field-&amp;gt;type-&amp;gt;attrs&nbsp;&amp;amp;&nbsp;FIELD_ATTRIBUTE_INIT_ONLY))<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;CODE_NOT_VERIFIABLE&nbsp;(ctx,&nbsp;g_strdup_printf&nbsp;(&amp;quot;Cannot&nbsp;take&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;init-only&nbsp;field&nbsp;at&nbsp;0x%04x&amp;quot;,&nbsp;ctx-&amp;gt;ip_offset));&lt;br&gt;&lt;br&gt;This&nbsp;should&nbsp;be&nbsp;allowed&nbsp;in&nbsp;the&nbsp;.cctor&nbsp;for&nbsp;the&nbsp;class&nbsp;(same&nbsp;for&nbsp;the<br>
&lt;br&gt;equivalent&nbsp;case&nbsp;of&nbsp;an&nbsp;instance&nbsp;field&nbsp;and&nbsp;the&nbsp;.ctor):&nbsp;a&nbsp;test&nbsp;case&nbsp;is&lt;br&gt;something&nbsp;like:&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;readonly&nbsp;static&nbsp;MyValueType&nbsp;v&nbsp;=&nbsp;new&nbsp;MyValueType&nbsp;(5);&lt;br&gt;&lt;br&gt;Note,&nbsp;eventually&nbsp;you&nbsp;also&nbsp;need&nbsp;to&nbsp;add&nbsp;accessibility&nbsp;checks:&nbsp;the&nbsp;method<br>
&lt;br&gt;needs&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;access&nbsp;the&nbsp;field&nbsp;keeping&nbsp;in&nbsp;mind&nbsp;both&nbsp;the&nbsp;field&amp;#39;s&lt;br&gt;and&nbsp;the&nbsp;field&amp;#39;s&nbsp;class&nbsp;visibility.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Definely,&nbsp;the&nbsp;spec&nbsp;say&nbsp;nothing&nbsp;about&nbsp;that,&nbsp;I&amp;#39;ll&nbsp;add&nbsp;this&nbsp;check&nbsp;and&nbsp;mark&nbsp;it&nbsp;as&nbsp;a&nbsp;spec&nbsp;issue.&nbsp;About&nbsp;the&nbsp;accessibility&nbsp;checks,&nbsp;I&amp;#39;m&nbsp;going&nbsp;to&nbsp;tackle&nbsp;all&nbsp;cases&nbsp;at&nbsp;once,&nbsp;as&nbsp;it&nbsp;should&nbsp;quite&nbsp;hairy,&nbsp;I&nbsp;believe.<br>
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&amp;gt;&nbsp;+static&nbsp;gboolean&lt;br&gt;&amp;gt;&nbsp;+check_is_valid_type_for_field_ops&nbsp;(VerifyContext&nbsp;*ctx,&nbsp;int&nbsp;token,&nbsp;ILStackDesc&nbsp;*obj,&nbsp;MonoClassField&nbsp;**ret_field)<br>
&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClassField&nbsp;*field;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClass&nbsp;*klass;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*must&nbsp;be&nbsp;one&nbsp;of:&nbsp;object&nbsp;type,&nbsp;managed&nbsp;pointer,&nbsp;unmanaged&nbsp;pointer&nbsp;(native&nbsp;int)&nbsp;or&nbsp;an&nbsp;instance&nbsp;of&nbsp;a&nbsp;value&nbsp;type&nbsp;*/&lt;br&gt;<br>
&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!((obj-&amp;gt;stype&nbsp;==&nbsp;TYPE_COMPLEX)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*&nbsp;the&nbsp;managed&nbsp;reference&nbsp;must&nbsp;be&nbsp;to&nbsp;an&nbsp;object&nbsp;or&nbsp;value&nbsp;type&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;||&nbsp;((obj-&amp;gt;stype&nbsp;&amp;amp;&nbsp;POINTER_MASK)&nbsp;&amp;amp;&amp;amp;&nbsp;(UNMASK_TYPE&nbsp;(obj-&amp;gt;stype)&nbsp;==&nbsp;TYPE_COMPLEX))<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;||&nbsp;(obj-&amp;gt;stype&nbsp;==&nbsp;TYPE_NATIVE_INT)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;||&nbsp;(obj-&amp;gt;stype&nbsp;==&nbsp;TYPE_PTR)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;||&nbsp;(obj-&amp;gt;stype&nbsp;==&nbsp;TYPE_COMPLEX)))&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ADD_VERIFY_ERROR&nbsp;(ctx,&nbsp;g_strdup_printf&nbsp;(&amp;quot;Invalid&nbsp;argument&nbsp;%s&nbsp;to&nbsp;load&nbsp;field&nbsp;at&nbsp;0x%04x&amp;quot;,&nbsp;type_names&nbsp;[UNMASK_TYPE&nbsp;(obj-&amp;gt;stype)],&nbsp;ctx-&amp;gt;ip_offset));<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;FALSE;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;field&nbsp;=&nbsp;mono_field_from_token&nbsp;(ctx-&amp;gt;image,&nbsp;token,&nbsp;&amp;amp;klass,&nbsp;ctx-&amp;gt;generic_context);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!field)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ADD_VERIFY_ERROR&nbsp;(ctx,&nbsp;g_strdup_printf&nbsp;(&amp;quot;Cannot&nbsp;load&nbsp;field&nbsp;from&nbsp;token&nbsp;0x%08x&nbsp;at&nbsp;0x%04x&amp;quot;,&nbsp;token,&nbsp;ctx-&amp;gt;ip_offset));<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;FALSE;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;*ret_field&nbsp;=&nbsp;field;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(obj-&amp;gt;type);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*The&nbsp;value&nbsp;on&nbsp;the&nbsp;stack&nbsp;must&nbsp;be&nbsp;a&nbsp;subclass&nbsp;of&nbsp;the&nbsp;defining&nbsp;type&nbsp;of&nbsp;the&nbsp;field*/<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;if&nbsp;we&nbsp;can&nbsp;load&nbsp;the&nbsp;field&nbsp;from&nbsp;the&nbsp;stack&nbsp;value*/&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(UNMASK_TYPE&nbsp;(obj-&amp;gt;stype)&nbsp;==&nbsp;TYPE_COMPLEX)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoType&nbsp;*type&nbsp;=&nbsp;obj-&amp;gt;type-&amp;gt;byref&nbsp;?&nbsp;&amp;amp;field-&amp;gt;parent-&amp;gt;this_arg&nbsp;:&nbsp;&amp;amp;field-&amp;gt;parent-&amp;gt;byval_arg;<br>
&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!verify_stack_type_compatibility&nbsp;(ctx,&nbsp;type,&nbsp;obj-&amp;gt;type,&nbsp;FALSE))&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ADD_VERIFY_ERROR&nbsp;(ctx,&nbsp;g_strdup_printf&nbsp;(&amp;quot;Type&nbsp;at&nbsp;stack&nbsp;is&nbsp;not&nbsp;compatible&nbsp;to&nbsp;reference&nbsp;the&nbsp;field&nbsp;at&nbsp;0x%04x&amp;quot;,&nbsp;ctx-&amp;gt;ip_offset));<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;FALSE;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(MONO_TYPE_IS_REFERENCE&nbsp;(field-&amp;gt;type)&nbsp;&amp;amp;&amp;amp;&nbsp;!(field-&amp;gt;type-&amp;gt;attrs&nbsp;&amp;amp;&nbsp;FIELD_ATTRIBUTE_STATIC))&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClass&nbsp;*p;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClassField&nbsp;*&nbsp;other;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(p&nbsp;=&nbsp;field-&amp;gt;parent;&nbsp;p&nbsp;!=&nbsp;NULL;&nbsp;p&nbsp;=&nbsp;p-&amp;gt;parent)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;gpointer&nbsp;iter&nbsp;=&nbsp;NULL;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while&nbsp;((other&nbsp;=&nbsp;mono_class_get_fields&nbsp;(p,&nbsp;&amp;amp;iter)))&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(other&nbsp;!=&nbsp;field&nbsp;&amp;amp;&amp;amp;&nbsp;other-&amp;gt;offset&nbsp;==&nbsp;field-&amp;gt;offset&nbsp;&amp;amp;&amp;amp;&nbsp;!(other-&amp;gt;type-&amp;gt;attrs&nbsp;&amp;amp;&nbsp;FIELD_ATTRIBUTE_STATIC))&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;CODE_NOT_VERIFIABLE&nbsp;(ctx,&nbsp;g_strdup_printf&nbsp;(&amp;quot;Overlapped&nbsp;reference&nbsp;field&nbsp;at&nbsp;0x%04x&amp;quot;,&nbsp;ctx-&amp;gt;ip_offset));&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;goto&nbsp;overlap_check_end;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;The&nbsp;code&nbsp;for&nbsp;overlapped&nbsp;fields&nbsp;is&nbsp;not&nbsp;as&nbsp;trivial&nbsp;as&nbsp;this.&nbsp;It&nbsp;is&nbsp;moreover&lt;br&gt;something&nbsp;you&nbsp;should&nbsp;do&nbsp;on&nbsp;a&nbsp;per-type&nbsp;basis&nbsp;instead&nbsp;of&nbsp;per-field&nbsp;access<br>
&lt;br&gt;in&nbsp;the&nbsp;IL&nbsp;code.&nbsp;metadata/object.c&nbsp;has&nbsp;the&nbsp;code&nbsp;to&nbsp;do&nbsp;proper&nbsp;overlapping&lt;br&gt;field&nbsp;detection:&nbsp;that&nbsp;code&nbsp;should&nbsp;not&nbsp;be&nbsp;duplicated.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I&nbsp;don&amp;#39;t&nbsp;quite&nbsp;follow&nbsp;you,&nbsp;I&nbsp;should&nbsp;test&nbsp;it&nbsp;it&amp;#39;s&nbsp;a&nbsp;load/store&nbsp;to&nbsp;a&nbsp;class&nbsp;with&nbsp;bad&nbsp;overlapping,&nbsp;even&nbsp;if&nbsp;the&nbsp;target&nbsp;is&nbsp;a&nbsp;good&nbsp;field?&nbsp;<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Thanks!&lt;br&gt;&lt;br&gt;lupus&lt;br&gt;&lt;br&gt;--&lt;br&gt;-----------------------------------------------------------------<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:lupus@debian.org&quot;&gt;lupus@debian.org&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;debian/rules&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:lupus@ximian.com&quot;&gt;lupus@ximian.com&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Monkeys&nbsp;do&nbsp;it&nbsp;better&lt;br&gt;_______________________________________________<br>
&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list<br>
&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
