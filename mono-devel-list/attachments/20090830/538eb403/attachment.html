<tt>
Actually,&nbsp;that&nbsp;just&nbsp;uses&nbsp;up&nbsp;so&nbsp;much&nbsp;memory&nbsp;that&nbsp;every&nbsp;2&nbsp;steps&nbsp;it&nbsp;does&nbsp;a&nbsp;gc.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Aug&nbsp;30,&nbsp;2009&nbsp;at&nbsp;11:50&nbsp;AM,&nbsp;James&nbsp;Zhao&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jameszhao00@gmail.com&quot;&gt;jameszhao00@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;Ah&nbsp;here&amp;#39;s&nbsp;the&nbsp;problem.&nbsp;I&nbsp;didn&amp;#39;t&nbsp;call&nbsp;yield/wait&nbsp;on&nbsp;any&nbsp;of&nbsp;the&nbsp;threads&nbsp;(and&nbsp;thus&nbsp;store()).&nbsp;I&nbsp;fixed&nbsp;the&nbsp;problem&nbsp;by&nbsp;having&nbsp;every&nbsp;thread&nbsp;call&nbsp;yield&nbsp;at&nbsp;least&nbsp;once&nbsp;and&nbsp;turning&nbsp;the&nbsp;code&nbsp;back&nbsp;to&nbsp;the&nbsp;version&nbsp;where&nbsp;one&nbsp;continuation&nbsp;is&nbsp;created&nbsp;per&nbsp;step.&lt;div&gt;<br>
&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Aug&nbsp;30,&nbsp;2009&nbsp;at&nbsp;12:45&nbsp;AM,&nbsp;James&nbsp;Zhao&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jameszhao00@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jameszhao00@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
Hi,<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;currently&nbsp;working&nbsp;on&nbsp;something&nbsp;that&nbsp;uses&nbsp;mono&nbsp;2.6&amp;#39;s&nbsp;tasklet/continuations&nbsp;(similar&nbsp;to&nbsp;stackless&nbsp;python/&amp;#39;eve).&nbsp;However,&nbsp;I&amp;#39;m&nbsp;experiencing&nbsp;some&nbsp;really&nbsp;bizzare&nbsp;memory&nbsp;issues.&nbsp;I&nbsp;tested&nbsp;on&nbsp;Windows&nbsp;and&nbsp;Linux. &lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;modified&nbsp;the&nbsp;default&nbsp;Mono.MicroThreads&nbsp;library&nbsp;so&nbsp;each&nbsp;microthread&nbsp;reuses&nbsp;continuations&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;continuation&nbsp;every&nbsp;Start(). &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;experiencing&nbsp;high&nbsp;memory&nbsp;usage&nbsp;when&nbsp;calling&nbsp;Mono&nbsp;Continuation&amp;#39;s&nbsp;Continuation.store().&nbsp;Every&nbsp;4&nbsp;or&nbsp;5&nbsp;seconds&nbsp;a&nbsp;huge&nbsp;GC&nbsp;op/spike&nbsp;happens.&nbsp;Here&amp;#39;s&nbsp;a comparison of&nbsp;memory/cpu&nbsp;for&nbsp;using&nbsp;Mono&nbsp;Continuations&nbsp;and&nbsp;directly&nbsp;calling&nbsp;the&nbsp;method.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;can&nbsp;view&nbsp;the&nbsp;source&nbsp;code &lt;a&nbsp;href=&quot;http://code.google.com/p/mmo-test/source/browse/#svn/trunk/mmo_v2&quot;&nbsp;target=&quot;_blank&quot;&gt;http://code.google.com/p/mmo-test/source/browse/#svn/trunk/mmo_v2&lt;/a&gt; .&nbsp;EntityProcessor.cs/Run()&nbsp;runs&nbsp;the&nbsp;microthreads&nbsp;and&nbsp;EntityProcessor.cs/AddQueuedEntities()&nbsp;adds&nbsp;the&nbsp;microthreads. &lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&amp;#39;s&nbsp;some&nbsp;data.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Memory,&nbsp;ms&nbsp;spent&nbsp;in&nbsp;iteration&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Using&nbsp;Mono&nbsp;Continuations&nbsp;(200k&nbsp;entities/MicroThreads)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;367210496,&nbsp;410&lt;br&gt;385441792,&nbsp;418&lt;br&gt;405204992,&nbsp;346&lt;br&gt;427053056,&nbsp;363&lt;br&gt;<br>
<br>
<br>
444809216,&nbsp;333&lt;br&gt;<br>
462483456,&nbsp;339&lt;br&gt;423661568,&nbsp;1559&lt;br&gt;441327616,&nbsp;465&lt;br&gt;458985472,&nbsp;305&lt;br&gt;403214336,&nbsp;1338&lt;br&gt;419254272,&nbsp;506&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Not&nbsp;sing&nbsp;Mono&nbsp;Continuations&nbsp;(200k&nbsp;entities)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;365662208,&nbsp;67&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;365662208,&nbsp;67&lt;/div&gt;<br>
&lt;div&gt;365662208,&nbsp;66&lt;/div&gt;&lt;div&gt;365662208,&nbsp;66&lt;/div&gt;&lt;div&gt;365662208,&nbsp;67&lt;/div&gt;&lt;div&gt;365662208,&nbsp;67&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;James&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&amp;#39;s&nbsp;my&nbsp;chat&nbsp;log&nbsp;with&nbsp;Rodrigo:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:16&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;hey&nbsp;rodrigo.&nbsp;do&nbsp;u&nbsp;have&nbsp;a&nbsp;moment?&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;yes&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:17&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;i&amp;#39;m&nbsp;currently&nbsp;working&nbsp;on&nbsp;something&nbsp;that&nbsp;uses&nbsp;mono&nbsp;2.6&amp;#39;s&nbsp;tasklet/continuations&nbsp;(similar&nbsp;to&nbsp;stackless&nbsp;python/&amp;#39;eve).&nbsp;however,&nbsp;im&nbsp;experiencing&nbsp;some&nbsp;really&nbsp;bizzare&nbsp;memory&nbsp;issues&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;right&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;on&nbsp;linux,&nbsp;right?&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:18&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;i&nbsp;tested&nbsp;on&nbsp;linux&nbsp;and&nbsp;windows.&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;ok&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;once&nbsp;i&nbsp;start&nbsp;using&nbsp;them,&nbsp;it&nbsp;causes&nbsp;memory&nbsp;usage&nbsp;to&nbsp;continue&nbsp;rising,&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;what&nbsp;kind&nbsp;of&nbsp;problems&nbsp;are&nbsp;you&nbsp;having?&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;until&nbsp;at&nbsp;around&nbsp;4-5&nbsp;secs&nbsp;a&nbsp;huge&nbsp;gc&nbsp;op&nbsp;occur&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;i&nbsp;took&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;source&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:19&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;*c&nbsp;source&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;well,&nbsp;each&nbsp;tasklet&nbsp;holds&nbsp;onto&nbsp;a&nbsp;big&nbsp;block&nbsp;of&nbsp;memory&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;and&nbsp;it&nbsp;should&nbsp;be&nbsp;gcing&nbsp;each&nbsp;time&nbsp;store()&nbsp;is&nbsp;called,&nbsp;or&nbsp;it&nbsp;will&nbsp;overwrite&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;and&nbsp;im&nbsp;reusing&nbsp;continuations&nbsp;across&nbsp;iterations&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:20&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;why,&nbsp;it&nbsp;shouldn&amp;#39;t&nbsp;be&nbsp;required&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;sorry.&nbsp;gc&nbsp;if&nbsp;current&nbsp;required&nbsp;&amp;gt;&nbsp;previous&nbsp;size&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;overwrite&nbsp;if&nbsp;otherwise&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;I&nbsp;still&nbsp;fails&nbsp;to&nbsp;see&nbsp;a&nbsp;reason&nbsp;to&nbsp;trigger&nbsp;a&nbsp;gc&nbsp;on&nbsp;this&nbsp;case&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:21&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;hmm&nbsp;i&nbsp;guess&nbsp;im&nbsp;not&nbsp;too&nbsp;sure&nbsp;either&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:22&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;but&nbsp;the&nbsp;thing&nbsp;is,&nbsp;even&nbsp;if&nbsp;im&nbsp;reusing&nbsp;the&nbsp;continuation&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;the&nbsp;memory,&nbsp;(ms&nbsp;spent)&nbsp;is&nbsp;like&nbsp;this&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;87314432,&nbsp;161&lt;br&gt;<br>
<br>
<br>
92131328,&nbsp;128&lt;br&gt;91377664,&nbsp;315&lt;br&gt;95244288,&nbsp;88&lt;br&gt;93085696,&nbsp;330&lt;br&gt;91824128,&nbsp;319&lt;br&gt;89403392,&nbsp;292&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;it&nbsp;keeps&nbsp;cycling&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:23&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;sorry.&nbsp;it&amp;#39;s&nbsp;more&nbsp;like&nbsp;this&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;367210496,&nbsp;410&lt;br&gt;<br>
<br>
<br>
385441792,&nbsp;418&lt;br&gt;405204992,&nbsp;346&lt;br&gt;427053056,&nbsp;363&lt;br&gt;444809216,&nbsp;333&lt;br&gt;462483456,&nbsp;339&lt;br&gt;423661568,&nbsp;1559&lt;br&gt;441327616,&nbsp;465&lt;br&gt;458985472,&nbsp;305&lt;br&gt;403214336,&nbsp;1338&lt;br&gt;419254272,&nbsp;506&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;and&nbsp;400mb&nbsp;is&nbsp;like&nbsp;the&nbsp;working&nbsp;set&nbsp;of&nbsp;your&nbsp;app?&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:24&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;at &lt;br&gt;423661568,&nbsp;1559,&nbsp;there&amp;#39;s&nbsp;a&nbsp;huge&nbsp;lag&nbsp;spike&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;lemme&nbsp;check&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;those&nbsp;spike&nbsp;can&nbsp;happen&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;530&nbsp;ish&nbsp;on&nbsp;windows&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;thing&nbsp;is,&nbsp;im&nbsp;not&nbsp;reallocating&nbsp;anything&nbsp;major&nbsp;each&nbsp;iteration&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;*allocating&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:25&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;i&nbsp;allocate&nbsp;1&nbsp;new&nbsp;continuation&nbsp;per&nbsp;step,&nbsp;and&nbsp;call&nbsp;store()&nbsp;on&nbsp;200k&nbsp;others&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;why&nbsp;are&nbsp;you&nbsp;calling&nbsp;store&nbsp;on&nbsp;those&nbsp;200k&nbsp;other?&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;yield/sleep&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:26&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;oh,&nbsp;ok&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;well,&nbsp;you&nbsp;realize&nbsp;that&nbsp;the&nbsp;working&nbsp;set&nbsp;is&nbsp;largely&nbsp;related&nbsp;to&nbsp;the&nbsp;living&nbsp;set&nbsp;of&nbsp;the&nbsp;objects&nbsp;on&nbsp;the&nbsp;many&nbsp;stacks&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;and&nbsp;GC&nbsp;spikes&nbsp;are&nbsp;not&nbsp;really&nbsp;uncommon&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:27&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;but&nbsp;i&nbsp;tested&nbsp;another&nbsp;scenario&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;i&nbsp;also&nbsp;have&nbsp;a&nbsp;version&nbsp;of&nbsp;microthreads&nbsp;that&nbsp;doesnt&nbsp;use&nbsp;continuations&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;that&nbsp;just&nbsp;runs()&nbsp;and&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;return&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;and&nbsp;that&nbsp;one&nbsp;doesnt&nbsp;have&nbsp;any&nbsp;spikes&nbsp;on&nbsp;mono&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:28&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;and&nbsp;memory&nbsp;on&nbsp;that&nbsp;one&nbsp;barely&nbsp;increases&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;do&nbsp;you&nbsp;mind&nbsp;emails&nbsp;the&nbsp;list&nbsp;with&nbsp;your&nbsp;code&nbsp;and&nbsp;CC&nbsp;Paolo&nbsp;Molaro&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;he&amp;#39;s&nbsp;the&nbsp;maintainer&nbsp;of&nbsp;tasklets&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;  &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;I&amp;#39;m&nbsp;not&nbsp;familiar&nbsp;with&nbsp;the&nbsp;code&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;yea&nbsp;sure.&nbsp;do&nbsp;u&nbsp;mind&nbsp;if&nbsp;i&nbsp;link&nbsp;this&nbsp;chat?&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Rodrigo&lt;/span&gt;:&nbsp;no&nbsp;problem&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em;text-indent:-1em&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;me&lt;/span&gt;:&nbsp;k.&nbsp;thank&nbsp;you&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;display:block;float:left;color:rgb(136,&nbsp;136,&nbsp;136)&quot;&gt;12:29&nbsp;AM &lt;/span&gt;&lt;span&nbsp;style=&quot;display:block;padding-left:6em&quot;&gt;&lt;span&gt;later&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
