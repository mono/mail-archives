<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;6.5.7654.12&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[Mono-dev]&nbsp;Fundamental&nbsp;performance&nbsp;problems&nbsp;with&nbsp;Mono&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/plain&nbsp;format&nbsp;--&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Sorry&nbsp;if&nbsp;you&nbsp;misunderstood,&nbsp;the&nbsp;blog&nbsp;I&nbsp;linked&nbsp;to&nbsp;isn't&nbsp;mine&nbsp;-&nbsp;I&nbsp;was&nbsp;merely&nbsp;referencing&nbsp;it&nbsp;an&nbsp;example&nbsp;of&nbsp;a&nbsp;managed&nbsp;buffer&nbsp;pool.&nbsp;There&nbsp;will&nbsp;almost&nbsp;certainly&nbsp;still&nbsp;be&nbsp;some&nbsp;garbage&nbsp;collection&nbsp;going&nbsp;on&nbsp;but&nbsp;this&nbsp;can&nbsp;help&nbsp;reduce&nbsp;it.&nbsp;Also,&nbsp;I'm&nbsp;not&nbsp;using&nbsp;the&nbsp;Begin/End&nbsp;calls&nbsp;unless&nbsp;the&nbsp;socket&nbsp;is&nbsp;going&nbsp;to&nbsp;block&nbsp;(at&nbsp;which&nbsp;point&nbsp;you're&nbsp;slowing&nbsp;down&nbsp;anyway).&lt;BR&gt;<br>
&lt;BR&gt;<br>
This&nbsp;was&nbsp;under&nbsp;Mono&nbsp;in&nbsp;Linux&nbsp;running&nbsp;on&nbsp;a&nbsp;600&nbsp;MHz&nbsp;ARM&nbsp;processor&nbsp;(so,&nbsp;definitely&nbsp;not&nbsp;MS&nbsp;.NET).&lt;BR&gt;<br>
&lt;BR&gt;<br>
-Thad&lt;BR&gt;<br>
&lt;BR&gt;<br>
-----Original&nbsp;Message-----&lt;BR&gt;<br>
From:&nbsp;mono-devel-list-bounces@lists.ximian.com&nbsp;on&nbsp;behalf&nbsp;of&nbsp;zvikag&lt;BR&gt;<br>
Sent:&nbsp;Fri&nbsp;1/8/2010&nbsp;7:23&nbsp;AM&lt;BR&gt;<br>
To:&nbsp;mono-devel-list@lists.ximian.com&lt;BR&gt;<br>
Subject:&nbsp;Re:&nbsp;[Mono-dev]&nbsp;Fundamental&nbsp;performance&nbsp;problems&nbsp;with&nbsp;Mono&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
Did&nbsp;you&nbsp;see&nbsp;this&nbsp;improvement&nbsp;using&nbsp;Mono&nbsp;or&nbsp;.NET&nbsp;on&nbsp;Windows?&nbsp;in&nbsp;your&nbsp;blog&nbsp;post&lt;BR&gt;<br>
you&nbsp;talk&nbsp;about&nbsp;GC&nbsp;generations&nbsp;that&nbsp;don't&nbsp;exist&nbsp;in&nbsp;Mono&nbsp;GC&nbsp;and&nbsp;OOM&nbsp;exceptions&lt;BR&gt;<br>
that&nbsp;I&nbsp;don't&nbsp;get.&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;am&nbsp;also&nbsp;doubtful&nbsp;that&nbsp;the&nbsp;use&nbsp;of&nbsp;pooled&nbsp;buffers&nbsp;can&nbsp;alleviate&nbsp;the&nbsp;problems&lt;BR&gt;<br>
in&nbsp;Mono&nbsp;since&nbsp;the&nbsp;main&nbsp;problem&nbsp;are&nbsp;the&nbsp;tons&nbsp;of&nbsp;garbage&nbsp;objects&nbsp;that&nbsp;are&lt;BR&gt;<br>
created&nbsp;during&nbsp;BeginXXX\EndXXX&nbsp;calls,&nbsp;not&nbsp;the&nbsp;pinning&nbsp;of&nbsp;send&nbsp;and&nbsp;receive&lt;BR&gt;<br>
buffers.&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thad&nbsp;wrote:&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;I&nbsp;feel&nbsp;your&nbsp;pain.&nbsp;I&nbsp;pulled&nbsp;a&nbsp;library&nbsp;across&nbsp;that&nbsp;did&nbsp;something&nbsp;similar,&lt;BR&gt;<br>
&amp;gt;&nbsp;and&nbsp;the&nbsp;large&nbsp;GC&nbsp;times&nbsp;had&nbsp;a&nbsp;visible,&nbsp;stop-the-world&nbsp;impact&nbsp;on&nbsp;latency.&lt;BR&gt;<br>
&amp;gt;&nbsp;Switching&nbsp;from&nbsp;garbage&nbsp;collected&nbsp;to&nbsp;managed&nbsp;buffers&nbsp;made&nbsp;a&nbsp;world&nbsp;of&lt;BR&gt;<br>
&amp;gt;&nbsp;difference.&nbsp;For&nbsp;more&nbsp;on&nbsp;this&nbsp;see:&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://msdn.microsoft.com/en-us/library/system.servicemodel.channels.buf&quot;&gt;http://msdn.microsoft.com/en-us/library/system.servicemodel.channels.buf&lt;/A&gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;fermanager.aspx&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://codebetter.com/blogs/gregyoung/archive/2007/06/18/async-sockets-a&quot;&gt;http://codebetter.com/blogs/gregyoung/archive/2007/06/18/async-sockets-a&lt;/A&gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;nd-buffer-management.aspx&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;After&nbsp;switching&nbsp;to&nbsp;managed&nbsp;buffers&nbsp;(and&nbsp;replicating&nbsp;some&nbsp;logic&nbsp;similar&lt;BR&gt;<br>
&amp;gt;&nbsp;to&nbsp;the&nbsp;Async&nbsp;socket&nbsp;methods),&nbsp;I've&nbsp;had&nbsp;a&nbsp;pass-through&nbsp;data&nbsp;bridge&lt;BR&gt;<br>
&amp;gt;&nbsp;running&nbsp;for&nbsp;days&nbsp;without&nbsp;a&nbsp;hiccup&nbsp;and&nbsp;with&nbsp;low&nbsp;CPU/memory&nbsp;utilization,&lt;BR&gt;<br>
&amp;gt;&nbsp;even&nbsp;on&nbsp;a&nbsp;fairly&nbsp;underpowered&nbsp;processor.&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;If&nbsp;you&nbsp;do&nbsp;decide&nbsp;to&nbsp;go&nbsp;with&nbsp;managed&nbsp;buffers&nbsp;you'll&nbsp;need&nbsp;to&nbsp;implement&lt;BR&gt;<br>
&amp;gt;&nbsp;your&nbsp;own&nbsp;(or&nbsp;find&nbsp;a&nbsp;good&nbsp;library)&nbsp;as&nbsp;the&nbsp;WCF&nbsp;BufferManager&nbsp;in&nbsp;Mono&nbsp;won't&lt;BR&gt;<br>
&amp;gt;&nbsp;really&nbsp;do&nbsp;what&nbsp;you&nbsp;want.&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;Regards,&lt;BR&gt;<br>
&amp;gt;&nbsp;-Thad&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;-----Original&nbsp;Message-----&lt;BR&gt;<br>
&amp;gt;&nbsp;From:&nbsp;mono-devel-list-bounces@lists.ximian.com&lt;BR&gt;<br>
&amp;gt;&nbsp;[&lt;A&nbsp;HREF=&quot;mailto:mono-devel-list-bounces@lists.ximian.com&quot;&gt;mailto:mono-devel-list-bounces@lists.ximian.com&lt;/A&gt;]&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;zvikag&lt;BR&gt;<br>
&amp;gt;&nbsp;Sent:&nbsp;Thursday,&nbsp;January&nbsp;07,&nbsp;2010&nbsp;10:38&nbsp;AM&lt;BR&gt;<br>
&amp;gt;&nbsp;To:&nbsp;mono-devel-list@lists.ximian.com&lt;BR&gt;<br>
&amp;gt;&nbsp;Subject:&nbsp;[Mono-dev]&nbsp;Fundamental&nbsp;performance&nbsp;problems&nbsp;with&nbsp;Mono&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;Hello&nbsp;all,&lt;BR&gt;<br>
&amp;gt;&nbsp;The&nbsp;bottom&nbsp;line&nbsp;of&nbsp;this&nbsp;message&nbsp;is&nbsp;that&nbsp;I&nbsp;don't&nbsp;see&nbsp;how&nbsp;can&nbsp;one&nbsp;write&nbsp;a&lt;BR&gt;<br>
&amp;gt;&nbsp;high-performance&nbsp;socket&nbsp;server&nbsp;in&nbsp;Mono...&lt;BR&gt;<br>
&amp;gt;&nbsp;Here&nbsp;is&nbsp;the&nbsp;story:&lt;BR&gt;<br>
&amp;gt;&nbsp;I&nbsp;am&nbsp;writing&nbsp;a&nbsp;proxy&nbsp;server&nbsp;using&nbsp;.NET&nbsp;Socket&nbsp;API.&nbsp;This&nbsp;proxy&nbsp;does&lt;BR&gt;<br>
&amp;gt;&nbsp;almost&lt;BR&gt;<br>
&amp;gt;&nbsp;entirely&nbsp;I/O&nbsp;work&nbsp;-&nbsp;copying&nbsp;buffers&nbsp;from&nbsp;one&nbsp;socket&nbsp;to&nbsp;another.&nbsp;Now,&lt;BR&gt;<br>
&amp;gt;&nbsp;Mono&lt;BR&gt;<br>
&amp;gt;&nbsp;doesn't&nbsp;implement&nbsp;the&nbsp;newer&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://msdn.microsoft.com/en-us/library/system.net.sockets.socketasyncev&quot;&gt;http://msdn.microsoft.com/en-us/library/system.net.sockets.socketasyncev&lt;/A&gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;entargs.aspx&lt;BR&gt;<br>
&amp;gt;&nbsp;XXXAsync&nbsp;Socket&nbsp;API&amp;nbsp;&nbsp;that&nbsp;was&nbsp;introduced&nbsp;in&nbsp;.NET&nbsp;2.0&nbsp;SP1&nbsp;(or&nbsp;more&lt;BR&gt;<br>
&amp;gt;&nbsp;accurately,&nbsp;implements&nbsp;it&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://www.mail-archive.com/mono-list@lists.ximian.com/msg28621.html&quot;&gt;http://www.mail-archive.com/mono-list@lists.ximian.com/msg28621.html&lt;/A&gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;perfunctorily&nbsp;).&nbsp;So&nbsp;I&nbsp;was&nbsp;left&nbsp;to&nbsp;use&nbsp;the&nbsp;APM&nbsp;Socket&nbsp;API&nbsp;which&nbsp;produces&lt;BR&gt;<br>
&amp;gt;&nbsp;tons&lt;BR&gt;<br>
&amp;gt;&nbsp;of&nbsp;garbage&nbsp;objects&nbsp;under&nbsp;heavy&nbsp;load.&lt;BR&gt;<br>
&amp;gt;&nbsp;When&nbsp;testing&nbsp;the&nbsp;server&nbsp;on&nbsp;Linux&nbsp;under&nbsp;load&nbsp;we&nbsp;saw&nbsp;very&nbsp;frequent&nbsp;CPU&lt;BR&gt;<br>
&amp;gt;&nbsp;bursts&lt;BR&gt;<br>
&amp;gt;&nbsp;that&nbsp;crippled&nbsp;the&nbsp;throughput&nbsp;of&nbsp;the&nbsp;server.&nbsp;After&nbsp;profiling&nbsp;with&nbsp;the&lt;BR&gt;<br>
&amp;gt;&nbsp;mono&lt;BR&gt;<br>
&amp;gt;&nbsp;built-in&nbsp;profiler&nbsp;I&nbsp;confirmed&nbsp;that&nbsp;the&nbsp;reason&nbsp;for&nbsp;the&nbsp;high&nbsp;CPU&nbsp;usage&nbsp;was&lt;BR&gt;<br>
&amp;gt;&nbsp;the&lt;BR&gt;<br>
&amp;gt;&nbsp;GC&nbsp;collections&nbsp;that&nbsp;got&nbsp;more&nbsp;and&nbsp;more&nbsp;frequent&nbsp;and&nbsp;took&nbsp;more&nbsp;and&nbsp;more&lt;BR&gt;<br>
&amp;gt;&nbsp;time.&lt;BR&gt;<br>
&amp;gt;&nbsp;I&nbsp;then&nbsp;read&nbsp;a&nbsp;little&nbsp;bit&nbsp;and&nbsp;realized&nbsp;that&nbsp;the&nbsp;Mono&nbsp;GC&nbsp;is&lt;BR&gt;<br>
&amp;gt;&nbsp;non-generational&lt;BR&gt;<br>
&amp;gt;&nbsp;which&nbsp;might&nbsp;explain&nbsp;the&nbsp;long&nbsp;GC&nbsp;cycles&nbsp;(if&nbsp;it&nbsp;was&nbsp;generational&nbsp;it&nbsp;could&lt;BR&gt;<br>
&amp;gt;&nbsp;have&lt;BR&gt;<br>
&amp;gt;&nbsp;collected&nbsp;the&nbsp;garbage&nbsp;objects&nbsp;that&nbsp;were&nbsp;created&nbsp;during&nbsp;async&nbsp;socket&lt;BR&gt;<br>
&amp;gt;&nbsp;operations&nbsp;in&nbsp;generation&nbsp;0&nbsp;and&nbsp;probably&nbsp;stop&nbsp;there,&nbsp;but&nbsp;it&nbsp;has&nbsp;to&lt;BR&gt;<br>
&amp;gt;&nbsp;traverse&lt;BR&gt;<br>
&amp;gt;&nbsp;the&nbsp;entire&nbsp;managed&nbsp;heap).&lt;BR&gt;<br>
&amp;gt;&nbsp;So&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;non-generational&nbsp;GC&nbsp;and&nbsp;the&nbsp;unimplemented&lt;BR&gt;<br>
&amp;gt;&nbsp;XXXAsync&lt;BR&gt;<br>
&amp;gt;&nbsp;Socket&nbsp;API&nbsp;result&nbsp;in&nbsp;very&nbsp;poor&nbsp;performance&nbsp;of&nbsp;the&nbsp;Mono&nbsp;server.&nbsp;The&lt;BR&gt;<br>
&amp;gt;&nbsp;maximum&lt;BR&gt;<br>
&amp;gt;&nbsp;throughput&nbsp;of&nbsp;the&nbsp;server&nbsp;with&nbsp;Mono&nbsp;on&nbsp;Linux&nbsp;is&nbsp;about&nbsp;half&nbsp;of&nbsp;that&nbsp;on&lt;BR&gt;<br>
&amp;gt;&nbsp;Windows&lt;BR&gt;<br>
&amp;gt;&nbsp;using&nbsp;.NET.&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;I&nbsp;attached&nbsp;the&nbsp;GC&nbsp;stats&nbsp;and&nbsp;profiling&nbsp;results&nbsp;of&nbsp;a&nbsp;15&nbsp;minute&nbsp;run.&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://old.nabble.com/file/p27026906/profile_alloc.log&quot;&gt;http://old.nabble.com/file/p27026906/profile_alloc.log&lt;/A&gt;&nbsp;profile_alloc.log&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://old.nabble.com/file/p27026906/gc_stats.log&quot;&gt;http://old.nabble.com/file/p27026906/gc_stats.log&lt;/A&gt;&nbsp;gc_stats.log&lt;BR&gt;<br>
&amp;gt;&nbsp;Can&nbsp;you&nbsp;help&nbsp;me&nbsp;out&nbsp;here?&lt;BR&gt;<br>
&amp;gt;&nbsp;--&lt;BR&gt;<br>
&amp;gt;&nbsp;View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://old.nabble.com/Fundamental-performance-problems-with-Mono-tp27026&quot;&gt;http://old.nabble.com/Fundamental-performance-problems-with-Mono-tp27026&lt;/A&gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;906p27026906.html&lt;BR&gt;<br>
&amp;gt;&nbsp;Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;Dev&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;_______________________________________________&lt;BR&gt;<br>
&amp;gt;&nbsp;Mono-devel-list&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&amp;gt;&nbsp;Mono-devel-list@lists.ximian.com&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/A&gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;_______________________________________________&lt;BR&gt;<br>
&amp;gt;&nbsp;Mono-devel-list&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
&amp;gt;&nbsp;Mono-devel-list@lists.ximian.com&lt;BR&gt;<br>
&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/A&gt;&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
--&lt;BR&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;A&nbsp;HREF=&quot;http://old.nabble.com/Fundamental-performance-problems-with-Mono-tp27026906p27075167.html&quot;&gt;http://old.nabble.com/Fundamental-performance-problems-with-Mono-tp27026906p27075167.html&lt;/A&gt;&lt;BR&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;Dev&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;BR&gt;<br>
&lt;BR&gt;<br>
_______________________________________________&lt;BR&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;BR&gt;<br>
Mono-devel-list@lists.ximian.com&lt;BR&gt;<br>
&lt;A&nbsp;HREF=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/A&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
