Index: System/String.cs
===================================================================
RCS file: /cvs/public/mcs/class/corlib/System/String.cs,v
retrieving revision 1.92
diff -u -b -r1.92 String.cs
--- System/String.cs	12 May 2003 10:47:16 -0000	1.92
+++ System/String.cs	20 Aug 2003 19:27:31 -0000
@@ -566,11 +566,15 @@
 		}
 	
 		public static string Format (IFormatProvider provider, string format, params object[] args) {
+			StringBuilder b = new StringBuilder ();
+			FormatHelper (b, provider, format, args);
+			return b.ToString ();
+		}
+		
+		internal static void FormatHelper (StringBuilder result, IFormatProvider provider, string format, params object[] args) {
 			if (format == null || args == null)
 				throw new ArgumentNullException ();
 		
-			StringBuilder result = new StringBuilder ();
-
 			int ptr = 0;
 			int start = ptr;
 			while (ptr < format.length) {
@@ -638,8 +642,6 @@
 
 			if (start < format.length)
 				result.Append (format.Substring (start));
-
-			return result.ToString ();
 		}
 
 		public static String Copy (String str) {
Index: System.Text/StringBuilder.cs
===================================================================
RCS file: /cvs/public/mcs/class/corlib/System.Text/StringBuilder.cs,v
retrieving revision 1.24
diff -u -b -r1.24 StringBuilder.cs
--- System.Text/StringBuilder.cs	10 May 2003 03:24:31 -0000	1.24
+++ System.Text/StringBuilder.cs	20 Aug 2003 19:27:31 -0000
@@ -432,7 +432,19 @@
 				throw new ArgumentOutOfRangeException();
 			}
 
-			return Append( new String( value, repeatCount) );
+			if( sLength + repeatCount > sCapacity ) {
+				// Need more capacity, double the capacity StringBuilder 
+				// and make sure we have at least enough for the value 
+				// if that's going to go over double. 
+					 
+				Capacity = repeatCount + ( sCapacity + sCapacity);
+			}
+			
+			for (int i = 0; i < repeatCount; i++)
+				sString [sLength++] = value;
+			
+			thestring = null;
+			return this;
 		}
 
 		public StringBuilder Append( char[] value, int startIndex, int charCount ) {
@@ -462,39 +474,42 @@
 				throw new ArgumentOutOfRangeException();
 			}
 
-			return Append (value.Substring (startIndex, count));
+			int new_size = sLength + count;
+			if (new_size > sCapacity)
+				Capacity = count + sCapacity * 2;
+
+			value.CopyTo (startIndex, sString, sLength, count);
+			sLength = new_size;
+			thestring = null;
+			return this;
 		}
 
 		public StringBuilder AppendFormat (string format, object arg0 )
 		{
-			string result = String.Format (format, arg0);
-			return Append (result);
+			return AppendFormat (null, format, new object [] { arg0 });
 		}
 
 		public StringBuilder AppendFormat (string format, params object[] args )
 		{
-			string result = String.Format (format, args);
-			return Append (result);
+			return AppendFormat (null, format, args);
 		}
 
 		public StringBuilder AppendFormat (IFormatProvider provider,
 						   string format,
 						   params object[] args)
 		{
-			string result = String.Format (provider, format, args);
-			return Append (result);
+			String.FormatHelper (this, provider, format, args);
+			return this;
 		}
 
 		public StringBuilder AppendFormat (string format, object arg0, object arg1 )
 		{
-			string result = String.Format (format, arg0, arg1);
-			return Append (result);
+			return AppendFormat (null, format, new object [] { arg0, arg1 });
 		}
 
 		public StringBuilder AppendFormat (string format, object arg0, object arg1, object arg2 )
 		{
-			string result = String.Format (format, arg0, arg1, arg2);
-			return Append (result);
+			return AppendFormat (null, format, new object [] { arg0, arg1, arg2 });
 		}
 
 		/*  The Insert Functions */
