<tt>
2006/7/26,&nbsp;Janne&nbsp;Rantala&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:janne.rantala@gmail.com&quot;&gt;janne.rantala@gmail.com&lt;/a&gt;&amp;gt;:&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;I've&nbsp;loaded&nbsp;assembly&nbsp;(compiled&nbsp;in&nbsp;&lt;a&nbsp;href=&quot;http://VS.NET&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;VS.NET&lt;/a&gt;)&nbsp;in&nbsp;embedded&nbsp;environment.&nbsp;This&nbsp;assembly&nbsp;is&nbsp;supposed&nbsp;to&nbsp;work&nbsp;as&nbsp;a&nbsp;client&nbsp;for&nbsp;web&nbsp;service.&nbsp;However&nbsp;this&nbsp;does&nbsp;not&nbsp;work&nbsp;because&nbsp;<br>
Assembly.GetEntryAssembly<br>
&nbsp;returns&nbsp;null&nbsp;when&nbsp;called&nbsp;from&nbsp;managed&nbsp;code.&nbsp;This&nbsp;causes&nbsp;ConfigurationManager&nbsp;to&nbsp;throw&nbsp;ArgumentException&nbsp;stating&nbsp;that&nbsp;&amp;quot;exePath&nbsp;must&nbsp;be&nbsp;specified&nbsp;when&nbsp;not&nbsp;running&nbsp;inside&nbsp;a&nbsp;stand&nbsp;alone&nbsp;exe&amp;quot;.&lt;br&gt;&lt;br&gt;MSDN&nbsp;&lt;a&nbsp;href=&quot;http://msdn2.microsoft.com/en-us/library/system.reflection.assembly.getentryassembly.aspx&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;<br>
<br>
http://msdn2.microsoft.com/en-us/library/system.reflection.assembly.getentryassembly.aspx&lt;/a&gt;&nbsp;says&nbsp;that&lt;br&gt;&lt;br&gt;&amp;quot;Return&nbsp;Value&lt;br&gt;The&nbsp;Assembly&nbsp;that&nbsp;is&nbsp;the&nbsp;process&nbsp;executable&nbsp;in&nbsp;the&nbsp;default&nbsp;application&lt;br&gt;domain,&nbsp;or&nbsp;the&nbsp;first&nbsp;executable&nbsp;that&nbsp;was&nbsp;executed&nbsp;by<br>
&lt;br&gt;AppDomain.ExecuteAssembly.&nbsp;Can&nbsp;return&nbsp;a&nbsp;null&nbsp;reference&nbsp;(Nothing&nbsp;in&lt;br&gt;Visual&nbsp;Basic)&nbsp;when&nbsp;called&nbsp;from&nbsp;unmanaged&nbsp;code.&amp;quot;&lt;br&gt;&lt;br&gt;But&nbsp;since&nbsp;this&nbsp;call&nbsp;is&nbsp;made&nbsp;from&nbsp;managed&nbsp;code&nbsp;it&nbsp;should&nbsp;return&nbsp;something&nbsp;else&nbsp;than&nbsp;null?&nbsp;Both&nbsp;<br>
Assembly.GetCallingAssembly()&nbsp;and&nbsp;Assembly.GetExecutingAssembly&nbsp;return&nbsp;the&nbsp;assembly&nbsp;I've&nbsp;loaded.&lt;br&gt;&lt;br&gt;Is&nbsp;this&nbsp;a&nbsp;bug?&lt;br&gt;&lt;br&gt;Here's&nbsp;the&nbsp;full&nbsp;stack&nbsp;trace&nbsp;if&nbsp;it's&nbsp;any&nbsp;help:&lt;br&gt;&lt;br&gt;&lt;span&gt;Unhandled&nbsp;Exception:&nbsp;System.TypeInitializationException<br>
<br>
:&nbsp;An&nbsp;exception&nbsp;was&nbsp;thrown&lt;br&gt;&lt;/span&gt;&lt;div&gt;&amp;nbsp;by&nbsp;the&nbsp;type&nbsp;initializer&nbsp;for&nbsp;System.Net.WebRequest&nbsp;---&amp;gt;&nbsp;System.ArgumentException&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;:&nbsp;exePath&nbsp;must&nbsp;be&nbsp;specified&nbsp;when&nbsp;not&nbsp;running&nbsp;inside&nbsp;a&nbsp;stand&nbsp;alone&nbsp;exe.<br>
&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;at&nbsp;System.Configuration.ConfigurationManager.OpenExeConfigurationInternal&nbsp;(Con&lt;br&gt;figurationUserLevel&nbsp;userLevel,&nbsp;System.Reflection.Assembly&nbsp;calling_assembly,&nbsp;Syst&lt;br&gt;em.String&nbsp;exePath)&nbsp;[0x00000]&lt;br&gt;<br>
<br>
&amp;nbsp;&nbsp;at&nbsp;System.Configuration.ClientConfigurationSystem.System.Configuration.Interna<br>
&lt;br&gt;l.IInternalConfigSystem.GetSection&nbsp;(System.String&nbsp;configKey)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;System.Configuration.ConfigurationManager.GetSection&nbsp;(System.String&nbsp;section&lt;br&gt;Name)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;System.Net.WebRequest..cctor&nbsp;()&nbsp;[0x00000]&nbsp;---&nbsp;End&nbsp;of&nbsp;inner&nbsp;exception&nbsp;stack<br>
&lt;br&gt;trace&nbsp;---&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;&amp;lt;0x00000&amp;gt;&nbsp;&amp;lt;unknown&nbsp;method&amp;gt;&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;System.Web.Services.Protocols.WebClientProtocol.GetWebRequest&nbsp;(System.Uri&nbsp;u&lt;br&gt;ri)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;System.Web.Services.Protocols.HttpWebClientProtocol.GetWebRequest<br>
<br>
<br>
&nbsp;(System.U&lt;br&gt;ri&nbsp;uri)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;System.Web.Services.Protocols.SoapHttpClientProtocol.GetWebRequest&nbsp;(System.&lt;br&gt;Uri&nbsp;uri)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;System.Web.Services.Protocols.SoapHttpClientProtocol.GetRequestForMessage&nbsp;(<br>
&lt;br&gt;System.Uri&nbsp;uri,&nbsp;System.Web.Services.Protocols.SoapClientMessage&nbsp;message)&nbsp;[0x0000&lt;br&gt;0]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;System.Web.Services.Protocols.SoapHttpClientProtocol.Invoke&nbsp;(System.String&lt;br&gt;method_name,&nbsp;System.Object[]&nbsp;parameters)&nbsp;[0x00000]<br>
&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;WSTest.net.xmethods.www.CurrencyExchangeService.getRate&nbsp;(System.String&nbsp;coun&lt;br&gt;try1,&nbsp;System.String&nbsp;country2)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;(wrapper&nbsp;remoting-invoke-with-check)&nbsp;WSTest.net.xmethods.www.CurrencyExchan&lt;br&gt;geService:getRate&nbsp;(string,string)<br>
&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;WSTest.Class1.WebServiceTest&nbsp;()&nbsp;[0x00000]&lt;/div&gt;&lt;br&gt;Cheers,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;sg&quot;&gt;&lt;br&gt;Janne&lt;br&gt;<br>
<br>
&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;Looks&nbsp;like&nbsp;the&nbsp;only&nbsp;place&nbsp;entry&nbsp;assembly&nbsp;is&nbsp;being&nbsp;set&nbsp;is&nbsp;mono_runtime_exec_main,&nbsp;which&nbsp;means&nbsp;that&nbsp;every&nbsp;time&nbsp;object&nbsp;is&nbsp;created&nbsp;I&nbsp;must&nbsp;also&nbsp;call&nbsp;Main&nbsp;method.&nbsp;Is&nbsp;this&nbsp;the&nbsp;way&nbsp;it&nbsp;is&nbsp;supposed&nbsp;to&nbsp;be?&nbsp;I'd&nbsp;imagine&nbsp;especially&nbsp;in&nbsp;embedded&nbsp;environment&nbsp;objects&nbsp;would&nbsp;be&nbsp;created&nbsp;without&nbsp;calling&nbsp;Main&nbsp;methods&nbsp;at&nbsp;all.<br>
&lt;br&gt;&lt;br&gt;Doing&nbsp;the&nbsp;mono_runtime_exec_main&nbsp;-call&nbsp;solves&nbsp;problem&nbsp;having&nbsp;GetEntryAssembly&nbsp;returning&nbsp;null&nbsp;and&nbsp;it&nbsp;also&nbsp;sets&nbsp;the&nbsp;AppDomain.CurrentDomain.SetupInformation.ConfigurationFile.&lt;br&gt;&lt;br&gt;Janne&lt;br&gt;<br>

</tt>
