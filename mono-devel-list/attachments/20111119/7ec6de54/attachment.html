<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;I&nbsp;write&nbsp;scientific&nbsp;numerical&nbsp;algorithms&nbsp;that&nbsp;are&nbsp;very&nbsp;data&nbsp;/&nbsp;array&nbsp;intensive.&nbsp;&amp;nbsp;Having&nbsp;recently&nbsp;moved&nbsp;from&nbsp;using&nbsp;the&nbsp;JVM&nbsp;to&nbsp;the&nbsp;Mono&nbsp;CLR,&nbsp;was&nbsp;curious&nbsp;about&nbsp;the&nbsp;pure&nbsp;numerical&nbsp;performance&nbsp;against&nbsp;arrays.&nbsp;&amp;nbsp;&nbsp;Towards&nbsp;this&nbsp;end,&nbsp;wrote&nbsp;a&nbsp;partial&nbsp;matrix&nbsp;class&nbsp;and&nbsp;driver&nbsp;around&nbsp;it&nbsp;to&nbsp;test&nbsp;performance&nbsp;across&nbsp;C++,&nbsp;JVM&nbsp;(Java),&nbsp;and&nbsp;CLRs&nbsp;(C#)&nbsp;with&nbsp;both&nbsp;safe&nbsp;and&nbsp;unsafe&nbsp;implementations.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;code&nbsp;is&nbsp;essentially&nbsp;the&nbsp;same&nbsp;across&nbsp;these&nbsp;languages,&nbsp;with&nbsp;the&nbsp;exception&nbsp;that&nbsp;I&nbsp;included&nbsp;an&nbsp;unsafe&nbsp;variant&nbsp;(using&nbsp;pointers),&nbsp;to&nbsp;see&nbsp;what&nbsp;sort&nbsp;of&nbsp;additional&nbsp;performance&nbsp;could&nbsp;be&nbsp;obtained&nbsp;in&nbsp;the&nbsp;CLR.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;a&nbsp;linux&nbsp;box&nbsp;had&nbsp;the&nbsp;following&nbsp;runtimes&nbsp;(where&nbsp;Java&nbsp;is&nbsp;1.7&nbsp;and&nbsp;mono&nbsp;2.10.6&nbsp;with&nbsp;LLVM&nbsp;and&nbsp;without&nbsp;(same&nbsp;#s)):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;CPP&nbsp;(Core&nbsp;i7-950):&nbsp;&amp;nbsp;&nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;01:28:818&lt;/div&gt;&lt;div&gt;Java&nbsp;(Core&nbsp;i7-950):&nbsp;&amp;nbsp;&nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;01:31.840&amp;nbsp;&lt;/div&gt;&lt;div&gt;Mono&nbsp;.NET&nbsp;(Core&nbsp;i7-950):&nbsp;&amp;nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;04:01.466&nbsp;(&lt;b&gt;unsafe,&nbsp;LLVM&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;Mono&nbsp;.NET&amp;nbsp;(Core&nbsp;i7-950):&nbsp;&amp;nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;04:29.680&nbsp;(&lt;b&gt;safe,&nbsp;LLVM&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Notice&nbsp;two&nbsp;things:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;class=&quot;MailOutline&quot;&gt;&lt;li&gt;the&nbsp;mono&nbsp;runtimes&nbsp;are&nbsp;~3x&nbsp;slower&nbsp;than&nbsp;the&nbsp;JVM&nbsp;or&nbsp;C++&lt;/li&gt;&lt;li&gt;the&nbsp;unsafe&nbsp;implementation&nbsp;offered&nbsp;very&nbsp;little&nbsp;performance&nbsp;improvement&nbsp;(why?)&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;decided&nbsp;to&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;MS&nbsp;.NET&nbsp;CLR&nbsp;on&nbsp;a&nbsp;VM&nbsp;and&nbsp;compare&nbsp;that&nbsp;with&nbsp;a&nbsp;C++&nbsp;baseline&nbsp;(since&nbsp;the&nbsp;VM&nbsp;is&nbsp;slower):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;CPP&nbsp;(VM):&nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&amp;nbsp;01:56:296&lt;/div&gt;&lt;div&gt;.NET&nbsp;(VM):&nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;02:17.359&nbsp;(&lt;b&gt;unsafe,&nbsp;MS&nbsp;CLR&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;.NET&nbsp;(VM):&nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;04.03.786&nbsp;(&lt;b&gt;safe,&nbsp;MS&nbsp;CLR&lt;/b&gt;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Interestingly,&nbsp;the&nbsp;MS&nbsp;CLR&nbsp;is&nbsp;almost&nbsp;as&nbsp;fast&nbsp;as&nbsp;C++&nbsp;with&nbsp;-O3&nbsp;optimisations&nbsp;for&nbsp;the&nbsp;unsafe&nbsp;implementation.&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;The&nbsp;&quot;safe&quot;&nbsp;implementation&nbsp;is&nbsp;2x&nbsp;as&nbsp;slow,&nbsp;in&nbsp;line&nbsp;with&nbsp;the&nbsp;idea&nbsp;that&nbsp;the&nbsp;unsafe&nbsp;implementation&nbsp;offers&nbsp;a&nbsp;significant&nbsp;performance&nbsp;advantage.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;&quot;safe&quot;&nbsp;implementations&nbsp;more&nbsp;or&nbsp;less&nbsp;align&nbsp;in&nbsp;that&nbsp;they&nbsp;are&nbsp;multiples&nbsp;slower&nbsp;than&nbsp;the&nbsp;C++&nbsp;implementation&nbsp;(3x&nbsp;in&nbsp;the&nbsp;case&nbsp;of&nbsp;mono&nbsp;and&nbsp;2x&nbsp;in&nbsp;the&nbsp;case&nbsp;of&nbsp;the&nbsp;MS&nbsp;CLR).&nbsp;&amp;nbsp;The&nbsp;mono&nbsp;implementation&nbsp;of&nbsp;the&nbsp;&quot;unsafe&quot;&nbsp;code&nbsp;shows&nbsp;very&nbsp;little&nbsp;performance&nbsp;benefit.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;am&nbsp;wondering&nbsp;the&nbsp;following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;class=&quot;MailOutline&quot;&gt;&lt;li&gt;are&nbsp;there&nbsp;runtime&nbsp;or&nbsp;compile&nbsp;parameters&nbsp;that&nbsp;would&nbsp;increase&nbsp;the&nbsp;performance&nbsp;of&nbsp;the&nbsp;unsafe&nbsp;code?&lt;/li&gt;&lt;li&gt;is&nbsp;the&nbsp;cost&nbsp;of&nbsp;pinning&nbsp;the&nbsp;arrays&nbsp;expensive?&lt;/li&gt;&lt;li&gt;is&nbsp;it&nbsp;just&nbsp;a&nbsp;lack&nbsp;of&nbsp;JIT&nbsp;optimisation&nbsp;on&nbsp;the&nbsp;unsafe&nbsp;code?&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;enclosing&nbsp;a&nbsp;source&nbsp;project&nbsp;with&nbsp;a&nbsp;csharp,&nbsp;java,&nbsp;and&nbsp;cpp&nbsp;sub-directory.&nbsp;&amp;nbsp;&nbsp;I&nbsp;hand&nbsp;compiled&nbsp;these,&nbsp;however,&nbsp;there&nbsp;is&nbsp;a&nbsp;sln&nbsp;that&nbsp;will&nbsp;compile&nbsp;the&nbsp;cpp&nbsp;and&nbsp;csharp&nbsp;parts.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ideas?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jonathan&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
