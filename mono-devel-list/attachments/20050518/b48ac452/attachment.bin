Index: Makefile
===================================================================
--- Makefile	(revision 44628)
+++ Makefile	(working copy)
@@ -11,7 +11,8 @@
 
 RUNTIME = mono --debug
 CSCOMPILE = mcs
-TESTS = testsuite/TESTS/Xalan_Conformance_Tests/whitespace/whitespace35.xsl
+CATALOG = testsuite/TESTS/catalog.xml
+FIXED_CATALOG = testsuite/TESTS/catalog-fixed.xml
 TARGET_RESULTS = Results
 MSTEST_RESULTS = testsuite/TESTS/ExpectedResults
 TEST_ARCHIVE = xslt-testsuite-03.ZIP
@@ -20,11 +21,11 @@
 
 test : xslttest.exe alltest.exe prepare
 
-prepare : $(TESTS) prepare-xslt prepare-mstest
+prepare : $(FIXED_CATALOG) prepare-xslt prepare-mstest
 
-prepare-xslt : xslttest.exe $(XSLTTEST_RESULTS) testsuite/TESTS/catalog-fixed.xml
+prepare-xslt : xslttest.exe $(XSLTTEST_RESULTS)
 
-prepare-mstest : alltest.exe $(MSTEST_RESULTS) testsuite/TESTS/catalog-fixed.xml
+prepare-mstest : alltest.exe $(MSTEST_RESULTS)
 
 xslttest.exe : xslttest.cs
 	$(CSCOMPILE) xslttest.cs
@@ -35,12 +36,12 @@
 alltest.exe : alltest.cs
 	$(CSCOMPILE) alltest.cs
 
-testsuite/TESTS/catalog-fixed.xml : testsuite/TESTS/catalog.xml catalog.sed
-	sed -f catalog.sed testsuite/TESTS/catalog.xml > testsuite/TESTS/catalog-fixed.xml
+$(FIXED_CATALOG) : $(CATALOG) catalog.sed
+	sed -f catalog.sed $(CATALOG) > $(FIXED_CATALOG)
 
-$(TESTS) : $(TEST_ARCHIVE)
+$(CATALOG) : $(TEST_ARCHIVE)
 	unzip -un $(TEST_ARCHIVE)
-	touch $(TESTS)
+	touch $(CATALOG)
 
 $(XSLTTEST_RESULTS) : $(XSLTTEST_RESULTS_ARCHIVE)
 	unzip -n -d $(XSLTTEST_RESULTS_ARCHIVE)
@@ -61,11 +62,11 @@
 
 run-test : run-test-xslt run-test-ms
 
-run-test-xslt : xslttest.exe testsuite/TESTS/catalog-fixed.xml
+run-test-xslt : xslttest.exe $(FIXED_CATALOG)
 	# Redirect stdout to /dev/null because it has only xsl:message garbage
 	$(RUNTIME) $(RUNTIME_FLAGS) xslttest.exe --report:TestResult.xml --xml --details --outall >/dev/null
 
-run-test-ms : alltest.exe xmlnorm.exe testsuite/TESTS/catalog-fixed.xml
+run-test-ms : alltest.exe xmlnorm.exe $(FIXED_CATALOG)
 	$(RUNTIME) $(RUNTIME_FLAGS) ./alltest.exe $(TARGET_RESULTS)
 	mono ./xmlnorm.exe -s testsuite/TESTS/$(TARGET_RESULTS) testsuite/TESTS/norm-tmp
 	rm -rf testsuite/TESTS/$(TARGET_RESULTS)
@@ -75,7 +76,7 @@
 clean : clean-xslttest clean-mstest
 	rm -f xslttest.exe
 
-clean-xslttest : xslttest.exe
+clean-xslttest : xslttest.exe $(FIXED_CATALOG)
 	if (test -e testsuite) then \
 		$(RUNTIME) ./xslttest.exe --list > output.lst; \
 		perl cleanup-output.pl; \
@@ -92,7 +93,12 @@
 	rm -rf testsuite
 	rm -f $(TEST_ARCHIVE) $(XSLTTEST_RESULTS_ARCHIVE) $(MSTEST_RESULTS_ARCHIVE)
 
-create-reference-output : clean-xslttest xslttest.exe
+# Check that we are running on MS.NET - otherwise the reference output can be
+# created on mono - and we will compare mono with mono
+must-be-dotnet:
+	uname | grep CYGWIN
+	
+create-reference-output : must-be-dotnet clean-xslttest xslttest.exe
 	./xslttest.exe --generate
 	./xslttest.exe --list > output.lst
 	zip xslttest-reference-output.zip -@ < output.lst
