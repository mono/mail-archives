Index: mono/mono/metadata/cominterop.c
===================================================================
--- mono/mono/metadata/cominterop.c	(revision 134598)
+++ mono/mono/metadata/cominterop.c	(working copy)
@@ -32,6 +32,7 @@
 #include "mono/metadata/attrdefs.h"
 #include "mono/metadata/gc-internal.h"
 #include "mono/utils/mono-counters.h"
+#include "mono/metadata/marshal-hooks.h"
 #include <string.h>
 #include <errno.h>
 
@@ -2409,8 +2410,8 @@
 	return TRUE;
 }
 
-gpointer
-mono_string_to_bstr (MonoString *string_obj)
+static gpointer
+mono_string_to_bstr_default (MonoString *string_obj)
 {
 	if (!string_obj)
 		return NULL;
@@ -2441,12 +2442,13 @@
 		return ret;
 	} else {
 		g_assert_not_reached ();
+		return 0;
 	}
 #endif
 }
 
-MonoString *
-mono_string_from_bstr (gpointer bstr)
+static MonoString *
+mono_string_from_bstr_default (gpointer bstr)
 {
 	if (!bstr)
 		return NULL;
@@ -2466,13 +2468,14 @@
 		return str;
 	} else {
 		g_assert_not_reached ();
+		return 0;
 	}
 
 #endif
 }
 
-void
-mono_free_bstr (gpointer bstr)
+static void
+mono_free_bstr_default (gpointer bstr)
 {
 	if (!bstr)
 		return;
@@ -2490,6 +2493,41 @@
 #endif
 }
 
+static MonoStringToBstrFunc mono_string_to_bstr_pfunc = mono_string_to_bstr_default;
+static MonoStringFromBstrFunc mono_string_from_bstr_pfunc = mono_string_from_bstr_default;
+static MonoFreeBstrFunc mono_free_bstr_pfunc = mono_free_bstr_default;
+
+void 
+mono_install_bstr_funcs (MonoStringToBstrFunc new_mono_string_to_bstr_pfunc,
+		   	 MonoStringFromBstrFunc new_mono_string_from_bstr_pfunc,
+			 MonoFreeBstrFunc new_mono_free_bstr_pfunc)
+{
+	if (!(new_mono_string_to_bstr_pfunc && new_mono_string_from_bstr_pfunc && new_mono_free_bstr_pfunc))
+		g_assert_not_reached ();
+	
+	mono_string_to_bstr_pfunc = new_mono_string_to_bstr_pfunc;
+	mono_string_from_bstr_pfunc = new_mono_string_from_bstr_pfunc;
+	mono_free_bstr_pfunc = new_mono_free_bstr_pfunc;
+}
+
+gpointer
+mono_string_to_bstr (MonoString *string_obj)
+{
+	return mono_string_to_bstr_pfunc (string_obj);
+}
+
+MonoString *
+mono_string_from_bstr (gpointer bstr)
+{
+	return mono_string_from_bstr_pfunc (bstr);
+}
+
+void
+mono_free_bstr (gpointer bstr)
+{
+	mono_free_bstr_pfunc (bstr);
+}
+
 #else /* DISABLE_COM */
 
 void
@@ -2533,4 +2571,11 @@
 	g_assert_not_reached ();
 }
 
+void 
+mono_install_bstr_funcs (MonoStringToBstrFunc new_mono_string_to_bstr_pfunc,
+		   	 MonoStringFromBstrFunc new_mono_string_from_bstr_pfunc,
+			 MonoFreeBstrFunc new_mono_free_bstr_pfunc)
+{
+	g_assert_not_reached ();
+}
 #endif /* DISABLE_COM */
Index: mono/mono/metadata/ChangeLog
===================================================================
--- mono/mono/metadata/ChangeLog	(revision 134598)
+++ mono/mono/metadata/ChangeLog	(working copy)
@@ -1,3 +1,16 @@
+2009-05-22  Bill Holmes  <billholmes54@gmail.com>
+
+	* cominterop.c : mono_string_to_bstr, mono_string_from_bstr and
+	  mono_free_bstr changed to call external hooks if installed.
+	  mono_install_bstr_funcs added to the set the hooks.
+
+	* marshal-hooks.h : Added to declare mono_install_bstr_funcs
+
+	* Makefile.am : Adding marshal-hooks.h to the list of public API
+	  header files.
+
+	Code is contributed under MIT/X11 license.
+
 2009-05-21  Miguel de Icaza  <miguel@novell.com>
 
 	* reflection.c: Remove code that it not used with
Index: mono/mono/metadata/marshal-hooks.h
===================================================================
--- mono/mono/metadata/marshal-hooks.h	(revision 0)
+++ mono/mono/metadata/marshal-hooks.h	(revision 0)
@@ -0,0 +1,18 @@
+#ifndef _MONO_MARSHAL_HOOKS_H_
+#define _MONO_MARSHAL_HOOKS_H_
+
+G_BEGIN_DECLS
+
+typedef gpointer (*MonoStringToBstrFunc)(MonoString *string_obj);
+typedef MonoString * (*MonoStringFromBstrFunc)(gpointer bstr);
+typedef void (*MonoFreeBstrFunc)(gpointer str);
+
+void 
+mono_install_bstr_funcs (MonoStringToBstrFunc new_mono_string_to_bstr_pfunc,
+			 MonoStringFromBstrFunc new_mono_string_from_bstr_pfunc,
+			 MonoFreeBstrFunc new_mono_free_bstr_pfunc);
+
+G_END_DECLS
+
+#endif
+
Index: mono/mono/metadata/Makefile.am
===================================================================
--- mono/mono/metadata/Makefile.am	(revision 134598)
+++ mono/mono/metadata/Makefile.am	(working copy)
@@ -179,6 +179,7 @@
 	exception.h		\
 	image.h			\
 	loader.h		\
+	marshal-hooks.h		\
 	mempool.h		\
 	metadata.h		\
 	mono-config.h		\