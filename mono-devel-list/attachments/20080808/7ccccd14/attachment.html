<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hey&nbsp;guys,&lt;br&gt;&lt;br&gt;I&nbsp;just&nbsp;got&nbsp;myself&nbsp;into&nbsp;a&nbsp;roadblock&nbsp;today&nbsp;while&nbsp;fixing&nbsp;overflow&nbsp;arithmetic&nbsp;under&nbsp;ARM.&nbsp;The&nbsp;issue&nbsp;is&nbsp;that&nbsp;the&nbsp;emitted&nbsp;IR&lt;br&gt;cannot&nbsp;be&nbsp;properly&nbsp;translated&nbsp;to&nbsp;native&nbsp;code.&lt;br&gt;&lt;br&gt;The&nbsp;ARM&nbsp;ISA&nbsp;has&nbsp;the&nbsp;oddity&nbsp;that&nbsp;carry/borrow&nbsp;works&nbsp;in&nbsp;the&nbsp;opposite&nbsp;way.&nbsp;Add&nbsp;with&nbsp;carry&nbsp;do&nbsp;a&nbsp;+1&nbsp;if&nbsp;the&nbsp;carry&nbsp;bit&nbsp;is&nbsp;set,&lt;br&gt;<br>
but&nbsp;Sub&nbsp;with&nbsp;borrow&nbsp;do&nbsp;a&nbsp;-1&nbsp;if&nbsp;the&nbsp;carry&nbsp;bit&nbsp;is&nbsp;not&nbsp;set.&lt;br&gt;&lt;br&gt;Then&nbsp;we&nbsp;have&nbsp;mono_decompose_opcode&nbsp;that&nbsp;use&nbsp;the&nbsp;same&nbsp;condition&nbsp;for&nbsp;both&nbsp;add&nbsp;and&nbsp;sub:&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;case&nbsp;OP_IADD_OVF:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ins-&amp;gt;opcode&nbsp;=&nbsp;OP_IADDCC;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MONO_EMIT_NEW_COND_EXC&nbsp;(cfg,&nbsp;IOV,&nbsp;&amp;quot;OverflowException&amp;quot;);&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;break;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;case&nbsp;OP_ISUB_OVF:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ins-&amp;gt;opcode&nbsp;=&nbsp;OP_ISUBCC;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MONO_EMIT_NEW_COND_EXC&nbsp;(cfg,&nbsp;IOV,&nbsp;&amp;quot;OverflowException&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;break;&lt;br&gt;&lt;br&gt;&lt;br&gt;I&nbsp;cannot&nbsp;fix&nbsp;that&nbsp;in&nbsp;the&nbsp;arm&nbsp;back-end&nbsp;as&nbsp;it&nbsp;should&nbsp;not&nbsp;reason&nbsp;about&nbsp;previous&nbsp;instructions.&lt;br&gt;<br>
My&nbsp;idea&nbsp;is&nbsp;to&nbsp;either&nbsp;move&nbsp;the&nbsp;SUB&nbsp;opcodes&nbsp;to&nbsp;arch&nbsp;specific&nbsp;code&nbsp;or&nbsp;add&nbsp;an&nbsp;#if&nbsp;MONO_ARCH_SUB_INVERTED_CARRY_FLAG.&lt;br&gt;&lt;br&gt;What&nbsp;do&nbsp;you&nbsp;guys&nbsp;think&nbsp;about&nbsp;this?&lt;br&gt;&lt;br&gt;Cheers,&lt;br&gt;Rodrigo&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
