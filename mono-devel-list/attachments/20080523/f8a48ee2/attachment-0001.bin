Index: ChangeLog
===================================================================
--- ChangeLog	(revision 103725)
+++ ChangeLog	(working copy)
@@ -1,3 +1,13 @@
+2008-05-23  Miguel de Icaza  <miguel@novell.com>
+
+	* Hashtable.cs: Implement a faster clone that does not use an
+	enumerator to iterate over the values, this doubles the speed of
+	Clone.
+
+	The use of an internal constructor that builds from a Hashtable is
+	done to avoid populating a Hashtable and then updating every field
+	and structure with new data. 
+
 2008-05-08  Robert Jordan  <robertj@gmx.net>
 
 	* DictionaryEntry.cs: Rename fields for serialization
Index: Hashtable.cs
===================================================================
--- Hashtable.cs	(revision 103725)
+++ Hashtable.cs	(working copy)
@@ -175,7 +175,27 @@
 		{
 		}
 
+		//
+		// Used as a faster Clone
+		//
+		internal Hashtable (Hashtable source)
+		{
+			inUse = source.inUse;
+			loadFactor = source.loadFactor;
+
+			table = (Slot []) source.table.Clone ();
+			hashes = (int []) source.hashes.Clone ();
+			threshold = source.threshold;
+			hcpRef = source.hcpRef;
+			comparerRef = source.comparerRef;
+			serializationInfo = source.serializationInfo;
+
 #if NET_2_0
+			equalityComparer = source.equalityComparer;
+#endif
+		}
+			
+#if NET_2_0
 		[Obsolete ("Please use Hashtable(int, IEqualityComparer) instead")]
 #endif
 		public Hashtable (int capacity,
@@ -519,25 +539,7 @@
 
 		public virtual object Clone ()
 		{
-#if NET_2_0
-			Hashtable ht = new Hashtable (Count, equalityComparer);
-			ht.hcp = this.hcp;
-			ht.comparer = this.comparer;
-#else
-			Hashtable ht = new Hashtable (Count, hcp, comparer);
-#endif
-			ht.inUse = 0;
-			ht.loadFactor = this.loadFactor;
-
-			// FIXME: maybe it's faster to simply
-			//        copy the back-end array?
-
-			IDictionaryEnumerator it = GetEnumerator ();
-			while (it.MoveNext ()) {
-				ht [it.Key] = it.Value;
-			}
-
-			return ht;
+			return new Hashtable (this);
 		}
 
 		public virtual void GetObjectData (SerializationInfo info, StreamingContext context)
