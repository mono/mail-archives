<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;May&nbsp;8,&nbsp;2008&nbsp;at&nbsp;1:40&nbsp;PM,&nbsp;Luis&nbsp;F.&nbsp;Ortiz&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:LuisOrtiz@verizon.net&quot;&gt;LuisOrtiz@verizon.net&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;On&nbsp;May&nbsp;7,&nbsp;2008,&nbsp;at&nbsp;10:50&nbsp;PM,&nbsp;Rodrigo&nbsp;Kumpera&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hi&nbsp;Luis,&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;have&nbsp;your&nbsp;patch&nbsp;integrated,&nbsp;some&nbsp;changes&nbsp;are&nbsp;needed.&nbsp;First,&nbsp;we&nbsp;want&nbsp;to&nbsp;default&nbsp;to&nbsp;32bits&nbsp;sized&nbsp;arrays&nbsp;on&nbsp;64bits&nbsp;machines,&nbsp;so&nbsp;your&nbsp;changes&nbsp;must&nbsp;be&nbsp;conditionally&nbsp;compiled.&nbsp;To&nbsp;help&nbsp;with&nbsp;that&nbsp;some&nbsp;changed&nbsp;to&nbsp;your&nbsp;patch&nbsp;are&nbsp;due.&nbsp;Next&nbsp;are&nbsp;some&nbsp;comments&nbsp;about&nbsp;it:&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Instead&nbsp;of&nbsp;replacing&nbsp;guint32&nbsp;for&nbsp;gsize,&nbsp;it&amp;#39;s&nbsp;better&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;type,&nbsp;let&amp;#39;s&nbsp;say&nbsp;array_size_t.&nbsp;This&nbsp;would&nbsp;reduce&nbsp;conditional&nbsp;compilation&nbsp;to&nbsp;fewer&nbsp;places.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Rodrigo:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Permit&nbsp;me&nbsp;to&nbsp;reply&nbsp;to&nbsp;your&nbsp;message&nbsp;in&nbsp;parts,&nbsp;so&nbsp;that&nbsp;I&nbsp;clear&nbsp;on&nbsp;what&nbsp;needs&nbsp;to&nbsp;be&nbsp;done,&nbsp;from&nbsp;your&nbsp;point&nbsp;of&nbsp;view.&lt;br&gt;<br>
&lt;br&gt;<br>
1)&nbsp;Add&nbsp;support&nbsp;for&nbsp;a&nbsp;new&nbsp;configuration&nbsp;argument&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;http://configure.in&quot;&nbsp;target=&quot;_blank&quot;&gt;configure.in&lt;/a&gt;&nbsp;(AC_ARG_ENABLE(big-arrays,[&nbsp;--enable-bug-arrays&nbsp;Enable&nbsp;allocation&nbsp;and&nbsp;indexing&nbsp;of&nbsp;arrays&nbsp;&amp;gt;&nbsp;31&nbsp;bits&nbsp;in&nbsp;size.],...))&lt;br&gt;<br>
<br>
2)&nbsp;Add&nbsp;a&nbsp;compile&nbsp;time&nbsp;define&nbsp;(AC_DEFINE(BIG_ARRAYS,1,[Enable&nbsp;allocation&nbsp;and&nbsp;indexing&nbsp;of&nbsp;arrays&nbsp;&amp;gt;&nbsp;31&nbsp;bits&nbsp;in&nbsp;size.]))&lt;br&gt;<br>
3)&nbsp;Use&nbsp;said&nbsp;compile&nbsp;time&nbsp;define&nbsp;to&nbsp;typedef&nbsp;array_size_t&nbsp;to&nbsp;either&nbsp;guint32&nbsp;or&nbsp;guint64&nbsp;depending&nbsp;on&nbsp;the&nbsp;state&nbsp;of&nbsp;BIG_ARRAYS&nbsp;in&nbsp;object.h&lt;br&gt;<br>
4)&nbsp;Use&nbsp;array_size_t&nbsp;where&nbsp;I&nbsp;used&nbsp;gsize&nbsp;in&nbsp;my&nbsp;patch.&lt;br&gt;<br>
&lt;br&gt;<br>
Questions:&lt;br&gt;<br>
&lt;br&gt;<br>
A)&nbsp;Do&nbsp;you&nbsp;agree&nbsp;then&nbsp;that&nbsp;the&nbsp;correct&nbsp;size&nbsp;types&nbsp;are&nbsp;either&nbsp;guint32&nbsp;or&nbsp;guint64?&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;Or&nbsp;would&nbsp;gint32&nbsp;and&nbsp;gint64&nbsp;be&nbsp;better&nbsp;choices&nbsp;as&nbsp;they&nbsp;would&nbsp;agree&nbsp;with&nbsp;the&nbsp;input&nbsp;arguments&nbsp;to&nbsp;ves_icall_System_Array_CreateInstanceImpl&nbsp;functions&nbsp;and&nbsp;the&nbsp;usage&nbsp;in&nbsp;socket-io.c?&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Arrays&nbsp;must&nbsp;be&nbsp;fully&nbsp;indexable&nbsp;using&nbsp;signed&nbsp;integers.&nbsp;This&nbsp;means&nbsp;max&nbsp;sizes&nbsp;must&nbsp;be&amp;nbsp;&nbsp;2^31&nbsp;-&nbsp;1&nbsp;or&nbsp;1^63&nbsp;-&nbsp;1.&nbsp;All&nbsp;math&nbsp;is&nbsp;done&nbsp;using&nbsp;unsigned&nbsp;integers&nbsp;to&nbsp;avoid&nbsp;overflow&nbsp;issues..&lt;br&gt;&amp;nbsp;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;br&gt;<br>
B)&nbsp;Should&nbsp;the&nbsp;CreateInstanceImpl64&nbsp;method&nbsp;definition&nbsp;in&nbsp;icall-def.h&nbsp;exist&nbsp;if&nbsp;BIG_ARRAYS&nbsp;is&nbsp;not&nbsp;defined.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;On&nbsp;this&nbsp;case&nbsp;it&amp;#39;s&nbsp;a&nbsp;matter&nbsp;if&nbsp;we&nbsp;want&nbsp;conditional&nbsp;compilation&nbsp;over&nbsp;BIG_ARRAYS&nbsp;to&nbsp;happen&nbsp;over&nbsp;the&nbsp;classlib&nbsp;as&nbsp;well.&nbsp;I&amp;#39;m&nbsp;prefer&nbsp;on&nbsp;doing&nbsp;all&nbsp;conditional&nbsp;compilation&nbsp;on&nbsp;unmanaged&nbsp;code&nbsp;only,&nbsp;but&nbsp;we&nbsp;rather&nbsp;listen&nbsp;to&nbsp;more&nbsp;opinions&nbsp;on&nbsp;this&nbsp;subject.&lt;br&gt;<br>
&amp;nbsp;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;br&gt;<br>
C)&nbsp;In&nbsp;the&nbsp;case&nbsp;where&nbsp;BIG_ARRAYS&nbsp;is&nbsp;not&nbsp;defined,&nbsp;&amp;nbsp;should&nbsp;ves_icall_System_Array_CreateInstanceImpl64()&nbsp;still&nbsp;exist&nbsp;and&nbsp;make&nbsp;sure&nbsp;all&nbsp;arguments&nbsp;fit&nbsp;into&nbsp;the&nbsp;small&nbsp;guint32?&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I&nbsp;favor&nbsp;this&nbsp;path&nbsp;of&nbsp;doing&nbsp;all&nbsp;conditional&nbsp;compilation&nbsp;on&nbsp;the&nbsp;unmanaged&nbsp;side.&lt;br&gt;&amp;nbsp;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;br&gt;<br>
D)&nbsp;mono_array_size_t&nbsp;or&nbsp;array_size_t?&nbsp;&amp;nbsp;&nbsp;Without&nbsp;the&nbsp;mono&nbsp;prefix,&nbsp;i&nbsp;fear&nbsp;that&nbsp;some&nbsp;third-party&nbsp;library&nbsp;might&nbsp;also&nbsp;use&nbsp;the&nbsp;obvious&nbsp;name.&nbsp;&amp;nbsp;Should&nbsp;the&nbsp;BIG_ARRAYS&nbsp;definition&nbsp;also&nbsp;use&nbsp;a&nbsp;MONO_&nbsp;prefix?&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Using&nbsp;mono&nbsp;prefix&nbsp;for&nbsp;both&nbsp;is&nbsp;the&nbsp;way&nbsp;to&nbsp;go.&lt;br&gt;&amp;nbsp;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
<br>
/Ortiz/Luis&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Cheers,&lt;br&gt;Rodrigo&nbsp;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
