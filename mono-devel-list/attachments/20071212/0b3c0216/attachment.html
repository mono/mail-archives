<tt>
<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;Ok.&nbsp;I&nbsp;did&nbsp;something&nbsp;very&nbsp;similiar.&nbsp;The<br>
only&nbsp;difference&nbsp;appears&nbsp;to&nbsp;be&nbsp;the&nbsp;_ReadBarrier.&nbsp;_ReadBarrier&nbsp;appears&nbsp;to<br>
work&nbsp;(it&nbsp;compiles&nbsp;and&nbsp;links).&nbsp;I&nbsp;haven't&nbsp;tried&nbsp;it&nbsp;at&nbsp;runtime&nbsp;yet.&nbsp;Does&nbsp;it<br>
not&nbsp;work&nbsp;at&nbsp;runtime?&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;#if&nbsp;_MSC_VER&nbsp;&amp;lt;&nbsp;1400&nbsp;//VS2003&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;extern<br>
void&nbsp;_ReadWriteBarrier();&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;extern&nbsp;void&nbsp;_ReadBarrier();&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;extern&nbsp;void&nbsp;_WriteBarrier();&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#pragma<br>
intrinsic(_ReadWriteBarrier)&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#pragma<br>
intrinsic(_WriteBarrier)&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;#else&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#include<br>
&amp;lt;intrin.h&amp;gt;&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;#endif&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;static<br>
inline&nbsp;void&nbsp;mono_memory_barrier&nbsp;(void)&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;_ReadWriteBarrier&nbsp;();&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;static<br>
inline&nbsp;void&nbsp;mono_memory_read_barrier&nbsp;(void)&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;_ReadBarrier&nbsp;();&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;static<br>
inline&nbsp;void&nbsp;mono_memory_write_barrier&nbsp;(void)&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;_WriteBarrier&nbsp;();&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&nbsp;face=&quot;sans-serif&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;table&nbsp;width=100%&gt;<br>
&lt;tr&nbsp;valign=top&gt;<br>
&lt;td&nbsp;width=40%&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;&lt;b&gt;&amp;quot;Aras&nbsp;Pranckevicius&amp;quot;<br>
&amp;lt;aras@unity3d.com&amp;gt;&lt;/b&gt;&nbsp;&lt;/font&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;Sent&nbsp;by:&nbsp;mono-devel-list-bounces@lists.ximian.com&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;12/12/2007&nbsp;03:55&nbsp;PM&lt;/font&gt;<br>
&lt;td&nbsp;width=59%&gt;<br>
&lt;table&nbsp;width=100%&gt;<br>
&lt;tr&nbsp;valign=top&gt;<br>
&lt;td&gt;<br>
&lt;div&nbsp;align=right&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;To&lt;/font&gt;&lt;/div&gt;<br>
&lt;td&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;mono-devel-list@lists.ximian.com&lt;/font&gt;<br>
&lt;tr&nbsp;valign=top&gt;<br>
&lt;td&gt;<br>
&lt;div&nbsp;align=right&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;cc&lt;/font&gt;&lt;/div&gt;<br>
&lt;td&gt;<br>
&lt;tr&nbsp;valign=top&gt;<br>
&lt;td&gt;<br>
&lt;div&nbsp;align=right&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;Subject&lt;/font&gt;&lt;/div&gt;<br>
&lt;td&gt;&lt;font&nbsp;size=1&nbsp;face=&quot;sans-serif&quot;&gt;Re:&nbsp;[Mono-dev]&nbsp;Building&nbsp;mono&nbsp;runtime<br>
in&nbsp;VS2003&lt;/font&gt;&lt;/table&gt;<br>
&lt;br&gt;<br>
&lt;table&gt;<br>
&lt;tr&nbsp;valign=top&gt;<br>
&lt;td&gt;<br>
&lt;td&gt;&lt;/table&gt;<br>
&lt;br&gt;&lt;/table&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&amp;gt;&nbsp;I&nbsp;have&nbsp;worked&nbsp;through&nbsp;most&nbsp;issues&nbsp;(eglib&nbsp;and<br>
libgc&nbsp;are&lt;br&gt;<br>
&amp;gt;&nbsp;building)&nbsp;but&nbsp;one&nbsp;has&nbsp;got&nbsp;me.&nbsp;In&nbsp;mono-membar.h&nbsp;(libmono)&nbsp;it&nbsp;is&nbsp;looking<br>
for&lt;br&gt;<br>
&amp;gt;&nbsp;intrin.h&nbsp;which&nbsp;does&nbsp;not&nbsp;ship&nbsp;with&nbsp;VS2003.&lt;br&gt;<br>
&lt;br&gt;<br>
Here's&nbsp;what&nbsp;we&nbsp;do:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#if&nbsp;_MSC_VER&nbsp;&amp;gt;=&nbsp;1400&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#include&nbsp;&amp;lt;intrin.h&amp;gt;&nbsp;/*&nbsp;VS2005&nbsp;*/&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#else&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;void&nbsp;_ReadWriteBarrier();&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#pragma&nbsp;intrinsic(_ReadWriteBarrier)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;void&nbsp;_WriteBarrier();&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#pragma&nbsp;intrinsic(_WriteBarrier)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#endif&lt;br&gt;<br>
&lt;br&gt;<br>
And&nbsp;then&nbsp;change&nbsp;mono_memory_read_barrier&nbsp;to:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#if&nbsp;_MSC_VER&nbsp;&amp;gt;=&nbsp;1400&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;_ReadBarrier&nbsp;();&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#else&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;_ReadWriteBarrier();&nbsp;/*&nbsp;VS2003&nbsp;does&nbsp;not&nbsp;have&nbsp;_ReadBarrier<br>
intrinsic&nbsp;*/&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;#endif&lt;br&gt;<br>
&lt;br&gt;<br>
VS2003&nbsp;does&nbsp;not&nbsp;seem&nbsp;to&nbsp;have&nbsp;ReadBarrier,&nbsp;so&nbsp;instead&nbsp;do&nbsp;a&nbsp;full&lt;br&gt;<br>
read&amp;amp;write&nbsp;barrier.&nbsp;Which&nbsp;can&nbsp;be&nbsp;a&nbsp;bit&nbsp;more&nbsp;expensive,&nbsp;but&nbsp;oh&nbsp;well.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Aras&nbsp;Pranckevicius&lt;br&gt;<br>
work:&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;a&nbsp;href=http://unity3d.com/&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://unity3d.com&lt;/font&gt;&lt;/tt&gt;&lt;/a&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&lt;br&gt;<br>
home:&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;a&nbsp;href=&quot;http://aras-p.info/&quot;&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://aras-p.info&lt;/font&gt;&lt;/tt&gt;&lt;/a&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
Mono-devel-list@lists.ximian.com&lt;br&gt;<br>
&lt;/font&gt;&lt;/tt&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/font&gt;&lt;/tt&gt;&lt;/a&gt;&lt;tt&gt;&lt;font&nbsp;size=2&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/tt&gt;<br>
&lt;br&gt;
</tt>
