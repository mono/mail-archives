<tt>
Hi&nbsp;Kornel,&lt;br&gt;&lt;br&gt;Your&nbsp;patch&nbsp;have&nbsp;a&nbsp;few&nbsp;issues.&nbsp;First,&nbsp;it&nbsp;does&nbsp;a&nbsp;lot&nbsp;of&nbsp;different&nbsp;stuff&nbsp;in&nbsp;the&nbsp;same&nbsp;patch,&nbsp;second&nbsp;no&nbsp;Changelog&nbsp;entries&nbsp;are&nbsp;provided.&lt;br&gt;&lt;br&gt;My&nbsp;suggestion&nbsp;is&nbsp;that&nbsp;yo&nbsp;split&nbsp;it&nbsp;in&nbsp;the&nbsp;following&nbsp;pieces&nbsp;and&nbsp;add&nbsp;Changelog&nbsp;entries&nbsp;so&nbsp;they&nbsp;can&nbsp;properly&nbsp;reviewed:&lt;br&gt;<br>
&lt;br&gt;-The&nbsp;change&nbsp;to&nbsp;mono_gc_init&nbsp;().&nbsp;This&nbsp;affects&nbsp;all&nbsp;platforms&nbsp;and&nbsp;require&nbsp;more&nbsp;reviewer&nbsp;effort&nbsp;that&nbsp;the&nbsp;rest.&lt;br&gt;&lt;br&gt;-SEH&nbsp;for&nbsp;reading&nbsp;mapped&nbsp;images.&nbsp;Can&nbsp;this&nbsp;change&nbsp;break&nbsp;cygwin/mingw&nbsp;builds?&lt;br&gt;&lt;br&gt;-coree/vtable&nbsp;fixups&nbsp;stuff.&nbsp;This&nbsp;one&nbsp;requires&nbsp;less&nbsp;reviewing&nbsp;as&nbsp;your&amp;#39;re&nbsp;the&nbsp;author&nbsp;of&nbsp;it&nbsp;and&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;affect&nbsp;other&nbsp;targets.&lt;br&gt;<br>
&lt;br&gt;Thanks,&lt;br&gt;Rodrigo&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2009/5/5&nbsp;Kornél&nbsp;Pál&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:kornelpal@gmail.com&quot;&gt;kornelpal@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;attached&nbsp;patch&nbsp;implements&nbsp;using&nbsp;trampolines&nbsp;for&nbsp;vtable&nbsp;fixups&nbsp;that&nbsp;delay&nbsp;assembly&nbsp;loading.&nbsp;I&nbsp;believe&nbsp;that&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;solution.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;patch&nbsp;also&nbsp;modifies:&lt;br&gt;<br>
&lt;br&gt;<br>
1)&nbsp;EXE&nbsp;image&nbsp;is&nbsp;only&nbsp;fixed&nbsp;up&nbsp;when&nbsp;using&nbsp;driver.c;&nbsp;embedded&nbsp;mono.dll&nbsp;will&nbsp;not&nbsp;improperly&nbsp;tamper&nbsp;the&nbsp;image&nbsp;used&nbsp;for&nbsp;version&nbsp;initialization.&lt;br&gt;<br>
&lt;br&gt;<br>
2)&nbsp;Use&nbsp;SEH&nbsp;with&nbsp;MS&nbsp;VC++&nbsp;for&nbsp;reading&nbsp;mapped&nbsp;image.&nbsp;(GCC&nbsp;has&nbsp;no&nbsp;support&nbsp;for&nbsp;that:(&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
3)&nbsp;Disallow&nbsp;unloading&nbsp;mono.dll&nbsp;after&nbsp;mscoree.dll&nbsp;was&nbsp;fixed&nbsp;up&nbsp;to&nbsp;prevent&nbsp;calling&nbsp;unmapped&nbsp;functions.&lt;br&gt;<br>
&lt;br&gt;<br>
4)&nbsp;Remove&nbsp;WaitForSingleObjectEx&nbsp;in&nbsp;mono_gc_init&nbsp;()&nbsp;by&nbsp;modifying&nbsp;mono_thread_create_internal&nbsp;to&nbsp;return&nbsp;the&nbsp;thread&nbsp;object.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;latter&nbsp;also&nbsp;affects&nbsp;other&nbsp;platform.&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;ask&nbsp;you&nbsp;to&nbsp;test&nbsp;it.&nbsp;I&nbsp;wasn&amp;#39;t&nbsp;able&nbsp;to&nbsp;reproduce&nbsp;any&nbsp;deadlock&nbsp;related&nbsp;to&nbsp;this.&nbsp;(I&nbsp;only&nbsp;found&nbsp;a&nbsp;deadlock&nbsp;with&nbsp;socket&nbsp;accept&nbsp;on&nbsp;Windows&nbsp;that&nbsp;was&nbsp;discussed&nbsp;earlier&nbsp;on&nbsp;the&nbsp;list.)&nbsp;If&nbsp;you&nbsp;can&nbsp;reproduce&nbsp;a&nbsp;deadlock&nbsp;related&nbsp;to&nbsp;finalizer&nbsp;thread&nbsp;I&nbsp;am&nbsp;willing&nbsp;to&nbsp;help&nbsp;solving&nbsp;that&nbsp;but&nbsp;I&nbsp;need&nbsp;the&nbsp;exact&nbsp;locaions&nbsp;of&nbsp;deadlocked&nbsp;thread&nbsp;stack&nbsp;traces.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
Kornél&lt;br&gt;<br>
&lt;/font&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
