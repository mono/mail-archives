Index: ChangeLog
===================================================================
RCS file: /mono/mcs/class/corlib/System/ChangeLog,v
retrieving revision 1.760
diff -u -3 -p -r1.760 ChangeLog
--- ChangeLog	24 Apr 2004 08:13:58 -0000	1.760
+++ ChangeLog	24 Apr 2004 19:50:14 -0000
@@ -1,3 +1,12 @@
+2004-04-24  Robert Shade <rshade@dvsconsulting.com>
+
+	* Char.cs: Make seperate InternalToUpper/InternalToUpper methods
+	  so that null values can me checked in managed code.
+	* Char.cs: Created internal ToUpperInvariant/ToLowerInvariant methods
+	  to directly use the invariant locale to save a comparison.
+	* Char.cs: (ToUpper/ToLower) Check for invariant locale here
+	  instead of in unmanaged code.
+
 2004-04-24  Andreas Nahr <ClassDevelopment@A-SoftTech.com>
 
 	* String.cs: Check for null values
Index: Char.cs
===================================================================
RCS file: /mono/mcs/class/corlib/System/Char.cs,v
retrieving revision 1.27
diff -u -3 -p -r1.27 Char.cs
--- Char.cs	21 Apr 2004 15:01:12 -0000	1.27
+++ Char.cs	24 Apr 2004 19:50:14 -0000
@@ -447,6 +447,11 @@ namespace System
 
 		public static char ToLower (char c)
 		{
+			return ToLower(c, CultureInfo.CurrentCulture);
+		}
+
+		internal static char ToLowerInvariant (char c)
+		{
 			unsafe {
 				if (c <= ((char)0x24cf))
 					return (char) to_lower_data_low [c];
@@ -456,22 +461,43 @@ namespace System
 			return c;
 		}
 
-		[MethodImplAttribute (MethodImplOptions.InternalCall)]
-		public static extern char ToLower (char c, CultureInfo culture);
+		public static char ToLower (char c, CultureInfo culture)
+		{
+			if (culture == null)
+				throw new ArgumentException("culture");
+
+			if (culture.LCID == 0x007F)
+				return ToLowerInvariant(c);
+
+			return InternalToLower(c, culture);
+		}
 
 		public static char ToUpper (char c)
 		{
+			return ToUpper(c, CultureInfo.CurrentCulture);
+		}
+
+		internal static char ToUpperInvariant(char c)
+		{
 			unsafe {
-				if (c <= ((char)0x24cf))
-					return (char) to_upper_data_low [c];
-				if (c >= ((char)0xff21))
-					return (char) to_upper_data_high [c - 0xff21];
-			}
-			return c;
+                                if (c <= ((char)0x24cf))
+                                        return (char) to_upper_data_low [c];
+                                if (c >= ((char)0xff21))
+                                        return (char) to_upper_data_high [c - 0xff21];
+                        }
+                        return c;
 		}
 
-		[MethodImplAttribute (MethodImplOptions.InternalCall)]
-		public static extern char ToUpper (char c, CultureInfo culture);
+		public static char ToUpper (char c, CultureInfo culture)
+		{
+			if (culture == null)
+				throw new ArgumentException("culture");
+
+			if (culture.LCID == 0x007F)
+				return ToUpperInvariant(c);
+
+			return InternalToUpper(c, culture);
+		}
 		
 		public override string ToString ()
 		{
@@ -582,6 +608,12 @@ namespace System
 		{
 			return System.Convert.ToUInt64(m_value);
 		}
+
+		[MethodImplAttribute (MethodImplOptions.InternalCall)]
+		public static extern char InternalToUpper(char c, CultureInfo culture);	
+
+		[MethodImplAttribute (MethodImplOptions.InternalCall)]
+		public static extern char InternalToLower(char c, CultureInfo culture);
 	}
 }
