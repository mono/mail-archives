<tt>
&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&nbsp;border-collapse:&nbsp;collapse;&nbsp;&quot;&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;We&nbsp;have&nbsp;implemented&nbsp;a&nbsp;simple&nbsp;self&nbsp;hosted&nbsp;web&nbsp;service&nbsp;in&nbsp;.NET&nbsp;using&nbsp;ServiceHost.&lt;span&gt;  &lt;/span&gt;The&nbsp;Client&nbsp;is&nbsp;a&nbsp;simple&nbsp;Silverlight&nbsp;app&nbsp;that&nbsp;polls&nbsp;for&nbsp;updated&nbsp;info&nbsp;every&nbsp;5&nbsp;seconds.&nbsp;The&nbsp;return&nbsp;messages&nbsp;tend&nbsp;to&nbsp;be&nbsp;no&nbsp;more&nbsp;that&nbsp;1-10K.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt; &lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;&lt;span&gt; &lt;/span&gt;We&nbsp;ported&nbsp;the&nbsp;web&nbsp;service&nbsp;(self-hosted) &lt;span&gt; &lt;/span&gt;to&nbsp;MONO&nbsp;2.6.&nbsp;This&nbsp;seemed&nbsp;to&nbsp;go&nbsp;perfectly&nbsp;and&nbsp;it&nbsp;stood&nbsp;up&nbsp;to&nbsp;stress&nbsp;testing&nbsp;in&nbsp;devel...then&nbsp;we&nbsp;deployed&nbsp;it.&nbsp;Now&nbsp;we&nbsp;find&nbsp;that&nbsp;the&nbsp;service&nbsp;is&nbsp;unstable&nbsp;and&nbsp;can&nbsp;just&nbsp;hangs&nbsp;after&nbsp;anywhere&nbsp;between&nbsp;2&nbsp;minutes&nbsp;and&nbsp;2&nbsp;days.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;IP&nbsp;traces&nbsp;show&nbsp;that&nbsp;when&nbsp;it&nbsp;hangs&nbsp;the&nbsp;XML&nbsp;Post&nbsp;gets&nbsp;(request)&nbsp;gets&nbsp;received&nbsp;by&nbsp;the&nbsp;webservice&nbsp;but&nbsp;nothing&nbsp;is&nbsp;ever&nbsp;transmitted&nbsp;back. &lt;span&gt; &lt;/span&gt;Also&nbsp;when&nbsp;it&nbsp;hangs&nbsp;netstat&nbsp;shows&nbsp;a&nbsp;persistent&nbsp;active&nbsp;connection&nbsp;on&nbsp;the&nbsp;port&nbsp;to&nbsp;which&nbsp;it&nbsp;is&nbsp;allocated.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt; &lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;In&nbsp;an&nbsp;attempt&nbsp;to&nbsp;diagnose&nbsp;this&nbsp;we&nbsp;looked&nbsp;at&nbsp;the&nbsp;port&nbsp;behaviour&nbsp;using&nbsp;netstat.&nbsp;We&nbsp;looked&nbsp;at&nbsp;this&nbsp;while&nbsp;the&nbsp;MONO&nbsp;implementation&nbsp;of&nbsp;the&nbsp;webservice&nbsp;was&nbsp;running&nbsp;without&nbsp;problem;&nbsp;we&nbsp;compare&nbsp;this&nbsp;to&nbsp;the&nbsp;active&nbsp;port&nbsp;connection&nbsp;behaviour&nbsp;of&nbsp;the&nbsp;windows/.NET&nbsp;implementation-&nbsp;what&nbsp;found&nbsp;was&nbsp;worrying.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt; &lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;When&nbsp;we&nbsp;run&nbsp;a&nbsp;single&nbsp;client&nbsp;and&nbsp;connect&nbsp;the&nbsp;windows/.NET&nbsp;version&nbsp;of&nbsp;the&nbsp;webservice&nbsp;we&nbsp;see &lt;b&gt;one&nbsp;port&nbsp;connection&nbsp;that&nbsp;persists&lt;/b&gt;.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;When&nbsp;we&nbsp;run&nbsp;a&nbsp;single&nbsp;client&nbsp;and&nbsp;connect&nbsp;the&nbsp;MONO&nbsp;version&nbsp;of&nbsp;the&nbsp;webservice&nbsp;we&nbsp;see&nbsp;it&nbsp;holds&nbsp;around &lt;b&gt;12-16&nbsp;active&nbsp;port&nbsp;connections&nbsp;at&nbsp;any&nbsp;one&nbsp;time&lt;/b&gt;...and&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;continuously&nbsp;dying&nbsp;and&nbsp;regenerating.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;We&nbsp;postulated&nbsp;that&nbsp;each&nbsp;call&nbsp;to&nbsp;the&nbsp;webservice&nbsp;was&nbsp;making&nbsp;a&nbsp;new&nbsp;connection&nbsp;(unlike&nbsp;Windows);&nbsp;each&nbsp;connection&nbsp;would&nbsp;be&nbsp;used&nbsp;once&nbsp;and&nbsp;then&nbsp;timeout.&nbsp;Given&nbsp;the&nbsp;rate&nbsp;that&nbsp;the&nbsp;client&nbsp;polls&nbsp;we&nbsp;estimated&nbsp;that&nbsp;the&nbsp;timeout&nbsp;must&nbsp;be&nbsp;around&nbsp;a&nbsp;minute...then&nbsp;we&nbsp;found&nbsp;this&nbsp;in&nbsp;the&nbsp;MONO &lt;span&nbsp;style=&quot;font-size:&nbsp;9pt;&nbsp;line-height:&nbsp;13px;&nbsp;color:&nbsp;black;&nbsp;&quot;&gt;DefaultCommunicationTimeouts.cs&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;<br>
<br>
&lt;span&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;9pt;&nbsp;line-height:&nbsp;13px;&nbsp;color:&nbsp;black;&nbsp;&quot;&gt;Vilius: &lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;9pt;&nbsp;line-height:&nbsp;13px;&nbsp;color:&nbsp;black;&nbsp;&quot;&gt;private&nbsp;DefaultCommunicationTimeouts&nbsp;()&lt;br&gt;{&lt;br&gt;close&nbsp;=&nbsp;open&nbsp;=&nbsp;send&nbsp;=&nbsp;TimeSpan.FromMinutes&nbsp;(1);&lt;br&gt;<br>
<br>
receive&nbsp;=&nbsp;TimeSpan.FromMinutes&nbsp;(10);&lt;br&gt;}&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;This&nbsp;strongly&nbsp;supports&nbsp;our&nbsp;theory...&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&nbsp;&quot;&gt;<br>
<br>
The&nbsp;question&nbsp;is&nbsp;why&nbsp;does&nbsp;it&nbsp;keep&nbsp;creating&nbsp;a&nbsp;new&nbsp;connection&nbsp;for&nbsp;each&nbsp;call?&nbsp;Can&nbsp;the&nbsp;MONO&nbsp;2.6&nbsp;implementation&nbsp;of&nbsp;ServiceHost&nbsp;maintain&nbsp;a&nbsp;single&nbsp;connection&nbsp;for&nbsp;an&lt;span&gt; &lt;/span&gt;application&nbsp;session&nbsp;(like&nbsp;Windows&nbsp;.NET)&nbsp;?&nbsp;What&nbsp;is&nbsp;the&nbsp;ramification&nbsp;of&nbsp;this? &lt;/p&gt;<br>
<br>
&lt;/span&gt;<br>

</tt>
