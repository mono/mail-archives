Index: object.c
===================================================================
--- object.c	(revision 69309)
+++ object.c	(working copy)
@@ -1992,7 +1992,7 @@
 	MonoDomain *domain = mono_domain_get ();
 
 	if (!main_args)
-		return NULL;
+		mono_raise_exception (mono_get_exception_not_supported ("No command line arguments supplied."));
 
 	res = (MonoArray*)mono_array_new (domain, mono_defaults.string_class, num_main_args);
 
@@ -2052,56 +2052,57 @@
 	
 	mono_thread_set_main (mono_thread_current ());
 
-	main_args = g_new0 (char*, argc);
-	num_main_args = argc;
+	if (mono_method_signature (method)->param_count) {
+		main_args = g_new0 (char*, argc);
+		num_main_args = argc;
 
-	if (!g_path_is_absolute (argv [0])) {
-		gchar *basename = g_path_get_basename (argv [0]);
-		gchar *fullpath = g_build_filename (method->klass->image->assembly->basedir,
-						    basename,
-						    NULL);
+		if (!g_path_is_absolute (argv [0])) {
+			gchar *basename = g_path_get_basename (argv [0]);
+			gchar *fullpath = g_build_filename (method->klass->image->assembly->basedir,
+								basename,
+								NULL);
 
-		utf8_fullpath = mono_utf8_from_external (fullpath);
-		if(utf8_fullpath == NULL) {
-			/* Printing the arg text will cause glib to
-			 * whinge about "Invalid UTF-8", but at least
-			 * its relevant, and shows the problem text
-			 * string.
-			 */
-			g_print ("\nCannot determine the text encoding for the assembly location: %s\n", fullpath);
-			g_print ("Please add the correct encoding to MONO_EXTERNAL_ENCODINGS and try again.\n");
-			exit (-1);
-		}
+			utf8_fullpath = mono_utf8_from_external (fullpath);
+			if(utf8_fullpath == NULL) {
+				/* Printing the arg text will cause glib to
+				* whinge about "Invalid UTF-8", but at least
+				* its relevant, and shows the problem text
+				* string.
+				*/
+				g_print ("\nCannot determine the text encoding for the assembly location: %s\n", fullpath);
+				g_print ("Please add the correct encoding to MONO_EXTERNAL_ENCODINGS and try again.\n");
+				exit (-1);
+			}
 
-		g_free (fullpath);
-		g_free (basename);
-	} else {
-		utf8_fullpath = mono_utf8_from_external (argv[0]);
-		if(utf8_fullpath == NULL) {
-			g_print ("\nCannot determine the text encoding for the assembly location: %s\n", argv[0]);
-			g_print ("Please add the correct encoding to MONO_EXTERNAL_ENCODINGS and try again.\n");
-			exit (-1);
+			g_free (fullpath);
+			g_free (basename);
+		} else {
+			utf8_fullpath = mono_utf8_from_external (argv[0]);
+			if(utf8_fullpath == NULL) {
+				g_print ("\nCannot determine the text encoding for the assembly location: %s\n", argv[0]);
+				g_print ("Please add the correct encoding to MONO_EXTERNAL_ENCODINGS and try again.\n");
+				exit (-1);
+			}
 		}
-	}
 
-	main_args [0] = utf8_fullpath;
+		main_args [0] = utf8_fullpath;
 
-	for (i = 1; i < argc; ++i) {
-		gchar *utf8_arg;
+		for (i = 1; i < argc; ++i) {
+			gchar *utf8_arg;
 
-		utf8_arg=mono_utf8_from_external (argv[i]);
-		if(utf8_arg==NULL) {
-			/* Ditto the comment about Invalid UTF-8 here */
-			g_print ("\nCannot determine the text encoding for argument %d (%s).\n", i, argv[i]);
-			g_print ("Please add the correct encoding to MONO_EXTERNAL_ENCODINGS and try again.\n");
-			exit (-1);
+			utf8_arg=mono_utf8_from_external (argv[i]);
+			if(utf8_arg==NULL) {
+				/* Ditto the comment about Invalid UTF-8 here */
+				g_print ("\nCannot determine the text encoding for argument %d (%s).\n", i, argv[i]);
+				g_print ("Please add the correct encoding to MONO_EXTERNAL_ENCODINGS and try again.\n");
+				exit (-1);
+			}
+
+			main_args [i] = utf8_arg;
 		}
+		argc--;
+		argv++;
 
-		main_args [i] = utf8_arg;
-	}
-	argc--;
-	argv++;
-	if (mono_method_signature (method)->param_count) {
 		args = (MonoArray*)mono_array_new (domain, mono_defaults.string_class, argc);
 		for (i = 0; i < argc; ++i) {
 			/* The encodings should all work, given that