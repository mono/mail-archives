using System;
using System.Configuration;
using System.Net;
using System.Net.Mail;

/// <summary>
/// Summary description for Mail
/// </summary>
public class Mail
{
    private SmtpClient smtpClient = new SmtpClient("neptune.digitalnetworks.co.uk");
    private MailMessage message = new MailMessage();

    public class Address
    {
        public string Email;
        public string DisplayName;

        public Address()
        {
            Email = "";
            DisplayName = "";
        }
    }

    public string Subject
    {
        set { message.Subject = value; }
        get { return message.Subject; }
    }

    public string Body
    {
        set { message.Body = value; }
        get { return message.Body; }
    }

    public Address From
    {
        set
        {
            if (value.Email != null)
            {
                MailAddress address;
                if (value.DisplayName != null)
                {
                    address = new MailAddress(value.Email.Trim(), value.DisplayName.Trim());
                }
                else
                {
                    address = new MailAddress(value.Email.Trim());
                }
                message.From = address;
            }
        }
        get
        {
            Address address = new Address();
            address.Email = message.From.Address;
            address.DisplayName = message.From.DisplayName;
            return address;
        }
    }

    public void AddRecipient(Address address)
    {
        try
        {
            if (address.Email != null)
            {
                MailAddress mailAddress = new MailAddress(address.Email);
                if (address.DisplayName != null)
                {
                    mailAddress = new MailAddress(address.Email, address.DisplayName);
                }
                message.To.Add(mailAddress);
            }
        }
        catch (Exception ex)
        {
            DigiSite.Logger.HandleError(ex);
        }
    }

    public bool Send()
    {
        try
        {
            message.IsBodyHtml = true;
			smtpClient.UseDefaultCredentials = false;
			smtpClient.Credentials = null;
            message.Subject = ConfigurationManager.AppSettings["Email Prefix"] + message.Subject;
            smtpClient.Send(message);
            return true;
            
        }
        catch (Exception ex)
        {
            DigiSite.Logger.HandleError(ex);
            return false;
        }
    }
}
