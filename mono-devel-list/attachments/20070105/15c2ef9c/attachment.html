<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
Happy&nbsp;New&nbsp;Year&nbsp;all!&lt;br&gt;<br>
&lt;br&gt;<br>
Porting&nbsp;our&nbsp;software&nbsp;to&nbsp;Mono/Linux,&nbsp;we're&nbsp;facing&nbsp;a&nbsp;strange&nbsp;situation<br>
with&nbsp;pointers&nbsp;on&nbsp;Mono/Linux.&nbsp;I&nbsp;would&nbsp;call&nbsp;it&nbsp;a&nbsp;bug,&nbsp;but&nbsp;before&nbsp;to&nbsp;post<br>
it&nbsp;on&nbsp;bugzilla,&nbsp;I&nbsp;would&nbsp;have&nbsp;liked&nbsp;to&nbsp;have&nbsp;the&nbsp;opportunity&nbsp;to&nbsp;discuss<br>
about&nbsp;it...&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;app&nbsp;uses&nbsp;a&nbsp;serialization&nbsp;mechanism&nbsp;based&nbsp;on&nbsp;pointers&nbsp;(and&nbsp;not&nbsp;on<br>
Marshal.Copy,&nbsp;notably&nbsp;for&nbsp;performance&nbsp;reasons).&nbsp;This&nbsp;works&nbsp;well&nbsp;in&nbsp;.NET<br>
but,&nbsp;when&nbsp;sending&nbsp;the&nbsp;byte&nbsp;array&nbsp;over&nbsp;the&nbsp;network&nbsp;and&nbsp;trying&nbsp;to<br>
deserialize&nbsp;it&nbsp;on&nbsp;Mono/Linux,&nbsp;that&nbsp;crashes.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Trying&nbsp;to&nbsp;understand&nbsp;what&nbsp;was&nbsp;wrong,&nbsp;I&nbsp;discovered&nbsp;that&nbsp;a&nbsp;given&nbsp;struct<br>
has&nbsp;not&nbsp;the&nbsp;same&nbsp;size&nbsp;for&nbsp;.NET&nbsp;and&nbsp;for&nbsp;Mono&nbsp;/&nbsp;Linux,&nbsp;even&nbsp;when&nbsp;playing<br>
with&nbsp;the&nbsp;Pack&nbsp;args.&nbsp;That&nbsp;seems&nbsp;very&nbsp;surprising...&nbsp;and&nbsp;I&nbsp;would&nbsp;it&nbsp;a&nbsp;bug<br>
of&nbsp;Mono&nbsp;on&nbsp;Linux.&nbsp;Any&nbsp;advice&nbsp;on&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;demonstrate&nbsp;it,&nbsp;I&nbsp;just&nbsp;created&nbsp;a&nbsp;simple&nbsp;dummy&nbsp;console&nbsp;application<br>
which&nbsp;basically&nbsp;defines&nbsp;a&nbsp;structure&nbsp;and&nbsp;then&nbsp;does<br>
&quot;Console.Writeline(sizeof(myStruct))&quot;&nbsp;(see&nbsp;code&nbsp;below)&nbsp;.&nbsp;If&nbsp;you&nbsp;run<br>
this<br>
application&nbsp;first&nbsp;in&nbsp;.NET&nbsp;/&nbsp;Windows,&nbsp;then&nbsp;on&nbsp;Mono&nbsp;/&nbsp;Linux,&nbsp;it&nbsp;gives&nbsp;two<br>
different&nbsp;results,&nbsp;respectively&nbsp;32&nbsp;bytes&nbsp;for&nbsp;the&nbsp;serialized&nbsp;struct&nbsp;in<br>
.NET/Windows&nbsp;and&nbsp;48&nbsp;for&nbsp;Mono&nbsp;/&nbsp;Linux.&nbsp;Once&nbsp;again,&nbsp;I've&nbsp;played&nbsp;with&nbsp;the<br>
Pack&nbsp;args&nbsp;as&nbsp;you&nbsp;can&nbsp;see&nbsp;from&nbsp;the<br>
sample&nbsp;code&nbsp;(I&nbsp;had&nbsp;tried&nbsp;with&nbsp;0&nbsp;(system-defined)&nbsp;then&nbsp;with&nbsp;1),&nbsp;but&nbsp;this<br>
has&nbsp;no&nbsp;impact&nbsp;on&nbsp;the&nbsp;fact&nbsp;I&nbsp;still&nbsp;had&nbsp;different&nbsp;results&nbsp;between&nbsp;.NET<br>
/Windows&amp;nbsp;&nbsp;and&nbsp;Mono&nbsp;/&nbsp;Linux.&lt;br&gt;<br>
&lt;br&gt;<br>
Any&nbsp;help&nbsp;appreciated!&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;moz-signature&quot;&gt;Lionel&nbsp;Cuir,&lt;br&gt;<br>
Associate&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#0000ff&quot;&gt;&lt;b&gt;Aulofee&nbsp;Supervision&nbsp;Systems<br>
(&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.aulofee.com&quot;&gt;http://www.aulofee.com&lt;/a&gt;)&lt;/b&gt;&lt;br&gt;<br>
*&nbsp;Security&nbsp;&amp;amp;&nbsp;Log&nbsp;correlation&lt;br&gt;<br>
*&nbsp;real-time&nbsp;Inventory&nbsp;&amp;amp;&nbsp;Detection&nbsp;of&nbsp;software&nbsp;&amp;amp;&nbsp;hardware&lt;br&gt;<br>
*&nbsp;Reporting&lt;br&gt;<br>
*&nbsp;Network&nbsp;Cartography&lt;/font&gt;&lt;br&gt;<br>
&amp;nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#000000&quot;&gt;&lt;i&gt;Sample&nbsp;code&nbsp;to&nbsp;demonstrate&nbsp;the&nbsp;problem:&lt;/i&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
using&nbsp;System;&lt;br&gt;<br>
using&nbsp;System.Runtime.InteropServices;&lt;br&gt;<br>
&lt;br&gt;<br>
namespace&nbsp;ConsoleApplication1&lt;br&gt;<br>
{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;class&nbsp;Program&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;unsafe&nbsp;static&nbsp;void&nbsp;Main(string[]&nbsp;args)&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Console.WriteLine(sizeof(InternalStructSvcMsg));&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Console.ReadLine();&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;[StructLayout(LayoutKind.Sequential,&nbsp;Pack&nbsp;=&nbsp;0)]&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;struct&nbsp;InternalStructSvcMsg&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;int&nbsp;CallerID;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;DateTime&nbsp;DateOfCreation;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;int&nbsp;From;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;int&nbsp;FromFunctionID;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;int&nbsp;To;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;int&nbsp;ToFunctionID;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;bool&nbsp;ToKeep;&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;InternalStructSvcMsg(int&nbsp;i)&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;CallerID&nbsp;=&nbsp;i;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;DateOfCreation&nbsp;=&nbsp;DateTime.MinValue;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;From&nbsp;=&nbsp;0;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;FromFunctionID&nbsp;=&nbsp;0;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;To&nbsp;=&nbsp;0;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ToFunctionID&nbsp;=&nbsp;0;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ToKeep&nbsp;=&nbsp;true;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
}&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>

</tt>
