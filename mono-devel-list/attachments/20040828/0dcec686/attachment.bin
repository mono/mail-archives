? DbDataAdapter.diff
Index: DbDataAdapter.cs
===================================================================
RCS file: /cvs/public/mcs/class/System.Data/System.Data.Common/DbDataAdapter.cs,v
retrieving revision 1.44
diff -u -r1.44 DbDataAdapter.cs
--- DbDataAdapter.cs	24 Jun 2004 16:25:02 -0000	1.44
+++ DbDataAdapter.cs	28 Aug 2004 03:01:27 -0000
@@ -285,25 +285,31 @@
 			try {
 				string tableName = srcTable;
 				do {
-					tableName = SetupSchema (SchemaType.Mapped, tableName);
-					if (tableName != null) {
-						// check if the table exists in the dataset
-						if (dataSet.Tables.Contains (tableName)) 
-							// get the table from the dataset
-							dataTable = dataSet.Tables [tableName];
-						else {
-							dataTable = new DataTable(tableName);
-							dataSet.Tables.Add (dataTable);
-						}
-
-						if (!FillTable (dataTable, dataReader, startRecord, maxRecords, ref count)) {
-							continue;
+					.
+					// Non-resultset queries like insert, delete or update aren't processed.
+                    if (dataReader.FieldCount != -1)
+					{
+						tableName = SetupSchema (SchemaType.Mapped, tableName);
+						if (tableName != null) {
+						
+							// check if the table exists in the dataset
+							if (dataSet.Tables.Contains (tableName)) 
+								// get the table from the dataset
+								dataTable = dataSet.Tables [tableName];
+							else {
+								dataTable = new DataTable(tableName);
+								dataSet.Tables.Add (dataTable);
+							}
+	
+							if (!FillTable (dataTable, dataReader, startRecord, maxRecords, ref count)) {
+								continue;
+							}
+	
+							tableName = String.Format ("{0}{1}", srcTable, ++resultIndex);
+	
+							startRecord = 0;
+							maxRecords = 0;
 						}
-
-						tableName = String.Format ("{0}{1}", srcTable, ++resultIndex);
-
-						startRecord = 0;
-						maxRecords = 0;
 					}
 				} while (dataReader.NextResult ());
 			} 
@@ -490,6 +496,7 @@
 		private int[] BuildSchema (IDataReader reader, DataTable table, SchemaType schemaType)
 		{
 			int readerIndex = 0;
+                           
 			int[] mapping = new int[reader.FieldCount]; // mapping the reader indexes to the datatable indexes
 			ArrayList primaryKey = new ArrayList ();
 			ArrayList sourceColumns = new ArrayList ();
