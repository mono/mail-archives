<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=ISO-8859-1&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
You&nbsp;asked&nbsp;for&nbsp;thoughts,&nbsp;so&nbsp;here&nbsp;I&nbsp;go...&amp;nbsp;&amp;nbsp;&nbsp;Overall&nbsp;I&nbsp;like&nbsp;it.&amp;nbsp;&nbsp;The&nbsp;use<br>
of&nbsp;lambda&nbsp;delegates&nbsp;is&nbsp;great.&amp;nbsp;&nbsp;As&nbsp;in&nbsp;perl,&nbsp;it&nbsp;helps&nbsp;keep&nbsp;the<br>
code&nbsp;succinct,&nbsp;and&nbsp;allows&nbsp;the&nbsp;snippets&nbsp;of&nbsp;option&nbsp;handling&nbsp;code&nbsp;to&nbsp;sit<br>
right&nbsp;next&nbsp;to&nbsp;the&nbsp;option&nbsp;definition.&amp;nbsp;&nbsp;A&nbsp;big&nbsp;plus&nbsp;in&nbsp;my&nbsp;book.&lt;br&gt;<br>
&lt;br&gt;<br>
Where&nbsp;I&nbsp;think&nbsp;you&nbsp;may&nbsp;have&nbsp;OD'ed&nbsp;on&nbsp;the&nbsp;crack&nbsp;(:-)&nbsp;is&nbsp;in&nbsp;the<br>
use&nbsp;of&nbsp;an&nbsp;enumerator&nbsp;and&nbsp;ToArray()&nbsp;to&nbsp;parse&nbsp;the&nbsp;arguments.&amp;nbsp;&nbsp;Its&nbsp;a<br>
cleaver&nbsp;implementation,&nbsp;and&nbsp;I&nbsp;think&nbsp;you&nbsp;should&nbsp;keep&nbsp;it&nbsp;as&nbsp;an&nbsp;internal<br>
mechanism.&amp;nbsp;&nbsp;But&nbsp;from&nbsp;a&nbsp;user&nbsp;perspective&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;non-obvious.&amp;nbsp;<br>
Most&nbsp;people&nbsp;would&nbsp;expect&nbsp;a&nbsp;method&nbsp;called&nbsp;Parse()&nbsp;on&nbsp;an&nbsp;object&nbsp;called<br>
Options&nbsp;to&nbsp;actually&nbsp;parse&nbsp;the&nbsp;options.&amp;nbsp;&nbsp;And&nbsp;seeing&nbsp;a&nbsp;call&nbsp;to&nbsp;ToArray()<br>
where&nbsp;you&nbsp;don't&nbsp;actually&nbsp;use&nbsp;the&nbsp;result&nbsp;(which&nbsp;will&nbsp;be&nbsp;typical&nbsp;for<br>
commands&nbsp;that&nbsp;don't&nbsp;use&nbsp;extra&nbsp;arguments)&nbsp;is&nbsp;very&nbsp;mysterious.&lt;br&gt;<br>
&lt;br&gt;<br>
A&nbsp;better&nbsp;approach,&nbsp;I&nbsp;think,&nbsp;would&nbsp;be&nbsp;have&nbsp;a&nbsp;Parse()&nbsp;method&nbsp;that&nbsp;parses<br>
the&nbsp;argument&nbsp;list&nbsp;and&nbsp;returns&nbsp;the&nbsp;extra&nbsp;arguments&nbsp;via&nbsp;an&nbsp;out<br>
parameter.&amp;nbsp;&nbsp;I&nbsp;like&nbsp;using&nbsp;an&nbsp;out&nbsp;parameter&nbsp;because&nbsp;it&nbsp;signals&nbsp;that<br>
Parse()&nbsp;is&nbsp;doing&nbsp;more&nbsp;than&nbsp;just&nbsp;producing&nbsp;an&nbsp;array.&amp;nbsp;&nbsp;Taking&nbsp;this<br>
approach,<br>
I&nbsp;would&nbsp;rename&nbsp;your&nbsp;existing&nbsp;Parse()&nbsp;method&nbsp;to&nbsp;something&nbsp;like<br>
GetArgumentParser()&nbsp;and&nbsp;make&nbsp;it&nbsp;private.&amp;nbsp;&nbsp;Then&nbsp;I&nbsp;would&nbsp;have&nbsp;the&nbsp;new<br>
Parse()&nbsp;method&nbsp;call&nbsp;GetArgumentParser()&nbsp;as&nbsp;part&nbsp;of&nbsp;its&nbsp;implementation.&lt;br&gt;<br>
&lt;br&gt;<br>
Another&nbsp;thing&nbsp;I&nbsp;think&nbsp;is&nbsp;really&nbsp;important&nbsp;is&nbsp;better&nbsp;error&nbsp;handling&nbsp;for<br>
typed&nbsp;options.&amp;nbsp;&nbsp;If&nbsp;the&nbsp;call&nbsp;to&nbsp;TypeConverter.ConvertFromString()&nbsp;fails,<br>
the&nbsp;exception&nbsp;thrown&nbsp;needs&nbsp;to&nbsp;identify&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;option&nbsp;that<br>
failed&nbsp;as&nbsp;well&nbsp;as&nbsp;its&nbsp;value.&amp;nbsp;&nbsp;I&nbsp;would&nbsp;create&nbsp;a&nbsp;specific&nbsp;exception&nbsp;class<br>
to&nbsp;convey&nbsp;this&nbsp;(with&nbsp;the&nbsp;original&nbsp;exception&nbsp;inside)&nbsp;so&nbsp;that&nbsp;the&nbsp;case<br>
can&nbsp;be&nbsp;caught&nbsp;and&nbsp;handled&nbsp;separately&nbsp;in<br>
the&nbsp;user's&nbsp;code.&lt;br&gt;<br>
&lt;br&gt;<br>
Finally,&nbsp;it&nbsp;looks&nbsp;like&nbsp;this&nbsp;code&nbsp;doesn't&nbsp;handle&nbsp;the&nbsp;case&nbsp;of&nbsp;option<br>
values&nbsp;separated&nbsp;by&nbsp;whitespace--e.g.&nbsp;&quot;--foo&nbsp;42&quot;.&amp;nbsp;&nbsp;I&nbsp;think&nbsp;a&nbsp;lot&nbsp;of<br>
people&nbsp;will&nbsp;miss&nbsp;this&nbsp;feature.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;hope&nbsp;this&nbsp;was&nbsp;helpful.&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;Jay&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Jonathan&nbsp;Pryor&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid:1199906603.8432.216.camel@lina.magi.jprl.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I've&nbsp;been&nbsp;doing&nbsp;a&nbsp;lot&nbsp;of&nbsp;work&nbsp;on&nbsp;monodocer,&nbsp;and&nbsp;(for&nbsp;some&nbsp;unknown<br>
reason)&nbsp;decided&nbsp;that&nbsp;the&nbsp;warning&nbsp;about&nbsp;the&nbsp;deprecation&nbsp;of<br>
Mono.GetOptions&nbsp;was&nbsp;annoying&nbsp;so&nbsp;I&nbsp;thought&nbsp;I'd&nbsp;come&nbsp;up&nbsp;with&nbsp;a<br>
replacement.<br>
<br>
This&nbsp;replacement&nbsp;is&nbsp;NOT&nbsp;currently&nbsp;intended&nbsp;to&nbsp;be&nbsp;stable,&nbsp;nor&nbsp;to&nbsp;be<br>
bundled&nbsp;with&nbsp;Mono&nbsp;itself&nbsp;for&nbsp;public&nbsp;use.<br>
<br>
It&nbsp;is&nbsp;also&nbsp;extremely&nbsp;crack-addled,&nbsp;which&nbsp;is&nbsp;why&nbsp;I'm&nbsp;liking&nbsp;it&nbsp;so&nbsp;much,<br>
and&nbsp;why&nbsp;I&nbsp;thought&nbsp;I'd&nbsp;share&nbsp;it&nbsp;with&nbsp;you.<br>
<br>
Crack-addled?&nbsp;&nbsp;How&nbsp;else&nbsp;would&nbsp;you&nbsp;describe&nbsp;this&nbsp;cunning&nbsp;combination&nbsp;of<br>
collection&nbsp;initializers&nbsp;and&nbsp;lambda&nbsp;delegates?<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;help&nbsp;=&nbsp;false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;verbose&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;source&nbsp;=&nbsp;null;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;p&nbsp;=&nbsp;new&nbsp;Options&nbsp;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;h|?|help&quot;,&nbsp;&nbsp;v&nbsp;=&amp;gt;&nbsp;help&nbsp;=&nbsp;v&nbsp;!=&nbsp;null&nbsp;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;v|verbose&quot;,&nbsp;v&nbsp;=&amp;gt;&nbsp;{&nbsp;++verbose;&nbsp;}&nbsp;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;source=&quot;,&nbsp;&nbsp;&nbsp;v&nbsp;=&amp;gt;&nbsp;source&nbsp;=&nbsp;v&nbsp;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Parse&nbsp;(new&nbsp;string[]{&quot;--help&quot;,&nbsp;&quot;-v&quot;,&nbsp;&quot;-v&quot;,&nbsp;&quot;-source=foo&quot;})<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.ToArray&nbsp;();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
After&nbsp;p.Parse().ToArray(),&nbsp;help=true,&nbsp;verbose=2,&nbsp;and&nbsp;source=&quot;foo&quot;.<br>
<br>
It&nbsp;is&nbsp;inspired&nbsp;by&nbsp;Perl's&nbsp;Getopt::Long&nbsp;library,&nbsp;except&nbsp;that&nbsp;all&nbsp;option<br>
processing&nbsp;is&nbsp;done&nbsp;via&nbsp;delegates&nbsp;(i.e.&nbsp;Perl&nbsp;`sub's)&nbsp;and&nbsp;not&nbsp;via&nbsp;by-ref<br>
variables&nbsp;(as&nbsp;Perl&nbsp;also&nbsp;supports).<br>
<br>
No&nbsp;reflection&nbsp;is&nbsp;used&nbsp;unless&nbsp;you&nbsp;use&nbsp;TypeConverter&nbsp;to&nbsp;implicitly&nbsp;convert<br>
strings&nbsp;to&nbsp;random&nbsp;managed&nbsp;types:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;n&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;p&nbsp;=&nbsp;new&nbsp;Options&nbsp;()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&quot;n=&quot;,&nbsp;(int&nbsp;v)&nbsp;=&amp;gt;&nbsp;n&nbsp;=&nbsp;v&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
<br>
Options&nbsp;currently&nbsp;supports:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Parameters&nbsp;of&nbsp;the&nbsp;form:&nbsp;-flag,&nbsp;--flag,&nbsp;/flag,&nbsp;-flag=value,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--flag=value,&nbsp;/flag=value,&nbsp;-flag:value,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--flag:value,&nbsp;/flag:value,&nbsp;-flag&nbsp;value,&nbsp;--flag&nbsp;value,&nbsp;/flag<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&quot;boolean&quot;&nbsp;parameters&nbsp;of&nbsp;the&nbsp;form:&nbsp;-flag,&nbsp;--flag,&nbsp;and&nbsp;/flag.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Boolean&nbsp;parameters&nbsp;can&nbsp;have&nbsp;a&nbsp;`+'&nbsp;or&nbsp;`-'&nbsp;appended&nbsp;to&nbsp;explicitly<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enable&nbsp;or&nbsp;disable&nbsp;the&nbsp;flag&nbsp;(in&nbsp;the&nbsp;same&nbsp;fashion&nbsp;as&nbsp;mcs&nbsp;-debug+).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;boolean&nbsp;callbacks,&nbsp;the&nbsp;provided&nbsp;value&nbsp;is&nbsp;non-null&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled,&nbsp;and&nbsp;null&nbsp;for&nbsp;disabled.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&quot;value&quot;&nbsp;parameters&nbsp;with&nbsp;a&nbsp;required&nbsp;value&nbsp;(append&nbsp;`='&nbsp;to&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;option&nbsp;name)&nbsp;or&nbsp;an&nbsp;optional&nbsp;value&nbsp;(append&nbsp;`:'&nbsp;to&nbsp;the&nbsp;option<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name).&nbsp;The&nbsp;option&nbsp;value&nbsp;can&nbsp;either&nbsp;be&nbsp;in&nbsp;the&nbsp;current&nbsp;option<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(--opt=value)&nbsp;or&nbsp;in&nbsp;the&nbsp;following&nbsp;parameter&nbsp;(--opt&nbsp;value).&nbsp;The<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actual&nbsp;value&nbsp;is&nbsp;provided&nbsp;as&nbsp;the&nbsp;parameter&nbsp;to&nbsp;the&nbsp;callback<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delegate,&nbsp;unless&nbsp;it's&nbsp;(1)&nbsp;optional&nbsp;and&nbsp;(2)&nbsp;missing,&nbsp;in&nbsp;which<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;null&nbsp;is&nbsp;passed.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&quot;bundled&quot;&nbsp;parameters&nbsp;which&nbsp;must&nbsp;start&nbsp;with&nbsp;a&nbsp;single&nbsp;`-'&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consists&nbsp;of&nbsp;only&nbsp;single&nbsp;characters.&nbsp;In&nbsp;this&nbsp;manner,&nbsp;-abc&nbsp;would<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;be&nbsp;a&nbsp;shorthand&nbsp;for&nbsp;-a&nbsp;-b&nbsp;-c.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Option&nbsp;processing&nbsp;is&nbsp;disabled&nbsp;when&nbsp;--&nbsp;is&nbsp;encountered.<br>
<br>
Furthermore,&nbsp;it&nbsp;does&nbsp;not&nbsp;treat&nbsp;'-'&nbsp;options&nbsp;differently&nbsp;from&nbsp;'--'&nbsp;or&nbsp;'/'<br>
options,&nbsp;aside&nbsp;from&nbsp;the&nbsp;aforementioned&nbsp;bundling&nbsp;support.<br>
<br>
Regardless,&nbsp;at&nbsp;~270&nbsp;LOC&nbsp;for&nbsp;the&nbsp;associated&nbsp;classes&nbsp;(not&nbsp;including<br>
comments&nbsp;or&nbsp;tests),&nbsp;I&nbsp;think&nbsp;it's&nbsp;a&nbsp;reasonably&nbsp;concise&nbsp;and&nbsp;useful&nbsp;library<br>
for&nbsp;command-line&nbsp;option&nbsp;processing.<br>
<br>
See&nbsp;also:&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;href=&quot;http://www.jprl.com/Blog/archive/development/mono/2008/Jan-07.html&quot;&gt;http://www.jprl.com/Blog/archive/development/mono/2008/Jan-07.html&lt;/a&gt;<br>
<br>
Thoughts?<br>
<br>
-&nbsp;Jon<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;hr&nbsp;size=&quot;4&quot;&nbsp;width=&quot;90%&quot;&gt;<br>
_______________________________________________<br>
Mono-devel-list&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;<br>
&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;<br>
&lt;/pre&gt;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
