<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;Hi&nbsp;all,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;I’m&nbsp;running&nbsp;into&nbsp;a&nbsp;strange&nbsp;problem&nbsp;when&nbsp;trying&nbsp;to&nbsp;use&nbsp;Mono&nbsp;4.4.1.0&nbsp;on&nbsp;an&nbsp;ARM&nbsp;architecture.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;When&nbsp;I&nbsp;try&nbsp;to&nbsp;execute&nbsp;a&nbsp;Mono&nbsp;application&nbsp;or&nbsp;simply&nbsp;run&nbsp;mcs,&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;output:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;class=&quot;&quot;&gt;#&nbsp;mcs&lt;br&nbsp;class=&quot;&quot;&gt;*&nbsp;Assertion&nbsp;at&nbsp;unwind.c:385,&nbsp;condition&nbsp;`read16&nbsp;(p)&nbsp;==&nbsp;(guint32)(op-&gt;when&nbsp;-&nbsp;loc)'&nbsp;not&nbsp;met&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Stacktrace:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Native&nbsp;stacktrace:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Debug&nbsp;info&nbsp;from&nbsp;gdb:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;=================================================================&lt;br&nbsp;class=&quot;&quot;&gt;Got&nbsp;a&nbsp;SIGABRT&nbsp;while&nbsp;executing&nbsp;native&nbsp;code.&nbsp;This&nbsp;usually&nbsp;indicates&lt;br&nbsp;class=&quot;&quot;&gt;a&nbsp;fatal&nbsp;error&nbsp;in&nbsp;the&nbsp;mono&nbsp;runtime&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;native&nbsp;libraries&nbsp;&lt;br&nbsp;class=&quot;&quot;&gt;used&nbsp;by&nbsp;your&nbsp;application.&lt;br&nbsp;class=&quot;&quot;&gt;=================================================================&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Aborted&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/font&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;The&nbsp;same&nbsp;application&nbsp;and&nbsp;mcs&nbsp;work&nbsp;fine&nbsp;with&nbsp;Mono&nbsp;4.0.2,&nbsp;I&nbsp;used&nbsp;a&nbsp;while&nbsp;ago.&nbsp;Looking&nbsp;at&nbsp;the&nbsp;source&nbsp;code&nbsp;in&nbsp;mono/mini/unwind.c&nbsp;in&nbsp;function&nbsp;mono_unwind_ops_encode_full,&nbsp;I&nbsp;can&nbsp;see&nbsp;that&nbsp;the&nbsp;code&nbsp;tries&nbsp;to&nbsp;cast&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;guint16&nbsp;or&nbsp;guint32&nbsp;pointer,&nbsp;which&nbsp;will&nbsp;fail&nbsp;on&nbsp;(my)&nbsp;ARM&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;not&nbsp;aligned&nbsp;(lines&nbsp;378&nbsp;and&nbsp;384).&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;}&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pl-k&quot;&nbsp;style=&quot;box-sizing:&nbsp;border-box;&nbsp;color:&nbsp;rgb(167,&nbsp;29,&nbsp;93);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&quot;&gt;else&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pl-k&quot;&nbsp;style=&quot;box-sizing:&nbsp;border-box;&nbsp;color:&nbsp;rgb(167,&nbsp;29,&nbsp;93);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&quot;&gt;if&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;(op-&gt;when&nbsp;-&nbsp;loc&nbsp;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;pl-c1&quot;&nbsp;style=&quot;box-sizing:&nbsp;border-box;&nbsp;color:&nbsp;rgb(0,&nbsp;134,&nbsp;179);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&quot;&gt;256&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;)&nbsp;{&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;*p&nbsp;++&nbsp;=&nbsp;DW_CFA_advance_loc2;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(248,&nbsp;238,&nbsp;199);&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;*(guint16*)p&nbsp;=&nbsp;(guint16)(op-&gt;when&nbsp;-&nbsp;loc);&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;pl-c1&quot;&nbsp;style=&quot;box-sizing:&nbsp;border-box;&nbsp;color:&nbsp;rgb(0,&nbsp;134,&nbsp;179);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;g_assert&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;(&lt;/span&gt;&lt;span&nbsp;class=&quot;pl-c1&quot;&nbsp;style=&quot;box-sizing:&nbsp;border-box;&nbsp;color:&nbsp;rgb(0,&nbsp;134,&nbsp;179);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&quot;&gt;read16&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Consolas,&nbsp;'Liberation&nbsp;Mono',&nbsp;Menlo,&nbsp;Courier,&nbsp;monospace;&nbsp;white-space:&nbsp;pre;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;(p)&nbsp;==&nbsp;(guint32)(op-&gt;when&nbsp;-&nbsp;loc));&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;What&nbsp;is&nbsp;interesting,&nbsp;is&nbsp;that&nbsp;the&nbsp;g_assert&nbsp;is&nbsp;using&nbsp;the&nbsp;read16&nbsp;macro,&nbsp;which&nbsp;deals&nbsp;with&nbsp;alignment&nbsp;issues&nbsp;and&nbsp;also&nbsp;endianness.&nbsp;But&nbsp;with&nbsp;this,&nbsp;I&nbsp;can’t&nbsp;really&nbsp;see&nbsp;how&nbsp;the&nbsp;code&nbsp;would&nbsp;work&nbsp;successfully&nbsp;with&nbsp;big&nbsp;endianness&nbsp;either.&nbsp;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;The&nbsp;code&nbsp;in&nbsp;question&nbsp;hasn’t&nbsp;changed&nbsp;between&nbsp;4.0&nbsp;and&nbsp;4.4&nbsp;but&nbsp;the&nbsp;pointer&nbsp;casting&nbsp;is&nbsp;only&nbsp;executed&nbsp;when&nbsp;“op-&gt;when&nbsp;-&nbsp;loc&nbsp;&gt;&nbsp;256”&nbsp;is&nbsp;true.&nbsp;So&nbsp;I&nbsp;wonder&nbsp;why&nbsp;this&nbsp;changed&nbsp;for&nbsp;me&nbsp;between&nbsp;4.0&nbsp;and&nbsp;4.4&nbsp;and&nbsp;if&nbsp;I’m&nbsp;even&nbsp;supposed&nbsp;to&nbsp;run&nbsp;into&nbsp;these&nbsp;cases&nbsp;on&nbsp;an&nbsp;ARM&nbsp;architecture?&nbsp;When&nbsp;I&nbsp;fix&nbsp;the&nbsp;two&nbsp;problems,&nbsp;everything&nbsp;seems&nbsp;to&nbsp;run&nbsp;fine.&lt;/span&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;Because&nbsp;I&nbsp;don’t&nbsp;think&nbsp;that&nbsp;I’m&nbsp;the&nbsp;first&nbsp;to&nbsp;try&nbsp;to&nbsp;execute&nbsp;“mcs”&nbsp;or&nbsp;run&nbsp;a&nbsp;Mono&nbsp;application&nbsp;on&nbsp;an&nbsp;ARM&nbsp;architecture,&nbsp;I&nbsp;kind&nbsp;of&nbsp;blame&nbsp;my&nbsp;build&nbsp;system.&nbsp;I&nbsp;use&nbsp;buildroot&nbsp;and&nbsp;run&nbsp;my&nbsp;system&nbsp;on&nbsp;an&nbsp;ARM&nbsp;926&nbsp;device.&nbsp;Unfortunately,&nbsp;I&nbsp;have&nbsp;no&nbsp;idea&nbsp;what&nbsp;the&nbsp;code&nbsp;in&nbsp;&lt;/span&gt;mono_unwind_ops_encode_full&nbsp;actually&nbsp;does&nbsp;and&nbsp;when&nbsp;op-&gt;when&nbsp;-&nbsp;loc&nbsp;would&nbsp;actually&nbsp;be&nbsp;greater&nbsp;than&nbsp;256.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;hope&nbsp;that&nbsp;someone&nbsp;here&nbsp;could&nbsp;give&nbsp;me&nbsp;some&nbsp;pointers&nbsp;on&nbsp;why&nbsp;the&nbsp;if&nbsp;condition&nbsp;could&nbsp;be&nbsp;true&nbsp;and&nbsp;never&nbsp;was&nbsp;before&nbsp;or&nbsp;in&nbsp;fact&nbsp;is&nbsp;not&nbsp;true&nbsp;for&nbsp;any&nbsp;ARM&nbsp;device,&nbsp;so&nbsp;I&nbsp;can&nbsp;check&nbsp;my&nbsp;build&nbsp;system.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Thanks,&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Henry&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
