diff --git a/data/mono-trace.d b/data/mono-trace.d
new file mode 100644
index 0000000..8aa795c
--- /dev/null
+++ b/data/mono-trace.d
@@ -0,0 +1,4 @@
+provider mono {
+	probe test ();
+};
+
diff --git a/mono/mini/Makefile.am b/mono/mini/Makefile.am
index a560ec0..914b99e 100644
--- a/mono/mini/Makefile.am
+++ b/mono/mini/Makefile.am
@@ -80,10 +80,18 @@ endif
 mono_SOURCES = \
 	main.c
 
+if TRUE
+MONO_DTRACE_OBJECT = 
+LIBMONO_DTRACE_OBJECT = 
+else
+MONO_DTRACE_OBJECT = mono-dtrace.$(OBJEXT)
+LIBMONO_DTRACE_OBJECT = .libs/mono-dtrace.$(OBJEXT)
+endif
+
 if STATIC_MONO
 # Link libmono into mono statically
 # This leads to higher performance, especially with TLS
-MONO_LIB=libmono-static.la
+MONO_LIB=libmono-static.la $(MONO_DTRACE_OBJECT)
 else 
 MONO_LIB=libmono.la
 endif
@@ -96,6 +104,35 @@ mono_LDADD = \
 mono_LDFLAGS = \
 	$(static_flags) -export-dynamic $(monobinldflags)
 
+if FALSE
+
+DTRACE=/usr/bin/dtrace
+# FIXME
+if X86
+	DTFLAGS=-32
+endif
+if SPARC
+	DTFLAGS=-32
+endif
+if AMD64
+	DTFLAGS=-64
+endif
+if SPARC64
+	DTFLAGS=-64
+endif
+
+mono-dtrace.$(OBJEXT): $(top_srcdir)/data/mono-trace.d libmono-static.la
+#	mkdir -p .dtrace
+#	ar x ...
+	$(DTRACE) $(DTFLAGS) -G -s $(top_srcdir)/data/mono-trace.d mini.$(OBJEXT) -o $@
+	ar r .libs/libmono-static.a mini.$(OBJEXT) mono-dtrace.$(OBJEXT)
+#	rm -rf .dtrace
+
+.libs/mono-dtrace.$(OBJEXT): $(top_srcdir)/data/mono-trace.d mini.lo
+	$(DTRACE) $(DTFLAGS) -G -s $(top_srcdir)/data/mono-trace.d .libs/mini.$(OBJEXT) -o $@
+
+endif
+
 # Create monow.exe, linked for the 'windows' subsystem
 if PLATFORM_WIN32
 monow_LDADD = $(mono_LDADD)
@@ -359,7 +396,7 @@ libmonoincludedir = $(includedir)/mono-$(API_VER)/mono/jit
 libmonoinclude_HEADERS = jit.h
 
 libmono_la_LIBADD = \
-	$(libs)
+	$(libs) $(LIBMONO_DTRACE_OBJECT)
 
 generics.exe: generics.cs TestDriver.dll generics-variant-types.dll
 	$(MCS) -out:$@ $< -r:TestDriver.dll -r:generics-variant-types.dll
diff --git a/mono/mini/mini.c b/mono/mini/mini.c
index 556d3e5..56f3daf 100644
--- a/mono/mini/mini.c
+++ b/mono/mini/mini.c
@@ -64,6 +64,8 @@
 #include <mono/utils/mono-counters.h>
 #include <mono/utils/mono-logger.h>
 #include <mono/utils/mono-mmap.h>
+#define _DTRACE_VERSION 1
+#include <mono/utils/mono-dtrace.h>
 
 #include "mini.h"
 #include <string.h>
@@ -13781,6 +13783,9 @@ mini_init (const char *filename, const char *runtime_version)
 	mono_generic_sharing_init ();
 
 	mono_thread_attach (domain);
+	
+	MONO_TEST ();
+	
 	return domain;
 }
 
diff --git a/mono/utils/Makefile.am b/mono/utils/Makefile.am
index ef6adbe..8fbd43d 100644
--- a/mono/utils/Makefile.am
+++ b/mono/utils/Makefile.am
@@ -2,6 +2,11 @@ noinst_LTLIBRARIES = libmonoutils.la
 
 INCLUDES = -I$(top_srcdir) -I$(top_srcdir)/mono $(LIBGC_CFLAGS) $(GLIB_CFLAGS)
 
+BUILT_SOURCES = mono-dtrace.h
+
+mono-dtrace.h: $(top_srcdir)/data/mono-trace.d
+	/usr/sbin/dtrace -h -s $(top_srcdir)/data/mono-trace.d -o $@
+
 if EGLIB_BUILD 
 hash_sources = mono-ehash.c
 else
