<tt>
Dudemullet,&lt;br&gt;&lt;br&gt;You&nbsp;basically&nbsp;have&nbsp;2&nbsp;choices,&nbsp;the&nbsp;managed&nbsp;and&nbsp;the&nbsp;unmanaged&nbsp;way.&lt;br&gt;&lt;br&gt;If&nbsp;you&nbsp;want&nbsp;to&nbsp;keep&nbsp;everything&nbsp;safe,&nbsp;you&nbsp;can&nbsp;replace&nbsp;all&nbsp;the&nbsp;pointers&nbsp;inside&nbsp;the&nbsp;struct&nbsp;with&nbsp;IntPtrs&nbsp;so&nbsp;you&nbsp;would&nbsp;have:&lt;br&gt;public&nbsp;class&nbsp;Itdb_iTunesDB&nbsp;{&lt;br&gt;<br>
<br>
<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;IntPtr&nbsp;tracks;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;IntPtr&nbsp;playlists;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;string&nbsp;filename;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;IntPtr&amp;nbsp;&nbsp;device;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;uint&nbsp;version;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ulong&nbsp;id;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ulong&nbsp;usertype;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;IntPtr&nbsp;userdata;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Delegate&amp;lt;&amp;gt;&nbsp;userdata_duplicate;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Delegate&amp;lt;&amp;gt;&nbsp;userdata_destroy;&lt;br&gt;<br>
}&lt;br&gt;&lt;br&gt;[DllImport(&amp;quot;libgpod.dll&amp;quot;)]&lt;br&gt;static&nbsp;extern&nbsp;IntPtr&nbsp;itdb_parse(string&nbsp;mp,&nbsp;IntPtr&nbsp;ge);&lt;br&gt;<br>
&lt;br&gt;<br>
IntPtr&nbsp;pDatabase&nbsp;=&nbsp;itdb_parse(&amp;quot;G:&amp;quot;,&nbsp;IntPtr.Zero);&lt;br&gt;itdb&nbsp;database&nbsp;=&nbsp;(Itdb)Marshal.PtrToStructure(pDatabase);&lt;br&gt;&lt;br&gt;And&nbsp;then&nbsp;for&nbsp;the&nbsp;inner&nbsp;pointers,&nbsp;use&nbsp;the&nbsp;same&nbsp;Marshal.PtrToStructure(),&nbsp;but&nbsp;as&nbsp;you&nbsp;can&nbsp;imagine&nbsp;this&nbsp;gets&nbsp;pretty&nbsp;clunky.&amp;nbsp;&nbsp;The&nbsp;other&nbsp;option&nbsp;is&nbsp;to&nbsp;use&nbsp;completly&nbsp;unmanaged&nbsp;definitions&nbsp;for&nbsp;your&nbsp;structs&nbsp;(eg.&nbsp;no&nbsp;strings).&amp;nbsp;&nbsp;This&nbsp;allows&nbsp;you&nbsp;to&nbsp;marshal&nbsp;them&nbsp;directly&nbsp;as&nbsp;pointers.&lt;br&gt;<br>
&lt;br&gt;eg.&nbsp;Define&nbsp;your&nbsp;managed&nbsp;struct&nbsp;as&nbsp;such:&lt;br&gt;struct&nbsp;Itdb_iTunesDB&nbsp;{&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;GList*&nbsp;tracks;&nbsp;//&nbsp;Define&nbsp;GList&nbsp;somewhere&nbsp;or&nbsp;just&nbsp;cast&nbsp;it&nbsp;to&nbsp;Track*,&nbsp;I&nbsp;don&amp;#39;t&nbsp;know&nbsp;how&nbsp;it&nbsp;is&nbsp;defined.&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;GList*&nbsp;playlists;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sbyte*&nbsp;pfilename;&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;string&nbsp;filename&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;get&nbsp;{return&nbsp;new&nbsp;string(pfilename);&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Itdb_Device*&nbsp;device;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;uint&nbsp;version;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ulong&nbsp;id;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ulong&nbsp;usertype;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;void*&nbsp;userdata;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;void*&nbsp;puserdata_duplicate;&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;ItdbUserDataDuplicateFunc&nbsp;userdata_duplicate&nbsp;{&nbsp;//&nbsp;Define&nbsp;delegates&nbsp;somewhere&nbsp;else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;get&nbsp;{&nbsp;return&nbsp;Marshal.DelegateForFunctionPtr(puserdata_duplicate);&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;void*&nbsp;puserdata_destroy;&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;ItdbUserDataDestroyFunc&nbsp;userdata_duplicate&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;get&nbsp;{&nbsp;return&nbsp;Marshal.DelegateForFunctionPtr(puserdata_destroy);&nbsp;}&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
}&nbsp;&lt;br&gt;&lt;br&gt;<br>
Obviously&nbsp;defining&nbsp;your&nbsp;structs&nbsp;this&nbsp;way&nbsp;involves&nbsp;a&nbsp;bit&nbsp;of&nbsp;work&nbsp;but&nbsp;in&nbsp;the&nbsp;end&nbsp;they&nbsp;become&nbsp;much&nbsp;easier&nbsp;to&nbsp;use&nbsp;as&nbsp;long&nbsp;as&nbsp;you&nbsp;are&nbsp;comfortable&nbsp;with&nbsp;using&nbsp;unmanaged&nbsp;code.&amp;nbsp;&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;see&nbsp;an&nbsp;example&nbsp;of&nbsp;how&nbsp;this&nbsp;is&nbsp;put&nbsp;together,&nbsp;check&nbsp;out&nbsp;my&nbsp;bindings&nbsp;for&nbsp;ffmpeg,&nbsp;ffmpeg-sharp&nbsp;(&lt;a&nbsp;href=&quot;http://code.google.com/p/ffmpeg-sharp&quot;&gt;http://code.google.com/p/ffmpeg-sharp&lt;/a&gt;).&lt;br&gt;<br>
&lt;br&gt;Thanks,&lt;br&gt;Justin&nbsp;Cherniak&lt;br&gt;&lt;br&gt;P.S.&nbsp;Did&nbsp;you&nbsp;know&nbsp;there&nbsp;is&nbsp;a&nbsp;managed&nbsp;ipod&nbsp;library,&nbsp;ipod-sharp&nbsp;(&lt;a&nbsp;href=&quot;http://download.banshee-project.org/ipod-sharp/&quot;&gt;http://download.banshee-project.org/ipod-sharp/&lt;/a&gt;)&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Thu,&nbsp;Dec&nbsp;11,&nbsp;2008&nbsp;at&nbsp;10:33&nbsp;PM,&nbsp;Dudemullet&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:elpaip@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;elpaip@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&lt;br&gt;<br>
hello,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;a&nbsp;struct&nbsp;that&nbsp;looks&nbsp;like&nbsp;this&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;++&nbsp;Unmanaged&nbsp;struct&nbsp;++&lt;br&gt;<br>
&lt;br&gt;<br>
typedef&nbsp;struct&nbsp;{&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;GList&nbsp;*tracks;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;GList&nbsp;*playlists;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;gchar&nbsp;*filename;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Itdb_Device&nbsp;*device;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;guint32&nbsp;version;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;guint64&nbsp;id;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;guint64&nbsp;usertype;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;gpointer&nbsp;userdata;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;ItdbUserDataDuplicateFunc&nbsp;userdata_duplicate;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;ItdbUserDataDestroyFunc&nbsp;userdata_destroy;&lt;br&gt;<br>
}&nbsp;Itdb_iTunesDB;&lt;br&gt;<br>
&lt;br&gt;<br>
++++++++++++++++++++&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
and&nbsp;I&nbsp;have&nbsp;a&nbsp;function&nbsp;inside&nbsp;a&nbsp;dll&nbsp;that&nbsp;is&nbsp;gonna&nbsp;populate&nbsp;it&nbsp;and&nbsp;Ive&nbsp;tried&lt;br&gt;<br>
various&nbsp;ways&nbsp;to&nbsp;declare&nbsp;&amp;nbsp;the&nbsp;return&nbsp;type&nbsp;either&nbsp;by&nbsp;IntPtr&nbsp;and&nbsp;later&nbsp;using&lt;br&gt;<br>
Marshal.PtrtoStructure&nbsp;but&nbsp;when&nbsp;I&nbsp;try&nbsp;and&nbsp;use&nbsp;this&nbsp;function&nbsp;I&nbsp;get&nbsp;the&nbsp;error&lt;br&gt;<br>
&amp;quot;The&nbsp;structure&nbsp;must&nbsp;not&nbsp;be&nbsp;a&nbsp;value&nbsp;class&amp;quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
this&nbsp;is&nbsp;how&nbsp;I&nbsp;tried&nbsp;to&nbsp;implement&nbsp;my&nbsp;function&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;++&nbsp;function&nbsp;++&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;[DllImport(&amp;quot;libgpod.dll&amp;quot;)]&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;static&nbsp;extern&nbsp;itdb&nbsp;itdb_parse(string&nbsp;mp,&nbsp;IntPtr&nbsp;ge);&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;itdb&nbsp;database&nbsp;=&nbsp;itdb_parse(&amp;quot;G:&amp;quot;,&nbsp;IntPtr.Zero);&lt;br&gt;<br>
&lt;br&gt;<br>
++++++++++++++++++++++++++++++++&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;the&nbsp;source&nbsp;I&nbsp;can&nbsp;see&nbsp;that&nbsp;&amp;quot;itdb_parse&amp;quot;&nbsp;returns&nbsp;a&nbsp;Itdb_iTunesDB&nbsp;pointer&nbsp;so&lt;br&gt;<br>
maybe&nbsp;I&nbsp;could&nbsp;use&nbsp;classes&nbsp;but&nbsp;what&nbsp;about&nbsp;the&nbsp;Itdb_Device&nbsp;struct&nbsp;that&nbsp;inside&lt;br&gt;<br>
this&nbsp;struct&nbsp;?&nbsp;Also&nbsp;if&nbsp;I&nbsp;need&nbsp;to&nbsp;implement&nbsp;the&nbsp;class,&nbsp;what&nbsp;should&nbsp;I&nbsp;do&nbsp;&amp;nbsp;Any&lt;br&gt;<br>
suggestions&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://www.nabble.com/Marshalling-a-struct-inside-a-struct-tp20969792p20969792.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.nabble.com/Marshalling-a-struct-inside-a-struct-tp20969792p20969792.html&lt;/a&gt;&lt;br&gt;<br>
<br>
<br>
Sent&nbsp;from&nbsp;the&nbsp;Mono&nbsp;-&nbsp;Dev&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
