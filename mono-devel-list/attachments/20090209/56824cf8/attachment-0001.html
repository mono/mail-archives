<tt>
Hey,&lt;br&gt;&lt;br&gt;The&nbsp;attached&nbsp;patch&nbsp;adds&nbsp;a&nbsp;new&nbsp;hook&nbsp;to&nbsp;allow&nbsp;threads&nbsp;to&nbsp;shutdown&nbsp;after&nbsp;the&nbsp;GC&nbsp;finalizer&nbsp;has&nbsp;finished.&lt;br&gt;The&nbsp;motivation&nbsp;for&nbsp;it&nbsp;is&nbsp;to&nbsp;improve&nbsp;profiler&amp;#39;s&nbsp;reliability&nbsp;at&nbsp;shutdown&nbsp;time.&lt;br&gt;&lt;br&gt;The&nbsp;new&nbsp;callback&nbsp;notifies&nbsp;the&nbsp;thread&nbsp;when&nbsp;regular&nbsp;shutdown&nbsp;starts&nbsp;and&nbsp;gives&nbsp;it&nbsp;a&nbsp;change&nbsp;to&nbsp;not&lt;br&gt;<br>
finish&nbsp;at&nbsp;this&nbsp;time.&lt;br&gt;&lt;br&gt;Later&nbsp;on&nbsp;the&nbsp;same&nbsp;callback&nbsp;is&nbsp;used&nbsp;to&nbsp;notify&nbsp;the&nbsp;thread&nbsp;that&nbsp;the&nbsp;last&nbsp;stage&nbsp;in&nbsp;the&nbsp;shutdown&nbsp;sequence&lt;br&gt;has&nbsp;been&nbsp;reached&nbsp;and&nbsp;it&nbsp;must&nbsp;shutdown.&lt;br&gt;&lt;br&gt;The&nbsp;callback&nbsp;is&nbsp;per-thread&nbsp;as&nbsp;I&nbsp;don&amp;#39;t&nbsp;want&nbsp;to&nbsp;have&nbsp;tools&nbsp;like&nbsp;the&nbsp;profiler&nbsp;messing&nbsp;up&nbsp;with&nbsp;embedded&nbsp;users.&lt;br&gt;<br>
&lt;br&gt;Please&nbsp;review.&lt;br&gt;&lt;br&gt;&lt;br&gt;Cheers,&lt;br&gt;Rodrigo&lt;br&gt;&lt;br&gt;<br>

</tt>
