<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;&lt;div&gt;Hello,&lt;/div&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
<br>
&lt;div&gt;Could&nbsp;you&nbsp;post&nbsp;the&nbsp;patch&nbsp;for&nbsp;review&nbsp;and&nbsp;license&nbsp;it&nbsp;under&nbsp;the&nbsp;MIT&nbsp;X11&nbsp;license?&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;Miguel&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ve&nbsp;reproduced&nbsp;the&nbsp;patch&nbsp;below.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;following&nbsp;patch&nbsp;is&nbsp;released&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;MIT/X11&nbsp;license,&nbsp;per&nbsp;Miguel&amp;#39;s&nbsp;request.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Brian&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;commit&nbsp;fb96f5d6387cc5c019fc00bfc89a25204fa14166&lt;/div&gt;&lt;div&gt;Author:&nbsp;Brian&nbsp;Luczkiewicz&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:brian@sooloos.com&quot;&gt;brian@sooloos.com&lt;/a&gt;&amp;gt;&lt;/div&gt;<br>
&lt;div&gt;<br>
Date:&nbsp; &nbsp;Sat&nbsp;Oct&nbsp;30&nbsp;21:52:09&nbsp;2010&nbsp;-0400&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; Enable&nbsp;--aot&nbsp;(but&nbsp;not&nbsp;--aot=full)&nbsp;on&nbsp;osx/x86&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;diff&nbsp;--git&nbsp;a/mono/mini/aot-compiler.c&nbsp;b/mono/mini/aot-compiler.c&lt;/div&gt;&lt;div&gt;index&nbsp;5088324..70ff8c0&nbsp;100644&lt;/div&gt;<br>
<br>
&lt;div&gt;---&nbsp;a/mono/mini/aot-compiler.c&lt;/div&gt;&lt;div&gt;+++&nbsp;b/mono/mini/aot-compiler.c&lt;/div&gt;&lt;div&gt;@@&nbsp;-82,6&nbsp;+82,8&nbsp;@@&lt;/div&gt;&lt;div&gt; #define&nbsp;SHARED_EXT&nbsp;&amp;quot;.dll&amp;quot;&lt;/div&gt;&lt;div&gt; #elif&nbsp;defined(__ppc__)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(__MACH__)&lt;/div&gt;<br>
&lt;div&gt;<br>
 #define&nbsp;SHARED_EXT&nbsp;&amp;quot;.dylib&amp;quot;&lt;/div&gt;&lt;div&gt;+#elif&nbsp;defined(__APPLE__)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(__native_client_codegen__)&lt;/div&gt;&lt;div&gt;+#define&nbsp;SHARED_EXT&nbsp;&amp;quot;.dylib&amp;quot;&lt;/div&gt;&lt;div&gt; #else&lt;/div&gt;<br>
<br>
&lt;div&gt; #define&nbsp;SHARED_EXT&nbsp;&amp;quot;.so&amp;quot;&lt;/div&gt;&lt;div&gt; #endif&lt;/div&gt;&lt;div&gt;@@&nbsp;-6055,6&nbsp;+6057,8&nbsp;@@&nbsp;compile_asm&nbsp;(MonoAotCompile&nbsp;*acfg)&lt;/div&gt;&lt;div&gt; #define&nbsp;LD_OPTIONS&nbsp;&amp;quot;-m&nbsp;elf64ppc&amp;quot;&lt;/div&gt;&lt;div&gt; #elif&nbsp;defined(sparc)&nbsp;&amp;amp;&amp;amp;&nbsp;SIZEOF_VOID_P&nbsp;==&nbsp;8&lt;/div&gt;<br>
<br>
&lt;div&gt; #define&nbsp;AS_OPTIONS&nbsp;&amp;quot;-xarch=v9&amp;quot;&lt;/div&gt;&lt;div&gt;+#elif&nbsp;defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(__APPLE__)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(__native_client_codegen__)&lt;/div&gt;&lt;div&gt;+#define&nbsp;AS_OPTIONS&nbsp;&amp;quot;-arch&nbsp;i386&nbsp;-W&amp;quot;&lt;/div&gt;<br>
<br>
&lt;div&gt; #else&lt;/div&gt;&lt;div&gt; #define&nbsp;AS_OPTIONS&nbsp;&amp;quot;&amp;quot;&lt;/div&gt;&lt;div&gt; #endif&lt;/div&gt;&lt;div&gt;@@&nbsp;-6120,6&nbsp;+6124,8&nbsp;@@&nbsp;compile_asm&nbsp;(MonoAotCompile&nbsp;*acfg)&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;command&nbsp;=&nbsp;g_strdup_printf&nbsp;(&amp;quot;gcc&nbsp;-dynamiclib&nbsp;-o&nbsp;%s&nbsp;%s.o&amp;quot;,&nbsp;tmp_outfile_name,&nbsp;acfg-&amp;gt;tmpfname);&lt;/div&gt;<br>
<br>
&lt;div&gt; #elif&nbsp;defined(HOST_WIN32)&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;command&nbsp;=&nbsp;g_strdup_printf&nbsp;(&amp;quot;gcc&nbsp;-shared&nbsp;--dll&nbsp;-mno-cygwin&nbsp;-o&nbsp;%s&nbsp;%s.o&amp;quot;,&nbsp;tmp_outfile_name,&nbsp;acfg-&amp;gt;tmpfname);&lt;/div&gt;<br>
<br>
&lt;div&gt;+#elif&nbsp;defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(__APPLE__)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(__native_client_codegen__)&lt;/div&gt;&lt;div&gt;+&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;command&nbsp;=&nbsp;g_strdup_printf&nbsp;(&amp;quot;gcc&nbsp;-m32&nbsp;-dynamiclib&nbsp;-o&nbsp;%s&nbsp;%s.o&amp;quot;,&nbsp;tmp_outfile_name,&nbsp;acfg-&amp;gt;tmpfname);&lt;/div&gt;<br>
<br>
&lt;div&gt; #else&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;command&nbsp;=&nbsp;g_strdup_printf&nbsp;(&amp;quot;%sld&nbsp;%s&nbsp;%s&nbsp;-shared&nbsp;-o&nbsp;%s&nbsp;%s.o&amp;quot;,&nbsp;tool_prefix,&nbsp;EH_LD_OPTIONS,&nbsp;LD_OPTIONS,&nbsp;tmp_outfile_name,&nbsp;acfg-&amp;gt;tmpfname);&lt;/div&gt;<br>
<br>
&lt;div&gt; #endif&lt;/div&gt;&lt;div&gt;diff&nbsp;--git&nbsp;a/mono/mini/aot-runtime.c&nbsp;b/mono/mini/aot-runtime.c&lt;/div&gt;&lt;div&gt;index&nbsp;4bae87b..d27d44c&nbsp;100644&lt;/div&gt;&lt;div&gt;---&nbsp;a/mono/mini/aot-runtime.c&lt;/div&gt;&lt;div&gt;+++&nbsp;b/mono/mini/aot-runtime.c&lt;/div&gt;&lt;div&gt;@@&nbsp;-65,6&nbsp;+65,8&nbsp;@@&lt;/div&gt;<br>
<br>
&lt;div&gt; #define&nbsp;SHARED_EXT&nbsp;&amp;quot;.dll&amp;quot;&lt;/div&gt;&lt;div&gt; #elif&nbsp;((defined(__ppc__)&nbsp;||&nbsp;defined(__powerpc__)&nbsp;||&nbsp;defined(__ppc64__))&nbsp;||&nbsp;defined(__MACH__))&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(__linux__)&lt;/div&gt;&lt;div&gt; #define&nbsp;SHARED_EXT&nbsp;&amp;quot;.dylib&amp;quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;+#elif&nbsp;defined(__APPLE__)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(__native_client_codegen__)&lt;/div&gt;&lt;div&gt;+#define&nbsp;SHARED_EXT&nbsp;&amp;quot;.dylib&amp;quot;&lt;/div&gt;&lt;div&gt; #else&lt;/div&gt;&lt;div&gt; #define&nbsp;SHARED_EXT&nbsp;&amp;quot;.so&amp;quot;&lt;/div&gt;<br>
<br>
&lt;div&gt; #endif&lt;/div&gt;&lt;div&gt;diff&nbsp;--git&nbsp;a/mono/mini/image-writer.c&nbsp;b/mono/mini/image-writer.c&lt;/div&gt;&lt;div&gt;index&nbsp;ff7e3d8..4a3cf02&nbsp;100644&lt;/div&gt;&lt;div&gt;---&nbsp;a/mono/mini/image-writer.c&lt;/div&gt;&lt;div&gt;+++&nbsp;b/mono/mini/image-writer.c&lt;/div&gt;&lt;div&gt;<br>
@@&nbsp;-113,7&nbsp;+113,7&nbsp;@@&lt;/div&gt;<br>
&lt;div&gt; #define&nbsp;USE_ELF_RELA&nbsp;1&lt;/div&gt;&lt;div&gt; #endif&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;-#if&nbsp;defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(TARGET_WIN32)&lt;/div&gt;&lt;div&gt;+#if&nbsp;defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(TARGET_WIN32)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(__APPLE__)&lt;/div&gt;<br>
<br>
&lt;div&gt; #define&nbsp;USE_ELF_WRITER&nbsp;1&lt;/div&gt;&lt;div&gt; #endif&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;@@&nbsp;-1576,7&nbsp;+1576,7&nbsp;@@&nbsp;static&nbsp;void&lt;/div&gt;&lt;div&gt; asm_writer_emit_global&nbsp;(MonoImageWriter&nbsp;*acfg,&nbsp;const&nbsp;char&nbsp;*name,&nbsp;gboolean&nbsp;func)&lt;/div&gt;&lt;div&gt; {&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;asm_writer_emit_unset_mode&nbsp;(acfg);&lt;/div&gt;<br>
<br>
&lt;div&gt;-#if&nbsp; (defined(__ppc__)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(TARGET_ASM_APPLE))&nbsp;||&nbsp;(defined(HOST_WIN32)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(MONO_CROSS_COMPILE))&lt;/div&gt;&lt;div&gt;+#if&nbsp; ((defined(__ppc__)&nbsp;||&nbsp;defined(TARGET_X86))&nbsp;&amp;amp;&amp;amp;&nbsp;defined(TARGET_ASM_APPLE))&nbsp;||&nbsp;(defined(HOST_WIN32)&nbsp;&amp;amp;&amp;amp;&nbsp;!defined(MONO_CROSS_COMPILE))&lt;/div&gt;<br>
<br>
&lt;div&gt;  &nbsp; &nbsp;//&nbsp;mach-o&nbsp;always&nbsp;uses&nbsp;a&nbsp;&amp;#39;_&amp;#39;&nbsp;prefix.&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;fprintf&nbsp;(acfg-&amp;gt;fp,&nbsp;&amp;quot;\t.globl&nbsp;_%s\n&amp;quot;,&nbsp;name);&lt;/div&gt;&lt;div&gt; #else&lt;/div&gt;&lt;div&gt;@@&nbsp;-1612,7&nbsp;+1612,13&nbsp;@@&nbsp;static&nbsp;void&lt;/div&gt;<br>
<br>
&lt;div&gt; asm_writer_emit_label&nbsp;(MonoImageWriter&nbsp;*acfg,&nbsp;const&nbsp;char&nbsp;*name)&lt;/div&gt;&lt;div&gt; {&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;asm_writer_emit_unset_mode&nbsp;(acfg);&lt;/div&gt;&lt;div&gt;-#if&nbsp;defined(HOST_WIN32)&nbsp;&amp;amp;&amp;amp;&nbsp;(defined(TARGET_X86)&nbsp;||&nbsp;defined(TARGET_AMD64))&lt;/div&gt;<br>
<br>
&lt;div&gt;+#if&nbsp;(defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(TARGET_ASM_APPLE))&lt;/div&gt;&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; name&nbsp;=&nbsp;get_label(name);&lt;/div&gt;&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; fprintf&nbsp;(acfg-&amp;gt;fp,&nbsp;&amp;quot;%s:\n&amp;quot;,&nbsp;name);&lt;/div&gt;&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;(name[0]&nbsp;!=&nbsp;&amp;#39;L&amp;#39;)&lt;/div&gt;<br>
<br>
&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fprintf&nbsp;(acfg-&amp;gt;fp,&nbsp;&amp;quot;_%s:\n&amp;quot;,&nbsp;name);&lt;/div&gt;&lt;div&gt;+&lt;/div&gt;&lt;div&gt;+#elif&nbsp;(defined(HOST_WIN32)&nbsp;&amp;amp;&amp;amp;&nbsp;(defined(TARGET_X86)&nbsp;||&nbsp;defined(TARGET_AMD64)))&nbsp;||&nbsp;(defined(TARGET_X86)&nbsp;&amp;amp;&amp;amp;&nbsp;defined(TARGET_ASM_APPLE))&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;fprintf&nbsp;(acfg-&amp;gt;fp,&nbsp;&amp;quot;_%s:\n&amp;quot;,&nbsp;name);&lt;/div&gt;&lt;div&gt; #if&nbsp;defined(HOST_WIN32)&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;/*&nbsp;Emit&nbsp;a&nbsp;normal&nbsp;label&nbsp;too&nbsp;*/&lt;/div&gt;<br>
<br>
&lt;div&gt;diff&nbsp;--git&nbsp;a/mono/mini/mini-x86.h&nbsp;b/mono/mini/mini-x86.h&lt;/div&gt;&lt;div&gt;index&nbsp;260e557..385a930&nbsp;100644&lt;/div&gt;&lt;div&gt;---&nbsp;a/mono/mini/mini-x86.h&lt;/div&gt;&lt;div&gt;+++&nbsp;b/mono/mini/mini-x86.h&lt;/div&gt;&lt;div&gt;@@&nbsp;-285,7&nbsp;+285,9&nbsp;@@&nbsp;typedef&nbsp;struct&nbsp;{&lt;/div&gt;<br>
<br>
&lt;div&gt; #define&nbsp;MONO_ARCH_MONITOR_OBJECT_REG&nbsp;X86_EAX&lt;/div&gt;&lt;div&gt; #endif&lt;/div&gt;&lt;div&gt; #define&nbsp;MONO_ARCH_HAVE_STATIC_RGCTX_TRAMPOLINE&nbsp;1&lt;/div&gt;&lt;div&gt;+#if&nbsp;!defined&nbsp;(__APPLE__)&nbsp;||&nbsp;defined(__native_client_codegen__)&lt;/div&gt;&lt;div&gt; #define&nbsp;MONO_ARCH_HAVE_FULL_AOT_TRAMPOLINES&nbsp;1&lt;/div&gt;<br>
<br>
&lt;div&gt;+#endif&lt;/div&gt;&lt;div&gt; #define&nbsp;MONO_ARCH_GOT_REG&nbsp;X86_EBX&lt;/div&gt;&lt;div&gt; #define&nbsp;MONO_ARCH_HAVE_GET_TRAMPOLINES&nbsp;1&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;@@&nbsp;-297,9&nbsp;+299,7&nbsp;@@&nbsp;typedef&nbsp;struct&nbsp;{&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt; #define&nbsp;MONO_ARCH_HAVE_DECOMPOSE_LONG_OPTS&nbsp;1&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;/div&gt;&lt;div&gt;-#if&nbsp;!defined(__APPLE__)&nbsp;||&nbsp;defined(__native_client_codegen__)&lt;/div&gt;&lt;div&gt; #define&nbsp;MONO_ARCH_AOT_SUPPORTED&nbsp;1&lt;/div&gt;&lt;div&gt;-#endif&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt; #if&nbsp;defined(__linux__)&nbsp;||&nbsp;defined(__sun)&lt;/div&gt;&lt;div&gt; #define&nbsp;MONO_ARCH_ENABLE_MONITOR_IL_FASTPATH&nbsp;1&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
