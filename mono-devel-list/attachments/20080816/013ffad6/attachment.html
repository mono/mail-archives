<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Scott,&lt;br&gt;&lt;br&gt;I&nbsp;guess&nbsp;that&nbsp;the&nbsp;objective&nbsp;of&nbsp;your&nbsp;patch&nbsp;is&nbsp;to&nbsp;optimize&nbsp;things,&nbsp;isn&amp;#39;t?&nbsp;So,&nbsp;why&nbsp;did&nbsp;you&nbsp;discard&nbsp;my&nbsp;idea?&nbsp;I&nbsp;have&nbsp;made&nbsp;a&nbsp;simple&nbsp;benchmark:&lt;br&gt;&lt;br&gt;On&nbsp;my&nbsp;x86&nbsp;Linux&nbsp;system&nbsp;using&nbsp;1.9.1,&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;results:&lt;br&gt;<br>
&lt;br&gt;Benchmark&nbsp;1&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for(int&nbsp;i&nbsp;=&nbsp;0&nbsp;;&nbsp;i&nbsp;&amp;lt;&nbsp;2000000000&nbsp;;&nbsp;i&nbsp;+=&nbsp;10)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MostSignificantBit&nbsp;(i);&lt;br&gt;Loop:&nbsp;8.097s&lt;br&gt;Optimized:&nbsp;1.780s&lt;br&gt;&lt;br&gt;Thus&nbsp;my&nbsp;code&nbsp;is&nbsp;over&nbsp;4.5&nbsp;times&nbsp;faster&nbsp;in&nbsp;average.&lt;br&gt;&lt;br&gt;Benchmark&nbsp;2&lt;br&gt;<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for(int&nbsp;i&nbsp;=&nbsp;0&nbsp;;&nbsp;i&nbsp;&amp;lt;&nbsp;2000000000&nbsp;;&nbsp;i&nbsp;+=&nbsp;10)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MostSignificantBit&nbsp;(i%64);&lt;br&gt;&lt;br&gt;Loop:&nbsp;6.088s&lt;br&gt;Optimized:&nbsp;3.856s&lt;br&gt;&lt;br&gt;Still&nbsp;over&nbsp;1.5&nbsp;times&nbsp;faster.&lt;br&gt;&lt;br&gt;Now&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;technical&nbsp;problem&nbsp;preventing&nbsp;the&nbsp;inclusion&nbsp;of&nbsp;the&nbsp;faster&nbsp;method,&nbsp;you&nbsp;are&nbsp;welcome&nbsp;to&nbsp;discuss&nbsp;it&nbsp;in&nbsp;this&nbsp;thread.&lt;br&gt;<br>
&lt;br&gt;Laurent.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2008/8/16&nbsp;Scott&nbsp;Peterson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:lunchtimemama@gmail.com&quot;&gt;lunchtimemama@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;OK,&nbsp;this&nbsp;patch&nbsp;just&nbsp;spruces&nbsp;up&nbsp;the&nbsp;HighestSetBit&nbsp;method&nbsp;and&nbsp;fixes&nbsp;the&nbsp;bug.&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&lt;br&gt;Index:&nbsp;class/System/System.Collections.Specialized/ChangeLog&lt;br&gt;===================================================================&lt;br&gt;<br>
<br>
---&nbsp;class/System/System.Collections.Specialized/ChangeLog&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;109665)&lt;br&gt;+++&nbsp;class/System/System.Collections.Specialized/ChangeLog&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)&lt;br&gt;&lt;/div&gt;@@&nbsp;-1,3&nbsp;+1,10&nbsp;@@&lt;br&gt;+2008-08-06&amp;nbsp;&nbsp;Scott&nbsp;Peterson&amp;nbsp;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:lunchtimemama@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;lunchtimemama@gmail.com&lt;/a&gt;&amp;gt;&lt;br&gt;<br>
<br>
+&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;*&nbsp;BitVector32.cs:&nbsp;Fixed&nbsp;a&nbsp;bug&nbsp;which&nbsp;allowed&nbsp;for&nbsp;invalid&nbsp;sections&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;to&nbsp;be&nbsp;created&nbsp;with&nbsp;CreateSection.&nbsp;Also&nbsp;simlpified&nbsp;HighestSetBit&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;algorithm&nbsp;and&nbsp;got&nbsp;rid&nbsp;ofNumberOfSetBits&nbsp;(using&nbsp;HighestSetBit&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;works&nbsp;just&nbsp;fine).&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;<br>
&lt;br&gt;<br>
+&lt;br&gt;&amp;nbsp;2008-07-31&amp;nbsp;&nbsp;Jb&nbsp;Evain&amp;nbsp;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jbevain@novell.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jbevain@novell.com&lt;/a&gt;&amp;gt;&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;*&nbsp;StringDictionary.cs:&nbsp;remove&nbsp;ComponentModel&nbsp;bits&nbsp;for&nbsp;NET_2_1.&lt;br&gt;Index:&nbsp;class/System/System.Collections.Specialized/BitVector32.cs&lt;br&gt;<br>
<br>
===================================================================&lt;br&gt;---&nbsp;class/System/System.Collections.Specialized/BitVector32.cs&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;109665)&lt;br&gt;+++&nbsp;class/System/System.Collections.Specialized/BitVector32.cs&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)&lt;br&gt;<br>
&lt;/div&gt;<br>
@@&nbsp;-184,11&nbsp;+184,11&nbsp;@@&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(maxValue&nbsp;&amp;lt;&nbsp;1)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;throw&nbsp;new&nbsp;ArgumentException&nbsp;(&amp;quot;maxValue&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;bit&nbsp;=&nbsp;HighestSetBit(maxValue)&nbsp;+&nbsp;1;&lt;br&gt;<br>
&lt;/div&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;bit&nbsp;=&nbsp;HighestSetBit(maxValue);&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;mask&nbsp;=&nbsp;(1&nbsp;&amp;lt;&amp;lt;&nbsp;bit)&nbsp;-&nbsp;1;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;offset&nbsp;=&nbsp;previous.Offset&nbsp;+&nbsp;NumberOfSetBits&nbsp;(previous.Mask);&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;offset&nbsp;=&nbsp;previous.Offset&nbsp;+&nbsp;HighestSetBit&nbsp;(previous.Mask);&lt;br&gt;<br>
&amp;nbsp;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(offset&nbsp;&amp;gt;&nbsp;32)&nbsp;{&lt;br&gt;&lt;/div&gt;<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(offset&nbsp;+&nbsp;bit&nbsp;&amp;gt;&nbsp;32)&nbsp;{&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;throw&nbsp;new&nbsp;ArgumentException&nbsp;(&amp;quot;Sections&nbsp;cannot&nbsp;exceed&nbsp;32&nbsp;bits&nbsp;in&nbsp;total&amp;quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&lt;br&gt;&lt;/div&gt;@@&nbsp;-227,27&nbsp;+227,12&nbsp;@@&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;Private&nbsp;utilities&lt;br&gt;<br>
-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;static&nbsp;int&nbsp;NumberOfSetBits&nbsp;(int&nbsp;i)&nbsp;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;static&nbsp;int&nbsp;HighestSetBit&nbsp;(int&nbsp;i)&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;count&nbsp;=&nbsp;0;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(int&nbsp;bit&nbsp;=&nbsp;0;&nbsp;bit&nbsp;&amp;lt;&nbsp;32;&nbsp;bit++)&nbsp;{&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;mask&nbsp;=&nbsp;1&nbsp;&amp;lt;&amp;lt;&nbsp;bit;&lt;br&gt;<br>
<br>
-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;((i&nbsp;&amp;amp;&nbsp;mask)&nbsp;!=&nbsp;0)&nbsp;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;count++;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while(i&nbsp;&amp;gt;&amp;gt;&nbsp;count&nbsp;!=&nbsp;0)&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;count++;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;count;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;-&lt;br&gt;<br>
-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;static&nbsp;int&nbsp;HighestSetBit&nbsp;(int&nbsp;i)&nbsp;&lt;br&gt;<br>
-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(int&nbsp;bit&nbsp;=&nbsp;31;&nbsp;bit&nbsp;&amp;gt;=&nbsp;0;&nbsp;bit--)&nbsp;{&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;mask&nbsp;=&nbsp;1&nbsp;&amp;lt;&amp;lt;&nbsp;bit;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;((mask&nbsp;&amp;amp;&nbsp;i)&nbsp;!=&nbsp;0)&nbsp;{&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;bit;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
<br>
-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;-&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;-1;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;}&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
