Index: mono/metadata/class.c
===================================================================
--- mono/metadata/class.c	(revision 37481)
+++ mono/metadata/class.c	(working copy)
@@ -858,9 +858,9 @@
 	if (g_hash_table_lookup_extended (iid_hash, str, NULL, &value)) {
 		mono_loader_unlock ();
 		g_free (str);
-		return (guint)value;
+		return GPOINTER_TO_UINT (value);
 	} else {
-		g_hash_table_insert (iid_hash, str, (gpointer)iid);
+		g_hash_table_insert (iid_hash, str, GUINT_TO_POINTER (iid));
 		++iid;
 	}
 
Index: mono/metadata/security.c
===================================================================
--- mono/metadata/security.c	(revision 37481)
+++ mono/metadata/security.c	(working copy)
@@ -10,7 +10,7 @@
 #ifdef HAVE_CONFIG_H
 #include <config.h>
 #endif
-
+#include <glib.h>
 #include <mono/metadata/appdomain.h>
 #include <mono/metadata/image.h>
 #include <mono/metadata/exception.h>
@@ -277,7 +277,7 @@
 		OpenProcessToken (GetCurrentProcess (), TOKEN_QUERY, &token);
 	}
 #else
-	token = (gpointer) geteuid ();
+	token = GUINT_TO_POINTER (geteuid ());
 #endif
 	return token;
 }
@@ -302,7 +302,7 @@
 		g_free (tu);
 	}
 #else 
-	gchar *uname = GetTokenName ((uid_t) token);
+	gchar *uname = GetTokenName ((uid_t) GPOINTER_TO_UINT (token));
 
 	MONO_ARCH_SAVE_REGS;
 
@@ -374,7 +374,7 @@
 #endif
 
 	if (result) {
-		token = (gpointer) p->pw_uid;
+		token = GUINT_TO_POINTER (p->pw_uid);
 	}
 
 #ifdef HAVE_GETPWNAM_R
@@ -520,7 +520,7 @@
 	fbufsize = (size_t) 1024;
 #endif
 	fbuf = g_malloc0 (fbufsize);
-	retval = getgrgid_r ((gid_t) group, &grp, fbuf, fbufsize, &g);
+	retval = getgrgid_r ((gid_t) GPOINTER_TO_UINT (group), &grp, fbuf, fbufsize, &g);
 	result = ((retval == 0) && (g == &grp));
 #else
 	/* default to non thread-safe but posix compliant function */
@@ -529,7 +529,7 @@
 #endif
 
 	if (result) {
-		result = IsMemberOf ((uid_t) user, g);
+		result = IsMemberOf ((uid_t) GPOINTER_TO_UINT (user), g);
 	}
 
 #ifdef HAVE_GETGRGID_R
@@ -581,7 +581,7 @@
 #endif
 
 		if (result) {
-			result = IsMemberOf ((uid_t) user, g);
+			result = IsMemberOf ((uid_t) GPOINTER_TO_UINT (user), g);
 		}
 
 #ifdef HAVE_GETGRNAM_R
Index: mono/metadata/process.c
===================================================================
--- mono/metadata/process.c	(revision 37481)
+++ mono/metadata/process.c	(working copy)
@@ -814,7 +814,7 @@
 		shell_args = "-c %s";
 #endif
 		if (spath != NULL) {
-			gint dummy;
+			gsize dummy;
 			gchar *quoted;
 
 			shell_path = mono_unicode_from_external (spath, &dummy);
Index: mono/metadata/ChangeLog
===================================================================
--- mono/metadata/ChangeLog	(revision 37481)
+++ mono/metadata/ChangeLog	(working copy)
@@ -1,3 +1,15 @@
+2004-12-??    <Author>
+	* class.c, security.c, process.c, mono-debug.c, mono-debug-debugger.c,
+	  profiler.c, marshal.c, rand.c:
+
+	  Fix compiler warnings on AMD64 by using G[U]INT_TO_POINTER, GPOINTER_TO_[U]INT
+	  macros for casts and MONO_FMT_64, MONO_FMT_PTR (defined in intps.h) in printf
+	  statements.
+
+	* mono-debug-debugger.h, mono-debug-debugger.c:
+	  Change of mono_debugger_event_handler to use guint64 as argument datatype. (Fix
+	  for 64 bit platforms.)
+
 2004-12-09  Martin Baulig  <martin@ximian.com>
 
 	* metadata.h, loader.h: Use `idx' instead of `index' in parameter
Index: mono/metadata/mono-debug.c
===================================================================
--- mono/metadata/mono-debug.c	(revision 37481)
+++ mono/metadata/mono-debug.c	(working copy)
@@ -339,7 +339,7 @@
 /**
  * mono_debug_source_location_from_address:
  * @method:
- * @address:
+ * @address: offset in the native code from the start of the method
  * @line_number:
  * @domain:
  *
@@ -423,7 +423,7 @@
 /**
  * mono_debug_il_offset_from_address:
  * @method:
- * @address:
+ * @address: offset
  * @domain:
  *
  * Returns: the IL offset corresponding to machine address @address which is an offset
Index: mono/metadata/mono-debug.h
===================================================================
Index: mono/metadata/mono-debug-debugger.c
===================================================================
--- mono/metadata/mono-debug-debugger.c	(revision 37481)
+++ mono/metadata/mono-debug-debugger.c	(working copy)
@@ -1,4 +1,6 @@
 #include <config.h>
+#include <glib.h>
+#include <intps.h>
 #include <stdlib.h>
 #include <string.h>
 #include <mono/metadata/assembly.h>
@@ -1113,7 +1115,7 @@
 		WRITE_UINT32 (ptr, write_class (table, klass->interfaces [i]));
 
 	if (ptr - old_ptr != data_size) {
-		g_warning (G_STRLOC ": %d,%d,%d", ptr - old_ptr, data_size, sizeof (gpointer));
+		g_warning (G_STRLOC ": %"MONO_FMT_PTR"d,%d,%"MONO_FMT_PTR"d", ptr - old_ptr, data_size, sizeof (gpointer));
 		if (klass)
 			g_warning (G_STRLOC ": %s.%s", klass->name_space, klass->name);
 		g_assert_not_reached ();
@@ -1417,8 +1419,7 @@
 
 	// Prevent the object from being finalized.
 	last_exception = exc;
-	mono_debugger_event (MONO_DEBUGGER_EVENT_UNHANDLED_EXCEPTION,
-			     GPOINTER_TO_UINT (exc), GPOINTER_TO_UINT (addr));
+	mono_debugger_event (MONO_DEBUGGER_EVENT_UNHANDLED_EXCEPTION, (guint64) exc, (guint64) addr);
 	return TRUE;
 }
 
@@ -1437,8 +1438,7 @@
 	info.exception_obj = exc;
 	info.stop = 0;
 
-	mono_debugger_event (MONO_DEBUGGER_EVENT_EXCEPTION, GPOINTER_TO_UINT (&info),
-			     GPOINTER_TO_UINT (addr));
+	mono_debugger_event (MONO_DEBUGGER_EVENT_EXCEPTION, (guint64) &info, (guint64) addr);
 }
 
 gboolean
@@ -1456,8 +1456,7 @@
 	info.exception_obj = exc;
 	info.stop = 0;
 
-	mono_debugger_event (MONO_DEBUGGER_EVENT_THROW_EXCEPTION, GPOINTER_TO_UINT (&info),
-			     GPOINTER_TO_UINT (addr));
+	mono_debugger_event (MONO_DEBUGGER_EVENT_THROW_EXCEPTION, (guint64) &info, (guint64) addr);
 	return info.stop != 0;
 }
 
Index: mono/metadata/profiler.c
===================================================================
--- mono/metadata/profiler.c	(revision 37481)
+++ mono/metadata/profiler.c	(working copy)
@@ -6,6 +6,7 @@
 #include "mono/io-layer/io-layer.h"
 #include <string.h>
 #include <gmodule.h>
+#include <intps.h>
 
 static MonoProfiler * current_profiler = NULL;
 
@@ -683,7 +684,7 @@
 		m = method_get_name (p->method);
 		printf ("########################\n");
 		printf ("% 8.3f ", (double) (p->total * 1000));
-		printf ("%7llu ", p->count);
+		printf ("%7"MONO_FMT_64"u ", p->count);
 		printf ("% 8.3f ", (double) (p->total * 1000)/(double)p->count);
 		printf ("  %s\n", m);
 
@@ -691,7 +692,7 @@
 		/* callers */
 		output_callers (p);
 	}
-	printf ("Total number of calls: %lld\n", total_calls);
+	printf ("Total number of calls: %"MONO_FMT_64"d\n", total_calls);
 }
 
 typedef struct {
Index: mono/metadata/marshal.c
===================================================================
--- mono/metadata/marshal.c	(revision 37481)
+++ mono/metadata/marshal.c	(working copy)
@@ -9,6 +9,7 @@
  */
 
 #include "config.h"
+#include "glib.h"
 #include "object.h"
 #include "loader.h"
 #include "metadata/marshal.h"
@@ -2964,6 +2965,7 @@
 		return mono_marshal_get_remoting_invoke (method);
 }
 
+/*
 static gpointer
 mono_marshal_load_remoting_wrapper (MonoRealProxy *rp, MonoMethod *method)
 {
@@ -2972,6 +2974,7 @@
 	else
 		return mono_compile_method (mono_marshal_get_remoting_invoke (method));
 }
+*/
 
 MonoMethod *
 mono_marshal_get_remoting_invoke_with_check (MonoMethod *method)
@@ -6680,7 +6683,7 @@
 #ifdef WIN32
 	TlsSetValue (last_error_tls_id, (gpointer)GetLastError ());
 #else
-	TlsSetValue (last_error_tls_id, (gpointer)errno);
+	TlsSetValue (last_error_tls_id, GINT_TO_POINTER (errno));
 #endif
 }
 
@@ -6921,7 +6924,7 @@
 {
 	MONO_ARCH_SAVE_REGS;
 
-	return ((guint32)TlsGetValue (last_error_tls_id));
+	return (GPOINTER_TO_UINT (TlsGetValue (last_error_tls_id)));
 }
 
 guint32 
Index: mono/metadata/rand.c
===================================================================
--- mono/metadata/rand.c	(revision 37481)
+++ mono/metadata/rand.c	(working copy)
@@ -198,13 +198,13 @@
 	}
 
 	/* if required exception will be thrown in managed code */
-	return ((file < 0) ? NULL : (gpointer) file);
+	return ((file < 0) ? NULL : GINT_TO_POINTER (file));
 }
 
 gpointer 
 ves_icall_System_Security_Cryptography_RNGCryptoServiceProvider_RngGetBytes (gpointer handle, MonoArray *arry)
 {
-	gint file = (gint) handle;
+	gint file = GPOINTER_TO_INT (handle);
 	guint32 len = mono_array_length (arry);
 	guchar *buf = mono_array_addr (arry, guchar, 0);
 
@@ -242,7 +242,7 @@
 ves_icall_System_Security_Cryptography_RNGCryptoServiceProvider_RngClose (gpointer handle) 
 {
 	if (!egd)
-		close ((gint) handle);
+		close (GPOINTER_TO_INT (handle));
 }
 
 #endif /* OS definition */
Index: mono/io-layer/security.c
===================================================================
--- mono/io-layer/security.c	(revision 37481)
+++ mono/io-layer/security.c	(working copy)
@@ -8,6 +8,7 @@
  */
 
 #include <config.h>
+#include <glib.h>
 #include <mono/io-layer/io-layer.h>
 
 #include <pwd.h>
@@ -31,7 +32,7 @@
 gboolean 
 ImpersonateLoggedOnUser (gpointer handle)
 {
-	uid_t token = (uid_t) handle;
+	uid_t token = (uid_t) GPOINTER_TO_UINT (handle);
 #ifdef HAVE_SETRESUID
 	if (setresuid (-1, token, getuid ()) < 0)
 		return FALSE;
Index: mono/io-layer/ChangeLog
===================================================================
--- mono/io-layer/ChangeLog	(revision 37481)
+++ mono/io-layer/ChangeLog	(working copy)
@@ -1,3 +1,13 @@
+2004-12-??    <Author>
+	* security.c, shared.c:
+	  Fix compiler warnings on AMD64 by using G[U]INT_TO_POINTER, GPOINTER_TO_[U]INT
+	  macros for casts and MONO_FMT_64, MONO_FMT_PTR (defined in intps.h) in printf
+	  statements.
+
+	* io.c: Fix general compiler warning by commenting out unused function.
+
+	* misc.c: Added string.h for memcpy
+
 2004-12-01 Neale Ferguson <Neale.Ferguson@SoftwareAG-usa.com>
 
 	* atomic.h : Fix InterlockedCompareExchange for s390/s390x.
Index: mono/io-layer/io.c
===================================================================
--- mono/io-layer/io.c	(revision 37481)
+++ mono/io-layer/io.c	(working copy)
@@ -1627,6 +1627,7 @@
 	return(fileaccess);
 }
 
+/* See CreateFile why this is not used anymore..
 static mode_t convert_perms(guint32 sharemode)
 {
 	mode_t perms=0600;
@@ -1640,7 +1641,7 @@
 
 	return(perms);
 }
-
+*/
 
 /**
  * CreateFile:
Index: mono/io-layer/shared.c
===================================================================
--- mono/io-layer/shared.c	(revision 37481)
+++ mono/io-layer/shared.c	(working copy)
@@ -44,6 +44,7 @@
 
 
 #include <config.h>
+#include <intps.h>
 #include <glib.h>
 #include <stdio.h>
 #include <fcntl.h>
@@ -276,7 +277,7 @@
 		if(created && *created==TRUE) {
 #ifdef HAVE_LARGE_FILE_SUPPORT
 			/* Keep gcc quiet... */
-			g_critical (G_GNUC_PRETTY_FUNCTION ": shared file [%s] is not big enough! (found %lld, need %d bytes)", filename, statbuf.st_size, wanted_size);
+			g_critical (G_GNUC_PRETTY_FUNCTION ": shared file [%s] is not big enough! (found %"MONO_FMT_64"d, need %d bytes)", filename, statbuf.st_size, wanted_size);
 #else
 			g_critical (G_GNUC_PRETTY_FUNCTION ": shared file [%s] is not big enough! (found %ld, need %d bytes)", filename, statbuf.st_size, wanted_size);
 #endif
Index: mono/io-layer/misc.c
===================================================================
--- mono/io-layer/misc.c	(revision 37481)
+++ mono/io-layer/misc.c	(working copy)
@@ -11,6 +11,7 @@
 #include <glib.h>
 #include <sys/time.h>
 #include <stdlib.h>
+#include <string.h> /*memcpy*/
 
 #include "misc-private.h"
 
Index: mono/monoburg/ChangeLog
===================================================================
--- mono/monoburg/ChangeLog	(revision 37481)
+++ mono/monoburg/ChangeLog	(working copy)
@@ -1,3 +1,6 @@
+2004-12-??    <Author>
+	* monoburg.c: Fix AMD64 compiler warning by using GINT_TO_POINTER for pointer cast
+
 2004-06-24  David Waite  <mass@akuma.org>
 
 	* monoburg.c: change to C90-style comments from C99/C++-style
Index: mono/monoburg/monoburg.c
===================================================================
--- mono/monoburg/monoburg.c	(revision 37481)
+++ mono/monoburg/monoburg.c	(working copy)
@@ -7,6 +7,7 @@
  * (C) 2001 Ximian, Inc.
  */
 
+#include <glib.h>
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
@@ -161,7 +162,7 @@
 	if (!term_hash) 
 		term_hash = g_hash_table_new (g_str_hash , g_str_equal);
 
-	g_hash_table_foreach (term_hash, (GHFunc) check_term_num, (gpointer) num);
+	g_hash_table_foreach (term_hash, (GHFunc) check_term_num, GINT_TO_POINTER (num));
 
 	term = g_new0 (Term, 1);
 
Index: mono/mini/trace.c
===================================================================
--- mono/mini/trace.c	(revision 37481)
+++ mono/mini/trace.c	(working copy)
@@ -9,6 +9,7 @@
  */
 
 #include <config.h>
+#include <glib.h>
 #include <signal.h>
 #include <unistd.h>
 #include <string.h>
@@ -285,7 +286,7 @@
 		printf (") ip: %p\n", __builtin_return_address (1));
 		return;
 	}	
-	if (((int)ebp & (MONO_ARCH_FRAME_ALIGNMENT - 1)) != 0) {
+	if (((uintptr_t) ebp & (MONO_ARCH_FRAME_ALIGNMENT - 1)) != 0) {
 		g_error ("unaligned stack detected (%p)", ebp);
 	}
 
@@ -333,7 +334,7 @@
 			
 		case MONO_TYPE_I:
 		case MONO_TYPE_U:
-			printf ("%p, ", (gpointer)*((int *)(cpos)));
+			printf ("%p, ", GINT_TO_POINTER (*((int *)(cpos))));
 			break;
 		case MONO_TYPE_BOOLEAN:
 		case MONO_TYPE_CHAR:
@@ -383,7 +384,7 @@
 			break;
 		case MONO_TYPE_I8:
 		case MONO_TYPE_U8:
-			printf ("0x%016llx, ", *((gint64 *)(cpos)));
+			printf ("0x%016"MONO_FMT_64"x, ", *((gint64 *)(cpos)));
 			break;
 		case MONO_TYPE_R4:
 			printf ("%f, ", *((float *)(cpos)));
@@ -470,7 +471,7 @@
 			} else if  (o->vtable->klass == mono_defaults.int32_class) {
 				printf ("[INT32:%p:%d]", o, *((gint32 *)((char *)o + sizeof (MonoObject))));	
 			} else if  (o->vtable->klass == mono_defaults.int64_class) {
-				printf ("[INT64:%p:%lld]", o, *((gint64 *)((char *)o + sizeof (MonoObject))));	
+				printf ("[INT64:%p:%"MONO_FMT_64"d]", o, *((gint64 *)((char *)o + sizeof (MonoObject))));
 			} else
 				printf ("[%s.%s:%p]", o->vtable->klass->name_space, o->vtable->klass->name, o);
 		} else
@@ -488,12 +489,12 @@
 	}
 	case MONO_TYPE_I8: {
 		gint64 l =  va_arg (ap, gint64);
-		printf ("lresult=0x%16llx", l);
+		printf ("lresult=0x%16"MONO_FMT_64"x", l);
 		break;
 	}
 	case MONO_TYPE_U8: {
 		gint64 l =  va_arg (ap, gint64);
-		printf ("lresult=0x%16llx", l);
+		printf ("lresult=0x%16"MONO_FMT_64"x", l);
 		break;
 	}
 	case MONO_TYPE_R4:
Index: mono/mini/abcremoval.c
===================================================================
--- mono/mini/abcremoval.c	(revision 37481)
+++ mono/mini/abcremoval.c	(working copy)
@@ -94,7 +94,7 @@
 		printf ("CONSTANT %d", value->value.constant.value);
 		break;
 	case MONO_VARIABLE_SUMMARIZED_VALUE:
-		printf ("VARIABLE %d, delta %d", value->value.variable.variable, value->value.variable.delta);
+		printf ("VARIABLE %"MONO_FMT_PTR"d, delta %d", value->value.variable.variable, value->value.variable.delta);
 		break;
 	case MONO_PHI_SUMMARIZED_VALUE: {
 		int phi;
@@ -900,7 +900,7 @@
 				
 				if ((index_value.value.constant.value >= 0) && (index_value.value.constant.value < array_context->ranges.zero.lower)) {
 					if (REPORT_ABC_REMOVAL) {
-						printf ("ARRAY-ACCESS: removed bounds check on array %d with constant index %d in method %s\n",
+						printf ("ARRAY-ACCESS: removed bounds check on array %"MONO_FMT_PTR"d with constant index %d in method %s\n",
 								array_variable, index_value.value.constant.value, mono_method_full_name (area->cfg->method, TRUE));
 					}
 					inst->flags |= (MONO_INST_NORANGECHECK);
@@ -921,11 +921,11 @@
 				
 				if (index_context->ranges.zero.lower >= 0) {
 					if (TRACE_ABC_REMOVAL) {
-						printf ("ARRAY-ACCESS: Removed lower bound check on array %d with index %d\n", array_variable, index_variable);
+						printf ("ARRAY-ACCESS: Removed lower bound check on array %"MONO_FMT_PTR"d with index %"MONO_FMT_PTR"d\n", array_variable, index_variable);
 					}
 					if ((index_context->ranges.variable.upper < 0)||(index_context->ranges.zero.upper < array_context->ranges.zero.lower)) {
 						if (REPORT_ABC_REMOVAL) {
-							printf ("ARRAY-ACCESS: removed bounds check on array %d with index %d in method %s\n",
+							printf ("ARRAY-ACCESS: removed bounds check on array %"MONO_FMT_PTR"d with index %"MONO_FMT_PTR"d in method %s\n",
 									array_variable, index_variable, mono_method_full_name (area->cfg->method, TRUE));
 						}
 						inst->flags |= (MONO_INST_NORANGECHECK);
@@ -933,10 +933,10 @@
 				}
 				if (TRACE_ABC_REMOVAL) {
 					if (index_context->ranges.variable.upper < 0) {
-						printf ("ARRAY-ACCESS: Removed upper bound check (through variable) on array %d with index %d\n", array_variable, index_variable);
+						printf ("ARRAY-ACCESS: Removed upper bound check (through variable) on array %"MONO_FMT_PTR"d with index %"MONO_FMT_PTR"d\n", array_variable, index_variable);
 					}
 					if (index_context->ranges.zero.upper < array_context->ranges.zero.lower) {
-						printf ("ARRAY-ACCESS: Removed upper bound check (through constant) on array %d with index %d\n", array_variable, index_variable);
+						printf ("ARRAY-ACCESS: Removed upper bound check (through constant) on array %"MONO_FMT_PTR"d with index %"MONO_FMT_PTR"d\n", array_variable, index_variable);
 					}
 				}
 			}
@@ -999,12 +999,12 @@
 	get_relations_from_previous_bb (bb, &additional_relations);
 	if (TRACE_ABC_REMOVAL) {
 		if (additional_relations.relation1.relation.relation != MONO_ANY_RELATION) {
-			printf ("Adding relation 1 on variable %d: ", additional_relations.relation1.variable);
+			printf ("Adding relation 1 on variable %"MONO_FMT_PTR"d: ", additional_relations.relation1.variable);
 			print_summarized_value_relation (&(additional_relations.relation1.relation));
 			printf ("\n");
 		}
 		if (additional_relations.relation2.relation.relation != MONO_ANY_RELATION) {
-			printf ("Adding relation 2 on variable %d: ", additional_relations.relation2.variable);
+			printf ("Adding relation 2 on variable %"MONO_FMT_PTR"d: ", additional_relations.relation2.variable);
 			print_summarized_value_relation (&(additional_relations.relation2.relation));
 			printf ("\n");
 		}
Index: mono/mini/inssel.brg
===================================================================
--- mono/mini/inssel.brg	(revision 37481)
+++ mono/mini/inssel.brg	(working copy)
@@ -74,7 +74,7 @@
                 inst->opcode = op; \
                 inst->dreg = dr; \
                 inst->sreg1 = sr; \
-                inst->inst_p1 = (gpointer)imm; \
+                inst->inst_p1 = GUINT_TO_POINTER (imm); \
 	        mono_bblock_add_inst (cfg->cbb, inst); \
 	} while (0)
 
Index: mono/mini/mini.c
===================================================================
--- mono/mini/mini.c	(revision 37481)
+++ mono/mini/mini.c	(working copy)
@@ -165,9 +165,9 @@
 		return;
 	}
 	method = mono_method_full_name (ji->method, TRUE);
-	source = mono_debug_source_location_from_address (ji->method, (int) ip, NULL, domain);
+	source = mono_debug_source_location_from_address (ji->method, GPOINTER_TO_UINT (ip), NULL, domain);
 
-	g_print ("IP %p at offset 0x%x of method %s (%p %p)[domain %p - %s]\n", ip, (char*)ip - (char*)ji->code_start, method, ji->code_start, (char*)ji->code_start + ji->code_size, domain, domain->friendly_name);
+	g_print ("IP %p at offset 0x%"MONO_FMT_PTR"x of method %s (%p %p)[domain %p - %s]\n", ip, (char*)ip - (char*)ji->code_start, method, ji->code_start, (char*)ji->code_start + ji->code_size, domain, domain->friendly_name);
 
 	if (source)
 		g_print ("%s\n", source);
@@ -251,7 +251,7 @@
 #define CHECK_BBLOCK(target,ip,tblock) do {	\
 		if ((target) < (ip) && !(tblock)->code)	{	\
 			bb_recheck = g_list_prepend (bb_recheck, (tblock));	\
-			if (cfg->verbose_level > 2) g_print ("queued block %d for check at IL%04x from IL%04x\n", (tblock)->block_num, (target) - header->code, (ip) - header->code);	\
+			if (cfg->verbose_level > 2) g_print ("queued block %d for check at IL%04"MONO_FMT_PTR"x from IL%04"MONO_FMT_PTR"x\n", (tblock)->block_num, (target) - header->code, (ip) - header->code);	\
 		}	\
 	} while (0)
 
@@ -1704,7 +1704,7 @@
 			mono_add_ins_to_end (bb, inst);
 		}
 		if (cfg->verbose_level > 3)
-			g_print ("storing %d to temp %d\n", i, locals [i]->inst_c0);
+			g_print ("storing %d to temp %"MONO_FMT_PTR"d\n", i, locals [i]->inst_c0);
 	}
 
 	/*
@@ -2163,7 +2163,7 @@
 	if (!sighash) {
 		sighash = g_hash_table_new (NULL, NULL);
 	}
-	else if ((res = g_hash_table_lookup (sighash, (gpointer)arity))) {
+	else if ((res = g_hash_table_lookup (sighash, GINT_TO_POINTER (arity)))) {
 		LeaveCriticalSection (&jit_mutex);
 		return res;
 	}
@@ -2182,7 +2182,7 @@
 
 	res->ret = &mono_defaults.int_class->byval_arg;
 
-	g_hash_table_insert (sighash, (gpointer)arity, res);
+	g_hash_table_insert (sighash, GINT_TO_POINTER (arity), res);
 	LeaveCriticalSection (&jit_mutex);
 
 	return res;
@@ -2199,7 +2199,7 @@
 	if (!sighash) {
 		sighash = g_hash_table_new (NULL, NULL);
 	}
-	else if ((res = g_hash_table_lookup (sighash, (gpointer)arity))) {
+	else if ((res = g_hash_table_lookup (sighash, GINT_TO_POINTER (arity)))) {
 		LeaveCriticalSection (&jit_mutex);
 		return res;
 	}
@@ -2218,7 +2218,7 @@
 
 	res->ret = &mono_defaults.int_class->byval_arg;
 
-	g_hash_table_insert (sighash, (gpointer)arity, res);
+	g_hash_table_insert (sighash, GINT_TO_POINTER (arity), res);
 	LeaveCriticalSection (&jit_mutex);
 
 	return res;
@@ -3033,7 +3033,7 @@
 			start_new_bblock = 0;
 			for (i = 0; i < bblock->in_scount; ++i) {
 				if (cfg->verbose_level > 3)
-					g_print ("loading %d from temp %d\n", i, bblock->in_stack [i]->inst_c0);						
+					g_print ("loading %d from temp %"MONO_FMT_PTR"d\n", i, bblock->in_stack [i]->inst_c0);
 				NEW_TEMPLOAD (cfg, ins, bblock->in_stack [i]->inst_c0);
 				*sp++ = ins;
 			}
@@ -3048,7 +3048,7 @@
 				bblock = tblock;
 				for (i = 0; i < bblock->in_scount; ++i) {
 					if (cfg->verbose_level > 3)
-						g_print ("loading %d from temp %d\n", i, bblock->in_stack [i]->inst_c0);						
+						g_print ("loading %d from temp %"MONO_FMT_PTR"d\n", i, bblock->in_stack [i]->inst_c0);
 					NEW_TEMPLOAD (cfg, ins, bblock->in_stack [i]->inst_c0);
 					*sp++ = ins;
 				}
@@ -3078,7 +3078,7 @@
 		}
 
 		if (cfg->verbose_level > 3)
-			g_print ("converting (in B%d: stack: %d) %s", bblock->block_num, sp-stack_start, mono_disasm_code_one (NULL, method, ip, NULL));
+			g_print ("converting (in B%d: stack: %"MONO_FMT_PTR"d) %s", bblock->block_num, sp-stack_start, mono_disasm_code_one (NULL, method, ip, NULL));
 
 		switch (*ip) {
 		case CEE_NOP:
@@ -4125,7 +4125,7 @@
 					MonoInst *iargs [3];
 
 					if (mono_compile_aot) {
-						cfg->ldstr_list = g_list_prepend (cfg->ldstr_list, (gpointer)n);
+						cfg->ldstr_list = g_list_prepend (cfg->ldstr_list, GINT_TO_POINTER (n));
 					}
 
 					NEW_TEMPLOAD (cfg, iargs [0], mono_get_domainvar (cfg)->inst_c0);
@@ -5955,7 +5955,7 @@
  unverified:
 	if (cfg->method != method) 
 		g_hash_table_destroy (bbhash);
-	g_error ("Invalid IL code at IL%04x in %s: %s\n", ip - header->code, 
+	g_error ("Invalid IL code at IL%04x in %s: %s\n", (int) (ip - header->code),
 		 mono_method_full_name (method, TRUE), mono_disasm_code_one (NULL, method, ip, NULL));
 	dont_inline = g_list_remove (dont_inline, method);
 	return -1;
@@ -5974,10 +5974,10 @@
 
 	switch (tree->opcode) {
 	case OP_ICONST:
-		printf ("[%d]", tree->inst_c0);
+		printf ("[%"MONO_FMT_PTR"d]", tree->inst_c0);
 		break;
 	case OP_I8CONST:
-		printf ("[%lld]", tree->inst_l);
+		printf ("[%"MONO_FMT_64"d]", tree->inst_l);
 		break;
 	case OP_R8CONST:
 		printf ("[%f]", *(double*)tree->inst_p0);
@@ -5987,13 +5987,13 @@
 		break;
 	case OP_ARG:
 	case OP_LOCAL:
-		printf ("[%d]", tree->inst_c0);
+		printf ("[%"MONO_FMT_PTR"d]", tree->inst_c0);
 		break;
 	case OP_REGOFFSET:
 		if (tree->inst_offset < 0)
-			printf ("[-0x%x(%s)]", -tree->inst_offset, mono_arch_regname (tree->inst_basereg));
+			printf ("[-0x%"MONO_FMT_PTR"x(%s)]", -tree->inst_offset, mono_arch_regname (tree->inst_basereg));
 		else
-			printf ("[0x%x(%s)]", tree->inst_offset, mono_arch_regname (tree->inst_basereg));
+			printf ("[0x%"MONO_FMT_PTR"x(%s)]", tree->inst_offset, mono_arch_regname (tree->inst_basereg));
 		break;
 	case OP_REGVAR:
 		printf ("[%s]", mono_arch_regname (tree->dreg));
@@ -6019,7 +6019,7 @@
 	}
 	case OP_PHI: {
 		int i;
-		printf ("[%d (", tree->inst_c0);
+		printf ("[%"MONO_FMT_PTR"d (", tree->inst_c0);
 		for (i = 0; i < tree->inst_phi_args [0]; i++) {
 			if (i)
 				printf (", ");
@@ -6041,7 +6041,7 @@
 	case OP_LOADI1_MEMBASE:
 	case OP_LOADU2_MEMBASE:
 	case OP_LOADI2_MEMBASE:
-		printf ("[%s] <- [%s + 0x%x]", mono_arch_regname (tree->dreg), mono_arch_regname (tree->inst_basereg), tree->inst_offset);
+		printf ("[%s] <- [%s + 0x%"MONO_FMT_PTR"x]", mono_arch_regname (tree->dreg), mono_arch_regname (tree->inst_basereg), tree->inst_offset);
 		break;
 	case CEE_BR:
 	case OP_CALL_HANDLER:
@@ -6754,7 +6754,7 @@
 		}
 
 		for (i = 0; i < patch_info->table_size; i++) {
-			jump_table [i] = code + (int)patch_info->data.table [i];
+			jump_table [i] = code + (intptr_t) patch_info->data.table [i];
 		}
 		target = jump_table;
 		break;
@@ -6767,7 +6767,7 @@
 		break;
 	case MONO_PATCH_INFO_IID:
 		mono_class_init (patch_info->data.klass);
-		target = (gpointer)patch_info->data.klass->interface_id;
+		target = GUINT_TO_POINTER (patch_info->data.klass->interface_id);
 		break;
 	case MONO_PATCH_INFO_VTABLE:
 		target = mono_class_vtable (domain, patch_info->data.klass);
@@ -7530,7 +7530,7 @@
 		
 			patch_info->ip.i = patch_info->ip.label->inst_c0;
 			for (i = 0; i < patch_info->table_size; i++) {
-				table [i] = (gpointer)patch_info->data.table [i]->native_offset;
+				table [i] = GINT_TO_POINTER (patch_info->data.table [i]->native_offset);
 			}
 			patch_info->data.target = table;
 			break;
Index: mono/mini/mini.h
===================================================================
--- mono/mini/mini.h	(revision 37481)
+++ mono/mini/mini.h	(working copy)
@@ -2,6 +2,7 @@
 #define __MONO_MINI_H__
 
 #include "config.h"
+#include "intps.h"
 #include <glib.h>
 #include <signal.h>
 #include <mono/metadata/loader.h>
@@ -424,11 +425,7 @@
 	MonoJumpInfoType type;
 	union {
 		gconstpointer   target;
-#if SIZEOF_VOID_P == 8
-		gint64          offset;
-#else
-		int             offset;
-#endif
+		intptr_t	offset;
 		MonoBasicBlock *bb;
 		MonoBasicBlock **table;
 		MonoInst       *inst;
Index: mono/mini/ChangeLog
===================================================================
--- mono/mini/ChangeLog	(revision 37481)
+++ mono/mini/ChangeLog	(working copy)
@@ -1,3 +1,14 @@
+2004-12-??    <Author>
+	* trace.c, abcremoval.c, inssel.brg, mini.c, debug-mini.c, mini-exceptions.c,
+	  linear-scan.c, ssapre.c, graph.c, ssa.c:
+
+	  Fix compiler warnings on AMD64 by using G[U]INT_TO_POINTER, GPOINTER_TO_[U]INT
+	  macros for casts, MONO_FMT_64, MONO_FMT_PTR (defined in intps.h) in printf
+	  statements and fix some bugs by using (uintptr_t) as cast/datatype.
+
+	* mini.h
+	  Instead of ifdef VOIDPTR == 8 use intptr_t
+
 2004-12-08  Zoltan Varga  <vargaz@freemail.hu>
 
 	* mini.c jit-icalls.c: Pass generic_context to mono_ldtoken_wrapper.
Index: mono/mini/debug-mini.c
===================================================================
--- mono/mini/debug-mini.c	(revision 37481)
+++ mono/mini/debug-mini.c	(working copy)
@@ -537,5 +537,5 @@
 	if (mono_debug_format == MONO_DEBUG_FORMAT_NONE)
 		return;
 
-	mono_debug_add_wrapper (method, callinfo->func, mono_get_root_domain ());
+	mono_debug_add_wrapper (method, (gpointer) callinfo->func, mono_get_root_domain ());
 }
Index: mono/mini/mini-exceptions.c
===================================================================
--- mono/mini/mini-exceptions.c	(revision 37481)
+++ mono/mini/mini-exceptions.c	(working copy)
@@ -16,6 +16,7 @@
 #include <mono/metadata/tabledefs.h>
 #include <mono/metadata/threads.h>
 #include <mono/metadata/debug-helpers.h>
+#include <mono/metadata/mono-debug-debugger.h>
 #include <mono/metadata/exception.h>
 #include <mono/metadata/gc-internal.h>
 #include <mono/metadata/mono-debug.h>
@@ -499,8 +500,8 @@
 					/* Switch back to normal stack */
 					if (stack_overflow)
 						/* Free up some stack space */
-						MONO_CONTEXT_SET_SP (&initial_ctx, (guint32)(MONO_CONTEXT_GET_SP (&initial_ctx)) + (64 * 1024));
-					MONO_CONTEXT_SET_IP (&initial_ctx, (unsigned int)jit_tls->abort_func);
+						MONO_CONTEXT_SET_SP (&initial_ctx, (uintptr_t) MONO_CONTEXT_GET_SP (&initial_ctx) + (64 * 1024));
+					MONO_CONTEXT_SET_IP (&initial_ctx, (uintptr_t) jit_tls->abort_func);
 					restore_context (&initial_ctx);
 				}
 				else
Index: mono/mini/linear-scan.c
===================================================================
--- mono/mini/linear-scan.c	(revision 37481)
+++ mono/mini/linear-scan.c	(working copy)
@@ -90,7 +90,7 @@
 	max_regs = g_list_length (regs);
 
 	for (l = regs; l; l = l->next) {
-		int regnum = (int)l->data;
+		int regnum = GPOINTER_TO_INT (l->data);
 		g_assert (regnum < G_N_ELEMENTS (gains));
 		gains [regnum] = 0;
 	}
@@ -115,7 +115,7 @@
 				amv->range.last_use.abs_pos, amv->spill_costs, amv->reg);
 #endif
 			active = g_list_delete_link (active, active);
-			regs = g_list_prepend (regs, (gpointer)amv->reg);
+			regs = g_list_prepend (regs, GINT_TO_POINTER (amv->reg));
 			gains [amv->reg] += amv->spill_costs;
 		}
 		
@@ -154,7 +154,7 @@
 
 			g_assert (regs);
 
-			vmv->reg = (int)regs->data;
+			vmv->reg = GPOINTER_TO_INT (regs->data);
 
 			used_regs |= 1LL << vmv->reg;
 
Index: mono/mini/ssapre.c
===================================================================
--- mono/mini/ssapre.c	(revision 37481)
+++ mono/mini/ssapre.c	(working copy)
@@ -9,6 +9,7 @@
 
 #include <string.h>
 #include <stdio.h>
+#include <intps.h>
 
 #include <mono/metadata/debug-helpers.h>
 #include <mono/metadata/opcodes.h>
@@ -43,16 +44,16 @@
 			printf ("NONE");
 			break;
 		case MONO_SSAPRE_EXPRESSION_ARGUMENT_ORIGINAL_VARIABLE:
-			printf ("ORIGINAL_VARIABLE %d", argument->argument.original_variable);
+			printf ("ORIGINAL_VARIABLE %"MONO_FMT_PTR"d", argument->argument.original_variable);
 			break;
 		case MONO_SSAPRE_EXPRESSION_ARGUMENT_SSA_VARIABLE:
-			printf ("SSA_VARIABLE %d", argument->argument.ssa_variable);
+			printf ("SSA_VARIABLE %"MONO_FMT_PTR"d", argument->argument.ssa_variable);
 			break;
 		case MONO_SSAPRE_EXPRESSION_ARGUMENT_INTEGER_CONSTANT:
-			printf ("INTEGER_CONSTANT %d", argument->argument.integer_constant);
+			printf ("INTEGER_CONSTANT %"MONO_FMT_PTR"d", argument->argument.integer_constant);
 			break;
 		case MONO_SSAPRE_EXPRESSION_ARGUMENT_LONG_COSTANT:
-			printf ("LONG_COSTANT %lld", *(argument->argument.long_constant));
+			printf ("LONG_COSTANT %"MONO_FMT_64"d", *(argument->argument.long_constant));
 			break;
 		case MONO_SSAPRE_EXPRESSION_ARGUMENT_FLOAT_COSTANT:
 			printf ("FLOAT_COSTANT %f", *(argument->argument.float_constant));
@@ -83,7 +84,7 @@
 
 static void
 print_expression_occurrence (MonoSsapreExpressionOccurrence *occurrence, int number) {
-	printf (" ([%d][bb %d [ID %d]][class %d]: ", number, occurrence->bb_info->cfg_dfn, occurrence->bb_info->bb->block_num, occurrence->redundancy_class);
+	printf (" ([%d][bb %d [ID %d]][class %"MONO_FMT_PTR"d]: ", number, occurrence->bb_info->cfg_dfn, occurrence->bb_info->bb->block_num, occurrence->redundancy_class);
 	print_expression_description (&(occurrence->description));
 	if (occurrence->is_first_in_bb) {
 		printf (" [FIRST in BB]");
@@ -112,7 +113,7 @@
 	if (expression != NULL) {
 		print_worklist (expression->previous);
 		
-		printf ("{%d}: ", expression->tree_size);
+		printf ("{%"MONO_FMT_PTR"d}: ", expression->tree_size);
 		print_expression_description (&(expression->description));
 		printf ("\n");
 		print_expression_occurrences (expression->occurrences);
@@ -140,7 +141,7 @@
 	}
 	printf ("\n");
 	if (bb_info->has_phi) {
-		printf (" PHI, class %d [ ", bb_info->phi_redundancy_class);
+		printf (" PHI, class %"MONO_FMT_PTR"d [ ", bb_info->phi_redundancy_class);
 		for (i = 0; i < bb_info->in_count; i++) {
 			int argument_class = bb_info->phi_arguments_classes [i];
 			if (argument_class != BOTTOM_REDUNDANCY_CLASS) {
@@ -164,26 +165,26 @@
 	if (bb_info->has_phi_argument) {
 		printf (" PHI ARGUMENT, class ");
 		if (bb_info->phi_argument_class != BOTTOM_REDUNDANCY_CLASS) {
-			printf ("%d ", bb_info->phi_argument_class);
+			printf ("%"MONO_FMT_PTR"d ", bb_info->phi_argument_class);
 		} else {
 			printf ("BOTTOM ");
 		}
 		if (bb_info->phi_argument_defined_by_real_occurrence != NULL) {
-			printf ("(Defined by real occurrence %d)", bb_info->phi_argument_defined_by_real_occurrence->redundancy_class);
+			printf ("(Defined by real occurrence %"MONO_FMT_PTR"d)", bb_info->phi_argument_defined_by_real_occurrence->redundancy_class);
 		} else if (bb_info->phi_argument_defined_by_phi != NULL) {
-			printf ("(Defined by phi %d)", bb_info->phi_argument_defined_by_phi->phi_redundancy_class);
+			printf ("(Defined by phi %"MONO_FMT_PTR"d)", bb_info->phi_argument_defined_by_phi->phi_redundancy_class);
 		} else {
 			printf ("(Undefined)");
 		}
 		printf (" (real occurrence arguments: left ");
 		if (bb_info->phi_argument_left_argument_version != BOTTOM_REDUNDANCY_CLASS) {
-			printf ("%d ", bb_info->phi_argument_left_argument_version);
+			printf ("%"MONO_FMT_PTR"d ", bb_info->phi_argument_left_argument_version);
 		} else {
 			printf ("NONE ");
 		}
 		printf (", right ");
 		if (bb_info->phi_argument_right_argument_version != BOTTOM_REDUNDANCY_CLASS) {
-			printf ("%d ", bb_info->phi_argument_right_argument_version);
+			printf ("%"MONO_FMT_PTR"d ", bb_info->phi_argument_right_argument_version);
 		} else {
 			printf ("NONE ");
 		}
@@ -986,7 +987,7 @@
 		if ((previous_bb != NULL) && ! dominates (previous_bb, current_bb)) {
 			if ((area->bb_on_top_of_renaming_stack != NULL) && (area->top_of_renaming_stack == NULL) && (previous_bb->phi_argument_has_real_use == FALSE)) {
 				if (TRACE_SSAPRE) {
-					printf ("Clearing down safe in PHI %d because of backtracking (previous block is [bb %d [ID %d]])\n",
+					printf ("Clearing down safe in PHI %"MONO_FMT_PTR"d because of backtracking (previous block is [bb %d [ID %d]])\n",
 							area->bb_on_top_of_renaming_stack->phi_redundancy_class, previous_bb->cfg_dfn, previous_bb->bb->block_num);
 				}
 				area->bb_on_top_of_renaming_stack->phi_is_down_safe = FALSE;
@@ -1083,7 +1084,7 @@
 					PUSH_REAL_OCCURRENCE (current_expression);
 					phi_bb->phi_is_down_safe = FALSE;
 					if (TRACE_SSAPRE) {
-						printf ("Clearing down safe in PHI %d because of real occurrence %d\n",
+						printf ("Clearing down safe in PHI %"MONO_FMT_PTR"d because of real occurrence %"MONO_FMT_PTR"d\n",
 								phi_bb->phi_redundancy_class, current_expression->redundancy_class);
 					}
 				}
@@ -1111,7 +1112,7 @@
 	}
 	if ((area->bb_on_top_of_renaming_stack != NULL) && (area->top_of_renaming_stack == NULL) && (previous_bb->phi_argument_has_real_use == FALSE)) {
 		if (TRACE_SSAPRE) {
-			printf ("Clearing down safe in PHI %d because of backtracking (previous block is [bb %d [ID %d]])\n",
+			printf ("Clearing down safe in PHI %"MONO_FMT_PTR"d because of backtracking (previous block is [bb %d [ID %d]])\n",
 					area->bb_on_top_of_renaming_stack->phi_redundancy_class, previous_bb->cfg_dfn, previous_bb->bb->block_num);
 		}
 		area->bb_on_top_of_renaming_stack->phi_is_down_safe = FALSE;
@@ -1155,7 +1156,7 @@
 			if (current_bb->phi_argument_class == BOTTOM_REDUNDANCY_CLASS) {
 				if ((current_bb->phi_argument_defined_by_phi != NULL) && (! current_bb->phi_argument_has_real_use)) {
 					if (TRACE_SSAPRE) {
-						printf ("Clearing down safe in PHI %d because PHI argument in block [bb %d [ID %d]] is BOTTOM\n",
+						printf ("Clearing down safe in PHI %"MONO_FMT_PTR"d because PHI argument in block [bb %d [ID %d]] is BOTTOM\n",
 								current_bb->phi_argument_defined_by_phi->phi_redundancy_class, current_bb->cfg_dfn, current_bb->bb->block_num);
 					}
 					current_bb->phi_argument_defined_by_phi->phi_is_down_safe = FALSE;
Index: mono/mini/graph.c
===================================================================
--- mono/mini/graph.c	(revision 37481)
+++ mono/mini/graph.c	(working copy)
@@ -164,10 +164,10 @@
 
 	switch (tree->opcode) {
 	case OP_ICONST:
-		fprintf (fp, "[%d]", tree->inst_c0);
+		fprintf (fp, "[%"MONO_FMT_PTR"d]", tree->inst_c0);
 		break;
 	case OP_I8CONST:
-		fprintf (fp, "[%lld]", tree->inst_l);
+		fprintf (fp, "[%"MONO_FMT_64"d]", tree->inst_l);
 		break;
 	case OP_R8CONST:
 		fprintf (fp, "[%f]", *(double*)tree->inst_p0);
@@ -177,10 +177,10 @@
 		break;
 	case OP_ARG:
 	case OP_LOCAL:
-		fprintf (fp, "[%d]", tree->inst_c0);
+		fprintf (fp, "[%"MONO_FMT_PTR"d]", tree->inst_c0);
 		break;
 	case OP_REGOFFSET:
-		fprintf (fp, "[0x%x(%s)]", tree->inst_offset, mono_arch_regname (tree->inst_basereg));
+		fprintf (fp, "[0x%"MONO_FMT_PTR"x(%s)]", tree->inst_offset, mono_arch_regname (tree->inst_basereg));
 		break;
 	case OP_REGVAR:
 		fprintf (fp, "[%s]", mono_arch_regname (tree->dreg));
@@ -210,7 +210,7 @@
 	}
 	case OP_PHI: {
 		int i;
-		fprintf (fp, "[%d\\ (", tree->inst_c0);
+		fprintf (fp, "[%"MONO_FMT_PTR"d\\ (", tree->inst_c0);
 		for (i = 0; i < tree->inst_phi_args [0]; i++) {
 			if (i)
 				fprintf (fp, ",\\ ");
Index: mono/mini/ssa.c
===================================================================
--- mono/mini/ssa.c	(revision 37481)
+++ mono/mini/ssa.c	(working copy)
@@ -952,7 +952,7 @@
 				*bblist = g_list_prepend (*bblist, tb);
 			}
 		} else if (r1 == 2) {
-			for (i = (int)inst->klass; i >= 0; i--) {
+			for (i = GPOINTER_TO_INT (inst->klass); i >= 0; i--) {
 				MonoBasicBlock *tb = inst->inst_many_bb [i];
 				if (!(tb->flags &  BB_REACHABLE)) {
 					tb->flags |= BB_REACHABLE;
Index: mono/utils/ChangeLog
===================================================================
--- mono/utils/ChangeLog	(revision 37481)
+++ mono/utils/ChangeLog	(working copy)
@@ -1,3 +1,6 @@
+2004-12-??    <Author>
+	* monobitset.c
+	  Fix compiler warning by adding a prototype for my_g_bit_nth_msf
 
 Tue Dec 7 17:53:01 CET 2004 Paolo Molaro <lupus@ximian.com>
 
Index: mono/utils/monobitset.c
===================================================================
--- mono/utils/monobitset.c	(revision 37481)
+++ mono/utils/monobitset.c	(working copy)
@@ -304,6 +304,9 @@
  * There was a 64 bit bug in glib-2.2: g_bit_nth_msf (0, -1) would return 32,
  * causing infinite loops in dominator computation. So glib-2.4 is required.
  */
+gint my_g_bit_nth_msf (gulong mask, gint nth_bit);
+
+gint
 my_g_bit_nth_msf (gulong mask,
 	       gint   nth_bit)
 {
