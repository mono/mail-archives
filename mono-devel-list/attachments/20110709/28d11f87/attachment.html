<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;9&nbsp;July&nbsp;2011&nbsp;18:57,&nbsp;Jonathan&nbsp;Pryor&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jonpryor@vt.edu&quot;&gt;jonpryor@vt.edu&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Jul&nbsp;9,&nbsp;2011,&nbsp;at&nbsp;1:06&nbsp;PM,&nbsp;arkain&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;Here&amp;#39;s&nbsp;another&nbsp;possibility.&nbsp;I&nbsp;don&amp;#39;t&nbsp;see&nbsp;what&nbsp;the&nbsp;problem&nbsp;would&nbsp;be&nbsp;in&lt;br&gt;<br>
&amp;gt;&nbsp;embedding&nbsp;ELF&nbsp;objects&nbsp;into&nbsp;a&nbsp;PE&nbsp;following&nbsp;the&nbsp;usual&nbsp;COFF&nbsp;objects.&nbsp;Doesn&amp;#39;t&nbsp;PE&lt;br&gt;<br>
&amp;gt;&nbsp;have&nbsp;a&nbsp;text&nbsp;section&nbsp;that&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;tag&nbsp;for&nbsp;extraction&nbsp;the&nbsp;native&lt;br&gt;<br>
&amp;gt;&nbsp;portion&nbsp;of&nbsp;the&nbsp;assembly?&nbsp;If&nbsp;that&nbsp;were&nbsp;used,&nbsp;then&nbsp;it&nbsp;would&nbsp;be&nbsp;possible&nbsp;to&lt;br&gt;<br>
&amp;gt;&nbsp;create&nbsp;a&nbsp;PE&nbsp;that&nbsp;contained&nbsp;COFF&nbsp;for&nbsp;the&nbsp;.NET&nbsp; code&nbsp;and&nbsp;ELF&nbsp;for&nbsp;the&nbsp;native&lt;br&gt;<br>
&amp;gt;&nbsp;code&nbsp;(on&nbsp;linux).&nbsp;The&nbsp;assembly&nbsp;loader&nbsp;in&nbsp;Linux&nbsp;could&nbsp;then&nbsp;extract&nbsp;the&nbsp;ELF&lt;br&gt;<br>
&amp;gt;&nbsp;content&nbsp;into&nbsp;a&nbsp;separate&nbsp;file&nbsp;in&nbsp;a&nbsp;temp&nbsp;directory&nbsp;and&nbsp;load&nbsp;it&nbsp;with&nbsp;dlopen.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;That&amp;#39;s&nbsp;only&nbsp;a&nbsp;halfway&nbsp;solution.&nbsp;One&nbsp;of&nbsp;the&nbsp;Nice&nbsp;Things&nbsp;about&nbsp;C++/CLI&nbsp;(and&nbsp;COM&nbsp;interop,&nbsp;for&nbsp;that&nbsp;matter)&nbsp;is&nbsp;that&nbsp;native&nbsp;clients&nbsp;can&nbsp;load&nbsp;managed&nbsp;assemblies&nbsp;without&nbsp;even&nbsp;realizing&nbsp;it&nbsp;[0].&nbsp;Things&nbsp;Just&nbsp;Work&nbsp;because&nbsp;LoadLibrary()&nbsp;loads&nbsp;a&nbsp;mixed-mode&nbsp;assembly&nbsp;the&nbsp;same&nbsp;way&nbsp;it&nbsp;loads&nbsp;any&nbsp;other&nbsp;native&nbsp;library,&nbsp;and&nbsp;the&nbsp;loading&nbsp;app&nbsp;doesn&amp;#39;t&nbsp;need&nbsp;to&nbsp;do&nbsp;anything&nbsp;differently.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Consequently,&nbsp;what&nbsp;you&nbsp;really&nbsp;want&nbsp;is&nbsp;to&nbsp;embed&nbsp;IL/etc.&nbsp;into&nbsp;ELF/Mach-O/etc.&nbsp;file&nbsp;formats,&nbsp;and&nbsp;add&nbsp;support&nbsp;to&nbsp;mono&nbsp;for&nbsp;these&nbsp;alternative&nbsp;file&nbsp;formats.&nbsp;This&nbsp;would&nbsp;allow&nbsp;existing&nbsp;native&nbsp;code&nbsp;to&nbsp;continue&nbsp;to&nbsp;use&nbsp;dlopen(3)/etc.&nbsp;against&nbsp;platform-native&nbsp;libraries&nbsp;which&nbsp;&amp;quot;just&nbsp;happen&amp;quot;&nbsp;to&nbsp;contain&nbsp;IL&nbsp;as&nbsp;well,&nbsp;implicitly&nbsp;pulling&nbsp;in&nbsp;mono&nbsp;(via&nbsp;shared&nbsp;library&nbsp;dependencies,&nbsp;more&nbsp;or&nbsp;less&nbsp;how&nbsp;things&nbsp;work&nbsp;with&nbsp;PE&nbsp;on&nbsp;Windows).&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
This&nbsp;was&nbsp;previously&nbsp;discussed&nbsp;on&nbsp;this&nbsp;thread,&nbsp;and&nbsp;given&nbsp;that&nbsp;ELF&nbsp;allows&nbsp;embedding&nbsp;~arbitrary&nbsp;text/binary&nbsp;sections&nbsp;into&nbsp;.so&nbsp;files&nbsp;(and&nbsp;presumably&nbsp;.dylib&nbsp;does&nbsp;as&nbsp;well),&nbsp;adding&nbsp;support&nbsp;for&nbsp;this&nbsp;likely&nbsp;wouldn&amp;#39;t&nbsp;be&nbsp;_too_&nbsp;difficult...&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
 -&nbsp;Jon&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;agree&nbsp;with&nbsp;you&nbsp;here,&nbsp;Jon,&nbsp;and&nbsp;it&nbsp;sounds&nbsp;like&nbsp;quite&nbsp;an&nbsp;interesting&nbsp;exercise.&nbsp; Of&nbsp;course,&nbsp;one&nbsp;of&nbsp;the&nbsp;other&nbsp;interesting&nbsp;things&nbsp;here&nbsp;would&nbsp;be&nbsp;what&nbsp;compiler&nbsp;do&nbsp;you&nbsp;use&nbsp;to&nbsp;generate&nbsp;a&nbsp;mixed-mode&nbsp;ELF?&nbsp; Or,&nbsp;how&nbsp;do&nbsp;you&nbsp;embed&nbsp;IL&nbsp;(and&nbsp;associated&nbsp;metadata)&nbsp;into&nbsp;your&nbsp;ELF&nbsp;-&nbsp;what&nbsp;process&nbsp;do&nbsp;you&nbsp;run&nbsp;to&nbsp;create&nbsp;this&nbsp;combination&nbsp;ELF?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;not&nbsp;having&nbsp;looked&nbsp;at&nbsp;the&nbsp;Mono&nbsp;PE&nbsp;loader&nbsp;(in&nbsp;depth),&nbsp;I&nbsp;don&amp;#39;t&nbsp;know&nbsp;how&nbsp;hard&nbsp;it&nbsp;would&nbsp;be&nbsp;to&nbsp;abstract&nbsp;the&nbsp;container&nbsp;format&nbsp;away&nbsp;from&nbsp;reading&nbsp;metadata.&nbsp; And&nbsp;after&nbsp;having&nbsp;glanced&nbsp;at&nbsp;it&nbsp;just&nbsp;now&nbsp;-&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;look&nbsp;/too/&nbsp;horrendous.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Tom&nbsp;Spink&lt;br&gt;<br>

</tt>
