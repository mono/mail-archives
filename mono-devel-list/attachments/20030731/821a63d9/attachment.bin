Index: acconfig.h
===================================================================
RCS file: /mono/mono/acconfig.h,v
retrieving revision 1.31
diff -u -b -r1.31 acconfig.h
--- acconfig.h	31 Jul 2003 14:32:40 -0000	1.31
+++ acconfig.h	31 Jul 2003 16:00:46 -0000
@@ -20,7 +20,7 @@
 #undef HAVE_TIMEZONE
 #undef HAVE_TM_GMTOFF
 #undef MONO_SIZEOF_SUNPATH
-#undef MONO_ZERO_ARRAY_LENGTH
+#undef MONO_ZERO_LEN_ARRAY
 #undef NEED_LINK_UNLINK
 #undef PTHREAD_POINTER_ID
 #undef HAVE_GC_H
Index: configure.in
===================================================================
RCS file: /mono/mono/configure.in,v
retrieving revision 1.156
diff -u -b -r1.156 configure.in
--- configure.in	31 Jul 2003 14:32:40 -0000	1.156
+++ configure.in	31 Jul 2003 16:00:47 -0000
@@ -487,10 +487,10 @@
                 };
         ], [], [
 		AC_MSG_RESULT(yes)
-		AC_DEFINE_UNQUOTED(MONO_ZERO_ARRAY_LENGTH, 0)
+		AC_DEFINE_UNQUOTED(MONO_ZERO_LEN_ARRAY, 0)
 	], [
 		AC_MSG_RESULT(no)
-		AC_DEFINE_UNQUOTED(MONO_ZERO_ARRAY_LENGTH, 1)
+		AC_DEFINE_UNQUOTED(MONO_ZERO_LEN_ARRAY, 1)
 	])
 
 	dnl *****************************
Index: mono/io-layer/handles.c
===================================================================
RCS file: /mono/mono/mono/io-layer/handles.c,v
retrieving revision 1.35
diff -u -b -r1.35 handles.c
--- mono/io-layer/handles.c	23 Jul 2003 19:05:34 -0000	1.35
+++ mono/io-layer/handles.c	31 Jul 2003 16:01:26 -0000
@@ -564,7 +564,7 @@
 	guint32 old_len, new_len;
 		
 	old_len=sizeof(struct _WapiHandleScratch) +
-		_wapi_shared_scratch->data_len;
+		_wapi_shared_scratch->data_len - MONO_ZERO_LEN_ARRAY;
 	new_len=old_len+_WAPI_SHM_SCRATCH_SIZE;
 		
 	if(_wapi_shared_scratch->is_shared==TRUE) {
@@ -779,7 +779,7 @@
 		WapiHandleRequest scratch={0};
 		WapiHandleResponse scratch_resp={0};
 		guint32 old_len=sizeof(struct _WapiHandleScratch) +
-			_wapi_shared_scratch->data_len;
+			_wapi_shared_scratch->data_len - MONO_ZERO_LEN_ARRAY;
 		
 		scratch.type=WapiHandleRequestType_Scratch;
 		scratch.u.scratch.length=store_bytes;
Index: mono/io-layer/shared.c
===================================================================
RCS file: /mono/mono/mono/io-layer/shared.c,v
retrieving revision 1.13
diff -u -b -r1.13 shared.c
--- mono/io-layer/shared.c	23 Jul 2003 19:05:34 -0000	1.13
+++ mono/io-layer/shared.c	31 Jul 2003 16:01:27 -0000
@@ -167,7 +167,8 @@
 	if(type==WAPI_SHM_DATA) {
 		wanted_size=sizeof(struct _WapiHandleShared_list);
 	} else if (type==WAPI_SHM_SCRATCH) {
-		wanted_size=sizeof(struct _WapiHandleScratch);
+		wanted_size=sizeof(struct _WapiHandleScratch)
+                    - MONO_ZERO_LEN_ARRAY;
 	} else {
 		g_assert_not_reached ();
 	}
Index: mono/io-layer/wapi-private.h
===================================================================
RCS file: /mono/mono/mono/io-layer/wapi-private.h,v
retrieving revision 1.24
diff -u -b -r1.24 wapi-private.h
--- mono/io-layer/wapi-private.h	31 Jul 2003 14:32:41 -0000	1.24
+++ mono/io-layer/wapi-private.h	31 Jul 2003 16:01:28 -0000
@@ -119,7 +119,7 @@
 	 * resize will go via mremap() or just realloc().
 	 */
 	gboolean is_shared;
-	guchar scratch_data[MONO_ZERO_ARRAY_LENGTH];
+	guchar scratch_data[MONO_ZERO_LEN_ARRAY];
 };
 
 /*
Index: mono/metadata/metadata.h
===================================================================
RCS file: /mono/mono/mono/metadata/metadata.h,v
retrieving revision 1.81
diff -u -b -r1.81 metadata.h
--- mono/metadata/metadata.h	25 Jul 2003 17:28:32 -0000	1.81
+++ mono/metadata/metadata.h	31 Jul 2003 16:01:38 -0000
@@ -2,17 +2,12 @@
 #ifndef __MONO_METADATA_H__
 #define __MONO_METADATA_H__
 
+#include <config.h>
 #include <glib.h>
 
 #include <mono/metadata/blob.h>
 #include <mono/metadata/row-indexes.h>
 #include <mono/metadata/image.h>
-
-#ifdef __GNUC__
-#define MONO_ZERO_LEN_ARRAY 0
-#else
-#define MONO_ZERO_LEN_ARRAY 1
-#endif
 
 #define MONO_TYPE_ISSTRUCT(t) (!(t)->byref && (((t)->type == MONO_TYPE_VALUETYPE && !(t)->data.klass->enumtype) || ((t)->type == MONO_TYPE_TYPEDBYREF)))
 #define MONO_TYPE_IS_VOID(t) ((t) && ((t)->type == MONO_TYPE_VOID) && !(t)->byref)
Index: mono/utils/monobitset.c
===================================================================
RCS file: /mono/mono/mono/utils/monobitset.c,v
retrieving revision 1.7
diff -u -b -r1.7 monobitset.c
--- mono/utils/monobitset.c	5 Mar 2003 14:47:51 -0000	1.7
+++ mono/utils/monobitset.c	31 Jul 2003 16:01:48 -0000
@@ -1,13 +1,8 @@
+#include <config.h>
 #include <glib.h>
 #include <string.h>
 
 #include "monobitset.h"
-
-#ifdef __GNUC__
-#define MONO_ZERO_LEN_ARRAY 0
-#else
-#define MONO_ZERO_LEN_ARRAY 1
-#endif
 
 #define BITS_PER_CHUNK (8 * sizeof (guint32))
 
