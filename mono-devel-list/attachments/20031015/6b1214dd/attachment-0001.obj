? metadata.diff
Index: object.c
===================================================================
RCS file: /mono/mono/mono/metadata/object.c,v
retrieving revision 1.184
diff -u -r1.184 object.c
--- object.c	30 Sep 2003 12:06:51 -0000	1.184
+++ object.c	15 Oct 2003 15:22:20 -0000
@@ -5,7 +5,13 @@
  *   Miguel de Icaza (miguel@ximian.com)
  *
  * (C) 2001 Ximian, Inc.
+ *
+ * Adapted (locale conversion in mono_runtime_run_main()):
+ *
+ *   Uwe Oertel - 2003/10/15
+ *
  */
+
 #include <config.h>
 #include <stdlib.h>
 #include <stdio.h>
@@ -29,6 +35,8 @@
 #include "mono/metadata/profiler-private.h"
 #include <mono/os/gc_wrapper.h>
 
+#include <mono/io-layer/unicode.h>
+
 /*
  * Enable experimental typed allocation using the GC_gcj_malloc function.
  */
@@ -903,8 +911,8 @@
 
 	main_args = (MonoArray*)mono_array_new (domain, mono_defaults.string_class, argc);
 
-	if (!g_path_is_absolute (argv [0])) {
-		gchar *basename = g_path_get_basename (argv [0]);
+	if (!g_path_is_absolute (_wapi_locale_to_utf8(argv [0]))) {
+		gchar *basename = g_path_get_basename (_wapi_locale_to_utf8(argv [0]));
 		gchar *fullpath = g_build_filename (method->klass->image->assembly->basedir,
 						    basename,
 						    NULL);
@@ -913,11 +921,11 @@
 		g_free (fullpath);
 		g_free (basename);
 	} else {
-		mono_array_set (main_args, gpointer, 0, mono_string_new (domain, argv [0]));
+		mono_array_set (main_args, gpointer, 0, mono_string_new (domain, _wapi_locale_to_utf8(argv [0])));
 	}
 
 	for (i = 1; i < argc; ++i) {
-		MonoString *arg = mono_string_new (domain, argv [i]);
+		MonoString *arg = mono_string_new (domain, _wapi_locale_to_utf8(argv [i]));
 		mono_array_set (main_args, gpointer, i, arg);
 	}
 	argc--;
@@ -925,7 +933,7 @@
 	if (method->signature->param_count) {
 		args = (MonoArray*)mono_array_new (domain, mono_defaults.string_class, argc);
 		for (i = 0; i < argc; ++i) {
-			MonoString *arg = mono_string_new (domain, argv [i]);
+			MonoString *arg = mono_string_new (domain, _wapi_locale_to_utf8(argv [i]));
 			mono_array_set (args, gpointer, i, arg);
 		}
 	} else {
