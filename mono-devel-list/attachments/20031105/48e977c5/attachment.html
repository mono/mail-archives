<tt>
&lt;DIV&gt;I&nbsp;don't&nbsp;have&nbsp;the&nbsp;spec&nbsp;with&nbsp;me&nbsp;right&nbsp;now&nbsp;but&nbsp;I&nbsp;thought&nbsp;that&nbsp;for&nbsp;stloc&nbsp;the&nbsp;types&nbsp;had&nbsp;to&nbsp;match.&nbsp;I&nbsp;could&nbsp;be&nbsp;wrong&nbsp;though&nbsp;:)&lt;/DIV&gt;<br>
&lt;DIV&gt;-Laurent&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;BR&gt;&lt;B&gt;&lt;I&gt;Paolo&nbsp;Molaro&nbsp;&amp;lt;lupus@ximian.com&amp;gt;&lt;/I&gt;&lt;/B&gt;&nbsp;wrote:&lt;/DIV&gt;<br>
&lt;BLOCKQUOTE&nbsp;class=replbq&nbsp;style=&quot;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#1010ff&nbsp;2px&nbsp;solid&quot;&gt;On&nbsp;11/04/03&nbsp;Laurent&nbsp;Morichetti&nbsp;wrote:&lt;BR&gt;&amp;gt;&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;get&nbsp;mini&nbsp;to&nbsp;work&nbsp;on&nbsp;64b&nbsp;and&nbsp;ran&nbsp;accross&nbsp;this&nbsp;problem:&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;for&nbsp;'int&nbsp;i&nbsp;=&nbsp;array.Length;'&nbsp;mcs&nbsp;generates:&lt;BR&gt;&amp;gt;&nbsp;ldlen&lt;BR&gt;&amp;gt;&nbsp;stloc.0&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;it&nbsp;really&nbsp;should&nbsp;generate:&lt;BR&gt;&amp;gt;&nbsp;ldlen&lt;BR&gt;&amp;gt;&nbsp;conv.i4&lt;BR&gt;&amp;gt;&nbsp;stloc.0&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;loc0&nbsp;is&nbsp;of&nbsp;type&nbsp;int32&nbsp;and&nbsp;my&nbsp;modified&nbsp;mini&nbsp;cannot&nbsp;match&nbsp;'ldind.i4&nbsp;(regvar)&nbsp;(ldlen&nbsp;(...))'.&nbsp;(cannot&nbsp;store&nbsp;a&nbsp;nati&nbsp;into&nbsp;an&nbsp;int32)&lt;BR&gt;&amp;gt;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;I&nbsp;haven't&nbsp;looked&nbsp;at&nbsp;mcs&nbsp;much&nbsp;and&nbsp;don't&nbsp;know&nbsp;where&nbsp;to&nbsp;start&nbsp;to&nbsp;solve&nbsp;that&nbsp;problem.&nbsp;Can&nbsp;someone&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;it.&lt;BR&gt;&lt;BR&gt;While&nbsp;the&nbsp;change&nbsp;to&nbsp;mcs&nbsp;is&nbsp;harmless&nbsp;(indeed,&nbsp;csc&nbsp;generates&nbsp;the&nbsp;conv.i4&lt;BR&gt;instruction&nbsp;as&nbsp;well&nbsp;and&nbsp;on&nbsp;x86&nbsp;it's&nbsp;removed&nbsp;by&nbsp;the&nbsp;optimizer),&lt;BR&gt;there&nbsp;is&nbsp;a&nbsp;more&nbsp;general&nbsp;solution&nbsp;that&nbsp;I&nbsp;think&nbsp;should&nbsp;be&nbsp;implemented&nbsp;in&nbsp;&lt;BR&gt;the&nbsp;JIT.&nbsp;There&nbsp;is&nbsp;a&nbsp;similar&nbsp;case&nbsp;explained&nbsp;in&nbsp;partition&nbsp;III&nbsp;in&nbsp;the&nbsp;&lt;BR&gt;'Implicit&nbsp;Argument&nbsp;Coercion'<br>
&nbsp;paragraph.&nbsp;&lt;BR&gt;When&nbsp;a&nbsp;signature&nbsp;requires&nbsp;a&nbsp;int32,&nbsp;if&nbsp;the&nbsp;eval&nbsp;stack&nbsp;contains&nbsp;a&nbsp;native&lt;BR&gt;int,&nbsp;it&nbsp;is&nbsp;implictly&nbsp;converted&nbsp;(as&nbsp;if&nbsp;a&nbsp;conv.i4&nbsp;was&nbsp;inserted).&lt;BR&gt;That&nbsp;is&nbsp;basically&nbsp;the&nbsp;same&nbsp;case&nbsp;as&nbsp;storing&nbsp;a&nbsp;value&nbsp;from&nbsp;the&nbsp;eval&nbsp;stack&lt;BR&gt;to&nbsp;a&nbsp;local&nbsp;variable.&lt;BR&gt;If&nbsp;you&nbsp;think&nbsp;about&nbsp;it,&nbsp;the&nbsp;same&nbsp;happens&nbsp;when&nbsp;a&nbsp;double&nbsp;(on&nbsp;the&nbsp;eval&lt;BR&gt;stack)&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;float&nbsp;variable:&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;to&nbsp;add&nbsp;an&lt;BR&gt;explicit&nbsp;conversion&nbsp;in&nbsp;IL&nbsp;code:&nbsp;the&nbsp;JIT&nbsp;does&nbsp;it&nbsp;automatically&nbsp;(because&lt;BR&gt;the&nbsp;cpu&nbsp;has&nbsp;a&nbsp;specific&nbsp;instruction&nbsp;for&nbsp;it:&nbsp;if&nbsp;it&nbsp;didn't&nbsp;we'd&nbsp;have&nbsp;to&lt;BR&gt;insert&nbsp;an&nbsp;explicit&nbsp;conversion&nbsp;opcode&nbsp;in&nbsp;that&nbsp;case,&nbsp;too).&lt;BR&gt;So,&nbsp;in&nbsp;the&nbsp;handful&nbsp;places&nbsp;where&nbsp;such&nbsp;an&nbsp;implicit&nbsp;conversion&nbsp;can/should&lt;BR&gt;happen,&nbsp;we&nbsp;need&nbsp;to&nbsp;add&nbsp;a&nbsp;check&nbsp;and&nbsp;insert&nbsp;an&nbsp;explicit&nbsp;conversion&nbsp;for&lt;BR&gt;platforms&nbsp;that&nbsp;need&nbsp;it&nbsp;(like&nbsp;in&nbsp;this&nbsp;case&nbsp;for&nbsp;64&nbsp;bit&nbsp;architectures).&lt;BR&gt;&lt;BR&gt;lupus&lt;BR&gt;&lt;BR&gt;--&nbsp;&lt;BR&gt;-----------------------------------------------------------------&lt;BR&gt;lupus@debian.org&nbsp;debian/rules&lt;BR&gt;lupus@ximian.com&nbsp;Monkeys&nbsp;do&nbsp;it<br>
&nbsp;better&lt;BR&gt;_______________________________________________&lt;BR&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;BR&gt;Mono-devel-list@lists.ximian.com&lt;BR&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/BLOCKQUOTE&gt;
</tt>
