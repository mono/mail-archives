<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=windows-1251&quot;<br>
&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Ben&nbsp;Maurer&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid1118444966.9091.21.camel@omega.maurer&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;Sat,&nbsp;2005-06-11&nbsp;at&nbsp;01:46&nbsp;+0300,&nbsp;Ilya&nbsp;Kharmatsky&nbsp;wrote:<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;What&nbsp;if&nbsp;you&nbsp;split&nbsp;up&nbsp;such&nbsp;arrays.&nbsp;IE:<br>
<br>
struct&nbsp;X&nbsp;{<br>
&nbsp;&nbsp;&nbsp;int&nbsp;a;&nbsp;int&nbsp;b;&nbsp;int&nbsp;c;<br>
}<br>
<br>
X&nbsp;[]&nbsp;foo;<br>
<br>
Turns&nbsp;into:<br>
<br>
int&nbsp;foo_A&nbsp;[];<br>
int&nbsp;foo_B&nbsp;[];<br>
int&nbsp;foo_C&nbsp;[];<br>
<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;It&nbsp;is&nbsp;complicated&nbsp;task&nbsp;in&nbsp;perspective&nbsp;of&nbsp;our&nbsp;conveter&nbsp;-&nbsp;if&nbsp;it&nbsp;will&nbsp;use<br>
you&nbsp;suggestion,&nbsp;it&nbsp;should<br>
remember&nbsp;the&nbsp;context&nbsp;of&nbsp;each&nbsp;foo_X&nbsp;array&nbsp;(in&nbsp;order&nbsp;for&nbsp;example&nbsp;to&nbsp;call<br>
proper&nbsp;functions&nbsp;etc.)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
Ugh,&nbsp;yeah,&nbsp;that&nbsp;would&nbsp;be&nbsp;ugly.<br>
<br>
Easier&nbsp;way&nbsp;to&nbsp;do&nbsp;it:&nbsp;when&nbsp;you&nbsp;init&nbsp;the&nbsp;array,&nbsp;create&nbsp;all&nbsp;the&nbsp;objects:<br>
<br>
so&nbsp;you&nbsp;say:<br>
<br>
MyStructType&nbsp;[]&nbsp;x&nbsp;=&nbsp;new&nbsp;MyStructType&nbsp;[10]<br>
<br>
for&nbsp;(...)<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx&nbsp;[i]&nbsp;=&nbsp;new&nbsp;MyStructType&nbsp;();<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;The&nbsp;optimization&nbsp;of&nbsp;handling&nbsp;structs&nbsp;should&nbsp;take&nbsp;place&nbsp;in&nbsp;the&nbsp;.net&nbsp;-&amp;gt;<br>
java&nbsp;converter,&nbsp;not&nbsp;in&nbsp;our&nbsp;source&nbsp;code.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;And&nbsp;if&nbsp;usage&nbsp;of&nbsp;structs&nbsp;in&nbsp;specific&nbsp;place&nbsp;in&nbsp;our&nbsp;source&nbsp;code&nbsp;is<br>
optional?&nbsp;I'm&nbsp;talking&nbsp;about&nbsp;specific<br>
case.&nbsp;This&nbsp;is&nbsp;&nbsp;not&nbsp;general&nbsp;proposal&nbsp;for&nbsp;optimization&nbsp;in&nbsp;every&nbsp;place,<br>
where&nbsp;arrays&nbsp;of&nbsp;structs&nbsp;are&nbsp;used!&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
Do&nbsp;you&nbsp;have&nbsp;benchmarks&nbsp;showing&nbsp;that&nbsp;this&nbsp;affects&nbsp;stuff&nbsp;by&nbsp;more&nbsp;than<br>
(say)&nbsp;5%&nbsp;per&nbsp;request?&nbsp;This&nbsp;doesn't&nbsp;look&nbsp;like&nbsp;a&nbsp;perf&nbsp;critical&nbsp;area<br>
really.<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
In&nbsp;&quot;empty&nbsp;page&quot;&nbsp;benchmark&nbsp;-&nbsp;under&nbsp;heavy&nbsp;stress&nbsp;-&nbsp;it&nbsp;took&nbsp;3-5%&nbsp;of<br>
overall&nbsp;server&nbsp;side&nbsp;job.&lt;br&gt;<br>
I'm&nbsp;talking&nbsp;about&nbsp;&quot;empty&nbsp;page&quot;,&nbsp;where&nbsp;no&nbsp;too&nbsp;much&nbsp;flows&nbsp;works.&nbsp;&lt;br&gt;<br>
&lt;blockquote&nbsp;cite=&quot;mid1118444966.9091.21.camel@omega.maurer&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
Even&nbsp;if&nbsp;code&nbsp;is&nbsp;in&nbsp;what&nbsp;is&nbsp;effectively&nbsp;#if&nbsp;0,&nbsp;it&nbsp;has&nbsp;a&nbsp;cost.&nbsp;It&nbsp;makes<br>
our&nbsp;code&nbsp;harder&nbsp;to&nbsp;read,&nbsp;means&nbsp;that&nbsp;people&nbsp;must&nbsp;think&nbsp;about&nbsp;more&nbsp;code<br>
paths,&nbsp;and&nbsp;most&nbsp;importantly,&nbsp;increases&nbsp;the&nbsp;chances&nbsp;that&nbsp;a&nbsp;patch&nbsp;will<br>
cause&nbsp;a&nbsp;regression&nbsp;in&nbsp;your&nbsp;runtime.<br>
<br>
BTW,&nbsp;doesn't&nbsp;this&nbsp;show&nbsp;up&nbsp;with&nbsp;Hashtable,&nbsp;which&nbsp;also&nbsp;uses&nbsp;an&nbsp;array&nbsp;of<br>
structs?<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
In&nbsp;Grasshopper&nbsp;we&nbsp;are&nbsp;using&nbsp;completely&nbsp;different&nbsp;implementation&nbsp;of<br>
Hashtable&nbsp;(BTW&nbsp;our&nbsp;&lt;br&gt;<br>
implementation&nbsp;doesn't&nbsp;use&nbsp;structs&nbsp;and&nbsp;works&nbsp;faster&nbsp;then&nbsp;mono's<br>
original&nbsp;hashtable&nbsp;and&nbsp;msft&lt;br&gt;<br>
hashtable).&nbsp;&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
