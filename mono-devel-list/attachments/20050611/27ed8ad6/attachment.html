<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=windows-1251&quot;<br>
&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--------&nbsp;Original&nbsp;Message&nbsp;--------<br>
&lt;table&nbsp;border=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&gt;<br>
&nbsp;&nbsp;&lt;tbody&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;align=&quot;right&quot;&nbsp;nowrap=&quot;nowrap&quot;&nbsp;valign=&quot;baseline&quot;&gt;Subject:&nbsp;&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Re:&nbsp;[Mono-devel-list]&nbsp;System.Web/System.Web.UI&nbsp;-&nbsp;patch&nbsp;(code<br>
synchronization&nbsp;between&nbsp;Mono&nbsp;and&nbsp;Mainsoft)&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;align=&quot;right&quot;&nbsp;nowrap=&quot;nowrap&quot;&nbsp;valign=&quot;baseline&quot;&gt;Date:&nbsp;&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Sat,&nbsp;11&nbsp;Jun&nbsp;2005&nbsp;15:35:32&nbsp;+0300&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;align=&quot;right&quot;&nbsp;nowrap=&quot;nowrap&quot;&nbsp;valign=&quot;baseline&quot;&gt;From:&nbsp;&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Ilya&nbsp;Kharmatsky&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:ilyak@mainsoft.com&quot;&gt;&amp;lt;ilyak@mainsoft.com&amp;gt;&lt;/a&gt;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;align=&quot;right&quot;&nbsp;nowrap=&quot;nowrap&quot;&nbsp;valign=&quot;baseline&quot;&gt;To:&nbsp;&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Ben&nbsp;Maurer&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:bmaurer@ximian.com&quot;&gt;&amp;lt;bmaurer@ximian.com&amp;gt;&lt;/a&gt;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&nbsp;align=&quot;right&quot;&nbsp;nowrap=&quot;nowrap&quot;&nbsp;valign=&quot;baseline&quot;&gt;References:&nbsp;&lt;/th&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:42A6D263.8000505@mainsoft.com&quot;&gt;&amp;lt;42A6D263.8000505@mainsoft.com&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:1118358334.29906.14.camel@localhost.localdomain&quot;&gt;&amp;lt;1118358334.29906.14.camel@localhost.localdomain&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:1118360879.8697.78.camel@omega.maurer&quot;&gt;&amp;lt;1118360879.8697.78.camel@omega.maurer&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:dd99b8c805061010446a5b3bdb@mail.gmail.com&quot;&gt;&amp;lt;dd99b8c805061010446a5b3bdb@mail.gmail.com&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:42AA0B13.3090809@mainsoft.com&quot;&gt;&amp;lt;42AA0B13.3090809@mainsoft.com&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:1118440926.9091.12.camel@omega.maurer&quot;&gt;&amp;lt;1118440926.9091.12.camel@omega.maurer&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:42AA185C.6050507@mainsoft.com&quot;&gt;&amp;lt;42AA185C.6050507@mainsoft.com&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:1118444966.9091.21.camel@omega.maurer&quot;&gt;&amp;lt;1118444966.9091.21.camel@omega.maurer&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:42AA8806.4000407@mainsoft.com&quot;&gt;&amp;lt;42AA8806.4000407@mainsoft.com&amp;gt;&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:1118473290.7971.55.camel@linux.site&quot;&gt;&amp;lt;1118473290.7971.55.camel@linux.site&amp;gt;&lt;/a&gt;&lt;/td&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>
&nbsp;&nbsp;&lt;/tbody&gt;<br>
&lt;/table&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;meta&nbsp;content=&quot;text/html;charset=windows-1251&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Ben&nbsp;Maurer&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid1118473290.7971.55.camel@linux.site&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;Sat,&nbsp;2005-06-11&nbsp;at&nbsp;09:43&nbsp;+0300,&nbsp;Ilya&nbsp;Kharmatsky&nbsp;wrote:<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;In&nbsp;&quot;empty&nbsp;page&quot;&nbsp;benchmark&nbsp;-&nbsp;under&nbsp;heavy&nbsp;stress&nbsp;-&nbsp;it&nbsp;took&nbsp;3-5%&nbsp;of<br>
overall&nbsp;server&nbsp;side&nbsp;job.<br>
I'm&nbsp;talking&nbsp;about&nbsp;&quot;empty&nbsp;page&quot;,&nbsp;where&nbsp;no&nbsp;too&nbsp;much&nbsp;flows&nbsp;works.&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
Wow.&nbsp;How&nbsp;much&nbsp;slower&nbsp;are&nbsp;you&nbsp;on&nbsp;a&nbsp;raw&nbsp;benchmark&nbsp;of&nbsp;accessing&nbsp;a&nbsp;struct<br>
array?<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&quot;Accessing&quot;&nbsp;is&nbsp;not&nbsp;a&nbsp;point.&nbsp;The&nbsp;initialization&nbsp;of&nbsp;such&nbsp;array&nbsp;is&nbsp;root&nbsp;of<br>
troubles.&nbsp;I&nbsp;have&nbsp;no&nbsp;raw&nbsp;benchmark&lt;br&gt;<br>
but&nbsp;this&nbsp;cost&nbsp;will&nbsp;be&nbsp;proportional&nbsp;to&nbsp;length&nbsp;of&nbsp;array&nbsp;*&nbsp;&quot;new&quot;.&nbsp;Since,<br>
currently&nbsp;I'm&nbsp;on&nbsp;vocation&nbsp;-&nbsp;I&nbsp;cannot&lt;br&gt;<br>
run&nbsp;it&nbsp;and&nbsp;say&nbsp;you&nbsp;exact&nbsp;numbers.&lt;br&gt;<br>
&lt;blockquote&nbsp;cite=&quot;mid1118473290.7971.55.camel@linux.site&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Given&nbsp;those&nbsp;numbers,&nbsp;it&nbsp;seems&nbsp;like&nbsp;struct&nbsp;member&nbsp;access&nbsp;is&nbsp;a&nbsp;few&nbsp;orders<br>
of&nbsp;magnitude&nbsp;slower&nbsp;than&nbsp;it&nbsp;should&nbsp;be.&nbsp;Sounds&nbsp;like&nbsp;something&nbsp;that&nbsp;needs<br>
to&nbsp;be&nbsp;fixed&nbsp;at&nbsp;the&nbsp;source...&nbsp;A&nbsp;3-5%&nbsp;improvement&nbsp;on&nbsp;web&nbsp;requests&nbsp;makes<br>
for&nbsp;a&nbsp;nice&nbsp;incentive!<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
Since&nbsp;each&nbsp;request&nbsp;-&nbsp;created&nbsp;new&nbsp;instanced&nbsp;of&nbsp;these&nbsp;arrays&nbsp;-&nbsp;we&nbsp;got&nbsp;the<br>
problem.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;cite=&quot;mid1118473290.7971.55.camel@linux.site&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;BTW,&nbsp;doesn't&nbsp;this&nbsp;show&nbsp;up&nbsp;with&nbsp;Hashtable,&nbsp;which&nbsp;also&nbsp;uses&nbsp;an&nbsp;array&nbsp;of<br>
structs?<br>
<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;In&nbsp;Grasshopper&nbsp;we&nbsp;are&nbsp;using&nbsp;completely&nbsp;different&nbsp;implementation&nbsp;of<br>
Hashtable&nbsp;(BTW&nbsp;our&nbsp;<br>
implementation&nbsp;doesn't&nbsp;use&nbsp;structs&nbsp;and&nbsp;works&nbsp;faster&nbsp;then&nbsp;mono's<br>
original&nbsp;hashtable&nbsp;and&nbsp;msft<br>
hashtable).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
How&nbsp;about&nbsp;in&nbsp;terms&nbsp;of&nbsp;memory&nbsp;usage?&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
I&nbsp;don't&nbsp;know&nbsp;exact&nbsp;numbers&nbsp;-&nbsp;but&nbsp;it&nbsp;shouldn't&nbsp;be&nbsp;a&nbsp;problem.&lt;br&gt;<br>
&lt;blockquote&nbsp;cite=&quot;mid1118473290.7971.55.camel@linux.site&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Care&nbsp;to&nbsp;share?&nbsp;Have&nbsp;benchmarks?<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
I&nbsp;have&nbsp;no&nbsp;benchmarks&nbsp;currently&nbsp;,&nbsp;it&nbsp;depends&nbsp;also&nbsp;on&nbsp;operation&nbsp;(Add,<br>
Remove,&nbsp;ContainsKey).&lt;br&gt;<br>
When&nbsp;I'll&nbsp;be&nbsp;back&nbsp;in&nbsp;office&nbsp;I'll&nbsp;send&nbsp;the&nbsp;benchmarks&nbsp;and&nbsp;code&nbsp;-&nbsp;but&nbsp;our<br>
code&nbsp;has&nbsp;been&nbsp;strongly&nbsp;&lt;br&gt;<br>
influenced&nbsp;by &nbsp;:<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;href=&quot;http://gee.cs.oswego.edu/dl/classes/EDU/oswego/cs/dl/util/concurrent/ConcurrentReaderHashMap.html&quot;&gt;http://gee.cs.oswego.edu/dl/classes/EDU/oswego/cs/dl/util/concurrent/ConcurrentReaderHashMap.html&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
(you&nbsp;can&nbsp;download&nbsp;code&nbsp;from&nbsp;here:&lt;br&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;<br>
&nbsp;href=&quot;http://gee.cs.oswego.edu/dl/classes/EDU/oswego/cs/dl/util/concurrent/intro.html&quot;&gt;http://gee.cs.oswego.edu/dl/classes/EDU/oswego/cs/dl/util/concurrent/intro.html&lt;/a&gt;&lt;br&gt;<br>
check&nbsp;&quot;installation&quot;&nbsp;part)&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;I&nbsp;told,&nbsp;when&nbsp;I'll&nbsp;return&nbsp;to&nbsp;office&nbsp;-&nbsp;I'll&nbsp;send&nbsp;our&nbsp;version&nbsp;of<br>
Hashtable.cs&lt;br&gt;<br>
&lt;br&gt;<br>
Ilya.&lt;br&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
