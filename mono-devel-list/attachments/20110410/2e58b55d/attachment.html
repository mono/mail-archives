<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#ffffff&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;04/09/2011&nbsp;04:39&nbsp;PM,&nbsp;Jeff&nbsp;Stedfast&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;cite=&quot;mid:4DA0C40F.3050000@novell.com&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;04/06/2011&nbsp;03:18&nbsp;AM,&nbsp;Marek&nbsp;Safar&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;cite=&quot;mid:4D9C13DE.7050008@gmail.com&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hello,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&amp;gt;&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppublic&nbsp;class&nbsp;Sort&amp;lt;T&amp;gt;&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppublic&nbsp;delegate&nbsp;int&nbsp;Comparison&nbsp;(T&nbsp;v0,&nbsp;T&nbsp;v1);<br>
<br>
You&nbsp;don't&nbsp;need&nbsp;yet&nbsp;another&nbsp;delegate,&nbsp;just&nbsp;use&nbsp;standard&nbsp;Func<br>
<br>
&amp;gt;&amp;gt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstatic&nbsp;readonly&nbsp;int&nbsp;INSERTIONSORT_THRESHOLD&nbsp;=&nbsp;7;<br>
<br>
Why&nbsp;not&nbsp;to&nbsp;used&nbsp;const&nbsp;int&nbsp;?<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;More&nbsp;importantly&nbsp;what&nbsp;is&nbsp;performance&nbsp;of&nbsp;sorting&nbsp;array&nbsp;of&nbsp;10-20<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements&nbsp;called&nbsp;1000000&nbsp;times&nbsp;?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attached&nbsp;is&nbsp;another&nbsp;test&nbsp;program&nbsp;with&nbsp;2&nbsp;newer/faster<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implementations&nbsp;of&nbsp;QuickSort,&nbsp;one&nbsp;of&nbsp;which&nbsp;is&nbsp;Non-Recursive.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;can&nbsp;run&nbsp;this&nbsp;program&nbsp;like&nbsp;so:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mono&nbsp;./qsort.exe&nbsp;[-random,&nbsp;-sorted,&nbsp;-reversed]&nbsp;[array&nbsp;size]&nbsp;[#<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loops]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;These&nbsp;2&nbsp;new&nbsp;implementations&nbsp;manage&nbsp;to&nbsp;reduce&nbsp;the&nbsp;number&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comparisons&nbsp;done&nbsp;by&nbsp;merging&nbsp;the&nbsp;Median()&nbsp;function&nbsp;from&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;set&nbsp;into&nbsp;the&nbsp;main&nbsp;body&nbsp;of&nbsp;the&nbsp;QuickSort&nbsp;function&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swapping&nbsp;those&nbsp;3&nbsp;elements&nbsp;into&nbsp;ascending&nbsp;order&nbsp;as&nbsp;it&nbsp;compares&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find&nbsp;the&nbsp;optimal&nbsp;pivot.&nbsp;This&nbsp;has&nbsp;the&nbsp;advantage&nbsp;of&nbsp;allowing&nbsp;our<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loops&nbsp;to&nbsp;start&nbsp;at&nbsp;low+1&nbsp;and&nbsp;high-1&nbsp;(thus&nbsp;reducing&nbsp;our&nbsp;compares&nbsp;by<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;for&nbsp;each&nbsp;partition).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;My&nbsp;previous&nbsp;implementation&nbsp;was&nbsp;able&nbsp;to&nbsp;reduce&nbsp;the&nbsp;compares&nbsp;by&nbsp;1&nbsp;by<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;starting&nbsp;at&nbsp;low+1&nbsp;by&nbsp;moving&nbsp;the&nbsp;pivot&nbsp;into&nbsp;low,&nbsp;but&nbsp;this&nbsp;has&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;negative&nbsp;impact&nbsp;of&nbsp;destroying&nbsp;performance&nbsp;on&nbsp;reverse-sorted<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrays.&nbsp;My&nbsp;new&nbsp;implementation&nbsp;doesn't&nbsp;have&nbsp;this&nbsp;problem&nbsp;(and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;therefore,&nbsp;we&nbsp;don't&nbsp;need&nbsp;to&nbsp;fall&nbsp;back&nbsp;to&nbsp;that&nbsp;insertion-sort&nbsp;if&nbsp;we<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detect&nbsp;that&nbsp;pathological&nbsp;case).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Interestingly,&nbsp;the&nbsp;NonRecursiveQuickSort()&nbsp;implementation&nbsp;does&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noticeably&nbsp;improve&nbsp;performance&nbsp;over&nbsp;the&nbsp;recursive&nbsp;version&nbsp;and&nbsp;in<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fact&nbsp;is&nbsp;slower&nbsp;than&nbsp;even&nbsp;our&nbsp;current&nbsp;implementation&nbsp;for&nbsp;sorting<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;small&nbsp;arrays&nbsp;(made&nbsp;evident&nbsp;when&nbsp;looped&nbsp;millions&nbsp;of&nbsp;times).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;How&nbsp;do&nbsp;you&nbsp;feel&nbsp;about&nbsp;replacing&nbsp;corlib's&nbsp;qsort()&nbsp;implementation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;my&nbsp;FasterQuickSort()&nbsp;implementation?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jeff&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;to&nbsp;be&nbsp;clear,&nbsp;I&nbsp;meant&nbsp;&quot;how&nbsp;do&nbsp;you&nbsp;feel&nbsp;about&nbsp;*me*&nbsp;doing&nbsp;the&nbsp;work<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;replace&nbsp;the&nbsp;current&nbsp;QuickSort&nbsp;impl&nbsp;in&nbsp;corlib&nbsp;with&nbsp;mine?&quot;&nbsp;:-)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;just&nbsp;want&nbsp;to&nbsp;make&nbsp;sure&nbsp;before&nbsp;I&nbsp;create&nbsp;a&nbsp;patch&nbsp;that&nbsp;people&nbsp;are<br>
&nbsp;&nbsp;&nbsp;&nbsp;interested.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;said,&nbsp;I&nbsp;forgot&nbsp;to&nbsp;include&nbsp;benchmark&nbsp;results:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[fejj@serenity&nbsp;sorting]$&nbsp;mono&nbsp;./qsort.exe&nbsp;-random&nbsp;10&nbsp;10000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;BasicQuickSort&nbsp;comparisons&nbsp;needed:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;430000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FasterQuickSort&nbsp;comparisons&nbsp;needed:&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;250000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;BasicQuickSort&nbsp;finished&nbsp;in:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;00:00:18.8535031s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FasterQuickSort&nbsp;finished&nbsp;in:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;00:00:16.4478594s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[fejj@serenity&nbsp;sorting]$&nbsp;mono&nbsp;./qsort.exe&nbsp;-sorted&nbsp;10&nbsp;10000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;BasicQuickSort&nbsp;comparisons&nbsp;needed:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;330000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FasterQuickSort&nbsp;comparisons&nbsp;needed:&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;180000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;BasicQuickSort&nbsp;finished&nbsp;in:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;00:00:16.9532771s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FasterQuickSort&nbsp;finished&nbsp;in:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;00:00:14.1202212s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[fejj@serenity&nbsp;sorting]$&nbsp;mono&nbsp;./qsort.exe&nbsp;-reversed&nbsp;10&nbsp;10000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;BasicQuickSort&nbsp;comparisons&nbsp;needed:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;360000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FasterQuickSort&nbsp;comparisons&nbsp;needed:&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;180000000&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;BasicQuickSort&nbsp;finished&nbsp;in:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;00:00:17.4450895s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;FasterQuickSort&nbsp;finished&nbsp;in:&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;00:00:15.1590930s&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Jeff&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
