Index: inssel.brg
===================================================================
RCS file: /cvs/public/mono/mono/mini/inssel.brg,v
retrieving revision 1.39
diff -u -r1.39 inssel.brg
--- inssel.brg	14 Apr 2004 10:31:49 -0000	1.39
+++ inssel.brg	2 May 2004 02:28:51 -0000
@@ -562,22 +562,24 @@
 				   state->right->left->tree->inst_offset);
 }
 
-stmt: CEE_STIND_I4 (OP_REGVAR, OP_ICONST) {
+stmt: CEE_STIND_I4 (OP_REGVAR, OP_ICONST),
+stmt: CEE_STIND_I2 (OP_REGVAR, OP_ICONST),
+stmt: CEE_STIND_I1 (OP_REGVAR, OP_ICONST),
+stmt: CEE_STIND_REF (OP_REGVAR, OP_ICONST),
+stmt: CEE_STIND_I (OP_REGVAR, OP_ICONST) {
+	tree->inst_c0 = state->right->tree->inst_c0;
+	if (tree->opcode == CEE_STIND_I2)
+		tree->inst_c0 &= 0xffff;
+	if (tree->opcode == CEE_STIND_I1)
+		tree->inst_c0 &= 0xff;
+	
 	tree->opcode = OP_ICONST;
 	tree->dreg = state->left->tree->dreg;
-	tree->inst_c0 = state->right->tree->inst_c0;
 	mono_bblock_add_inst (s->cbb, tree);
 }
 
 stmt: CEE_STIND_REF (OP_REGVAR, reg) {
 	MONO_EMIT_UNALU (s, tree, OP_MOVE, state->left->tree->dreg, state->right->reg1);
-}
-
-stmt: CEE_STIND_REF (OP_REGVAR, OP_ICONST) {
-	tree->opcode = OP_ICONST;
-	tree->dreg = state->left->tree->dreg;
-	tree->inst_c0 = state->right->tree->inst_c0;
-	mono_bblock_add_inst (s->cbb, tree);
 }
 
 stmt: CEE_STIND_I (OP_REGVAR, reg) {
