<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;6.5.7650.28&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[Mono-dev]&nbsp;[PATCH]&nbsp;ASP.NET&nbsp;2.0&nbsp;-&nbsp;fix&nbsp;for&nbsp;TemplateSourceDirectory&nbsp;inheritance&nbsp;with&nbsp;master&nbsp;pages&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/plain&nbsp;format&nbsp;--&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Hello&nbsp;Marek,&lt;BR&gt;<br>
&lt;BR&gt;<br>
To&nbsp;solve&nbsp;the&nbsp;problem&nbsp;you&nbsp;describe,&nbsp;MS&nbsp;set&nbsp;the&nbsp;new&nbsp;property&nbsp;-&nbsp;AppRelativeTemplateSourceDirectory.&nbsp;I&nbsp;think&nbsp;it&nbsp;would&nbsp;be&nbsp;better&nbsp;to&nbsp;follow&nbsp;their&nbsp;solution&nbsp;-&nbsp;then&nbsp;we&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;share&nbsp;our&nbsp;code&nbsp;(see&nbsp;Control.TemplateSourceDirectory&nbsp;-&nbsp;the&nbsp;JVM&nbsp;version).&nbsp;In&nbsp;addition,&nbsp;if&nbsp;the&nbsp;user&nbsp;overrides&nbsp;TemplateSourceDirectory,&nbsp;his&nbsp;code&nbsp;will&nbsp;not&nbsp;compile&nbsp;under&nbsp;mono.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Regards,&lt;BR&gt;<br>
Konstantin&nbsp;Triger&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
-----Original&nbsp;Message-----&lt;BR&gt;<br>
From:&nbsp;mono-devel-list-bounces@lists.ximian.com&nbsp;on&nbsp;behalf&nbsp;of&nbsp;Marek&nbsp;Habersack&lt;BR&gt;<br>
Sent:&nbsp;Thu&nbsp;08/02/2007&nbsp;00:25&lt;BR&gt;<br>
To:&nbsp;Mono&nbsp;Development&nbsp;List&lt;BR&gt;<br>
Subject:&nbsp;[Mono-dev]&nbsp;[PATCH]&nbsp;ASP.NET&nbsp;2.0&nbsp;-&nbsp;fix&nbsp;for&nbsp;TemplateSourceDirectory&nbsp;inheritance&nbsp;with&nbsp;master&nbsp;pages&lt;BR&gt;<br>
&lt;BR&gt;<br>
Hello,&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&nbsp;The&nbsp;attached&nbsp;diff&nbsp;fixes&nbsp;a&nbsp;situation,&nbsp;where&nbsp;ResolveClientUrl&nbsp;wouldn't&nbsp;work&lt;BR&gt;<br>
correctly&nbsp;if&nbsp;it&nbsp;was&nbsp;used&nbsp;from&nbsp;within&nbsp;a&nbsp;control&nbsp;placed&nbsp;in&nbsp;a&nbsp;page&nbsp;that&nbsp;uses&nbsp;a&lt;BR&gt;<br>
master&nbsp;page,&nbsp;i.e.&nbsp;if&nbsp;the&nbsp;parenthood&nbsp;tree&nbsp;was&nbsp;like:&lt;BR&gt;<br>
&lt;BR&gt;<br>
System.Web.UI.WebControls.ContentPlaceHolder&lt;BR&gt;<br>
&amp;nbsp;&nbsp;System.Web.UI.HtmlControls.HtmlForm&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ASP.test_master&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ASP.Default_aspx&lt;BR&gt;<br>
&lt;BR&gt;<br>
with&nbsp;the&nbsp;site&nbsp;layout:&lt;BR&gt;<br>
&lt;BR&gt;<br>
Default.aspx&lt;BR&gt;<br>
subdir/test.master&lt;BR&gt;<br>
subdir/Default.aspx&lt;BR&gt;<br>
&lt;BR&gt;<br>
In&nbsp;such&nbsp;situation,&nbsp;ResolveUrl&nbsp;(called&nbsp;by&nbsp;ResolveClientUrl)&nbsp;would&nbsp;return&lt;BR&gt;<br>
incorrect&nbsp;URL&nbsp;for&nbsp;any&nbsp;relative&nbsp;address,&nbsp;in&nbsp;the&nbsp;above&nbsp;case,&nbsp;if&nbsp;invoked&nbsp;from&lt;BR&gt;<br>
~/Default.aspx:&lt;BR&gt;<br>
&lt;BR&gt;<br>
ResolveClientUrl(&amp;quot;subdir/Default.aspx&amp;quot;)&nbsp;==&nbsp;subdir/subdir/Default.aspx&lt;BR&gt;<br>
&lt;BR&gt;<br>
This&nbsp;was&nbsp;due&nbsp;to&nbsp;the&nbsp;fact,&nbsp;that&nbsp;ASP.test_master&nbsp;TemplateSourceDirectory&nbsp;code&lt;BR&gt;<br>
(generated&nbsp;by&nbsp;the&nbsp;TemplateControlCompiler)&nbsp;would&nbsp;not&nbsp;reach&nbsp;up&nbsp;to&nbsp;its&nbsp;parent,&lt;BR&gt;<br>
but&nbsp;would&nbsp;return&nbsp;&amp;quot;~/subdir&amp;quot;&nbsp;instead&nbsp;of&nbsp;&amp;quot;/&amp;quot;.&lt;BR&gt;<br>
&lt;BR&gt;<br>
The&nbsp;diff&nbsp;makes&nbsp;two&nbsp;modifications&nbsp;-&nbsp;first&nbsp;it&nbsp;makes&nbsp;sure&nbsp;TemplateSourceDirectory&lt;BR&gt;<br>
always&nbsp;returns&nbsp;a&nbsp;HTTP-absolute&nbsp;URL&nbsp;(e.g.&nbsp;/,&nbsp;/subdir&nbsp;etc)&nbsp;and&nbsp;that&nbsp;any&nbsp;template&lt;BR&gt;<br>
control&nbsp;checks&nbsp;for&nbsp;its&nbsp;parent's&nbsp;TemplateSourceDir&nbsp;value&nbsp;before&nbsp;returning&nbsp;its&lt;BR&gt;<br>
hard-coded&nbsp;source&nbsp;directory.&lt;BR&gt;<br>
&lt;BR&gt;<br>
please&nbsp;review,&nbsp;thanks&lt;BR&gt;<br>
&lt;BR&gt;<br>
marek&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>
<br>

</tt>
