Index: eglib/src/gtimer-win32.c
===================================================================
--- eglib/src/gtimer-win32.c	(revision 133507)
+++ eglib/src/gtimer-win32.c	(working copy)
@@ -68,9 +68,14 @@
 gdouble
 g_timer_elapsed (GTimer *timer, gulong *microseconds)
 {
-	guint64 stop;
-	guint64 freq;
-	gdouble seconds;
+	static guint64 freq = 0;
+	guint64 delta, stop;
+
+	if (freq == 0) {
+		if (!QueryPerformanceFrequency ((LARGE_INTEGER *)&freq))
+			freq = 1;
+	}
+
 	if (timer->stop == 0) {
 		QueryPerformanceCounter ((LARGE_INTEGER*)&stop);
 	}
@@ -78,13 +83,12 @@
 		stop = timer->stop;
 	}
 
-	QueryPerformanceFrequency ((LARGE_INTEGER*)&freq);
-	seconds = 1.0 * (stop - timer->start) / freq;
+	delta = stop - timer->start;
 
-	if (microseconds) {
-		*microseconds = (gulong)(1000000.0 * (stop - timer->start) / freq);
-	}
-	return seconds;
+	if (microseconds)
+		*microseconds = (gulong) (delta * (1000000.0 / freq));
+
+	return (gdouble) delta / (gdouble) freq;
 }
 
 
Index: eglib/ChangeLog
===================================================================
--- eglib/ChangeLog	(revision 133507)
+++ eglib/ChangeLog	(working copy)
@@ -1,3 +1,9 @@
+2009-04-22  Jeffrey Stedfast  <fejj@novell.com>
+
+	* src/gtimer-win32.c (g_timer_elapsed): Avoid re-querying freq by
+	just saving it in a static variable. Also modified microseconds
+	calculation to avoid overflow.
+
 2009-04-05  Miguel de Icaza  <miguel@novell.com>
 
 	* src/gpath.c: Avoid situations where we add the separator if one
