<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;I&amp;#39;ve&nbsp;almost&nbsp;finished&nbsp;tuning&nbsp;Mono&amp;#39;s&nbsp;Altivec&nbsp;performance.&nbsp;The&nbsp;results&nbsp;are&nbsp;,&nbsp;as&nbsp;usual,&nbsp;in&nbsp;this&nbsp;table:&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://spreadsheets.google.com/ccc?key=0AhjvSAvEoHopdG1LUE9Zdkd1TTZIQ0FCWl82bU5Fa1E&amp;amp;hl=en&amp;amp;authkey=COqyrPMD&quot;&gt;https://spreadsheets.google.com/ccc?key=0AhjvSAvEoHopdG1LUE9Zdkd1TTZIQ0FCWl82bU5Fa1E&amp;amp;hl=en&amp;amp;authkey=COqyrPMD&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://spreadsheets.google.com/ccc?key=0AhjvSAvEoHopdG1LUE9Zdkd1TTZIQ0FCWl82bU5Fa1E&amp;amp;hl=en&amp;amp;authkey=COqyrPMD&quot;&gt;&lt;/a&gt;There&nbsp;are&nbsp;much&nbsp;more&nbsp;&amp;quot;blue&amp;quot;&nbsp;ratios&nbsp;now&nbsp;but&nbsp;there&nbsp;are&nbsp;still&nbsp;some&nbsp;optimization&nbsp;issues&nbsp;I&nbsp;couldn&amp;#39;t&nbsp;solve:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1)&nbsp;&amp;#39;mmm_intrchage&amp;#39;&nbsp;uses&nbsp;a&nbsp;different&nbsp;expression&nbsp;for&nbsp;alignment&nbsp;checking&nbsp;(versioning)&nbsp;and&nbsp;this&nbsp;expression&nbsp;is&nbsp;somehow&nbsp;isn&amp;#39;t&nbsp;constand-folded&nbsp;during&nbsp;JITing.&nbsp;This&nbsp;results&nbsp;in&nbsp;twice&nbsp;bigger&nbsp;code&nbsp;and&nbsp;register&nbsp;allocator&nbsp;just&nbsp;can&amp;#39;t&nbsp;act&nbsp;effectively&nbsp;there.&nbsp;By&nbsp;enabling&nbsp;full&nbsp;optimizations&nbsp;in&nbsp;Mono&nbsp;I&nbsp;could&nbsp;partially&nbsp;solve&nbsp;this&nbsp;problem&nbsp;but&nbsp;is&nbsp;not&nbsp;the&nbsp;best&nbsp;solution&nbsp;(since&nbsp;this&nbsp;increases&nbsp;compilation&nbsp;time).&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2)&nbsp;&amp;#39;video_dissolve_fp&amp;#39;,&nbsp;&amp;#39;saxpy_fp&amp;#39;,&nbsp;&amp;#39;dscal_fp&amp;#39;&nbsp;are&nbsp;all&nbsp;variations&nbsp;of&nbsp;simple&nbsp;&amp;#39;a[i]=b*c[i]+d[i]&amp;#39;&nbsp;floating-point&nbsp;loop.&nbsp;The&nbsp;aligned&nbsp;version,&nbsp;generated&nbsp;by&nbsp;vectorizer,&nbsp;looks&nbsp;(in&nbsp;Gimple)&nbsp;like:&nbsp;&amp;quot;*(&amp;amp;a+i)&nbsp;=&nbsp;b*&nbsp;(*(&amp;amp;c+i))&nbsp;+&nbsp;*(&amp;amp;d+i)&amp;quot;&nbsp;and&nbsp;this&nbsp;is&nbsp;converted&nbsp;further&nbsp;to&nbsp;CIL.&nbsp;Since&nbsp;Mono&nbsp;has&nbsp;no&nbsp;inter-bb&nbsp;constant&nbsp;propagation&nbsp;and&nbsp;all&nbsp;array&amp;#39;s&nbsp;addresses&nbsp;are&nbsp;know&nbsp;at&nbsp;JIT&nbsp;time,&nbsp;all&nbsp;3&nbsp;addresses&nbsp;are&nbsp;generated&nbsp;by&nbsp;Mono&nbsp;in&nbsp;each&nbsp;iteration&nbsp;(and&nbsp;it&nbsp;takes&nbsp;3&nbsp;PPC&nbsp;instruction&nbsp;for&nbsp;each&nbsp;address).&nbsp;I&nbsp;think&nbsp;this&nbsp;is&nbsp;the&nbsp;reason&nbsp;for&nbsp;bad&nbsp;results&nbsp;but&nbsp;the&nbsp;ratios&nbsp;these&nbsp;benchmarks&nbsp;behave&nbsp;rather&nbsp;differently.&nbsp;Anyway,&nbsp;it&nbsp;would&nbsp;be&nbsp;much&nbsp;better&nbsp;if&nbsp;arrays&amp;#39;&nbsp;addresses&nbsp;were&nbsp;saved&nbsp;to&nbsp;locals&nbsp;in&nbsp;loop&nbsp;prolog&nbsp;and&nbsp;then&nbsp;used&nbsp;in&nbsp;each&nbsp;iteration.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#39;video_dissolve_s8&amp;#39;&nbsp;and&nbsp;&amp;#39;small_sad&amp;#39;&nbsp;still&nbsp;need&nbsp;to&nbsp;be&nbsp;implemented/analyzed.&nbsp;Tommorow&nbsp;I&amp;#39;ll&nbsp;update&nbsp;the&nbsp;numbers&nbsp;for&nbsp;SSE.&nbsp;I&nbsp;anticipate&nbsp; an&nbsp;improvement&nbsp;after&nbsp;recent&nbsp;tweaks&nbsp;I&amp;#39;ve&nbsp;added&nbsp;to&nbsp;Mono&nbsp;but&nbsp;it&nbsp;won&amp;#39;t&nbsp;so&nbsp;good&nbsp;as&nbsp;with&nbsp;Altivec,&nbsp;mostly&nbsp;because&nbsp;x87&nbsp;instruction&nbsp;set&nbsp;is&nbsp;more&nbsp;stack-based&nbsp;so&nbsp;floating-point&nbsp;code&nbsp;doesn&amp;#39;t&nbsp;get&nbsp;optimized&nbsp;as&nbsp;simply&nbsp;as&nbsp;on&nbsp;PowerPC.&nbsp;Anyway,&nbsp;let&amp;#39;s&nbsp;wait until tomorrow&amp;#39;s&nbsp;results...&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&amp;#39;s&nbsp;all,&nbsp;folks!&nbsp;(c)&lt;/div&gt;&lt;div&gt;-- &lt;/div&gt;&lt;div&gt;Regards,&lt;br&gt;Sergei&nbsp;Dyshel&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
