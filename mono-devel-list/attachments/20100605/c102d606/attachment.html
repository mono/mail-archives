<tt>
Your&amp;#39;re&nbsp;getting&nbsp;this&nbsp;because&nbsp;the&nbsp;block&nbsp;map&nbsp;patch&nbsp;isn&amp;#39;t&nbsp;64&nbsp;bits&nbsp;ready.&nbsp;Next&nbsp;time&nbsp;I&amp;#39;ll&nbsp;#error&lt;div&gt;on&nbsp;64bits&nbsp;to&nbsp;avoid&nbsp;such&nbsp;hassle.&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Next&nbsp;week&nbsp;is&nbsp;HackWeek&nbsp;and&nbsp;I&amp;#39;ll&nbsp;be&nbsp;diverted&nbsp;from&nbsp;sgen&nbsp;work,&nbsp;so&nbsp;I&amp;#39;ll&nbsp;resume&nbsp;on&nbsp;the&nbsp;14th&lt;/div&gt;<br>
&lt;div&gt;doing&nbsp;the following&nbsp;improvements:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Make&nbsp;it&nbsp;work&nbsp;on&nbsp;64bits,&nbsp;which&nbsp;means&nbsp;fixing&nbsp;this&nbsp;silly&nbsp;recursion&nbsp;bug&nbsp;and&nbsp;work&nbsp;on&nbsp;the&lt;/div&gt;&lt;div&gt;level0&nbsp;hash&nbsp;table.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Move&nbsp;all&nbsp;of&nbsp;it&nbsp;to&nbsp;sgen-blockmap.c.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Embed&nbsp;the&nbsp;memory&nbsp;region&nbsp;type&nbsp;on&nbsp;the&nbsp;region&nbsp;pointer&nbsp;itself&nbsp;to&nbsp;see&nbsp;how&nbsp;code&nbsp;ends&nbsp;up&nbsp;looking&nbsp;like.&lt;/div&gt;&lt;div&gt;This&nbsp;saves&nbsp;a&nbsp;load&nbsp;from&nbsp;possibly&nbsp;cold&nbsp;memory,&nbsp;reduces&nbsp;region&nbsp;header&nbsp;size&nbsp;and&nbsp;remove&nbsp;a&nbsp;ton&nbsp;of&lt;/div&gt;<br>
&lt;div&gt;noise&nbsp;from&nbsp;the&nbsp;LOS&nbsp;patch.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Rodrigo&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Jun&nbsp;5,&nbsp;2010&nbsp;at&nbsp;8:09&nbsp;AM,&nbsp;Mark&nbsp;Probst&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mark.probst@gmail.com&quot;&gt;mark.probst@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;Hi&nbsp;Rodrigo,&lt;br&gt;<br>
&lt;br&gt;<br>
With&nbsp;the&nbsp;first&nbsp;two&nbsp;patches&nbsp;applied&nbsp;I&nbsp;get&nbsp;an&nbsp;endless&nbsp;recursion:&lt;br&gt;<br>
&lt;br&gt;<br>
...&lt;br&gt;<br>
#148&nbsp;0x000000000052350c&nbsp;in&nbsp;get_internal_mem&nbsp;(size=8192,&nbsp;type=&amp;lt;value&lt;br&gt;<br>
optimized&nbsp;out&amp;gt;)&nbsp;at&nbsp;sgen-gc.c:3926&lt;br&gt;<br>
#149&nbsp;0x00000000005235a4&nbsp;in&nbsp;block_map_register_block&lt;br&gt;<br>
(block=0x7fff9ad60000,&nbsp;start=&amp;lt;value&nbsp;optimized&nbsp;out&amp;gt;,&nbsp;end=3)&lt;br&gt;<br>
&nbsp; &nbsp; at&nbsp;sgen-gc.c:1121&lt;br&gt;<br>
#150&nbsp;0x000000000052350c&nbsp;in&nbsp;get_internal_mem&nbsp;(size=8192,&nbsp;type=&amp;lt;value&lt;br&gt;<br>
optimized&nbsp;out&amp;gt;)&nbsp;at&nbsp;sgen-gc.c:3926&lt;br&gt;<br>
#151&nbsp;0x00000000005235a4&nbsp;in&nbsp;block_map_register_block&lt;br&gt;<br>
(block=0x7fff9ada0000,&nbsp;start=&amp;lt;value&nbsp;optimized&nbsp;out&amp;gt;,&nbsp;end=3)&lt;br&gt;<br>
&nbsp; &nbsp; at&nbsp;sgen-gc.c:1121&lt;br&gt;<br>
#152&nbsp;0x000000000052350c&nbsp;in&nbsp;get_internal_mem&nbsp;(size=8192,&nbsp;type=&amp;lt;value&lt;br&gt;<br>
optimized&nbsp;out&amp;gt;)&nbsp;at&nbsp;sgen-gc.c:3926&lt;br&gt;<br>
#153&nbsp;0x00000000005235a4&nbsp;in&nbsp;block_map_register_block&lt;br&gt;<br>
(block=0x7fff9ade0000,&nbsp;start=&amp;lt;value&nbsp;optimized&nbsp;out&amp;gt;,&nbsp;end=3)&lt;br&gt;<br>
&nbsp; &nbsp; at&nbsp;sgen-gc.c:1121&lt;br&gt;<br>
#154&nbsp;0x000000000052350c&nbsp;in&nbsp;get_internal_mem&nbsp;(size=8192,&nbsp;type=&amp;lt;value&lt;br&gt;<br>
optimized&nbsp;out&amp;gt;)&nbsp;at&nbsp;sgen-gc.c:3926&lt;br&gt;<br>
#155&nbsp;0x00000000005235a4&nbsp;in&nbsp;block_map_register_block&lt;br&gt;<br>
(block=0x7fff9ae20000,&nbsp;start=&amp;lt;value&nbsp;optimized&nbsp;out&amp;gt;,&nbsp;end=3)&lt;br&gt;<br>
&nbsp; &nbsp; at&nbsp;sgen-gc.c:1121&lt;br&gt;<br>
#156&nbsp;0x000000000052350c&nbsp;in&nbsp;get_internal_mem&nbsp;(size=8192,&nbsp;type=&amp;lt;value&lt;br&gt;<br>
optimized&nbsp;out&amp;gt;)&nbsp;at&nbsp;sgen-gc.c:3926&lt;br&gt;<br>
#157&nbsp;0x00000000005235a4&nbsp;in&nbsp;block_map_register_block&lt;br&gt;<br>
(block=0x7fff9ae60000,&nbsp;start=&amp;lt;value&nbsp;optimized&nbsp;out&amp;gt;,&nbsp;end=3)&lt;br&gt;<br>
&nbsp; &nbsp; at&nbsp;sgen-gc.c:1121&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;ve&nbsp;attached&nbsp;the&nbsp;first&nbsp;two&nbsp;patches&nbsp;adapted&nbsp;to&nbsp;the&nbsp;new&nbsp;LOS&nbsp;code.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;would&nbsp;be&nbsp;nice&nbsp;if&nbsp;all&nbsp;the&nbsp;block&nbsp;map&nbsp;code&nbsp;was&nbsp;in&nbsp;a&nbsp;separate&nbsp;file&lt;br&gt;<br>
(sgen-blockmap.c).&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Mark&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
