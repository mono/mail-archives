<tt>
Hello,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Attached&nbsp;is&nbsp;a&nbsp;patch&nbsp;to&nbsp;fix&nbsp;remoting&nbsp;involving&nbsp;COM&nbsp;Interop&nbsp;types.&nbsp;I&nbsp;had&nbsp;previsouly&nbsp;broken&nbsp;this&nbsp;unintentionally.&nbsp;COM&nbsp;Interop&nbsp;uses&nbsp;transparent&nbsp;proxies,&nbsp;and&nbsp;there&nbsp;was&nbsp;lots&nbsp;of&nbsp;places&nbsp;that&nbsp;didn&amp;#39;t&nbsp;distinguish&nbsp;between&nbsp;a&nbsp;remoting&nbsp;transparent&nbsp;proxy&nbsp;and&nbsp;a&nbsp;COM&nbsp;Interop&nbsp;transparent&nbsp;proxy.&nbsp;To&nbsp;distinguish&nbsp;I&nbsp;check&nbsp;to&nbsp;see&nbsp;if&nbsp;the&nbsp;real&nbsp;proxy&nbsp;associated&nbsp;with&nbsp;the&nbsp;transparent&nbsp;proxy&nbsp;is&nbsp;a&nbsp;COM&nbsp;Interop&nbsp;proxy.&nbsp;<br>
&lt;br&gt;&lt;br&gt;The&nbsp;main&nbsp;cases&nbsp;I&nbsp;needed&nbsp;to&nbsp;handle&nbsp;was&nbsp;the&nbsp;casting&nbsp;of&nbsp;transparent&nbsp;proxy&nbsp;objects,&nbsp;method&nbsp;calls,&nbsp;and&nbsp;field&nbsp;access.&nbsp;For&nbsp;the&nbsp;casting&nbsp;of&nbsp;transparent&nbsp;proxies,&nbsp;I&nbsp;added&nbsp;a&nbsp;new&nbsp;field&nbsp;to&nbsp;the&nbsp;MonoRemoteClass&nbsp;for&nbsp;the&nbsp;COM&nbsp;Interop&nbsp;vtable.&nbsp;I&nbsp;was&nbsp;previously&nbsp;overwriting&nbsp;the&nbsp;default_vtable.&nbsp;For&nbsp;method&nbsp;calls,&nbsp;and&nbsp;probably&nbsp;the&nbsp;most&nbsp;important&nbsp;thing&nbsp;to&nbsp;notice,&nbsp;is&nbsp;that&nbsp;I&nbsp;added&nbsp;another&nbsp;check&nbsp;to<br>
mono_marshal_get_remoting_invoke_with_check&nbsp;to&nbsp;see&nbsp;if&nbsp;a&nbsp;transparent<br>
proxy&nbsp;is&nbsp;used&nbsp;for&nbsp;COM&nbsp;Interop.&nbsp;This&nbsp;does&nbsp;add&nbsp;some&nbsp;overhead&nbsp;to&nbsp;remoting;<br>
the&nbsp;overhead&nbsp;should&nbsp;always&nbsp;be&nbsp;emitting&nbsp;a&nbsp;method&nbsp;that&nbsp;simply&nbsp;loads&nbsp;all<br>
the&nbsp;arguments&nbsp;and&nbsp;calls&nbsp;the&nbsp;wrapped&nbsp;method&nbsp;on&nbsp;the&nbsp;underlying&nbsp;managed<br>
object&nbsp;the&nbsp;proxy&nbsp;wraps.&nbsp;No&nbsp;real&nbsp;COM&nbsp;Interop&nbsp;code&nbsp;or&nbsp;marshalling&nbsp;code<br>
should&nbsp;unless&nbsp;the&nbsp;type&nbsp;has&nbsp;a&nbsp;ComImport&nbsp;attribute.&nbsp;Unless&nbsp;COM&nbsp;is&nbsp;used<br>
the&nbsp;method&nbsp;should&nbsp;never&nbsp;be&nbsp;called,&nbsp;only&nbsp;emitted.&lt;br&gt;&lt;br&gt;The&nbsp;field&nbsp;access&nbsp;was&nbsp;done&nbsp;via&nbsp;checks&nbsp;in&nbsp;mono_load_remote_field,&nbsp;mono_load_remote_field_new,&nbsp;mono_store_remote_field,&nbsp;and&nbsp;mono_store_remote_field_new.&nbsp;This&nbsp;avoids&nbsp;emitting&nbsp;any&nbsp;additional&nbsp;checks&nbsp;or&nbsp;methods&nbsp;for&nbsp;remoting&nbsp;wrappers.<br>
&lt;br&gt;&lt;br&gt;Please&nbsp;make&nbsp;any&nbsp;suggestions&nbsp;if&nbsp;my&nbsp;changes&nbsp;could&nbsp;be&nbsp;done&nbsp;in&nbsp;a<br>
better&nbsp;way;&nbsp;especially&nbsp;if&nbsp;my&nbsp;changes&nbsp;related&nbsp;to&nbsp;methods&nbsp;should&nbsp;be&nbsp;more<br>
like&nbsp;the&nbsp;ones&nbsp;for&nbsp;fields,&nbsp;or&nbsp;vice&nbsp;versa.&lt;br&gt;&lt;br&gt;This&nbsp;patch&nbsp;allows&nbsp;anyone&nbsp;one&nbsp;using&nbsp;COM&nbsp;Interop&nbsp;to&nbsp;remote&nbsp;those&nbsp;objects.&nbsp;This&nbsp;obviously&nbsp;would&nbsp;be&nbsp;much&nbsp;more&nbsp;likely&nbsp;to&nbsp;occur&nbsp;on&nbsp;windows,&nbsp;but&nbsp;an&nbsp;example&nbsp;use&nbsp;of&nbsp;this&nbsp;on&nbsp;other&nbsp;platforms&nbsp;would&nbsp;be&nbsp;accessing&nbsp;the&nbsp;Mozilla&nbsp;DOM&nbsp;cross&nbsp;process&nbsp;in&nbsp;the&nbsp;<br>
ASP.Net&nbsp;designer.&lt;br&gt;&lt;br&gt;Code&nbsp;is&nbsp;contributed&nbsp;under&nbsp;MIT/X11&nbsp;license.<br>
&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Jonathan&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
