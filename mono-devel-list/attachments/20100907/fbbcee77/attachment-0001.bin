using System;
using System.IO;
using System.Net;

namespace ConsoleApplication1 {
	class Class1 {
		static void Main ()
		{
			HttpListener l = new HttpListener ();
			l.Prefixes.Add ("https://*:9667/");
			l.Start ();
			l.BeginGetContext (OnGetContext, l);
			Console.ReadLine ();
		}

		static void OnGetContext (IAsyncResult ares)
		{
			HttpListener l = ares.AsyncState as HttpListener;
			if (l == null)
				return;

			try {
				HttpListenerContext ctx = l.EndGetContext (ares);
				Console.WriteLine ("Got request");
				l.BeginGetContext (OnGetContext, l);
				using (StreamWriter writer = new StreamWriter (ctx.Response.OutputStream)) 
					writer.Write ("Hello world!");
				ctx.Response.Close ();
				Console.WriteLine ("Sent request");
			} catch (Exception e) {
				Console.WriteLine (e);
				Environment.Exit (1);
			}
		}
	}
}

