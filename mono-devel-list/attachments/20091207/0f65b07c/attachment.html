<tt>
Just&nbsp;to&nbsp;add,&nbsp;while&nbsp;MonoTorrent&nbsp;doesn&amp;#39;t&nbsp;use&nbsp;it&amp;#39;s&nbsp;on&nbsp;threadpool,&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;hog&nbsp;ThreadPool&nbsp;threads&nbsp;by&nbsp;blocking&nbsp;inside&nbsp;the&nbsp;async&nbsp;callbacks.&nbsp;As&nbsp;soon&nbsp;as&nbsp;a&nbsp;message&nbsp;is&nbsp;received&nbsp;and&nbsp;my&nbsp;callback&nbsp;is&nbsp;invoked,&nbsp;I&nbsp;queue&nbsp;the&nbsp;message&nbsp;to&nbsp;be&nbsp;processed&nbsp;and&nbsp;allow&nbsp;thread&nbsp;to&nbsp;return&nbsp;to&nbsp;the&nbsp;ThreadPool.&nbsp;As&nbsp;such,&nbsp;even&nbsp;with&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;actively&nbsp;transferring&nbsp;connections&nbsp;(&amp;gt;&nbsp;50)&nbsp;I&nbsp;only&nbsp;need&nbsp;a&nbsp;handful&nbsp;of&nbsp;threadpool&nbsp;threads.&nbsp;If&nbsp;you&nbsp;starve&nbsp;the&nbsp;threadpool,&nbsp;your&nbsp;performance&nbsp;will&nbsp;suffer&nbsp;accordingly&nbsp;;)&lt;br&gt;<br>
&lt;br&gt;Alan.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;7,&nbsp;2009&nbsp;at&nbsp;8:17&nbsp;PM,&nbsp;Alan&nbsp;McGovern&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:alan.mcgovern@gmail.com&quot;&gt;alan.mcgovern@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hey,&lt;br&gt;&lt;br&gt;MonoTorrent&nbsp;uses&nbsp;the&nbsp;standard&nbsp;.NET&nbsp;threadpool&nbsp;for&nbsp;all&nbsp;asynchronous&nbsp;sockets.&nbsp;It&amp;#39;s&nbsp;all&nbsp;standard&nbsp;Socket.BeginReceive/Socket.EndReceive&nbsp;calls.&nbsp;I&amp;#39;ve&nbsp;run&nbsp;it&nbsp;with&nbsp;~150&nbsp;open&nbsp;connections&nbsp;in&nbsp;the&nbsp;past&nbsp;with&nbsp;no&nbsp;issues,&nbsp;though&nbsp;it&amp;#39;s&nbsp;worth&nbsp;noting&nbsp;that&nbsp;150&nbsp;open&nbsp;connections&nbsp;!=&nbsp;150&nbsp;actively&nbsp;transferring&nbsp;connections.&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;If&nbsp;you&amp;#39;re&nbsp;seeing&nbsp;issues&nbsp;with&nbsp;running&nbsp;out&nbsp;of&nbsp;threads&nbsp;and&nbsp;connections&nbsp;being&nbsp;dropped&nbsp;as&nbsp;a&nbsp;result,&nbsp;just&nbsp;export&nbsp;MONO_THREADS_PER_CPU=100&nbsp;to&nbsp;increase&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;allowed&nbsp;threads&nbsp;and&nbsp;see&nbsp;if&nbsp;that&nbsp;helps.&nbsp;Feel&nbsp;free&nbsp;to&nbsp;vary&nbsp;the&nbsp;number&nbsp;up&nbsp;or&nbsp;down&nbsp;as&nbsp;appropriate.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;Alan.&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;7,&nbsp;2009&nbsp;at&nbsp;5:12&nbsp;PM,&nbsp;Rafael&nbsp;Teixeira&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:monoman@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;monoman@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
You&nbsp;could&nbsp;look&nbsp;at&nbsp;the&nbsp;source&nbsp;of&nbsp;MonoTorrent,&nbsp;and&nbsp;also&nbsp;of&nbsp;XSP&nbsp;that&nbsp;does&lt;br&gt;<br>
use&nbsp;a&nbsp;separate&nbsp;ThreadPool&nbsp;AFAIR.&lt;br&gt;<br>
&lt;br&gt;<br>
Rafael&nbsp;&amp;quot;Monoman&amp;quot;&nbsp;Teixeira&lt;br&gt;<br>
---------------------------------------&lt;br&gt;<br>
&amp;quot;To&nbsp;be&nbsp;creative&nbsp;means&nbsp;to&nbsp;be&nbsp;in&nbsp;love&nbsp;with&nbsp;life.&nbsp;You&nbsp;can&nbsp;be&nbsp;creative&lt;br&gt;<br>
only&nbsp;if&nbsp;you&nbsp;love&nbsp;life&nbsp;enough&nbsp;that&nbsp;you&nbsp;want&nbsp;to&nbsp;enhance&nbsp;its&nbsp;beauty,&nbsp;you&lt;br&gt;<br>
want&nbsp;to&nbsp;bring&nbsp;a&nbsp;little&nbsp;more&nbsp;music&nbsp;to&nbsp;it,&nbsp;a&nbsp;little&nbsp;more&nbsp;poetry&nbsp;to&nbsp;it,&nbsp;a&lt;br&gt;<br>
little&nbsp;more&nbsp;dance&nbsp;to&nbsp;it.&amp;quot;&lt;br&gt;<br>
Osho&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Sun,&nbsp;Dec&nbsp;6,&nbsp;2009&nbsp;at&nbsp;11:21&nbsp;PM,&nbsp;Laser&nbsp;Lu&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:laser_lu@163.com&quot;&nbsp;target=&quot;_blank&quot;&gt;laser_lu@163.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;Thanks&nbsp;for&nbsp;your&nbsp;reply&nbsp;;-)&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I’m&nbsp;now&nbsp;using&nbsp;the&nbsp;latest&nbsp;version&nbsp;2.4.2.3.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;This&nbsp;is&nbsp;the&nbsp;program&nbsp;I’m&nbsp;developing:&nbsp;&lt;a&nbsp;href=&quot;http://linktalk.net&quot;&nbsp;target=&quot;_blank&quot;&gt;http://linktalk.net&lt;/a&gt;.&nbsp;In&nbsp;this&nbsp;program,&lt;br&gt;<br>
&amp;gt;&nbsp;IHttpAsyncHandler,&nbsp;ThreadPool,&nbsp;and&nbsp;TCP&nbsp;Sockets&nbsp;are&nbsp;heavily&nbsp;used.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;tried&nbsp;to&nbsp;host&nbsp;my&nbsp;program&nbsp;under&nbsp;Apache/XSP,&nbsp;but&nbsp;it&nbsp;had&nbsp;a&nbsp;really&nbsp;poor&lt;br&gt;<br>
&amp;gt;&nbsp;performance.&nbsp;So,&nbsp;I&nbsp;tried&nbsp;the&nbsp;HttpListener&nbsp;class,&nbsp;but&nbsp;still&nbsp;not&nbsp;good,&nbsp;and&nbsp;had&lt;br&gt;<br>
&amp;gt;&nbsp;lots&nbsp;of&nbsp;SocketExceptions&nbsp;thrown&nbsp;compared&nbsp;to&nbsp;the&nbsp;Windows&nbsp;counterpart.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Lastly,&nbsp;I&nbsp;implemented&nbsp;a&nbsp;simple&nbsp;web&nbsp;server&nbsp;by&nbsp;myself,&nbsp;using&nbsp;Socket&nbsp;listening&lt;br&gt;<br>
&amp;gt;&nbsp;and&nbsp;parsing&nbsp;directly.&nbsp;It&nbsp;works&nbsp;better,&nbsp;however,&nbsp;async&nbsp;requests&nbsp;usually&lt;br&gt;<br>
&amp;gt;&nbsp;become&nbsp;unresponsive.&nbsp;It&nbsp;seems&nbsp;the&nbsp;ThreadPool&nbsp;is&nbsp;not&nbsp;as&nbsp;good&nbsp;as&nbsp;the&nbsp;.NET&lt;br&gt;<br>
&amp;gt;&nbsp;implementation,&nbsp;or&nbsp;maybe&nbsp;there&nbsp;needs&nbsp;some&nbsp;special&nbsp;configuration&nbsp;I&nbsp;don’t&lt;br&gt;<br>
&amp;gt;&nbsp;know.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Under&nbsp;Windows/.NET&nbsp;the&nbsp;program&nbsp;can&nbsp;handle&nbsp;more&nbsp;than&nbsp;2000&nbsp;online&nbsp;IM&nbsp;users&lt;br&gt;<br>
&amp;gt;&nbsp;concurrently,&nbsp;but&nbsp;on&nbsp;Linux/Mono&nbsp;less&nbsp;than&nbsp;100&nbsp;conrrent&nbsp;users,&nbsp;and&nbsp;usually&lt;br&gt;<br>
&amp;gt;&nbsp;become&nbsp;unresponsive…&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;________________________________&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;From:&nbsp;Miguel&nbsp;de&nbsp;Icaza&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:miguel@novell.com&quot;&nbsp;target=&quot;_blank&quot;&gt;miguel@novell.com&lt;/a&gt;]&lt;br&gt;<br>
&amp;gt;&nbsp;Sent:&nbsp;Monday,&nbsp;December&nbsp;07,&nbsp;2009&nbsp;9:03&nbsp;AM&lt;br&gt;<br>
&amp;gt;&nbsp;To:&nbsp;Laser&nbsp;Lu&lt;br&gt;<br>
&amp;gt;&nbsp;Cc:&nbsp;&lt;a&nbsp;href=&quot;mailto:mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Subject:&nbsp;Re:&nbsp;[Mono-dev]&nbsp;Why&nbsp;not&nbsp;build&nbsp;official&nbsp;site&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://ASP.NET&quot;&nbsp;target=&quot;_blank&quot;&gt;ASP.NET&lt;/a&gt;?&nbsp;Mono&nbsp;should&lt;br&gt;<br>
&amp;gt;&nbsp;enhance&nbsp;server&nbsp;performance&nbsp;and&nbsp;stability!&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Hello,&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;  &nbsp; &nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;we&nbsp;would&nbsp;have&nbsp;to&nbsp;migrate&nbsp;the&nbsp;contents.&nbsp; &nbsp;We&nbsp;tried&lt;br&gt;<br>
&amp;gt;&nbsp;once&nbsp;to&nbsp;move&nbsp;to&nbsp;MindTouch&amp;#39;s&nbsp;Deki,&nbsp;but&nbsp;we&nbsp;lost&nbsp;too&nbsp;much&nbsp;in&nbsp;the&nbsp;translation&lt;br&gt;<br>
&amp;gt;&nbsp;and&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;problems&nbsp;with&nbsp;the&nbsp;translation&nbsp;so&nbsp;we&nbsp;abandoned&nbsp;that&lt;br&gt;<br>
&amp;gt;&nbsp;plan.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;  &nbsp; &nbsp;We&nbsp;are&nbsp;doing&nbsp;the&nbsp;new&nbsp;web&nbsp;sites&nbsp;using&nbsp;Mono&nbsp;though,&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://monodevelop.com&quot;&nbsp;target=&quot;_blank&quot;&gt;http://monodevelop.com&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;http://wiki.monotouch.net&quot;&nbsp;target=&quot;_blank&quot;&gt;http://wiki.monotouch.net&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;http://monotouch.net&quot;&nbsp;target=&quot;_blank&quot;&gt;http://monotouch.net&lt;/a&gt;,&nbsp;and&lt;br&gt;<br>
<br>
<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://forums.monotouch.net&quot;&nbsp;target=&quot;_blank&quot;&gt;http://forums.monotouch.net&lt;/a&gt;&nbsp;are&nbsp;all&nbsp;running&nbsp;with&nbsp;Mono&nbsp;powered&nbsp;software.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;  &nbsp; &nbsp;As&nbsp;for&nbsp;stability&nbsp;and&nbsp;performance,&nbsp;which&nbsp;version&nbsp;of&nbsp;Mono&nbsp;are&nbsp;you&lt;br&gt;<br>
&amp;gt;&nbsp;running?&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;was&nbsp;just&nbsp;wondering,&nbsp;why&nbsp;the&nbsp;mono&nbsp;official&nbsp;site&nbsp;was&nbsp;not&nbsp;built&lt;br&gt;<br>
&amp;gt;&nbsp;on &lt;a&nbsp;href=&quot;http://ASP.NET/C#&quot;&nbsp;target=&quot;_blank&quot;&gt;ASP.NET/C#&lt;/a&gt;? That&nbsp;would&nbsp;be&nbsp;a&nbsp;good&nbsp;demonstration.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Currently,&nbsp;I’m&nbsp;developing&nbsp;a&nbsp;Web&nbsp;IM&nbsp;program,&nbsp;and&nbsp;it&nbsp;works&nbsp;fine&nbsp;on&lt;br&gt;<br>
&amp;gt;&nbsp;Windows/.NET.&nbsp;However,&nbsp;the&nbsp;same&nbsp;code&nbsp;had&nbsp;a&nbsp;poor&nbsp;performance&nbsp;on&nbsp;Linux/Mono,&lt;br&gt;<br>
&amp;gt;&nbsp;and&nbsp;seems&nbsp;very&nbsp;unstable.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;So&nbsp;I&nbsp;doubt&nbsp;whether&nbsp;Mono&nbsp;is&nbsp;suitable&nbsp;for&nbsp;developing&nbsp;server&nbsp;programs&nbsp;which&lt;br&gt;<br>
&amp;gt;&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;handle&nbsp;a&nbsp;huge&nbsp;amount&nbsp;of&nbsp;concurrent&nbsp;requests.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;wish&nbsp;the&nbsp;Mono&nbsp;team&nbsp;would&nbsp;pay&nbsp;much&nbsp;more&nbsp;attentions&nbsp;to&nbsp;server&nbsp;applications,&lt;br&gt;<br>
&amp;gt;&nbsp;and&nbsp;enhance&nbsp;the&nbsp;server&nbsp;stability&nbsp;or&nbsp;just&nbsp;concentrate&nbsp;on&nbsp;server&nbsp;applications,&lt;br&gt;<br>
&amp;gt;&nbsp;not&nbsp;just&nbsp;catching&nbsp;up&nbsp;with&nbsp;Microsoft’s&nbsp;new&nbsp;cool&nbsp;features.&nbsp;Because&nbsp;Linux/Unix&lt;br&gt;<br>
&amp;gt;&nbsp;is&nbsp;used&nbsp;as&nbsp;server&nbsp;under&nbsp;90%&nbsp;circumstances,&nbsp;performance&nbsp;and&nbsp;stability&nbsp;is&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;most&nbsp;import&nbsp;thing!&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&amp;gt;&nbsp;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&amp;gt;&nbsp;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
