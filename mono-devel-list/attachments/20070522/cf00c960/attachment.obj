Index: mono/mono/metadata/appdomain.c
===================================================================
--- mono/mono/metadata/appdomain.c	(revision 77822)
+++ mono/mono/metadata/appdomain.c	(working copy)
@@ -12,7 +12,9 @@
 #include <config.h>
 #include <glib.h>
 #include <string.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <errno.h>
 #include <sys/stat.h>
 #include <sys/types.h>
Index: mono/mono/metadata/image.c
===================================================================
--- mono/mono/metadata/image.c	(revision 77822)
+++ mono/mono/metadata/image.c	(working copy)
@@ -28,7 +28,9 @@
 #include <mono/utils/mono-path.h>
 #include <sys/types.h>
 #include <sys/stat.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #define INVALID_ADDRESS 0xffffffff
 
Index: mono/mono/metadata/file-io.c
===================================================================
--- mono/mono/metadata/file-io.c	(revision 77822)
+++ mono/mono/metadata/file-io.c	(working copy)
@@ -14,7 +14,9 @@
 #include <string.h>
 #include <errno.h>
 #include <signal.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #ifdef HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
Index: mono/mono/metadata/debug-mono-symfile.c
===================================================================
--- mono/mono/metadata/debug-mono-symfile.c	(revision 77822)
+++ mono/mono/metadata/debug-mono-symfile.c	(working copy)
@@ -4,7 +4,9 @@
 #include <errno.h>
 #include <string.h>
 #include <signal.h>
+#ifdef HAVE_SYS_PARAM_H
 #include <sys/param.h>
+#endif
 #include <sys/stat.h>
 #include <mono/metadata/metadata.h>
 #include <mono/metadata/tabledefs.h>
@@ -21,7 +23,9 @@
 #include <mono/metadata/class-internals.h>
 
 #include <fcntl.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #define RANGE_TABLE_CHUNK_SIZE		256
 #define CLASS_TABLE_CHUNK_SIZE		256
Index: mono/mono/metadata/ChangeLog
===================================================================
--- mono/mono/metadata/ChangeLog	(revision 77822)
+++ mono/mono/metadata/ChangeLog	(working copy)
@@ -1,3 +1,19 @@
+2007-05-23  Jonathan Chambers  <joncham@gmail.com>
+
+	* appdomain.c: Add configure checks for header files.
+	* image.c: Add configure checks for header files.
+	* file-io.c: Add configure checks for header files.
+	* debug-mono-symfile.c: Add configure checks for header files.
+	* threadpool.c: Add configure checks for header files.
+	* console-io.c: Add configure checks for header files.
+	* profiler.c: Add configure checks for header files.
+	* rawbuffer.c: Add configure checks for header files.
+	* icall.c: Add configure checks for header files.
+	* rand.c: Add configure checks for header files.
+	* socket-io.c: Add configure checks for header files.
+	
+	Code is contributed under MIT/X11 license.
+
 2007-05-22  Zoltan Varga  <vargaz@gmail.com>
 
 	* reflection.c (encode_cattr_value): Fix yet another object cattr encoding issue.
Index: mono/mono/metadata/threadpool.c
===================================================================
--- mono/mono/metadata/threadpool.c	(revision 77822)
+++ mono/mono/metadata/threadpool.c	(working copy)
@@ -33,10 +33,14 @@
 #include <mono/io-layer/io-layer.h>
 #include <mono/os/gc_wrapper.h>
 #include <errno.h>
+#ifdef HAVE_SYS_TIME_H
 #include <sys/time.h>
+#endif
 #include <sys/types.h>
 #include <fcntl.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <string.h>
 
 #include <mono/utils/mono-poll.h>
Index: mono/mono/metadata/console-io.c
===================================================================
--- mono/mono/metadata/console-io.c	(revision 77822)
+++ mono/mono/metadata/console-io.c	(working copy)
@@ -13,9 +13,13 @@
 #include <string.h>
 #include <errno.h>
 #include <signal.h>
+#ifdef HAVE_SYS_TIME_H
 #include <sys/time.h>
+#endif
 #include <sys/types.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <mono/metadata/appdomain.h>
 #include <mono/metadata/object-internals.h>
 #include <mono/metadata/class-internals.h>
Index: mono/mono/metadata/profiler.c
===================================================================
--- mono/mono/metadata/profiler.c	(revision 77822)
+++ mono/mono/metadata/profiler.c	(working copy)
@@ -20,8 +20,12 @@
 #include "mono/io-layer/io-layer.h"
 #include "mono/utils/mono-dl.h"
 #include <string.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
+#ifdef HAVE_SYS_TIME_H
 #include <sys/time.h>
+#endif
 #ifdef HAVE_BACKTRACE_SYMBOLS
 #include <execinfo.h>
 #endif
Index: mono/mono/metadata/rawbuffer.c
===================================================================
--- mono/mono/metadata/rawbuffer.c	(revision 77822)
+++ mono/mono/metadata/rawbuffer.c	(working copy)
@@ -11,7 +11,9 @@
 #define USE_WIN32_API		1
 #endif
 
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <errno.h>
 #ifdef USE_WIN32_API
 #include <winsock2.h>
Index: mono/mono/metadata/icall.c
===================================================================
--- mono/mono/metadata/icall.c	(revision 77822)
+++ mono/mono/metadata/icall.c	(working copy)
@@ -14,8 +14,12 @@
 #include <stdarg.h>
 #include <string.h>
 #include <ctype.h>
+#ifdef HAVE_SYS_TIME_H
 #include <sys/time.h>
+#endif
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #if defined (PLATFORM_WIN32)
 #include <stdlib.h>
 #endif
Index: mono/mono/metadata/rand.c
===================================================================
--- mono/mono/metadata/rand.c	(revision 77822)
+++ mono/mono/metadata/rand.c	(working copy)
@@ -15,7 +15,9 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #include <mono/metadata/object.h>
 #include <mono/metadata/rand.h>
Index: mono/mono/metadata/socket-io.c
===================================================================
--- mono/mono/metadata/socket-io.c	(revision 77822)
+++ mono/mono/metadata/socket-io.c	(working copy)
@@ -14,7 +14,9 @@
 #include <glib.h>
 #include <string.h>
 #include <stdlib.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <mono/metadata/object.h>
@@ -31,7 +33,9 @@
 #include <mono/metadata/threadpool-internals.h>
 #include <mono/metadata/domain-internals.h>
 
-#include <sys/time.h> 
+#ifdef HAVE_SYS_TIME_H
+#include <sys/time.h>
+#endif
 #ifdef HAVE_SYS_IOCTL_H
 #include <sys/ioctl.h>
 #endif
Index: mono/mono/mini/mini.c
===================================================================
--- mono/mono/mini/mini.c	(revision 77822)
+++ mono/mono/mini/mini.c	(working copy)
@@ -10,9 +10,13 @@
 
 #include <config.h>
 #include <signal.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <math.h>
+#ifdef HAVE_SYS_TIME_H
 #include <sys/time.h>
+#endif
 
 #ifdef PLATFORM_MACOSX
 #include <mach/mach.h>
Index: mono/mono/mini/ChangeLog
===================================================================
--- mono/mono/mini/ChangeLog	(revision 77822)
+++ mono/mono/mini/ChangeLog	(working copy)
@@ -1,3 +1,15 @@
+2007-05-23  Jonathan Chambers  <joncham@gmail.com>
+
+	* mini.c: Add configure checks for header files.
+	* mini-x86.c: Add configure checks for header files.
+	* trace.c: Add configure checks for header files.
+	* aot-runtime.c: Add configure checks for header files.
+	* aot-compiler.c: Add configure checks for header files.
+	* driver.c: Add configure checks for header files.
+	* mini-codegen.c: Add configure checks for header files.
+	
+	Code is contributed under MIT/X11 license.
+
 2007-05-22  Zoltan Varga  <vargaz@gmail.com>
 
 	* mini-ia64.c (mono_arch_lowering_pass): Fix the handling of
Index: mono/mono/mini/mini-x86.c
===================================================================
--- mono/mono/mini/mini-x86.c	(revision 77822)
+++ mono/mono/mini/mini-x86.c	(working copy)
@@ -11,7 +11,9 @@
 #include "mini.h"
 #include <string.h>
 #include <math.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #include <mono/metadata/appdomain.h>
 #include <mono/metadata/debug-helpers.h>
Index: mono/mono/mini/trace.c
===================================================================
--- mono/mono/mini/trace.c	(revision 77822)
+++ mono/mono/mini/trace.c	(working copy)
@@ -10,7 +10,9 @@
 
 #include <config.h>
 #include <signal.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <string.h>
 #include "mini.h"
 #include <mono/metadata/debug-helpers.h>
Index: mono/mono/mini/aot-runtime.c
===================================================================
--- mono/mono/mini/aot-runtime.c	(revision 77822)
+++ mono/mono/mini/aot-runtime.c	(working copy)
@@ -10,7 +10,9 @@
 
 #include "config.h"
 #include <sys/types.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <string.h>
 #ifndef PLATFORM_WIN32
Index: mono/mono/mini/aot-compiler.c
===================================================================
--- mono/mono/mini/aot-compiler.c	(revision 77822)
+++ mono/mono/mini/aot-compiler.c	(working copy)
@@ -10,7 +10,9 @@
 
 #include "config.h"
 #include <sys/types.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <string.h>
 #ifndef PLATFORM_WIN32
Index: mono/mono/mini/driver.c
===================================================================
--- mono/mono/mini/driver.c	(revision 77822)
+++ mono/mono/mini/driver.c	(working copy)
@@ -11,7 +11,9 @@
 
 #include <config.h>
 #include <signal.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #include <mono/metadata/assembly.h>
 #include <mono/metadata/loader.h>
Index: mono/mono/mini/mini-codegen.c
===================================================================
--- mono/mono/mini/mini-codegen.c	(revision 77822)
+++ mono/mono/mini/mini-codegen.c	(working copy)
@@ -6,7 +6,9 @@
 
 #include <string.h>
 #include <math.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #include <mono/metadata/appdomain.h>
 #include <mono/metadata/debug-helpers.h>
Index: mono/mono/utils/mono-path.c
===================================================================
--- mono/mono/utils/mono-path.c	(revision 77822)
+++ mono/mono/utils/mono-path.c	(working copy)
@@ -13,9 +13,13 @@
 #include <errno.h>
 #include <string.h>
 #include <stdlib.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 /* This is only needed for the mono_path_canonicalize code, MAXSYMLINKS, could be moved */
+#ifdef HAVE_SYS_PARAM_H
 #include <sys/param.h>
+#endif
 
 #include "mono-path.h"
 
Index: mono/mono/utils/ChangeLog
===================================================================
--- mono/mono/utils/ChangeLog	(revision 77822)
+++ mono/mono/utils/ChangeLog	(working copy)
@@ -1,3 +1,12 @@
+2007-05-23  Jonathan Chambers  <joncham@gmail.com>
+
+	* mono-path.c: Add configure checks for header files.
+	* mono-codeman.c: Add configure checks for header files.
+	* mono-poll.h: Add configure checks for header files.
+	* mono-stdlib.c: Add configure checks for header files.
+	
+	Code is contributed under MIT/X11 license.
+
 2007-03-09  Jonathan Chambers  <joncham@gmail.com>
 
 	* mono-dl.c:  Use Unicode characters for Win32 functions.
Index: mono/mono/utils/mono-codeman.c
===================================================================
--- mono/mono/utils/mono-codeman.c	(revision 77822)
+++ mono/mono/utils/mono-codeman.c	(working copy)
@@ -1,5 +1,8 @@
 #include "config.h"
+
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <stdlib.h>
 #include <string.h>
 #include <assert.h>
Index: mono/mono/utils/mono-poll.h
===================================================================
--- mono/mono/utils/mono-poll.h	(revision 77822)
+++ mono/mono/utils/mono-poll.h	(working copy)
@@ -2,9 +2,13 @@
 #define MONO_POLL_H
 
 #include <config.h>
+#ifdef HAVE_SYS_TIME_H
 #include <sys/time.h>
+#endif
 #include <sys/types.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #ifdef HAVE_POLL
 #include <sys/poll.h>
Index: mono/mono/utils/mono-stdlib.c
===================================================================
--- mono/mono/utils/mono-stdlib.c	(revision 77822)
+++ mono/mono/utils/mono-stdlib.c	(working copy)
@@ -14,7 +14,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include <fcntl.h>
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include "mono-stdlib.h"
 
 #ifndef HAVE_MKSTEMP
Index: mono/configure.in
===================================================================
--- mono/configure.in	(revision 77822)
+++ mono/configure.in	(working copy)
@@ -1403,6 +1403,12 @@
 		AC_CHECK_LIB(attr, lsetxattr, XATTR_LIB="-lattr",)
 	)
 	AC_SUBST(XATTR_LIB)
+	
+	dnl *********************************
+	dnl *** Checks for Windows compilation ***
+	dnl *********************************
+	AC_CHECK_HEADERS(sys/time.h)
+	AC_CHECK_HEADERS(sys/param.h)
 
 	dnl *********************************
 	dnl *** Check for Console 2.0 I/O ***