<tt>
Not&nbsp;a&nbsp;big&nbsp;fan&nbsp;of&nbsp;C,&nbsp;neither&nbsp;I&nbsp;do&nbsp;have&nbsp;a&nbsp;OS&nbsp;X&nbsp;machine&nbsp;to&nbsp;test&nbsp;but&nbsp;a&nbsp;simple&nbsp;grep&nbsp;-R&nbsp;&amp;quot;mach_port&amp;quot;&nbsp;.&nbsp;shows&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;deallocate.&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;6/12/06,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Allan&nbsp;Hsu<br>
&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:allan@counterpop.net&quot;&gt;allan@counterpop.net&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;On&nbsp;Jun&nbsp;8,&nbsp;2006,&nbsp;at&nbsp;7:56&nbsp;PM,&nbsp;Miguel&nbsp;de&nbsp;Icaza&nbsp;wrote:<br>
&lt;br&gt;&lt;br&gt;&amp;gt;&amp;gt;&nbsp;I'm&nbsp;having&nbsp;a&nbsp;hard&nbsp;time&nbsp;tracking&nbsp;down&nbsp;a&nbsp;mach&nbsp;port&nbsp;leak&nbsp;in&nbsp;imeem.&nbsp;Some&lt;br&gt;&amp;gt;&amp;gt;&nbsp;roundabout&nbsp;debugging&nbsp;leads&nbsp;me&nbsp;to&nbsp;believe&nbsp;it's&nbsp;somewhere&nbsp;in&nbsp;the&lt;br&gt;&amp;gt;&amp;gt;&nbsp;networking-related&nbsp;portions&nbsp;of&nbsp;either&nbsp;our&nbsp;managed&nbsp;code&nbsp;or&nbsp;the&nbsp;Mono<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;runtime.&nbsp;Has&nbsp;anybody&nbsp;else&nbsp;noticed&nbsp;their&nbsp;mach&nbsp;port&nbsp;counts&nbsp;rising&nbsp;over&lt;br&gt;&amp;gt;&amp;gt;&nbsp;time?&nbsp;If&nbsp;so,&nbsp;what&nbsp;does&nbsp;your&nbsp;application&nbsp;do?&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;A&nbsp;test&nbsp;case&nbsp;narrowing&nbsp;the&nbsp;problem&nbsp;would&nbsp;be&nbsp;the&nbsp;first&nbsp;step.&lt;br&gt;&lt;br&gt;I've&nbsp;done&nbsp;some&nbsp;more&nbsp;investigation&nbsp;and&nbsp;I've&nbsp;filed&nbsp;a&nbsp;new&nbsp;bug&nbsp;and&nbsp;marked<br>
&lt;br&gt;the&nbsp;old&nbsp;one&nbsp;as&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;new&nbsp;one:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://bugs.ximian.com/show_bug.cgi?id=78628&quot;&gt;http://bugs.ximian.com/show_bug.cgi?id=78628&lt;/a&gt;&lt;br&gt;&lt;br&gt;It&nbsp;looks&nbsp;like&nbsp;the&nbsp;problem&nbsp;has&nbsp;to&nbsp;do&nbsp;with&nbsp;garbage&nbsp;collection&nbsp;and<br>
&lt;br&gt;threading&nbsp;and&nbsp;it&nbsp;should&nbsp;effect&nbsp;just&nbsp;about&nbsp;anybody&nbsp;that&nbsp;uses&nbsp;threads&lt;br&gt;under&nbsp;Mono&nbsp;on&nbsp;OS&nbsp;X.&nbsp;I&nbsp;attached&nbsp;a&nbsp;rough&nbsp;GC&nbsp;patch&nbsp;to&nbsp;the&nbsp;bug&nbsp;that&lt;br&gt;halves&nbsp;the&nbsp;number&nbsp;of&nbsp;ports&nbsp;leaked&nbsp;in&nbsp;some&nbsp;situations,&nbsp;but&nbsp;does&nbsp;not&lt;br&gt;entirely&nbsp;fix&nbsp;the&nbsp;problem.&nbsp;The&nbsp;patch&nbsp;also&nbsp;has&nbsp;a&nbsp;lot&nbsp;of&nbsp;whitespace<br>
&lt;br&gt;changes&nbsp;I&nbsp;made&nbsp;so&nbsp;I&nbsp;could&nbsp;properly&nbsp;read&nbsp;the&nbsp;code&nbsp;(sorry&nbsp;about&nbsp;that).&lt;br&gt;&lt;br&gt;At&nbsp;this&nbsp;point,&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;what&nbsp;else&nbsp;to&nbsp;do.&nbsp;I'm&nbsp;wondering&nbsp;if&nbsp;the&lt;br&gt;rest&nbsp;of&nbsp;the&nbsp;leaks&nbsp;could&nbsp;be&nbsp;caused&nbsp;by&nbsp;another&nbsp;place&nbsp;where&lt;br&gt;mach_port_deallocate()&nbsp;isn't&nbsp;being&nbsp;called&nbsp;when&nbsp;it&nbsp;should&nbsp;be.&nbsp;I'm&nbsp;no<br>
&lt;br&gt;mach&nbsp;expert,&nbsp;so&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;where&nbsp;else&nbsp;to&nbsp;look.&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;-Allan&lt;br&gt;--&lt;br&gt;Allan&nbsp;Hsu&nbsp;&amp;lt;allan&nbsp;at&nbsp;counterpop&nbsp;dot&nbsp;net&amp;gt;&lt;br&gt;1E64&nbsp;E20F&nbsp;34D9&nbsp;CBA7&nbsp;1300&amp;nbsp;&amp;nbsp;1457&nbsp;AC37&nbsp;CBBB&nbsp;0E92&nbsp;C779&lt;br&gt;&lt;br&gt;_______________________________________________<br>
&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list<br>
&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;Alexandre&nbsp;Gomes,&nbsp;Portugal<br>

</tt>
