<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;while&nbsp;running&nbsp;x64&nbsp;mixed&nbsp;mode&nbsp;assemblies&nbsp;under&nbsp;Wine/Mono&nbsp;I&nbsp;came<br>
&nbsp;&nbsp;&nbsp;&nbsp;through&nbsp;the&nbsp;problem&nbsp;that&nbsp;MSVC&nbsp;generated&nbsp;mixed&nbsp;IL&nbsp;code&nbsp;causes<br>
&nbsp;&nbsp;&nbsp;&nbsp;'Invalid&nbsp;IL&nbsp;code'&nbsp;exception&nbsp;under&nbsp;Mono.&nbsp;The&nbsp;same&nbsp;dll&nbsp;compiled&nbsp;in<br>
&nbsp;&nbsp;&nbsp;&nbsp;32-bit&nbsp;does&nbsp;not&nbsp;have&nbsp;such&nbsp;a&nbsp;problem.&nbsp;I've&nbsp;created&nbsp;a&nbsp;quick&nbsp;fix&nbsp;patch<br>
&nbsp;&nbsp;&nbsp;&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mono/mini/method-to-ir.c&nbsp;which&nbsp;fixes&nbsp;the&nbsp;issue&nbsp;for&nbsp;me&nbsp;and&nbsp;a&nbsp;bug<br>
&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;now&nbsp;has&nbsp;a&nbsp;IL&nbsp;assembly&nbsp;test&nbsp;case&nbsp;and&nbsp;my&nbsp;patch&nbsp;(along&nbsp;with&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;MSVC&nbsp;example&nbsp;&amp;&nbsp;description&nbsp;of&nbsp;the&nbsp;problem):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://bugzilla.xamarin.com/show_bug.cgi?id=37913&quot;&gt;https://bugzilla.xamarin.com/show_bug.cgi?id=37913&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;The&nbsp;last&nbsp;IL&nbsp;test&nbsp;case&nbsp;causes&nbsp;crash&nbsp;on&nbsp;native&nbsp;win32&nbsp;and&nbsp;works<br>
&nbsp;&nbsp;&nbsp;&nbsp;under&nbsp;win64.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;To&nbsp;summarize,&nbsp;what&nbsp;happens&nbsp;(as&nbsp;I&nbsp;see&nbsp;it):&nbsp;Windows&nbsp;allows&nbsp;much&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;things&nbsp;mixing&nbsp;I8/PTR/I4&nbsp;to&nbsp;pass&nbsp;compilation&nbsp;(for&nbsp;both&nbsp;32/64),&nbsp;some<br>
&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;them&nbsp;get&nbsp;native&nbsp;GPF&nbsp;under&nbsp;Win32.&nbsp;Mono&nbsp;is&nbsp;fully&nbsp;checking<br>
&nbsp;&nbsp;&nbsp;&nbsp;assemblies&nbsp;and&nbsp;does&nbsp;not&nbsp;allow&nbsp;certain&nbsp;things&nbsp;to&nbsp;pass&nbsp;verifier<br>
&nbsp;&nbsp;&nbsp;&nbsp;(though&nbsp;if&nbsp;I&nbsp;do&nbsp;allow&nbsp;I8/PTR&nbsp;mixing&nbsp;in&nbsp;verifier&nbsp;on&nbsp;x64&nbsp;it&nbsp;works).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;I&nbsp;realize&nbsp;that&nbsp;the&nbsp;patch&nbsp;is&nbsp;probably&nbsp;not&nbsp;an&nbsp;upstream&nbsp;candidate<br>
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;its&nbsp;current&nbsp;form.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;The&nbsp;overall&nbsp;idea&nbsp;of&nbsp;arch-dependent&nbsp;assembly&nbsp;checks&nbsp;is&nbsp;probably<br>
&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;so&nbsp;OK&nbsp;for&nbsp;Mono&nbsp;as&nbsp;assembly&nbsp;code&nbsp;is&nbsp;meant&nbsp;to&nbsp;be&nbsp;arch&nbsp;independent.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Windows&nbsp;might&nbsp;be&nbsp;following&nbsp;this&nbsp;principle&nbsp;but&nbsp;instead&nbsp;has&nbsp;less<br>
&nbsp;&nbsp;&nbsp;&nbsp;restrictive&nbsp;checking&nbsp;allowing&nbsp;the&nbsp;compiled&nbsp;assembly&nbsp;natively&nbsp;crash<br>
&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;needed&nbsp;(and&nbsp;managed&nbsp;code&nbsp;generator&nbsp;produces&nbsp;a&nbsp;different&nbsp;code<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;different&nbsp;arch).&nbsp;So&nbsp;straightforward&nbsp;way&nbsp;to&nbsp;maintain<br>
&nbsp;&nbsp;&nbsp;&nbsp;compatibility&nbsp;with&nbsp;real&nbsp;MSVC&nbsp;managed&nbsp;code&nbsp;under&nbsp;x64&nbsp;is&nbsp;just&nbsp;allow<br>
&nbsp;&nbsp;&nbsp;&nbsp;such&nbsp;code&nbsp;to&nbsp;pass&nbsp;verifier.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;Maybe&nbsp;someone&nbsp;could&nbsp;push&nbsp;me&nbsp;in&nbsp;the&nbsp;right&nbsp;direction&nbsp;how&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;compatibility&nbsp;issue&nbsp;can&nbsp;be&nbsp;correctly&nbsp;fixed&nbsp;in&nbsp;Mono?&nbsp;I&nbsp;could&nbsp;possibly<br>
&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;make&nbsp;an&nbsp;appropriate&nbsp;patch&nbsp;and&nbsp;suggest&nbsp;it&nbsp;upstream.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;Paul.&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
