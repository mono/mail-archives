<tt>
Luis,&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;committed&nbsp;your&nbsp;patch&nbsp;with&nbsp;some&nbsp;changes&nbsp;or&nbsp;missing&nbsp;parts.&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;contribuitins.&nbsp;Some&nbsp;of&nbsp;the&nbsp;comments&nbsp;were&nbsp;due&nbsp;to&nbsp;a&nbsp;more&nbsp;detailed&nbsp;review&nbsp;while&nbsp;merging&nbsp;your&nbsp;code&nbsp;in.&lt;br&gt;&lt;br&gt;&lt;br&gt;Index:&nbsp;mono/metadata/object.c&lt;br&gt;<br>
===================================================================&lt;br&gt;<br>
<br>
<br>
---&nbsp;mono/metadata/object.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;17)&lt;br&gt;+++&nbsp;mono/metadata/object.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)&lt;br&gt;@@&nbsp;-3513,12&nbsp;+3513,23&nbsp;@@&lt;br&gt;&amp;nbsp;}&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;/*&nbsp;helper&nbsp;macros&nbsp;to&nbsp;check&nbsp;for&nbsp;overflow&nbsp;when&nbsp;calculating&nbsp;the&nbsp;size&nbsp;of&nbsp;arrays&nbsp;*/&lt;br&gt;-#define&nbsp;MYGUINT32_MAX&nbsp;4294967295U&lt;br&gt;<br>
<br>
<br>
<br>
+#if&nbsp;(GLIB_SIZEOF_SIZE_T&nbsp;&amp;lt;&nbsp;4&nbsp;)&lt;br&gt;&lt;br&gt;I&nbsp;changed&nbsp;the&nbsp;check&nbsp;to&nbsp;be&nbsp;against&nbsp;MONO_BIG_ARRAYS.&lt;br&gt;&lt;br&gt;@@&nbsp;-3548,34&nbsp;+3559,32&nbsp;@@&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*&nbsp;A&nbsp;single&nbsp;dimensional&nbsp;array&nbsp;with&nbsp;a&nbsp;0&nbsp;lower&nbsp;bound&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;an&nbsp;szarray&nbsp;*/&lt;br&gt;....&lt;br&gt;<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(CHECK_ADD_OVERFLOW_UN&nbsp;(byte_len,&nbsp;3))&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_gc_out_of_memory&nbsp;(MYGUINT32_MAX);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_gc_out_of_memory&nbsp;(MONO_ARRAY_MAX_SIZE);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;byte_len&nbsp;=&nbsp;(byte_len&nbsp;+&nbsp;3)&nbsp;&amp;amp;&nbsp;~3;&lt;br&gt;&lt;br&gt;<br>
<br>
You&nbsp;might&nbsp;need&nbsp;to&nbsp;adjust&nbsp;this&nbsp;alignment&nbsp;check&nbsp;to&nbsp;be&nbsp;aware&nbsp;of&nbsp;your&nbsp;changes.&lt;br&gt;&lt;br&gt;===================================================================&lt;br&gt;---&nbsp;mono/metadata/icall.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;17)&lt;br&gt;<br>
+++&nbsp;mono/metadata/icall.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)&lt;br&gt;<br>
@@&nbsp;-527,11&nbsp;+527,11&nbsp;@@&lt;br&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;aklass&nbsp;=&nbsp;mono_bounded_array_class_get&nbsp;(mono_class_from_mono_type&nbsp;(type-&amp;gt;type),&nbsp;mono_array_length&nbsp;(lengths),&nbsp;bounded);&lt;br&gt;&amp;nbsp;&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;=&nbsp;alloca&nbsp;(aklass-&amp;gt;rank&nbsp;*&nbsp;sizeof(guint32)&nbsp;*&nbsp;2);&lt;br&gt;<br>
<br>
<br>
<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;=&nbsp;alloca&nbsp;(aklass-&amp;gt;rank&nbsp;*&nbsp;sizeof(mono_array_size_t)&nbsp;*&nbsp;2);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;aklass-&amp;gt;rank;&nbsp;++i)&nbsp;{&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i]&nbsp;=&nbsp;mono_array_get&nbsp;(lengths,&nbsp;guint32,&nbsp;i);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i]&nbsp;=&nbsp;mono_array_get&nbsp;(lengths,&nbsp;gint32,&nbsp;i);&lt;br&gt;<br>
<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(bounds)&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i&nbsp;+&nbsp;aklass-&amp;gt;rank]&nbsp;=&nbsp;mono_array_get&nbsp;(bounds,&nbsp;guint32,&nbsp;i);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i&nbsp;+&nbsp;aklass-&amp;gt;rank]&nbsp;=&nbsp;mono_array_get&nbsp;(bounds,&nbsp;gint32,&nbsp;i);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i&nbsp;+&nbsp;aklass-&amp;gt;rank]&nbsp;=&nbsp;0;&lt;br&gt;<br>
<br>
<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&lt;br&gt;Why&nbsp;are&nbsp;you&nbsp;using&nbsp;mono_array_get&nbsp;with&nbsp;gint32?&nbsp;I&nbsp;can&amp;#39;t&nbsp;think&nbsp;of&nbsp;a&nbsp;reason&nbsp;for&nbsp;this&nbsp;change,&nbsp;as&nbsp;it&nbsp;won&amp;#39;t&nbsp;matter&nbsp;for&nbsp;mono_array_new_full.&amp;nbsp;&nbsp;Besides&nbsp;that,&nbsp;this&nbsp;is&nbsp;asking&nbsp;for&nbsp;trouble&nbsp;as&nbsp;you&nbsp;are&nbsp;mixing&nbsp;signed&nbsp;and&nbsp;unsigned&nbsp;numbers.&lt;br&gt;<br>
<br>
<br>
<br>
&lt;br&gt;&lt;br&gt;&amp;nbsp;@@&nbsp;-560,6&nbsp;+606,27&nbsp;@@&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_raise_exception&nbsp;(mono_get_exception_index_out_of_range&nbsp;());&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(this-&amp;gt;bounds&nbsp;==&nbsp;NULL)&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;length&nbsp;=&nbsp;this-&amp;gt;max_length;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;length&nbsp;=&nbsp;this-&amp;gt;bounds&nbsp;[dimension].length;&lt;br&gt;<br>
<br>
<br>
<br>
+&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(length&nbsp;&amp;gt;&nbsp;G_MAXINT32)&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_raise_exception&nbsp;(mono_get_exception_overflow&nbsp;());&lt;br&gt;+&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;length;&lt;br&gt;+}&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;put&nbsp;the&nbsp;length&nbsp;check&nbsp;inside&nbsp;a&nbsp;#ifdef&nbsp;MONO_BIG_ARRAYS&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;@@&nbsp;-541,6&nbsp;+541,51&nbsp;@@&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;array;&lt;br&gt;&amp;nbsp;}&lt;br&gt;&amp;nbsp;&lt;br&gt;+static&nbsp;MonoArray&nbsp;*&lt;br&gt;+ves_icall_System_Array_CreateInstanceImpl64&nbsp;(MonoReflectionType&nbsp;*type,&nbsp;MonoArray&nbsp;*lengths,&nbsp;MonoArray&nbsp;*bounds)&lt;br&gt;...&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;mono_array_length&nbsp;(lengths);&nbsp;i++)&nbsp;&lt;br&gt;<br>
<br>
<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;((mono_array_get&nbsp;(lengths,&nbsp;gint64,&nbsp;i)&nbsp;&amp;lt;&nbsp;0)&nbsp;||&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(mono_array_get&nbsp;(lengths,&nbsp;gint64,&nbsp;i)&nbsp;&amp;gt;&nbsp;MONO_ARRAY_MAX_INDEX))&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_raise_exception&nbsp;(mono_get_exception_argument_out_of_range&nbsp;(NULL));&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;Can&amp;#39;t&nbsp;this&nbsp;expression&nbsp;be&nbsp;simplified&nbsp;to&nbsp;&amp;quot;if&nbsp;((mono_array_get&nbsp;(lengths,&nbsp;guint64,&nbsp;i)&nbsp;&amp;gt;&nbsp;MONO_ARRAY_MAX_INDEX)&amp;quot;,&lt;br&gt;note&nbsp;we&nbsp;are&nbsp;reading&nbsp;it&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;value.&lt;br&gt;...&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;=&nbsp;alloca&nbsp;(aklass-&amp;gt;rank&nbsp;*&nbsp;sizeof(mono_array_size_t)&nbsp;*&nbsp;2);&lt;br&gt;<br>
<br>
<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;aklass-&amp;gt;rank;&nbsp;++i)&nbsp;{&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i]&nbsp;=&nbsp;mono_array_get&nbsp;(lengths,&nbsp;gint64,&nbsp;i);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(bounds)&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i&nbsp;+&nbsp;aklass-&amp;gt;rank]&nbsp;=&nbsp;mono_array_get&nbsp;(bounds,&nbsp;gint64,&nbsp;i);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&lt;br&gt;<br>
<br>
<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sizes&nbsp;[i&nbsp;+&nbsp;aklass-&amp;gt;rank]&nbsp;=&nbsp;0;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;Note&nbsp;that&nbsp;sizes&nbsp;element&nbsp;type&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number,&nbsp;so&nbsp;we&nbsp;must&nbsp;read&nbsp;it&nbsp;acordingly&nbsp;and&nbsp;cast&nbsp;it&nbsp;to&nbsp;mono_array_size_t&nbsp;to&lt;br&gt;ajust&nbsp;for&nbsp;the&nbsp;desired&nbsp;size&nbsp;-&nbsp;and&nbsp;avoid&nbsp;warnings&nbsp;as&nbsp;well.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;We&nbsp;can&nbsp;use&nbsp;the&nbsp;same&nbsp;code&nbsp;for&nbsp;the&nbsp;bound&nbsp;check&nbsp;I&nbsp;suggested&nbsp;for&nbsp;both&nbsp;CreateInstanceImpl&nbsp;versions.&nbsp;If&nbsp;we&nbsp;do&nbsp;that&nbsp;we&nbsp;could&nbsp;fix&lt;br&gt;the&nbsp;ugly&nbsp;aspect&nbsp;of&nbsp;having&nbsp;two&nbsp;99%&nbsp;identical&nbsp;functions&nbsp;by&nbsp;defining&nbsp;it&nbsp;as&nbsp;a&nbsp;MACRO&nbsp;and&nbsp;expanding&nbsp;it&nbsp;twice.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;May&nbsp;23,&nbsp;2008&nbsp;at&nbsp;7:10&nbsp;PM,&nbsp;Luis&nbsp;F.&nbsp;Ortiz&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:LuisOrtiz@verizon.net&quot;&nbsp;target=&quot;_blank&quot;&gt;LuisOrtiz@verizon.net&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;div&gt;&lt;div&gt;Rodrigo:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Sorry&nbsp;for&nbsp;the&nbsp;delayed&nbsp;response,&nbsp;things&nbsp;got&nbsp;busy,&nbsp;and&nbsp;I&nbsp;did&nbsp;not&nbsp;notice&nbsp;your&nbsp;message.&lt;/div&gt;&lt;div&gt;Please&nbsp;go&nbsp;ahead&nbsp;and&nbsp;check&nbsp;in&nbsp;the&nbsp;parts&nbsp;that&nbsp;you&nbsp;feel&nbsp;most&nbsp;comfortable&nbsp;with,&nbsp;since&nbsp;I&nbsp;do&nbsp;not&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;have&amp;nbsp;commit&amp;nbsp;rights.&nbsp;&amp;nbsp;&nbsp;I&amp;#39;ll&nbsp;adapt&nbsp;any&nbsp;further&nbsp;submissions&nbsp;against&nbsp;the&nbsp;next&nbsp;official&nbsp;cut.&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;The&nbsp;changes&nbsp;I&nbsp;have&nbsp;made&nbsp;are&nbsp;to&nbsp;be&nbsp;released&nbsp;under&nbsp;the&nbsp;X11&nbsp;license&nbsp;and&nbsp;I&nbsp;vouch&nbsp;that&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;talked&nbsp;to&nbsp;the&nbsp;appropriate&nbsp;people&nbsp;at&nbsp;my&nbsp;employer&nbsp;(Interactive&nbsp;Supercomputing)&nbsp;and&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;they&nbsp;agree&nbsp;as&nbsp;well&nbsp;to&nbsp;release&nbsp;this&nbsp;and&nbsp;any&nbsp;further&nbsp;contributions&nbsp;I&nbsp;make&nbsp;to&nbsp;Mono&nbsp;while&amp;nbsp;&lt;/div&gt;&lt;div&gt;under&amp;nbsp;their&nbsp;employ&nbsp;under&nbsp;the&nbsp;X11&nbsp;license.&nbsp;&amp;nbsp;&nbsp;There,&nbsp;that&nbsp;ought&nbsp;to&nbsp;make&nbsp;everybody&nbsp;happy.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Luis&nbsp;F.&nbsp;Ortiz&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;May&nbsp;16,&nbsp;2008,&nbsp;at&nbsp;10:53&nbsp;AM,&nbsp;Rodrigo&nbsp;Kumpera&nbsp;wrote:\&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hi&nbsp;Luis,&lt;br&gt;&lt;br&gt;Most&nbsp;parts&nbsp;of&nbsp;your&nbsp;patch&nbsp;are&nbsp;ok&nbsp;to&nbsp;be&nbsp;commited.&nbsp;As&nbsp;I&nbsp;said&nbsp;before,&nbsp;it&amp;#39;s&nbsp;better&nbsp;to&nbsp;have&nbsp;separate&nbsp;patches&nbsp;to&nbsp;speed&nbsp;up&nbsp;the&nbsp;review.&nbsp;As&nbsp;you&nbsp;get&nbsp;more&nbsp;changes&nbsp;in,&nbsp;it&nbsp;will&nbsp;ease&nbsp;your&nbsp;work&nbsp;on&nbsp;preparing&nbsp;patches&nbsp;and&nbsp;will&nbsp;ease&nbsp;on&nbsp;tracking&nbsp;head&nbsp;changes.&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;&lt;br&gt;Right&nbsp;now&nbsp;I&amp;#39;m&nbsp;ok&nbsp;with&nbsp;the&nbsp;configure,&nbsp;mono_array_t&nbsp;and&nbsp;related&nbsp;changes.&nbsp;These&nbsp;were&nbsp;easy&nbsp;to&nbsp;review&nbsp;and&nbsp;don&amp;#39;t&nbsp;introduce&nbsp;any&nbsp;change&nbsp;in&nbsp;behavior,&nbsp;so&nbsp;we&nbsp;can&nbsp;check-in&nbsp;then&nbsp;right&nbsp;now.&nbsp;The&nbsp;others&nbsp;requires&nbsp;more&nbsp;testing&nbsp;from&nbsp;me&nbsp;and&nbsp;would&nbsp;be&nbsp;easier&nbsp;to&nbsp;both&nbsp;of&nbsp;us&nbsp;if&nbsp;done&nbsp;after.&nbsp;&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;Do&nbsp;you&nbsp;mind&nbsp;cooking&nbsp;you&nbsp;a&nbsp;patch&nbsp;only&nbsp;with&nbsp;the&nbsp;ok&nbsp;parts.&lt;br&gt;&lt;br&gt;Remember&nbsp;that&nbsp;you&nbsp;need&nbsp;to&nbsp;either&nbsp;release&nbsp;these&nbsp;changes&nbsp;under&nbsp;the&nbsp;X11&nbsp;license&nbsp;or&nbsp;have&nbsp;done&nbsp;some&nbsp;copyright&nbsp;assignment&nbsp;paperwork.&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Rodrigo&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
&nbsp;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;May&nbsp;8,&nbsp;2008&nbsp;at&nbsp;8:21&nbsp;PM,&nbsp;Luis&nbsp;F.&nbsp;Ortiz&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:LuisOrtiz@verizon.net&quot;&nbsp;target=&quot;_blank&quot;&gt;LuisOrtiz@verizon.net&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
<br>
<br>
&nbsp;&lt;div&gt;On&nbsp;May&nbsp;8,&nbsp;2008,&nbsp;at&nbsp;9:29&nbsp;AM,&nbsp;Rodrigo&nbsp;Kumpera&nbsp;wrote:&lt;br&gt;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&nbsp;One&nbsp;important&nbsp;thing&nbsp;I&nbsp;forgot.&nbsp;If&nbsp;you&nbsp;break&nbsp;your&nbsp;patch&nbsp;into&nbsp;a&nbsp;few&nbsp;smaller&nbsp;ones&nbsp;the&nbsp;review&nbsp;process&nbsp;will&nbsp;be&nbsp;a&nbsp;lot&nbsp;easier&nbsp;to&nbsp;every&nbsp;one&nbsp;involved.&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;The&nbsp;first&nbsp;one&nbsp;can&nbsp;introduce&nbsp;new&nbsp;types&nbsp;and&nbsp;configuration&nbsp;foo;&nbsp;then&nbsp;other&nbsp;to&nbsp;fix&nbsp;codegen&nbsp;and&nbsp;Array&nbsp;methods&nbsp;and;&nbsp;at&nbsp;last,&nbsp;a&nbsp;bunch&nbsp;of&nbsp;fixes&nbsp;to&nbsp;classlib&nbsp;issues&nbsp;-like&nbsp;sockets,&nbsp;file&nbsp;i/o&nbsp;and&nbsp;so&nbsp;on.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;Cheers,&lt;br&gt;&nbsp;Rodrigo&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;&lt;/blockquote&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&nbsp;OK,&nbsp;here&nbsp;is&nbsp;another&nbsp;stab&nbsp;at&nbsp;the&nbsp;changes.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;This&nbsp;modifies&nbsp;the&nbsp;following&nbsp;files:&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;a&nbsp;href=&quot;http://configure.in&quot;&nbsp;target=&quot;_blank&quot;&gt;configure.in&lt;/a&gt;&lt;div&gt;&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;mono/metadata/object.c&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;mono/metadata/object.h&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;mono/metadata/icall-def.h&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;mono/metadata/icall.c&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;mono/metadata/socket-io.c&lt;br&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&nbsp;These&nbsp;files:&lt;br&gt;&nbsp;&amp;nbsp;1)&nbsp;Add&nbsp;a&nbsp;new&nbsp;configuration&nbsp;option,&nbsp;--enable-big-arrays,&nbsp;which&nbsp;defines&nbsp;conditionally&nbsp;defines&nbsp;MONO_BIG_ARRAYS&nbsp;in&nbsp;config.h,&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;&amp;nbsp;2)&nbsp;Add&nbsp;in&nbsp;mono/metadata/object.h&nbsp;:&lt;br&gt;&nbsp;&amp;nbsp;A)&nbsp;A&nbsp;new&nbsp;typedef&nbsp;for&nbsp;mono_array_size_t&nbsp;to&nbsp;be&nbsp;either&nbsp;guint32&nbsp;or&nbsp;guint64&lt;br&gt;&nbsp;&amp;nbsp;B)&nbsp;A&nbsp;new&nbsp;#define&nbsp;for&nbsp;MONO_ARRAY_MAX_INDEX&nbsp;for&nbsp;the&nbsp;biggest&nbsp;valid&nbsp;array&nbsp;index,&nbsp;i.e.&nbsp;G_MAXINTxx&lt;br&gt;&nbsp;&amp;nbsp;C)&nbsp;A&nbsp;new&nbsp;#define&nbsp;for&nbsp;MONO_ARRAY_MAX_SIZE&nbsp;for&nbsp;the&nbsp;biggest&nbsp;valid&nbsp;array&nbsp;allocation,&nbsp;i.e.&nbsp;G_MAXUINTxx&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;&amp;nbsp;D)&nbsp;The&nbsp;above&nbsp;all&nbsp;controlled&nbsp;by&nbsp;MONO_BIG_ARRAYS&lt;br&gt;&nbsp;&amp;nbsp;3)&nbsp;Modify&nbsp;the&nbsp;definitions&nbsp;of&nbsp;mono_array_new(),&nbsp;mono_array_new_full(),&nbsp;and&nbsp;mono_array_new_specific()&nbsp;to&nbsp;match,&lt;br&gt;&nbsp;&amp;nbsp;4)&nbsp;Modify&nbsp;the&nbsp;usages&nbsp;of&nbsp;those&nbsp;functions&nbsp;in&nbsp;the&nbsp;metadata&nbsp;directory&nbsp;to&nbsp;match,&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;&amp;nbsp;5)&nbsp;Add&nbsp;range&nbsp;checking&nbsp;in&nbsp;ves_icall_System_Array_CreateInstanceImpl64&nbsp;so&nbsp;it&nbsp;works&nbsp;with&nbsp;or&nbsp;without&nbsp;MONO_BIG_ARRAYS,&lt;br&gt;&nbsp;&amp;nbsp;6)&nbsp;Attempt&nbsp;to&nbsp;address&nbsp;all&nbsp;the&nbsp;mistakes&nbsp;you&nbsp;pointed&nbsp;out.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;These&nbsp;changes,&nbsp;in&nbsp;addition&nbsp;to&nbsp;the&nbsp;other&nbsp;changes&nbsp;I&nbsp;made,&nbsp;pass&nbsp;&amp;quot;make&nbsp;check&amp;quot;&nbsp;with&nbsp;the&nbsp;exception&nbsp;of&nbsp;Tests.test_0_regress_75832(),&nbsp;as&nbsp;previously&nbsp;confessed.&lt;br&gt;<br>
<br>
<br>
<br>
&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;/Ortiz/Luis&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
