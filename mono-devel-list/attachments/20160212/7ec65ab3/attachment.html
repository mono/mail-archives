<tt>
Hey&nbsp;Seif&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&#39;re&nbsp;also&nbsp;seeing&nbsp;this&nbsp;in&nbsp;production&nbsp;and&nbsp;it&#39;s&nbsp;causing&nbsp;a&nbsp;bit&nbsp;of&nbsp;pain.&nbsp;We&nbsp;can&nbsp;reproduce&nbsp;the&nbsp;issues&nbsp;with&nbsp;your&nbsp;gist. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&#39;re&nbsp;on&nbsp;3.12&nbsp;on&nbsp;prod&nbsp;too&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;div&gt;Jonathan&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;br&gt;On&nbsp;Friday,&nbsp;12&nbsp;February&nbsp;2016,&nbsp;Seif&nbsp;Attar&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:iam@seifattar.net&quot;&gt;iam@seifattar.net&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;&lt;/div&gt;We&nbsp;are&nbsp;running&nbsp;mono&nbsp;4.2.2&nbsp;in&nbsp;prod&nbsp;and&nbsp;the&nbsp;VM&nbsp;that&nbsp;the&nbsp;process&nbsp;was&nbsp;running&nbsp;on&nbsp;had&nbsp;SAN&nbsp;failure&nbsp;and&nbsp;after&nbsp;storage&nbsp;recovered,&nbsp;all&nbsp;outgoing&nbsp;requests&nbsp;were&nbsp;timing&nbsp;out,&nbsp;even&nbsp;though&nbsp;doing&nbsp;a&nbsp;curl&nbsp;was&nbsp;working&nbsp;fine.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Theory&nbsp;was&nbsp;that&nbsp;thread&nbsp;pool&nbsp;starved&nbsp;and&nbsp;somehow&nbsp;things&nbsp;didn&#39;t&nbsp;recover&nbsp;properly.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Managed&nbsp;to&nbsp;reproduce&nbsp;with:&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://gist.githubusercontent.com/seif/ae2defbfa5afa26fa8f6/raw/bef351eded56c882658a4bad60fa4818ad32d629/timeout.cs&quot;&nbsp;target=&quot;_blank&quot;&gt;https://gist.githubusercontent.com/seif/ae2defbfa5afa26fa8f6/raw/bef351eded56c882658a4bad60fa4818ad32d629/timeout.cs&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Even&nbsp;after&nbsp;ThreadPool&nbsp;finishes&nbsp;the&nbsp;tasks&nbsp;and&nbsp;has&nbsp;available&nbsp;threads,&nbsp;it&nbsp;never&nbsp;recovers&nbsp;and&nbsp;subsequent&nbsp;webrequests&nbsp;all&nbsp;timeout.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Running&nbsp;on&nbsp;mono&nbsp;4.2.2,&nbsp;linux&nbsp;kernel&nbsp;4.2.0-27&nbsp;and&nbsp;libc&nbsp;2.21.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Output&nbsp;from&nbsp;gdb&nbsp;is:&lt;br&gt;&lt;br&gt;(gdb)&nbsp;info&nbsp;threads&lt;br&gt; &nbsp;Id  &nbsp;Target&nbsp;Id        &nbsp;Frame&lt;br&gt; &nbsp;13  &nbsp;Thread&nbsp;0x7fca903ff700&nbsp;(LWP&nbsp;27944)&nbsp;&quot;cli&quot;&nbsp;pthread_cond_wait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185&lt;br&gt; &nbsp;12  &nbsp;Thread&nbsp;0x7fca90b34700&nbsp;(LWP&nbsp;27945)&nbsp;&quot;Finalizer&quot;&nbsp;0x00007fca911d70c9&nbsp;in&nbsp;futex_abstimed_wait&nbsp;(cancel=true,&nbsp;private=&lt;optimised&nbsp;out&gt;,&nbsp;abstime=0x0,&nbsp;expected=0,&nbsp;futex=0x948ae0)&nbsp;at&nbsp;sem_waitcommon.c:42&lt;br&gt; &nbsp;11  &nbsp;Thread&nbsp;0x7fca8dfff700&nbsp;(LWP&nbsp;27946)&nbsp;&quot;Timer-Scheduler&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;10  &nbsp;Thread&nbsp;0x7fca91ba1700&nbsp;(LWP&nbsp;27947)&nbsp;&quot;cli&quot;&nbsp;__clock_nanosleep&nbsp;(clock_id=1,&nbsp;flags=1,&nbsp;req=0x7fca91ba0dc0,&nbsp;rem=0x7fca90f134aa&nbsp;&lt;__clock_nanosleep+138&gt;)&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/clock_nanosleep.c:48&lt;br&gt; &nbsp;9   &nbsp;Thread&nbsp;0x7fca8ddfe700&nbsp;(LWP&nbsp;27948)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;8   &nbsp;Thread&nbsp;0x7fca8dbfd700&nbsp;(LWP&nbsp;27949)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;7   &nbsp;Thread&nbsp;0x7fca8d7fb700&nbsp;(LWP&nbsp;27951)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;6   &nbsp;Thread&nbsp;0x7fca8d3f9700&nbsp;(LWP&nbsp;27953)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;5   &nbsp;Thread&nbsp;0x7fca8d1f8700&nbsp;(LWP&nbsp;27954)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;4   &nbsp;Thread&nbsp;0x7fca8cff7700&nbsp;(LWP&nbsp;27955)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;3   &nbsp;Thread&nbsp;0x7fca8cdf6700&nbsp;(LWP&nbsp;27956)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt; &nbsp;2   &nbsp;Thread&nbsp;0x7fca8cbf5700&nbsp;(LWP&nbsp;27957)&nbsp;&quot;Threadpool&nbsp;work&quot;&nbsp;pthread_cond_timedwait@@GLIBC_2.3.2&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238&lt;br&gt;*&nbsp;1   &nbsp;Thread&nbsp;0x7fca91cf0780&nbsp;(LWP&nbsp;27942)&nbsp;&quot;cli&quot;&nbsp;0x00007fca911d7e0d&nbsp;in&nbsp;read&nbsp;()&nbsp;at&nbsp;../sysdeps/unix/syscall-template.S:81&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could&nbsp;not&nbsp;reproduce&nbsp;on&nbsp;mono&nbsp;3.12,&nbsp;but&nbsp;it&nbsp;happens&nbsp;on&nbsp;4.0.3&nbsp;and&nbsp;4.2.2&lt;br&gt;&lt;br&gt;&lt;/div&gt;Is&nbsp;this&nbsp;a&nbsp;known&nbsp;issue?&nbsp;any&nbsp;workarounds?&nbsp;Tried&nbsp;setting&nbsp;MONO_DNS=1&nbsp;to&nbsp;use&nbsp;the&nbsp;clr&nbsp;dns,&nbsp;but&nbsp;that&nbsp;didn&#39;t&nbsp;help.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;more&nbsp;info&nbsp;I&nbsp;need&nbsp;to&nbsp;provide.&lt;br&gt;&lt;br&gt;&lt;/div&gt;Thanks,&lt;br&gt;&lt;/div&gt;Seif&lt;br&gt;&nbsp;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
