<tt>
Ok,&nbsp;so&nbsp;here&amp;#39;s&nbsp;the&nbsp;latest&nbsp;and&nbsp;greatest.&lt;br&gt;&lt;br&gt;I&amp;#39;ve&nbsp;attached&nbsp;a&nbsp;new&nbsp;patch&nbsp;for&nbsp;the&nbsp;managed&nbsp;SHA1&nbsp;implementation.&nbsp;One&nbsp;loop&nbsp;is&nbsp;fully&nbsp;unrolled&nbsp;(InitialiseBuffer),&nbsp;one&nbsp;is&nbsp;partially&nbsp;unrolled&nbsp;(FillBuff)&nbsp;and&nbsp;i&nbsp;rolled&nbsp;up&nbsp;the&nbsp;SHA1&nbsp;calculations&nbsp;as&nbsp;much&nbsp;as&nbsp;i&nbsp;think&nbsp;is&nbsp;possible.&nbsp;This&nbsp;means&nbsp;the&nbsp;cs&nbsp;file&nbsp;has&nbsp;gone&nbsp;from&nbsp;500&nbsp;lines&nbsp;to&nbsp;330&nbsp;lines.&nbsp;This&nbsp;should&nbsp;make&nbsp;JITing&nbsp;faster,&nbsp;which&nbsp;was&nbsp;one&nbsp;concern&nbsp;raised&nbsp;earlier.&nbsp;The&nbsp;reason&nbsp;for&nbsp;leaving&nbsp;InitialiseBuffer&nbsp;unrolled&nbsp;is&nbsp;that&nbsp;it&nbsp;gave&nbsp;a&nbsp;fairly&nbsp;dramatic&nbsp;increase&nbsp;in&nbsp;speed.&nbsp;Also,&nbsp;it&amp;#39;s&nbsp;quite&nbsp;short&nbsp;as&nbsp;compared&nbsp;to&nbsp;the&nbsp;other&nbsp;two&nbsp;methods,&nbsp;so&nbsp;there&nbsp;wouldn&amp;#39;t&nbsp;be&nbsp;a&nbsp;huge&nbsp;LOC&nbsp;saving&nbsp;if&nbsp;i&nbsp;rolled&nbsp;it&nbsp;up,&nbsp;but&nbsp;there&nbsp;would&nbsp;be&nbsp;a&nbsp;noticeable&nbsp;perf.&nbsp;loss.&lt;br&gt;<br>
&lt;br&gt;Now,&nbsp;performance!&nbsp;The&nbsp;attached&nbsp;testbench.cs&nbsp;file&nbsp;can&nbsp;be&nbsp;compiled&nbsp;and&nbsp;run&nbsp;by&nbsp;itself.&nbsp;It&nbsp;will&nbsp;then&nbsp;print&nbsp;out&nbsp;timing&nbsp;for&nbsp;the&nbsp;SVN-head&nbsp;version&nbsp;of&nbsp;the&nbsp;SHA1&nbsp;algo&nbsp;and&nbsp;the&nbsp;enhanced&nbsp;version&nbsp;of&nbsp;the&nbsp;algo.&nbsp;The&nbsp;results&nbsp;i&amp;#39;ve&nbsp;gathered&nbsp;so&nbsp;far&nbsp;are:&lt;br&gt;<br>
&lt;br&gt;&lt;div&nbsp;style=&quot;margin-left:&nbsp;40px;&quot;&gt;Core&nbsp;Duo&nbsp;@&nbsp;1.86GHz&lt;br&gt;SVN&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;:&nbsp;8004ms&lt;br&gt;Enhanced:&nbsp;6007ms&lt;br&gt;&lt;b&gt;1.33x&nbsp;faster&lt;/b&gt;&lt;br&gt;&lt;br&gt;Core&nbsp;2&nbsp;Duo&nbsp;@&nbsp;2.40GHz&lt;br&gt;SVN&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;:&nbsp;6062ms&lt;br&gt;Enhanced:&nbsp;3945ms&lt;br&gt;&lt;b&gt;1.53x&nbsp;faster&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;<br>
Finally,&nbsp;a&nbsp;version&nbsp;of&nbsp;the&nbsp;above&nbsp;code&nbsp;where&nbsp;all&nbsp;the&nbsp;loops&nbsp;are&nbsp;fully&nbsp;unrolled&nbsp;is&nbsp;only&nbsp;about&nbsp;1.06x&nbsp;faster,&nbsp;so&nbsp;the&nbsp;perf&nbsp;loss&nbsp;in&nbsp;rolling&nbsp;up&nbsp;those&nbsp;two&nbsp;loops&nbsp;is&nbsp;fairly&nbsp;negligible.&lt;br&gt;&lt;br&gt;Let&nbsp;me&nbsp;know&nbsp;your&nbsp;thoughts&nbsp;on&nbsp;this,&lt;br&gt;&lt;br&gt;<br>
Alan.&lt;br&gt;&lt;br&gt;On&nbsp;Tue,&nbsp;Apr&nbsp;29,&nbsp;2008&nbsp;at&nbsp;7:25&nbsp;PM,&nbsp;Alan&nbsp;McGovern&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:alan.mcgovern@gmail.com&quot;&gt;alan.mcgovern@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;Hi&nbsp;igor,&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&amp;gt;&nbsp;&amp;nbsp;[1]&nbsp;The&nbsp;first&nbsp;numbers&nbsp;from&nbsp;Alan,&nbsp;on&nbsp;Sunday&nbsp;using&nbsp;unsafe&nbsp;code,&nbsp;were&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;nbsp;&amp;gt;&nbsp;&amp;nbsp;around&nbsp;40%&nbsp;and&nbsp;he&nbsp;made&nbsp;more&nbsp;progress&nbsp;after&nbsp;that.&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;The&nbsp;current&nbsp;unsafe&nbsp;code&nbsp;version&nbsp;is&nbsp;just&nbsp;over&nbsp;3x&nbsp;faster&nbsp;than&nbsp;the&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;default&nbsp;implementation&nbsp;in&nbsp;Mono&nbsp;1.9.&nbsp;However&nbsp;this&nbsp;will&nbsp;never&nbsp;be&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;committed&nbsp;to&nbsp;mono&nbsp;itself.&nbsp;So&nbsp;don&amp;#39;t&nbsp;get&nbsp;your&nbsp;hopes&nbsp;up&nbsp;on&nbsp;it&nbsp;;)&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;nbsp;&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&amp;gt;&nbsp;&amp;nbsp;I&nbsp;committed&nbsp;(i.e.it&amp;#39;s&nbsp;already&nbsp;in&nbsp;HEAD)&nbsp;a&nbsp;small&nbsp;patch&nbsp;to&nbsp;helps&nbsp;ABC&nbsp;removal&nbsp;(fields&nbsp;versus&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&amp;gt;&nbsp;&amp;nbsp;local).&nbsp;This&nbsp;gained&nbsp;(well&nbsp;reduced&nbsp;time&nbsp;by)&nbsp;26%&nbsp;on&nbsp;a&nbsp;P4&nbsp;(x86&nbsp;JIT).&nbsp;The&nbsp;next&nbsp;day&nbsp;I&nbsp;tried&nbsp;th&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;nbsp;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;nbsp;same&nbsp;code&nbsp;on&nbsp;a&nbsp;64&nbsp;bit&nbsp;box&nbsp;(x86_64&nbsp;JIT)&nbsp;and&nbsp;the&nbsp;time&nbsp;reduction&nbsp;was&nbsp;32%.&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;My&nbsp;current&nbsp;working&nbsp;version&nbsp;using&nbsp;safe&nbsp;code&nbsp;only&nbsp;is&nbsp;about&nbsp;twice&nbsp;as&nbsp;fast&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;as&nbsp;Mono&nbsp;1.9.&nbsp;It&nbsp;includes&nbsp;the&nbsp;patch&nbsp;mentioned&nbsp;above&nbsp;by&nbsp;sebastien.&nbsp;This&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;nbsp;is&nbsp;the&nbsp;patch&nbsp;included&nbsp;in&nbsp;my&nbsp;first&nbsp;email.&nbsp;However,&nbsp;there&nbsp;is&nbsp;the&nbsp;issue&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;that&nbsp;this&nbsp;makes&nbsp;the&nbsp;SHA1&nbsp;class&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;monster&nbsp;for&nbsp;the&nbsp;JIT.&nbsp;I&amp;#39;m&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;going&nbsp;to&nbsp;see&nbsp;if&nbsp;i&nbsp;can&nbsp;reduce&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;class&nbsp;without&nbsp;losing&nbsp;too&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;nbsp;much&nbsp;of&nbsp;the&nbsp;extra&nbsp;performance.&nbsp;So&nbsp;check&nbsp;back&nbsp;later&nbsp;tonight&nbsp;for&nbsp;exact&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;numbers&nbsp;and&nbsp;my&nbsp;testbench.&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;Alan.&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&lt;br&gt;&lt;br&gt;<br>

</tt>
