<tt>
Hello.&amp;nbsp;&nbsp;I&amp;#39;m&nbsp;in&nbsp;the&nbsp;process&nbsp;of&nbsp;writing&nbsp;an&nbsp;MTOM&nbsp;extension&nbsp;of&nbsp;SoapHttpClientProtocol&nbsp;and&nbsp;I&amp;#39;ve&nbsp;run&nbsp;into&nbsp;a&nbsp;slight&nbsp;snag.&amp;nbsp;&nbsp;Part&nbsp;of&nbsp;my&nbsp;code&nbsp;involves&nbsp;overriding&nbsp;GetWebResponse()&nbsp;and&nbsp;replacing&nbsp;the&nbsp;Content-Type&nbsp;header&nbsp;(which&nbsp;is,&nbsp;for&nbsp;MTOM-encoded&nbsp;stuff,&nbsp;&amp;#39;application/xop+xml&amp;#39;)&nbsp;with&nbsp;&amp;#39;text/xml&amp;#39;&nbsp;for&nbsp;the&nbsp;sake&nbsp;of&nbsp;the&nbsp;lower&nbsp;layers&nbsp;that&nbsp;don&amp;#39;t&nbsp;know&nbsp;that&nbsp;they&amp;#39;re&nbsp;actually&nbsp;supporting&nbsp;MTOM.&amp;nbsp;&nbsp;Here&amp;#39;s&nbsp;the&nbsp;line&nbsp;of&nbsp;code&nbsp;I&nbsp;use:<br>
&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;rsp.Headers[HttpResponseHeader.ContentType]&nbsp;=&nbsp;&amp;quot;text/xml&amp;quot;;&lt;br&gt;&lt;br&gt;In&nbsp;WebHeaderCollection,&nbsp;however,&nbsp;this&nbsp;setter&nbsp;ends&nbsp;up&nbsp;doing&nbsp;an&nbsp;Add().&amp;nbsp;&nbsp;Its&nbsp;NameValueCollection,&nbsp;in&nbsp;turn,&nbsp;adds&nbsp;&amp;#39;,text/xml&amp;#39;&nbsp;to&nbsp;the&nbsp;&amp;quot;Content-Type&amp;quot;&nbsp;key&nbsp;as&nbsp;it&amp;#39;s&nbsp;supposed&nbsp;to.&amp;nbsp;&nbsp;So&nbsp;the&nbsp;content&nbsp;type&nbsp;turns&nbsp;out&nbsp;to&nbsp;be:<br>
&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;lt;original&nbsp;content&nbsp;type&amp;gt;,text/xml&lt;br&gt;&lt;br&gt;When&nbsp;WebServiceHelper&nbsp;tries&nbsp;to&nbsp;decode&nbsp;this&nbsp;to&nbsp;get&nbsp;the&nbsp;encoding,&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;expect&nbsp;the&nbsp;comma-delimited&nbsp;types&nbsp;and&nbsp;ends&nbsp;up&nbsp;returning&nbsp;something&nbsp;invalid&nbsp;like:&lt;br&gt;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;utf-8&amp;quot;,text/xml&lt;br&gt;&lt;br&gt;Now,&nbsp;I&nbsp;could&nbsp;manually&nbsp;remove&nbsp;and&nbsp;re-set&nbsp;the&nbsp;Content-Type&nbsp;header&nbsp;in&nbsp;the&nbsp;WebHeaderCollection.&amp;nbsp;&nbsp;But&nbsp;I&nbsp;don&amp;#39;t&nbsp;think&nbsp;I&nbsp;should&nbsp;have&nbsp;to!&amp;nbsp;&nbsp;For&nbsp;one,&nbsp;this&nbsp;code&nbsp;works&nbsp;as&nbsp;intended&nbsp;under&nbsp;.NET.&amp;nbsp;&nbsp;Second,&nbsp;WebHeaderCollection&nbsp;already&nbsp;has&nbsp;a&nbsp;list&nbsp;of&nbsp;those&nbsp;headers&nbsp;that&nbsp;are&nbsp;allowed&nbsp;to&nbsp;contain&nbsp;multiple&nbsp;values&nbsp;in&nbsp;their&nbsp;NameValue&nbsp;string&nbsp;-&nbsp;it&nbsp;stores&nbsp;them&nbsp;in&nbsp;a&nbsp;hash&nbsp;table&nbsp;called&nbsp;&amp;#39;multiValue&amp;#39;.&amp;nbsp;&nbsp;The&nbsp;private&nbsp;method&nbsp;SetInternal()&nbsp;checks&nbsp;this&nbsp;hash&nbsp;table&nbsp;to&nbsp;see&nbsp;whether&nbsp;an&nbsp;incoming&nbsp;name/value&nbsp;pair&nbsp;should&nbsp;replace&nbsp;the&nbsp;existing&nbsp;header&nbsp;(ie.&nbsp;do&nbsp;a&nbsp;Remove()/Set())&nbsp;or&nbsp;just&nbsp;add&nbsp;it&nbsp;(ie.&nbsp;do&nbsp;an&nbsp;Add()).&amp;nbsp;&nbsp;Content-Type&nbsp;is&nbsp;not&nbsp;a&nbsp;multi-value&nbsp;header,&nbsp;so&nbsp;it&nbsp;seems&nbsp;to&nbsp;me&nbsp;that&nbsp;simply&nbsp;using&nbsp;the&nbsp;setter&nbsp;should&nbsp;replace&nbsp;it.<br>
&lt;br&gt;&lt;br&gt;My&nbsp;proposed&nbsp;change,&nbsp;finally,&nbsp;is&nbsp;to&nbsp;call&nbsp;the&nbsp;SetInternal()&nbsp;method&nbsp;in&nbsp;the&nbsp;setters&nbsp;instead&nbsp;of&nbsp;Add():&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;string&nbsp;this[HttpRequestHeader&nbsp;hrh]&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;get&nbsp;{&nbsp;...&nbsp;}&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;set&nbsp;{&nbsp;SetInternal&nbsp;(ResponseHeaderToString&nbsp;(hrh),&nbsp;value);&nbsp;}&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
&lt;br&nbsp;clear=&quot;all&quot;&gt;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;string&nbsp;this[HttpResponseHeader&nbsp;hrh]&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;get&nbsp;{&nbsp;...&nbsp;}&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;set&nbsp;{&nbsp;SetInternal&nbsp;(ResponseHeaderToString&nbsp;(hrh),&nbsp;value);&nbsp;}&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;<br>
&lt;br&gt;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;I&amp;#39;m&nbsp;missed&nbsp;something&nbsp;or&nbsp;if&nbsp;I&nbsp;can&nbsp;provide&nbsp;more&nbsp;information,&nbsp;and&nbsp;my&nbsp;apologies&nbsp;for&nbsp;the&nbsp;long-winded&nbsp;explanation!&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;Jay&nbsp;Miller&lt;br&gt;PGP&nbsp;Fingerprint&nbsp;|&nbsp;5f7adbbe&nbsp;bfc60727&nbsp;96dca94c&nbsp;616d5080&nbsp;09e3e846<br>

</tt>
