<tt>
Hi&nbsp;Andreas,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;It&nbsp;sounds&nbsp;like&nbsp;what&nbsp;you&nbsp;are&nbsp;doing&nbsp;is&nbsp;embedding&nbsp;mono.&nbsp;Did&nbsp;you&nbsp;see&nbsp;this&nbsp;page&nbsp;on&nbsp;the&nbsp;wiki&nbsp;(&lt;a&nbsp;href=&quot;http://www.mono-project.com/Embedding_Mono&quot;&gt;http://www.mono-project.com/Embedding_Mono&lt;/a&gt;)?&nbsp;To&nbsp;answer&nbsp;your&nbsp;#2&nbsp;question,&nbsp;I&nbsp;think&nbsp;you&nbsp;want&nbsp;your&nbsp;menthod&nbsp;to&nbsp;be&nbsp;an&nbsp;internal&nbsp;call,&nbsp;rather&nbsp;than&nbsp;a&nbsp;pinvoke.&nbsp;Internal&nbsp;calls&nbsp;do&nbsp;no&nbsp;marshalling,&nbsp;so&nbsp;you&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;return&nbsp;an&nbsp;object&nbsp;directly.&nbsp;See&nbsp;the&nbsp;samples&nbsp;that&nbsp;ship&nbsp;with&nbsp;mono,&nbsp;or&nbsp;this&nbsp;part&nbsp;of&nbsp;the&nbsp;link&nbsp;above&nbsp;(<br>
&lt;a&nbsp;href=&quot;http://www.mono-project.com/Embedding_Mono#Exposing_C_code_to_the_CIL_universe&quot;&gt;http://www.mono-project.com/Embedding_Mono#Exposing_C_code_to_the_CIL_universe&lt;/a&gt;).&lt;br&gt;&lt;br&gt;So,&nbsp;quickly&nbsp;it&nbsp;will&nbsp;look&nbsp;something&nbsp;like...<br>
&lt;br&gt;&lt;br&gt;C#:&lt;br&gt;&lt;pre&gt;[MethodImplAttribute(MethodImplOptions.InternalCall)]&lt;br&gt;public&nbsp;static&nbsp;extern&nbsp;object&nbsp;getPeerObjectOf(HandleRef&nbsp;jarg1);&lt;/pre&gt;&lt;br&gt;And&nbsp;your&nbsp;C++&nbsp;will&nbsp;almost&nbsp;stay&nbsp;the&nbsp;same;&nbsp;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;but&nbsp;you&nbsp;may&nbsp;need&nbsp;to&nbsp;adjust&nbsp;your&nbsp;use&nbsp;of&nbsp;HandleRef&nbsp;since&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;be&nbsp;marshalled&nbsp;like&nbsp;a&nbsp;pinvoke,&nbsp;so&nbsp;you&amp;#39;ll&nbsp;be&nbsp;getting&nbsp;a&nbsp;real&nbsp;HandleRef&nbsp;structure.&nbsp;<br>
&lt;br&gt;&lt;br&gt;Also,&nbsp;don&amp;#39;t&nbsp;forget&nbsp;if&nbsp;you&nbsp;make&nbsp;the&nbsp;method&nbsp;an&nbsp;instance&nbsp;method&nbsp;rather&nbsp;than&nbsp;static,&nbsp;the&nbsp;C&nbsp;code&nbsp;needs&nbsp;&amp;quot;MonoObject*&nbsp;this_ptr&amp;quot;&nbsp;as&nbsp;the&nbsp;first&nbsp;argument.&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Jonathan&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;3/16/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Andreas&nbsp;Lagemann&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:ae@informatik.tu-cottbus.de&quot;&gt;ae@informatik.tu-cottbus.de&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
-----BEGIN&nbsp;PGP&nbsp;SIGNED&nbsp;MESSAGE-----&lt;br&gt;Hash:&nbsp;SHA1&lt;br&gt;&lt;br&gt;Hi&nbsp;all,&lt;br&gt;I&nbsp;want&nbsp;to&nbsp;do&nbsp;the&nbsp;following&nbsp;in&nbsp;a&nbsp;program&nbsp;which&nbsp;consists&nbsp;of&lt;br&gt;interacting&nbsp;parts&nbsp;of&nbsp;native&nbsp;C++(not&nbsp;managed)&nbsp;code&nbsp;and&nbsp;C#&nbsp;on&nbsp;mono&lt;br&gt;where&nbsp;the&nbsp;mono&nbsp;runtime&nbsp;is&nbsp;started&nbsp;from&nbsp;the&nbsp;C++&nbsp;code&nbsp;and&nbsp;C#&nbsp;code<br>
&lt;br&gt;calls&nbsp;back&nbsp;to&nbsp;C++:&lt;br&gt;&lt;br&gt;1.&nbsp;I&nbsp;want&nbsp;to&nbsp;store&nbsp;a&nbsp;reference&nbsp;to&nbsp;an&nbsp;already&nbsp;existing&nbsp;mono-object&nbsp;on&lt;br&gt;the&nbsp;C++&nbsp;side.&nbsp;I&nbsp;currently&nbsp;do&nbsp;it&nbsp;this&nbsp;way:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;typedef&nbsp;MonoObject*&nbsp;(*getCsharpPeerFn)();&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;void&nbsp;setCsharpPeerCallback(getCsharpPeerFn&nbsp;fnptr)<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;getCsharpPeer&nbsp;=&nbsp;fnptr;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;csharpPeer&nbsp;=&nbsp;getCsharpPeer();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;csharpPeerHandle&nbsp;=&nbsp;mono_gchandle_new(csharpPeer,&nbsp;TRUE);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br&gt;where&nbsp;the&nbsp;setCsharpPeerCallback&nbsp;method&nbsp;is&nbsp;called&nbsp;from&nbsp;C#-code&nbsp;via<br>
&lt;br&gt;P/Invoke.&lt;br&gt;&lt;br&gt;That&nbsp;works&nbsp;fine&nbsp;so&nbsp;far.&nbsp;But&nbsp;additionally&nbsp;I&nbsp;would&nbsp;like&nbsp;to:&lt;br&gt;&lt;br&gt;2.&nbsp;retrieve&nbsp;the&nbsp;stored&nbsp;reference&nbsp;from&nbsp;within&nbsp;managed&nbsp;code&nbsp;by&nbsp;calling&lt;br&gt;the&nbsp;unmanaged&nbsp;side.&nbsp;I&nbsp;tried&nbsp;something&nbsp;like&nbsp;that:&lt;br&gt;&lt;br&gt;C#:&lt;br&gt;<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;[DllImport(&amp;quot;Simkernel&amp;quot;,EntryPoint=&amp;quot;getPeerObjectOf&amp;quot;)]&lt;br&gt;&amp;nbsp;&amp;nbsp;public&nbsp;static&nbsp;extern&nbsp;object&nbsp;getPeerObjectOf(HandleRef&nbsp;jarg1);&lt;br&gt;&lt;br&gt;C++:&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;MonoObject*&nbsp;getPeerObjectOf(SomeCommonClassBase*&nbsp;obj)&nbsp;{&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;MyClass*&nbsp;myObj&nbsp;=&nbsp;dynamic_cast&amp;lt;MyClass*&amp;gt;(obj);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;myObj&nbsp;?&nbsp;myObj-&amp;gt;getMyPeerObject()&nbsp;:&nbsp;NULL;&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&lt;br&gt;When&nbsp;I&nbsp;call&nbsp;getPeerObjectOf&nbsp;from&nbsp;C#&nbsp;I&nbsp;get&nbsp;an&nbsp;runtime&nbsp;Error,&nbsp;stating&lt;br&gt;that&nbsp;marshalling&nbsp;of&nbsp;object&nbsp;is&nbsp;not&nbsp;implemented.<br>
&lt;br&gt;&lt;br&gt;Is&nbsp;there&nbsp;another&nbsp;way&nbsp;to&nbsp;do&nbsp;what&nbsp;I&nbsp;want?&lt;br&gt;Is&nbsp;marshalling&nbsp;of&nbsp;type&nbsp;object&nbsp;supported&nbsp;in&nbsp;more&nbsp;recent&nbsp;mono&nbsp;versions&lt;br&gt;(I&amp;#39;m&nbsp;using&nbsp;version&nbsp;&lt;a&nbsp;href=&quot;http://1.1.13.6&quot;&gt;1.1.13.6&lt;/a&gt;)?&lt;br&gt;&lt;br&gt;Please&nbsp;help,&nbsp;I&amp;#39;m&nbsp;really&nbsp;becoming&nbsp;desperate&nbsp;about&nbsp;this.<br>
&lt;br&gt;&lt;br&gt;Thank&nbsp;you&nbsp;for&nbsp;reading&nbsp;and&nbsp;best&nbsp;regards,&lt;br&gt;&lt;br&gt;Andreas&lt;br&gt;-----BEGIN&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;Version:&nbsp;GnuPG&nbsp;v1.4.2.2&nbsp;(GNU/Linux)&lt;br&gt;Comment:&nbsp;Using&nbsp;GnuPG&nbsp;with&nbsp;Mozilla&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;http://enigmail.mozdev.org&quot;&gt;http://enigmail.mozdev.org<br>
&lt;/a&gt;&lt;br&gt;&lt;br&gt;iD8DBQFF+pVANfV8qlW7iaERAof6AJ42HTgQqOnJSRDCaS7/U+7ZSwliqQCfZ0kd&lt;br&gt;c9orZDWbGGkhnxi8rGQ/vx8=&lt;br&gt;=Ck74&lt;br&gt;-----END&nbsp;PGP&nbsp;SIGNATURE-----&lt;br&gt;_______________________________________________&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
