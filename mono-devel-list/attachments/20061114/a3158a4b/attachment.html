<tt>
This&nbsp;seems&nbsp;to&nbsp;work.&lt;br&gt;&lt;br&gt;Thanks&nbsp;a&nbsp;lot,&lt;br&gt;&lt;br&gt;Dan&lt;br&gt;&lt;br&gt;&lt;b&gt;&lt;i&gt;Paolo&nbsp;Molaro&nbsp;&amp;lt;lupus@ximian.com&amp;gt;&lt;/i&gt;&lt;/b&gt;&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;replbq&quot;&nbsp;style=&quot;border-left:&nbsp;2px&nbsp;solid&nbsp;rgb(16,&nbsp;16,&nbsp;255);&nbsp;margin-left:&nbsp;5px;&nbsp;padding-left:&nbsp;5px;&quot;&gt;&nbsp;On&nbsp;11/14/06&nbsp;D&nbsp;M&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;I&nbsp;think&nbsp;the&nbsp;issue&nbsp;is&nbsp;with&nbsp;the&nbsp;mini-arm.c&nbsp;add_general&nbsp;(guint&nbsp;*gr,&nbsp;guint&nbsp;*stack_size,&nbsp;ArgInfo&nbsp;*ainfo,&nbsp;gboolean&nbsp;simple)&nbsp;function.&lt;br&gt;&amp;gt;&nbsp;It&nbsp;doesn't&nbsp;work&nbsp;properly&nbsp;for&nbsp;MONO_TYPE_I8/MONO_TYPE_R8&nbsp;if&nbsp;just&nbsp;the&nbsp;first&nbsp;half&nbsp;fits&nbsp;in&nbsp;one&nbsp;register&nbsp;and&nbsp;the&nbsp;other&nbsp;on&nbsp;the&nbsp;stack.&lt;br&gt;&amp;gt;&nbsp;mono_arch_create_trampoline&nbsp;seems&nbsp;to&nbsp;handle&nbsp;this&nbsp;case.&lt;br&gt;&amp;gt;&nbsp;Is&nbsp;there&nbsp;an&nbsp;easy&nbsp;fix&nbsp;?&lt;br&gt;&lt;br&gt;You&nbsp;may&nbsp;want&nbsp;to&nbsp;try&nbsp;this&nbsp;mostly&nbsp;untested&nbsp;patch.&lt;br&gt;&lt;br&gt;lupus&lt;br&gt;&lt;br&gt;--&nbsp;&lt;br&gt;-----------------------------------------------------------------&lt;br&gt;lupus@debian.org&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debian/rules&lt;br&gt;lupus@ximian.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Monkeys&nbsp;do&nbsp;it&nbsp;better&lt;br&gt;Index:<br>
&nbsp;inssel-arm.brg&lt;br&gt;===================================================================&lt;br&gt;---&nbsp;inssel-arm.brg&nbsp;(revision&nbsp;67852)&lt;br&gt;+++&nbsp;inssel-arm.brg&nbsp;(working&nbsp;copy)&lt;br&gt;@@&nbsp;-274,6&nbsp;+274,21&nbsp;@@&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;stmt:&nbsp;OP_OUTARG_MEMBASE&nbsp;(lreg)&nbsp;{&lt;br&gt;&nbsp;&nbsp;int&nbsp;offset&nbsp;=&nbsp;tree-&amp;gt;backend.arg_info&nbsp;&amp;gt;&amp;gt;&nbsp;8;&lt;br&gt;+&nbsp;int&nbsp;partial&nbsp;=&nbsp;(tree-&amp;gt;backend.arg_info&nbsp;&amp;amp;&nbsp;0xff)&nbsp;==&nbsp;0xff;&lt;br&gt;+&nbsp;if&nbsp;(partial)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;MonoCallInst&nbsp;*call&nbsp;=&nbsp;(MonoCallInst*)tree-&amp;gt;inst_right;&lt;br&gt;+&nbsp;&nbsp;if&nbsp;(G_BYTE_ORDER&nbsp;==&nbsp;G_BIG_ENDIAN)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORE_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;offset,&nbsp;state-&amp;gt;left-&amp;gt;reg1);&lt;br&gt;+&nbsp;&nbsp;}&nbsp;else&nbsp;{&lt;br&gt;+&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORE_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;offset,&nbsp;state-&amp;gt;left-&amp;gt;reg2);&lt;br&gt;+&nbsp;&nbsp;}&lt;br&gt;+&nbsp;&nbsp;tree-&amp;gt;opcode&nbsp;=&nbsp;OP_SETREG;&lt;br&gt;+&nbsp;&nbsp;tree-&amp;gt;dreg&nbsp;=&nbsp;mono_regstate_next_int&nbsp;(s-&amp;gt;rs);&lt;br&gt;+&nbsp;&nbsp;tree-&amp;gt;sreg1&nbsp;=&nbsp;G_BYTE_ORDER&nbsp;==&nbsp;G_BIG_ENDIAN?&nbsp;state-&amp;gt;left-&amp;gt;reg2:&nbsp;state-&amp;gt;left-&amp;gt;reg1;&lt;br&gt;+&nbsp;&nbsp;mono_bblock_add_inst&nbsp;(s-&amp;gt;cbb,&nbsp;tree);&lt;br&gt;+&nbsp;&nbsp;mono_call_inst_add_outarg_reg<br>
&nbsp;(s,&nbsp;call,&nbsp;tree-&amp;gt;dreg,&nbsp;ARMREG_R3,&nbsp;FALSE);&lt;br&gt;+&nbsp;&nbsp;return;&lt;br&gt;+&nbsp;}&lt;br&gt;&nbsp;&nbsp;if&nbsp;(G_BYTE_ORDER&nbsp;==&nbsp;G_BIG_ENDIAN)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORE_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;offset,&nbsp;state-&amp;gt;left-&amp;gt;reg2);&lt;br&gt;&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORE_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;offset&nbsp;+&nbsp;4,&nbsp;state-&amp;gt;left-&amp;gt;reg1);&lt;br&gt;@@&nbsp;-286,6&nbsp;+301,7&nbsp;@@&lt;br&gt;&nbsp;stmt:&nbsp;OP_OUTARG_MEMBASE&nbsp;(freg)&nbsp;{&lt;br&gt;&nbsp;&nbsp;int&nbsp;offset&nbsp;=&nbsp;tree-&amp;gt;backend.arg_info&nbsp;&amp;gt;&amp;gt;&nbsp;8;&lt;br&gt;&nbsp;&nbsp;if&nbsp;(SOFT_FLOAT_IMPL)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;int&nbsp;partial&nbsp;=&nbsp;(tree-&amp;gt;backend.arg_info&nbsp;&amp;amp;&nbsp;0xff)&nbsp;==&nbsp;0xff;&lt;br&gt;&nbsp;&nbsp;&nbsp;/*&nbsp;same&nbsp;as&nbsp;OP_OUTARG_MEMBASE&nbsp;(lreg)&nbsp;*/&lt;br&gt;&nbsp;&nbsp;&nbsp;if&nbsp;(G_BYTE_ORDER&nbsp;==&nbsp;G_BIG_ENDIAN)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORE_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;offset,&nbsp;state-&amp;gt;left-&amp;gt;reg2);&lt;br&gt;@@&nbsp;-299,7&nbsp;+315,17&nbsp;@@&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORER8_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;offset,&nbsp;state-&amp;gt;left-&amp;gt;reg1);&lt;br&gt;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;((tree-&amp;gt;backend.arg_info&nbsp;&amp;amp;&nbsp;0xff)&nbsp;==&nbsp;4)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORER4_MEMBASE_REG,<br>
&nbsp;ARMREG_SP,&nbsp;offset,&nbsp;state-&amp;gt;left-&amp;gt;reg1);&lt;br&gt;-&nbsp;&nbsp;else&lt;br&gt;+&nbsp;&nbsp;else&nbsp;if&nbsp;((tree-&amp;gt;backend.arg_info&nbsp;&amp;amp;&nbsp;0xff)&nbsp;==&nbsp;0xff)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;&nbsp;MonoCallInst&nbsp;*call&nbsp;=&nbsp;(MonoCallInst*)tree-&amp;gt;inst_right;&lt;br&gt;+&nbsp;&nbsp;&nbsp;int&nbsp;creg;&lt;br&gt;+&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORER8_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;(s-&amp;gt;param_area&nbsp;-&nbsp;8),&nbsp;state-&amp;gt;left-&amp;gt;reg1);&lt;br&gt;+&nbsp;&nbsp;&nbsp;creg&nbsp;=&nbsp;mono_regstate_next_int&nbsp;(s-&amp;gt;rs);&lt;br&gt;+&nbsp;&nbsp;&nbsp;mono_call_inst_add_outarg_reg&nbsp;(s,&nbsp;call,&nbsp;creg,&nbsp;ARMREG_R3,&nbsp;FALSE);&lt;br&gt;+&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_LOAD_MEMBASE_OP&nbsp;(s,&nbsp;OP_LOAD_MEMBASE,&nbsp;creg,&nbsp;ARMREG_SP,&nbsp;(s-&amp;gt;param_area&nbsp;-&nbsp;8));&lt;br&gt;+&nbsp;&nbsp;&nbsp;creg&nbsp;=&nbsp;mono_regstate_next_int&nbsp;(s-&amp;gt;rs);&lt;br&gt;+&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_LOAD_MEMBASE_OP&nbsp;(s,&nbsp;OP_LOAD_MEMBASE,&nbsp;creg,&nbsp;ARMREG_SP,&nbsp;(s-&amp;gt;param_area&nbsp;-&nbsp;4));&lt;br&gt;+&nbsp;&nbsp;&nbsp;MONO_EMIT_NEW_STORE_MEMBASE&nbsp;(s,&nbsp;OP_STORE_MEMBASE_REG,&nbsp;ARMREG_SP,&nbsp;offset,&nbsp;creg);&lt;br&gt;+&nbsp;&nbsp;}&nbsp;else&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;g_assert_not_reached&nbsp;();&lt;br&gt;&nbsp;&nbsp;}&lt;br&gt;&nbsp;}&lt;br&gt;Index:&nbsp;mini-arm.c&lt;br&gt;===================================================================&lt;br&gt;---&nbsp;mini-arm.c&nbsp;(revision&nbsp;67852)&lt;br&gt;+++&nbsp;mini-arm.c<br>
&nbsp;(working&nbsp;copy)&lt;br&gt;@@&nbsp;-318,6&nbsp;+318,7&nbsp;@@&lt;br&gt;&nbsp;enum&nbsp;{&lt;br&gt;&nbsp;&nbsp;RegTypeGeneral,&lt;br&gt;&nbsp;&nbsp;RegTypeBase,&lt;br&gt;+&nbsp;RegTypeBaseGen,&lt;br&gt;&nbsp;&nbsp;RegTypeFP,&lt;br&gt;&nbsp;&nbsp;RegTypeStructByVal,&lt;br&gt;&nbsp;&nbsp;RegTypeStructByAddr&lt;br&gt;@@&nbsp;-355,7&nbsp;+356,13&nbsp;@@&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;ainfo-&amp;gt;reg&nbsp;=&nbsp;*gr;&lt;br&gt;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&nbsp;&nbsp;}&nbsp;else&nbsp;{&lt;br&gt;-&nbsp;&nbsp;if&nbsp;(*gr&nbsp;&amp;gt;&nbsp;ARMREG_R2)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;if&nbsp;(*gr&nbsp;==&nbsp;ARMREG_R3)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;&nbsp;/*&nbsp;first&nbsp;word&nbsp;in&nbsp;r3&nbsp;and&nbsp;the&nbsp;second&nbsp;on&nbsp;the&nbsp;stack&nbsp;*/&lt;br&gt;+&nbsp;&nbsp;&nbsp;ainfo-&amp;gt;offset&nbsp;=&nbsp;*stack_size;&lt;br&gt;+&nbsp;&nbsp;&nbsp;ainfo-&amp;gt;reg&nbsp;=&nbsp;ARMREG_SP;&nbsp;/*&nbsp;in&nbsp;the&nbsp;caller&nbsp;*/&lt;br&gt;+&nbsp;&nbsp;&nbsp;ainfo-&amp;gt;regtype&nbsp;=&nbsp;RegTypeBaseGen;&lt;br&gt;+&nbsp;&nbsp;&nbsp;*stack_size&nbsp;+=&nbsp;4;&lt;br&gt;+&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(*gr&nbsp;&amp;gt;&nbsp;ARMREG_R3)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;/**stack_size&nbsp;+=&nbsp;7;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;*stack_size&nbsp;&amp;amp;=&nbsp;~7;*/&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;ainfo-&amp;gt;offset&nbsp;=&nbsp;*stack_size;&lt;br&gt;@@&nbsp;-820,6&nbsp;+827,12&nbsp;@@&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(ainfo-&amp;gt;regtype&nbsp;==&nbsp;RegTypeBase)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg-&amp;gt;opcode&nbsp;=&nbsp;OP_OUTARG_MEMBASE;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg-&amp;gt;backend.arg_info&nbsp;=&nbsp;(ainfo-&amp;gt;offset&nbsp;&amp;lt;&amp;lt;&nbsp;8)&nbsp;|&nbsp;ainfo-&amp;gt;size;&lt;br&gt;+&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(ainfo-&amp;gt;regtype&nbsp;==&nbsp;RegTypeBaseGen)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;call-&amp;gt;used_iregs&nbsp;|=&nbsp;1&nbsp;&amp;lt;&amp;lt;&nbsp;ARMREG_R3;&lt;br&gt;+&nbsp;<br>
&nbsp;&nbsp;&nbsp;arg-&amp;gt;opcode&nbsp;=&nbsp;OP_OUTARG_MEMBASE;&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;arg-&amp;gt;backend.arg_info&nbsp;=&nbsp;(ainfo-&amp;gt;offset&nbsp;&amp;lt;&amp;lt;&nbsp;8)&nbsp;|&nbsp;0xff;&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(arg-&amp;gt;type&nbsp;==&nbsp;STACK_R8)&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cfg-&amp;gt;flags&nbsp;|=&nbsp;MONO_CFG_HAS_FPOUT;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(ainfo-&amp;gt;regtype&nbsp;==&nbsp;RegTypeFP)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg-&amp;gt;backend.reg3&nbsp;=&nbsp;ainfo-&amp;gt;reg;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;FP&nbsp;args&nbsp;are&nbsp;passed&nbsp;in&nbsp;int&nbsp;regs&nbsp;*/&lt;br&gt;@@&nbsp;-2984,6&nbsp;+2997,12&nbsp;@@&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;+&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(ainfo-&amp;gt;regtype&nbsp;==&nbsp;RegTypeBaseGen)&nbsp;{&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;g_assert&nbsp;(arm_is_imm12&nbsp;(prev_sp_offset&nbsp;+&nbsp;ainfo-&amp;gt;offset));&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;g_assert&nbsp;(arm_is_imm12&nbsp;(inst-&amp;gt;inst_offset));&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;ARM_LDR_IMM&nbsp;(code,&nbsp;ARMREG_LR,&nbsp;ARMREG_SP,&nbsp;(prev_sp_offset&nbsp;+&nbsp;ainfo-&amp;gt;offset));&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;ARM_STR_IMM&nbsp;(code,&nbsp;ARMREG_LR,&nbsp;inst-&amp;gt;inst_basereg,&nbsp;inst-&amp;gt;inst_offset&nbsp;+&nbsp;4);&lt;br&gt;+&nbsp;&nbsp;&nbsp;&nbsp;ARM_STR_IMM&nbsp;(code,&nbsp;ARMREG_R3,&nbsp;inst-&amp;gt;inst_basereg,&nbsp;inst-&amp;gt;inst_offset);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(ainfo-&amp;gt;regtype&nbsp;==&nbsp;RegTypeBase)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_assert&nbsp;(arm_is_imm12&nbsp;(prev_sp_offset&nbsp;+&nbsp;ainfo-&amp;gt;offset));&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch<br>
&nbsp;(ainfo-&amp;gt;size)&nbsp;{&lt;br&gt;_______________________________________________&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;Mono-devel-list@lists.ximian.com&lt;br&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;p&gt;&amp;#32;<br>
<br>
&lt;hr&nbsp;size=1&gt;Cheap&nbsp;Talk?&nbsp;&lt;a&nbsp;href=&quot;http://us.rd.yahoo.com/mail_us/taglines/postman8/*http://us.rd.yahoo.com/evt=39663/*http://voice.yahoo.com&quot;&gt;Check&nbsp;out&lt;/a&gt;&nbsp;Yahoo!&nbsp;Messenger's&nbsp;low&nbsp;PC-to-Phone&nbsp;call&nbsp;rates.
</tt>
