Index: System.Text.RegularExpressions/quicksearch.cs
===================================================================
--- System.Text.RegularExpressions/quicksearch.cs	(revision 79685)
+++ System.Text.RegularExpressions/quicksearch.cs	(working copy)
@@ -160,44 +160,77 @@
 			// private
 
 		private void SetupShiftTable () {
-			shift = new Hashtable ();
-			if (reverse)
-			{
-				for (int i = len ; i > 0; -- i) 
-				{
-					char c = str[i -1];
-					shift[GetChar(c)] = i;
-				}
+			bool needsExtendedTable = len > (byte.MaxValue - 1);
+
+			byte maxLowChar = 0;
+			for (int i = 0; i < len; i++) {
+				char cur = str [i];
+				if (cur <= (char)byte.MaxValue) {
+					if ((byte)cur > maxLowChar)
+						maxLowChar = (byte)cur;				
+				} else
+					needsExtendedTable = true;
 			}
-			else
-			{
-				for (int i = 0; i < len; ++ i) 
-				{
-					char c = str[i];
-					shift[GetChar(c)] = len - i;
+			
+			shift = new byte [maxLowChar + 1];
+			if (needsExtendedTable)
+				shiftExtended = new Hashtable ();
+
+			for (int i = 0, j = len; i < len; i++, j--) {
+				char c = str [(!reverse ? i : j - 1)];
+				if (c < shift.Length) {
+					if (j <= byte.MaxValue) {
+						shift [c] = (byte)(j - 1);
+						continue;
+					} else {
+						shift [c] = byte.MaxValue;
+					}
 				}
+				shiftExtended [c] = j;
 			}
-			
 		}
 	    
 		private int GetShiftDistance (char c) {
-			if(shift == null)
+			if (shiftExtended == null)
 				return 1;
+				
+			c = GetChar (c);
+			if (c < shift.Length) {
+				int dist = shift [c];
+				switch (dist) {
+					case 0:
+						return len + 1;
 
-			object s = shift [GetChar (c)];
+					case byte.MaxValue:
+						break;
+
+					default:
+						return dist + 1;
+				}
+			}
+
+			if (shiftExtended == null)
+				return len + 1;
+
+			object s = shiftExtended [c];
 			return (s != null ? (int)s : len + 1);
 		}
 
 		private char GetChar(char c) {
 			return (!ignore ? c : Char.ToLower(c));
 		}
-		
+
 		private string str;
 		private int len;
 		private bool ignore;
 		private bool reverse;
 
-		private Hashtable shift;
+		// shift[idx] contains value x  means 
+		//  x == 0             => shift dist. == len + 1
+		//  x == byte.Maxvalue => shift dist. > 255, look it up in shiftExtended
+		//  otherwise          => shift dist. == x + 1 
+		private byte[] shift;
+		private Hashtable shiftExtended;
 		private readonly static int THRESHOLD = 5;
 	}
 
