<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Neale,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;should&nbsp;change&nbsp;from SIZE_MAX&nbsp;to&nbsp;the&nbsp;max&nbsp;value&nbsp;a&nbsp;ssize_t&nbsp;can&nbsp;hold.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;Rodrigo&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Thu,&nbsp;Jun&nbsp;12,&nbsp;2014&nbsp;at&nbsp;4:38&nbsp;PM,&nbsp;Neale&nbsp;Ferguson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:NealeFerguson@verizon.net&quot;&nbsp;target=&quot;_blank&quot;&gt;NealeFerguson@verizon.net&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
The&nbsp;following&nbsp;program&nbsp;runs&nbsp;fine&nbsp;on&nbsp;.NET&nbsp;-&lt;br&gt;<br>
&lt;br&gt;<br>
using&nbsp;System;&lt;br&gt;<br>
using&nbsp;System.Collections.Generic;&lt;br&gt;<br>
using&nbsp;System.Runtime;&lt;br&gt;<br>
using&nbsp;System.Text;&lt;br&gt;<br>
&lt;br&gt;<br>
namespace&nbsp;LargeObjectTest&lt;br&gt;<br>
{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;class&nbsp;Program&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;static&nbsp;void&nbsp;Main(string[]&nbsp;args)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IList&lt;double&gt;&nbsp;myList&nbsp;=&nbsp;new&nbsp;List&lt;double&gt;();&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;long&nbsp;index&nbsp;=&nbsp;1024*1024*1024;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;index:&quot;&nbsp;+&nbsp;index);&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;double[]&nbsp;array&nbsp;=&nbsp;null;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;UInt32.MaxValue:&nbsp;&quot;+UInt32.MaxValue);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;array&nbsp;=&nbsp;new&nbsp;double[index];&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;doubleArray:LongLength&nbsp;&quot;&nbsp;+&nbsp;array.Length&nbsp;*&nbsp;sizeof(double)&nbsp;+&nbsp;&quot;&nbsp;bytes&quot;);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;sizeof(double)&nbsp;&quot;&nbsp;+&nbsp;sizeof(double)&nbsp;+&nbsp;&quot;&nbsp;bytes&quot;);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;index&nbsp;&quot;&nbsp;+&nbsp;index);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;doubleArray:LongLength&nbsp;&quot;&nbsp;+&nbsp;array.LongLength);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;doubleArray:Size&nbsp;&quot;&nbsp;+&nbsp;array.LongLength&nbsp;*&nbsp;sizeof(double)&nbsp;*&nbsp;1.0&nbsp;+&nbsp;&quot;&nbsp;Bytes&quot;);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;catch&nbsp;(Exception&nbsp;e)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;Exception:&quot;&nbsp;+&nbsp;e);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;Exception:&quot;&nbsp;+&nbsp;e.Message&nbsp;+&nbsp;&quot;&nbsp;allocating&nbsp;:&quot;&nbsp;+&nbsp;index);&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;Exception:&quot;&nbsp;+&nbsp;e.Message&nbsp;+&nbsp;&quot;&nbsp;allocating&nbsp;:&quot;&nbsp;+&nbsp;index&nbsp;*&nbsp;sizeof(double));&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;on&nbsp;mono&nbsp;on&nbsp;Linux&nbsp;it&nbsp;results&nbsp;in:&lt;br&gt;<br>
&lt;br&gt;<br>
index:1073741824&lt;br&gt;<br>
UInt32.MaxValue:&nbsp;4294967295&lt;br&gt;<br>
Exception:System.OutOfMemoryException:&nbsp;Out&nbsp;of&nbsp;memory&lt;br&gt;<br>
 &nbsp;at&nbsp;(wrapper&nbsp;managed-to-native)&nbsp;object:__icall_wrapper_mono_array_new_specific&nbsp;(intptr,int)&lt;br&gt;<br>
 &nbsp;at&nbsp;LargeObjectTest.Program.Main&nbsp;(System.String[]&nbsp;args)&nbsp;[0x00000]&nbsp;in&nbsp;&lt;filename&nbsp;unknown&gt;:0&lt;br&gt;<br>
Exception:Out&nbsp;of&nbsp;memory&nbsp;allocating&nbsp;:1073741824&lt;br&gt;<br>
Exception:Out&nbsp;of&nbsp;memory&nbsp;allocating&nbsp;:8589934592&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;I&nbsp;make&nbsp;the&nbsp;following&nbsp;change&nbsp;to&nbsp;override&nbsp;the&nbsp;SIZE_MAX&nbsp;value&nbsp;from&nbsp;/usr/include/stdint.h:&lt;br&gt;<br>
&lt;br&gt;<br>
---&nbsp;a/mono/metadata/sgen-los.c&lt;br&gt;<br>
+++&nbsp;b/mono/metadata/sgen-los.c&lt;br&gt;<br>
@@&nbsp;-342,8&nbsp;+342,12&nbsp;@@&nbsp;sgen_los_alloc_large_inner&nbsp;(MonoVTable&nbsp;*vtable,&nbsp;size_t&nbsp;size)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; *&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; *&nbsp;size&nbsp;&lt;=&nbsp;SIZE_MAX&nbsp;-&nbsp;(mono_pagesize&nbsp;()&nbsp;-&nbsp;1)&nbsp;-&nbsp;sizeof&nbsp;(LOSObject)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; */&lt;br&gt;<br>
+#undef&nbsp;SIZE_MAX&lt;br&gt;<br>
+#define&nbsp;SIZE_MAX&nbsp;(17179869184U)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(size&nbsp;&gt;&nbsp;SIZE_MAX&nbsp;-&nbsp;(mono_pagesize&nbsp;()&nbsp;-&nbsp;1)&nbsp;-&nbsp;sizeof&nbsp;(LOSObject))&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;NULL;&lt;br&gt;<br>
+#undef&nbsp;SIZE_MAX&lt;br&gt;<br>
+#define&nbsp;SIZE_MAX&nbsp;(4294967295U)&lt;br&gt;<br>
&lt;br&gt;<br>
 #ifdef&nbsp;LOS_DUMMY&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(!los_segment)&lt;br&gt;<br>
&lt;br&gt;<br>
Then&nbsp;the&nbsp;program&nbsp;works&nbsp;as&nbsp;it&nbsp;does&nbsp;under&nbsp;.NET:&lt;br&gt;<br>
&lt;br&gt;<br>
index:1073741824&lt;br&gt;<br>
UInt32.MaxValue:&nbsp;4294967295&lt;br&gt;<br>
doubleArray:LongLength&nbsp;0&nbsp;bytes&lt;br&gt;<br>
sizeof(double)&nbsp;8&nbsp;bytes&lt;br&gt;<br>
index&nbsp;1073741824&lt;br&gt;<br>
doubleArray:LongLength&nbsp;1073741824&lt;br&gt;<br>
doubleArray:Size&nbsp;8589934592&nbsp;Bytes&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;question&nbsp;is,&nbsp;what&nbsp;is&nbsp;the&nbsp;correct&nbsp;value&nbsp;for&nbsp;the&nbsp;comparison&nbsp;in&nbsp;lieu&nbsp;of&nbsp;SIZE_MAX?&nbsp;I&nbsp;can&#39;t&nbsp;determine&nbsp;what&nbsp;the&nbsp;max&nbsp;is&nbsp;on&nbsp;.NET.&nbsp;Another&nbsp;question&nbsp;is&nbsp;what&nbsp;type&nbsp;of&nbsp;compacting&nbsp;happens&nbsp;with&nbsp;large&nbsp;objects&nbsp;like&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
Neale&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
