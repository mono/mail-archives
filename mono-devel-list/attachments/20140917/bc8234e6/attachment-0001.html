<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;style&gt;&lt;!--<br>
.hmmessage&nbsp;P<br>
{<br>
margin:0px;<br>
padding:0px<br>
}<br>
body.hmmessage<br>
{<br>
font-size:&nbsp;12pt;<br>
font-family:Î¢ÈíÑÅºÚ<br>
}<br>
--&gt;&lt;/style&gt;&lt;/head&gt;<br>
&lt;body&nbsp;class='hmmessage'&gt;&lt;div&nbsp;dir='ltr'&gt;i&nbsp;saw&nbsp;the&nbsp;bug&nbsp;you&nbsp;have&nbsp;opened,&nbsp;the&nbsp;behavior&nbsp;is&nbsp;pretty&nbsp;interesting,&nbsp;which&nbsp;is&nbsp;out&nbsp;of&nbsp;my&nbsp;expectation.&nbsp;thank&nbsp;you&nbsp;for&nbsp;the&nbsp;information.&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Hzj_jie&lt;br&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[Mono-dev]&nbsp;a&nbsp;set&nbsp;of&nbsp;tests&nbsp;to&nbsp;find&nbsp;out&nbsp;the&nbsp;difference&nbsp;between&nbsp;.Net&nbsp;and&nbsp;Mono&nbsp;implementation&lt;br&gt;&gt;&nbsp;From:&nbsp;jonpryor@vt.edu&lt;br&gt;&gt;&nbsp;Date:&nbsp;Tue,&nbsp;16&nbsp;Sep&nbsp;2014&nbsp;12:31:37&nbsp;-0400&lt;br&gt;&gt;&nbsp;CC:&nbsp;mono-devel-list@lists.ximian.com&lt;br&gt;&gt;&nbsp;To:&nbsp;hzj_jie@hotmail.com&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;On&nbsp;Sep&nbsp;16,&nbsp;2014,&nbsp;at&nbsp;6:10&nbsp;AM,&nbsp;ºÎ×Ó½ÜHzj_jie&nbsp;&lt;hzj_jie@hotmail.com&gt;&nbsp;wrote:&lt;br&gt;&gt;&nbsp;&gt;&nbsp;1.&nbsp;GC&lt;br&gt;&gt;&nbsp;&gt;&nbsp;thought&nbsp;GC.Collect()&nbsp;does&nbsp;not&nbsp;guarantee&nbsp;all&nbsp;the&nbsp;inaccessible&nbsp;objects&nbsp;are&nbsp;finalized&nbsp;and&nbsp;reclaimed,&nbsp;.Net&nbsp;implementation&nbsp;usually&nbsp;be&nbsp;able&nbsp;to&nbsp;delete&nbsp;all&nbsp;the&nbsp;inaccessible&nbsp;objects.&lt;br&gt;&gt;&nbsp;&gt;&nbsp;impacts,&nbsp;delegate_pinning_test,&nbsp;it&nbsp;make&nbsp;sure&nbsp;the&nbsp;delegate&nbsp;/&nbsp;event&nbsp;in&nbsp;.net&nbsp;will&nbsp;release&nbsp;the&nbsp;object&nbsp;after&nbsp;itself&nbsp;has&nbsp;been&nbsp;released.&lt;br&gt;&gt;&nbsp;&gt;&nbsp;weak_pointer_test,&nbsp;weak_pointer&nbsp;is&nbsp;a&nbsp;simple&nbsp;wrapper&nbsp;of&nbsp;WeakReference,&nbsp;which&nbsp;is&nbsp;strong-typed.&lt;br&gt;&gt;&nbsp;&gt;&nbsp;event_disposer_test,&nbsp;event_disposer&nbsp;is&nbsp;a&nbsp;strong-typed&nbsp;pointer,&nbsp;which&nbsp;provide&nbsp;disposing&nbsp;event&nbsp;when&nbsp;disposing.&lt;br&gt;&gt;&nbsp;&gt;&nbsp;lifetime_binder_test,&nbsp;lifetime_binder&nbsp;is&nbsp;a&nbsp;collection&nbsp;to&nbsp;avoid&nbsp;the&nbsp;object&nbsp;to&nbsp;be&nbsp;finalized.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;Developers&nbsp;need&nbsp;to&nbsp;write&nbsp;tests&nbsp;for&nbsp;finalizers,&nbsp;and&nbsp;writing&nbsp;tests&nbsp;for&nbsp;finalizers&nbsp;can&nbsp;be&nbsp;tricky&nbsp;for&nbsp;a&nbsp;variety&nbsp;of&nbsp;reasons.&nbsp;As&nbsp;such,&nbsp;it&nbsp;is&nbsp;quite&nbsp;possible&nbsp;that&nbsp;a&nbsp;GC-related&nbsp;test&nbsp;that&nbsp;&quot;works&quot;&nbsp;on&nbsp;.NET&nbsp;won't&nbsp;work&nbsp;on&nbsp;Mono&nbsp;w/o&nbsp;change.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;test&nbsp;your&nbsp;class'&nbsp;finalizer,&nbsp;then&nbsp;you&nbsp;need&nbsp;to&nbsp;use&nbsp;two&nbsp;threads&nbsp;+&nbsp;WeakReference:&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&nbsp;WeakReference&nbsp;r&nbsp;=&nbsp;null;&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;var&nbsp;t&nbsp;=&nbsp;new&nbsp;Thread&nbsp;(()&nbsp;=&gt;&nbsp;{&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;v&nbsp;=&nbsp;new&nbsp;ClassToTest&nbsp;();&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;new&nbsp;WeakReference&nbsp;(t);&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Start&nbsp;();&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Join&nbsp;();&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GC.Collect&nbsp;();&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;GC.WaitForPendingFinalizers&nbsp;();&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;can&nbsp;now&nbsp;[0]&nbsp;check&nbsp;r.IsAlive,&nbsp;etc.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;The&nbsp;reason&nbsp;you&nbsp;create&nbsp;the&nbsp;instance&nbsp;+&nbsp;WeakReference&nbsp;on&nbsp;another&nbsp;thread&nbsp;is&nbsp;because&nbsp;Mono's&nbsp;GC&nbsp;will&nbsp;*conservatively*&nbsp;scan&nbsp;the&nbsp;thread's&nbsp;heap&nbsp;looking&nbsp;for&nbsp;valid&nbsp;references.&nbsp;By&nbsp;using&nbsp;a&nbsp;new&nbsp;thread&nbsp;*which&nbsp;exits*,&nbsp;the&nbsp;conservative&nbsp;stack&nbsp;scan&nbsp;will&nbsp;&quot;skip&quot;&nbsp;the&nbsp;exited&nbsp;thread,&nbsp;and&nbsp;thus&nbsp;won't&nbsp;find&nbsp;any&nbsp;valid&nbsp;references&nbsp;to&nbsp;the&nbsp;allocated&nbsp;instance.&nbsp;This&nbsp;in&nbsp;turn&nbsp;allows&nbsp;you&nbsp;to&nbsp;use&nbsp;the&nbsp;WeakReference&nbsp;to&nbsp;determine&nbsp;if&nbsp;the&nbsp;instance&nbsp;has&nbsp;in&nbsp;fact&nbsp;been&nbsp;collected.&nbsp;(Or&nbsp;not,&nbsp;if&nbsp;your&nbsp;ClassToTest&nbsp;registers&nbsp;itself&nbsp;with&nbsp;some&nbsp;static&nbsp;collection&nbsp;or&nbsp;something...)&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&nbsp;-&nbsp;Jon&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;[0]:&nbsp;https://bugzilla.xamarin.com/show_bug.cgi?id=20503&lt;br&gt;&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
