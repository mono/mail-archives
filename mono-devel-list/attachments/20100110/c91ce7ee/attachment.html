<tt>
Alternatively&nbsp;you&nbsp;could&nbsp;just&nbsp;allocate&nbsp;and&nbsp;retain&nbsp;a&nbsp;1&nbsp;byte&nbsp;array&nbsp;inside&nbsp;the&nbsp;BufferedStream&nbsp;class&nbsp;and&nbsp;constantly&nbsp;re-use&nbsp;it.&nbsp;BinaryReader&nbsp;already&nbsp;uses&nbsp;this&nbsp;approach.&nbsp;As&nbsp;BufferedStream&nbsp;is&nbsp;sealed,&nbsp;the&nbsp;exact&nbsp;approach&nbsp;used&nbsp;doesn&amp;#39;t&nbsp;particularly&nbsp;matter&nbsp;as&nbsp;the&nbsp;user&nbsp;can&amp;#39;t&nbsp;tell&nbsp;the&nbsp;difference.&lt;br&gt;<br>
&lt;br&gt;Would&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;Stream&nbsp;subclasses&nbsp;benefit&nbsp;from&nbsp;similar&nbsp;optimisations?&nbsp;&lt;br&gt;&lt;br&gt;Alan.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Jan&nbsp;10,&nbsp;2010&nbsp;at&nbsp;3:35&nbsp;PM,&nbsp;Tom&nbsp;Philpot&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tom.philpot@logos.com&quot;&gt;tom.philpot@logos.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;It&nbsp;looks&nbsp;like&nbsp;the&nbsp;implementation&nbsp;of&nbsp;ReadByte&nbsp;and&nbsp;WriteByte&nbsp;in&nbsp;BufferedStream&nbsp;follow&nbsp;the&nbsp;default&nbsp;behavior&nbsp;for&nbsp;Stream&nbsp;by&nbsp;allocating&nbsp;a&nbsp;1-byte&nbsp;array&nbsp;and&nbsp;then&nbsp;calling&nbsp;Read()&nbsp;or&nbsp;Write().&nbsp;This&nbsp;is&nbsp;exactly&nbsp;what&nbsp;the&nbsp;MSDN&nbsp;docs&nbsp;for&nbsp;ReadByte&nbsp;and&nbsp;WriteByte&nbsp;ask&nbsp;implementers&nbsp;NOT&nbsp;to&nbsp;do:&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&amp;gt;From&nbsp; &lt;a&nbsp;href=&quot;http://msdn.microsoft.com/en-us/library/system.io.stream.readbyte.aspx&quot;&nbsp;target=&quot;_blank&quot;&gt;http://msdn.microsoft.com/en-us/library/system.io.stream.readbyte.aspx&lt;/a&gt;&lt;br&gt;<br>
Notes&nbsp;to&nbsp;Implementers:&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;default&nbsp;implementation&nbsp;on&nbsp;Stream&nbsp;creates&nbsp;a&nbsp;new&nbsp;single-byte&nbsp;array&nbsp;and&nbsp;then&nbsp;calls&nbsp;Read.&nbsp;While&nbsp;this&nbsp;is&nbsp;formally&nbsp;correct,&nbsp;it&nbsp;is&nbsp;inefficient.&nbsp;Any&nbsp;stream&nbsp;with&nbsp;an&nbsp;internal&nbsp;buffer&nbsp;should&nbsp;override&nbsp;this&nbsp;method&nbsp;and&nbsp;provide&nbsp;a&nbsp;much&nbsp;more&nbsp;efficient&nbsp;version&nbsp;that&nbsp;reads&nbsp;the&nbsp;buffer&nbsp;directly,&nbsp;avoiding&nbsp;the&nbsp;extra&nbsp;array&nbsp;allocation&nbsp;on&nbsp;every&nbsp;call.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Granted,&nbsp;most&nbsp;people&nbsp;don&amp;#39;t&nbsp;really&nbsp;ever&nbsp;read&nbsp;one&nbsp;byte&nbsp;at&nbsp;a&nbsp;time&nbsp;from&nbsp;a&nbsp;Stream,&nbsp;but&nbsp;in&nbsp;our&nbsp;case,&nbsp;we&nbsp;need&nbsp;to.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;my&nbsp;simple&nbsp;tests,&nbsp;reading&nbsp;1.5&nbsp;GB&nbsp;of&nbsp;data&nbsp;using&nbsp;ReadByte&nbsp;from&nbsp;BufferedStream&nbsp;versus&nbsp;FileStream&nbsp;yielded&nbsp;the&nbsp;following&nbsp;the&nbsp;following&nbsp;results&nbsp;(Late&nbsp;2008&nbsp;MacBook&nbsp;13.3&amp;quot;&nbsp;2.0&nbsp;Ghz,&nbsp;5400&nbsp;rpm&nbsp;disk):&lt;br&gt;<br>
Test&nbsp;#1:&lt;br&gt;<br>
Using&nbsp;default&nbsp;BufferedStream&nbsp;ReadByte&nbsp;implementation:&nbsp;763.814&nbsp;seconds&lt;br&gt;<br>
Using&nbsp;FileStream&nbsp;ReadByte&nbsp;implementation:&nbsp;43.53&nbsp;seconds&lt;br&gt;<br>
&lt;br&gt;<br>
Test&nbsp;#2:&lt;br&gt;<br>
Using&nbsp;default&nbsp;BufferedStream&nbsp;ReadByte&nbsp;implementation:&nbsp;765.427&nbsp;seconds&lt;br&gt;<br>
Using&nbsp;FileStream&nbsp;ReadByte&nbsp;implementation:&nbsp;42.678&nbsp;seconds&lt;br&gt;<br>
&lt;br&gt;<br>
Obviously&nbsp;the&nbsp;alloc&nbsp;and&nbsp;GC&nbsp;cost&nbsp;of&nbsp;this&nbsp;one&nbsp;byte&nbsp;array&nbsp;is&nbsp;huge.&nbsp;I&nbsp;just&nbsp;thought&nbsp;I&amp;#39;d&nbsp;throw&nbsp;this&nbsp;out&nbsp;there&nbsp;in&nbsp;case&nbsp;one&nbsp;of&nbsp;the&nbsp;Mono&nbsp;devs&nbsp;(or&nbsp;someone&nbsp;else)&nbsp;wanted&nbsp;to&nbsp;work&nbsp;on&nbsp;a&nbsp;patch&nbsp;before&nbsp;I&nbsp;got&nbsp;a&nbsp;chance&nbsp;to&nbsp;submit&nbsp;one&nbsp;sometime&nbsp;on&nbsp;Monday.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Tom&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
