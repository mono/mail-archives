using System;
using System.IO;
using System.Linq;
using System.Net;
using System.Threading;
using System.Web;

namespace DownloadTest
{
	class MainClass
	{
		public static void DownloadStuff(string downloadSourceFilePath, string downloadDestinationFilePath)
		{
			try
			{
				WebClient wc = new WebClient();
				wc.DownloadFile(new Uri(downloadSourceFilePath), downloadDestinationFilePath);
				System.Console.WriteLine("Downloaded {0} successfully.", downloadSourceFilePath);
			}
			catch (Exception e)
			{
				Console.Error.WriteLine(e.Message);
				Console.Error.WriteLine(e.StackTrace);
			}
		}

		public delegate void DownloaderDelegate(string downloadSourceFilePath, string downloadDestinationFilePath);
		
		public static void Main (string[] args)
		{
			// Points to an approx 75 MB Logos4Mac.dmg file hosted at S3.
			string file1 = "http://www.logos.com/logos4mac";
			string outputFile1 = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.Desktop), "DownloadTest1.tmp");

			DownloaderDelegate delegate1 = new DownloaderDelegate(MainClass.DownloadStuff);
			IAsyncResult result1 = delegate1.BeginInvoke(file1, outputFile1, null, null);
			Console.WriteLine("Ending call for delegate 1");
			delegate1.EndInvoke(result1);
		}
	}
}
