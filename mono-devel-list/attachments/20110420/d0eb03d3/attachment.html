<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#ffffff&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;04/20/2011&nbsp;12:00&nbsp;AM,&nbsp;Rodrigo&nbsp;Kumpera&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:BANLkTimQG0dqkk0LJ_k6YhoPUeCmw1JrhQ@mail.gmail.com&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Jeff,&nbsp;shouldn't&nbsp;this&nbsp;be&nbsp;part&nbsp;of&nbsp;eglib&nbsp;as&nbsp;a&nbsp;build&nbsp;time&nbsp;option?&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;suppose&nbsp;it&nbsp;could&nbsp;be,&nbsp;but&nbsp;I&nbsp;think&nbsp;the&nbsp;plan&nbsp;right&nbsp;now&nbsp;is&nbsp;to&nbsp;simply<br>
&nbsp;&nbsp;&nbsp;&nbsp;remove&nbsp;g_iconv()&nbsp;from&nbsp;eglib&nbsp;since&nbsp;eglib&nbsp;is&nbsp;supposed&nbsp;to&nbsp;remain&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;minimalist&nbsp;version&nbsp;of&nbsp;glib&nbsp;as&nbsp;per&nbsp;discussion&nbsp;with&nbsp;Miguel.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;It's&nbsp;also&nbsp;probably&nbsp;not&nbsp;very&nbsp;useful&nbsp;for&nbsp;most&nbsp;people&nbsp;who&nbsp;want&nbsp;to&nbsp;use<br>
&nbsp;&nbsp;&nbsp;&nbsp;g_iconv()&nbsp;to&nbsp;*just*&nbsp;have&nbsp;UTF-16/32BE/LE&nbsp;to&nbsp;UTF-8&nbsp;conversion.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Jeff&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:BANLkTimQG0dqkk0LJ_k6YhoPUeCmw1JrhQ@mail.gmail.com&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Apr&nbsp;19,&nbsp;2011&nbsp;10:06&nbsp;PM,&nbsp;&quot;Jeffrey<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stedfast&nbsp;(&lt;a&nbsp;moz-do-not-send=&quot;true&quot;&nbsp;href=&quot;mailto:fejj@gnome.org&quot;&gt;fejj@gnome.org&lt;/a&gt;)&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;mailto:mono-patches@lists.ximian.com&quot;&gt;mono-patches@lists.ximian.com&lt;/a&gt;&amp;gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;br&nbsp;type=&quot;attribution&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Branch:&nbsp;refs/heads/master&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Home:&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;https://github.com/mono/moon&quot;&gt;https://github.com/mono/moon&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Commit:&nbsp;caef081dc43c17327c37932f65264deec19d8022&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Author:&nbsp;Jeffrey&nbsp;Stedfast&nbsp;&amp;lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;mailto:fejj@gnome.org&quot;&gt;fejj@gnome.org&lt;/a&gt;&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Date:&nbsp;04/19/2011&nbsp;21:05:59&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;URL:&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
href=&quot;https://github.com/mono/moon/commit/caef081dc43c17327c37932f65264deec19d8022&quot;&gt;https://github.com/mono/moon/commit/caef081dc43c17327c37932f65264deec19d8022&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Implemented&nbsp;an&nbsp;iconv-like&nbsp;API&nbsp;for&nbsp;unicode&nbsp;conversion&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Changed&nbsp;paths:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;M&nbsp;src/Makefile.am&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Added&nbsp;paths:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;A&nbsp;src/miconv.cpp&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;A&nbsp;src/miconv.h&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Modified:&nbsp;src/Makefile.am&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;===================================================================&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;---&nbsp;a/src/Makefile.am&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+++&nbsp;b/src/Makefile.am&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;@@&nbsp;-78,6&nbsp;+78,7&nbsp;@@&nbsp;libmoon_include_headers&nbsp;=&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;medialog.h&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;mediaplayer.h&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;messaging.h&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;miconv.h&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;moon-curves.h&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;moonlightconfiguration.h\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;moon-path.h&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;@@&nbsp;-234,6&nbsp;+235,7&nbsp;@@&nbsp;dist_libmoon_la_SOURCES&nbsp;=&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;medialog.cpp&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;mediaplayer.cpp&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;messaging.cpp&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;miconv.cpp&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;moon-curves.c&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;moonlightconfiguration.cpp&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;moon-path.c&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Added:&nbsp;src/miconv.cpp&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;===================================================================&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;---&nbsp;/dev/null&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+++&nbsp;b/src/miconv.cpp&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;@@&nbsp;-0,0&nbsp;+1,344&nbsp;@@&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+/*&nbsp;-*-&nbsp;Mode:&nbsp;C++;&nbsp;tab-width:&nbsp;8;&nbsp;indent-tabs-mode:&nbsp;t;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c-basic-offset:&nbsp;8&nbsp;-*-&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+/*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;miconv.cpp:&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;Contact:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;Moonlight&nbsp;List&nbsp;(&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;mailto:moonlight-list@lists.ximian.com&quot;&gt;moonlight-list@lists.ximian.com&lt;/a&gt;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;Copyright&nbsp;2011&nbsp;Novell,&nbsp;Inc.&nbsp;(&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://www.novell.com&quot;&gt;http://www.novell.com&lt;/a&gt;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE&nbsp;file&nbsp;included&nbsp;with&nbsp;the&nbsp;distribution&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;details.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;config.h&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;glib.h&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;string.h&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;errno.h&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#include&nbsp;&quot;miconv.h&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+namespace&nbsp;Moonlight&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+enum&nbsp;Endian&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;LittleEndian,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;BigEndian&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+};&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+typedef&nbsp;int&nbsp;(*&nbsp;Decoder)&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+typedef&nbsp;int&nbsp;(*&nbsp;Encoder)&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&nbsp;decode_utf32&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf32&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&nbsp;decode_utf16&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf16&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&nbsp;decode_utf8&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&nbsp;encode_utf8&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;struct&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;const&nbsp;char&nbsp;*name;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Decoder&nbsp;decoder;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Encoder&nbsp;encoder;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Endian&nbsp;endian;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&nbsp;charsets[]&nbsp;=&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;{&nbsp;&quot;UTF-32BE&quot;,&nbsp;decode_utf32,&nbsp;NULL,&nbsp;BigEndian&nbsp;},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;{&nbsp;&quot;UTF-32LE&quot;,&nbsp;decode_utf32,&nbsp;NULL,&nbsp;LittleEndian&nbsp;},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;{&nbsp;&quot;UTF-16BE&quot;,&nbsp;decode_utf16,&nbsp;NULL,&nbsp;BigEndian&nbsp;},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;{&nbsp;&quot;UTF-16LE&quot;,&nbsp;decode_utf16,&nbsp;NULL,&nbsp;LittleEndian&nbsp;},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;{&nbsp;&quot;UTF-8&quot;,&nbsp;decode_utf8,&nbsp;encode_utf8,&nbsp;LittleEndian&nbsp;},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+};&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+struct&nbsp;_miconv_t&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Decoder&nbsp;decode;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Encoder&nbsp;encode;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Endian&nbsp;endian;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+};&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+miconv_t&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+miconv_open&nbsp;(const&nbsp;char&nbsp;*to,&nbsp;const&nbsp;char&nbsp;*from)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Decoder&nbsp;decoder&nbsp;=&nbsp;NULL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Encoder&nbsp;encoder&nbsp;=&nbsp;NULL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;Endian&nbsp;endian;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;miconv_t&nbsp;cd;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;guint&nbsp;i;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(!to&nbsp;||&nbsp;!from)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;(miconv_t)&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;G_N_ELEMENTS&nbsp;(charsets);&nbsp;i++)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(!strcmp&nbsp;(charsets[i].name,&nbsp;from))&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;decoder&nbsp;=&nbsp;charsets[i].decoder;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;endian&nbsp;=&nbsp;charsets[i].endian;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(!strcmp&nbsp;(charsets[i].name,&nbsp;to))&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;encoder&nbsp;=&nbsp;charsets[i].encoder;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(encoder&nbsp;==&nbsp;NULL&nbsp;||&nbsp;decoder&nbsp;==&nbsp;NULL)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;(miconv_t)&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;cd&nbsp;=&nbsp;(miconv_t)&nbsp;g_malloc&nbsp;(sizeof&nbsp;(*cd));&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;cd-&amp;gt;decode&nbsp;=&nbsp;decoder;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;cd-&amp;gt;encode&nbsp;=&nbsp;encoder;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;cd-&amp;gt;endian&nbsp;=&nbsp;endian;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;cd-&amp;gt;c&nbsp;=&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;cd;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+int&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+miconv_close&nbsp;(miconv_t&nbsp;cd)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;g_free&nbsp;(cd);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+int&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+miconv&nbsp;(miconv_t&nbsp;cd,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;size_t&nbsp;inleft,&nbsp;outleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;char&nbsp;*inptr,&nbsp;*outptr;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;int&nbsp;rc&nbsp;=&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(outbytes&nbsp;==&nbsp;NULL&nbsp;||&nbsp;outbytesleft&nbsp;==&nbsp;NULL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;/*&nbsp;reset&nbsp;converter&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;cd-&amp;gt;c&nbsp;=&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inleft&nbsp;=&nbsp;inbytesleft&nbsp;?&nbsp;*inbytesleft&nbsp;:&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inptr&nbsp;=&nbsp;inbytes&nbsp;?&nbsp;*inbytes&nbsp;:&nbsp;NULL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;outleft&nbsp;=&nbsp;*outbytesleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;outptr&nbsp;=&nbsp;*outbytes;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;=&nbsp;cd-&amp;gt;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;while&nbsp;(inleft&nbsp;&amp;gt;=&nbsp;0&nbsp;&amp;amp;&amp;amp;&nbsp;outleft&nbsp;&amp;gt;&nbsp;0)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(c&nbsp;==&nbsp;(gunichar)&nbsp;-1&nbsp;&amp;amp;&amp;amp;&nbsp;cd-&amp;gt;decode<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cd-&amp;gt;endian,&nbsp;&amp;amp;inptr,&nbsp;&amp;amp;inleft,&nbsp;&amp;amp;c)&nbsp;==&nbsp;-1)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;rc&nbsp;=&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;break;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(cd-&amp;gt;encode&nbsp;(c,&nbsp;&amp;amp;outptr,&nbsp;&amp;amp;outleft)&nbsp;==&nbsp;-1)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;rc&nbsp;=&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;break;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;=&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(inbytesleft)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytesleft&nbsp;=&nbsp;inleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(inbytes)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytes&nbsp;=&nbsp;inptr;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*outbytesleft&nbsp;=&nbsp;outleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*outbytes&nbsp;=&nbsp;outptr;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;cd-&amp;gt;c&nbsp;=&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;rc;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+decode_utf32&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar&nbsp;*inptr&nbsp;=&nbsp;(gunichar&nbsp;*)&nbsp;*inbytes;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;size_t&nbsp;inleft&nbsp;=&nbsp;*inbytesleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(inleft&nbsp;&amp;lt;&nbsp;4)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EINVAL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(endian&nbsp;==&nbsp;BigEndian)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;=&nbsp;GUINT32_FROM_BE&nbsp;(*inptr);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;else&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;=&nbsp;GUINT32_FROM_LE&nbsp;(*inptr);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inleft&nbsp;-=&nbsp;4;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inptr++;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(c&nbsp;&amp;gt;=&nbsp;2147483648UL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytes&nbsp;=&nbsp;(char&nbsp;*)&nbsp;inptr;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytesleft&nbsp;=&nbsp;inleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*outchar&nbsp;=&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf32&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+decode_utf16&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar2&nbsp;*inptr&nbsp;=&nbsp;(gunichar2&nbsp;*)&nbsp;*inbytes;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;size_t&nbsp;inleft&nbsp;=&nbsp;*inbytesleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar2&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar&nbsp;u;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(inleft&nbsp;&amp;lt;&nbsp;2)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EINVAL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(endian&nbsp;==&nbsp;BigEndian)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;u&nbsp;=&nbsp;GUINT16_FROM_BE&nbsp;(*inptr);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;else&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;u&nbsp;=&nbsp;GUINT16_FROM_LE&nbsp;(*inptr);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inleft&nbsp;-=&nbsp;2;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inptr++;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(u&nbsp;&amp;gt;=&nbsp;0xdc00&nbsp;&amp;amp;&amp;amp;&nbsp;u&nbsp;&amp;lt;=&nbsp;0xdfff)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;(u&nbsp;&amp;gt;=&nbsp;0xd800&nbsp;&amp;amp;&amp;amp;&nbsp;u&nbsp;&amp;lt;=&nbsp;0xdbff)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(inleft&nbsp;&amp;lt;&nbsp;2)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EINVAL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(endian&nbsp;==&nbsp;BigEndian)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;=&nbsp;GUINT16_FROM_BE&nbsp;(*inptr);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;else&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;=&nbsp;GUINT16_FROM_LE&nbsp;(*inptr);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inleft&nbsp;-=&nbsp;2;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inptr++;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;0xdc00&nbsp;||&nbsp;c&nbsp;&amp;gt;&nbsp;0xdfff)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;u&nbsp;=&nbsp;((u&nbsp;-&nbsp;0xd800)&nbsp;&amp;lt;&amp;lt;&nbsp;10)&nbsp;+&nbsp;(c&nbsp;-&nbsp;0xdc00)&nbsp;+<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0010000UL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytes&nbsp;=&nbsp;(char&nbsp;*)&nbsp;inptr;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytesleft&nbsp;=&nbsp;inleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*outchar&nbsp;=&nbsp;u;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf16&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+decode_utf8&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;size_t&nbsp;inleft&nbsp;=&nbsp;*inbytesleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;char&nbsp;*inptr&nbsp;=&nbsp;*inbytes;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;size_t&nbsp;i,&nbsp;len&nbsp;=&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;unsigned&nbsp;char&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;gunichar&nbsp;u;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;=&nbsp;*inptr++;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;0x80)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;/*&nbsp;simple&nbsp;ascii&nbsp;case&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xe0)&nbsp;==&nbsp;0xc0)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;&amp;amp;=&nbsp;0x1f;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;2;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xf0)&nbsp;==&nbsp;0xe0)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;&amp;amp;=&nbsp;0x0f;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;3;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xf8)&nbsp;==&nbsp;0xf0)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;&amp;amp;=&nbsp;0x07;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;4;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xfc)&nbsp;==&nbsp;0xf8)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;&amp;amp;=&nbsp;0x03;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;5;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xfe)&nbsp;==&nbsp;0xfc)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;&amp;amp;=&nbsp;0x01;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;6;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(len&nbsp;&amp;gt;&nbsp;inleft)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EINVAL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;u&nbsp;=&nbsp;c;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;for&nbsp;(i&nbsp;=&nbsp;1;&nbsp;i&nbsp;&amp;lt;&nbsp;len;&nbsp;i++)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;u&nbsp;&amp;lt;&amp;lt;=&nbsp;6&nbsp;|&nbsp;((*inptr)&nbsp;&amp;amp;&nbsp;0x3f);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;inptr++;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytesleft&nbsp;=&nbsp;inleft&nbsp;-&nbsp;len;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*inbytes&nbsp;=&nbsp;inptr;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*outchar&nbsp;=&nbsp;u;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+encode_utf8&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*outbytesleft)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;size_t&nbsp;outleft&nbsp;=&nbsp;*outbytesleft;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;char&nbsp;*outptr&nbsp;=&nbsp;*outbytes;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;size_t&nbsp;len,&nbsp;i;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;char&nbsp;base;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;128UL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;base&nbsp;=&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;2048UL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;base&nbsp;=&nbsp;192;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;2;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;65536UL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;base&nbsp;=&nbsp;224;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;3;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;2097152UL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;base&nbsp;=&nbsp;240;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;4;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;67108864UL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;base&nbsp;=&nbsp;248;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;5;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;2147483648UL)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;base&nbsp;=&nbsp;252;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;len&nbsp;=&nbsp;6;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&nbsp;else&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;EINVAL;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;if&nbsp;(outleft&nbsp;&amp;lt;&nbsp;len)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;errno&nbsp;=&nbsp;E2BIG;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;-1;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;for&nbsp;(i&nbsp;=&nbsp;len&nbsp;-&nbsp;1;&nbsp;i&nbsp;&amp;gt;&nbsp;0;&nbsp;i--)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;/*&nbsp;mask&nbsp;off&nbsp;6&nbsp;bits&nbsp;worth&nbsp;and&nbsp;add&nbsp;128&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;outptr[i]&nbsp;=&nbsp;128&nbsp;+&nbsp;(c&nbsp;&amp;amp;&nbsp;0x3f);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;c&nbsp;&amp;gt;&amp;gt;=&nbsp;6;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;/*&nbsp;first&nbsp;character&nbsp;has&nbsp;a&nbsp;different&nbsp;base&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;outptr[0]&nbsp;=&nbsp;base&nbsp;+&nbsp;(c&nbsp;&amp;amp;&nbsp;0x3f);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*outbytesleft&nbsp;=&nbsp;outleft&nbsp;-&nbsp;len;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*outbytes&nbsp;=&nbsp;outptr&nbsp;+&nbsp;len;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;return&nbsp;0;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+};&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Added:&nbsp;src/miconv.h&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;===================================================================&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;---&nbsp;/dev/null&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+++&nbsp;b/src/miconv.h&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;@@&nbsp;-0,0&nbsp;+1,35&nbsp;@@&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+/*&nbsp;-*-&nbsp;Mode:&nbsp;C++;&nbsp;tab-width:&nbsp;8;&nbsp;indent-tabs-mode:&nbsp;t;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c-basic-offset:&nbsp;8&nbsp;-*-&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+/*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;miconv.h:&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;Contact:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;Moonlight&nbsp;List&nbsp;(&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;mailto:moonlight-list@lists.ximian.com&quot;&gt;moonlight-list@lists.ximian.com&lt;/a&gt;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;Copyright&nbsp;2011&nbsp;Novell,&nbsp;Inc.&nbsp;(&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://www.novell.com&quot;&gt;http://www.novell.com&lt;/a&gt;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE&nbsp;file&nbsp;included&nbsp;with&nbsp;the&nbsp;distribution&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;details.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#ifndef&nbsp;__MICONV_H__&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#define&nbsp;__MICONV_H__&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;glib.h&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;sys/types.h&amp;gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+namespace&nbsp;Moonlight&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+G_BEGIN_DECLS&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+typedef&nbsp;struct&nbsp;_miconv_t&nbsp;*miconv_t;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+int&nbsp;miconv&nbsp;(miconv_t&nbsp;cd,&nbsp;char&nbsp;**inbytes,&nbsp;size_t<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*inbytesleft,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+miconv_t&nbsp;miconv_open&nbsp;(const&nbsp;char&nbsp;*to,&nbsp;const&nbsp;char&nbsp;*from);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+int&nbsp;miconv_close&nbsp;(miconv_t&nbsp;cd);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+G_END_DECLS&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+};&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+#endif&nbsp;/*&nbsp;__MICONV_H__&nbsp;*/&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;+&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;Mono-patches&nbsp;maillist&nbsp;-&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;mailto:Mono-patches@lists.ximian.com&quot;&gt;Mono-patches@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;gt;&nbsp;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-patches&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-patches&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
