<tt>
&lt;p&gt;Jeff,&nbsp;shouldn&amp;#39;t&nbsp;this&nbsp;be&nbsp;part&nbsp;of&nbsp;eglib&nbsp;as&nbsp;a&nbsp;build&nbsp;time&nbsp;option?&lt;/p&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Apr&nbsp;19,&nbsp;2011&nbsp;10:06&nbsp;PM,&nbsp;&amp;quot;Jeffrey&nbsp;Stedfast&nbsp;(&lt;a&nbsp;href=&quot;mailto:fejj@gnome.org&quot;&gt;fejj@gnome.org&lt;/a&gt;)&amp;quot;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mono-patches@lists.ximian.com&quot;&gt;mono-patches@lists.ximian.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&nbsp;type=&quot;attribution&quot;&gt;<br>
&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;Branch:&nbsp;refs/heads/master&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Home:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/mono/moon&quot;&gt;https://github.com/mono/moon&lt;/a&gt;&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;Commit:&nbsp;caef081dc43c17327c37932f65264deec19d8022&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;Author:&nbsp;Jeffrey&nbsp;Stedfast&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:fejj@gnome.org&quot;&gt;fejj@gnome.org&lt;/a&gt;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date:&nbsp;04/19/2011&nbsp;21:05:59&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;URL:&nbsp;&lt;a&nbsp;href=&quot;https://github.com/mono/moon/commit/caef081dc43c17327c37932f65264deec19d8022&quot;&gt;https://github.com/mono/moon/commit/caef081dc43c17327c37932f65264deec19d8022&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;Implemented&nbsp;an&nbsp;iconv-like&nbsp;API&nbsp;for&nbsp;unicode&nbsp;conversion&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;Changed&nbsp;paths:&lt;br&gt;&amp;gt;&nbsp;&nbsp;M&nbsp;src/Makefile.am&lt;br&gt;&amp;gt;&nbsp;Added&nbsp;paths:&lt;br&gt;&amp;gt;&nbsp;&nbsp;A&nbsp;src/miconv.cpp&lt;br&gt;&amp;gt;&nbsp;&nbsp;A&nbsp;src/miconv.h&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;Modified:&nbsp;src/Makefile.am&lt;br&gt;<br>
&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;a/src/Makefile.am&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;b/src/Makefile.am&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-78,6&nbsp;+78,7&nbsp;@@&nbsp;libmoon_include_headers&nbsp;=&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmedialog.h&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmediaplayer.h&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;<br>
&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmessaging.h&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmiconv.h&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmoon-curves.h&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmoonlightconfiguration.h\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmoon-path.h&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-234,6&nbsp;+235,7&nbsp;@@&nbsp;dist_libmoon_la_SOURCES&nbsp;=&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmedialog.cpp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmediaplayer.cpp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;<br>
&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmessaging.cpp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmiconv.cpp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmoon-curves.c&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmoonlightconfiguration.cpp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmoon-path.c&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;Added:&nbsp;src/miconv.cpp&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;<br>
&amp;gt;&nbsp;---&nbsp;/dev/null&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;b/src/miconv.cpp&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-0,0&nbsp;+1,344&nbsp;@@&lt;br&gt;&amp;gt;&nbsp;+/*&nbsp;-*-&nbsp;Mode:&nbsp;C++;&nbsp;tab-width:&nbsp;8;&nbsp;indent-tabs-mode:&nbsp;t;&nbsp;c-basic-offset:&nbsp;8&nbsp;-*-&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+/*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;miconv.cpp:&nbsp;&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;Contact:&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp;*&nbsp;&nbsp;&nbsp;Moonlight&nbsp;List&nbsp;(&lt;a&nbsp;href=&quot;mailto:moonlight-list@lists.ximian.com&quot;&gt;moonlight-list@lists.ximian.com&lt;/a&gt;)&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;Copyright&nbsp;2011&nbsp;Novell,&nbsp;Inc.&nbsp;(&lt;a&nbsp;href=&quot;http://www.novell.com&quot;&gt;http://www.novell.com&lt;/a&gt;)&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE&nbsp;file&nbsp;included&nbsp;with&nbsp;the&nbsp;distribution&nbsp;for&nbsp;details.&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;config.h&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;glib.h&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;string.h&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;+#include&nbsp;&amp;lt;errno.h&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+#include&nbsp;&amp;quot;miconv.h&amp;quot;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+namespace&nbsp;Moonlight&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+enum&nbsp;Endian&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspLittleEndian,&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspBigEndian&lt;br&gt;&amp;gt;&nbsp;+};&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;<br>
&amp;gt;&nbsp;+typedef&nbsp;int&nbsp;(*&nbsp;Decoder)&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;&amp;gt;&nbsp;+typedef&nbsp;int&nbsp;(*&nbsp;Encoder)&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&nbsp;decode_utf32&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;<br>
&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf32&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&nbsp;decode_utf16&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf16&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&nbsp;decode_utf8&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar);&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&nbsp;encode_utf8&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;struct&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspconst&nbsp;char&nbsp;*name;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDecoder&nbsp;decoder;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncoder&nbsp;encoder;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEndian&nbsp;endian;&lt;br&gt;&amp;gt;&nbsp;+}&nbsp;charsets[]&nbsp;=&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{&nbsp;&amp;quot;UTF-32BE&amp;quot;,&nbsp;decode_utf32,&nbsp;NULL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BigEndian&nbsp;&nbsp;&nbsp;&nbsp;},&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{&nbsp;&amp;quot;UTF-32LE&amp;quot;,&nbsp;decode_utf32,&nbsp;NULL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LittleEndian&nbsp;},&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{&nbsp;&amp;quot;UTF-16BE&amp;quot;,&nbsp;decode_utf16,&nbsp;NULL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BigEndian&nbsp;&nbsp;&nbsp;&nbsp;},&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{&nbsp;&amp;quot;UTF-16LE&amp;quot;,&nbsp;decode_utf16,&nbsp;NULL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LittleEndian&nbsp;},&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{&nbsp;&amp;quot;UTF-8&amp;quot;,&nbsp;&nbsp;&nbsp;&nbsp;decode_utf8,&nbsp;&nbsp;encode_utf8,&nbsp;&nbsp;LittleEndian&nbsp;},&lt;br&gt;<br>
&amp;gt;&nbsp;+};&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+struct&nbsp;_miconv_t&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDecoder&nbsp;decode;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncoder&nbsp;encode;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEndian&nbsp;endian;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+};&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+miconv_t&lt;br&gt;&amp;gt;&nbsp;+miconv_open&nbsp;(const&nbsp;char&nbsp;*to,&nbsp;const&nbsp;char&nbsp;*from)&lt;br&gt;<br>
&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDecoder&nbsp;decoder&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncoder&nbsp;encoder&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEndian&nbsp;endian;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmiconv_t&nbsp;cd;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguint&nbsp;i;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(!to&nbsp;||&nbsp;!from)&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;(miconv_t)&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;G_N_ELEMENTS&nbsp;(charsets);&nbsp;i++)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(!strcmp&nbsp;(charsets[i].name,&nbsp;from))&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdecoder&nbsp;=&nbsp;charsets[i].decoder;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspendian&nbsp;=&nbsp;charsets[i].endian;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(!strcmp&nbsp;(charsets[i].name,&nbsp;to))&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspencoder&nbsp;=&nbsp;charsets[i].encoder;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(encoder&nbsp;==&nbsp;NULL&nbsp;||&nbsp;decoder&nbsp;==&nbsp;NULL)&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;(miconv_t)&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcd&nbsp;=&nbsp;(miconv_t)&nbsp;g_malloc&nbsp;(sizeof&nbsp;(*cd));&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcd-&amp;gt;decode&nbsp;=&nbsp;decoder;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcd-&amp;gt;encode&nbsp;=&nbsp;encoder;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcd-&amp;gt;endian&nbsp;=&nbsp;endian;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcd-&amp;gt;c&nbsp;=&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;cd;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+int&lt;br&gt;&amp;gt;&nbsp;+miconv_close&nbsp;(miconv_t&nbsp;cd)&lt;br&gt;<br>
&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspg_free&nbsp;(cd);&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+int&lt;br&gt;&amp;gt;&nbsp;+miconv&nbsp;(miconv_t&nbsp;cd,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchar&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft)&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsize_t&nbsp;inleft,&nbsp;outleft;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchar&nbsp;*inptr,&nbsp;*outptr;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspint&nbsp;rc&nbsp;=&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(outbytes&nbsp;==&nbsp;NULL&nbsp;||&nbsp;outbytesleft&nbsp;==&nbsp;NULL)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*&nbsp;reset&nbsp;converter&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcd-&amp;gt;c&nbsp;=&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;0;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinleft&nbsp;=&nbsp;inbytesleft&nbsp;?&nbsp;*inbytesleft&nbsp;:&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinptr&nbsp;=&nbsp;inbytes&nbsp;?&nbsp;*inbytes&nbsp;:&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutleft&nbsp;=&nbsp;*outbytesleft;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutptr&nbsp;=&nbsp;*outbytes;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;=&nbsp;cd-&amp;gt;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhile&nbsp;(inleft&nbsp;&amp;gt;=&nbsp;0&nbsp;&amp;amp;&amp;amp;&nbsp;outleft&nbsp;&amp;gt;&nbsp;0)&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(c&nbsp;==&nbsp;(gunichar)&nbsp;-1&nbsp;&amp;amp;&amp;amp;&nbsp;cd-&amp;gt;decode&nbsp;(cd-&amp;gt;endian,&nbsp;&amp;amp;inptr,&nbsp;&amp;amp;inleft,&nbsp;&amp;amp;c)&nbsp;==&nbsp;-1)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprc&nbsp;=&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbreak;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(cd-&amp;gt;encode&nbsp;(c,&nbsp;&amp;amp;outptr,&nbsp;&amp;amp;outleft)&nbsp;==&nbsp;-1)&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprc&nbsp;=&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbreak;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;=&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(inbytesleft)&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytesleft&nbsp;=&nbsp;inleft;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(inbytes)&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytes&nbsp;=&nbsp;inptr;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*outbytesleft&nbsp;=&nbsp;outleft;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*outbytes&nbsp;=&nbsp;outptr;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcd-&amp;gt;c&nbsp;=&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;rc;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;&amp;gt;&nbsp;+decode_utf32&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar)&lt;br&gt;<br>
&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar&nbsp;*inptr&nbsp;=&nbsp;(gunichar&nbsp;*)&nbsp;*inbytes;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsize_t&nbsp;inleft&nbsp;=&nbsp;*inbytesleft;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(inleft&nbsp;&amp;lt;&nbsp;4)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EINVAL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(endian&nbsp;==&nbsp;BigEndian)&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;=&nbsp;GUINT32_FROM_BE&nbsp;(*inptr);&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;=&nbsp;GUINT32_FROM_LE&nbsp;(*inptr);&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinleft&nbsp;-=&nbsp;4;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinptr++;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(c&nbsp;&amp;gt;=&nbsp;2147483648UL)&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytes&nbsp;=&nbsp;(char&nbsp;*)&nbsp;inptr;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytesleft&nbsp;=&nbsp;inleft;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*outchar&nbsp;=&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf32&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;<br>
&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;&amp;gt;&nbsp;+decode_utf16&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar)&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar2&nbsp;*inptr&nbsp;=&nbsp;(gunichar2&nbsp;*)&nbsp;*inbytes;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsize_t&nbsp;inleft&nbsp;=&nbsp;*inbytesleft;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar2&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar&nbsp;u;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(inleft&nbsp;&amp;lt;&nbsp;2)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EINVAL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(endian&nbsp;==&nbsp;BigEndian)&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspu&nbsp;=&nbsp;GUINT16_FROM_BE&nbsp;(*inptr);&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspu&nbsp;=&nbsp;GUINT16_FROM_LE&nbsp;(*inptr);&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinleft&nbsp;-=&nbsp;2;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinptr++;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(u&nbsp;&amp;gt;=&nbsp;0xdc00&nbsp;&amp;amp;&amp;amp;&nbsp;u&nbsp;&amp;lt;=&nbsp;0xdfff)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;(u&nbsp;&amp;gt;=&nbsp;0xd800&nbsp;&amp;amp;&amp;amp;&nbsp;u&nbsp;&amp;lt;=&nbsp;0xdbff)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(inleft&nbsp;&amp;lt;&nbsp;2)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EINVAL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(endian&nbsp;==&nbsp;BigEndian)&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;=&nbsp;GUINT16_FROM_BE&nbsp;(*inptr);&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;=&nbsp;GUINT16_FROM_LE&nbsp;(*inptr);&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinleft&nbsp;-=&nbsp;2;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinptr++;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(c&nbsp;&amp;lt;&nbsp;0xdc00&nbsp;||&nbsp;c&nbsp;&amp;gt;&nbsp;0xdfff)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspu&nbsp;=&nbsp;((u&nbsp;-&nbsp;0xd800)&nbsp;&amp;lt;&amp;lt;&nbsp;10)&nbsp;+&nbsp;(c&nbsp;-&nbsp;0xdc00)&nbsp;+&nbsp;0x0010000UL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytes&nbsp;=&nbsp;(char&nbsp;*)&nbsp;inptr;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytesleft&nbsp;=&nbsp;inleft;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*outchar&nbsp;=&nbsp;u;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+//static&nbsp;int&nbsp;encode_utf16&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;&amp;gt;&nbsp;+decode_utf8&nbsp;(Endian&nbsp;endian,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&nbsp;gunichar&nbsp;*outchar)&lt;br&gt;<br>
&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsize_t&nbsp;inleft&nbsp;=&nbsp;*inbytesleft;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchar&nbsp;*inptr&nbsp;=&nbsp;*inbytes;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsize_t&nbsp;i,&nbsp;len&nbsp;=&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspunsigned&nbsp;char&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgunichar&nbsp;u;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;=&nbsp;*inptr++;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(c&nbsp;&amp;lt;&nbsp;0x80)&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*&nbsp;simple&nbsp;ascii&nbsp;case&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xe0)&nbsp;==&nbsp;0xc0)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;&amp;amp;=&nbsp;0x1f;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;2;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xf0)&nbsp;==&nbsp;0xe0)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;&amp;amp;=&nbsp;0x0f;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;3;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xf8)&nbsp;==&nbsp;0xf0)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;&amp;amp;=&nbsp;0x07;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;4;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xfc)&nbsp;==&nbsp;0xf8)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;&amp;amp;=&nbsp;0x03;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;5;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;((c&nbsp;&amp;amp;&nbsp;0xfe)&nbsp;==&nbsp;0xfc)&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;&amp;amp;=&nbsp;0x01;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;6;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EILSEQ;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(len&nbsp;&amp;gt;&nbsp;inleft)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EINVAL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspu&nbsp;=&nbsp;c;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor&nbsp;(i&nbsp;=&nbsp;1;&nbsp;i&nbsp;&amp;lt;&nbsp;len;&nbsp;i++)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspu&nbsp;&amp;lt;&amp;lt;=&nbsp;6&nbsp;|&nbsp;((*inptr)&nbsp;&amp;amp;&nbsp;0x3f);&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinptr++;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytesleft&nbsp;=&nbsp;inleft&nbsp;-&nbsp;len;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*inbytes&nbsp;=&nbsp;inptr;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*outchar&nbsp;=&nbsp;u;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&lt;br&gt;&amp;gt;&nbsp;+encode_utf8&nbsp;(gunichar&nbsp;c,&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft)&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsize_t&nbsp;outleft&nbsp;=&nbsp;*outbytesleft;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchar&nbsp;*outptr&nbsp;=&nbsp;*outbytes;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsize_t&nbsp;len,&nbsp;i;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchar&nbsp;base;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(c&nbsp;&amp;lt;&nbsp;128UL)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbase&nbsp;=&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;2048UL)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbase&nbsp;=&nbsp;192;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;2;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;65536UL)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbase&nbsp;=&nbsp;224;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;3;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;2097152UL)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbase&nbsp;=&nbsp;240;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;4;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;67108864UL)&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbase&nbsp;=&nbsp;248;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;5;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;if&nbsp;(c&nbsp;&amp;lt;&nbsp;2147483648UL)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbase&nbsp;=&nbsp;252;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplen&nbsp;=&nbsp;6;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&nbsp;else&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;EINVAL;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(outleft&nbsp;&amp;lt;&nbsp;len)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperrno&nbsp;=&nbsp;E2BIG;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;-1;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor&nbsp;(i&nbsp;=&nbsp;len&nbsp;-&nbsp;1;&nbsp;i&nbsp;&amp;gt;&nbsp;0;&nbsp;i--)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*&nbsp;mask&nbsp;off&nbsp;6&nbsp;bits&nbsp;worth&nbsp;and&nbsp;add&nbsp;128&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutptr[i]&nbsp;=&nbsp;128&nbsp;+&nbsp;(c&nbsp;&amp;amp;&nbsp;0x3f);&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspc&nbsp;&amp;gt;&amp;gt;=&nbsp;6;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*&nbsp;first&nbsp;character&nbsp;has&nbsp;a&nbsp;different&nbsp;base&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutptr[0]&nbsp;=&nbsp;base&nbsp;+&nbsp;(c&nbsp;&amp;amp;&nbsp;0x3f);&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*outbytesleft&nbsp;=&nbsp;outleft&nbsp;-&nbsp;len;&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*outbytes&nbsp;=&nbsp;outptr&nbsp;+&nbsp;len;&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreturn&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+};&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;Added:&nbsp;src/miconv.h&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;/dev/null&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;b/src/miconv.h&lt;br&gt;<br>
&amp;gt;&nbsp;@@&nbsp;-0,0&nbsp;+1,35&nbsp;@@&lt;br&gt;&amp;gt;&nbsp;+/*&nbsp;-*-&nbsp;Mode:&nbsp;C++;&nbsp;tab-width:&nbsp;8;&nbsp;indent-tabs-mode:&nbsp;t;&nbsp;c-basic-offset:&nbsp;8&nbsp;-*-&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+/*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;miconv.h:&nbsp;&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;Contact:&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;&nbsp;&nbsp;Moonlight&nbsp;List&nbsp;(&lt;a&nbsp;href=&quot;mailto:moonlight-list@lists.ximian.com&quot;&gt;moonlight-list@lists.ximian.com&lt;/a&gt;)&lt;br&gt;<br>
&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;Copyright&nbsp;2011&nbsp;Novell,&nbsp;Inc.&nbsp;(&lt;a&nbsp;href=&quot;http://www.novell.com&quot;&gt;http://www.novell.com&lt;/a&gt;)&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;See&nbsp;the&nbsp;LICENSE&nbsp;file&nbsp;included&nbsp;with&nbsp;the&nbsp;distribution&nbsp;for&nbsp;details.&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;<br>
&amp;gt;&nbsp;+#ifndef&nbsp;__MICONV_H__&lt;br&gt;&amp;gt;&nbsp;+#define&nbsp;__MICONV_H__&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;glib.h&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+#include&nbsp;&amp;lt;sys/types.h&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+namespace&nbsp;Moonlight&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+G_BEGIN_DECLS&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;<br>
&amp;gt;&nbsp;+typedef&nbsp;struct&nbsp;_miconv_t&nbsp;*miconv_t;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+int&nbsp;miconv&nbsp;(miconv_t&nbsp;cd,&nbsp;char&nbsp;**inbytes,&nbsp;size_t&nbsp;*inbytesleft,&lt;br&gt;&amp;gt;&nbsp;+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;**outbytes,&nbsp;size_t&nbsp;*outbytesleft);&lt;br&gt;&amp;gt;&nbsp;+miconv_t&nbsp;miconv_open&nbsp;(const&nbsp;char&nbsp;*to,&nbsp;const&nbsp;char&nbsp;*from);&lt;br&gt;<br>
&amp;gt;&nbsp;+int&nbsp;miconv_close&nbsp;(miconv_t&nbsp;cd);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+G_END_DECLS&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+};&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+#endif&nbsp;/*&nbsp;__MICONV_H__&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&amp;gt;&nbsp;Mono-patches&nbsp;maillist&nbsp;&nbsp;-&nbsp;&nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-patches@lists.ximian.com&quot;&gt;Mono-patches@lists.ximian.com&lt;/a&gt;&lt;br&gt;&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-patches&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-patches&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
