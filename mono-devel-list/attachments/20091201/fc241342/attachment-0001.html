<tt>
Hi,&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Dec&nbsp;1,&nbsp;2009&nbsp;at&nbsp;6:02&nbsp;PM,&nbsp;Babbage&nbsp;Linden&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:babbage@lindenlab.com&quot;&gt;babbage@lindenlab.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Hi&nbsp;all,&lt;br&gt;&lt;br&gt;I&amp;#39;m&nbsp;currently&nbsp;investigating&nbsp;a&nbsp;performance&nbsp;problem&nbsp;which&nbsp;is&nbsp;causing&nbsp;complex&nbsp;objects&nbsp;in&nbsp;Second&nbsp;Life&nbsp;containing&nbsp;many&nbsp;scripts&nbsp;to&nbsp;take&nbsp;a&nbsp;long&nbsp;time&nbsp;to&nbsp;load.&lt;br&gt;&lt;br&gt;We&nbsp;embed&nbsp;Mono&nbsp;in&nbsp;the&nbsp;Second&nbsp;Life&nbsp;simulator,&nbsp;so&nbsp;I&nbsp;turned&nbsp;on&nbsp;the&nbsp;profiler&nbsp;before&nbsp;initialising&nbsp;the&nbsp;runtime:&lt;br&gt;<br>
<br>
&lt;br&gt;mono_profiler_load(&amp;quot;default:stat&amp;quot;);&lt;br&gt;mono_jit_init(&amp;quot;root&nbsp;domain&amp;quot;);&lt;br&gt;mono_internal_call_init();&lt;br&gt;&lt;br&gt;After&nbsp;shutting&nbsp;down&nbsp;the&nbsp;simulator,&nbsp;the&nbsp;profiler&nbsp;reported&nbsp;the&nbsp;slow&nbsp;method&nbsp;as&nbsp;being&nbsp;System.Reflection.Assembly::Load(byte[]),&nbsp;with&nbsp;each&nbsp;call&nbsp;taking&nbsp;19.961ms:&lt;br&gt;<br>
<br>
&lt;br&gt;Time(ms)&nbsp;Count  &nbsp;P/call(ms)&nbsp;Method&nbsp;name&lt;br&gt;########################&lt;br&gt; 4052.135    &nbsp;203  &nbsp;19.961  &nbsp;System.Reflection.Assembly::Load(byte[])&lt;br&gt; &nbsp;Callers&nbsp;(with&nbsp;count)&nbsp;that&nbsp;contribute&nbsp;at&nbsp;least&nbsp;for&nbsp;1%:&lt;br&gt;        &nbsp;102 &nbsp;50&nbsp;%&nbsp;LindenLab.SecondLife.Script::.ctor(string,byte[],long&amp;amp;)&lt;br&gt;<br>
<br>
        &nbsp;101 &nbsp;49&nbsp;%&nbsp;LindenLab.SecondLife.Script::Deserialize(byte[],byte[])&lt;br&gt;&lt;br&gt;Does&nbsp;this&nbsp;seem&nbsp;right?&nbsp;We&amp;#39;re&nbsp;just&nbsp;passing&nbsp;an&nbsp;assembly&nbsp;as&nbsp;bytes&nbsp;to&nbsp;Mono&nbsp;and&nbsp;asking&nbsp;it&nbsp;to&nbsp;turn&nbsp;it&nbsp;in&nbsp;to&nbsp;an&nbsp;assembly,&nbsp;19ms&nbsp;seems&nbsp;like&nbsp;a&nbsp;long&nbsp;time&nbsp;to&nbsp;do&nbsp;that.&lt;br&gt;<br>
<br>
&lt;br&gt;Are&nbsp;there&nbsp;any&nbsp;faster&nbsp;ways&nbsp;we&nbsp;could&nbsp;do&nbsp;this?&nbsp;In&nbsp;the&nbsp;example&nbsp;above&nbsp;an&nbsp;object&nbsp;with&nbsp;200&nbsp;scripts&nbsp;in&nbsp;it&nbsp;is&nbsp;taking&nbsp;4s&nbsp;to&nbsp;load,&nbsp;which&nbsp;is&nbsp;much&nbsp;faster&nbsp;than&nbsp;with&nbsp;an&nbsp;LSL&nbsp;script.&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I&nbsp;can&amp;#39;t&nbsp;reproduce&nbsp;this,&nbsp;most&nbsp;of&nbsp;the&nbsp;work&nbsp;happens&nbsp;in&nbsp;native&nbsp;code,&nbsp;could&nbsp;you&nbsp;try&nbsp;running&nbsp;under&lt;br&gt;<br>
valgrind&nbsp;--tool=callgrind,&nbsp;that&nbsp;will&nbsp;profile&nbsp;the&nbsp;runtime&nbsp;code.&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;I&nbsp;get&nbsp;similar&nbsp;results&nbsp;using&nbsp;mono&nbsp;1.2.6&nbsp;(which&nbsp;we&nbsp;have&nbsp;embedded&nbsp;in&nbsp;Second&nbsp;Life)&nbsp;or&nbsp;revision&nbsp;146428,&nbsp;which&nbsp;is&nbsp;pretty&nbsp;close&nbsp;to&nbsp;the&nbsp;tip&nbsp;of&nbsp;svn.&lt;br&gt;<br>
<br>
&lt;br&gt;Also,&nbsp;the&nbsp;profiler&nbsp;seems&nbsp;to&nbsp;output&nbsp;it&amp;#39;s&nbsp;results&nbsp;the&nbsp;first&nbsp;time&nbsp;we&nbsp;unload&nbsp;a&nbsp;domain,&nbsp;is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;stop&nbsp;that&nbsp;happening,&nbsp;so&nbsp;we&nbsp;get&nbsp;the&nbsp;full&nbsp;output&nbsp;on&nbsp;shut&nbsp;down?&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;This&nbsp;is&nbsp;a&nbsp;problem&nbsp;with&nbsp;the&nbsp;current&nbsp;built-in&nbsp;profiler,&nbsp;it&nbsp;emits&nbsp;all&nbsp;info&nbsp;when&nbsp;an&nbsp;appdomain&nbsp;is&lt;br&gt;<br>
unloaded,&nbsp;since&nbsp;the&nbsp;methods&nbsp;etc.&nbsp;it&nbsp;collected&nbsp;info&nbsp;about&nbsp;could&nbsp;be&nbsp;going&nbsp;away.&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;(How&nbsp;should&nbsp;we&nbsp;be&nbsp;creating&nbsp;and&nbsp;destroying&nbsp;appdomains&nbsp;from&nbsp;unmanaged&nbsp;code:&nbsp;we&amp;#39;re&nbsp;currently&nbsp;using&nbsp;ves_icall_System_AppDomain_InternalUnload&nbsp;from&nbsp;unmanaged&nbsp;code&nbsp;to&nbsp;unload&nbsp;domains,&nbsp;which&nbsp;is&nbsp;less&nbsp;than&nbsp;ideal...)&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;You&nbsp;should&nbsp;call&nbsp;the&nbsp;managed&nbsp;CreateDomain&nbsp;and&nbsp;UnloadDomain&nbsp;methods&nbsp;using&lt;br&gt;mono_runtime_invoke&nbsp;()&nbsp;or&nbsp;call&nbsp;a&nbsp;managed&nbsp;method&nbsp;in &nbsp;your&nbsp;code&nbsp;which&nbsp;calls&nbsp;them.&lt;br&gt; &lt;br&gt;            &nbsp;Zoltan&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Cheers,&lt;br&gt;&lt;br&gt;Jim&lt;br&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
