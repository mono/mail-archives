Index: processes.c
===================================================================
RCS file: /mono/mono/mono/io-layer/processes.c,v
retrieving revision 1.17
diff -u -r1.17 processes.c
--- processes.c	29 Sep 2003 15:05:21 -0000	1.17
+++ processes.c	28 Oct 2003 09:05:46 -0000
@@ -22,13 +22,13 @@
 #include <unistd.h>
 
 #include <mono/io-layer/wapi.h>
-#include <mono/io-layer/unicode.h>
 #include <mono/io-layer/wapi-private.h>
 #include <mono/io-layer/handles-private.h>
 #include <mono/io-layer/misc-private.h>
 #include <mono/io-layer/mono-mutex.h>
 #include <mono/io-layer/process-private.h>
 #include <mono/io-layer/threads.h>
+#include <mono/utils/strenc.h>
 
 /* The process' environment strings */
 extern char **environ;
@@ -125,7 +125,7 @@
 	 * so crap, with an API like this :-(
 	 */
 	if(appname!=NULL) {
-		cmd=_wapi_unicode_to_utf8 (appname);
+		cmd=mono_unicode_to_external (appname);
 		if(cmd==NULL) {
 #ifdef DEBUG
 			g_message (G_GNUC_PRETTY_FUNCTION
@@ -145,7 +145,7 @@
 	}
 	
 	if(cmdline!=NULL) {
-		args=_wapi_unicode_to_utf8 (cmdline);
+		args=mono_unicode_to_external (cmdline);
 		if(args==NULL) {
 #ifdef DEBUG
 			g_message (G_GNUC_PRETTY_FUNCTION
@@ -158,7 +158,7 @@
 	}
 
 	if(cwd!=NULL) {
-		dir=_wapi_unicode_to_utf8 (cwd);
+		dir=mono_unicode_to_external (cwd);
 		if(dir==NULL) {
 #ifdef DEBUG
 			g_message (G_GNUC_PRETTY_FUNCTION
@@ -210,8 +210,7 @@
 		count=0;
 		for(new_environp=(gunichar2 *)new_environ; *new_environp;
 		    new_environp++) {
-			strings[count]=g_utf16_to_utf8 (new_environp, -1, NULL,
-							NULL, NULL);
+			strings[count]=mono_unicode_to_external (new_environp);
 			count++;
 			while(*new_environp) {
 				new_environp++;
