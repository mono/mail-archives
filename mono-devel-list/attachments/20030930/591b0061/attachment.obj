using System;
using System.Collections;

namespace GCTest
{
	/// <summary>
	/// Test for garbage collection on Mono
	/// </summary>
	class GCTest
	{
		static void Main(string[] args)
		{
			int count = 100000;

			ArrayList al = new ArrayList();

			Console.WriteLine( "Create " + count + " objects..." );

			for ( int iPos =0; iPos < count; iPos++)
			{
				string s = new String( 'S', 100 );

				al.Add(s);
			}

			Console.WriteLine( "   ready." );
			Console.WriteLine( "Uses Memory: " + GC.GetTotalMemory(true) );
			Console.WriteLine( "Press any key to release memory." );
			Console.ReadLine();

			al.Add("dummy");	// To avoid optimization
			al = null;

			GC.Collect();

			Console.WriteLine( "Memory released" );
			Console.WriteLine( "Uses Memory: " + GC.GetTotalMemory(true) );
			Console.WriteLine( "Press any key to exit." );
			Console.ReadLine();
		}
	}
}
