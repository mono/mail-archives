#include <windows.h>
#include <stdio.h>

typedef struct {
    DWORD_PTR ExceptionList;
    DWORD_PTR StackBase;
    DWORD_PTR StackLimit;
} TIB;

void do_foo ()
{
	int a_lot[8000];
	int more;
	printf ("here stack is %p\n", &more);
}

DWORD WINAPI DumpThreadData (LPVOID tname)
{
	int foo = 99;
	TIB32 *p = (TIB32 *)NtCurrentTeb ();
	printf ("TEB %s is %p base is %p limit is %p cur_ptr %p\n", tname, p, p->StackBase, p->StackLimit, &foo);
	do_foo ();
	return 0;
}

int main(int argc, char* argv[])
{
	DumpThreadData ("main");
	CreateThread (NULL, NULL, DumpThreadData, "other thread", 0, NULL);
	getc (stdin);
	return 0;
}
