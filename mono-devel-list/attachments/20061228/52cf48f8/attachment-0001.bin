Index: xsp/src/ModMonoRequest.cs
===================================================================
--- xsp/src/ModMonoRequest.cs	(revision 70124)
+++ xsp/src/ModMonoRequest.cs	(working copy)
@@ -71,6 +71,7 @@
 		string queryString;
 		string protocol;
 		string uri;
+		string vServerName;
 		string localAddress;
 		string remoteAddress;
 		string remoteName;
@@ -103,7 +104,7 @@
 			if (shutdown)
 				return;
 
-			if (cmd != 6) {
+			if (cmd != 7) {
 				string msg = "mod_mono and xsp have different versions.";
 				Console.WriteLine (msg);
 				Console.Error.WriteLine (msg);
@@ -111,6 +112,7 @@
 			}
 
 			verb = ReadString ();
+			vServerName = ReadString ();
 			uri = ReadString ();
 			queryString = ReadString ();
 			protocol = ReadString ();
@@ -272,6 +274,11 @@
 			return uri;
 		}
 
+		public string GetVirtualServerName ()
+		{
+			return vServerName;
+		}
+
 		public string GetQueryString ()
 		{
 			return queryString;
Index: xsp/src/ModMonoApplicationHost.cs
===================================================================
--- xsp/src/ModMonoApplicationHost.cs	(revision 70124)
+++ xsp/src/ModMonoApplicationHost.cs	(working copy)
@@ -382,13 +382,17 @@
 				}
 			}
 
+			string vServerName = rr.Request.GetVirtualServerName ();
+			if (vServerName == null)
+				vServerName = vhost;
+
 			VPathToHost vapp = null;
 			string vpath = rr.GetUriPath ();
 			string path = rr.GetPhysicalPath ();
 			if (path == null) {
-				vapp = server.GetApplicationForPath (vhost, port, vpath, false);
+				vapp = server.GetApplicationForPath (vServerName, port, vpath, false);
 			} else {
-				vapp = GetOrCreateApplication (vhost, port, path, vpath);
+				vapp = GetOrCreateApplication (vServerName, port, path, vpath);
 			}
 
 			if (vapp == null) {
