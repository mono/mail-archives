<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;content=&quot;text/html;&nbsp;charset=gb2312&quot;&nbsp;http-equiv=Content-Type&gt;<br>
&lt;META&nbsp;name=GENERATOR&nbsp;content=&quot;MSHTML&nbsp;8.00.7600.16588&quot;&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;<br>
&lt;P&gt;hi,&nbsp;all!&lt;BR&gt;&amp;nbsp;&nbsp;The&nbsp;following&nbsp;code&nbsp;are&nbsp;from&nbsp;libgdiplus2.6.7,&nbsp;in&nbsp;<br>
graphics.c.&lt;BR&gt;&amp;nbsp;&nbsp;I&nbsp;have&nbsp;a&nbsp;few&nbsp;quetions:&lt;BR&gt;1.&nbsp;Why&nbsp;&quot;&nbsp;&lt;FONT&nbsp;color=#ff0000&gt;the&nbsp;<br>
matrix&nbsp;MUST&nbsp;be&nbsp;invertible&nbsp;to&nbsp;be&nbsp;used&lt;/FONT&gt;&nbsp;&quot;&nbsp;when&nbsp;we&nbsp;call&nbsp;GdipSetWorldTransform&nbsp;<br>
or&nbsp;GdipMultiplyWorldTransform?&nbsp;It&nbsp;is&nbsp;unnecessary&nbsp;for&nbsp;windows's&nbsp;gdiplus.&lt;BR&gt;2.&nbsp;<br>
each&nbsp;time&nbsp;when&nbsp;the&nbsp;world&nbsp;transformation&nbsp;is&nbsp;changed(translate,&nbsp;roate,&nbsp;scale),&nbsp;the&nbsp;<br>
function&nbsp;apply_world_to_bounds&nbsp;is&nbsp;called.&nbsp;what&nbsp;if&nbsp;we&nbsp;don't&nbsp;call&nbsp;<br>
apply_world_to_bounds?&lt;BR&gt;3.&nbsp;GdipSetWorldTransform&nbsp;also&nbsp;change&nbsp;the&nbsp;world&nbsp;<br>
transformation,&nbsp;but&nbsp;it&nbsp;doesnt&nbsp;call&nbsp;world&nbsp;transformation,&nbsp;why?&lt;BR&gt;4.&nbsp;<br>
apply_world_to_bounds&nbsp;use&nbsp;&lt;FONT&nbsp;color=#0000ff&gt;graphics-&amp;gt;clip_matrix&nbsp;<br>
&lt;/FONT&gt;&lt;FONT&nbsp;color=#000000&gt;to&nbsp;transform&nbsp;points,&nbsp;why&nbsp;not&nbsp;use&nbsp;<br>
graphics-&amp;gt;copy_of_ctm?&nbsp;As&nbsp;graphics-&amp;gt;copy_of_ctm&nbsp;is&nbsp;the&nbsp;world&nbsp;<br>
transformation&nbsp;and&nbsp;graphics-&amp;gt;clip_matrix&nbsp;is&nbsp;just&nbsp;the&nbsp;matrix&nbsp;of&nbsp;the&nbsp;clip&nbsp;<br>
region.&lt;BR&gt;&lt;BR&gt;I&nbsp;use&nbsp;libgdiplus&nbsp;to&nbsp;draw&nbsp;something(I&nbsp;change&nbsp;the&nbsp;world&nbsp;<br>
transformation&nbsp;using&nbsp;the&nbsp;related&nbsp;functions,&nbsp;but&nbsp;the&nbsp;position&nbsp;and&nbsp;the&nbsp;size&nbsp;is&nbsp;<br>
incorrect.&nbsp;I&nbsp;don't&nbsp;know&nbsp;wether&nbsp;it&nbsp;has&nbsp;sth&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;following&nbsp;<br>
questions.&lt;BR&gt;&lt;BR&gt;thanks!&lt;BR&gt;&lt;BR&gt;static&nbsp;GpStatus&lt;BR&gt;apply_world_to_bounds&nbsp;<br>
(GpGraphics&nbsp;*graphics)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;GpStatus&nbsp;status;&lt;BR&gt;&amp;nbsp;GpPointF&nbsp;<br>
pts[2];&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;pts[0].X&nbsp;=&nbsp;graphics-&amp;gt;bounds.X;&lt;BR&gt;&amp;nbsp;pts[0].Y&nbsp;=&nbsp;<br>
graphics-&amp;gt;bounds.Y;&lt;BR&gt;&amp;nbsp;pts[1].X&nbsp;=&nbsp;graphics-&amp;gt;bounds.X&nbsp;+&nbsp;<br>
graphics-&amp;gt;bounds.Width;&lt;BR&gt;&amp;nbsp;pts[1].Y&nbsp;=&nbsp;graphics-&amp;gt;bounds.Y&nbsp;+&nbsp;<br>
graphics-&amp;gt;bounds.Height;&lt;BR&gt;&amp;nbsp;status&nbsp;=&nbsp;GdipTransformMatrixPoints&nbsp;(&lt;FONT&nbsp;<br>
color=#0000ff&gt;graphics-&amp;gt;clip_matrix&lt;/FONT&gt;,&nbsp;(GpPointF*)&amp;amp;pts,&nbsp;2);/*&nbsp;&lt;FONT&nbsp;<br>
color=#0000ff&gt;why&nbsp;not&nbsp;use&nbsp;graphics-&amp;gt;copy_of_ctm&lt;/FONT&gt;?*/&lt;BR&gt;&amp;nbsp;if&nbsp;(status&nbsp;<br>
!=&nbsp;Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;status;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;if&nbsp;(pts[0].X&nbsp;&amp;gt;&nbsp;pts[1].X)&nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.X&nbsp;=&nbsp;<br>
float2int(pts[1].X);&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.Width&nbsp;=&nbsp;float2int(iround&nbsp;<br>
(pts[0].X&nbsp;-&nbsp;pts[1].X));&lt;BR&gt;&amp;nbsp;}&nbsp;else&nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.X&nbsp;=&nbsp;<br>
float2int(pts[0].X);&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.Width&nbsp;=&nbsp;float2int(iround&nbsp;<br>
(pts[1].X&nbsp;-&nbsp;pts[0].X));&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;if&nbsp;(pts[0].Y&nbsp;&amp;gt;&nbsp;pts[1].Y)&nbsp;<br>
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.Y&nbsp;=&nbsp;<br>
float2int(pts[1].Y);&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.Height&nbsp;=&nbsp;<br>
float2int(iround&nbsp;(pts[0].Y&nbsp;-&nbsp;pts[1].Y));&lt;BR&gt;&amp;nbsp;}&nbsp;else&nbsp;<br>
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.Y&nbsp;=&nbsp;<br>
float2int(pts[0].Y);&lt;BR&gt;&amp;nbsp;&amp;nbsp;graphics-&amp;gt;bounds.Height&nbsp;=&nbsp;<br>
float2int(iround&nbsp;(pts[1].Y&nbsp;-&nbsp;pts[0].Y));&lt;BR&gt;&amp;nbsp;}&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;return&nbsp;Ok;&lt;BR&gt;}&lt;BR&gt;&lt;BR&gt;GpStatus&nbsp;WINGDIPAPI&nbsp;GdipSetWorldTransform&nbsp;<br>
(GpGraphics&nbsp;*graphics,&nbsp;GpMatrix&nbsp;*matrix)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;GpStatus&nbsp;<br>
status;&lt;BR&gt;&amp;nbsp;BOOL&nbsp;invertible;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;if&nbsp;(!graphics&nbsp;||&nbsp;!matrix)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;InvalidParameter;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;/*&nbsp;optimization&nbsp;-&nbsp;inverting&nbsp;an&nbsp;identity&nbsp;matrix&nbsp;result&nbsp;in&nbsp;the&nbsp;identity&nbsp;<br>
matrix&nbsp;*/&lt;BR&gt;&amp;nbsp;if&nbsp;(gdip_is_matrix_empty&nbsp;(matrix))&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
GdipResetWorldTransform&nbsp;(graphics);&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;color=#ff0000&gt;&amp;nbsp;/*&nbsp;the&nbsp;matrix&nbsp;MUST&nbsp;be&nbsp;invertible&nbsp;to&nbsp;be&nbsp;used&nbsp;<br>
*/&lt;/FONT&gt;&lt;BR&gt;&amp;nbsp;status&nbsp;=&nbsp;GdipIsMatrixInvertible&nbsp;(matrix,&nbsp;<br>
&amp;amp;invertible);&lt;BR&gt;&amp;nbsp;if&nbsp;(!invertible&nbsp;||&nbsp;(status&nbsp;!=&nbsp;<br>
Ok))&lt;BR&gt;&amp;nbsp;&amp;nbsp;{printf(&quot;InvalidParameter\n&quot;);return&nbsp;InvalidParameter;}&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;gdip_cairo_matrix_copy&nbsp;(graphics-&amp;gt;copy_of_ctm,&nbsp;<br>
matrix);&lt;BR&gt;&amp;nbsp;gdip_cairo_matrix_copy&nbsp;(graphics-&amp;gt;clip_matrix,&nbsp;matrix);&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;/*&nbsp;we&nbsp;already&nbsp;know&nbsp;it's&nbsp;invertible&nbsp;*/&lt;BR&gt;&amp;nbsp;GdipInvertMatrix&nbsp;<br>
(graphics-&amp;gt;clip_matrix);&lt;BR&gt;&lt;BR&gt;/*&lt;FONT&nbsp;<br>
color=#0000ff&gt;&amp;nbsp;apply_world_to_bounds&nbsp;(graphics);&nbsp;is&nbsp;not&nbsp;called&nbsp;here!&nbsp;<br>
why?*/&lt;/FONT&gt;&lt;BR&gt;&lt;BR&gt;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;switch&nbsp;(graphics-&amp;gt;backend)&nbsp;{&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndCairo:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;cairo_SetWorldTransform&nbsp;(graphics,&nbsp;<br>
matrix);&lt;BR&gt;&amp;nbsp;case&nbsp;GraphicsBackEndMetafile:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
metafile_SetWorldTransform&nbsp;(graphics,&nbsp;<br>
matrix);&lt;BR&gt;&amp;nbsp;default:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
GenericError;&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;}&amp;nbsp;&lt;BR&gt;&lt;BR&gt;GpStatus&nbsp;WINGDIPAPI&nbsp;<br>
GdipMultiplyWorldTransform&nbsp;(GpGraphics&nbsp;*graphics,&nbsp;GpMatrix&nbsp;*matrix,&nbsp;<br>
GpMatrixOrder&nbsp;order)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Status&nbsp;s;&lt;BR&gt;&amp;nbsp;BOOL&nbsp;<br>
invertible;&lt;BR&gt;&amp;nbsp;GpMatrix&nbsp;inverted;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;if&nbsp;(!graphics)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;InvalidParameter;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;color=#ff0000&gt;&amp;nbsp;/*&nbsp;the&nbsp;matrix&nbsp;MUST&nbsp;be&nbsp;invertible&nbsp;to&nbsp;be&nbsp;used&nbsp;<br>
*/&lt;/FONT&gt;&lt;BR&gt;&amp;nbsp;s&nbsp;=&nbsp;GdipIsMatrixInvertible&nbsp;(matrix,&nbsp;<br>
&amp;amp;invertible);&lt;BR&gt;&amp;nbsp;if&nbsp;(!invertible&nbsp;||&nbsp;(s&nbsp;!=&nbsp;<br>
Ok))&lt;BR&gt;&amp;nbsp;&amp;nbsp;{printf(&quot;InvalidParameter\n&quot;);return&nbsp;InvalidParameter;}&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;s&nbsp;=&nbsp;GdipMultiplyMatrix&nbsp;(graphics-&amp;gt;copy_of_ctm,&nbsp;matrix,&nbsp;<br>
order);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(s&nbsp;!=&nbsp;<br>
Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;/*&nbsp;Multiply&nbsp;the&nbsp;inverted&nbsp;matrix&nbsp;with&nbsp;the&nbsp;clipping&nbsp;matrix&nbsp;<br>
*/&lt;BR&gt;&amp;nbsp;gdip_cairo_matrix_copy&nbsp;(&amp;amp;inverted,&nbsp;matrix);&lt;BR&gt;&amp;nbsp;s&nbsp;=&nbsp;<br>
GdipInvertMatrix&nbsp;(&amp;amp;inverted);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
if&nbsp;(s&nbsp;!=&nbsp;<br>
Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;s&nbsp;=&nbsp;GdipMultiplyMatrix&nbsp;(graphics-&amp;gt;clip_matrix,&nbsp;&amp;amp;inverted,&nbsp;<br>
order);&lt;BR&gt;&amp;nbsp;if&nbsp;(s&nbsp;!=&nbsp;Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;color=#0000ff&gt;&amp;nbsp;apply_world_to_bounds&nbsp;(graphics);&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;switch&nbsp;(graphics-&amp;gt;backend)&nbsp;{&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndCairo:&lt;BR&gt;&amp;nbsp;&amp;nbsp;/*&nbsp;not&nbsp;a&nbsp;typo&nbsp;-&nbsp;we&nbsp;apply&nbsp;to&nbsp;calculated&nbsp;<br>
matrix&nbsp;to&nbsp;cairo&nbsp;context&nbsp;*/&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;cairo_SetWorldTransform&nbsp;<br>
(graphics,&nbsp;graphics-&amp;gt;copy_of_ctm);&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndMetafile:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;metafile_MultiplyWorldTransform&nbsp;<br>
(graphics,&nbsp;matrix,&nbsp;order);&lt;BR&gt;&amp;nbsp;default:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
GenericError;&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;}&lt;BR&gt;&lt;BR&gt;GpStatus&nbsp;WINGDIPAPI&nbsp;<br>
GdipRotateWorldTransform&nbsp;(GpGraphics&nbsp;*graphics,&nbsp;float&nbsp;angle,&nbsp;GpMatrixOrder&nbsp;<br>
order)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;GpStatus&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;if&nbsp;(!graphics)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;InvalidParameter;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;s&nbsp;=&nbsp;GdipRotateMatrix&nbsp;(graphics-&amp;gt;copy_of_ctm,&nbsp;angle,&nbsp;<br>
order);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(s&nbsp;!=&nbsp;<br>
Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;s&nbsp;=&nbsp;GdipRotateMatrix&nbsp;(graphics-&amp;gt;clip_matrix,&nbsp;-angle,&nbsp;<br>
gdip_matrix_reverse_order&nbsp;(order));&lt;BR&gt;&amp;nbsp;if&nbsp;(s&nbsp;!=&nbsp;Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
s;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;color=#0000ff&gt;&amp;nbsp;apply_world_to_bounds&nbsp;(graphics);&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;switch&nbsp;(graphics-&amp;gt;backend)&nbsp;{&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndCairo:&lt;BR&gt;&amp;nbsp;&amp;nbsp;/*&nbsp;not&nbsp;a&nbsp;typo&nbsp;-&nbsp;we&nbsp;apply&nbsp;to&nbsp;calculated&nbsp;<br>
matrix&nbsp;to&nbsp;cairo&nbsp;context&nbsp;*/&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;cairo_SetWorldTransform&nbsp;<br>
(graphics,&nbsp;graphics-&amp;gt;copy_of_ctm);&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndMetafile:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;metafile_RotateWorldTransform&nbsp;<br>
(graphics,&nbsp;angle,&nbsp;order);&lt;BR&gt;&amp;nbsp;default:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
GenericError;&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;}&lt;/P&gt;<br>
&lt;P&gt;GpStatus&nbsp;WINGDIPAPI&nbsp;GdipScaleWorldTransform&nbsp;(GpGraphics&nbsp;*graphics,&nbsp;float&nbsp;sx,&nbsp;<br>
float&nbsp;sy,&nbsp;GpMatrixOrder&nbsp;order)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;GpStatus&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;if&nbsp;(!graphics&nbsp;||&nbsp;(sx&nbsp;==&nbsp;0.0f)&nbsp;||&nbsp;(sy&nbsp;==&nbsp;0.0f))&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
InvalidParameter;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s&nbsp;=&nbsp;GdipScaleMatrix&nbsp;<br>
(graphics-&amp;gt;copy_of_ctm,&nbsp;sx,&nbsp;sy,&nbsp;<br>
order);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(s&nbsp;!=&nbsp;<br>
Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;s&nbsp;=&nbsp;GdipScaleMatrix&nbsp;(graphics-&amp;gt;clip_matrix,&nbsp;(1.0f&nbsp;/&nbsp;sx),&nbsp;(1.0f&nbsp;/&nbsp;<br>
sy),&nbsp;gdip_matrix_reverse_order&nbsp;(order));&lt;BR&gt;&amp;nbsp;if&nbsp;(s&nbsp;!=&nbsp;<br>
Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;&lt;FONT&nbsp;color=#0000ff&gt;&amp;nbsp;apply_world_to_bounds&nbsp;(graphics);&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;switch&nbsp;(graphics-&amp;gt;backend)&nbsp;{&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndCairo:&lt;BR&gt;&amp;nbsp;&amp;nbsp;/*&nbsp;not&nbsp;a&nbsp;typo&nbsp;-&nbsp;we&nbsp;apply&nbsp;to&nbsp;calculated&nbsp;<br>
matrix&nbsp;to&nbsp;cairo&nbsp;context&nbsp;*/&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;cairo_SetWorldTransform&nbsp;<br>
(graphics,&nbsp;graphics-&amp;gt;copy_of_ctm);&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndMetafile:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;metafile_ScaleWorldTransform&nbsp;<br>
(graphics,&nbsp;sx,&nbsp;sy,&nbsp;order);&lt;BR&gt;&amp;nbsp;default:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
GenericError;&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;}&lt;/P&gt;<br>
&lt;P&gt;GpStatus&nbsp;WINGDIPAPI&nbsp;GdipTranslateWorldTransform&nbsp;(GpGraphics&nbsp;*graphics,&nbsp;float&nbsp;<br>
dx,&nbsp;float&nbsp;dy,&nbsp;GpMatrixOrder&nbsp;order)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;GpStatus&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;if&nbsp;(!graphics)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;InvalidParameter;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s&nbsp;=&nbsp;GdipTranslateMatrix&nbsp;<br>
(graphics-&amp;gt;copy_of_ctm,&nbsp;dx,&nbsp;dy,&nbsp;<br>
order);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(s&nbsp;!=&nbsp;Ok)&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;s;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;s&nbsp;=&nbsp;GdipTranslateMatrix&nbsp;(graphics-&amp;gt;clip_matrix,&nbsp;-dx,&nbsp;-dy,&nbsp;<br>
gdip_matrix_reverse_order&nbsp;(order));&lt;BR&gt;&amp;nbsp;if&nbsp;(s&nbsp;!=&nbsp;Ok)&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
s;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&lt;FONT&nbsp;color=#0000ff&gt;&amp;nbsp;apply_world_to_bounds&nbsp;<br>
(graphics);&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&amp;nbsp;switch&nbsp;(graphics-&amp;gt;backend)&nbsp;{&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndCairo:&lt;BR&gt;&amp;nbsp;&amp;nbsp;/*&nbsp;not&nbsp;a&nbsp;typo&nbsp;-&nbsp;we&nbsp;apply&nbsp;to&nbsp;calculated&nbsp;<br>
matrix&nbsp;to&nbsp;cairo&nbsp;context&nbsp;*/&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;cairo_SetWorldTransform&nbsp;<br>
(graphics,&nbsp;graphics-&amp;gt;copy_of_ctm);&lt;BR&gt;&amp;nbsp;case&nbsp;<br>
GraphicsBackEndMetafile:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;metafile_TranslateWorldTransform&nbsp;<br>
(graphics,&nbsp;dx,&nbsp;dy,&nbsp;order);&lt;BR&gt;&amp;nbsp;default:&lt;BR&gt;&amp;nbsp;&amp;nbsp;return&nbsp;<br>
GenericError;&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;}&lt;BR&gt;&lt;/P&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
