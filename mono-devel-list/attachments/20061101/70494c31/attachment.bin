/*
 Proxy configuration file test.
 
 1. Compile with "gmcs settingstest.cs -define:NET_2_0 -out:net20.exe ; mcs settingstest.cs -out:net11.exe;"
 2. Edit both 1.1 and 2.0 machine.configs to add <system.net><defaultProxy><proxy address="http://proxy.example.com"
 3. Run mono net11.exe; mono net20.exe
 
 Output on Mono SVN and 1.1.17 is
 
#######
 .NET 1.1
 Config object type is System.Net.WebProxy
 IWebProxy: Proxy address is http://proxy.example.com/
 
 .NET 2.0

 Config object type is System.Net.Configuration.DefaultProxySection
 DefaultProxySection.Proxy: Address is 
#######

 This demonstrates that Mono 1.1 respects machine.config settings with 
 ConfigurationSettings.GetConfig, while Mono 2.0 does not. Is this behaviour correct?

*/

using System;
using System.Configuration;

namespace ProxyTest
{
	class MainClass
	{
		public static void Main(string[] args)
		{
#if NET_2_0
			System.Console.WriteLine ("\n.NET 2.0\n");
#else
			System.Console.WriteLine ("\n.NET 1.1\n");
#endif
			
			object p = ConfigurationSettings.GetConfig ("system.net/defaultProxy");
			
			System.Console.WriteLine ("Config object type is {0}", p.GetType ().ToString ());
			
			System.Net.IWebProxy proxy = p as System.Net.IWebProxy;
			if (proxy != null) {
				string addr = proxy.GetProxy (new Uri ("http://www.google.com")).ToString ();
				System.Console.WriteLine ("IWebProxy: Proxy address is {0}", addr);
			}
#if NET_2_0
			System.Net.Configuration.DefaultProxySection sec = p as System.Net.Configuration.DefaultProxySection;
			if (sec != null) {
				System.Console.WriteLine ("DefaultProxySection.Proxy: Address is {0}", sec.Proxy.ProxyAddress);
			}
#endif			
		}
	}
}