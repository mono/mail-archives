Index: libgc/win32_threads.c
===================================================================
--- libgc/win32_threads.c	(revision 88551)
+++ libgc/win32_threads.c	(working copy)
@@ -386,6 +386,10 @@
 #       if defined(I386)
           PUSH4(Edi,Esi,Ebx,Edx), PUSH2(Ecx,Eax), PUSH1(Ebp);
 	  sp = (ptr_t)context.Esp;
+	  #	elif defined(X86_64)
+	  PUSH4(Rax,Rcx,Rdx,Rbx); PUSH2(Rbp, Rsi); PUSH1(Rdi);
+	  PUSH4(R8, R9, R10, R11); PUSH4(R12, R13, R14, R15);
+	  sp = (ptr_t)context.Rsp;
 #       elif defined(ARM32)
 	  PUSH4(R0,R1,R2,R3),PUSH4(R4,R5,R6,R7),PUSH4(R8,R9,R10,R11),PUSH1(R12);
 	  sp = (ptr_t)context.Sp;
Index: libgc/include/private/gcconfig.h
===================================================================
--- libgc/include/private/gcconfig.h	(revision 88551)
+++ libgc/include/private/gcconfig.h	(working copy)
@@ -399,7 +399,11 @@
 # else
 #   if (defined(_MSDOS) || defined(_MSC_VER)) && (_M_IX86 >= 300) \
         || defined(_WIN32) && !defined(__CYGWIN32__) && !defined(__CYGWIN__)
-#     define I386
+#     if defined(__LP64__) || defined(_WIN64)
+#	define X86_64
+#     else
+#       define I386
+#     endif
 #     define MSWIN32	/* or Win32s */
 #     define mach_type_known
 #   endif
Index: libgc/ChangeLog
===================================================================
--- libgc/ChangeLog	(revision 88551)
+++ libgc/ChangeLog	(working copy)
@@ -1,4 +1,13 @@
+2007-10-31  Jonathan Chambers  <joncham@gmail.com>
 
+	* win32_threads.c: Backport changes from libgc 7.0 to support
+	Win64.
+	
+	* include/private/gcconfig.h: Backport changes from libgc 7.0 to support
+	Win64.
+	
+	Contributed under MIT/X11 license.
+
 Mon Sep 24 16:15:47 CEST 2007 Paolo Molaro <lupus@ximian.com>
 
 	* include/private/gc_priv.h: increase the default MAX_HEAP_SECTS