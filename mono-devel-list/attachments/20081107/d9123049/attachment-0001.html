<tt>
Hi&nbsp;Christophe,&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2008/11/7&nbsp;Christophe&nbsp;Guillon&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:christophe.guillon.perso@gmail.com&quot;&gt;christophe.guillon.perso@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Thank&nbsp;you&nbsp;for&nbsp;the&nbsp;explanation.&nbsp;It&nbsp;confirms&nbsp;my&nbsp;point&nbsp;and&nbsp;it&nbsp;seems&nbsp;that&nbsp;we&nbsp;agree.&lt;br&gt;&lt;br&gt;For&nbsp;the&nbsp;user&nbsp;guide&nbsp;aspect:&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&amp;gt;2)&nbsp;the&nbsp;attributes&nbsp;on&nbsp;the&nbsp;methods&nbsp;are&nbsp;never&nbsp;inspected&nbsp;by&nbsp;the&nbsp;runtime:&lt;br&gt;<br>
&amp;gt;they&nbsp;are&nbsp;there&nbsp;to&nbsp;guide&nbsp;the&nbsp;programmers&nbsp;using&nbsp;Mono.Simd&nbsp;in&nbsp;determining&lt;br&gt;<br>
&amp;gt;what&nbsp;kind&nbsp;of&nbsp;optimizations&nbsp;are&nbsp;usually&nbsp;available&nbsp;or&nbsp;currently&nbsp;enabled.&lt;br&gt;&lt;/div&gt;<br>
If&nbsp;it&nbsp;is&nbsp;indeed&nbsp;&amp;quot;just&amp;quot;&nbsp;a&nbsp;guide&nbsp;to&nbsp;the&nbsp;user&nbsp;of&nbsp;Mono.Simd,&nbsp;thus&nbsp;why&nbsp;putting&nbsp;it&nbsp;in&nbsp;the&nbsp;library&nbsp;and&nbsp;coupling&nbsp;this&nbsp;with&nbsp;the&nbsp;specific&nbsp;architecture&nbsp;(SSE2&nbsp;or&nbsp;other).&nbsp;The&nbsp;fact&nbsp;that&nbsp;it&nbsp;is&nbsp;an&nbsp;AddWithSaturation&nbsp;on&nbsp;a&nbsp;Vector16b&nbsp;is&nbsp;sufficient&nbsp;for&nbsp;the&nbsp;semantic.&nbsp;Then&nbsp;a&nbsp;note&nbsp;in&nbsp;the&nbsp;mono&nbsp;VM&nbsp;documentation&nbsp;can&nbsp;tell&nbsp;that&nbsp;on&nbsp;SSE2&nbsp;architectures&nbsp;-O=simd&nbsp;will&nbsp;select&nbsp;the&nbsp;corresponding&nbsp;SSE2&nbsp;op&nbsp;is&nbsp;sufficient.&nbsp;Optionaly&nbsp;a&nbsp;note&nbsp;in&nbsp;the&nbsp;library&nbsp;documentation&nbsp;can&nbsp;tell&nbsp;that&nbsp;mono&nbsp;&amp;quot;normally&amp;quot;&nbsp;should&nbsp;catch&nbsp;such&nbsp;calls&nbsp;on&nbsp;SSE2&nbsp;architectures.&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;We&nbsp;want&nbsp;to&nbsp;expose&nbsp;this&nbsp;information&nbsp;on&nbsp;the&nbsp;documentation&nbsp;as&nbsp;well&nbsp;and&nbsp;instead&nbsp;of&nbsp;having&nbsp;to&nbsp;dig&nbsp;this&nbsp;information&nbsp;twice&nbsp;we&nbsp;are&nbsp;planning&nbsp;on&nbsp;generating&nbsp;this&nbsp;part&nbsp;of&nbsp;the&nbsp;docs.&lt;br&gt;<br>
&lt;br&gt;&amp;nbsp;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;For&nbsp;the&nbsp;choice&nbsp;of&nbsp;the&nbsp;accelerated&nbsp;or&nbsp;not&nbsp;accelerated&nbsp;mode&nbsp;at&nbsp;runtime:&lt;br&gt;&amp;gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;readonly&nbsp;bool&nbsp;use_mono_simd&nbsp;=&nbsp;(SimdRuntime.AccelMode&nbsp;&amp;amp;&nbsp;AccelMode.SSE2)&nbsp;!=&nbsp;&amp;gt;0;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&amp;gt;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;...&lt;br&gt;<br>
<br>
&nbsp;&amp;gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(use_mono_simd)&lt;br&gt;<br>
&nbsp;&amp;gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;simd&nbsp;codepath&lt;br&gt;<br>
&nbsp;&amp;gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&lt;br&gt;<br>
&nbsp;&amp;gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//scalar&nbsp;codepath&lt;br&gt;&lt;/div&gt;If&nbsp;it&nbsp;is&nbsp;actually&nbsp;to&nbsp;overcome&nbsp;a&nbsp;temporary&nbsp;inneficiency&nbsp;due&nbsp;to&nbsp;some&nbsp;copy,&nbsp;it&nbsp;is&nbsp;imho&nbsp;far&nbsp;too&nbsp;intrusive&nbsp;in&nbsp;the&nbsp;user&nbsp;code.&nbsp;Here&nbsp;the&nbsp;user&nbsp;clearly&nbsp;wrote&nbsp;a&nbsp;code&nbsp;that&nbsp;is&nbsp;dependent&nbsp;on&nbsp;some&nbsp;&amp;quot;external&amp;quot;&nbsp;context,&nbsp;but&nbsp;instead&nbsp;of&nbsp;querying&nbsp;the&nbsp;actual&nbsp;VM&nbsp;runtime,&nbsp;or&nbsp;simply&nbsp;a&nbsp;user&nbsp;defined&nbsp;variable&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;some&nbsp;configuration&nbsp;file&nbsp;of&nbsp;the&nbsp;application,&nbsp;the&nbsp;query&nbsp;is&nbsp;on&nbsp;the&nbsp;Mono.Simd&nbsp;library&nbsp;itself.&lt;br&gt;<br>
<br>
While&nbsp;in&nbsp;fact&nbsp;the&nbsp;library&nbsp;itself&nbsp;as&nbsp;no&nbsp;knowledge&nbsp;of&nbsp;the&nbsp;actual&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;running&nbsp;VM.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;There&nbsp;are&nbsp;two&nbsp;good&nbsp;reasons&nbsp;for&nbsp;using&nbsp;this&nbsp;approach,&nbsp;the&nbsp;first&nbsp;one&nbsp;is&nbsp;because&nbsp;the&nbsp;user&nbsp;requires&nbsp;the&nbsp;best&nbsp;performance&nbsp;in&nbsp;all&nbsp;situations&nbsp;and&nbsp;want&nbsp;to&nbsp;know&nbsp;if&nbsp;it&amp;#39;s&nbsp;method&nbsp;will&nbsp;be&nbsp;optimized&nbsp;or&nbsp;not.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;second&nbsp;reason&nbsp;happens&nbsp;when&nbsp;there&nbsp;are&nbsp;many&nbsp;different&nbsp;ways&nbsp;to&nbsp;implement&nbsp;a&nbsp;given&nbsp;function,&nbsp;each&nbsp;one&nbsp;using&nbsp;different&nbsp;instruction&nbsp;sets&nbsp;and&nbsp;the&nbsp;user&nbsp;wants&nbsp;to&nbsp;have&nbsp;improved&nbsp;performance&nbsp;on&nbsp;newer&nbsp;processors.&lt;br&gt;&lt;br&gt;For&nbsp;example,&nbsp;there&nbsp;are&nbsp;3&nbsp;ways&nbsp;to&nbsp;implement&nbsp;dot&nbsp;product&nbsp;using&nbsp;Mono.Simd:&lt;br&gt;<br>
&lt;br&gt;1)&nbsp;Only&nbsp;using&nbsp;sse1&nbsp;and&nbsp;sse2&nbsp;which&nbsp;takes&nbsp;5&nbsp;instructions&nbsp;(1&nbsp;mul,&nbsp;2&nbsp;add&nbsp;and&nbsp;2&nbsp;shuffle)&lt;br&gt;2)&nbsp;Using&nbsp;sse3,&nbsp;which&nbsp;takes&nbsp;3&nbsp;instructions&nbsp;(1&nbsp;mul,&nbsp;2&nbsp;hadd)&lt;br&gt;3)&nbsp;Using&nbsp;sse4.2&nbsp;which&nbsp;takes&nbsp;1&nbsp;instruction&nbsp;(dotp)&nbsp;--&nbsp;sse4.2&nbsp;still&nbsp;not&nbsp;supported&nbsp;by&nbsp;Mono.Simd.&lt;br&gt;<br>
&lt;br&gt;For&nbsp;some&nbsp;users&nbsp;having&nbsp;this&nbsp;option&nbsp;is&nbsp;important&nbsp;and&nbsp;this&nbsp;is&nbsp;the&nbsp;main&nbsp;objective&nbsp;of&nbsp;the&nbsp;runtime&nbsp;query&nbsp;capabilities.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;br&gt;&lt;br&gt;Thus&nbsp;I&nbsp;fully&nbsp;agree&nbsp;with&nbsp;this&nbsp;(which&nbsp;is&nbsp;my&nbsp;point):&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&amp;quot;Note&nbsp;that&nbsp;we&nbsp;may&nbsp;eventually&nbsp;either&nbsp;return&nbsp;the&nbsp;attribute&nbsp;not&nbsp;based&nbsp;on&nbsp;the&lt;br&gt;<br>
<br>
metadata&nbsp;in&nbsp;the&nbsp;assembly,&nbsp;but&nbsp;based&nbsp;on&nbsp;the&nbsp;runtime&nbsp;understanding:&nbsp;this&lt;br&gt;<br>
will&nbsp;avoid&nbsp;the&nbsp;need&nbsp;to&nbsp;have&nbsp;an&nbsp;updated&nbsp;Mono.Simd&nbsp;assembly&nbsp;when&nbsp;new&lt;br&gt;<br>
optimizations&nbsp;are&nbsp;added.&nbsp;Just&nbsp;use&nbsp;the&nbsp;b&nbsp;pattern&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;avoid&lt;br&gt;<br>
that&nbsp;issue&nbsp;and&nbsp;remember&nbsp;that&nbsp;you&nbsp;don&amp;#39;t&nbsp;usually&nbsp;need&nbsp;to&nbsp;check&nbsp;all&nbsp;the&lt;br&gt;<br>
methods,&nbsp;but&nbsp;just&nbsp;the&nbsp;ones&nbsp;you&nbsp;actually&nbsp;need&nbsp;to&nbsp;be&nbsp;optimized.&amp;quot;&lt;br&gt;&lt;br&gt;&lt;/div&gt;All&nbsp;the&nbsp;question&nbsp;there&nbsp;is,&nbsp;whether&nbsp;or&nbsp;not&nbsp;there&nbsp;is&nbsp;a&nbsp;way&nbsp;to&nbsp;get&nbsp;from&nbsp;the&nbsp;runtime&nbsp;this&nbsp;information&nbsp;and&nbsp;by&nbsp;which&nbsp;mean?&lt;br&gt;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;have&nbsp;attributes&nbsp;attached&nbsp;(or&nbsp;simulated)&nbsp;by&nbsp;the&nbsp;runtime?&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;The&nbsp;SimdRuntime.AccelMode&nbsp;property&nbsp;queries&nbsp;the&nbsp;runtime&nbsp;for&nbsp;the&nbsp;supported&nbsp;instruction&nbsp;sets.&nbsp;You&nbsp;might&nbsp;look&lt;br&gt;at&nbsp;the&nbsp;implementation&nbsp;and&nbsp;get&nbsp;puzzled&nbsp;by&nbsp;the&nbsp;fact&nbsp;that&nbsp;it&nbsp;returns&nbsp;AccelMode.None,&nbsp;but&nbsp;in&nbsp;fact&nbsp;this&nbsp;is&nbsp;a&nbsp;&amp;quot;magic&nbsp;method&amp;quot;&lt;br&gt;<br>
that&nbsp;the&nbsp;runtime&nbsp;takes&nbsp;special&nbsp;care&nbsp;and&nbsp;make&nbsp;sure&nbsp;it&nbsp;returns&nbsp;the&nbsp;right&nbsp;thing.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;taking&nbsp;your&nbsp;time&nbsp;looking&nbsp;at&nbsp;the&nbsp;Mono.Simd&nbsp;library&nbsp;:)&lt;br&gt;&lt;br&gt;&lt;br&gt;Cheers,&lt;br&gt;Rodrigo&lt;br&gt;<br>

</tt>
