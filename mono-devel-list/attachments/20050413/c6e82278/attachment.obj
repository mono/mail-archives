--- atomic.h	2005-04-13 12:03:01.000000000 -0600
+++ atomic.hmine	2005-04-13 12:20:33.000000000 -0600
@@ -421,26 +421,26 @@
 static inline gint32 InterlockedIncrement(volatile gint32 *val)
 {
-	gint32 result = 0, tmp;
+	gint32 result;
 
 	__asm__ __volatile__ ("\n1:\n\t"
 			      "lwarx  %0, 0, %2\n\t"
-			      "addi   %1, %0, 1\n\t"
-                              "stwcx. %1, 0, %2\n\t"
+			      "addi   %0, %0, 1\n\t"
+                              "stwcx. %0, 0, %2\n\t"
 			      "bne-   1b"
-			      : "=&b" (result), "=&b" (tmp): "r" (val): "cc", "memory");
-	return result + 1;
+			      : "=&r" (result): "r" (val): "cc", "memory");
+	return result;
 }
 
 static inline gint32 InterlockedDecrement(volatile gint32 *val)
 {
-	gint32 result = 0, tmp;
+	gint32 result;
 
 	__asm__ __volatile__ ("\n1:\n\t"
 			      "lwarx  %0, 0, %2\n\t"
-			      "addi   %1, %0, -1\n\t"
-                              "stwcx. %1, 0, %2\n\t"
+			      "addi   %0, %0, -1\n\t"
+                              "stwcx. %0, 0, %2\n\t"
 			      "bne-   1b"
-			      : "=&b" (result), "=&b" (tmp): "r" (val): "cc", "memory");
-	return result - 1;
+			      : "=&r" (result) : "r" (val): "cc", "memory");
+	return result;
 }
 
@@ -465,11 +465,11 @@
 static inline gint32 InterlockedExchange(volatile gint32 *dest, gint32 exch)
 {
-	gint32 tmp = 0;
+	gint32 result;
 
 	__asm__ __volatile__ ("\n1:\n\t"
-			      "lwarx  %0, 0, %2\n\t"
-			      "stwcx. %3, 0, %2\n\t"
+			      "lwarx  %0, 0, %1\n\t"
+			      "stwcx. %2, 0, %1\n\t"
 			      "bne    1b"
-			      : "=r" (tmp) : "0" (tmp), "b" (dest), "r" (exch): "cc", "memory");
+			      : "=&r" (result) : "b" (dest), "r" (exch): "cc", "memory");
- 	return(tmp);
+ 	return(result);
 }