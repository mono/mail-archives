Index: gmcs/class.cs
===================================================================
RCS file: /cvs/public/mcs/gmcs/class.cs,v
retrieving revision 1.66
diff -u -u -r1.66 class.cs
--- gmcs/class.cs	19 May 2004 19:32:24 -0000	1.66
+++ gmcs/class.cs	20 May 2004 10:42:53 -0000
@@ -396,7 +396,7 @@
 			if (indexers == null)
 				indexers = new ArrayList ();
 
-			if (i.ExplicitInterfaceName != null)
+			if (i.MemberName.TypeName != null)
 				indexers.Insert (0, i);
 			else
 				indexers.Add (i);
@@ -1107,7 +1107,7 @@
 			// Invariant maintained by AddIndexer(): All explicit interface indexers precede normal indexers
 			bool seen_normal_indexers = false;
 			foreach (Indexer i in Indexers) {
-				if (i.MemberName.TypeName != null)
+				if (i.MemberName.TypeName == null)
 					seen_normal_indexers = true;
 				else if (seen_normal_indexers)
 					throw new Exception ("Internal Error: 'Indexers' array not sorted properly.");
@@ -3739,7 +3739,7 @@
 		string obsolete = null;
 		bool obsolete_error = false;
 
-		public virtual bool ApplyAttributes (Attributes opt_attrs, bool is_method, DeclSpace ds)
+		public virtual bool ApplyAttributes (Attributes opt_attrs, bool is_method, EmitContext ec)
 		{
 			if ((opt_attrs == null) || (opt_attrs.AttributeSections == null))
 				return true;
@@ -3747,7 +3747,7 @@
 			foreach (AttributeSection asec in opt_attrs.AttributeSections) {
 				if (asec.Attributes == null)
 					continue;
-					
+
 				foreach (Attribute a in asec.Attributes) {
 					Type attr_type = a.ResolveType (ec, true);
 					if (attr_type == TypeManager.conditional_attribute_type) {
@@ -3921,8 +3921,10 @@
 			MethodInfo implementing = null;
 			string prefix;
 
+			ec = method.CreateEmitContext (container, null);
+
 			if (method.OptAttributes != null)
-				if (!ApplyAttributes (method.OptAttributes, is_method, container))
+				if (!ApplyAttributes (method.OptAttributes, is_method, ec))
 					return false;
 
 			if (member.IsExplicitImpl)
@@ -4020,8 +4022,6 @@
 
 				IsImplementing = true;
 			}
-
-			ec = method.CreateEmitContext (container, null);
 
 			//
 			// Create the MethodBuilder for the method
