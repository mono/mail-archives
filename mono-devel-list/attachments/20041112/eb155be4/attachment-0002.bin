Index: mini.c
===================================================================
--- mini.c	(revision 36050)
+++ mini.c	(working copy)
@@ -2350,6 +2350,13 @@
 	MonoVTable *vtable;
 	int i;
 
+	/*
+	 * CAS - do not inline methods with declarative security
+	 * Note: this has to be before any possible return TRUE;
+	 */
+	if (mono_method_has_declsec (method))
+		return FALSE;
+
 #ifdef MONO_ARCH_HAVE_LMF_OPS
 	if (((method->iflags & METHOD_IMPL_ATTRIBUTE_INTERNAL_CALL) ||
 		 (method->flags & METHOD_ATTRIBUTE_PINVOKE_IMPL)) &&
Index: mini.h
===================================================================
--- mini.h	(revision 36050)
+++ mini.h	(working copy)
@@ -18,6 +18,7 @@
 
 #include "mini-arch.h"
 #include "regalloc.h"
+#include "declsec.h"
 
 #define MONO_USE_AOT_COMPILER
 
Index: ChangeLog
===================================================================
--- ChangeLog	(revision 36050)
+++ ChangeLog	(working copy)
@@ -1,4 +1,11 @@
+2004-11-12  Sebastien Pouliot  <sebastien@ximian.com>
 
+	* declsec.c|h: New files to support declarative security attributes.
+	Added function to check if a method has (applicable) security.
+	* mini.c|h: Add check for declarative security attributes in 
+	mono_method_check_inlining.
+	* Makefile.am: Added declsec.c and declsec.h to the build.
+
 Thu Nov 11 20:17:17 CET 2004 Paolo Molaro <lupus@ximian.com>
 
 	* mini-ppc.c, mini-ppc,h, cpu-g5.md, exceptions-ppc.c:
Index: Makefile.am
===================================================================
--- Makefile.am	(revision 36050)
+++ Makefile.am	(working copy)
@@ -165,7 +165,9 @@
 	debug-mini.c	\
 	linear-scan.c	\
 	aot.c		\
-	graph.c	
+	graph.c		\
+	declsec.c	\
+	declsec.h
 
 test_sources = 		\
 	basic-calls.cs 	\
