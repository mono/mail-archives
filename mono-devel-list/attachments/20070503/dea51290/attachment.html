<tt>
Attached&nbsp;is&nbsp;new&nbsp;patch&nbsp;(hopefully)&nbsp;addressing&nbsp;all&nbsp;previous&nbsp;issues.&nbsp;I&nbsp;renamed&nbsp;methods&nbsp;to&nbsp;mono_thread_init_apartment_state&nbsp;and&nbsp;mono_thread_cleanup_apartment_state.&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Jonathan&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;5/3/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Paolo&nbsp;Molaro&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:lupus@ximian.com&quot;&gt;lupus@ximian.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
On&nbsp;05/02/07&nbsp;Jonathan&nbsp;Chambers&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;Index:&nbsp;mono/mono/metadata/threads.c&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;mono/mono/metadata/threads.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(revision&nbsp;76569)&lt;br&gt;<br>
&amp;gt;&nbsp;+++&nbsp;mono/mono/metadata/threads.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(working&nbsp;copy)&lt;br&gt;[...]&lt;br&gt;&amp;gt;&nbsp;+void&nbsp;mono_thread_set_apartment_state&nbsp;()&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&lt;br&gt;should&nbsp;be:&lt;br&gt;&lt;br&gt;void&lt;br&gt;mono_thread_set_apartment_state&nbsp;(void)&lt;br&gt;&lt;br&gt;It&nbsp;may&nbsp;also&nbsp;be&nbsp;better&nbsp;to&nbsp;name&nbsp;the&nbsp;function&nbsp;mono_thread_apply_apartment_state.<br>
&lt;br&gt;&lt;br&gt;&amp;gt;&nbsp;Index:&nbsp;mono/mono/metadata/object.c&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;mono/mono/metadata/object.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;76569)&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;mono/mono/metadata/object.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)<br>
&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-2387,6&nbsp;+2387,7&nbsp;@@&lt;br&gt;[...]&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cinfo&nbsp;=&nbsp;mono_custom_attrs_from_method&nbsp;(method);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(cinfo)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;MonoClass&nbsp;*stathread_attribute&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoThread*&nbsp;thread&nbsp;=&nbsp;mono_thread_current&nbsp;();<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoObject*&nbsp;stathread_object;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!stathread_attribute)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;stathread_attribute&nbsp;=&nbsp;mono_class_from_name&nbsp;(mono_defaults.corlib,&nbsp;&amp;quot;System&amp;quot;,&nbsp;&amp;quot;STAThreadAttribute&amp;quot;);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_custom_attrs_get_attr&nbsp;(cinfo,&nbsp;stathread_attribute);&lt;br&gt;&lt;br&gt;As&nbsp;zoltan&nbsp;said,&nbsp;use&nbsp;mono_custom_attrs_has_attr().&lt;br&gt;&lt;br&gt;&amp;gt;&nbsp;Index:&nbsp;mono/mono/metadata/object-internals.h&lt;br&gt;&amp;gt;&nbsp;===================================================================<br>
&lt;br&gt;&amp;gt;&nbsp;---&nbsp;mono/mono/metadata/object-internals.h&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;76569)&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;mono/mono/metadata/object-internals.h&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-274,7&nbsp;+274,7&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoBoolean&nbsp;thread_dump_requested;&lt;br&gt;<br>
&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;gpointer&nbsp;end_stack;&nbsp;/*&nbsp;This&nbsp;is&nbsp;only&nbsp;used&nbsp;when&nbsp;running&nbsp;in&nbsp;the&nbsp;debugger.&nbsp;*/&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoBoolean&nbsp;thread_interrupt_requested;&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;gpointer&nbsp;unused4;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;guint32&nbsp;apartment_state;&lt;br&gt;&lt;br&gt;Since&nbsp;you&nbsp;need&nbsp;just&nbsp;2&nbsp;bits,&nbsp;please&nbsp;use&nbsp;a&nbsp;guint8&nbsp;type.<br>
&lt;br&gt;&lt;br&gt;Thanks!&lt;br&gt;&lt;br&gt;lupus&lt;br&gt;&lt;br&gt;--&lt;br&gt;-----------------------------------------------------------------&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:lupus@debian.org&quot;&gt;lupus@debian.org&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;debian/rules&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:lupus@ximian.com&quot;&gt;<br>
lupus@ximian.com&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Monkeys&nbsp;do&nbsp;it&nbsp;better&lt;br&gt;_______________________________________________&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com<br>
&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
