<tt>
2009/1/13&nbsp;Jonathan&nbsp;Pryor&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jonpryor@vt.edu&quot;&gt;jonpryor@vt.edu&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;On&nbsp;Tue,&nbsp;2009-01-13&nbsp;at&nbsp;16:13&nbsp;+0100,&nbsp;Alfredo&nbsp;José&nbsp;Muela&nbsp;Romero&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;My&nbsp;current&nbsp;problem,&nbsp;which&nbsp;I&amp;#39;m&nbsp;running&nbsp;out&nbsp;of&nbsp;ideas&nbsp;:/&nbsp;is&nbsp;about&nbsp;how&nbsp;to&lt;br&gt;<br>
&amp;gt;&nbsp;get&nbsp;a&nbsp;call&nbsp;from&nbsp;the&nbsp;dinamic&nbsp;to&nbsp;the&nbsp;wrapped&nbsp;code.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Let&amp;#39;s&nbsp;say&nbsp;I&nbsp;have&nbsp;a&nbsp;dynamic&nbsp;library&nbsp;(in&nbsp;C++&nbsp;for&nbsp;instance)&nbsp;which&lt;br&gt;<br>
&amp;gt;&nbsp;implements&nbsp;a&nbsp;Model-View-Controller&nbsp;pattern.&nbsp;In&nbsp;that&nbsp;library&nbsp;exists&nbsp;a&lt;br&gt;<br>
&amp;gt;&nbsp;method&nbsp;which&nbsp;receives&nbsp;a&nbsp;pointer&nbsp;to&nbsp;an&nbsp;object&nbsp;as&nbsp;a&nbsp;parameter&nbsp;in&nbsp;order&lt;br&gt;<br>
&amp;gt;&nbsp;to&nbsp;notify&nbsp;later&nbsp;changes.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Does&nbsp;anyone&nbsp;know&nbsp;a&nbsp;way&nbsp;to&nbsp;get&nbsp;that&nbsp;call&nbsp;to&nbsp;the&nbsp;C#&nbsp;code&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Delegates&nbsp;are&nbsp;your&nbsp;friend.&nbsp;&amp;nbsp;Delegates&nbsp;marshal&nbsp;to&nbsp;a&nbsp;function&nbsp;pointer&nbsp;that&lt;br&gt;<br>
can&nbsp;be&nbsp;called&nbsp;from&nbsp;C/C++&nbsp;code,&nbsp;e.g.&nbsp;given:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;delegate&nbsp;int&nbsp;Foo&nbsp;(string&nbsp;s);&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;[DllImport]&nbsp;static&nbsp;extern&nbsp;void&nbsp;PerformCallback(Foo&nbsp;f);&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;...&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Func&amp;lt;string,&nbsp;int&amp;gt;&nbsp;f&nbsp;=&nbsp;s&nbsp;=&amp;gt;&nbsp;s.Length;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;PerformCallback&nbsp;(f);&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;f&nbsp;=&nbsp;null;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;C++&nbsp;code&nbsp;would&nbsp;be:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;void&nbsp;PerformCallback(int&nbsp;(*cb)(const&nbsp;char*&nbsp;s))&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;cb&nbsp;(&amp;quot;hello!&amp;quot;);&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;works&nbsp;pretty&nbsp;well&nbsp;for&nbsp;functions.&nbsp;&amp;nbsp;If&nbsp;you&nbsp;need&nbsp;to&nbsp;pass&nbsp;actual&nbsp;C++&lt;br&gt;<br>
objects&nbsp;around,&nbsp;things&nbsp;get&nbsp;more&nbsp;complicated.&nbsp;&amp;nbsp;You&nbsp;might&nbsp;be&nbsp;able&nbsp;to&lt;br&gt;<br>
create&nbsp;a&nbsp;C#&nbsp;class/structure&nbsp;to&nbsp;mirror&nbsp;the&nbsp;C++&nbsp;type,&nbsp;but&nbsp;such&nbsp;things&nbsp;can&lt;br&gt;<br>
get&nbsp;ugly,&nbsp;quick.&lt;br&gt;<br>
&lt;br&gt;<br>
Note:&nbsp;delegates&nbsp;passed&nbsp;to&nbsp;native&nbsp;code&nbsp;are&nbsp;only&nbsp;valid&nbsp;for&nbsp;as&nbsp;long&nbsp;as&nbsp;the&lt;br&gt;<br>
managed&nbsp;delegate&nbsp;exists.&nbsp;&amp;nbsp;In&nbsp;the&nbsp;above&nbsp;code,&nbsp;the&nbsp;native&nbsp;callback&nbsp;will&lt;br&gt;<br>
only&nbsp;be&nbsp;valid&nbsp;for&nbsp;the&nbsp;life&nbsp;of&nbsp;the&nbsp;PerformCallback()&nbsp;call.&nbsp;&amp;nbsp;If&nbsp;you&nbsp;need&lt;br&gt;<br>
it&nbsp;to&nbsp;last&nbsp;longer,&nbsp;you&amp;#39;ll&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;delegate&nbsp;as&nbsp;a&nbsp;member&nbsp;and&lt;br&gt;<br>
otherwise&nbsp;ensure&nbsp;it&nbsp;isn&amp;#39;t&nbsp;collected.&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;-&nbsp;Jon&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;Hi&nbsp;Jon,&lt;br&gt;&lt;br&gt;I&amp;#39;m&nbsp;aware&nbsp;about&nbsp;the&nbsp;delegate&amp;#39;s&nbsp;marshalling,&nbsp;as&nbsp;I&nbsp;far&nbsp;as&nbsp;I&nbsp;understood&nbsp;and&nbsp;test&nbsp;them&nbsp;they&nbsp;seemed&nbsp;pretty&nbsp;much&nbsp;as&nbsp;a&nbsp;function&nbsp;pointer...&nbsp;I&amp;#39;m&nbsp;glad&nbsp;I&nbsp;got&nbsp;it&nbsp;right&nbsp;:)&lt;br&gt;&lt;br&gt;The&nbsp;issue&nbsp;is&nbsp;about&nbsp;giving&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;object&nbsp;and&nbsp;access&nbsp;to&nbsp;the&nbsp;method&nbsp;through&nbsp;the&nbsp;object.&lt;br&gt;<br>
&lt;br&gt;My&nbsp;thoughts&nbsp;were&nbsp;now&nbsp;on&nbsp;giving&nbsp;an&nbsp;extra&nbsp;functionallity&nbsp;to&nbsp;a&nbsp;proxy&nbsp;class&nbsp;which&nbsp;would&nbsp;use&nbsp;that&nbsp;function&nbsp;pointer&nbsp;(delegate&nbsp;in&nbsp;C#)&nbsp;to&nbsp;perform&nbsp;the&nbsp;callback.&nbsp;However,&nbsp;I&nbsp;guess&nbsp;that&nbsp;adding&nbsp;that&nbsp;indirection&nbsp;level&nbsp;may&nbsp;not&nbsp;be&nbsp;too&nbsp;&amp;quot;elegant&amp;quot;&nbsp;:S&lt;br&gt;<br>

</tt>
