<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/3.16.2&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
Hi,&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;Threads&nbsp;WAPI&nbsp;handle&nbsp;leaks&nbsp;has&nbsp;always&nbsp;caused&nbsp;problems&nbsp;with&nbsp;ASP.NET&nbsp;and&nbsp;MONO.&nbsp;In&nbsp;the&nbsp;past,&nbsp;there&nbsp;has&nbsp;been&nbsp;many&nbsp;bugs&nbsp;related&nbsp;to&nbsp;this&nbsp;problem...&lt;BR&gt;<br>
Now,&nbsp;we&nbsp;use&nbsp;mono&nbsp;to&nbsp;power&nbsp;our&nbsp;intranet&nbsp;(more&nbsp;than&nbsp;4000&nbsp;users...).&lt;BR&gt;<br>
&lt;BR&gt;<br>
I'm&nbsp;monitoring&nbsp;the&nbsp;number&nbsp;of&nbsp;wapi&nbsp;handles&nbsp;using&nbsp;mono&nbsp;--wapi=hps&nbsp;|&nbsp;wc&nbsp;-l&lt;BR&gt;<br>
&lt;BR&gt;<br>
During&nbsp;the&nbsp;day,&nbsp;the&nbsp;number&nbsp;of&nbsp;WAPI&nbsp;handles&nbsp;keeps&nbsp;stable.&nbsp;It&nbsp;seems&nbsp;that&nbsp;the&nbsp;GC&nbsp;collect&nbsp;them&nbsp;correctly...&nbsp;&lt;BR&gt;<br>
but&nbsp;during&nbsp;the&nbsp;night&nbsp;when&nbsp;our&nbsp;intranet&nbsp;is&nbsp;inactive&nbsp;the&nbsp;number&nbsp;of&nbsp;WAPI&nbsp;handles&nbsp;grows...&nbsp;&lt;BR&gt;<br>
and&nbsp;sometimes&nbsp;reach&nbsp;the&nbsp;limit&nbsp;of&nbsp;4096...&nbsp;And&nbsp;crashes&nbsp;the&nbsp;mod-mono-server's...&lt;BR&gt;<br>
&lt;BR&gt;<br>
Two&nbsp;question&nbsp;:&lt;BR&gt;<br>
-&amp;gt;&nbsp;why&nbsp;the&nbsp;number&nbsp;of&nbsp;WAPI&nbsp;handles&nbsp;grows...&nbsp;when&nbsp;there's&nbsp;no&nbsp;activity&nbsp;on&nbsp;the&nbsp;site&nbsp;(if&nbsp;the&nbsp;ASP.NET&nbsp;application&nbsp;has&nbsp;been&nbsp;very&nbsp;busy&nbsp;during&nbsp;the&nbsp;day...&nbsp;it&nbsp;will&nbsp;grows&nbsp;faster&nbsp;during&nbsp;the&nbsp;night)&nbsp;?&lt;BR&gt;<br>
&lt;BR&gt;<br>
-&amp;gt;&nbsp;don't&nbsp;you&nbsp;thing&nbsp;that&nbsp;a&nbsp;4096&nbsp;limit&nbsp;for&nbsp;WAPI&nbsp;handles&nbsp;is&nbsp;too&nbsp;small&nbsp;for&nbsp;big&nbsp;production&nbsp;servers?&nbsp;(on&nbsp;windows&nbsp;the&nbsp;number&nbsp;of&nbsp;handles&nbsp;is&nbsp;often&nbsp;&amp;gt;6000)?&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks&nbsp;for&nbsp;helping&nbsp;me&nbsp;fixing&nbsp;this&nbsp;issue&lt;BR&gt;<br>
&lt;BR&gt;<br>
Hubert&nbsp;FONGARNAND&lt;BR&gt;<br>
&lt;BR&gt;<br>
I've&nbsp;a&nbsp;workaround:&nbsp;I&nbsp;use&nbsp;my&nbsp;monitoring&nbsp;system&nbsp;to&nbsp;send&nbsp;a&nbsp;request&nbsp;(that&nbsp;do&nbsp;a&nbsp;GC.Collect())&nbsp;on&nbsp;each&nbsp;ASP.NET&nbsp;apps&nbsp;every&nbsp;5&nbsp;minutes&lt;BR&gt;<br>
&lt;BR&gt;<br>
Some&nbsp;graphs&nbsp;(without&nbsp;the&nbsp;5&nbsp;minutes&nbsp;ping)&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;IMG&nbsp;SRC=&quot;cid:1203497138.30080.10.camel@hublinux.fidudev.fr&quot;&nbsp;ALIGN=&quot;bottom&quot;&nbsp;BORDER=&quot;0&quot;&gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
