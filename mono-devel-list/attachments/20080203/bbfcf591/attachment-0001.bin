using System;
using System.Data;

class datatest {
    static void Main( string[] args ) 
    {
        int nRows = Convert.ToInt32( args[0] );

	DataTable table = new DataTable();

        DataColumn newColumn = new DataColumn( "a", typeof(Int32) );
        table.Columns.Add( newColumn );

        newColumn = new DataColumn( "b", typeof(Int32) );
        table.Columns.Add( newColumn );

        table.BeginLoadData();
        
        object[] dataArray = new object[2];
        for ( int i=0; i<nRows; i++ )
        {
            dataArray[0] = i;
            dataArray[1] = i * i;
            table.LoadDataRow( dataArray, true );
        }
        
        table.EndLoadData();
        table.AcceptChanges();

        
        Console.WriteLine( "GC.GetTotalMemory() = {0}", GC.GetTotalMemory( true ) );

        DateTime start = DateTime.Now;

        int sum = 0;
        for ( int i=0; i<nRows; i++ ) {
            DataRow[] rows = table.Select( "a = " + i );

            // do something with it, just because.
            sum += (int)rows[0][1];
        }

        Console.WriteLine( "sum = {0}", sum );

        TimeSpan ts = DateTime.Now - start;
        Console.WriteLine( "Selects took {0} seconds",
                           ts.TotalSeconds );
        
        Console.WriteLine( "GC.GetTotalMemory() = {0}",
                           GC.GetTotalMemory( true ) );
            
    }
}
