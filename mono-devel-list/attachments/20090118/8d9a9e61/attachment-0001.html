<tt>
&lt;html&nbsp;xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&nbsp;xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&nbsp;xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot;&nbsp;xmlns:m=&quot;http://schemas.microsoft.com/office/2004/12/omml&quot;&nbsp;xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;<br>
<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;meta&nbsp;name=Generator&nbsp;content=&quot;Microsoft&nbsp;Word&nbsp;12&nbsp;(filtered&nbsp;medium)&quot;&gt;<br>
&lt;style&gt;<br>
&lt;!--<br>
&nbsp;/*&nbsp;Font&nbsp;Definitions&nbsp;*/<br>
&nbsp;@font-face<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{font-family:Wingdings;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppanose-1:5&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0;}<br>
@font-face<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{font-family:&quot;Cambria&nbsp;Math&quot;;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppanose-1:2&nbsp;4&nbsp;5&nbsp;3&nbsp;5&nbsp;4&nbsp;6&nbsp;3&nbsp;2&nbsp;4;}<br>
@font-face<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{font-family:Calibri;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppanose-1:2&nbsp;15&nbsp;5&nbsp;2&nbsp;2&nbsp;2&nbsp;4&nbsp;3&nbsp;2&nbsp;4;}<br>
@font-face<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{font-family:Tahoma;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppanose-1:2&nbsp;11&nbsp;6&nbsp;4&nbsp;3&nbsp;5&nbsp;4&nbsp;4&nbsp;2&nbsp;4;}<br>
&nbsp;/*&nbsp;Style&nbsp;Definitions&nbsp;*/<br>
&nbsp;p.MsoNormal,&nbsp;li.MsoNormal,&nbsp;div.MsoNormal<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{margin:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-bottom:.0001pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-size:12.0pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Times&nbsp;New&nbsp;Roman&quot;,&quot;serif&quot;;}<br>
a:link,&nbsp;span.MsoHyperlink<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:99;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:blue;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
a:visited,&nbsp;span.MsoHyperlinkFollowed<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:99;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:purple;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
p<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:99;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmso-margin-top-alt:auto;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-right:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmso-margin-bottom-alt:auto;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-left:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-size:12.0pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Times&nbsp;New&nbsp;Roman&quot;,&quot;serif&quot;;}<br>
p.MsoListParagraph,&nbsp;li.MsoListParagraph,&nbsp;div.MsoListParagraph<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:34;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-top:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-right:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-bottom:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-left:.5in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-bottom:.0001pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-size:12.0pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Times&nbsp;New&nbsp;Roman&quot;,&quot;serif&quot;;}<br>
span.EmailStyle18<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-type:personal-reply;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:#1F497D;}<br>
.MsoChpDefault<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-type:export-only;}<br>
@page&nbsp;Section1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{size:8.5in&nbsp;11.0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin:1.0in&nbsp;1.0in&nbsp;1.0in&nbsp;1.0in;}<br>
div.Section1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{page:Section1;}<br>
&nbsp;/*&nbsp;List&nbsp;Definitions&nbsp;*/<br>
&nbsp;@list&nbsp;l0<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-list-id:1066802221;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmso-list-type:hybrid;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmso-list-template-ids:1495312620&nbsp;67698703&nbsp;67698713&nbsp;67698715&nbsp;67698703&nbsp;67698713&nbsp;67698715&nbsp;67698703&nbsp;67698713&nbsp;67698715;}<br>
@list&nbsp;l0:level1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-level-tab-stop:none;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmso-level-number-position:left;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-indent:-.25in;}<br>
ol<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{margin-bottom:0in;}<br>
ul<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{margin-bottom:0in;}<br>
--&gt;<br>
&lt;/style&gt;<br>
&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&nbsp;&lt;o:shapedefaults&nbsp;v:ext=&quot;edit&quot;&nbsp;spidmax=&quot;1026&quot;&nbsp;/&gt;<br>
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&nbsp;&lt;o:shapelayout&nbsp;v:ext=&quot;edit&quot;&gt;<br>
&nbsp;&nbsp;&lt;o:idmap&nbsp;v:ext=&quot;edit&quot;&nbsp;data=&quot;1&quot;&nbsp;/&gt;<br>
&nbsp;&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;<br>
&lt;/head&gt;<br>
<br>
&lt;body&nbsp;lang=EN-US&nbsp;link=blue&nbsp;vlink=purple&gt;<br>
<br>
&lt;div&nbsp;class=Section1&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;Hi&nbsp;again&nbsp;all,&nbsp;I&nbsp;have&nbsp;gotten&nbsp;Mono&nbsp;cross&nbsp;compiling&nbsp;within&nbsp;the<br>
Android&nbsp;build&nbsp;environment&nbsp;successfully.&nbsp;The&nbsp;good&nbsp;part&nbsp;about&nbsp;this&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;now<br>
properly&nbsp;using&nbsp;Android&amp;#8217;s&nbsp;linker&nbsp;and&nbsp;libc&nbsp;(Bionic);&nbsp;ie,&nbsp;I&nbsp;am&nbsp;no&nbsp;longer<br>
using&nbsp;glibc&nbsp;or&nbsp;ld-linux.so.3.&nbsp;So&nbsp;that&nbsp;reduced&nbsp;the&nbsp;memory&nbsp;footprint,&nbsp;increased<br>
the&nbsp;speed&nbsp;(Bionic&nbsp;uses&nbsp;Thumb&nbsp;code),&nbsp;and&nbsp;also&nbsp;allows&nbsp;interop&nbsp;with&nbsp;Android&amp;#8217;s<br>
shared&nbsp;libraries&nbsp;(which&nbsp;didn&amp;#8217;t&nbsp;work&nbsp;before&nbsp;due&nbsp;to&nbsp;a&nbsp;different&nbsp;linker<br>
script&nbsp;being&nbsp;used&nbsp;that&nbsp;caused&nbsp;incompatibility).&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;I&amp;#8217;ve&nbsp;attached&nbsp;a&nbsp;patch&nbsp;of&nbsp;what&nbsp;is&nbsp;needed&nbsp;to&nbsp;change&nbsp;in&nbsp;Mono<br>
code&nbsp;to&nbsp;get&nbsp;this&nbsp;working.&nbsp;Brief&nbsp;summary:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoListParagraph&nbsp;style='text-indent:-.25in;mso-list:l0&nbsp;level1&nbsp;lfo1'&gt;&lt;![if&nbsp;!supportLists]&gt;&lt;span<br>
style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D'&gt;&lt;span<br>
style='mso-list:Ignore'&gt;1.&lt;span&nbsp;style='font:7.0pt&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;gcconfig.h:&nbsp;Android&amp;#8217;s&nbsp;Mono&nbsp;is&nbsp;not&nbsp;using&nbsp;glibc&nbsp;anymore,&nbsp;so<br>
the&nbsp;GC&nbsp;needs&nbsp;to&nbsp;search&nbsp;for&nbsp;the&nbsp;data&nbsp;start&nbsp;segment&nbsp;when&nbsp;PLATFORM_ANDROID&nbsp;is<br>
defined.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoListParagraph&nbsp;style='text-indent:-.25in;mso-list:l0&nbsp;level1&nbsp;lfo1'&gt;&lt;![if&nbsp;!supportLists]&gt;&lt;span<br>
style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D'&gt;&lt;span<br>
style='mso-list:Ignore'&gt;2.&lt;span&nbsp;style='font:7.0pt&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;io.c:&nbsp;Although&nbsp;Android&nbsp;has&nbsp;statfs,&nbsp;there&nbsp;are&nbsp;some&nbsp;missing<br>
functions&nbsp;and&nbsp;defines&nbsp;that&nbsp;prevent&nbsp;GetDiskSpaceFreeEx&nbsp;from&nbsp;compiling.&nbsp;I&nbsp;used<br>
the&nbsp;PLATFORM_ANDROID&nbsp;define&nbsp;again&nbsp;to&nbsp;make&nbsp;it&nbsp;fall&nbsp;back&nbsp;to&nbsp;the&nbsp;simpler<br>
implementation.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoListParagraph&nbsp;style='text-indent:-.25in;mso-list:l0&nbsp;level1&nbsp;lfo1'&gt;&lt;![if&nbsp;!supportLists]&gt;&lt;span<br>
style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D'&gt;&lt;span<br>
style='mso-list:Ignore'&gt;3.&lt;span&nbsp;style='font:7.0pt&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;attach.c:&nbsp;The&nbsp;HAVE_GETPWUID_R&nbsp;define&nbsp;should&nbsp;be&nbsp;checked&nbsp;and&nbsp;the<br>
proper&nbsp;function&nbsp;used&nbsp;(getpwuid&nbsp;in&nbsp;Android&amp;#8217;s&nbsp;case).&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoListParagraph&nbsp;style='text-indent:-.25in;mso-list:l0&nbsp;level1&nbsp;lfo1'&gt;&lt;![if&nbsp;!supportLists]&gt;&lt;span<br>
style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D'&gt;&lt;span<br>
style='mso-list:Ignore'&gt;4.&lt;span&nbsp;style='font:7.0pt&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;socket-io.c:&nbsp;Android&nbsp;has&nbsp;an&nbsp;incomplete&nbsp;ipv6&nbsp;implementation,&nbsp;so&nbsp;I<br>
needed&nbsp;to&nbsp;undef&nbsp;AF_INET6&nbsp;to&nbsp;prevent&nbsp;compilation&nbsp;errors.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoListParagraph&nbsp;style='text-indent:-.25in;mso-list:l0&nbsp;level1&nbsp;lfo1'&gt;&lt;![if&nbsp;!supportLists]&gt;&lt;span<br>
style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D'&gt;&lt;span<br>
style='mso-list:Ignore'&gt;5.&lt;span&nbsp;style='font:7.0pt&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;mini-arm.c:&nbsp;Android&amp;#8217;s&nbsp;toolchain&nbsp;does&nbsp;not&nbsp;implement<br>
__clear_cache,&nbsp;so&nbsp;I&nbsp;needed&nbsp;to&nbsp;implement&nbsp;it&nbsp;properly&nbsp;for&nbsp;Mono&nbsp;to&nbsp;function.&nbsp;I<br>
have&nbsp;opened&nbsp;a&nbsp;bug&nbsp;on&nbsp;the&nbsp;Android&nbsp;team&nbsp;about&nbsp;this&nbsp;problem:&nbsp;&lt;a<br>
href=&quot;http://code.google.com/p/android/issues/detail?id=1803&quot;&gt;http://code.google.com/p/android/issues/detail?id=1803&lt;/a&gt;.<br>
However,&nbsp;they&nbsp;tend&nbsp;to&nbsp;be&nbsp;fairly&nbsp;unresponsive&amp;#8230;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoListParagraph&nbsp;style='text-indent:-.25in;mso-list:l0&nbsp;level1&nbsp;lfo1'&gt;&lt;![if&nbsp;!supportLists]&gt;&lt;span<br>
style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D'&gt;&lt;span<br>
style='mso-list:Ignore'&gt;6.&lt;span&nbsp;style='font:7.0pt&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;mono-mmap.c:&nbsp;The&nbsp;HAVE_SHM_OPEN&nbsp;define&nbsp;should&nbsp;be&nbsp;checked&nbsp;as&nbsp;well.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;Creating&nbsp;a&nbsp;build&nbsp;for&nbsp;Android&nbsp;does&nbsp;not&nbsp;use&nbsp;the&nbsp;usual<br>
configure/make&nbsp;process&nbsp;anymore.&nbsp;Instead,&nbsp;Mono&nbsp;must&nbsp;be&nbsp;an&nbsp;external&nbsp;project&nbsp;under<br>
your&nbsp;local&nbsp;Android&nbsp;source&nbsp;tree,&nbsp;and&nbsp;cross&nbsp;compiled&nbsp;in&nbsp;that&nbsp;environment.&nbsp;To&nbsp;view<br>
the&nbsp;rest&nbsp;of&nbsp;the&nbsp;changes&nbsp;(mostly&nbsp;tweaks&nbsp;and&nbsp;filling&nbsp;holes&nbsp;in&nbsp;libc)&nbsp;and&nbsp;build<br>
instructions,&nbsp;you&nbsp;can&nbsp;go&nbsp;to&nbsp;&lt;/span&gt;&lt;a<br>
href=&quot;http://code.google.com/p/androidmono/&quot;&gt;http://code.google.com/p/androidmono/&lt;/a&gt;.&lt;span<br>
style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;color:#1F497D'&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;I&amp;#8217;m&nbsp;contributing&nbsp;the&nbsp;both&nbsp;the&nbsp;internal&nbsp;and&nbsp;external<br>
changes&nbsp;to&nbsp;Mono&nbsp;under&nbsp;the&nbsp;MIT/X11&nbsp;license.&nbsp;(Please&nbsp;disregard&nbsp;my&nbsp;previous&nbsp;patch,<br>
as&nbsp;this&nbsp;change&nbsp;supersedes&nbsp;that)&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;Thanks,&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;Koushik&nbsp;Dutta&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;&lt;a&nbsp;href=&quot;http://www.koushikdutta.com/&quot;&gt;&lt;span&nbsp;style='color:blue'&gt;www.koushikdutta.com&lt;/span&gt;&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:11.0pt;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
color:#1F497D'&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;div&nbsp;style='border:none;border-top:solid&nbsp;#B5C4DF&nbsp;1.0pt;padding:3.0pt&nbsp;0in&nbsp;0in&nbsp;0in'&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;b&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;'&gt;From:&lt;/span&gt;&lt;/b&gt;&lt;span<br>
style='font-size:10.0pt;font-family:&quot;Tahoma&quot;,&quot;sans-serif&quot;'&gt;&nbsp;Rodrigo&nbsp;Kumpera<br>
[mailto:kumpera@gmail.com]&nbsp;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Wednesday,&nbsp;January&nbsp;14,&nbsp;2009&nbsp;4:18&nbsp;AM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;Koushik&nbsp;K.&nbsp;Dutta&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[Mono-dev]&nbsp;Tweaks&nbsp;needed&nbsp;in&nbsp;security.c&nbsp;for&nbsp;running&nbsp;Mono&nbsp;on<br>
Android&nbsp;-&nbsp;patch&nbsp;included&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&nbsp;style='margin-bottom:12.0pt'&gt;I&nbsp;loved&nbsp;the&nbsp;idea&nbsp;of&nbsp;bringing<br>
mono&nbsp;to&nbsp;Android,&nbsp;so&nbsp;keep&nbsp;everyone&nbsp;posted&nbsp;about&nbsp;your&nbsp;changes.&lt;br&gt;<br>
We'll&nbsp;make&nbsp;sure&nbsp;they&nbsp;are&nbsp;integrated&nbsp;back&nbsp;into&nbsp;the&nbsp;main&nbsp;tree&nbsp;once&nbsp;you&nbsp;figure&nbsp;out<br>
the&nbsp;way&nbsp;to&nbsp;go.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;On&nbsp;Tue,&nbsp;Jan&nbsp;13,&nbsp;2009&nbsp;at&nbsp;11:53&nbsp;PM,&nbsp;Koushik&nbsp;K.&nbsp;Dutta&nbsp;&amp;lt;&lt;a<br>
href=&quot;mailto:koush@koushikdutta.com&quot;&gt;koush@koushikdutta.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:11.0pt;color:#1F497D'&gt;Hi&nbsp;Rodrigo.&nbsp;Thanks&nbsp;for&nbsp;your<br>
response.&nbsp;After&nbsp;working&nbsp;on&nbsp;Mono/Android&nbsp;a&nbsp;bit&nbsp;further,&nbsp;I&nbsp;decided&nbsp;I&nbsp;need&nbsp;to<br>
think&nbsp;through&nbsp;the&nbsp;problem&nbsp;more.&nbsp;Linux&nbsp;and&nbsp;Android&nbsp;use&nbsp;significantly&nbsp;different<br>
linkers&nbsp;which&nbsp;is&nbsp;causing&nbsp;other&nbsp;various&nbsp;issues.&nbsp;I&nbsp;may&nbsp;end&nbsp;having&nbsp;to&nbsp;link&nbsp;versus<br>
Bionic&nbsp;after&nbsp;all,&nbsp;and&nbsp;implementing&nbsp;whatever&nbsp;dependencies&nbsp;are&nbsp;missing.&nbsp;So&nbsp;for<br>
now,&nbsp;this&nbsp;change&nbsp;may&nbsp;be&nbsp;unnecessary&amp;#8230;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:11.0pt;color:#1F497D'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:11.0pt;color:#1F497D'&gt;Koushik&nbsp;Dutta&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:11.0pt;color:#1F497D'&gt;&lt;a<br>
href=&quot;http://www.koushikdutta.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;www.koushikdutta.com&lt;/a&gt;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:11.0pt;color:#1F497D'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style='border:none;border-top:solid&nbsp;windowtext&nbsp;1.0pt;padding:3.0pt&nbsp;0in&nbsp;0in&nbsp;0in;<br>
border-color:-moz-use-text-color&nbsp;-moz-use-text-color'&gt;<br>
<br>
&lt;p&gt;&lt;b&gt;&lt;span&nbsp;style='font-size:10.0pt'&gt;From:&lt;/span&gt;&lt;/b&gt;&lt;span&nbsp;style='font-size:<br>
10.0pt'&gt;&nbsp;Rodrigo&nbsp;Kumpera&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:kumpera@gmail.com&quot;<br>
target=&quot;_blank&quot;&gt;kumpera@gmail.com&lt;/a&gt;]&nbsp;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Monday,&nbsp;January&nbsp;12,&nbsp;2009&nbsp;10:24&nbsp;AM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;Koushik&nbsp;K.&nbsp;Dutta&lt;br&gt;<br>
&lt;b&gt;Cc:&lt;/b&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[Mono-dev]&nbsp;Tweaks&nbsp;needed&nbsp;in&nbsp;security.c&nbsp;for&nbsp;running&nbsp;Mono&nbsp;on<br>
Android&nbsp;-&nbsp;patch&nbsp;included&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;style='margin-bottom:12.0pt'&gt;Hi&nbsp;Koushik,&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;have&nbsp;your&nbsp;patch&nbsp;accepted&nbsp;into&nbsp;the&nbsp;mono&nbsp;runtime&nbsp;you&nbsp;need&nbsp;to&nbsp;state&nbsp;that&nbsp;your<br>
contribution&nbsp;is&nbsp;under&nbsp;the&nbsp;MIT/X11&nbsp;license&lt;br&gt;<br>
otherwise&nbsp;we&nbsp;can't&nbsp;commit&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
Besides&nbsp;this,&nbsp;most&nbsp;of&nbsp;the&nbsp;code&nbsp;in&nbsp;System.Security&nbsp;is&nbsp;windows&nbsp;centered&nbsp;and&nbsp;makes<br>
no&nbsp;sense&nbsp;under&nbsp;Android.&nbsp;Maybe&nbsp;the&nbsp;best&lt;br&gt;<br>
solution&nbsp;is&nbsp;just&nbsp;remove&nbsp;it&nbsp;as&nbsp;using&nbsp;it&nbsp;would&nbsp;make&nbsp;no&nbsp;sense&nbsp;at&nbsp;all.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Rodrigo&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;p&gt;2009/1/11&nbsp;Koushik&nbsp;K.&nbsp;Dutta&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:koush@koushikdutta.com&quot;<br>
target=&quot;_blank&quot;&gt;koush@koushikdutta.com&lt;/a&gt;&amp;gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;div&gt;<br>
<br>
&lt;p&gt;Hi&nbsp;all,&nbsp;I'm&nbsp;working&nbsp;on&nbsp;getting&nbsp;Mono&nbsp;running&nbsp;under&nbsp;Android.&nbsp;So&nbsp;far,&nbsp;I've&nbsp;been<br>
able&nbsp;to&nbsp;get&nbsp;things&nbsp;running&nbsp;with&nbsp;next&nbsp;to&nbsp;no&nbsp;code&nbsp;changes&nbsp;(by&nbsp;way&nbsp;of&nbsp;configure,<br>
compiler&nbsp;and&nbsp;linker&nbsp;options).&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;I&nbsp;did&nbsp;run&nbsp;into&nbsp;one&nbsp;issue&nbsp;though&nbsp;that&nbsp;required&nbsp;a&nbsp;code&nbsp;change.&nbsp;Mono&nbsp;has&nbsp;a<br>
dependency&nbsp;on&nbsp;libc.so.&nbsp;On&nbsp;Android,&nbsp;Google&nbsp;implemented&nbsp;a&nbsp;custom&nbsp;lightweight<br>
version&nbsp;of&nbsp;libc.so,&nbsp;which&nbsp;they&nbsp;call&nbsp;&amp;quot;Bionic&amp;quot;.&nbsp;I&nbsp;have&nbsp;tried&nbsp;building<br>
Mono&nbsp;against&nbsp;Bionic,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment,&nbsp;it&nbsp;seems&nbsp;basically&nbsp;impossible&nbsp;because<br>
Bionic&nbsp;does&nbsp;not&nbsp;have&nbsp;Unicode&nbsp;support.&nbsp;(I&nbsp;will&nbsp;dig&nbsp;into&nbsp;other&nbsp;solutions&nbsp;for&nbsp;this<br>
further,&nbsp;but&nbsp;it's&nbsp;low&nbsp;priority&nbsp;at&nbsp;the&nbsp;moment&amp;#8230;&nbsp;I&nbsp;want&nbsp;to&nbsp;get&nbsp;things<br>
running&nbsp;&lt;span&nbsp;style='font-family:Wingdings'&gt;J&lt;/span&gt;)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;So,&nbsp;as&nbsp;a&nbsp;result,&nbsp;Mono&nbsp;on&nbsp;Android&nbsp;needs&nbsp;to&nbsp;be&nbsp;packaged&nbsp;with&nbsp;the&nbsp;standard<br>
ARM/Linux&nbsp;version&nbsp;of&nbsp;libc.&nbsp;&amp;nbsp;However,&nbsp;there&nbsp;are&nbsp;significant&nbsp;differences<br>
between&nbsp;the&nbsp;Linux&nbsp;file&nbsp;system&nbsp;and&nbsp;Android&nbsp;file&nbsp;system.&nbsp;So&nbsp;when&nbsp;Mono's&nbsp;uses<br>
libc's&nbsp;getpwuid&nbsp;and&nbsp;getpwuid_r,&nbsp;it&nbsp;fails,&nbsp;and&nbsp;causes&nbsp;further&nbsp;problems&nbsp;in&nbsp;the<br>
runtime.&nbsp;Linux's&nbsp;getpwuid&nbsp;works&nbsp;by&nbsp;examining&nbsp;various&nbsp;files&nbsp;in&nbsp;/etc.&nbsp;But,<br>
Android&nbsp;does&nbsp;not&nbsp;have&nbsp;a&nbsp;/etc.&nbsp;Android&nbsp;has&nbsp;a&nbsp;uid/gid&nbsp;repository&nbsp;that&nbsp;is&nbsp;very<br>
different&nbsp;from&nbsp;typical&nbsp;Linux&nbsp;distributions.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;For&nbsp;reference,&nbsp;here&nbsp;is&nbsp;Bionic's&nbsp;implementation&nbsp;of&nbsp;getpwuid&nbsp;(there&nbsp;is&nbsp;no<br>
getpwuid_r):&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;;color:blue'&gt;struct&lt;/span&gt;&lt;span<br>
style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&nbsp;passwd*&nbsp;getpwuid(uid_t&nbsp;uid)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;{&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
stubs_state_t*&amp;nbsp;&nbsp;state&nbsp;=&nbsp;__stubs_state();&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;span<br>
style='color:blue'&gt;struct&lt;/span&gt;&nbsp;passwd*&amp;nbsp;&nbsp;pw;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;span<br>
style='color:blue'&gt;if&lt;/span&gt;&nbsp;(state&nbsp;==&nbsp;NULL)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;span&nbsp;style='color:blue'&gt;return&lt;/span&gt;&nbsp;NULL;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
pw&nbsp;=&nbsp;&amp;amp;state-&amp;gt;passwd;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;span<br>
style='color:blue'&gt;if&lt;/span&gt;&nbsp;(&nbsp;android_id_to_passwd(pw,&nbsp;uid)&nbsp;!=&nbsp;NULL&nbsp;)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;span&nbsp;style='color:blue'&gt;return&lt;/span&gt;&nbsp;pw;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;span<br>
style='color:blue'&gt;if&lt;/span&gt;&nbsp;(uid&nbsp;&amp;lt;&nbsp;AID_APP)&nbsp;{&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
errno&nbsp;=&nbsp;ENOENT;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;span&nbsp;style='color:blue'&gt;return&lt;/span&gt;&nbsp;NULL;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
}&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
snprintf(&nbsp;state-&amp;gt;app_name_buffer,&nbsp;&lt;span&nbsp;style='color:blue'&gt;sizeof&lt;/span&gt;<br>
state-&amp;gt;app_name_buffer,&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&lt;span&nbsp;style='color:#A31515'&gt;&amp;quot;app_%d&amp;quot;&lt;/span&gt;,&nbsp;uid&nbsp;-&nbsp;AID_APP&nbsp;);&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
pw-&amp;gt;pw_name&amp;nbsp;&nbsp;=&nbsp;state-&amp;gt;app_name_buffer;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
pw-&amp;gt;pw_dir&amp;nbsp;&amp;nbsp;&nbsp;=&nbsp;&lt;span&nbsp;style='color:#A31515'&gt;&amp;quot;/data&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
pw-&amp;gt;pw_shell&nbsp;=&nbsp;&lt;span&nbsp;style='color:#A31515'&gt;&amp;quot;/system/bin/sh&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
pw-&amp;gt;pw_uid&amp;nbsp;&amp;nbsp;&nbsp;=&nbsp;uid;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
pw-&amp;gt;pw_gid&amp;nbsp;&amp;nbsp;&nbsp;=&nbsp;uid;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;span<br>
style='color:blue'&gt;return&lt;/span&gt;&nbsp;pw;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&quot;'&gt;}&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;getpwuid&nbsp;is&nbsp;used&nbsp;in&nbsp;three&nbsp;locations&nbsp;Mono.&nbsp;The&nbsp;two&nbsp;troublesome&nbsp;ones&nbsp;are&nbsp;in<br>
mono/metadata/security.c&nbsp;in&nbsp;the&nbsp;functions&nbsp;&amp;quot;GetTokenName&amp;quot;&nbsp;and<br>
&amp;quot;IsMemberOf&amp;quot;.&nbsp;(The&nbsp;third&nbsp;is&nbsp;in&nbsp;pwd.c&nbsp;for&nbsp;Mono's&nbsp;Posix&nbsp;syscall<br>
wrapper,&nbsp;but&nbsp;that&nbsp;is&nbsp;not&nbsp;causing&nbsp;the&nbsp;problem.&nbsp;I'll&nbsp;fix&nbsp;that&nbsp;later.)&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;I&nbsp;have&nbsp;attached&nbsp;a&nbsp;patch&nbsp;file&nbsp;that&nbsp;I&nbsp;have&nbsp;successfully&nbsp;built&nbsp;and&nbsp;tested<br>
against&nbsp;Android.&amp;nbsp;&nbsp;It&nbsp;is&nbsp;also&nbsp;regression&nbsp;safe,&nbsp;as&nbsp;all&nbsp;the&nbsp;new&nbsp;code&nbsp;is<br>
inside&nbsp;a&nbsp;#ifdef&nbsp;PLATFORM_ANDROID&nbsp;block.&nbsp;The&nbsp;workaround&nbsp;is&nbsp;simple,&nbsp;and&nbsp;there&nbsp;are<br>
comments&nbsp;explaining&nbsp;how&nbsp;the&nbsp;Android&nbsp;uid&nbsp;model&nbsp;works.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;Alternatively,&nbsp;I&nbsp;can&nbsp;obviously&nbsp;compile&nbsp;a&nbsp;custom&nbsp;version&nbsp;of&nbsp;libc.so&nbsp;for&nbsp;Mono,<br>
but&nbsp;I&nbsp;do&nbsp;not&nbsp;think&nbsp;that&nbsp;is&nbsp;a&nbsp;good&nbsp;solution.&nbsp;Mono&nbsp;is&nbsp;already&nbsp;using&nbsp;#ifdef<br>
PLATFORM_WIN32&nbsp;at&nbsp;the&nbsp;same&nbsp;points&nbsp;in&nbsp;code&nbsp;that&nbsp;I&nbsp;placed&nbsp;my&nbsp;PLATFORM_ANDROID,<br>
and&nbsp;I'm&nbsp;assuming&nbsp;that&nbsp;the&nbsp;Mono&nbsp;developers&nbsp;will&nbsp;be&nbsp;more&nbsp;open&nbsp;to&nbsp;my&nbsp;proposed<br>
changes.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;For&nbsp;information&nbsp;about&nbsp;how&nbsp;to&nbsp;build&nbsp;Mono&nbsp;to&nbsp;target&nbsp;Android,&nbsp;you&nbsp;can&nbsp;reference<br>
my&nbsp;post:&nbsp;&lt;a<br>
href=&quot;http://www.koushikdutta.com/2009/01/building-mono-for-android.html&quot;<br>
target=&quot;_blank&quot;&gt;http://www.koushikdutta.com/2009/01/building-mono-for-android.html&lt;/a&gt;.<br>
Or&nbsp;feel&nbsp;free&nbsp;to&nbsp;contact&nbsp;me.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;Thanks,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;Koushik&nbsp;Dutta&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;a&nbsp;href=&quot;http://www.koushikdutta.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;www.koushikdutta.com&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;Koushik&nbsp;Dutta&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;a&nbsp;href=&quot;http://www.koushikdutta.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;www.koushikdutta.com&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;p&nbsp;style='margin-bottom:12.0pt'&gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;<br>
target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;p&gt;&amp;nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
<br>
&lt;/div&gt;<br>
<br>
&lt;/body&gt;<br>
<br>
&lt;/html&gt;<br>

</tt>
