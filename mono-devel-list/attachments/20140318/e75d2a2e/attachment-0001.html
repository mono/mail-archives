<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;dir=&quot;auto&quot;&gt;&lt;div&gt;Dont&nbsp;use&nbsp;CharSet.Ansi.&nbsp;Try&nbsp;CharSet.Unicode.&lt;br&gt;&lt;br&gt;Sent&nbsp;from&nbsp;a&nbsp;computer&lt;/div&gt;&lt;div&gt;&lt;br&gt;On&nbsp;Mar&nbsp;11,&nbsp;2014,&nbsp;at&nbsp;7:55&nbsp;AM,&nbsp;&quot;Wang&nbsp;Jiteng&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:imwjt@163.com&quot;&gt;imwjt@163.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;line-height:1.7;color:#000000;font-size:14px;font-family:arial&quot;&gt;Nowadays&nbsp;I'm&nbsp;working&nbsp;on&nbsp;a&nbsp;project&nbsp;in&nbsp;which&nbsp;I&nbsp;need&nbsp;to&nbsp;call&nbsp;encryption&nbsp;and&nbsp;decryption&nbsp;&nbsp;functions.&nbsp;These&nbsp;functions&nbsp;are&nbsp;written&nbsp;in&nbsp;C&nbsp;and&nbsp;have&nbsp;been&nbsp;compiled&nbsp;into&nbsp;a&nbsp;DLL&nbsp;under&nbsp;windows(visual&nbsp;studio&nbsp;2010).&nbsp;&lt;br&gt;&lt;br&gt;The&nbsp;functions&nbsp;in&nbsp;the&nbsp;DLL(which&nbsp;is&nbsp;called&nbsp;Cypher.dll)&nbsp;are:&lt;br&gt;unsigned&nbsp;long&nbsp;decrypt(unsigned&nbsp;char&nbsp;*reval,&nbsp;const&nbsp;char&nbsp;*in,&nbsp;&nbsp;unsigned&nbsp;long&nbsp;len&nbsp;)&lt;br&gt;&lt;br&gt;and&lt;br&gt;unsigned&nbsp;long&nbsp;encrypt(char&nbsp;*out,&nbsp;const&nbsp;unsigned&nbsp;char&nbsp;*data,&nbsp;unsigned&nbsp;long&nbsp;len)&lt;br&gt;&lt;br&gt;In&nbsp;my&nbsp;C#&nbsp;codes,&nbsp;I&nbsp;re-write&nbsp;these&nbsp;two&nbsp;functions&nbsp;with&nbsp;:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;[DllImport(&quot;Cypher.dll&quot;,&nbsp;CharSet=CharSet.Ansi,&nbsp;CallingConvention=CallingConvention.Cdecl,&nbsp;EntryPoint&nbsp;=&nbsp;&quot;decrypt&quot;)]&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;&nbsp;extern&nbsp;static&nbsp;uint&nbsp;decrypt([Out]&nbsp;ref&nbsp;byte&nbsp;reval,ref&nbsp;byte&nbsp;c,uint&nbsp;len);&lt;br&gt;/*&lt;br&gt;reval:&nbsp;&nbsp;the&nbsp;decrypted&nbsp;text&nbsp;&lt;br&gt;c:&nbsp;the&nbsp;cypher&nbsp;text&nbsp;to&nbsp;be&nbsp;decrypted.&lt;br&gt;len:&nbsp;text&nbsp;length&nbsp;(the&nbsp;fellow&nbsp;who&nbsp;gave&nbsp;me&nbsp;the&nbsp;dll&nbsp;said&nbsp;this&nbsp;parameter&nbsp;can&nbsp;be&nbsp;<br>
assigned&nbsp;by&nbsp;any&nbsp;value,so&nbsp;I&nbsp;usually&nbsp;assigned&nbsp;it&nbsp;by&nbsp;c.Length)&lt;br&gt;*/&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;[DllImport(&quot;Cypher.dll&quot;,&nbsp;CharSet=CharSet.Ansi,CallingConvention=CallingConvention.Cdecl,&nbsp;EntryPoint&nbsp;=&nbsp;&quot;encrypt&quot;)]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;&nbsp;extern&nbsp;static&nbsp;uint&nbsp;encrypt(ref&nbsp;byte&nbsp;ou,ref&nbsp;byte&nbsp;data,&nbsp;uint&nbsp;len);&lt;br&gt;/*&lt;br&gt;out:&nbsp;the&nbsp;encrypted&nbsp;cypher&nbsp;text&lt;br&gt;data:the&nbsp;text&nbsp;to&nbsp;be&nbsp;encrypted,&nbsp;which&nbsp;usually&nbsp;is&nbsp;a&nbsp;path&nbsp;like&nbsp;&quot;C:\\Users\\downtown\\Desktop\\something\\test&quot;&nbsp;or&nbsp;&quot;C:\\Users\\downtown\\Desktop\\测试集\\test&quot;&nbsp;(I)&lt;br&gt;len:<br>
&nbsp;text&nbsp;length&lt;br&gt;*/&lt;br&gt;&lt;br&gt;Compared&nbsp;with&nbsp;calling&nbsp;the&nbsp;Cypher.dll&nbsp;direclty&nbsp;in&nbsp;C&nbsp;codes,&nbsp;the&nbsp;&quot;encrypt&quot;&nbsp;function&nbsp;always&nbsp;works&nbsp;correctly.&nbsp;The&nbsp;&quot;decrypt&quot;&nbsp;function&nbsp;works&nbsp;fine&nbsp;if&nbsp;the&nbsp;input&nbsp;parameter&nbsp;&quot;data&quot;&nbsp;in&nbsp;&quot;encrypt&quot;&nbsp;are&nbsp;standard&nbsp;ASCII&nbsp;charaters.&nbsp;&lt;br&gt;But&nbsp;when&nbsp;I&nbsp;add&nbsp;some&nbsp;CHINESE&nbsp;characters(I'm&nbsp;a&nbsp;Chinese&nbsp;progammer&nbsp;btw.&nbsp;Forgive&nbsp;my&nbsp;poor&nbsp;English&nbsp;:P&nbsp;)&nbsp;like&nbsp;&quot;C:\\Users\\downtown\\Desktop\\测试集\\test&quot;.&nbsp;&lt;br&gt;The&nbsp;&quot;decrypt&quot;&nbsp;result&nbsp;goes&nbsp;wrong,&nbsp;which&nbsp;is&nbsp;&quot;C:\\Users\\downtown\\Desktop\\测试集\\t&quot;&nbsp;(some&nbsp;characters&nbsp;in&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string&nbsp;are&nbsp;cut&nbsp;off).&lt;br&gt;&lt;br&gt;if&nbsp;I&nbsp;input&nbsp;&quot;C:\\Users\\downtown\\Desktop\\测试\\test&quot;,&nbsp;the&nbsp;&quot;decrypt&quot;&nbsp;is&nbsp;&quot;C:\\Users\\downtown\\Desktop\\测试\\te&quot;&lt;br&gt;&lt;br&gt;It&nbsp;is&nbsp;interesting&nbsp;because&nbsp;each&nbsp;Chinese&nbsp;character&nbsp;takes&nbsp;two&nbsp;byte&nbsp;(in&nbsp;ANSI&nbsp;or&nbsp;UTF8).&nbsp;But&nbsp;the&nbsp;&quot;decrypt&quot;&nbsp;function&nbsp;seems&nbsp;retain&nbsp;just&nbsp;one&nbsp;byte&nbsp;for&nbsp;each&nbsp;Chinese&nbsp;character.&lt;br&gt;So&nbsp;When&nbsp;3&nbsp;Chinese&nbsp;characters(测试集)&nbsp;exists&nbsp;in&nbsp;the&nbsp;string,&nbsp;after&nbsp;decrypted,&nbsp;they&nbsp;&quot;eat&quot;&nbsp;3&nbsp;bytes('e','s'&nbsp;and&nbsp;'t')&nbsp;at&nbsp;the&nbsp;of&nbsp;the&nbsp;string.&lt;br&gt;When&nbsp;2&nbsp;Chinese&nbsp;characters(测试)&nbsp;exists&nbsp;in&nbsp;the&nbsp;string,&nbsp;after&nbsp;decrypted,&nbsp;they&nbsp;&quot;eat&quot;&nbsp;2&nbsp;bytes('s'&nbsp;and&nbsp;'t')&nbsp;at&nbsp;the&nbsp;of&nbsp;the&nbsp;string.&lt;br&gt;&lt;br&gt;Dose&nbsp;anybody&nbsp;knows&nbsp;why&nbsp;that&nbsp;happens???&lt;br&gt;&lt;br&gt;and&nbsp;the&nbsp;codes&nbsp;to&nbsp;call&nbsp;these&nbsp;fuctions&nbsp;above&nbsp;are:&lt;br&gt;//Encrypt&nbsp;function;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;string&nbsp;EncryptParameters(string&nbsp;args)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;plainBytes&nbsp;=&nbsp;System.Text.Encoding.Default.GetBytes(args);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;cypher_maxlen&nbsp;=&nbsp;args.Length*2+16;&lt;br&gt;//prepare&nbsp;the&nbsp;cypher&nbsp;text&nbsp;byte&nbsp;array&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;c&nbsp;=&nbsp;new&nbsp;byte[cypher_maxlen];&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i=0;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CFunction.encrypt(ref&nbsp;c[0],ref&nbsp;plainBytes[0],&nbsp;(uint)args.Length);&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i=0;c[i]!=0&nbsp;&amp;&amp;&nbsp;i&lt;cypher_maxlen;i++)//;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.Write(c[i]+&quot;&nbsp;&quot;);&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;cypher_str&nbsp;=&nbsp;System.Text.Encoding.Default.GetString(c,&nbsp;0,&nbsp;i);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cypher_str;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;//Decrypt&nbsp;Function&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;string&nbsp;DecryptParameters(string&nbsp;args)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;plain_maxlen&nbsp;=&nbsp;args.Length;&lt;br&gt;&lt;br&gt;//add&nbsp;a&nbsp;'\0'&nbsp;to&nbsp;the&nbsp;end,&nbsp;or&nbsp;the&nbsp;&quot;decrypt&quot;&nbsp;function&nbsp;goes&nbsp;wrong&nbsp;sometime.&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;args_with_end&nbsp;=&nbsp;args&nbsp;+&nbsp;&quot;\0&quot;;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;cypherBytes&nbsp;=&nbsp;System.Text.Encoding.Default.GetBytes(args_with_end);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i=0;&lt;br&gt;&lt;br&gt;//prepare&nbsp;the&nbsp;byte&nbsp;array&nbsp;of&nbsp;decrypted&nbsp;text&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;p&nbsp;=&nbsp;new&nbsp;byte[plain_maxlen];&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CFunction.decrypt(p,cypherBytes,(uint)cypherBytes.Length);&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i=0;p[i]!=0&nbsp;&amp;&amp;&nbsp;i&lt;plain_maxlen;i++);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;plain_str&nbsp;=&nbsp;System.Text.Encoding.Default.GetString(p,&nbsp;0,&nbsp;i);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;plain_str;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;and&nbsp;I&nbsp;call&nbsp;these&nbsp;two&nbsp;functions&nbsp;above&nbsp;like:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;cypher_args&nbsp;=&nbsp;EncryptParaments(init_args);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;plain_args&nbsp;=&nbsp;DecryptParaments(cypher_args);&lt;br&gt;and&nbsp;the&nbsp;string&nbsp;plain_args&nbsp;are&nbsp;not&nbsp;always&nbsp;correct&nbsp;as&nbsp;I&nbsp;mentioned.&nbsp;&lt;br&gt;&lt;br&gt;Thanks.&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;span&nbsp;title=&quot;neteasefooter&quot;&gt;&lt;span&nbsp;id=&quot;netease_mail_footer&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;span&gt;_______________________________________________&lt;/span&gt;&lt;br&gt;&lt;span&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
