<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;font-size:12pt&quot;&gt;&lt;div&gt;&lt;span&gt;Since&nbsp;no&nbsp;one&nbsp;seems&nbsp;inclined&nbsp;to&nbsp;look&nbsp;at&nbsp;this&nbsp;bug,&nbsp;here's&nbsp;my&nbsp;proposed&nbsp;fix.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;The&nbsp;problem&nbsp;seems&nbsp;to&nbsp;be&nbsp;that&nbsp;ves_icall_System_IO_MonoIO_GetFileSystemEntries()&nbsp;can&nbsp;return&nbsp;NULL&nbsp;without&nbsp;setting&nbsp;an&nbsp;error.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;So&nbsp;I&nbsp;rewrote&nbsp;the&nbsp;code&nbsp;to&nbsp;create&nbsp;an&nbsp;empty&nbsp;string-array&nbsp;in&nbsp;that&nbsp;case.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;My&nbsp;code&nbsp;uses&nbsp;the&nbsp;dreaded&nbsp;&quot;goto&quot;,&nbsp;but&nbsp;IMHO&nbsp;that's&nbsp;no&nbsp;worse&nbsp;than&nbsp;a&nbsp;return&nbsp;statement&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;function.&nbsp;&nbsp;Besides,&nbsp;in&nbsp;assembly&nbsp;language,&nbsp;all&nbsp;we&nbsp;have&nbsp;is&nbsp;goto&nbsp;:-)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;Steven&nbsp;Boswell&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&nbsp;&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;Arial&quot;&gt;<br>
&nbsp;&lt;hr&nbsp;size=&quot;1&quot;&gt;&nbsp;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:bold;&quot;&gt;From:&lt;/span&gt;&lt;/b&gt;&nbsp;Steven&nbsp;Boswell&nbsp;II&nbsp;&lt;ulatekh@yahoo.com&gt;&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;To:&lt;/span&gt;&lt;/b&gt;&nbsp;&quot;mono-devel-list@lists.ximian.com&quot;&nbsp;&lt;mono-devel-list@lists.ximian.com&gt;&nbsp;&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Sent:&lt;/span&gt;&lt;/b&gt;&nbsp;Friday,&nbsp;June&nbsp;8,&nbsp;2012&nbsp;5:43&nbsp;PM&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Subject:&lt;/span&gt;&lt;/b&gt;&nbsp;[Mono-dev]&nbsp;GetFileSystemEntries()&nbsp;can&nbsp;return&nbsp;null,&nbsp;but&nbsp;very&nbsp;few&nbsp;null&nbsp;checks&lt;br&gt;&nbsp;&lt;/font&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;br&gt;<br>
&lt;div&nbsp;id=&quot;yiv1324997790&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&lt;div&nbsp;id=&quot;yiv1324997790&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;font-family:&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&lt;div&nbsp;id=&quot;yiv1324997790yui_3_2_0_19_133918270620940&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;Today,&nbsp;rather&nbsp;randomly,&nbsp;I&nbsp;got&nbsp;an&nbsp;unhandled&nbsp;NullReferenceException&nbsp;in&nbsp;mcs/class/System/System.IO/DefaultWatcher.cs&nbsp;at&nbsp;line&nbsp;221&nbsp;--&nbsp;&quot;files&quot;&nbsp;was&nbsp;null.&nbsp;&nbsp;All&nbsp;the&nbsp;places&nbsp;that&nbsp;&quot;files&quot;&nbsp;gets&nbsp;set&nbsp;can't&nbsp;be&nbsp;null,&nbsp;except&nbsp;for&nbsp;the&nbsp;one&nbsp;on&nbsp;line&nbsp;204,&nbsp;a&nbsp;call&nbsp;to&nbsp;Directory.GetFileSystemEntries().&nbsp;&nbsp;That&nbsp;led&nbsp;to&nbsp;mcs/class/corlib/System.IO/Directory.cs&nbsp;line&nbsp;497,&nbsp;which&nbsp;led&nbsp;to&nbsp;&lt;span&nbsp;style=&quot;font-size:12pt;&quot;&gt;mcs/class/&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:12pt;&quot;&gt;corlib/System.IO/MonoIO.cs&nbsp;line&nbsp;177,&nbsp;which&nbsp;led&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;called<br>
&nbsp;ves_icall_System_IO_MonoIO_GetFileSystemEntries(),&nbsp;which&nbsp;starts&nbsp;at&nbsp;line&nbsp;319&nbsp;of&nbsp;mono/metadata/file-io.c&nbsp;.&nbsp;&nbsp;That&nbsp;function&nbsp;can&nbsp;return&nbsp;null&nbsp;in&nbsp;several&nbsp;different&nbsp;ways.&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;yiv1324997790yui_3_2_0_19_133918270620940&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12pt;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;Looking&nbsp;around,&nbsp;this&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;general&nbsp;problem...&lt;/div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Files&nbsp;that&nbsp;call&nbsp;GetFileSystemEntries()&nbsp;and&nbsp;check&nbsp;for&nbsp;null:&lt;/div&gt;&lt;div&gt;mcs/class/System.Web/System.Web.Hosting/ApplicationHost.cs&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Files&nbsp;that&nbsp;call&nbsp;GetFileSystemEntries()&nbsp;without&nbsp;checking&nbsp;for<br>
&nbsp;null:&lt;/div&gt;&lt;div&gt;mcs/class/Compat.ICSharpCode.SharpZipLib/ICSharpCode.SharpZipLib/Tar/TarEntry.cs&lt;/div&gt;&lt;div&gt;mcs/class/ICSharpCode.SharpZipLib/ICSharpCode.SharpZipLib/Tar/TarEntry.cs&lt;/div&gt;&lt;div&gt;mcs/class/Microsoft.Build.Utilities/Mono.XBuild.Utilities/MSBuildUtils.cs&lt;/div&gt;&lt;div&gt;mcs/class/Mono.Posix/Mono.Unix/UnixDirectoryInfo.cs&lt;/div&gt;&lt;div&gt;mcs/class/System/System.IO/DefaultWatcher.cs&lt;/div&gt;&lt;div&gt;mcs/tools/macpack/MacPack.cs&lt;/div&gt;&lt;div&gt;mcs/tools/monodoc/Lucene.Net/Lucene.Net/SupportClass.cs&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Files&nbsp;with&nbsp;a&nbsp;GetFileSystemEntries()&nbsp;that&nbsp;can&nbsp;return&nbsp;null:&lt;/div&gt;&lt;div&gt;mcs/class/corlib/Linux/Linux.cs&lt;/div&gt;&lt;div&gt;mono/metadata/file-io.c&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;fixing&nbsp;this&nbsp;is&nbsp;as&nbsp;simple&nbsp;as&nbsp;adding&nbsp;null&nbsp;checks&nbsp;to&nbsp;the&nbsp;affected&nbsp;areas,&nbsp;I&nbsp;can&nbsp;crank&nbsp;that&nbsp;out&nbsp;and&nbsp;submit&nbsp;a&nbsp;patch.&nbsp;&nbsp;Otherwise,&nbsp;someone&nbsp;more&nbsp;knowledgeable&nbsp;than&nbsp;me&nbsp;needs&nbsp;to&nbsp;look&nbsp;into&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don't&nbsp;see&nbsp;any&nbsp;bug&nbsp;reports&nbsp;in&nbsp;either&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;<br>
&nbsp;href=&quot;http://bugzilla.novell.com&quot;&gt;bugzilla.novell.com&lt;/a&gt;&nbsp;or<br>
&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;href=&quot;http://bugzilla.xamarin.com&quot;&gt;bugzilla.xamarin.com&lt;/a&gt;&nbsp;about&nbsp;this&nbsp;issue.&nbsp;&nbsp;I&nbsp;searched&nbsp;&quot;Mono&nbsp;class&nbsp;libraries&quot;&nbsp;and&nbsp;&quot;Mono&nbsp;runtime&quot;.&nbsp;&nbsp;There&nbsp;were&nbsp;a&nbsp;few&nbsp;other&nbsp;issues&nbsp;related&nbsp;to&nbsp;GetFileSystemEntries(),&nbsp;but&nbsp;none&nbsp;that&nbsp;sounded&nbsp;like&nbsp;this.&nbsp;&nbsp;So&nbsp;I&nbsp;filed&nbsp;one...&nbsp;https://bugzilla.xamarin.com/show_bug.cgi?id=5591&nbsp;.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Steven&nbsp;Boswell&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;ymailto=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
