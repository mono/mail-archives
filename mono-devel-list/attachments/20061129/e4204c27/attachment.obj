Index: VirtualPathProviderTest.cs
===================================================================
--- VirtualPathProviderTest.cs	(revision 68645)
+++ VirtualPathProviderTest.cs	(working copy)
@@ -34,6 +34,8 @@
 using System.Web.Caching;
 using System.Web.Hosting;
 using NUnit.Framework;
+using MonoTests.SystemWeb.Framework;
+using System.Web.UI;
 
 namespace MonoTests.System.Web.Hosting {
 	class DummyVPP : VirtualPathProvider {
@@ -177,6 +179,51 @@
 			DummyVPP dummy = new DummyVPP ();
 			dummy.CombineVirtualPaths ("root", "./otherleaf/index.aspx");
 		}
+
+		[Test]
+		[Category ("NunitWeb")]
+		public void OpenFile () {
+			WebTest t = new WebTest (PageInvoker.CreateOnLoad (OpenFile_Load));
+			t.Run ();
+		}
+		public static void OpenFile_Load (Page p) {
+			HostingEnvironment.RegisterVirtualPathProvider (new MyVirtualPathProvider ());
+			MyControl ctrl = new MyControl ();
+			Stream stream = ctrl.OpenFile ("~/MyPage.aspx");
+			Assert.IsNull (stream);
+			Assert.AreEqual ("~/MyPage.aspx", MyVirtualPathProvider._virtualPath);
+
+			stream = ctrl.OpenFile ("/MyPage.aspx");
+			Assert.IsNull (stream);
+			Assert.AreEqual ("/MyPage.aspx", MyVirtualPathProvider._virtualPath);
+		}
+
+		class MyControl : Control
+		{
+			public new Stream OpenFile (string path)
+			{
+				return base.OpenFile(path);
+			}
+		}
+		class MyVirtualPathProvider : VirtualPathProvider
+		{
+			public static string _virtualPath;
+			public override VirtualFile GetFile (string virtualPath) {
+				_virtualPath = virtualPath;
+				return new MyVirtualFile (virtualPath);
+			}
+		}
+		class MyVirtualFile : VirtualFile
+		{
+			public MyVirtualFile (string path)
+				: base (path)
+			{
+			}
+
+			public override Stream Open () {
+				return null;
+			}
+		}
 	}
 	
 }
