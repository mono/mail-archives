<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Oct&nbsp;3,&nbsp;2012&nbsp;at&nbsp;3:41&nbsp;PM,&nbsp;Jonathan&nbsp;Shore&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jonathan.shore@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jonathan.shore@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;div&gt;On&nbsp;Oct&nbsp;3,&nbsp;2012,&nbsp;at&nbsp;2:57&nbsp;PM,&nbsp;Rodrigo&nbsp;Kumpera&nbsp;wrote:&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Wed,&nbsp;Oct&nbsp;3,&nbsp;2012&nbsp;at&nbsp;1:59&nbsp;PM,&nbsp;sebastian&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:sebastian@palladiumconsulting.com&quot;&nbsp;target=&quot;_blank&quot;&gt;sebastian@palladiumconsulting.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&gt;Finally,&nbsp;we&nbsp;may&nbsp;want&nbsp;to&nbsp;tweak&nbsp;the&nbsp;parameters&nbsp;sent&nbsp;to&nbsp;the&nbsp;LLVM&nbsp;compiler&nbsp;to&nbsp;optimize&nbsp;for&nbsp;runtime&nbsp;speed,&nbsp;even&nbsp;at&nbsp;the&nbsp;cost&nbsp;of&nbsp;very&nbsp;slow&nbsp;compilation.&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Tweaking&nbsp;llvm&nbsp;parameters&nbsp;require&nbsp;changing&nbsp;mono&#39;s&nbsp;source&nbsp;code&nbsp;and&nbsp;pretty&nbsp;much&nbsp;voids&nbsp;any&nbsp;guarantees&nbsp;that&nbsp;the&nbsp;resulting&nbsp;code&nbsp;will&nbsp;work.&lt;/div&gt;&lt;div&gt;A&nbsp;lot&nbsp;of&nbsp;LLVM&nbsp;optimizations&nbsp;for&nbsp;some&nbsp;reasons&nbsp;produce&nbsp;bad&nbsp;code&nbsp;when&nbsp;used&nbsp;with&nbsp;mono.&nbsp;Zoltan&nbsp;can&nbsp;better&nbsp;explain&nbsp;this,&nbsp;I&nbsp;guess.&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;very&nbsp;interested&nbsp;in&nbsp;this&nbsp;topic&nbsp;as&nbsp;well.&nbsp; &nbsp;Squeezing&nbsp;the&nbsp;most&nbsp;performance&nbsp;I&nbsp;can&nbsp;for&nbsp;numerical&nbsp;work&nbsp;is&nbsp;important&nbsp;for&nbsp;my&nbsp;application. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sebastian,&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;what&nbsp;sorts&nbsp;of&nbsp;algorithms&nbsp;you&nbsp;are&nbsp;running,&nbsp;but&nbsp;there&nbsp;are&nbsp;a&nbsp;number&nbsp;of&nbsp;flags&nbsp;one&nbsp;can&nbsp;use,&nbsp;such&nbsp;as&nbsp;-O=unsafe&nbsp;and&nbsp;inlining&nbsp;directives&nbsp;that&nbsp;get&nbsp;mono&nbsp;--llvm&nbsp;very&nbsp;close&nbsp;to&nbsp;GCC&nbsp;compiled&nbsp;C&nbsp;/&nbsp;C++&nbsp;code&nbsp;for&nbsp;numerical&nbsp;algorithms.&nbsp; &nbsp;I&#39;ve&nbsp;found&nbsp;that&nbsp;with&nbsp;careful&nbsp;structuring&nbsp;get&nbsp;within&nbsp;5-10%&nbsp;of&nbsp;C&nbsp;speed.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;Mono&nbsp;(and&nbsp;the&nbsp;MS&nbsp;VM,&nbsp;I&nbsp;believe)&nbsp;are&nbsp;not&nbsp;all&nbsp;that&nbsp;aggressive&nbsp;with&nbsp;inlining.&nbsp; &nbsp;Many&nbsp;of&nbsp;the&nbsp;situations&nbsp;that&nbsp;would&nbsp;like&nbsp;to&nbsp;inline&nbsp;are&nbsp;somewhat&nbsp;complex&nbsp;to&nbsp;detect&nbsp;/&nbsp;guard.&nbsp; &nbsp;Mono&nbsp;(and&nbsp;I&nbsp;believe&nbsp;the&nbsp;MS&nbsp;.NET&nbsp;runtime)&nbsp;will&nbsp;not&nbsp;attempt&nbsp;to&nbsp;inline&nbsp;calls&nbsp;in&nbsp;various&nbsp;settings,&nbsp;such&nbsp;as&nbsp;if&nbsp;is&nbsp;virtual.&nbsp; &nbsp;There&nbsp;would&nbsp;have&nbsp;to&nbsp;be&nbsp;conditional&nbsp;code&nbsp;generated&nbsp;for&nbsp;the&nbsp;situations&nbsp;where&nbsp;a&nbsp;call&nbsp;would&nbsp;need&nbsp;to&nbsp;be&nbsp;virtual&nbsp;and&nbsp;where&nbsp;it&nbsp;could&nbsp;be&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;concrete&nbsp;terminal&nbsp;type.&nbsp; &lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;can&nbsp;force&nbsp;more&nbsp;agressive&nbsp;inlining&nbsp;of&nbsp;methods&nbsp;by&nbsp;using&nbsp;[MethodImpl(MethodImplOptions.AggressiveInlining)]&nbsp;or [MethodImpl(256)]&nbsp;(if&nbsp;you&#39;re&nbsp;not&nbsp;on&nbsp;4.5)&nbsp;on&nbsp;them.&nbsp;This&nbsp;will&nbsp;still&nbsp;block&nbsp;inlining&nbsp;in&nbsp;a&nbsp;few&nbsp;cases&nbsp;but&nbsp;will&nbsp;give&nbsp;you&nbsp;quite&nbsp;a&nbsp;bit&nbsp;of&nbsp;headroom.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;more&nbsp;general&nbsp;question&nbsp;to&nbsp;the&nbsp;Mono&nbsp;team,&nbsp;does&nbsp;the&nbsp;mono-llvm&nbsp;fork&nbsp;pull&nbsp;in&nbsp;new&nbsp;functionality&nbsp;from&nbsp;the&nbsp;LLVM&nbsp;project&nbsp;from&nbsp;time&nbsp;to&nbsp;time?&nbsp; Should&nbsp;we&nbsp;expect&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;take&nbsp;advantage&nbsp;of&nbsp;the&nbsp;new&nbsp;optimisations&nbsp;(for&nbsp;example&nbsp;the&nbsp;deeper&nbsp;vectorization&nbsp;work&nbsp;in&nbsp;progress)&nbsp;when&nbsp;they&nbsp;become&nbsp;available?&nbsp; &nbsp; I&nbsp;recall&nbsp;that&nbsp;there&nbsp;were&nbsp;a&nbsp;number&nbsp;of&nbsp;deficiencies&nbsp;with&nbsp;the&nbsp;LLVM&nbsp;that&nbsp;required&nbsp;a&nbsp;lot&nbsp;of&nbsp;scaffolding&nbsp;in&nbsp;order&nbsp;to&nbsp;interoperate&nbsp;with&nbsp;the&nbsp;mono&nbsp;runtime.&nbsp; &nbsp;Curious&nbsp;whether&nbsp;the&nbsp;LLVM&nbsp;foks&nbsp;have&nbsp;thought&nbsp;to&nbsp;address&nbsp;these&nbsp;so&nbsp;that&nbsp;could&nbsp;make&nbsp;more&nbsp;direct&nbsp;use&nbsp;of&nbsp;core&nbsp;LLVM&nbsp;in&nbsp;the&nbsp;future?&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;Yes,&nbsp;we&nbsp;track&nbsp;updates&nbsp;of&nbsp;upstream&nbsp;LLVM,&nbsp;you&nbsp;can&nbsp;notice&nbsp;that&nbsp;in&nbsp;what&nbsp;we&nbsp;have&nbsp;on&nbsp;trunk&nbsp;and&nbsp;what&nbsp;2.10&nbsp;uses.&nbsp;We&#39;re&nbsp;not&nbsp;very&nbsp;aggressive&nbsp;in&nbsp;tracking&nbsp;their&nbsp;release&nbsp;schedule&nbsp;given&nbsp;they&nbsp;have&nbsp;a&nbsp;very&nbsp;poor&nbsp;backward&nbsp;compatibility&nbsp;story.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
