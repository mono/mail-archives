Index: System.Web.UI/HtmlTextWriter.cs
===================================================================
--- System.Web.UI/HtmlTextWriter.cs	(revision 55097)
+++ System.Web.UI/HtmlTextWriter.cs	(working copy)
@@ -106,6 +106,15 @@
 	
 		protected virtual void AddAttribute (string name, string value, HtmlTextWriterAttribute key)
 		{
+			if (key == HtmlTextWriterAttribute.Onclick) {
+				for (int i = 0; i <= attrs_pos; i++) {
+					if (attrs[i].key == key) {
+						attrs[i].value = value + attrs[i].value;
+						return;
+					}
+				}
+			}
+
 			NextAttrStack ();
 			attrs [attrs_pos].name = name;
 			attrs [attrs_pos].value = value;
@@ -203,12 +212,15 @@
 			// the enum later. Do we really need anything
 			// faster than a linear search?
 			
-			foreach (HtmlAttribute t in htmlattrs) {
-				if (t.name == attrName)
-					return t.key;
+			if (attrName != null && attrName.Length > 0) {
+				attrName = attrName.ToLower();
+				foreach (HtmlAttribute t in htmlattrs) {
+					if (t.name == attrName)
+						return t.key;
+				}
 			}
 
-			return 0;		
+			return (HtmlTextWriterAttribute)(-1);		
 		}
 
 		[MonoTODO]
@@ -227,13 +239,16 @@
 			// because there might be something added to
 			// the enum later. Do we really need anything
 			// faster than a linear search?
-			
-			foreach (HtmlStyle t in htmlstyles) {
-				if (t.name == styleName)
-					return t.key;
+
+			if (styleName != null && styleName.Length > 0) {
+				styleName = styleName.ToLower();
+				foreach (HtmlStyle t in htmlstyles) {
+					if (t.name == styleName)
+						return t.key;
+				}
 			}
 
-			return 0;			
+			return (HtmlTextWriterStyle)(-1);			
 		}
 		
 		[MonoTODO]
@@ -249,10 +264,13 @@
 			// because there might be something added to
 			// the enum later. Do we really need anything
 			// faster than a linear search?
-			
-			foreach (HtmlTag t in tags) {
-				if (t.name == tagName)
-					return t.key;
+
+			if (tagName != null && tagName.Length > 0) {
+				tagName = tagName.ToLower();
+				foreach (HtmlTag t in tags) {
+					if (t.name == tagName)
+						return t.key;
+				}
 			}
 
 			return HtmlTextWriterTag.Unknown;
