Index: XSPWorkerRequest.cs
===================================================================
RCS file: /cvs/public/xsp/server/XSPWorkerRequest.cs,v
retrieving revision 1.10
diff -u -r1.10 XSPWorkerRequest.cs
--- XSPWorkerRequest.cs	24 May 2003 02:16:13 -0000	1.10
+++ XSPWorkerRequest.cs	24 May 2003 15:56:04 -0000
@@ -4,8 +4,10 @@
 // Authors:
 //	Gonzalo Paniagua Javier (gonzalo@ximian.com)
 //	Simon Waite (simon@psionics.demon.co.uk)
+//	Ben Maurer (bmaurer@users.sourceforge.net)
 //
 // (C) 2002 Ximian, Inc (http://www.ximian.com)
+// (C) 2003 Ben Maurer
 //
 using System;
 using System.Collections;
@@ -382,38 +384,36 @@
 			if (!Directory.Exists (localPath))
 				return true;
 
-			if (!path.EndsWith ("/"))
+			// Redirect /foo to /foo/ to make links like page.aspx go to /foo/page.aspx
+			// else, they would go to /page.aspx, which is wrong.
+			if (!path.EndsWith ("/")) {
 				path += "/";
-
-			bool catOne = false;
+				if (queryString != null && queryString != "")
+					path += "?" + queryString;
+				
+				SendStatus (302, "Moved");
+				WriteString (status);
+				WriteString ("Location: " + path + "\r\n");
+				WriteString ("Content-Type: text/html\r\n");
+				string page = "<html><head><title>Object moved</title></head>" + 
+					"<body><h1>Object Moved</h1>Document moved <a href=\"" +
+					path + "\">here</a></body>";
+				
+				WriteString ("Content-Length: " + page.Length + "\r\n\r\n");
+				WriteString (page);
+				headersSent = true;
+				FlushResponse (true);
+				return false;
+			}			
+			
 			foreach (string indexFile in indexFiles) {
 				string testfile = Path.Combine (localPath, indexFile);
 				if (File.Exists (testfile)) {
 					path += indexFile;
-					catOne = true;
-					break;
+					return true;
 				}
 			}
-
-			if (!catOne)
-				return true;
-
-			if (queryString != null && queryString != "")
-				path += "?" + queryString;
-
-			SendStatus (302, "Moved");
-			WriteString (status);
-			WriteString ("Location: " + path + "\r\n");
-			WriteString ("Content-Type: text/html\r\n");
-			string page = "<html><head><title>Object moved</title></head>" + 
-				      "<body><h1>Object Moved</h1>Document moved <a href=\"" +
-				      path + "\">here</a></body>";
-
-			WriteString ("Content-Length: " + page.Length + "\r\n\r\n");
-			WriteString (page);
-			headersSent = true;
-			FlushResponse (true);
-			return false;
+			return true;
 		}
 
 		void WriteString (string s)
Index: ChangeLog
===================================================================
RCS file: /cvs/public/xsp/server/ChangeLog,v
retrieving revision 1.26
diff -u -r1.26 ChangeLog
--- ChangeLog	24 May 2003 02:16:13 -0000	1.26
+++ ChangeLog	24 May 2003 15:56:04 -0000
@@ -1,3 +1,8 @@
+2003-05-24  Ben Maurer <bmaurer@users.sourceforge.net>
+	* XSPWorkerRequest.cs: Now /foo/ does not redirect to
+	/foo/index.aspx, it just does a Response.Transfer () sort of
+	thing.
+
 2003-05-24  Gonzalo Paniagua Javier <gonzalo@ximian.com>
 
 	* XSPWorkerRequest.cs: when redirecting to an index page, also use the
