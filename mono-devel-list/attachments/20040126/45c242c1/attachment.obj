? AssemblyBuilder.diff
Index: AssemblyBuilder.cs
===================================================================
RCS file: /cvs/public/mcs/class/corlib/System.Reflection.Emit/AssemblyBuilder.cs,v
retrieving revision 1.69
diff -u -r1.69 AssemblyBuilder.cs
--- AssemblyBuilder.cs	24 Jan 2004 11:58:57 -0000	1.69
+++ AssemblyBuilder.cs	26 Jan 2004 13:51:05 -0000
@@ -85,6 +85,7 @@
 		Win32VersionResource version_res;
 		bool created;
 		bool is_module_only;
+		private Mono.Security.StrongName sn;
 
 		[MethodImplAttribute(MethodImplOptions.InternalCall)]
 		private static extern void basic_init (AssemblyBuilder ab);
@@ -574,6 +575,11 @@
 			// contain the hash of the other modules
 			mainModule.Save ();
 
+			// if not delayed then we directly strongname the assembly
+			if ((sn != null) && (!delay_sign)) {
+				sn.Sign (System.IO.Path.Combine (this.AssemblyDir, assemblyFileName));
+			}
+
 			created = true;
 		}
 
@@ -601,7 +607,7 @@
 			string attrname = customBuilder.Ctor.ReflectedType.FullName;
 			byte[] data;
 			int len, pos;
-			Mono.Security.StrongName sn;
+
 			if (attrname == "System.Reflection.AssemblyVersionAttribute") {
 				version = create_assembly_version (customBuilder.string_arg ());
 				return;
Index: ChangeLog
===================================================================
RCS file: /cvs/public/mcs/class/corlib/System.Reflection.Emit/ChangeLog,v
retrieving revision 1.196
diff -u -r1.196 ChangeLog
--- ChangeLog	24 Jan 2004 11:58:57 -0000	1.196
+++ ChangeLog	26 Jan 2004 13:51:05 -0000
@@ -1,3 +1,8 @@
+2004-01-26  Sebastien Pouliot  <spouliot@videotron.ca>
+
+	* AssemblyBuilder.cs: Save will now strongname the assembly is (a) a
+	StrongName is present and (b) the signature isn't delayed.
+
 2004-01-24 David Sheldon <dave-mono@earth.li>
 
 	* AssemblyBuilder.cs: Added override for GetFiles() that throws
