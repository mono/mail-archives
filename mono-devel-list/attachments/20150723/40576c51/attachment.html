<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hey&nbsp;Greg,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;With&nbsp;my&nbsp;current&nbsp;test&nbsp;case&nbsp;it&nbsp;crashes&nbsp;anywhere&nbsp;between&nbsp;0.1&nbsp;and&nbsp;30&nbsp;sec,&nbsp;occasionally&nbsp;longer.&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;run&nbsp;my&nbsp;test&nbsp;case&nbsp;till&nbsp;it&nbsp;crashes,&nbsp;10&nbsp;times&nbsp;in&nbsp;a&nbsp;row,&nbsp;measuring&nbsp;the&nbsp;total&nbsp;run&nbsp;time:&lt;/div&gt;&lt;div&gt;vanilla&nbsp;=&nbsp;3m9.216s 2m26.571s 2m31.168s&nbsp;3m8.670s&lt;/div&gt;&lt;div&gt;clear-at-gc&nbsp;=&nbsp;1m50.81s 2m01.85s 1m10.21s&nbsp;1m10.21s&lt;/div&gt;&lt;div&gt;disable-minor&nbsp;= 0m16.74s&nbsp;0m16.32s&nbsp;(duh,&nbsp;more&nbsp;major&nbsp;collections.&nbsp;the&nbsp;reverse&nbsp;happens&nbsp;if&nbsp;you&nbsp;increase&nbsp;the&nbsp;nursery&nbsp;size.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;So....&nbsp;yeah,&nbsp;clear-at-gc&nbsp;actually&nbsp;makes&nbsp;it&nbsp;worse.&nbsp;;)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;quite&nbsp;possibly&nbsp;has&nbsp;something&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;GC,&nbsp;but&nbsp;i&#39;m&nbsp;trying&nbsp;to&nbsp;find&nbsp;the&nbsp;link&nbsp;with&nbsp;that&nbsp;rdtsc&nbsp;instruction.&lt;/div&gt;&lt;div&gt;Assuming&nbsp;the&nbsp;tsc&nbsp;isn&#39;t&nbsp;used&nbsp;in&nbsp;some&nbsp;convoluted&nbsp;way,&nbsp;it&nbsp;means&nbsp;it&nbsp;should&nbsp;be&nbsp;a&nbsp;missing&nbsp;memory&nbsp;barrier&nbsp;somewhere.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Taloth&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Jul&nbsp;23,&nbsp;2015&nbsp;at&nbsp;2:11&nbsp;PM,&nbsp;Greg&nbsp;Young&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:gregoryyoung1@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;gregoryyoung1@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;We&nbsp;have&nbsp;seen&nbsp;some&nbsp;similar&nbsp;crashes&nbsp;of&nbsp;mono&nbsp;in&nbsp;linux&nbsp;(ubuntu&nbsp;and&nbsp;amazon&nbsp;linux).&lt;br&gt;<br>
&lt;br&gt;<br>
One&nbsp;thing&nbsp;we&nbsp;have&nbsp;done&nbsp;that&nbsp;greatly&nbsp;reduces&nbsp;the&nbsp;frequency&nbsp;of&nbsp;the&lt;br&gt;<br>
crashes&nbsp;so&nbsp;far&nbsp;(removed&nbsp;95%+&nbsp;of&nbsp;them)&nbsp;is.&nbsp;MONO_GC_DEBUG=clear-at-gc&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;an&nbsp;issue&nbsp;here&nbsp;as&nbsp;well&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://bugzilla.xamarin.com/show_bug.cgi?id=18151&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugzilla.xamarin.com/show_bug.cgi?id=18151&lt;/a&gt;&nbsp;that&nbsp;is&nbsp;likely&lt;br&gt;<br>
related.&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
On&nbsp;Thu,&nbsp;Jul&nbsp;23,&nbsp;2015&nbsp;at&nbsp;3:03&nbsp;PM,&nbsp;Taloth&nbsp;Saldono&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:talothsaldono@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;talothsaldono@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hey&nbsp;guys,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;(Initially&nbsp;I&nbsp;incorrectly&nbsp;posted&nbsp;this&nbsp;to&nbsp;the&nbsp;mono-list,&nbsp;so&nbsp;for&nbsp;those&lt;br&gt;<br>
&gt;&nbsp;receiving&nbsp;this&nbsp;message&nbsp;twice,&nbsp;my&nbsp;apologies.)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;looking&nbsp;for&nbsp;a&nbsp;mono&nbsp;expert&nbsp;on&nbsp;the&nbsp;managed&nbsp;threading&nbsp;system,&nbsp;hopefully&nbsp;you&lt;br&gt;<br>
&gt;&nbsp;can&nbsp;give&nbsp;me&nbsp;a&nbsp;pointer&nbsp;to&nbsp;where&nbsp;to&nbsp;look.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;problem&nbsp;a&nbsp;couple&nbsp;of&nbsp;my&nbsp;users&nbsp;experience&nbsp;is&nbsp;that&nbsp;since&nbsp;linux&nbsp;kernel&nbsp;4.1&lt;br&gt;<br>
&gt;&nbsp;mono&nbsp;crashes&nbsp;in&nbsp;a&nbsp;reproducible&nbsp;manner.&nbsp;(Using&nbsp;test&nbsp;case&nbsp;bug-18026&nbsp;in&nbsp;a&nbsp;loop,&lt;br&gt;<br>
&gt;&nbsp;which&nbsp;is&nbsp;a&nbsp;threadpool&nbsp;stress-test)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;A&nbsp;similar&nbsp;problem&nbsp;occurred&nbsp;in&nbsp;3.13.0&nbsp;but&nbsp;that&nbsp;was&nbsp;fixed&nbsp;by&nbsp;backporting&nbsp;some&lt;br&gt;<br>
&gt;&nbsp;commits&nbsp;in&nbsp;the&nbsp;ubuntu&nbsp;kernel.&nbsp;(See&lt;br&gt;<br>
&lt;/span&gt;&lt;span&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://bugzilla.xamarin.com/show_bug.cgi?id=29212&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugzilla.xamarin.com/show_bug.cgi?id=29212&lt;/a&gt;)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Initially&nbsp;I&nbsp;believed&nbsp;that&nbsp;in&nbsp;4.1&nbsp;those&nbsp;commits&nbsp;were&nbsp;reverted,&nbsp;but&nbsp;tests&lt;br&gt;<br>
&gt;&nbsp;indicated&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;cause.&lt;br&gt;<br>
&gt;&nbsp;So&nbsp;I&nbsp;did&nbsp;a&nbsp;full&nbsp;bisect&nbsp;on&nbsp;linux&nbsp;4.0-4.1&nbsp;on&nbsp;a&nbsp;64-bit&nbsp;Ubuntu&nbsp;14.04.2&lt;br&gt;<br>
&gt;&nbsp;Virtualbox.&nbsp;(~13&nbsp;compiles&nbsp;of&nbsp;the&nbsp;kernel,&nbsp;took&nbsp;a&nbsp;couple&nbsp;of&nbsp;days)&lt;br&gt;<br>
&gt;&nbsp;And&nbsp;it&nbsp;ended&nbsp;up&nbsp;on&lt;br&gt;<br>
&lt;/span&gt;&lt;div&gt;&lt;div&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://github.com/torvalds/linux/commit/c70e1b475f37f07ab7181ad28458666d59aae634&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/torvalds/linux/commit/c70e1b475f37f07ab7181ad28458666d59aae634&lt;/a&gt;.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;problem&nbsp;seems&nbsp;to&nbsp;cause&nbsp;NullReferenceException&nbsp;and&nbsp;possibly&nbsp;native&lt;br&gt;<br>
&gt;&nbsp;SIGSEGVs&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;places.&nbsp;(I&nbsp;can&nbsp;dump&nbsp;some&nbsp;stacktraces&nbsp;if&nbsp;desired,&lt;br&gt;<br>
&gt;&nbsp;but&nbsp;I&nbsp;suspect&nbsp;that&nbsp;won&#39;t&nbsp;be&nbsp;helpful&nbsp;coz&nbsp;the&nbsp;corruption&nbsp;is&nbsp;likely&nbsp;caused&lt;br&gt;<br>
&gt;&nbsp;elsewhere.)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;To&nbsp;me&nbsp;it&nbsp;seems&nbsp;impossible&nbsp;that&nbsp;reading&nbsp;the&nbsp;tsc&nbsp;in&nbsp;any&nbsp;way&nbsp;could&nbsp;result&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;nullrefs.&nbsp;So&nbsp;my&nbsp;guess&nbsp;would&nbsp;it&nbsp;a&nbsp;side-effect&nbsp;of&nbsp;the&nbsp;memory&nbsp;barrier.&nbsp;From&lt;br&gt;<br>
&gt;&nbsp;what&nbsp;I&nbsp;understand&nbsp;from&nbsp;the&nbsp;commit,&nbsp;the&nbsp;&#39;mfence+lfence&#39;&nbsp;changed&nbsp;to&nbsp;&#39;mfence&nbsp;or&lt;br&gt;<br>
&gt;&nbsp;lfence&#39;&nbsp;(depending&nbsp;on&nbsp;what&nbsp;the&nbsp;cpu&nbsp;supports)&nbsp;and&nbsp;mfrence=lfence+sfence&nbsp;(not&lt;br&gt;<br>
&gt;&nbsp;entirely&nbsp;true,&nbsp;but&nbsp;close),&nbsp;so&nbsp;I&nbsp;have&nbsp;no&nbsp;idea&nbsp;what&nbsp;the&nbsp;heck&nbsp;is&nbsp;going&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;there.&lt;br&gt;<br>
&gt;&nbsp;But&nbsp;if&nbsp;I&nbsp;would&nbsp;venture&nbsp;a&nbsp;guess&nbsp;that&nbsp;somewhere,&nbsp;indirectly,&nbsp;mono&nbsp;unknowingly&lt;br&gt;<br>
&gt;&nbsp;relies&nbsp;on&nbsp;that&nbsp;barrier&nbsp;to&nbsp;be&nbsp;there.&lt;br&gt;<br>
&gt;&nbsp;Theoretically&nbsp;it&nbsp;still&nbsp;means&nbsp;other&nbsp;native&nbsp;apps&nbsp;could&nbsp;experience&nbsp;the&nbsp;same&lt;br&gt;<br>
&gt;&nbsp;problem,&nbsp;but&nbsp;I&nbsp;would&#39;ve&nbsp;expected&nbsp;reports&nbsp;about&nbsp;that&nbsp;already.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;experience&nbsp;in&nbsp;these&nbsp;matters&nbsp;is&nbsp;pretty&nbsp;much&nbsp;non-existent.&nbsp;But&nbsp;dumping&lt;br&gt;<br>
&gt;&nbsp;issues&nbsp;on&nbsp;devs&nbsp;is&nbsp;the&nbsp;least&nbsp;productive&nbsp;way&nbsp;to&nbsp;get&nbsp;them&nbsp;fixed,&nbsp;so&nbsp;I&nbsp;try&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;investigate&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;can.&nbsp;Especially&nbsp;since&nbsp;it&nbsp;involves&nbsp;an&nbsp;issue&nbsp;that&lt;br&gt;<br>
&gt;&nbsp;could&nbsp;be&nbsp;caused&nbsp;by&nbsp;either&nbsp;mono&nbsp;or&nbsp;the&nbsp;kernel.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;So&nbsp;my&nbsp;question&nbsp;is:&nbsp;Is&nbsp;there&nbsp;a&nbsp;likely&nbsp;candidate&nbsp;in&nbsp;mono&nbsp;where&nbsp;it&nbsp;uses&nbsp;the&nbsp;tsc&lt;br&gt;<br>
&gt;&nbsp;(possibly&nbsp;for&nbsp;profiling)&nbsp;where&nbsp;the&nbsp;changed&nbsp;barrier&nbsp;could&nbsp;cause&nbsp;this&nbsp;odd&lt;br&gt;<br>
&gt;&nbsp;behavior?&nbsp;And&nbsp;obviously,&nbsp;is&nbsp;there&nbsp;anything&nbsp;in&nbsp;particular&nbsp;I&nbsp;could&nbsp;try&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;narrow&nbsp;this&nbsp;down&nbsp;further?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Almost&nbsp;forgot,&nbsp;but&nbsp;I&nbsp;did&nbsp;the&nbsp;bisect&nbsp;using&nbsp;mono&nbsp;4.0.2.5,&nbsp;but&nbsp;I&nbsp;tested&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;nightly&nbsp;version&nbsp;as&nbsp;well.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;time.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Taloth&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
Studying&nbsp;for&nbsp;the&nbsp;Turing&nbsp;test&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
