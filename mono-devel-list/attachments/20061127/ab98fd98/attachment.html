<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;TRANSITIONAL//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;CHARSET=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;META&nbsp;NAME=&quot;GENERATOR&quot;&nbsp;CONTENT=&quot;GtkHTML/3.12.1&quot;&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
Hi,&lt;BR&gt;<br>
&lt;BR&gt;<br>
When&nbsp;using&nbsp;Npgsql,&nbsp;if&nbsp;you&nbsp;try&nbsp;to&nbsp;send&nbsp;(INSERT&nbsp;or&nbsp;UPDATE)&nbsp;a&nbsp;bytea&nbsp;(blob)&nbsp;element&nbsp;without&nbsp;using&nbsp;&amp;quot;Prepare&amp;quot;&nbsp;it&nbsp;will&nbsp;be&nbsp;sent&nbsp;as&nbsp;a&nbsp;Escaped&nbsp;string...&nbsp;This&nbsp;string&nbsp;is&nbsp;4x&nbsp;bigger&nbsp;than&nbsp;the&nbsp;real&nbsp;bytea...&lt;BR&gt;<br>
So&nbsp;:&nbsp;The&nbsp;memory&nbsp;usage&nbsp;on&nbsp;the&nbsp;ASP.NET&nbsp;server&nbsp;is&nbsp;enormous&nbsp;when&nbsp;the&nbsp;blob&nbsp;is&nbsp;more&nbsp;than&nbsp;1MB...&nbsp;and&nbsp;the&nbsp;network&nbsp;traffic&nbsp;is&nbsp;enormous&nbsp;too!&lt;BR&gt;<br>
(see&nbsp;&lt;A&nbsp;HREF=&quot;http://pgfoundry.org/tracker/index.php?func=detail&amp;aid=1000458&amp;group_id=1000140&amp;atid=590&quot;&gt;http://pgfoundry.org/tracker/index.php?func=detail&amp;amp;aid=1000458&amp;amp;group_id=1000140&amp;amp;atid=590&lt;/A&gt;)&lt;BR&gt;<br>
&lt;BR&gt;<br>
If&nbsp;you&nbsp;want&nbsp;to&nbsp;avoid&nbsp;that&nbsp;you've&nbsp;to&nbsp;use&nbsp;Prepare&nbsp;before&nbsp;executing&nbsp;ExecuteNonQuery,&nbsp;or&nbsp;ExecuteReader...&lt;BR&gt;<br>
If&nbsp;you&nbsp;don't&nbsp;believe&nbsp;me&nbsp;use&nbsp;Ethereal&nbsp;(wireshark)&lt;BR&gt;<br>
&lt;BR&gt;<br>
Here's&nbsp;a&nbsp;patch&nbsp;that&nbsp;add&nbsp;a&nbsp;cmd.Prepare&nbsp;allowing&nbsp;Npgsql&nbsp;sending&nbsp;data&nbsp;in&nbsp;binary&nbsp;format!&lt;BR&gt;<br>
This&nbsp;patch&nbsp;shouldn't&nbsp;change&nbsp;anything&nbsp;if&nbsp;you&nbsp;use&nbsp;other&nbsp;connector&nbsp;than&nbsp;Npgsql.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks&nbsp;to&nbsp;review&nbsp;it!&lt;BR&gt;<br>
&lt;BR&gt;<br>
Hubert&nbsp;FONGARNAND&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;PRE&gt;<br>
Index:&nbsp;mcs/class/System.Web/System.Web.SessionState/SessionSQLServerHandler.cs<br>
===================================================================<br>
---&nbsp;mcs/class/System.Web/System.Web.SessionState/SessionSQLServerHandler.cs&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(r&amp;#233;vision&nbsp;68495)<br>
+++&nbsp;mcs/class/System.Web/System.Web.SessionState/SessionSQLServerHandler.cs&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(copie&nbsp;de&nbsp;travail)<br>
@@&nbsp;-196,6&nbsp;+196,7&nbsp;@@<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.CommandText&nbsp;=&nbsp;selectCommand;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.Parameters.Add&nbsp;(CreateParam&nbsp;(command,&nbsp;DbType.String,&nbsp;&amp;quot;SessionID&amp;quot;,&nbsp;id));<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.Parameters.Add&nbsp;(CreateParam&nbsp;(command,&nbsp;DbType.DateTime,&nbsp;&amp;quot;Expires&amp;quot;,&nbsp;DateTime.Now&nbsp;));<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.Prepare();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;command.ExecuteReader&nbsp;();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}<br>
&nbsp;<br>
@@&nbsp;-253,7&nbsp;+254,7&nbsp;@@<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;session.StaticObjects.ToByteArray&nbsp;()));<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;param.Add&nbsp;(CreateParam&nbsp;(command,&nbsp;DbType.Binary,&nbsp;&amp;quot;SessionData&amp;quot;,<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;session.SessionDictionary.ToByteArray&nbsp;()));<br>
-<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.Prepare();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.ExecuteNonQuery&nbsp;();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}<br>
&nbsp;<br>
@@&nbsp;-287,6&nbsp;+288,7&nbsp;@@<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;param.Add&nbsp;(CreateParam&nbsp;(command,&nbsp;DbType.Int32,&nbsp;&amp;quot;Timeout&amp;quot;,&nbsp;timeout));<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;param.Add&nbsp;(CreateParam&nbsp;(command,&nbsp;DbType.Binary,&nbsp;&amp;quot;SessionData&amp;quot;,<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;dict.ToByteArray&nbsp;()));<br>
+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.Prepare();<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;command.ExecuteNonQuery&nbsp;();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}<br>
&lt;/PRE&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
_______________________________________________&lt;br&gt;Ce&nbsp;message&nbsp;et&nbsp;les&nbsp;éventuels&nbsp;documents&nbsp;joints&nbsp;peuvent&nbsp;contenir&nbsp;des&nbsp;informations&nbsp;confidentielles.&lt;br&gt;Au&nbsp;cas&nbsp;où&nbsp;il&nbsp;ne&nbsp;vous&nbsp;serait&nbsp;pas&nbsp;destiné,&nbsp;nous&nbsp;vous&nbsp;remercions&nbsp;de&nbsp;bien&nbsp;vouloir&nbsp;le&nbsp;supprimer&nbsp;et&nbsp;en&nbsp;aviser&nbsp;immédiatement&nbsp;l'expéditeur.&nbsp;Toute&nbsp;utilisation&nbsp;de&nbsp;ce&nbsp;message&nbsp;non&nbsp;conforme&nbsp;à&nbsp;sa&nbsp;destination,&nbsp;toute&nbsp;diffusion&nbsp;ou&nbsp;publication,&nbsp;totale&nbsp;ou&nbsp;partielle&nbsp;et&nbsp;quel&nbsp;qu'en&nbsp;soit&nbsp;le&nbsp;moyen&nbsp;est&nbsp;formellement&nbsp;interdite.&lt;br&gt;Les&nbsp;communications&nbsp;sur&nbsp;internet&nbsp;n'étant&nbsp;pas&nbsp;sécurisées,&nbsp;l'intégrité&nbsp;de&nbsp;ce&nbsp;message&nbsp;n'est&nbsp;pas&nbsp;assurée&nbsp;et&nbsp;la&nbsp;société&nbsp;émettrice&nbsp;ne&nbsp;peut&nbsp;être&nbsp;tenue&nbsp;pour&nbsp;responsable&nbsp;de&nbsp;son&nbsp;contenu.&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
