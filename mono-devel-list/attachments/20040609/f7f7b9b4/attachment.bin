<%@ Page Language = "C#" %>
<%@ Import namespace = "System.Threading" %>
<%@ Import namespace = "System.Security.Principal" %>
<html>
<head>
<title>Principal on Context</title>
<script runat="server">
	void Page_Load ()
	{
		one.Text = GetString (Context.User);
		two.Text = GetString (Thread.CurrentPrincipal);
		Princ p = new Princ ("hola");
		Context.User = p;
		three.Text = GetString (Context.User);
		four.Text = GetString (Thread.CurrentPrincipal);
	}

	string GetString (IPrincipal user)
	{
		if (user == null)
			return "user is null";

		if (user.Identity.Name == null)
			return "name is null";

		if (user.Identity.Name == "")
			return "name is empty (" + user.GetType () + ")";

		return user.Identity.Name;
	}

	class Princ : IPrincipal 
	{
		IIdentity ident;

		public Princ (string name)
		{
			ident = new GenericIdentity (name);
		}

		public IIdentity Identity {
			get { return ident; }
		}

		public bool IsInRole (string role)
		{
			return false;
		}
	}
</script>
</head>
<body>
Context: <asp:label id="one" runat="server" /><br>
Thread: <asp:label id="two" runat="server" /><br>
<p>After changing Context.User:<br>
Context: <asp:label id="three" runat="server" /><br>
Thread: <asp:label id="four" runat="server" /><br>
</body>
</html>

