<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Use&nbsp;a&nbsp;recent&nbsp;version&nbsp;of&nbsp;mono&nbsp;on&nbsp;OSX&nbsp;because&nbsp;DISABLE_AIO&nbsp;has&nbsp;no&nbsp;effect&nbsp;on&nbsp;OSX&nbsp;since&nbsp;the&nbsp;kqueue&nbsp;backend&nbsp;has&nbsp;been&nbsp;disabled.&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Apr&nbsp;23,&nbsp;2013&nbsp;at&nbsp;3:46&nbsp;AM,&nbsp;Roope&nbsp;Kangas&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:roope@grandcrugames.com&quot;&nbsp;target=&quot;_blank&quot;&gt;roope@grandcrugames.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;Hi,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;OSX&nbsp;I&nbsp;keep&nbsp;getting&nbsp;&quot;shutting&nbsp;down&nbsp;finalizer&nbsp;thread&nbsp;timed&nbsp;out&quot;&nbsp;or&nbsp;just&nbsp;process&nbsp;hang&nbsp;ups&nbsp;on&nbsp;exit&nbsp;if&nbsp;I&nbsp;do&nbsp;not&nbsp;use&nbsp;MONO_DISABLE_AIO.&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;only&nbsp;if&nbsp;I&nbsp;try&nbsp;to&nbsp;use&nbsp;async&nbsp;send&nbsp;so&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;this&nbsp;is&nbsp;linux&nbsp;only...&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;-- &lt;br&gt; Roope&nbsp;Kangas&nbsp;/&nbsp;LSD,&nbsp;Grand&nbsp;Cru&lt;br&gt;&lt;div&gt; &lt;a&nbsp;href=&quot;tel:%2B358%2040%20869%206976&quot;&nbsp;value=&quot;+358408696976&quot;&nbsp;target=&quot;_blank&quot;&gt;+358&nbsp;40&nbsp;869&nbsp;6976&lt;/a&gt; &lt;a&nbsp;href=&quot;mailto:roope@grandcrugames.com&quot;&nbsp;target=&quot;_blank&quot;&gt;roope@grandcrugames.com&lt;/a&gt; &lt;br&gt;<br>
 &lt;a&nbsp;href=&quot;http://grandcrugames.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://grandcrugames.com/&lt;/a&gt;&nbsp;@grandcrugames&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&nbsp;style=&quot;color:#a0a0a8&quot;&gt;On&nbsp;Tuesday,&nbsp;April&nbsp;23,&nbsp;2013&nbsp;at&nbsp;10:43&nbsp;AM,&nbsp;Greg&nbsp;Young&nbsp;wrote:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Should&nbsp;this&nbsp;be&nbsp;the&nbsp;new&nbsp;default&nbsp;build&nbsp;for&nbsp;linux&nbsp;then?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;Tue,&nbsp;Apr&nbsp;23,&nbsp;2013&nbsp;at&nbsp;4:23&nbsp;AM,&nbsp;Rodrigo&nbsp;Kumpera&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:kumpera@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;kumpera@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;specific&nbsp;to&nbsp;the&nbsp;epoll&nbsp;backed,&nbsp;if&nbsp;you&nbsp;disable&nbsp;it[1]&nbsp;your&lt;/div&gt;&lt;div&gt;problem&nbsp;is&nbsp;fixed.&lt;/div&gt;&lt;div&gt;I&nbsp;could&nbsp;repro&nbsp;it&nbsp;on&nbsp;linux-amd64&nbsp;with&nbsp;epoll&nbsp;enabled&nbsp;but&nbsp;could&nbsp;not&nbsp;with&nbsp;it&lt;/div&gt;<br>
&lt;div&gt;disabled.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;way&nbsp;to&nbsp;fix&nbsp;this&nbsp;is:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-move&nbsp;locking&nbsp;to&nbsp;the&nbsp;epoll&nbsp;backend&nbsp;and&nbsp;make&nbsp;sure&nbsp;it&nbsp;works&nbsp;there;&lt;/div&gt;&lt;div&gt;-use&nbsp;a&nbsp;pipe&nbsp;like&nbsp;other&nbsp;backends&nbsp;to&nbsp;wake&nbsp;up&nbsp;the&nbsp;waiter&nbsp;and&nbsp;do&nbsp;all&nbsp;epoll&nbsp;ops&lt;/div&gt;<br>
&lt;div&gt;from&nbsp;a&nbsp;single&nbsp;thread&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[1]&nbsp;Set&nbsp;the&nbsp;MONO_DISABLE_AIO&nbsp;env&nbsp;var&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;still&nbsp;have&nbsp;this&nbsp;patch&nbsp;that&nbsp;we&nbsp;use&nbsp;with&nbsp;mono.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;diff&nbsp;--git&nbsp;a/mono/metadata/threadpool.c&nbsp;b/mono/metadata/threadpool.c&lt;/div&gt;<br>
&lt;div&gt;index&nbsp;e8a2f1a..f83e473&nbsp;100644&lt;/div&gt;&lt;div&gt;---&nbsp;a/mono/metadata/threadpool.c&lt;/div&gt;&lt;div&gt;+++&nbsp;b/mono/metadata/threadpool.c&lt;/div&gt;&lt;div&gt;@@&nbsp;-555,8&nbsp;+555,8&nbsp;@@&nbsp;socket_io_add&nbsp;(MonoAsyncResult&nbsp;*ares,&lt;/div&gt;&lt;div&gt;MonoSocketAsyncResult&nbsp;*state)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;mono_g_hash_table_replace&nbsp;(data-&gt;sock_to_state,&nbsp;state-&gt;handle,&nbsp;list);&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;ievt&nbsp;=&nbsp;get_events_from_list&nbsp;(list);&lt;/div&gt;&lt;div&gt;-&nbsp;LeaveCriticalSection&nbsp;(&amp;data-&gt;io_lock);&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;data-&gt;modify&nbsp;(data-&gt;event_data,&nbsp;fd,&nbsp;state-&gt;operation,&nbsp;ievt,&nbsp;is_new);&lt;/div&gt;<br>
&lt;div&gt;+&nbsp;LeaveCriticalSection&nbsp;(&amp;data-&gt;io_lock);&lt;/div&gt;&lt;div&gt;&nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;tried&nbsp;to&nbsp;submit&nbsp;this&nbsp;previously&nbsp;as&nbsp;it&nbsp;resolves&nbsp;our&nbsp;problems.&nbsp;It&nbsp;was&lt;/div&gt;&lt;div&gt;rejected&nbsp;that&nbsp;it&nbsp;introduces&nbsp;a&nbsp;deadlock.&nbsp;We&nbsp;have&nbsp;provided&nbsp;tests&nbsp;that&lt;/div&gt;<br>
&lt;div&gt;show&nbsp;without&nbsp;this&nbsp;change&nbsp;that&nbsp;TCP&nbsp;is&nbsp;basically&nbsp;unusable&nbsp;calls&nbsp;like&lt;/div&gt;&lt;div&gt;beginsend&nbsp;sometimes&nbsp;never&nbsp;call&nbsp;endsend.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;would&nbsp;really&nbsp;prefer&nbsp;to&nbsp;not&nbsp;be&nbsp;distributing&nbsp;a&nbsp;&quot;custom&quot;&nbsp;version&nbsp;of&lt;/div&gt;<br>
&lt;div&gt;mono&nbsp;with&nbsp;this&nbsp;patch&nbsp;so&nbsp;how&nbsp;can&nbsp;we&nbsp;resolve&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Greg&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;Le&nbsp;doute&nbsp;n&#39;est&nbsp;pas&nbsp;une&nbsp;condition&nbsp;agréable,&nbsp;mais&nbsp;la&nbsp;certitude&nbsp;est&nbsp;absurde.&lt;/div&gt;<br>
&lt;div&gt;_______________________________________________&lt;/div&gt;&lt;div&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&nbsp;&lt;/div&gt;&lt;div&gt;Le&nbsp;doute&nbsp;n&#39;est&nbsp;pas&nbsp;une&nbsp;condition&nbsp;agréable,&nbsp;mais&nbsp;la&nbsp;certitude&nbsp;est&nbsp;absurde.&lt;/div&gt;&lt;div&gt;_______________________________________________&lt;/div&gt;<br>
&lt;div&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
