<tt>
Paolo,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Thanks&nbsp;for&nbsp;reviewing&nbsp;the&nbsp;changes.&nbsp;I've&nbsp;addressed&nbsp;most&nbsp;of&nbsp;the&nbsp;issues&nbsp;you&nbsp;have&nbsp;brought&nbsp;up&nbsp;below.&nbsp;See&nbsp;comments&nbsp;inline&nbsp;and&nbsp;new&nbsp;patch.&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;12/4/06,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;<br>
<br>
Paolo&nbsp;Molaro&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:lupus@ximian.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;lupus@ximian.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
On&nbsp;12/01/06&nbsp;Jon&nbsp;Chambers&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;Index:&nbsp;mono/mono/metadata/loader.c&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;mono/mono/metadata/loader.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;68741)&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;mono/mono/metadata/loader.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)<br>
&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-1377,7&nbsp;+1377,7&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;!(cols&nbsp;[1]&nbsp;&amp;amp;&nbsp;METHOD_IMPL_ATTRIBUTE_INTERNAL_CALL)&nbsp;&amp;amp;&amp;amp;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;!(result-&amp;gt;iflags&nbsp;&amp;amp;&nbsp;METHOD_IMPL_ATTRIBUTE_RUNTIME)&nbsp;&amp;amp;&amp;amp;&nbsp;container)&nbsp;{&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;gpointer&nbsp;loc&nbsp;=&nbsp;mono_image_rva_map&nbsp;(image,&nbsp;cols&nbsp;[0]);<br>
&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(loc);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(loc)&nbsp;;&lt;br&gt;&lt;br&gt;This&nbsp;change&nbsp;is&nbsp;incorrect&nbsp;and&nbsp;should&nbsp;be&nbsp;dropped.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Fixed.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&amp;gt;&nbsp;Index:&nbsp;mono/mono/metadata/domain.c&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;mono/mono/metadata/domain.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;68741)&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;mono/mono/metadata/domain.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)<br>
&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-812,14&nbsp;+812,24&nbsp;@@&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_defaults.variant_class&nbsp;=&nbsp;mono_class_from_name&nbsp;(&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_defaults.corlib,&nbsp;&amp;quot;System&amp;quot;,&nbsp;&amp;quot;Variant&amp;quot;);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(mono_defaults.variant_class&nbsp;!=&nbsp;0);<br>
&lt;br&gt;&lt;br&gt;I&nbsp;think&nbsp;we&nbsp;should&nbsp;move&nbsp;away&nbsp;from&nbsp;asserting&nbsp;here.&nbsp;I&nbsp;most&nbsp;cases&lt;br&gt;the&nbsp;types&nbsp;here&nbsp;should&nbsp;be&nbsp;initialized&nbsp;lazily&nbsp;to&nbsp;avoid&nbsp;increasing&nbsp;startup&lt;br&gt;time&nbsp;and&nbsp;memory&nbsp;usage.&nbsp;Likely&nbsp;all&nbsp;the&nbsp;COM-related&nbsp;types&nbsp;can&nbsp;be&nbsp;loaded&lt;br&gt;<br>
<br>
lazily&nbsp;the&nbsp;first&nbsp;time&nbsp;some&nbsp;COM&nbsp;feature&nbsp;is&nbsp;used.&lt;br&gt;It's&nbsp;still&nbsp;fine&nbsp;to&nbsp;have&nbsp;the&nbsp;fields&nbsp;in&nbsp;mono_defaults.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;The&nbsp;are&nbsp;lazily&nbsp;initialized&nbsp;now.&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&amp;gt;&nbsp;Index:&nbsp;mono/mono/metadata/marshal.c&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;mono/mono/metadata/marshal.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(revision&nbsp;68741)&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;mono/mono/metadata/marshal.c&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(working&nbsp;copy)<br>
&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-386,6&nbsp;+448,10&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;rt;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+/*&nbsp;End&nbsp;COM&nbsp;Interop&nbsp;related&nbsp;stuff&nbsp;until&nbsp;seperate&nbsp;file&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;void&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;mono_marshal_init&nbsp;(void)&lt;br&gt;<br>
&amp;gt;&amp;nbsp;&amp;nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-446,6&nbsp;+512,8&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;register_icall&nbsp;(cominterop_get_method_interface,&nbsp;&amp;quot;cominterop_get_method_interface&amp;quot;,&nbsp;&amp;quot;object&nbsp;ptr&amp;quot;,&nbsp;FALSE);&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;register_icall&nbsp;(cominterop_get_function_pointer,&nbsp;&amp;quot;cominterop_get_function_pointer&amp;quot;,&nbsp;&amp;quot;ptr&nbsp;ptr&nbsp;int32&amp;quot;,&nbsp;FALSE);<br>
&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;register_icall&nbsp;(cominterop_object_is_rcw,&nbsp;&amp;quot;cominterop_object_is_rcw&amp;quot;,&nbsp;&amp;quot;int32&nbsp;object&amp;quot;,&nbsp;FALSE);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;register_icall&nbsp;(cominterop_get_ccw,&nbsp;&amp;quot;cominterop_get_ccw&amp;quot;,&nbsp;&amp;quot;ptr&nbsp;object&nbsp;ptr&amp;quot;,&nbsp;FALSE);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;register_icall&nbsp;(cominterop_get_ccw_object,&nbsp;&amp;quot;cominterop_get_ccw_object&amp;quot;,&nbsp;&amp;quot;object&nbsp;ptr&nbsp;int32&amp;quot;,&nbsp;FALSE);&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-1796,7&nbsp;+1864,7&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;MonoMethod*&nbsp;com_interop_proxy_get_proxy&nbsp;=&nbsp;NULL;<br>
&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;MonoMethod*&nbsp;get_transparent_proxy&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;real_proxy;&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;guint32&nbsp;pos_failed&nbsp;=&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;guint32&nbsp;pos_null&nbsp;=&nbsp;0,&nbsp;pos_ccw&nbsp;=&nbsp;0,&nbsp;pos_end&nbsp;=&nbsp;0;<br>
&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClass&nbsp;*klass&nbsp;=&nbsp;mono_class_from_mono_type&nbsp;(type);&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_ldloc&nbsp;(mb,&nbsp;1);&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-1805,8&nbsp;+1873,17&nbsp;@@&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_ldloc&nbsp;(mb,&nbsp;0);<br>
&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_byte&nbsp;(mb,&nbsp;CEE_LDIND_I);&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;pos_failed&nbsp;=&nbsp;mono_mb_emit_short_branch&nbsp;(mb,&nbsp;CEE_BRFALSE_S);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;pos_null&nbsp;=&nbsp;mono_mb_emit_short_branch&nbsp;(mb,&nbsp;CEE_BRFALSE_S);<br>
&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;load&nbsp;dst&nbsp;to&nbsp;store&nbsp;later&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_ldloc&nbsp;(mb,&nbsp;1);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_ldloc&nbsp;(mb,&nbsp;0);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_byte&nbsp;(mb,&nbsp;CEE_LDIND_I);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_icon&nbsp;(mb,&nbsp;TRUE);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_icall&nbsp;(mb,&nbsp;cominterop_get_ccw_object);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;pos_ccw&nbsp;=&nbsp;mono_mb_emit_short_branch&nbsp;(mb,&nbsp;CEE_BRTRUE_S);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!com_interop_proxy_class)<br>
&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;com_interop_proxy_class&nbsp;=&nbsp;mono_class_from_name&nbsp;(mono_defaults.corlib,&nbsp;&amp;quot;Mono.Interop&amp;quot;,&nbsp;&amp;quot;ComInteropProxy&amp;quot;);&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!com_interop_proxy_get_proxy)&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-1821,18&nbsp;+1898,35&nbsp;@@<br>
&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_ptr&nbsp;(mb,&nbsp;&amp;amp;mono_defaults.com_object_class-&amp;gt;byval_arg);&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_icall&nbsp;(mb,&nbsp;type_from_handle);&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_managed_call&nbsp;(mb,&nbsp;com_interop_proxy_get_proxy,&nbsp;NULL);<br>
&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_stloc&nbsp;(mb,&nbsp;real_proxy);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//mono_mb_emit_stloc&nbsp;(mb,&nbsp;real_proxy);&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_ldloc&nbsp;(mb,&nbsp;1);&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_mb_emit_ldloc&nbsp;(mb,&nbsp;real_proxy);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//mono_mb_emit_ldloc&nbsp;(mb,&nbsp;1);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//mono_mb_emit_ldloc&nbsp;(mb,&nbsp;real_proxy);&lt;br&gt;&lt;br&gt;Why&nbsp;is&nbsp;this&nbsp;code&nbsp;commented&nbsp;out?&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Removed.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&amp;gt;&nbsp;+GHashTable*&nbsp;ccw_hash&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+GHashTable*&nbsp;ccw_entry_hash&nbsp;=&nbsp;NULL;&lt;br&gt;&lt;br&gt;These&nbsp;must&nbsp;be&nbsp;static.&nbsp;Also,&nbsp;document&nbsp;with&nbsp;a&nbsp;comment&nbsp;what&nbsp;the&nbsp;key&nbsp;and&lt;br&gt;value&nbsp;types&nbsp;are&nbsp;for&nbsp;each&nbsp;hashtable.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Static&nbsp;and&nbsp;now&nbsp;documented.&nbsp;<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&amp;gt;&nbsp;+/**&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;cominterop_get_ccw:&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;@object:&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;object<br>
&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;@itf:&nbsp;interface&nbsp;type&nbsp;needed&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;Returns:&nbsp;a&nbsp;value&nbsp;indicating&nbsp;if&nbsp;the&nbsp;object&nbsp;is&nbsp;a&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*&nbsp;Runtime&nbsp;Callable&nbsp;Wrapper&nbsp;(RCW)&nbsp;for&nbsp;a&nbsp;COM&nbsp;object&lt;br&gt;&amp;gt;&nbsp;+&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;gpointer&lt;br&gt;&amp;gt;&nbsp;+cominterop_get_ccw&nbsp;(MonoObject*&nbsp;object,&nbsp;MonoClass*&nbsp;itf)<br>
&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;i;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoCCW&nbsp;*ccw&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoCCWEntry*&nbsp;ccw_entry&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;gpointer&nbsp;*vtable&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;gpointer&nbsp;iunknown[3]&nbsp;=&nbsp;{NULL,&nbsp;NULL,&nbsp;NULL};&lt;br&gt;<br>
&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;gpointer&nbsp;idispatch[4]&nbsp;=&nbsp;{NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL};<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClass*&nbsp;iface&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoClass*&nbsp;klass&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;EmitMarshalContext&nbsp;m;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;start_slot&nbsp;=&nbsp;3;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;method_count&nbsp;=&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!object)<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;klass&nbsp;=&nbsp;mono_object_get_class&nbsp;(object);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!ccw_hash)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw_hash&nbsp;=&nbsp;g_hash_table_new&nbsp;(mono_aligned_addr_hash,&nbsp;NULL);<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!ccw_entry_hash)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw_entry_hash&nbsp;=&nbsp;g_hash_table_new&nbsp;(mono_aligned_addr_hash,&nbsp;NULL);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw&nbsp;=&nbsp;g_hash_table_lookup&nbsp;(ccw_hash,&nbsp;object);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!iunknown[0])&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iunknown[0]&nbsp;=&nbsp;cominterop_ccw_queryinterface;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iunknown[1]&nbsp;=&nbsp;cominterop_ccw_addref;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iunknown[2]&nbsp;=&nbsp;cominterop_ccw_release;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!idispatch[0])&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;idispatch[0]&nbsp;=&nbsp;cominterop_ccw_get_type_info_count;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;idispatch[1]&nbsp;=&nbsp;cominterop_ccw_get_type_info;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;idispatch[2]&nbsp;=&nbsp;cominterop_ccw_get_ids_of_names;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;idispatch[3]&nbsp;=&nbsp;cominterop_ccw_invoke;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!ccw)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw&nbsp;=&nbsp;g_new0&nbsp;(MonoCCW,&nbsp;1);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw-&amp;gt;vtable_hash&nbsp;=&nbsp;g_hash_table_new&nbsp;(mono_aligned_addr_hash,&nbsp;NULL);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw-&amp;gt;ref_count&nbsp;=&nbsp;0;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw-&amp;gt;object&nbsp;=&nbsp;object;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_hash_table_insert&nbsp;(ccw_hash,&nbsp;object,&nbsp;ccw);&lt;br&gt;&lt;br&gt;You&nbsp;can't&nbsp;insert&nbsp;a&nbsp;managed&nbsp;object&nbsp;inside&nbsp;a&nbsp;GHashTable,&nbsp;since&nbsp;objects&lt;br&gt;can&nbsp;move&nbsp;and&nbsp;the&nbsp;GC&nbsp;can't&nbsp;see&nbsp;inside&nbsp;GHashTable,&nbsp;you'll&nbsp;get&nbsp;a&nbsp;broken<br>
&lt;br&gt;pointer&nbsp;and&nbsp;a&nbsp;crash.&nbsp;If&nbsp;the&nbsp;hash&nbsp;must&nbsp;not&nbsp;keep&nbsp;alive&nbsp;the&nbsp;object&nbsp;and&nbsp;you&lt;br&gt;used&nbsp;a&nbsp;GHashTable&nbsp;as&nbsp;a&nbsp;way&nbsp;to&nbsp;implement&nbsp;weak&nbsp;references,&nbsp;you&nbsp;must&nbsp;use&lt;br&gt;the&nbsp;runtime&nbsp;support&nbsp;for&nbsp;weak&nbsp;references&nbsp;instead.&nbsp;Also,&nbsp;remember&nbsp;that&nbsp;for<br>
&lt;br&gt;object&nbsp;hashes&nbsp;you&nbsp;must&nbsp;use&nbsp;the&nbsp;mono_object_hash()&nbsp;function.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;The&nbsp;object&nbsp;is&nbsp;not&nbsp;put&nbsp;in&nbsp;hashtable,&nbsp;but&nbsp;just&nbsp;used&nbsp;as&nbsp;the&nbsp;key&nbsp;in&nbsp;this&nbsp;case.&nbsp;I&nbsp;changed&nbsp;the&nbsp;hash&nbsp;table&nbsp;to&nbsp;use&nbsp;mono_object_hash()&nbsp;as&nbsp;the&nbsp;hash&nbsp;function&nbsp;where&nbsp;the&nbsp;object&nbsp;is&nbsp;the&nbsp;key.&nbsp;I've&nbsp;removed&nbsp;the&nbsp;MonoObject*&nbsp;field&nbsp;from&nbsp;the&nbsp;MonoCCW&nbsp;struct&nbsp;and&nbsp;just&nbsp;look&nbsp;it&nbsp;up&nbsp;using&nbsp;the&nbsp;gc_handle&nbsp;when&nbsp;needed&nbsp;instead.<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;register&nbsp;for&nbsp;finalization&nbsp;to&nbsp;clean&nbsp;up&nbsp;ccw&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_object_register_finalizer&nbsp;(object);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iface&nbsp;=&nbsp;itf;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(iface&nbsp;==&nbsp;mono_defaults.iunknown_class)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;start_slot&nbsp;=&nbsp;3;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&nbsp;if&nbsp;(iface&nbsp;==&nbsp;mono_defaults.idispatch_class)&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;start_slot&nbsp;=&nbsp;7;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while&nbsp;(iface)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;method_count&nbsp;+=&nbsp;iface-&amp;gt;method.count;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(iface-&amp;gt;interface_count)&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iface&nbsp;=&nbsp;iface-&amp;gt;interfaces[0];&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;start_slot&nbsp;=&nbsp;cominterop_get_com_slot_begin&nbsp;(iface);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iface&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw_entry&nbsp;=&nbsp;g_hash_table_lookup&nbsp;(ccw-&amp;gt;vtable_hash,&nbsp;itf);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;<br>
<br>
&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!ccw_entry)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;vtable_index&nbsp;=&nbsp;method_count-1+start_slot;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;vtable&nbsp;=&nbsp;mono_mempool_alloc0&nbsp;(klass-&amp;gt;image-&amp;gt;mempool,&nbsp;sizeof&nbsp;(gpointer)*(method_count+start_slot));<br>
&lt;br&gt;&lt;br&gt;You&nbsp;need&nbsp;to&nbsp;take&nbsp;the&nbsp;loader&nbsp;lock&nbsp;to&nbsp;allocate&nbsp;from&nbsp;image-&amp;gt;mempool.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I've&nbsp;added&nbsp;the&nbsp;loader&nbsp;lock.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;memcpy(vtable,&nbsp;iunknown,&nbsp;sizeof(iunknown));&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(start_slot&nbsp;==&nbsp;7)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;memcpy(vtable+3,&nbsp;idispatch,&nbsp;sizeof(idispatch));&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iface&nbsp;=&nbsp;itf;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while&nbsp;(iface)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;iface-&amp;gt;method.count-1;&nbsp;i&nbsp;&amp;gt;=&nbsp;0;i--)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;param_index&nbsp;=&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoMethodBuilder&nbsp;*mb;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoMarshalSpec&nbsp;**&nbsp;mspecs;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoMethod&nbsp;*wrapper_method,&nbsp;*adjust_method;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoMethod&nbsp;*method&nbsp;=&nbsp;iface-&amp;gt;methods[i];<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoMethodSignature*&nbsp;sig_adjusted;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoMethodSignature*&nbsp;sig&nbsp;=&nbsp;mono_method_signature&nbsp;(method);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mb&nbsp;=&nbsp;mono_mb_new&nbsp;(iface,&nbsp;method-&amp;gt;name,&nbsp;MONO_WRAPPER_CCW);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;adjust_method&nbsp;=&nbsp;cominterop_get_managed_wrapper_adjusted&nbsp;(method);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;sig_adjusted&nbsp;=&nbsp;mono_method_signature&nbsp;(adjust_method);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mspecs&nbsp;=&nbsp;g_new&nbsp;(MonoMarshalSpec*,&nbsp;sig_adjusted-&amp;gt;param_count&nbsp;+&nbsp;1);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_method_get_marshal_info&nbsp;(method,&nbsp;mspecs);&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;move&nbsp;managed&nbsp;args&nbsp;up&nbsp;one&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(param_index&nbsp;=&nbsp;sig-&amp;gt;param_count;&nbsp;param_index&nbsp;&amp;gt;=&nbsp;1;&nbsp;param_index--)<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mspecs[param_index+1]&nbsp;=&nbsp;mspecs[param_index];&lt;br&gt;&lt;br&gt;Here&nbsp;and&nbsp;in&nbsp;the&nbsp;other&nbsp;places,&nbsp;put&nbsp;a&nbsp;space&nbsp;before&nbsp;the&nbsp;[&nbsp;of&nbsp;an&nbsp;array&lt;br&gt;access.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I've&nbsp;put&nbsp;in&nbsp;spaces&nbsp;in&nbsp;my&nbsp;uses&nbsp;of&nbsp;array&nbsp;accessors.<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;first&nbsp;arg&nbsp;is&nbsp;IntPtr&nbsp;for&nbsp;interface<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mspecs[1]&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;move&nbsp;return&nbsp;spec&nbsp;to&nbsp;last&nbsp;param&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!MONO_TYPE_IS_VOID&nbsp;(sig-&amp;gt;ret))&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mspecs[sig_adjusted-&amp;gt;param_count]&nbsp;=&nbsp;mspecs[0];<br>
&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mspecs[0]&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cominterop_setup_marshal_context&nbsp;(&amp;amp;m,&nbsp;adjust_method);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;m.mb&nbsp;=&nbsp;mb;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_marshal_emit_managed_wrapper&nbsp;(mb,&nbsp;sig_adjusted,&nbsp;mspecs,&nbsp;&amp;amp;m,&nbsp;adjust_method,&nbsp;NULL);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_loader_lock&nbsp;();&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_marshal_lock&nbsp;();<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;wrapper_method&nbsp;=&nbsp;mono_mb_create_method&nbsp;(mb,&nbsp;sig_adjusted,&nbsp;sig_adjusted-&amp;gt;param_count&nbsp;+&nbsp;16);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_marshal_unlock&nbsp;();&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_loader_unlock&nbsp;();<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;vtable[vtable_index--]&nbsp;=&nbsp;mono_compile_method&nbsp;(wrapper_method);&lt;br&gt;&lt;br&gt;Do&nbsp;you&nbsp;really&nbsp;need&nbsp;the&nbsp;methods&nbsp;to&nbsp;be&nbsp;compiled&nbsp;right&nbsp;away?&lt;br&gt;It&nbsp;would&nbsp;be&nbsp;good&nbsp;to&nbsp;delay&nbsp;compilation&nbsp;to&nbsp;when&nbsp;the&nbsp;methods&nbsp;are&nbsp;actually<br>
&lt;br&gt;used.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;These&nbsp;are&nbsp;unmanaged-&amp;gt;managed&nbsp;transition&nbsp;wrappers,&nbsp;so&nbsp;I&nbsp;compile&nbsp;these&nbsp;to&nbsp;get&nbsp;the&nbsp;function&nbsp;pointers&nbsp;to&nbsp;fill&nbsp;the&nbsp;COM&nbsp;vtables.&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(param_index&nbsp;=&nbsp;sig_adjusted-&amp;gt;param_count;&nbsp;param_index&nbsp;&amp;gt;=&nbsp;0;&nbsp;param_index--)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(mspecs&nbsp;[param_index])&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_metadata_free_marshal_spec&nbsp;(mspecs&nbsp;[param_index]);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_free&nbsp;(mspecs);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(iface-&amp;gt;interface_count)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iface&nbsp;=&nbsp;iface-&amp;gt;interfaces[0];&lt;br&gt;<br>
<br>
&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;iface&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw_entry&nbsp;=&nbsp;g_new0&nbsp;(MonoCCWEntry,&nbsp;1);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw_entry-&amp;gt;ccw&nbsp;=&nbsp;ccw;<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw_entry-&amp;gt;vtable&nbsp;=&nbsp;vtable;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_hash_table_insert&nbsp;(ccw-&amp;gt;vtable_hash,&nbsp;itf,&nbsp;ccw_entry);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_hash_table_insert&nbsp;(ccw_entry_hash,&nbsp;ccw_entry,&nbsp;ccw);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}<br>
&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;ccw_entry;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;gboolean&lt;br&gt;&amp;gt;&nbsp;+mono_marshal_free_ccw_entry&nbsp;(gpointer&nbsp;key,&nbsp;gpointer&nbsp;value,&nbsp;gpointer&nbsp;user_data)&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoCCWEntry*&nbsp;entry&nbsp;=&nbsp;(MonoCCWEntry*)value;<br>
&lt;br&gt;&lt;br&gt;No&nbsp;need&nbsp;to&nbsp;use&nbsp;a&nbsp;cast&nbsp;here.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Removed&nbsp;cast.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&amp;gt;&nbsp;+gboolean<br>
&lt;br&gt;&amp;gt;&nbsp;+mono_marshal_free_ccw&nbsp;(MonoObject*&nbsp;object)&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoCCW*&nbsp;ccw&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;no&nbsp;ccw's&nbsp;were&nbsp;created&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!ccw_hash)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;FALSE;&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&lt;br&gt;<br>
You&nbsp;might&nbsp;want&nbsp;to&nbsp;add&nbsp;also&nbsp;a&nbsp;check&nbsp;for&nbsp;g_hash_table_size&nbsp;()&nbsp;==&nbsp;0&nbsp;here.<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Added&nbsp;check.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&amp;gt;&nbsp;+static&nbsp;int&nbsp;STDCALL&lt;br&gt;&amp;gt;&nbsp;+cominterop_ccw_addref&nbsp;(MonoCCWEntry*&nbsp;ccwe)<br>
&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoCCW*&nbsp;ccw&nbsp;=&nbsp;ccwe-&amp;gt;ccw;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(ccw);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(ccw-&amp;gt;object);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(ccw-&amp;gt;ref_count&nbsp;&amp;gt;=&nbsp;0);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw-&amp;gt;ref_count++;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(ccw-&amp;gt;ref_count&nbsp;==&nbsp;1)&nbsp;{<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*&nbsp;since&nbsp;we&nbsp;now&nbsp;have&nbsp;a&nbsp;ref&nbsp;count,&nbsp;alloc&nbsp;a&nbsp;handle*/&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw-&amp;gt;gc_handle&nbsp;=&nbsp;mono_gchandle_new&nbsp;(ccw-&amp;gt;object,&nbsp;FALSE);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;Can&nbsp;you&nbsp;explain&nbsp;this&nbsp;MonoCCW&nbsp;data&nbsp;structure&nbsp;here?&nbsp;It&nbsp;has&nbsp;a&nbsp;pointer<br>
&lt;br&gt;to&nbsp;a&nbsp;reference&nbsp;which&nbsp;isn't&nbsp;GC-tracked&nbsp;and&nbsp;so&nbsp;it's&nbsp;bad.&nbsp;It&nbsp;looks&nbsp;to&nbsp;be&lt;br&gt;created&nbsp;with&nbsp;a&nbsp;0&nbsp;refcount&nbsp;and&nbsp;an&nbsp;handle&nbsp;is&nbsp;created&nbsp;for&nbsp;the&nbsp;object,&nbsp;so&lt;br&gt;there&nbsp;doesn't&nbsp;seem&nbsp;to&nbsp;be&nbsp;any&nbsp;need&nbsp;to&nbsp;store&nbsp;also&nbsp;an&nbsp;object&nbsp;in&nbsp;it.&lt;br&gt;Also,&nbsp;the&nbsp;reference&nbsp;count&nbsp;increase&nbsp;is&nbsp;done&nbsp;in&nbsp;a&nbsp;thread-unsafe&nbsp;way.<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I've&nbsp;removed&nbsp;the&nbsp;object&nbsp;reference.&nbsp;I&nbsp;only&nbsp;allocate&nbsp;a&nbsp;weak&nbsp;handle&nbsp;and&nbsp;set&nbsp;the&nbsp;reference&nbsp;count&nbsp;to&nbsp;0.&nbsp;If&nbsp;the&nbsp;unmanaged&nbsp;client&nbsp;code&nbsp;decides&nbsp;to&nbsp;addref&nbsp;and&nbsp;hold&nbsp;onto&nbsp;the&nbsp;CCW,&nbsp;I&nbsp;then&nbsp;allocate&nbsp;a&nbsp;strong&nbsp;handle.&nbsp;Once&nbsp;the&nbsp;reference&nbsp;count&nbsp;goes&nbsp;back&nbsp;to&nbsp;0&nbsp;I&nbsp;go&nbsp;back&nbsp;to&nbsp;a&nbsp;weak&nbsp;handle.<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;ccw-&amp;gt;ref_count;&lt;br&gt;&amp;gt;&nbsp;+}&lt;br&gt;&amp;gt;&nbsp;+&lt;br&gt;&amp;gt;&nbsp;+static&nbsp;int&nbsp;STDCALL<br>
&lt;br&gt;&amp;gt;&nbsp;+cominterop_ccw_release&nbsp;(MonoCCWEntry*&nbsp;ccwe)&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoCCW*&nbsp;ccw&nbsp;=&nbsp;ccwe-&amp;gt;ccw;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(ccw);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(ccw-&amp;gt;object);&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(ccw-&amp;gt;ref_count&nbsp;&amp;gt;&nbsp;0);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw-&amp;gt;ref_count--;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(ccw-&amp;gt;ref_count&nbsp;==&nbsp;0)&nbsp;{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*&nbsp;allow&nbsp;gc&nbsp;of&nbsp;object&nbsp;*/&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;guint32&nbsp;handle&nbsp;=&nbsp;ccw-&amp;gt;gc_handle;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_assert&nbsp;(handle);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;ccw-&amp;gt;gc_handle&nbsp;=&nbsp;0;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_gchandle_free&nbsp;(handle);&lt;br&gt;&lt;br&gt;Why&nbsp;doesn't&nbsp;this&nbsp;clear&nbsp;ccw-&amp;gt;object?&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Object&nbsp;reference&nbsp;removed.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&amp;gt;&nbsp;+static&nbsp;int&nbsp;STDCALL&lt;br&gt;&amp;gt;&nbsp;+cominterop_ccw_get_type_info_count&nbsp;(MonoCCWEntry*&nbsp;ccwe,&nbsp;guint32&nbsp;*pctinfo)&lt;br&gt;&amp;gt;&nbsp;+{&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(pctinfo)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;*pctinfo&nbsp;=&nbsp;1;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;0x80004001L;&lt;br&gt;&lt;br&gt;<br>
<br>
Better&nbsp;use&nbsp;a&nbsp;named&nbsp;define&nbsp;here&nbsp;for&nbsp;clarity&nbsp;of&nbsp;what&nbsp;the&nbsp;number&nbsp;means.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Added&nbsp;named&nbsp;defines&nbsp;for&nbsp;basic&nbsp;error&nbsp;codes.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&amp;gt;&nbsp;Index:&nbsp;mono/mono/metadata/gc.c&lt;br&gt;&amp;gt;&nbsp;===================================================================&lt;br&gt;&amp;gt;&nbsp;---&nbsp;mono/mono/metadata/gc.c&amp;nbsp;&amp;nbsp;&nbsp;(revision&nbsp;68741)&lt;br&gt;&amp;gt;&nbsp;+++&nbsp;mono/mono/metadata/gc.c&amp;nbsp;&amp;nbsp;&nbsp;(working&nbsp;copy)&lt;br&gt;<br>
<br>
&amp;gt;&nbsp;@@&nbsp;-61,6&nbsp;+61,7&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;{&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoObject&nbsp;*exc&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoObject&nbsp;*o,&nbsp;*o2;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;MonoMethod*&nbsp;finalizer&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;o&nbsp;=&nbsp;(MonoObject*)((char*)obj&nbsp;+&nbsp;GPOINTER_TO_UINT&nbsp;(data));<br>
&lt;br&gt;<br>
&amp;gt;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;#ifndef&nbsp;HAVE_SGEN_GC&lt;br&gt;&amp;gt;&nbsp;@@&nbsp;-100,8&nbsp;+101,15&nbsp;@@&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;mono_runtime_invoke&nbsp;(mono_class_get_finalizer&nbsp;(o-&amp;gt;vtable-&amp;gt;klass),&nbsp;o,&nbsp;NULL,&nbsp;&amp;amp;exc);<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;finalizer&nbsp;=&nbsp;mono_class_get_finalizer&nbsp;(o-&amp;gt;vtable-&amp;gt;klass);&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;/*&nbsp;if&nbsp;we&nbsp;area&nbsp;ccw,&nbsp;and&nbsp;have&nbsp;no&nbsp;finalizer&nbsp;method&nbsp;just&nbsp;return&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;*&nbsp;else&nbsp;run&nbsp;regular&nbsp;finalizer&nbsp;after&nbsp;freeing&nbsp;ccw&nbsp;*/<br>
&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(mono_marshal_free_ccw&nbsp;(o)&nbsp;&amp;amp;&amp;amp;&nbsp;!finalizer)&lt;br&gt;&amp;gt;&nbsp;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return;&lt;br&gt;&lt;br&gt;So&nbsp;what&nbsp;happens&nbsp;if&nbsp;the&nbsp;object&nbsp;has&nbsp;a&nbsp;finalizer&nbsp;and&nbsp;wants&nbsp;to&nbsp;use&nbsp;COM&lt;br&gt;features&nbsp;in&nbsp;it?&nbsp;Is&nbsp;that&nbsp;not&nbsp;possible?&nbsp;We&nbsp;need&nbsp;a&nbsp;comment&nbsp;here.<br>
&lt;br&gt;You&nbsp;may&nbsp;also&nbsp;want&nbsp;to&nbsp;check&nbsp;what&nbsp;happens&nbsp;with&nbsp;resurrection&nbsp;(ie&nbsp;the&lt;br&gt;objects&nbsp;stores&nbsp;itself&nbsp;in&nbsp;a&nbsp;static&nbsp;field&nbsp;inside&nbsp;the&nbsp;finalizer).&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Added&nbsp;better&nbsp;comment.&nbsp;If&nbsp;an&nbsp;object&nbsp;has&nbsp;a&nbsp;CCW&nbsp;associated&nbsp;with&nbsp;it&nbsp;and&nbsp;has&nbsp;no&nbsp;finalizer&nbsp;we&nbsp;can&nbsp;safely&nbsp;return&nbsp;after&nbsp;destroying&nbsp;the&nbsp;CCW&nbsp;since&nbsp;we&nbsp;are&nbsp;only&nbsp;being&nbsp;finalized&nbsp;since&nbsp;COM&nbsp;Interop&nbsp;registered&nbsp;the&nbsp;object&nbsp;for&nbsp;finalization&nbsp;to&nbsp;clean&nbsp;up&nbsp;the&nbsp;CCW.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases&nbsp;we&nbsp;continue&nbsp;on&nbsp;(including&nbsp;the&nbsp;case&nbsp;you&nbsp;brought&nbsp;up&nbsp;where&nbsp;an&nbsp;object&nbsp;has&nbsp;a&nbsp;finalizer&nbsp;and&nbsp;has&nbsp;been&nbsp;exposed&nbsp;to&nbsp;unmanaged&nbsp;code&nbsp;via&nbsp;a&nbsp;CCW)&nbsp;to&nbsp;call&nbsp;the&nbsp;objects&nbsp;finalizer.&nbsp;I've&nbsp;added&nbsp;a&nbsp;FIXME&nbsp;for&nbsp;resurrection,&nbsp;and&nbsp;also&nbsp;if&nbsp;the&nbsp;user&nbsp;calls&nbsp;SuppressFinalize&nbsp;the&nbsp;CCW&nbsp;will&nbsp;leak&nbsp;currently.&nbsp;I&nbsp;see&nbsp;what&nbsp;is&nbsp;done&nbsp;for&nbsp;delegates&nbsp;in&nbsp;that&nbsp;case,&nbsp;but&nbsp;this&nbsp;is&nbsp;a&nbsp;bit&nbsp;different.&nbsp;I&nbsp;currently&nbsp;have&nbsp;no&nbsp;way&nbsp;to&nbsp;determine&nbsp;that&nbsp;an&nbsp;object&nbsp;with&nbsp;a&nbsp;finalizer&nbsp;needs&nbsp;it's&nbsp;CCW&nbsp;destroyed&nbsp;but&nbsp;don't&nbsp;need&nbsp;it's&nbsp;finalizer&nbsp;run.<br>
&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Thanks!&lt;br&gt;&lt;br&gt;lupus&lt;br&gt;&lt;br&gt;--&lt;br&gt;-----------------------------------------------------------------<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:lupus@debian.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;lupus@debian.org&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;debian/rules&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:lupus@ximian.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;<br>
lupus@ximian.com&lt;/a&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Monkeys&nbsp;do&nbsp;it&nbsp;better&lt;br&gt;_______________________________________________<br>
&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onclick=&quot;return&nbsp;top.js.OpenExtLink(window,event,this)&quot;&gt;<br>
http://lists.ximian.com/mailman/listinfo/mono-devel-list<br>
&lt;/a&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Also,&nbsp;there&nbsp;are&nbsp;some&nbsp;places&nbsp;I&nbsp;know&nbsp;I&nbsp;need&nbsp;to&nbsp;make&nbsp;threadsafe.&nbsp;Should&nbsp;I&nbsp;create&nbsp;a&nbsp;new&nbsp;critical&nbsp;section,&nbsp;or&nbsp;just&nbsp;use&nbsp;the&nbsp;marshal&nbsp;one?&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Jonathan&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;<br>
<br>

</tt>
