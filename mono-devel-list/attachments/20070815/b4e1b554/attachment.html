<tt>
Hi&nbsp;Bill,&lt;br&gt;&lt;br&gt;Below&nbsp;are&nbsp;some&nbsp;comments&nbsp;regarding&nbsp;your&nbsp;patch:&lt;br&gt;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return(ret);&lt;br&gt;+}&lt;br&gt;&lt;br&gt;Don&amp;#39;t&nbsp;use&nbsp;parentesis&nbsp;around&nbsp;the&nbsp;return&nbsp;value,&nbsp;it&nbsp;makes&nbsp;things&nbsp;harder&nbsp;to&nbsp;read.&lt;br&gt;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;remain,&nbsp;n;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;buf_size&nbsp;=&nbsp;st_src-&amp;gt;st_blksize;<br>
&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;char&nbsp;*buf&nbsp;=&nbsp;(char&nbsp;*)&nbsp;alloca&nbsp;(buf_size);&lt;br&gt;+&lt;br&gt;&lt;br&gt;It&amp;#39;s&nbsp;better&nbsp;to&nbsp;avoid&nbsp;alloca&nbsp;for&nbsp;quite&nbsp;a&nbsp;few&nbsp;reasons&nbsp;and&nbsp;on&nbsp;this&nbsp;case,&nbsp;it&amp;#39;s&nbsp;better&nbsp;to&nbsp;limit&nbsp;the&nbsp;maximum&nbsp;size&nbsp;of&nbsp;buf_size&nbsp;since&nbsp;it&amp;#39;s&nbsp;value&nbsp;is&nbsp;outside&nbsp;mono&amp;#39;s&nbsp;control.<br>
&lt;br&gt;&lt;br&gt;-&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_free&nbsp;(utf8_src);&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_free&nbsp;(utf8_dest);&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;close&nbsp;(src_fd);&lt;br&gt;-&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;close&nbsp;(dest_fd);&lt;br&gt;-&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_free&nbsp;(utf8_replacedFileName);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_free&nbsp;(utf8_replacementFileName);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;g_free&nbsp;(utf8_backupFileName);<br>
&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;close&nbsp;(backup_fd);&lt;br&gt;+&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&lt;br&gt;Notice&nbsp;here&nbsp;that&nbsp;you&amp;#39;re&nbsp;introducing&nbsp;some&nbsp;redudant&nbsp;whitespaces&nbsp;in&nbsp;the&nbsp;empty&nbsp;lines,&nbsp;this&nbsp;should&nbsp;be&nbsp;avoided&nbsp;as&nbsp;it&nbsp;make&nbsp;patches&nbsp;hard&nbsp;to&nbsp;read&nbsp;due&nbsp;to&nbsp;increased&nbsp;noise.&lt;br&gt;&lt;br&gt;Besides&nbsp;that,&nbsp;I&nbsp;have&nbsp;a&nbsp;question.&nbsp;Wouldn&amp;#39;t&nbsp;be&nbsp;possible&nbsp;to&nbsp;use&nbsp;sendfile&nbsp;for&nbsp;unix&nbsp;systems?&nbsp;Senfile&nbsp;skip&nbsp;copying&nbsp;data&nbsp;to&nbsp;user&nbsp;space&nbsp;and&nbsp;should&nbsp;be&nbsp;a&nbsp;lot&nbsp;faster&nbsp;than&nbsp;using&nbsp;read/write.<br>
&lt;br&gt;&lt;br&gt;Cheers!&lt;br&gt;Rodrigo&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;8/15/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Bill&nbsp;Holmes&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:billholmes54@gmail.com&quot;&gt;billholmes54@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Attached&nbsp;is&nbsp;a&nbsp;patch&nbsp;that&nbsp;implements&nbsp;the&nbsp;2.0&nbsp;method&nbsp;File.IO.File.Replace.&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://msdn2.microsoft.com/en-us/library/9etk7xw2.aspx&quot;&gt;http://msdn2.microsoft.com/en-us/library/9etk7xw2.aspx&lt;/a&gt;&lt;br&gt;&lt;br&gt;Some&nbsp;implementation&nbsp;details&nbsp;are&nbsp;as&nbsp;follows.<br>
&lt;br&gt;-An&nbsp;internal&nbsp;call&nbsp;was&nbsp;added&nbsp;to&nbsp;perform&nbsp;this&nbsp;operation&lt;br&gt;-Most&nbsp;argument&nbsp;validation&nbsp;is&nbsp;performed&nbsp;in&nbsp;managed&nbsp;code.&lt;br&gt;-On&nbsp;windows&nbsp;we&nbsp;call&nbsp;ReplaceFile&nbsp;defined&nbsp;in&nbsp;Kernel32&lt;br&gt;-On&nbsp;!windows&nbsp;Replace&nbsp;file&nbsp;was&nbsp;implemented&nbsp;in&nbsp;io-layer/io.c<br>
&lt;br&gt;&lt;br&gt;*file-io.c:&nbsp;Added&nbsp;ves_icall_System_IO_MonoIO_ReplaceFile&nbsp;to&nbsp;call&lt;br&gt;ReplaceFile&nbsp;Kernel32&nbsp;on&nbsp;windows&nbsp;or&nbsp;in&nbsp;io-layer.&lt;br&gt;*file-io.h:&nbsp;Added&nbsp;deceleration&nbsp;for&nbsp;ves_icall_System_IO_MonoIO_ReplaceFile&lt;br&gt;*icall-def.h:&nbsp;Register&nbsp;ves_icall_System_IO_MonoIO_ReplaceFile&nbsp;as&nbsp;an<br>
&lt;br&gt;internal&nbsp;call.&lt;br&gt;*io.c:&nbsp;Added&nbsp;implementation&nbsp;for&nbsp;ReplaceFile.&lt;br&gt;*io.h:&nbsp;Added&nbsp;deceleration&nbsp;for&nbsp;ReplaceFile&nbsp;method.&lt;br&gt;*File.cs:&amp;nbsp;&amp;nbsp;Add&nbsp;implementation&nbsp;for&nbsp;IO.File.Replace&nbsp;methods.&lt;br&gt;*MonoIO.cs:&nbsp;Declared&nbsp;an&nbsp;internal&nbsp;call&nbsp;for&nbsp;ReplaceFile<br>
&lt;br&gt;*FileTest.cs:&amp;nbsp;&amp;nbsp;Added&nbsp;a&nbsp;test&nbsp;for&nbsp;IO.File.Replace.&lt;br&gt;&lt;br&gt;This&nbsp;may&nbsp;be&nbsp;less&nbsp;of&nbsp;a&nbsp;patch&nbsp;request&nbsp;and&nbsp;more&nbsp;of&nbsp;a&nbsp;&amp;quot;Tell&nbsp;me&nbsp;what&nbsp;I&nbsp;did&lt;br&gt;wrong.&amp;quot;&amp;nbsp;&amp;nbsp;;)&lt;br&gt;&lt;br&gt;-bill&lt;br&gt;&lt;br&gt;_______________________________________________<br>
&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list<br>
&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
