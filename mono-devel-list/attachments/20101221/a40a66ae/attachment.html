<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Dec&nbsp;16,&nbsp;2010&nbsp;at&nbsp;4:28&nbsp;AM,&nbsp;Virgile&nbsp;Bello&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:virgile.bello@gmail.com&quot;&gt;virgile.bello@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&gt;I&nbsp;was&nbsp;wondering&nbsp;a&nbsp;few&nbsp;things&nbsp;concerning&nbsp;Mono.Taskets:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1/&nbsp;By&nbsp;modifying&nbsp;mono&nbsp;to&nbsp;not&nbsp;throw&nbsp;an&nbsp;exception&nbsp;when&nbsp;marking&nbsp;top-most&nbsp;frame&nbsp;a&nbsp;second&nbsp;time&nbsp;(using&nbsp;Mono.Continuation.Mark),&nbsp;I&nbsp;figured&nbsp;more&nbsp;behavior&nbsp;could&nbsp;be&nbsp;covered.&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;an&nbsp;example,&nbsp;let&amp;#39;s&nbsp;say&nbsp;I&nbsp;Mark&nbsp;and&nbsp;Store&nbsp;in&nbsp;the&nbsp;following&nbsp;stack&nbsp;frame:&lt;/div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;C2()&nbsp;-&amp;gt;&nbsp;Here&nbsp;I&nbsp;Store(0)&lt;/div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;C1()&nbsp;-&amp;gt;&nbsp;Here&nbsp;I&nbsp;Mark&lt;/div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;A2()&lt;/div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;A1()&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Next&nbsp;run,&nbsp;I&nbsp;could&nbsp;run&nbsp;B1&nbsp;again&nbsp;from&nbsp;a&nbsp;different&nbsp;stack&nbsp;to&nbsp;restore&nbsp;B2:&lt;/div&gt;&lt;div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;C2()&nbsp;-&amp;gt;&nbsp;Here&nbsp;I&nbsp;Store(0)&lt;/div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;C1()&nbsp;-&amp;gt;&nbsp;Here&nbsp;I&nbsp;Mark&nbsp;_again_&nbsp;to&nbsp;update&nbsp;current&nbsp;stack&nbsp;topmost&nbsp;frame,&nbsp;and&nbsp;then&nbsp;Restore(0)&nbsp;which&nbsp;will&nbsp;add&nbsp;C2&nbsp;on&nbsp;top&nbsp;of&nbsp;new&nbsp;stack&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;==&nbsp;Stack&nbsp;B3()&lt;/div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;B2()&lt;/div&gt;&lt;div&gt;==&nbsp;Stack&nbsp;B1()&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Basically,&nbsp;this&nbsp;enables&nbsp;Continuation&nbsp;to&nbsp;be&nbsp;resumed&nbsp;later&nbsp;in&nbsp;time,&nbsp;even&nbsp;if&nbsp;calling&nbsp;stack&nbsp;frame&nbsp;is&nbsp;different.&lt;/div&gt;&lt;div&gt;As&nbsp;a&nbsp;result,&nbsp;MicroThread&nbsp;Scheduler&nbsp;could&nbsp;be&nbsp;rewritten&nbsp;so&nbsp;that&nbsp;it&nbsp;runs&nbsp;in&nbsp;a&nbsp;&amp;quot;Step()&amp;quot;&nbsp;mode&nbsp;every&nbsp;frame&nbsp;instead&nbsp;of&nbsp;a&nbsp;&amp;quot;Run()&amp;quot;&nbsp;loop&nbsp;(which&nbsp;force&nbsp;to&nbsp;create&nbsp;thread)&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;This&nbsp;could&nbsp;even&nbsp;allow&nbsp;to&nbsp;migrate&nbsp;MicroThread&nbsp;on&nbsp;a&nbsp;different&nbsp;Thread&nbsp;(not&nbsp;tested&nbsp;yet). &lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;So&nbsp;far&nbsp;it&nbsp;seems&nbsp;to&nbsp;work&nbsp;on&nbsp;simple&nbsp;case,&nbsp;can&nbsp;anyone&nbsp;tell&nbsp;me&nbsp;if&nbsp;it&nbsp;could&nbsp;lead&nbsp;to&nbsp;any&nbsp;issues&nbsp;I&nbsp;could&nbsp;not&nbsp;foresee?&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;was&nbsp;especially&nbsp;worried&nbsp;about&nbsp;internal&nbsp;pointer&nbsp;to&nbsp;stack&nbsp;(if&nbsp;there&nbsp;is&nbsp;any)&nbsp;becoming&nbsp;invalid&nbsp;if&nbsp;base&nbsp;ESP&nbsp;gets&nbsp;shifted&nbsp;(but&nbsp;in&nbsp;that&nbsp;case,&nbsp;I&nbsp;could&nbsp;always&nbsp;manage&nbsp;to&nbsp;call&nbsp;this&nbsp;function&nbsp;with&nbsp;the&nbsp;same&nbsp;call&nbsp;stack&nbsp;so&nbsp;ESP&nbsp;would&nbsp;be&nbsp;the&nbsp;same&nbsp;between&nbsp;each&nbsp;&amp;quot;Step()&amp;quot;).&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes,&nbsp;all&nbsp;sort&nbsp;of&nbsp;internal&nbsp;pointers&nbsp;will&nbsp;break&nbsp;with&nbsp;this.&nbsp;This&nbsp;means&nbsp;any&nbsp;call&nbsp;with&nbsp;byref&nbsp;args&nbsp;or&nbsp;with&nbsp;a&nbsp;this&nbsp;vtype&nbsp;will&nbsp;break.&nbsp;Fixing&nbsp;this&nbsp;is&nbsp;not&nbsp;simple&nbsp;at&nbsp;all.&nbsp;Thread&nbsp;migration&nbsp;is&nbsp;also&nbsp;an&nbsp;issue&nbsp;as&nbsp;those&nbsp;frames&nbsp;could&nbsp;have&nbsp;taken&nbsp;a&nbsp;lock&nbsp;and&nbsp;migration&nbsp;would&nbsp;lead&nbsp;to&nbsp;corruption&nbsp;(easy&nbsp;to&nbsp;work&nbsp;around&nbsp;thou).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2/&nbsp;I&nbsp;noticed&nbsp;a&nbsp;bug&nbsp;in continuation_mark_frame&nbsp;that&nbsp;could&nbsp;lead&nbsp;to&nbsp;random&nbsp;crash: &lt;a&nbsp;href=&quot;https://bugzilla.novell.com/show_bug.cgi?id=659827&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugzilla.novell.com/show_bug.cgi?id=659827&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
3/&nbsp;So&nbsp;far&nbsp;it&nbsp;is&nbsp;only&nbsp;available&nbsp;on&nbsp;x86/ia64.&nbsp;Is&nbsp;there&nbsp;anything&nbsp;that&nbsp;would&nbsp;prevent&nbsp;it&nbsp;to&nbsp;work&nbsp;on&nbsp;other&nbsp;platform&nbsp;(esp.&nbsp;ARM/PS3&nbsp;etc...)&nbsp;in&nbsp;the&nbsp;future?&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;No,&nbsp;someone&nbsp;just&nbsp;have&nbsp;to&nbsp;submit&nbsp;code&nbsp;for&nbsp;those&nbsp;targets.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
