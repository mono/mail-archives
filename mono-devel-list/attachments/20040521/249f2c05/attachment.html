<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.2800.1400&quot;&nbsp;name=GENERATOR&gt;<br>
&lt;STYLE&gt;&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;bgColor=#ffffff&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Hi,&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;this&nbsp;is&nbsp;a&nbsp;first&nbsp;of&nbsp;a&nbsp;series&nbsp;of&nbsp;patches&nbsp;for&nbsp;the&nbsp;<br>
string&nbsp;class&nbsp;moving&nbsp;it&nbsp;to&nbsp;managed&nbsp;code.&nbsp;Why?&nbsp;Because&nbsp;it&nbsp;is&nbsp;faster&nbsp;than&nbsp;<br>
native!&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;------------------&amp;nbsp;&nbsp;Believe&nbsp;in&nbsp;managed&nbsp;code!&nbsp;<br>
;)&nbsp;&amp;nbsp;-------------------------&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Here&nbsp;are&nbsp;some&nbsp;microbenchmark&nbsp;results&nbsp;for&nbsp;the&nbsp;change&nbsp;<br>
(I&nbsp;think&nbsp;I&nbsp;made&nbsp;literally&nbsp;thousands&nbsp;of&nbsp;runs):&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;(002)&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;chars&nbsp;tested&nbsp;with,&nbsp;first&nbsp;<br>
value&nbsp;is&nbsp;old&nbsp;time&nbsp;in&nbsp;ms,&nbsp;second&nbsp;value&nbsp;is&nbsp;time&nbsp;after&nbsp;change&nbsp;in&nbsp;ms.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;CopyTo&nbsp;(002):&nbsp;7190&nbsp;-&amp;gt;&nbsp;3595&lt;BR&gt;CopyTo&nbsp;(015):&nbsp;7611&nbsp;<br>
-&amp;gt;&nbsp;4446&lt;BR&gt;CopyTo&nbsp;(016):&nbsp;8982&nbsp;-&amp;gt;&nbsp;4486&lt;BR&gt;CopyTo&nbsp;(512):&nbsp;3174&nbsp;-&amp;gt;&nbsp;<br>
2995&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;ToCharArray&nbsp;(000):&nbsp;4727&nbsp;-&amp;gt;&nbsp;4086&lt;BR&gt;ToCharArray&nbsp;<br>
(002):&nbsp;4967&nbsp;-&amp;gt;&nbsp;4556&lt;BR&gt;ToCharArray&nbsp;(015):&nbsp;8041&nbsp;-&amp;gt;&nbsp;7691&lt;BR&gt;ToCharArray&nbsp;<br>
(960):&nbsp;2674&nbsp;-&amp;gt;&nbsp;2673&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;ToCharArray&nbsp;(with&nbsp;parameters):&nbsp;Similar&nbsp;to&nbsp;above&nbsp;<br>
(little&nbsp;bit&nbsp;less)&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Also&nbsp;I&nbsp;believe&nbsp;that&nbsp;we&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;gain&nbsp;<br>
another&nbsp;20%&nbsp;speed&nbsp;increase&nbsp;by&nbsp;further&amp;nbsp;optimizing&nbsp;int-pointer&nbsp;casts&nbsp;and&nbsp;<br>
operations&nbsp;in&nbsp;the&nbsp;JIT/&nbsp;Runtime.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Moreover&nbsp;one&nbsp;of&nbsp;the&nbsp;huge&nbsp;speed&nbsp;hogs&nbsp;is&nbsp;the&nbsp;creation&nbsp;<br>
of&nbsp;a&nbsp;new&nbsp;string&nbsp;object&nbsp;(which&amp;nbsp;still&nbsp;needs&nbsp;an&nbsp;icall).&nbsp;If&nbsp;somebody&nbsp;would&nbsp;come&nbsp;<br>
up&nbsp;with&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;optimize&nbsp;this&nbsp;this&nbsp;would&nbsp;give&nbsp;us&nbsp;another&nbsp;serious&nbsp;speed&nbsp;<br>
gain&nbsp;for&nbsp;the&nbsp;string&nbsp;class.&nbsp;By&nbsp;the&nbsp;way:&nbsp;Does&nbsp;anybody&nbsp;know&nbsp;if&nbsp;creating&nbsp;a&nbsp;new&nbsp;<br>
string&nbsp;object&nbsp;in&nbsp;native&nbsp;using&nbsp;InternalAllocateStr&nbsp;initializes&nbsp;the&nbsp;allocated&nbsp;<br>
memory&nbsp;to&nbsp;0&nbsp;values?&nbsp;Because&nbsp;it&nbsp;doesn't&nbsp;need&nbsp;to.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I'm&nbsp;hoping&nbsp;for&nbsp;feedback&nbsp;on&nbsp;the&nbsp;<br>
patch...&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Andreas&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
