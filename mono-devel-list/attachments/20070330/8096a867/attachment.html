<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;finally&nbsp;managed&nbsp;to&nbsp;get&nbsp;heap-buddy&nbsp;working&nbsp;on&nbsp;my&nbsp;mac,&nbsp;it&nbsp;took&nbsp;a&nbsp;while,&nbsp;but&nbsp;i&nbsp;got&nbsp;there&nbsp;;)&nbsp;After&nbsp;testing&nbsp;monotorrent&nbsp;for&nbsp;a&nbsp;while&nbsp;with&nbsp;the&nbsp;debugger&nbsp;enabled,&nbsp;nothing&nbsp;happened.&nbsp;Then&nbsp;i&nbsp;realised&nbsp;i&nbsp;wasn&amp;#39;t&nbsp;using&nbsp;mono&nbsp;<br>
1.2.3.&nbsp;A&nbsp;few&nbsp;minutes&nbsp;later&nbsp;i&nbsp;fired&nbsp;up&nbsp;monotorrent&nbsp;using&nbsp;mono&nbsp;1.2.3&nbsp;and&nbsp;within&nbsp;seconds&nbsp;had&nbsp;runaway&nbsp;memory&nbsp;usage.&nbsp;Here&amp;#39;s&nbsp;the&nbsp;stats,&nbsp;maybe&nbsp;they&amp;#39;ll&nbsp;make&nbsp;sense&nbsp;to&nbsp;someone,&nbsp;or&nbsp;fire&nbsp;alarm&nbsp;bells&nbsp;for&nbsp;someone&nbsp;else:&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>
I&nbsp;attached&nbsp;the&nbsp;seperate&nbsp;HeapBuddy&nbsp;reports&nbsp;to&nbsp;the&nbsp;email.&lt;br&gt;&lt;br&gt;Alan.&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;3/29/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Joe&nbsp;Shaw&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:joe@ximian.com&quot;&gt;joe@ximian.com&lt;/a&gt;&amp;gt;&nbsp;wrote:<br>
&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Hi&nbsp;Alan,&lt;br&gt;&lt;br&gt;On&nbsp;3/29/07,&nbsp;Alan&nbsp;McGovern&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:alan.mcgovern@gmail.com&quot;&gt;<br>
alan.mcgovern@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;So,&nbsp;the&nbsp;thing&nbsp;is&nbsp;i&nbsp;can&amp;#39;t&nbsp;track&nbsp;down&nbsp;what&amp;#39;s&nbsp;causing&nbsp;the&nbsp;memory&nbsp;usage&nbsp;in&lt;br&gt;&amp;gt;&nbsp;monotorrent.&nbsp;I&nbsp;have&nbsp;no&nbsp;idea&nbsp;how&nbsp;to&nbsp;even&nbsp;start.&nbsp;I&amp;#39;ve&nbsp;tried&nbsp;using&nbsp;the&nbsp;built&nbsp;in&lt;br&gt;&amp;gt;&nbsp;profilers,&nbsp;but&nbsp;they&nbsp;require&nbsp;a&nbsp;graceful&nbsp;exit&nbsp;before&nbsp;they&nbsp;output&nbsp;their&nbsp;data,<br>
&lt;br&gt;&amp;gt;&nbsp;and&nbsp;unfortunately&nbsp;i&nbsp;can&amp;#39;t&nbsp;get&nbsp;them&nbsp;a&nbsp;graceful&nbsp;exit&nbsp;;)&lt;br&gt;&lt;br&gt;I&nbsp;would&nbsp;use&nbsp;the&nbsp;two&nbsp;external&nbsp;memory&nbsp;profilers&nbsp;for&nbsp;this:&nbsp;heap-buddy&nbsp;and&lt;br&gt;heap-shot.&amp;nbsp;&amp;nbsp;Both&nbsp;are&nbsp;available&nbsp;from&nbsp;Mono&nbsp;SVN&nbsp;and&nbsp;straightforward&nbsp;to&lt;br&gt;build&nbsp;and&nbsp;use.<br>
&lt;br&gt;&lt;br&gt;heap-buddy&nbsp;is&nbsp;a&nbsp;summarizing&nbsp;profiler.&amp;nbsp;&amp;nbsp;It&nbsp;collects&nbsp;allocation&lt;br&gt;statistics&nbsp;while&nbsp;the&nbsp;program&nbsp;is&nbsp;running&nbsp;and&nbsp;writes&nbsp;out&nbsp;the&nbsp;aggregate&lt;br&gt;info&nbsp;to&nbsp;a&nbsp;file&nbsp;which&nbsp;you&nbsp;analyze&nbsp;with&nbsp;a&nbsp;command-line&nbsp;tool&nbsp;after&nbsp;it&amp;#39;s&lt;br&gt;<br>
finished&nbsp;running.&amp;nbsp;&amp;nbsp;It&nbsp;is&nbsp;robust&nbsp;against&nbsp;your&nbsp;app&nbsp;exiting&nbsp;ungracefully.&lt;br&gt;:)&lt;br&gt;&lt;br&gt;The&nbsp;tool&nbsp;has&nbsp;4&nbsp;basic&nbsp;modes:&nbsp;summary,&nbsp;history,&nbsp;types&nbsp;and&nbsp;backtraces.&lt;br&gt;&lt;br&gt;Summary&nbsp;gives&nbsp;you&nbsp;high-level&nbsp;info:&nbsp;how&nbsp;many&nbsp;objects/bytes&nbsp;were<br>
&lt;br&gt;allocated,&nbsp;the&nbsp;final&nbsp;size&nbsp;of&nbsp;the&nbsp;heap,&nbsp;the&nbsp;number&nbsp;of&nbsp;GCs,&nbsp;etc.&lt;br&gt;History&nbsp;gives&nbsp;you&nbsp;a&nbsp;timeline&nbsp;of&nbsp;each&nbsp;heap&nbsp;resize&nbsp;and&nbsp;GC,&nbsp;telling&nbsp;you&lt;br&gt;the&nbsp;sizes&nbsp;of&nbsp;the&nbsp;heap,&nbsp;the&nbsp;number&nbsp;of&nbsp;objects&nbsp;and&nbsp;their&nbsp;size,&nbsp;and&nbsp;how&lt;br&gt;it&nbsp;changed&nbsp;over&nbsp;time.&amp;nbsp;&amp;nbsp;You&nbsp;can&nbsp;see,&nbsp;for&nbsp;instance,&nbsp;that&nbsp;if&nbsp;your&nbsp;heap<br>
&lt;br&gt;resizes&nbsp;5&nbsp;times&nbsp;in&nbsp;a&nbsp;row&nbsp;without&nbsp;a&nbsp;GC&nbsp;all&nbsp;within&nbsp;2&nbsp;seconds&nbsp;that&nbsp;you&lt;br&gt;have&nbsp;a&nbsp;run&nbsp;away&nbsp;allocation&nbsp;pattern.&nbsp;:)&lt;br&gt;&lt;br&gt;Types&nbsp;will&nbsp;show&nbsp;you&nbsp;all&nbsp;the&nbsp;value&nbsp;types&nbsp;that&nbsp;have&nbsp;been&nbsp;created,&nbsp;how&lt;br&gt;many&nbsp;total&nbsp;instances,&nbsp;the&nbsp;total&nbsp;bytes,&nbsp;the&nbsp;average&nbsp;size&nbsp;of&nbsp;one<br>
&lt;br&gt;instance,&nbsp;and&nbsp;the&nbsp;average&nbsp;age&nbsp;(ie,&nbsp;the&nbsp;number&nbsp;of&nbsp;GCs)&nbsp;it&nbsp;lived&nbsp;for.&lt;br&gt;If&nbsp;you&amp;#39;re&nbsp;dealing&nbsp;with&nbsp;runaway&nbsp;memory,&nbsp;this&nbsp;will&nbsp;tell&nbsp;you&nbsp;what&nbsp;it&nbsp;is.&lt;br&gt;The&nbsp;average&nbsp;age&nbsp;is&nbsp;good&nbsp;for&nbsp;finding&nbsp;memory&nbsp;leaks.&lt;br&gt;&lt;br&gt;Backtraces&nbsp;is&nbsp;like&nbsp;types,&nbsp;except&nbsp;it&amp;#39;s&nbsp;more&nbsp;granular.&amp;nbsp;&amp;nbsp;It&nbsp;shows&nbsp;you&nbsp;the<br>
&lt;br&gt;same&nbsp;info&nbsp;as&nbsp;types,&nbsp;but&nbsp;it&nbsp;breaks&nbsp;the&nbsp;types&nbsp;up&nbsp;by&nbsp;the&nbsp;call&nbsp;trace&nbsp;that&lt;br&gt;allocated&nbsp;them.&amp;nbsp;&amp;nbsp;This&nbsp;is&nbsp;good&nbsp;when&nbsp;you&amp;#39;re&nbsp;trying&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;is&lt;br&gt;allocating&nbsp;all&nbsp;those&nbsp;damn&nbsp;strings.&nbsp;:)&lt;br&gt;&lt;br&gt;The&nbsp;other&nbsp;tool&nbsp;is&nbsp;heap-shot,&nbsp;which&nbsp;is&nbsp;a&nbsp;snapshotting&nbsp;profiler.&amp;nbsp;&amp;nbsp;When<br>
&lt;br&gt;you&nbsp;use&nbsp;it,&nbsp;you&nbsp;send&nbsp;SIGPROF&nbsp;to&nbsp;your&nbsp;running&nbsp;process&nbsp;which&nbsp;causes&nbsp;a&lt;br&gt;file&nbsp;to&nbsp;be&nbsp;written&nbsp;out&nbsp;with&nbsp;all&nbsp;the&nbsp;information&nbsp;about&nbsp;allocations&nbsp;at&lt;br&gt;that&nbsp;point.&amp;nbsp;&amp;nbsp;Afterward&nbsp;you&nbsp;can&nbsp;use&nbsp;the&nbsp;GUI&nbsp;to&nbsp;see&nbsp;where&nbsp;all&nbsp;the&nbsp;memory&lt;br&gt;<br>
has&nbsp;gone.&lt;br&gt;&lt;br&gt;The&nbsp;basic&nbsp;display&nbsp;mode&nbsp;shows&nbsp;you&nbsp;all&nbsp;the&nbsp;types,&nbsp;along&nbsp;with&nbsp;the&nbsp;number&lt;br&gt;of&nbsp;instances&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;these&nbsp;use.&amp;nbsp;&amp;nbsp;This&nbsp;is&nbsp;pretty&lt;br&gt;similar&nbsp;to&nbsp;heap-buddy&amp;#39;s&nbsp;types&nbsp;mode,&nbsp;except&nbsp;that&nbsp;it&nbsp;shows&nbsp;you&nbsp;the&nbsp;info<br>
&lt;br&gt;for&nbsp;a&nbsp;snapshot&nbsp;in&nbsp;time,&nbsp;rather&nbsp;than&nbsp;the&nbsp;aggregate&nbsp;over&nbsp;the&nbsp;whole&nbsp;run&lt;br&gt;of&nbsp;the&nbsp;program.&lt;br&gt;&lt;br&gt;The&nbsp;beauty&nbsp;of&nbsp;this&nbsp;tool&nbsp;is&nbsp;in&nbsp;the&nbsp;&amp;quot;Reverse&nbsp;references&amp;quot;&nbsp;mode,&nbsp;which&lt;br&gt;tells&nbsp;you&nbsp;what&nbsp;objects&nbsp;hold&nbsp;references&nbsp;to&nbsp;a&nbsp;given&nbsp;type.&amp;nbsp;&amp;nbsp;So,&nbsp;if&nbsp;you<br>
&lt;br&gt;reverse&nbsp;the&nbsp;references&nbsp;for&nbsp;&amp;quot;string&amp;quot;,&nbsp;you&nbsp;might&nbsp;see&nbsp;that&nbsp;100&nbsp;instances&lt;br&gt;of&nbsp;&amp;quot;string&amp;quot;&nbsp;are&nbsp;being&nbsp;referenced&nbsp;by&nbsp;50&nbsp;instances&nbsp;of&lt;br&gt;System.IO.FileInfo,&nbsp;and&nbsp;are&nbsp;using&nbsp;2k&nbsp;of&nbsp;memory.&amp;nbsp;&amp;nbsp;As&nbsp;you&nbsp;drill&nbsp;down,&lt;br&gt;<br>
you&nbsp;might&nbsp;see&nbsp;reference&nbsp;leaks&nbsp;(like&nbsp;those&nbsp;damned&nbsp;static&nbsp;ArrayLists&nbsp;and&lt;br&gt;Hashtables)&nbsp;that&nbsp;continually&nbsp;grow&nbsp;without&nbsp;bound.&amp;nbsp;&amp;nbsp;These&nbsp;two&nbsp;tools&lt;br&gt;(especially&nbsp;heap-shot)&nbsp;have&nbsp;helped&nbsp;us&nbsp;reduce&nbsp;memory&nbsp;usage&nbsp;in&nbsp;Beagle&lt;br&gt;tremendously.<br>
&lt;br&gt;&lt;br&gt;I&amp;#39;ve&nbsp;blogged&nbsp;about&nbsp;both&nbsp;tools&nbsp;in&nbsp;the&nbsp;past&nbsp;(mostly&nbsp;heap-buddy).&amp;nbsp;&amp;nbsp;You&lt;br&gt;can&nbsp;search&nbsp;for&nbsp;them&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://joeshaw.org&quot;&gt;http://joeshaw.org&lt;/a&gt;.&amp;nbsp;&amp;nbsp;Lluis&nbsp;wrote&nbsp;heap-shot&nbsp;and&lt;br&gt;has&nbsp;blogged&nbsp;about&nbsp;it&nbsp;as&nbsp;well.&lt;br&gt;<br>
&lt;br&gt;Good&nbsp;luck,&lt;br&gt;Joe&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
