<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;face=&quot;Corbel&quot;&gt;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;have&nbsp;found&nbsp;a&nbsp;potential&nbsp;issue&nbsp;with&nbsp;NetworkStream&nbsp;on&nbsp;ARM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Raspberry).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;might&nbsp;be&nbsp;a&nbsp;stupid&nbsp;bug&nbsp;on&nbsp;my&nbsp;code&nbsp;too,&nbsp;but&nbsp;I&nbsp;don't&nbsp;see&nbsp;it.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;short:&nbsp;a&nbsp;simple&nbsp;multi-threaded&nbsp;server&nbsp;running&nbsp;on&nbsp;Raspberry<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(same&nbsp;behavior&nbsp;on&nbsp;Mono&nbsp;4.4.0&nbsp;as&nbsp;Mono&nbsp;4.6.0),&nbsp;client&nbsp;on&nbsp;W10:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;&lt;b&gt;Fails&lt;/b&gt;&nbsp;to&nbsp;correctly&nbsp;send&nbsp;data&nbsp;using&nbsp;NetworkStream<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(server&nbsp;seems&nbsp;to&nbsp;send&nbsp;the&nbsp;data,&nbsp;but&nbsp;it&nbsp;never&nbsp;arrives&nbsp;to&nbsp;client).<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master/Program.cs&quot;&gt;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master/Program.cs&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.1.&nbsp;&lt;b&gt;Fails&lt;/b&gt;&nbsp;*only*&nbsp;using&nbsp;NetworkStream&nbsp;(no&nbsp;BufferedStream<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;BinaryReader/Writer&nbsp;around,&nbsp;and&nbsp;it&nbsp;still&nbsp;fails):<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-only-network-stream/Program.cs&quot;&gt;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-only-network-stream/Program.cs&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Works&nbsp;correctly&nbsp;using&nbsp;Sockets&nbsp;(no&nbsp;streams&nbsp;on&nbsp;top).<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-use-socket-only/Program.cs&quot;&gt;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-use-socket-only/Program.cs&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;Works&nbsp;correctly&nbsp;using&nbsp;a&nbsp;custom&nbsp;NetworkStream:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1. <br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-use-alternative-network-stream/Program.cs&quot;&gt;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-use-alternative-network-stream/Program.cs&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2. <br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-use-alternative-network-stream/MyNetworkStream.cs&quot;&gt;https://github.com/psantosl/mono-raspberry-socket-issue/blob/master-use-alternative-network-stream/MyNetworkStream.cs&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.3.&nbsp;Although&nbsp;I&nbsp;just&nbsp;saw&nbsp;it&nbsp;timing&nbsp;out&nbsp;after&nbsp;transferring&nbsp;several<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hundred&nbsp;MB&nbsp;on&nbsp;each&nbsp;connection&nbsp;(I'm&nbsp;on&nbsp;a&nbsp;slow&nbsp;VPN&nbsp;connected&nbsp;to&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Raspberry,&nbsp;although&nbsp;we&nbsp;reproduced&nbsp;it&nbsp;on&nbsp;LAN&nbsp;too).&nbsp;Interestingly,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;the&nbsp;regular&nbsp;NetworkStream&nbsp;it&nbsp;fails&nbsp;inmediately.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;When&nbsp;it&nbsp;fails,&nbsp;what&nbsp;happens&nbsp;is&nbsp;that&nbsp;at&nbsp;a&nbsp;given&nbsp;point&nbsp;in&nbsp;time&nbsp;(in<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;tests&nbsp;like&nbsp;in&nbsp;a&nbsp;few&nbsp;seconds)&nbsp;one&nbsp;of&nbsp;the&nbsp;client&nbsp;threads&nbsp;(or&nbsp;more<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;than&nbsp;one)&nbsp;NEVER&nbsp;exits&nbsp;the&nbsp;Read,&nbsp;data&nbsp;never&nbsp;arrives&nbsp;although&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;log&nbsp;says&nbsp;the&nbsp;data&nbsp;was&nbsp;written,&nbsp;but&nbsp;it&nbsp;doesn't.&nbsp;Since&nbsp;I've<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;a&nbsp;timeout&nbsp;for&nbsp;the&nbsp;read&nbsp;operation,&nbsp;you&nbsp;see&nbsp;how&nbsp;the&nbsp;program<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stops&nbsp;working.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;==&nbsp;Addi&lt;/b&gt;&lt;b&gt;tional&nbsp;tests&nbsp;performed&nbsp;==&lt;/b&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;tried&nbsp;with&nbsp;different&nbsp;buffer&nbsp;sizes,&nbsp;it&nbsp;always&nbsp;fails&nbsp;with&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NetworkStream.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;ran&nbsp;the&nbsp;same&nbsp;server&nbsp;code&nbsp;on&nbsp;other&nbsp;setups:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Window&nbsp;10/.NET:&nbsp;&lt;b&gt;OK&lt;/b&gt;.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;OpenSuse&nbsp;13.2&nbsp;+&nbsp;mono&nbsp;4.0.4&nbsp;(Stable&nbsp;4.0.4.1/5ab4c0d):&nbsp;&lt;b&gt;OK&lt;/b&gt;.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Raspberry:&nbsp;failed&nbsp;both&nbsp;with&nbsp;mono&nbsp;4.4.0&nbsp;and&nbsp;mono-4.6.0.245&nbsp;(built<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;GitHub&nbsp;on&nbsp;the&nbsp;746756c&nbsp;commit.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;originally&nbsp;discovered&nbsp;the&nbsp;issue&nbsp;running&nbsp;a&nbsp;Plastic&nbsp;SCM&nbsp;server&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://www.bananapi.org/&quot;&gt;BananaPi&lt;/a&gt;&nbsp;(like&nbsp;a&nbsp;Raspberry<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;SATA).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;==&nbsp;Extra&nbsp;notes&nbsp;==&lt;/b&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;I&nbsp;know&nbsp;the&nbsp;multi-threaded&nbsp;server&nbsp;is&nbsp;not&nbsp;optimal&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread-per-connection&nbsp;is&nbsp;really&nbsp;bad,&nbsp;this&nbsp;is&nbsp;just&nbsp;a&nbsp;test&nbsp;case.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Initially&nbsp;I&nbsp;thought&nbsp;we&nbsp;had&nbsp;an&nbsp;issue&nbsp;with&nbsp;async&nbsp;sockets,&nbsp;but<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after&nbsp;a&nbsp;few&nbsp;days&nbsp;I&nbsp;just&nbsp;isolated&nbsp;the&nbsp;problem&nbsp;in&nbsp;NetworkStream.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Any&nbsp;hints&nbsp;would&nbsp;be&nbsp;appreciated.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pablo&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;http://www.plasticscm.com&quot;&gt;www.plasticscm.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
