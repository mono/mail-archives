<tt>
&lt;DIV&gt;I&nbsp;have&nbsp;rewritten&nbsp;CalcPrime()&nbsp;in&nbsp;the&nbsp;mcs\class\corlib\System.Collections\Hashtable.cs&nbsp;to&nbsp;fix&nbsp;several&nbsp;bugs&nbsp;(ie&nbsp;15&nbsp;was&nbsp;shown&nbsp;as&nbsp;a&nbsp;prime&nbsp;and&nbsp;the&nbsp;result&nbsp;was&nbsp;sometimes&nbsp;below&nbsp;the&nbsp;original&nbsp;value)&amp;nbsp;&nbsp;The&nbsp;speed&nbsp;has&nbsp;been&nbsp;improved&nbsp;almost&nbsp;4.5&nbsp;times&nbsp;according&nbsp;to&nbsp;the&nbsp;30&nbsp;second&nbsp;tests,&nbsp;by&nbsp;skipping&nbsp;numbers&nbsp;divisible&nbsp;by&nbsp;2&nbsp;and&nbsp;3.&nbsp;There&nbsp;is&nbsp;some&nbsp;bits&nbsp;magic,&nbsp;but&nbsp;code&nbsp;is,&nbsp;hopefully,&nbsp;clear&nbsp;/&nbsp;enough&nbsp;commented.&nbsp;TestPrime()&nbsp;is&nbsp;no&nbsp;longer&nbsp;needed&nbsp;and&nbsp;should&nbsp;be&nbsp;removed.&lt;BR&gt;&lt;BR&gt;Also,&nbsp;there&nbsp;is&nbsp;a&nbsp;hardcoded&nbsp;prime&nbsp;number's&nbsp;table&nbsp;being&nbsp;used&nbsp;in&nbsp;ToPrime(),&nbsp;which&nbsp;waistes&nbsp;lots&nbsp;of&nbsp;resources&nbsp;(IMHO)&nbsp;because&nbsp;it&nbsp;skips&nbsp;most&nbsp;of&nbsp;the&nbsp;primes&nbsp;and&nbsp;new&nbsp;hash&nbsp;tables&nbsp;become&nbsp;overbloated.&nbsp;Why&nbsp;not&nbsp;use&nbsp;the&nbsp;Mono.Math.BigInteger.smallPrimes[]&nbsp;instead?&nbsp;Wouldn’t&nbsp;that&nbsp;be&nbsp;closer&nbsp;to&nbsp;the&nbsp;spec?&nbsp;Although,&nbsp;i&nbsp;am&nbsp;not&nbsp;sure&nbsp;about&nbsp;dependencies&nbsp;because&nbsp;the&nbsp;Hashtable&nbsp;is&nbsp;in&nbsp;the&nbsp;corlib,&nbsp;whereas&nbsp;BigInteger&nbsp;might&nbsp;not&nbsp;be.&nbsp;&lt;BR&gt;&lt;BR&gt;One&nbsp;last&nbsp;question&nbsp;--&nbsp;why&nbsp;does&nbsp;HashTable&nbsp;uses&nbsp;int&nbsp;for&nbsp;capacity?&nbsp;Isn't&nbsp;uint&nbsp;more&nbsp;appropriate?&nbsp;Why&nbsp;did&nbsp;MS&nbsp;chose&nbsp;to&nbsp;use&nbsp;int&nbsp;everywhere?<br>
&nbsp;Sometime&nbsp;in&nbsp;the&nbsp;future&nbsp;we&nbsp;will&nbsp;have&nbsp;LOTS&nbsp;of&nbsp;ram,&nbsp;enough&nbsp;to&nbsp;have&nbsp;over&nbsp;2&nbsp;billion&nbsp;elements...&nbsp;:-)&nbsp;In&nbsp;any&nbsp;case,&nbsp;i&nbsp;wounder&nbsp;if&nbsp;signed&nbsp;or&nbsp;unsigned&nbsp;shift&nbsp;operations&nbsp;are&nbsp;faster?&nbsp;Compiler&nbsp;might&nbsp;be&nbsp;adding&nbsp;some&nbsp;extra&nbsp;&quot;&amp;amp;&quot;&nbsp;masks.&nbsp;&lt;BR&gt;&lt;BR&gt;///&nbsp;&amp;lt;sumary&amp;gt;&lt;BR&gt;///&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Written&nbsp;by&nbsp;Yuri&nbsp;Astrakhan&nbsp;(&nbsp;wuzika(-AT-)yahoo(-DOT-)com&nbsp;)&nbsp;for&nbsp;Mono&nbsp;Project&lt;BR&gt;///&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Calculates&nbsp;the&nbsp;first&nbsp;prime&nbsp;number&nbsp;more&nbsp;or&nbsp;equal&nbsp;to&nbsp;x.&lt;BR&gt;///&nbsp;The&nbsp;algorithm&nbsp;tests&nbsp;all&nbsp;numbers&nbsp;that&nbsp;are&nbsp;*NOT*&nbsp;divisable&nbsp;by&nbsp;2&nbsp;and&nbsp;3,&lt;BR&gt;///&nbsp;starting&nbsp;from&nbsp;x&nbsp;(or&nbsp;x+1&nbsp;if&nbsp;even&nbsp;x).&lt;BR&gt;///&nbsp;1&nbsp;is&nbsp;the&nbsp;smallest&nbsp;return&nbsp;value,&nbsp;2&nbsp;and&nbsp;3&nbsp;are&nbsp;always&nbsp;skipped&nbsp;(5&nbsp;is&nbsp;returned&nbsp;next)&lt;BR&gt;///&nbsp;The&nbsp;test&nbsp;is&nbsp;done&nbsp;by&nbsp;the&nbsp;similar&nbsp;algorithm&nbsp;--&nbsp;dividing&nbsp;generated&lt;BR&gt;///&nbsp;number&nbsp;(testVal)&nbsp;by&nbsp;every&nbsp;possible&nbsp;value&nbsp;up&nbsp;to&nbsp;the&nbsp;sqrt(testVal),&lt;BR&gt;///&nbsp;excluding&nbsp;those&nbsp;divisable&nbsp;by&nbsp;2&nbsp;and&nbsp;3.&lt;BR&gt;///&nbsp;Everything&nbsp;is&nbsp;done&nbsp;inside&nbsp;a&nbsp;single&nbsp;function&nbsp;to&nbsp;avoid&nbsp;tons&nbsp;of&nbsp;function&nbsp;calls.&lt;BR&gt;///&nbsp;The&nbsp;local&nbsp;variables&nbsp;adder&nbsp;&amp;amp;&nbsp;divAdder&nbsp;are&nbsp;used&nbsp;to&nbsp;increment<br>
&nbsp;values.&lt;BR&gt;///&nbsp;&amp;lt;/sumary&amp;gt;&lt;BR&gt;private&nbsp;static&nbsp;int&nbsp;CalcPrime(int&nbsp;x)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;start&nbsp;with&nbsp;an&nbsp;odd&nbsp;number&nbsp;(either&nbsp;x&nbsp;or&nbsp;x+1)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;testVal&nbsp;=&nbsp;(x&nbsp;|&nbsp;1);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;make&nbsp;sure&nbsp;testVal&nbsp;is&nbsp;not&nbsp;divisible&nbsp;by&nbsp;3&nbsp;(incr&nbsp;by&nbsp;2&nbsp;if&nbsp;needed)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if(&nbsp;(testVal&nbsp;%&nbsp;3)&nbsp;==&nbsp;0&nbsp;)&nbsp;testVal+=2;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;adder&nbsp;can&nbsp;be&nbsp;either&nbsp;be&nbsp;0&nbsp;or&nbsp;1&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;adder&nbsp;=&nbsp;(2-(testVal&nbsp;%&nbsp;3));&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;Since&nbsp;int.MaxValue&nbsp;(2147483647)&nbsp;is&nbsp;a&nbsp;prime,&nbsp;no&nbsp;need&nbsp;to&nbsp;test&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;ATTENTION!&amp;nbsp;&nbsp;If&nbsp;you&nbsp;change&nbsp;int&nbsp;to&nbsp;some&nbsp;other&nbsp;type&nbsp;(not&nbsp;32bit&nbsp;signed),&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;this&nbsp;code&nbsp;might&nbsp;give&nbsp;a&nbsp;wrong&nbsp;result&nbsp;for&nbsp;x&nbsp;approaching&nbsp;maxValue.&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;some&nbsp;test&nbsp;will&nbsp;be&nbsp;needed&nbsp;here:&amp;nbsp;&amp;nbsp;&nbsp;if(&nbsp;testVal&nbsp;&amp;gt;&nbsp;maxPrime&nbsp;)&nbsp;return&nbsp;testVal;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while(&nbsp;true&nbsp;)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;maxDiv&nbsp;=&nbsp;(int)&nbsp;Math.Sqrt(&nbsp;testVal&nbsp;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;div&nbsp;=&nbsp;5;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;2,3,and&nbsp;4&nbsp;are&nbsp;already&nbsp;elliminated&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;divAdder&nbsp;=&nbsp;0;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;for&nbsp;div==5,&nbsp;((div+2)&nbsp;%&nbsp;3)&nbsp;!=&nbsp;0&amp;nbsp;&nbsp;thus&nbsp;next&nbsp;time&nbsp;add&nbsp;2&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;Try&nbsp;to&nbsp;divide&nbsp;testVal&nbsp;by&nbsp;all&nbsp;possible&nbsp;divisors&nbsp;(div)&nbsp;excluding&nbsp;2&nbsp;and&nbsp;3&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;while(&nbsp;div&nbsp;&amp;lt;=&nbsp;maxDiv&nbsp;)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if(&nbsp;(testVal&nbsp;%&nbsp;div)&nbsp;==&nbsp;0&nbsp;)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;nope,&nbsp;number&nbsp;testVal&nbsp;is&nbsp;not&nbsp;prime&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;move&nbsp;on&nbsp;to&nbsp;the&nbsp;next&nbsp;testVal&nbsp;by&nbsp;adding&nbsp;2&nbsp;if&nbsp;the&nbsp;result&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;is&nbsp;not&nbsp;divisible&nbsp;by&nbsp;3,&nbsp;otherwise&nbsp;add&nbsp;4&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;testVal&nbsp;+=&nbsp;(2&nbsp;&amp;lt;&amp;lt;<br>
&nbsp;adder);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;adder&nbsp;^=&nbsp;1;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;break;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;try&nbsp;next&nbsp;divisor&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;div&nbsp;+=&nbsp;(2&nbsp;&amp;lt;&amp;lt;&nbsp;divAdder);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;divAdder&nbsp;^=&nbsp;1;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//&nbsp;check&nbsp;if&nbsp;while()&nbsp;exited&nbsp;without&nbsp;&quot;break&quot;&nbsp;-&nbsp;if&nbsp;no&nbsp;divisor&nbsp;was&nbsp;found&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if(&nbsp;div&nbsp;&amp;gt;&nbsp;maxDiv&nbsp;)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;testVal;&nbsp;//&nbsp;we&nbsp;have&nbsp;the&nbsp;winner&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;BR&gt;}&lt;BR&gt;&lt;/DIV&gt;&lt;p&gt;&lt;hr&nbsp;SIZE=1&gt;<br>
Do&nbsp;you&nbsp;Yahoo!?&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://us.rd.yahoo.com/evt=10469/*http://sitebuilder.yahoo.com&quot;&gt;Yahoo!&nbsp;SiteBuilder&lt;/a&gt;&nbsp;-&nbsp;Free,&nbsp;easy-to-use&nbsp;web&nbsp;site&nbsp;design&nbsp;software
</tt>
