<tt>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Dan,&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;As&nbsp;I&nbsp;am&nbsp;currently&nbsp;working&nbsp;on&nbsp;the&nbsp;Process&nbsp;class,&nbsp;I&nbsp;am&nbsp;getting&nbsp;a&nbsp;look&nbsp;at&nbsp;your&nbsp;bug.&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;Does&nbsp;settingÂ &nbsp;StandardOutputEncoding&nbsp;=&nbsp;Console.OutputEncoding&nbsp;on&nbsp;the&nbsp;ProcessStartInfo&nbsp;passed&nbsp;to&nbsp;Start&nbsp;fixes&nbsp;your&nbsp;issue?&nbsp;This&nbsp;is&nbsp;the&nbsp;behaviour&nbsp;on&nbsp;.NET,&nbsp;so&nbsp;this&nbsp;is&nbsp;the&nbsp;behaviour&nbsp;that&nbsp;we&nbsp;are&nbsp;going&nbsp;to&nbsp;adopt&nbsp;(at&nbsp;least&nbsp;for&nbsp;bug&nbsp;compatibility).&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;Thank&nbsp;you!&nbsp;:)&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;Ludovic&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;----------&nbsp;Forwarded&nbsp;message&nbsp;---------&lt;br&gt;From:&nbsp;Dan&nbsp;Liew&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dan@su-root.co.uk&quot;&gt;dan@su-root.co.uk&lt;/a&gt;&gt;&lt;br&gt;Date:&nbsp;Fri,&nbsp;9&nbsp;Oct&nbsp;2015,&nbsp;14:40&lt;br&gt;Subject:&nbsp;[Mono-dev]&nbsp;System.Diagnostics.Process&nbsp;behaves&nbsp;differently&nbsp;in&nbsp;and&nbsp;outside&nbsp;of&nbsp;a&nbsp;NUnit&nbsp;test&nbsp;case&lt;br&gt;To:&nbsp;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:mono-devel-list@lists.ximian.com&quot;&gt;mono-devel-list@lists.ximian.com&lt;/a&gt;&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;an&nbsp;issue&nbsp;that&nbsp;I&nbsp;was&nbsp;bitten&nbsp;by&nbsp;a&nbsp;while&nbsp;ago&nbsp;but&nbsp;I&nbsp;didn&#39;t&nbsp;post&lt;br&gt;<br>
here&nbsp;because&nbsp;I&nbsp;managed&nbsp;to&nbsp;work&nbsp;around&nbsp;it&nbsp;but&nbsp;it&nbsp;looks&nbsp;like&nbsp;something&lt;br&gt;<br>
inside&nbsp;mono&nbsp;changed&nbsp;between&nbsp;3.12&nbsp;and&nbsp;4.0.4&nbsp;which&nbsp;my&nbsp;broke&nbsp;my&lt;br&gt;<br>
workaround.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;issue&nbsp;basically&nbsp;is&nbsp;I&nbsp;observed&nbsp;my&nbsp;code&nbsp;failing&nbsp;when&nbsp;called&nbsp;from&nbsp;an&lt;br&gt;<br>
NUnit&nbsp;test&nbsp;but&nbsp;when&nbsp;run&nbsp;from&nbsp;an&nbsp;executable&nbsp;it&nbsp;would&nbsp;work&nbsp;fine.&nbsp;The&lt;br&gt;<br>
code&nbsp;in&nbsp;question&nbsp;[1]&nbsp;calls&nbsp;out&nbsp;to&nbsp;an&nbsp;external&nbsp;process&nbsp;using&lt;br&gt;<br>
``System.Diagnostics.Process``&nbsp;where&nbsp;the&nbsp;standard&nbsp;input&nbsp;is&nbsp;redirected.&lt;br&gt;<br>
When&nbsp;running&nbsp;from&nbsp;an&nbsp;NUnit&nbsp;test&nbsp;a&nbsp;UTF-8&nbsp;BOM&nbsp;gets&nbsp;sent&nbsp;to&nbsp;the&nbsp;process&#39;s&lt;br&gt;<br>
standard&nbsp;input&nbsp;and&nbsp;when&nbsp;running&nbsp;from&nbsp;an&nbsp;executable&nbsp;the&nbsp;UTF-8&nbsp;BOM&nbsp;does&lt;br&gt;<br>
not&nbsp;get&nbsp;sent.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;looked&nbsp;at&nbsp;this&nbsp;again&nbsp;and&nbsp;I&#39;ve&nbsp;noticed&nbsp;two&nbsp;things&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;In&nbsp;System.Diagnostics.Process.Start_noshell()&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&lt;br&gt;<br>
writable&nbsp;end&nbsp;of&nbsp;the&nbsp;pipe&nbsp;connected&nbsp;to&nbsp;the&nbsp;child&nbsp;process&#39;s&nbsp;standard&lt;br&gt;<br>
input&nbsp;is&nbsp;taken&nbsp;from&nbsp;``Console.Out.Encoding``.&nbsp;Is&nbsp;this&nbsp;really&nbsp;a&nbsp;good&lt;br&gt;<br>
idea?&nbsp;Depending&nbsp;on&nbsp;this&nbsp;global&nbsp;value&nbsp;seems&nbsp;like&nbsp;a&nbsp;bad&nbsp;idea&nbsp;and&nbsp;could&lt;br&gt;<br>
introduce&nbsp;weird&nbsp;race&nbsp;conditions&nbsp;if&nbsp;the&nbsp;Console.Out&nbsp;encoding&nbsp;is&nbsp;changed&lt;br&gt;<br>
in&nbsp;some&nbsp;way&nbsp;(e.g.&nbsp;``Console.OutputEncoding&nbsp;=&nbsp;new&lt;br&gt;<br>
System.Text.UTF8Encoding(false);``&nbsp;seems&nbsp;to&nbsp;do&nbsp;this&nbsp;and&nbsp;this&nbsp;the&nbsp;new&lt;br&gt;<br>
workaround&nbsp;I&nbsp;ended&nbsp;up&nbsp;using)&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;When&nbsp;running&nbsp;in&nbsp;an&nbsp;executable&nbsp;the&nbsp;value&nbsp;of&lt;br&gt;<br>
``Console.Out.Encoding.emitUTF8Identifier``&nbsp;is&nbsp;false&nbsp;but&nbsp;when&nbsp;running&lt;br&gt;<br>
in&nbsp;an&nbsp;NUnit&nbsp;test&nbsp;the&nbsp;value&nbsp;of&lt;br&gt;<br>
````Console.Out.Encoding.emitUTF8Identifier``&nbsp;is&nbsp;true!&lt;br&gt;<br>
I&#39;m&nbsp;not&nbsp;sure&nbsp;if&nbsp;this&nbsp;is&nbsp;Mono&#39;s&nbsp;or&nbsp;NUnit&#39;s&nbsp;fault&nbsp;but&nbsp;this&nbsp;seems&nbsp;very&nbsp;wrong&nbsp;to&nbsp;me.&lt;br&gt;<br>
&lt;br&gt;<br>
I&#39;ve&nbsp;filled&nbsp;a&nbsp;bug&nbsp;at&nbsp;[2]&nbsp;and&nbsp;[3]&nbsp;but&nbsp;thought&nbsp;I&#39;d&nbsp;post&nbsp;about&nbsp;it&nbsp;here&lt;br&gt;<br>
too&nbsp;as&nbsp;this&nbsp;issue&nbsp;seems&nbsp;partially&nbsp;tied&nbsp;to&nbsp;some&nbsp;of&nbsp;mono&#39;s&nbsp;internal&lt;br&gt;<br>
implementation&nbsp;details.&lt;br&gt;<br>
&lt;br&gt;<br>
[1]&nbsp;&lt;a&nbsp;href=&quot;https://bugzilla.xamarin.com/attachment.cgi?id=13247&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugzilla.xamarin.com/attachment.cgi?id=13247&lt;/a&gt;&lt;br&gt;<br>
[2]&nbsp;&lt;a&nbsp;href=&quot;https://bugzilla.xamarin.com/show_bug.cgi?id=21374&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugzilla.xamarin.com/show_bug.cgi?id=21374&lt;/a&gt;&lt;br&gt;<br>
[3]&nbsp;&lt;a&nbsp;href=&quot;https://github.com/nunit/nunit/issues/881&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/nunit/nunit/issues/881&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Dan.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
