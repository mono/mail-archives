<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hey,&lt;br&gt;&lt;br&gt;With&nbsp;the&nbsp;recent&nbsp;talk&nbsp;on&nbsp;GetHashCode(),&nbsp;I&nbsp;was&nbsp;just&nbsp;taking&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;code.&nbsp;I&nbsp;decided&nbsp;to&nbsp;try&nbsp;my&nbsp;hand&nbsp;at&nbsp;seeing&nbsp;what&nbsp;would&nbsp;happen&nbsp;performancewise&nbsp;if&nbsp;i&nbsp;made&nbsp;the&nbsp;function&nbsp;work&nbsp;with&nbsp;an&nbsp;int*&nbsp;as&nbsp;opposed&nbsp;to&nbsp;char*.&nbsp;Turns&nbsp;out&nbsp;i&nbsp;ended&nbsp;up&nbsp;with&nbsp;something&nbsp;which&nbsp;was&nbsp;50%&nbsp;slower,&nbsp;but&nbsp;also&nbsp;had&nbsp;50%&nbsp;less&nbsp;collisions&nbsp;on&nbsp;a&nbsp;rather&nbsp;large&nbsp;english&nbsp;dictionary&nbsp;dataset&nbsp;(17mb&nbsp;of&nbsp;words,&nbsp;probably&nbsp;a&nbsp;few&nbsp;dupes).&lt;br&gt;<br>
&lt;br&gt;Just&nbsp;in&nbsp;case&nbsp;it&amp;#39;s&nbsp;of&nbsp;any&nbsp;use,&nbsp;i&amp;#39;ve&nbsp;attached&nbsp;it&nbsp;here,&nbsp;though&nbsp;i&amp;#39;d&nbsp;say&nbsp;there&nbsp;are&nbsp;much&nbsp;better&nbsp;ones&nbsp;out&nbsp;there.&nbsp;This&nbsp;was&nbsp;purely&nbsp;accidental&nbsp;;)&lt;br&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;unsafe&nbsp;static&nbsp;int&nbsp;GetHashCode(string&nbsp;s)&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;h&nbsp;=&nbsp;0;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;rem&nbsp;=&nbsp;s.Length&nbsp;&amp;amp;&nbsp;3;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;fixed&nbsp;(char*&nbsp;c&nbsp;=&nbsp;s)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int*&nbsp;start&nbsp;=&nbsp;(int*)c;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int*&nbsp;end&nbsp;=&nbsp;start&nbsp;+&nbsp;s.Length&nbsp;-&nbsp;rem;&lt;br&gt;<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(int*&nbsp;i&nbsp;=&nbsp;end;&nbsp;i&nbsp;&amp;gt;=&nbsp;start;&nbsp;i--)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;h&nbsp;=&nbsp;(h&nbsp;&amp;lt;&amp;lt;&nbsp;5)&nbsp;-&nbsp;h&nbsp;+&nbsp;*i;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;char*&nbsp;cc&nbsp;=&nbsp;c&nbsp;+&nbsp;s.Length&nbsp;-&nbsp;rem;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;(char*&nbsp;i&nbsp;=&nbsp;cc&nbsp;+&nbsp;rem;&nbsp;i&nbsp;&amp;gt;=&nbsp;cc;&nbsp;i--)&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;h&nbsp;=&nbsp;(h&nbsp;&amp;lt;&amp;lt;&nbsp;5)&nbsp;-&nbsp;h&nbsp;+&nbsp;*i;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;h;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jul&nbsp;21,&nbsp;2008&nbsp;at&nbsp;12:33&nbsp;PM,&nbsp;Marek&nbsp;Safar&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:marek.safar@seznam.cz&quot;&gt;marek.safar@seznam.cz&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Hello&nbsp;Andreas,&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&amp;gt;&nbsp;Imho&nbsp;we&nbsp;should&nbsp;revert&nbsp;the&nbsp;change,&nbsp;especially&nbsp;as&nbsp;MS&nbsp;seems&nbsp;to&nbsp;also&nbsp;have&nbsp;an&lt;br&gt;<br>
&amp;gt;&nbsp;implementation&nbsp;with&nbsp;low&nbsp;collisions&nbsp;(and&nbsp;in&nbsp;fact&nbsp;this&nbsp;will&nbsp;be&nbsp;what&nbsp;people&nbsp;are&lt;br&gt;<br>
&amp;gt;&nbsp;expecting&nbsp;from&nbsp;a&nbsp;hashcode&nbsp;without&nbsp;any&nbsp;further&nbsp;explanation)&nbsp;we&nbsp;should&nbsp;do&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;same.&nbsp;Otherwise&nbsp;this&nbsp;might&nbsp;drive&nbsp;some&nbsp;implementations&nbsp;into&nbsp;huge&nbsp;perf&lt;br&gt;<br>
&amp;gt;&nbsp;problems.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;/div&gt;I&nbsp;reverted&nbsp;my&nbsp;changes&nbsp;for&nbsp;now&nbsp;to&nbsp;produce&nbsp;same&nbsp;bad/good&nbsp;results.&nbsp;However,&lt;br&gt;<br>
I&nbsp;tried&nbsp;to&nbsp;port&nbsp;another&nbsp;implementation&nbsp;which&nbsp;seems&nbsp;to&nbsp;produce&nbsp;much&nbsp;more&lt;br&gt;<br>
better&nbsp;results&nbsp;for&nbsp;both&nbsp;scenarios&nbsp;but&nbsp;it&nbsp;still&nbsp;needs&nbsp;more&nbsp;testing.&nbsp;I&amp;#39;ll&lt;br&gt;<br>
send&nbsp;a&nbsp;patch&nbsp;for&nbsp;review&nbsp;when&nbsp;I&nbsp;am&nbsp;done.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Marek&lt;br&gt;<br>
&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
