<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;<br>
&lt;div&gt;Jonathan:&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp;Sorry&nbsp;for&nbsp;the&nbsp;delay&nbsp;in&nbsp;my&nbsp;response;&nbsp;first&nbsp;off,&nbsp;the&nbsp;test&nbsp;application&nbsp;I&nbsp;wrote&nbsp;was&nbsp;buggy&nbsp;and&nbsp;lied&nbsp;about&nbsp;how&nbsp;much&nbsp;memory&nbsp;was&nbsp;being&nbsp;allocated.&nbsp; &nbsp;I&nbsp;had&nbsp;to&nbsp;rewrite&nbsp;it.&nbsp; It&nbsp;now&nbsp;clearly&nbsp;can&nbsp;not&nbsp;allocate&nbsp;arrays&nbsp;larger&nbsp;than&nbsp;2GB,&nbsp;though&nbsp;I&nbsp;have&nbsp;yet&nbsp;to&nbsp;pin&nbsp;down&nbsp;the&nbsp;exact&nbsp;amounts,&nbsp;as&nbsp;it&nbsp;seems&nbsp;that&nbsp;my&nbsp;test&nbsp;program&nbsp;gives&nbsp;me&nbsp;numbers&nbsp;that&nbsp;are&nbsp;different,&nbsp;depending&nbsp;on&nbsp;which&nbsp;C#&nbsp;compiler&nbsp;I&nbsp;use&nbsp;(csc&nbsp;or&nbsp;mcs)&nbsp;and&nbsp;the&nbsp;CLR&nbsp;in&nbsp;use&nbsp;under&nbsp;XP64.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp;I'll&nbsp;get&nbsp;down&nbsp;to&nbsp;the&nbsp;bottom&nbsp;of&nbsp;this&nbsp;and&nbsp;reply&nbsp;later.&nbsp;  &lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;--Luis&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Sep&nbsp;3,&nbsp;2007,&nbsp;at&nbsp;5:26&nbsp;PM,&nbsp;Jonathan&nbsp;Chambers&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hello,&lt;br&gt;&lt;br&gt;I&nbsp;don't&nbsp;have&nbsp;an&nbsp;answer&nbsp;to&nbsp;your&nbsp;problem,&nbsp;but&nbsp;I&nbsp;did&nbsp;have&nbsp;another&nbsp;question.&nbsp;I&nbsp;can't&nbsp;find&nbsp;a&nbsp;link&nbsp;to&nbsp;the&nbsp;documentation&nbsp;in&nbsp;msdn,&nbsp;but&nbsp;I&nbsp;thought&nbsp;arrays&nbsp;were&nbsp;limited&nbsp;to&nbsp;2&nbsp;GB&nbsp;in&nbsp;the&nbsp;.Net&nbsp;runtime&nbsp;(even&nbsp;on&nbsp;64-bit).&nbsp;Do&nbsp;you&nbsp;not&nbsp;see&nbsp;this&nbsp;behavior?&nbsp;&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://blogs.msdn.com/joshwil/archive/2005/08/10/450202.aspx&quot;&gt;http://blogs.msdn.com/joshwil/archive/2005/08/10/450202.aspx&lt;/a&gt;&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Jonathan&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;9/3/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;&nbsp;Luis&nbsp;F.&nbsp;Ortiz&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:LuisOrtiz@verizon.net&quot;&gt;LuisOrtiz@verizon.net&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&nbsp;Folks:&lt;br&gt;&lt;br&gt;I&nbsp;was&nbsp;porting&nbsp;a&nbsp;small&nbsp;test&nbsp;application&nbsp;that&nbsp;was&nbsp;written&nbsp;in&nbsp;C#&nbsp;that&lt;br&gt;allocated&lt;br&gt;an&nbsp;array&nbsp;with&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;elements&nbsp;(&amp;gt;&nbsp;2^32).  While&nbsp;it&lt;br&gt;compiled&nbsp;and&nbsp;ran&lt;br&gt;in&nbsp;Visual&nbsp;Studio's&nbsp;C#&nbsp;under&nbsp;WindowsXP-64bit&nbsp;without&nbsp;a&nbsp;hitch,&nbsp;when&nbsp;I&nbsp;&lt;br&gt;compiled&lt;br&gt;and&nbsp;ran&nbsp;it&nbsp;under&nbsp;mcs/mono&nbsp;(1.2.4)&nbsp;on&nbsp;the&nbsp;same&nbsp;hardware,&nbsp;but&nbsp;booted&nbsp;up&lt;br&gt;under&lt;br&gt;Fedora7-x86_64,&nbsp;I&nbsp;ran&nbsp;into&nbsp;a&nbsp;few&nbsp;problems.&lt;br&gt;&lt;br&gt;Digging&nbsp;into&nbsp;it&nbsp;a&nbsp;bit,&nbsp;I&nbsp;discovered&nbsp;that:&lt;br&gt;&lt;br&gt;1)  MCS&nbsp;assumed&nbsp;that&nbsp;the&nbsp;arguments&nbsp;to&nbsp;NEWARR&nbsp;were&nbsp;always&nbsp;U4&nbsp;or&nbsp;I4,&nbsp;&lt;br&gt;which&nbsp;does&nbsp;not&nbsp;seem&lt;br&gt;    &nbsp;to&nbsp;be&nbsp;the&nbsp;case&nbsp;as&nbsp;far&nbsp;as&nbsp;ECMA-335v4.&lt;br&gt;2)  MONO&nbsp;assumes&nbsp;that&nbsp;array&nbsp;lengths&nbsp;and&nbsp;bounds&nbsp;can&nbsp;always&nbsp;be&lt;br&gt;represented&nbsp;as&nbsp;guint32's,&lt;br&gt;    &nbsp;[&nbsp;like&nbsp;mono_array_new_specific&nbsp;(MonoVTable&nbsp;*vtable,&nbsp;guint32&nbsp;n)&nbsp;]&nbsp;&lt;br&gt;&lt;br&gt;&lt;br&gt;Would&nbsp;folks&nbsp;object&nbsp;to&nbsp;a&nbsp;series&nbsp;of&nbsp;patches&nbsp;to:&lt;br&gt;&lt;br&gt;A)  Fix&nbsp;mcs/expression.cs&nbsp;to&nbsp;emit&nbsp;OpCodes.Conv_Ovf_U/I&nbsp;instead&nbsp;of&lt;br&gt;OpCodes.Conv_Ovf_U4/I4&lt;br&gt;    &nbsp;for&nbsp;array&nbsp;size&nbsp;arguments,&lt;br&gt;B)  Modify&nbsp;mono/metadata/object.h&nbsp;to&nbsp;change&nbsp;the&nbsp;base&nbsp;type&nbsp;for&nbsp;array&nbsp;&lt;br&gt;lengths/bounds&nbsp;to&lt;br&gt;    &nbsp;XXX&nbsp;instead&nbsp;of&nbsp;guint32,&lt;br&gt;C)  Change&nbsp;mono/metadata/object.c&nbsp;to&nbsp;change&nbsp;the&nbsp;functions&nbsp;that&nbsp;create/&lt;br&gt;access&nbsp;arrays&nbsp;to&lt;br&gt;    &nbsp;take&nbsp;XXX&nbsp;instead&nbsp;of&nbsp;guint32&nbsp;length/bounds&nbsp;arguments.  Also&lt;br&gt;perhaps&nbsp;update&nbsp;some&nbsp;of&nbsp;&lt;br&gt;    &nbsp;the&nbsp;lower&nbsp;level&nbsp;object&nbsp;allocation&nbsp;functions&nbsp;to&nbsp;use&nbsp;XXX&nbsp;as&nbsp;needed.&lt;br&gt;D)  Modify&nbsp;the&nbsp;execution&nbsp;of&nbsp;NEWARR&nbsp;be&nbsp;able&nbsp;to&nbsp;deal&nbsp;with&nbsp;I/U&nbsp;native&lt;br&gt;types.  No&nbsp;doubt&nbsp;something&lt;br&gt;    &nbsp;in&nbsp;the&nbsp;JIT&nbsp;needs&nbsp;tweaking&nbsp;as&nbsp;well.&lt;br&gt;&nbsp;E)  Double&nbsp;check&nbsp;that&nbsp;array&nbsp;indexing&nbsp;not&nbsp;only&nbsp;takes&nbsp;native&nbsp;int&nbsp;types,&lt;br&gt;but&nbsp;uses&nbsp;them&nbsp;right.&lt;br&gt;F)  Add&nbsp;a&nbsp;few&nbsp;new&nbsp;test&nbsp;cases&nbsp;for&nbsp;large&nbsp;array&nbsp;allocation.&lt;br&gt;G)  Whatever&nbsp;else&nbsp;needs&nbsp;to&nbsp;be&nbsp;done&nbsp;that&nbsp;I'll&nbsp;bump&nbsp;into&nbsp;after&nbsp;I&nbsp;try&nbsp;&lt;br&gt;making&nbsp;the&nbsp;above&nbsp;changes&lt;br&gt;    &nbsp;and&nbsp;realize&nbsp;what&nbsp;I&nbsp;forgot.  Warnings&nbsp;of&nbsp;known&nbsp;hazards&nbsp;gratefully&lt;br&gt;accepted.&lt;br&gt;&lt;br&gt;My&nbsp;big&nbsp;question&nbsp;is&nbsp;what&nbsp;the&nbsp;right&nbsp;type&nbsp;for&nbsp;the&nbsp;size&nbsp;ought&nbsp;to&nbsp;be?&lt;br&gt;I've&nbsp;seen&nbsp;int,&nbsp;size_t,&nbsp;gsize,&nbsp;&lt;br&gt;and&nbsp;guint32&nbsp;used&nbsp;in&nbsp;Mono.  I&nbsp;suspect&nbsp;that&nbsp;int&nbsp;and&nbsp;guint32&nbsp;are&nbsp;wrong&lt;br&gt;from&nbsp;a&nbsp;portability&nbsp;perspective,&lt;br&gt;but&nbsp;would&nbsp;prefer&nbsp;that&nbsp;someone&nbsp;more&nbsp;intimately&nbsp;involved&nbsp;with&nbsp;Mono&nbsp;to&lt;br&gt;say&nbsp;if&nbsp;guint&nbsp;or&nbsp;gsize&nbsp;or&nbsp;size_t&lt;br&gt;were&nbsp;preferred.&nbsp;I'm&nbsp;guessing&nbsp;Bug&nbsp;81774&nbsp;is&nbsp;related&nbsp;to&nbsp;this&nbsp;as&nbsp;well.&nbsp;&lt;br&gt;&lt;br&gt;BTW,&nbsp;is&nbsp;this&nbsp;too&nbsp;big&nbsp;for&nbsp;a&nbsp;newby&nbsp;to&nbsp;tackle?&lt;br&gt;&lt;br&gt;--Luis&nbsp;F.&nbsp;Ortiz&lt;br&gt;Follower&nbsp;of&nbsp;the&nbsp;&quot;Selfish&nbsp;Way&quot;&lt;br&gt;_______________________________________________&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;&nbsp;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
