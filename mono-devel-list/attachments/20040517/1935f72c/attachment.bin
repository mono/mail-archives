? .hidden
? cmov.patch
? curpatch.patch
? min-max.patch
? roarr.patch
? t.cs
Index: mini.c
===================================================================
RCS file: /cvs/public/mono/mono/mini/mini.c,v
retrieving revision 1.236
diff -u -r1.236 mini.c
--- mini.c	14 May 2004 22:05:06 -0000	1.236
+++ mini.c	17 May 2004 20:30:27 -0000
@@ -2384,6 +2384,11 @@
 {
 	int pc, op;
 	MonoInst *ins;
+	
+	static MonoClass *runtime_helpers_class = NULL;
+	if (! runtime_helpers_class)
+		runtime_helpers_class = mono_class_from_name (mono_defaults.corlib,
+			"System.Runtime.CompilerServices", "RuntimeHelpers");
 
 	if (cmethod->klass == mono_defaults.string_class) {
  		if (cmethod->name [0] != 'g')
@@ -2405,6 +2410,12 @@
 		else if (strcmp (cmethod->name, "get_Length") == 0)
 			op = CEE_LDLEN;
 		else
+			return NULL;
+	} else if (cmethod->klass == runtime_helpers_class) {
+		if (strcmp (cmethod->name, "get_OffsetToStringData") == 0) {
+			NEW_ICONST (cfg, ins, G_STRUCT_OFFSET (MonoString, chars));
+			return ins;
+		} else
 			return NULL;
 	} else {
 		op = mono_arch_get_opcode_for_method (cfg, cmethod, fsig, args);
