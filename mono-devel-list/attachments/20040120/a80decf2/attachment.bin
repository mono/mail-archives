? .cvsignore
? Npgsql.patch
Index: Npgsql/NpgsqlConnection.cs
===================================================================
RCS file: /cvs/public/mcs/class/Npgsql/Npgsql/NpgsqlConnection.cs,v
retrieving revision 1.10
diff -u -b -r1.10 NpgsqlConnection.cs
--- Npgsql/NpgsqlConnection.cs	17 Jan 2004 17:39:10 -0000	1.10
+++ Npgsql/NpgsqlConnection.cs	20 Jan 2004 11:19:24 -0000
@@ -375,6 +375,7 @@
                 
                 if (!Connector.IsInitialized)
                 {
+                    Connector.BackendProtocolVersion = ProtocolVersion.Version3;
                     
                     // Reset state to initialize new connector in pool.
                     CurrentState = NpgsqlClosedState.Instance;
@@ -398,6 +399,7 @@
                             _mediator.Reset();
                             CurrentState = NpgsqlClosedState.Instance;
                             BackendProtocolVersion = ProtocolVersion.Version2;
+                            Connector.BackendProtocolVersion = ProtocolVersion.Version2;
                             CurrentState.Open(this);
                         }
     
@@ -431,7 +433,10 @@
                     
                     Connector.ServerVersion = _serverVersion;
                     
+                } else {
+                        BackendProtocolVersion = Connector.BackendProtocolVersion;
                 }
+
                 //NpgsqlCommand commandEncoding = new NpgsqlCommand("show client_encoding", this);
                 //String serverEncoding = (String)commandEncoding.ExecuteScalar();
 
Index: Npgsql/NpgsqlConnector.cs
===================================================================
RCS file: /cvs/public/mcs/class/Npgsql/Npgsql/NpgsqlConnector.cs,v
retrieving revision 1.4
diff -u -b -r1.4 NpgsqlConnector.cs
--- Npgsql/NpgsqlConnector.cs	17 Jan 2004 17:39:10 -0000	1.4
+++ Npgsql/NpgsqlConnector.cs	20 Jan 2004 11:19:24 -0000
@@ -64,6 +64,8 @@
         internal Connector Next;
         internal Connector Prev;
 
+        internal int BackendProtocolVersion;
+            
         /// <value>Controls the pooling of the connector.</value>
         /// <remarks>It this is reset, then the physical connection is
         /// closed and the connector is <b>not</b> added to the
