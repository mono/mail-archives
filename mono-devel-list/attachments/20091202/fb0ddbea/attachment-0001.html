<tt>
&lt;div&gt;The&nbsp;overall&nbsp;patch&nbsp;looks&nbsp;good,&nbsp;but&nbsp;some&nbsp;small&nbsp;changes&nbsp;must&nbsp;be&nbsp;done&nbsp;before&nbsp;the&nbsp;patch&nbsp;can&nbsp;be&nbsp;committed:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Times;&nbsp;font-size:&nbsp;medium;&nbsp;&quot;&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;<br>
@@&nbsp;-1489,8&nbsp;+1489,73&nbsp;@@<br>
&nbsp;}<br>
&nbsp;#endif&nbsp;/*&nbsp;UNUSED_CODE&nbsp;*/<br>
&nbsp;<br>
+#ifdef&nbsp;PLATFORM_MACOSX<br>
+#include&nbsp;&amp;lt;sys/sysctl.h&amp;gt;<br>
+#include&nbsp;&amp;lt;sys/proc.h&amp;gt;<br>
+&lt;/pre&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;Move&nbsp;header&nbsp;declarations&nbsp;to&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;file.&nbsp;It&nbsp;doesn&amp;#39;t&nbsp;matter&nbsp;we&nbsp;have&nbsp;other&lt;/pre&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;place&nbsp;with&nbsp;this,&nbsp;let&amp;#39;s&nbsp;not&nbsp;make&nbsp;it&nbsp;worse.&lt;/pre&gt;<br>
&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Times;&nbsp;white-space:&nbsp;normal;&nbsp;&quot;&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(err&nbsp;==&nbsp;0)&nbsp;{<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspresult&nbsp;=&nbsp;g_malloc&nbsp;(proclength);<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif&nbsp;(result&nbsp;==&nbsp;NULL)&nbsp;{<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsperr&nbsp;=&nbsp;ENOMEM;<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp}&lt;/pre&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;No&nbsp;need&nbsp;to&nbsp;guard&nbsp;against&nbsp;allocation&nbsp;failure&nbsp;with&nbsp;g_malloc&nbsp;as&nbsp;glib&nbsp;asserts&nbsp;on&nbsp;failure.&lt;/pre&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;<br>
The&nbsp;same&nbsp;applies&nbsp;to&nbsp;the&nbsp;loop&nbsp;around&nbsp;allocation&nbsp;failure.&lt;/pre&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Times;&nbsp;white-space:&nbsp;normal;&nbsp;&quot;&gt;&lt;pre&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfree&nbsp;(result);<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspresult&nbsp;=&nbsp;NULL;<br>
+&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*needed&nbsp;=&nbsp;j&nbsp;*&nbsp;sizeof(guint32);<br>
&lt;/pre&gt;&lt;div&gt;You&nbsp;must&nbsp;use&nbsp;g_free&nbsp;paired&nbsp;with&nbsp;g_malloc.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;believe&nbsp;the&nbsp;code&nbsp;in &lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;process_open_compare&nbsp;is&nbsp;not&nbsp;optimal&nbsp;for&nbsp;OSX&nbsp;as&nbsp;it&nbsp;wastes&nbsp;time&nbsp;following&nbsp;the&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;linux&nbsp;path.&nbsp;Please&nbsp;rework&nbsp;it&nbsp;to&nbsp;be&nbsp;something&nbsp;saner:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;monospace;&nbsp;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;monospace&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre-wrap;&quot;&gt;#if&nbsp;defined(PLATFORM_MACOSX)&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;monospace&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre-wrap;&quot;&gt;...&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;monospace&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre-wrap;&quot;&gt;#elif&nbsp;defined&nbsp;(PLATFORM_SOLARIS)&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;#else&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;monospace&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre-wrap;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Times&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;normal;&quot;&gt;Thanks&nbsp;for&nbsp;the&nbsp;patch,&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;monospace&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre-wrap;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Times&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;normal;&quot;&gt;Rodrigo&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;monospace&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre-wrap;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Times&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;white-space:&nbsp;normal;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/span&gt;&lt;/div&gt;<br>

</tt>
