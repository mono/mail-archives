<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Oct&nbsp;20,&nbsp;2009&nbsp;at&nbsp;2:10&nbsp;PM,&nbsp;Erven&nbsp;Rohou&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:erven.rohou@inria.fr&quot;&gt;erven.rohou@inria.fr&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Hello,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;a&nbsp;few&nbsp;questions&nbsp;about&nbsp;inlining:&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;I&nbsp;am&nbsp;curious&nbsp;what&nbsp;the&nbsp;heuristics&nbsp;are.&nbsp;I&nbsp;looked&nbsp;at&nbsp;the&nbsp;function&lt;br&gt;<br>
mono_method_check_inlining,&nbsp;but&nbsp;even&nbsp;when&nbsp;the&nbsp;function&nbsp;returns&nbsp;TRUE,&nbsp;the&lt;br&gt;<br>
function&nbsp;might&nbsp;not&nbsp;be&nbsp;inlined.&nbsp;Could&nbsp;you&nbsp;point&nbsp;me&nbsp;the&nbsp;relevant&nbsp;piece&nbsp;of&nbsp;code?&nbsp;Is&lt;br&gt;<br>
there&nbsp;any&nbsp;high&nbsp;level&nbsp;rule&nbsp;to&nbsp;make&nbsp;a&nbsp;guess,&nbsp;like&nbsp;complex&nbsp;control&nbsp;flow,&nbsp;use&nbsp;of&lt;br&gt;<br>
certain&nbsp;opcode,&nbsp;etc?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;code&nbsp;in mono_method_check_inlining&nbsp;is&nbsp;just&nbsp;an&nbsp;heristics&nbsp;of&nbsp;what&nbsp;methods&nbsp;to&lt;/div&gt;&lt;div&gt;try&nbsp;to&nbsp;inline.&nbsp;The&nbsp;code&nbsp;that&nbsp;decides&nbsp;what&nbsp;gets&nbsp;inlined&nbsp;or&nbsp;not&nbsp;is&nbsp;in&nbsp;mono_method_to_ir,&lt;/div&gt;<br>
&lt;div&gt;look&nbsp;for INLINE_FAILURE&nbsp;calls.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;br&gt;<br>
-&nbsp;Can&nbsp;I&nbsp;force&nbsp;inlining&nbsp;of&nbsp;a&nbsp;given&nbsp;function?&nbsp;Even&nbsp;a&nbsp;hack&nbsp;is&nbsp;fine,&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&lt;br&gt;<br>
evaluate&nbsp;several&nbsp;code&nbsp;generation&nbsp;schemes,&nbsp;and&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;measure&nbsp;the&nbsp;impact&lt;br&gt;<br>
of&nbsp;inlining.&nbsp;Whatever&nbsp;works&nbsp;is&nbsp;fine.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;has&nbsp;been&nbsp;requested&nbsp;a&nbsp;few&nbsp;times,&nbsp;there&nbsp;is&nbsp;a&nbsp;patch&nbsp;floating&nbsp;on&nbsp;the&nbsp;mailing&nbsp;list&lt;/div&gt;&lt;div&gt;that&nbsp;adds&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;code&nbsp;required&nbsp;for&nbsp;such&nbsp;thing.&nbsp;Other&nbsp;than&nbsp;that,&nbsp;no,&nbsp;there&lt;/div&gt;<br>
&lt;div&gt;is&nbsp;not&nbsp;way&nbsp;to&nbsp;force&nbsp;inlining.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;a&nbsp;hack&nbsp;you&nbsp;can&nbsp;simply&nbsp;change&nbsp;the&nbsp;heristics&nbsp;function&nbsp;to&nbsp;check&nbsp;against&nbsp;an&nbsp;env&nbsp;var&lt;/div&gt;&lt;div&gt;and&nbsp;then&nbsp;make&nbsp;the&nbsp;call&nbsp;to inline_method&nbsp;pass&nbsp;true&nbsp;to&nbsp;the&nbsp;last&nbsp;argument.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
It&nbsp;seems&nbsp;that&nbsp;a&nbsp;simple&nbsp;copy&nbsp;propagation&nbsp;followed&nbsp;by&nbsp;dead&nbsp;code&nbsp;elimination&nbsp;would&lt;br&gt;<br>
fix&nbsp;it.&nbsp;But&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;where&nbsp;I&nbsp;should&nbsp;look.&nbsp;Any&nbsp;comment&nbsp;or&nbsp;suggestion?&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;Generating&nbsp;good&nbsp;code&nbsp;without&nbsp;the&nbsp;simd&nbsp;ops&nbsp;enabled&nbsp;was&nbsp;never&nbsp;the&nbsp;idea,&nbsp;but&nbsp;to&nbsp;improve&lt;/div&gt;&lt;div&gt;it&nbsp;I&nbsp;fear&nbsp;we&nbsp;would&nbsp;need&nbsp;a&nbsp;scalar&nbsp;replacement&nbsp;pass,&nbsp;which&nbsp;is&nbsp;very&nbsp;tricky. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;could&nbsp;get&nbsp;most of&nbsp;the&nbsp;same&nbsp;benefit&nbsp;by&nbsp;using&nbsp;high&nbsp;level&nbsp;load/store from&nbsp;vtypes&lt;/div&gt;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;&lt;div&gt;instructions and&nbsp;decompose&nbsp;them&nbsp;later.&nbsp;This&nbsp;would&nbsp;enable&nbsp;us&nbsp;to&nbsp;do&nbsp;apply&nbsp;the&nbsp;usual&lt;/div&gt;&lt;div&gt;<br>
optimizations&nbsp;which&nbsp;right&nbsp;now&nbsp;are&nbsp;not&nbsp;enabled&nbsp;since&nbsp;we&nbsp;generate&nbsp;indirect&nbsp;loads&nbsp;instructions&lt;/div&gt;&lt;div&gt;which&nbsp;disable&nbsp;most&nbsp;optimizations.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
