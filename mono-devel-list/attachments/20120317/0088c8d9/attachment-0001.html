<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Mar&nbsp;17,&nbsp;2012&nbsp;at&nbsp;2:03&nbsp;AM,&nbsp;&lt;a&nbsp;href=&quot;mailto:pablosantosluac@terra.es&quot;&gt;pablosantosluac@terra.es&lt;/a&gt;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:pablosantosluac@terra.es&quot;&gt;pablosantosluac@terra.es&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Ok:&nbsp;the&nbsp;problem&nbsp;is&nbsp;that&nbsp;I&nbsp;was&nbsp;wrapping&nbsp;the&nbsp;NetworkStream&nbsp;with&nbsp;a&lt;br&gt;<br>
BufferedStream,&nbsp;and&nbsp;BufferedStream&nbsp;is&nbsp;not&nbsp;async&nbsp;in&nbsp;Mono,&nbsp;while&nbsp;it&nbsp;is&lt;br&gt;<br>
async&nbsp;in&nbsp;.NET&lt;br&gt;<br>
&lt;br&gt;<br>
:(&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;16/03/2012&nbsp;16:57,&nbsp;&lt;a&nbsp;href=&quot;mailto:pablosantosluac@terra.es&quot;&gt;pablosantosluac@terra.es&lt;/a&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;working&nbsp;on&nbsp;some&nbsp;changes&nbsp;to&nbsp;make&nbsp;the&nbsp;TcpChannel&nbsp;work&nbsp;in&nbsp;async&nbsp;mode.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Instead&nbsp;of&nbsp;changing&nbsp;all&nbsp;the&nbsp;reads&nbsp;and&nbsp;writes&nbsp;to&nbsp;async,&nbsp;I&#39;m&nbsp;just&lt;br&gt;<br>
&gt;&nbsp;modifying&nbsp;the&nbsp;intial&nbsp;message&nbsp;status&nbsp;read&nbsp;to&nbsp;async,&nbsp;so&nbsp;instead&nbsp;of&nbsp;having&lt;br&gt;<br>
&gt;&nbsp;a&nbsp;pile&nbsp;of&nbsp;threads&nbsp;waiting&nbsp;for&nbsp;IO&nbsp;on&nbsp;the&nbsp;server&nbsp;(waiting&nbsp;for&nbsp;clients&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;call&nbsp;or&nbsp;disconnect),&nbsp;there&nbsp;will&nbsp;be&nbsp;only&nbsp;as&nbsp;few&nbsp;threads&nbsp;as&nbsp;running&nbsp;methods.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;works&nbsp;great&nbsp;on&nbsp;Windows&nbsp;even&nbsp;under&nbsp;huge&nbsp;load&nbsp;(I&#39;m&nbsp;testing&nbsp;on&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;100-nodes&nbsp;cluster&nbsp;on&nbsp;EC2).&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;But,&nbsp;now,&nbsp;trying&nbsp;on&nbsp;Linux&nbsp;simply&nbsp;fails&nbsp;because&nbsp;this&nbsp;call:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;networkStream.BeginRead(buffer,&nbsp;0,&nbsp;6,&nbsp;callback,&nbsp;null);&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;where&nbsp;networkStream&nbsp;is&nbsp;System.Net.Sockets.NetworkStream&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;locks.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;it&nbsp;actually&nbsp;does&nbsp;is&nbsp;to&nbsp;block&nbsp;and&nbsp;then&nbsp;invoke&nbsp;the&nbsp;callback,&nbsp;but&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;doesn&#39;t&nbsp;go&nbsp;through&nbsp;until&nbsp;the&nbsp;callback&nbsp;finishes,&nbsp;which&nbsp;I&nbsp;think&nbsp;is&nbsp;not&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;desired&nbsp;behavior.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;running:&lt;br&gt;<br>
&gt;&nbsp;Mono&nbsp;JIT&nbsp;compiler&nbsp;version&nbsp;2.10.2&nbsp;(tarball&nbsp;Mon&nbsp;Apr&nbsp;18&nbsp;15:12:52&nbsp;UTC&nbsp;2011)&lt;br&gt;<br>
&gt;&nbsp;Copyright&nbsp;(C)&nbsp;2002-2011&nbsp;Novell,&nbsp;Inc&nbsp;and&nbsp;Contributors.&nbsp;&lt;a&nbsp;href=&quot;http://www.mono-project.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.mono-project.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;TLS:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;__thread&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;SIGSEGV:&nbsp; &nbsp; &nbsp; &nbsp;altstack&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;Notifications:&nbsp;epoll&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;Architecture:&nbsp; amd64&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;Disabled:&nbsp; &nbsp; &nbsp; none&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;Misc:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; debugger&nbsp;softdebug&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;LLVM:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; yes(2.9svn-mono)&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;GC:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Included&nbsp;Boehm&nbsp;(with&nbsp;typed&nbsp;GC&nbsp;and&nbsp;Parallel&nbsp;Mark)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;fails&nbsp;with&nbsp;older&nbsp;monos&nbsp;too.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Obviously&nbsp;I&#39;m&nbsp;doing&nbsp;something&nbsp;wrong.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;I&nbsp;can&nbsp;fix&nbsp;it?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Thanks,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;pablo&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;Hi..&nbsp;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;post&nbsp;some&nbsp;benchmarks&nbsp;for&nbsp;that&nbsp;once&nbsp;you&nbsp;fixed&nbsp;your&nbsp;bugs. &nbsp;I&nbsp;am&nbsp;interested&nbsp;in&nbsp;using&nbsp;async&nbsp;socket&nbsp;with&nbsp;mono&nbsp;on&nbsp;Linux..thx.&lt;br&gt;<br>

</tt>
