<tt>
Hi,&lt;br&gt;&lt;br&gt;The&nbsp;attached&nbsp;patch&nbsp;optimize&nbsp;the&nbsp;imt&nbsp;thunk&nbsp;code.&nbsp;The&nbsp;optimization&nbsp;is&nbsp;to&nbsp;exploit&nbsp;the&nbsp;fact&nbsp;that&nbsp;IP&nbsp;don&amp;#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;preserved&nbsp;under&nbsp;a&nbsp;particular&nbsp;situation.&lt;br&gt;&lt;br&gt;The&nbsp;magic&nbsp;trampoline&nbsp;needs&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;used&nbsp;by&nbsp;the&nbsp;call&nbsp;site&nbsp;to&nbsp;patch&nbsp;it&nbsp;and&nbsp;this&nbsp;address&nbsp;might&nbsp;be&nbsp;stored&nbsp;in&nbsp;a&nbsp;scratch&nbsp;register,&nbsp;that&amp;#39;s&nbsp;why&nbsp;the&nbsp;IMT&nbsp;code&nbsp;cannot&nbsp;change&nbsp;then.&nbsp;But&nbsp;if&nbsp;the&nbsp;code&nbsp;store&nbsp;the&nbsp;vtable&nbsp;address&nbsp;within&nbsp;the&nbsp;scratch&nbsp;registers,&nbsp;the&nbsp;magic&nbsp;trampoline&nbsp;code&nbsp;won&amp;#39;t&nbsp;notice.&nbsp;This&nbsp;change&nbsp;allow&nbsp;us&nbsp;to&nbsp;branch&nbsp;without&nbsp;the&nbsp;POP&nbsp;hack.<br>
&lt;br&gt;&lt;br&gt;The&nbsp;optimization&nbsp;loads&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;into&nbsp;IP&nbsp;and&nbsp;uses&nbsp;r0&nbsp;and&nbsp;r1&nbsp;to&nbsp;compare&nbsp;values.&nbsp;To&nbsp;call&nbsp;the&nbsp;virtual&nbsp;method,&nbsp;we&nbsp;use&nbsp;&amp;quot;ldr&nbsp;pc,&nbsp;[ip&nbsp;+&nbsp;#]&amp;quot;.&nbsp;These&nbsp;changes&nbsp;reduce&nbsp;the&nbsp;code&nbsp;by&nbsp;3&nbsp;words&nbsp;for&nbsp;each&nbsp;entry.&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;Cheers,&lt;br&gt;Rodrigo&lt;br&gt;<br>

</tt>
