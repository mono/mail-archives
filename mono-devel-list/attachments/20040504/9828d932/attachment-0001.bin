Index: class/ChangeLog
from  Raja R Harinath  <rharinath@novell.com>

	* Makefile (SUBDIRS): Build 'corlib' and first pass of 'System'
	before anything else.  Remove duplicated Novell.Directory.Ldap.

Index: class/Makefile
===================================================================
RCS file: /cvs/public/mcs/class/Makefile,v
retrieving revision 1.19
diff -u -u -r1.19 Makefile
--- class/Makefile 1 May 2004 04:52:56 -0000 1.19
+++ class/Makefile 4 May 2004 09:18:51 -0000
@@ -9,8 +9,8 @@
 endif
 SUBDIRS = \
 	corlib				\
-	I18N				\
 	System				\
+	I18N				\
 	System.XML			\
 	System				\
 	System.Drawing			\
@@ -45,7 +45,6 @@
 	Commons.Xml.Relaxng		\
 	Novell.Directory.Ldap		\
 	Mono.Security.Win32		\
-	Novell.Directory.Ldap		\
 	System.DirectoryServices	\
 	System.Messaging	\
 	System.ServiceProcess \
Index: class/System/ChangeLog
from  Raja R Harinath  <rharinath@novell.com>

	* Makefile (all-local): Built first pass with BOOT_COMPILE.

Index: class/System/Makefile
===================================================================
RCS file: /cvs/public/mcs/class/System/Makefile,v
retrieving revision 1.10
diff -u -u -r1.10 Makefile
--- class/System/Makefile 27 Apr 2004 06:00:57 -0000 1.10
+++ class/System/Makefile 4 May 2004 09:18:51 -0000
@@ -21,10 +21,13 @@
 ifdef SECOND_PASS
 	include ../../build/library.make
 else
+# First pass:
+#   1. Build temporary System.dll without depending on System.Xml.dll
+#   2. Since mcs.exe depends on System.dll, use BOOT_COMPILE to compile System.dll
 all-local:
 	@if test ! -f ../lib/$(PROFILE)/$(CYCLIC_DEP) ; then \
 	    echo "Creating temporary $(LIBRARY) without $(CYCLIC_DEP) reference." ; \
-	    $(MAKE) SECOND_PASS=yes || exit 1 ; \
+	    $(MAKE) SECOND_PASS=yes CSCOMPILE='$(BOOT_COMPILE)' || exit 1 ; \
 	    rm -f '$(depsdir)/$(PROFILE)_$(LIBRARY).stamp'; \
 	else \
 	    $(MAKE) SECOND_PASS=yes EXTRA_FLAGS='/define:XML_DEP /r:$(CYCLIC_DEP)' || exit 1; \
Index: class/System/Assembly/ChangeLog
from  Raja R Harinath  <rharinath@novell.com>

	* AssemblyInfo.cs (AssemblyDelaySign, AssemblyKeyFile): Disable
	for BOOTSTRAP_WITH_OLDLIB.  Mono 0.31 runtime crashes with them.

Index: class/System/Assembly/AssemblyInfo.cs
===================================================================
RCS file: /cvs/public/mcs/class/System/Assembly/AssemblyInfo.cs,v
retrieving revision 1.6
diff -u -u -r1.6 AssemblyInfo.cs
--- class/System/Assembly/AssemblyInfo.cs 29 Apr 2004 05:19:55 -0000 1.6
+++ class/System/Assembly/AssemblyInfo.cs 4 May 2004 09:18:51 -0000
@@ -45,5 +45,7 @@
 [assembly: AllowPartiallyTrustedCallers]
 [assembly: ComVisible(false)]
 
+#if ! BOOTSTRAP_WITH_OLDLIB
 [assembly: AssemblyDelaySign(true)]
 [assembly: AssemblyKeyFile("../ecma.pub")]
+#endif
Index: class/corlib/ChangeLog
from  Raja R Harinath  <rharinath@novell.com>

	* Makefile (corlib_net_2_0_bootstrap): Copy System.dll and
	System.Xml.dll from 'default' profile build.
	($(gmcs)): Always go to 'gmcs' directory.

Index: class/corlib/Makefile
===================================================================
RCS file: /cvs/public/mcs/class/corlib/Makefile,v
retrieving revision 1.24
diff -u -u -r1.24 Makefile
--- class/corlib/Makefile 30 Apr 2004 13:24:17 -0000 1.24
+++ class/corlib/Makefile 4 May 2004 09:18:51 -0000
@@ -165,9 +165,12 @@
 
 corlib_net_2_0_bootstrap: $(net_2_0_bootstrap_response) $(net_2_0_bootstrap_stampfile)
 	$(BOOTSTRAP_MCS) /nowarn:649 /nowarn:169 /define:INSIDE_CORLIB /define:NET_1_1 /define:BOOTSTRAP_NET_2_0 $(corlib_flags) /target:library /out:../lib/net_2_0_bootstrap/mscorlib.dll @$(net_2_0_bootstrap_response)
+	cp ../lib/default/System.dll ../lib/default/System.Xml.dll ../lib/net_2_0_bootstrap
 
-$(gmcs):
-	cd $(topdir)/gmcs/ && $(MAKE) ;
+# make sure that $(gmcs) is up-to-date
+FORCE:
+$(gmcs): FORCE
+	cd $(topdir)/gmcs && $(MAKE) ;
 
 $(response): $(sourcefile)
 	@echo Creating $@ ...
Index: class/corlib/Assembly/ChangeLog
from  Raja R Harinath  <rharinath@novell.com>

	* AssemblyInfo.cs (AssemblyDelaySign, AssemblyKeyFile): Disable
	with BOOTSTRAP_WITH_OLDLIB.  Mono 0.31 runtime crashes on this.

Index: class/corlib/Assembly/AssemblyInfo.cs
===================================================================
RCS file: /cvs/public/mcs/class/corlib/Assembly/AssemblyInfo.cs,v
retrieving revision 1.7
diff -u -u -r1.7 AssemblyInfo.cs
--- class/corlib/Assembly/AssemblyInfo.cs 29 Apr 2004 22:23:02 -0000 1.7
+++ class/corlib/Assembly/AssemblyInfo.cs 4 May 2004 09:18:51 -0000
@@ -44,7 +44,9 @@
 [assembly: AllowPartiallyTrustedCallers]
 [assembly: Guid("BED7F4EA-1A96-11D2-8F08-00A0C9A6186D")]
 
-#if ! NET_2_0  && ! BOOTSTRAP_NET_2_0
+#if ! NET_2_0  && ! BOOTSTRAP_NET_2_0 
+#  if ! BOOTSTRAP_WITH_OLDLIB
 	[assembly: AssemblyDelaySign(true)]
 	[assembly: AssemblyKeyFile("../ecma.pub")]
+#  endif
 #endif
