From d79db908b99f5c51a74a2b151c59321e0649d26e Mon Sep 17 00:00:00 2001
From: Paul Gofman <gofmanp@gmail.com>
Date: Tue, 9 Feb 2016 19:06:22 +0300
Subject: [PATCH] sgen: fix bit counting in mword

Fixes GC crashe for 64-bit architecture when using libmono.
---
 mono/sgen/sgen-marksweep.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/mono/sgen/sgen-marksweep.c b/mono/sgen/sgen-marksweep.c
index 0e9691d..fd4a3ef 100644
--- a/mono/sgen/sgen-marksweep.c
+++ b/mono/sgen/sgen-marksweep.c
@@ -1401,8 +1401,8 @@ bitcount (mword d)
 	int count = 0;
 
 #ifdef __GNUC__
-	if (sizeof (mword) == sizeof (unsigned long))
-		count += __builtin_popcountl (d);
+	if (sizeof (mword) == 8)
+		count += __builtin_popcountll (d);
 	else
 		count += __builtin_popcount (d);
 #else
-- 
2.5.0

