<tt>
Hi&nbsp;guys,&lt;br&gt;&lt;br&gt;I&amp;#39;ve&nbsp;been&nbsp;using&nbsp;the&nbsp;moq&nbsp;framework&nbsp;in&nbsp;a&nbsp;gmcs&nbsp;compiled&nbsp;project&nbsp;and&nbsp;I&nbsp;encountered&nbsp;some&nbsp;strange&nbsp;behavior.&nbsp;I&nbsp;decided&nbsp;to&nbsp;compile&nbsp;moq&nbsp;with&nbsp;gmcs&nbsp;and&nbsp;run&nbsp;the&nbsp;test&nbsp;suite.&nbsp;When&nbsp;I&nbsp;tried&nbsp;to&nbsp;compile&nbsp;the&nbsp;moq&nbsp;tests&nbsp;I&nbsp;got&nbsp;an&nbsp;exception&nbsp;from&nbsp;gmcs.&nbsp;Ive&nbsp;reduced&nbsp;the&nbsp;code&nbsp;that&nbsp;causes&nbsp;the&nbsp;exception&nbsp;to&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;using&nbsp;System;&lt;br&gt;using&nbsp;System.Linq.Expressions;&lt;br&gt;using&nbsp;System.Collections.Generic;&lt;br&gt;&lt;br&gt;static&nbsp;public&nbsp;class&nbsp;Foo&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;public&nbsp;int&nbsp;Helper(Expression&amp;lt;Predicate&amp;lt;int&amp;gt;&amp;gt;&nbsp;match)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;0;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;public&nbsp;void&nbsp;Main()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Expression&amp;lt;Action&amp;lt;List&amp;lt;int&amp;gt;&amp;gt;&amp;gt;&nbsp;exp&nbsp;=&nbsp;x&nbsp;=&amp;gt;&nbsp;x.Add(&nbsp;Helper(i&nbsp;=&amp;gt;&nbsp;true)&nbsp;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;}&lt;br&gt;&lt;br&gt;I&nbsp;use&nbsp;&amp;quot;gmcs&nbsp;main.cs&amp;quot;&nbsp;to&nbsp;compile,&nbsp;and&nbsp;get&nbsp;the&nbsp;output&nbsp;below.&nbsp;I&nbsp;hope&nbsp;this&nbsp;helps.&lt;br&gt;<br>
&lt;br&gt;Regards,&nbsp;Bas&nbsp;Smit&lt;br&gt;&lt;br&gt;Exception&nbsp;caught&nbsp;by&nbsp;the&nbsp;compiler&nbsp;while&nbsp;emitting:&lt;br&gt;&amp;nbsp;&amp;nbsp;&nbsp;Block&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem&nbsp;begin&nbsp;at:&nbsp;\Solutions\gmcs2\cs\main.cs(13,5):&lt;br&gt;System.ArgumentNullException:&nbsp;Argument&nbsp;cannot&nbsp;be&nbsp;null.&lt;br&gt;Parameter&nbsp;name:&nbsp;local&lt;br&gt;<br>
Internal&nbsp;compiler&nbsp;error&nbsp;at&nbsp;\Solutions\gmcs2\cs\main.cs(12,24)::&nbsp;exception&nbsp;caught&lt;br&gt;&amp;nbsp;while&nbsp;emitting&nbsp;MethodBuilder&nbsp;[Foo::Main]&lt;br&gt;&lt;br&gt;Unhandled&nbsp;Exception:&nbsp;System.ArgumentNullException:&nbsp;Argument&nbsp;cannot&nbsp;be&nbsp;null.&lt;br&gt;Parameter&nbsp;name:&nbsp;local&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;System.Reflection.Emit.ILGenerator.Emit&nbsp;(OpCode&nbsp;opcode,&nbsp;System.Reflection.E&lt;br&gt;mit.LocalBuilder&nbsp;local)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.LocalInfo.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.VariableReference.EmitLoad&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x0000&lt;br&gt;<br>
0]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.VariableReference.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;lea&lt;br&gt;ve_copy)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.VariableReference.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ArrayCreation.EmitDynamicInitializers&nbsp;(Mono.CSharp.EmitContext&lt;br&gt;<br>
ec,&nbsp;Boolean&nbsp;emitConstants)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ArrayCreation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Argument.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitArguments&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;<br>
llections.ArrayList&nbsp;arguments,&nbsp;Boolean&nbsp;dup_args,&nbsp;Mono.CSharp.LocalTemporary&nbsp;this&lt;br&gt;_arg)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;<br>
stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc,&nbsp;Boolean&nbsp;dup_args,&nbsp;Boolean&nbsp;om&lt;br&gt;it_args)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;<br>
stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.MethodGroupExpr.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;llections.ArrayList&nbsp;arguments)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.TypeCast.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Argument.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitArguments&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;<br>
llections.ArrayList&nbsp;arguments,&nbsp;Boolean&nbsp;dup_args,&nbsp;Mono.CSharp.LocalTemporary&nbsp;this&lt;br&gt;_arg)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;<br>
stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc,&nbsp;Boolean&nbsp;dup_args,&nbsp;Boolean&nbsp;om&lt;br&gt;it_args)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;<br>
stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.MethodGroupExpr.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;llections.ArrayList&nbsp;arguments)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.TypeCast.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ArrayCreation.EmitDynamicInitializers&nbsp;(Mono.CSharp.EmitContext&lt;br&gt;ec,&nbsp;Boolean&nbsp;emitConstants)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ArrayCreation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Argument.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitArguments&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;llections.ArrayList&nbsp;arguments,&nbsp;Boolean&nbsp;dup_args,&nbsp;Mono.CSharp.LocalTemporary&nbsp;this&lt;br&gt;<br>
_arg)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc,&nbsp;Boolean&nbsp;dup_args,&nbsp;Boolean&nbsp;om&lt;br&gt;<br>
it_args)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.MethodGroupExpr.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;llections.ArrayList&nbsp;arguments)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.TypeCast.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ArrayCreation.EmitDynamicInitializers&nbsp;(Mono.CSharp.EmitContext&lt;br&gt;ec,&nbsp;Boolean&nbsp;emitConstants)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ArrayCreation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Argument.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitArguments&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;llections.ArrayList&nbsp;arguments,&nbsp;Boolean&nbsp;dup_args,&nbsp;Mono.CSharp.LocalTemporary&nbsp;this&lt;br&gt;_arg)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;<br>
e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc,&nbsp;Boolean&nbsp;dup_args,&nbsp;Boolean&nbsp;om&lt;br&gt;it_args)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;<br>
e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.MethodGroupExpr.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;<br>
llections.ArrayList&nbsp;arguments)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.TypeCast.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Argument.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitArguments&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;llections.ArrayList&nbsp;arguments,&nbsp;Boolean&nbsp;dup_args,&nbsp;Mono.CSharp.LocalTemporary&nbsp;this&lt;br&gt;_arg)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;<br>
e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc,&nbsp;Boolean&nbsp;dup_args,&nbsp;Boolean&nbsp;om&lt;br&gt;it_args)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_bas&lt;br&gt;<br>
e,&nbsp;Mono.CSharp.Expression&nbsp;instance_expr,&nbsp;System.Reflection.MethodBase&nbsp;method,&nbsp;Sy&lt;br&gt;stem.Collections.ArrayList&nbsp;Arguments,&nbsp;Location&nbsp;loc)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.MethodGroupExpr.EmitCall&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;System.Co&lt;br&gt;<br>
llections.ArrayList&nbsp;arguments)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Invocation.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.VariableReference.EmitAssign&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Mono.&lt;br&gt;CSharp.Expression&nbsp;source,&nbsp;Boolean&nbsp;leave_copy,&nbsp;Boolean&nbsp;prepare_for_load)&nbsp;[0x00000&lt;br&gt;<br>
]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Assign.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec,&nbsp;Boolean&nbsp;is_statement)&lt;br&gt;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Assign.EmitStatement&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.StatementExpression.DoEmit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x0000&lt;br&gt;<br>
0]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Statement.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Block.DoEmit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.Block.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;<br>
&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ExplicitBlock.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.ToplevelBlock.Emit&nbsp;(Mono.CSharp.EmitContext&nbsp;ec)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.EmitContext.EmitResolvedTopBlock&nbsp;(Mono.CSharp.ToplevelBlock&nbsp;blo&lt;br&gt;<br>
ck,&nbsp;Boolean&nbsp;unreachable)&nbsp;[0x00000]&lt;br&gt;&amp;nbsp;&nbsp;at&nbsp;Mono.CSharp.EmitContext.EmitTopBlock&nbsp;(IMethodData&nbsp;md,&nbsp;Mono.CSharp.ToplevelB&lt;br&gt;lock&nbsp;block)&nbsp;[0x00000]&lt;br&gt;<br>

</tt>
