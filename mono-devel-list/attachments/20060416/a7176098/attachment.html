<tt>
&lt;div&gt;Hello&nbsp;all.&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;I&nbsp;have&nbsp;an&nbsp;optimization&nbsp;question&nbsp;here.&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;class&nbsp;that&nbsp;has&nbsp;2D&nbsp;array&nbsp;of&nbsp;double.&nbsp;This&nbsp;class&nbsp;will&nbsp;be&nbsp;used&nbsp;in&nbsp;scientific&nbsp;iteration.&amp;nbsp;&nbsp;It&nbsp;need&nbsp;to&nbsp;have&nbsp;operators&nbsp;(+,-,&nbsp;etc.)&nbsp;so&nbsp;that&nbsp;users&nbsp;can&nbsp;do&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;A&nbsp;=&nbsp;(B&nbsp;+&nbsp;C&nbsp;+&nbsp;D&nbsp;+&nbsp;E&nbsp;+&nbsp;F)/2.5;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;It&nbsp;also&nbsp;has&nbsp;to&nbsp;be&nbsp;fast&nbsp;(as&nbsp;it&nbsp;will&nbsp;be&nbsp;executed&nbsp;thousands&nbsp;of&nbsp;time&nbsp;in&nbsp;iterations&nbsp;and&nbsp;the&nbsp;array&nbsp;dimensions&nbsp;will&nbsp;be&nbsp;large).&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;When&nbsp;I&nbsp;wrote&nbsp;the&nbsp;application&nbsp;in&nbsp;C#&nbsp;(100%)&nbsp;the&nbsp;performance&nbsp;was&nbsp;bad&nbsp;(about&nbsp;30&nbsp;times&nbsp;slower&nbsp;than&nbsp;pure&nbsp;C&nbsp;implementation)&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;.&nbsp;&lt;BR&gt;After&nbsp;profiling&nbsp;I&nbsp;found&nbsp;that&nbsp;the&nbsp;loop&nbsp;inside&nbsp;operator+&nbsp;that&nbsp;cause&nbsp;problem.&nbsp;We&nbsp;can't&nbsp;have&nbsp;one&nbsp;loop&nbsp;to&nbsp;process&nbsp;all&nbsp;operands&nbsp;because&nbsp;we&nbsp;can&nbsp;only&nbsp;process&nbsp;two&nbsp;at&nbsp;a&nbsp;time&nbsp;(that's&nbsp;what&nbsp;I&nbsp;know.&nbsp;I&nbsp;could&nbsp;be&nbsp;wrong).&nbsp;The&nbsp;creation&nbsp;of&nbsp;temporary&nbsp;object&nbsp;also&nbsp;hurts&nbsp;performance.&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;The&nbsp;next&nbsp;thing&nbsp;I&nbsp;did&nbsp;to&nbsp;improve&nbsp;performance&nbsp;was&nbsp;to&nbsp;embed<br>
&nbsp;the&nbsp;application&nbsp;with&nbsp;C.&nbsp;The&nbsp;array&nbsp;allocation&nbsp;is&nbsp;now&nbsp;done&nbsp;in&nbsp;C.&nbsp;All&nbsp;loops&nbsp;are&nbsp;now&nbsp;executed&nbsp;in&nbsp;C.&nbsp;This&nbsp;approach&nbsp;improves&nbsp;the&nbsp;performance&nbsp;greatly.&nbsp;However,&nbsp;it&nbsp;is&nbsp;still&nbsp;not&nbsp;good&nbsp;enough&nbsp;compared&nbsp;to&nbsp;pure&nbsp;C&nbsp;implementation.&nbsp;It's&nbsp;about&nbsp;2-3&nbsp;times&nbsp;slower.&nbsp;After&nbsp;investigating&nbsp;further&nbsp;I&nbsp;found&nbsp;the&nbsp;problem.&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;In&nbsp;C,&nbsp;we&nbsp;can&nbsp;do&nbsp;like&nbsp;this:&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;for(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;rowcount;&nbsp;i++)&lt;BR&gt;&amp;nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;for(int&nbsp;j&nbsp;=&nbsp;0;&nbsp;j&nbsp;&amp;lt;&nbsp;colcount;&nbsp;i++)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;a[i][j]&nbsp;=&nbsp;(b[i][j]&nbsp;+&nbsp;c[i][j]&nbsp;+&nbsp;d[i][j]&nbsp;+&nbsp;e[i][j]&nbsp;+&nbsp;f[i][j])/2.5;&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;In&nbsp;C,&nbsp;we&nbsp;can&nbsp;process&nbsp;all&nbsp;array&nbsp;in&nbsp;one&nbsp;loop.&nbsp;But,&nbsp;in&nbsp;C#&nbsp;we&nbsp;have&nbsp;to&nbsp;process&nbsp;array&nbsp;2&nbsp;at&nbsp;a&nbsp;time.&amp;nbsp;&nbsp;This&nbsp;means&nbsp;(for&nbsp;the&nbsp;above&nbsp;example),&nbsp;we&nbsp;need&nbsp;to&nbsp;execute&nbsp;the&nbsp;loop&nbsp;4&nbsp;times&nbsp;instead&nbsp;of&nbsp;once.&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;What&nbsp;should&nbsp;I&nbsp;do&nbsp;to&nbsp;bring&nbsp;the&nbsp;performance&nbsp;closer&nbsp;to&nbsp;C&nbsp;(of&nbsp;course&nbsp;I&nbsp;wan&nbsp;to&nbsp;keep&nbsp;the&nbsp;class&nbsp;and&nbsp;operators)?&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&lt;BR&gt;How&nbsp;do&nbsp;we&nbsp;tell&nbsp;C#&nbsp;to&nbsp;process&nbsp;all&nbsp;operands&nbsp;at<br>
&nbsp;once,&nbsp;instead&nbsp;of&nbsp;only&nbsp;2&nbsp;at&nbsp;a&nbsp;time?&nbsp;Do&nbsp;we&nbsp;need&nbsp;to&nbsp;modify&nbsp;the&nbsp;C#&nbsp;language&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;process&nbsp;all&nbsp;at&nbsp;once?&nbsp;If&nbsp;we&nbsp;do&nbsp;need&nbsp;to&nbsp;modify&nbsp;C#&nbsp;or&nbsp;the&nbsp;JIT&nbsp;compiler,&nbsp;where&nbsp;should&nbsp;I&nbsp;start?&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;Many&nbsp;thanks&nbsp;for&nbsp;your&nbsp;attention.&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;Rusmin&lt;/div&gt;&lt;p&gt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;hr&nbsp;size=1&gt;Blab-away&nbsp;for&nbsp;as&nbsp;little&nbsp;as&nbsp;1¢/min.&nbsp;Make&nbsp;&lt;a&nbsp;href=&quot;http://us.rd.yahoo.com/mail_us/taglines/postman2/*http://us.rd.yahoo.com/evt=39663/*http://voice.yahoo.com&quot;&gt;&nbsp;PC-to-Phone&nbsp;Calls&lt;/a&gt;&nbsp;using&nbsp;Yahoo!&nbsp;Messenger&nbsp;with&nbsp;Voice.
</tt>
