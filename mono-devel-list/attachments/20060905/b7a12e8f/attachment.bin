Index: mcs/class/corlib/System/ChangeLog
===================================================================
--- mcs/class/corlib/System/ChangeLog	(revision 64941)
+++ mcs/class/corlib/System/ChangeLog	(working copy)
@@ -1,3 +1,7 @@
+2006-09-05  Jason McFall  <jaymc_fall@yahoo.com>
+
+	* Environment.cs (ProcessorCount): Implement as icall.
+
 2006-09-05  Raja R Harinath  <rharinath@novell.com>
 
 	* DateTime.cs (Today) [NET_2_0]: Set kind to Local.
Index: mcs/class/corlib/System/Environment.cs
===================================================================
--- mcs/class/corlib/System/Environment.cs	(revision 64941)
+++ mcs/class/corlib/System/Environment.cs	(working copy)
@@ -621,14 +621,10 @@
 		[MethodImplAttribute (MethodImplOptions.InternalCall)]
 		internal static extern void InternalSetEnvironmentVariable (string variable, string value);
 
-		[MonoTODO]
-		public static int ProcessorCount {
+		public static extern int ProcessorCount {
 			[EnvironmentPermission (SecurityAction.Demand, Read="NUMBER_OF_PROCESSORS")]
-			get {
-				// note: Changes to the NUMBER_OF_PROCESSORS environment variable
-				// under Windows doesn't affect the (good) value returned.
-				throw new NotImplementedException ();
-			}
+			[MethodImplAttribute (MethodImplOptions.InternalCall)]
+			get;			
 		}
 
 		[MonoTODO ("not much documented")]
Index: mono/mono/metadata/ChangeLog
===================================================================
--- mono/mono/metadata/ChangeLog	(revision 64941)
+++ mono/mono/metadata/ChangeLog	(working copy)
@@ -1,3 +1,14 @@
+2006-09-05  Jason McFall  <jaymc_fall@yahoo.com>
+
+	* environment.c (ves_icall_System_Environment_get_ProcessorCount): 
+	Implement Environment.ProcessorCount.
+	
+	* environment.h (ves_icall_System_Environment_get_ProcessorCount): 
+	Implement Environment.ProcessorCount.
+	
+	* icall.c: 
+	Add Environment.ProcessorCount icall.
+
 2006-09-05  Raja R Harinath  <rharinath@novell.com>
 
 	* debug-mono-symfile.c (mono_debug_open_mono_symbols): Remove
Index: mono/mono/metadata/icall.c
===================================================================
--- mono/mono/metadata/icall.c	(revision 64941)
+++ mono/mono/metadata/icall.c	(working copy)
@@ -6623,6 +6623,7 @@
 	{"get_MachineName", ves_icall_System_Environment_get_MachineName},
 	{"get_NewLine", ves_icall_System_Environment_get_NewLine},
 	{"get_Platform", ves_icall_System_Environment_get_Platform},
+	{"get_ProcessorCount", ves_icall_System_Environment_get_ProcessorCount},
 	{"get_TickCount", ves_icall_System_Environment_get_TickCount},
 	{"get_UserName", ves_icall_System_Environment_get_UserName},
 	{"internalGetEnvironmentVariable", ves_icall_System_Environment_GetEnvironmentVariable},
Index: mono/mono/metadata/environment.c
===================================================================
--- mono/mono/metadata/environment.c	(revision 64941)
+++ mono/mono/metadata/environment.c	(working copy)
@@ -18,6 +18,7 @@
 #include <mono/io-layer/io-layer.h>
 
 #ifndef PLATFORM_WIN32
+#include <unistd.h>
 #include <sys/utsname.h>
 #endif
 
@@ -64,3 +65,18 @@
 #endif
 	return mono_string_new (mono_domain_get (), "0.0.0.0");
 }
+
+gint32 ves_icall_System_Environment_get_ProcessorCount(void)
+{
+
+#ifdef PLATFORM_WIN32
+		
+	SYSTEM_INFO sys_info;
+	GetSystemInfo(&sys_info);
+	return sys_info.dwNumberOfProcessors;
+
+#else
+	return (gint32)sysconf (_SC_NPROCESSORS_CONF);
+#endif
+
+}
Index: mono/mono/metadata/environment.h
===================================================================
--- mono/mono/metadata/environment.h	(revision 64941)
+++ mono/mono/metadata/environment.h	(working copy)
@@ -17,6 +17,8 @@
 
 extern MonoString* ves_icall_System_Environment_GetOSVersionString (void);
 
+extern gint32 ves_icall_System_Environment_get_ProcessorCount(void);
+
 G_END_DECLS
 
 #endif /* _MONO_METADATA_ENVIRONMENT_H_ */