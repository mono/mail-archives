Index: ChangeLog
===================================================================
RCS file: /mono/mcs/class/System.Data/System.Data/ChangeLog,v
retrieving revision 1.118
diff -u -w -r1.118 ChangeLog
--- ChangeLog	30 Mar 2004 14:35:28 -0000	1.118
+++ ChangeLog	31 Mar 2004 21:25:36 -0000
@@ -1,3 +1,11 @@
+2004-03-31  Juraj Skripsky <juraj@hotfeet.ch>
+
+	* DataColumn.cs : Setting Caption to null sets it to the empty string
+	(ms.net behaviour, testcase is in DataColumnTest).
+	
+	* DataRow.cs : Evaluate DataColumn.Expression when such a column's value is
+	requested.
+
 2004-03-30 Lluis Sanchez Gual <lluis@ximian.com>
 
 	* DataColumn.cs: In Expression setter, set the expression member even if 
Index: DataColumn.cs
===================================================================
RCS file: /mono/mcs/class/System.Data/System.Data/DataColumn.cs,v
retrieving revision 1.34
diff -u -w -r1.34 DataColumn.cs
--- DataColumn.cs	30 Mar 2004 14:35:28 -0000	1.34
+++ DataColumn.cs	31 Mar 2004 21:25:38 -0000
@@ -261,6 +261,9 @@
 					return _caption;
 			}
 			set {
+				if (value == null)
+					value = String.Empty;
+					
 				_caption = value;
 			}
 		}
@@ -392,6 +395,10 @@
    				}
 				expression = value;  
 			}
+		}
+		
+		internal IExpression CompiledExpression {
+			get { return compiledExpression; }
 		}
 
 		[Browsable (false)]
Index: DataRow.cs
===================================================================
RCS file: /mono/mcs/class/System.Data/System.Data/DataRow.cs,v
retrieving revision 1.55
diff -u -w -r1.55 DataRow.cs
--- DataRow.cs	15 Mar 2004 10:10:06 -0000	1.55
+++ DataRow.cs	31 Mar 2004 21:25:41 -0000
@@ -192,12 +192,13 @@
 				// Accessing deleted rows
 				if (rowState == DataRowState.Deleted && version != DataRowVersion.Original)
 					throw new DeletedRowInaccessibleException ("Deleted row information cannot be accessed through the row.");
-				// Row not in table
-				//if (rowState == DataRowState.Detached && version == DataRowVersion.Default)
-				//	throw new RowNotInTableException("This row has been removed from a table and does not have any data.  BeginEdit() will allow creation of new data in this row.");
-				// Non-existent version
-				//if (!HasVersion (version))
-				//	throw new VersionNotFoundException (Locale.GetText ("There is no " + version.ToString () + " data to access."));
+				
+				DataColumn col = _table.Columns[columnIndex];
+				if (col.Expression != String.Empty) {
+					object o = col.CompiledExpression.Eval (this);
+					return Convert.ChangeType (o, col.DataType);
+				}
+				
 				if (HasVersion(version))
 				{
 					switch (version) 
