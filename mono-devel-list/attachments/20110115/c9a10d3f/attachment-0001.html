<tt>
It&nbsp;crashes&nbsp;with&nbsp;all&nbsp;apps&nbsp;during&nbsp;mono_jit_init[_version]&nbsp;(which&nbsp;use&nbsp;mono_runtime_invoke&nbsp;internally)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!mono_jit_runtime_invoke(_MonoMethod&nbsp;*&nbsp;method,&nbsp;void&nbsp;*&nbsp;obj,&nbsp;void&nbsp;*&nbsp;*&nbsp;params,&nbsp;MonoObject&nbsp;*&nbsp;*&nbsp;exc)&nbsp; Line&nbsp;5700&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!mono_runtime_invoke(_MonoMethod&nbsp;*&nbsp;method,&nbsp;void&nbsp;*&nbsp;obj,&nbsp;void&nbsp;*&nbsp;*&nbsp;params,&nbsp;MonoObject&nbsp;*&nbsp;*&nbsp;exc)&nbsp; Line&nbsp;2727&nbsp;+&nbsp;0x18&nbsp;bytes&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!create_exception_two_strings(_MonoClass&nbsp;*&nbsp;klass,&nbsp;_MonoString&nbsp;*&nbsp;a1,&nbsp;_MonoString&nbsp;*&nbsp;a2)&nbsp; Line&nbsp;134&nbsp;+&nbsp;0x13&nbsp;bytes&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!mono_exception_from_name_two_strings(_MonoImage&nbsp;*&nbsp;image,&nbsp;const&nbsp;char&nbsp;*&nbsp;name_space,&nbsp;const&nbsp;char&nbsp;*&nbsp;name,&nbsp;_MonoString&nbsp;*&nbsp;a1,&nbsp;_MonoString&nbsp;*&nbsp;a2)&nbsp; Line&nbsp;157&nbsp;+&nbsp;0x11&nbsp;bytes&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!create_domain_objects(_MonoDomain&nbsp;*&nbsp;domain)&nbsp; Line&nbsp;177&nbsp;+&nbsp;0x1c&nbsp;bytes&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!mono_runtime_init(_MonoDomain&nbsp;*&nbsp;domain,&nbsp;void&nbsp;(int,&nbsp;void&nbsp;*,&nbsp;void&nbsp;*)*&nbsp;start_cb,&nbsp;void&nbsp;(int,&nbsp;void&nbsp;*)*&nbsp;attach_cb)&nbsp; Line&nbsp;261&nbsp;+&nbsp;0x9&nbsp;bytes&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!mini_init(const&nbsp;char&nbsp;*&nbsp;filename,&nbsp;const&nbsp;char&nbsp;*&nbsp;runtime_version)&nbsp; Line&nbsp;6514&nbsp;+&nbsp;0x13&nbsp;bytes&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;mono-2.0.dll!mono_jit_init_version(const&nbsp;char&nbsp;*&nbsp;domain_name,&nbsp;const&nbsp;char&nbsp;*&nbsp;runtime_version)&nbsp; Line&nbsp;2043&nbsp;+&nbsp;0xd&nbsp;bytes&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;C&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Jan&nbsp;15,&nbsp;2011&nbsp;at&nbsp;9:20&nbsp;AM,&nbsp;Zoltan&nbsp;Varga&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:vargaz@gmail.com&quot;&gt;vargaz@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
<br>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  Do&nbsp;you&nbsp;have&nbsp;a&nbsp;testcase,&nbsp;or&nbsp;does&nbsp;this&nbsp;happen&nbsp;with&nbsp;all&nbsp;apps&nbsp;?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Zoltan&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;Fri,&nbsp;Jan&nbsp;14,&nbsp;2011&nbsp;at&nbsp;10:58&nbsp;PM,&nbsp;Virgile&nbsp;Bello&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:virgile.bello@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;virgile.bello@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;Recently,&nbsp;I&nbsp;had&nbsp;some&nbsp;problem&nbsp;with&nbsp;the&nbsp;VS2010&nbsp;build&nbsp;of&nbsp;mono.&lt;div&gt;Runtime&nbsp;check&nbsp;complains&nbsp;ESP&nbsp;is&nbsp;wrong&nbsp;after&nbsp;first&nbsp;time&nbsp;runtime_invoke&nbsp;is&nbsp;called.&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;traced&nbsp;it&nbsp;back&nbsp;to&nbsp;this&nbsp;single-line&nbsp;commit.&lt;/div&gt;&lt;div&gt;<br>
<br>
(Reverting&nbsp;this&nbsp;single&nbsp;line&nbsp;avoids&nbsp;the&nbsp;problem&nbsp;on&nbsp;any&nbsp;version&nbsp;up&nbsp;to&nbsp;master)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;08f0bcaad89540260323f24811cbf896cfe471ed&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt; &nbsp; Mark&nbsp;runtime&nbsp;invoke&nbsp;wrappers&nbsp;as&nbsp;pinvoke,&nbsp;since&nbsp;they&nbsp;are&nbsp;called&nbsp;from&nbsp;native&nbsp;code.&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;diff&nbsp;--git&nbsp;a/mono/metadata/marshal.c&nbsp;b/mono/metadata/marshal.c&lt;/div&gt;&lt;div&gt;index&nbsp;476d129..c586555&nbsp;100644&lt;/div&gt;&lt;div&gt;---&nbsp;a/mono/metadata/marshal.c&lt;/div&gt;&lt;div&gt;+++&nbsp;b/mono/metadata/marshal.c&lt;/div&gt;&lt;div&gt;@@&nbsp;-4571,6&nbsp;+4571,7&nbsp;@@&nbsp;mono_marshal_get_runtime_invoke&nbsp;(MonoMethod&nbsp;*method,&nbsp;gboolean&nbsp;virtual)&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; csig-&amp;gt;params&nbsp;[1]&nbsp;=&nbsp;&amp;amp;mono_defaults.int_class-&amp;gt;byval_arg;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; csig-&amp;gt;params&nbsp;[2]&nbsp;=&nbsp;&amp;amp;mono_defaults.int_class-&amp;gt;byval_arg;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; csig-&amp;gt;params&nbsp;[3]&nbsp;=&nbsp;&amp;amp;mono_defaults.int_class-&amp;gt;byval_arg;&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
&lt;div&gt;+&nbsp; &nbsp; &nbsp; &nbsp;csig-&amp;gt;pinvoke&nbsp;=&nbsp;1;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; name&nbsp;=&nbsp;mono_signature_to_name&nbsp;(callsig,&nbsp;virtual&nbsp;?&nbsp;&amp;quot;runtime_invoke_virtual&amp;quot;&nbsp;:&nbsp;&amp;quot;runtime_invoke&amp;quot;);&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; mb&nbsp;=&nbsp;mono_mb_new&nbsp;(target_klass,&nbsp;name,&nbsp; MONO_WRAPPER_RUNTIME_INVOKE);&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
&lt;/div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
