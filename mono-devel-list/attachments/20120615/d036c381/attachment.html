<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;font-size:12pt&quot;&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&nbsp;&quot;&gt;&lt;span&gt;Hey,&nbsp;I&nbsp;can&nbsp;copy&nbsp;the&nbsp;stack&nbsp;trace&nbsp;from&nbsp;the&nbsp;call-stack&nbsp;tab&nbsp;in&nbsp;the&nbsp;debugger!&nbsp;&nbsp;Sweet.&nbsp;&nbsp;Here&nbsp;it&nbsp;is:&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&nbsp;&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;&lt;div&gt;System.Drawing.GDIPlus.CheckStatus&nbsp;(status=System.Drawing.Status.InvalidParameter)&nbsp;in&nbsp;mcs/class/System.Drawing/System.Drawing/gdipFunctions.cs:220&lt;/div&gt;&lt;div&gt;System.Drawing.Graphics.GdipMeasureString&nbsp;(graphics=0xffffffffb4476428,&nbsp;text=&quot;Export&quot;,&nbsp;font={[Font:&nbsp;Name=DejaVu&nbsp;Sans,&nbsp;Size=8.25,&nbsp;Units=3,&nbsp;GdiCharSet=1,&nbsp;GdiVerticalFont=False]},&nbsp;layoutRect={{X=0,Y=0,Width=2.147484E+09,Height=2.147484E+09}},&nbsp;stringFormat=0xffffffffb445b288)&nbsp;in<br>
&nbsp;mcs/class/System.Drawing/System.Drawing/Graphics.cs:1950&lt;/div&gt;&lt;div&gt;System.Drawing.Graphics.MeasureString&nbsp;(text=&quot;Export&quot;,&nbsp;font={[Font:&nbsp;Name=DejaVu&nbsp;Sans,&nbsp;Size=8.25,&nbsp;Units=3,&nbsp;GdiCharSet=1,&nbsp;GdiVerticalFont=False]},&nbsp;width=2147483647,&nbsp;format={[StringFormat,&nbsp;FormatFlags=0]})&nbsp;in&nbsp;mcs/class/System.Drawing/System.Drawing/Graphics.cs:1983&lt;/div&gt;&lt;div&gt;System.Windows.Forms.TextRenderer.MeasureTextInternal&nbsp;(dc={System.Drawing.Graphics},&nbsp;text=&quot;Export&quot;,&nbsp;font={[Font:&nbsp;Name=DejaVu&nbsp;Sans,&nbsp;Size=8.25,&nbsp;Units=3,&nbsp;GdiCharSet=1,&nbsp;GdiVerticalFont=False]},&nbsp;proposedSize={{Width=0,&nbsp;Height=0}},&nbsp;flags=System.Windows.Forms.TextFormatFlags.HidePrefix,&nbsp;useMeasureString=false)&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/TextRenderer.cs:304&lt;/div&gt;&lt;div&gt;System.Windows.Forms.TextRenderer.MeasureText&nbsp;(text=&quot;Export&quot;,&nbsp;font={[Font:&nbsp;Name=DejaVu&nbsp;Sans,&nbsp;Size=8.25,&nbsp;Units=3,&nbsp;GdiCharSet=1,&nbsp;GdiVerticalFont=False]},&nbsp;proposedSize={{Width=0,&nbsp;Height=0}},<br>
&nbsp;flags=System.Windows.Forms.TextFormatFlags.HidePrefix)&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/TextRenderer.cs:137&lt;/div&gt;&lt;div&gt;System.Windows.Forms.ToolStripItem.CalculateAutoSize&nbsp;()&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/ToolStripItem.cs:1507&lt;/div&gt;&lt;div&gt;System.Windows.Forms.ToolStripItem.set_InternalOwner&nbsp;(value=(null))&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/ToolStripItem.cs:1898&lt;/div&gt;&lt;div&gt;System.Windows.Forms.ToolStripItemCollection.Remove&nbsp;(value={Export})&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/ToolStripItemCollection.cs:270&lt;/div&gt;&lt;div&gt;System.Windows.Forms.ToolStripItem.Dispose&nbsp;(disposing=false)&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/ToolStripItem.cs:963&lt;/div&gt;&lt;div&gt;System.Windows.Forms.ToolStripDropDownItem.Dispose&nbsp;(disposing=false)&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/ToolStripDropDownItem.cs:185&lt;/div&gt;&lt;div&gt;System.Windows.Forms.ToolStripMenuItem.Dispose<br>
&nbsp;(disposing=false)&nbsp;in&nbsp;mcs/class/Managed.Windows.Forms/System.Windows.Forms/ToolStripMenuItem.cs:222&lt;/div&gt;&lt;div&gt;System.ComponentModel.Component.Finalize&nbsp;()&nbsp;in&nbsp;mcs/class/System/System.ComponentModel/Component.cs:104&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Interesting,&nbsp;this&nbsp;is&nbsp;with&nbsp;a&nbsp;different&nbsp;menu&nbsp;item,&nbsp;&quot;Export&quot;...not&nbsp;the&nbsp;one&nbsp;I&nbsp;selected.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don't&nbsp;know&nbsp;if&nbsp;it&nbsp;matters&nbsp;that&nbsp;32-bit&nbsp;pointers&nbsp;are&nbsp;getting&nbsp;sign-extended&nbsp;to&nbsp;64-bit&nbsp;pointers,&nbsp;like&nbsp;graphics=0xffffffffb4476428&nbsp;in&nbsp;System.Drawing.Graphics.GdipMeasureString(),&nbsp;but&nbsp;that&nbsp;looks&nbsp;suspicious&nbsp;too.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&nbsp;&quot;&gt;Steven&nbsp;Boswell&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;font-size:&nbsp;12pt;&nbsp;&quot;&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',<br>
&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&nbsp;&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;Arial&quot;&gt;&nbsp;&lt;hr&nbsp;size=&quot;1&quot;&gt;&nbsp;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:bold;&quot;&gt;From:&lt;/span&gt;&lt;/b&gt;&nbsp;Steven&nbsp;Boswell&nbsp;II&nbsp;&lt;ulatekh@yahoo.com&gt;&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;To:&lt;/span&gt;&lt;/b&gt;&nbsp;&quot;mono-devel-list@lists.ximian.com&quot;&nbsp;&lt;mono-devel-list@lists.ximian.com&gt;&nbsp;&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Sent:&lt;/span&gt;&lt;/b&gt;&nbsp;Friday,&nbsp;June&nbsp;15,&nbsp;2012&nbsp;5:34&nbsp;PM&lt;br&gt;&nbsp;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Subject:&lt;/span&gt;&lt;/b&gt;&nbsp;Re:&nbsp;[Mono-dev]&nbsp;Patches&nbsp;for&nbsp;mono-winforms&lt;br&gt;&nbsp;&lt;/font&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;br&gt;<br>
&lt;div&nbsp;id=&quot;yiv435952070&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;'times&nbsp;new&nbsp;roman',&nbsp;'new&nbsp;york',&nbsp;times,&nbsp;serif;&nbsp;&quot;&gt;&lt;div&gt;Enclosed&nbsp;is&nbsp;a&nbsp;new&nbsp;patch,&nbsp;mostly&nbsp;for&nbsp;discussion&nbsp;purposes,&nbsp;since&nbsp;there's&nbsp;no&nbsp;unit&nbsp;test&nbsp;&amp;&nbsp;I&nbsp;don't&nbsp;know&nbsp;how&nbsp;I&nbsp;would&nbsp;write&nbsp;one&nbsp;for&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Today,&nbsp;after&nbsp;using&nbsp;my&nbsp;application&nbsp;in&nbsp;a&nbsp;particular&nbsp;way,&nbsp;I&nbsp;got&nbsp;it&nbsp;to&nbsp;crash,&nbsp;putting&nbsp;up&nbsp;an&nbsp;&quot;Exception&nbsp;caught&quot;&nbsp;window.&nbsp;&nbsp;I&nbsp;can't&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;outside&nbsp;of&nbsp;running&nbsp;it&nbsp;in&nbsp;the&nbsp;MonoDevelop&nbsp;debugger,&nbsp;and&nbsp;there&nbsp;appears&nbsp;to&nbsp;be&nbsp;no&nbsp;way&nbsp;to&nbsp;copy&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;stack-trace&nbsp;tab&nbsp;in&nbsp;the&nbsp;exception-caught&nbsp;window&nbsp;(really?&nbsp;how&nbsp;the&nbsp;heck&nbsp;did&nbsp;THIS&nbsp;get&nbsp;missed?),&nbsp;so&nbsp;I&nbsp;can't&nbsp;post&nbsp;the&nbsp;full&nbsp;details.&nbsp;&nbsp;But&nbsp;it&nbsp;starts&nbsp;at&nbsp;System.ComponentModel.Finalize()&nbsp;with&nbsp;a&nbsp;tool-strip-item&nbsp;(the&nbsp;one&nbsp;I&nbsp;selected&nbsp;seconds&nbsp;before&nbsp;the&nbsp;crash),&nbsp;and&nbsp;ends&nbsp;in&nbsp;System.Drawing.GDIPlus.CheckStatus(Status),&nbsp;where&nbsp;it&nbsp;reports&nbsp;&quot;A&nbsp;null&nbsp;reference&nbsp;or&nbsp;invalid&nbsp;value&nbsp;was<br>
&nbsp;found&nbsp;[GDI+&nbsp;status:<br>
&nbsp;InvalidParameter]&quot;.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;no&nbsp;idea&nbsp;why&nbsp;a&nbsp;copy&nbsp;of&nbsp;my&nbsp;menu-item&nbsp;is&nbsp;getting&nbsp;finalized;&nbsp;I&nbsp;certainly&nbsp;didn't&nbsp;make&nbsp;a&nbsp;copy&nbsp;of&nbsp;it.&nbsp;&nbsp;The&nbsp;good&nbsp;news&nbsp;is,&nbsp;this&nbsp;crash&nbsp;is&nbsp;consistently&nbsp;repeatable,&nbsp;if&nbsp;I&nbsp;just&nbsp;use&nbsp;my&nbsp;application&nbsp;in&nbsp;the&nbsp;same&nbsp;certain&nbsp;order.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Digging&nbsp;through&nbsp;the&nbsp;stack&nbsp;trace,&nbsp;I&nbsp;arrived&nbsp;at&nbsp;System.Windows.Forms.ToolStripItem.set_InternalOwner,&nbsp;where&nbsp;the&nbsp;owner&nbsp;was&nbsp;being&nbsp;set&nbsp;to&nbsp;null,&nbsp;and&nbsp;right&nbsp;afterwards,&nbsp;CalculateAutoSize()&nbsp;was&nbsp;being&nbsp;called.&nbsp;&nbsp;Why&nbsp;would&nbsp;anyone&nbsp;need&nbsp;to&nbsp;calculate&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;menu-item&nbsp;that&nbsp;isn't&nbsp;even&nbsp;connected&nbsp;to&nbsp;a&nbsp;menu&nbsp;any&nbsp;more?&nbsp;&nbsp;So,&nbsp;for&nbsp;me,&nbsp;the&nbsp;bug&nbsp;fix&nbsp;was&nbsp;obvious:&nbsp;check&nbsp;if&nbsp;the&nbsp;owner&nbsp;isn't&nbsp;null&nbsp;before&nbsp;calling&nbsp;CalculateAutoSize().&nbsp;&nbsp;That's&nbsp;what&nbsp;the&nbsp;enclosed&nbsp;patch&nbsp;does.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;With&nbsp;this&nbsp;patch,&nbsp;the&nbsp;bug&nbsp;doesn't&nbsp;reproduce,&nbsp;and&nbsp;the&nbsp;menu-item&nbsp;I&nbsp;selected&nbsp;is&nbsp;still&nbsp;there&nbsp;and&nbsp;doing&nbsp;fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;thoughts&nbsp;on&nbsp;the&nbsp;correctness&nbsp;of&nbsp;this&nbsp;bug&nbsp;fix?<br>
&nbsp;&nbsp;Or&nbsp;how&nbsp;one&nbsp;would&nbsp;write&nbsp;a&nbsp;unit&nbsp;test&nbsp;for&nbsp;it?&nbsp;&nbsp;Or&nbsp;how&nbsp;to&nbsp;copy&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;stack-trace&nbsp;tab&nbsp;in&nbsp;MonoDevelop's&nbsp;exception-caught&nbsp;window?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Steven&nbsp;Boswell&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;ymailto=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
