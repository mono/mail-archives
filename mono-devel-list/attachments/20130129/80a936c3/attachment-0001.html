<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;we&nbsp;have&nbsp;a&nbsp;problem&nbsp;with&nbsp;mono&nbsp;sometimes&nbsp;not&nbsp;invoking&nbsp;a&nbsp;callback&nbsp;when&nbsp;completing&nbsp;an&nbsp;operation.&nbsp; We&nbsp;use&nbsp;a&nbsp;patch&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;mailto:gonzalo.mono@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;gonzalo.mono@gmail.com&lt;/a&gt;&nbsp;which&nbsp;fixes&nbsp;the&nbsp;problem&nbsp;for&nbsp;us.&nbsp;You&nbsp;can&nbsp;try&nbsp;building&nbsp;mono&nbsp;with&nbsp;this&nbsp;patch&nbsp;and&nbsp;check&nbsp;if&nbsp;it&nbsp;helps. &lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://github.com/ysw/mono-socket-problem/blob/master/Patches/cb_fix.patch&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/ysw/mono-socket-problem/blob/master/Patches/cb_fix.patch&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt;-yuriy&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Jan&nbsp;29,&nbsp;2013&nbsp;at&nbsp;1:47&nbsp;PM,&nbsp;Esben&nbsp;Laursen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:hyber@hyber.dk&quot;&nbsp;target=&quot;_blank&quot;&gt;hyber@hyber.dk&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;Guys,&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;my&nbsp;first&nbsp;post&nbsp;to&nbsp;the&nbsp;develop&nbsp;list,&nbsp;so&nbsp;I&nbsp;have&nbsp;that&nbsp;I&nbsp;have&nbsp;found&nbsp;the&nbsp;correct&nbsp;place&nbsp;for&nbsp;my&nbsp;questions.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;a&nbsp;problem&nbsp;with&nbsp;the&nbsp;sharpsnmplib&nbsp;(&lt;a&nbsp;href=&quot;http://sharpsnmplib.codeplex.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sharpsnmplib.codeplex.&lt;u&gt;&lt;/u&gt;com/&lt;/a&gt;)&nbsp;that&nbsp;when&nbsp;I&nbsp;run&nbsp;mono-3.0.3&nbsp;it&nbsp;halts&nbsp;my&nbsp;program&nbsp;even&nbsp;tough&nbsp;I&nbsp;have&nbsp;set&nbsp;a&nbsp;time-out&nbsp;of&nbsp;3000ms&nbsp;on&nbsp;the&nbsp;socket.&nbsp;I&nbsp;have&nbsp;a&nbsp;watchdog&nbsp;that&nbsp;after&nbsp;about&nbsp;10minutes&nbsp;reset&nbsp;the&nbsp;thread&nbsp;and&nbsp;tries&nbsp;again.&lt;br&gt;<br>
<br>
<br>
<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;fairly&nbsp;convinced&nbsp;that&nbsp;it&nbsp;is&nbsp;a&nbsp;problem&nbsp;in&nbsp;the&nbsp;framework,&nbsp;but&nbsp;of&nbsp;course&nbsp;not&nbsp;sure.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;tried&nbsp;to&nbsp;build&nbsp;a&nbsp;reproduction&nbsp;of&nbsp;my&nbsp;problem&nbsp;where&nbsp;I&nbsp;implemented&nbsp;my&nbsp;method&nbsp;as&nbsp;Async&nbsp;with&nbsp;a&nbsp;waitone&nbsp;time-out&nbsp;of&nbsp;twice&nbsp;the&nbsp;socket&nbsp;time-out.&nbsp;It&nbsp;happens&nbsp;from&nbsp;time&nbsp;to&nbsp;time&nbsp;that&nbsp;the&nbsp;waitone&nbsp;would&nbsp;trigger&nbsp;before&nbsp;the&nbsp;time-out&nbsp;of&nbsp;the&nbsp;socket.&nbsp;(I&nbsp;tested&nbsp;this&nbsp;on&nbsp;2.6.7,&nbsp;2.10.8&nbsp;and&nbsp;3.0.3&nbsp;and&nbsp;they&nbsp;all&nbsp;had&nbsp;the&nbsp;issue)&lt;br&gt;<br>
<br>
<br>
<br>
&lt;br&gt;<br>
That&nbsp;lead&nbsp;me&nbsp;to&nbsp;build&nbsp;a&nbsp;simple&nbsp;udp&nbsp;socket&nbsp;client&nbsp;and&nbsp;server&nbsp;app.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;works&nbsp;the&nbsp;following&nbsp;way:&lt;br&gt;<br>
&lt;br&gt;<br>
Client&nbsp;sends&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;the&nbsp;server&lt;br&gt;<br>
The&nbsp;server&nbsp;reads&nbsp;the&nbsp;socket&nbsp;and&nbsp;returns&nbsp;the&nbsp;same&nbsp;data&nbsp;back&nbsp;to&nbsp;the&nbsp;client&lt;br&gt;<br>
Client&nbsp;reads&nbsp;the&nbsp;socket&nbsp;and&nbsp;closes&nbsp;it&lt;br&gt;<br>
Then&nbsp;loop&nbsp;back&nbsp;to&nbsp;the&nbsp;beginning.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;works&nbsp;great&nbsp;on&nbsp;Windows&nbsp;(and&nbsp;mono&nbsp;if&nbsp;you&nbsp;run&nbsp;both&nbsp;apps&nbsp;locally)&lt;br&gt;<br>
&lt;br&gt;<br>
Then&nbsp;I&nbsp;tested&nbsp;with&nbsp;the&nbsp;server&nbsp;app&nbsp;running&nbsp;on&nbsp;my&nbsp;Windows7&nbsp;and&nbsp;the&nbsp;client&nbsp;app&nbsp;running&nbsp;on&nbsp;a&nbsp;Debian&nbsp;(tried&nbsp;both&nbsp;2.6.7&nbsp;and&nbsp;3.0.3)&nbsp;and&nbsp;it&nbsp;would&nbsp;only&nbsp;send&nbsp;out&nbsp;20-30&nbsp;udp&nbsp;packets&nbsp;before&nbsp;it&nbsp;would&nbsp;that&nbsp;giving&nbsp;me&nbsp;this&nbsp;output&nbsp;to&nbsp;the&nbsp;console:&lt;br&gt;<br>
<br>
<br>
<br>
&lt;br&gt;<br>
Operation&nbsp;on&nbsp;non-blocking&nbsp;socket&nbsp;would&nbsp;block&lt;br&gt;<br>
Operation&nbsp;on&nbsp;non-blocking&nbsp;socket&nbsp;would&nbsp;block&lt;br&gt;<br>
Operation&nbsp;on&nbsp;non-blocking&nbsp;socket&nbsp;would&nbsp;block&lt;br&gt;<br>
Operation&nbsp;on&nbsp;non-blocking&nbsp;socket&nbsp;would&nbsp;block&lt;br&gt;<br>
Operation&nbsp;on&nbsp;non-blocking&nbsp;socket&nbsp;would&nbsp;block&lt;br&gt;<br>
&lt;br&gt;<br>
after&nbsp;a&nbsp;little&nbsp;while&nbsp;it&nbsp;would&nbsp;send&nbsp;out&nbsp;some&nbsp;more&nbsp;packets.&lt;br&gt;<br>
&lt;br&gt;<br>
Here&nbsp;is&nbsp;a&nbsp;link&nbsp;to&nbsp;my&nbsp;code:&nbsp;&lt;a&nbsp;href=&quot;http://pastebin.com/3ehqSpWM&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pastebin.com/3ehqSpWM&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;question&nbsp;is&nbsp;the&nbsp;following:&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;I&nbsp;guess&nbsp;this&nbsp;is&nbsp;a&nbsp;bug,&nbsp;should&nbsp;I&nbsp;create&nbsp;it&nbsp;in&nbsp;bugzilla?&lt;br&gt;<br>
&lt;br&gt;<br>
2.&nbsp;If&nbsp;I&nbsp;have&nbsp;a&nbsp;multithreaded&nbsp;app&nbsp;that&nbsp;sends&nbsp;out&nbsp;hundreds&nbsp;or&nbsp;thousand&nbsp;of&nbsp;UDP&nbsp;requests,&nbsp;do&nbsp;you&nbsp;think&nbsp;this&nbsp;could&nbsp;cause&nbsp;the&nbsp;socket&nbsp;to&nbsp;be&nbsp;block&nbsp;for&nbsp;10&nbsp;minutes&nbsp;at&nbsp;a&nbsp;time?&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;its&nbsp;the&nbsp;same&nbsp;problem&nbsp;and&nbsp;the&nbsp;problem&nbsp;I&nbsp;have&nbsp;with&nbsp;my&nbsp;code&nbsp;seems&nbsp;to&nbsp;be&nbsp;worse&nbsp;on&nbsp;mono-3.0.3,&nbsp;but&nbsp;not&nbsp;worse&nbsp;in&nbsp;my&nbsp;reproduction&nbsp;app&nbsp;(although&nbsp;it&nbsp;is&nbsp;not&nbsp;threaded)&lt;br&gt;<br>
<br>
<br>
<br>
&lt;br&gt;<br>
What&nbsp;are&nbsp;your&nbsp;thoughts?&lt;br&gt;<br>
&lt;br&gt;<br>
Many&nbsp;thanks&nbsp;for&nbsp;your&nbsp;help.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers&lt;br&gt;<br>
&lt;br&gt;<br>
Esben&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Mono-devel-list@lists.ximian.&lt;u&gt;&lt;/u&gt;com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/&lt;u&gt;&lt;/u&gt;mailman/listinfo/mono-devel-&lt;u&gt;&lt;/u&gt;list&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;--&nbsp;&lt;br&gt;Yuriy&nbsp;Solodkyy&lt;br&gt;(&lt;a&nbsp;href=&quot;mailto:y.solodkyy@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;y.solodkyy@gmail.com&lt;/a&gt;)<br>
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Yuriy&nbsp;Solodkyy&lt;br&gt;(&lt;a&nbsp;href=&quot;mailto:y.solodkyy@gmail.com&quot;&gt;y.solodkyy@gmail.com&lt;/a&gt;)<br>
&lt;/div&gt;<br>

</tt>
