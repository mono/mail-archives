<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.6000.16711&quot;&nbsp;name=GENERATOR&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I'm&nbsp;attempting&nbsp;to&nbsp;use&nbsp;the&nbsp;Mono&nbsp;store&nbsp;system&nbsp;to&nbsp;<br>
store&nbsp;CRL&nbsp;files&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;manual&nbsp;implementation&nbsp;of&nbsp;online&nbsp;CRL&nbsp;checking&nbsp;with&nbsp;<br>
X509Chain.Build().&nbsp;Whereas&nbsp;X509Crl&nbsp;is&nbsp;an&nbsp;open&nbsp;object,&nbsp;<br>
Mono.Security.X509.X509Store&nbsp;has&nbsp;no&nbsp;public&nbsp;constructor,&nbsp;and&nbsp;seemingly&nbsp;no&nbsp;way&nbsp;to&nbsp;<br>
instantiate&nbsp;it&nbsp;or&nbsp;access&nbsp;it&nbsp;directly&nbsp;from&nbsp;a&nbsp;user&nbsp;program.&nbsp;This&nbsp;class&nbsp;contains&nbsp;<br>
the&nbsp;Import&nbsp;function&nbsp;for&nbsp;CRLs,&nbsp;although&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;tell&nbsp;it&nbsp;isn't&nbsp;called&nbsp;<br>
anywhere&nbsp;else&nbsp;within&nbsp;Mono.&nbsp;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;At&nbsp;the&nbsp;moment&nbsp;I've&nbsp;implemented&nbsp;the&nbsp;<br>
online&nbsp;check&nbsp;by&nbsp;generating&nbsp;a&nbsp;chain,&nbsp;walking&nbsp;the&nbsp;elements&nbsp;and&nbsp;manually&nbsp;fetching&nbsp;<br>
the&nbsp;certificates,&nbsp;writing&nbsp;them&nbsp;to&nbsp;the&nbsp;correct&nbsp;file&nbsp;name&nbsp;for&nbsp;the&nbsp;CRL&nbsp;so&nbsp;they&nbsp;can&nbsp;<br>
be&nbsp;picked&nbsp;up&nbsp;by&nbsp;X509Chain.FindCrl&lt;BR&gt;&amp;nbsp;&lt;BR&gt;Obviously&nbsp;it's&nbsp;be&nbsp;useful&nbsp;to&nbsp;have&nbsp;<br>
some&nbsp;way&nbsp;to&nbsp;access&nbsp;the&nbsp;Mono&nbsp;X509Store&nbsp;instead&nbsp;of&nbsp;relying&nbsp;on&nbsp;these&nbsp;hacks.&nbsp;I've&nbsp;<br>
not&nbsp;that&nbsp;familiar&nbsp;with&nbsp;the&nbsp;codebase,&nbsp;but&nbsp;if&nbsp;I'm&nbsp;not&nbsp;mistaken&nbsp;there's&nbsp;currently&nbsp;<br>
no&nbsp;way,&nbsp;and&nbsp;so&nbsp;I&nbsp;was&nbsp;thinking&nbsp;maybe&nbsp;it's&nbsp;possible&nbsp;to&nbsp;provide&nbsp;a&nbsp;public&nbsp;<br>
constructor&nbsp;for&nbsp;the&nbsp;store,&nbsp;or&nbsp;some&nbsp;system&nbsp;to&nbsp;allow&nbsp;importing&nbsp;and&nbsp;retrieval&nbsp;of&nbsp;<br>
CRLs?&lt;BR&gt;&amp;nbsp;&lt;BR&gt;On&nbsp;another&nbsp;note,&nbsp;I&nbsp;noticed&nbsp;X509Crl.Parse()&nbsp;assumes&nbsp;an&nbsp;<br>
unencoded&nbsp;format&nbsp;for&nbsp;CRLs,&nbsp;although&nbsp;upon&nbsp;downloading&nbsp;a&nbsp;few&nbsp;test&nbsp;ones&nbsp;I&nbsp;realised&nbsp;<br>
quite&nbsp;a&nbsp;few&nbsp;come&nbsp;base64&nbsp;encoded,&nbsp;so&nbsp;I&nbsp;created&nbsp;the&nbsp;following&nbsp;function,&nbsp;based&nbsp;on&nbsp;<br>
Mono.Security.X509.&nbsp;X509Certificate.PEM&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;static&nbsp;byte[]&nbsp;<br>
_DecodeCrlBase64(byte[]&nbsp;data)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;string&nbsp;<br>
crl&nbsp;=&nbsp;<br>
Encoding.ASCII.GetString(data);&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
string&nbsp;header&nbsp;=&nbsp;String.Format(&quot;-----BEGIN&nbsp;{0}-----&quot;,&nbsp;&quot;X509&nbsp;<br>
CRL&quot;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;<br>
start&nbsp;=&nbsp;crl.IndexOf(header)&nbsp;+&nbsp;<br>
header.Length;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
if&nbsp;(start&nbsp;-&nbsp;header.Length&nbsp;==&nbsp;<br>
-1)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;<br>
data;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
string&nbsp;footer&nbsp;=&nbsp;String.Format(&quot;-----END&nbsp;{0}-----&quot;,&nbsp;&quot;X509&nbsp;<br>
CRL&quot;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;<br>
end&nbsp;=&nbsp;crl.IndexOf(footer,&nbsp;<br>
start);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;string&nbsp;<br>
base64&nbsp;=&nbsp;crl.Substring(start,&nbsp;(end&nbsp;-&nbsp;<br>
start));&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;<br>
Convert.FromBase64String(base64);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
}&lt;BR&gt;&amp;nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;also&nbsp;had&nbsp;troubles&nbsp;with&nbsp;FindCrl,&nbsp;<br>
mainly:&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;((ski.Length&nbsp;<br>
==&nbsp;0)&nbsp;||&nbsp;(ski&nbsp;==&nbsp;GetAuthorityKeyIdentifier&nbsp;(crl)))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;crl;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;this&nbsp;line&nbsp;seems&nbsp;to&nbsp;impose&nbsp;a&nbsp;mandatory&nbsp;Authority&nbsp;Key&nbsp;<br>
Identifier&nbsp;(2.5.29.35)&nbsp;check.&nbsp;According&nbsp;to&nbsp;&lt;A&nbsp;<br>
href=&quot;http://www.redhat.com/docs/manuals/cert-system/admin/7.1/app_ext.html&quot;&gt;http://www.redhat.com/docs/manuals/cert-system/admin/7.1/app_ext.html&lt;/A&gt;&nbsp;<br>
this&nbsp;extension&nbsp;is&nbsp;non-critical&nbsp;and&nbsp;&quot;If&nbsp;this&nbsp;extension&nbsp;is&nbsp;not&nbsp;present,&nbsp;then&nbsp;the&nbsp;<br>
issuer&nbsp;name&nbsp;alone&nbsp;is&nbsp;used&nbsp;to&nbsp;identify&nbsp;the&nbsp;issuer&nbsp;<br>
certificate.&quot;.&lt;BR&gt;&amp;nbsp;&lt;BR&gt;Hence,&nbsp;I&nbsp;believe&nbsp;the&nbsp;check&nbsp;should&nbsp;be&nbsp;optional,&nbsp;<br>
replacing&nbsp;the&nbsp;above&nbsp;line&nbsp;in&nbsp;both&nbsp;places&nbsp;with&nbsp;something&nbsp;along&nbsp;the&nbsp;lines&nbsp;<br>
of:&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;string&nbsp;aki&nbsp;=&nbsp;<br>
GetAuthorityKeyIdentifier&nbsp;(crl);&lt;BR&gt;&amp;nbsp;&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;((ski.Length&nbsp;==&nbsp;0)&nbsp;||&nbsp;<br>
(String.IsNullOrEmpty(aki)&nbsp;||&nbsp;ski&nbsp;==&nbsp;<br>
aki))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
return&nbsp;crl;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;I&nbsp;haven't&nbsp;got&nbsp;any&nbsp;real&nbsp;functional&nbsp;knowledge&nbsp;of&nbsp;the&nbsp;<br>
theory&nbsp;behind&nbsp;the&nbsp;CRL&nbsp;checks,&nbsp;apart&nbsp;from&nbsp;checking&nbsp;the&nbsp;related&nbsp;RFCs,&nbsp;specs&nbsp;and&nbsp;<br>
general&nbsp;internet&nbsp;resources.&nbsp;However,&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;contribute&nbsp;with&nbsp;this,&nbsp;and&nbsp;<br>
it'd&nbsp;be&nbsp;great&nbsp;to&nbsp;get&nbsp;online&nbsp;CRL&nbsp;checking&nbsp;working&nbsp;in&nbsp;a&nbsp;future&nbsp;release&nbsp;of&nbsp;Mono,&nbsp;as&nbsp;<br>
well&nbsp;as&nbsp;opening&nbsp;up&nbsp;the&nbsp;functionality&nbsp;for&nbsp;dealing&nbsp;with&nbsp;CRLs&nbsp;in&nbsp;the&nbsp;store.&nbsp;I&nbsp;know&nbsp;<br>
on&nbsp;top&nbsp;of&nbsp;just&nbsp;downloading&nbsp;if&nbsp;not&nbsp;found,&nbsp;there&nbsp;should&nbsp;be&nbsp;some&nbsp;checking&nbsp;to&nbsp;ensure&nbsp;<br>
CRls&nbsp;are&nbsp;updated&nbsp;should&nbsp;they&nbsp;be&nbsp;found&nbsp;to&nbsp;be&nbsp;out&nbsp;of&nbsp;date,&nbsp;although&nbsp;I&nbsp;don't&nbsp;know&nbsp;<br>
if&nbsp;this&nbsp;should&nbsp;occur&nbsp;in&nbsp;the&nbsp;X509Chain.Build&nbsp;method&nbsp;or&nbsp;not.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Hopefully&nbsp;someone&nbsp;more&nbsp;knowledge&nbsp;can&nbsp;give&nbsp;advice&nbsp;on&nbsp;<br>
how&nbsp;best&nbsp;to&nbsp;go&nbsp;about&nbsp;all&nbsp;of&nbsp;this.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Thanks,&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Alex&nbsp;Mason&lt;BR&gt;&amp;nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;BR&gt;&amp;nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
