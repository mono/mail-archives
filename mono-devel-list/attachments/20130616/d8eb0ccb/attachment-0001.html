<tt>
&lt;html&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;id=&quot;owaParaStyle&quot;&nbsp;type=&quot;text/css&quot;&gt;P&nbsp;{margin-top:0;margin-bottom:0;}&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;ocsi=&quot;0&quot;&nbsp;fpstyle=&quot;1&quot;&gt;<br>
&lt;div&nbsp;style=&quot;direction:&nbsp;ltr;font-family:&nbsp;Tahoma;color:&nbsp;#000000;font-size:&nbsp;10pt;&quot;&gt;Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
I'd&nbsp;like&nbsp;some&nbsp;guidance&nbsp;on&nbsp;how&nbsp;to&nbsp;free&nbsp;memory&nbsp;in&nbsp;an&nbsp;embedded&nbsp;Mono&nbsp;scenario.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;'monkeyed'&nbsp;a&nbsp;few&nbsp;things&nbsp;started&nbsp;from&nbsp;the&nbsp;embedded&nbsp;samples&nbsp;in&nbsp;the&nbsp;mono&nbsp;codebase,&nbsp;but&nbsp;they&nbsp;are&nbsp;limited&nbsp;to&nbsp;g_free&nbsp;calls&nbsp;on&nbsp;UTF8&nbsp;strings.&nbsp;I&nbsp;think&nbsp;I&nbsp;figured&nbsp;out&nbsp;I&nbsp;needed&nbsp;to&nbsp;use&nbsp;mono_gchandle_new&nbsp;and&nbsp;mono_gchandle_free&nbsp;to&nbsp;'pin'&nbsp;(resp.&nbsp;'free')&nbsp;MonoObject&nbsp;from&nbsp;the<br>
&nbsp;embedding&nbsp;application&nbsp;when&nbsp;they&nbsp;re&nbsp;not&nbsp;in&nbsp;use&nbsp;anymore&nbsp;outside&nbsp;of&nbsp;the&nbsp;CLR.&nbsp;Nevertheless&nbsp;the&nbsp;fate&nbsp;of&nbsp;transient&nbsp;objects&nbsp;is&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;mystery.&lt;br&gt;<br>
&lt;br&gt;<br>
Say&nbsp;I&nbsp;have&nbsp;a&nbsp;C#&nbsp;function:&lt;br&gt;<br>
public&nbsp;static&nbsp;object&nbsp;CreateInstance(string&nbsp;typename,&nbsp;object[]&nbsp;ctorArgs)&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Which&nbsp;I&nbsp;am&nbsp;calling&nbsp;from&nbsp;C&nbsp;with&nbsp;the&nbsp;code&nbsp;below.&nbsp;What&nbsp;should&nbsp;I&nbsp;do&nbsp;with&nbsp;the&nbsp;transient&nbsp;MonoArray&nbsp;'ctor_params'&nbsp;before&nbsp;leaving&nbsp;the&nbsp;function?&nbsp;is&nbsp;mono_free&nbsp;to&nbsp;call&nbsp;in&nbsp;this&nbsp;case,&nbsp;or&nbsp;would&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;do&nbsp;its&nbsp;job&nbsp;just&nbsp;fine&nbsp;as&nbsp;it&nbsp;is.&lt;br&gt;<br>
&lt;br&gt;<br>
{&lt;br&gt;<br>
//&nbsp;snip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;MonoArray*&nbsp;ctor_params&nbsp;=&nbsp;create_array_object(build_method_parameters(ctorParams),&nbsp;Rf_length(ctorParams));&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;MonoObject&nbsp;*&nbsp;exception,&nbsp;*result;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;void**&nbsp;ci_p&nbsp;=&nbsp;(void**)malloc(2*sizeof(void*));&nbsp;//&nbsp;The&nbsp;array&nbsp;of&nbsp;parameters&nbsp;for&nbsp;CreateInstance&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ci_p[0]&nbsp;=&nbsp;create_mono_string(ns_qualified_typename);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ci_p[1]&nbsp;=&nbsp;ctor_params;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;mono_runtime_invoke&nbsp;(method,&nbsp;NULL,&nbsp;ci_p,&nbsp;&amp;exception);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;print_if_exception(exception);&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;free(ci_p);&lt;br&gt;<br>
//&nbsp;snip&lt;br&gt;<br>
}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
