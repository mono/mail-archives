<tt>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;/*&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;*&nbsp;g_printerr&nbsp;(&amp;quot;\nUnhandled&nbsp;Exception:&nbsp;%s.%s:&nbsp;%s\n&amp;quot;,&nbsp;exc-&amp;gt;vtable-&amp;gt;klass-&amp;gt;name_space, &lt;/div&gt;<br>
&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;*&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp; &nbsp;exc-&amp;gt;vtable-&amp;gt;klass-&amp;gt;name,&nbsp;message);&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;*/&lt;/div&gt;<br>
&lt;div&gt;+&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;g_printerr&nbsp;(&amp;quot;\nUnhandled&nbsp;Exception:&nbsp;%s\n&amp;quot;,&nbsp;message);&lt;/div&gt;&lt;div&gt;-&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;+&lt;/div&gt;&lt;div&gt; &lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;if&nbsp;(free_message)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please&nbsp;remove&nbsp;the&nbsp;whitespace&nbsp;noise.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mono_string_to_utf8_checked&nbsp;can&amp;#39;t&nbsp;be&nbsp;added&nbsp;to&nbsp;the&nbsp;public&nbsp;API&nbsp;without&nbsp;proper&nbsp;documentation.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Patch&nbsp;looks&nbsp;good&nbsp;besides&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Jul&nbsp;2,&nbsp;2010&nbsp;at&nbsp;5:34&nbsp;PM,&nbsp;Michael&nbsp;Hutchinson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:m.j.hutchinson@gmail.com&quot;&gt;m.j.hutchinson@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Fri,&nbsp;Jul&nbsp;2,&nbsp;2010&nbsp;at&nbsp;3:43&nbsp;PM,&nbsp;Robert&nbsp;Jordan&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:robertj@gmx.net&quot;&gt;robertj@gmx.net&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;You&nbsp;can&nbsp;get&nbsp;rid&nbsp;of&nbsp;the&nbsp;loop&nbsp;and&nbsp;optimize&nbsp;it&nbsp;further&nbsp;by&nbsp;caching&lt;br&gt;<br>
&amp;gt;&nbsp;System.Object&amp;#39;s&nbsp;ToString&nbsp;method:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;MonoString&nbsp;*&lt;br&gt;<br>
&amp;gt;&nbsp;mono_object_to_string&nbsp;(MonoObject&nbsp;*obj,&nbsp;MonoObject&nbsp;**exc)&lt;br&gt;<br>
&amp;gt;&nbsp;{&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; static&nbsp;MonoMethod&nbsp;*to_string&nbsp;=&nbsp;NULL;&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; MonoMethod&nbsp;*method;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; g_assert&nbsp;(obj);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;(!to_string)&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; to_string&nbsp;=&nbsp;mono_class_get_method_from_name_flags&lt;br&gt;<br>
&amp;gt;&nbsp;(mono_get_object_class&nbsp;(),&nbsp;&amp;quot;ToString&amp;quot;,&nbsp;0,&nbsp;METHOD_ATTRIBUTE_VIRTUAL&nbsp;|&lt;br&gt;<br>
&amp;gt;&nbsp;METHOD_ATTRIBUTE_PUBLIC);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; method&nbsp;=&nbsp;mono_object_get_virtual_method&nbsp;(obj,&nbsp;method);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; return&nbsp;(MonoString&nbsp;*)&nbsp;mono_runtime_invoke&nbsp;(method,&nbsp;obj,&nbsp;NULL,&nbsp;exc);&lt;br&gt;<br>
&amp;gt;&nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Makes&nbsp;sense&nbsp;-&nbsp;I&amp;#39;m&nbsp;not&nbsp;familiar&nbsp;with&nbsp;Mono&nbsp;runtime&nbsp;API,&nbsp;and&nbsp;I&amp;#39;d&nbsp;just&lt;br&gt;<br>
lifted&nbsp;code&nbsp;directly&nbsp;from&nbsp;mono_print_exception.&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;ve&nbsp;folded&nbsp;this&nbsp;into&nbsp;my&nbsp;patch&nbsp;(with&nbsp;the&nbsp;to_string&nbsp;fix),&nbsp;added&lt;br&gt;<br>
Changelogs,&nbsp;and&nbsp;updated&nbsp;the&nbsp;utils&nbsp;Makefile.am&nbsp;to&nbsp;install&nbsp;mono-error.h.&lt;br&gt;<br>
&lt;br&gt;<br>
OK&nbsp;to&nbsp;commit&nbsp;now?&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
--&lt;br&gt;<br>
Michael&nbsp;Hutchinson&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://mjhutchinson.com&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mjhutchinson.com&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Mono-devel-list&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Mono-devel-list@lists.ximian.com&quot;&gt;Mono-devel-list@lists.ximian.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ximian.com/mailman/listinfo/mono-devel-list&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ximian.com/mailman/listinfo/mono-devel-list&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
