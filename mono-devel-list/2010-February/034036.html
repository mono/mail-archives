<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono.Simd AltiVec port
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono.Simd%20AltiVec%20port&In-Reply-To=19e4cfaf1002020059i2b998446x993f9bbf56b48d7c%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034014.html">
   <LINK REL="Next"  HREF="034072.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono.Simd AltiVec port</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono.Simd%20AltiVec%20port&In-Reply-To=19e4cfaf1002020059i2b998446x993f9bbf56b48d7c%40mail.gmail.com"
       TITLE="[Mono-dev] Mono.Simd AltiVec port">kumpera at gmail.com
       </A><BR>
    <I>Wed Feb  3 19:59:15 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034014.html">[Mono-dev] Mono.Simd AltiVec port
</A></li>
        <LI>Next message: <A HREF="034072.html">[Mono-dev] Mono.Simd AltiVec port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34036">[ date ]</a>
              <a href="thread.html#34036">[ thread ]</a>
              <a href="subject.html#34036">[ subject ]</a>
              <a href="author.html#34036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sergei,

On Tue, Feb 2, 2010 at 6:59 AM, Sergei Dyshel &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">qyron.private at gmail.com</A>&gt;wrote:

&gt;<i> Hello all,
</I>&gt;<i>
</I>&gt;<i> I'm currently working on PowerPC port of Mono which utilizes AltiVec SIMD
</I>&gt;<i> instructions. During the development I've encountered an alignment problem:
</I>&gt;<i>
</I>&gt;<i> As far as I understood from running Mono's JIT, stack-allocated
</I>&gt;<i> Mono.Simd.Vector* types are always aligned by 16 byte bound, but global
</I>&gt;<i> ones aren't (such as static class members). This is not a problem for SSE
</I>&gt;<i> which has unaligned load/stores but AltiVec doesn't have them. Instead of
</I>&gt;<i> implementing misaligned loads/stores for AltiVec I think it's better to
</I>&gt;<i> force alignment in global variables, as it done in the case of stack.
</I>&gt;<i>
</I>
No, the JIT doesn't align all Vector types to 16 bytes. There are places,
like spill, code that
still doesn't do it correctly. Not a lot of work to get there, but still not
done.


If by global variables you mean statics, then making them properly aligned
is possible with some trickery.
The only issue alignment issue we can't currently fix are heap objects due
to how our GC works.
Our new GC might eventually gain the ability to properly align such objects,
but this is something
for the far future.



&gt;<i> Can somebody help me with that (e.g. point at relevant places in
</I>&gt;<i> 'mini-ppc.c')?
</I>&gt;<i>
</I>
To fix the alignment of stack variables you need to mess with a bunch of
places:

-The spill code from mini-codegen.c
-The var allocation code in mono_allocate_stack_slots (mini.c)

To fix the static storage alignment you need to change the code that
allocate the statics area
to use the proper alignment.

This is the same problem as with objects as it uses a gc routine to allocate
the memory blob.
Fixing this requires boing deep into the GC, which is not something simple.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100203/d50b8897/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100203/d50b8897/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034014.html">[Mono-dev] Mono.Simd AltiVec port
</A></li>
	<LI>Next message: <A HREF="034072.html">[Mono-dev] Mono.Simd AltiVec port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34036">[ date ]</a>
              <a href="thread.html#34036">[ thread ]</a>
              <a href="subject.html#34036">[ subject ]</a>
              <a href="author.html#34036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
