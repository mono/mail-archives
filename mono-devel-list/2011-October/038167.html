<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] WCF Error Deserializing SOAP Reply
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20WCF%20Error%20Deserializing%20SOAP%20Reply&In-Reply-To=1314366585567-3770895.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038165.html">
   <LINK REL="Next"  HREF="038169.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] WCF Error Deserializing SOAP Reply</H1>
    <B>Marc Bettex</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20WCF%20Error%20Deserializing%20SOAP%20Reply&In-Reply-To=1314366585567-3770895.post%40n4.nabble.com"
       TITLE="[Mono-dev] WCF Error Deserializing SOAP Reply">bettex at epsitec.ch
       </A><BR>
    <I>Thu Oct 27 07:56:05 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="038165.html">[Mono-dev] [Mono-list] 32-bit vs 64-bit Performance Discrepency
</A></li>
        <LI>Next message: <A HREF="038169.html">[Mono-dev] interacting with method signatures from C (embedded)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38167">[ date ]</a>
              <a href="thread.html#38167">[ thread ]</a>
              <a href="subject.html#38167">[ subject ]</a>
              <a href="author.html#38167">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am porting a windows application using wcf running on .Net so that it can
run on Mono (2.10.6) and I have bumped in the same problem.

For the context, I use message contracts with the xml serializer and the c#
code for the objects is generated by the svcutil.exe program from microsoft
(from a wsdl and xsd files given by a third party).

I have found that the problem occurs when the XmlSerializer must deserialize
the xml for properties that can target more that one type. For instance a
property such as this one have this problem.

[System.Xml.Serialization.XmlElementAttribute (&quot;WeeklyHours&quot;, typeof
(decimal), Order=0)]
[System.Xml.Serialization.XmlElementAttribute (&quot;WeeklyLessons&quot;, typeof
(string), DataType=&quot;integer&quot;, Order=0)]
public object Item
{
    get
    {
        return this.itemField;
    }
    set
    {
        this.itemField = value;
    }
}

All these properties match an &lt;xs:choice&gt; item in the xsd file. For
instance, this property up there matches the following statement.

&lt;xs:choice&gt;
	&lt;xs:element name=&quot;WeeklyHours&quot; type=&quot;tns:WeeklyHoursType&quot; /&gt;
	&lt;xs:element name=&quot;WeeklyLessons&quot; type=&quot;tns:WeeklyLessonsType&quot; /&gt;
&lt;/xs:choice&gt;

I don't know if this problem is a bug in Mono or something that is not
supposed to be supported.

Anyway, I think that there is a work around this. In my case, I replaced the
c# code above by the following one. There is one new property for each
possible element in the old property and there is also an xxxSpecified
property which is required because of the nullable decimal type (this is the
supported way in .Net to have a nullable value type in this case).

[System.Xml.Serialization.XmlElementAttribute (&quot;WeeklyHours&quot;)]
public decimal? WeeklyHours
{
	get
	{
		return this.weeklyHoursField;
	}
	set
	{
		this.weeklyHoursField = value;
	}
}

[System.Xml.Serialization.XmlIgnoreAttribute ()]
public bool WeeklyHoursSpecified
{
	get
	{
		return this.WeeklyHours.HasValue;
	}
	set
	{
	}
}

[System.Xml.Serialization.XmlElementAttribute (&quot;WeeklyLessons&quot;,
DataType=&quot;integer&quot;)]
public string WeeklyLessons
{
	get
	{
		return this.weeklyLessonsField;
	}
	set
	{
		this.weeklyLessonsField = value;
	}
}

Of course this is not perfect but it looks like it can work. You need to be
strict and make sure that on any given object, you use at most one of the
property, otherwise the xsd schema won't be respected.

I need to to more testing on this to ensure that it works but I can't for
now because after having &quot;solved&quot; that problem, I bumped in the next one :-p
Any feedback on this problem/workaround would be welcome.


blaynebayer wrote:
&gt;<i> 
</I>&gt;<i> I get the following error when performing a wcf client request to a third
</I>&gt;<i> party web service using soap: 
</I>&gt;<i> 
</I>&gt;<i> Read by order only possible for encoded/bare format :   at
</I>&gt;<i> System.Xml.Serialization.ClassMap.GetElement (Int32 index) 
</I>&gt;<i> 
</I>

--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/WCF-Error-Deserializing-SOAP-Reply-tp3770895p3944097.html">http://mono.1490590.n4.nabble.com/WCF-Error-Deserializing-SOAP-Reply-tp3770895p3944097.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038165.html">[Mono-dev] [Mono-list] 32-bit vs 64-bit Performance Discrepency
</A></li>
	<LI>Next message: <A HREF="038169.html">[Mono-dev] interacting with method signatures from C (embedded)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38167">[ date ]</a>
              <a href="thread.html#38167">[ thread ]</a>
              <a href="subject.html#38167">[ subject ]</a>
              <a href="author.html#38167">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
