<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] interacting with method signatures from C (embedded)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20interacting%20with%20method%20signatures%20from%20C%20%28embedded%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038167.html">
   <LINK REL="Next"  HREF="038170.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] interacting with method signatures from C (embedded)</H1>
    <B>Jonathan Shore</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20interacting%20with%20method%20signatures%20from%20C%20%28embedded%29&In-Reply-To="
       TITLE="[Mono-dev] interacting with method signatures from C (embedded)">jonathan.shore at gmail.com
       </A><BR>
    <I>Thu Oct 27 19:23:29 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="038167.html">[Mono-dev] WCF Error Deserializing SOAP Reply
</A></li>
        <LI>Next message: <A HREF="038170.html">[Mono-dev] interacting with method signatures from C (embedded)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38169">[ date ]</a>
              <a href="thread.html#38169">[ thread ]</a>
              <a href="subject.html#38169">[ subject ]</a>
              <a href="author.html#38169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I want to call arbitrary methods on C# / mono classes from a scripting
language (with C as the intermediate interface between the two).   The
method names and signatures are not known up-front, rather the scripting
language -&gt; C -&gt; mono, C layer must translate calls in the scripting
language to:

   1. locate the type (ok, this is straightforward)
   2. locate the method (not straightforward, see below)
   3. call the method (straightforward)

Locating a method with overloading seems to present an issue in that the
public C interface does not expose sufficient access to the MonoType* and
MonoClass* structures.   For instance, asssuming I have a function like this
that I want to implement:


  MonoMethod* find_method (
    MonoDomain* domain,
    MonoClass* type,
    const char* name,
    int nargs,
    MonoClass** types)


I can iterate over the memebers with mono_signature_get_params(), however,
this returns a MonoType* struct reference.  I cannot examine the &quot;type&quot;
field of this struct as is not seen to be a complete structure without
including the &lt;mono/metadata/*-internals.h&gt; files.

I am aware of the &quot;debug-helpers&quot; interface which allows for the search of a
class and method signature using a string.  This interface is oriented
towards use cases where the method one is trying to locate is fixed.  The
construction of the string signature is expensive.  Additionally in scanning
methods, each method matching a name is rendered as a MonoMethodDesc,
creating strings for the classname, namespace, and parameters.  This seems
like a lot of overhead.

Ignoring the extra work / overhead in the search, assuming one has both
primitive and object based types,* how does one create an appropriate
parameter description string for a MonoObject**?   There is logic in
debug-helpers.c to generate a description string from MonoType, but I do not
see a public function for this.

The lowest overhead approach would be to have access to the MonoType* and
MonoClass* structures and be able to iterate over the parameters,
determining whether the type enum and object name (where applicable) are
equal.

Question:  what is the best approach to locating a method given the name of
the method and an array of MonoClass* for the parameters?   I cannot
directly access the structures and I have not determined a way to render the
appropriate type string for a non-primitive class.

Here is a stackoverflow I posted on this:
<A HREF="http://stackoverflow.com/questions/7921337/how-to-use-monotype-in-context-of-evaluating-method-signatures">http://stackoverflow.com/questions/7921337/how-to-use-monotype-in-context-of-evaluating-method-signatures</A>

Thanks

Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20111027/4bacd32f/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20111027/4bacd32f/attachment-0001.html</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038167.html">[Mono-dev] WCF Error Deserializing SOAP Reply
</A></li>
	<LI>Next message: <A HREF="038170.html">[Mono-dev] interacting with method signatures from C (embedded)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38169">[ date ]</a>
              <a href="thread.html#38169">[ thread ]</a>
              <a href="subject.html#38169">[ subject ]</a>
              <a href="author.html#38169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
