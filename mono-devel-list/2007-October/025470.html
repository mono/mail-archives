<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] sigc++ signal C# wraper
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20sigc%2B%2B%20signal%20C%23%20wraper&In-Reply-To=1193710213.22010.87.camel%40lina.magi.jprl.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025444.html">
   <LINK REL="Next"  HREF="025471.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] sigc++ signal C# wraper</H1>
    <B>buhochileno at gmail.com</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20sigc%2B%2B%20signal%20C%23%20wraper&In-Reply-To=1193710213.22010.87.camel%40lina.magi.jprl.com"
       TITLE="[Mono-dev] sigc++ signal C# wraper">buhochileno at gmail.com
       </A><BR>
    <I>Tue Oct 30 16:33:14 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025444.html">[Mono-dev] sigc++ signal C# wraper
</A></li>
        <LI>Next message: <A HREF="025471.html">[Mono-dev] sigc++ signal C# wraper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25470">[ date ]</a>
              <a href="thread.html#25470">[ thread ]</a>
              <a href="subject.html#25470">[ subject ]</a>
              <a href="author.html#25470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank for the help Jonathan... I follow your links and I learn a lote 
:<i>-)...I fix the aliendetector class and the wrapper for the sigc++ 
</I>signal, and the C++ shared library execute my managed method!!!, is so 
great learn new stuff, I'm realy happy thank you so much.
I only have now a little problem, but I'm sure that is my stupidity, I 
add to the C# example code that you send me a delegate and a event , to 
allow to other C# class to asociate  method to this event in a 
traditional .Net/mono way, something like this (only for test):
...
[DllImport (&quot;/usr/local/lib/devel/libaliendetector.so&quot;)]
    private static extern void AlienDetector_AddSignalDetected (IntPtr 
detector, SignalDetectedHandler h);
...
public delegate void SignalDetectedHandlerM (); //I define this to not 
use the delegate used in the 
//DllImport...AlienDetector_AddSignalDetected...
    public static event SignalDetectedHandlerM SignalDetected;
...
and then in the &quot;MyHandler&quot; method (the method executed by the unmanaged 
code) I add this:
    public static void MyHandler ()
    {
        Console.WriteLine (&quot;Managed Code Invoked!&quot;); //this work prefectly
        Demo.SignalDetected(); //traditional .net/mono event trigger, 
dont' work
    }
...allways I get a:
Unhandled Exception: System.NullReferenceException: Object reference not 
set to an instance of an object

The porpuse of this is that later other class can do a traditional:
Demo.SignalDetected += new Demo.SignalDetectedHandlerM(MyOtherHandler);
...and the unmanaged code also triger the MyOtherHandler and use 
&quot;MyHandler&quot; only as a bringe or something like that.

do you see my stupid error?, there are is other better aproach??

thanks again..

Greetings
Mauricio

Jonathan Pryor wrote:
&gt;<i> On Mon, 2007-10-29 at 20:58 -0300, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">buhochileno at gmail.com</A> wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> About the sigc++ C# wraper, please be patient with me, I love 
</I>&gt;&gt;<i> programming and I really want to learn this kind of wraper (in other 
</I>&gt;&gt;<i> situation I write little wraper for common inpout/output function), and 
</I>&gt;&gt;<i> you must know that this is a very difcult subject to find 
</I>&gt;&gt;<i> documentation...
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> I used:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://libsigc.sourceforge.net/libsigc2/docs/reference/html/group__ptr__fun.html">http://libsigc.sourceforge.net/libsigc2/docs/reference/html/group__ptr__fun.html</A>
</I>&gt;<i> <A HREF="http://libsigc.sourceforge.net/libsigc2/docs/manual/html/index.html">http://libsigc.sourceforge.net/libsigc2/docs/manual/html/index.html</A>
</I>&gt;<i> <A HREF="http://www.mono-project.com/Dllimport">http://www.mono-project.com/Dllimport</A>
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> and also recently I learn how manipulate signal/slot in 
</I>&gt;&gt;<i> C++ code (I know how to work and define Delegates and Events in C#).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> First I try to write your test code only to see if I can understad and 
</I>&gt;&gt;<i> compile the code, so I write the aliendetector.cc class like:
</I>&gt;&gt;<i> struct AlienDetector { sigc::signal&lt;void&gt; signal_detected;};
</I>&gt;&gt;<i> extern &quot;C&quot; void* CreateAlienDetector (){ return new AlienDetector ();}
</I>&gt;&gt;<i> void (*SignalDetectedHandler) ();
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> As I said, this was untested.  The above *should* be:
</I>&gt;<i>
</I>&gt;<i> 	typedef void (*SignalDetectedHandler) ();
</I>&gt;<i>
</I>&gt;<i> Otherwise it declares the variable SignalDetectedHandler instead of
</I>&gt;<i> declaring the _type_ SignalDetectedHandler.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> extern &quot;C&quot; void AlienDetector_AddSignalDetected (AlienDetector* 
</I>&gt;&gt;<i> detector, SignalDetectedHandler handler)
</I>&gt;&gt;<i> {detector-&gt;signal_detected.connect (sigc::ptr_fun(handler));
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And I add a little dummy &quot;main&quot; only to see if a traditional compiling 
</I>&gt;&gt;<i> command work:
</I>&gt;&gt;<i> g++ aliendetector.cc -o aliendetector `pkg-config --cflags --libs 
</I>&gt;&gt;<i> sigc++-2.0`
</I>&gt;&gt;<i> //I get...
</I>&gt;&gt;<i> aliendetector.cc:15: error: &#8216;SignalDetectedHandler&#8217; is not a type
</I>&gt;&gt;<i> aliendetector.cc: In function &#8216;void 
</I>&gt;&gt;<i> AlienDetector_AddSignalDetected(AlienDetector*, int)&#8217;:
</I>&gt;&gt;<i> aliendetector.cc:17: error: no matching function for call to &#8216;ptr_fun(int&amp;)&#8217;
</I>&gt;&gt;<i> The second error may be is related to the firs &#8216;SignalDetectedHandler&#8217; 
</I>&gt;&gt;<i> is not a type, I try diferent stuff, but I don't know exactly what can I 
</I>&gt;&gt;<i> change...
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> The second error is probably related to the first.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> Anyway and only to move forward in the building procees of a shared 
</I>&gt;&gt;<i> library, I comment the &quot;void (*SignalDetectedHandler) ();&quot; stuff and the 
</I>&gt;&gt;<i> compilation work, but I have some doubts about it:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I use the following command to get the object code:
</I>&gt;&gt;<i> g++ -fpic -c aliendetector.cc -Wall -g `pkg-config --cflags --libs 
</I>&gt;&gt;<i> sigc++-2.0` //for the object code without main
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> When using -c you don't need `pkg-config --libs`, just `pkg-config
</I>&gt;<i> --cflags`.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> So later I do a :
</I>&gt;&gt;<i> g++ -o libaliendetector.so aliendetector.o -shared -Wl,-Bsymbolic -g 
</I>&gt;&gt;<i> -lsigc-2.0
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> I think you'll need a `pkg-config --libs sigc++-2.0` here, instead of
</I>&gt;<i> -lsigc-2.0.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> Also I want to show you a little of my work:
</I>&gt;&gt;<i> I write this little test header WebCamOrbit.h:
</I>&gt;&gt;<i> #include &lt;sigc++/sigc++.h&gt;
</I>&gt;&gt;<i> class WebCamOrbit
</I>&gt;&gt;<i> {public:
</I>&gt;&gt;<i> WebCamOrbit(); virtual ~WebCamOrbit();
</I>&gt;&gt;<i> virtual void SetPanTilt(int, int);
</I>&gt;&gt;<i> //signal accessor:
</I>&gt;&gt;<i> typedef sigc::signal&lt;void, int, int&gt; type_OnMove;
</I>&gt;&gt;<i> type_OnMove OnMove();
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> OnMove should return `type_OnMove&amp;' instead of `type_OnMove', so that
</I>&gt;<i> later calls in &quot;Consumer&quot; classes like wcOrbit.OnMove().connect(...)
</I>&gt;<i> don't make an extra copy of m_OnMove and instead modify the variable
</I>&gt;<i> directly.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> this work like a charm in C++, and I need to write a wrapper for the 
</I>&gt;&gt;<i> signal exposed by the WebCamOrbit class, so I understend that I have to 
</I>&gt;&gt;<i> build a shared library with this class right?
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Not necessarily, but you should. :-)
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> , and then in some how 
</I>&gt;&gt;<i> write the C# wrapper to allow to a C# programmer to access to this event 
</I>&gt;&gt;<i> in a traditional .NET/mono way (with delegates and events). Do you have 
</I>&gt;&gt;<i> any documentation?, sugestion?.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> See above URLs.
</I>&gt;<i>
</I>&gt;<i>  - Jon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025444.html">[Mono-dev] sigc++ signal C# wraper
</A></li>
	<LI>Next message: <A HREF="025471.html">[Mono-dev] sigc++ signal C# wraper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25470">[ date ]</a>
              <a href="thread.html#25470">[ thread ]</a>
              <a href="subject.html#25470">[ subject ]</a>
              <a href="author.html#25470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
