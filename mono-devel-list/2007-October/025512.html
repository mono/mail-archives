<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] garbage collection and the embedding API
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20garbage%20collection%20and%20the%20embedding%20API&In-Reply-To=4728C77C.9070600%40palladiumconsulting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025510.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] garbage collection and the embedding API</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20garbage%20collection%20and%20the%20embedding%20API&In-Reply-To=4728C77C.9070600%40palladiumconsulting.com"
       TITLE="[Mono-dev] garbage collection and the embedding API">lupus at ximian.com
       </A><BR>
    <I>Wed Oct 31 14:52:39 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025510.html">[Mono-dev] garbage collection and the embedding API
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25512">[ date ]</a>
              <a href="thread.html#25512">[ thread ]</a>
              <a href="subject.html#25512">[ subject ]</a>
              <a href="author.html#25512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/31/07 Sebastian Good wrote:
&gt;<i> What are the lifetime rules for a MonoObject* created with mono_object_new? 
</I>&gt;<i> Is there a corresponding free that needs to be called? I understand that 
</I>&gt;<i> within the JIT's heaps, garbage collection takes care of such issues, but 
</I>&gt;<i> when a CIL pointer &quot;escapes&quot; into the C++ world, I  am having trouble 
</I>&gt;<i> finding documentation describing what to do. I understand it is possible to 
</I>&gt;<i> &quot;pin&quot; these MonoObject*s so they don't move around, but I assume this is 
</I>&gt;<i> unnecessary until a Compacting GC is actually released.
</I>
See docs/gc-variables-in-c in the mono directory/svn module.

&gt;<i> Experimentation suggests that one can indeed be careless with these 
</I>&gt;<i> pointers and not suffer a memory leak, but I'd like to have a firm 
</I>&gt;<i> understanding.
</I>&gt;<i>
</I>&gt;<i> From the discussion at 
</I>&gt;<i> <A HREF="http://www.mono-project.com/Mono:Runtime#Garbage_Collection">http://www.mono-project.com/Mono:Runtime#Garbage_Collection</A> it seems like  
</I>&gt;<i> the unmanaged C++ heap is not scanned but it seems to me like it is. Does 
</I>&gt;<i> the GC linked in with mono replace the default new() or malloc operators?
</I>
Only the stack and the resgisters are scanned in the unmanaged world
(and if it is a thread not created by mono only after you
mono_thread_attach()ed it).
If your only reference to a manged object is somewhere else, including
memory allocated with malloc and new, the GC will free it.
You can use GC handles to cause an object to be kept alive
and you'll have to release it explicitly with mono_gchandle_free().

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025510.html">[Mono-dev] garbage collection and the embedding API
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25512">[ date ]</a>
              <a href="thread.html#25512">[ thread ]</a>
              <a href="subject.html#25512">[ subject ]</a>
              <a href="author.html#25512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
