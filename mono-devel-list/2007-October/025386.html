<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH]Optimization of the generated IMT code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5DOptimization%20of%20the%20generated%20IMT%20code&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025404.html">
   <LINK REL="Next"  HREF="025388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH]Optimization of the generated IMT code</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5DOptimization%20of%20the%20generated%20IMT%20code&In-Reply-To="
       TITLE="[Mono-dev] [PATCH]Optimization of the generated IMT code">kumpera at gmail.com
       </A><BR>
    <I>Wed Oct 24 19:39:04 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025404.html">[Mono-dev] Patch to add support to execute methods	withParamArray thought Reflection
</A></li>
        <LI>Next message: <A HREF="025388.html">[Mono-dev] LINQ to XML status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25386">[ date ]</a>
              <a href="thread.html#25386">[ thread ]</a>
              <a href="subject.html#25386">[ subject ]</a>
              <a href="author.html#25386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The attached patch optimize the imt thunk code. The optimization is to
exploit the fact that IP don't need to be preserved under a particular
situation.

The magic trampoline needs to retrieve the vtable pointer used by the call
site to patch it and this address might be stored in a scratch register,
that's why the IMT code cannot change then. But if the code store the vtable
address within the scratch registers, the magic trampoline code won't
notice. This change allow us to branch without the POP hack.

The optimization loads the vtable pointer into IP and uses r0 and r1 to
compare values. To call the virtual method, we use &quot;ldr pc, [ip + #]&quot;. These
changes reduce the code by 3 words for each entry.


Cheers,
Rodrigo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071024/1cb6bd3d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071024/1cb6bd3d/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: arm_imt_opt.diff
Type: text/x-patch
Size: 4875 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071024/1cb6bd3d/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071024/1cb6bd3d/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025404.html">[Mono-dev] Patch to add support to execute methods	withParamArray thought Reflection
</A></li>
	<LI>Next message: <A HREF="025388.html">[Mono-dev] LINQ to XML status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25386">[ date ]</a>
              <a href="thread.html#25386">[ thread ]</a>
              <a href="subject.html#25386">[ subject ]</a>
              <a href="author.html#25386">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
