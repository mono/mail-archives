<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] ConcurrentQueue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ConcurrentQueue&In-Reply-To=%3CCAOK_bjpC3x6AcPELSzOoZDy_iLJ5HGEz6G%2B1UZfRyA77m_NDNw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041016.html">
   <LINK REL="Next"  HREF="041019.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] ConcurrentQueue</H1>
    <B>Natti Shwarts</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ConcurrentQueue&In-Reply-To=%3CCAOK_bjpC3x6AcPELSzOoZDy_iLJ5HGEz6G%2B1UZfRyA77m_NDNw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] ConcurrentQueue">natti.shwarts at gmail.com
       </A><BR>
    <I>Tue Dec 17 16:14:06 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="041016.html">[Mono-dev] Mono.Cairo 4.0 different on Mac and Ubuntu
</A></li>
        <LI>Next message: <A HREF="041019.html">[Mono-dev] Size of thread in Mono (65MB per thread?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41018">[ date ]</a>
              <a href="thread.html#41018">[ thread ]</a>
              <a href="subject.html#41018">[ subject ]</a>
              <a href="author.html#41018">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I'm running the following .net program on mono (Ubuntu 12, sources
3.8.13.12)
and after ~1 minute where the memory rises up (without any reason according
to the code below), mono crash with TOO MANY HEAP SECTIONS.
(using Queue + lock is stable)
I got mono sources from Git and compile them with large heap.
The result was the same.

I have a few questions:
1. Do you have any idea what could cause this problem ?
2. regarding mono compilation, all makefiles created are with -g flag, how
can I remove it ?

Thanks
Natti



class Program
{
    private static readonly ConcurrentQueue&lt;object&gt; Pool = new
ConcurrentQueue&lt;object&gt;();
    static void Main(string[] args)
    {
        //Fill
        for (var i = 0; i &lt; 500; i++)
            Pool.Enqueue(new object());
        var threads = Enumerable.Range(0, Environment.ProcessorCount)
                                                 .Select(_ =&gt; new Thread(()
=&gt;
                                                  {
                                                          while (true)
                                                          {
                                                                  object
obj;
                                                                   if
(Pool.TryDequeue(out obj))

Pool.Enqueue(obj);
                                                           }
                                                    })).ToArray();
                foreach (var t in threads)
                      t.Start();
                Thread.Sleep(Timeout.Infinite);
            }
     }
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131217/5a16990d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131217/5a16990d/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041016.html">[Mono-dev] Mono.Cairo 4.0 different on Mac and Ubuntu
</A></li>
	<LI>Next message: <A HREF="041019.html">[Mono-dev] Size of thread in Mono (65MB per thread?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41018">[ date ]</a>
              <a href="thread.html#41018">[ thread ]</a>
              <a href="subject.html#41018">[ subject ]</a>
              <a href="author.html#41018">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
