<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] large performance drop between boehm and sgen for a parallel app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20large%20performance%20drop%20between%20boehm%20and%20sgen%20for%20a%0A%20parallel%20app&In-Reply-To=%3CCACmR%2BBBtMYjCUy_Kj9X3KPZKRwDC-Jk2eC0Xz-Lt_3zdpkccNQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040982.html">
   <LINK REL="Next"  HREF="040984.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] large performance drop between boehm and sgen for a parallel app</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20large%20performance%20drop%20between%20boehm%20and%20sgen%20for%20a%0A%20parallel%20app&In-Reply-To=%3CCACmR%2BBBtMYjCUy_Kj9X3KPZKRwDC-Jk2eC0Xz-Lt_3zdpkccNQ%40mail.gmail.com%3E"
       TITLE="[Mono-dev] large performance drop between boehm and sgen for a parallel app">kumpera at gmail.com
       </A><BR>
    <I>Sat Dec  7 18:15:06 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040982.html">[Mono-dev] large performance drop between boehm and sgen for a	parallel app
</A></li>
        <LI>Next message: <A HREF="040984.html">[Mono-dev] large performance drop between boehm and sgen for a	parallel app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40983">[ date ]</a>
              <a href="thread.html#40983">[ thread ]</a>
              <a href="subject.html#40983">[ subject ]</a>
              <a href="author.html#40983">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A perf run with sampling profiling and actual traces would be of some use.

If you have a very large heap, you're probably hitting the limitation of on
the default serial major collector mono uses.
You could try to run with the parallel major enabled, but that's
experimental and has not received enough tunning/testing.


On Sat, Dec 7, 2013 at 12:38 PM, Jonathan Shore &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonathan.shore at gmail.com</A>&gt;wrote:

&gt;<i> Here are the results for a trimmed down version of the problem:
</I>&gt;<i>
</I>&gt;<i> *Boehm (default settings)*
</I>&gt;<i> Performance counter stats for '/opt/mono-3.0/bin/mono-boehm --llvm
</I>&gt;<i> /home/jonathan/Dev/hf/lib/Debug/FeatureGeneratorCSVFile.exe -info -config
</I>&gt;<i> etc/samples/orderbook-2013-CX-V11.xml -out features-2013-CX.csv':
</I>&gt;<i>
</I>&gt;<i>    48579862.522506 task-clock                #    *9.034* CPUs utilized
</I>&gt;<i>
</I>&gt;<i>        188,866,824 context-switches          #    0.004 M/sec
</I>&gt;<i>
</I>&gt;<i>             46,500 CPU-migrations            #    0.000 M/sec
</I>&gt;<i>
</I>&gt;<i>          1,475,427 page-faults               #    0.000 M/sec
</I>&gt;<i>
</I>&gt;<i> 140,468,865,368,193 cycles                    #    2.892 GHz
</I>&gt;<i>
</I>&gt;<i>    &lt;not supported&gt; stalled-cycles-frontend
</I>&gt;<i>    &lt;not supported&gt; stalled-cycles-backend
</I>&gt;<i> 80,012,982,451,027 instructions              #    0.57  insns per cycle
</I>&gt;<i>
</I>&gt;<i> 16,967,686,291,478 branches                  #  349.274 M/sec
</I>&gt;<i>
</I>&gt;<i>     95,315,728,420 branch-misses             #    0.56% of all branches
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     *5377*.495775794 seconds time elapsed
</I>&gt;<i>
</I>&gt;<i> *SGen (default settings)*
</I>&gt;<i> Performance counter stats for '/opt/mono-3.0/bin/mono-sgen --llvm
</I>&gt;<i> /home/jonathan/Dev/hf/lib/Debug/FeatureGeneratorCSVFile.exe -info -config
</I>&gt;<i> etc/samples/orderbook-2013-CX-V11.xml -out features-2013-CX.csv':
</I>&gt;<i>
</I>&gt;<i>   108414200.651113 task-clock                #    *2.049* CPUs utilized
</I>&gt;<i>
</I>&gt;<i>         65,792,604 context-switches          #    0.001 M/sec
</I>&gt;<i>
</I>&gt;<i>             30,536 CPU-migrations            #    0.000 M/sec
</I>&gt;<i>
</I>&gt;<i>        309,928,477 page-faults               #    0.003 M/sec
</I>&gt;<i>
</I>&gt;<i> 263,506,866,481,917 cycles                   #    2.431 GHz
</I>&gt;<i>
</I>&gt;<i>    &lt;not supported&gt; stalled-cycles-frontend
</I>&gt;<i>    &lt;not supported&gt; stalled-cycles-backend
</I>&gt;<i> 130,560,004,191,686 instructions             #    0.50  insns per cycle
</I>&gt;<i>
</I>&gt;<i> 27,570,367,199,486 branches                  #  254.306 M/sec
</I>&gt;<i>
</I>&gt;<i>    382,673,241,515 branch-misses             #    1.39% of all branches
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    *52912.*358974732 seconds time elapsed
</I>&gt;<i>
</I>&gt;<i> There is a nearly 10x difference in performance between these.  Both were
</I>&gt;<i> run on 10 cores.   The boehm version achieved a 9 cpu average and the sgen
</I>&gt;<i> achieved a 2 cpu average + more overhead.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Dec 5, 2013, at 12:48 PM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Are you running boehm in parallel mode? Can you run perf on your
</I>&gt;<i> application and email us the translated results?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Dec 5, 2013 at 11:11 AM, Jonathan Shore &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonathan.shore at gmail.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have a complex parallel application which, when run on 10 threads gets
</I>&gt;&gt;<i> very close to 1000% cpu with mono-boehm (linux) consistently (running for
</I>&gt;&gt;<i> hours).   With mono-sgen only achieves  200 - 250% cpu.   This is on a 12 /
</I>&gt;&gt;<i> 24 core machine.   I need to run sgen eventually because run into the 32
</I>&gt;&gt;<i> bit limit with boehm from time to time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that this is with a fairly recent version of mono compiled from git
</I>&gt;&gt;<i> sources with llvm enabled.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is not an application I can easily box up for analysis on bugzilla due
</I>&gt;&gt;<i> to size of data context, though happy to provide an enviroment to the mono
</I>&gt;&gt;<i> team if useful.  Wondering whether there is some GC debugging can turn on
</I>&gt;&gt;<i> that is useful to the mono team?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks
</I>&gt;&gt;<i> Jonathan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131207/e9ca8c79/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131207/e9ca8c79/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040982.html">[Mono-dev] large performance drop between boehm and sgen for a	parallel app
</A></li>
	<LI>Next message: <A HREF="040984.html">[Mono-dev] large performance drop between boehm and sgen for a	parallel app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40983">[ date ]</a>
              <a href="thread.html#40983">[ thread ]</a>
              <a href="subject.html#40983">[ subject ]</a>
              <a href="author.html#40983">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
