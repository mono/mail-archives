<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] large performance drop between boehm and sgen for a	parallel app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20large%20performance%20drop%20between%20boehm%20and%20sgen%20for%20a%0A%09parallel%20app&In-Reply-To=%3C9143C886-A931-4F09-8F9F-BAA20C5B85D4%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040978.html">
   <LINK REL="Next"  HREF="040983.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] large performance drop between boehm and sgen for a	parallel app</H1>
    <B>Jonathan Shore</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20large%20performance%20drop%20between%20boehm%20and%20sgen%20for%20a%0A%09parallel%20app&In-Reply-To=%3C9143C886-A931-4F09-8F9F-BAA20C5B85D4%40gmail.com%3E"
       TITLE="[Mono-dev] large performance drop between boehm and sgen for a	parallel app">jonathan.shore at gmail.com
       </A><BR>
    <I>Sat Dec  7 17:38:45 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040978.html">[Mono-dev] large performance drop between boehm and sgen for a	parallel app
</A></li>
        <LI>Next message: <A HREF="040983.html">[Mono-dev] large performance drop between boehm and sgen for a parallel app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40982">[ date ]</a>
              <a href="thread.html#40982">[ thread ]</a>
              <a href="subject.html#40982">[ subject ]</a>
              <a href="author.html#40982">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here are the results for a trimmed down version of the problem:

Boehm (default settings)
Performance counter stats for '/opt/mono-3.0/bin/mono-boehm --llvm /home/jonathan/Dev/hf/lib/Debug/FeatureGeneratorCSVFile.exe -info -config etc/samples/orderbook-2013-CX-V11.xml -out features-2013-CX.csv':

   48579862.522506 task-clock                #    9.034 CPUs utilized          
       188,866,824 context-switches          #    0.004 M/sec                  
            46,500 CPU-migrations            #    0.000 M/sec                  
         1,475,427 page-faults               #    0.000 M/sec                  
140,468,865,368,193 cycles                    #    2.892 GHz                    
   &lt;not supported&gt; stalled-cycles-frontend 
   &lt;not supported&gt; stalled-cycles-backend  
80,012,982,451,027 instructions              #    0.57  insns per cycle        
16,967,686,291,478 branches                  #  349.274 M/sec                  
    95,315,728,420 branch-misses             #    0.56% of all branches        

    5377.495775794 seconds time elapsed

SGen (default settings)
Performance counter stats for '/opt/mono-3.0/bin/mono-sgen --llvm /home/jonathan/Dev/hf/lib/Debug/FeatureGeneratorCSVFile.exe -info -config etc/samples/orderbook-2013-CX-V11.xml -out features-2013-CX.csv':

  108414200.651113 task-clock                #    2.049 CPUs utilized          
        65,792,604 context-switches          #    0.001 M/sec                  
            30,536 CPU-migrations            #    0.000 M/sec                  
       309,928,477 page-faults               #    0.003 M/sec                  
263,506,866,481,917 cycles                   #    2.431 GHz                    
   &lt;not supported&gt; stalled-cycles-frontend 
   &lt;not supported&gt; stalled-cycles-backend  
130,560,004,191,686 instructions             #    0.50  insns per cycle        
27,570,367,199,486 branches                  #  254.306 M/sec                  
   382,673,241,515 branch-misses             #    1.39% of all branches        

   52912.358974732 seconds time elapsed

There is a nearly 10x difference in performance between these.  Both were run on 10 cores.   The boehm version achieved a 9 cpu average and the sgen achieved a 2 cpu average + more overhead.


On Dec 5, 2013, at 12:48 PM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:

&gt;<i> Are you running boehm in parallel mode? Can you run perf on your application and email us the translated results?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Thu, Dec 5, 2013 at 11:11 AM, Jonathan Shore &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonathan.shore at gmail.com</A>&gt; wrote:
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I have a complex parallel application which, when run on 10 threads gets very close to 1000% cpu with mono-boehm (linux) consistently (running for hours).   With mono-sgen only achieves  200 - 250% cpu.   This is on a 12 / 24 core machine.   I need to run sgen eventually because run into the 32 bit limit with boehm from time to time.
</I>&gt;<i> 
</I>&gt;<i> Note that this is with a fairly recent version of mono compiled from git sources with llvm enabled.
</I>&gt;<i> 
</I>&gt;<i> It is not an application I can easily box up for analysis on bugzilla due to size of data context, though happy to provide an enviroment to the mono team if useful.  Wondering whether there is some GC debugging can turn on that is useful to the mono team?
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> Jonathan
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131207/842dd4a6/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131207/842dd4a6/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040978.html">[Mono-dev] large performance drop between boehm and sgen for a	parallel app
</A></li>
	<LI>Next message: <A HREF="040983.html">[Mono-dev] large performance drop between boehm and sgen for a parallel app
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40982">[ date ]</a>
              <a href="thread.html#40982">[ thread ]</a>
              <a href="subject.html#40982">[ subject ]</a>
              <a href="author.html#40982">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
