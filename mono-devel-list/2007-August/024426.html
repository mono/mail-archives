<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Remoting serialization problem with array of arrays
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Remoting%20serialization%20problem%20with%20array%20of%20arrays&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024425.html">
   <LINK REL="Next"  HREF="024552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Remoting serialization problem with array of arrays</H1>
    <B>Jae Stutzman</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Remoting%20serialization%20problem%20with%20array%20of%20arrays&In-Reply-To="
       TITLE="[Mono-dev] Remoting serialization problem with array of arrays">jaebird at gmail.com
       </A><BR>
    <I>Mon Aug  6 12:07:20 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024425.html">[Mono-dev] [PATCH] System.Web doesn't compile
</A></li>
        <LI>Next message: <A HREF="024552.html">[Mono-dev] Can't compile with mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24426">[ date ]</a>
              <a href="thread.html#24426">[ thread ]</a>
              <a href="subject.html#24426">[ subject ]</a>
              <a href="author.html#24426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are passing array of array of our custom object (ie not framework) as a
parameter to remote methods. This works fine between to .NET boxes or if the
server is running on mono (linux), but fails if one of the server is running
on windows and client on mono (linux). We are actually using interfaces, but
the behavior is the same.

Example:

Client:
HappyHello[][] hello = ....
testRemoteMethod.Hello(hello);

The exception that is returned is a rethrown exception (coming from the
server) as a serialization error:

  at
System.Runtime.Serialization.Formatters.Binary.ObjectWriter.GetAssemblyNameId(
System.String assembly) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectWriter.GetAssemblyId (
System.Reflection.Assembly assembly) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectWriter.WriteTypeSpec (
System.IO.BinaryWriter writer, System.Type type) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectWriter.WriteGenericArray(
System.IO.BinaryWriter writer, Int64 id, System.Array array) [0x00000]
  at System.Runtime.Serialization.Formatters.Binary.ObjectWriter.WriteArray(
System.IO.BinaryWriter writer, Int64 id, System.Array array) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectWriter.WriteObjectInstance(
System.IO.BinaryWriter writer, System.Object obj, Boolean isValueObject)
[0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectWriter.WriteQueuedObjects(
System.IO.BinaryWriter writer) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectWriter.WriteObjectGraph(
System.IO.BinaryWriter writer, System.Object obj,
System.Runtime.Remoting.Messaging.Header[] headers) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.MessageFormatter.WriteMethodCall(
System.IO.BinaryWriter writer, System.Object obj,
System.Runtime.Remoting.Messaging.Header[] headers, ISurrogateSelector
surrogateSelector, StreamingContext context, FormatterAssemblyStyle
assemblyFormat, FormatterTypeStyle typeFormat) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Serialize (
System.IO.Stream serializationStream, System.Object graph,
System.Runtime.Remoting.Messaging.Header[] headers) [0x00000]
  at
System.Runtime.Remoting.Channels.BinaryClientFormatterSink.SyncProcessMessage(IMessage
msg) [0x00000]

This is what I think is happening: The client is not serializing the
object[][] properly which causes the server to throw the exception. Like I
mentioned above, if the server is running on mono, the windows client
serializes properly and the server does not throw and error. Also, if I
change it to only be one array of HappyHello, the code works fine on both
platforms.

I hope this is clear... I can write a bug for this.

Cheers,

Jae
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070806/d11d2530/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070806/d11d2530/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024425.html">[Mono-dev] [PATCH] System.Web doesn't compile
</A></li>
	<LI>Next message: <A HREF="024552.html">[Mono-dev] Can't compile with mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24426">[ date ]</a>
              <a href="thread.html#24426">[ thread ]</a>
              <a href="subject.html#24426">[ subject ]</a>
              <a href="author.html#24426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
