<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Bugzilla bug #81063 &quot;[ARM] Hit	assertion	in	inssel-float.brg(CEE_STIND_R4) - remoting, ARM,	vfp softfloat&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Bugzilla%20bug%20%2381063%20%22%5BARM%5D%20Hit%0A%09assertion%09in%09inssel-float.brg%28CEE_STIND_R4%29%20-%20remoting%2C%20ARM%2C%0A%09vfp%20softfloat%22&In-Reply-To=20070830111445.GG1101%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024750.html">
   <LINK REL="Next"  HREF="024758.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Bugzilla bug #81063 &quot;[ARM] Hit	assertion	in	inssel-float.brg(CEE_STIND_R4) - remoting, ARM,	vfp softfloat&quot;</H1>
    <B>Dean Jenkins</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Bugzilla%20bug%20%2381063%20%22%5BARM%5D%20Hit%0A%09assertion%09in%09inssel-float.brg%28CEE_STIND_R4%29%20-%20remoting%2C%20ARM%2C%0A%09vfp%20softfloat%22&In-Reply-To=20070830111445.GG1101%40debian.org"
       TITLE="[Mono-dev] Bugzilla bug #81063 &quot;[ARM] Hit	assertion	in	inssel-float.brg(CEE_STIND_R4) - remoting, ARM,	vfp softfloat&quot;">djenkins at mvista.com
       </A><BR>
    <I>Thu Aug 30 08:52:34 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024750.html">[Mono-dev] Bugzilla bug #81063 &quot;[ARM] Hit assertion	in	inssel-float.brg(CEE_STIND_R4) - remoting, ARM, vfp softfloat&quot;
</A></li>
        <LI>Next message: <A HREF="024758.html">[Mono-dev] Bugzilla bug #81063 &quot;[ARM] Hit assertion	in	inssel-float.brg(CEE_STIND_R4) - remoting, ARM, vfp softfloat&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24752">[ date ]</a>
              <a href="thread.html#24752">[ thread ]</a>
              <a href="subject.html#24752">[ subject ]</a>
              <a href="author.html#24752">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi lupus,

BTW. Your E-mail did not contain an attachment. Please can you try
again ? Perhaps add your attachment to the bugzilla bug #81063 ?

Also, I can't access the attachment in bugzilla from the original
reporter of the bug. My Firefox browser wants to save the cgi script and
not the attachment :(

I temporarily removed the asserts in CEE_STIND_R4 and CEE_LDIND_R4 and
put some debug in mono_fstore_r4() and mono_fload_r4(). The helper
functions seem to be containing floats OK when I run my C# test script.
Output from my script seems to be OK.

At the moment I do have access to a XScale platform that uses soft float
in JIT. If you have some test code or code snippets I could integrate it
and do a mono build and test it.

Thanks,

Regards,
Dean.
MontaVista Software Ltd.

On Thu, 2007-08-30 at 13:14 +0200, Paolo Molaro wrote:
&gt;<i> On 08/30/07 Dean Jenkins wrote:
</I>&gt;<i> &gt; I'm running some mono tests and some tests fail due to the assert for
</I>&gt;<i> &gt; CEE_STIND_R4 being reached. There seems to be a float used in
</I>&gt;<i> &gt; System.Runtime.Serialization.Formatters.Binary.ObjectReader.ReadValue in
</I>&gt;<i> &gt; ReadArrayOfPrimitiveType() for case TypeCode.Single and I think that
</I>&gt;<i> &gt; causes the assertion during JIT compilation.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Can anyone explain why CEE_STIND_R4 has no soft float support but
</I>&gt;<i> &gt; CEE_STIND_R8 is supported ?
</I>&gt;<i> 
</I>&gt;<i> By the time we reach the burg rules, all the CEE_STIND_R4 instructions
</I>&gt;<i> should have been removed when in soft-float mode. The reason is that
</I>&gt;<i> values on the evaluation stack are in double precision, because the
</I>&gt;<i> operations on them need to happen with that precision. This in turn
</I>&gt;<i> means that an freg as seen in the burg rules represents a double.
</I>&gt;<i> We can store a double with two simple integer stores, because it's just
</I>&gt;<i> a bit copy. The same cannot happen with a float, because that would
</I>&gt;<i> involve also a change in precision: this change is currently done with
</I>&gt;<i> an helper function (mono_fstore_r4) and at rules selection it's too late
</I>&gt;<i> to emit new function calls.
</I>&gt;<i> 
</I>&gt;<i> &gt; Can anyone offer any solutions or provide some clues for me to fix it ?
</I>&gt;<i> &gt; I'm wondering whether I can just adapt the CEE_STIND_R8 solution but I'm
</I>&gt;<i> &gt; worried there is a technical reason why CEE_STIND_R4 has no soft float
</I>&gt;<i> &gt; support.
</I>&gt;<i> 
</I>&gt;<i> See above for the reasons. I just went over mini.c again searching for
</I>&gt;<i> spots where we might not be handling the R4 case and found more than a
</I>&gt;<i> dozen cases (though some are in corner cases, eventually we need them
</I>&gt;<i> all fixed).
</I>&gt;<i> I have attached the diff with the cases marked with a FIXME: in most
</I>&gt;<i> cases the fix is trivial (like a cut&amp;paste from the code that already
</I>&gt;<i> handles the R4 case correctly): I don't have a ready build/debug env
</I>&gt;<i> for soft-float right now, but if someone can extract a small test case
</I>&gt;<i> from the above bug report and post the output of running
</I>&gt;<i> 	mono -v -v -v -v -v test.exe
</I>&gt;<i> (just the output of the failing method), I can look at fixing that case
</I>&gt;<i> at least.
</I>&gt;<i> 
</I>&gt;<i> lupus
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024750.html">[Mono-dev] Bugzilla bug #81063 &quot;[ARM] Hit assertion	in	inssel-float.brg(CEE_STIND_R4) - remoting, ARM, vfp softfloat&quot;
</A></li>
	<LI>Next message: <A HREF="024758.html">[Mono-dev] Bugzilla bug #81063 &quot;[ARM] Hit assertion	in	inssel-float.brg(CEE_STIND_R4) - remoting, ARM, vfp softfloat&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24752">[ date ]</a>
              <a href="thread.html#24752">[ thread ]</a>
              <a href="subject.html#24752">[ subject ]</a>
              <a href="author.html#24752">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
