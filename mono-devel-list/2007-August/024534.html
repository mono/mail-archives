<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] patch for Mono.Security.Protocol.Ntlm (revisited)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20patch%20for%20Mono.Security.Protocol.Ntlm%20%28revisited%29&In-Reply-To=1187017093.3967.382.camel%40poupou.home">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024505.html">
   <LINK REL="Next"  HREF="024528.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] patch for Mono.Security.Protocol.Ntlm (revisited)</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20patch%20for%20Mono.Security.Protocol.Ntlm%20%28revisited%29&In-Reply-To=1187017093.3967.382.camel%40poupou.home"
       TITLE="[Mono-dev] patch for Mono.Security.Protocol.Ntlm (revisited)">atsushi at ximian.com
       </A><BR>
    <I>Tue Aug 14 21:49:40 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024505.html">[Mono-dev] patch for Mono.Security.Protocol.Ntlm (revisited)
</A></li>
        <LI>Next message: <A HREF="024528.html">[Mono-dev] patch for Mono.Security.Protocol.Ntlm (revisited)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24534">[ date ]</a>
              <a href="thread.html#24534">[ thread ]</a>
              <a href="subject.html#24534">[ subject ]</a>
              <a href="author.html#24534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Sebastien Pouliot wrote:
&gt;<i> On Mon, 2007-08-13 at 23:25 +0900, Atsushi Eno wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Couple of months ago I posted a patch for NTLM authentication
</I>&gt;&gt;<i> which seemed outdated.
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/2007-March/022918.html">http://lists.ximian.com/pipermail/mono-devel-list/2007-March/022918.html</A>
</I>&gt;<i> 
</I>&gt;<i> The patch doesn't include the new files you're adding
</I>&gt;<i> 
</I>&gt;<i> +./Mono.Security.Protocol.Ntlm/NtlmTargetInformation.cs
</I>&gt;<i> +./Mono.Security.Protocol.Ntlm/NtlmVersion.cs
</I>
Oops, attached this time ;)

&gt;&gt;<i> Now I'm revisiting this patch, with some NUnit test breakage fixes
</I>&gt;&gt;<i> (mentioned in the earlier post).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As for TDS testing, today I have been trying to test this NTLM auth
</I>&gt;&gt;<i> with our SqlClient, but I couldn't get it working fine with our
</I>&gt;&gt;<i> (unpatched) code. Should current code work fine?
</I>&gt;<i> 
</I>&gt;<i> It did at one time... but I don't think we have tests to cover this.
</I>&gt;<i> 
</I>&gt;&gt;<i> Part of my code looks like below. I tried with MSDE 2000 (2005
</I>&gt;&gt;<i> Express too, but I heard that it won't work fine either way).
</I>&gt;&gt;<i> I guess I have no problem with this (it worked under .NET 1.x/2.0).
</I>&gt;<i> 
</I>&gt;<i> Things that depends on version, like
</I>&gt;<i> +			Version v = Environment.OSVersion.Version;
</I>&gt;<i> probably won't work under Linux, MacOS X or Solaris (unless MS code
</I>&gt;<i> doesn't interpret the values ?).
</I>
That's true. If it didn't work after successful testing, I'd change
it to have some mimic values.

&gt;&gt;<i> Any suggestions to verify NTLM stuff would be appreciated.
</I>&gt;<i> 
</I>&gt;<i> NTLM is also used for web stuff, so it should be tested with HTTP too.
</I>&gt;<i> Doing a successful &quot;GET /&quot; on a IIS server, configured for &quot;integrated
</I>&gt;<i> security&quot;, should do the trick.
</I>
Ok, I could test it on .NET with the code below:

	WebClient c = new WebClient ();
	c.Credentials = CredentialCache.DefaultCredentials;
	c.DownloadData (http_address);

(without credentials it causes HTTP 401.)

The client didn't work on Mono (because our DefaultCredntials is
empty). Is there a way to create ICredentials for Windows
authentication? (I guess it does not make sense on Linux.)

&gt;<i> Finally, before committing, we must be sure we're not breaking API
</I>&gt;<i> compatibility with earlier releases of Mono.Security.dll.
</I>
I need some types, additional public/family constructors,
Some new properties in Message types and ChallengeResponse type,
and some enum values in NtlmFlags. They wouldn't break backward
compatibility.

The most weird part is that the default NtlmVersion differs between
those messages (v1 for Type2 and Type3, v2 for Type1). I don't like
it, but it is for compatibility.

Atsushi Eno
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: NtlmTargetInformation.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070815/76a4e526/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070815/76a4e526/attachment.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: NtlmVersion.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070815/76a4e526/attachment-0001.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070815/76a4e526/attachment-0001.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024505.html">[Mono-dev] patch for Mono.Security.Protocol.Ntlm (revisited)
</A></li>
	<LI>Next message: <A HREF="024528.html">[Mono-dev] patch for Mono.Security.Protocol.Ntlm (revisited)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24534">[ date ]</a>
              <a href="thread.html#24534">[ thread ]</a>
              <a href="subject.html#24534">[ subject ]</a>
              <a href="author.html#24534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
