<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Marshalling: Bug in StructLayout?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Marshalling%3A%20Bug%20in%20StructLayout%3F&In-Reply-To=200708181620.37842.prakash%40punnoor.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024586.html">
   <LINK REL="Next"  HREF="024588.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Marshalling: Bug in StructLayout?</H1>
    <B>Rolf Bjarne Kvinge</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Marshalling%3A%20Bug%20in%20StructLayout%3F&In-Reply-To=200708181620.37842.prakash%40punnoor.de"
       TITLE="[Mono-dev] Marshalling: Bug in StructLayout?">rolflists at ya.com
       </A><BR>
    <I>Sat Aug 18 10:38:49 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024586.html">[Mono-dev] Marshalling: Bug in StructLayout?
</A></li>
        <LI>Next message: <A HREF="024588.html">[Mono-dev] Marshalling: Bug in StructLayout?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24587">[ date ]</a>
              <a href="thread.html#24587">[ thread ]</a>
              <a href="subject.html#24587">[ subject ]</a>
              <a href="author.html#24587">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:mono-devel-list-
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of Prakash Punnoor
</I>&gt;<i> Sent: s&#225;bado, 18 de agosto de 2007 16:21
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: [Mono-dev] Marshalling: Bug in StructLayout?
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am not sure whether I am making something wrong or mono has a bug.
</I>&gt;<i> Please see attached program. If declare the AVRational struct with
</I>&gt;<i> explicit offsets, it works, otherwise the width member (and following)
</I>&gt;<i> in AVFormatContext are off by 4 bytes.
</I>&gt;<i> 
</I>
Structs may be padded according to the platform you're running on, so it's not a bug.

MSDN says about SequentialLayout: The members of the object are laid out sequentially, in the order in which they appear when exported to unmanaged memory. The members are laid out according to the packing specified in StructLayoutAttribute.Pack, and can be noncontiguous.

You have to use explicit layout (or StructLayoutAttribute.Pack) to get the correct structure on all platforms.

Rolf

&gt;<i> To reproduce: I am on x86_64 Linux (gentoo) using ffmpeg-
</I>&gt;<i> 0.4.9_p20070616-r1 and tao bindings (<A HREF="http://www.taoframework.com/">http://www.taoframework.com/</A>) from
</I>&gt;<i> svn. Unfortunately the binding are not really matching with the ffmpeg
</I>&gt;<i> version I have, so I started duplicating/correcting the structs, as you
</I>&gt;<i> can see in the source files.
</I>&gt;<i> 
</I>&gt;<i> Nevertheless I stumbled across above behaviour.
</I>&gt;<i> 
</I>&gt;<i> I compiled the cs file using
</I>&gt;<i> gmcs ff.cs /lib:/usr/lib64/mono/tao /r:Tao.FFmpeg /out:ff.exe
</I>&gt;<i> 
</I>&gt;<i> Just copy an avi file to the folder with ff.exe, rename the avi to
</I>&gt;<i> &quot;cold.avi&quot;
</I>&gt;<i> and try it out. Instead of the width the height gets printed out, which
</I>&gt;<i> indicates that off by 4 bytes problem. If I set the EXPLICIT define, I
</I>&gt;<i> get correct output
</I>&gt;<i> 
</I>&gt;<i> I compiled mono using gcc 4.2.1, might that be a problem?
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> --
</I>&gt;<i> (&#176;=                 =&#176;)
</I>&gt;<i> //\ Prakash Punnoor /\\
</I>&gt;<i> V_/                 \_V
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024586.html">[Mono-dev] Marshalling: Bug in StructLayout?
</A></li>
	<LI>Next message: <A HREF="024588.html">[Mono-dev] Marshalling: Bug in StructLayout?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24587">[ date ]</a>
              <a href="thread.html#24587">[ thread ]</a>
              <a href="subject.html#24587">[ subject ]</a>
              <a href="author.html#24587">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
