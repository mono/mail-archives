<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mono_config_parse (was: Embedding mono on windows: the	missing (lib)mono.llib)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mono_config_parse%20%28was%3A%20Embedding%20mono%20on%20windows%3A%20the%0A%09missing%20%28lib%29mono.llib%29&In-Reply-To=mailman.9997.1187693247.24950.mono-devel-list%40lists.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024625.html">
   <LINK REL="Next"  HREF="024631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mono_config_parse (was: Embedding mono on windows: the	missing (lib)mono.llib)</H1>
    <B>Sebastian Good</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mono_config_parse%20%28was%3A%20Embedding%20mono%20on%20windows%3A%20the%0A%09missing%20%28lib%29mono.llib%29&In-Reply-To=mailman.9997.1187693247.24950.mono-devel-list%40lists.ximian.com"
       TITLE="[Mono-dev] mono_config_parse (was: Embedding mono on windows: the	missing (lib)mono.llib)">sebastian at palladiumconsulting.com
       </A><BR>
    <I>Tue Aug 21 18:23:31 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024625.html">[Mono-dev] SWF on Quartz (OS X)
</A></li>
        <LI>Next message: <A HREF="024631.html">[Mono-dev] mono_config_parse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24630">[ date ]</a>
              <a href="thread.html#24630">[ thread ]</a>
              <a href="subject.html#24630">[ subject ]</a>
              <a href="author.html#24630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> Date: Tue, 21 Aug 2007 10:30:43 +0200
</I>&gt;<i> From: Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt;
</I>&gt;<i> Subject: Re: [Mono-dev] Embedding mono on windows: the missing
</I>&gt;<i> 	(lib)mono.lib
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Sebastian Good wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> &gt; I am attempting to embed a mono runtime in my C++ application. I'm using 
</I>&gt;&gt;<i> &gt; the standard 1.4.2 mono install (on WinXP) &amp; Visual Studio 2005. I've 
</I>&gt;&gt;<i> &gt; generated the expected C++ compiler flags using
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt;    pkg-config --msvc-syntax --cflags --libs mono
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; And while my simple hello-world embedding application now compiles 
</I>&gt;&gt;<i> &gt; nicely, it fails to link with
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt;    LNK1104: cannot open file 'mono.lib'
</I>&gt;&gt;<i> &gt; 
</I>&gt;&gt;<i> &gt; I can confirm my install has no 'mono.lib', or even 'libmono.lib'. A 
</I>&gt;&gt;<i> &gt; search of this list and other sites suggests this is not all that 
</I>&gt;&gt;<i> &gt; uncommon. People seem to be trying to build mono using Cygwin in order 
</I>&gt;&gt;<i> &gt; to recreate the missing mono.lib (and sometimes running into other 
</I>&gt;&gt;<i> &gt; problems doing that). Am I being a knucklehead or is the standard mono 
</I>&gt;&gt;<i> &gt; Windows install missing this library? Is there an alternative to 
</I>&gt;&gt;<i> &gt; building mono myself? Should I be more interested in the '*.a' files 
</I>&gt;&gt;<i> &gt; sitting in my /lib directory?
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Quick workaround:
</I>&gt;<i>
</I>&gt;<i> mono.def (see attachment) is built during the cygwin
</I>&gt;<i> build process. From this file, you can generate mono.lib
</I>&gt;<i> using MSVC's lib tool:
</I>&gt;<i>
</I>&gt;<i> lib /nologo /machine:x86 /def:mono.def /out:mono.lib
</I>&gt;<i>
</I>&gt;<i> Because the embedded API is stable, i.e. doesn't change often,
</I>&gt;<i> you can use the lib with several Mono versions.
</I>&gt;<i>
</I>&gt;<i> Robert
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An embedded and charset-unspecified text was scrubbed...
</I>&gt;<i> Name: mono.def
</I>&gt;<i> Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070821/e11fb03c/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070821/e11fb03c/attachment.pl</A> 
</I>&gt;<i>   
</I>Thanks very much Robert, this certainly did the trick. All is now linkin 
and even running but failing to find mscorlib, which suggests to me it 
is time to call mono_config_parse. A couple of notes. The samples at 
<A HREF="http://www.mono-project.com/Embedding_Mono">http://www.mono-project.com/Embedding_Mono</A> do not have the proper 
#include directive, which appears to be

    #include &lt;mono/metadata/mono-config.h&gt;

This gets us access to void mono_config_parse(const char *filename), 
though we then fail to link again, with

    error LNK2001: unresolved external symbol &quot;void __cdecl 
mono_config_parse(char const *)&quot;

The .c and .h and Makefiles, as well as the defs file you sent I all 
seem to agree that mono-config.c is linked into mono.dll -- indeed the 
mono_config_parse function is even listed as an entry point in the 
mono.dll I included. I have to say I don't understand why it won't link.

I have tried working around this by setting various environment 
variables (e.g. MONO_PATH, MONO_CFG_DIR, etc.) but all result in the 
runtime error of

    The assembly mscorlib.dll was not found or could not be loaded. It 
should have been installed in the 
'c:\dev\ndi\InteropMonoEmbed\lib\mono\1.0\mscorlib.dll' directory.

It just seems to be looking for a lib relative to the path in which it 
executes. I would be grateful for any hints on how to either 
successfully link to the mono_config_parse (assuming this enables mono 
to find its assemblies) or some way of pointing mono at its own 
assemblies. Many thanks again.

- Sebastian



-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3301 bytes
Desc: S/MIME Cryptographic Signature
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070821/b1ec432f/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070821/b1ec432f/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024625.html">[Mono-dev] SWF on Quartz (OS X)
</A></li>
	<LI>Next message: <A HREF="024631.html">[Mono-dev] mono_config_parse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24630">[ date ]</a>
              <a href="thread.html#24630">[ thread ]</a>
              <a href="subject.html#24630">[ subject ]</a>
              <a href="author.html#24630">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
