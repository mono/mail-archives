<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Exists() and races.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Exists%28%29%20and%20races.&In-Reply-To=200306090802.h5982sh10443%40mono-cvs.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001034.html">
   <LINK REL="Next"  HREF="001039.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Exists() and races.</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Exists%28%29%20and%20races.&In-Reply-To=200306090802.h5982sh10443%40mono-cvs.ximian.com"
       TITLE="[Mono-devel-list] Exists() and races.">lupus at ximian.com
       </A><BR>
    <I>Mon Jun  9 05:34:48 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001034.html">[Mono-devel-list] off by one error in MonoSymbolFile:GetMethodByToken
</A></li>
        <LI>Next message: <A HREF="001039.html">[Mono-devel-list] mbas compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1036">[ date ]</a>
              <a href="thread.html#1036">[ thread ]</a>
              <a href="subject.html#1036">[ subject ]</a>
              <a href="author.html#1036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> --- FileStream.cs	9 Jun 2003 06:48:35 -0000	1.36
</I>&gt;<i> +++ FileStream.cs	9 Jun 2003 08:02:51 -0000	1.37
</I>&gt;<i> @@ -114,7 +114,10 @@
</I>&gt;<i>  			// TODO: demand permissions
</I>&gt;<i>  
</I>&gt;<i>  			MonoIOError error;
</I>&gt;<i> -			
</I>&gt;<i> +
</I>&gt;<i> +  			if (!MonoIO.ExistsDirectory (Path.GetDirectoryName (name), out error))
</I>&gt;<i> +  				throw new DirectoryNotFoundException (Path.GetDirectoryName (name));
</I>&gt;<i> +
</I>&gt;<i>  			this.handle = MonoIO.Open (name, mode, access, share,
</I>&gt;<i>  						   out error);
</I>&gt;<i>  			if (handle == MonoIO.InvalidHandle) {
</I>
I picked this commit, but I think there are other example of the use
of the Exists*() methods that are incorrect.
The if (!MonoIO.ExistsDirectory (...)) test is incorrect: what happens
if the directory is removed between the check and the open? We're still
back at the original bug that this change probably tryed to fix.
The check must be removed, since it's usless and we should make sure
that Open() sets the correct error if the directory is missing and the
DirectoryNotFound exception gets thrown only if Open reports the
directory is missing.

Anyone up to the task of auditing the assemblies for incorrect use of
Exists*() and fixing the issues in the correct way?

Thanks.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001034.html">[Mono-devel-list] off by one error in MonoSymbolFile:GetMethodByToken
</A></li>
	<LI>Next message: <A HREF="001039.html">[Mono-devel-list] mbas compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1036">[ date ]</a>
              <a href="thread.html#1036">[ thread ]</a>
              <a href="subject.html#1036">[ subject ]</a>
              <a href="author.html#1036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
