<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] local file based EventLog implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20local%20file%20based%20EventLog%20implementation&In-Reply-To=03b801c6c47a%243e389e70%240100a8c0%40kornelpal.hu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019972.html">
   <LINK REL="Next"  HREF="019976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] local file based EventLog implementation</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20local%20file%20based%20EventLog%20implementation&In-Reply-To=03b801c6c47a%243e389e70%240100a8c0%40kornelpal.hu"
       TITLE="[Mono-dev] local file based EventLog implementation">gert.driesen at telenet.be
       </A><BR>
    <I>Sun Aug 20 15:52:45 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019972.html">[Mono-dev] local file based EventLog implementation
</A></li>
        <LI>Next message: <A HREF="019976.html">[Mono-dev] local file based EventLog implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19974">[ date ]</a>
              <a href="thread.html#19974">[ thread ]</a>
              <a href="subject.html#19974">[ subject ]</a>
              <a href="author.html#19974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:mono-devel-list-
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of Korn&#233;l P&#225;l
</I>&gt;<i> Sent: zondag 20 augustus 2006 19:01
</I>&gt;<i> To: Gert Driesen; 'Robert Jordan'; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-dev] local file based EventLog implementation
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt; &gt; b) adding EventLogMessages.dll to the binary distributions (for
</I>&gt;<i> &gt;&gt; win32,
</I>&gt;<i> &gt;&gt; &gt; and linux too)
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; If we do not get approval for (b) (not sure why, but could be
</I>&gt;<i> &gt;&gt; &gt; ofcourse), then we could still embed the dll into the System
</I>&gt;<i> &gt;&gt; &gt; assembly
</I>&gt;<i> &gt; &gt; and extract it at runtime (if it doesn't exist yet).  But I'd
</I>&gt;<i> rather
</I>&gt;<i> &gt;&gt; avoid this.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The Debian folks usually don't accept binaries. I wish you good luck
</I>&gt;<i> &gt;&gt; to explain them the difference between a managed DLL, an unmanaged
</I>&gt;<i> &gt;&gt; DLL and an unmanaged DLL consisting of just one PE resource :-)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I think it would indeed be better to either build it at compile time,
</I>&gt;<i> &gt;or if is too difficult to achieve (especially on linux) that we can
</I>&gt;<i> &gt;always embed it. Or as a (very) last resort, do not register one for
</I>&gt;<i> &gt;event sources created from Mono.
</I>&gt;<i> 
</I>&gt;<i> Mono is only &quot;copied&quot; by Debian folks so I think we don't have to
</I>&gt;<i> explain them anything.:) Along with EventLogMessages.dll I posted a
</I>&gt;<i> batch file that builds EventLogMessages.dll. I think that there are
</I>&gt;<i> open scource build tools that can do the same so building is not a big
</I>&gt;<i> deal but those tools are not likely to be installed on non-Windows
</I>&gt;<i> operating systems. If you are really freaking binaries it's quite easy
</I>&gt;<i> to write a managed exeutable that will generate it.:) But as this is
</I>&gt;<i> not a code module you should think of it more like a .png image than a
</I>&gt;<i> .dll library. Or if you prefer it even can be a managed assembly that
</I>&gt;<i> has the appropriate unmanaged resources but that way it will become a
</I>&gt;<i> file containing code as well.
</I>
I'd prefer the &quot;pure&quot; approach, meaning using your original
EventLogMessages.dll. 

But we need approval from Miguel on this.

&gt;<i> &gt;&gt; &gt; In what form should EventLogMessage.dll added to svn (and the
</I>&gt;<i> &gt;&gt; &gt; source
</I>&gt;<i> &gt;&gt; &gt; distributions) ? Can we juist include it as is, or do we need to
</I>&gt;<i> &gt;&gt; build
</I>&gt;<i> &gt;&gt; &gt; it at compile time ?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Please excuse my ignorance, but why on earth do we need
</I>&gt;<i> &gt;&gt; EventLogMessage.dll with its PE resources under Unix?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;It's definitely not needed, but Korn&#233;l proposed to use it on unix too.
</I>&gt;<i> &gt;IT would be nice to have, but not necessary.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;On Windows, I think we should definitely use it. But there it's also
</I>&gt;<i> &gt;not strictly necessary (but more than one unix).
</I>&gt;<i> 
</I>&gt;<i> For Windows: Windows event log requires a message DLL. If you can
</I>&gt;<i> provide a simple test case (that calls Windows API directly) that show
</I>&gt;<i> that no message DLL is required I believe you otherwise I cannot
</I>&gt;<i> because all my experiences and even Platfrom SDK documentation is clear
</I>&gt;<i> that the messages are read from a DLL.
</I>&gt;<i> If I don't set (or delte)
</I>&gt;<i> HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Applicati
</I>&gt;<i> on\&lt;source&gt;\EventMessageFile
</I>&gt;<i> I get the following error message in Event Viewer:
</I>&gt;<i> The description for Event ID (...) in Source (...) cannot be found. The
</I>&gt;<i> local computer may not have the necessary registry information or
</I>&gt;<i> message DLL files to display messages from a remote computer. You may
</I>&gt;<i> be able to use the /AUXSOURCE= flag to retrieve this description; see
</I>&gt;<i> Help and Support for details. The following information is part of the
</I>&gt;<i> event: ...
</I>
Indeed, this matches the behavior I see and suspected. Which means that an
EventLogMessages.dll is not strictly necessary to write event entries, but
ofcourse I'd like to ship one with Mono too !

&gt;<i> So strictly speaking it works (because the function calls succeed) but
</I>&gt;<i> as you can see you will see no message when you use no message DLL.
</I>
You do get the message, it's where you dots are ;-)

&gt;<i> So I think message DLL dependency can hardly be named not strictly
</I>&gt;<i> necessary because the message is an esential part of an event log
</I>&gt;<i> entry.
</I>
I definitely agree with you that we need it to do the right thing. It's just
not necessary to write events, only to read them.

&gt;<i> For Unix (and others):
</I>&gt;<i> Because you are going (or already done) to implement message DLL
</I>&gt;<i> handling on Unix (according to your previous messages using registry)
</I>&gt;<i> as well I think it's quite obvious to use EventLogMessage.dll as well.
</I>&gt;<i> If it's OK for you to use registry on Unix I don't see any reason not
</I>&gt;<i> to use EventLogMessage.dll as well because message DLL can be read and
</I>&gt;<i> written using registry methods and the no message DLL situation should
</I>&gt;<i> have the same result as on Windows.
</I>
Miguel has decided against using the registry on linux, but that doesn't
mean that we cannot use EventLogMessages.dll on unix.

&gt;<i> &gt;&gt; I understand why it's needed for Win32 and even why
</I>&gt;<i> &gt;&gt; Win32 demands it (performance and log file size optimization), but
</I>&gt;<i> &gt;&gt; since MS.NET installs EventLogMessage.dll, no one will ever use
</I>&gt;<i> &gt;&gt; resource DLLs with .NET, IMO. No one wants to deal with MC and RC
</I>&gt;<i> &gt;&gt; just for eventlogging's sake.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;In .NET 2.0, MS provided better support for using message resource
</I>&gt;<i> &gt;dll's, so I'm pretty sure its usage will pick up.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Reading event entries created by event sources that use a message
</I>&gt;<i> &gt;resource has already been implemented (for the win32 implementation).
</I>&gt;<i> 
</I>&gt;<i> If you want to implement message DLL support on non-Windows operating
</I>&gt;<i> systems you should use PE files as well because otherwise it will be
</I>&gt;<i> incompatible with MS.NET for no reason. Managed modules are PE files so
</I>&gt;<i> they can containt PE resources and it somebody uses it's own executable
</I>&gt;<i> or some bundled DLL as messages, event logging will simply not work on
</I>&gt;<i> non-Windows operating systems for no reason, because it contains no
</I>&gt;<i> native code.
</I>
Compatibility is the reason why I started on this implementation, so I'm
completely with you on this.

&gt;<i> As for EventLogMessage.dll: We don't need it. But we need a PE file
</I>&gt;<i> with the same message resources. And I think it's quite easy to use the
</I>&gt;<i> same file name and it improves compatibility as well so I don't see any
</I>&gt;<i> reason to put these resource to System.dll for example instead.
</I>&gt;<i> 
</I>&gt;<i> Gert: If you send me your latest patch I'll have a look at it.
</I>
It's committed in svn (after approval from Miguel). The win32 implementation
is feature complete.

The only thing missing is that we currently do not register an
EventLogMessages.dll (as we do not ship with one).

Let me know if you want me to send a patch to you anyway.

Gert




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019972.html">[Mono-dev] local file based EventLog implementation
</A></li>
	<LI>Next message: <A HREF="019976.html">[Mono-dev] local file based EventLog implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19974">[ date ]</a>
              <a href="thread.html#19974">[ thread ]</a>
              <a href="subject.html#19974">[ subject ]</a>
              <a href="author.html#19974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
