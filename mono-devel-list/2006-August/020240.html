<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Announce%3A%20Mono.Fuse%20%28%2B%20Required%20Mono.Posix%20Changes%29&In-Reply-To=1156989094.4260.33.camel%40melchior.magi">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020255.html">
   <LINK REL="Next"  HREF="020159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Announce: Mono.Fuse (+ Required Mono.Posix Changes)</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Announce%3A%20Mono.Fuse%20%28%2B%20Required%20Mono.Posix%20Changes%29&In-Reply-To=1156989094.4260.33.camel%40melchior.magi"
       TITLE="[Mono-dev] Announce: Mono.Fuse (+ Required Mono.Posix Changes)">lupus at ximian.com
       </A><BR>
    <I>Thu Aug 31 10:29:47 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020255.html">[Mono-dev] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
</A></li>
        <LI>Next message: <A HREF="020159.html">[Mono-dev] Case sensitivity and xbuild
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20240">[ date ]</a>
              <a href="thread.html#20240">[ thread ]</a>
              <a href="subject.html#20240">[ subject ]</a>
              <a href="author.html#20240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/30/06 Jonathan Pryor wrote:
&gt;<i> I'm not entirely sure I see the &quot;compatibility nightmare.&quot;  Nor do I see
</I>&gt;<i> the &quot;million reasons.&quot;  The only reasons I can think of is that there
</I>&gt;<i> are some symbols which should be removed (e.g. the old Mono.Posix
</I>&gt;<i> namespace functions such as &quot;wifexited&quot; and &quot;helper_Mono_Posix_Stat&quot;).
</I>
As I said, none of the functions, structures, data type and preprocessor symbols
defined in the binary MonoPosixHelper shared library and in its private
header files are designed for public consumption. If you count them up
there won't be millions, but still likely thousands:)
None of that will be exported for public use: it's just an internal
implementation detail.

&gt;<i> Con:
</I>&gt;<i>   - Requires more P/Invoke transitions.
</I>&gt;<i>     - One P/Invoke transition to call NativeConvert.FromErrno
</I>&gt;<i>       (done for each delegate invoked).
</I>&gt;<i>     - One P/Invoke transition for each parameter that needs to
</I>&gt;<i>       be converted (e.g. converting the IntPtr into a Stat, above).
</I>&gt;<i>   - Requires adding several new methods to 
</I>&gt;<i>     Mono.Unix.Native.NativeConvert to copy structures between managed
</I>&gt;<i>     and native (e.g. the NativeConvert.Copy() method used above).
</I>
The conversion methods are needed in any case, otherwise Mono.Posix is
useless for all but the trivial cases (the current design requires that
everything is remapped with Mono.Posix's view of constants, so
it ended up including tons of crap APIs... At least including the
conversion methods allows to overcome such design limitations).

&gt;<i> I implemented solution (1) for efficiency reasons -- why invoke extra
</I>&gt;<i> P/Invoke calls when they can be avoided?
</I>&gt;<i> 
</I>&gt;<i> So I implemented (2) for comparison.  The result: to copy a 100000000
</I>&gt;<i> byte file using `cat':
</I>&gt;<i> 
</I>&gt;<i> 	            Average Copy Time
</I>&gt;<i> 	Solution 1:  4.8362s
</I>&gt;<i> 	Solution 2:  4.8613s
</I>&gt;<i> 
</I>&gt;<i> Since FUSE reads file contents in 4KB chunks, there is an average
</I>&gt;<i> overhead of .25us/call using (2).
</I>
Good, so there is not much overhead either: this is so much better than
exposing for public use an unmaintainable API.

&gt;<i> &gt; Sorry, but there is no way to grab the mono-config.h name for this.
</I>&gt;<i> 
</I>&gt;<i> I'm sorry, but I don't understand this comment.
</I>
Any patch that will install a mono-config.h file for use by a library
that is not libmono itself won't be accepted (and even in that case it
won't look like the file you want to install here).

&gt;<i> Regardless, it sounds like you don't want MapAttribute to be a public
</I>&gt;<i> API in any way, and would prefer copy+pasting code between any projects
</I>&gt;<i> that want to make use of the make-map.exe mechanism.
</I>&gt;<i> 
</I>&gt;<i> I'm not entirely fond of extra copy+pasting if not necessary...
</I>&gt;<i> 
</I>&gt;<i> So a question/proposal: could we make make-map.exe/create-native-map
</I>&gt;<i> follow the &quot;Applications Guidelines&quot; for an unstable API to copy
</I>&gt;<i> create-native-map.exe itself and a .cs file for use within that
</I>&gt;<i> application?
</I>&gt;<i> 
</I>&gt;<i> Thus, instead of Mono.Posix.dll exporting a public attribute, we have an
</I>&gt;<i> easier way for people to make use of create-native-map without them
</I>&gt;<i> needing to copy the existing source code (they can instead copy an
</I>&gt;<i> existing binary &amp; update as needed).
</I>
You're trying to expose a private, limited-purpouse and hackish tool
for general use. We can't endorse that, because we'd have to maintain
compatibility of the tool and of its output. Put up a web page, maybe
even use a (separate) svn module in the mono repository, but mcs/ is not
a place for dumping any tool we can think of (especially hackish tools
like make-map.exe).

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020255.html">[Mono-dev] Announce: Mono.Fuse (+ Required Mono.Posix Changes)
</A></li>
	<LI>Next message: <A HREF="020159.html">[Mono-dev] Case sensitivity and xbuild
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20240">[ date ]</a>
              <a href="thread.html#20240">[ thread ]</a>
              <a href="subject.html#20240">[ subject ]</a>
              <a href="author.html#20240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
