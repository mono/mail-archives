<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] vbc compiler treats AscW as CInt with /novbruntimeref
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20vbc%20compiler%20treats%20AscW%20as%20CInt%20with%20/novbruntimeref&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020126.html">
   <LINK REL="Next"  HREF="020129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] vbc compiler treats AscW as CInt with /novbruntimeref</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20vbc%20compiler%20treats%20AscW%20as%20CInt%20with%20/novbruntimeref&In-Reply-To="
       TITLE="[Mono-dev] vbc compiler treats AscW as CInt with /novbruntimeref">kornelpal at gmail.com
       </A><BR>
    <I>Mon Aug 28 03:03:01 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020126.html">[Mono-dev] Debugger
</A></li>
        <LI>Next message: <A HREF="020129.html">[Mono-dev] vbc compiler treats AscW as CInt with /novbruntimeref
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20127">[ date ]</a>
              <a href="thread.html#20127">[ thread ]</a>
              <a href="subject.html#20127">[ subject ]</a>
              <a href="author.html#20127">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

If I compile the attached file:
vbnc /target:library /novbruntimeref novbruntimeref.vb

I get the result that calls to AscW are replaced with the first parameter 
passed to AscW but it is Integer on the stack.

This replacement is done when:
- /novbruntimeref is used
- The called AscW is declared in the code being compiled
- The called AscW is Shared (or is declared in a Module)
- The first argument of the called AscW is ByVal Char

Note that the return value and the other arguments of the called AscW are 
dropped and only the first parameter is preserved on the stack.

Also note that this value is really Integer because invalid conversion 
causes error with type name Integer.

I found this when tried to figure out why Convert.ToInt32 is required in 
AscW. I found no other such hacks (Asc, Chr, ChrW) and I think there are no 
others.

Implementing this in vbnc as well could help the VB runtime.

Korn&#233;l 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: novbruntimeref.vb
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060828/f8a9aea2/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060828/f8a9aea2/attachment.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020126.html">[Mono-dev] Debugger
</A></li>
	<LI>Next message: <A HREF="020129.html">[Mono-dev] vbc compiler treats AscW as CInt with /novbruntimeref
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20127">[ date ]</a>
              <a href="thread.html#20127">[ thread ]</a>
              <a href="subject.html#20127">[ subject ]</a>
              <a href="author.html#20127">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
