<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] New eventlog implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20New%20eventlog%20implementation&In-Reply-To=44E1BAD0.2000707%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019853.html">
   <LINK REL="Next"  HREF="019843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] New eventlog implementation</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20New%20eventlog%20implementation&In-Reply-To=44E1BAD0.2000707%40ximian.com"
       TITLE="[Mono-dev] [PATCH] New eventlog implementation">gert.driesen at telenet.be
       </A><BR>
    <I>Tue Aug 15 08:47:33 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019853.html">[Mono-dev] [PATCH] New eventlog implementation
</A></li>
        <LI>Next message: <A HREF="019843.html">[Mono-dev] Mono Meeting, October 23rd and 24th.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19855">[ date ]</a>
              <a href="thread.html#19855">[ thread ]</a>
              <a href="subject.html#19855">[ subject ]</a>
              <a href="author.html#19855">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Atsushi Eno [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushi at ximian.com</A>]
</I>&gt;<i> Sent: dinsdag 15 augustus 2006 14:15
</I>&gt;<i> To: Gert Driesen
</I>&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-dev] [PATCH] New eventlog implementation
</I>&gt;<i> 
</I>&gt;<i> RunningOnLinux looks extraneous. It could just check the path validity
</I>&gt;<i> and existence of &quot;/var/blah&quot; (besides it is not a precise name, as well
</I>&gt;<i> as UnixEventLog which is very likely be used on Windows).
</I>
On your request, I've already changed its name to LocalFileEventLog locally.

&gt;<i> As for other comments I've already wrote to Gert in #mono.
</I>&gt;<i> 
</I>&gt;<i> In response to Gert's request, my final code review is done above.
</I>&gt;<i> 
</I>&gt;<i> My impression is, the patch is not worthy enough of being checked in,
</I>&gt;<i> as it does almost nothing.
</I>
What do you mean &quot;it does almost nothing&quot; ? It handles eventlog creation and
registration, and does it in a way that exactly matches the MS
implementation. I know this is not a goal by itself, but I consider it to be
positive as it allow us to validate our implementation with unit tests (as I
did extensively in this patch).

I'm not sure I understand all this negativity. I created a good
implementation (which I've run by you first, before I started even working
on it), which is fully covered with unit tests, works seamlessly on both
Windows and Unix, allows us to achieve compatibility with MS.NET and still
allows us flexibility to use other implementations. What more do you want,
really ? 

&gt;<i> The purpose of the patch is to support Windows Event Log on windows.
</I>&gt;<i> It is good, but the patch simply does not work. The code could be
</I>&gt;<i> checked in later, when it became useful enough to read logs.
</I>
Can you explain what does not work ? All my unit tests pass 100% on Mono
(1.0 &amp; 2.0 profile) and MS.NET (1.1 &amp; 2.0).

As I've explained before, you need to:

- remove the event entries that were created by your implementation as it
does not write all necessary information and uses a different naming scheme
for the log files
- first create and event source before you can use it.

	For example:

		If (!EventLog.Exists (&quot;enolog&quot;, &quot;.&quot;))
			EventLog.CreateEventSource (&quot;enosource&quot;, &quot;enolog&quot;);

		....

&gt;<i> (If the purpose is just to support registry, it includes too many
</I>&gt;<i> unnecessary changes. IF I took over the entire event log stuff, I'd
</I>&gt;<i> just revert his changes to whatever I had.)
</I>
Nope, the purpose is not just to support registry. The purpose was to have
something useful that matches the MS implementation (allowing us to check
our implementation against the MS one using unit tests), and still allows us
to have flexibility to use other backend event log providers (such as the
local file implementation).

I don't really see what's wrong with that ? Would you care to explain ?

&gt;<i> Having said that, I don't object if someone approves the patch i.e. I
</I>&gt;<i> don't want to spend my time anymore on this tiny demand on this
</I>&gt;<i> registry based implementation.
</I>
Ok, thx.

Gert

&gt;<i> Gert Driesen wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've finished implementing the eventlog changes and incorporated
</I>&gt;<i> &gt; feedback by Atushi Eno (let me know if there's anything message).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We now have the following environment variables for configuring the
</I>&gt;<i> &gt; eventlog subsystem:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - MONO_EVENTLOG_TYPE for setting the implementation type.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 Possible value are:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 * win32 : read/write entries using the native win32
</I>&gt;<i> &gt;                 eventlog
</I>&gt;<i> &gt;                 * local : read/write entries as files to a local
</I>&gt;<i> &gt;                 directory
</I>&gt;<i> &gt;                 * null  : silently ignore all entries
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 The default is &quot;null&quot;, meaning entries will be
</I>&gt;<i> silently
</I>&gt;<i> &gt;                 ignored.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 If the implementation is set to &quot;local&quot; and
</I>&gt;<i> &gt;                 MONO_EVENTLOG_PATH
</I>&gt;<i> &gt;                 is not set, then the following directory will be used
</I>&gt;<i> &gt;                 for storing eventlog entries:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 * windows : %APPDATA%\mono\eventlog
</I>&gt;<i> &gt;                 * unix    : /var/lib/mono/eventlog
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 On unix, the directory permission for indivual
</I>&gt;<i> eventlog
</I>&gt;<i> &gt;                 log directories is set to 777 (with +t bit) allowing
</I>&gt;<i> &gt;                 everyone to read and write eventlog entries while
</I>&gt;<i> only
</I>&gt;<i> &gt;                 allowing entries to be deleted by the user(s) that
</I>&gt;<i> &gt;                 created them.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - MONO_EVENTLOG_PATH for setting the local file path.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 If set, and MONO_EVENTLOG_IMPL is not set then the
</I>&gt;<i> local
</I>&gt;<i> &gt;                 file implementation is used.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - MONO_REGISTRY_MACHINE for setting the directory to use for storing
</I>&gt;<i> &gt; the machine-level registry hives.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 If not set, then the machine-level registry hives are
</I>&gt;<i> &gt;                 stored in directory .mono/registry relative to the
</I>&gt;<i> &gt;                 user's home directory.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 This applies to HKEY_LOCAL_MACHINE,
</I>&gt;<i> HKEY_CURRENT_CONFIG,
</I>&gt;<i> &gt;                 HKEY_CLASSES_ROOT, HKEY_DYN_DATA,
</I>&gt;<i> HKEY_PERFORMANCE_DATA
</I>&gt;<i> &gt;                 and HKEY_USERS.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For this last environment variable, I'll supply a separate patch once
</I>&gt;<i> &gt; my other registry changes have been approved (to avoid a patch
</I>&gt;<i> nightmare).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; A simple test application for the eventlog subsystem (by courtesy of
</I>&gt;<i> &gt; Atsushi Eno):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; using System;
</I>&gt;<i> &gt; using System.Diagnostics;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; public class Test
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt;   public static void Main ()
</I>&gt;<i> &gt;   {
</I>&gt;<i> &gt;     if (!EventLog.Exists (&quot;enolog&quot;)) {
</I>&gt;<i> &gt;       EventLog.CreateEventSource (&quot;enologue&quot;, &quot;enolog&quot;);
</I>&gt;<i> &gt;     }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     EventLog log = new EventLog (&quot;enolog&quot;, &quot;.&quot;, &quot;enologue&quot;);
</I>&gt;<i> &gt;     foreach (EventLogEntry e in log.Entries)
</I>&gt;<i> &gt;       Console.WriteLine (e.Message);
</I>&gt;<i> &gt;     log.WriteEntry (&quot;My test message.&quot;);
</I>&gt;<i> &gt;   }
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Note: set the MONO_EVENTLOG_TYPE environment variable to &quot;local&quot; if
</I>&gt;<i> &gt; you want the entries to be persisted to the local file store.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Let me know if there's anything that you want me to change, or if
</I>&gt;<i> it's
</I>&gt;<i> &gt; ok to commit as such.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'll update the man page once my patch is approved (but before I
</I>&gt;<i> &gt; commit it).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Best regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Gert
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019853.html">[Mono-dev] [PATCH] New eventlog implementation
</A></li>
	<LI>Next message: <A HREF="019843.html">[Mono-dev] Mono Meeting, October 23rd and 24th.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19855">[ date ]</a>
              <a href="thread.html#19855">[ thread ]</a>
              <a href="subject.html#19855">[ subject ]</a>
              <a href="author.html#19855">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
