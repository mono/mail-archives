<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] local file based EventLog implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20local%20file%20based%20EventLog%20implementation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019984.html">
   <LINK REL="Next"  HREF="019993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] local file based EventLog implementation</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20local%20file%20based%20EventLog%20implementation&In-Reply-To="
       TITLE="[Mono-dev] local file based EventLog implementation">gert.driesen at telenet.be
       </A><BR>
    <I>Mon Aug 21 09:36:13 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019984.html">[Mono-dev] local file based EventLog implementation
</A></li>
        <LI>Next message: <A HREF="019993.html">[Mono-dev] local file based EventLog implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19989">[ date ]</a>
              <a href="thread.html#19989">[ thread ]</a>
              <a href="subject.html#19989">[ subject ]</a>
              <a href="author.html#19989">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
----- Original Message ----- 
From: &quot;Robert Jordan&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt;
To: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Monday, August 21, 2006 2:02 PM
Subject: Re: [Mono-dev] local file based EventLog implementation


&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> Miguel de Icaza wrote:
</I>&gt;&gt;&gt;<i> I'd prefer the &quot;pure&quot; approach, meaning using your original
</I>&gt;&gt;&gt;<i> EventLogMessages.dll.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> But we need approval from Miguel on this.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Someone please send me a summary ;-)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My feeling: I dont know why we need another dll.
</I>&gt;<i>
</I>&gt;<i> 1) The Win32-EventLog doesn't log strings. For performance
</I>&gt;<i>    reasons it logs the resource IDs of strings stored as
</I>&gt;<i>    a PE text resource in a PE-DLL that has to be registered
</I>&gt;<i>    with the EventLog services.
</I>&gt;<i>    The strings may contain substitution symbols (%1, %2 ...),
</I>&gt;<i>    since EventLog's API supports parameter substitution.
</I>&gt;<i>
</I>&gt;<i> 2) Because (1) is not very comprehensible for MS.NET users,
</I>&gt;<i>    MS came up with a brilliant idea to register a dummy
</I>&gt;<i>    DLL (EventLogMessages.dll) consisting of resource strings
</I>&gt;<i>    with a parameter substitution symbol: &quot;%1&quot;.
</I>&gt;<i>
</I>&gt;<i> 3) MS.NET's EventLog class logs the resource ID of the
</I>&gt;<i>    &quot;%1&quot; together with the real message as an argument,
</I>&gt;<i>    simulating the ability to log plain text strings.
</I>&gt;<i>
</I>&gt;<i> 4) Mono's EventLog implementation for Win32 needs the same hack,
</I>&gt;<i>    if its implementation is based on the Win32 EventLog API
</I>&gt;<i>    (it is already).
</I>&gt;<i>
</I>&gt;<i> 5) Mono's EventLog implementation for Unix doesn't need
</I>&gt;<i>    EventLogMessages.dll, because Unix doesn't have an
</I>&gt;<i>    EventLog with the same restrictions like the Win32-EventLog.
</I>&gt;<i>
</I>&gt;<i> 6) MS.NET 2.0 supports registration of resource DLLs and
</I>&gt;<i>    logging by ID.
</I>&gt;<i>    If Mono's EventLog implementation for Unix will support
</I>&gt;<i>    this features, providing EventLogMessages.dll makes sense
</I>&gt;<i>    again, because Mono's internal EventLog is almost Win32
</I>&gt;<i>    compatible and already supports those resource DLLs.
</I>&gt;<i>
</I>&gt;<i> -- end of summary  --
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The question is whether (6) will be feature-complete.
</I>&gt;<i>
</I>&gt;<i> The tool-chain (MC, RC) for creating such DLLs usually doesn't
</I>&gt;<i> exist on Unix, so probably no one is willing to use this API,
</I>&gt;<i> but it could useful for porting existing 2.0 apps.
</I>
Not sure we need a message compiler (mc), other open-source projects (eg. 
log4j) also include the .rc and bin files in the source repository.

To complile the rc file, we could use windres (no?).

&gt;<i> The problem I see is: for the sake of 100% API compatibility
</I>&gt;<i> the full Win32-EventLog has to be simulated on Unix, and,
</I>&gt;<i> because it comes in handy, even the internals of Win32-EventLog
</I>&gt;<i> are simulated (the registry configuration).
</I>
We could use a small (XML) file to store this information for each event 
source (instead of using the unix registry API). Shouldn't take too long.

Our unix eventlog implementation already is API compatible. If you forget 
about the message resource stuff and access to remote eventlogs,  it is even 
feature complete.

It would be great if Korn&#233;l (or anyone else) would want to add support for 
reading strings from a PE messagetable (for unix), but it is not strictly 
required on unix. I'd still very much like it, ofcourse.

&gt;<i> Not to speak about the need of a viewer for this logs, because otherwise 
</I>&gt;<i> the entries
</I>&gt;<i> were unreadable. All this for a small range of applications
</I>&gt;<i> that use custom message DLLs.
</I>
I've already written a small SWF viewer for the eventlog (which still needs 
a lot of love). The eventlog API is very simple, it shouldn't take more than 
a few days to have a great event viewer that also supports event source 
creation &amp; deletion.

&gt;<i> I don't like this, but of course I fully respect the work
</I>&gt;<i> already done! I'd rather blame MS because its 2.0 EventLog
</I>&gt;<i> implementation became even more Win32-centric.
</I>
I don't think the 2.0 implementation is more win32-centric. It just exposes 
more functionality of the win32 eventlog.

To ensure interoperability (with .NET and native win32 applications) we 
should indeed use a PE dll on Windows, but we could still implement it in a 
non-win32 specific way for unix (using, for example, managed resource 
assemblies). But that would make the resource dlls non-interoperable between 
Mono/Unix and Windows.

Gert


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019984.html">[Mono-dev] local file based EventLog implementation
</A></li>
	<LI>Next message: <A HREF="019993.html">[Mono-dev] local file based EventLog implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19989">[ date ]</a>
              <a href="thread.html#19989">[ thread ]</a>
              <a href="subject.html#19989">[ subject ]</a>
              <a href="author.html#19989">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
