<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] SmtpClient only supports ESMTP?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SmtpClient%20only%20supports%20ESMTP%3F&In-Reply-To=1180561944.21642.153.camel%40tazmanian-devil.boston.novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023756.html">
   <LINK REL="Next"  HREF="023739.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] SmtpClient only supports ESMTP?</H1>
    <B>Mads Bondo Dydensborg</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SmtpClient%20only%20supports%20ESMTP%3F&In-Reply-To=1180561944.21642.153.camel%40tazmanian-devil.boston.novell.com"
       TITLE="[Mono-dev] SmtpClient only supports ESMTP?">mbd at dbc.dk
       </A><BR>
    <I>Thu May 31 06:40:16 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023756.html">[Mono-dev] SmtpClient only supports ESMTP?
</A></li>
        <LI>Next message: <A HREF="023739.html">[Mono-dev] mono for arm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23765">[ date ]</a>
              <a href="thread.html#23765">[ thread ]</a>
              <a href="subject.html#23765">[ subject ]</a>
              <a href="author.html#23765">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>onsdag 30 maj 2007 23:52 skrev Jeffrey Stedfast:
&gt;<i> On Wed, 2007-05-30 at 12:12 +0200, Mads Bondo Dydensborg wrote:
</I>&gt;<i> &gt; Hi there
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Regrettable I &quot;crashed&quot; into a smtp server today, that does not support 
</I>ESMTP, 
&gt;<i> &gt; but only SMTP (some old kind of exchange server, I think).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It seems that System.Net.Mail.SmtpClient only supports ESMTP - is this 
</I>true? 
&gt;<i> &gt; Any plans for supporting SMTP also?
</I>&gt;<i> 
</I>&gt;<i> I've just committed a fix to make it work for non-ESMTP servers (as well
</I>&gt;<i> as a few fixes for other low-hanging fruit that I spotted while browsing
</I>&gt;<i> thru the code).
</I>
Fantastic!

Thanks a lot. 

An additional bit of information: Turns out the SMTP server I was talking to, 
is a piece of anti-virus software running in front of the real mail server. 
Just to clear Exchange of any accusations on my part. Also, the program I am 
running is nlog (nlog-project.org) which is compiled to use 
System.Net.Mail.SmtpClient. Makes a bit annoying to try and use another 
component.

However, your fix does not work with the SMTP &quot;server&quot; I am running against. 
Here is a stacktrace:

2007-05-31 12:00:15.5294 Error Target exception: 
System.Net.Mail.SmtpException: 500 Syntax error, command unrecognized
  at System.Net.Mail.SmtpClient.Authenticate (System.String Username, 
System.String Password) [0x000a4] 
in /home/compile/Compile/Mono/mcs/class/System/System.Net.Mail/Smtp
Client.cs:678
  at System.Net.Mail.SmtpClient.PerformAuthentication () [0x00074] 
in /home/compile/Compile/Mono/mcs/class/System/System.Net.Mail/SmtpClient.cs:657
  at System.Net.Mail.SmtpClient.Send (System.Net.Mail.MailMessage message) 
[0x000ec] 
in /home/compile/Compile/Mono/mcs/class/System/System.Net.Mail/SmtpClient.cs:308
 
The &quot;server&quot; does not support authentication. Looking at the code, it seem 
there are a couple of FIXME related to this. A question: if the code has to 
fall back on HELO, can we safely assume that no extensions exists? My 
understanding of SMTP suggests this. This could be a quick fix for the SMTP 
case, although auth and other still needs to be determined for the ESMTP 
case.

Attached is a patch against current svn that does exactly this: for ESMTP it 
assumes that Auth and TLS works (as now), for SMTP it assumes they do not. 
This fixes my problem (mail is now beeing sent, and received), but is 
untested on real ESMTP servers (don't have one handy, would require some 
firewall fiddling). Please let me know if you can accept this almost trivial 
patch.

Regards,

Mads


&gt;<i> 
</I>&gt;<i> Jeff
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
Med venlig hilsen/Regards

Systemudvikler/Systemsdeveloper cand.scient.dat, Ph.d., Mads Bondo Dydensborg
Dansk BiblioteksCenter A/S, Tempovej 7-11, 2750 Ballerup, Tlf. +45 44 86 77 34
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SmtpClient.cs.patch
Type: text/x-diff
Size: 1156 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070531/27c7754f/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070531/27c7754f/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023756.html">[Mono-dev] SmtpClient only supports ESMTP?
</A></li>
	<LI>Next message: <A HREF="023739.html">[Mono-dev] mono for arm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23765">[ date ]</a>
              <a href="thread.html#23765">[ thread ]</a>
              <a href="subject.html#23765">[ subject ]</a>
              <a href="author.html#23765">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
