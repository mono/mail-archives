<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Monodoc patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Monodoc%20patch&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022828.html">
   <LINK REL="Next"  HREF="022861.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Monodoc patch</H1>
    <B>Kevin Reay</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Monodoc%20patch&In-Reply-To="
       TITLE="[Mono-dev] Monodoc patch">kevintreay at gmail.com
       </A><BR>
    <I>Thu Mar 15 03:14:19 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022828.html">[Mono-dev] OT: Mac OSX Tester needed For an NUnit bug
</A></li>
        <LI>Next message: <A HREF="022861.html">[Mono-dev] Monodoc patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22831">[ date ]</a>
              <a href="thread.html#22831">[ thread ]</a>
              <a href="subject.html#22831">[ subject ]</a>
              <a href="author.html#22831">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm wondering if I could get someone to look at the following patch
I've crafted to fix some bugs and add some features to the monodoc
tool. The patch is against subversion revision 74230 (current trunk).
I'm not sure if these should be grouped together in one patch; if the
expectation is different, please let me know.

The patch changes the following things:
- Fixes bug 80575 (<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=80575">http://bugzilla.ximian.com/show_bug.cgi?id=80575</A>)
(missing compare for null class reference)
- Groups contribution-specific functionality to new dedicated menu (to
allow for more contribution specific functionality in the future)
- Adds contributor statistics feature
- A few minor code tweaks/nitpicks

Also, I uploaded to updates to the class doc. I'm just wondering if
anyone has had a chance to read them over. I'd like to know if I
should continue documenting things in that style.

Finally, I'm hoping to add some new contributor features (thus the
creation of the Contributing menu) and would like anyones opinion on
whether the creation of a small list window to display the
contributions pending for upload would be something people would want.
It is something I would use.

Thanks,
Kevin Reay

Ps, I've attached the patch, as well as uploaded it
(<A HREF="http://www.explodingrobot.com/mono/monodoc.patch0.txt">http://www.explodingrobot.com/mono/monodoc.patch0.txt</A>) in case the
mailing list strips attachments. Code released with whatever license
is necessary, of course (MIT X11 is fine).
-------------- next part --------------
Index: browser.cs
===================================================================
--- browser.cs	(revision 74230)
+++ browser.cs	(working copy)
@@ -826,14 +826,14 @@
 		// postcomment.Sensitive = comments1.Active;
 
 		// refresh, so we can see the comments
-		if (CurrentTab.history != null) // catch the case when we are currently loading
+		if (CurrentTab != null &amp;&amp; CurrentTab.history != null) // catch the case when we are currently loading
 			CurrentTab.history.ActivateCurrent ();
 	}
 	
 	void OnInheritedMembersActivate (object o, EventArgs args)
 	{
 		SettingsHandler.Settings.ShowInheritedMembers = showinheritedmembers.Active;
-		if (CurrentTab.history != null) // catch the case when we are currently loading
+		if (CurrentTab != null &amp;&amp; CurrentTab.history != null) // catch the case when we are currently loading
 			CurrentTab.history.ActivateCurrent ();
 	}
 
@@ -842,7 +842,7 @@
 		SettingsHandler.Settings.EnableEditing = editing1.Active;
 
 		// refresh, so we can see the [edit] things
-		if (CurrentTab != null) // catch the case when we are currently loading
+		if (CurrentTab != null &amp;&amp; CurrentTab.history != null) // catch the case when we are currently loading
 			CurrentTab.history.ActivateCurrent ();
 	}
 	
@@ -873,7 +873,6 @@
 	//
 	// Invoked when the user presses a key on the index_entry
 	//
-
 	public void OnIndexEntryKeyPress (object o, KeyPressEventArgs args)
 	{
 		args.RetVal = true;
@@ -1368,7 +1367,113 @@
 		}
 	}
 
+	void OnContributionStatistics (object sender, EventArgs a)
+	{
+		string email = SettingsHandler.Settings.Email;
+		string key = SettingsHandler.Settings.Key;
+		
+		if (key == null || key == &quot;&quot;) {
+			MessageDialog md = new MessageDialog (null, 
+							      DialogFlags.DestroyWithParent,
+							      MessageType.Info, 
+							      ButtonsType.Close, 
+				                  &quot;You have not obtained or used a contribution key yet.&quot;);
+			md.Title = &quot;No contribution key&quot;;
+			
+			md.Run();
+			md.Destroy();
+		}
+		else
+			ContributionStatus.GetStatus (email, key);
+	}
+	
+	class ContributionStatus {
+		enum State {
+			GetStatusError,
+			NetworkError,
+			Done
+		}
 
+		State state;
+		Status status;
+		string contributoremail;
+		
+		ThreadNotify tn;
+		WebClientAsyncResult war;
+		ContributionsSoap d;
+		
+		public static void GetStatus (string email, string key)
+		{
+			new ContributionStatus(email, key);
+		}
+		
+		ContributionStatus (string email, string key)
+		{
+			tn = new ThreadNotify (new ReadyEvent (Update));
+			
+			d = new ContributionsSoap ();
+			if (Environment.GetEnvironmentVariable (&quot;MONODOCTESTING&quot;) == null)
+				d.Url = &quot;<A HREF="http://www.go-mono.com/docs/server.asmx&quot;;">http://www.go-mono.com/docs/server.asmx&quot;;</A>
+				
+			war = (WebClientAsyncResult) d.BeginGetStatus (email, key, new AsyncCallback (GetStatusDone), null);
+			contributoremail = email;
+		}
+		
+		void Update ()
+		{
+			MessageDialog md = null;
+			
+			switch (state) {
+			case State.GetStatusError:
+				md = new MessageDialog (null, 
+					              DialogFlags.DestroyWithParent,
+							      MessageType.Error, ButtonsType.Close, 
+				                  &quot;Server returned error while requesting contributor statistics&quot;);
+				md.Title = &quot;Contribution Statistics Error Occurred&quot;;
+				break;
+			case State.NetworkError:
+				md = new MessageDialog (null, 
+					              DialogFlags.DestroyWithParent,
+							      MessageType.Error, ButtonsType.Close, 
+				                  &quot;Network error occurred while requesting contributor statistics&quot;);
+				md.Title = &quot;Contribution Statistics Error Occurred&quot;;
+				break;
+			case State.Done:
+				md = new MessageDialog (null, 
+					              DialogFlags.DestroyWithParent,
+							      MessageType.Info, ButtonsType.Close, 
+				                  &quot;Contribution statistics for &quot; + contributoremail +
+					              &quot;\n\nTotal contributions: &quot; + status.Contributions +
+					              &quot;\nContributions committed: &quot; + status.Commited +
+					              &quot;\nContributions pending: &quot; + status.Pending);
+				md.Title = &quot;Contribution Statistics&quot;;
+				break;
+			}
+
+			md.Run();
+			md.Destroy();
+		}
+				
+		void GetStatusDone (IAsyncResult iar)
+		{
+			try {
+				status = d.EndGetStatus (iar);
+				war = null;
+
+				if (status == null)
+					state = State.GetStatusError;
+				else
+					state = State.Done;
+
+			} catch (Exception e) {
+				state = State.NetworkError;
+				Console.WriteLine (&quot;Error getting status: &quot; + e);
+			}
+			if (tn != null)
+				tn.WakeupMain ();
+		}	
+	}
+
 	class NewComment {
 		[Glade.Widget] Window newcomment;
 		[Glade.Widget] Entry entry;
Index: ChangeLog
===================================================================
--- ChangeLog	(revision 74230)
+++ ChangeLog	(working copy)
@@ -1,3 +1,9 @@
+2007-03-15  Kevin Reay  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kevintreay at gmail.com</A>&gt;
+
+	* browser.cs: Fix #80575. Add missing check for null CurrentTab.
+	* browser.glade: Added Contributing menu. Reordered some menu items.
+	* browser.cs: Added contributor statistics feature.
+
 2006-12-19  Ankit Jain  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jankit at novell.com</A>&gt;
 
 	* browser.cs (Main): Add a &quot;--remote-mode&quot; option and implement. With 
Index: browser.glade
===================================================================
--- browser.glade	(revision 74230)
+++ browser.glade	(working copy)
@@ -83,16 +83,6 @@
 		  &lt;/child&gt;
 
 		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;contributor_settings1&quot;&gt;
-		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_Upload Contributions&lt;/property&gt;
-		      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-		      &lt;signal name=&quot;activate&quot; handler=&quot;OnUpload&quot; last_modification_time=&quot;Wed, 08 Oct 2003 02:53:43 GMT&quot;/&gt;
-		      &lt;accelerator key=&quot;U&quot; modifiers=&quot;GDK_CONTROL_MASK&quot; signal=&quot;activate&quot;/&gt;
-		    &lt;/widget&gt;
-		  &lt;/child&gt;
-
-		  &lt;child&gt;
 		    &lt;widget class=&quot;GtkImageMenuItem&quot; id=&quot;print&quot;&gt;
 		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 		      &lt;property name=&quot;label&quot;&gt;gtk-print&lt;/property&gt;
@@ -189,22 +179,6 @@
 		      &lt;accelerator key=&quot;A&quot; modifiers=&quot;GDK_CONTROL_MASK&quot; signal=&quot;activate&quot;/&gt;
 		    &lt;/widget&gt;
 		  &lt;/child&gt;
-
-		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;separator1&quot;&gt;
-		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		    &lt;/widget&gt;
-		  &lt;/child&gt;
-
-		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkCheckMenuItem&quot; id=&quot;editing1&quot;&gt;
-		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Editing&lt;/property&gt;
-		      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;active&quot;&gt;False&lt;/property&gt;
-		      &lt;signal name=&quot;activate&quot; handler=&quot;OnEditingActivate&quot; last_modification_time=&quot;Fri, 03 Oct 2003 22:44:59 GMT&quot;/&gt;
-		    &lt;/widget&gt;
-		  &lt;/child&gt;
 		&lt;/widget&gt;
 	      &lt;/child&gt;
 	    &lt;/widget&gt;
@@ -268,6 +242,53 @@
 	  &lt;/child&gt;
 
 	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;contributingMenu&quot;&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_Contributing&lt;/property&gt;
+	      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
+
+	      &lt;child&gt;
+		&lt;widget class=&quot;GtkMenu&quot; id=&quot;contributingMenu_menu&quot;&gt;
+		  &lt;child&gt;
+		    &lt;widget class=&quot;GtkCheckMenuItem&quot; id=&quot;editing1&quot;&gt;
+		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+		      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Edit Mode&lt;/property&gt;
+		      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
+		      &lt;property name=&quot;active&quot;&gt;False&lt;/property&gt;
+		      &lt;signal name=&quot;activate&quot; handler=&quot;OnEditingActivate&quot; last_modification_time=&quot;Fri, 03 Oct 2003 22:44:59 GMT&quot;/&gt;
+		    &lt;/widget&gt;
+		  &lt;/child&gt;
+
+		  &lt;child&gt;
+		    &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;separator1&quot;&gt;
+		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+		    &lt;/widget&gt;
+		  &lt;/child&gt;
+
+		  &lt;child&gt;
+		    &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;contributor_settings1&quot;&gt;
+		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+		      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_Upload Contributions&lt;/property&gt;
+		      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
+		      &lt;signal name=&quot;activate&quot; handler=&quot;OnUpload&quot; last_modification_time=&quot;Wed, 08 Oct 2003 02:53:43 GMT&quot;/&gt;
+		      &lt;accelerator key=&quot;U&quot; modifiers=&quot;GDK_CONTROL_MASK&quot; signal=&quot;activate&quot;/&gt;
+		    &lt;/widget&gt;
+		  &lt;/child&gt;
+
+		  &lt;child&gt;
+		    &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;contributor_statistics1&quot;&gt;
+		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+		      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_View Contribution Statistics&lt;/property&gt;
+		      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
+		      &lt;signal name=&quot;activate&quot; handler=&quot;OnContributionStatistics&quot; last_modification_time=&quot;Wed, 08 Oct 2003 02:53:43 GMT&quot;/&gt;
+		    &lt;/widget&gt;
+		  &lt;/child&gt;
+		&lt;/widget&gt;
+	      &lt;/child&gt;
+	    &lt;/widget&gt;
+	  &lt;/child&gt;
+
+	  &lt;child&gt;
 	    &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menuitem7&quot;&gt;
 	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 	      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_Help&lt;/property&gt;
Index: BookmarkManager.cs
===================================================================
--- BookmarkManager.cs	(revision 74230)
+++ BookmarkManager.cs	(working copy)
@@ -324,10 +324,11 @@
 		public BookmarkManager (Browser browser){
 			_Browser = browser;
 			
-			
+			#if DEBUG
 			Console.WriteLine (&quot;Bookmark Manager init&quot;);
+			#endif
 
-			//discoverig bookmark file
+			// discovering bookmark file
 			bookmark_file = Environment.GetFolderPath (Environment.SpecialFolder.ApplicationData);
 			bookmark_file = System.IO.Path.Combine (bookmark_file, &quot;monodoc&quot;);
 			bookmark_file = System.IO.Path.Combine (bookmark_file, &quot;bookmarks.xml&quot;);
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022828.html">[Mono-dev] OT: Mac OSX Tester needed For an NUnit bug
</A></li>
	<LI>Next message: <A HREF="022861.html">[Mono-dev] Monodoc patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22831">[ date ]</a>
              <a href="thread.html#22831">[ thread ]</a>
              <a href="subject.html#22831">[ subject ]</a>
              <a href="author.html#22831">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
