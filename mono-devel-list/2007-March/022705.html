<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for Math.cs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20Math.cs&In-Reply-To=117799f00703041602s17916e28u993ccdbb21c87a2e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022704.html">
   <LINK REL="Next"  HREF="022771.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for Math.cs</H1>
    <B>Cetin Sert</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20Math.cs&In-Reply-To=117799f00703041602s17916e28u993ccdbb21c87a2e%40mail.gmail.com"
       TITLE="[Mono-dev] Patch for Math.cs">cetin.sert at gmail.com
       </A><BR>
    <I>Sun Mar  4 19:47:44 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022704.html">[Mono-dev] Patch for Math.cs
</A></li>
        <LI>Next message: <A HREF="022771.html">[Mono-dev] Patch for Math.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22705">[ date ]</a>
              <a href="thread.html#22705">[ thread ]</a>
              <a href="subject.html#22705">[ subject ]</a>
              <a href="author.html#22705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi I just checked the IL codes of these methods:

 

private static bool TestIf(int value)

{

    if (value &gt; 0)

        return true;

    else

        return false;

}

 

private static bool TestTurnary(int value)

{

    return value &gt; 0 ? true : false;

}

 

and got these from Lutz Roeder&#146;s famous .NET Reflector (5.0.5.0):

 


.method private hidebysig static
&lt;<A HREF="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.">http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.</A>
0.0:b77a5c561934e089/System.Boolean&gt; bool
&lt;<A HREF="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://ILComparison:">http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://ILComparison:</A>
1.0.0.0/ILComparison.Program/TestIf(Int32):Boolean&gt; TestIf(
&lt;<A HREF="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.">http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.</A>
0.0:b77a5c561934e089/System.Int32&gt; int32 'value') cil managed
{
    .maxstack 8
    L_0000: ldarg.0 
    L_0001: ldc.i4.0 
    L_0002: ble.s L_0006
    L_0004: ldc.i4.1 
    L_0005: ret 
    L_0006: ldc.i4.0 
    L_0007: ret 
}

 

	

.method private hidebysig static
&lt;<A HREF="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.">http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.</A>
0.0:b77a5c561934e089/System.Boolean&gt; bool
&lt;<A HREF="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://ILComparison:">http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://ILComparison:</A>
1.0.0.0/ILComparison.Program/TestTurnary(Int32):Boolean&gt; TestTurnary(
&lt;<A HREF="http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.">http://www.aisto.com/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.</A>
0.0:b77a5c561934e089/System.Int32&gt; int32 'value') cil managed
{
    .maxstack 8
    L_0000: ldarg.0 
    L_0001: ldc.i4.0 
    L_0002: bgt.s L_0006
    L_0004: ldc.i4.0 
    L_0005: ret 
    L_0006: ldc.i4.1 
    L_0007: ret 
}

 

	

As you can see, there is nothing that might cause a performance difference.
It&#146;s only the order of things that&#146;s different.

 

From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Alan McGovern
Sent: Montag, 5. M&#228;rz 2007 01:03
To: Dennis Hayes
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-dev] Patch for Math.cs

 

Just out of interest, could you check the performance of the method if you
change code patterns like:

if (value &gt; 0)
     return Floor (value + 0.5);
else
     return Ceiling (value - 0.5);

to:

return (value &gt; 0) ? Floor(value+0.5) : Ceiling(value - 0.5);

When i was profiling stuff before i think there was a performance boost when
using the turnary form, I may be wrong though. If it does turn out to be
faster, you could make that change to. If it isn't, no worries. 

Alan.



On 3/4/07, Dennis Hayes &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">denisraytek at yahoo.com</A>&gt; wrote:

This is a minor clean up of Math.cs.

Basicly, in the methods that use MidpointRounding Mode, it moves the check
for a valid mode to the end of the method.

 

Since the mode is checked in the method, doing this eliminates the extra
check. Also, the check should never fail, since an enum is being passed in.
This will make the code a little faster. 

 

I don't have svn access setup, so I need someone to check this in also.

 

I did not include any tests, because this should not have added or modifyed
anything testable. 

 

Should I do anything elseor do anything differently?

Would this be better as a switch?

Thanks,

Dennis

  _____  

Need a quick answer? Get one in minutes from people who know. Ask your
question on Yahoo! Answers
&lt;<A HREF="http://answers.yahoo.com/;_ylc=X3oDMTFvbGNhMGE3BF9TAzM5NjU0NTEwOARfcwMzOTY1">http://answers.yahoo.com/;_ylc=X3oDMTFvbGNhMGE3BF9TAzM5NjU0NTEwOARfcwMzOTY1</A>
NDUxMDMEc2VjA21haWxfdGFnbGluZQRzbGsDbWFpbF90YWcx&gt; .
--0-164504892-1173052624=:24413--


Index: Math.cs
===================================================================
--- Math.cs     (revision 73696)
+++ Math.cs     (working copy)
@@ -373,27 +373,27 @@ 
               [MonoTODO (&quot;Not implemented&quot;)]
               public static decimal Round (decimal d, MidpointRounding
mode)
               {
-                       if ((mode != MidpointRounding.ToEven ) &amp;&amp; (mode !=
MidpointRounding.AwayFromZero))
-                               throw new ArgumentException (&quot;The value '&quot; +
mode + &quot;' is not valid for this usage of the type MidpointRounding.&quot;,
&quot;mode&quot;); 
-
                       if (mode == MidpointRounding.ToEven)
                               return Round (d);
-                       throw new NotImplementedException ();
+                       if (mode == MidpointRounding.AwayFromZero)
+                           throw new NotImplementedException ();
+
+                       throw new ArgumentException (&quot;The value '&quot; + mode +
&quot;' is not valid for this usage of the type MidpointRounding.&quot;, &quot;mode&quot;); 
               }

               [MonoTODO (&quot;Not implemented&quot;)]
               public static decimal Round (decimal d, int decimals,
MidpointRounding mode)
               {
-                       if ((mode != MidpointRounding.ToEven) &amp;&amp; (mode !=
MidpointRounding.AwayFromZero))
-                               throw new ArgumentException (&quot;The value '&quot; +
mode + &quot;' is not valid for this usage of the type MidpointRounding.&quot;,
&quot;mode&quot;); 
-
                       if (mode == MidpointRounding.ToEven)
                               return Round (d, decimals);
-                       throw new NotImplementedException ();
+                       if (mode == MidpointRounding.AwayFromZero)
+                           throw new NotImplementedException ();
+
+                       throw new ArgumentException (&quot;The value '&quot; + mode +
&quot;' is not valid for this usage of the type MidpointRounding.&quot;, &quot;mode&quot;); 
               }
 #endif

-               [MethodImplAttribute (MethodImplOptions.InternalCall)]
+        [MethodImplAttribute (MethodImplOptions.InternalCall)]
               public extern static double Round (double d); 

               public static double Round (double value, int digits)
@@ -411,26 +411,25 @@
 #if NET_2_0
               public static double Round (double value, MidpointRounding
mode)
               { 
-                       if ((mode != MidpointRounding.ToEven) &amp;&amp; (mode !=
MidpointRounding.AwayFromZero))
-                               throw new ArgumentException (&quot;The value '&quot; +
mode + &quot;' is not valid for this usage of the type MidpointRounding.&quot;,
&quot;mode&quot;); 
-
                       if (mode == MidpointRounding.ToEven)
                               return Round (value);
                       if (value &gt; 0)
                               return Floor (value + 0.5);
                       else
                               return Ceiling (value - 0.5);
+
+                       throw new ArgumentException (&quot;The value '&quot; + mode +
&quot;' is not valid for this usage of the type MidpointRounding.&quot;, &quot;mode&quot;); 
               }

               [MonoTODO (&quot;Not implemented&quot;)]
               public static double Round (double value, int digits,
MidpointRounding mode)
               {
-                       if ((mode != MidpointRounding.ToEven) &amp;&amp; (mode !=
MidpointRounding.AwayFromZero))
-                               throw new ArgumentException (&quot;The value '&quot; +
mode + &quot;' is not valid for this usage of the type MidpointRounding.&quot;,
&quot;mode&quot;); 
-
-                       if (mode == MidpointRounding.ToEven)
+            if (mode == MidpointRounding.ToEven)
                               return Round (value, digits);
-                       throw new NotImplementedException (); 
+                       if (mode == MidpointRounding.ToEven)
+                           throw new NotImplementedException ();
+
+                       throw new ArgumentException (&quot;The value '&quot; + mode +
&quot;' is not valid for this usage of the type MidpointRounding.&quot;, &quot;mode&quot;); 
               }

               public static double Truncate (double d)
@@ -454,7 +453,7 @@
               }
 #endif

-               public static int Sign (decimal value)
+        public static int Sign (decimal value) 
               {
                       if (value &gt; 0) return 1;
                       return (value == 0)? 0: -1;

_______________________________________________
Mono-devel-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070305/c958125a/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070305/c958125a/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022704.html">[Mono-dev] Patch for Math.cs
</A></li>
	<LI>Next message: <A HREF="022771.html">[Mono-dev] Patch for Math.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22705">[ date ]</a>
              <a href="thread.html#22705">[ thread ]</a>
              <a href="subject.html#22705">[ subject ]</a>
              <a href="author.html#22705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
