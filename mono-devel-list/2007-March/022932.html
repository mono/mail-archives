<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for IPAddress.cs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20IPAddress.cs&In-Reply-To=13150-58778%40sneakemail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022986.html">
   <LINK REL="Next"  HREF="022917.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for IPAddress.cs</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20IPAddress.cs&In-Reply-To=13150-58778%40sneakemail.com"
       TITLE="[Mono-dev] Patch for IPAddress.cs">miguel at novell.com
       </A><BR>
    <I>Sun Mar 25 12:46:31 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022986.html">[Mono-dev] Patch for IPAddress.cs
</A></li>
        <LI>Next message: <A HREF="022917.html">[Mono-dev] Mono's BitConverter.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22932">[ date ]</a>
              <a href="thread.html#22932">[ thread ]</a>
              <a href="subject.html#22932">[ subject ]</a>
              <a href="author.html#22932">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

&gt;<i> x86 actually has an instruction whose sole purpose is to invert the byte
</I>&gt;<i> order of a 32-bit value. Look up BSWAP. It requires at least a 486, though.
</I>&gt;<i> Does mono otherwise run on 386 CPUs presently? If it is okay to exclude 386
</I>&gt;<i> systems (or they can be detected on-the-fly and given the alternative 3
</I>&gt;<i> instructions), then perhaps it would be possible to do something like
</I>&gt;<i> marking it as an icall and having the JIT recognize that method and inline
</I>&gt;<i> it as just a BSWAP.
</I>
I was thinking more about this issue.   The JIT has an infrastructure to
inline some well known methods/properties directly with inline assembly,
so the use of something like BSWAP on 486+ should work and could be used
in a few spots like IPAddress, BitConverter and the new DataConverter.

But in general, one of the challenges that we face is that we want to
avoid a exposing new API entry points in any of the core libraries (as
to keep our binaries compatible with .NET).

I can think right now a few options:

	* Create a Mono.Core assembly that contains some of these
	  implementations.  The JIT would be aware of the existence
	  of Mono.Core and inline things accordingly.

	  The major drawback for this is that it would be another
	  obnoxious dependency for folks moving code to other runtimes
	  and also that our own corlib would have to depend on this 
	  assembly (for DataConverter)

	* Create a special namespace that the JIT reserves the right to
	  inline and provide its own implementation, something like
	  Mono.JIT.Intrinsics

	  Some special methods here would be recognized as special and
	  would be hijacked by the JIT, regardless of what the source
	  code for that method implement.

	  The deployment model would be: application developers would 
	  have to bundle a monojitintrinsics.cs file with their 
	  software (they would download that from our site if they
	  need the extra performance boost) and use it in there.

	  By default the implementation would provide the same 
	  functionality in C# terms.

	* Improve the JIT to recognize a particular operation pattern,
	  and replace that with bswap. 

	  First we would need to identify an implementation that is
	  the simplest to analyze, and if we can come up with such
	  a construct, add special support for the JIT to always map
	  that to an instruction like bswap.

Miguel.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022986.html">[Mono-dev] Patch for IPAddress.cs
</A></li>
	<LI>Next message: <A HREF="022917.html">[Mono-dev] Mono's BitConverter.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22932">[ date ]</a>
              <a href="thread.html#22932">[ thread ]</a>
              <a href="subject.html#22932">[ subject ]</a>
              <a href="author.html#22932">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
