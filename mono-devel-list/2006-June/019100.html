<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] System.Web.Menu ViewState
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20System.Web.Menu%20ViewState&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019155.html">
   <LINK REL="Next"  HREF="019156.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] System.Web.Menu ViewState</H1>
    <B>Konstantin Triger</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20System.Web.Menu%20ViewState&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] System.Web.Menu ViewState">kostat at mainsoft.com
       </A><BR>
    <I>Mon Jun 26 14:05:07 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019155.html">[Mono-dev] Patch for System.Web.UI.WebControls.Wizard
</A></li>
        <LI>Next message: <A HREF="019156.html">[Mono-dev] [PATCH] System.Web.Menu ViewState
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19100">[ date ]</a>
              <a href="thread.html#19100">[ thread ]</a>
              <a href="subject.html#19100">[ subject ]</a>
              <a href="author.html#19100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

 

Currently the databound menu view state is not correctly saved, thus on postback, it is not restored since the binding does not happen.

This happens because of several reasons:

1.	MenuItemCollection saves dirty items only if it's a) populated b) marked for saving state c) altered. And it will save only items, which were added during first load. I changed it to simply save items if the collection is dirty (marked for saving state and then altered), please review this part.
2.	MenuItem did not bind the items recursively during its binding phase. So the inner items were lazily bound during render. At this point, the view state is already prepared, so it did not contain inner item data. In addition the menu caption was not retrieved, so it did not make to the view state.
3.	Menu first bound the MenuItem and than added to the collection. Since the item dirty state is set in MenuItemCollection.Add if the collection tracks its view state; and during binding we set the collection view state tracking according to the item view state tracking, Add() should be called prior to Bind.

 

Attached a patch fixing this. Please review.

 

Regards,

Konstantin Triger

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060626/b9c182a0/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060626/b9c182a0/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: menus.patch
Type: application/octet-stream
Size: 3452 bytes
Desc: menus.patch
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060626/b9c182a0/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060626/b9c182a0/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019155.html">[Mono-dev] Patch for System.Web.UI.WebControls.Wizard
</A></li>
	<LI>Next message: <A HREF="019156.html">[Mono-dev] [PATCH] System.Web.Menu ViewState
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19100">[ date ]</a>
              <a href="thread.html#19100">[ thread ]</a>
              <a href="subject.html#19100">[ subject ]</a>
              <a href="author.html#19100">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
