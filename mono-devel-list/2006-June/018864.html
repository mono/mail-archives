<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Speed up ByteEncoding.GetString()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Speed%20up%20ByteEncoding.GetString%28%29&In-Reply-To=008601c68bbf%24a9a4ebd0%240100a8c0%40kornelpal.hu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018859.html">
   <LINK REL="Next"  HREF="018865.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Speed up ByteEncoding.GetString()</H1>
    <B>Zac Bowling</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Speed%20up%20ByteEncoding.GetString%28%29&In-Reply-To=008601c68bbf%24a9a4ebd0%240100a8c0%40kornelpal.hu"
       TITLE="[Mono-dev] [PATCH] Speed up ByteEncoding.GetString()">zac at zacbowling.com
       </A><BR>
    <I>Fri Jun  9 16:09:21 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018859.html">[Mono-dev] [PATCH] Speed up ByteEncoding.GetString()
</A></li>
        <LI>Next message: <A HREF="018865.html">[Mono-dev] [PATCH] Speed up ByteEncoding.GetString()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18864">[ date ]</a>
              <a href="thread.html#18864">[ thread ]</a>
              <a href="subject.html#18864">[ subject ]</a>
              <a href="author.html#18864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Looks good from what I can tell. 

Sort of makes me think we should have a nice universal facility for
casting a string to byte array just for us to use internally (not for
the public to use because it can be an unsafe operation unless you know
what you are doing and why microsoft never added toByteArray() and the
ctor String(byte[]) functions in .NET as compared to Java). Maybe we
could make what we did in the Unicode (utf16/ucs2) encoding more generic
inside the string class? Something like the following functions:

internal String(byte[] val, bool bigEndian);
internal String(byte[] val); //assumes native
internal byte[] ToByteArray(bool bigEndian);
internal byte[] ToNativeByteArray();
or
internal static byte[] StringToByteArray(bool bigEndian);
internal static byte[] StringToNativeByteArray();
internal static String StringFromNativeByteArray(byte[] val);
internal static String StringFromByteArray(byte[] val, bool bigEndian);

Zac Bowling
<A HREF="http://zacbowling.com/">http://zacbowling.com/</A> 

On Fri, 2006-06-09 at 14:24 +0200, Korn&#233;l P&#225;l wrote:
&gt;<i> OK, now I understan your problem.
</I>&gt;<i> 
</I>&gt;<i> Please review this modified patch.
</I>&gt;<i> 
</I>&gt;<i> Korn&#233;l
</I>&gt;<i> 
</I>&gt;<i> ----- Original Message ----- 
</I>&gt;<i> From: &quot;Miguel de Icaza&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at ximian.com</A>&gt;
</I>&gt;<i> To: &quot;Korn&#233;l P&#225;l&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at gmail.com</A>&gt;
</I>&gt;<i> Cc: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> Sent: Friday, June 09, 2006 2:01 PM
</I>&gt;<i> Subject: Re: [Mono-dev] [PATCH] Speed up ByteEncoding.GetString()
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; Hello,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Invoking non-public methods using SRE is widely used by our class 
</I>&gt;<i> &gt;&gt; library,
</I>&gt;<i> &gt;&gt; it is supported by the ECMA standards so I don't really understand what 
</I>&gt;<i> &gt;&gt; you
</I>&gt;<i> &gt;&gt; mean on &quot;access to internal methods will at some point broken&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As I said, this might be something that we will fix in the future, and
</I>&gt;<i> &gt; although it works today, it does not mean it will work today, I do not
</I>&gt;<i> &gt; want to add more dependencies that might prevent us from fixing it in
</I>&gt;<i> &gt; the future.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Besides, poking at string internals is not something am very excited
</I>&gt;<i> &gt; about supporting nor encouraging.  The last time we did something
</I>&gt;<i> &gt; &quot;unsafe&quot; like this, it was reviewed over and over, and it turned out to
</I>&gt;<i> &gt; be buggy, it took months to track the mysterious bug because the
</I>&gt;<i> &gt; conditions were very hard to reproduce.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Note that even using &quot;new string ((char) 0, length)&quot; is faster than the
</I>&gt;<i> &gt;&gt; current implementation.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That part of the patch is fine with me.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Miguel 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>-- 
Zac Bowling &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">zac at zacbowling.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018859.html">[Mono-dev] [PATCH] Speed up ByteEncoding.GetString()
</A></li>
	<LI>Next message: <A HREF="018865.html">[Mono-dev] [PATCH] Speed up ByteEncoding.GetString()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18864">[ date ]</a>
              <a href="thread.html#18864">[ thread ]</a>
              <a href="subject.html#18864">[ subject ]</a>
              <a href="author.html#18864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
