<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for System.Net.Dns.GetHostAddresses
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20System.Net.Dns.GetHostAddresses&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019181.html">
   <LINK REL="Next"  HREF="019166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for System.Net.Dns.GetHostAddresses</H1>
    <B>Petri Latvala</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20System.Net.Dns.GetHostAddresses&In-Reply-To="
       TITLE="[Mono-dev] Patch for System.Net.Dns.GetHostAddresses">adrinael at adrinael.net
       </A><BR>
    <I>Fri Jun 30 06:39:27 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="019181.html">[Mono-dev] Monodevelop, gtk# etc
</A></li>
        <LI>Next message: <A HREF="019166.html">[Mono-dev] Preview of the release notes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19165">[ date ]</a>
              <a href="thread.html#19165">[ thread ]</a>
              <a href="subject.html#19165">[ subject ]</a>
              <a href="author.html#19165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>MSDN says GetHostAddresses doesn't query DNS if given an IP address,
but simply constructs an IPAddress array and returns it. Mono's
implementation queries DNS to find the names for the IP, then
discards them, and returns an array of IPAddress. Here's a patch to
not query when given an IP, and a test for it.


-- 
Petri Latvala
Adrinael
-------------- next part --------------
Index: class/System/Test/System.Net/DnsTest.cs
===================================================================
--- class/System/Test/System.Net/DnsTest.cs	(revision 62136)
+++ class/System/Test/System.Net/DnsTest.cs	(working copy)
@@ -169,6 +169,16 @@
                 Dns.GetHostEntry (site1Name); // hostname
                 Dns.GetHostEntry (site1Dot); // IP address
         }
+
+	[Test]
+	public void GetHostAddresses ()
+	{
+		string localaddr = &quot;127.0.0.1&quot;;
+		string arbitraryaddr = &quot;1.2.3.4&quot;;
+
+		AssertEquals (Dns.GetHostAddresses (localaddr) [0].ToString (), localaddr);
+		AssertEquals (Dns.GetHostAddresses (arbitraryaddr) [0].ToString (), arbitraryaddr);
+	}
 #endif
 
         private void SubTestValidIPHostEntry(IPHostEntry h) {
Index: class/System/System.Net/Dns.cs
===================================================================
--- class/System/System.Net/Dns.cs	(revision 62136)
+++ class/System/System.Net/Dns.cs	(working copy)
@@ -277,7 +277,16 @@
 			if (hostNameOrAddress == null)
 				throw new ArgumentNullException (&quot;hostNameOrAddress&quot;);
 
-			return GetHostEntry (hostNameOrAddress).AddressList;
+			IPAddress addr;
+			if (IPAddress.TryParse (hostNameOrAddress, out addr))
+			{
+				return new IPAddress[1] { addr };
+			}
+			else
+			{
+			  
+				return GetHostEntry (hostNameOrAddress).AddressList;
+			}
 		}
 #endif
 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060630/78d18ae8/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060630/78d18ae8/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019181.html">[Mono-dev] Monodevelop, gtk# etc
</A></li>
	<LI>Next message: <A HREF="019166.html">[Mono-dev] Preview of the release notes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19165">[ date ]</a>
              <a href="thread.html#19165">[ thread ]</a>
              <a href="subject.html#19165">[ subject ]</a>
              <a href="author.html#19165">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
