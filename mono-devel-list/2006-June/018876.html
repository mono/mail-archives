<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Abort with Non-Typical Exception Handler Layout on Mono	1.1.13.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Abort%20with%20Non-Typical%20Exception%20Handler%20Layout%20on%20Mono%0A%091.1.13.6&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018875.html">
   <LINK REL="Next"  HREF="018879.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Abort with Non-Typical Exception Handler Layout on Mono	1.1.13.6</H1>
    <B>Almann T. Goo</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Abort%20with%20Non-Typical%20Exception%20Handler%20Layout%20on%20Mono%0A%091.1.13.6&In-Reply-To="
       TITLE="[Mono-dev] Abort with Non-Typical Exception Handler Layout on Mono	1.1.13.6">almann.goo at gmail.com
       </A><BR>
    <I>Sun Jun 11 09:48:32 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018875.html">[Mono-dev] [PATCH] menu cssclass test and fix
</A></li>
        <LI>Next message: <A HREF="018879.html">[Mono-dev] Re: Abort with Non-Typical Exception Handler Layout on	Mono 1.1.13.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18876">[ date ]</a>
              <a href="thread.html#18876">[ thread ]</a>
              <a href="subject.html#18876">[ subject ]</a>
              <a href="author.html#18876">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am working on exception handler translation for JaCIL (CLI to JVM
byte-code compiler) so I've been writing some sample cases in CIL to better
understand the handler semantics in the CLI.  When running up this CIL code
in Mono 1.1.13.6, the run time aborted on an assertion error.

    T_START:
        ldstr   &quot;Start&quot;
        call    void [mscorlib]System.Console::WriteLine(string)
        leave.s COMPLETE
    T1_END:
        nop
    T2_END:

    COMPLETE:
        ret

    F1_START:
        ldstr   &quot;Finally1&quot;
        call    void [mscorlib]System.Console::WriteLine(string)
        endfinally
    F1_END:

    F2_START:
        ldstr   &quot;Finally2&quot;
        call    void [mscorlib]System.Console::WriteLine(string)
        endfinally
    F2_END:

    .try T_START to T1_END finally handler F1_START to F1_END
    .try T_START to T2_END finally handler F2_START to F2_END

The error returned when trying to execute this code in Mono is:

$ mono sample.exe

** ERROR **: file mini.c: line 9517 (mini_method_compile): assertion failed:
(tblock-&gt;native_offset)
aborting...
Aborted

If I move the method return and its label past the last finally handler the
above code works (probably how most compilers would probably generate this
type of code).  From what I understand of ECMA-335, it is legitimate to have
this case, and it indeed works in .NET Framework and Portable .NET as shown
below:

D:\tmp&gt; sample.exe
Start
Finally1
Finally2

I could be missing something in ECMA-335 (which has parts of the handler
spec in Partitions I, II, and III making more room for confusion) and PNet
and .NET Framework are just simply lax in this regard.  This is certainly
not a show stopper for my work, but I was wondering if anyone else has run
into anything similar on Mono with regard to exception handlers.

Best regards,
Almann

-- 
Almann T. Goo
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">almann.goo at gmail.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060611/c82e9e83/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060611/c82e9e83/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018875.html">[Mono-dev] [PATCH] menu cssclass test and fix
</A></li>
	<LI>Next message: <A HREF="018879.html">[Mono-dev] Re: Abort with Non-Typical Exception Handler Layout on	Mono 1.1.13.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18876">[ date ]</a>
              <a href="thread.html#18876">[ thread ]</a>
              <a href="subject.html#18876">[ subject ]</a>
              <a href="author.html#18876">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
