<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] PATCH: Bug #76757,	new AppDomains inherit current loaded assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PATCH%3A%20Bug%20%2376757%2C%0A%09new%20AppDomains%20inherit%20current%20loaded%20assemblies&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018985.html">
   <LINK REL="Next"  HREF="018988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] PATCH: Bug #76757,	new AppDomains inherit current loaded assemblies</H1>
    <B>Brian Crowell</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PATCH%3A%20Bug%20%2376757%2C%0A%09new%20AppDomains%20inherit%20current%20loaded%20assemblies&In-Reply-To="
       TITLE="[Mono-dev] PATCH: Bug #76757,	new AppDomains inherit current loaded assemblies">mono-devel at fluggo.com
       </A><BR>
    <I>Sat Jun 17 19:31:22 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018985.html">[Mono-dev] System.Configuration 2.0	ApplicationSettings	infrastructure.
</A></li>
        <LI>Next message: <A HREF="018988.html">[Mono-dev] PATCH: Bug #76757, new AppDomains inherit current	loaded assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18984">[ date ]</a>
              <a href="thread.html#18984">[ thread ]</a>
              <a href="subject.html#18984">[ subject ]</a>
              <a href="author.html#18984">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
The attached patch (create-empty-appdomain.patch) fixes bug #76757. New domains 
are created with only the corlib loaded, and the cross-domain code now handles 
the type differences correctly.

An important thing to note about this patch is that it disables a lot of code in 
mono/metadata/marshal.c relating to the fast cross-domain wrappers. Much of that 
code made bad assumptions about the availability of types in other domains and 
the ability to make equality comparisons by pointers. The patch forces all 
cross-domain calls to go through the CrossAppDomainChannel, which has also been 
fixed in this regard.

The attached marshal.diff shows another strategy I thought about taking. This 
tries to get the cross-domain wrappers to correctly understand type equality 
across domains. I abandoned it because it was too much effort, but anyone 
interested can look at it and see what I was trying to do. That diff is based on 
version 1.1.13.8.

Please look at this and approve it for inclusion. I can't commit things, nor 
would I in this case without having someone look into #76811:

   <A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=76811">http://bugzilla.ximian.com/show_bug.cgi?id=76811</A>

--Brian
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: create-empty-appdomain.patch
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060617/7e93709c/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060617/7e93709c/attachment.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: marshal.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060617/7e93709c/attachment-0001.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060617/7e93709c/attachment-0001.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018985.html">[Mono-dev] System.Configuration 2.0	ApplicationSettings	infrastructure.
</A></li>
	<LI>Next message: <A HREF="018988.html">[Mono-dev] PATCH: Bug #76757, new AppDomains inherit current	loaded assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18984">[ date ]</a>
              <a href="thread.html#18984">[ thread ]</a>
              <a href="subject.html#18984">[ subject ]</a>
              <a href="author.html#18984">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
