<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] NullReferenceException on a callvirt... with a	non-null reference? (please help!)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20NullReferenceException%20on%20a%20callvirt...%20with%20a%0A%09non-null%20reference%3F%20%28please%20help%21%29&In-Reply-To=449270BC.8000900%40fluggo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018973.html">
   <LINK REL="Next"  HREF="018976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] NullReferenceException on a callvirt... with a	non-null reference? (please help!)</H1>
    <B>Zoltan Varga</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20NullReferenceException%20on%20a%20callvirt...%20with%20a%0A%09non-null%20reference%3F%20%28please%20help%21%29&In-Reply-To=449270BC.8000900%40fluggo.com"
       TITLE="[Mono-dev] NullReferenceException on a callvirt... with a	non-null reference? (please help!)">vargaz at gmail.com
       </A><BR>
    <I>Fri Jun 16 05:04:03 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018973.html">[Mono-dev] NullReferenceException on a callvirt... with a non-null reference? (please help!)
</A></li>
        <LI>Next message: <A HREF="018976.html">[Mono-dev] NullReferenceException on a callvirt... with a non-null	reference? (please help!)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18975">[ date ]</a>
              <a href="thread.html#18975">[ thread ]</a>
              <a href="subject.html#18975">[ subject ]</a>
              <a href="author.html#18975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>                                                 Hi,

  The fact that new appdomains have all assemblies loaded is clearly a bug, but
it can't be fixed easily because certain parts of the runtime, most notably the
remoting infrastructure seem to depend on this broken behaviour. Most likely
because the same assembly will be loaded separately into the two appdomains,
confusing the remoting code which expects them to be the same (ie. the same
MonoAssembly structure).

                                                       Zoltan

On 6/16/06, Brian Crowell &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel at fluggo.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Okay, while dealing with the whole AppDomains-should-be-empty-bug, I came across
</I>&gt;<i> a strange phenomenon. After making sure that new AppDomains carry only the
</I>&gt;<i> corlib, cross-domain calls to that AppDomain fail with a NullReferenceException.
</I>&gt;<i>
</I>&gt;<i> After careful examination, I've determined that this exception occurs inside the
</I>&gt;<i> xdomain-wrapper method created in metadata/marshal.c. Specifically, it occurs
</I>&gt;<i> during the callvirt instruction that *would* carry out the last step of the
</I>&gt;<i> cross-domain call-- calling the method on the object in the next domain.
</I>&gt;<i>
</I>&gt;<i> Yet, by injecting Console.WriteLine calls into this code, I can show that the
</I>&gt;<i> reference to the target object is, in fact, not null. So, I guess what I need to
</I>&gt;<i> know is-- under what other conditions could a NullReferenceException occur on a
</I>&gt;<i> callvirt (in x86)?
</I>&gt;<i>
</I>&gt;<i> I have a feeling this may have to do with the fact that the called method and
</I>&gt;<i> the calling method come from two instances of the same assembly. Example: I have
</I>&gt;<i> one AppDomain which pulls its assemblies from /foo, and the second which pulls
</I>&gt;<i> it assemblies from /bar. Under the original implementation, these AppDomains
</I>&gt;<i> would carry the same assemblies; that is, the ones that come from the original
</I>&gt;<i> AppDomain. Under the new implementation, the assemblies are separately loaded
</I>&gt;<i> from /foo and /bar, like they should be. So maybe the call-wrapping doesn't take
</I>&gt;<i> this into account?
</I>&gt;<i>
</I>&gt;<i> I'm still working through this, but any help on this particular point would be
</I>&gt;<i> appreciated.
</I>&gt;<i>
</I>&gt;<i> --Brian
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018973.html">[Mono-dev] NullReferenceException on a callvirt... with a non-null reference? (please help!)
</A></li>
	<LI>Next message: <A HREF="018976.html">[Mono-dev] NullReferenceException on a callvirt... with a non-null	reference? (please help!)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18975">[ date ]</a>
              <a href="thread.html#18975">[ thread ]</a>
              <a href="subject.html#18975">[ subject ]</a>
              <a href="author.html#18975">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
