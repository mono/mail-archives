<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Detecting if a dll or binary is platform independant
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Detecting%20if%20a%20dll%20or%20binary%20is%20platform%20independant&In-Reply-To=1150274955.2678.10.camel%40mrwibble.mrwobble">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018918.html">
   <LINK REL="Next"  HREF="018922.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Detecting if a dll or binary is platform independant</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Detecting%20if%20a%20dll%20or%20binary%20is%20platform%20independant&In-Reply-To=1150274955.2678.10.camel%40mrwibble.mrwobble"
       TITLE="[Mono-dev] Detecting if a dll or binary is platform independant">jonpryor at vt.edu
       </A><BR>
    <I>Wed Jun 14 07:24:31 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018918.html">[Mono-dev] Detecting if a dll or binary is platform independant
</A></li>
        <LI>Next message: <A HREF="018922.html">[Mono-dev] [Patch] Stetic crash and invalid code generation.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18921">[ date ]</a>
              <a href="thread.html#18921">[ thread ]</a>
              <a href="subject.html#18921">[ subject ]</a>
              <a href="author.html#18921">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2006-06-14 at 09:49 +0100, PFJ wrote:
&gt;<i> Is there any sure fire way to detect if either a dll or binary compiled
</I>&gt;<i> with mono is platform agnostic or platform specific?
</I>
It all depends on what your definition of &quot;platform agnostic&quot; and
&quot;platform specific&quot; is. :-)

The best example of a &quot;platform specific&quot; assembly would be a &quot;mixed
mode&quot; assembly, in which actual x86/AMD64/Itanium/etc. code is placed
into the assembly along with the platform agnostic CIL code.

However, only .NET tools can create such mixed mode assemblies, and Mono
doesn't support their execution on any platform, so they're currently
not a concern (and likely won't ever be, for a variety of reasons).

Consequently, any assembly of consequence executing under Mono will
contain *only* platform agnostic CIL code.

The only thing left to determine whether an assembly is platform
specific is the use of Platform Invoke (P/Invoke), and this is _not_
trivial, as &quot;portable&quot; P/Invoke code can be written, but
platform-specific platform code can also be written.  Classic example:
`struct stat' in C#:

	public struct stat {
		public ulong st_dev, st_ino;
		public uint st_mode;
		private uint _padding_;
		public ulong st_nlink, st_uid, st_gid, st_rdev;
		public long st_size, st_blksize, st_blocks, st_atime,
			st_mtime, st_ctime;
	}

Question: is that structure definition portable for use with fstat(2)?

Answer: Maybe. :-)  It should work on 64-bit ABIs (since long/ulong are
64-bit integer types), but it will fail badly on 32-bit ABIs, and it
will fail on any ABI in which the member ordering differs.
Consequently, such a structure would be platform specific if used with a
DllImport statement, but there is NO EASY WAY for a program to make this
determination. :-/

(Plus, it can get more complicated, particularly if such a structure is
instead used with some native library which will accept that structure,
such as Mono.Posix.dll &amp; libMonoPosixHelper.so, which uses a 64-bit ABI
throughout, and libMonoPosixHelper.so converts this to a 32-bit ABI as
appropriate.)

So it's easiest to assume that all CIL code is platform agnostic.

&gt;<i> There is currently a debate about this on the fedora-packagers list, but
</I>&gt;<i> as yet, no one is able to determine a simple way to see where things
</I>&gt;<i> need to go (in respects to agnostic going in /usr/share and platform
</I>&gt;<i> specific in /usr/lib or /usr/lib64). As FC has only recently taken mono
</I>&gt;<i> as part of it's core distro, the packagers (me included) want to get
</I>&gt;<i> this right from the outset.
</I>
I would suggest looking at what SuSE and Debian/Ubuntu have done with
this, as they have all encountered these issues.  Following in their
footsteps would help consistency, and make it easier to repackage
existing programs.

I believe that they currently use /usr/lib for everything.

However, this gets considerably more complicated, as applications may
bundle native libraries with them -- take Blam! and F-Spot as examples:

        $ ls /usr/lib/f-spot
        FlickrNet.dll      libfspoteog.so.0.0.0       libfspot.so.0
        f-spot.exe         libfspotjpegtran.so        libfspot.so.0.0.0
        f-spot.exe.config  libfspotjpegtran.so.0      libgphoto2-sharp.dll
        libfspoteog.so     libfspotjpegtran.so.0.0.0  libgphoto2-sharp.dll.config
        libfspoteog.so.0   libfspot.so                SemWeb.dll

The *.dll and *.exe files may be platform agnostic, but the *.so* files
certainly are NOT.

So the easiest solution may be to check to see if any native libraries
are bundled with the app, and if that's the case stick it under the
appropriate /usr/lib or /usr/lib64 directory.  Otherwise, stick
with /usr/lib.

 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018918.html">[Mono-dev] Detecting if a dll or binary is platform independant
</A></li>
	<LI>Next message: <A HREF="018922.html">[Mono-dev] [Patch] Stetic crash and invalid code generation.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18921">[ date ]</a>
              <a href="thread.html#18921">[ thread ]</a>
              <a href="subject.html#18921">[ subject ]</a>
              <a href="author.html#18921">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
