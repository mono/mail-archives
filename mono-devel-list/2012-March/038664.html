<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Question about NetworkStream.BeginRead
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Question%20about%20NetworkStream.BeginRead&In-Reply-To=%3C4F6362F1.10704%40terra.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038663.html">
   <LINK REL="Next"  HREF="038665.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Question about NetworkStream.BeginRead</H1>
    <B>pablosantosluac at terra.es</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Question%20about%20NetworkStream.BeginRead&In-Reply-To=%3C4F6362F1.10704%40terra.es%3E"
       TITLE="[Mono-dev] Question about NetworkStream.BeginRead">pablosantosluac at terra.es
       </A><BR>
    <I>Fri Mar 16 15:57:37 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="038663.html">[Mono-dev] Current state of support for Code Contracts?
</A></li>
        <LI>Next message: <A HREF="038665.html">[Mono-dev] Question about NetworkStream.BeginRead
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38664">[ date ]</a>
              <a href="thread.html#38664">[ thread ]</a>
              <a href="subject.html#38664">[ subject ]</a>
              <a href="author.html#38664">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm working on some changes to make the TcpChannel work in async mode.

Instead of changing all the reads and writes to async, I'm just
modifying the intial message status read to async, so instead of having
a pile of threads waiting for IO on the server (waiting for clients to
call or disconnect), there will be only as few threads as running methods.

It works great on Windows even under huge load (I'm testing on a
100-nodes cluster on EC2).

But, now, trying on Linux simply fails because this call:

networkStream.BeginRead(buffer, 0, 6, callback, null);

where networkStream is System.Net.Sockets.NetworkStream

locks.

What it actually does is to block and then invoke the callback, but it
doesn't go through until the callback finishes, which I think is not the
desired behavior.

I'm running:
Mono JIT compiler version 2.10.2 (tarball Mon Apr 18 15:12:52 UTC 2011)
Copyright (C) 2002-2011 Novell, Inc and Contributors. www.mono-project.com
    TLS:           __thread
    SIGSEGV:       altstack
    Notifications: epoll
    Architecture:  amd64
    Disabled:      none
    Misc:          debugger softdebug
    LLVM:          yes(2.9svn-mono)
    GC:            Included Boehm (with typed GC and Parallel Mark)

It fails with older monos too.

Obviously I'm doing something wrong.

Is there a way I can fix it?

Thanks,

pablo
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038663.html">[Mono-dev] Current state of support for Code Contracts?
</A></li>
	<LI>Next message: <A HREF="038665.html">[Mono-dev] Question about NetworkStream.BeginRead
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38664">[ date ]</a>
              <a href="thread.html#38664">[ thread ]</a>
              <a href="subject.html#38664">[ subject ]</a>
              <a href="author.html#38664">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
