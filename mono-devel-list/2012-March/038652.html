<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [db|sql]metal using a custom DbSchemaLoader ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20%5Bdb%7Csql%5Dmetal%20using%20a%20custom%20DbSchemaLoader%20%3F&In-Reply-To=%3C1331212618.15639.38.camel%40hestia%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038649.html">
   <LINK REL="Next"  HREF="038653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [db|sql]metal using a custom DbSchemaLoader ?</H1>
    <B>Cyrille Ch&#233;p&#233;lov</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20%5Bdb%7Csql%5Dmetal%20using%20a%20custom%20DbSchemaLoader%20%3F&In-Reply-To=%3C1331212618.15639.38.camel%40hestia%3E"
       TITLE="[Mono-dev] [db|sql]metal using a custom DbSchemaLoader ?">cyrille at chepelov.org
       </A><BR>
    <I>Thu Mar  8 13:16:58 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="038649.html">[Mono-dev] Mono 3.0, .NET 4.5 and next steps
</A></li>
        <LI>Next message: <A HREF="038653.html">[Mono-dev] [db|sql]metal using a custom DbSchemaLoader ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38652">[ date ]</a>
              <a href="thread.html#38652">[ thread ]</a>
              <a href="subject.html#38652">[ subject ]</a>
              <a href="author.html#38652">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

while trying to apply SqlMetal on a PostGIS database, I received error
messages about unknown SQL data types, some of them being geographic
types, some others being simply type aliases

Apparently, the &quot;DbMetal way&quot; of handling this is to derive from the
DbSchemaLoader (PgsqlSchemaLoader in this case), override SchemaLoader's
MapDbType(), and then invoke dbmetal/sqlmetal
--with-schemaloader=My.Custom.SchemaLoader,MyAssembly

the problem: 

        during the DbLinq-to-Mono integration, the &quot;ISchemaLoader /
        SchemaLoader&quot; extensibility point has been shut using
        MONO_STRICT. The only assembly allowed to know about these
        useful types is sqlmetal.exe itself.
        
        Even if you were to build a new ISchemaLoader implementation
        from scratch, you can't supply it to sqlmetal anyway, because
        you cannot reference the DbLinq.Vendor.ISchemaLoader from Mono's
        System.Data.Linq, since it is also internal because of
        MONO_STRICT.

    
In effect, you now may use --with-schemaloader to force sqlmetal.exe to
use SqlServerSchemaLoader against an Oracle database, but that's about
all you can do with that option.

My question: 
    
    Would a patch removing the &quot;#if !MONO_STRICT .. public&quot; condition
from ISchemaLoader &amp; common implementations be accepted in Mono
System.Data.Linq ? I notice Mono's S.D.Linq already leaks some bits from
DbLinq.Util, it doesn't seem to be that big a deal to let ISchemaLoader
escape as well, would it be ?
    If such a patch cannot be included, what is the best way to proceed
then ?


second question:
    DbLinq.Vendor.DbSchemaLoader's MapDbType method has a smell in its
&quot;switch/case&quot; statement. Apparently, that has been written much earlier
than the availability of a proper SchemaLoader child class per provider.
So in effect, all type names from all dialects are tested against every
database, regardless of the provider. Wouldn't it be sensible to push
down the type tests into each provider ? I would like to do this.

thanks in advance.

    -- Cyrille

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120308/2663159c/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120308/2663159c/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038649.html">[Mono-dev] Mono 3.0, .NET 4.5 and next steps
</A></li>
	<LI>Next message: <A HREF="038653.html">[Mono-dev] [db|sql]metal using a custom DbSchemaLoader ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38652">[ date ]</a>
              <a href="thread.html#38652">[ thread ]</a>
              <a href="subject.html#38652">[ subject ]</a>
              <a href="author.html#38652">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
