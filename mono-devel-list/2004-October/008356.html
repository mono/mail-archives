<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [SPAM] - Re: [Mono-devel-list] DataSetHelper Class and Mono problems? - Email found in subject
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BSPAM%5D%20-%20Re%3A%20%5BMono-devel-list%5D%20DataSetHelper%20Class%20and%20Mono%20problems%3F%20-%20Email%20found%20in%20subject&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008463.html">
   <LINK REL="Next"  HREF="008357.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[SPAM] - Re: [Mono-devel-list] DataSetHelper Class and Mono problems? - Email found in subject</H1>
    <B>Jon Benson</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BSPAM%5D%20-%20Re%3A%20%5BMono-devel-list%5D%20DataSetHelper%20Class%20and%20Mono%20problems%3F%20-%20Email%20found%20in%20subject&In-Reply-To="
       TITLE="[SPAM] - Re: [Mono-devel-list] DataSetHelper Class and Mono problems? - Email found in subject">Jon at destra.com
       </A><BR>
    <I>Sun Oct 17 22:51:22 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008463.html">[Mono-devel-list] Re: ExpandEnvironmentVariables fix
</A></li>
        <LI>Next message: <A HREF="008357.html">[Mono-devel-list] httpModules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8356">[ date ]</a>
              <a href="thread.html#8356">[ thread ]</a>
              <a href="subject.html#8356">[ subject ]</a>
              <a href="author.html#8356">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the detailed explanation.  Even as a relative newbie to C# I
think I actually follow that.  :)

In short this means the Add function within the DataSetHelper class is
only valid for one type of object anyway?  :(

My test scenario was sadly not exactly the same as the code I was using.
With some debugging I discovered that under .NET the object being passed
to the Add function, in my original code, was being passed as whatever
type the DataColumn in the DataTable was specified as (I was originally
using Int32 but changed it to Decimal) but under Mono it is ending up as
System.String regardless of it's original type.


Thanks,

Jon

-----Original Message-----
From: Jonathan Pryor [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>] 
Sent: Friday, 15 October 2004 9:26 PM
To: Jon Benson
Cc: Mono Development List
Subject: [SPAM] - Re: [Mono-devel-list] DataSetHelper Class and Mono
problems? - Email found in subject

On Thu, 2004-10-14 at 23:09, Jon Benson wrote:
&lt;snip/&gt;
&gt;<i> However I run in to a problem with one of the functions throwing an 
</I>&gt;<i> exception under Mono.  I've created a bit of test code to reproduce 
</I>&gt;<i> this
</I>&gt;<i> exception:
</I>&gt;<i> Unhandled Exception: System.InvalidCastException: Cannot cast from 
</I>&gt;<i> source type to destination type.
</I>&gt;<i> in &lt;0x00085&gt; Test.TestClass:Add (object,object) in &lt;0x0004e&gt; 
</I>&gt;<i> Test.TestClass:Main (string[])
</I>
You're getting an exception because your code is buggy. :-)

You're passing boxed ints to Add, but Add casts them to decimal.  A
boxed int can't be cast to a decimal.  For example:

	object boxed_int = 42;
	int i = (int) 42; // unbox: valid
	decimal d = 42;   // calls Decimal.implicit operator Decimal
(int)
	decimal d2 = (decimal) boxed_int;
		// runtime cast check.  
		// boxed_int.GetType() != typeof(Decimal), so an 
		// InvalidCastException is thrown.

The last cast is precisely what your program does.  As Umadevi
mentioned, it also fails on .NET.

It fails because runtime casts don't look for any type conversion
operators that the types define, such as &quot;implicit operator Decimal (int
value)''.  Such operator functions calls are generated by the compiler,
not the runtime.  Thus, to convert a boxed int into a decimal, you'd
need two casts:

	decimal d = (decimal) (int) boxed_int;

&gt;<i> Sample code to reproduce the exception:
</I>&gt;<i> using System;
</I>&gt;<i> 
</I>&gt;<i> namespace Test
</I>&gt;<i> {
</I>&gt;<i>    class TestClass
</I>&gt;<i>    {
</I>&gt;<i>       [STAThread]
</I>&gt;<i>       static void Main(string[] args)
</I>&gt;<i>       {
</I>&gt;<i>          int i1 = 34; int i2 = 8;
</I>&gt;<i> 
</I>&gt;<i>          int i3 = (int)((decimal)i1 + (decimal)i2);
</I>&gt;<i>          Console.WriteLine(i3.ToString());
</I>&gt;<i> 
</I>&gt;<i>          i3 = (int)(TestClass.Add(i1, i2));
</I>
Notice that i1 and i2 are of type int, so  you're passing boxed ints.

&gt;<i>          Console.WriteLine(i3.ToString());
</I>&gt;<i>       }
</I>&gt;<i> 
</I>&gt;<i>       private static object Add(object a, object b)
</I>&gt;<i>       {
</I>&gt;<i>           //Adds two values - if one is DBNull, then returns the other
</I>&gt;<i>           if (a is DBNull)
</I>&gt;<i>               return b;
</I>&gt;<i>           if (b is DBNull)
</I>&gt;<i>               return a;
</I>&gt;<i>           return ((decimal)a + (decimal)b);
</I>
Here you cast the boxed ints to a decimal.  Thus, an
InvalidCastException.

&gt;<i>       }
</I>&gt;<i>    }
</I>&gt;<i> }
</I>
 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008463.html">[Mono-devel-list] Re: ExpandEnvironmentVariables fix
</A></li>
	<LI>Next message: <A HREF="008357.html">[Mono-devel-list] httpModules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8356">[ date ]</a>
              <a href="thread.html#8356">[ thread ]</a>
              <a href="subject.html#8356">[ subject ]</a>
              <a href="author.html#8356">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
