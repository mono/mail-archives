<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Overcoming PInvoke limitations in e.g. Mono.Posix
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Overcoming%20PInvoke%20limitations%20in%20e.g.%20Mono.Posix&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008271.html">
   <LINK REL="Next"  HREF="008273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Overcoming PInvoke limitations in e.g. Mono.Posix</H1>
    <B>Alan Jenkins</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Overcoming%20PInvoke%20limitations%20in%20e.g.%20Mono.Posix&In-Reply-To="
       TITLE="[Mono-devel-list] Overcoming PInvoke limitations in e.g. Mono.Posix">sourcejedi at phonecoop.coop
       </A><BR>
    <I>Thu Oct  7 14:45:01 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008271.html">[Mono-devel-list] Mono Class Library Status
</A></li>
        <LI>Next message: <A HREF="008273.html">[Mono-devel-list] Overcoming PInvoke limitations in e.g.	Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8272">[ date ]</a>
              <a href="thread.html#8272">[ thread ]</a>
              <a href="subject.html#8272">[ subject ]</a>
              <a href="author.html#8272">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>PInvoke is convenient, but it relies on binary compatability.  E.g. much  
Posix specifications define symbolic constants for C programs which do not 
have a fixed value across all platforms.  The layout of structures also 
varies between platforms.  PInvoke is sufficient for the microsoft world, but 
Mono really needs more.  As far as I know the current Mono.Posix 
implementation doesn't have a complete solution - although I don't know 
anything about the SDL or GTK bindings.

I propose a Mono.InteropServices namespace, with tools to write structs and 
enums in C# from annotated (with attributes) C# code, with C code as an 
intermediate step.  The C code would be relatively portable, but the generated 
C# code would be platform specific.  Already generated C# code could be 
included for people without a C compiler (e.g. windows users).

I've been having a go at hand generating some C code first, but I'm quite 
willing &amp; able to do the whole thing.  Theres only one bit which seems to 
involve any actual thinking - typedefs, which can be handled the same way as 
in Mono.Posix OEE 0.3:

Quoting Jonathan Pryor <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>
&gt;<i> Furthermore, C typedefs get their own types.  This feature is debatable,
</I>&gt;<i> and can be changed, but I thought it was cool.  Consequently, the C:
</I>&gt;<i> 
</I>&gt;<i>         typedef unsigned long size_t;
</I>&gt;<i> 
</I>&gt;<i> Becomes the C#:
</I>&gt;<i> 
</I>&gt;<i>         public struct size_t : IComparable, IFormattable...
</I>&gt;<i>         {
</I>&gt;<i>                 private ulong value;
</I>&gt;<i>                 // ...
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i> This can get rather tedious, so I have a Perl script which generates the
</I>&gt;<i> structure declarations, stub-vt.pl.  (This could also be a shell script,
</I>&gt;<i> or any other language, if that would be preferred.  I'm not sure what
</I>&gt;<i> the Mono policy regarding code generation is; I haven't heard of such a
</I>&gt;<i> policy, anyway.)
</I>&gt;<i> 
</I>&gt;<i> The &quot;typedef&quot; classes all support implicit conversions to their
</I>&gt;<i> underlying type, but require explicit conversions back.  Usage is thus:
</I>&gt;<i> 
</I>&gt;<i>      size_t a = (size_t) (1 + 2);
</I>&gt;<i>         size_t b = (size_t) (a + 42);
</I>&gt;<i>         // ...
</I>
Which sounds fine.

Stop me if this is already being worked on - I know its obvious, it's just 
nobody seems to have got around to it yet!  Unless I've missed something.

Alan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008271.html">[Mono-devel-list] Mono Class Library Status
</A></li>
	<LI>Next message: <A HREF="008273.html">[Mono-devel-list] Overcoming PInvoke limitations in e.g.	Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8272">[ date ]</a>
              <a href="thread.html#8272">[ thread ]</a>
              <a href="subject.html#8272">[ subject ]</a>
              <a href="author.html#8272">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
