<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] DataSetHelper Class and Mono problems?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DataSetHelper%20Class%20and%20Mono%20problems%3F&In-Reply-To=605003BD28411C429D2ECB73C8115C84016412CD%40exchange2k3.destra.mel">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008318.html">
   <LINK REL="Next"  HREF="008320.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] DataSetHelper Class and Mono problems?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DataSetHelper%20Class%20and%20Mono%20problems%3F&In-Reply-To=605003BD28411C429D2ECB73C8115C84016412CD%40exchange2k3.destra.mel"
       TITLE="[Mono-devel-list] DataSetHelper Class and Mono problems?">jonpryor at vt.edu
       </A><BR>
    <I>Fri Oct 15 07:25:49 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008318.html">[Mono-devel-list] DataSetHelper Class and Mono problems?
</A></li>
        <LI>Next message: <A HREF="008320.html">[Mono-devel-list] Mono.Posix OEE CVS Integration Patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8323">[ date ]</a>
              <a href="thread.html#8323">[ thread ]</a>
              <a href="subject.html#8323">[ subject ]</a>
              <a href="author.html#8323">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 2004-10-14 at 23:09, Jon Benson wrote:
&lt;snip/&gt;
&gt;<i> However I run in to a problem with one of the functions throwing an
</I>&gt;<i> exception under Mono.  I've created a bit of test code to reproduce this
</I>&gt;<i> exception:
</I>&gt;<i> Unhandled Exception: System.InvalidCastException: Cannot cast from
</I>&gt;<i> source type to destination type.
</I>&gt;<i> in &lt;0x00085&gt; Test.TestClass:Add (object,object)
</I>&gt;<i> in &lt;0x0004e&gt; Test.TestClass:Main (string[])
</I>
You're getting an exception because your code is buggy. :-)

You're passing boxed ints to Add, but Add casts them to decimal.  A
boxed int can't be cast to a decimal.  For example:

	object boxed_int = 42;
	int i = (int) 42; // unbox: valid
	decimal d = 42;   // calls Decimal.implicit operator Decimal (int)
	decimal d2 = (decimal) boxed_int;
		// runtime cast check.  
		// boxed_int.GetType() != typeof(Decimal), so an 
		// InvalidCastException is thrown.

The last cast is precisely what your program does.  As Umadevi
mentioned, it also fails on .NET.

It fails because runtime casts don't look for any type conversion
operators that the types define, such as &quot;implicit operator Decimal (int
value)''.  Such operator functions calls are generated by the compiler,
not the runtime.  Thus, to convert a boxed int into a decimal, you'd
need two casts:

	decimal d = (decimal) (int) boxed_int;

&gt;<i> Sample code to reproduce the exception:
</I>&gt;<i> using System;
</I>&gt;<i> 
</I>&gt;<i> namespace Test
</I>&gt;<i> {
</I>&gt;<i>    class TestClass
</I>&gt;<i>    {
</I>&gt;<i>       [STAThread]
</I>&gt;<i>       static void Main(string[] args)
</I>&gt;<i>       {
</I>&gt;<i>          int i1 = 34; int i2 = 8;
</I>&gt;<i> 
</I>&gt;<i>          int i3 = (int)((decimal)i1 + (decimal)i2);
</I>&gt;<i>          Console.WriteLine(i3.ToString());
</I>&gt;<i> 
</I>&gt;<i>          i3 = (int)(TestClass.Add(i1, i2));
</I>
Notice that i1 and i2 are of type int, so  you're passing boxed ints.

&gt;<i>          Console.WriteLine(i3.ToString());
</I>&gt;<i>       }
</I>&gt;<i> 
</I>&gt;<i>       private static object Add(object a, object b)
</I>&gt;<i>       {
</I>&gt;<i>           //Adds two values - if one is DBNull, then returns the other
</I>&gt;<i>           if (a is DBNull)
</I>&gt;<i>               return b;
</I>&gt;<i>           if (b is DBNull)
</I>&gt;<i>               return a;
</I>&gt;<i>           return ((decimal)a + (decimal)b);
</I>
Here you cast the boxed ints to a decimal.  Thus, an
InvalidCastException.

&gt;<i>       }
</I>&gt;<i>    }
</I>&gt;<i> }
</I>
 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008318.html">[Mono-devel-list] DataSetHelper Class and Mono problems?
</A></li>
	<LI>Next message: <A HREF="008320.html">[Mono-devel-list] Mono.Posix OEE CVS Integration Patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8323">[ date ]</a>
              <a href="thread.html#8323">[ thread ]</a>
              <a href="subject.html#8323">[ subject ]</a>
              <a href="author.html#8323">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
