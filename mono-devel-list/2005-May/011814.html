<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Limiting Memory Allocation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Limiting%20Memory%20Allocation&In-Reply-To=1115221458.5245.82.camel%40omega.maurer">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011809.html">
   <LINK REL="Next"  HREF="011811.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Limiting Memory Allocation</H1>
    <B>Richard Matthias</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Limiting%20Memory%20Allocation&In-Reply-To=1115221458.5245.82.camel%40omega.maurer"
       TITLE="[Mono-devel-list] Limiting Memory Allocation">richardmatthias at gmail.com
       </A><BR>
    <I>Wed May  4 14:25:06 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011809.html">[Mono-devel-list] Limiting Memory Allocation
</A></li>
        <LI>Next message: <A HREF="011811.html">[Mono-devel-list] Re: OpenGL and Tao?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11814">[ date ]</a>
              <a href="thread.html#11814">[ thread ]</a>
              <a href="subject.html#11814">[ subject ]</a>
              <a href="author.html#11814">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I hate popping up on mailing lists without any introductions, but anyway...

I can't help feeling that you're going about this in the most complex
way possible. Given that you are generating all the code from a source
script at runtime, why don't you just inject code to monitor memory
usage inline? Unless you are revising LSL (I'm a secondlife user) all
data operations are value based, so it's pretty easy to see where
memory is freed.

There would be an intermediate time between the script's memory
counter being decremented and the GC actually recovering that memory
which would potentially allow scripts to lag the server by creating
tons of garbage, but you could limit that by accounting for memory
allocation events in your scheduling.

btw. I'm curious as to how you are dealing with the issue of
assemblies (dynamically generated or otherwise) not being unloadable?
.NET is pretty badly designed for handline dynamic code in the way
you'd want to for a game server. The only way you can unload code is
to load that code in a seperate AppDomain and unload the AppDomain
when you're done with it. Of course you can't load every script into
it's own AppDomain because each has a large allocation overhead. There
is also a significant marshalling overhead when calling across
AppDomains. The alternative is to generate code in a single AppDomain
and put up with the fact that you're going to leak memory as users
load new scripts and recompile existing ones. As you need some way to
serialize script state anyway, I guess you could serialize all the
scripts periodically and unload the AppDomain and start again.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011809.html">[Mono-devel-list] Limiting Memory Allocation
</A></li>
	<LI>Next message: <A HREF="011811.html">[Mono-devel-list] Re: OpenGL and Tao?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11814">[ date ]</a>
              <a href="thread.html#11814">[ thread ]</a>
              <a href="subject.html#11814">[ subject ]</a>
              <a href="author.html#11814">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
