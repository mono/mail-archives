<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Mono ASP.NET is very slow with big html pages...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Mono%20ASP.NET%20is%20very%20slow%20with%20big%20html%20pages...&In-Reply-To=dd99b8c805051210502377c6a1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011922.html">
   <LINK REL="Next"  HREF="011898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Mono ASP.NET is very slow with big html pages...</H1>
    <B>Hubert FONGARNAND</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Mono%20ASP.NET%20is%20very%20slow%20with%20big%20html%20pages...&In-Reply-To=dd99b8c805051210502377c6a1%40mail.gmail.com"
       TITLE="[Mono-devel-list] Mono ASP.NET is very slow with big html pages...">informatique.internet at fiducial.fr
       </A><BR>
    <I>Fri May 13 02:35:32 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011922.html">[Mono-devel-list] Mono ASP.NET is very slow with big html pages...
</A></li>
        <LI>Next message: <A HREF="011898.html">[Mono-devel-list] [ANN] X-develop 1.0.1 with Mac OS X support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11928">[ date ]</a>
              <a href="thread.html#11928">[ thread ]</a>
              <a href="subject.html#11928">[ subject ]</a>
              <a href="author.html#11928">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
We've rewritten our programm without using any &quot;server side&quot; text-size 
calculation...
I just use the client browser, (a table without any fixed width can adapt his 
size automatically)
Now, my pages loads as fast as MS.NET
But, the problem isn't here 
System.Drawing font measure function is incredibly slower and CPU intensive 
than MS.NET... I can do benchmarks if you want... (i've gentoo linux and 
WS2003 on the same machine)

Le Jeudi 12 Mai 2005 19:50, Rafael Teixeira a &#233;crit&#160;:
&gt;<i> Also, you can create that font only once (cache it by the Name and
</I>&gt;<i> Size) and reuse in many pages, just beware o memory consumption, if
</I>&gt;<i> you doesn't limit the choices for fonts and sizes.
</I>&gt;<i>
</I>&gt;<i> I also reiterate what Ben said, doesn't calculate things on the
</I>&gt;<i> server, because things will go diferently on the client. To add
</I>&gt;<i> another issue (besides user-chosen-css, installed fonts) the
</I>&gt;<i> resolution may be different, what makes the same font render quite
</I>&gt;<i> differently.
</I>&gt;<i>
</I>&gt;<i> HIH,
</I>&gt;<i>
</I>&gt;<i> On 5/12/05, Ben Maurer &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bmaurer at ximian.com</A>&gt; wrote:
</I>&gt;<i> &gt; On Thu, 2005-05-12 at 11:04 +0200, Hubert FONGARNAND wrote:
</I>&gt;<i> &gt; &gt; I apologize, i've found my problem...
</I>&gt;<i> &gt; &gt; This slowdown is due to System.Drawing
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Let me explain...
</I>&gt;<i> &gt; &gt; Mono renders a page with more than 100 menu, for each menu, the largest
</I>&gt;<i> &gt; &gt; item size is calculated by this function :
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;                 SizeF size;
</I>&gt;<i> &gt; &gt;                   float emSize =
</I>&gt;<i> &gt; &gt; Convert.ToSingle(fontInfo.Size.Unit.Value); emSize = (emSize==0 ?8
</I>&gt;<i> &gt; &gt; :emSize);
</I>&gt;<i> &gt; &gt;                   Font stringFont = new Font(fontInfo.Name, emSize);
</I>&gt;<i> &gt; &gt;                   Graphics g=new Bitmap(1,1);
</I>&gt;<i> &gt; &gt;                   size = g.MeasureString(text, stringFont);
</I>&gt;<i> &gt; &gt;                 g.Dispose();
</I>&gt;<i> &gt; &gt;                   return size;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; After doing some tests, i've seen that the slowest line is :
</I>&gt;<i> &gt; &gt;                   Font stringFont = new Font(fontInfo.Name, emSize);
</I>&gt;<i> &gt; &gt; So the creation of this Font object (the font is Arial) is extremely
</I>&gt;<i> &gt; &gt; slow comparing to MS.NET...
</I>&gt;<i> &gt; &gt; If I remove this line, the page loads as fast as MS.NET (a little bit
</I>&gt;<i> &gt; &gt; faster...)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Is there a way to optimize System.Drawing for this problem;
</I>&gt;<i> &gt; &gt; or is there a better way to measure a text string length (with variable
</I>&gt;<i> &gt; &gt; font size) without using this very slow function...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm not sure how much we can speed that up. I can take a look at how
</I>&gt;<i> &gt; Cairo does the stuff.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; However, if I understand what you are doing correctly, you are trying to
</I>&gt;<i> &gt; measure a string on the server and see how large it will be on the
</I>&gt;<i> &gt; client. I am not sure how well that will work. On the client side,
</I>&gt;<i> &gt; people might have different fonts installed, or might even use a user
</I>&gt;<i> &gt; css sheet. Nonetheless, we should still try to be faster here.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -- Ben
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>_______________________________________________
Ce message et les &#233;ventuels documents joints peuvent contenir des informations confidentielles.
Au cas o&#249; il ne vous serait pas destin&#233;, nous vous remercions de bien vouloir le supprimer et en aviser imm&#233;diatement l'exp&#233;diteur. Toute utilisation de ce message non conforme &#224; sa destination, toute diffusion ou publication, totale ou partielle et quel qu'en soit le moyen est formellement interdite.
Les communications sur internet n'&#233;tant pas s&#233;curis&#233;es, l'int&#233;grit&#233; de ce message n'est pas assur&#233;e et la soci&#233;t&#233; &#233;mettrice ne peut &#234;tre tenue pour responsable de son contenu.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011922.html">[Mono-devel-list] Mono ASP.NET is very slow with big html pages...
</A></li>
	<LI>Next message: <A HREF="011898.html">[Mono-devel-list] [ANN] X-develop 1.0.1 with Mac OS X support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11928">[ date ]</a>
              <a href="thread.html#11928">[ thread ]</a>
              <a href="subject.html#11928">[ subject ]</a>
              <a href="author.html#11928">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
