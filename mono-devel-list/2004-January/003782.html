<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] A how to for Mono on OS X Panther Building (w/ JIT and GC to boot)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20A%20how%20to%20for%20Mono%20on%20OS%20X%20Panther%20Building%20%28w/%20JIT%20and%20GC%20to%20boot%29&In-Reply-To=F3869728-4FF1-11D8-A6FF-000A95A4DC82%40morford.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003776.html">
   <LINK REL="Next"  HREF="003778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] A how to for Mono on OS X Panther Building (w/ JIT and GC to boot)</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20A%20how%20to%20for%20Mono%20on%20OS%20X%20Panther%20Building%20%28w/%20JIT%20and%20GC%20to%20boot%29&In-Reply-To=F3869728-4FF1-11D8-A6FF-000A95A4DC82%40morford.org"
       TITLE="[Mono-devel-list] A how to for Mono on OS X Panther Building (w/ JIT and GC to boot)">lupus at ximian.com
       </A><BR>
    <I>Mon Jan 26 10:42:46 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="003776.html">[Mono-devel-list] A how to for Mono on OS X Panther Building (w/ JIT and GC to boot)
</A></li>
        <LI>Next message: <A HREF="003778.html">[Mono-devel-list] [PATCH] AssemblyBuilder.cs to support strongnaming at compile time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3782">[ date ]</a>
              <a href="thread.html#3782">[ thread ]</a>
              <a href="subject.html#3782">[ subject ]</a>
              <a href="author.html#3782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the writeup, Below my comments.

On 01/26/04 Dave Morford wrote:
&gt;<i> flags will result in a successful compile, link, install and that of 
</I>&gt;<i> the 140 tests in the mono/tests directory, only 21 fail. Doing this on 
</I>
Are you running the tests with mint or with the jit? The results match
the current status of the jit on MacOSX 10.2, but on a 10.3 machine
I have access to there are a lot more errors (dunno yet why, debugging
is also a pain, since gdb keeps crashing). Did you test on a dual or
uniprocessor?

&gt;<i> 	1. Boehm GC 6.3a4 is required. I could never get the built-in 
</I>&gt;<i> 	version, the stable version hand built or the port from DarwinPorts work.
</I>
Yes, previous versions of libgc were buggy, so, on MacOSX get the
version at: <A HREF="http://www.hpl.hp.com/personal/Hans_Boehm/gc/gc_source">http://www.hpl.hp.com/personal/Hans_Boehm/gc/gc_source</A> .
We'll include those sources in the mono package after the next release.

&gt;<i> 	3. I did not, and will not, try this on OS X Jaguar. The differences 
</I>&gt;<i> are too great and I think using Panther as the working target for 
</I>&gt;<i> success moving forward is the best option.
</I>
Mono builds and works ok for me on 10.2: the changes to keep it working
on both should be minimal (plus, I have 10.2 and no current plans of
upgrading;-).

&gt;<i> 2. Run the following tools in the order specified below in the root of 
</I>&gt;<i> the mono snapshot:
</I>&gt;<i> 
</I>&gt;<i> glibtoolize --force --copy
</I>&gt;<i> aclocal
</I>&gt;<i> autoheader
</I>&gt;<i> automake --add-missing --gnu
</I>&gt;<i> autoconf
</I>
This is the same thing done by ./autogen.sh, so just running that should
work as well.

&gt;<i> 3. Run configure with these options:
</I>&gt;<i> 
</I>&gt;<i> ./configure --prefix=/usr/local --disable-static 
</I>&gt;<i> LDFLAGS=-L/usr/local/lib CFLAGS=-I/usr/local/include 
</I>&gt;<i> CPPFLAGS=-I/usr/local/include --with-gc=boehm 
</I>&gt;<i> --program-transform-name=s/libtool/glibtool/
</I>
This last option should not be needed, at least I never used it, but
maybe it depends on the version of automake/libtool used.

&gt;<i> 4. Make the following change before running make:
</I>&gt;<i> 	
</I>&gt;<i> 	a. comment out the #ifdef __APPLE__ at the top of the file 
</I>&gt;<i> mono/io-layer/sockets.h. This is not needed on 10.3, only 10.2.
</I>
This is now removed from the source, so this step should not be needed.

&gt;<i> 	b. in mono/mini, run: grep -n &quot;version-script&quot; Makefile. This should 
</I>&gt;<i> return, at least on the 0.30 Previews, the following: 157:#monoldflags 
</I>&gt;<i> = -Wl,-version-script=$(srcdir)/ldscript. If this line is not commented 
</I>&gt;<i> out and/or has a ./ldscript instead of $(srcdir)/ldscript, you can 
</I>&gt;<i> comment it out or remove the &quot;-Wl,&quot;. I commented it out to no problems 
</I>&gt;<i> as well as removed the &quot;-Wl,&quot;, which fails when linking.
</I>
This step should not be needed as well, as you point out the flag is
already commented out on MacOSX.

&gt;<i> Tests on primes, fibonacci, reflection, language and runtime/vm objects 
</I>&gt;<i> and ops (class, interface, cast, box, etc) all seem to pass in 
</I>&gt;<i> mono/tests. PInvoke, threads, appdomains, vararg and setenv stand out 
</I>&gt;<i> as tests that fail currently.
</I>
Exception-related tests should fail as well: I'm working on that code on
Linux/PPC currently, later I'll see how much of it can be reused on
MacOSX (which seems to require it's own thread to intercept mach
messages before they are converted to signals, sigh, I'd wish they'd fix
the signal implemenatation instead...).

&gt;<i> 1. Some of the assumptions in the configure scripts, in particular 
</I>&gt;<i> threading, need to be examined. gcc does not need the -pthread flags to 
</I>
But using -pthread doesn't give any error, so this is a non-issue.

&gt;<i> 2. The ICU check looks for icu-config and fails but ICU *is* present on 
</I>&gt;<i> OS X Panther in /usr/lib/libicucore.dylib but the icu-config tool is 
</I>&gt;<i> not present. Perhaps a better check for this is possible? Does it need 
</I>&gt;<i> to be linked in or is icu-config called or used anywhere?
</I>
It's called to collect the compile flags to use when linking it.
However, I had reports that the jit fails when icu is used, so I suggest
not trying to enable it in the meantime (you need to provide your own
icu-config script since it seems it's not installed by default).
Anyway, we're also dropping the libicu dependency, so it's not a big
issue.

&gt;<i> 3. Interop needs some work. I was able to get one or two PInvoke calls 
</I>&gt;<i> through to some NS* objects in AppKit and Foundation in the Cocoa API, 
</I>&gt;<i> but anything that did Windowing punted. I've just installed the latest 
</I>&gt;<i> CHUD tools from Apple, so these will help in looking at the problems.
</I>
One issue to check for is if on 10.3, the default dl_open()
implementation works for shared libraries (as opposed to bundles).
I read somewhere that they may have the support, though it could be
half-assed (requires the complete path to the file etc.). If someone
could do a few tests on this and report it would be nice. If it works
that way we'll need to write our own code to support P/Invoke
(note we use the dl_* API through the GModule GLib interface).

As for the objective-C support, I'd like to handle it mostly in the same
way COM stuff is handled in the MS CLR on windows: a tool is used to
create assemblies whose types describe the objective-C classes, then the
runtime automatically marshals data between the CLR and the objective-C
world, etc.

Other tasks where people may help are:
*) support for mono --aot: this currently gives a few errors in the
assembly output, we need to adapt it to whatever the MacOSX assembler
accepts. A brave programmer could also contribute the code to build a
Mach-O binary directly...
*) of course, help debugging the errors we still get from the jit is
appreciated, especially if people have working debuggers on their
boxes:-)
*) later speed tuning needs to be done as well: currently the
performance of the jit is not bad, but we still have register allocation
and iniling disabled and there are quite a few arch-specific
optimizations that we could implement.

Thanks.
lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003776.html">[Mono-devel-list] A how to for Mono on OS X Panther Building (w/ JIT and GC to boot)
</A></li>
	<LI>Next message: <A HREF="003778.html">[Mono-devel-list] [PATCH] AssemblyBuilder.cs to support strongnaming at compile time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3782">[ date ]</a>
              <a href="thread.html#3782">[ thread ]</a>
              <a href="subject.html#3782">[ subject ]</a>
              <a href="author.html#3782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
