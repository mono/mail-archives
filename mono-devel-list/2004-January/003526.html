<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] reading a lot of files without closing them
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20reading%20a%20lot%20of%20files%20without%20closing%20them&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003527.html">
   <LINK REL="Next"  HREF="003547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] reading a lot of files without closing them</H1>
    <B>A Rafael D Teixeira</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20reading%20a%20lot%20of%20files%20without%20closing%20them&In-Reply-To="
       TITLE="[Mono-devel-list] reading a lot of files without closing them">rafaelteixeirabr at hotmail.com
       </A><BR>
    <I>Sun Jan 11 11:35:03 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="003527.html">[Mono-devel-list] making --debug the default in the runtime
</A></li>
        <LI>Next message: <A HREF="003547.html">[Mono-devel-list] reading a lot of files without closing  them
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3526">[ date ]</a>
              <a href="thread.html#3526">[ thread ]</a>
              <a href="subject.html#3526">[ subject ]</a>
              <a href="author.html#3526">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>From: David Sheldon &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dave-monolist at earth.li</A>&gt;
</I>&gt;<i>
</I>&gt;<i>My code was something like this:
</I>&gt;<i>
</I>&gt;<i>try {
</I>&gt;<i>   XmlValidatingReader xvr = new XmlValidatingReader (new 
</I>&gt;<i>XmlTextReader(filename));
</I>&gt;<i>   while(!xvr.EOF)
</I>&gt;<i>     xvr.Read();
</I>&gt;<i>   xvr.Close();
</I>&gt;<i>}
</I>&gt;<i>catch (XmlSchemaException ex) {
</I>&gt;<i>   // print error
</I>&gt;<i>}
</I>
Well, commonly it should be coded as below, as the OBLIGATION to close the 
file is yours, because the finalizer may never be called by the gc, and even 
when it is called that may be too late anyway...

try {
   XmlValidatingReader xvr = new XmlValidatingReader (new 
XmlTextReader(filename));
   try {
     while(!xvr.EOF)
       xvr.Read();
   } finally {
     xvr.Close();
   }
}
catch (XmlSchemaException ex) {
   // print error
}

But being somewhat (some people say totally) lazy myself, I like to abuse of 
the 'using' statement, and as you pointed that  XmlValidatingReader doesn't 
implement IDisposable I just have my handy homegrown subclass:

class DXmlValidatingReader : XmlValidatingReader, IDisposable
{
  public DXmlValidatingReader(string FileName) : base(new 
XmlTextReader(FileName)) {}

  void IDisposable.Dispose() { this.Close(); }
}

And so the code becomes:

try {
  using (DXmlValidatingReader xvr = new DXmlValidatingReader (filename) ) {
    while(!xvr.EOF)
      xvr.Read();
  }
} catch (XmlSchemaException ex) {
  // print error
}

Rafael Teixeira
Brazilian Polymath
Mono Hacker since 16 Jul 2001
MonoBrasil Founding Member - Membro Fundador do MonoBrasil
English Blog: <A HREF="http://monoblog.blogspot.com/">http://monoblog.blogspot.com/</A>

_________________________________________________________________
MSN Messenger: converse com os seus amigos online.  
<A HREF="http://messenger.msn.com.br">http://messenger.msn.com.br</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003527.html">[Mono-devel-list] making --debug the default in the runtime
</A></li>
	<LI>Next message: <A HREF="003547.html">[Mono-devel-list] reading a lot of files without closing  them
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3526">[ date ]</a>
              <a href="thread.html#3526">[ thread ]</a>
              <a href="subject.html#3526">[ subject ]</a>
              <a href="author.html#3526">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
