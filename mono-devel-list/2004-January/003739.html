<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Corlib test cases
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Corlib%20test%20cases&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003738.html">
   <LINK REL="Next"  HREF="003746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Corlib test cases</H1>
    <B>Bernie Solomon</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Corlib%20test%20cases&In-Reply-To="
       TITLE="[Mono-devel-list] Corlib test cases">bernard at ugsolutions.com
       </A><BR>
    <I>Thu Jan 22 19:02:11 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="003738.html">[Mono-devel-list] Corlib test cases
</A></li>
        <LI>Next message: <A HREF="003746.html">[Mono-devel-list] Corlib test cases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3739">[ date ]</a>
              <a href="thread.html#3739">[ thread ]</a>
              <a href="subject.html#3739">[ subject ]</a>
              <a href="author.html#3739">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; 17) MonoTests.System.IO.BinaryReaderTest.ReadDecimal : test#01
</I>&gt;<i> &gt; expected:&lt;-18295873486192640&gt;
</I>&gt;<i> &gt; but was:&lt;18295873486192640&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; in [0x00043] (at
</I>/home/sheldon/hacking/mono/raw_cvs/mcs/class/corlib/Test/System.IO/BinaryRea
derTest.cs:977) MonoTests.System.IO.BinaryReaderTest:ReadDecimal ()
&gt;<i>
</I>&gt;<i> Oh, this is an interesting one. If I run the following code on MS.NET I
</I>get:
&gt;<i>
</I>&gt;<i> d is -18295873486192640
</I>&gt;<i> d != -18295873486192640
</I>
This seems a good effort to me (when working on ports it was hard to know if
failures were due to the port or the class libraries as I didn't know what
expected results were without trying elsewhere too).

Sometime ago I actually did a little poking about on this as I didn't know
if it was my porting problem or not. In the runtime's header it has the
following - though I don't know how this was found. If you change this so
the sign is the whole byte (i.e. removed reserved2 and change sign) then the
behaviour is similar to what you say here - treating any non-zero value of
sign as -ve and you get the same value. But the actual byte stream seems
like a corrupt decimal. Whether behaviour on such streams should be
indentical is open to debate. However perhaps the fix is to make the test
use a cleaner version of the number. Or change the run-times handling of
sign to produce similar odd behaviour is another solution.

Bernie

typedef struct
{
	union {
		guint32 ss32;
#if G_BYTE_ORDER != G_LITTLE_ENDIAN
	    struct {
		    unsigned int sign      : 1;
		    unsigned int reserved2 : 7;
		    unsigned int scale     : 8;
		    unsigned int reserved1 : 16;
	    } signscale;
#else
	    struct {
		    unsigned int reserved1 : 16;
		    unsigned int scale     : 8;
		    unsigned int reserved2 : 7;
		    unsigned int sign      : 1;
	    } signscale;
#endif
	} u;
    guint32 hi32;
    guint32 lo32;
    guint32 mid32;
} decimal_repr;



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003738.html">[Mono-devel-list] Corlib test cases
</A></li>
	<LI>Next message: <A HREF="003746.html">[Mono-devel-list] Corlib test cases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3739">[ date ]</a>
              <a href="thread.html#3739">[ thread ]</a>
              <a href="subject.html#3739">[ subject ]</a>
              <a href="author.html#3739">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
