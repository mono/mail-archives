<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Native code in mcs &amp; Mono.Posix
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Native%20code%20in%20mcs%20%26%20Mono.Posix&In-Reply-To=1073531877.3762.2336.camel%40erandi.boston.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003501.html">
   <LINK REL="Next"  HREF="003492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Native code in mcs &amp; Mono.Posix</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Native%20code%20in%20mcs%20%26%20Mono.Posix&In-Reply-To=1073531877.3762.2336.camel%40erandi.boston.ximian.com"
       TITLE="[Mono-devel-list] Native code in mcs &amp; Mono.Posix">lupus at ximian.com
       </A><BR>
    <I>Thu Jan  8 09:20:52 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="003501.html">[Mono-devel-list] Native code in mcs &amp; Mono.Posix
</A></li>
        <LI>Next message: <A HREF="003492.html">[Mono-devel-list] Native code in mcs &amp; Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3499">[ date ]</a>
              <a href="thread.html#3499">[ thread ]</a>
              <a href="subject.html#3499">[ subject ]</a>
              <a href="author.html#3499">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/07/04 Miguel de Icaza wrote:
&gt;<i> The reason for the code to live in mcs, is that the C code that is
</I>&gt;<i> compiled needs to know about the values defined in the C# world.  So the
</I>&gt;<i> solution is to use a C# program with attributes, and from this we
</I>&gt;<i> generate the C code that gets compiled.
</I>&gt;<i> 
</I>&gt;<i> There are a couple of options to fix this, some more gross than others:
</I>&gt;<i> 
</I>&gt;<i> 	* Move the Mono.Posix assembly code into mono.
</I>&gt;<i> 
</I>&gt;<i> 	  This would mean that the mono/ compilation process would need
</I>&gt;<i> 	  a working C# compiler, which is not a problem, since we ship
</I>&gt;<i> 	  binaries on it already in the mono/runtime directory.
</I>&gt;<i> 
</I>&gt;<i> 	  That way we could use libtool.
</I>&gt;<i> 
</I>&gt;<i> 	* Keep the code in mcs, but generate the map.c and map.h files
</I>&gt;<i> 	  into $(topdir)/../mono/monoposix/ directory.
</I>&gt;<i> 
</I>&gt;<i> 	  This would add a crossed dependency between the two modules.
</I>&gt;<i> 	  To make our life simpler, we could check in the generated
</I>&gt;<i> 	  files into CVS, so the only person that has this issue is the
</I>&gt;<i> 	  maintainer of the code.
</I>&gt;<i> 
</I>&gt;<i> 	* Remove the support for the shared library until we find a
</I>&gt;<i> 	  reasonable thing to do.
</I>&gt;<i> 
</I>&gt;<i> 	* Move the new C runtime code into a new module, &quot;c-helpers&quot;,
</I>&gt;<i> 	  and put the Cairo and Posix stuff there.
</I>&gt;<i> 
</I>&gt;<i> These are all quite ugly solutions, I tried to have something
</I>&gt;<i> kind-of-clean, but I did not have in mind those doing cross-compilation
</I>&gt;<i> when I did it.
</I>
I think the cairo helper lib should go in it's own separate cvs module
with a propor autotools setup: we could add it inside the mono
module as well, but only if the cairo source is added as well (we
don't need to inflict the cairo API instabilities on everyone).
Note that this can be done with a cvs virtual module as well.

The posix stuff is different, IMHO: I don't see the need to use
a library to export a few constants and a couple of simple macros.
It would be much better both performance-wise and complexity-wise to
redo that stuff in managed code (the managed code can be generated with
a C program, of course). I would also not do the constant remapping of
the values: exposing the constants as properties or readonly static
variables is a better way to do it, but that's a separate issue.
So, for Mono.Posix the helper shared lib should be dropped completely.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003501.html">[Mono-devel-list] Native code in mcs &amp; Mono.Posix
</A></li>
	<LI>Next message: <A HREF="003492.html">[Mono-devel-list] Native code in mcs &amp; Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3499">[ date ]</a>
              <a href="thread.html#3499">[ thread ]</a>
              <a href="subject.html#3499">[ subject ]</a>
              <a href="author.html#3499">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
