<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for Bug 8207: Can't set 1000000 baud with	System.IO.Ports.SerialPort.BaudRate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Patch%20for%20Bug%208207%3A%20Can%27t%20set%201000000%20baud%20with%0A%09System.IO.Ports.SerialPort.BaudRate&In-Reply-To=%3CCANqeOFqN_g2B_2NvTDWEW2aQx3Pw9XfOMRLyetpZdBKHraXvUw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042950.html">
   <LINK REL="Next"  HREF="042956.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for Bug 8207: Can't set 1000000 baud with	System.IO.Ports.SerialPort.BaudRate</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Patch%20for%20Bug%208207%3A%20Can%27t%20set%201000000%20baud%20with%0A%09System.IO.Ports.SerialPort.BaudRate&In-Reply-To=%3CCANqeOFqN_g2B_2NvTDWEW2aQx3Pw9XfOMRLyetpZdBKHraXvUw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Patch for Bug 8207: Can't set 1000000 baud with	System.IO.Ports.SerialPort.BaudRate">miguel at xamarin.com
       </A><BR>
    <I>Tue May 12 13:50:59 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="042950.html">[Mono-dev] Recipe for target 'install-frameworks' failed
</A></li>
        <LI>Next message: <A HREF="042956.html">[Mono-dev] Building 4.0.1.34 release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42952">[ date ]</a>
              <a href="thread.html#42952">[ thread ]</a>
              <a href="subject.html#42952">[ subject ]</a>
              <a href="author.html#42952">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mono 4.0 branched a long time ago, so it is possible that this is just a
side effect of that.

But you can check the patch in git, if the patch is not on the mono 4.0.0
branch, and only in master, it means that it will be part of Mono 4.2

Miguel

On Tue, May 12, 2015 at 4:47 AM, Ariel Rocholl &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">publico at arocholl.com</A>&gt; wrote:

&gt;<i> Hi there,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I don&#8217;t see this included in Mono 4.0, probably misunderstood this one
</I>&gt;<i> would be merged into 4.0.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Do you have a target release where this will be available?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Best Regards,
</I>&gt;<i> ----
</I>&gt;<i> Ariel Rocholl
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] *On Behalf Of *Miguel de Icaza
</I>&gt;<i> *Sent:* Wednesday, February 25, 2015 17:45
</I>&gt;<i> *To:* Christian Hofstaedtler
</I>&gt;<i> *Cc:* mono-devel
</I>&gt;<i> *Subject:* Re: [Mono-dev] Patch for Bug 8207: Can't set 1000000 baud with
</I>&gt;<i> System.IO.Ports.SerialPort.BaudRate
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Applied, and updated also to support Mac.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Feb 24, 2015 at 3:45 PM, Christian Hofstaedtler &lt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ch---mono-devel at zeha.at</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> This patch (against mono-2.10.8.1 from Debian) allows setting
</I>&gt;<i> custom baud rates, and very likely would support a baudrate of
</I>&gt;<i> 1000000.
</I>&gt;<i>
</I>&gt;<i> I release this patch under the MIT license.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --- serial.c.orig       2013-01-30 12:06:52.379691461 +0100
</I>&gt;<i> +++ serial.c.orig       2013-01-30 13:05:50.383390154 +0100
</I>&gt;<i> @@ -17,6 +17,11 @@
</I>&gt;<i>  #endif
</I>&gt;<i>  #include &lt;sys/ioctl.h&gt;
</I>&gt;<i>
</I>&gt;<i> +/* This is for ASYNC_*, serial_struct on linux */
</I>&gt;<i> +#if defined(__linux__)
</I>&gt;<i> +#include &lt;linux/serial.h&gt;
</I>&gt;<i> +#endif
</I>&gt;<i> +
</I>&gt;<i>  #include &lt;glib.h&gt;
</I>&gt;<i>
</I>&gt;<i>  /* This is for FIONREAD on solaris */
</I>&gt;<i> @@ -151,6 +156,7 @@
</I>&gt;<i>  set_attributes (int fd, int baud_rate, MonoParity parity, int dataBits,
</I>&gt;<i> MonoStopBits stopBits, MonoHandshake handshake)
</I>&gt;<i>  {
</I>&gt;<i>         struct termios newtio;
</I>&gt;<i> +       gboolean custom_baud_rate = FALSE;
</I>&gt;<i>
</I>&gt;<i>         if (tcgetattr (fd, &amp;newtio) == -1)
</I>&gt;<i>                 return FALSE;
</I>&gt;<i> @@ -227,8 +233,10 @@
</I>&gt;<i>             break;
</I>&gt;<i>         case 50:
</I>&gt;<i>         case 0:
</I>&gt;<i> -       default:
</I>&gt;<i>             baud_rate = B9600;
</I>&gt;<i> +           break;
</I>&gt;<i> +       default:
</I>&gt;<i> +           custom_baud_rate = TRUE;
</I>&gt;<i>                 break;
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i> @@ -319,16 +327,54 @@
</I>&gt;<i>             newtio.c_iflag |= IXOFF | IXON;
</I>&gt;<i>                 break;
</I>&gt;<i>         }
</I>&gt;<i> -
</I>&gt;<i> -       if (cfsetospeed (&amp;newtio, baud_rate) &lt; 0 || cfsetispeed (&amp;newtio,
</I>&gt;<i> baud_rate) &lt; 0 ||
</I>&gt;<i> -           tcsetattr (fd, TCSANOW, &amp;newtio) &lt; 0)
</I>&gt;<i> +
</I>&gt;<i> +       if (custom_baud_rate == FALSE)
</I>&gt;<i>         {
</I>&gt;<i> -               return FALSE;
</I>&gt;<i> +               if (cfsetospeed (&amp;newtio, baud_rate) &lt; 0 || cfsetispeed
</I>&gt;<i> (&amp;newtio, baud_rate) &lt; 0)
</I>&gt;<i> +               {
</I>&gt;<i> +                       return FALSE;
</I>&gt;<i> +               }
</I>&gt;<i>         }
</I>&gt;<i>         else
</I>&gt;<i>         {
</I>&gt;<i> -       return TRUE;
</I>&gt;<i> +               /* On Linux, to set a custom baud rate, we must set the
</I>&gt;<i> &quot;standard&quot; baud_rate
</I>&gt;<i> +                * to 38400. */
</I>&gt;<i> +               if (cfsetospeed (&amp;newtio, B38400) &lt; 0 || cfsetispeed
</I>&gt;<i> (&amp;newtio, B38400) &lt; 0)
</I>&gt;<i> +               {
</I>&gt;<i> +                       return FALSE;
</I>&gt;<i> +               }
</I>&gt;<i> +       }
</I>&gt;<i> +
</I>&gt;<i> +       if (tcsetattr (fd, TCSANOW, &amp;newtio) &lt; 0)
</I>&gt;<i> +       {
</I>&gt;<i> +               return FALSE;
</I>&gt;<i> +       }
</I>&gt;<i> +
</I>&gt;<i> +       if (custom_baud_rate == TRUE)
</I>&gt;<i> +       {
</I>&gt;<i> +#if defined(__linux__)
</I>&gt;<i> +               struct serial_struct ser;
</I>&gt;<i> +
</I>&gt;<i> +               if (ioctl (fd, TIOCGSERIAL, &amp;ser) &lt; 0)
</I>&gt;<i> +               {
</I>&gt;<i> +                       return FALSE;
</I>&gt;<i> +               }
</I>&gt;<i> +
</I>&gt;<i> +               ser.custom_divisor = ser.baud_base / baud_rate;
</I>&gt;<i> +               ser.flags &amp;= ~ASYNC_SPD_MASK;
</I>&gt;<i> +               ser.flags |= ASYNC_SPD_CUST;
</I>&gt;<i> +
</I>&gt;<i> +               if (ioctl (fd, TIOCSSERIAL, &amp;ser) &lt; 0)
</I>&gt;<i> +               {
</I>&gt;<i> +                       return FALSE;
</I>&gt;<i> +               }
</I>&gt;<i> +#else
</I>&gt;<i> +               /* Don't know how to set custom baud rate on this
</I>&gt;<i> platform. */
</I>&gt;<i> +               return FALSE;
</I>&gt;<i> +#endif
</I>&gt;<i>         }
</I>&gt;<i> +
</I>&gt;<i> +       return TRUE;
</I>&gt;<i>  }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20150512/16debf8d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20150512/16debf8d/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042950.html">[Mono-dev] Recipe for target 'install-frameworks' failed
</A></li>
	<LI>Next message: <A HREF="042956.html">[Mono-dev] Building 4.0.1.34 release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42952">[ date ]</a>
              <a href="thread.html#42952">[ thread ]</a>
              <a href="subject.html#42952">[ subject ]</a>
              <a href="author.html#42952">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
