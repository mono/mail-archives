<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] TCP 3.0.1/2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20TCP%203.0.1/2&In-Reply-To=%3CCACmR%2BBDrdivY_PjoagRviChq2vLqDZ_0r7HoxViOGghPqL9wWQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039855.html">
   <LINK REL="Next"  HREF="039859.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] TCP 3.0.1/2</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20TCP%203.0.1/2&In-Reply-To=%3CCACmR%2BBDrdivY_PjoagRviChq2vLqDZ_0r7HoxViOGghPqL9wWQ%40mail.gmail.com%3E"
       TITLE="[Mono-dev] TCP 3.0.1/2">kumpera at gmail.com
       </A><BR>
    <I>Wed Nov 28 13:39:02 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="039855.html">[Mono-dev] TCP 3.0.1/2
</A></li>
        <LI>Next message: <A HREF="039859.html">[Mono-dev] TCP 3.0.1/2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39858">[ date ]</a>
              <a href="thread.html#39858">[ thread ]</a>
              <a href="subject.html#39858">[ subject ]</a>
              <a href="author.html#39858">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please point us to the relevant patches that you believe are missing from
3.0 and I'll review them.

In the meanwhile, here's the commit that reverted one of your changes due
to deadlocks.

Locking should be done on the backend not on the frontend.

commit 47dd377f8587b466475ac5a6cf548f49b9394d0d
Author: Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt;
Date:   Thu Nov 1 17:43:25 2012 -0400

    Revert &quot;Merge pull request #464 from gregoryyoung/master&quot;

    This commit causes deadlock in the tpool backend in the following way:

    thread 1:
        socket_io_add locks io_lock
        tp_poll_modify waits on new_sem

    thread 2:
        tp_poll_wait tries to lock io_lock

    tp_poll_wait is the responsible to post to new_sem, which it can't do
since it's
    blocked on io_lock, held by a thread waiting on new_sem.

    This reverts commit 11286da0ac2e2bab7b2d8ab04b9f6a4da4e12131, reversing


On Wed, Nov 28, 2012 at 1:23 AM, Greg Young &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>&gt; wrote:

&gt;<i> I would be curious in talking a bit more about this because without it
</I>&gt;<i> TCP does not work reliably.
</I>&gt;<i>
</I>&gt;<i> btw: having run billions of calls through TCP under load we have never
</I>&gt;<i> seen a deadlock on it. Could you describe the deadlock scenario?
</I>&gt;<i>
</I>&gt;<i> Greg
</I>&gt;<i>
</I>&gt;<i> On Tue, Nov 27, 2012 at 9:37 PM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; It depends on what patches. One I did merge had to be reverted due to
</I>&gt;<i> &gt; causing deadlocks.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Tue, Nov 27, 2012 at 1:45 PM, Greg Young &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; 3.0.1? We are seeing some of the same kinds of issues with TCP as
</I>&gt;<i> &gt;&gt; previously (eg call beginsend never get an endsend). There is
</I>&gt;<i> &gt;&gt; discussion in the history of the list. I can go figure out which
</I>&gt;<i> &gt;&gt; relevant patches might be missing but should we be expecting them to
</I>&gt;<i> &gt;&gt; have been brought forward?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Le doute n'est pas une condition agr&#233;able, mais la certitude est absurde.
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20121128/45d3a66e/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20121128/45d3a66e/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039855.html">[Mono-dev] TCP 3.0.1/2
</A></li>
	<LI>Next message: <A HREF="039859.html">[Mono-dev] TCP 3.0.1/2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39858">[ date ]</a>
              <a href="thread.html#39858">[ thread ]</a>
              <a href="subject.html#39858">[ subject ]</a>
              <a href="author.html#39858">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
