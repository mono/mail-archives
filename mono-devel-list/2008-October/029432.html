<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch: Fix fast generic virtual method calls with	remoting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%3A%20Fix%20fast%20generic%20virtual%20method%20calls%20with%0A%09remoting&In-Reply-To=8cca42d80810081517u49aa5d59wc13c2c924de48cf1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029423.html">
   <LINK REL="Next"  HREF="029446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch: Fix fast generic virtual method calls with	remoting</H1>
    <B>Mark Probst</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%3A%20Fix%20fast%20generic%20virtual%20method%20calls%20with%0A%09remoting&In-Reply-To=8cca42d80810081517u49aa5d59wc13c2c924de48cf1%40mail.gmail.com"
       TITLE="[Mono-dev] Patch: Fix fast generic virtual method calls with	remoting">mark.probst at gmail.com
       </A><BR>
    <I>Wed Oct  8 19:09:43 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="029423.html">[Mono-dev] Patch: Fix fast generic virtual method calls with	remoting
</A></li>
        <LI>Next message: <A HREF="029446.html">[Mono-dev] Patch: Fix fast generic virtual method calls	with	remoting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29432">[ date ]</a>
              <a href="thread.html#29432">[ thread ]</a>
              <a href="subject.html#29432">[ subject ]</a>
              <a href="author.html#29432">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Rodrigo,

&gt;<i> @@ -1991,7 +1990,7 @@
</I>&gt;<i>              iter = NULL;
</I>&gt;<i>              j = 0;
</I>&gt;<i>              while ((cm = mono_class_get_methods (interf, &amp;iter)))
</I>&gt;<i> -                pvt-&gt;vtable [slot + j++] = mono_method_signature
</I>&gt;<i> (cm)-&gt;generic_param_count ? cm : arch_create_remoting_trampoline (cm,
</I>&gt;<i> target_type);
</I>&gt;<i> +                pvt-&gt;vtable [slot + j++] = mono_method_signature
</I>&gt;<i> (cm)-&gt;generic_param_count ? cm : arch_create_remoting_trampoline (domain,
</I>&gt;<i> cm, target_type);
</I>&gt;<i>
</I>&gt;<i>              slot += mono_class_num_methods (interf);
</I>&gt;<i>          }
</I>&gt;<i>
</I>&gt;<i> Why this part of the vtable doesn't receive a remoting wrapper?
</I>
It probably needs one, too :-)

&gt;<i> Looks like your patch reverts Robert's changes and use a new trampoline
</I>&gt;<i> instead, thou there are other changes in object.c that haven't been changed
</I>&gt;<i> back and seen related to virtual generic methods.
</I>
My guess is that the changes regarding the vtable were just there to
save memory, i.e. to not create trampolines for the generic virtual
slots which are never jumped to.  Since fast virtual generic method
calls do jump to those slots, we need something there.

We don't have a particular test case for bug #78882, but we have
several tests for generic remoting invokes in the
System.Runtime.Remoting testsuite (those were the one that were
broken), which are fixed by this patch, and the test case attached
with the bug report runs as well.

Anyway, updated patch attached.

Mark
-------------- next part --------------
A non-text attachment was scrubbed...
Name: generic_virtual_remoting.diff
Type: text/x-diff
Size: 7238 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20081009/ded41fe7/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20081009/ded41fe7/attachment-0001.bin</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029423.html">[Mono-dev] Patch: Fix fast generic virtual method calls with	remoting
</A></li>
	<LI>Next message: <A HREF="029446.html">[Mono-dev] Patch: Fix fast generic virtual method calls	with	remoting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29432">[ date ]</a>
              <a href="thread.html#29432">[ thread ]</a>
              <a href="subject.html#29432">[ subject ]</a>
              <a href="author.html#29432">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
