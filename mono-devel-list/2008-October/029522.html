<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch: Stack alignment on x86
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%3A%20Stack%20alignment%20on%20x86&In-Reply-To=295e750a0810170954o33f40e5et27c2eef8e98d9c39%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029521.html">
   <LINK REL="Next"  HREF="029523.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch: Stack alignment on x86</H1>
    <B>Mark Probst</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%3A%20Stack%20alignment%20on%20x86&In-Reply-To=295e750a0810170954o33f40e5et27c2eef8e98d9c39%40mail.gmail.com"
       TITLE="[Mono-dev] Patch: Stack alignment on x86">mark.probst at gmail.com
       </A><BR>
    <I>Fri Oct 17 13:06:33 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="029521.html">[Mono-dev] Patch: Stack alignment on x86
</A></li>
        <LI>Next message: <A HREF="029523.html">[Mono-dev] Patch: Stack alignment on x86
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29522">[ date ]</a>
              <a href="thread.html#29522">[ thread ]</a>
              <a href="subject.html#29522">[ subject ]</a>
              <a href="author.html#29522">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Zoltan,

&gt;<i>  Looks good. Why is this part needed:
</I>&gt;<i>
</I>&gt;<i> +                       if (cfg-&gt;method-&gt;wrapper_type ==
</I>&gt;<i> MONO_WRAPPER_NATIVE_TO_MANAGED ||
</I>&gt;<i> +                                       cfg-&gt;method-&gt;wrapper_type ==
</I>&gt;<i> MONO_WRAPPER_RUNTIME_INVOKE) {
</I>&gt;<i> +                               x86_pop_reg (code, X86_ESP);
</I>&gt;<i> +                       }
</I>&gt;<i>
</I>&gt;<i> Those wrappers are never called from managed code.
</I>
They are entry points from unmanaged code to managed code, and since
we can't rely on stack alignment in unmanaged code we have to align
the stack in those entry points.  What I do in those two wrappers is
to put stack alignment instructions around each call.  This is the
part after the call which restores the stack pointer.  The part that
goes before the call is in mono_arch_emit_call().

Mark
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029521.html">[Mono-dev] Patch: Stack alignment on x86
</A></li>
	<LI>Next message: <A HREF="029523.html">[Mono-dev] Patch: Stack alignment on x86
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29522">[ date ]</a>
              <a href="thread.html#29522">[ thread ]</a>
              <a href="subject.html#29522">[ subject ]</a>
              <a href="author.html#29522">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
