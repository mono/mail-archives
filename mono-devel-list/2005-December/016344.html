<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] XsdValidatingReader patch for multiple schema	validation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20XsdValidatingReader%20patch%20for%20multiple%20schema%0A%09validation&In-Reply-To=8A48FECDBB37A64D835609475C54E9DA01101CD6%40dm.croc.ru">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016293.html">
   <LINK REL="Next"  HREF="016297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] XsdValidatingReader patch for multiple schema	validation</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20XsdValidatingReader%20patch%20for%20multiple%20schema%0A%09validation&In-Reply-To=8A48FECDBB37A64D835609475C54E9DA01101CD6%40dm.croc.ru"
       TITLE="[Mono-dev] XsdValidatingReader patch for multiple schema	validation">atsushi at ximian.com
       </A><BR>
    <I>Mon Dec 26 09:19:10 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="016293.html">[Mono-dev] XsdValidatingReader patch for multiple schema validation
</A></li>
        <LI>Next message: <A HREF="016297.html">[Mono-dev] [PATCH] Validation for &lt;xsl:output&gt; attributes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16344">[ date ]</a>
              <a href="thread.html#16344">[ thread ]</a>
              <a href="subject.html#16344">[ subject ]</a>
              <a href="author.html#16344">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Applied the patch with a few changes. Thanks for a good test!

It would be better if you try &quot;make run-test&quot; to check if your changes
are fine.
It runs our unit tests and tells you if there is breaking tests. With
this patch 
it resulted in an infinite loop ;-)

Atsushi Eno

&gt;<i>  &lt;&lt;XsdValidatingReader.cs.diff&gt;&gt; Good day.
</I>&gt;<i> 
</I>&gt;<i> I've found an issue in implementation of XSD schema validation. This
</I>&gt;<i> feature works with MS.NET, but doesn't worked with Mono. I've fixed it
</I>&gt;<i> for my project. Can somebody check this patch and submit it to common
</I>&gt;<i> source base?
</I>&gt;<i> 
</I>&gt;<i> The problem is the next. schemaLocation attribute could handle multiple
</I>&gt;<i> schema references. They contained in this attribute as set of pairs
</I>&gt;<i> &lt;URI&gt;-&lt;schema file&gt;. But Mono validating only with last pair - the only
</I>&gt;<i> schema supported. While validating, XsdValidator reads these files and
</I>&gt;<i> collect it into the SchemasCollection. It was implemented in this way:
</I>&gt;<i> 
</I>&gt;<i> 				tmp = schemaLocation.Split
</I>&gt;<i> (XmlChar.WhitespaceChars);
</I>&gt;<i> ....
</I>&gt;<i> 				for (int i = 0; i &lt; tmp.Length; i += 2)
</I>&gt;<i> {
</I>&gt;<i> 					try {
</I>&gt;<i> 						schema =
</I>&gt;<i> ReadExternalSchema (tmp [i + 1]);
</I>&gt;<i> 					} catch (Exception) { // FIXME:
</I>&gt;<i> (wishlist) It is bad manner ;-(
</I>&gt;<i> 						if (!schemas.Contains
</I>&gt;<i> (tmp [i]))
</I>&gt;<i> 							HandleError
</I>&gt;<i> (String.Format (&quot;Could not resolve schema location URI: {0}&quot;,
</I>&gt;<i> 								i + 1 &lt;
</I>&gt;<i> tmp.Length ? tmp [i + 1] : String.Empty), null, true);
</I>&gt;<i> 						continue;
</I>&gt;<i> 					}
</I>&gt;<i> ...
</I>&gt;<i> 				}
</I>&gt;<i> 			}
</I>&gt;<i> 			if (schema != null) {
</I>&gt;<i> 				if (!schemas.Contains
</I>&gt;<i> (schema.TargetNamespace)) {
</I>&gt;<i> 					schemaAdded = true;
</I>&gt;<i> 					schemas.Add (schema);
</I>&gt;<i> 				}
</I>&gt;<i> 			}
</I>&gt;<i> 
</I>&gt;<i> As it can be seen, every pair of URI and file reads, analized... And the
</I>&gt;<i> end. Only the last schema added to collection, because it's out of
</I>&gt;<i> for-cycle.
</I>&gt;<i> My patch fixes this issue and also moves try-block from cycle (marked as
</I>&gt;<i> &quot;bad manner&quot;) to outer one - for correct error processing.
</I>&gt;<i> 
</I>&gt;<i> I've also attached test case. Binary and source for xmlvalue.exe utility
</I>&gt;<i> is simple example of call XmlValidationReader. Data for this example is
</I>&gt;<i> file testXSDvalidator.xml, that contains references to two schemas. This
</I>&gt;<i> test works with MS.NET, but fails for Mono 1.1.12. With my patch this
</I>&gt;<i> example works with Mono. I've tested it under Solaris 9 (SPARC).
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016293.html">[Mono-dev] XsdValidatingReader patch for multiple schema validation
</A></li>
	<LI>Next message: <A HREF="016297.html">[Mono-dev] [PATCH] Validation for &lt;xsl:output&gt; attributes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16344">[ date ]</a>
              <a href="thread.html#16344">[ thread ]</a>
              <a href="subject.html#16344">[ subject ]</a>
              <a href="author.html#16344">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
