<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] DataTable.Select() bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DataTable.Select%28%29%20bug&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016158.html">
   <LINK REL="Next"  HREF="016161.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] DataTable.Select() bug</H1>
    <B>Konstantin Triger</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DataTable.Select%28%29%20bug&In-Reply-To="
       TITLE="[Mono-dev] DataTable.Select() bug">kostat at mainsoft.com
       </A><BR>
    <I>Mon Dec 12 05:47:50 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="016158.html">[Mono-dev] LINQ Standard Query Operators for Mono
</A></li>
        <LI>Next message: <A HREF="016161.html">[Mono-dev] Service crashes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16159">[ date ]</a>
              <a href="thread.html#16159">[ thread ]</a>
              <a href="subject.html#16159">[ subject ]</a>
              <a href="author.html#16159">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,

 

Attached a fix for the following bug:

 

static void Main(string[] args)

{

            DataTable d = new DataTable();

            d.Columns.Add (new DataColumn (&quot;aaa&quot;));

            DataRow [] rows = d.Select (null, null,
DataViewRowState.Deleted);

            Console.Out.WriteLine (rows.Length.ToString ());

            d.Rows.Add (new object [] {&quot;bbb&quot;});

            d.Rows.Add (new object [] {&quot;bbb&quot;});

            rows = d.Select (null, null, DataViewRowState.Deleted);

            Console.Out.WriteLine (rows.Length.ToString ());

}

 

0 should be printed in both cases, but we print 2 in the second.

 

The reason for this behavior is wrong Index.Update() logic.

Actually we did several errors there:

1.	We were validating before the indices were updated.
2.	Not in all the cases the update was called.
3.	The update logic was broken as it did not provide enough info to
decide what has changed.

 

The attached patch fixes this. Please review.

If no one objects I'll commit.

 

Regards,

Konstantin Triger

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20051212/3edf8ebd/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20051212/3edf8ebd/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: index_update.diff
Type: application/octet-stream
Size: 19174 bytes
Desc: index_update.diff
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20051212/3edf8ebd/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20051212/3edf8ebd/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016158.html">[Mono-dev] LINQ Standard Query Operators for Mono
</A></li>
	<LI>Next message: <A HREF="016161.html">[Mono-dev] Service crashes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16159">[ date ]</a>
              <a href="thread.html#16159">[ thread ]</a>
              <a href="subject.html#16159">[ subject ]</a>
              <a href="author.html#16159">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
