<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] VB ... Very difficult to translate to C# !!!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20VB%20...%20Very%20difficult%20to%20translate%20to%20C%23%20%21%21%21&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006928.html">
   <LINK REL="Next"  HREF="006925.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] VB ... Very difficult to translate to C# !!!</H1>
    <B>A Rafael D Teixeira</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20VB%20...%20Very%20difficult%20to%20translate%20to%20C%23%20%21%21%21&In-Reply-To="
       TITLE="[Mono-devel-list] VB ... Very difficult to translate to C# !!!">rafaelteixeirabr at hotmail.com
       </A><BR>
    <I>Thu Jul  8 14:53:19 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006928.html">[Mono-devel-list] PATCH for System.Web.UI reloaded
</A></li>
        <LI>Next message: <A HREF="006925.html">[Mono-devel-list] free vb to c# converter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6915">[ date ]</a>
              <a href="thread.html#6915">[ thread ]</a>
              <a href="subject.html#6915">[ subject ]</a>
              <a href="author.html#6915">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>First of all, here an (untested) simplified version in VB.NET

Option Strict On

Public Class DCUtils

    Private Function AssemblePart(ByVal h As Integer) As String
        h = ((h \ 16) Xor (h * 16)) And 255
        Select Case h
            Case 0, 5, 36, 96, 124, 126
                Return String.Format(&quot;/%DCN{0:000}%/&quot;, h)
            Case Else
                Return Chr(h)
        End Select
    End Function

    Public Function LockToKey(ByVal Lck As String) As String
        Dim j As Integer

        Lck = Lck.Split(&quot; &quot;c)(0)

        LockToKey = AssemblePart(Asc(Lck) Xor Asc(Right$(Lck, 1)) Xor 
Asc(Right$(Lck, 2)) Xor 5)

        For j = 2 To Len(Lck)
            LockToKey = LockToKey &amp; AssemblePart(Asc(Mid$(Lck, j, 1)) Xor 
Asc(Mid$(Lck, j - 1, 1)))
        Next
    End Function

End Class

which converted to C# may become

using System;

namespace Yeah
{
	/// &lt;summary&gt;
	/// Summary description for Class1.
	/// &lt;/summary&gt;
	public class DCUtils
	{
		private static int Xor(params char[] values)
		{
			int h = (int)values[0];
			for (int j = 1; j &lt; values.Length; j++)
				h ^= (int)values[j];
			return h;
		}

		private static string AssemblePart(int h)
		{
			h = ((h / 16) ^ (h * 16)) &amp; 255;
			switch (h)
			{
				case 0: case 5: case 36: case 96: case 124: case 126:
					return String.Format(&quot;/%DCN{0:000}%/&quot;, h);
				default:
					System.Text.StringBuilder sb = new System.Text.StringBuilder(1);
					sb.Append((char)h);
					return sb.ToString();
			}
		}

		public static string LockToKey(string Lck)
		{
			Lck = Lck.Split(' ')[0];

			string result = AssemblePart(Xor(Lck[0], Lck[Lck.Length-1], 
Lck[Lck.Length-2], (char)5));

			for(int j = 1; j &lt; Lck.Length; j++)
				result = result + AssemblePart(Xor(Lck[j], Lck[j - 1]));

			return result;
		}
	}
}

All 3 versions (the old VB6 one and those new 2) run the same result for my 
test pattern &quot;Rumba 3&quot;

Hope it helps


Rafael &quot;Monoman&quot; Teixeira
Mono Hacker since 16 Jul 2001 - <A HREF="http://www.go-mono.org/">http://www.go-mono.org/</A>
MonoBrasil Founding Member - Membro Fundador do MonoBrasil 
<A HREF="http://monobrasil.softwarelivre.org">http://monobrasil.softwarelivre.org</A>
English Blog: <A HREF="http://monoblog.blogspot.com/">http://monoblog.blogspot.com/</A>
Brazilian Portuguese Blog: <A HREF="http://monoblog.weblogger.terra.com.br/">http://monoblog.weblogger.terra.com.br/</A>




&gt;<i>From: Alessandro Torrisi &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">alessandro.torrisi at eurone.it</A>&gt;
</I>&gt;<i>Reply-To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">alessandro.torrisi at eurone.it</A>
</I>&gt;<i>To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i>Subject: [Mono-devel-list] VB ... Very difficult to translate to C# !!!
</I>&gt;<i>Date: Thu, 08 Jul 2004 17:28:24 +0200
</I>&gt;<i>
</I>&gt;<i>Do you know how can I translate this in C# code ???
</I>&gt;<i>I have very difficulties...
</I>&gt;<i>
</I>&gt;<i>============================================================================
</I>&gt;<i>
</I>&gt;<i>Public Class DCUtils
</I>&gt;<i>
</I>&gt;<i>     Public Function LockToKey(ByVal Lck As String) As String
</I>&gt;<i>         Dim h As Integer, j As Integer, n As Integer
</I>&gt;<i>         n = 5
</I>&gt;<i>
</I>&gt;<i>         h = InStr(1, Lck, &quot; &quot;)
</I>&gt;<i>         If h Then Lck = Left$(Lck, h - 1)
</I>&gt;<i>
</I>&gt;<i>         h = Asc(Lck) Xor Asc(Right$(Lck, 1)) Xor Asc(Right$(Lck, 2)) Xor
</I>&gt;<i>n
</I>&gt;<i>         h = (h \ 16) Xor (h * 16)
</I>&gt;<i>
</I>&gt;<i>         Do While h &gt; 255
</I>&gt;<i>             h = h - 256
</I>&gt;<i>         Loop
</I>&gt;<i>
</I>&gt;<i>         Select Case h
</I>&gt;<i>             Case 0, 5, 36, 96, 124, 126
</I>&gt;<i>                 LockToKey = &quot;/%DCN&quot; &amp; Right$(&quot;00&quot; &amp; CStr(h), 3) &amp; &quot;%/&quot;
</I>&gt;<i>             Case Else
</I>&gt;<i>                 LockToKey = Chr(h)
</I>&gt;<i>         End Select
</I>&gt;<i>
</I>&gt;<i>         For j = 2 To Len(Lck)
</I>&gt;<i>             h = Asc(Mid$(Lck, j, 1)) Xor Asc(Mid$(Lck, j - 1, 1))
</I>&gt;<i>             h = (h \ 16) Xor (h * 16)
</I>&gt;<i>
</I>&gt;<i>             Do While h &gt; 255
</I>&gt;<i>                 h = h - 256
</I>&gt;<i>             Loop
</I>&gt;<i>
</I>&gt;<i>             Select Case h
</I>&gt;<i>                 Case 0, 5, 36, 96, 124, 126
</I>&gt;<i>                     LockToKey = LockToKey &amp; &quot;/%DCN&quot; &amp; Right$(&quot;00&quot; &amp;
</I>&gt;<i>CStr(h), 3) &amp; &quot;%/&quot;
</I>&gt;<i>                 Case Else
</I>&gt;<i>                     LockToKey = LockToKey &amp; Chr(h)
</I>&gt;<i>             End Select
</I>&gt;<i>         Next
</I>&gt;<i>     End Function
</I>&gt;<i>
</I>&gt;<i>End Class
</I>&gt;<i>
</I>&gt;<i>============================================================================
</I>&gt;<i>
</I>&gt;<i>Please help ME !!! Alex.
</I>&gt;<i>P.S. Compiling it with MBAS it took some error !!!
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-devel-list mailing list
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>
_________________________________________________________________
MSN Messenger: instale gr&#225;tis e converse com seus amigos. 
<A HREF="http://messenger.msn.com.br">http://messenger.msn.com.br</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006928.html">[Mono-devel-list] PATCH for System.Web.UI reloaded
</A></li>
	<LI>Next message: <A HREF="006925.html">[Mono-devel-list] free vb to c# converter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6915">[ date ]</a>
              <a href="thread.html#6915">[ thread ]</a>
              <a href="subject.html#6915">[ subject ]</a>
              <a href="author.html#6915">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
