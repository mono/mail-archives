<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] System.IO.FileStream behaves strangely on large files.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20System.IO.FileStream%20behaves%20strangely%20on%20large%20files.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006776.html">
   <LINK REL="Next"  HREF="006801.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] System.IO.FileStream behaves strangely on large files.</H1>
    <B>alfius</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20System.IO.FileStream%20behaves%20strangely%20on%20large%20files.&In-Reply-To="
       TITLE="[Mono-devel-list] System.IO.FileStream behaves strangely on large files.">alfius at freemail.gr
       </A><BR>
    <I>Thu Jul  1 07:41:41 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006776.html">[Mono-devel-list] Re: [Mono-list] Re: [Ximian-mono-list] Details of other testsuites, not included	in daily tests
</A></li>
        <LI>Next message: <A HREF="006801.html">[Mono-devel-list] System.IO.FileStream behaves strangely on	large files.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6769">[ date ]</a>
              <a href="thread.html#6769">[ thread ]</a>
              <a href="subject.html#6769">[ subject ]</a>
              <a href="author.html#6769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
I have observed some strange behaviour while using a FileStream to
access large files (&gt;4GB).

For example I have a large file 'bigfile':
-rw-r--r--    1 alf      users    4898967552 Jul  1 00:44 bigfile

When I run the following program:

---Code start------------------------------------

using System.IO;
using System;

class btest {

    public static void Main() 
    {
	FileStream fs=new FileStream(&quot;bigfile&quot;, FileMode.Open,
FileAccess.Read);
	
	Console.WriteLine(&quot;Offset 1: {0:x}&quot;, fs.Seek(0x1000000,
SeekOrigin.Begin));
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 2: {0:x}&quot;, fs.Seek(0x100,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 3: {0:x}&quot;, fs.Seek(0x7fffffff,
SeekOrigin.Begin));
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 4: {0:x}&quot;, fs.Seek(0x80000000,
SeekOrigin.Begin));
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 5: {0:x}&quot;, fs.Seek(0xf0000000,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 6: {0:x}&quot;, fs.Seek(0xfffffffe,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 7: {0:x}&quot;, fs.Seek(0x100000000,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 8: {0:x}&quot;, fs.Seek(0x1234555,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 9: {0:x}&quot;, fs.Seek(0x100000000,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	
	string[] files=Directory.GetFiles(&quot;.&quot;,&quot;*.cs&quot;);
	
	Console.WriteLine(&quot;Offset 10: {0:x}&quot;, fs.Seek(0x1234555,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());
	Console.WriteLine(&quot;Offset 11: {0:x}&quot;, fs.Seek(0x100000000,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());

	Console.WriteLine(&quot;Offset 12: {0:x}&quot;, fs.Seek(0xf0000000,
SeekOrigin.Begin));	
	Console.WriteLine(&quot;Value {0:x}&quot;, fs.ReadByte());    
    }

}

---Code End------------------------------------------------

---Results Start-------------------------------------------
$ mcs btest.cs
Compilation succeeded
$ mono --debug btest.exe
Offset 1: 1000000
Value 11
Offset 2: 100
Value b4
Offset 3: 7fffffff
Value e0
Offset 4: 80000000
Value 10
Offset 5: ffffffff
Value ae
Offset 6: ffffffff
Value fd
Offset 7: 100000000
Value c0
Offset 8: 1234555
Value c4
Offset 9: 100000000
Value f5
Offset 10: 1234555
Value c4
Offset 11: 100000000
Value f5

Unhandled Exception: System.IO.IOException: Win32 IO returned
ERROR_NO_MORE_FILES. Path: bigfile
in [0x00111] (at /cvs/mcs/class/corlib/System.IO/FileStream.cs:707)
System.IO.FileStream:Seek (long,System.IO.SeekOrigin)
in &lt;0x005f1&gt; btest:Main ()
---Results End-------------------------------------------

First of all when trying to access offsets between 0x80000000-0xffffffff
I some time get that the offset is 0xffffffff. Also when trying to
access an offset above 0x80000000 twice (eg offset 7,11) the results I
get from ReadByte() are not always the same.

Directory.GetFiles() seems to have a strange effect. After calling it,
all access that would be &quot;invalid&quot; before calling it (return 0xffffffff)
throw an apparently irrelevant exception.

I am missing something or are these bugs?

Thanks,
Alexandros

PS I am using Beta 2, haven't been able to get 1.0




____________________________________________________________________
<A HREF="http://www.freemail.gr">http://www.freemail.gr</A> - &#228;&#249;&#241;&#229;&#220;&#237; &#245;&#240;&#231;&#241;&#229;&#243;&#223;&#225; &#231;&#235;&#229;&#234;&#244;&#241;&#239;&#237;&#233;&#234;&#239;&#253; &#244;&#225;&#247;&#245;&#228;&#241;&#239;&#236;&#229;&#223;&#239;&#245;.
<A HREF="http://www.freemail.gr">http://www.freemail.gr</A> - free email service for the Greek-speaking.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006776.html">[Mono-devel-list] Re: [Mono-list] Re: [Ximian-mono-list] Details of other testsuites, not included	in daily tests
</A></li>
	<LI>Next message: <A HREF="006801.html">[Mono-devel-list] System.IO.FileStream behaves strangely on	large files.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6769">[ date ]</a>
              <a href="thread.html#6769">[ thread ]</a>
              <a href="subject.html#6769">[ subject ]</a>
              <a href="author.html#6769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
