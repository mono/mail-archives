<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] System.Data indexes redesign
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20System.Data%20indexes%20redesign&In-Reply-To=s0fdf7be.071%40lucius.provo.novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007124.html">
   <LINK REL="Next"  HREF="007129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] System.Data indexes redesign</H1>
    <B>Boris Kirzner</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20System.Data%20indexes%20redesign&In-Reply-To=s0fdf7be.071%40lucius.provo.novell.com"
       TITLE="[Mono-devel-list] System.Data indexes redesign">borisk at mainsoft.com
       </A><BR>
    <I>Thu Jul 22 03:06:12 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007124.html">[Mono-devel-list] Microsoft.VisualBasic Newline Constants
</A></li>
        <LI>Next message: <A HREF="007129.html">[Mono-devel-list] To access Konsole
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7128">[ date ]</a>
              <a href="thread.html#7128">[ thread ]</a>
              <a href="subject.html#7128">[ subject ]</a>
              <a href="author.html#7128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Uma

S Umadevi wrote:

&gt;<i>Hey Boris,
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>Couple of questions/suggestions. (some of them may be due to my lack of
</I>&gt;<i>understanding of your redesign)
</I>&gt;<i>
</I>&gt;<i>1.  How are record numbers generated? This is going to be the key to
</I>&gt;<i>the performance of the every class using the indexes.
</I>&gt;<i>  
</I>&gt;<i>
</I>Record numbers are not generated, but we use the actual record numbers 
from record manager

&gt;<i>2.  how is it going to take care of the versions of the row? Are you
</I>&gt;<i>going to generate a new number for a version? And how long is the new
</I>&gt;<i>record going to be stored.
</I>&gt;<i>  
</I>&gt;<i>
</I>When updating an index, one of row's record is choosed depending on 
record state and key row state filter

&gt;<i>3. The Index is going to be a array ? of recordnumbers.. Why an array?
</I>&gt;<i>Why not use something like a hashtable where we would get a faster
</I>&gt;<i>lookup..
</I>&gt;<i>  
</I>&gt;<i>
</I>I don't think that hash is applicable here, since there is no both 
simple and effective way to generate unique key values for rows.
We can compare two rows to determine which is &quot;bigger&quot; in the meaning of 
some key, but can't create row key value itself.

&gt;<i>Also deletion/additions to positions are going to pose us problems.
</I>&gt;<i>  
</I>&gt;<i>
</I>We keep index sorted, so update will take O(log(n)).

&gt;<i>When does an record number change? Does it change at all??
</I>&gt;<i>  
</I>&gt;<i>
</I>Record number does not change, but it can be replaced with another 
record number when row state changes (EndEdit() etc.).

&gt;<i>4.The node object will have to remain to hold the datarow. Or are you
</I>&gt;<i>thinking of something new?  
</I>&gt;<i>  
</I>&gt;<i>
</I>We'll manage reverse mapping array of records to rows in record manager, 
so having record number we can get its row by O(1)

&gt;<i>5. Another suggestion for implementation is that we leave the tree of
</I>&gt;<i>indexes the way it is currently and  keep the recordnumbers to access it
</I>&gt;<i>in hashtable along with the position of the node.
</I>&gt;<i>Can also have rowversion arrays that we take care of the different
</I>&gt;<i>versions if they exist..
</I>&gt;<i>  
</I>&gt;<i>
</I>Reverse mapping solve this problem

&gt;<i>6. Multiple dataviews will again impose an additional problem of
</I>&gt;<i>rowviews in different versions.. How are we going to take care of it in
</I>&gt;<i>the approach mentioned below..
</I>&gt;<i>  
</I>&gt;<i>
</I>Each time we want to serve data view with unique version requirement, 
new index should be built with corresponding row state filter

&gt;<i>Also I have just started working on ADO.NET 2.0, but for some of the
</I>&gt;<i>batch processing, paging etc, we will reuse lots of this logic. So we
</I>&gt;<i>may want to keep that in mind when we design  the cache.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Regards
</I>&gt;<i>Uma
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>Thanks
Boris

&gt;&gt;&gt;&gt;<i>Boris Kirzner &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">borisk at mainsoft.com</A>&gt; 7/20/2004 3:44:32 PM &gt;&gt;&gt;
</I>&gt;&gt;&gt;&gt;<i>        
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;<i>Hello all
</I>&gt;<i>In the last  week we started thinking about redesign of System.Data 
</I>&gt;<i>indexes towards Uma's  DataView implementation  and the latest 
</I>&gt;<i>System.Data changes.
</I>&gt;<i>Following is the brief description  of redesign  guidelines :
</I>&gt;<i>
</I>&gt;<i>Motivation:
</I>&gt;<i>Currently index implemented as balanced tree of nodes, while each node
</I>&gt;<i>
</I>&gt;<i>points to a specific row. Tree is build based on row compare
</I>&gt;<i>(sequential 
</I>&gt;<i>comparing of row key values in natural order of table columns). Each 
</I>&gt;<i>time we want to access row, a lookup performed in the tree based on key
</I>&gt;<i>
</I>&gt;<i>values.
</I>&gt;<i>One of the major disadvantages of this structure is that if we insert 
</I>&gt;<i>row based on   particular version of its key values, it is impossible
</I>&gt;<i>to 
</I>&gt;<i>search the row based on another version of its key values. To solve the
</I>&gt;<i>
</I>&gt;<i>problem, all the actions on tree always based on current row version.
</I>&gt;<i>Additional weakness of this approach (in the meaning of performance) is
</I>&gt;<i>
</I>&gt;<i>that huge amount of objects are allocated and deallocated while working
</I>&gt;<i>
</I>&gt;<i>with index.
</I>&gt;<i>The last main drawback is that it is impossible to build index to hold
</I>&gt;<i>
</I>&gt;<i>only rows of some particular state. This makes indexes hardly
</I>&gt;<i>applicable 
</I>&gt;<i>for serving data views.
</I>&gt;<i>
</I>&gt;<i>The main goals of the indexes redesign are:
</I>&gt;<i>- Simplify management of indexes and take advantage of the changes in 
</I>&gt;<i>the field of data storage recently made.
</I>&gt;<i>- Avoid massive objects allocation and deallocation to speed up the 
</I>&gt;<i>performance.
</I>&gt;<i>- Prepare indexes towards the full implementation of data views.
</I>&gt;<i>
</I>&gt;<i>The main classes affected by redesign are:
</I>&gt;<i>
</I>&gt;<i>Key:
</I>&gt;<i>Key is a source of the following basic operations: row/record filtering
</I>&gt;<i>
</I>&gt;<i>(returns number of record for the current row or -1 if the row does not
</I>&gt;<i>
</I>&gt;<i>pass state filter) and record comparing (including columns sort
</I>&gt;<i>order).
</I>&gt;<i>Each key defined on set of columns, columns sorting order and row state
</I>&gt;<i>
</I>&gt;<i>filter.
</I>&gt;<i>
</I>&gt;<i>Index:
</I>&gt;<i>Index implemented as array of record numbers and provides the following
</I>&gt;<i>
</I>&gt;<i>services: rebuild index, update (replace one record of row by another),
</I>&gt;<i>
</I>&gt;<i>delete (remove row record) and find.
</I>&gt;<i>Index rebuild is managed by key, as well as record comparing used to 
</I>&gt;<i>form sorted index.
</I>&gt;<i>Index can hold non-unique values, but it manages an up-to-date boolean
</I>&gt;<i>
</I>&gt;<i>indication about this.
</I>&gt;<i>Notice: since the record retrieval for row (managed by key) based on
</I>&gt;<i>row 
</I>&gt;<i>state, any operations of index update should be performed prior to 
</I>&gt;<i>changing row state.
</I>&gt;<i>
</I>&gt;<i>Tables, views and constraints:
</I>&gt;<i>In the past table used to hold the list of its indexes, but most of the
</I>&gt;<i>
</I>&gt;<i>index actions performed in the spirit of &quot;one index per one
</I>&gt;<i>constraint&quot;.
</I>&gt;<i>Since we want to extend usage of indexes to view also, this approach 
</I>&gt;<i>have to be changed.
</I>&gt;<i>By the new design table used not only to hold, but also to manage all
</I>&gt;<i>of 
</I>&gt;<i>its indexes. Both constraints and views use indexes services to perform
</I>&gt;<i>
</I>&gt;<i>some particular tasks.
</I>&gt;<i>For example, assert of unique constraint does not update index anymore,
</I>&gt;<i>
</I>&gt;<i>but just uses index duplicates indication to decide whether the 
</I>&gt;<i>assertion succeeded or not.
</I>&gt;<i>This implementation will enable easy integration of indexes with data
</I>&gt;<i>views.
</I>&gt;<i>
</I>&gt;<i>Record cache:
</I>&gt;<i>New design requires fast reverse record-to-row mapping service. This 
</I>&gt;<i>task carried out by record cache, which holds a reverse record-to-index
</I>&gt;<i>
</I>&gt;<i>mapping.
</I>&gt;<i>
</I>&gt;<i>Row:
</I>&gt;<i>To support record cache reverse mapping, the original, current and 
</I>&gt;<i>proposed records numbers become data row internal properties (thus 
</I>&gt;<i>providing an easy way to keep the mapping updated).
</I>&gt;<i>
</I>&gt;<i>Any comments/ideas ?
</I>&gt;<i>
</I>&gt;<i>Thanks
</I>&gt;<i>Boris
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>
-- 
Boris Kirzner &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">borisk at mainsoft.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007124.html">[Mono-devel-list] Microsoft.VisualBasic Newline Constants
</A></li>
	<LI>Next message: <A HREF="007129.html">[Mono-devel-list] To access Konsole
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7128">[ date ]</a>
              <a href="thread.html#7128">[ thread ]</a>
              <a href="subject.html#7128">[ subject ]</a>
              <a href="author.html#7128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
