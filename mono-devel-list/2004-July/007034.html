<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [LONG] Any Interest in FreeBSD Patches? 	Then see attached.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BLONG%5D%20Any%20Interest%20in%20FreeBSD%20Patches%3F%20%0A%09Then%20see%20attached.&In-Reply-To=1090009712.943.294.camel%40hagbard.apathetic.discordia.org.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007033.html">
   <LINK REL="Next"  HREF="007035.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [LONG] Any Interest in FreeBSD Patches? 	Then see attached.</H1>
    <B>John Merryweather Cooper</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BLONG%5D%20Any%20Interest%20in%20FreeBSD%20Patches%3F%20%0A%09Then%20see%20attached.&In-Reply-To=1090009712.943.294.camel%40hagbard.apathetic.discordia.org.uk"
       TITLE="[Mono-devel-list] [LONG] Any Interest in FreeBSD Patches? 	Then see attached.">john_m_cooper at yahoo.com
       </A><BR>
    <I>Fri Jul 16 17:13:33 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007033.html">[Mono-devel-list] [LONG] Any Interest in FreeBSD Patches? 	Then see attached.
</A></li>
        <LI>Next message: <A HREF="007035.html">[Mono-devel-list] [LONG] Any Interest in FreeBSD Patches? 	Then see attached.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7034">[ date ]</a>
              <a href="thread.html#7034">[ thread ]</a>
              <a href="subject.html#7034">[ subject ]</a>
              <a href="author.html#7034">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2004-07-16 at 13:28, Dick Porter wrote:
&gt;<i> On Fri, 2004-07-16 at 20:47, John Merryweather Cooper wrote:
</I>&gt;<i> &gt; I'm the FreeBSD maintainer for mono and I've finally gotten a
</I>&gt;<i> &gt; reasonable, working mono on FreeBSD (at least on -CURRENT, FreeBSD
</I>&gt;<i> &gt; 5.2).  In the hopes that some of this might get integrated into the next
</I>&gt;<i> &gt; release (and make my job a little easier), I've attached the patches
</I>&gt;<i> &gt; necessary to get Mono 1.0 working.  All of these patches can be had via
</I>&gt;<i> &gt; cvsweb at:
</I>&gt;<i> 
</I>&gt;<i> Thanks for this.
</I>&gt;<i> 
</I>&gt;<i> &gt; # extra-patch-signbit  ONLY NEEDED FOR FREEBSD 4.x
</I>&gt;<i> 
</I>&gt;<i> This one will have to wait for Paolo to get back.
</I>&gt;<i> 
</I>&gt;<i> &gt; # patch-configure
</I>&gt;<i> &gt; #####
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The build environment in the FreeBSD Ports system defines two
</I>&gt;<i> &gt; environment variables:  PTHREAD_CFLAGS and PTHREAD_LIBS.  The contents
</I>&gt;<i> &gt; of these two environments vary depending on the FreeBSD version,
</I>&gt;<i> 
</I>&gt;<i> How does this patch impact FreeBSD builders of the tarball?  I'm
</I>&gt;<i> assuming PTHREAD_CFLAGS and PTHREAD_LIBS won't be set automatically for
</I>&gt;<i> them.  Is it possible to have a set of probably-correct defaults, and
</I>&gt;<i> let the ports build override them?
</I>
I'm unclear about your reference to &quot;FreeBSD builders of the tarball.&quot; 
If you mean package building, then this is handled by the build
environment on Bento, the package building machine.  Bento builds the
binary versions carried on the FTP sites for distribution using the
FreeBSD package system and on CD-ROM/DVD's.

Nevertheless, the educated defaults can be used--PROVIDED that they can
be overridden.  These would be (in pseudo code):

#include &lt;sys/param.h&gt;

/* definitions for -STABLE and really early versions of -CURRENT */
#if (__FREEBSD__version &lt; 500016)
#define PTHREAD_CFLAGS	-D_THREAD_SAFE
#define PTHREAD_LIBS	-pthread

/* definitions for newer versions of -CURRENT before KSE */
#elif (__FREEBSD__version &lt; 502102)
#define PTHREAD_CFLAGS	-D_THREAD_SAFE
#define PTHREAD_LIBS	-lc_r

/* definitions for -CURRENT */
#else
#define PTHREAD_CFLAGS	/* empty */
#define PTHREAD_LIBS	-lpthread
#endif

These values can always be recovered from /usr/ports/Mk/bsd.port.mk. 
Note that only the first (-STABLE) and last (-CURRENT) choices are
maintained in for ports (such as lang/mono) in the ports tree, but there
are still plenty of people running older -CURRENTs.  However, nobody has
been able to get lang/mono to run on the non-KSE -CURRENTs, so it's a
pretty dead choice.

Since there's considerable development energy on threads in -CURRENT,
expect these flags to change &quot;early and often&quot; on -CURRENT.

&gt;<i> 
</I>&gt;<i> &gt; # patch-ligbc_Makefile.in
</I>&gt;<i> &gt; # patch-ligbc_configure
</I>&gt;<i> &gt; # patch-libgc_dbg_mlc.c
</I>&gt;<i> &gt; # patch-libgc_dyn_load.c
</I>&gt;<i> &gt; # patch-libgc_include_private_gcconfig.h
</I>&gt;<i> &gt; # patch-libgc_ltmain.sh
</I>&gt;<i> &gt; # patch-libgc_os_dep.c
</I>&gt;<i> &gt; # patch-libgc_threadlibs.c
</I>&gt;<i> 
</I>&gt;<i> These patches should be fed upstream to the libgc people, see
</I>&gt;<i> <A HREF="http://www.hpl.hp.com/personal/Hans_Boehm/gc">http://www.hpl.hp.com/personal/Hans_Boehm/gc</A> for their site.  The
</I>&gt;<i> mailing list info is at the bottom of that page.  We update to new
</I>&gt;<i> versions of libgc fairly often.
</I>&gt;<i> 
</I>
Happily.  :)

&gt;<i> &gt; # patch-ltmain.sh
</I>&gt;<i> 
</I>&gt;<i> ltmain is a generated file (from libtool.)
</I>&gt;<i> 
</I>&gt;<i> &gt; # patch-mono_Makefile.in
</I>&gt;<i> 
</I>&gt;<i> Again, Makefile.in is a generated file, built from Makefile.am.  There
</I>&gt;<i> is no tests directory specified in Makefile.am.
</I>&gt;<i> 
</I>
As a general rule, we try to avoid using automake.  So, we take the
configure scripts and *.in files as we find them and patch them to
work.  There's just too much chaos in the auto[tools] stuff--although
there is a strong effort to resolve this chaos for FreeBSD, we're not
there yet.

&gt;<i> 
</I>&gt;<i> - Dick
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>
jmc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 187 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20040716/b67ccb04/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20040716/b67ccb04/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007033.html">[Mono-devel-list] [LONG] Any Interest in FreeBSD Patches? 	Then see attached.
</A></li>
	<LI>Next message: <A HREF="007035.html">[Mono-devel-list] [LONG] Any Interest in FreeBSD Patches? 	Then see attached.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7034">[ date ]</a>
              <a href="thread.html#7034">[ thread ]</a>
              <a href="subject.html#7034">[ subject ]</a>
              <a href="author.html#7034">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
