<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Class built by mono throws FileNotFoundException when	run on windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Class%20built%20by%20mono%20throws%20FileNotFoundException%20when%0A%09run%20on%20windows&In-Reply-To=%3CBN3PR0801MB11547AC576F2571B3329B663FA6A0%40BN3PR0801MB1154.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043240.html">
   <LINK REL="Next"  HREF="043234.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Class built by mono throws FileNotFoundException when	run on windows</H1>
    <B>Edward Ned Harvey (mono)</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Class%20built%20by%20mono%20throws%20FileNotFoundException%20when%0A%09run%20on%20windows&In-Reply-To=%3CBN3PR0801MB11547AC576F2571B3329B663FA6A0%40BN3PR0801MB1154.namprd08.prod.outlook.com%3E"
       TITLE="[Mono-dev] Class built by mono throws FileNotFoundException when	run on windows">edward.harvey.mono at clevertrove.com
       </A><BR>
    <I>Tue Sep  1 20:04:57 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="043240.html">[Mono-dev] Running .NET on (OpenSUSE) Linux (13.2) still crashes with thread overload...
</A></li>
        <LI>Next message: <A HREF="043234.html">[Mono-dev] Class built by mono throws FileNotFoundException when run on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43232">[ date ]</a>
              <a href="thread.html#43232">[ thread ]</a>
              <a href="subject.html#43232">[ subject ]</a>
              <a href="author.html#43232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've always used separate project files on windows and linux, in order to include different compiler symbols, in order to make projects build with different dependencies. I've been chastised here for doing it, so I'd like to find a better way. (Miguel and others tore apart a pull request, saying I should never check __MONO__, if I need behavior to be different on windows and non-windows, I need to use a runtime check. The problem is, as described below, the runtime check can't build or run on windows, so I'd like to figure out how it should be done).

Right now, I have a class, which is using Mono.Unix.Native, because of a method that does this: 
    if (Type.GetType(&quot;Mono.Runtime&quot;) != null) {
        Syscall.chmod(...);
    }

When built and run on mono, works great. The problem is building and running on windows. In order to make it build, I copied Mono.Posix.dll into the project and referenced it, with CopyLocal = False. This way, Mono.Posix.dll doesn't get copied to the build directory, which is good because it's already present on mono systems, and not needed on windows systems - the only reason for it to exist in the project is because windows can't build without it.

So it builds. But unfortunately, it won't run on windows. It throws FileNotFoundException &quot;Mono.Posix.dll&quot; before evaluating the if-clause.

The workaround I've found is to create a wrapper class MonoSpecific, so the if-clause and the Mono.Posix call are not in the same file. But this is clearly a hack. Is there a better way?

Hello.cs:
    using System;
    namespace helloProject
    {
        static class Hello
        {
            static void ChangePermsIfNecessary()
            {
                if (Type.GetType(&quot;Mono.Runtime&quot;) != null) {
                    MonoSpecific.DoChmod();
                }
            }
        }
    }

MonoSpecific.cs:
    using System;
    using Mono.Unix.Native;
    namespace helloProject
    {
        static class MonoSpecific
        {
            static void DoChmod()
            {
                Syscall.chmod(...);
            }
        }
    }

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043240.html">[Mono-dev] Running .NET on (OpenSUSE) Linux (13.2) still crashes with thread overload...
</A></li>
	<LI>Next message: <A HREF="043234.html">[Mono-dev] Class built by mono throws FileNotFoundException when run on windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43232">[ date ]</a>
              <a href="thread.html#43232">[ thread ]</a>
              <a href="subject.html#43232">[ subject ]</a>
              <a href="author.html#43232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
