<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono repo breaks on some azure VMs but not others -	CDN issue?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20Mono%20repo%20breaks%20on%20some%20azure%20VMs%20but%20not%20others%20-%0A%09CDN%20issue%3F&In-Reply-To=%3CCY1PR03MB22655BA2F96530EE52AE5A50B6060%40CY1PR03MB2265.namprd03.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044280.html">
   <LINK REL="Next"  HREF="044282.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono repo breaks on some azure VMs but not others -	CDN issue?</H1>
    <B>David Molnar</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20Mono%20repo%20breaks%20on%20some%20azure%20VMs%20but%20not%20others%20-%0A%09CDN%20issue%3F&In-Reply-To=%3CCY1PR03MB22655BA2F96530EE52AE5A50B6060%40CY1PR03MB2265.namprd03.prod.outlook.com%3E"
       TITLE="[Mono-dev] Mono repo breaks on some azure VMs but not others -	CDN issue?">dmolnar at microsoft.com
       </A><BR>
    <I>Mon Apr 17 19:06:19 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044280.html">[Mono-dev] Mono repo breaks on some azure VMs but not others - CDN	issue?
</A></li>
        <LI>Next message (by thread): <A HREF="044282.html">[Mono-dev] Mono repo breaks on some azure VMs but not others - CDN issue? (Mono-devel-list Digest, Vol 144, Issue 12)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44281">[ date ]</a>
              <a href="thread.html#44281">[ thread ]</a>
              <a href="subject.html#44281">[ subject ]</a>
              <a href="author.html#44281">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I apologize for the self-follow-up, but we have found that <A HREF="http://download.mono-project.com/repo/centos/repodata/repomd.xml">http://download.mono-project.com/repo/centos/repodata/repomd.xml</A> is also hitting the CDN cache with a last modified date of 6 April 2017.

This 6 April 2017 is earlier than the date of 12 April 2017 which is listed on <A HREF="http://download.mono-project.com/repo/centos/repodata/">http://download.mono-project.com/repo/centos/repodata/</A> .

We hit this apparently stale repomd.xml on all our VMs. The apparently stale repomd.xml contains a link to the &quot;d839...&quot; URL that is breaking on some VMs and not others.

Is there a way for us to bypass the CDN and access an updated repodata.xml? nslookup reports the IP address as 72.21.81.200, but <A HREF="http://72.21.81.200/repo/centos/repodata/">http://72.21.81.200/repo/centos/repodata/</A> gives a 404 error.

If repodata.xml is in fact out of date, would it be possible to push an update to repodata.xml to the CDN?

Thank you,
David Molnar


Wget -d output:
GET /repo/centos/repodata/repomd.xml HTTP/1.1

User-Agent: Wget/1.17.1 (linux-gnu)

Accept: */*

Accept-Encoding: identity

Host: download.mono-project.com

Connection: Keep-Alive



---request end---

HTTP request sent, awaiting response...

---response begin---

HTTP/1.1 200 OK

Accept-Ranges: bytes

Content-Type: application/xml

Date: Mon, 17 Apr 2017 18:42:49 GMT

Etag: &quot;bb3-54c7d707d5cd8&quot;

Last-Modified: Thu, 06 Apr 2017 11:02:05 GMT

Server: ECAcc (sjc/16E4)

Vary: Accept-Encoding

X-Cache: HIT

Content-Length: 2995



---response end---

200 OK

Registered socket 3 for persistent reuse.

Length: 2995 (2.9K) [application/xml]

Saving to: 'repomd.xml.1'

From: David Molnar
Sent: Monday, April 17, 2017 11:31 AM
To: '<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list at lists.dot.net</A>' &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list at lists.dot.net</A>&gt;
Cc: William Blum &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">William.Blum at microsoft.com</A>&gt;; Marina Polishchuk &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">marinapo at microsoft.com</A>&gt;; Stas Tishkin &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">statis at exchange.microsoft.com</A>&gt;
Subject: Mono repo breaks on some azure VMs but not others - CDN issue?

Hi everyone,

First, thank you for all your hard work on the Mono project. We use F# as our primary development language. Mono helps us rapidly develop for Linux as well as Windows while keeping the benefits of using F#.

Unfortunately we are seeing a problem with the CentOS repository at download.mono-project.com that we believe is related to a CDN issue. Please let me know if this is not the right place to ask about this, I would appreciate any pointers. The issue is breaking Linux deployments of our Azure hosted service by causing yum install failures of Mono on our Linux VMs. We would be grateful for a fix or workaround and we are happy to help with further troubleshooting.

Details:

We deploy Mono on Red Hat Enterprise Linux 7.2 VMs hosted on Microsoft Azure. We see yum fails to install package sqlite from the CentOS repo on download.mono-project.com from some VMs but not other VMs hosted in Azure. The issue is breaking our Linux deployments of our service because we have set yum to install Mono on startup for our Linux VMs.

We see that yum is attempting to download this URL
<A HREF="http://download.mono-project.com/repo/centos/repodata/d839a3db898c8bd7e9a08097357b3568ffc7b128e846b3943d1d61a94ecc2bc6-primary.sqlite.bz2">http://download.mono-project.com/repo/centos/repodata/d839a3db898c8bd7e9a08097357b3568ffc7b128e846b3943d1d61a94ecc2bc6-primary.sqlite.bz2</A>

The URL is specified in <A HREF="http://download.mono-project.com/repo/centos/repodata/repomd.xml">http://download.mono-project.com/repo/centos/repodata/repomd.xml</A> , which we download directly from the web site, has a last modified date of 12 April 2017. The file we have shows revision 1491476506 . Is this the most recent version of repomd.xml?

The URL gives a 404 on some of our Azure-hosted VMs and not others. We can reliably reproduce the 404 error using wget on failing machines 100% of the time.

When we examine <A HREF="http://download.mono-project.com/repo/centos/repodata/">http://download.mono-project.com/repo/centos/repodata/</A>  from a web browser we see that the sqlite package is at this URL, updated 12 April 2017:
<A HREF="http://download.mono-project.com/repo/centos/repodata/4e94d255551bd1fa2ce69f946cf41519aed3b645206aa23e1aa2d06f349763ae-primary.sqlite.bz2">http://download.mono-project.com/repo/centos/repodata/4e94d255551bd1fa2ce69f946cf41519aed3b645206aa23e1aa2d06f349763ae-primary.sqlite.bz2</A>
There is no &quot;d839...&quot; URL in the repodata directory.

On all our machines that successfully download the &quot;d839...&quot; URL, we observe from wget a reference to a CDN cache hit and a &quot;last modified&quot; date of Thursday 6 April 2017. Output from wget appended to this message.

Because of the CDN reference and the CDN hitting only on machines that succeed in downloading the &quot;d839...&quot; URL, we suspect that there is a CDN which is caching an old version of the primary.sqlite.bz2 package. Because the &quot;d839...&quot; URL shows upin repomd.xml, we also suspect that either repomd.xml is being cached with the previous URL or that repomd.xml has not been updated properly with a new URL for a new version of the package.

Does this error report make sense? Would it be possible to please check repomd.xml and the propagation of the repo data to relevant CDNs? If this issue is hitting us, I expect it may also break others using CentOS / RHEL as well.

Again, if this is not the best place to report, I would appreciate any pointers on where to follow up. Thanks again for all your hard work on Mono!

David Molnar


WGET output showing CDN hit:

wget <A HREF="http://download.mono-project.com/repo/centos/repodata/d839a3db898c8bd7e9a08097357b3568ffc7b128e846">http://download.mono-project.com/repo/centos/repodata/d839a3db898c8bd7e9a08097357b3568ffc7b128e846</A>
b3943d1d61a94ecc2bc6-primary.sqlite.bz2
StatusCode        : 200
StatusDescription : OK
Content           : {66, 90, 104, 57...}
RawContent        : HTTP/1.1 200 OK
                    X-Cache: HIT
                    Accept-Ranges: bytes
                    Content-Length: 555139
                    Content-Type: application/x-bzip2
                    Date: Mon, 17 Apr 2017 06:11:49 GMT
                    ETag: &quot;87883-54c7d707d2df2&quot;
                    Last-Modified: Thu, 06...
Headers           : {[X-Cache, HIT], [Accept-Ranges, bytes], [Content-Length, 555139], [Content-Type,
                    application/x-bzip2]...}
RawContentLength  : 555139





-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20170417/02f26a97/attachment-0001.html">http://lists.dot.net/pipermail/mono-devel-list/attachments/20170417/02f26a97/attachment-0001.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044280.html">[Mono-dev] Mono repo breaks on some azure VMs but not others - CDN	issue?
</A></li>
	<LI>Next message (by thread): <A HREF="044282.html">[Mono-dev] Mono repo breaks on some azure VMs but not others - CDN issue? (Mono-devel-list Digest, Vol 144, Issue 12)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44281">[ date ]</a>
              <a href="thread.html#44281">[ thread ]</a>
              <a href="subject.html#44281">[ subject ]</a>
              <a href="author.html#44281">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
