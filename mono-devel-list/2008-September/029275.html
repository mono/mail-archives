<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] close on exec
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20close%20on%20exec&In-Reply-To=827808.48608.qm%40web39508.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029274.html">
   <LINK REL="Next"  HREF="029279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] close on exec</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20close%20on%20exec&In-Reply-To=827808.48608.qm%40web39508.mail.mud.yahoo.com"
       TITLE="[Mono-dev] close on exec">kornelpal at gmail.com
       </A><BR>
    <I>Tue Sep 30 14:18:09 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="029274.html">[Mono-dev] close on exec
</A></li>
        <LI>Next message: <A HREF="029279.html">[Mono-dev] close on exec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29275">[ date ]</a>
              <a href="thread.html#29275">[ thread ]</a>
              <a href="subject.html#29275">[ subject ]</a>
              <a href="author.html#29275">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

MS .NET creates new processes with handle inheritance enabled but on 
Windows only handles maked as inheriable are inherited to the new process.

When using System.Diagnostics.Process.Start() mono closes file 
descriptors in the forked process.

But if you call fork() it is your responsibility to close handles. 
Handles can only be closed safely right after fork() so if you don't 
have access to the source code of the library you can't fix it.

You can however create a subprocess using Process.Start() that will not 
contain the socket handle because Mono properly closes those file 
descriptors. But there still will be some leaked file descriptors from 
the new Mono process so you should create a native wrapper executable to 
minimalize the leakage.

Korn&#233;l

Jacob Gladish wrote:
&gt;<i> I'm using p/invoke in my code and the library I'm calling into may call fork()/exec(), at which point the new process has dup'd copies of some of my open files. Sadly, one was a tcp listener, which means if I restart my application the bind() fails when I create an instance of a TcpListener. I'm curious if anyone can confirm the windows/.net behavior for this situation. As far as I know win32 handle inheritance is off unless specified, which leads me to believe that all fd's should be set close on exec by the mono runtime on unix variants. 
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029274.html">[Mono-dev] close on exec
</A></li>
	<LI>Next message: <A HREF="029279.html">[Mono-dev] close on exec
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29275">[ date ]</a>
              <a href="thread.html#29275">[ thread ]</a>
              <a href="subject.html#29275">[ subject ]</a>
              <a href="author.html#29275">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
