<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Remoting - can't pass an object reference in call	between windows and mono.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Remoting%20-%20can%27t%20pass%20an%20object%20reference%20in%20call%0A%09between%20windows%20and%20mono.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029023.html">
   <LINK REL="Next"  HREF="029025.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Remoting - can't pass an object reference in call	between windows and mono.</H1>
    <B>Steffen Enni</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Remoting%20-%20can%27t%20pass%20an%20object%20reference%20in%20call%0A%09between%20windows%20and%20mono.&In-Reply-To="
       TITLE="[Mono-dev] Remoting - can't pass an object reference in call	between windows and mono.">steffen.enni at gmail.com
       </A><BR>
    <I>Tue Sep  2 05:31:08 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="029023.html">[Mono-dev] WebBrowser and MDI (Windows?) Re: Mono 2.0 Preview 2 is out!!
</A></li>
        <LI>Next message: <A HREF="029025.html">[Mono-dev] Remoting - can't pass an object reference in call between windows and mono.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29024">[ date ]</a>
              <a href="thread.html#29024">[ thread ]</a>
              <a href="subject.html#29024">[ subject ]</a>
              <a href="author.html#29024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

My client implements a callback interface that is supplied as an argument to
a remote call against a server.

The interface is:

    public interface IHello
    {
        //client -----(SayHello)-----&gt; server
        //       &lt;-----(Hello)--------
        //       ---return(Hello)----&gt;
        //       &lt;--return(SayHello)--
        void SayHello(string sender, IHello remoteRef);
        void Hello(string sender);
    }

When I run both server and client on windows then calling SayHello() works.
Similarly when running on mono 2.1.r110365 (the VMWare image with the latest
build from <A HREF="http://www.mono-project.de/mono-image/">http://www.mono-project.de/mono-image/</A>) it also works.  If I just
call the Hello() method then it works in all cases.

I've attached a combined MonoDevelop / Visual Studio 2008 solution which can
reproduce the behavior.

I set up the HttpChannel in the following way on both the server and client:
  BinaryServerFormatterSinkProvider serverProv = new
BinaryServerFormatterSinkProvider();
  serverProv.TypeFilterLevel =
System.Runtime.Serialization.Formatters.TypeFilterLevel.Full;
  BinaryClientFormatterSinkProvider clientProv = new
BinaryClientFormatterSinkProvider();
  System.Collections.IDictionary props = new System.Collections.Hashtable();
  props[&quot;port&quot;] = 7326;
  HttpChannel channel = new HttpChannel(props, clientProv, serverProv);
  ChannelServices.RegisterChannel(channel, false);

I activate the IHello implementations on both the client and server using
code like this:

 class HelloImpl : MarshalByRefObject, IHello { ...}
 HelloImpl hello = new HelloImpl();
 RemotingServices.Marshal(hello, &quot;server&quot;);


I've tested on the following combinations using a HttpChannel. I've tried
using a TcpChannel with similar results and now I'm run out of ideas of what
to try.

==========================================
Server            Client            Result
mono 1.9.1        mono 1.9.1          FAIL
mono 1.9.1        mono 2.1.r110365      OK
mono 1.9.1        windows             FAIL
mono 2.1-r110365  mono 2.1-r110365      OK
mono 2.1.r110365  mono 1.9.1          FAIL
mono 2.1-r110365  windows             FAIL   &lt;=== This is the one I would
like to see working.
windows           mono 1.9.1          FAIL
windows           mono 2.1-r110365    FAIL
windows           windows               OK
===========================================

I get different failure scenarios. (They can all be seen in the notes.txt
file that are included in the attached archive.)

When the client is on windows (a Vista machine, tried both with .NET 3.5 and
2.0 with same result) I get the following error on the client side:

Server stack trace:
  at System.Reflection.MonoField.SetValue (System.Object obj, System.Object
val, BindingFlags invokeAttr, System.Reflection.Binder binder, Syste
m.Globalization.CultureInfo culture) [0x00000]
  at System.Reflection.FieldInfo.SetValue (System.Object obj, System.Object
value) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectReader.SetObjectValue
(System.Object parentObject, System.String fieldName, System.Ref
lection.MemberInfo memberInfo,
System.Runtime.Serialization.SerializationInfo info, System.Object value,
System.Type valueType, System.Int32[] i
ndices) [0x00000]
  at System.Runtime.Serialization.Formatters.Binary.ObjectReader.ReadValue
(System.IO.BinaryReader reader, System.Object parentObject, Int64 par
entObjectId, System.Runtime.Serialization.SerializationInfo info,
System.Type valueType, System.String fieldName, System.Reflection.MemberInfo
m
emberInfo, System.Int32[] indices) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectReader.ReadObjectContent
(System.IO.BinaryReader reader, System.Runtime.Serialization.
Formatters.Binary.TypeMetadata metadata, Int64 objectId, System.Object&amp;
objectInstance, System.Runtime.Serialization.SerializationInfo&amp; info) [0
x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectReader.ReadObjectInstance
(System.IO.BinaryReader reader, Boolean isRuntimeObject, Boo
lean hasTypeInfo, System.Int64&amp; objectId, System.Object&amp; value,
System.Runtime.Serialization.SerializationInfo&amp; info) [0x00000]
  at System.Runtime.Serialization.Formatters.Binary.ObjectReader.ReadObject
(BinaryElement element, System.IO.BinaryReader reader, System.Int64&amp;
 objectId, System.Object&amp; value,
System.Runtime.Serialization.SerializationInfo&amp; info) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectReader.ReadNextObject
(System.IO.BinaryReader reader) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.ObjectReader.ReadObjectGraph
(System.IO.BinaryReader reader, Boolean readHeaders, System.Obj
ect&amp; result, System.Runtime.Remoting.Messaging.Header[]&amp; headers) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.MessageFormatter.ReadMethodCall
(System.IO.BinaryReader reader, Boolean hasHeaders, System.R
untime.Remoting.Messaging.HeaderHandler headerHandler,
System.Runtime.Serialization.Formatters.Binary.BinaryFormatter formatter)
[0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.NoCheckDeserialize
(System.IO.Stream serializationStream, System.Runtime.Rem
oting.Messaging.HeaderHandler handler) [0x00000]
  at
System.Runtime.Serialization.Formatters.Binary.BinaryFormatter.Deserialize
(System.IO.Stream serializationStream, System.Runtime.Remoting.M
essaging.HeaderHandler handler) [0x00000]
  at
System.Runtime.Remoting.Channels.BinaryServerFormatterSink.ProcessMessage
(IServerChannelSinkStack sinkStack, IMessage requestMsg, ITranspo
rtHeaders requestHeaders, System.IO.Stream requestStream, IMessage&amp;
responseMsg, ITransportHeaders&amp; responseHeaders, System.IO.Stream&amp; responseS
tream) [0x00000]

Exception rethrown at [0]:
   at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage
reqMsg, IMessage retMsg)
   at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp;
msgData, Int32 type)
   at Interface.IHello.SayHello(String sender, IHello remoteRef)
   at Client.Program.Main(String[] args) in
D:\Projects\Constellation\mono\PassingObjRef\Client\Program.cs:line 51


I've searched the mailing list archive and could not find any hints on what
to do, so I have no idea of what else I could try to solve this problem.

Is there a kind person that is able to help me in solving this problem?


Best regards

Steffen Enni
Denmark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080902/a831e8c4/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080902/a831e8c4/attachment-0001.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PassingObjRef.tar.gz
Type: application/x-gzip
Size: 6404 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080902/a831e8c4/attachment-0001.gz">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080902/a831e8c4/attachment-0001.gz</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029023.html">[Mono-dev] WebBrowser and MDI (Windows?) Re: Mono 2.0 Preview 2 is out!!
</A></li>
	<LI>Next message: <A HREF="029025.html">[Mono-dev] Remoting - can't pass an object reference in call between windows and mono.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29024">[ date ]</a>
              <a href="thread.html#29024">[ thread ]</a>
              <a href="subject.html#29024">[ subject ]</a>
              <a href="author.html#29024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
