<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] BitVector32 patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20BitVector32%20patch&In-Reply-To=ee9b16d00808260235h3d7b48ch86dee467a46e9f5e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029088.html">
   <LINK REL="Next"  HREF="029105.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] BitVector32 patch</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20BitVector32%20patch&In-Reply-To=ee9b16d00808260235h3d7b48ch86dee467a46e9f5e%40mail.gmail.com"
       TITLE="[Mono-dev] BitVector32 patch">kumpera at gmail.com
       </A><BR>
    <I>Tue Sep  9 08:45:45 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="029088.html">[Mono-dev] Unable to run monodoc (Mono 2.0 RC 1 problem)
</A></li>
        <LI>Next message: <A HREF="029105.html">[Mono-dev] BitVector32 patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29089">[ date ]</a>
              <a href="thread.html#29089">[ thread ]</a>
              <a href="subject.html#29089">[ subject ]</a>
              <a href="author.html#29089">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Scott,

Your patch mixes formating with real changes, which is not a nice thing, but
given it's size, I'll review it anyway.

But, please, mixing many diferent kind of changes in the same patch will
only cause frustration for everyone.
For the contributor for having a long review time or, worse, just take a
straight no because on the length.
For reviewers, reading long patches with all sorts of changes takes a lot
longer and makes it harder.

2008/8/26 Scott Peterson &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lunchtimemama at gmail.com</A>&gt;

&gt;<i> OK, the bug is fixed and the fix is committed. I've done up another
</I>&gt;<i> patch with the other minor fixes (a few logical things and a few style
</I>&gt;<i> things). Patch is attached and inline.
</I>&gt;<i>
</I>&gt;<i> - Scott
</I>&gt;<i>
</I>&gt;<i> Index: class/System/System.Collections.Specialized/BitVector32.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- class/System/System.Collections.Specialized/BitVector32.cs  (revision
</I>&gt;<i> 111591)
</I>&gt;<i> +++ class/System/System.Collections.Specialized/BitVector32.cs  (working
</I>&gt;<i> copy)
</I>&gt;<i>  @@ -84,14 +82,12 @@
</I>&gt;<i>
</I>&gt;<i>                        public override int GetHashCode ()
</I>&gt;<i>                        {
</I>&gt;<i> -                               return (((Int16) mask).GetHashCode () &lt;&lt;
</I>&gt;<i> 16) +
</I>&gt;<i> -                                      ((Int16) offset).GetHashCode ();
</I>&gt;<i> +                               return mask &lt;&lt; offset;
</I>&gt;<i>                        }
</I>&gt;<i>
</I>
This change will reduce the entropy of the hash function.
With your change the following sections will have the same hash code: (mask
1, offset 2), (mask 2, offset 1), (mask 4, offset 0).
I believe the equivalent is something like (mask &lt;&lt; 16) + offset. What do
you think?



&gt;<i>                         public override string ToString ()
</I>&gt;<i>                        {
</I>&gt;<i> -                               return &quot;Section{0x&quot; +
</I>&gt;<i> Convert.ToString(mask, 16) +
</I>&gt;<i> -                                      &quot;, 0x&quot; + Convert.ToString(offset,
</I>&gt;<i> 16) + &quot;}&quot;;
</I>&gt;<i> +                               return ToString (this);
</I>&gt;<i>                        }
</I>&gt;<i>
</I>
Good catch, it's ok to commit.


&gt;<i> @@ -197,10 +195,7 @@
</I>&gt;<i>
</I>&gt;<i>                public override bool Equals (object o)
</I>&gt;<i>                {
</I>&gt;<i> -                       if (!(o is BitVector32))
</I>&gt;<i> -                               return false;
</I>&gt;<i> -
</I>&gt;<i> -                       return bits == ((BitVector32) o).bits;
</I>&gt;<i> +                       return (o is BitVector32) &amp;&amp; bits == ((BitVector32)
</I>&gt;<i> o).bits;
</I>&gt;<i>                }
</I>&gt;<i>
</I>&gt;<i>                public override int GetHashCode ()
</I>&gt;<i>
</I>
This is a nice simplification, it's ok to commit.




&gt;<i>
</I>&gt;<i> @@ -218,7 +213,7 @@
</I>&gt;<i>                         StringBuilder b = new StringBuilder ();
</I>&gt;<i>                        b.Append (&quot;BitVector32{&quot;);
</I>&gt;<i>                        long mask = (long) 0x80000000;
</I>&gt;<i> -                       while (mask &gt; 0) {
</I>&gt;<i> +                       while (mask != 0) {
</I>&gt;<i>                                b.Append (((value.bits &amp; mask) == 0) ? '0' :
</I>&gt;<i> '1');
</I>&gt;<i>                                mask &gt;&gt;= 1;
</I>&gt;<i>                        }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I don't see the point of this change.
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080909/6ef587c3/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080909/6ef587c3/attachment-0001.html</A> 
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029088.html">[Mono-dev] Unable to run monodoc (Mono 2.0 RC 1 problem)
</A></li>
	<LI>Next message: <A HREF="029105.html">[Mono-dev] BitVector32 patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29089">[ date ]</a>
              <a href="thread.html#29089">[ thread ]</a>
              <a href="subject.html#29089">[ subject ]</a>
              <a href="author.html#29089">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
