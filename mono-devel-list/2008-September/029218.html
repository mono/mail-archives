<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev]  Cannot re-call start of asynchronous method... Error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20Cannot%20re-call%20start%20of%20asynchronous%20method...%20Error&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029217.html">
   <LINK REL="Next"  HREF="029219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev]  Cannot re-call start of asynchronous method... Error</H1>
    <B>acoupe</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20Cannot%20re-call%20start%20of%20asynchronous%20method...%20Error&In-Reply-To="
       TITLE="[Mono-dev]  Cannot re-call start of asynchronous method... Error">andrew at eVirtualStudio.com
       </A><BR>
    <I>Tue Sep 23 09:43:37 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="029217.html">[Mono-dev] Patch: Generic code sharing for value types
</A></li>
        <LI>Next message: <A HREF="029219.html">[Mono-dev] Cannot re-call start of asynchronous method... Error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29218">[ date ]</a>
              <a href="thread.html#29218">[ thread ]</a>
              <a href="subject.html#29218">[ subject ]</a>
              <a href="author.html#29218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Help requested...

Here's the full error:

System.InvalidOperationException: Cannot re-call start of asynchronous
method while a previous call is still in progress.
  at System.Net.HttpWebRequest.BeginGetRequestStream (System.AsyncCallback
callback, System.Object state) [0x00000] 
  at System.Net.HttpWebRequest.GetRequestStream () [0x00000] 
  at AWSAuthConnection.putStream (System.String bucket, System.String key,
S3StreamObject obj, 
System.Collections.SortedList headers) [0x00000] 
  at Test.Projects.UploadFile (System.String UploadFileName, System.String
S3Key) [0x00000] 


The code shown below has been running perfectly for months under Net 2.0. 
The code uploads a file to a web service using the REST framework.  The REST
libs are well tested and work fine under Mono -  except when I upload a file
using the code below.

Here's the relevant code:
Try
            Dim conn As New AWSAuthConnection(&quot;&lt;UserId&gt;,&quot;&lt;Password&gt;&quot;, False)

            Dim fsUploadFile As New FileStream(UploadFileName,
FileMode.Open, FileAccess.Read)
            If fsUploadFile.Length &gt; 0 Then ' make sure the size of the file
is &gt; 0
                Dim S3StreamResponse As New S3StreamObject(fsUploadFile,
Nothing)
'THE FOLLOWING LINE OF CODE CRASHES:
                Dim res As Response = conn.putStream(m_BucketName,
HttpUtility.UrlEncode(S3Key), S3StreamResponse, Nothing)
                fsUploadFile.Close()
            Else
                Return False
            End If
        Catch ex As Exception
            Projects.LogException(ex)
            Return False
        End Try
        Return True

Here's the REST &quot;putstream&quot; code that is causing the error.

public Response putStream(string bucket, string key, S3StreamObject obj,
SortedList headers) 
		{

			Boolean isEmptyKey = (key == null) || (key.Length == 0)
				|| (key.Trim().Length == 0);
			string pathSep = isEmptyKey ? &quot;&quot; : &quot;/&quot;;

			if (key == null)
				key = &quot;&quot;;

			WebRequest request = makeStreamRequest(&quot;PUT&quot;, bucket + pathSep
				+ HttpUtility.UrlEncode(key), headers, obj);
            request.Timeout = 3600000; // 1 hr
			ASCIIEncoding encoding = new ASCIIEncoding();

			byte[] buf = new byte[1024];
			BufferedStream bufferedInput = new BufferedStream(obj.Stream);
			int contentLength = 0;
			int bytesRead = 0;
			while ((bytesRead = bufferedInput.Read(buf, 0, 1024)) &gt; 0)
			{
				contentLength += bytesRead;
				request.GetRequestStream().Write( buf, 0, bytesRead );
			}
			request.GetRequestStream().Close();

			return new Response( request );
		}

I don't understand why the error is occuring or what it really means.  Any
help with this problem is greatly appreciated!

-- 
View this message in context: <A HREF="http://www.nabble.com/Cannot-re-call-start-of-asynchronous-method...-Error-tp19627990p19627990.html">http://www.nabble.com/Cannot-re-call-start-of-asynchronous-method...-Error-tp19627990p19627990.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029217.html">[Mono-dev] Patch: Generic code sharing for value types
</A></li>
	<LI>Next message: <A HREF="029219.html">[Mono-dev] Cannot re-call start of asynchronous method... Error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29218">[ date ]</a>
              <a href="thread.html#29218">[ thread ]</a>
              <a href="subject.html#29218">[ subject ]</a>
              <a href="author.html#29218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
