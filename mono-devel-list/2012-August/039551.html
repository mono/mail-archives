<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Malloc issue?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Malloc%20issue%3F&In-Reply-To=%3CCAC9RQtin%2BGNxqzE2zRc%3DDXWuHihXvk%3DMNdVD1bUZi73Ac2yBfw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039549.html">
   <LINK REL="Next"  HREF="039553.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Malloc issue?</H1>
    <B>Greg Young</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Malloc%20issue%3F&In-Reply-To=%3CCAC9RQtin%2BGNxqzE2zRc%3DDXWuHihXvk%3DMNdVD1bUZi73Ac2yBfw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Malloc issue?">gregoryyoung1 at gmail.com
       </A><BR>
    <I>Fri Aug 24 01:03:42 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="039549.html">[Mono-dev] Malloc issue?
</A></li>
        <LI>Next message: <A HREF="039553.html">[Mono-dev] Malloc issue?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39551">[ date ]</a>
              <a href="thread.html#39551">[ thread ]</a>
              <a href="subject.html#39551">[ subject ]</a>
              <a href="author.html#39551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Didn't reply to all.

Code is very simple (allocates 16 mb and frees it).

Also this in an internal assertion is this really the best way? If we
passed wrong parameters etc I would kind of expect an exception.

On Friday, August 24, 2012, Rodrigo Kumpera wrote:

&gt;<i> Either your app is broken or linux's malloc is. Mono does nothing special
</I>&gt;<i> but call malloc/free.
</I>&gt;<i>
</I>&gt;<i> One issue might be if you're allocating more than 2Gb of memory at once.
</I>&gt;<i> This will probably break on mono.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Aug 23, 2012 at 3:35 AM, Greg Young &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>&lt;javascript:_e({}, 'cvml', '<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>');&gt;
</I>&gt;<i> &gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> We are allocating and releasing unmanaged memory with
</I>&gt;&gt;<i> marshal.allochglobal. In mono we are getting the following failure (no
</I>&gt;&gt;<i> failures under clr).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any ideas?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> part from team city logs:
</I>&gt;&gt;<i> [20:55:52][Step 2/2] mono: malloc.c:2451: sYSMALLOc: Assertion `(old_top
</I>&gt;&gt;<i> == (((mbinptr) (((char *) &amp;((av)-&gt;bins[((1) - 1) * 2])) -
</I>&gt;&gt;<i> __builtin_offsetof (struct malloc_chunk, fd)))) &amp;&amp; old_size == 0) ||
</I>&gt;&gt;<i> ((unsigned long) (old_size) &gt;= (unsigned long)((((__builtin_offsetof
</I>&gt;&gt;<i> (struct malloc_chunk, fd_nextsize))+((2 * (sizeof(size_t))) - 1)) &amp; ~((2 *
</I>&gt;&gt;<i> (sizeof(size_t))) - 1))) &amp;&amp; ((old_top)-&gt;size &amp; 0x1) &amp;&amp; ((unsigned
</I>&gt;&gt;<i> long)old_end &amp; pagemask) == 0)' failed.
</I>&gt;&gt;<i> [20:55:52][Step 2/2] Stacktrace:
</I>&gt;&gt;<i> [20:55:52][Step 2/2]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Le doute n'est pas une condition agr&#233;able, mais la certitude est absurde.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A> &lt;javascript:_e({}, 'cvml',
</I>&gt;&gt;<i> '<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>');&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>
-- 
Le doute n'est pas une condition agr&#233;able, mais la certitude est absurde.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120824/e3d9869e/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120824/e3d9869e/attachment-0001.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039549.html">[Mono-dev] Malloc issue?
</A></li>
	<LI>Next message: <A HREF="039553.html">[Mono-dev] Malloc issue?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39551">[ date ]</a>
              <a href="thread.html#39551">[ thread ]</a>
              <a href="subject.html#39551">[ subject ]</a>
              <a href="author.html#39551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
