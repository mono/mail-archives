<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] System.Drawing.Graphics exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20System.Drawing.Graphics%20exceptions&In-Reply-To=24485334.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032584.html">
   <LINK REL="Next"  HREF="032589.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] System.Drawing.Graphics exceptions</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20System.Drawing.Graphics%20exceptions&In-Reply-To=24485334.post%40talk.nabble.com"
       TITLE="[Mono-dev] System.Drawing.Graphics exceptions">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Tue Jul 14 15:22:29 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032584.html">[Mono-dev] System.Drawing.Graphics exceptions
</A></li>
        <LI>Next message: <A HREF="032589.html">[Mono-dev] System.Drawing.Graphics exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32586">[ date ]</a>
              <a href="thread.html#32586">[ thread ]</a>
              <a href="subject.html#32586">[ subject ]</a>
              <a href="author.html#32586">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Jon,

The exception from your previous email* shows the problem:

        &#65279;[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">root at localhost</A> BTOAD]# mono RMScreenShot.exe test.jpg
        &gt;             BTOStudio RM Client ScreenShot Utility
        &lt; ERROR &gt;     Fatal Error: System.NotImplementedException: 0bbp
        depth not
        supported.

So for some reason (is X running? remote access??) the current visual
returns 0bbp which is unusable to create a screenshot. 

Are you able to run GUI (e.g. SWF) apps from your terminal session ?

Sebastien

* please note that this is a mailing-list, even if you're using it like
a forum with nabble. As such it can be difficult to read your email
thread if you don't include the text from previous one.

On Tue, 2009-07-14 at 11:37 -0700, Jon James wrote:
&gt;<i> -bump-
</I>&gt;<i> 
</I>&gt;<i> Any thoughts around this problem?  I've gone through the
</I>&gt;<i> system.drawing.graphics source code. I'm thinking there is an issue with
</I>&gt;<i> this line:
</I>&gt;<i> 
</I>&gt;<i> 240: Bitmap bmp = new Bitmap (blockRegionSize.Width,
</I>&gt;<i> blockRegionSize.Height);  or the visual object that is created in the
</I>&gt;<i> method.  
</I>&gt;<i> 
</I>&gt;<i> or these lines:
</I>&gt;<i> 
</I>&gt;<i> 229: XVisualInfo visual = new XVisualInfo ();
</I>&gt;<i> 
</I>&gt;<i> /* Get XVisualInfo for this visual */
</I>&gt;<i> visual.visualid = GDIPlus.XVisualIDFromVisual(defvisual);
</I>&gt;<i> vPtr = GDIPlus.XGetVisualInfo (GDIPlus.Display, 0x1 /* VisualIDMask */, ref
</I>&gt;<i> visual, ref nitems);
</I>&gt;<i> visual = (XVisualInfo) Marshal.PtrToStructure(vPtr, typeof (XVisualInfo));
</I>&gt;<i> 
</I>&gt;<i> /* Sorry I do not have access to a computer with &gt; deepth. Fell free to add
</I>&gt;<i> more pixel formats */	
</I>&gt;<i> image = GDIPlus.XGetImage (GDIPlus.Display, window, sourceX, sourceY,
</I>&gt;<i> blockRegionSize.Width,
</I>&gt;<i> 	blockRegionSize.Height, AllPlanes, 2 /* ZPixmap*/);
</I>&gt;<i> 				
</I>&gt;<i> Bitmap bmp = new Bitmap (blockRegionSize.Width, blockRegionSize.Height);
</I>&gt;<i> 	int red, blue, green;
</I>&gt;<i> 		for (int y = 0; y &lt; blockRegionSize.Height; y++) {
</I>&gt;<i> 			for (int x = 0; x &lt; blockRegionSize.Width; x++) {
</I>&gt;<i> 				pixel = GDIPlus.XGetPixel (image, x, y);
</I>&gt;<i> 
</I>&gt;<i> 				switch (visual.depth) {
</I>&gt;<i> 					case 16: /* 16bbp pixel transformation */
</I>&gt;<i> 						red = (int) ((pixel &amp; visual.red_mask ) &gt;&gt; 8) &amp; 0xff;
</I>&gt;<i> 						green = (int) (((pixel &amp; visual.green_mask ) &gt;&gt; 3 )) &amp; 0xff;
</I>&gt;<i> 						blue = (int) ((pixel &amp; visual.blue_mask ) &lt;&lt; 3 ) &amp; 0xff;
</I>&gt;<i> 						break;
</I>&gt;<i> 					case 24:
</I>&gt;<i> 					case 32:
</I>&gt;<i> 						red = (int) ((pixel &amp; visual.red_mask ) &gt;&gt; 16) &amp; 0xff;
</I>&gt;<i> 						green = (int) (((pixel &amp; visual.green_mask ) &gt;&gt; 8 )) &amp; 0xff;
</I>&gt;<i> 						blue = (int) ((pixel &amp; visual.blue_mask )) &amp; 0xff;
</I>&gt;<i> 						break;
</I>&gt;<i> 					default:
</I>&gt;<i> 						string text = Locale.GetText (&quot;{0}bbp depth not supported.&quot;,
</I>&gt;<i> visual.depth);
</I>&gt;<i> 						throw new NotImplementedException (text);
</I>&gt;<i> 				}
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032584.html">[Mono-dev] System.Drawing.Graphics exceptions
</A></li>
	<LI>Next message: <A HREF="032589.html">[Mono-dev] System.Drawing.Graphics exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32586">[ date ]</a>
              <a href="thread.html#32586">[ thread ]</a>
              <a href="subject.html#32586">[ subject ]</a>
              <a href="author.html#32586">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
