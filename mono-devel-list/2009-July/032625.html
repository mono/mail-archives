<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] p/invoke marshal struct to pointer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20p/invoke%20marshal%20struct%20to%20pointer&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032626.html">
   <LINK REL="Next"  HREF="032627.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] p/invoke marshal struct to pointer</H1>
    <B>Gladish, Jacob</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20p/invoke%20marshal%20struct%20to%20pointer&In-Reply-To="
       TITLE="[Mono-dev] p/invoke marshal struct to pointer">Jacob.Gladish at sig.com
       </A><BR>
    <I>Fri Jul 17 11:44:50 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032626.html">[Mono-dev] [PATCH] Change Mono.C5 from common lib to net_2_0 lib
</A></li>
        <LI>Next message: <A HREF="032627.html">[Mono-dev] p/invoke marshal struct to pointer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32625">[ date ]</a>
              <a href="thread.html#32625">[ thread ]</a>
              <a href="subject.html#32625">[ subject ]</a>
              <a href="author.html#32625">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm using a third-party .NET wrapper around an unmanaged library that was intended for use on windows. I'm investigating whether this will work on work on Linux and am getting the following exception:

System.Runtime.InteropServices.MarshalDirectiveException: Can not marshal 'parameter #1': Pointers can not reference marshaled structures. Use byref instead.

I can confirm that the .NET wrapper is indeed trying to pass a pointer to a managed struct via p/invoke to an unmanaged function. I was curious if anyone could confirm to me whether that's a bug in the .NET wrapper or in the mono-runtime. This could runs fine on windows using the MS .NET runtime.

The mono runtime seems to have a specific check for this cause and throws the exception. I guess what's confusing is that if it's really not allowed, then why would the Microsoft runtime allow it?

Thanks
-jake


IMPORTANT: The information contained in this email and/or its attachments is confidential. If you are not the intended recipient, please notify the sender immediately by reply and immediately delete this message and all its attachments. Any review, use, reproduction, disclosure or dissemination of this message or any attachment by an unintended recipient is strictly prohibited. Neither this message nor any attachment is intended as or should be construed as an offer, solicitation or recommendation to buy or sell any security or other financial instrument. Neither the sender, his or her employer nor any of their respective affiliates makes any warranties as to the completeness or accuracy of any of the information contained herein or that this message or any of its attachments is free of viruses.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032626.html">[Mono-dev] [PATCH] Change Mono.C5 from common lib to net_2_0 lib
</A></li>
	<LI>Next message: <A HREF="032627.html">[Mono-dev] p/invoke marshal struct to pointer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32625">[ date ]</a>
              <a href="thread.html#32625">[ thread ]</a>
              <a href="subject.html#32625">[ subject ]</a>
              <a href="author.html#32625">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
