<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] VBNC and embedding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20VBNC%20and%20embedding&In-Reply-To=h4v0vg%2424d%241%40ger.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032713.html">
   <LINK REL="Next"  HREF="032680.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] VBNC and embedding</H1>
    <B>bassraf at gmail.com</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20VBNC%20and%20embedding&In-Reply-To=h4v0vg%2424d%241%40ger.gmane.org"
       TITLE="[Mono-dev] VBNC and embedding">bassraf at gmail.com
       </A><BR>
    <I>Fri Jul 31 20:38:00 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032713.html">[Mono-dev] VBNC and embedding
</A></li>
        <LI>Next message: <A HREF="032680.html">[Mono-dev] Mono Regex not working the same as MS .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32714">[ date ]</a>
              <a href="thread.html#32714">[ thread ]</a>
              <a href="subject.html#32714">[ subject ]</a>
              <a href="author.html#32714">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Robert, may I be so blunt to ask which steps you take exactly to successfully get VB code to compile?

I'm doing nothing too complicated, but the code is spread over multiple classes, so what I'll do is paint a picture of what I'm currently doing below:

I'm on Windows XP, VS2005, mono 2.4.2.3 and using the embedding API. 

I load, &quot;libglib-2.0-0.dll&quot; and &quot;mono.dll&quot; and get a whole bunch of procaddresses from mono.dll.

then:

      mono_config_parse(NULL);
      m_RootDomain = mono_jit_init_version(&quot;root&quot;,&quot;v2.0.50727&quot;);
      mono_security_set_mode(MONO_SECURITY_MODE_NONE);
   	m_MainAssembly = mono_assembly_open(&amp;m_MainAssemblyFile);
      m_MainImage = mono_assembly_get_image(m_MainAssembly);

The main assembly contains the &quot;compiler&quot; code which I will be calling from the unmanaged code using the embedding API:

	CompilerParameters m_Params = new CompilerParameters();
	m_Params.GenerateExecutable = false;
	m_Params.GenerateInMemory = true;		
	m_Params.IncludeDebugInformation = false;
	m_Params.TreatWarningsAsErrors = false;
	m_Params.CompilerOptions = &quot;/t:library&quot;;
	m_Params.ReferencedAssemblies.Clear();
	m_Params.ReferencedAssemblies.Add(&quot;mscorlib.dll&quot;);
	
	CodeDomProvider m_Provider = new Microsoft.VisualBasic.VBCodeProvider();
	CompilerResults cResults = m_Provider.CompileAssemblyFromSource(m_Params, Script);

Which I call using: mono_runtime_invoke();

Here's the (VB) script I'm trying to compile:

imports System
imports System.Windows.Forms

Namespace xpScript

Class ScriptObject

 Public Sub Main()
  MessageBox.Show(&quot;hello?&quot;)
 End Sub

End Class

End Namespace


I tried loading a 2.0 assembly using mono_jit_init(), (to make sure the switching to 2.0 works) but same result.
If I force loading of v1.0 or v9.0 for example, the call to the managed compiler simply hangs in the MSVC debugger.
But when I do the above (correctly switch to 2.0) I get the VBNC_CRASH error in the compiler results.

The weird thing is that when I switch the CodeProvider to CSharpProvider it works beautifully and I can compile AND execute 
just about any code, using the VBCodeProvider the &quot;script&quot; won't even compile.

Do you see any obvious ommisions or mistakes in the above?

You wouldn't happen to have a very basic working msvc solution which simply loads an assembly and executes a VBScript do you?


Thanks for you help,
Bas




&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:mono-devel-list-
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of Robert Jordan
</I>&gt;<i> Sent: Friday, July 31, 2009 17:01 P
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-dev] VBNC and embedding
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bassraf at gmail.com</A> wrote:
</I>&gt;<i> &gt; Hi guys,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have successfully integrated mono as scripting engine using
</I>&gt;<i> &gt; CSharpCodeProvider and the embedding api. However, ever since mono
</I>&gt;<i> &gt; 2.0, switching to Microsoft.VisualBasic.VBCodeProvider() as the code
</I>&gt;<i> &gt; provider will  always give me VBNC_CRASH at line 0 as an error result
</I>&gt;<i> &gt; when trying to compile a very basic piece of VB.NET code. All I do is
</I>&gt;<i> &gt; switch the code provider (and the script code obviously).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is there anyone who is using the VBCodeProvider under the 2.x runtime
</I>&gt;<i> &gt; successfully that can tell me what&#8217;s going on?
</I>&gt;<i> 
</I>&gt;<i> It works fine for me when I'm trying to compile some basic
</I>&gt;<i> VB code.
</I>&gt;<i> 
</I>&gt;<i> Are you sure that you're switching the runtime correctly to run
</I>&gt;<i> on the 2.0 profile? VBCodeProvider does not support .NET 1.1.
</I>&gt;<i> 
</I>&gt;<i> Robert
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032713.html">[Mono-dev] VBNC and embedding
</A></li>
	<LI>Next message: <A HREF="032680.html">[Mono-dev] Mono Regex not working the same as MS .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32714">[ date ]</a>
              <a href="thread.html#32714">[ thread ]</a>
              <a href="subject.html#32714">[ subject ]</a>
              <a href="author.html#32714">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
