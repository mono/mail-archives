<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] System.Drawing.Graphics exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20System.Drawing.Graphics%20exceptions&In-Reply-To=24435096.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032583.html">
   <LINK REL="Next"  HREF="032586.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] System.Drawing.Graphics exceptions</H1>
    <B>Jon James</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20System.Drawing.Graphics%20exceptions&In-Reply-To=24435096.post%40talk.nabble.com"
       TITLE="[Mono-dev] System.Drawing.Graphics exceptions">jon_james at dell.com
       </A><BR>
    <I>Tue Jul 14 14:37:28 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032583.html">[Mono-dev]  System.Drawing.Graphics exceptions
</A></li>
        <LI>Next message: <A HREF="032586.html">[Mono-dev] System.Drawing.Graphics exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32584">[ date ]</a>
              <a href="thread.html#32584">[ thread ]</a>
              <a href="subject.html#32584">[ subject ]</a>
              <a href="author.html#32584">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-bump-

Any thoughts around this problem?  I've gone through the
system.drawing.graphics source code. I'm thinking there is an issue with
this line:

240: Bitmap bmp = new Bitmap (blockRegionSize.Width,
blockRegionSize.Height);  or the visual object that is created in the
method.  

or these lines:

229: XVisualInfo visual = new XVisualInfo ();

/* Get XVisualInfo for this visual */
visual.visualid = GDIPlus.XVisualIDFromVisual(defvisual);
vPtr = GDIPlus.XGetVisualInfo (GDIPlus.Display, 0x1 /* VisualIDMask */, ref
visual, ref nitems);
visual = (XVisualInfo) Marshal.PtrToStructure(vPtr, typeof (XVisualInfo));

/* Sorry I do not have access to a computer with &gt; deepth. Fell free to add
more pixel formats */	
image = GDIPlus.XGetImage (GDIPlus.Display, window, sourceX, sourceY,
blockRegionSize.Width,
	blockRegionSize.Height, AllPlanes, 2 /* ZPixmap*/);
				
Bitmap bmp = new Bitmap (blockRegionSize.Width, blockRegionSize.Height);
	int red, blue, green;
		for (int y = 0; y &lt; blockRegionSize.Height; y++) {
			for (int x = 0; x &lt; blockRegionSize.Width; x++) {
				pixel = GDIPlus.XGetPixel (image, x, y);

				switch (visual.depth) {
					case 16: /* 16bbp pixel transformation */
						red = (int) ((pixel &amp; visual.red_mask ) &gt;&gt; 8) &amp; 0xff;
						green = (int) (((pixel &amp; visual.green_mask ) &gt;&gt; 3 )) &amp; 0xff;
						blue = (int) ((pixel &amp; visual.blue_mask ) &lt;&lt; 3 ) &amp; 0xff;
						break;
					case 24:
					case 32:
						red = (int) ((pixel &amp; visual.red_mask ) &gt;&gt; 16) &amp; 0xff;
						green = (int) (((pixel &amp; visual.green_mask ) &gt;&gt; 8 )) &amp; 0xff;
						blue = (int) ((pixel &amp; visual.blue_mask )) &amp; 0xff;
						break;
					default:
						string text = Locale.GetText (&quot;{0}bbp depth not supported.&quot;,
visual.depth);
						throw new NotImplementedException (text);
				}
-- 
View this message in context: <A HREF="http://www.nabble.com/System.Drawing.Graphics-exceptions-tp24435096p24485334.html">http://www.nabble.com/System.Drawing.Graphics-exceptions-tp24435096p24485334.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032583.html">[Mono-dev]  System.Drawing.Graphics exceptions
</A></li>
	<LI>Next message: <A HREF="032586.html">[Mono-dev] System.Drawing.Graphics exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32584">[ date ]</a>
              <a href="thread.html#32584">[ thread ]</a>
              <a href="subject.html#32584">[ subject ]</a>
              <a href="author.html#32584">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
