<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Repeat builds of core assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Repeat%20builds%20of%20core%20assemblies&In-Reply-To=%3CCAGW14aX45GsaC7jfwStX%2BvN3w_VCpTT15gmY%2B7ztOcY8wwK3rA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041471.html">
   <LINK REL="Next"  HREF="041475.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Repeat builds of core assemblies</H1>
    <B>Bryan Crotaz</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Repeat%20builds%20of%20core%20assemblies&In-Reply-To=%3CCAGW14aX45GsaC7jfwStX%2BvN3w_VCpTT15gmY%2B7ztOcY8wwK3rA%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Repeat builds of core assemblies">bryan.crotaz at silvercurve.co.uk
       </A><BR>
    <I>Mon May 12 16:35:31 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041471.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
        <LI>Next message: <A HREF="041475.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41472">[ date ]</a>
              <a href="thread.html#41472">[ thread ]</a>
              <a href="subject.html#41472">[ subject ]</a>
              <a href="author.html#41472">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There's a lot of references in your document to build failures and
potential future build failures.

Can I suggest that pull-requests are only accepted if they don't break the
build?  It's surely the developer's responsibility to make sure that they
haven't created any conflicts, or have correctly documented extra cygwin
packages that are needed, or have correctly edited the Windows installer to
include all the correct files.

This way, newbie contributors can be guaranteed that they can download the
latest default branch from git and can build it.  Then they can get on with
being productive instead of being put off by a whole load of errors they
won't understand.

Bryan


On 12 May 2014 17:30, Bryan Crotaz &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bryan.crotaz at silvercurve.co.uk</A>&gt; wrote:

&gt;<i> Ooooh pretty.....  Will give it a go.
</I>&gt;<i>
</I>&gt;<i> Can the build script be extended to install needed cygwin packages if
</I>&gt;<i> they're missing?  When I first tried to build I had no idea how to find the
</I>&gt;<i> packages, or how to install them - for newbie contributors this would
</I>&gt;<i> remove a lot (in my case 2 days) of head scratching.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 12 May 2014 17:23, Alex J Lennon &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ajlennon at dynamicdevices.co.uk</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 12/05/2014 17:07, Bryan Crotaz wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Will this make building on windows possible?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Bryan,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've written a walkthrough here for building 3.4.0 from the release
</I>&gt;&gt;<i> tarball and 3.4.1 from git on Windows.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://www.codeproject.com/Articles/769292/How-to-build-Mono-on-Windows">http://www.codeproject.com/Articles/769292/How-to-build-Mono-on-Windows</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Best regards, Alex
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Bryan Crotaz
</I>&gt;&gt;<i> Silver Curve
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 12 May 2014, at 16:59, Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Hey guys,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Another update: I am almost done with the work, only one cycle left to
</I>&gt;&gt;<i> resolve and I will be able to land the changes.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  All the changes are on a branch on github.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  MIguel
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, May 2, 2014 at 4:27 PM, Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hello guys,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  Just a follow up to my previous posting on this.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  I have managed to untangle this mess, and now I have a clean build
</I>&gt;&gt;&gt;<i> that does not involve overwriting assemblies.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  In addition to untangling this, I added dependencies on all the
</I>&gt;&gt;&gt;<i> assemblies involved in this circular dependency mess so if you type &quot;make&quot;
</I>&gt;&gt;&gt;<i> in any of System, System.Xml, System.Security, Mono.Security or
</I>&gt;&gt;&gt;<i> System.Configuration, all the dependencies will be properly built.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  During the fixing, I noticed that our System.Xml build must have broke
</I>&gt;&gt;&gt;<i> a few eons ago, because there was code in place to perform a 2-stage
</I>&gt;&gt;&gt;<i> System.Xml build as well (without and with System.Configuration support),
</I>&gt;&gt;&gt;<i> but nobody noticed that this had happened.   While I fixed this, it raises
</I>&gt;&gt;&gt;<i> the obvious point that nobody really cares (or likes) System.Configuration.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  While doing this review, I found a few other places that also have
</I>&gt;&gt;&gt;<i> these ugly loops, so I am going to be fixing those as well.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  Miguel
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  On Tue, Apr 22, 2014 at 3:53 PM, Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt;wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Hey guys,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  I was looking at making the MSBuild system work, and during the
</I>&gt;&gt;&gt;&gt;<i> process I have encountered a few problems that we have in our existing
</I>&gt;&gt;&gt;&gt;<i> build system that are problematic.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  The problem is that System, System.XML and System.Configuration are
</I>&gt;&gt;&gt;&gt;<i> each defined in terms of the other assemblies.   So we gradually bring up
</I>&gt;&gt;&gt;&gt;<i> each one of those assemblies up by first compiling a stub System, which we
</I>&gt;&gt;&gt;&gt;<i> use to build System.XML and System.Configuration.   Then we rebuild System,
</I>&gt;&gt;&gt;&gt;<i> this time referencing System.XML and System.Configuration so we can take a
</I>&gt;&gt;&gt;&gt;<i> dependency on them, and so on.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  To build a complete System.dll for a particular profile (net_2_0,
</I>&gt;&gt;&gt;&gt;<i> net_4_0, etc) takes three steps:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>    - Core Build
</I>&gt;&gt;&gt;&gt;<i>    - Secondary Build:
</I>&gt;&gt;&gt;&gt;<i>       - Core Build +
</I>&gt;&gt;&gt;&gt;<i>       - Defines: XML_DEP + SECURITY_DEP
</I>&gt;&gt;&gt;&gt;<i>       - Refs:
</I>&gt;&gt;&gt;&gt;<i>          - -r:PrebuiltSystem=../lib/Previous/System.dll
</I>&gt;&gt;&gt;&gt;<i>          - -r:System.Xml.dll
</I>&gt;&gt;&gt;&gt;<i>           - -r:MonoSecurity=Mono.Security.dll
</I>&gt;&gt;&gt;&gt;<i>        - Final Build:
</I>&gt;&gt;&gt;&gt;<i>       - Secondary Build +
</I>&gt;&gt;&gt;&gt;<i>       - defines: -d:CONFIGURATION_DEP
</I>&gt;&gt;&gt;&gt;<i>       - Refs:
</I>&gt;&gt;&gt;&gt;<i>          - System.Configuration.dll
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The above is what is required to bring up System.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  Our implementation has one major problem: it overwrites the
</I>&gt;&gt;&gt;&gt;<i> intermediate files.  So the core build output is overwritten by the
</I>&gt;&gt;&gt;&gt;<i> secondary build, and the secondary build is overwritten by the final build.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  It seems that historically, instead of introducing temporary
</I>&gt;&gt;&gt;&gt;<i> directories for each stage, instead we hacked our way out of it.   We
</I>&gt;&gt;&gt;&gt;<i> introduced a LIBRARY_USE_INTERMEDIATE_FILE whose sole purpose was to work
</I>&gt;&gt;&gt;&gt;<i> around the case where Windows was actively telling us we were doing
</I>&gt;&gt;&gt;&gt;<i> something wrong (we were overwriting a file that we were actively
</I>&gt;&gt;&gt;&gt;<i> referencing!)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  The above is also likely going to prevent reliable parallel builds,
</I>&gt;&gt;&gt;&gt;<i> or probably means that we introduced some gross hack to make the above work
</I>&gt;&gt;&gt;&gt;<i> in parallel.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  I am going to try to fix this, but the Makefile goop is pretty dense,
</I>&gt;&gt;&gt;&gt;<i> and I might fail.   I just figured I should share my findings in case
</I>&gt;&gt;&gt;&gt;<i> civilization comes to an end and a future archeologist tries to figure out
</I>&gt;&gt;&gt;&gt;<i> why this was not working.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  These are the defines that we use to bring up System for each profile:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  basic Profile:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> basic: -d:NET_1_1 -d:NET_2_0 -d:BOOTSTRAP_BASIC -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> basic: -d:NET_1_1 -d:NET_2_0 -d:BOOTSTRAP_BASIC -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;&gt;<i> -d:XML_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  Build Profile:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> build: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> build: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:CONFIGURATION_2_0  -d:XML_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  Net 2.0 profile:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_2_0: -d:NET_1_1 -d:NET_2_0  -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_2_0: -d:NET_1_1 -d:NET_2_0  -d:CONFIGURATION_2_0  -d:XML_DEP
</I>&gt;&gt;&gt;&gt;<i> -d:SECURITY_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_2_0: -d:NET_1_1 -d:NET_2_0  -d:CONFIGURATION_2_0  -d:XML_DEP
</I>&gt;&gt;&gt;&gt;<i> -d:SECURITY_DEP -d:CONFIGURATION_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  Net 4.0 profile:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_4_0: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_4_0: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:CONFIGURATION_2_0 -d:XML_DEP  -d:SECURITY_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_4_0: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:CONFIGURATION_2_0 -d:XML_DEP  -d:SECURITY_DEP  -d:CONFIGURATION_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  Net 4.5 profile:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_4_5: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:NET_4_5 -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_4_5: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:NET_4_5 -d:CONFIGURATION_2_0 -d:XML_DEP  -d:SECURITY_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> net_4_5: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5 -d:NET_4_0
</I>&gt;&gt;&gt;&gt;<i> -d:NET_4_5 -d:CONFIGURATION_2_0  -d:XML_DEP -d:SECURITY_DEP
</I>&gt;&gt;&gt;&gt;<i> -d:CONFIGURATION_DEP
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>   Miguel
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>   _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">listMono-devel-list at lists.ximian.comhttp</A>://lists.ximian.com/mailman/listinfo/mono-devel-list
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Bryan Crotaz
</I>&gt;<i> Managing Director
</I>&gt;<i> Silver Curve
</I>&gt;<i>
</I>


-- 
Bryan Crotaz
Managing Director
Silver Curve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/2c779e05/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/2c779e05/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041471.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
	<LI>Next message: <A HREF="041475.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41472">[ date ]</a>
              <a href="thread.html#41472">[ thread ]</a>
              <a href="subject.html#41472">[ subject ]</a>
              <a href="author.html#41472">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
