<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Repeat builds of core assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Repeat%20builds%20of%20core%20assemblies&In-Reply-To=%3C5370F854.4090608%40dynamicdevices.co.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041477.html">
   <LINK REL="Next"  HREF="041474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Repeat builds of core assemblies</H1>
    <B>Alex J Lennon</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Repeat%20builds%20of%20core%20assemblies&In-Reply-To=%3C5370F854.4090608%40dynamicdevices.co.uk%3E"
       TITLE="[Mono-dev] Repeat builds of core assemblies">ajlennon at dynamicdevices.co.uk
       </A><BR>
    <I>Mon May 12 16:35:32 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041477.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
        <LI>Next message: <A HREF="041474.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41473">[ date ]</a>
              <a href="thread.html#41473">[ thread ]</a>
              <a href="subject.html#41473">[ subject ]</a>
              <a href="author.html#41473">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 12/05/2014 17:30, Bryan Crotaz wrote:
&gt;<i> Ooooh pretty.....  Will give it a go.
</I>&gt;<i>
</I>&gt;<i> Can the build script be extended to install needed cygwin packages if
</I>&gt;<i> they're missing?  When I first tried to build I had no idea how to
</I>&gt;<i> find the packages, or how to install them - for newbie contributors
</I>&gt;<i> this would remove a lot (in my case 2 days) of head scratching.
</I>&gt;<i>
</I>
That's an interesting idea Bryan. I'd love it if the Win32 build process
was a little more streamlined but I wouldn't know where to begin myself
within the Mono build scripting at present.

In the short-term it might be possible to do something with a script
using one of the command-line package managers for Cygwin (e.g. apt-cyg)

I could have a look at that when I have time maybe if the Cygwin UI
setup app is proving a hurdle.

&gt;<i>
</I>&gt;<i> On 12 May 2014 17:23, Alex J Lennon &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ajlennon at dynamicdevices.co.uk</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ajlennon at dynamicdevices.co.uk</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     On 12/05/2014 17:07, Bryan Crotaz wrote:
</I>&gt;&gt;<i>     Will this make building on windows possible?
</I>&gt;&gt;<i>
</I>&gt;<i>     Bryan,
</I>&gt;<i>
</I>&gt;<i>     I've written a walkthrough here for building 3.4.0 from the
</I>&gt;<i>     release tarball and 3.4.1 from git on Windows.
</I>&gt;<i>
</I>&gt;<i>     <A HREF="http://www.codeproject.com/Articles/769292/How-to-build-Mono-on-Windows">http://www.codeproject.com/Articles/769292/How-to-build-Mono-on-Windows</A>
</I>&gt;<i>
</I>&gt;<i>     Best regards, Alex
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>     Bryan Crotaz
</I>&gt;&gt;<i>     Silver Curve
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     On 12 May 2014, at 16:59, Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>
</I>&gt;&gt;<i>     &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     Hey guys,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     Another update: I am almost done with the work, only one cycle
</I>&gt;&gt;&gt;<i>     left to resolve and I will be able to land the changes.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     All the changes are on a branch on github.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     MIguel
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     On Fri, May 2, 2014 at 4:27 PM, Miguel de Icaza
</I>&gt;&gt;&gt;<i>     &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         Hello guys,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         Just a follow up to my previous posting on this.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         I have managed to untangle this mess, and now I have a clean
</I>&gt;&gt;&gt;<i>         build that does not involve overwriting assemblies.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         In addition to untangling this, I added dependencies on all
</I>&gt;&gt;&gt;<i>         the assemblies involved in this circular dependency mess so
</I>&gt;&gt;&gt;<i>         if you type &quot;make&quot; in any of System, System.Xml,
</I>&gt;&gt;&gt;<i>         System.Security, Mono.Security or System.Configuration, all
</I>&gt;&gt;&gt;<i>         the dependencies will be properly built.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         During the fixing, I noticed that our System.Xml build must
</I>&gt;&gt;&gt;<i>         have broke a few eons ago, because there was code in place
</I>&gt;&gt;&gt;<i>         to perform a 2-stage System.Xml build as well (without and
</I>&gt;&gt;&gt;<i>         with System.Configuration support), but nobody noticed that
</I>&gt;&gt;&gt;<i>         this had happened.   While I fixed this, it raises the
</I>&gt;&gt;&gt;<i>         obvious point that nobody really cares (or likes)
</I>&gt;&gt;&gt;<i>         System.Configuration.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         While doing this review, I found a few other places that
</I>&gt;&gt;&gt;<i>         also have these ugly loops, so I am going to be fixing those
</I>&gt;&gt;&gt;<i>         as well.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         Miguel
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         On Tue, Apr 22, 2014 at 3:53 PM, Miguel de Icaza
</I>&gt;&gt;&gt;<i>         &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             Hey guys,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             I was looking at making the MSBuild system work, and
</I>&gt;&gt;&gt;<i>             during the process I have encountered a few problems
</I>&gt;&gt;&gt;<i>             that we have in our existing build system that are
</I>&gt;&gt;&gt;<i>             problematic.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             The problem is that System, System.XML and
</I>&gt;&gt;&gt;<i>             System.Configuration are each defined in terms of the
</I>&gt;&gt;&gt;<i>             other assemblies.   So we gradually bring up each one of
</I>&gt;&gt;&gt;<i>             those assemblies up by first compiling a stub System,
</I>&gt;&gt;&gt;<i>             which we use to build System.XML and
</I>&gt;&gt;&gt;<i>             System.Configuration.   Then we rebuild System, this
</I>&gt;&gt;&gt;<i>             time referencing System.XML and System.Configuration so
</I>&gt;&gt;&gt;<i>             we can take a dependency on them, and so on.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             To build a complete System.dll for a particular profile
</I>&gt;&gt;&gt;<i>             (net_2_0, net_4_0, etc) takes three steps: 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>               * Core Build
</I>&gt;&gt;&gt;<i>               * Secondary Build:
</I>&gt;&gt;&gt;<i>                   o Core Build + 
</I>&gt;&gt;&gt;<i>                   o Defines: XML_DEP + SECURITY_DEP
</I>&gt;&gt;&gt;<i>                   o Refs: 
</I>&gt;&gt;&gt;<i>                       + -r:PrebuiltSystem=../lib/Previous/System.dll 
</I>&gt;&gt;&gt;<i>                       + -r:System.Xml.dll
</I>&gt;&gt;&gt;<i>                       + -r:MonoSecurity=Mono.Security.dll
</I>&gt;&gt;&gt;<i>               * Final Build:
</I>&gt;&gt;&gt;<i>                   o Secondary Build + 
</I>&gt;&gt;&gt;<i>                   o defines: -d:CONFIGURATION_DEP
</I>&gt;&gt;&gt;<i>                   o Refs:
</I>&gt;&gt;&gt;<i>                       + System.Configuration.dll
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             The above is what is required to bring up System.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             Our implementation has one major problem: it overwrites
</I>&gt;&gt;&gt;<i>             the intermediate files.  So the core build output is
</I>&gt;&gt;&gt;<i>             overwritten by the secondary build, and the secondary
</I>&gt;&gt;&gt;<i>             build is overwritten by the final build.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             It seems that historically, instead of introducing
</I>&gt;&gt;&gt;<i>             temporary directories for each stage, instead we hacked
</I>&gt;&gt;&gt;<i>             our way out of it.   We introduced a
</I>&gt;&gt;&gt;<i>             LIBRARY_USE_INTERMEDIATE_FILE whose sole purpose was to
</I>&gt;&gt;&gt;<i>             work around the case where Windows was actively telling
</I>&gt;&gt;&gt;<i>             us we were doing something wrong (we were overwriting a
</I>&gt;&gt;&gt;<i>             file that we were actively referencing!)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             The above is also likely going to prevent reliable
</I>&gt;&gt;&gt;<i>             parallel builds, or probably means that we introduced
</I>&gt;&gt;&gt;<i>             some gross hack to make the above work in parallel.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             I am going to try to fix this, but the Makefile goop is
</I>&gt;&gt;&gt;<i>             pretty dense, and I might fail.   I just figured I
</I>&gt;&gt;&gt;<i>             should share my findings in case civilization comes to
</I>&gt;&gt;&gt;<i>             an end and a future archeologist tries to figure out why
</I>&gt;&gt;&gt;<i>             this was not working.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             These are the defines that we use to bring up System for
</I>&gt;&gt;&gt;<i>             each profile:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             basic Profile:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             basic: -d:NET_1_1 -d:NET_2_0 -d:BOOTSTRAP_BASIC
</I>&gt;&gt;&gt;<i>             -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             basic: -d:NET_1_1 -d:NET_2_0 -d:BOOTSTRAP_BASIC
</I>&gt;&gt;&gt;<i>             -d:CONFIGURATION_2_0 -d:XML_DEP
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             Build Profile:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             build: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             build: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:CONFIGURATION_2_0  -d:XML_DEP
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             Net 2.0 profile:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_2_0: -d:NET_1_1 -d:NET_2_0  -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_2_0: -d:NET_1_1 -d:NET_2_0  -d:CONFIGURATION_2_0 
</I>&gt;&gt;&gt;<i>             -d:XML_DEP -d:SECURITY_DEP 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_2_0: -d:NET_1_1 -d:NET_2_0  -d:CONFIGURATION_2_0 
</I>&gt;&gt;&gt;<i>             -d:XML_DEP -d:SECURITY_DEP -d:CONFIGURATION_DEP 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             Net 4.0 profile:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_4_0: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:CONFIGURATION_2_0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_4_0: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:CONFIGURATION_2_0 -d:XML_DEP  -d:SECURITY_DEP
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_4_0: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:CONFIGURATION_2_0 -d:XML_DEP 
</I>&gt;&gt;&gt;<i>             -d:SECURITY_DEP  -d:CONFIGURATION_DEP
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             Net 4.5 profile:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_4_5: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:NET_4_5 -d:CONFIGURATION_2_0 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_4_5: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:NET_4_5 -d:CONFIGURATION_2_0 -d:XML_DEP 
</I>&gt;&gt;&gt;<i>             -d:SECURITY_DEP 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             net_4_5: -d:NET_1_1 -d:NET_2_0 -d:NET_3_0 -d:NET_3_5
</I>&gt;&gt;&gt;<i>             -d:NET_4_0 -d:NET_4_5 -d:CONFIGURATION_2_0  -d:XML_DEP
</I>&gt;&gt;&gt;<i>             -d:SECURITY_DEP -d:CONFIGURATION_DEP 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>             Miguel
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;&gt;<i>     Mono-devel-list mailing list
</I>&gt;&gt;&gt;<i>     <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;<i>     &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;&gt;&gt;<i>     <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;<i>     Mono-devel-list mailing list
</I>&gt;&gt;<i>     <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;&gt;<i>     <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> Bryan Crotaz
</I>&gt;<i> Managing Director
</I>&gt;<i> Silver Curve
</I>
-- 

Dynamic Devices Ltd &lt;<A HREF="http://www.dynamicdevices.co.uk/">http://www.dynamicdevices.co.uk/</A>&gt;

Alex J Lennon / Director
1 Queensway, Liverpool L22 4RA

mobile: +44 (0)7956 668178

Linkedin &lt;<A HREF="http://www.linkedin.com/in/alexjlennon">http://www.linkedin.com/in/alexjlennon</A>&gt; Skype
&lt;skype:alexjlennon?add&gt;

This e-mail message may contain confidential or legally privileged
information and is intended only for the use of the intended
recipient(s). Any unauthorized disclosure, dissemination, distribution,
copying or the taking of any action in reliance on the information
herein is prohibited. E-mails are not secure and cannot be guaranteed to
be error free as they can be intercepted, amended, or contain viruses.
Anyone who communicates with us by e-mail is deemed to have accepted
these risks. Company Name is not responsible for errors or omissions in
this message and denies any responsibility for any damage arising from
the use of e-mail. Any opinion and other statement contained in this
message and any attachment are solely those of the author and do not
necessarily represent those of the company.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ddlogo-4.png
Type: image/png
Size: 3997 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0003.png">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0003.png</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: linkedin.png
Type: image/png
Size: 631 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0004.png">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0004.png</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: skype.png
Type: image/png
Size: 800 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0005.png">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140512/695fb6a6/attachment-0005.png</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041477.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
	<LI>Next message: <A HREF="041474.html">[Mono-dev] Repeat builds of core assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41473">[ date ]</a>
              <a href="thread.html#41473">[ thread ]</a>
              <a href="subject.html#41473">[ subject ]</a>
              <a href="author.html#41473">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
