<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] NET_2_0 attributes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20NET_2_0%20attributes&In-Reply-To=4151D522.6040902%40seznam.cz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008036.html">
   <LINK REL="Next"  HREF="007909.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] NET_2_0 attributes</H1>
    <B>Ben Maurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20NET_2_0%20attributes&In-Reply-To=4151D522.6040902%40seznam.cz"
       TITLE="[Mono-devel-list] NET_2_0 attributes">bmaurer at ximian.com
       </A><BR>
    <I>Wed Sep 22 17:00:13 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008036.html">[Mono-devel-list] NET_2_0 attributes
</A></li>
        <LI>Next message: <A HREF="007909.html">[Mono-devel-list] NET_2_0 attributes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8037">[ date ]</a>
              <a href="thread.html#8037">[ thread ]</a>
              <a href="subject.html#8037">[ subject ]</a>
              <a href="author.html#8037">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2004-09-22 at 15:40, Marek Safar wrote:
&gt;<i> &gt;&gt;&gt;I think we need to implement this stuff in the C part of the runtime.
</I>&gt;<i> &gt;&gt;&gt;The icalls need to be changed, too, to match the MS CLR implementation
</I>&gt;<i> &gt;&gt;&gt;wrt attribute creation. Last time I checked:
</I>&gt;<i> &gt;&gt;&gt;*) IsDefined() didn't cause the attributes to be created
</I>&gt;<i> &gt;&gt;OK, but that is different story. This is all valid for normal attributes 
</I>&gt;<i> &gt;&gt;not for pseudo.
</I>&gt;<i> &gt;It needs to be done for all kinds and we want to have the logic in one
</I>&gt;<i> &gt;place.
</I>&gt;<i> It will be slower a out of context. I don't understand why do you want 
</I>&gt;<i> to test whether type is Serializable somewhere in deep runtime, when we 
</I>&gt;<i> have had this code in corlib already.
</I>&gt;<i> I think it will be a lot of useless casts instead of simplicity of 
</I>&gt;<i> virtual methods in my patch.
</I>
If we do it in managed code, we will have to do the following:

1) get normal attrs from native code
2) search for the pseudo atts
3) create them
4) create a new array with all of them.

That is a total of 2 arrays created by the GC. Anyways, you are going to
have to do icalls for many of the pseudo attrs. So you are going to
waste some managed-&gt;unmanaged transitions.

IsDefined should have *NO* managed allocations (idealy, no unmanaged
ones either). It is going to be hard to do that unless we do most of the
logic in native code.

&gt;<i> &gt;It's not. Parameterless attributes may have state that can be changed as
</I>&gt;<i> &gt;any other and the constructor can have any arbitrary side effect.
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt;
</I>&gt;<i> OK, I thought attributes with parameterless constructor and no property 
</I>&gt;<i> e.g. SerializableAttribute, ComImportAttribute, InAttribute,....
</I>
Nobody should be using GetAttributes for those. If you want to check if
a class has ComImportAttribute, you should use IsDefined. It will do
fewer memory allocations, and should be faster.

Anyways, think about it like this: if you want to have all
parameterless, ctorless attributes be saved, you are going to need a
lock and a hashtable lookup to save the cost of allocation. Even today,
it is probably faster just to do the gcmalloc. Once we have generational
collection, it should be much faster to do the gc allocation.

-- Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008036.html">[Mono-devel-list] NET_2_0 attributes
</A></li>
	<LI>Next message: <A HREF="007909.html">[Mono-devel-list] NET_2_0 attributes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8037">[ date ]</a>
              <a href="thread.html#8037">[ thread ]</a>
              <a href="subject.html#8037">[ subject ]</a>
              <a href="author.html#8037">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
