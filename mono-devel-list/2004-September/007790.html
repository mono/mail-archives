<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: [Mono-patches]	mcs/class/corlib/System.Collections.Generic Collection.cs,NONE,1.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BMono-patches%5D%0A%09mcs/class/corlib/System.Collections.Generic%20Collection.cs%2CNONE%2C1.1&In-Reply-To=1094095219.2749.38.camel%40Ben">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007785.html">
   <LINK REL="Next"  HREF="007787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: [Mono-patches]	mcs/class/corlib/System.Collections.Generic Collection.cs,NONE,1.1</H1>
    <B>Carlos Alberto Cortez</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BMono-patches%5D%0A%09mcs/class/corlib/System.Collections.Generic%20Collection.cs%2CNONE%2C1.1&In-Reply-To=1094095219.2749.38.camel%40Ben"
       TITLE="[Mono-devel-list] Re: [Mono-patches]	mcs/class/corlib/System.Collections.Generic Collection.cs,NONE,1.1">carlos at unixmexico.org
       </A><BR>
    <I>Thu Sep  2 15:28:39 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007785.html">[Mono-devel-list] Re: [Mono-patches] mcs/class/corlib/System.Collections.Generic Collection.cs,NONE,1.1
</A></li>
        <LI>Next message: <A HREF="007787.html">[Mono-devel-list] DbDataAdapter fix for out of memory errors when filling datasets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7790">[ date ]</a>
              <a href="thread.html#7790">[ thread ]</a>
              <a href="subject.html#7790">[ subject ]</a>
              <a href="author.html#7790">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, 
notes below:

El mi&#233;, 01-09-2004 a las 22:20, Ben Maurer escribi&#243;:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Here are a few comments:
</I>&gt;<i> 
</I>&gt;<i> On Wed, 2004-09-01 at 19:41, Carlos Alberto Cortes  wrote:
</I>&gt;<i> &gt; 		private const int defaultLength = 16;
</I>&gt;<i> Can you double check that this is the case? I think in List &lt;T&gt; it is now 4.
</I>
In the longhorn documentation it is not stated (at least for
Collection); however, I will try to 
test this.

&gt;<i> 
</I>&gt;<i> Style: s/private //
</I>&gt;<i> &gt; 		private T [] contents;
</I>&gt;<i> &gt; 		private readonly Type innertype;
</I>&gt;<i> This is not needed at all. You can just say typeof (T)
</I>&gt;<i> &gt; 		private int capacity;
</I>&gt;<i> capacity == contents.Length. This is not needed.
</I>&gt;<i> &gt; 		private int count;
</I>&gt;<i> &gt; 		private int modcount;
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 		public Collection (List &lt;T&gt; list)
</I>&gt;<i> &gt; 		{
</I>&gt;<i> &gt; 			if (list == null)
</I>&gt;<i> &gt; 				throw new ArgumentNullException (&quot;list&quot;);
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 			contents = new T [list.Count * 2];
</I>&gt;<i> Check that the capacity is set to list.Count * 2. It is probably not.
</I>&gt;<i> &gt; 			list.CopyTo (contents, 0);
</I>&gt;<i> &gt; 			count = list.Count;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 			capacity = contents.Length;
</I>&gt;<i> &gt; 			innertype = typeof (T);
</I>&gt;<i> &gt; 				
</I>&gt;<i> &gt; 		}
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> Just make this `return IndexOf (item) &gt; 0'.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 		IEnumerator IEnumerable.GetEnumerator ()
</I>&gt;<i> &gt; 		{
</I>&gt;<i> &gt; 			return new Enumerator (this);
</I>&gt;<i> &gt; 		}
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 		public int IndexOf (T item)
</I>&gt;<i> &gt; 		{
</I>&gt;<i> &gt; 			for (int i = 0; i &lt; count; i++)
</I>&gt;<i> &gt; 				if (contents [i].Equals (item))
</I>&gt;<i> &gt; 					return i;
</I>&gt;<i> What if contents [i] == null?
</I>&gt;<i> 
</I>&gt;<i> I think what may happen is this:
</I>&gt;<i> 
</I>&gt;<i> if (item == null)
</I>&gt;<i> 	for (int i = 0; i &lt; count; i ++)
</I>&gt;<i> 		if (contents [i] == null)
</I>&gt;<i> 			return i;
</I>&gt;<i> else
</I>&gt;<i> 	for (int i = 0; i &lt; count; i ++)
</I>&gt;<i> 		if (item.contents [i])
</I>&gt;<i> 			return i;
</I>&gt;<i> 
</I>&gt;<i> &gt; 			return -1;
</I>&gt;<i> &gt; 		}
</I>
InsertItem, RemoveItem and SetItem are methods used inside other methods
(InsertItem is used in Insert and Add, SetItem in the indexer, and
RemoveItem in Remove). 

As long as I could test, the exceptions are checked in the calling
methods (the class is designed to be extended, and thus the coder must
only add statements in the overriden methods and call the base method).

&gt;<i> &gt; 		protected virtual void InsertItem (int index, T item)
</I>&gt;<i> &gt; 		{
</I>&gt;<i> Does this method check its arguments?
</I>&gt;<i> &gt; 			modcount++;
</I>&gt;<i> &gt; 			//
</I>&gt;<i> &gt; 			// Shift them by 1
</I>&gt;<i> &gt; 			//
</I>&gt;<i> &gt; 			int rest = count - index;
</I>&gt;<i> &gt; 			if (rest &gt; 0)
</I>&gt;<i> &gt; 				Array.Copy (contents, index, contents, index + 1, rest);
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 			contents [index] = item;
</I>&gt;<i> &gt; 			count++;
</I>&gt;<i> &gt; 		}
</I>&gt;<i> 
</I>&gt;<i> &gt; 		protected virtual void RemoveItem (int index)
</I>&gt;<i> &gt; 		{
</I>&gt;<i> Does this method check its arguments?
</I>
Both Add and Insert check the array capacity.

&gt;<i> Does it resize the array?
</I>&gt;<i> &gt; 			modcount++;
</I>&gt;<i> &gt; 			
</I>&gt;<i> &gt; 			int rest = count - index - 1;
</I>&gt;<i> &gt; 			if (rest &gt; 0)
</I>&gt;<i> &gt; 				Array.Copy (contents, index + 1, contents, index, rest);
</I>&gt;<i> &gt; 			//
</I>&gt;<i> &gt; 			// Clear the last element
</I>&gt;<i> &gt; 			//
</I>&gt;<i> &gt; 			Array.Clear (contents, --count, 1);
</I>&gt;<i> &gt; 		}
</I>&gt;<i> Don't use Array.Clear for one item. You should be able to set it to the
</I>&gt;<i> default value (I forget the syntax  for that)
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 		protected virtual void SetItem (int index, T item)
</I>&gt;<i> &gt; 		{
</I>&gt;<i> Check arguments?
</I>&gt;<i> &gt; 			modcount++;
</I>&gt;<i> &gt; 			contents [index] = item;
</I>&gt;<i> &gt; 		}
</I>&gt;<i> 
</I>&gt;<i> &gt; 		private void CheckType (object value)
</I>&gt;<i> &gt; 		{
</I>&gt;<i> &gt; 			if (!innertype.IsInstanceOfType (value)) {
</I>&gt;<i> just say
</I>&gt;<i> if (!(value is T))
</I>&gt;<i> &gt; 				string valtype = value.GetType ().ToString ();
</I>&gt;<i> &gt; 				throw new ArgumentException (
</I>&gt;<i> &gt; 						String.Format (&quot;A value of type {0} can't be used in this generic collection.&quot;, valtype),
</I>&gt;<i> &gt; 						&quot;value&quot;);
</I>&gt;<i> &gt; 			}
</I>&gt;<i> &gt; 		}
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 		private void Resize (int newCapacity)
</I>&gt;<i> &gt; 		{
</I>&gt;<i> &gt; 			T [] tmp = new T [newCapacity];
</I>&gt;<i> &gt; 			Array.Copy (contents, tmp, count);
</I>&gt;<i> use Array.Resize here.
</I>&gt;<i> &gt; 			contents = tmp;
</I>&gt;<i> &gt; 			capacity = newCapacity;
</I>&gt;<i> &gt; 		}
</I>&gt;<i> &gt; 		
</I>&gt;<i> &gt; 		//
</I>&gt;<i> &gt; 		// Will we use this iterator until iterators support is done?
</I>&gt;<i> &gt; 		//
</I>&gt;<i> &gt; 		private struct Enumerator : IEnumerator &lt;T&gt;, IEnumerator 
</I>&gt;<i> Is this struct private in the .NET api? 
</I>
It looks like it is a private one.

Thanks for the response.

Carlos.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- Ben
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007785.html">[Mono-devel-list] Re: [Mono-patches] mcs/class/corlib/System.Collections.Generic Collection.cs,NONE,1.1
</A></li>
	<LI>Next message: <A HREF="007787.html">[Mono-devel-list] DbDataAdapter fix for out of memory errors when filling datasets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7790">[ date ]</a>
              <a href="thread.html#7790">[ thread ]</a>
              <a href="subject.html#7790">[ subject ]</a>
              <a href="author.html#7790">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
