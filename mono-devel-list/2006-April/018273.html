<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Question about performance improvement in C#
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Question%20about%20performance%20improvement%20in%20C%23&In-Reply-To=20060416141855.77000.qmail%40web60818.mail.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018264.html">
   <LINK REL="Next"  HREF="018268.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Question about performance improvement in C#</H1>
    <B>Brian Crowell</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Question%20about%20performance%20improvement%20in%20C%23&In-Reply-To=20060416141855.77000.qmail%40web60818.mail.yahoo.com"
       TITLE="[Mono-dev] Question about performance improvement in C#">mono-devel at fluggo.com
       </A><BR>
    <I>Mon Apr 17 14:38:52 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018264.html">[Mono-dev] Summer of Code?
</A></li>
        <LI>Next message: <A HREF="018268.html">[Mono-dev] System.Web.UI.WebControls/MenuItem binding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18273">[ date ]</a>
              <a href="thread.html#18273">[ thread ]</a>
              <a href="subject.html#18273">[ subject ]</a>
              <a href="author.html#18273">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rusmin Susanto wrote:
&gt;<i> In C, we can process all array in one loop. But, in C# we have to 
</I>&gt;<i> process array 2 at a time.  This means (for the above example), we need 
</I>&gt;<i> to execute the loop 4 times instead of once.
</I>
You're just going to have to rethink your design. Object-oriented design is an 
art, and has to yield to concerns of performance, stability, and expandability.

In this case, you should not encapsulate the idea of a linear or two-dimensional 
array. It looks like a good object-oriented design in theory, but makes you lose 
a lot of cache and some heap performance in practice, because, as you've said, 
you have to process one pair at a time.

It may help you to examine more of the patterns in .NET and think of more of the 
tools at your disposal. Consider this static method:

   public static double[] Sum( params double[][] args ) {
       if( args == null || args.Length == 0 )
           throw new ArgumentException( ... );

       double[] result = new double[args[0].Length];

       for( int arg = 0; arg &lt; args.Length; arg++ )
           for( int i = 0; i &lt; args[0].Length; i++ )
                result[i] += args[arg][i];

       return result;
   }

It's not the best method in the world, but may get you much closer to your 
performance goal without sacrificing too much readability. Also note that the 
performance can hinge on such simple things as the order of the loops:

       for( int i = 0; i &lt; args[0].Length; i++ )
           for( int arg = 0; arg &lt; args.Length; arg++ )
                result[i] += args[arg][i];

The first example might perform better because it processes the arrays linearly. 
The second might perform better because the variable &quot;result&quot; is less likely to 
leave the processor's cache.

On top of that, remember that your two-dimensional C loop does work in C#. There 
is no rule that everything you do in C# must yield a class.


&gt;<i> How do we tell C# to process all operands at once, instead of only 2 at 
</I>&gt;<i> a time? Do we need to modify the C# language so that it can process all 
</I>&gt;<i> at once? If we do need to modify C# or the JIT compiler, where should I 
</I>&gt;<i> start?
</I>
Nyet. Try first to work within your language. There are very simple things you 
can do to solve your problem without re-inventing the wheel. From what I've seen 
of your work, C# will do the job, and easily. You just haven't wrapped your head 
around the language yet.

--Brian



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018264.html">[Mono-dev] Summer of Code?
</A></li>
	<LI>Next message: <A HREF="018268.html">[Mono-dev] System.Web.UI.WebControls/MenuItem binding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18273">[ date ]</a>
              <a href="thread.html#18273">[ thread ]</a>
              <a href="subject.html#18273">[ subject ]</a>
              <a href="author.html#18273">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
