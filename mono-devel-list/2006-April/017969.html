<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono profiler agent for jitted code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20profiler%20agent%20for%20jitted%20code&In-Reply-To=84EA05E2CA77634C82730353CBE3A84303E67B81%40SAUSEXMB1.amd.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017966.html">
   <LINK REL="Next"  HREF="017970.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono profiler agent for jitted code</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20profiler%20agent%20for%20jitted%20code&In-Reply-To=84EA05E2CA77634C82730353CBE3A84303E67B81%40SAUSEXMB1.amd.com"
       TITLE="[Mono-dev] Mono profiler agent for jitted code">lupus at ximian.com
       </A><BR>
    <I>Mon Apr  3 06:31:30 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017966.html">[Mono-dev] patch for Soap Serialization Competability
</A></li>
        <LI>Next message: <A HREF="017970.html">[Mono-dev] Mono profiler agent for jitted code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17969">[ date ]</a>
              <a href="thread.html#17969">[ thread ]</a>
              <a href="subject.html#17969">[ subject ]</a>
              <a href="author.html#17969">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/31/06 Yeh, Jason wrote:
&gt;<i> I have been working on a proposal to extend Oprofile to profile the
</I>&gt;<i> &quot;anonymous samples&quot; resulted from jitted code.  I am not familiar enough
</I>&gt;<i> with Mono to determine how such profiler will benefit Mono.  I would
</I>&gt;<i> like to know if such profiler would benefit Mono, and also how would you
</I>&gt;<i> use this profiler if it is available.  
</I>
Having oprofile properly support JITs would be excellent: we certainly
can use it.
We already have a statistical profiler that uses either setitimer()
or /dev/rtc to get samples of the app behaviour. Having oprofile support
JITs we could also enable support for sampling based on cache misses and
so on and this would help us a lot in tuning the mono runtime and the apps
that run on mono.
The important properties we'd like to see from oprofile are:
*) handle jitted methods (code stored in non-file-backed memory)
*) not require root privs (at least for a subset of the capabilities or
with limits designed to reduce the number of interrupts per second)
*) have the counters virtualized per process (this may be already the
case, I haven't looked at oprofile in a long time)

If these features were available we could gather all the interesting
info the cpus can have counters for and we could not only have a
offline profiler, but we could also use it to do dynamic profiling: this
would enable us to recompile hot methods with more aggressive
optimizations at runtime etc.

&gt;<i> If this profiler can benefit Mono, I would like to write a profile agent
</I>&gt;<i> for Mono and make sure that it will work with Mono.  It would also be
</I>&gt;<i> great if someone can point me the files that I should check if I ever
</I>&gt;<i> need to look at how Mono creates jit code.
</I>
We have a profiling interface: it is defined in mono/metadta/profiler.h.
What you'd likely want to do is create a profile module (mono can load
them at runtime) that intercepts JIT compilation. The MonoProfileJitResult
callback will allow you to get some info about a jitted method (like the
address and the size in memory).
The mono/metadata/profiler.c file also contains our sample profiler
that you might want to look at for ideas on how to implement your agent.
As for the JIT sources, they are in the mono/mini/ directory, but you'll
likely only need to deal with the profiling interface.
Let me know if you have any other question.
Thanks!

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017966.html">[Mono-dev] patch for Soap Serialization Competability
</A></li>
	<LI>Next message: <A HREF="017970.html">[Mono-dev] Mono profiler agent for jitted code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17969">[ date ]</a>
              <a href="thread.html#17969">[ thread ]</a>
              <a href="subject.html#17969">[ subject ]</a>
              <a href="author.html#17969">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
