<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Question about performance improvement in C#
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Question%20about%20performance%20improvement%20in%20C%23&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018259.html">
   <LINK REL="Next"  HREF="018261.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Question about performance improvement in C#</H1>
    <B>Rusmin Susanto</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Question%20about%20performance%20improvement%20in%20C%23&In-Reply-To="
       TITLE="[Mono-dev] Question about performance improvement in C#">rusminsusanto at yahoo.com
       </A><BR>
    <I>Sun Apr 16 10:18:54 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018259.html">[Mono-dev] SiteMapNode.cs unit tests and fix
</A></li>
        <LI>Next message: <A HREF="018261.html">[Mono-dev] Question about performance improvement in C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18260">[ date ]</a>
              <a href="thread.html#18260">[ thread ]</a>
              <a href="subject.html#18260">[ subject ]</a>
              <a href="author.html#18260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all.
  I have an optimization question here.
  I have a class that has 2D array of double. This class will be used in scientific iteration.  It need to have operators (+,-, etc.) so that users can do something like this:
   
   A = (B + C + D + E + F)/2.5;
   
  It also has to be fast (as it will be executed thousands of time in iterations and the array dimensions will be large).
   
  When I wrote the application in C# (100%) the performance was bad (about 30 times slower than pure C implementation)
  . 
After profiling I found that the loop inside operator+ that cause problem. We can't have one loop to process all operands because we can only process two at a time (that's what I know. I could be wrong). The creation of temporary object also hurts performance.
   
  The next thing I did to improve performance was to embed the application with C. The array allocation is now done in C. All loops are now executed in C. This approach improves the performance greatly. However, it is still not good enough compared to pure C implementation. It's about 2-3 times slower. After investigating further I found the problem. 
   
  In C, we can do like this:
   
   for(int i = 0; i &lt; rowcount; i++)
 {
  for(int j = 0; j &lt; colcount; i++)
   a[i][j] = (b[i][j] + c[i][j] + d[i][j] + e[i][j] + f[i][j])/2.5;
 }

  In C, we can process all array in one loop. But, in C# we have to process array 2 at a time.  This means (for the above example), we need to execute the loop 4 times instead of once.
   
  What should I do to bring the performance closer to C (of course I wan to keep the class and operators)?
  
How do we tell C# to process all operands at once, instead of only 2 at a time? Do we need to modify the C# language so that it can process all at once? If we do need to modify C# or the JIT compiler, where should I start? 
   
  Many thanks for your attention.
   
   
   
  Rusmin

		
---------------------------------
Blab-away for as little as 1&#162;/min. Make  PC-to-Phone Calls using Yahoo! Messenger with Voice.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060416/a7176098/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060416/a7176098/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018259.html">[Mono-dev] SiteMapNode.cs unit tests and fix
</A></li>
	<LI>Next message: <A HREF="018261.html">[Mono-dev] Question about performance improvement in C#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18260">[ date ]</a>
              <a href="thread.html#18260">[ thread ]</a>
              <a href="subject.html#18260">[ subject ]</a>
              <a href="author.html#18260">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
