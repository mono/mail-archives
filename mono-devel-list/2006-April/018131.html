<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Add GetString to UnicodeEncoding 2.0 and	modifysome Encoding wrappers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Add%20GetString%20to%20UnicodeEncoding%202.0%20and%0A%09modifysome%20Encoding%20wrappers&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018130.html">
   <LINK REL="Next"  HREF="018108.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Add GetString to UnicodeEncoding 2.0 and	modifysome Encoding wrappers</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Add%20GetString%20to%20UnicodeEncoding%202.0%20and%0A%09modifysome%20Encoding%20wrappers&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] Add GetString to UnicodeEncoding 2.0 and	modifysome Encoding wrappers">kornelpal at gmail.com
       </A><BR>
    <I>Mon Apr 10 07:12:19 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018130.html">[Mono-dev] [PATCH] Add GetString to UnicodeEncoding 2.0 and	modifysome Encoding wrappers
</A></li>
        <LI>Next message: <A HREF="018108.html">[Mono-dev] FAMWatcher race condition patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18131">[ date ]</a>
              <a href="thread.html#18131">[ thread ]</a>
              <a href="subject.html#18131">[ subject ]</a>
              <a href="author.html#18131">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK, now I understand what you mean.:)

UnicodeEncoding.GetString should have exactly the same result as previously 
but it should be much faster because data is written directly to the string 
instead of creating a temporary char[] buffer.

All the modified Encoding methods are very high level wrappers that have 
currently faster implementations than in my patch because some unnecessary 
checks are avoided.

The problem however is that Encoding is an abstract class with a lot of 
virtual methods so people can implement their own encodings. In this case 
they may assume that these wrappers call (or wrap) the same methods as in 
MS.NET.

I noticed this when implementing UnicodeEncoding.GetString because GetString 
(byte[]) calls GetString (byte[] bytes, int, int) on MS.NET while Mono uses 
new string (GetChars (byte[])). As you can see on MS.NET overriding 
GetString (byte[] bytes, int, int) will result in modification of GetString 
(byte[]) as well while on Mono you have to override both of them to have the 
same effect.

The same goes for the two other modified Encoding methods. They are higher 
level wrappers on MS.NET than on Mono.

So the difference can only be experienced when overriding methods in 
Encoding, you will get different results on MS.NET and Mono.

The exact behaviour of these wrappers could be enforced using a test case by 
creating an inherited class that throws exceptions when methods that should 
not be called are called and fails when the expected method was not called 
but I'm not sure whether we need this kind of tests.

Note that explicitly throwing ArgumentNullException is required because of 
accessing .Length that would result in NullReferenceException. These methods 
throw ArgumentNullException on MS.NET. Previously I thought that 
ArgumentNullExceptions were already thrown by the wrapped methods in the 
current implementation but now I reallized that GetBytes (char[]) currently 
throws NullReferenceException that is a bug.

So the goal of this patch is to implement a fast UnicodeEncoding.GetString 
and to modify some wrapper methods of Encoding to call the same methods as 
they do on MS.NET (this actually means to make the higher level wrappers 
than they are currently).

Korn&#233;l

----- Original Message ----- 
From: &quot;Atsushi Eno&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushi at ximian.com</A>&gt;
To: &quot;Korn&#233;l P&#225;l&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at gmail.com</A>&gt;
Cc: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Monday, April 10, 2006 12:54 PM
Subject: Re: [Mono-dev] [PATCH] Add GetString to UnicodeEncoding 2.0 and 
modifysome Encoding wrappers


&gt;<i> Korn&#233;l P&#225;l wrote:
</I>&gt;&gt;<i> No, but if you have conceptions regarding what kind of new tests we need 
</I>&gt;&gt;<i> I can create some.
</I>&gt;<i>
</I>&gt;<i> Things that fails without your patch but does not fail with it.
</I>&gt;<i> (Otherwise why did you create the patch? ;-)
</I>&gt;<i>
</I>&gt;<i> For GetBytes() fix I can imagine the difference (though it is very
</I>&gt;<i> minor: whether it throws NullReferenceException or
</I>&gt;<i> ArgumentNullException) but not sure for others.
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018130.html">[Mono-dev] [PATCH] Add GetString to UnicodeEncoding 2.0 and	modifysome Encoding wrappers
</A></li>
	<LI>Next message: <A HREF="018108.html">[Mono-dev] FAMWatcher race condition patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18131">[ date ]</a>
              <a href="thread.html#18131">[ thread ]</a>
              <a href="subject.html#18131">[ subject ]</a>
              <a href="author.html#18131">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
