<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Incorrect Directory.GetParent behavior
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Incorrect%20Directory.GetParent%20behavior&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018377.html">
   <LINK REL="Next"  HREF="018385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Incorrect Directory.GetParent behavior</H1>
    <B>Emery Conrad</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Incorrect%20Directory.GetParent%20behavior&In-Reply-To="
       TITLE="[Mono-dev] Incorrect Directory.GetParent behavior">econrad at vt.edu
       </A><BR>
    <I>Mon Apr 24 12:20:09 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018377.html">[Mono-dev] FW: System.Web.Mail patches #2
</A></li>
        <LI>Next message: <A HREF="018385.html">[Mono-dev] Incorrect Directory.GetParent behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18369">[ date ]</a>
              <a href="thread.html#18369">[ thread ]</a>
              <a href="subject.html#18369">[ subject ]</a>
              <a href="author.html#18369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

Directory.GetParent should return a DirectoryInfo for *both* full path names
and relative path names. (See
<A HREF="http://msdn2.microsoft.com/en-us/library/system.io.directory.getparent.aspxfor">http://msdn2.microsoft.com/en-us/library/system.io.directory.getparent.aspxfor</A>
microsoft doc). Here's the issue: currently, mono implements
Directory.GetParent using new DirectoryInfo(Path.GetDirectoryName(path)),
but Path.GetDirectoryName *does not* returns an absolute directory name for
a relative path (it returns the String-based relative path information
contained in the argument). So, when mono calls &quot;new DirectoryInfo(relpath)&quot;
for some relative path, it works UNLESS the Path.GetDirectoryName() has
return String.Emtpy (since this is the required behavior for this function
for a relative path of something in the current directory).

The fix is to make the ctor for DirectoryInfo reset the argument to
Directory.GetCurrentDirectory() when the argument is String.Emtpy. Diff is
below.

Emery


Index: mcs/class/corlib/System.IO/DirectoryInfo.cs
===================================================================
--- mcs/class/corlib/System.IO/DirectoryInfo.cs (revision 59817)
+++ mcs/class/corlib/System.IO/DirectoryInfo.cs (working copy)
@@ -51,6 +51,9 @@

                public DirectoryInfo (string path)
                {
+                       if(path == String.Empty)
+                               path = Directory.GetCurrentDirectory();
+
                        CheckPath (path);

                        FullPath = Path.GetFullPath (path);

--
Emery Conrad
Department of Mathematics
Virginia Tech
5076 Derring Hall
Blacksburg, VA 24061-0406
(540) 231-3324
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060424/454a393e/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060424/454a393e/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018377.html">[Mono-dev] FW: System.Web.Mail patches #2
</A></li>
	<LI>Next message: <A HREF="018385.html">[Mono-dev] Incorrect Directory.GetParent behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18369">[ date ]</a>
              <a href="thread.html#18369">[ thread ]</a>
              <a href="subject.html#18369">[ subject ]</a>
              <a href="author.html#18369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
