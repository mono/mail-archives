<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] &quot;safe&quot; way about Marshal.UnsafeAddrOfPinnedArrayElement
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%22safe%22%20way%20about%20Marshal.UnsafeAddrOfPinnedArrayElement&In-Reply-To=a11dfb980604172127h17846205v27a846ce7ae580cc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018277.html">
   <LINK REL="Next"  HREF="018286.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] &quot;safe&quot; way about Marshal.UnsafeAddrOfPinnedArrayElement</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%22safe%22%20way%20about%20Marshal.UnsafeAddrOfPinnedArrayElement&In-Reply-To=a11dfb980604172127h17846205v27a846ce7ae580cc%40mail.gmail.com"
       TITLE="[Mono-dev] &quot;safe&quot; way about Marshal.UnsafeAddrOfPinnedArrayElement">jonpryor at vt.edu
       </A><BR>
    <I>Tue Apr 18 07:48:11 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018277.html">[Mono-dev] &quot;safe&quot; way about Marshal.UnsafeAddrOfPinnedArrayElement
</A></li>
        <LI>Next message: <A HREF="018286.html">[Mono-dev] &quot;safe&quot; way about Marshal.UnsafeAddrOfPinnedArrayElement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18285">[ date ]</a>
              <a href="thread.html#18285">[ thread ]</a>
              <a href="subject.html#18285">[ subject ]</a>
              <a href="author.html#18285">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2006-04-18 at 12:27 +0800, GaoXianchao wrote:
&gt;<i> hi all,
</I>&gt;<i> I'm wrapping epoll api on linux.
</I>&gt;<i> To pass address of managed struct array to unmanaged code, I use
</I>&gt;<i> Marshal.UnsafeAddrOfPinnedArrayElement . But the method is &quot;unsafe&quot;.
</I>&gt;<i> Is there a &quot;safe&quot; way to do what the Marshal.UnsafeAddrOfPinnedArrayElement do?
</I>
It's &quot;unsafe&quot; because you need to be careful. :-)

An alternative is to use *real* unsafe code, e.g.

	FooStruct[] array = ...;
	unsafe {
		fixed (FooStruct* pArray = array) {
			FooStruct* element = &amp;pArray [index];
		}
	}

I'm not entirely sure what your problem is though.  &quot;Unsafe&quot; code (like
the above `unsafe' block) just means that you're possibly executing
without a net, which could result in memory corruption and abortion of
the process. :-)

Marshal.UnsafeAddrOfPinnedArrayElement isn't even in an unsafe C#
context, it just has &quot;Unsafe&quot; in the name.

Here's a hint of truth: ANY time you do a P/Invoke, you're potentially
doing something unsafe. :-)

(Especially considering that you're invoking external code which could
really do anything, such as overwrite the entire GC heap, which would
cause the process an ugly death in the future...)

However, I'm not sure why you need
Marshal.UnsafeAddrOfPinnedArrayElement in the first place.
epoll_wait(2) takes a `struct epoll_event' array parameter, so unless
you wanted to only send a subset of your array, the default marshaling
rules which convert a managed array to an array pointer should be fine.

 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018277.html">[Mono-dev] &quot;safe&quot; way about Marshal.UnsafeAddrOfPinnedArrayElement
</A></li>
	<LI>Next message: <A HREF="018286.html">[Mono-dev] &quot;safe&quot; way about Marshal.UnsafeAddrOfPinnedArrayElement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18285">[ date ]</a>
              <a href="thread.html#18285">[ thread ]</a>
              <a href="subject.html#18285">[ subject ]</a>
              <a href="author.html#18285">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
