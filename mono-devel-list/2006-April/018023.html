<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Thread Abort() sometimes fails in mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Thread%20Abort%28%29%20sometimes%20fails%20in%20mono&In-Reply-To=1144167190.10986.11.camel%40kenshin.CASA">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018042.html">
   <LINK REL="Next"  HREF="018025.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Thread Abort() sometimes fails in mono</H1>
    <B>Wade Maxfield</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Thread%20Abort%28%29%20sometimes%20fails%20in%20mono&In-Reply-To=1144167190.10986.11.camel%40kenshin.CASA"
       TITLE="[Mono-dev] Thread Abort() sometimes fails in mono">wmaxfield at gmail.com
       </A><BR>
    <I>Tue Apr  4 13:50:00 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018042.html">[Mono-dev] Re: Thread Abort() sometimes fails in mono
</A></li>
        <LI>Next message: <A HREF="018025.html">[Mono-dev] Thread Abort() sometimes fails in mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18023">[ date ]</a>
              <a href="thread.html#18023">[ thread ]</a>
              <a href="subject.html#18023">[ subject ]</a>
              <a href="author.html#18023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Felipe,

  First, thank you.

  Second, yes, I did use a variable to do what you stated (it was in the
code fragments).  When I found the abort() did not work all the time, I set
a variable to true, which caused my thread to abort.

  Now, in regards to programming practices.  I believe you are correct.  I
agree in principal with everything you state.  I typically practice those
things, as unbelievable as that might sound.  I'm more into systems now, but
I've written real time sw for years.

  However, if you look at Microsoft's .NET programming in C# examples and
tutorials, their C# tutorial (see Microsoft .NET SDK, C# Programming
Reference, &quot;Threading Tutorial&quot;) on threads shows you to

  1) Spin while thread is not alive
  2) call abort for thread to be closed

   I agree that a sleep() is a good thing while waiting for thread to start
running.  However, I thought one of the points of &quot;managed&quot; code was to
allow this sort of thing, not necessarily paying attention to cpu loading
issues, as well as memory issues?  That is why I swallowed MS's tutorial
hook line and sinker.

  In any case, regardless of the efficacy of the program I've written, the
point that mono developers must ponder is that other coders following my
footsteps will code exactly the same way, the way that Microsoft Tutorial
states it should.  When it fails to abort under mono, but always aborts
under .NET, they will claim it is a bug in Mono.

  It does appear I overlooked a join() call, which forces the first thread
to deadlock until the abort happens.  However, I never had the problem of a
failing abort in .NET.  In this case, I could care less if the thread
aborted a few hundred milliseconds to one second later than the main thread.

  As I indicated earlier, I set a variable which caused my routine to bail,
causing the thread to naturally abort (similar to your proposal, but more
crude).  This method will work in all versions, .NET and Mono.

   I was wondering if perhaps the abort() routine in Mono might need
tweaking. I was assuming that in most cases, (except for System.Managed and
other issues of similar ilk) that Mono would typically want to work the same
way as .NET.

  I think Mono is great!  I'm very, very happy to see it.  The work thus far
has been astounding and exciting.   If the way abort() works is the one of
the few differences, I don't have any problems using Mono.  It would need to
be documented, however, for future folks blindly following MS
recommendations.

  BTW, the original .NET code ran in Mono without recompile, except for one
small issue.  I'm tracking down some other issues now.


thanks again,
wade

On 4/4/06, Felipe Almeida Lessa &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">felipe.lessa at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Em Ter, 2006-04-04 &#224;s 08:26 -0600, Wade Maxfield escreveu:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i>
</I>&gt;<i> Hi! Correct me if I'm wrong but...
</I>&gt;<i>
</I>&gt;<i> &gt; /*doesn't always work ----&gt;*/    Global.WebThread.Abort();
</I>&gt;<i>
</I>&gt;<i> You shouldn't be using Thread.Abort, right? AFAIK, this is a bad way of
</I>&gt;<i> killing threads.
</I>&gt;<i>
</I>&gt;<i> &gt;         while (!Global.WebThread.IsAlive);
</I>&gt;<i>
</I>&gt;<i> Why do you make the CPU go to 100% here? At least some Sleep should be
</I>&gt;<i> better, no?
</I>&gt;<i>
</I>&gt;<i> ------
</I>&gt;<i>
</I>&gt;<i> I didn't read all of your code, but I suspect you should be using
</I>&gt;<i> another thread abortion method. I have some code that uses a thread with
</I>&gt;<i> some web requests, and to abort it I do 2 things:
</I>&gt;<i>
</I>&gt;<i> 1) Create a variable that is marked false when I want the thread to die.
</I>&gt;<i> The thread's code periodically checks for the variable.
</I>&gt;<i> 2) Save the WebRequest on a private variable to try to abort it, if
</I>&gt;<i> possible.
</I>&gt;<i>
</I>&gt;<i> The relevant abortion method:
</I>&gt;<i>
</I>&gt;<i> public void Abort() {
</I>&gt;<i>         this.aborted = true;
</I>&gt;<i>         try {
</I>&gt;<i>                 if (this.abortable) {
</I>&gt;<i>                         this.webRequest.Abort();
</I>&gt;<i>                         Logger.Log(this, &quot;WebRequest aborted with
</I>&gt;<i> (apparent) success!&quot;);
</I>&gt;<i>                 } else
</I>&gt;<i>                         Logger.Log(this, &quot;WebRequest is not abortable.&quot;);
</I>&gt;<i>         } catch (Exception e) {
</I>&gt;<i>                 Logger.Log(this, &quot;Failed to abort the WebRequest:\n&quot; +
</I>&gt;<i> e.ToString());
</I>&gt;<i>         }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> The method name is &quot;Abort&quot; because this class does not derive from
</I>&gt;<i> Thread. Also, you can safely ignore all Logger::Log calls.
</I>&gt;<i>
</I>&gt;<i> abortable is a variable that is set to false when the code starts an
</I>&gt;<i> operation on the WebRequest that would probably crash the program if it
</I>&gt;<i> was aborted.
</I>&gt;<i>
</I>&gt;<i> It's also worth noting that we just try to abort the WebRequest and
</I>&gt;<i> ignore any exceptions -- the code will stop anyway sometime soon as we
</I>&gt;<i> set the aborted variable.
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Felipe.
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060404/4a9cc005/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060404/4a9cc005/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018042.html">[Mono-dev] Re: Thread Abort() sometimes fails in mono
</A></li>
	<LI>Next message: <A HREF="018025.html">[Mono-dev] Thread Abort() sometimes fails in mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18023">[ date ]</a>
              <a href="thread.html#18023">[ thread ]</a>
              <a href="subject.html#18023">[ subject ]</a>
              <a href="author.html#18023">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
