<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] TCP Async
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20TCP%20Async&In-Reply-To=%3CCAN5%3DXTAD3F_N%3DTwmPQ9f1vrCvQJEu%2BSkmoCck7CdtfEdbd3exQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039318.html">
   <LINK REL="Next"  HREF="039348.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] TCP Async</H1>
    <B>Yuriy Solodkyy</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20TCP%20Async&In-Reply-To=%3CCAN5%3DXTAD3F_N%3DTwmPQ9f1vrCvQJEu%2BSkmoCck7CdtfEdbd3exQ%40mail.gmail.com%3E"
       TITLE="[Mono-dev] TCP Async">yuriy at couldbedone.com
       </A><BR>
    <I>Fri Jul  6 21:49:22 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="039318.html">[Mono-dev] AOT and generics
</A></li>
        <LI>Next message: <A HREF="039348.html">[Mono-dev] TCP Async
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39314">[ date ]</a>
              <a href="thread.html#39314">[ thread ]</a>
              <a href="subject.html#39314">[ subject ]</a>
              <a href="author.html#39314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Rodrigo,

please find a small sample app at <A HREF="https://github.com/ysw/mono-socket-problem">https://github.com/ysw/mono-socket-problem</A>

This app can start in either server or client mode.  These modes only
differ in whether it listens for connections on multiple ports or
connects to server on multiple ports. Upon connecting to or accepting
connection it immediately sends some data, and then sends next chunk
of data in response to any data received from the other side.  There
are some random delays in code and we limit outgoing traffic on each
connection not to be significantly higher than inbound.

There is also a separate thread which regularly checks status of every
connection and report any connections that are awaiting a callback,
but their status obtained with socket.poll is already READY.  (A
several seconds delay is still allowed).

See also the README file.


Also, it seems that constantly changing men/max threads in ThreadPool
increases probability of the problem. See code.
Please let me know if this sample app works for you.

Hope it helps


Thank you,
Yuriy


We've been aware of such issues, could you file a bug and attach a test
case with it please?

This would really really help us fix it.

On Wed, Jun 27, 2012 at 4:08 AM, Greg Young &lt;gregoryyoung1 at gmail.com&gt; wrote:

&gt;<i> We are experiencing an issue with async behaviours in sockets (with
</I>&gt;<i> SendAsync/callback not Begin/End).
</I>&gt;<i>
</I>&gt;<i> Our visible issue is that when in a send loop we will fail on our
</I>&gt;<i> heartbeats. After debugging and counting calls into/out of
</I>&gt;<i> SendAsync/callback we see that we are inside of a call to SendAsync
</I>&gt;<i> (eg: it never returns, in our case for 10 seconds before we declare
</I>&gt;<i> the socket dead). We can duplicate this fairly regularly on
</I>&gt;<i> mac/bsd/linux though its nonconsistent (sometimes it may happen
</I>&gt;<i> repeatedly other times it works fine). The code does not have such
</I>&gt;<i> issues on MS CLR. We are also running on loopback so its unlikely that
</I>&gt;<i> an underlying network problem is causing the hang up. The code itself
</I>&gt;<i> is fairly straight forward (not that different than the MS example of
</I>&gt;<i> the API except that its fully async (separate send/receive loops while
</I>&gt;<i> the example is request/response))
</I>&gt;<i>
</I>&gt;<i> I am pulling sources now to build latest but does anyone happen to
</I>&gt;<i> know of known issues with this sort of thing?
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Greg
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Le doute n'est pas une condition agr&#233;able, mais la certitude est absurde.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> Mono-devel-list at lists.ximian.com
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>
-- 
Yuriy Solodkyy
(<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">y.solodkyy at gmail.com</A>)
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039318.html">[Mono-dev] AOT and generics
</A></li>
	<LI>Next message: <A HREF="039348.html">[Mono-dev] TCP Async
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39314">[ date ]</a>
              <a href="thread.html#39314">[ thread ]</a>
              <a href="subject.html#39314">[ subject ]</a>
              <a href="author.html#39314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
