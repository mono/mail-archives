<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Enable TLS for PPC32/64
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Enable%20TLS%20for%20PPC32/64&In-Reply-To=1232816849.507.15.camel%40newton">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030631.html">
   <LINK REL="Next"  HREF="030666.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Enable TLS for PPC32/64</H1>
    <B>Steven Munroe</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Enable%20TLS%20for%20PPC32/64&In-Reply-To=1232816849.507.15.camel%40newton"
       TITLE="[Mono-dev] [PATCH] Enable TLS for PPC32/64">munroesj at us.ibm.com
       </A><BR>
    <I>Sun Jan 25 19:12:10 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="030631.html">[Mono-dev] [PATCH] Enable TLS for PPC32/64
</A></li>
        <LI>Next message: <A HREF="030666.html">[Mono-dev] [PATCH] Enable TLS for PPC32/64
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30645">[ date ]</a>
              <a href="thread.html#30645">[ thread ]</a>
              <a href="subject.html#30645">[ subject ]</a>
              <a href="author.html#30645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mark Probst wrote:
&gt;<i> On Thu, 2009-01-22 at 09:03 -0600, Steven Munroe wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> this patch completes the PPC64 port and enables Thread Local Storage
</I>&gt;&gt;<i> under Linux/NPTL. This patch also provides the infrastructure for
</I>&gt;&gt;<i> detecting PPC hardware attributes (via the SYSV Aux Vector) that we will
</I>&gt;&gt;<i> need to optimize JIT code. For example this patch fixes
</I>&gt;&gt;<i> mono_arch_flush_icache() used aux vector Hardware Capabilities
</I>&gt;&gt;<i> (AT_HWCAP) info to avoid unnecessary dcbf/icbi sequences.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Thank you very much for this patch and all the legal difficulties that
</I>&gt;<i> went with it.
</I>&gt;<i>
</I>&gt;<i> We don't commit patches this big in one swoop, so I had to split it up.
</I>&gt;<i> The order in which they are meant to be applied is:
</I>&gt;<i>
</I>&gt;<i>   sm-codegen.diff
</I>&gt;<i>   sm-beautify.diff
</I>&gt;<i>   sm-small-fixes.diff
</I>&gt;<i>   sm-hwcap.diff
</I>&gt;<i>   sm-better-code.diff
</I>&gt;<i>   sm-icache.diff
</I>&gt;<i>   sm-tls.diff
</I>&gt;<i>
</I>&gt;<i> The changes in sm-superfluous.diff seem, well, superfluous to me :-)
</I>&gt;<i>
</I>&gt;<i> When contributing patches, please also use our coding style, especially
</I>&gt;<i> regarding indentation and where to put spaces:
</I>&gt;<i>
</I>&gt;<i>   <A HREF="http://www.mono-project.com/Coding_Guidelines">http://www.mono-project.com/Coding_Guidelines</A>
</I>&gt;<i>
</I>&gt;<i> I've fixed all of that in your code as far as it caught my eye.
</I>&gt;<i>
</I>&gt;<i> Paolo: Please review the patches, especially the hwcap, icache and TLS
</I>&gt;<i> stuff.  I can't say much about those, but everything else looks fine,
</I>&gt;<i> and everything works (runtime and corlib regressions, tested on
</I>&gt;<i> PPC64/linux and PPC32/darwin).
</I>&gt;<i>
</I>&gt;<i> Mark
</I>&gt;<i>
</I>&gt;<i>   
</I>dang ... I spent most of my weekend reworking the patch on my own as you
suggested. Attached my version in case you want to use the change logs.

What you consider superfluous addresses an annoying bug where the
mkbundle generates code that can never be assembled and results in a 2GB
a.out file. This is a result of brain-dead code the than can't handle
biarch builds (where the build is for the non-default arch).

Has far I can tell mkbundle is disabled for PPC32 and has been for some
time ...


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ppc-part1-fix-20090124.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0005.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0005.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ppc-part2-gen-20090124.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0006.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0006.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ppc-part3-warn-20090124.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0007.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0007.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ppc-part4-opt-20090124.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0008.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0008.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ppc-part5-tls-20090124.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0009.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090125/c5575104/attachment-0009.txt</A> 
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030631.html">[Mono-dev] [PATCH] Enable TLS for PPC32/64
</A></li>
	<LI>Next message: <A HREF="030666.html">[Mono-dev] [PATCH] Enable TLS for PPC32/64
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30645">[ date ]</a>
              <a href="thread.html#30645">[ thread ]</a>
              <a href="subject.html#30645">[ subject ]</a>
              <a href="author.html#30645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
