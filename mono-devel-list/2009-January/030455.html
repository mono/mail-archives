<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] PInvoke and language interopelability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PInvoke%20and%20language%20interopelability&In-Reply-To=db6932e60901130713o5996eb5dx15a27e8bf0c04ea4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030453.html">
   <LINK REL="Next"  HREF="030456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] PInvoke and language interopelability</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PInvoke%20and%20language%20interopelability&In-Reply-To=db6932e60901130713o5996eb5dx15a27e8bf0c04ea4%40mail.gmail.com"
       TITLE="[Mono-dev] PInvoke and language interopelability">jonpryor at vt.edu
       </A><BR>
    <I>Tue Jan 13 11:03:54 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="030453.html">[Mono-dev] PInvoke and language interopelability
</A></li>
        <LI>Next message: <A HREF="030456.html">[Mono-dev] PInvoke and language interopelability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30455">[ date ]</a>
              <a href="thread.html#30455">[ thread ]</a>
              <a href="subject.html#30455">[ subject ]</a>
              <a href="author.html#30455">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2009-01-13 at 16:13 +0100, Alfredo Jos&#233; Muela Romero wrote:
&gt;<i> My current problem, which I'm running out of ideas :/ is about how to
</I>&gt;<i> get a call from the dinamic to the wrapped code.
</I>&gt;<i> 
</I>&gt;<i> Let's say I have a dynamic library (in C++ for instance) which
</I>&gt;<i> implements a Model-View-Controller pattern. In that library exists a
</I>&gt;<i> method which receives a pointer to an object as a parameter in order
</I>&gt;<i> to notify later changes.
</I>&gt;<i> 
</I>&gt;<i> Does anyone know a way to get that call to the C# code
</I>
Delegates are your friend.  Delegates marshal to a function pointer that
can be called from C/C++ code, e.g. given:

	delegate int Foo (string s);
	[DllImport] static extern void PerformCallback(Foo f);

	...
	Func&lt;string, int&gt; f = s =&gt; s.Length;
	PerformCallback (f);
	f = null;

The C++ code would be:

	void PerformCallback(int (*cb)(const char* s))
	{
		cb (&quot;hello!&quot;);
	}

This works pretty well for functions.  If you need to pass actual C++
objects around, things get more complicated.  You might be able to
create a C# class/structure to mirror the C++ type, but such things can
get ugly, quick.

Note: delegates passed to native code are only valid for as long as the
managed delegate exists.  In the above code, the native callback will
only be valid for the life of the PerformCallback() call.  If you need
it to last longer, you'll need to store the delegate as a member and
otherwise ensure it isn't collected.

 - Jon


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030453.html">[Mono-dev] PInvoke and language interopelability
</A></li>
	<LI>Next message: <A HREF="030456.html">[Mono-dev] PInvoke and language interopelability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30455">[ date ]</a>
              <a href="thread.html#30455">[ thread ]</a>
              <a href="subject.html#30455">[ subject ]</a>
              <a href="author.html#30455">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
