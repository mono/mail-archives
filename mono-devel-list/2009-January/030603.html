<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Use ECMA compliant floating point rounding (x86)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Use%20ECMA%20compliant%20floating%20point%20rounding%20%28x86%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030620.html">
   <LINK REL="Next"  HREF="030741.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Use ECMA compliant floating point rounding (x86)</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Use%20ECMA%20compliant%20floating%20point%20rounding%20%28x86%29&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] Use ECMA compliant floating point rounding (x86)">kornelpal at gmail.com
       </A><BR>
    <I>Thu Jan 22 19:12:52 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="030620.html">[Mono-dev] Enabling Support for SIMD Intrinsics
</A></li>
        <LI>Next message: <A HREF="030741.html">[Mono-dev]  ServiceHost Crashes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30603">[ date ]</a>
              <a href="thread.html#30603">[ thread ]</a>
              <a href="subject.html#30603">[ subject ]</a>
              <a href="author.html#30603">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

This patch fixes the test cases in 
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=467201">https://bugzilla.novell.com/show_bug.cgi?id=467201</A>

I've found the following bugs:

1. Return value of functions don't has to be rounded and is not rounded 
by MS.NET either.

2. conv.r4 has to change precision (required by ECMA specs)

3. conv.r8 also has to change precision

I also reordered code in OP_LCONV_TO_R_UN_2 because there is no need to 
allocate extra stack space and store and reload a 80-bit floating point 
value. I just removed unnecessary code but please have a look at the 
changes because I have little experience with the FPU.

Also note that the test in the bug report should be modified to be 
platform independent and the above three bugs should be fixed on all 
other platforms that has them.

Korn&#233;l
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: fpu_round.diff.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090123/bcc5aee1/attachment.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090123/bcc5aee1/attachment.txt</A> 
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030620.html">[Mono-dev] Enabling Support for SIMD Intrinsics
</A></li>
	<LI>Next message: <A HREF="030741.html">[Mono-dev]  ServiceHost Crashes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30603">[ date ]</a>
              <a href="thread.html#30603">[ thread ]</a>
              <a href="subject.html#30603">[ subject ]</a>
              <a href="author.html#30603">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
