<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] ASP.NET Web API on Mono 3.0 (Could not load type	'System.Web.Http.WebHost.HttpControllerHandler')
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ASP.NET%20Web%20API%20on%20Mono%203.0%20%28Could%20not%20load%20type%0A%09%27System.Web.Http.WebHost.HttpControllerHandler%27%29&In-Reply-To=%3CCAB1r_%2BW3wcAm0HEkUdCd%2Bb1XaMGFGB7vzVBhPCjfNW2pr1uEZA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039719.html">
   <LINK REL="Next"  HREF="039721.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] ASP.NET Web API on Mono 3.0 (Could not load type	'System.Web.Http.WebHost.HttpControllerHandler')</H1>
    <B>Daniel Lo Nigro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ASP.NET%20Web%20API%20on%20Mono%203.0%20%28Could%20not%20load%20type%0A%09%27System.Web.Http.WebHost.HttpControllerHandler%27%29&In-Reply-To=%3CCAB1r_%2BW3wcAm0HEkUdCd%2Bb1XaMGFGB7vzVBhPCjfNW2pr1uEZA%40mail.gmail.com%3E"
       TITLE="[Mono-dev] ASP.NET Web API on Mono 3.0 (Could not load type	'System.Web.Http.WebHost.HttpControllerHandler')">lists at dan.cx
       </A><BR>
    <I>Thu Oct 25 02:51:00 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="039719.html">[Mono-dev] ASP.NET Web API on Mono 3.0 (Could not load type	'System.Web.Http.WebHost.HttpControllerHandler')
</A></li>
        <LI>Next message: <A HREF="039721.html">[Mono-dev] ASP.NET Web API on Mono 3.0 (Could not load type	'System.Web.Http.WebHost.HttpControllerHandler')
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39720">[ date ]</a>
              <a href="thread.html#39720">[ thread ]</a>
              <a href="subject.html#39720">[ subject ]</a>
              <a href="author.html#39720">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your reply.

I found that my app is referencing version 2.0.0.0 of System.Net.Http.dll,
probably because I'm only using .NET Framework 4.0 (not 4.5) on my Windows
machine. I created an assembly binding in my Web.config to redirect to the
newer version:

      &lt;dependentAssembly&gt;
        &lt;assemblyIdentity name=&quot;System.Net.Http&quot;
publicKeyToken=&quot;b03f5f7f11d50a3a&quot; /&gt;
        &lt;bindingRedirect oldVersion=&quot;2.0.0.0&quot; newVersion=&quot;4.0.0.0&quot; /&gt;
      &lt;/dependentAssembly&gt;

I'll raise a bug for the missing IHostBufferPolicySelector interface. I
tried working around this by uploading a copy of the Microsoft build of
System.Net.Http.dll 4.0.0.0.

This got the basic site working (the &quot;Welcome to ASP.NET Web API&quot; page in
the default template), but I'm getting this error whenever I try to use a
WebAPI controller:

Missing method System.Web.HttpRequest::GetBufferlessInputStream() in
assembly
/opt/mono-3.0.0/lib/mono/gac/System.Web/4.0.0.0__b03f5f7f11d50a3a/System.Web.dll,
referenced in assembly
/tmp/root-temp-aspnet-0/2956977a/assembly/shadow/5cf10065/cf4140da_93b040bf_00000001/System.Web.Http.WebHost.dll

This is confusing, as Mono's status page shows this method as implemented:
<A HREF="http://go-mono.com/status/status.aspx?reference=4.0&amp;profile=4.5&amp;assembly=System.Web.">http://go-mono.com/status/status.aspx?reference=4.0&amp;profile=4.5&amp;assembly=System.Web.</A>
However,
I opened Mono's System.Web.dll in a decompiler and can see that
GetBufferlessInputSteam() is missing.


On Wed, Oct 24, 2012 at 10:35 PM, Rafael Teixeira &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">monoman at gmail.com</A>&gt; wrote:

&gt;<i> Hi Daniel,
</I>&gt;<i>
</I>&gt;<i> Well at
</I>&gt;<i> <A HREF="https://github.com/mono/mono/blob/master/mcs/class/System.Net.Http/System.Net.Http/HttpMessageInvoker.cs">https://github.com/mono/mono/blob/master/mcs/class/System.Net.Http/System.Net.Http/HttpMessageInvoker.cs</A> one
</I>&gt;<i> can see that such class is part of Mono and stable for at least 5 months,
</I>&gt;<i> so it surely should be found in Mono 3.0 but from your log it seems that
</I>&gt;<i> your server is loading a copy found on your bin directory, that may be
</I>&gt;<i> outdated...
</I>&gt;<i>
</I>&gt;<i> *Mono: Assembly Loader probing location:
</I>&gt;<i> '/var/www/WebApiTest/bin/System.Net.Http.dll'.
</I>&gt;<i> Mono: Assembly Loader shadow-copied assembly to:
</I>&gt;<i> '/tmp/root-temp-aspnet-0/2956977a/assembly/shadow/ebec392e/785c7991_93b040bf_00000001/System.Net.Http.dll'.
</I>&gt;<i> *
</I>&gt;<i> So please get rid of your copy of System.Net.Http.dll, and it should work.
</I>&gt;<i>
</I>&gt;<i> In the other hand surely IHostBufferPolicySelector is missing from
</I>&gt;<i> <A HREF="https://github.com/mono/mono/blob/master/mcs/class/System.Web.Http/System.Web.Http.dll.sources.">https://github.com/mono/mono/blob/master/mcs/class/System.Web.Http/System.Web.Http.dll.sources.</A>
</I>&gt;<i> Maybe this is newer than the open sourced files from Microsoft being used
</I>&gt;<i> in that part of Mono.
</I>&gt;<i>
</I>&gt;<i> Please open an issue for this second problem, probably the aspnetstack
</I>&gt;<i> needs to be refreshed, although this may appear only in the 4.5 profile,
</I>&gt;<i> I'm not sure what are the .NET platform requirements for ASP.NET Web API.
</I>&gt;<i>
</I>&gt;<i> Fun,
</I>&gt;<i>
</I>&gt;<i> Rafael &quot;Monoman&quot; Teixeira
</I>&gt;<i> ---------------------------------------
</I>&gt;<i> &quot;The most exciting phrase to hear in science, the one that heralds new
</I>&gt;<i> discoveries, is not 'Eureka!' (I found it!) but 'That's funny ...'&quot;
</I>&gt;<i> Isaac Asimov
</I>&gt;<i> US science fiction novelist &amp; scholar (1920 - 1992)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, Oct 24, 2012 at 2:03 AM, Daniel Lo Nigro &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lists at dan.cx</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Just rediscovered the MONO_LOG_LEVEL=&quot;debug&quot; environment variable.
</I>&gt;<i> Here's the log from my app: <A HREF="http://sprunge.us/eXOV.">http://sprunge.us/eXOV.</A> I think these might
</I>&gt;<i> be related, but of course I could be totally wrong:
</I>&gt;<i> &gt; Mono: The class System.Web.Http.Hosting.IHostBufferPolicySelector could
</I>&gt;<i> not be loaded, used in System.Web.Http, Version=4.0.0.0, Culture=neutral,
</I>&gt;<i> PublicKeyToken=31bf3856ad364e35
</I>&gt;<i> &gt; Mono: The class System.Net.Http.HttpMessageInvoker could not be loaded,
</I>&gt;<i> used in System.Net.Http, Version=2.0.0.0, Culture=neutral,
</I>&gt;<i> PublicKeyToken=b03f5f7f11d50a3a
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thoughts?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Wed, Oct 24, 2012 at 2:23 PM, Daniel Lo Nigro &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lists at dan.cx</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I'm trying to get ASP.NET WebApi working on Mono 3.0, and am getting
</I>&gt;<i> &gt;&gt; the following error:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; System.TypeLoadException: Could not load type
</I>&gt;<i> &gt;&gt; 'System.Web.Http.WebHost.HttpControllerHandler' from assembly
</I>&gt;<i> &gt;&gt; 'System.Web.Http.WebHost, Version=4.0.0.0, Culture=neutral,
</I>&gt;<i> &gt;&gt; PublicKeyToken=31bf3856ad364e35'.
</I>&gt;<i> &gt;&gt;   at (wrapper managed-to-native) System.Type:type_is_assignable_from
</I>&gt;<i> &gt;&gt; (System.Type,System.Type)
</I>&gt;<i> &gt;&gt;   at System.Type.IsAssignableFrom (System.Type c) [0x00096] in
</I>&gt;<i> &gt;&gt; /usr/local/src/mono-3.0.0/mcs/class/corlib/System/Type.cs:902
</I>&gt;<i> &gt;&gt;   at System.Web.Mvc.AreaRegistration.IsAreaRegistrationType
</I>&gt;<i> &gt;&gt; (System.Type type) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt;&gt;   at
</I>&gt;<i> System.Web.Mvc.TypeCacheUtil+&lt;&gt;c__DisplayClass1.&lt;FilterTypesInAssemblies&gt;b__0
</I>&gt;<i> &gt;&gt; (System.Type type) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt;&gt;   at
</I>&gt;<i> System.Linq.Enumerable+&lt;CreateWhereIterator&gt;c__Iterator35`1[System.Type].MoveNext
</I>&gt;<i> &gt;&gt; () [0x00059] in
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> /usr/local/src/mono-3.0.0/mcs/class/System.Core/System.Linq/Enumerable.cs:3030
</I>&gt;<i> &gt;&gt;   at System.Collections.Generic.List`1[System.Type].AddEnumerable
</I>&gt;<i> &gt;&gt; (IEnumerable`1 enumerable) [0x00013] in
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> /usr/local/src/mono-3.0.0/mcs/class/corlib/System.Collections.Generic/List.cs:134
</I>&gt;<i> &gt;&gt;   at System.Collections.Generic.List`1[System.Type]..ctor
</I>&gt;<i> &gt;&gt; (IEnumerable`1 collection) [0x0002f] in
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> /usr/local/src/mono-3.0.0/mcs/class/corlib/System.Collections.Generic/List.cs:69
</I>&gt;<i> &gt;&gt;   at System.Linq.Enumerable.ToList[Type] (IEnumerable`1 source)
</I>&gt;<i> &gt;&gt; [0x00006] in
</I>&gt;<i> /usr/local/src/mono-3.0.0/mcs/class/System.Core/System.Linq/Enumerable.cs:2867
</I>&gt;<i> &gt;&gt;   at System.Web.Mvc.TypeCacheUtil.GetFilteredTypesFromAssemblies
</I>&gt;<i> &gt;&gt; (System.String cacheName, System.Predicate`1 predicate, IBuildManager
</I>&gt;<i> &gt;&gt; buildManager) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt;&gt;   at System.Web.Mvc.AreaRegistration.RegisterAllAreas
</I>&gt;<i> &gt;&gt; (System.Web.Routing.RouteCollection routes, IBuildManager
</I>&gt;<i> &gt;&gt; buildManager, System.Object state) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt;&gt;   at System.Web.Mvc.AreaRegistration.RegisterAllAreas (System.Object
</I>&gt;<i> &gt;&gt; state) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt;&gt;   at System.Web.Mvc.AreaRegistration.RegisterAllAreas () [0x00000] in
</I>&gt;<i> &gt;&gt; &lt;filename unknown&gt;:0
</I>&gt;<i> &gt;&gt;   at Daniel15.WebApiTest.WebApiApplication.Application_Start ()
</I>&gt;<i> &gt;&gt; [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt;&gt;   at (wrapper managed-to-native)
</I>&gt;<i> &gt;&gt; System.Reflection.MonoMethod:InternalInvoke
</I>&gt;<i> &gt;&gt; (System.Reflection.MonoMethod,object,object[],System.Exception&amp;)
</I>&gt;<i> &gt;&gt;   at System.Reflection.MonoMethod.Invoke (System.Object obj,
</I>&gt;<i> &gt;&gt; BindingFlags invokeAttr, System.Reflection.Binder binder,
</I>&gt;<i> &gt;&gt; System.Object[] parameters, System.Globalization.CultureInfo culture)
</I>&gt;<i> &gt;&gt; [0x000d5] in
</I>&gt;<i> /usr/local/src/mono-3.0.0/mcs/class/corlib/System.Reflection/MonoMethod.cs:229
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Followed by this error:
</I>&gt;<i> &gt;&gt; System.TypeLoadException:
</I>&gt;<i> &gt;&gt; A type load exception has occurred.
</I>&gt;<i> &gt;&gt; Description: HTTP 500.Error processing request.
</I>&gt;<i> &gt;&gt; Details: Non-web exception. Exception origin (name of application or
</I>&gt;<i> &gt;&gt; object): Daniel15.WebApiTest.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Are there additional debug flags I can use to determine what's causing
</I>&gt;<i> &gt;&gt; this and why it's unable to load the type? I'm using Mono 3.0
</I>&gt;<i> &gt;&gt; (compiled from source) and xsp/fastcgi-mono-server4 (latest Git
</I>&gt;<i> &gt;&gt; version)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thanks in advance!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20121025/09b3663d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20121025/09b3663d/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039719.html">[Mono-dev] ASP.NET Web API on Mono 3.0 (Could not load type	'System.Web.Http.WebHost.HttpControllerHandler')
</A></li>
	<LI>Next message: <A HREF="039721.html">[Mono-dev] ASP.NET Web API on Mono 3.0 (Could not load type	'System.Web.Http.WebHost.HttpControllerHandler')
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39720">[ date ]</a>
              <a href="thread.html#39720">[ thread ]</a>
              <a href="subject.html#39720">[ subject ]</a>
              <a href="author.html#39720">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
