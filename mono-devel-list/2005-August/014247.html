<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mcs patch for default encoding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mcs%20patch%20for%20default%20encoding&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014242.html">
   <LINK REL="Next"  HREF="014251.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mcs patch for default encoding</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mcs%20patch%20for%20default%20encoding&In-Reply-To="
       TITLE="[Mono-dev] mcs patch for default encoding">kornelpal at hotmail.com
       </A><BR>
    <I>Tue Aug 23 14:35:28 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014242.html">[Mono-dev] mcs patch for default encoding
</A></li>
        <LI>Next message: <A HREF="014251.html">[Mono-dev] mcs patch for default encoding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14247">[ date ]</a>
              <a href="thread.html#14247">[ thread ]</a>
              <a href="subject.html#14247">[ subject ]</a>
              <a href="author.html#14247">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I support your latest patch. It does the same as csc.exe except UTF-8
detection using parsing the entire file. Using BOM regardless of /codepage
argument is a good decission and csc.exe does this as well.

I think /codepage:restore should be named /codepage:default and
/codepage:utf8 should be /codepage:utf-8. csc.exe does not support named
code pages but this may cause incompatiblity with older mcs version.

There is no need to use cp = Encoding.Default.CodePage;

I advise to use this:

switch (value)
{
 case &quot;utf8&quot;:
  encoding = Encoding.UTF8;
  break;
 case &quot;reset&quot;:
  encoding = Encoding.Default;
  break;
 default:
  try
  {
   encoding = Encoding.GetEncoding (int.Parse (value));
  }
  catch
  {
   Report.Error (2016, &quot;Code page `{0}' is invalid or not installed&quot;,
value);
  }
  break;
}
return true;

And there is no use to comment out lines in UTF8Encoding. Old version will
be available in SVN.

Note that none of these remarks affect behaviour they only affect the actual
implementation.

Korn&#233;l

----- Original Message -----
From: &quot;Atsushi Eno&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushi at ximian.com</A>&gt;
To: &quot;Korn&#233;l P&#225;l&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at hotmail.com</A>&gt;
Cc: &quot;mono-devel mailing list&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;; &quot;Marek
Safar&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">marek.safar at seznam.cz</A>&gt;
Sent: Tuesday, August 23, 2005 5:55 PM
Subject: Re: [Mono-dev] mcs patch for default encoding


&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I still personally don't like such almost-extraneous solution.
</I>&gt;<i> I actually made similar fix when I was trying to fix bug #75679
</I>&gt;<i> ( <A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=75679">http://bugzilla.ximian.com/show_bug.cgi?id=75679</A> ) but the code
</I>&gt;<i> ran pretty slower than as it is now.
</I>&gt;<i>
</I>&gt;<i> So, the matters to solve are:
</I>&gt;<i>
</I>&gt;<i> 1) Should we read entire stream ahead of compilation as
</I>&gt;<i>    Korn&#233;l suggested ?
</I>&gt;<i> 2) Can we apply my patch except for the part that is
</I>&gt;<i>    related default encoding part in driver.cs ?
</I>&gt;<i> 3) Can we apply driver.cs patch that is related to
</I>&gt;<i>    default encoding ?
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno
</I>&gt;<i>
</I>&gt;<i> Korn&#233;l P&#225;l wrote:
</I>&gt;&gt;<i> I've tried to compile a 2 GB size file using csc.exe: I got out of memory
</I>&gt;&gt;<i> error. The I reduced the size to 500 MB but I still got out of memory.
</I>&gt;&gt;<i> Finally I was able to compile a 200 MB file.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I got error CS1034: Compiler limit exceeded: Line cannot exceed 2046
</I>&gt;&gt;<i> characters
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So I added line breaks as well. And added // to the beginning of each
</I>&gt;&gt;<i> line
</I>&gt;&gt;<i> to add some non-whitespace chars just for fun and to test the compiler.:)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The first non-ASCII character is very near to the end of the file.
</I>&gt;&gt;<i> csc.exe
</I>&gt;&gt;<i> compiled it correctly. UTF-8 and ACP as well. D&#233;tectEncoding was compiled
</I>&gt;&gt;<i> correctly in both cases. I attached the test cases (about 200 MB each).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So I think csc.exe parses the whole file to detect UTF-8 and has poor
</I>&gt;&gt;<i> memory
</I>&gt;&gt;<i> management in addition.:) Maybe it chaches the source file using it's own
</I>&gt;&gt;<i> allocated memory.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Korn&#233;l
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014242.html">[Mono-dev] mcs patch for default encoding
</A></li>
	<LI>Next message: <A HREF="014251.html">[Mono-dev] mcs patch for default encoding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14247">[ date ]</a>
              <a href="thread.html#14247">[ thread ]</a>
              <a href="subject.html#14247">[ subject ]</a>
              <a href="author.html#14247">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
