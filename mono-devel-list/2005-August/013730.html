<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20%5BPATCH%5D%20Race%20condition%20when%20restarting%0A%09threads&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013648.html">
   <LINK REL="Next"  HREF="013649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads</H1>
    <B>Boehm, Hans</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20%5BPATCH%5D%20Race%20condition%20when%20restarting%0A%09threads&In-Reply-To="
       TITLE="[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads">hans.boehm at hp.com
       </A><BR>
    <I>Mon Aug  1 18:09:17 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013648.html">[Mono-devel-list] calling indexer from aspx page written in VB
</A></li>
        <LI>Next message: <A HREF="013649.html">[Mono-devel-list] Mono Cryptography UnmanagedWrapper Wiki setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13730">[ date ]</a>
              <a href="thread.html#13730">[ thread ]</a>
              <a href="subject.html#13730">[ subject ]</a>
              <a href="author.html#13730">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry about the long delay.

I don't quite understand the problem here.  If GC_stop_count has
just been incremented, then I'm about to send another suspend
signal to the thread, and it will have to stop again before
we think the world is stopped.  

Can you be a bit more specific about the race here?

Thanks.

Hans

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Ben Maurer [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bmaurer at ximian.com</A>] 
</I>&gt;<i> Sent: Tuesday, July 12, 2005 11:29 PM
</I>&gt;<i> To: Boehm, Hans
</I>&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gc at napali.hpl.hp.com</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: RE: [Gc] [PATCH] Race condition when restarting threads
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, 2005-07-12 at 11:42 -0700, Boehm, Hans wrote:
</I>&gt;<i> &gt; &gt; Your patch had the fields set as volatile, so shouldn't the
</I>&gt;<i> &gt; &gt; compiler ensure that the cpu does not reorder the stores?
</I>&gt;<i> &gt; We had a long discussion of that on the C++ memory model list. The 
</I>&gt;<i> &gt; answer is architecture dependent.  Volatile will generally prevent 
</I>&gt;<i> &gt; compiler reordering.  It usually introduces the necessary hardware 
</I>&gt;<i> &gt; barriers on Itanium, but not, for example, on PowerPC.
</I>&gt;<i> 
</I>&gt;<i> I think your version has a race if this is the case:
</I>&gt;<i> 
</I>&gt;<i> &gt; +    sigsuspend(&amp;suspend_handler_mask);        /* Wait for signal */
</I>&gt;<i> &gt; +    while (GC_world_is_stopped &amp;&amp; GC_stop_count == my_stop_count) {
</I>&gt;<i> 
</I>&gt;<i> Imagine that this thread gets a spurious signal. The 
</I>&gt;<i> GC_stop_count++ statement has already taken effect, but the 
</I>&gt;<i> GC_world_is_stopped = TRUE has not, the thread would bypass 
</I>&gt;<i> the wait, causing the world not to be stopped.
</I>&gt;<i> 
</I>&gt;<i> In fact, how do we know that my_stop_count is correct?
</I>&gt;<i> 
</I>&gt;<i> When I put this in the mono tree, I'd really have something 
</I>&gt;<i> with barriers in it and use the version that I suggested. 
</I>&gt;<i> Without the barriers, am a bit worried about the correctness 
</I>&gt;<i> (especially since the issues happen on platforms I am not 
</I>&gt;<i> testing with).
</I>&gt;<i> 
</I>&gt;<i> -- Ben
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013648.html">[Mono-devel-list] calling indexer from aspx page written in VB
</A></li>
	<LI>Next message: <A HREF="013649.html">[Mono-devel-list] Mono Cryptography UnmanagedWrapper Wiki setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13730">[ date ]</a>
              <a href="thread.html#13730">[ thread ]</a>
              <a href="subject.html#13730">[ subject ]</a>
              <a href="author.html#13730">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
