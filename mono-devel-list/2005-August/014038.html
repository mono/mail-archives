<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] ThreadAbortException during compilation path
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20ThreadAbortException%20during%20compilation%20path&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014008.html">
   <LINK REL="Next"  HREF="014205.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] ThreadAbortException during compilation path</H1>
    <B>Vorobiev Maksim</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20ThreadAbortException%20during%20compilation%20path&In-Reply-To="
       TITLE="[Mono-dev] ThreadAbortException during compilation path">MVorobiev at croc.ru
       </A><BR>
    <I>Tue Aug 16 12:04:17 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014008.html">[Mono-dev] RE: [Mono-patches] r48374 - in	trunk/mcs/class/System.Drawing: .System.Drawing Test/System.Drawing
</A></li>
        <LI>Next message: <A HREF="014205.html">[Mono-dev] ThreadAbortException during compilation path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14038">[ date ]</a>
              <a href="thread.html#14038">[ thread ]</a>
              <a href="subject.html#14038">[ subject ]</a>
              <a href="author.html#14038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good day.
 
We have encounted an issue with CSharpCodeCompiller class. Then there is
a termination of thread, that startups compilation (and waits for
ExitCode), it gots ThreadAbortException and goes to finally block. But
the process of mcs is still running! So, it should not check for
ExitCode. In case then mcs still running, we got
InvalidOperationException, that hides ThreadAbortException.
This is the current code:
 
   try {
    mcs.Start();
    // If there are a few kB in stdout, we might lock
    mcs_output=mcs.StandardError.ReadToEnd();
    mcs.StandardOutput.ReadToEnd ();
    mcs.WaitForExit();
   } finally {
    results.NativeCompilerReturnValue = mcs.ExitCode; // &lt;--
!!!!!!!!!!This line
    mcs.Close();
   } 
 
May be it's better to change for this?
 
   try {
    mcs.Start();
    // If there are a few kB in stdout, we might lock
    mcs_output=mcs.StandardError.ReadToEnd();
    mcs.StandardOutput.ReadToEnd ();
    mcs.WaitForExit();
    results.NativeCompilerReturnValue = mcs.ExitCode; // &lt;-- !!!!!! Goes
from finally to try block
   } finally {
    mcs.Close();
   } 
 
The patch is attached. If there is no disagreement, apply this patch to
CVS.

Thank you.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: CSharpCodeCompiler.diff
Type: application/octet-stream
Size: 409 bytes
Desc: CSharpCodeCompiler.diff
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050816/95b32755/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050816/95b32755/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014008.html">[Mono-dev] RE: [Mono-patches] r48374 - in	trunk/mcs/class/System.Drawing: .System.Drawing Test/System.Drawing
</A></li>
	<LI>Next message: <A HREF="014205.html">[Mono-dev] ThreadAbortException during compilation path
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14038">[ date ]</a>
              <a href="thread.html#14038">[ thread ]</a>
              <a href="subject.html#14038">[ subject ]</a>
              <a href="author.html#14038">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
