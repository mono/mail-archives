<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20%5BPATCH%5D%20Race%20condition%20when%20restarting%0A%09threads&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013651.html">
   <LINK REL="Next"  HREF="013652.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads</H1>
    <B>Boehm, Hans</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20%5BPATCH%5D%20Race%20condition%20when%20restarting%0A%09threads&In-Reply-To="
       TITLE="[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads">hans.boehm at hp.com
       </A><BR>
    <I>Mon Aug  1 19:41:55 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013651.html">[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
</A></li>
        <LI>Next message: <A HREF="013652.html">[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13731">[ date ]</a>
              <a href="thread.html#13731">[ thread ]</a>
              <a href="subject.html#13731">[ subject ]</a>
              <a href="author.html#13731">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I still don't think I understand the scenario.

The original thread in (1) was suspended from the last GC?

My assumption is that if thread A sends a signal to thread B, then
Bs handler sees all memory operations performed by A before the
signal was sent.  I don't think that's officially guaranteed, but I
would be amazed if it weren't true everywhere.

Thus in step (2) if the thread wakes up after the suspend signal has
been
sent, it must see both the updates to GC_stop_count and
GC_world_stopped.
(And it was suspended from the preceding round, the new suspend signal
should still be pending anyway, I think.)
If it wakes up before, it will get another signal telling it to stop.
What am I missing?

Hans

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Ben Maurer [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bmaurer at ximian.com</A>] 
</I>&gt;<i> Sent: Monday, August 01, 2005 4:24 PM
</I>&gt;<i> To: Boehm, Hans
</I>&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gc at napali.hpl.hp.com</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: RE: [Gc] [PATCH] Race condition when restarting threads
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Mon, 2005-08-01 at 15:09 -0700, Boehm, Hans wrote:
</I>&gt;<i> &gt; I don't quite understand the problem here.  If 
</I>&gt;<i> GC_stop_count has just 
</I>&gt;<i> &gt; been incremented, then I'm about to send another suspend 
</I>&gt;<i> signal to the 
</I>&gt;<i> &gt; thread, and it will have to stop again before we think the world is 
</I>&gt;<i> &gt; stopped.
</I>&gt;<i> 
</I>&gt;<i> My situation is:
</I>&gt;<i> 
</I>&gt;<i> 1) the thread suspending other threads has done both 
</I>&gt;<i> GC_stop_count ++ and GC_world_is_stopped = TRUE
</I>&gt;<i> 2) A suspended thread wakes up from sigsuspend (on a random signal)
</I>&gt;<i> 3) By the time it wakes up, the GC_stop_count has taken 
</I>&gt;<i> effect (as seen by this thread), but GC_world_is_stopped has not
</I>&gt;<i> 4) The thread thus thinks that the world is being started up 
</I>&gt;<i> again and continues.
</I>&gt;<i> 
</I>&gt;<i> -- Ben
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013651.html">[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
</A></li>
	<LI>Next message: <A HREF="013652.html">[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13731">[ date ]</a>
              <a href="thread.html#13731">[ thread ]</a>
              <a href="subject.html#13731">[ subject ]</a>
              <a href="author.html#13731">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
