<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] GC segfault on ARM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20GC%20segfault%20on%20ARM&In-Reply-To=20050820134248.GG4400%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014122.html">
   <LINK REL="Next"  HREF="014181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] GC segfault on ARM</H1>
    <B>Tomi Valkeinen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20GC%20segfault%20on%20ARM&In-Reply-To=20050820134248.GG4400%40debian.org"
       TITLE="[Mono-dev] GC segfault on ARM">tomba at bat.org
       </A><BR>
    <I>Mon Aug 22 02:57:01 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014122.html">[Mono-dev] GC segfault on ARM
</A></li>
        <LI>Next message: <A HREF="014181.html">[Mono-dev] GC segfault on ARM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14162">[ date ]</a>
              <a href="thread.html#14162">[ thread ]</a>
              <a href="subject.html#14162">[ subject ]</a>
              <a href="author.html#14162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 20 Aug 2005, Paolo Molaro wrote:
&gt;<i> On 08/18/05 Tomi Valkeinen wrote:
</I>&gt;&gt;<i> Oh, and if you are using an ARM11 based board, you may also want to fix
</I>&gt;&gt;<i> the swp-bug (<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=75114">http://bugzilla.ximian.com/show_bug.cgi?id=75114</A>)
</I>&gt;<i>
</I>&gt;<i> Did you test that change?
</I>&gt;<i> Care to research with the libc guys why they wrote it that way and if
</I>&gt;<i> your change is really the right fix?
</I>
Hi,

Yes, I did test it. All compilers seem to produce correct code after the
change. The interesting part with the bug is that even if the produced
code is against ARM reference manual, it works with all the ARM9
processors I have tested, but fails with ARM11.

The code in recent libc is actually a bit different. This is from
glibc-2.3.5:

   __asm__ __volatile__(&quot;swp %0, %1, [%2]&quot;
                        : &quot;=r&quot;(ret)
                        : &quot;0&quot;(1), &quot;r&quot;(spinlock));

And this is from mono's libgc:

           __asm__ __volatile__(&quot;swp %0, %1, [%2]&quot;
                              : &quot;=r&quot;(oldval)
                              : &quot;r&quot;(1), &quot;r&quot;(addr)
                              : &quot;memory&quot;);

The version in glibc produces correct code. The fix that I proposed was 
suggested in Codesourcery's forums, but I guess the libc version is just 
as fine.

  Tomi Valkeinen


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014122.html">[Mono-dev] GC segfault on ARM
</A></li>
	<LI>Next message: <A HREF="014181.html">[Mono-dev] GC segfault on ARM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14162">[ date ]</a>
              <a href="thread.html#14162">[ thread ]</a>
              <a href="subject.html#14162">[ subject ]</a>
              <a href="author.html#14162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
