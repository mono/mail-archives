<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] malloc error executing OBS-built mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20malloc%20error%20executing%20OBS-built%20mono&In-Reply-To=%3CCANqeOFouN6mN_d4qJphV--r7P-6BkA%3DyFxcXcNFtBCF-RDBvrQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043343.html">
   <LINK REL="Next"  HREF="043345.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] malloc error executing OBS-built mono</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20malloc%20error%20executing%20OBS-built%20mono&In-Reply-To=%3CCANqeOFouN6mN_d4qJphV--r7P-6BkA%3DyFxcXcNFtBCF-RDBvrQ%40mail.gmail.com%3E"
       TITLE="[Mono-dev] malloc error executing OBS-built mono">miguel at xamarin.com
       </A><BR>
    <I>Fri Oct 23 14:31:37 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="043343.html">[Mono-dev] malloc error executing OBS-built mono
</A></li>
        <LI>Next message: <A HREF="043345.html">[Mono-dev] Link errors with mono-llvm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43344">[ date ]</a>
              <a href="thread.html#43344">[ thread ]</a>
              <a href="subject.html#43344">[ subject ]</a>
              <a href="author.html#43344">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well, the good news is that this should be trivial to reproduce under gdb,
are you able to do that?

The valgrind command is not reporting line numbers, could you perhaps
compile with debug symbols, or skip the part where you strip those symbols
out?

As for the bug, I can not figure what it is, the issue is an allocation of
a buffer that is later passed to strlen, and the function at that revision
does not have any buffers allocated from dllmap_start that are later passed
to strlen.

On Fri, Oct 23, 2015 at 3:28 AM, Miguel Gonz&#225;lez &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mgonzalez at codicesoftware.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I&#8217;ve run mono inside valgrind. I had already done that when I first bumped
</I>&gt;<i> on this issue, but I didn&#8217;t save the results :-(  This is the summarized
</I>&gt;<i> output:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> $ valgrind -v --track-origins=yes --leak-check=full
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono
</I>&gt;<i> /opt/plasticscm5/mono/lib/mono/4.5/gacutil.exe &#8211;l
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ==4421== Memcheck, a memory error detector
</I>&gt;<i>
</I>&gt;<i> ==4421== Copyright (C) 2002-2012, and GNU GPL'd, by Julian Seward et al.
</I>&gt;<i>
</I>&gt;<i> ==4421== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info
</I>&gt;<i>
</I>&gt;<i> ==4421== Command: /opt/plasticscm5/mono/bin/mono
</I>&gt;<i> /opt/plasticscm5/mono/lib/mono/4.5/gacutil.exe -l
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> --4421-- Valgrind options:
</I>&gt;<i>
</I>&gt;<i> --4421--    -v
</I>&gt;<i>
</I>&gt;<i> --4421--    --track-origins=yes
</I>&gt;<i>
</I>&gt;<i> --4421--    --leak-check=full
</I>&gt;<i>
</I>&gt;<i> --4421-- Contents of /proc/version:
</I>&gt;<i>
</I>&gt;<i> --4421--   Linux version 3.4.33-2.24-desktop (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">geeko at buildhost</A>) (gcc
</I>&gt;<i> version 4.7.1 20120723 [gcc-4_7-branch revision 189773] (SUSE Linux) ) #1
</I>&gt;<i> SMP PREEMPT Tue Feb 26 03:34:33 UTC 2013 (5f00a32)
</I>&gt;<i>
</I>&gt;<i> --4421-- Arch and hwcaps: X86, x86-sse1-sse2
</I>&gt;<i>
</I>&gt;<i> --4421-- Page sizes: currently 4096, max supported 4096
</I>&gt;<i>
</I>&gt;<i> --4421-- Valgrind library directory: /usr/lib/valgrind
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> ### ... more command output (see attached file) ... ###
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> ==4421== HEAP SUMMARY:
</I>&gt;<i>
</I>&gt;<i> ==4421==     in use at exit: 19,546 bytes in 643 blocks
</I>&gt;<i>
</I>&gt;<i> ==4421==   total heap usage: 81,884 allocs, 81,241 frees, 36,260,501 bytes
</I>&gt;<i> allocated
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> ==4421== Searching for pointers to 643 not-freed blocks
</I>&gt;<i>
</I>&gt;<i> ==4421== Checked 23,326,752 bytes
</I>&gt;<i>
</I>&gt;<i> ==4421== ==4421== LEAK SUMMARY:
</I>&gt;<i>
</I>&gt;<i> ==4421==    definitely lost: 5,175 bytes in 326 blocks
</I>&gt;<i>
</I>&gt;<i> ==4421==    indirectly lost: 64 bytes in 8 blocks
</I>&gt;<i>
</I>&gt;<i> ==4421==      possibly lost: 288 bytes in 2 blocks
</I>&gt;<i>
</I>&gt;<i> ==4421==    still reachable: 14,019 bytes in 307 blocks
</I>&gt;<i>
</I>&gt;<i> ==4421==         suppressed: 0 bytes in 0 blocks
</I>&gt;<i>
</I>&gt;<i> ==4421== Reachable blocks (those to which a pointer was found) are not
</I>&gt;<i> shown.
</I>&gt;<i>
</I>&gt;<i> ==4421== To see them, rerun with: --leak-check=full --show-reachable=yes
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> ### ... Detailed info about leaked heap blocks (see attached file) ... ###
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> ==4421== ERROR SUMMARY: 130 errors from 130 contexts (suppressed: 0 from 0)
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> ==4421== 1 errors in context 1 of 130:
</I>&gt;<i>
</I>&gt;<i> ==4421== Conditional jump or move depends on uninitialised value(s)
</I>&gt;<i>
</I>&gt;<i> ==4421==    at 0x402C2D9: strlen (in
</I>&gt;<i> /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B749E: dllmap_start (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x8283F41: monoeg_g_markup_parse_context_parse (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B6E37: mono_config_parse_xml_with_context (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B6F6C: mono_config_parse_file_with_context (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B6FD6: mono_config_parse_file (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B808B: mono_config_parse (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x80C1448: mono_main (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x8065E51: main (in /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==  Uninitialised value was created by a heap allocation
</I>&gt;<i>
</I>&gt;<i> ==4421==    at 0x402B9FD: malloc (in
</I>&gt;<i> /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x827C84F: monoeg_malloc (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B7476: dllmap_start (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x8283F41: monoeg_g_markup_parse_context_parse (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B6E37: mono_config_parse_xml_with_context (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B6F6C: mono_config_parse_file_with_context (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B6FD6: mono_config_parse_file (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x81B808B: mono_config_parse (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x80C1448: mono_main (in
</I>&gt;<i> /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==    by 0x8065E51: main (in /opt/plasticscm5/mono/bin/mono-sgen)
</I>&gt;<i>
</I>&gt;<i> ==4421==
</I>&gt;<i>
</I>&gt;<i> ==4421== ERROR SUMMARY: 130 errors from 130 contexts (suppressed: 0 from 0)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I&#8217;ve attached the full report as a text file to this mail.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Miguel
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Miguel de Icaza [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>]
</I>&gt;<i> *Sent:* 22 October 2015 18:09
</I>&gt;<i>
</I>&gt;<i> *To:* Miguel Gonz&#225;lez &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mgonzalez at codicesoftware.com</A>&gt;
</I>&gt;<i> *Cc:* <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> *Subject:* Re: [Mono-dev] malloc error executing OBS-built mono
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well, the great news is that this happens without involving the JIT or GC
</I>&gt;<i> - it happens just at startup, so this is a plain-old C bug.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Your best bet is now to run this with Valgrind and see what it tells you.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Oct 22, 2015 at 12:04 PM, Miguel Gonz&#225;lez &lt;
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mgonzalez at codicesoftware.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> I executed a sample command (gacutils.exe -l) under gdb to see the trace
</I>&gt;<i> at the time of the crash.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is the backtrace as returned by gdb:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Program received signal SIGABRT, Aborted.
</I>&gt;<i>
</I>&gt;<i> 0xf7e1b245 in raise () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #0  0xf7e1b245 in raise () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #1  0xf7e1cac3 in abort () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #2  0xf7e635cb in malloc_printerr () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #3  0xf7e63aec in top_check () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #4  0xf7e65b13 in malloc_check () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #5  0xf7e66c45 in malloc () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #6  0xf7e6b071 in strdup () from /lib/libc.so.6
</I>&gt;<i>
</I>&gt;<i> #7  0x0827d54c in monoeg_g_strsplit ()
</I>&gt;<i>
</I>&gt;<i> #8  0x081b70a5 in arch_matches ()
</I>&gt;<i>
</I>&gt;<i> #9  0x081b70fa in arch_matches ()
</I>&gt;<i>
</I>&gt;<i> #10 0x081b7770 in dllmap_start ()
</I>&gt;<i>
</I>&gt;<i> #11 0x08283f42 in monoeg_g_markup_parse_context_parse ()
</I>&gt;<i>
</I>&gt;<i> #12 0x081b6e38 in mono_config_parse_xml_with_context ()
</I>&gt;<i>
</I>&gt;<i> #13 0x081b6f6d in mono_config_parse_file_with_context ()
</I>&gt;<i>
</I>&gt;<i> #14 0x081b6fd7 in mono_config_parse_file ()
</I>&gt;<i>
</I>&gt;<i> #15 0x081b808c in mono_config_parse ()
</I>&gt;<i>
</I>&gt;<i> #16 0x080c1449 in mono_main ()
</I>&gt;<i>
</I>&gt;<i> #17 0x08065e52 in main ()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It seems to be failing when the /etc/mono/config file is loaded. This is
</I>&gt;<i> the config file contents. The zlib line has been manually added to the code
</I>&gt;<i> retrieved from GitHub.
</I>&gt;<i>
</I>&gt;<i> &lt;configuration&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;i:cygwin1.dll&quot; target=&quot;libc.so.6&quot; os=&quot;!windows&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libc&quot; target=&quot;libc.so.6&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;intl&quot; target=&quot;libc.so.6&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;intl&quot; name=&quot;bind_textdomain_codeset&quot; target=&quot;libc.so.6&quot;
</I>&gt;<i> os=&quot;solaris&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libintl&quot; name=&quot;bind_textdomain_codeset&quot; target=&quot;libc.so.6&quot;
</I>&gt;<i> os=&quot;solaris&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libintl&quot; target=&quot;libc.so.6&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;i:libxslt.dll&quot; target=&quot;libxslt.so&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;i:odbc32.dll&quot; target=&quot;libodbc.so&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;i:odbc32.dll&quot; target=&quot;libiodbc.dylib&quot; os=&quot;osx&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;oci&quot; target=&quot;libclntsh.so&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;db2cli&quot; target=&quot;libdb2_36.so&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;MonoPosixHelper&quot;
</I>&gt;<i> target=&quot;$mono_libdir/libMonoPosixHelper.so&quot; os=&quot;!windows&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;i:msvcrt&quot; target=&quot;libc.so.6&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;i:msvcrt.dll&quot; target=&quot;libc.so.6&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;sqlite&quot; target=&quot;libsqlite.so.0&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;sqlite3&quot; target=&quot;libsqlite3.so.0&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libX11&quot; target=&quot;libX11.so.6&quot; os=&quot;!windows&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libgdk-x11-2.0&quot; target=&quot;libgdk-x11-2.0.so.0&quot;
</I>&gt;<i> os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libgtk-x11-2.0&quot; target=&quot;libgtk-x11-2.0.so.0&quot;
</I>&gt;<i> os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libXinerama&quot; target=&quot;libXinerama.so.1&quot; os=&quot;!windows&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libcairo-2.dll&quot; target=&quot;libcairo.so.2&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libcairo-2.dll&quot; target=&quot;libcairo.2.dylib&quot; os=&quot;osx&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libcups&quot; target=&quot;libcups.so.2&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;libcups&quot; target=&quot;libcups.dylib&quot; os=&quot;osx&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;i:kernel32.dll&quot;&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;dllentry dll=&quot;__Internal&quot; name=&quot;CopyMemory&quot;
</I>&gt;<i> target=&quot;mono_win32_compat_CopyMemory&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;dllentry dll=&quot;__Internal&quot; name=&quot;FillMemory&quot;
</I>&gt;<i> target=&quot;mono_win32_compat_FillMemory&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;dllentry dll=&quot;__Internal&quot; name=&quot;MoveMemory&quot;
</I>&gt;<i> target=&quot;mono_win32_compat_MoveMemory&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;dllentry dll=&quot;__Internal&quot; name=&quot;ZeroMemory&quot;
</I>&gt;<i> target=&quot;mono_win32_compat_ZeroMemory&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;/dllmap&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;gdiplus&quot; target=&quot;libgdiplus.so&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;gdiplus.dll&quot; target=&quot;libgdiplus.so&quot;  os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;gdi32&quot; target=&quot;libgdiplus.so&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;gdi32.dll&quot; target=&quot;libgdiplus.so&quot; os=&quot;!windows&quot;/&gt;
</I>&gt;<i>
</I>&gt;<i>    &lt;dllmap dll=&quot;z&quot; target=&quot;libz.so.1&quot; os=&quot;!windows&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i> &lt;/configuration&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Anyway, as I mentioned, we&#8217;re putting the openSUSE 12.3 build aside. We&#8217;ve
</I>&gt;<i> noticed that openSUSE 12.3, 13.1 and 13.2 can work with our openSUSE 12.2
</I>&gt;<i> repository.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Miguel
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] *On Behalf Of *Miguel Gonz&#225;lez
</I>&gt;<i> *Sent:* 22 October 2015 10:49
</I>&gt;<i> *To:* Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *Cc:* <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> *Subject:* Re: [Mono-dev] malloc error executing OBS-built mono
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi Miguel,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for the update :-) I had also an e-mail from Zoltan Varga yesterday
</I>&gt;<i> telling me that the change had been applied. I updated my code accordingly
</I>&gt;<i> to see if that could be the fix for my issue, too&#8230; But it didn&#8217;t :-(
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I&#8217;ll try using gdb as you suggested. I hadn&#8217;t considered it before since
</I>&gt;<i> this crash only happens inside the automated build of the OBS worker
</I>&gt;<i> virtual machine and I&#8217;ve not been able to reproduce in any other
</I>&gt;<i> environment. However, any additional info is always appreciated! There are
</I>&gt;<i> also chances of ditching this build and relying on other distros to build
</I>&gt;<i> our packages, since our OpenSUSE packages seem to be highly compatible
</I>&gt;<i> between versions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Miguel
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Miguel de Icaza [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>&gt;]
</I>&gt;<i> *Sent:* 21 October 2015 20:44
</I>&gt;<i> *To:* Miguel Gonz&#225;lez &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mgonzalez at codicesoftware.com</A>&gt;
</I>&gt;<i> *Cc:* <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> *Subject:* Re: [Mono-dev] malloc error executing OBS-built mono
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello Miguel,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I also had to apply this change in order to avoid an unallowed warning
</I>&gt;<i> message:
</I>&gt;<i>
</I>&gt;<i> I: Statement might be overflowing a buffer in strncat. Common mistake:
</I>&gt;<i>
</I>&gt;<i>    BAD: strncat(buffer,charptr,sizeof(buffer)) is wrong, it takes the
</I>&gt;<i>
</I>&gt;<i>    left over size as 3rd argument
</I>&gt;<i>
</I>&gt;<i>    GOOD: strncat(buffer,charptr,sizeof(buffer)-strlen(buffer)-1)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We replaced that code with the glib string operations just yesterday:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 042ddd504c09977682bb48010c5642390826d1da
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But thanks for sharing.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> At this point I&#8217;m able to build mono RPM packages and they&#8217;re working as I
</I>&gt;<i> install them using a test OpenSUSE 12.3 virtual machine. However, when the
</I>&gt;<i> GTK# builds are started &#8211;which use the mono packages as build requirement&#8211;,
</I>&gt;<i> the worker is unable to run the mono executable: apparently, malloc is
</I>&gt;<i> corrupting the heap or something. This is a sample execution as extracted
</I>&gt;<i> from the OBS build logs:
</I>&gt;<i>
</I>&gt;<i> [  101s] + /opt/plasticscm5/mono/bin/mono /opt/plasticscm5/mono/lib/mono/4.5/gacutil.exe -l
</I>&gt;<i>
</I>&gt;<i> [  101s] *** Error in `/opt/plasticscm5/mono/bin/mono': malloc: top chunk is corrupt: 0x08ab9230 ***
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What you want to do at this point in time is to run the process under gdb,
</I>&gt;<i> as this will show where malloc detected the error, and then you should get
</I>&gt;<i> both the unmanaged stack trace, and if possible the managed one (with the
</I>&gt;<i> mono_stack gdb macro)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Miguel.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20151023/8ca49f2c/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20151023/8ca49f2c/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043343.html">[Mono-dev] malloc error executing OBS-built mono
</A></li>
	<LI>Next message: <A HREF="043345.html">[Mono-dev] Link errors with mono-llvm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43344">[ date ]</a>
              <a href="thread.html#43344">[ thread ]</a>
              <a href="subject.html#43344">[ subject ]</a>
              <a href="author.html#43344">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
