<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] malloc error executing OBS-built mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20malloc%20error%20executing%20OBS-built%20mono&In-Reply-To=%3CDBXPR07MB33337DAB64725E014AE707ADE270%40DBXPR07MB333.eurprd07.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043339.html">
   <LINK REL="Next"  HREF="043341.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] malloc error executing OBS-built mono</H1>
    <B>Miguel Gonz&#225;lez</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20malloc%20error%20executing%20OBS-built%20mono&In-Reply-To=%3CDBXPR07MB33337DAB64725E014AE707ADE270%40DBXPR07MB333.eurprd07.prod.outlook.com%3E"
       TITLE="[Mono-dev] malloc error executing OBS-built mono">mgonzalez at codicesoftware.com
       </A><BR>
    <I>Thu Oct 22 08:49:03 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="043339.html">[Mono-dev] malloc error executing OBS-built mono
</A></li>
        <LI>Next message: <A HREF="043341.html">[Mono-dev] malloc error executing OBS-built mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43340">[ date ]</a>
              <a href="thread.html#43340">[ thread ]</a>
              <a href="subject.html#43340">[ subject ]</a>
              <a href="author.html#43340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Miguel,

Thanks for the update :-) I had also an e-mail from Zoltan Varga yesterday telling me that the change had been applied. I updated my code accordingly to see if that could be the fix for my issue, too&#8230; But it didn&#8217;t :-(

I&#8217;ll try using gdb as you suggested. I hadn&#8217;t considered it before since this crash only happens inside the automated build of the OBS worker virtual machine and I&#8217;ve not been able to reproduce in any other environment. However, any additional info is always appreciated! There are also chances of ditching this build and relying on other distros to build our packages, since our OpenSUSE packages seem to be highly compatible between versions.

Thank you,

Miguel

From: Miguel de Icaza [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at xamarin.com</A>]
Sent: 21 October 2015 20:44
To: Miguel Gonz&#225;lez &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mgonzalez at codicesoftware.com</A>&gt;
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-dev] malloc error executing OBS-built mono

Hello Miguel,

I also had to apply this change in order to avoid an unallowed warning message:
I: Statement might be overflowing a buffer in strncat. Common mistake:
   BAD: strncat(buffer,charptr,sizeof(buffer)) is wrong, it takes the
   left over size as 3rd argument
   GOOD: strncat(buffer,charptr,sizeof(buffer)-strlen(buffer)-1)

We replaced that code with the glib string operations just yesterday:

042ddd504c09977682bb48010c5642390826d1da

But thanks for sharing.

At this point I&#8217;m able to build mono RPM packages and they&#8217;re working as I install them using a test OpenSUSE 12.3 virtual machine. However, when the GTK# builds are started &#8211;which use the mono packages as build requirement&#8211;, the worker is unable to run the mono executable: apparently, malloc is corrupting the heap or something. This is a sample execution as extracted from the OBS build logs:

[  101s] + /opt/plasticscm5/mono/bin/mono /opt/plasticscm5/mono/lib/mono/4.5/gacutil.exe -l

[  101s] *** Error in `/opt/plasticscm5/mono/bin/mono': malloc: top chunk is corrupt: 0x08ab9230 ***

What you want to do at this point in time is to run the process under gdb, as this will show where malloc detected the error, and then you should get both the unmanaged stack trace, and if possible the managed one (with the mono_stack gdb macro)

Miguel.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20151022/5c7f8298/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20151022/5c7f8298/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043339.html">[Mono-dev] malloc error executing OBS-built mono
</A></li>
	<LI>Next message: <A HREF="043341.html">[Mono-dev] malloc error executing OBS-built mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43340">[ date ]</a>
              <a href="thread.html#43340">[ thread ]</a>
              <a href="subject.html#43340">[ subject ]</a>
              <a href="author.html#43340">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
