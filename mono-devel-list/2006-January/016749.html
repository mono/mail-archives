<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Problem with sqlite in mono 1.1.13
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Problem%20with%20sqlite%20in%20mono%201.1.13&In-Reply-To=1137971037.3943.7.camel%40linux.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016748.html">
   <LINK REL="Next"  HREF="016750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Problem with sqlite in mono 1.1.13</H1>
    <B>Aaron Bockover</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Problem%20with%20sqlite%20in%20mono%201.1.13&In-Reply-To=1137971037.3943.7.camel%40linux.site"
       TITLE="[Mono-dev] Problem with sqlite in mono 1.1.13">abockover at novell.com
       </A><BR>
    <I>Sun Jan 22 18:18:02 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="016748.html">[Mono-dev] Problem with sqlite in mono 1.1.13
</A></li>
        <LI>Next message: <A HREF="016750.html">[Mono-dev] Problem with sqlite in mono 1.1.13
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16749">[ date ]</a>
              <a href="thread.html#16749">[ thread ]</a>
              <a href="subject.html#16749">[ subject ]</a>
              <a href="author.html#16749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> ...A local fix for you is to use the NUMBER column type instead of
</I>&gt;<i> INTEGER...
</I>
I should have said &quot;NUMERIC&quot; not &quot;NUMBER&quot; ... however, there are some
things to note, from <A HREF="http://sqlite.org/datatype3.html">http://sqlite.org/datatype3.html</A> :

&quot;Each value stored in an SQLite database (or manipulated by the database
engine) has one of the following storage classes:
        ...
	* INTEGER. The value is a signed integer, stored in 1, 2, 3, 4, 6, or 8
bytes depending on the magnitude of the value.&quot;

Unless some detection is done in the bindings to see if the value in a
row for an INTEGER column can fit inside of an Int32, the value should
always be returned as an Int64, otherwise we risk backwards
incompatibility, and do not conform to the sqlite3 spec, which clearly
states a number in an INTEGER column can occupy up to 8 bytes.

Cheers,
Aaron



On Sun, 2006-01-22 at 18:03 -0500, Aaron Bockover wrote:
&gt;<i> Wow. I'm not sure why this change was made, but in
</I>&gt;<i> Mono.Data.SqliteClient/SqliteDataReader.cs, this happens now for
</I>&gt;<i> columns
</I>&gt;<i> declared as INT/INTEGER:
</I>&gt;<i> 
</I>&gt;<i> ...
</I>&gt;<i> data_row[i] = (int)Sqlite.sqlite3_column_int64 (pVm, i);
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;<i> An explicit cast from an Int64 to an Int32. So that change completely
</I>&gt;<i> breaks compatibility with older databases.
</I>&gt;<i> 
</I>&gt;<i> A local fix for you is to use the NUMBER column type instead of
</I>&gt;<i> INTEGER
</I>&gt;<i> if you need to store an Int64, though I do not agree with this change,
</I>&gt;<i> and I bet this breaks my application too:
</I>&gt;<i> 
</I>&gt;<i> 2006-01-02  Joshua Tauberer  &lt;xxxxx&gt;
</I>&gt;<i> ...
</I>&gt;<i>     * SqliteDataReader.cs:
</I>&gt;<i>         * Use object[] in place of ArrayList for each row.
</I>&gt;<i>         * For Sqlite3, which remembers whether a value was
</I>&gt;<i>           an integer, text, real, or blob, actually return
</I>&gt;<i>           longs, strings, doubles, and byte[]s.
</I>&gt;<i>         * GetDataTypeName() works where possible (Sqlite3).
</I>&gt;<i>         * INT/INTEGER columns are now returned as ints,
</I>&gt;<i>           rather than longs, for Sqlite3.  Similarly for
</I>&gt;<i>           DATE and DATETIME columns, now returning DateTimes.
</I>&gt;<i> 
</I>&gt;<i> I'll do some more probing of this issue.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Aaron Bockover
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Sun, 2006-01-22 at 22:49 +0100, Fredrik Nilsson wrote:
</I>&gt;<i> &gt; Sorry, forgot to attach output of testcase:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Value to store: 127824400782036290
</I>&gt;<i> &gt; Value in database: -2109895358
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; /Fredrik Nilsson
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Fredrik Nilsson wrote:
</I>&gt;<i> &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I'm having problem with sqlite since mono version 1.1.13.
</I>&gt;<i> &gt; &gt; Getting a long (Int64) value doesn't work anymore.
</I>&gt;<i> &gt; &gt; I didn't have any problems with this in version 1.1.12.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Small test case will follow.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; /Fredrik Nilsson
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; using System;
</I>&gt;<i> &gt; &gt; using Mono.Data.SqliteClient;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; class MainClass
</I>&gt;<i> &gt; &gt; {
</I>&gt;<i> &gt; &gt;    public static void Main(string[] args)
</I>&gt;<i> &gt; &gt;    {
</I>&gt;<i> &gt; &gt;        long filetime = DateTime.Now.ToFileTime ();
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;        Console.WriteLine (&quot;Value to store: &quot; + filetime);
</I>&gt;<i> &gt; &gt;               SqliteCommand cmd = new SqliteCommand();
</I>&gt;<i> &gt; &gt;        SqliteConnection connection = new 
</I>&gt;<i> &gt; &gt; SqliteConnection(@&quot;version=3,URI=file:test.db&quot;);
</I>&gt;<i> &gt; &gt;        connection.Open();
</I>&gt;<i> &gt; &gt;        cmd.Connection = connection;
</I>&gt;<i> &gt; &gt;        cmd.CommandText = &quot;CREATE TABLE Test (Date INTEGER NOT
</I>&gt;<i> NULL);&quot;;
</I>&gt;<i> &gt; &gt;        cmd.ExecuteNonQuery ();
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;        cmd = new SqliteCommand ();
</I>&gt;<i> &gt; &gt;        cmd.Connection = connection;
</I>&gt;<i> &gt; &gt;        cmd.CommandText = &quot;INSERT INTO Test (Date) VALUES ('&quot; + 
</I>&gt;<i> &gt; &gt; filetime + &quot;');&quot;;
</I>&gt;<i> &gt; &gt;        cmd.ExecuteNonQuery ();
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;        cmd = new SqliteCommand ();
</I>&gt;<i> &gt; &gt;        cmd.Connection = connection;
</I>&gt;<i> &gt; &gt;        cmd.CommandText = &quot;SELECT * FROM Test;&quot;;
</I>&gt;<i> &gt; &gt;        SqliteDataReader reader = cmd.ExecuteReader ();
</I>&gt;<i> &gt; &gt;               while (reader.Read ()) {
</I>&gt;<i> &gt; &gt;            Console.WriteLine (&quot;Value in database: &quot; + reader[0]);
</I>&gt;<i> &gt; &gt;        }
</I>&gt;<i> &gt; &gt;               connection.Close();
</I>&gt;<i> &gt; &gt;    }
</I>&gt;<i> &gt; &gt; }
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016748.html">[Mono-dev] Problem with sqlite in mono 1.1.13
</A></li>
	<LI>Next message: <A HREF="016750.html">[Mono-dev] Problem with sqlite in mono 1.1.13
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16749">[ date ]</a>
              <a href="thread.html#16749">[ thread ]</a>
              <a href="subject.html#16749">[ subject ]</a>
              <a href="author.html#16749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
