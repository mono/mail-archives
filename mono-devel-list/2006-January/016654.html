<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] wsdl to C#: generated stub raises exception on dynamic	array casting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20wsdl%20to%20C%23%3A%20generated%20stub%20raises%20exception%20on%20dynamic%0A%09array%20casting&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016660.html">
   <LINK REL="Next"  HREF="016655.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] wsdl to C#: generated stub raises exception on dynamic	array casting</H1>
    <B>Julien MARBACH</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20wsdl%20to%20C%23%3A%20generated%20stub%20raises%20exception%20on%20dynamic%0A%09array%20casting&In-Reply-To="
       TITLE="[Mono-dev] wsdl to C#: generated stub raises exception on dynamic	array casting">jmarbach at quelisid.com
       </A><BR>
    <I>Tue Jan 17 14:50:38 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="016660.html">[Mono-dev] MSVC compiled mono_jit_walk_stack problems
</A></li>
        <LI>Next message: <A HREF="016655.html">[Mono-dev] wsdl to C#: generated stub raises exception on	dynamic array casting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16654">[ date ]</a>
              <a href="thread.html#16654">[ thread ]</a>
              <a href="subject.html#16654">[ subject ]</a>
              <a href="author.html#16654">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
I've generated a C# client stub from a wsdl file with Mono &quot;wsdl&quot;
command. The stub works great for most of the remote methods but one is
not functioning. 
The problematic method consist in transferring a dynamic array of struct
from the server to the client. 
When returning its result, the stub function that calls the remote
method makes a cast form Object[] to TagIdArray (my custom type : array
of TagID, see attached code snippets) and an invalid cast exception is
generated :

Unhandled Exception: System.InvalidCastException: Cannot cast from
source type to destination type.
in &lt;0x000f1&gt; quelisapi:getTagIdList (Boolean blocking, Int64 timeout,
System.Boolean scanning)
in (wrapper remoting-invoke-with-check) quelisapi:getTagIdList
(bool,long,bool&amp;)
in [0x00018]
(at /home/jmarbach/workspace/cvs/SmartReader/warehouse_demo/quelisapiclient/quelisapiclient/Main.cs:40) QuelisapiClient:getIDList ()
in [0x00039]
(at /home/jmarbach/workspace/cvs/SmartReader/warehouse_demo/quelisapiclient/quelisapiclient/Main.cs:25) QuelisapiClient:Main (System.String[] args)

The exception is raised by the cast on the return statement of this
function :
    public TagIdArray getTagIdList(bool blocking, long timeout, out bool
scanning) {
        object[] results = this.Invoke(&quot;getTagIdList&quot;, new object[] {
            blocking,
            timeout});
        scanning = ((bool)(results[1]));
        return ((TagIdArray)(results[0]));
    }

Does this means that Mono SOAP implementation is not compatible with the
one I use on the server side (gSOAP) ? 

And/or does this means that Mono SOAP implementation does not support
the serialization/deserialization of this kind of structure?

What kind of table could I use that would be supported by Mono?

Thanks,
Julien


PS1 : Here are the code snippets ( &quot;[...]&quot; stands for non relevant
omitted code) :

[************************** wsdl file end ***************************] 

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;definitions name=&quot;quelisapi&quot;
 targetNamespace=&quot;urn:QuelisReader&quot;
 xmlns:tns=&quot;urn:QuelisReader&quot;
 xmlns:SOAP-ENV=&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/&quot;">http://schemas.xmlsoap.org/soap/envelope/&quot;</A>
 xmlns:SOAP-ENC=&quot;<A HREF="http://schemas.xmlsoap.org/soap/encoding/&quot;">http://schemas.xmlsoap.org/soap/encoding/&quot;</A>
 xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</A>
 xmlns:xsd=&quot;<A HREF="http://www.w3.org/2001/XMLSchema&quot;">http://www.w3.org/2001/XMLSchema&quot;</A>
 xmlns:api=&quot;urn:QuelisReader&quot;
 xmlns:SOAP=&quot;<A HREF="http://schemas.xmlsoap.org/wsdl/soap/&quot;">http://schemas.xmlsoap.org/wsdl/soap/&quot;</A>
 xmlns:MIME=&quot;<A HREF="http://schemas.xmlsoap.org/wsdl/mime/&quot;">http://schemas.xmlsoap.org/wsdl/mime/&quot;</A>
 xmlns:DIME=&quot;<A HREF="http://schemas.xmlsoap.org/ws/2002/04/dime/wsdl/&quot;">http://schemas.xmlsoap.org/ws/2002/04/dime/wsdl/&quot;</A>
 xmlns:WSDL=&quot;<A HREF="http://schemas.xmlsoap.org/wsdl/&quot;">http://schemas.xmlsoap.org/wsdl/&quot;</A>
 xmlns=&quot;<A HREF="http://schemas.xmlsoap.org/wsdl/&quot;">http://schemas.xmlsoap.org/wsdl/&quot;</A>&gt;

&lt;types&gt;

 &lt;schema targetNamespace=&quot;urn:QuelisReader&quot;
  xmlns:SOAP-ENV=&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/&quot;">http://schemas.xmlsoap.org/soap/envelope/&quot;</A>
  xmlns:SOAP-ENC=&quot;<A HREF="http://schemas.xmlsoap.org/soap/encoding/&quot;">http://schemas.xmlsoap.org/soap/encoding/&quot;</A>
  xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</A>
  xmlns:xsd=&quot;<A HREF="http://www.w3.org/2001/XMLSchema&quot;">http://www.w3.org/2001/XMLSchema&quot;</A>
  xmlns:api=&quot;urn:QuelisReader&quot;
  xmlns=&quot;<A HREF="http://www.w3.org/2001/XMLSchema&quot;">http://www.w3.org/2001/XMLSchema&quot;</A>
  elementFormDefault=&quot;unqualified&quot;
  attributeFormDefault=&quot;unqualified&quot;&gt;
  &lt;import namespace=&quot;<A HREF="http://schemas.xmlsoap.org/soap/encoding/&quot;/">http://schemas.xmlsoap.org/soap/encoding/&quot;/</A>&gt;

[...]

  &lt;complexType name=&quot;TagId&quot;&gt;
   &lt;sequence&gt;
     &lt;element name=&quot;uid&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot; maxOccurs=&quot;1&quot;
nillable=&quot;true&quot;/&gt;
     &lt;element name=&quot;readings&quot; type=&quot;xsd:int&quot; minOccurs=&quot;1&quot;
maxOccurs=&quot;1&quot;/&gt;
   &lt;/sequence&gt;
  &lt;/complexType&gt;
  &lt;simpleType name=&quot;TagIdArray&quot;&gt;
   &lt;restriction base=&quot;xsd:base64Binary&quot;&gt;
   &lt;/restriction&gt;
  &lt;/simpleType&gt;
 &lt;/schema&gt;

&lt;/types&gt;

[...]

&lt;message name=&quot;getTagIdList&quot;&gt;
 &lt;part name=&quot;blocking&quot; type=&quot;xsd:boolean&quot;/&gt;
 &lt;part name=&quot;timeout&quot; type=&quot;xsd:long&quot;/&gt;
&lt;/message&gt;

&lt;message name=&quot;TagIdList&quot;&gt;
 &lt;part name=&quot;tagIdArray&quot; type=&quot;api:TagIdArray&quot;/&gt;
 &lt;part name=&quot;scanning&quot; type=&quot;xsd:boolean&quot;/&gt;
&lt;/message&gt;

&lt;portType name=&quot;quelisapiPortType&quot;&gt;

[...]

 &lt;operation name=&quot;getTagIdList&quot;&gt;
  &lt;documentation&gt;Service definition of function
api__getTagIdList&lt;/documentation&gt;
  &lt;input message=&quot;tns:getTagIdList&quot;/&gt;
  &lt;output message=&quot;tns:TagIdList&quot;/&gt;
 &lt;/operation&gt;

&lt;/portType&gt;

&lt;binding name=&quot;quelisapi&quot; type=&quot;tns:quelisapiPortType&quot;&gt;
 &lt;SOAP:binding style=&quot;rpc&quot;
transport=&quot;<A HREF="http://schemas.xmlsoap.org/soap/http&quot;/">http://schemas.xmlsoap.org/soap/http&quot;/</A>&gt;

[...]

 &lt;operation name=&quot;getTagIdList&quot;&gt;
  &lt;SOAP:operation style=&quot;rpc&quot; soapAction=&quot;&quot;/&gt;
  &lt;input&gt;
     &lt;SOAP:body use=&quot;encoded&quot; namespace=&quot;urn:QuelisReader&quot;
encodingStyle=&quot;<A HREF="http://schemas.xmlsoap.org/soap/encoding/&quot;/">http://schemas.xmlsoap.org/soap/encoding/&quot;/</A>&gt;
  &lt;/input&gt;
  &lt;output&gt;
     &lt;SOAP:body use=&quot;encoded&quot; namespace=&quot;urn:QuelisReader&quot;
encodingStyle=&quot;<A HREF="http://schemas.xmlsoap.org/soap/encoding/&quot;/">http://schemas.xmlsoap.org/soap/encoding/&quot;/</A>&gt;
  &lt;/output&gt;
 &lt;/operation&gt;

&lt;/binding&gt;

&lt;service name=&quot;quelisapi&quot;&gt;
 &lt;documentation&gt;gSOAP 2.7.6c generated service
definition&lt;/documentation&gt;
 &lt;port name=&quot;quelisapi&quot; binding=&quot;tns:quelisapi&quot;&gt;
  &lt;SOAP:address location=&quot;<A HREF="http://api.quelisid.com&quot;/">http://api.quelisid.com&quot;/</A>&gt;
 &lt;/port&gt;
&lt;/service&gt;

&lt;/definitions&gt;

[************************** wsdl file end ***************************] 

[************************ generated stub ****************************] 
//
------------------------------------------------------------------------------
//  &lt;autogenerated&gt;
//      This code was generated by a tool.
//      Mono Runtime Version: 1.1.4322.573
// 
//      Changes to this file may cause incorrect behavior and will be
lost if 
//      the code is regenerated.
//  &lt;/autogenerated&gt;
//
------------------------------------------------------------------------------

// 
// This source code was auto-generated by Mono Web Services Description
Language Utility
//
using System;
/// &lt;remarks/&gt;
/// &lt;remarks&gt;
///gSOAP 2.7.6c generated service definition
///&lt;/remarks&gt;
[System.Web.Services.WebServiceBinding(Name=&quot;quelisapi&quot;,Namespace=&quot;urn:QuelisReader&quot;),
System.Diagnostics.DebuggerStepThroughAttribute(),
System.ComponentModel.DesignerCategoryAttribute(&quot;code&quot;)]
public class quelisapi:
System.Web.Services.Protocols.SoapHttpClientProtocol {
    
    public quelisapi () {
        this.Url = &quot;<A HREF="http://api.quelisid.com&quot;;">http://api.quelisid.com&quot;;</A>
    }
    
[...]
    
    /// &lt;remarks&gt;
    ///Service definition of function api__getTagIdList
    ///&lt;/remarks&gt;

[System.Web.Services.Protocols.SoapRpcMethodAttribute(&quot;&quot;,RequestNamespace=&quot;urn:QuelisReader&quot;,ResponseNamespace=&quot;urn:QuelisReader&quot;)]
    [return: System.Xml.Serialization.SoapElement(&quot;tagIdArray&quot;)]
    public TagIdArray getTagIdList(bool blocking, long timeout, out bool
scanning) {
        object[] results = this.Invoke(&quot;getTagIdList&quot;, new object[] {
            blocking,
            timeout});
        scanning = ((bool)(results[1]));
        return ((TagIdArray)(results[0]));
    }
    
    public System.IAsyncResult BegingetTagIdList(bool blocking, long
timeout, System.AsyncCallback callback, object asyncState) {
        return this.BeginInvoke(&quot;getTagIdList&quot;, new object[] {
            blocking,
            timeout}, callback, asyncState);
    }
    
    public TagIdArray EndgetTagIdList(System.IAsyncResult asyncResult,
out bool scanning) {
        object[] results = this.EndInvoke(asyncResult);
        scanning = ((bool)(results[1]));
        return ((TagIdArray)(results[0]));
    }
}

/// &lt;remarks/&gt;
[System.Xml.Serialization.SoapType(Namespace=&quot;urn:QuelisReader&quot;)]
public class TagIdArray {
    
    /// &lt;remarks/&gt;
    [System.Xml.Serialization.SoapElement()]
    public TagId[] item;
}

/// &lt;remarks/&gt;
[System.Xml.Serialization.SoapType(Namespace=&quot;urn:QuelisReader&quot;)]
public class TagId {
    
    /// &lt;remarks/&gt;
    public string uid;
    
    /// &lt;remarks/&gt;
    public int readings;
}

[******************** generated stub end **************************] 
[********* My code, used to call the getTagIdList function ********]

TagIdArray tagIdArray;// = new TagIdArray();
bool nonBlocking = false;
long timeout = 10000;
bool scanning = false;

tagIdArray = Service.getTagIdList(nonBlocking , timeout, out scanning);

[*********               End                               ********]

PS2 : on mono irc channel I've discussed about it with &quot;jonp&quot; who made
me some suggestions :

(09:48:07) jonp: as a test, change the C# method argument accepting the
array to a System.Xml.XmlNode (iirc)
(09:48:18) jonp: this should give you direct access to the underlying XML, without any unmarshaling
(09:49:26) jonp: sadly this was reported on mono-devel-list sep-2004, but there were no replies 

I'm working on it.

He also pointed out some compatibility info between gSOAP and other SOAP implementations :
<A HREF="http://www.cs.fsu.edu/~engelen/interop11/interop2results.html">http://www.cs.fsu.edu/~engelen/interop11/interop2results.html</A>
This page shows that arrays support (and mostly struct arrays) seems to be a big compatibility challenge between the existing SOAP implementations.

-- 
MARBACH Julien
Embedded software engineer
Quelis ID Systems
11845 Irenee-Vachon
J7N 1G2 Mirabel (QC)
Canada

Phone : +1 (450) 476-1930 - x230
Fax   : +1 (450) 476-0246

--- www.quelisid.com ---



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016660.html">[Mono-dev] MSVC compiled mono_jit_walk_stack problems
</A></li>
	<LI>Next message: <A HREF="016655.html">[Mono-dev] wsdl to C#: generated stub raises exception on	dynamic array casting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16654">[ date ]</a>
              <a href="thread.html#16654">[ thread ]</a>
              <a href="subject.html#16654">[ subject ]</a>
              <a href="author.html#16654">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
