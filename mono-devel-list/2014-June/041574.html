<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Question about adding opcodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Question%20about%20adding%20opcodes&In-Reply-To=%3CCAH9TF6PmL-RV96pg3%2BtxxaXE26xbVHCu36rnTD1XAW4pA8ONsA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041573.html">
   <LINK REL="Next"  HREF="041572.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Question about adding opcodes</H1>
    <B>Alex R&#248;nne Petersen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Question%20about%20adding%20opcodes&In-Reply-To=%3CCAH9TF6PmL-RV96pg3%2BtxxaXE26xbVHCu36rnTD1XAW4pA8ONsA%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Question about adding opcodes">alex at alexrp.com
       </A><BR>
    <I>Mon Jun  2 07:44:07 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041573.html">[Mono-dev] Question about adding opcodes
</A></li>
        <LI>Next message: <A HREF="041572.html">[Mono-dev] Problem with full-AOT mode on ARM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41574">[ date ]</a>
              <a href="thread.html#41574">[ thread ]</a>
              <a href="subject.html#41574">[ subject ]</a>
              <a href="author.html#41574">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On Mon, Jun 2, 2014 at 12:24 AM, Steven Bluen &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sbluen153 at yahoo.com</A>&gt; wrote:
&gt;<i> Thanks for your response. Would you also care to explain something else please? Because I'm not sure why when I place printf calls inside the switch statement, when I run a program with Mono, all of the output is placed at the beginning, before anything else is printed to the console.
</I>
Where did you place the printfs? mono_method_to_ir () is one of the
first things that run when a method is JITed.

&gt;<i>
</I>&gt;<i> On another note, is there an easy way to read the preprocessor macros when coding or debugging Mono's functions? Because they slow down my understanding of the code by being skipped in the debugger and because my IDE, Eclipse, can't handle some of them very well under its default settings.
</I>
I don't know of any easy way to do this. You could look at the
generated config.h, `gcc -dM -E - &lt; /dev/null`, the
mini-{x86,arm,...}.h arch header for your platform, etc.

&gt;<i>
</I>&gt;<i> Steven Bluen
</I>&gt;<i> --------------------------------------------
</I>&gt;<i> On Sun, 6/1/14, Alex R&#248;nne Petersen &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">alex at alexrp.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>  Subject: Re: [Mono-dev] Question about adding opcodes
</I>&gt;<i>  To: &quot;Steven Bluen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sbluen153 at yahoo.com</A>&gt;
</I>&gt;<i>  Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i>  Date: Sunday, June 1, 2014, 6:16 AM
</I>&gt;<i>
</I>&gt;<i>  Hi,
</I>&gt;<i>
</I>&gt;<i>  On Sun, Jun 1, 2014 at 2:58 PM, Steven Bluen &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sbluen153 at yahoo.com</A>&gt;
</I>&gt;<i>  wrote:
</I>&gt;<i>  &gt; Hello,
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; I am trying to add an opcode to Mono's JIT compiler and
</I>&gt;<i>  its interpreter to allow Mono to compile and run
</I>&gt;<i>  applications so that I can make a frequently used operation
</I>&gt;<i>  in a C# program run faster. To keep things simple and avoid
</I>&gt;<i>  the need for parsing, this opcode is invoked through dynamic
</I>&gt;<i>  methods.
</I>&gt;<i>
</I>&gt;<i>  Adding it to the interpreter is not worth it. The
</I>&gt;<i>  interpreter is
</I>&gt;<i>  bitrotted to the point of obscurity.
</I>&gt;<i>
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; I am able to get Mono's JIT compiler to stop at a
</I>&gt;<i>  breakpoint in mono/mini/method-to-ir.c at the point where
</I>&gt;<i>  the opcode is added to the method's intermediate
</I>&gt;<i>  representation. However, it would be much appreciated if
</I>&gt;<i>  someone could let me know which component, source code file,
</I>&gt;<i>  or function of Mono's interpreter is responsible for
</I>&gt;<i>  interpreting the instructions that form the body of a
</I>&gt;<i>  dynamic method.
</I>&gt;<i>
</I>&gt;<i>  They're parsed like any other method (from an on-disk CIL
</I>&gt;<i>  assembly).
</I>&gt;<i>  This parsing is based on the tables in mono/cil/ and is done
</I>&gt;<i>  in
</I>&gt;<i>  mono_method_to_ir () in mono/mini/method-to-ir.c. The CIL
</I>&gt;<i>  stream is
</I>&gt;<i>  simply interpreted directly. If you're adding a new CIL
</I>&gt;<i>  opcode
</I>&gt;<i>  (different from an IR opcode), add it in
</I>&gt;<i>  mono/cil/cil-opcodes.xml and
</I>&gt;<i>  handle it in mono_method_to_ir (). If you plan to also add
</I>&gt;<i>  an IR
</I>&gt;<i>  opcode (or several), you may want to consider intercepting
</I>&gt;<i>  an
</I>&gt;<i>  intrinsic method call instead of using a custom CIL opcode.
</I>&gt;<i>  This'll be
</I>&gt;<i>  portable to MS.NET as MS.NET will then just use the managed
</I>&gt;<i>  fallback.
</I>&gt;<i>
</I>&gt;<i>  Regards,
</I>&gt;<i>  Alex
</I>&gt;<i>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041573.html">[Mono-dev] Question about adding opcodes
</A></li>
	<LI>Next message: <A HREF="041572.html">[Mono-dev] Problem with full-AOT mode on ARM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41574">[ date ]</a>
              <a href="thread.html#41574">[ thread ]</a>
              <a href="subject.html#41574">[ subject ]</a>
              <a href="author.html#41574">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
