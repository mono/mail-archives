<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] field pointer and garbage collection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20field%20pointer%20and%20garbage%20collection&In-Reply-To=%3CCAH9TF6OSdRWiBCEiZJ9qvg_MDNvavS26WO57fp_1COxhAy%3D77g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041600.html">
   <LINK REL="Next"  HREF="041602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] field pointer and garbage collection</H1>
    <B>Alex R&#248;nne Petersen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20field%20pointer%20and%20garbage%20collection&In-Reply-To=%3CCAH9TF6OSdRWiBCEiZJ9qvg_MDNvavS26WO57fp_1COxhAy%3D77g%40mail.gmail.com%3E"
       TITLE="[Mono-dev] field pointer and garbage collection">alex at alexrp.com
       </A><BR>
    <I>Wed Jun 11 10:16:50 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041600.html">[Mono-dev] field pointer and garbage collection
</A></li>
        <LI>Next message: <A HREF="041602.html">[Mono-dev] field pointer and garbage collection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41601">[ date ]</a>
              <a href="thread.html#41601">[ thread ]</a>
              <a href="subject.html#41601">[ subject ]</a>
              <a href="author.html#41601">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As with any pointer updating during GC, this can only be done with
precise type and liveness information. If any pointer to an object --
whether base or interior -- exists in CPU registers or on the stack,
the object is considered pinned and will not be moved. The exception
to this is when you run SGen with precise stack scanning (which is
somewhat experimental) - in this mode, SGen knows which pointers are
where on the stack and will update accordingly.

Note that CIL only allows interior pointers on the stack - you can't
take an interior pointer and store it on the heap or anything like
that.

On Wed, Jun 11, 2014 at 12:08 PM, serus &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fabian.nagel at gmail.com</A>&gt; wrote:
&gt;<i> Dear Devs,
</I>&gt;<i>
</I>&gt;<i> I would appreciate if someone could make sense out of the following:
</I>&gt;<i>
</I>&gt;<i> When a field of an object is accessed in C#, the IL code is LDFLD.
</I>&gt;<i> Intuitively, I would assume that the JIT compiler would transform LDFLD into
</I>&gt;<i> the assembler version of the following C code:
</I>&gt;<i>
</I>&gt;<i> int A = *(int*)(ptr + 24);   // ptr is pointer to object, accessed field is
</I>&gt;<i> int and 24 is offset of field in object
</I>&gt;<i>
</I>&gt;<i> Now assuming this was true, at some point (ptr + 24) would reside in a CPU
</I>&gt;<i> register, if execution is intercepted by garbage collection and the object
</I>&gt;<i> moved somewhere, this pointer would have to be updated as well, which sounds
</I>&gt;<i> impossible as the forward pointer is installed at the beginning of the
</I>&gt;<i> object and the pointer points to somewhere inside the object.
</I>&gt;<i>
</I>&gt;<i> What part of my assumption is wrong? How is this solved?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/field-pointer-and-garbage-collection-tp4663040.html">http://mono.1490590.n4.nabble.com/field-pointer-and-garbage-collection-tp4663040.html</A>
</I>&gt;<i> Sent from the Mono - Dev mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I></PRE>






































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041600.html">[Mono-dev] field pointer and garbage collection
</A></li>
	<LI>Next message: <A HREF="041602.html">[Mono-dev] field pointer and garbage collection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41601">[ date ]</a>
              <a href="thread.html#41601">[ thread ]</a>
              <a href="subject.html#41601">[ subject ]</a>
              <a href="author.html#41601">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
