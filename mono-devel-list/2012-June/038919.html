<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Control.Dispose glitch?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Control.Dispose%20glitch%3F&In-Reply-To=%3C4FC8117B.2070405%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="038920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Control.Dispose glitch?</H1>
    <B>Rob Wilkens</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Control.Dispose%20glitch%3F&In-Reply-To=%3C4FC8117B.2070405%40gmail.com%3E"
       TITLE="[Mono-dev] Control.Dispose glitch?">robwilkens at gmail.com
       </A><BR>
    <I>Fri Jun  1 00:48:59 UTC 2012</I>
    <P><UL>
        
        <LI>Next message: <A HREF="038920.html">[Mono-dev] Patches for mono-winforms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38919">[ date ]</a>
              <a href="thread.html#38919">[ thread ]</a>
              <a href="subject.html#38919">[ subject ]</a>
              <a href="author.html#38919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(This is re: System.Windows.Forms)

IT appears Control.Dispose is destroying the parent window, then 
destroying the children...  Is it supposed to do that?

This is causing some warning messages from X11 in my test code under 
some circumstances, at least when the window is created under another 
thread and it takes the &quot;if (this.InvokeRequired)&quot;==true path (which 
happens when the control was created in a different thread.)  I haven't 
tried to see if other paths lead to this.

The code still runs (no crash), but I get the following warning from X11:
X11 Error encountered:
   Error: BadWindow (invalid Window parameter)
   Request:     4 (0)
   Resource ID: 0x3C0002C
   Serial:      544
....(etc)....

The events leading up to this are (all from same call to Control.Dispose 
for the form):
(1) An XDestroyWindow is sent to the Form which contained the label 
(From DestroyHandle() call path in Control.Dispose).. This succeeds.
(2) An XDestroyWindow is sent to the label when the children[] are being 
disposed (which eventually gets back to their Control.Dispose of their 
own, which then calls DestroyHandle()),and the child label has probably 
already been 'destroyed' by virtue of Destroying the parent form, and 
the result is the BadWindow message above.

I can fix this, I think, by moving the parent delete below the children 
deletion...  I haven't tested this yet, or tried doing it yet. I'm 
worried because this is not platform specific code, it may break 
something on a non-x11 platform, which means in addition to Linux, i'll 
have to test this change on my mac and my Windows installations 
somehow), presuming i make this change.  I've not yet ever built mono on 
either of those other two plaforms.

Can someone tell me I shouldn't do this?  I'm not touching anything else 
tonight.

-Rob
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="038920.html">[Mono-dev] Patches for mono-winforms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38919">[ date ]</a>
              <a href="thread.html#38919">[ thread ]</a>
              <a href="subject.html#38919">[ subject ]</a>
              <a href="author.html#38919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
