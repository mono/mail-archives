<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Win Patches for Datagrid (first here) then idle
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Win%20Patches%20for%20Datagrid%20%28first%20here%29%20then%20idle&In-Reply-To=%3C4FE06759.6030905%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039193.html">
   <LINK REL="Next"  HREF="039204.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Win Patches for Datagrid (first here) then idle</H1>
    <B>Rob Wilkens</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Win%20Patches%20for%20Datagrid%20%28first%20here%29%20then%20idle&In-Reply-To=%3C4FE06759.6030905%40gmail.com%3E"
       TITLE="[Mono-dev] Win Patches for Datagrid (first here) then idle">robwilkens at gmail.com
       </A><BR>
    <I>Tue Jun 19 11:49:45 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="039193.html">[Mono-dev] Win Patches for Datagrid (first here) then idle
</A></li>
        <LI>Next message: <A HREF="039204.html">[Mono-dev] Win Patches for Datagrid (first here) then idle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39196">[ date ]</a>
              <a href="thread.html#39196">[ thread ]</a>
              <a href="subject.html#39196">[ subject ]</a>
              <a href="author.html#39196">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I took someone's suggestion on formatting code, and that was to run it
through the monodevelop code formatter.

This changed one or two lines outside of my own code, but let me know if
this one looks ok to you.

Attached is revised DataGridTest.cs patch.

-Rob

On 06/19/2012 05:54 AM, Stifu wrote:
&gt;<i> By the way, make sure to fix the coding style.
</I>&gt;<i>
</I>&gt;<i> OnMouseDown(me); -&gt; OnMouseDown (me);
</I>&gt;<i> if( disposing ) -&gt; if (disposing)
</I>&gt;<i> base.Dispose( disposing ); -&gt; base.Dispose (disposing);
</I>&gt;<i>
</I>&gt;<i> etc
</I>-------------- next part --------------
diff --git a/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/DataGridTest.cs b/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/DataGridTest.cs
index f49ecd8..2dce886 100644
--- a/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/DataGridTest.cs
+++ b/mcs/class/Managed.Windows.Forms/Test/System.Windows.Forms/DataGridTest.cs
@@ -23,7 +23,6 @@
 //	Jordi Mas i Hernandez &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jordi at ximian.com</A>&gt;
 //
 //
-
 using System;
 using System.Collections;
 using System.ComponentModel;
@@ -32,14 +31,14 @@ using System.Windows.Forms;
 using System.Xml;
 using NUnit.Framework;
 using System.Data;
+using System.Xml;
 
 namespace MonoTests.System.Windows.Forms
 {
 	// Helper classes
-
-	class TestDataGrid : DataGrid 
+	class TestDataGrid : DataGrid
 	{
-		public TestDataGrid () 
+		public TestDataGrid ()
 		{
 
 		}
@@ -56,7 +55,6 @@ namespace MonoTests.System.Windows.Forms
 	{
 		private bool eventhandled;
 
-
 		[Test]
 		public void TestDefaultValues ()
 		{
@@ -111,7 +109,7 @@ namespace MonoTests.System.Windows.Forms
 		{
 			DataGrid dg = new DataGrid ();
 			eventhandled = false;
-			dg.BackgroundColorChanged  += new EventHandler (OnEventHandler);
+			dg.BackgroundColorChanged += new EventHandler (OnEventHandler);
 			dg.BackgroundColor = Color.Red;
 			Assert.AreEqual (true, eventhandled, &quot;A1&quot;);
 		}
@@ -121,7 +119,7 @@ namespace MonoTests.System.Windows.Forms
 		{
 			DataGrid dg = new DataGrid ();
 			eventhandled = false;
-			dg.BorderStyleChanged  += new EventHandler (OnEventHandler);
+			dg.BorderStyleChanged += new EventHandler (OnEventHandler);
 			dg.BorderStyle = BorderStyle.None;
 			Assert.AreEqual (true, eventhandled, &quot;A1&quot;);
 		}
@@ -204,13 +202,12 @@ namespace MonoTests.System.Windows.Forms
 			Assert.AreSame (dg.HeaderFont, dg.Font, &quot;#5&quot;);
 		}
 
-
 		[Test]
 		public void TestParentRowsLabelStyleChangedEvent ()
 		{
 			DataGrid dg = new DataGrid ();
 			eventhandled = false;
-			dg.ParentRowsLabelStyleChanged  += new EventHandler (OnEventHandler);
+			dg.ParentRowsLabelStyleChanged += new EventHandler (OnEventHandler);
 			dg.ParentRowsLabelStyle = DataGridParentRowsLabelStyle.None;
 			Assert.AreEqual (true, eventhandled, &quot;A1&quot;);
 		}
@@ -220,7 +217,7 @@ namespace MonoTests.System.Windows.Forms
 		{
 			DataGrid dg = new DataGrid ();
 			eventhandled = false;
-			dg.ParentRowsVisibleChanged  += new EventHandler (OnEventHandler);
+			dg.ParentRowsVisibleChanged += new EventHandler (OnEventHandler);
 			dg.ParentRowsVisible = !dg.ParentRowsVisible;
 			Assert.AreEqual (true, eventhandled, &quot;A1&quot;);
 		}
@@ -230,7 +227,7 @@ namespace MonoTests.System.Windows.Forms
 		{
 			DataGrid dg = new DataGrid ();
 			eventhandled = false;
-			dg.ReadOnlyChanged  += new EventHandler (OnEventHandler);
+			dg.ReadOnlyChanged += new EventHandler (OnEventHandler);
 			dg.ReadOnly = !dg.ReadOnly;
 			Assert.AreEqual (true, eventhandled, &quot;A1&quot;);
 		}
@@ -384,6 +381,7 @@ namespace MonoTests.System.Windows.Forms
 		}
 
 		int data_source_changed_count = 0;
+
 		void OnDataSourceChanged (object sender, EventArgs e)
 		{
 			data_source_changed_count ++;
@@ -603,7 +601,7 @@ namespace MonoTests.System.Windows.Forms
 
 			DataSet ds = new DataSet (&quot;DataSet&quot;);
 			DataTable dt = new DataTable (&quot;MyTable&quot;);
-			dt.Columns.Add (&quot;A&quot;, typeof (string));
+			dt.Columns.Add (&quot;A&quot;, typeof(string));
 			dt.NewRow ();
 			ds.Tables.Add (dt);
 
@@ -619,5 +617,96 @@ namespace MonoTests.System.Windows.Forms
 
 			Assert.AreEqual (1, table_style.GridColumnStyles.Count, &quot;#B1&quot;);
 		}
+
+		public class ClickableDataGrid : DataGrid
+		{
+			public void ClickGrid (int X, int Y)
+			{
+				MouseEventArgs me = new MouseEventArgs (
+					MouseButtons.Left,
+					1, /*# of clicks*/ 
+					X, Y, 0);
+				OnMouseDown (me);
+				OnClick (me);
+				OnMouseUp (me);
+			}
+		}
+
+		public class Form5487 : Form
+		{
+			private ClickableDataGrid dataGrid1;
+			private Container components = null;
+
+			public Form5487 ()
+			{
+				InitializeComponent ();
+			}
+		
+			protected override void Dispose (bool disposing)
+			{
+				if (disposing) {
+					if (components != null) {
+						components.Dispose ();
+					}
+				}
+				base.Dispose (disposing);
+			}
+
+			private void InitializeComponent ()
+			{
+				this.dataGrid1 = new ClickableDataGrid ();
+				((ISupportInitialize)(this.dataGrid1)).BeginInit ();
+				this.SuspendLayout ();
+				this.dataGrid1.DataMember = &quot;&quot;;
+				this.dataGrid1.HeaderForeColor = SystemColors.ControlText;
+				this.dataGrid1.Location = new Point (16, 16);
+				this.dataGrid1.Name = &quot;dataGrid1&quot;;
+				this.dataGrid1.Size = new Size (624, 440);
+				this.dataGrid1.TabIndex = 0;
+				this.AutoScaleBaseSize = new Size (5, 13);
+				this.ClientSize = new Size (656, 470);
+				this.Controls.Add (this.dataGrid1);
+				this.Name = &quot;Form1&quot;;
+				this.Text = &quot;Form1&quot;;
+				this.Shown += new EventHandler (this.Form1_Load);
+				((ISupportInitialize)(this.dataGrid1)).EndInit ();
+				this.ResumeLayout (false);
+
+			}
+
+			private void Form1_Load (object sender, EventArgs e)
+			{
+				DataSet ds = new DataSet ();
+				String XMLString = &quot;&quot;;
+				XmlTextReader XMLTR;
+
+				XMLString += &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;ISO-8859-1\&quot;?&gt;&quot;;
+				XMLString += &quot;&lt;pa&gt;&lt;pb&gt;&lt;pc&gt;&lt;pd&gt;&lt;id&gt;1&lt;/id&gt;&quot;;
+				XMLString += &quot;&lt;/pd&gt;&lt;/pc&gt;&lt;pc&gt;&lt;pd&gt;&lt;id&gt;1&lt;/id&gt;&quot;;
+				XMLString += &quot;&lt;/pd&gt;&lt;pd&gt;&lt;id&gt;1&lt;/id&gt;&lt;/pd&gt;&lt;pd&gt;&quot;;
+				XMLString += &quot;&lt;id&gt;1&lt;/id&gt;&lt;/pd&gt;&lt;pd&gt;&lt;id&gt;1&lt;/id&gt;&quot;;
+				XMLString += &quot;&lt;/pd&gt;&lt;pd&gt;&lt;id&gt;1&lt;/id&gt;&lt;/pd&gt;&lt;pd&gt;&quot;;	
+				XMLString += &quot;&lt;id&gt;1&lt;/id&gt;&lt;/pd&gt;&lt;pd&gt;&lt;id&gt;1&lt;/id&gt;&quot;;
+				XMLString += &quot;&lt;/pd&gt;&lt;pd&gt;&lt;id&gt;1&lt;/id&gt;&lt;/pd&gt;&lt;/pc&gt;&quot;;
+				XMLString += &quot;&lt;/pb&gt;&lt;/pa&gt;&quot;;
+				XMLTR = new XmlTextReader (XMLString,
+					XmlNodeType.Document, null);
+				XMLTR.ReadOuterXml ();
+				ds.ReadXml (XMLTR);
+				this.dataGrid1.DataSource = ds;	
+				this.dataGrid1.ClickGrid (25, 45);
+				Application.DoEvents ();
+				this.dataGrid1.ClickGrid (46, 73);
+				Application.DoEvents ();
+				this.dataGrid1.NavigateBack ();
+				Close ();
+			}
+		}
+		[Test]
+		public void Bug5487AndRelated ()
+		{
+			//this should crash on fail
+			Application.Run (new Form5487 ());
+		}
 	}
 }
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039193.html">[Mono-dev] Win Patches for Datagrid (first here) then idle
</A></li>
	<LI>Next message: <A HREF="039204.html">[Mono-dev] Win Patches for Datagrid (first here) then idle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39196">[ date ]</a>
              <a href="thread.html#39196">[ thread ]</a>
              <a href="subject.html#39196">[ subject ]</a>
              <a href="author.html#39196">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
