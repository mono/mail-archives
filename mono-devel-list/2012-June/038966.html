<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Embedded mono - cross compile on cygwin and linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Embedded%20mono%20-%20cross%20compile%20on%20cygwin%20and%20linux&In-Reply-To=%3CCA%2Bvc01%3D2KLDbQVp%2B0NzEynCHekcHNqGx0y79Yj2fAbHwgE_XKA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038965.html">
   <LINK REL="Next"  HREF="038967.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Embedded mono - cross compile on cygwin and linux</H1>
    <B>Matthias D.</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Embedded%20mono%20-%20cross%20compile%20on%20cygwin%20and%20linux&In-Reply-To=%3CCA%2Bvc01%3D2KLDbQVp%2B0NzEynCHekcHNqGx0y79Yj2fAbHwgE_XKA%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Embedded mono - cross compile on cygwin and linux">matthi.d at googlemail.com
       </A><BR>
    <I>Mon Jun  4 11:42:36 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="038965.html">[Mono-dev] Embedded mono - cross compile on cygwin and linux
</A></li>
        <LI>Next message: <A HREF="038967.html">[Mono-dev] Embedded mono - cross compile on cygwin and linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38966">[ date ]</a>
              <a href="thread.html#38966">[ thread ]</a>
              <a href="subject.html#38966">[ subject ]</a>
              <a href="author.html#38966">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

after some further digging I'm quite sure this SIGSEGV and SIGILL happens
on a function pointer created by mono_method_get_unmanaged_thunk.
This method looks really really scarry to me
(mono_marshal_get_thunk_invoke_wrapper)!

I did also tried to repruduce this on a smaller codeset, but even my
current code works on some circumstances. (It's occures only when I change
some settings that I do not understand how they relate to this, they only
cause the code to be called more often).

Added some code, maybe I made a simple mistake on marshalling or something
simple like that (on the struct field types).
Here you can see exaclty what I'm doing.
<A HREF="https://docs.google.com/document/d/1JDUrHGyYIYKdTcwLDIsdIeW17I5OA0AOs-hG_sWThSQ/edit">https://docs.google.com/document/d/1JDUrHGyYIYKdTcwLDIsdIeW17I5OA0AOs-hG_sWThSQ/edit</A>
(Note: I do not try to engage you to try to reproduce this error [Its
pretty time consuming], I wrote these documents for my own reference, if I
ever try to embed mono in another app. However i figured, if somebody want
to look into this why not give him all information what i have done)
These documents also point out how you can statically link to libmono-2.0.a
on windows (which is also not supported for some reason).
The documents may very well be incomplete, just leave a comment there if
you want.

When somebody has any tipps I'd appreciate to hear them (What the cause
could be, how to debug this properly...or anything really), if not I will
hopefully figure it out sometimes....
And send the required patches back here.

Note: I did also add the patches which should be more &quot;git&quot; like than the
diffs I did add before (sorry for that, I'm just getting into this git
thing).

have a nice week,
Matthias




On Mon, Jun 4, 2012 at 10:42 AM, Matthias D. &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">matthi.d at googlemail.com</A>&gt;wrote:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I did setup my system like this (can anyone tell me why this linked email
</I>&gt;<i> was not sent to the mailing list?):
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://docs.google.com/document/d/1rtkBYdPlRvnWQsFHetIAQqTNNzPu8_iP8maoQUl3zRE/edit">https://docs.google.com/document/d/1rtkBYdPlRvnWQsFHetIAQqTNNzPu8_iP8maoQUl3zRE/edit</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Some additions to that mail (that was somehow not send).
</I>&gt;<i> I know this scenario is currently unsupported, but is there anything I can
</I>&gt;<i> do to prevent breaking changes to that scenario as I noticed these changes
</I>&gt;<i> will not work on master!
</I>&gt;<i> On master branch mono it will not make with the erorr:
</I>&gt;<i>
</I>&gt;<i> Like I said: I managed to get it working with 2.11.1 do it shouldn't be
</I>&gt;<i> difficult to get it working on master, should it?
</I>&gt;<i> Or will you continue to let this scenario be unsupported? (Read the above
</I>&gt;<i> link)
</I>&gt;<i>
</I>&gt;<i> I will continue to work some time on this scenario (the above mono
</I>&gt;<i> statically embedded in a native app on cygwin -&gt; mingw cross compile).
</I>&gt;<i> Currenty I'm trying to debug a SIGSEGV and a SIGILL most likely caused by
</I>&gt;<i> the embedded mono.
</I>&gt;<i> What I'm tried to do is compile mono with the &quot;-g&quot; flag but I still
</I>&gt;<i> doesn't get a propper stack stack trace (bt in gdb).
</I>&gt;<i> Any hints how I could track this one down?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for your time reading this,
</I>&gt;<i> Matthias
</I>&gt;<i>
</I>&gt;<i> PS: I hope you can also answer the questions in the linked Email (that was
</I>&gt;<i> not sent).
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MonoLoader.cpp
Type: text/x-c++src
Size: 6100 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0001.cpp">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0001.cpp</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MonoLoader.h
Type: text/x-chdr
Size: 3391 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0001.h">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0001.h</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BotLoader.cs
Type: application/octet-stream
Size: 16563 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0004.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0004.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-Fix-to-make-mono-cross-compile-with-master-branch.patch
Type: application/octet-stream
Size: 841 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0005.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0005.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0003-Fix-for-typo-on-CPPFLAGS.patch
Type: application/octet-stream
Size: 671 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0006.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0006.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Fixes-to-make-mono-cross-compile-on-linux-cygwin-to-.patch
Type: application/octet-stream
Size: 1503 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0007.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120604/d2de8af2/attachment-0007.obj</A>&gt;
</PRE>























































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038965.html">[Mono-dev] Embedded mono - cross compile on cygwin and linux
</A></li>
	<LI>Next message: <A HREF="038967.html">[Mono-dev] Embedded mono - cross compile on cygwin and linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38966">[ date ]</a>
              <a href="thread.html#38966">[ thread ]</a>
              <a href="subject.html#38966">[ subject ]</a>
              <a href="author.html#38966">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
