<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] How To Convince Mono To Allocate Big Arrays
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20To%20Convince%20Mono%20To%20Allocate%20Big%20Arrays&In-Reply-To=F3AAF6E3-F6B7-4AC5-9E20-D10EF05B38D7%40verizon.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027824.html">
   <LINK REL="Next"  HREF="027825.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] How To Convince Mono To Allocate Big Arrays</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20To%20Convince%20Mono%20To%20Allocate%20Big%20Arrays&In-Reply-To=F3AAF6E3-F6B7-4AC5-9E20-D10EF05B38D7%40verizon.net"
       TITLE="[Mono-dev] How To Convince Mono To Allocate Big Arrays">kumpera at gmail.com
       </A><BR>
    <I>Thu May  8 12:55:49 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027824.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
        <LI>Next message: <A HREF="027825.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27826">[ date ]</a>
              <a href="thread.html#27826">[ thread ]</a>
              <a href="subject.html#27826">[ subject ]</a>
              <a href="author.html#27826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, May 8, 2008 at 1:40 PM, Luis F. Ortiz &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">LuisOrtiz at verizon.net</A>&gt; wrote:

&gt;<i> On May 7, 2008, at 10:50 PM, Rodrigo Kumpera wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Luis,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To have your patch integrated, some changes are needed. First, we want to
</I>&gt;&gt;<i> default to 32bits sized arrays on 64bits machines, so your changes must be
</I>&gt;&gt;<i> conditionally compiled. To help with that some changed to your patch are
</I>&gt;&gt;<i> due. Next are some comments about it:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Instead of replacing guint32 for gsize, it's better to create a new type,
</I>&gt;&gt;<i> let's say array_size_t. This would reduce conditional compilation to fewer
</I>&gt;&gt;<i> places.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Rodrigo:
</I>&gt;<i>        Permit me to reply to your message in parts, so that I clear on what
</I>&gt;<i> needs to be done, from your point of view.
</I>&gt;<i>
</I>&gt;<i> 1) Add support for a new configuration argument to configure.in(AC_ARG_ENABLE(big-arrays,[ --enable-bug-arrays Enable allocation and
</I>&gt;<i> indexing of arrays &gt; 31 bits in size.],...))
</I>&gt;<i> 2) Add a compile time define (AC_DEFINE(BIG_ARRAYS,1,[Enable allocation and
</I>&gt;<i> indexing of arrays &gt; 31 bits in size.]))
</I>&gt;<i> 3) Use said compile time define to typedef array_size_t to either guint32
</I>&gt;<i> or guint64 depending on the state of BIG_ARRAYS in object.h
</I>&gt;<i> 4) Use array_size_t where I used gsize in my patch.
</I>&gt;<i>
</I>&gt;<i> Questions:
</I>&gt;<i>
</I>&gt;<i> A) Do you agree then that the correct size types are either guint32 or
</I>&gt;<i> guint64?
</I>&gt;<i>   Or would gint32 and gint64 be better choices as they would agree with the
</I>&gt;<i> input arguments to ves_icall_System_Array_CreateInstanceImpl functions and
</I>&gt;<i> the usage in socket-io.c?
</I>&gt;<i>
</I>
Arrays must be fully indexable using signed integers. This means max sizes
must be  2^31 - 1 or 1^63 - 1. All math is done using unsigned integers to
avoid overflow issues..


&gt;<i>
</I>&gt;<i> B) Should the CreateInstanceImpl64 method definition in icall-def.h exist
</I>&gt;<i> if BIG_ARRAYS is not defined.
</I>&gt;<i>
</I>
On this case it's a matter if we want conditional compilation over
BIG_ARRAYS to happen over the classlib as well. I'm prefer on doing all
conditional compilation on unmanaged code only, but we rather listen to more
opinions on this subject.


&gt;<i>
</I>&gt;<i> C) In the case where BIG_ARRAYS is not defined,  should
</I>&gt;<i> ves_icall_System_Array_CreateInstanceImpl64() still exist and make sure all
</I>&gt;<i> arguments fit into the small guint32?
</I>&gt;<i>
</I>
I favor this path of doing all conditional compilation on the unmanaged
side.


&gt;<i>
</I>&gt;<i> D) mono_array_size_t or array_size_t?   Without the mono prefix, i fear
</I>&gt;<i> that some third-party library might also use the obvious name.  Should the
</I>&gt;<i> BIG_ARRAYS definition also use a MONO_ prefix?
</I>&gt;<i>
</I>
Using mono prefix for both is the way to go.


&gt;<i>
</I>&gt;<i> /Ortiz/Luis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>Cheers,
Rodrigo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080508/863192a2/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080508/863192a2/attachment.html</A> 
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027824.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
	<LI>Next message: <A HREF="027825.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27826">[ date ]</a>
              <a href="thread.html#27826">[ thread ]</a>
              <a href="subject.html#27826">[ subject ]</a>
              <a href="author.html#27826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
