<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Hashtable.Clone speedup.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Hashtable.Clone%20speedup.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027976.html">
   <LINK REL="Next"  HREF="027981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Hashtable.Clone speedup.</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Hashtable.Clone%20speedup.&In-Reply-To="
       TITLE="[Mono-dev] Hashtable.Clone speedup.">miguel at ximian.com
       </A><BR>
    <I>Thu May 22 20:01:14 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027976.html">[Mono-dev] mod_mono restart patch
</A></li>
        <LI>Next message: <A HREF="027981.html">[Mono-dev] Hashtable.Clone speedup.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27980">[ date ]</a>
              <a href="thread.html#27980">[ thread ]</a>
              <a href="subject.html#27980">[ subject ]</a>
              <a href="author.html#27980">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello folks,

    The following patch doubles the speed of the Hashtable.Clone()
method by copying the data directly, instead of using an enumerator and
repopulating the hashtable.

    Additionally, since the way that Clone() works today is by passing a
capacity value based on the actual number of slots on the Hashtable and
the Hashtable constructor likes to make its own guesstimates as to the
capacity of the table based on the loadFactor, it might end up resizing
the hashtable more than once.

    What to look for: I avoided copying two fields hashKeys and
hashValues as those seem like caches that are computed on demand.   But
did I miss anything important?

    You can reproduce locally using the attached program, invoke like
this:

	mono clone N M

    Where N is the number of slots to stick in the Hashtable, and M is
the number of copies to perform.

Miguel.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: hashtable.patch
Type: text/x-patch
Size: 2268 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080522/f6cd1790/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080522/f6cd1790/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: clone.cs
Type: text/x-csharp
Size: 602 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080522/f6cd1790/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080522/f6cd1790/attachment-0001.bin</A> 
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027976.html">[Mono-dev] mod_mono restart patch
</A></li>
	<LI>Next message: <A HREF="027981.html">[Mono-dev] Hashtable.Clone speedup.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27980">[ date ]</a>
              <a href="thread.html#27980">[ thread ]</a>
              <a href="subject.html#27980">[ subject ]</a>
              <a href="author.html#27980">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
