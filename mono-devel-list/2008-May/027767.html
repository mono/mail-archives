<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Fixes and modifications for MSVCRT support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Fixes%20and%20modifications%20for%20MSVCRT%20support&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027829.html">
   <LINK REL="Next"  HREF="027770.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Fixes and modifications for MSVCRT support</H1>
    <B>P&#225;l Korn&#233;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Fixes%20and%20modifications%20for%20MSVCRT%20support&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] Fixes and modifications for MSVCRT support">kornelpal at gmail.com
       </A><BR>
    <I>Mon May  5 05:12:28 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027829.html">[Mono-dev] Difficulties with charset on asp.net applications and mod_mono with 1.9.1, most non-ASCII chars appear as ??
</A></li>
        <LI>Next message: <A HREF="027770.html">[Mono-dev] debug mono embedded
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27767">[ date ]</a>
              <a href="thread.html#27767">[ thread ]</a>
              <a href="subject.html#27767">[ subject ]</a>
              <a href="author.html#27767">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

These patches contain some fixes that seem to be required for MSVCRT 
support.

Note that I wasn't able to execute even a simle Hello World application that 
uses MSVCRT yet but made some progress with these fixes.

The most weird thing is that when the assembly is compiled as pure IL MSVC++ 
still uses vtfixup. But not the usual way. It uses ResolveMethodHandle along 
with GetFunctionPointer that is basically the same thing that vtfixup is 
without the marshaling.

Even worse, MSVC++ assumes that static fields with and RVA point to the 
actual PE image. The thable it uses for resolving method is not defined 
properly in the CLI image but only it's start and end is defined. This even 
breaks ildasm-ilasm round trip but MSVC++ assumes this. The mini.c and 
jit-icalls.c is supposed to support this but I know that this would break 
other platforms maybe even x86 Windows as well.

MSVC++ also generates code that marshals pointers.

Korn&#233;l 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: msvcrt_partial.diff.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080505/9430e4f7/attachment.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080505/9430e4f7/attachment.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: msvcrt_mcs.diff.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080505/9430e4f7/attachment-0001.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080505/9430e4f7/attachment-0001.txt</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027829.html">[Mono-dev] Difficulties with charset on asp.net applications and mod_mono with 1.9.1, most non-ASCII chars appear as ??
</A></li>
	<LI>Next message: <A HREF="027770.html">[Mono-dev] debug mono embedded
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27767">[ date ]</a>
              <a href="thread.html#27767">[ thread ]</a>
              <a href="subject.html#27767">[ subject ]</a>
              <a href="author.html#27767">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
