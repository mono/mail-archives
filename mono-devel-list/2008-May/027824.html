<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] How To Convince Mono To Allocate Big Arrays
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20To%20Convince%20Mono%20To%20Allocate%20Big%20Arrays&In-Reply-To=8cca42d80805071950q1f4e5b98t67f5ca3b030827e4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028094.html">
   <LINK REL="Next"  HREF="027826.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] How To Convince Mono To Allocate Big Arrays</H1>
    <B>Luis F. Ortiz</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20To%20Convince%20Mono%20To%20Allocate%20Big%20Arrays&In-Reply-To=8cca42d80805071950q1f4e5b98t67f5ca3b030827e4%40mail.gmail.com"
       TITLE="[Mono-dev] How To Convince Mono To Allocate Big Arrays">LuisOrtiz at verizon.net
       </A><BR>
    <I>Thu May  8 12:40:20 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028094.html">[Mono-dev] [PATCH] How To Convince Mono To Allocate Big Arrays
</A></li>
        <LI>Next message: <A HREF="027826.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27824">[ date ]</a>
              <a href="thread.html#27824">[ thread ]</a>
              <a href="subject.html#27824">[ subject ]</a>
              <a href="author.html#27824">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On May 7, 2008, at 10:50 PM, Rodrigo Kumpera wrote:
&gt;<i> Hi Luis,
</I>&gt;<i>
</I>&gt;<i> To have your patch integrated, some changes are needed. First, we  
</I>&gt;<i> want to default to 32bits sized arrays on 64bits machines, so your  
</I>&gt;<i> changes must be conditionally compiled. To help with that some  
</I>&gt;<i> changed to your patch are due. Next are some comments about it:
</I>&gt;<i>
</I>&gt;<i> Instead of replacing guint32 for gsize, it's better to create a new  
</I>&gt;<i> type, let's say array_size_t. This would reduce conditional  
</I>&gt;<i> compilation to fewer places.
</I>
Rodrigo:
	Permit me to reply to your message in parts, so that I clear on what  
needs to be done, from your point of view.

1) Add support for a new configuration argument to configure.in  
(AC_ARG_ENABLE(big-arrays,[ --enable-bug-arrays Enable allocation and  
indexing of arrays &gt; 31 bits in size.],...))
2) Add a compile time define (AC_DEFINE(BIG_ARRAYS,1,[Enable  
allocation and indexing of arrays &gt; 31 bits in size.]))
3) Use said compile time define to typedef array_size_t to either  
guint32 or guint64 depending on the state of BIG_ARRAYS in object.h
4) Use array_size_t where I used gsize in my patch.

Questions:

A) Do you agree then that the correct size types are either guint32 or  
guint64?
    Or would gint32 and gint64 be better choices as they would agree  
with the input arguments to ves_icall_System_Array_CreateInstanceImpl  
functions and the usage in socket-io.c?

B) Should the CreateInstanceImpl64 method definition in icall-def.h  
exist if BIG_ARRAYS is not defined.

C) In the case where BIG_ARRAYS is not defined,  should  
ves_icall_System_Array_CreateInstanceImpl64() still exist and make  
sure all arguments fit into the small guint32?

D) mono_array_size_t or array_size_t?   Without the mono prefix, i  
fear that some third-party library might also use the obvious name.   
Should the BIG_ARRAYS definition also use a MONO_ prefix?

/Ortiz/Luis





</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028094.html">[Mono-dev] [PATCH] How To Convince Mono To Allocate Big Arrays
</A></li>
	<LI>Next message: <A HREF="027826.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27824">[ date ]</a>
              <a href="thread.html#27824">[ thread ]</a>
              <a href="subject.html#27824">[ subject ]</a>
              <a href="author.html#27824">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
