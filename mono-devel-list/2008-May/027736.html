<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] JIT and Inlining - why doesn't it happen?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20JIT%20and%20Inlining%20-%20why%20doesn%27t%20it%20happen%3F&In-Reply-To=117799f00805010125wea17edcq75d9f243b39f49b7%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027735.html">
   <LINK REL="Next"  HREF="027737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] JIT and Inlining - why doesn't it happen?</H1>
    <B>Andreas Nahr</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20JIT%20and%20Inlining%20-%20why%20doesn%27t%20it%20happen%3F&In-Reply-To=117799f00805010125wea17edcq75d9f243b39f49b7%40mail.gmail.com"
       TITLE="[Mono-dev] JIT and Inlining - why doesn't it happen?">ClassDevelopment at A-SoftTech.com
       </A><BR>
    <I>Thu May  1 05:28:34 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027735.html">[Mono-dev] JIT and Inlining - why doesn't it happen?
</A></li>
        <LI>Next message: <A HREF="027737.html">[Mono-dev] JIT and Inlining - why doesn't it happen?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27736">[ date ]</a>
              <a href="thread.html#27736">[ thread ]</a>
              <a href="subject.html#27736">[ subject ]</a>
              <a href="author.html#27736">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I just checked the R01/R02 methods and they both have 20 IL instructions
with 22 bytes of IL code, so this is pretty much a corner case. However the
Ch method that you mention has a mere 9 IL instructions and only 9 bytes of
IL code, so this does not explain why it doesn't get inlined if the
threshold is 20 bytes of IL.

 

Greetings

Andreas

 

Von: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] Im Auftrag von Alan
McGovern
Gesendet: Donnerstag, 1. Mai 2008 10:26
An: Rodrigo Kumpera
Cc: mono-devel
Betreff: Re: [Mono-dev] JIT and Inlining - why doesn't it happen?

 

Hi,

That makes sense. I was just quite surprised at the time that the methods
were not being inlined as they were only simple maths operations. I checked
monodis for one of the methods and it turned out to be 8 IL instructions,
which is probably 24 bytes, which would explain why it wasn't inlined.

Alan.

On Thu, May 1, 2008 at 12:24 AM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:

Well, the inliner basically eliminates the penalty from using properties and
empty constructors.

Increasing the inline threshold is tricky and might now be worthy as there
are too many situations that abort inlining. So it would significantly
increase JIT time for diminishing gains.





On Wed, Apr 30, 2008 at 6:38 PM, Alan McGovern &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">alan.mcgovern at gmail.com</A>&gt;
wrote:

This method does not get inlined:

private uint Ch (uint u, uint v, uint w) 
{
    return (u&amp;v) ^ (~u&amp;w);
}

If that isn't inlined then don't ask me what kind of method *could* be
inlined by the JIT.

Alan.

 

On Wed, Apr 30, 2008 at 11:32 PM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:

Mono only inline very short methods. Right now methods must have a body at
most 20 bytes long.




2008/4/30 Alan McGovern &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">alan.mcgovern at gmail.com</A>&gt;:

I recently started doing a bit of optimisation work on the
hashing/cryptography classes in mono. When working on the managed SHA256
class[1], i noticed that mono isn't inlining what i'd consider some *very*
simple methods.

The helper methods which do the bitshifting (Ro0, Ro1, Ch, Maj etc) aren't
inlined! Each of these methods is only called once in the code. By manually
inlining those method calls, performance increased significantly - about
70%. Why isn't mono inlining these methods? Can mono be made inline these?

Alan.

[1]<A HREF="http://anonsvn.mono-project.com/viewcvs/trunk/mcs/class/corlib/System.Sec">http://anonsvn.mono-project.com/viewcvs/trunk/mcs/class/corlib/System.Sec</A>
urity.Cryptography/SHA256Managed.cs?rev=46462
&lt;<A HREF="http://anonsvn.mono-project.com/viewcvs/trunk/mcs/class/corlib/System.Secur">http://anonsvn.mono-project.com/viewcvs/trunk/mcs/class/corlib/System.Secur</A>
ity.Cryptography/SHA256Managed.cs?rev=46462&amp;view=markup&gt; &amp;view=markup

_______________________________________________
Mono-devel-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>

 

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080501/4fa352ab/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080501/4fa352ab/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027735.html">[Mono-dev] JIT and Inlining - why doesn't it happen?
</A></li>
	<LI>Next message: <A HREF="027737.html">[Mono-dev] JIT and Inlining - why doesn't it happen?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27736">[ date ]</a>
              <a href="thread.html#27736">[ thread ]</a>
              <a href="subject.html#27736">[ subject ]</a>
              <a href="author.html#27736">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
