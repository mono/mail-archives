<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] How To Convince Mono To Allocate Big Arrays
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20To%20Convince%20Mono%20To%20Allocate%20Big%20Arrays&In-Reply-To=8cca42d80805160753h2d1a70a0j1d6d3f3db823e428%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027930.html">
   <LINK REL="Next"  HREF="028047.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] How To Convince Mono To Allocate Big Arrays</H1>
    <B>Luis F. Ortiz</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20To%20Convince%20Mono%20To%20Allocate%20Big%20Arrays&In-Reply-To=8cca42d80805160753h2d1a70a0j1d6d3f3db823e428%40mail.gmail.com"
       TITLE="[Mono-dev] How To Convince Mono To Allocate Big Arrays">LuisOrtiz at verizon.net
       </A><BR>
    <I>Fri May 23 18:10:33 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="027930.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
        <LI>Next message: <A HREF="028047.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27995">[ date ]</a>
              <a href="thread.html#27995">[ thread ]</a>
              <a href="subject.html#27995">[ subject ]</a>
              <a href="author.html#27995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rodrigo:
     Sorry for the delayed response, things got busy, and I did not  
notice your message.
Please go ahead and check in the parts that you feel most comfortable  
with, since I do not
have commit rights.   I'll adapt any further submissions against the  
next official cut.

    The changes I have made are to be released under the X11 license  
and I vouch that
I have talked to the appropriate people at my employer (Interactive  
Supercomputing) and
they agree as well to release this and any further contributions I  
make to Mono while
under their employ under the X11 license.   There, that ought to make  
everybody happy.

Luis F. Ortiz


On May 16, 2008, at 10:53 AM, Rodrigo Kumpera wrote:\
&gt;<i> Hi Luis,
</I>&gt;<i>
</I>&gt;<i> Most parts of your patch are ok to be commited. As I said before,  
</I>&gt;<i> it's better to have separate patches to speed up the review. As you  
</I>&gt;<i> get more changes in, it will ease your work on preparing patches and  
</I>&gt;<i> will ease on tracking head changes.
</I>&gt;<i>
</I>&gt;<i> Right now I'm ok with the configure, mono_array_t and related  
</I>&gt;<i> changes. These were easy to review and don't introduce any change in  
</I>&gt;<i> behavior, so we can check-in then right now. The others requires  
</I>&gt;<i> more testing from me and would be easier to both of us if done after.
</I>&gt;<i> Do you mind cooking you a patch only with the ok parts.
</I>&gt;<i>
</I>&gt;<i> Remember that you need to either release these changes under the X11  
</I>&gt;<i> license or have done some copyright assignment paperwork.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Rodrigo
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, May 8, 2008 at 8:21 PM, Luis F. Ortiz  
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">LuisOrtiz at verizon.net</A>&gt; wrote:
</I>&gt;<i> On May 8, 2008, at 9:29 AM, Rodrigo Kumpera wrote:
</I>&gt;<i> One important thing I forgot. If you break your patch into a few  
</I>&gt;<i> smaller ones the review process will be a lot easier to every one  
</I>&gt;<i> involved.
</I>&gt;<i> The first one can introduce new types and configuration foo; then  
</I>&gt;<i> other to fix codegen and Array methods and; at last, a bunch of  
</I>&gt;<i> fixes to classlib issues -like sockets, file i/o and so on.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Rodrigo
</I>&gt;<i>
</I>&gt;<i> OK, here is another stab at the changes.
</I>&gt;<i>
</I>&gt;<i> This modifies the following files:
</I>&gt;<i>        configure.in
</I>&gt;<i>
</I>&gt;<i>        mono/metadata/object.c
</I>&gt;<i>        mono/metadata/object.h
</I>&gt;<i>        mono/metadata/icall-def.h
</I>&gt;<i>        mono/metadata/icall.c
</I>&gt;<i>        mono/metadata/socket-io.c
</I>&gt;<i>
</I>&gt;<i> These files:
</I>&gt;<i>  1) Add a new configuration option, --enable-big-arrays, which  
</I>&gt;<i> defines conditionally defines MONO_BIG_ARRAYS in config.h,
</I>&gt;<i>  2) Add in mono/metadata/object.h :
</I>&gt;<i>  A) A new typedef for mono_array_size_t to be either guint32 or  
</I>&gt;<i> guint64
</I>&gt;<i>  B) A new #define for MONO_ARRAY_MAX_INDEX for the biggest valid  
</I>&gt;<i> array index, i.e. G_MAXINTxx
</I>&gt;<i>  C) A new #define for MONO_ARRAY_MAX_SIZE for the biggest valid  
</I>&gt;<i> array allocation, i.e. G_MAXUINTxx
</I>&gt;<i>  D) The above all controlled by MONO_BIG_ARRAYS
</I>&gt;<i>  3) Modify the definitions of mono_array_new(),  
</I>&gt;<i> mono_array_new_full(), and mono_array_new_specific() to match,
</I>&gt;<i>  4) Modify the usages of those functions in the metadata directory  
</I>&gt;<i> to match,
</I>&gt;<i>  5) Add range checking in  
</I>&gt;<i> ves_icall_System_Array_CreateInstanceImpl64 so it works with or  
</I>&gt;<i> without MONO_BIG_ARRAYS,
</I>&gt;<i>  6) Attempt to address all the mistakes you pointed out.
</I>&gt;<i>
</I>&gt;<i> These changes, in addition to the other changes I made, pass &quot;make  
</I>&gt;<i> check&quot; with the exception of Tests.test_0_regress_75832(), as  
</I>&gt;<i> previously confessed.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> /Ortiz/Luis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080523/d3b96fb2/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080523/d3b96fb2/attachment-0001.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027930.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
	<LI>Next message: <A HREF="028047.html">[Mono-dev] How To Convince Mono To Allocate Big Arrays
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27995">[ date ]</a>
              <a href="thread.html#27995">[ thread ]</a>
              <a href="subject.html#27995">[ subject ]</a>
              <a href="author.html#27995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
