<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mkbundle --cross
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20mkbundle%20--cross&In-Reply-To=%3Ca94e6a55-fbee-433f-9c3e-01587779e1fe%40libero.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044428.html">
   <LINK REL="Next"  HREF="044429.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mkbundle --cross</H1>
    <B>dmaxime</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20mkbundle%20--cross&In-Reply-To=%3Ca94e6a55-fbee-433f-9c3e-01587779e1fe%40libero.it%3E"
       TITLE="[Mono-dev] mkbundle --cross">dmaxime at libero.it
       </A><BR>
    <I>Thu Jun 29 15:11:45 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044428.html">[Mono-dev] mkbundle --cross
</A></li>
        <LI>Next message (by thread): <A HREF="044429.html">[Mono-dev] Mono packaging location?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44433">[ date ]</a>
              <a href="thread.html#44433">[ thread ]</a>
              <a href="subject.html#44433">[ subject ]</a>
              <a href="author.html#44433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, David,
I followed your advice and now my program runs fine on mac but I found 
other issues I would like to point out to you::

If there are dlls with the same name in the current folder, mkbundle 
ignores the path on the command line (look path of System.dll):

$ mkbundle --deps --static --cross mono-5.0.1-osx-10.7-i386.zip -o 
launcher-mac CHElauncher.exe 
/home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/System.dll
From: /home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip
Using runtime: /home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/bin/mono
      Assembly: /home/jak/mac/CHElauncher
      Assembly: /home/jak/mac/System.dll
      Assembly: 
/home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/I18N.West.dll
      Assembly: 
/home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/I18N.dll
Generated launcher-mac

(now I remove local file System.dll)

$ rm System.dll

$ mkbundle --deps --static --cross mono-5.0.1-osx-10.7-i386.zip -o 
launcher-mac CHElauncher.exe 
/home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/System.dll
From: /home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip
Using runtime: /home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/bin/mono
      Assembly: /home/jak/mac/CHElauncher
      Assembly: 
/home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/System.dll
      Assembly: 
/home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/I18N.West.dll
      Assembly: 
/home/jak/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/I18N.dll
Generated launcher-mac

Also, I've looked at mkbundle source code on 
<A HREF="https://github.com/mono/mono/blob/master/mcs/tools/mkbundle/mkbundle.cs.">https://github.com/mono/mono/blob/master/mcs/tools/mkbundle/mkbundle.cs.</A> 
I do not have the ability to use debugging tools on it, but it seems 
that in the QueueAssembly function, the first time recursively called, 
the first if is satisfied, so it ends up returning true, true again and 
stops its work. To follow, I send you the piece of code that I used to 
find out about the dependencies of my program. It is not recursive and 
seems to do its job properly. I've grubbed it here: 
<A HREF="https://stackoverflow.com/questions/851248/c-sharp-reflection-get-all-active-assemblies-in-a-solution">https://stackoverflow.com/questions/851248/c-sharp-reflection-get-all-active-assemblies-in-a-solution</A> 
.

         staticintMain(string[]args)
{
List&lt;string&gt;ass_name=newList&lt;string&gt;();

try
{
foreach(var e inGetAssemblies(@args[0]))
ass_name.Add(e.GetName().Name);

foreach(var e inass_name)
Console.WriteLine(e);
}
catch(Exception e)
{
Console.WriteLine(&quot;Anexceptionoccurred:{0}&quot;,e.Message);
return1;
}
return0;
}

publicstaticIEnumerable&lt;Assembly&gt;GetAssemblies(stringfname)
{
varlist=newList&lt;string&gt;();
varstack=newStack&lt;Assembly&gt;();
Assemblyasm=null;
stack.Push(Assembly.LoadFile(fname));

do
{
asm=stack.Pop();

yieldreturnasm;

foreach(var reference inasm.GetReferencedAssemblies())
{
if(!list.Contains(reference.FullName))
{
stack.Push(Assembly.Load(reference));
list.Add(reference.FullName);
}
}
}
while(stack.Count&gt;0);
}

I noticed another thing in mkbundle source code: the VerifySdk function 
verifies the presence of the runtime in sdk_path/bin/mono but in the 
windows environment there is no file called 'mono' in the folder, there 
is only mono.exe

Thank you again for your attention.
Greetings.

Il 27/06/2017 14:06, David Curylo ha scritto:
&gt;<i> You need to also add System.dll to the command line, and you’ll find 
</I>&gt;<i> that you have to add all of those other libraries, as well as possibly 
</I>&gt;<i> a few other that are under /usr/lib/mono/4.5/Facades if you use things 
</I>&gt;<i> like from those libraries like TaskExtensions from 
</I>&gt;<i> System.Threading.Tasks.dll.  According to the docs, --deps is supposed 
</I>&gt;<i> to discover those, but I’ve never been able to get it to find them 
</I>&gt;<i> even though things are directly referenced (not loading by reflection 
</I>&gt;<i> or anything).
</I>&gt;<i>
</I>&gt;<i> I think you also need the --static flag to embed the mono runtime 
</I>&gt;<i> libraries.
</I>&gt;<i>
</I>&gt;&gt;<i> On Jun 27, 2017, at 5:27 AM, dmaxime via Mono-devel-list 
</I>&gt;&gt;<i> &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list at lists.dot.net</A> 
</I>&gt;&gt;<i> &lt;mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list at lists.dot.net</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hello everybody,
</I>&gt;&gt;<i> I would like to build a 'all in one' OSX program from linux (ubuntu).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is the linux version I'm using:
</I>&gt;&gt;<i> Linux  4.4.0-81-generic #104-Ubuntu SMP Wed Jun 14 08:17:06 UTC 2017 
</I>&gt;&gt;<i> x86_64 x86_64 x86_64 GNU/Linux
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This and the Mono version installed:
</I>&gt;&gt;<i> Mono JIT compiler version 5.0.1.1 (2017-02/5077205 Thu May 25 
</I>&gt;&gt;<i> 09:16:53 UTC 2017)
</I>&gt;&gt;<i> Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. 
</I>&gt;&gt;<i> www.mono-project.com
</I>&gt;&gt;<i>     TLS:           __thread
</I>&gt;&gt;<i>     SIGSEGV:       altstack
</I>&gt;&gt;<i>     Notifications: epoll
</I>&gt;&gt;<i>     Architecture:  amd64
</I>&gt;&gt;<i>     Disabled:      none
</I>&gt;&gt;<i>     Misc:          softdebug
</I>&gt;&gt;<i>     LLVM:          supported, not enabled.
</I>&gt;&gt;<i>     GC:            sgen (concurrent by default)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> These are the necessary frameworks to run my program:
</I>&gt;&gt;<i>     Microsoft.CSharp.dll
</I>&gt;&gt;<i>     System.Configuration.dll
</I>&gt;&gt;<i>     System.Data.DataSetExtensions.dll
</I>&gt;&gt;<i>     System.Data.dll
</I>&gt;&gt;<i>     System.Deployment.dll
</I>&gt;&gt;<i>     System.dll
</I>&gt;&gt;<i>     System.Drawing.dll
</I>&gt;&gt;<i>     System.IO.Compression.dll
</I>&gt;&gt;<i>     System.IO.Compression.FileSystem.dll
</I>&gt;&gt;<i> System.Net &lt;<A HREF="http://system.net">http://system.net</A>&gt;.Http.dll
</I>&gt;&gt;<i>     System.Runtime.Serialization.dll
</I>&gt;&gt;<i>     System.Web.dll
</I>&gt;&gt;<i>     System.Web.Extensions.dll
</I>&gt;&gt;<i>     System.Windows.Forms.dll
</I>&gt;&gt;<i>     System.Xml.dll
</I>&gt;&gt;<i>     System.Xml.Linq.dll
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I took the following environments using the command &quot;mkbundle 
</I>&gt;&gt;<i> --fetch-target&quot;:
</I>&gt;&gt;<i> mono-5.0.1-osx-10.7-i386.zip
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I ran the build, using mkbundle, with the following command:
</I>&gt;&gt;<i> $ mkbundle --deps --cross mono-5.0.1-osx-10.7-i386.zip -o 
</I>&gt;&gt;<i> launcher-mac CHElauncher.exe
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And this is the resulting output:
</I>&gt;&gt;<i> From: ~/.mono/targets/mono-5.0.1-osx-10.7-i386.zip
</I>&gt;&gt;<i> Using runtime: ~/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/bin/mono
</I>&gt;&gt;<i>     Assembly: ~/mac/CHElauncher.exe
</I>&gt;&gt;<i>     Assembly: 
</I>&gt;&gt;<i> ~/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/I18N.West.dll
</I>&gt;&gt;<i>     Assembly: 
</I>&gt;&gt;<i> ~/.mono/targets/mono-5.0.1-osx-10.7-i386.zip/lib/mono/4.5/I18N.dll
</I>&gt;&gt;<i> Generated launcher-mac
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that my program runs fine in windows, linux and mac environments 
</I>&gt;&gt;<i> but when I move the resulting file from the build to the mac pc, 
</I>&gt;&gt;<i> where no mono environment is installed, and run it, I get the 
</I>&gt;&gt;<i> following error:
</I>&gt;&gt;<i> $ ./CHElauncher.exe
</I>&gt;&gt;<i> The assembly mscorlib.dll was not found or could not be loaded.
</I>&gt;&gt;<i> It should have been installed in the 
</I>&gt;&gt;<i> `/Library/Frameworks/Mono.framework/Versions/5.0.1/lib/mono/4.5/mscorlib.dll' 
</I>&gt;&gt;<i> directory.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I also tried to add mscorlib.dll to the command line mkbundle and I 
</I>&gt;&gt;<i> received this error:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Unhandled Exception:
</I>&gt;&gt;<i> System.IO.FileNotFoundException: Could not load file or assembly 
</I>&gt;&gt;<i> 'System, Version=4.0.0.0, Culture=neutral, 
</I>&gt;&gt;<i> PublicKeyToken=b77a5c561934e089' or one of its dependencies.
</I>&gt;&gt;<i> File name: 'System, Version=4.0.0.0, Culture=neutral, 
</I>&gt;&gt;<i> PublicKeyToken=b77a5c561934e089'
</I>&gt;&gt;<i> [ERROR] FATAL UNHANDLED EXCEPTION: System.IO.FileNotFoundException: 
</I>&gt;&gt;<i> Could not load file or assembly 'System, Version=4.0.0.0, 
</I>&gt;&gt;<i> Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its 
</I>&gt;&gt;<i> dependencies.
</I>&gt;&gt;<i> File name: 'System, Version=4.0.0.0, Culture=neutral, 
</I>&gt;&gt;<i> PublicKeyToken=b77a5c561934e089'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Could you explain to me what I'm wrong?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks in advance for your attention.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A> &lt;mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">http://lists.dot.net/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20170629/b102d2cc/attachment-0001.html">http://lists.dot.net/pipermail/mono-devel-list/attachments/20170629/b102d2cc/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044428.html">[Mono-dev] mkbundle --cross
</A></li>
	<LI>Next message (by thread): <A HREF="044429.html">[Mono-dev] Mono packaging location?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44433">[ date ]</a>
              <a href="thread.html#44433">[ thread ]</a>
              <a href="subject.html#44433">[ subject ]</a>
              <a href="author.html#44433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
