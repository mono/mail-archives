<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Problem with CA sending certified emails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Problem%20with%20CA%20sending%20certified%20emails&In-Reply-To=MAILSERVERE8DzHx63R00000599%40mail.apsystems.it">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035280.html">
   <LINK REL="Next"  HREF="035283.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Problem with CA sending certified emails</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Problem%20with%20CA%20sending%20certified%20emails&In-Reply-To=MAILSERVERE8DzHx63R00000599%40mail.apsystems.it"
       TITLE="[Mono-dev] Problem with CA sending certified emails">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Tue Jun 22 07:49:02 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035280.html">[Mono-dev] Problem with CA sending certified emails
</A></li>
        <LI>Next message: <A HREF="035283.html">[Mono-dev] Problem with CA sending certified emails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35281">[ date ]</a>
              <a href="thread.html#35281">[ thread ]</a>
              <a href="subject.html#35281">[ subject ]</a>
              <a href="author.html#35281">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Installing CA certificate(s) won't create a trust relationship. For this
you need to install the root certificate in the Trust store (that's what
mozroots does, but that's not what you're doing with certmgr).

Make sure you get the root certificate (generally the one that is
signing the CA certificate) and use 'Trust' instead of 'CA' with
certmgr.

Sebastien

On Mon, 2010-06-21 at 17:22 +0200, APS wrote:
&gt;<i> I forgot to say that I'm using Mono 2.6.4 VM and it works for google 
</I>&gt;<i> but not for another provider (Actalis).
</I>&gt;<i> 
</I>&gt;<i> At 17.09 21/06/2010, you wrote:
</I>&gt;<i> &gt;Hello,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I tried replacing the Mono.Security.dll file with the one from 2.6, it
</I>&gt;<i> &gt;didn't work for me:
</I>&gt;<i> &gt;<A HREF="http://stackoverflow.com/questions/2884290/ssl-authentication-error-remotecertificatechainerrors-on-asp-net-on-ubuntu">http://stackoverflow.com/questions/2884290/ssl-authentication-error-remotecertificatechainerrors-on-asp-net-on-ubuntu</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I tried having a parallel installation of 2.6, and redirecting
</I>&gt;<i> &gt;mod_mono to use the new one, it didn't work for me:
</I>&gt;<i> &gt;<A HREF="http://lists.ximian.com/pipermail/mono-aspnet-list/2010-March/000668.html">http://lists.ximian.com/pipermail/mono-aspnet-list/2010-March/000668.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;My next attempt is to use <A HREF="http://badgerports.org/">http://badgerports.org/</A> to upgrade the whole
</I>&gt;<i> &gt;thing to 2.6. My current workaround is to use:
</I>&gt;<i> &gt;<A HREF="http://ubuntu-tutorials.com/2008/11/11/relaying-postfix-smtp-via-smtpgmailcom/">http://ubuntu-tutorials.com/2008/11/11/relaying-postfix-smtp-via-smtpgmailcom/</A>
</I>&gt;<i> &gt;and send mail to localhost.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Joe
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Message: 3
</I>&gt;<i> &gt; &gt; Date: Mon, 21 Jun 2010 11:52:38 +0200
</I>&gt;<i> &gt; &gt; From: APS &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dev.malst at apsystems.it</A>&gt;
</I>&gt;<i> &gt; &gt; Subject: [Mono-dev] Problem with CA sending certified emails
</I>&gt;<i> &gt; &gt; To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; Message-ID: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">MAILSERVERDIfWb4SaF00000580 at mail.apsystems.it</A>&gt;
</I>&gt;<i> &gt; &gt; Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Hi everyone,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I need your help cause I've problems sending certified mail with mono
</I>&gt;<i> &gt; &gt; and a specific provider.
</I>&gt;<i> &gt; &gt; I tried with gmail as explained in
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &lt;<A HREF="http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F">http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F</A>&gt;<A HREF="http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F">http://www.mono-project.com/FAQ:_Security#Does_SSL_works_for_SMTP.2C_like_GMail_.3F</A>
</I>&gt;<i> &gt; &gt; and it works.
</I>&gt;<i> &gt; &gt; Using same code with another local email provider also works.
</I>&gt;<i> &gt; &gt; Using same code with a third email provider in windows I have to
</I>&gt;<i> &gt; &gt; manually install the CA certificate, if I do that in local computer
</I>&gt;<i> &gt; &gt; store I'm able to send certified mails.
</I>&gt;<i> &gt; &gt; In mono I installed the CA certificate using
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; certmgr --add -c -m CA /tmp/certca.crt
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; but sending mails I receive the following error, if I launch
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; certmgr -list -c -m CA
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I see the gmail certificate and my new certificate, what I'm doing wrong?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Here is the error.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; System.Net.Mail.SmtpException: Message could not be sent. ---&gt;
</I>&gt;<i> &gt; &gt; System.IO.IOException: The authentication or decryption has failed.
</I>&gt;<i> &gt; &gt; ---&gt; System.InvalidOperationException: SSL authentication error:
</I>&gt;<i> &gt; &gt; RemoteCertificateNotAvailable, RemoteCertificateChainErrors
</I>&gt;<i> &gt; &gt;   at System.Net.Mail.SmtpClient.&lt;callback&gt;m__3 (System.Object
</I>&gt;<i> &gt; &gt; sender, System.Security.Cryptography.X509Certificates.X509Certificate
</I>&gt;<i> &gt; &gt; certificate, System.Security.Cryptography.X509Certificates.X509Chain
</I>&gt;<i> &gt; &gt; chain, SslPolicyErrors sslPolicyErrors) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; System.Net.Security.SslStream+&lt;BeginAuthenticateAsClient&gt;c__AnonStorey7.&lt;&gt;m__9
</I>&gt;<i> &gt; &gt; (System.Security.Cryptography.X509Certificates.X509Certificate cert,
</I>&gt;<i> &gt; &gt; System.Int32[] certErrors) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; Mono.Security.Protocol.Tls.SslClientStream.OnRemoteCertificateValidation
</I>&gt;<i> &gt; &gt; (System.Security.Cryptography.X509Certificates.X509Certificate
</I>&gt;<i> &gt; &gt; certificate, System.Int32[] errors) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; Mono.Security.Protocol.Tls.SslStreamBase.RaiseRemoteCertificateValidation
</I>&gt;<i> &gt; &gt; (System.Security.Cryptography.X509Certificates.X509Certificate
</I>&gt;<i> &gt; &gt; certificate, System.Int32[] errors) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; Mono.Security.Protocol.Tls.SslClientStream.RaiseServerCertificateValidation
</I>&gt;<i> &gt; &gt; (System.Security.Cryptography.X509Certificates.X509Certificate
</I>&gt;<i> &gt; &gt; certificate, System.Int32[] certificateErrors) [0x00000] in &lt;filename
</I>&gt;<i> &gt; &gt; unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.validateCertificates
</I>&gt;<i> &gt; &gt; (Mono.Security.X509.X509CertificateCollection certificates) [0x00000]
</I>&gt;<i> &gt; &gt; in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; Mono.Security.Protocol.Tls.Handshake.Client.TlsServerCertificate.ProcessAsTls1
</I>&gt;<i> &gt; &gt; () [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at Mono.Security.Protocol.Tls.Handshake.HandshakeMessage.Process
</I>&gt;<i> &gt; &gt; () [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at (wrapper remoting-invoke-with-check)
</I>&gt;<i> &gt; &gt; Mono.Security.Protocol.Tls.Handshake.HandshakeMessage:Process ()
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; Mono.Security.Protocol.Tls.ClientRecordProtocol.ProcessHandshakeMessage
</I>&gt;<i> &gt; &gt; (Mono.Security.Protocol.Tls.TlsStream handMsg) [0x00000] in &lt;filename
</I>&gt;<i> &gt; &gt; unknown&gt;:0
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; Mono.Security.Protocol.Tls.RecordProtocol.InternalReceiveRecordCallback
</I>&gt;<i> &gt; &gt; (IAsyncResult asyncResult) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   --- End of inner exception stack trace ---
</I>&gt;<i> &gt; &gt;   at Mono.Security.Protocol.Tls.SslStreamBase.AsyncHandshakeCallback
</I>&gt;<i> &gt; &gt; (IAsyncResult asyncResult) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt;   --- End of inner exception stack trace ---
</I>&gt;<i> &gt; &gt;   at System.Net.Mail.SmtpClient.Send (System.Net.Mail.MailMessage
</I>&gt;<i> &gt; &gt; message) [0x00000] in &lt;filename unknown&gt;:0
</I>&gt;<i> &gt; &gt; -------------- next part --------------
</I>&gt;<i> &gt; &gt; An HTML attachment was scrubbed...
</I>&gt;<i> &gt; &gt; URL: 
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100621/ff8290df/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100621/ff8290df/attachment-0001.html</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;_______________________________________________
</I>&gt;<i> &gt;Mono-devel-list mailing list
</I>&gt;<i> &gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;--
</I>&gt;<i> &gt;Il messaggio e' stato analizzato alla ricerca di virus o
</I>&gt;<i> &gt;contenuti pericolosi da MailScanner, ed e'
</I>&gt;<i> &gt;risultato non infetto.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035280.html">[Mono-dev] Problem with CA sending certified emails
</A></li>
	<LI>Next message: <A HREF="035283.html">[Mono-dev] Problem with CA sending certified emails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35281">[ date ]</a>
              <a href="thread.html#35281">[ thread ]</a>
              <a href="subject.html#35281">[ subject ]</a>
              <a href="author.html#35281">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
