<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Arm9 NS9215 floating point troubles
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Arm9%20NS9215%20floating%20point%20troubles&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035282.html">
   <LINK REL="Next"  HREF="035238.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Arm9 NS9215 floating point troubles</H1>
    <B>Trevor Ackerman</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Arm9%20NS9215%20floating%20point%20troubles&In-Reply-To="
       TITLE="[Mono-dev] Arm9 NS9215 floating point troubles">t_ackerman at yahoo.com
       </A><BR>
    <I>Thu Jun 17 12:07:28 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035282.html">[Mono-dev] mach kernel support for sgen
</A></li>
        <LI>Next message: <A HREF="035238.html">[Mono-dev] Arm9 NS9215 floating point troubles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35237">[ date ]</a>
              <a href="thread.html#35237">[ thread ]</a>
              <a href="subject.html#35237">[ subject ]</a>
              <a href="author.html#35237">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have been able to cross-compile Mono 2.6.4 for the NS9215 (no fpu 
afaik) and I'm having trouble with floats when executing code.

I 
thought I had correctly specified soft-float and indeed mono tells me so

~
 # /usr/local/bin/mono -V
Mono JIT compiler version 2.6.4 (tarball 
Wed Jun 16 14:55:33 MDT 2010)
Copyright (C) 2002-2010 Novell, Inc and
 Contributors. www.mono-project.com
&#160;&#160;&#160;&#160;&#160;&#160;&#160;
 TLS:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; normal
&#160;&#160;&#160;&#160;&#160;&#160;&#160; GC:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Included Boehm (with 
typed GC and Parallel Mark)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; SIGSEGV:&#160;&#160;&#160;&#160;&#160;&#160; normal
&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
Notifications:
 epoll
&#160;&#160;&#160;&#160;&#160;&#160;&#160; Architecture:&#160; arm,soft-float
&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
Disabled:&#160;&#160;&#160;&#160;&#160; none
~ # 

However the following code produces 
grossly wrong results

using System;

public class FloatTest
{
&#160;&#160;&#160;&#160;&#160;&#160;&#160;
 static public void Main()
&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
Console.WriteLine(&quot;0.0f literal is &quot; + 0.0f);
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
Console.WriteLine(&quot;1.0f literal is &quot; + 1.0f);
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
Console.WriteLine(&quot;12.3f literal is &quot; + 12.3f);
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
Console.WriteLine(&quot;32f
 literal is &quot; + 32f);
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Console.WriteLine(&quot;1024f 
literal is &quot; + 1024f);
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Console.WriteLine(&quot;32768f 
literal is &quot; + 32768f);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
}

Here are the results

~
 # /usr/local/bin/mono FloatTest.exe
0.0f literal is 0
1.0f 
literal is 5.299809E-315
12.3f literal is -1.491669E-154
32f 
literal is 5.325712E-315
1024f literal is 5.351615E-315
32768f 
literal is 5.377519E-315

my configure command is
./configure 
--host=arm-linux --with-tls=pthread --with-moonlight=no 
--with-mcs-docs=no

summary from running config is

&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
mcs source:&#160;&#160;&#160; $(top_srcdir)/mcs
&#160;&#160;&#160;&#160;&#160;&#160;&#160; olive source:&#160;
 

&#160;&#160;&#160;&#160;&#160;&#160;&#160; GC:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; included
&#160;&#160;&#160;&#160;&#160;&#160;&#160; GLIB:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
system
&#160;&#160;&#160;&#160;&#160;&#160;&#160; TLS:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; pthread
&#160;&#160;&#160;&#160;&#160;&#160;&#160; SIGALTSTACK:&#160;&#160; yes
&#160;&#160;&#160;&#160;&#160;&#160;&#160;
 Engine:&#160;&#160;&#160;&#160;&#160;&#160;&#160; Building and using the JIT
&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2.0 Profile:&#160;&#160; yes
&#160;&#160;&#160;&#160;&#160;&#160;&#160;
 Moon Profile:&#160; no
&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4.0 Alpha:&#160;&#160;&#160;&#160; no
&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
MonoTouch:&#160;&#160;&#160;&#160; no
&#160;&#160;&#160;&#160;&#160;&#160;&#160; JNI support:&#160;&#160; IKVM
 Native
&#160;&#160;&#160;&#160;&#160;&#160;&#160; libgdiplus:&#160;&#160;&#160; assumed to be installed
&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
zlib:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; system zlib
&#160;&#160;&#160;&#160;&#160;&#160;&#160; oprofile:&#160;&#160;&#160;&#160;&#160; no
&#160;&#160;&#160;&#160;&#160;&#160;&#160; 
BigArrays:&#160;&#160;&#160;&#160; no
&#160;&#160;&#160;&#160;&#160;&#160;&#160; DTrace:&#160;&#160;&#160;&#160;&#160;&#160;&#160; no
&#160;&#160;&#160;&#160;&#160;&#160;&#160; Parallel Mark:
 yes
&#160;&#160;&#160;&#160;&#160;&#160;&#160; LLVM Back End: no

My CFLAGS and CPPFLAGS environment variables are
 both
-DARM_FPU_NONE=1 -DMONO_ARCH_SOFT_FLOAT=1

Any insight 
would be greatly appreciated, I've looked at some of the code in the 
mono/mini directory but cannot make sense of how float values are 
getting generated.

TIA


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100617/9490734c/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100617/9490734c/attachment.html</A> 
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035282.html">[Mono-dev] mach kernel support for sgen
</A></li>
	<LI>Next message: <A HREF="035238.html">[Mono-dev] Arm9 NS9215 floating point troubles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35237">[ date ]</a>
              <a href="thread.html#35237">[ thread ]</a>
              <a href="subject.html#35237">[ subject ]</a>
              <a href="author.html#35237">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
