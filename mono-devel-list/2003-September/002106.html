<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Managed/Unmanaged Code Interop... v2.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Managed/Unmanaged%20Code%20Interop...%20v2.1&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002033.html">
   <LINK REL="Next"  HREF="002034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Managed/Unmanaged Code Interop... v2.1</H1>
    <B>Bernie Solomon</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Managed/Unmanaged%20Code%20Interop...%20v2.1&In-Reply-To="
       TITLE="[Mono-devel-list] Managed/Unmanaged Code Interop... v2.1">bernard at ugsolutions.com
       </A><BR>
    <I>Wed Sep 17 18:54:24 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002033.html">[Mono-devel-list] Managed/Unmanaged Code Interop... v2.1
</A></li>
        <LI>Next message: <A HREF="002034.html">[Mono-devel-list] Bugs in Enum conversion using TypeDescriptor and EnumConverter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2106">[ date ]</a>
              <a href="thread.html#2106">[ thread ]</a>
              <a href="subject.html#2106">[ subject ]</a>
              <a href="author.html#2106">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It has taken me a little while to get round to looking at this but having
read it I do have a few comments.

Firstly I think this is very useful to try and pin down as much as it can be
and document....

My comments are:

- For library names - you don't have much choice if your libraries have
different names on different platforms but to use mono's mapping mechanism -
but if they are the same bar extension (dll/so/sl) then I find it simpler to
just leave off the extension in the DllImport and it works on all platforms
&amp; .Net without any config changes:

[DllImport(&quot;libmine&quot;)] extern static int myFunc();

of course the case of the library has to match on Unix and doesn't matter on
Windows.

- You can access C++ if you really want - definitely for calls without
'this' and non-virtual calls would probably work- the problem here is the
name mangling in that you need to use the EntryPoint parameter and put in
the mangled name - and this is platform &amp; compiler dependent which makes
portability hard.

- Your section on StringBuilder should probably mention whatever the
interaction is with CharSet (I am not sure what that is off hand - would
require some experimentation).

- I am kind of interested why you'd use class marshalling not having thought
of needing it myself. struct marshalling is essential for talking to legacy
APIs but what can do you do with the managed class when it is in C/C++ (and
in any form of portable way???)

- The structure marshalling section says structs are typically on the stack
and passed by reference to the unmanaged function. This is only true for
struct which contains blittable types (if so implemented) so any member
which is a string or even a bool causes a copy. However .Net seems to copy
in/and out even if all you have is &quot;ref&quot; as the argumemt type.

- Mentioning that bool is special and if say you want to map it to an
unsigned char needs MarshalAs might make this more complete.

- Also in my .Net experimentation the runtime does seem to allocate space
for arrays in structs for &quot;out&quot; parameters.

- Finally anything which uses FieldOffset is impossible to be portable if
there are any pointers about in it and you need 64 bit platforms.

But it was useful to read and I learnt more about this area from what is
there....

Bernie Solomon

----- Original Message ----- 
From: &quot;Jonathan Pryor&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>&gt;
To: &quot;Mono List&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-list at ximian.com</A>&gt;; &quot;Mono Documentation&quot;
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-docs-list at lists.ximian.com</A>&gt;; &quot;Mono Development List&quot;
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Tuesday, September 09, 2003 7:55 PM
Subject: [Mono-devel-list] Managed/Unmanaged Code Interop... v2.1


&gt;<i> The latest draft for my managed/unmanaged code interop
</I>&gt;<i> documentation is available for perusal at:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.jprl.com/~jon/interop.html">http://www.jprl.com/~jon/interop.html</A>
</I>&gt;<i>
</I>&gt;<i> I feel like I'm writing a chapter for a book.  It would be nice,
</I>&gt;<i> actually; I have yet to see all this information in one place.
</I>&gt;<i>
</I>&gt;<i> Please review.  I'd like as many suggestions as possible.  You can
</I>&gt;<i> ignore the TODOs for now; some will be taken care of in the next draft.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>  - Jon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002033.html">[Mono-devel-list] Managed/Unmanaged Code Interop... v2.1
</A></li>
	<LI>Next message: <A HREF="002034.html">[Mono-devel-list] Bugs in Enum conversion using TypeDescriptor and EnumConverter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2106">[ date ]</a>
              <a href="thread.html#2106">[ thread ]</a>
              <a href="subject.html#2106">[ subject ]</a>
              <a href="author.html#2106">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
