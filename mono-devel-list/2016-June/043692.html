<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mono_add_internal_call to mscorlib method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20mono_add_internal_call%20to%20mscorlib%20method&In-Reply-To=%3C1465479475407-4667955.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043691.html">
   <LINK REL="Next"  HREF="043695.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mono_add_internal_call to mscorlib method</H1>
    <B>nicob</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20mono_add_internal_call%20to%20mscorlib%20method&In-Reply-To=%3C1465479475407-4667955.post%40n4.nabble.com%3E"
       TITLE="[Mono-dev] mono_add_internal_call to mscorlib method">nicolasbotto at gmail.com
       </A><BR>
    <I>Thu Jun  9 13:37:55 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043691.html">[Mono-dev] mono_add_internal_call to mscorlib method
</A></li>
        <LI>Next message: <A HREF="043695.html">[Mono-dev] mono_add_internal_call to mscorlib method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43692">[ date ]</a>
              <a href="thread.html#43692">[ thread ]</a>
              <a href="subject.html#43692">[ subject ]</a>
              <a href="author.html#43692">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Robert, thanks for the reply. I didn't explain my self correctly. Here's
an example, I have a c# assembly with a method that prints the args to the
console:

public void Print()
{
    string[] args = System.Environment.GetCommandLineArgs();
    System.Console.WriteLine(&quot;Length: &quot; + args.Length);
}

This assembly is loaded using the mono embedded API. I look for the method
print and I invoke it. This returns 0. 

The main issue here is that the System.Environment.GetCommandLineArgs() is
being used by the System.Diagnostics.Trace to get the Application Name,
therefore when you try it in an embedded scenario it blows up.

internal static string get_AppName()
{
    if (appName == null)
    {
        new EnvironmentPermission(EnvironmentPermissionAccess.Read,
&quot;Path&quot;).Assert();
        appName = Path.GetFileName(Environment.GetCommandLineArgs()[0]);
    }
    return appName;
}

As you can see Path.GetFileName(Environment.GetCommandLineArgs()[0]); throws
an exception:

System.IndexOutOfRangeException: Index was outside the bounds of the array.

This occurs because the native call is never invoked. That's the reason why
I'd like to add an icall and return an array so it doesn't fail. 

Please let me know if you need more info. Is you run this using the mono
command it works because the native call is being invoked, it fails in an
embedded scenario.

Thanks



--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/mono-add-internal-call-to-mscorlib-method-tp4667951p4667955.html">http://mono.1490590.n4.nabble.com/mono-add-internal-call-to-mscorlib-method-tp4667951p4667955.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043691.html">[Mono-dev] mono_add_internal_call to mscorlib method
</A></li>
	<LI>Next message: <A HREF="043695.html">[Mono-dev] mono_add_internal_call to mscorlib method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43692">[ date ]</a>
              <a href="thread.html#43692">[ thread ]</a>
              <a href="subject.html#43692">[ subject ]</a>
              <a href="author.html#43692">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
