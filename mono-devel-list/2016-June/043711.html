<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] DateTime.Now
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20DateTime.Now&In-Reply-To=%3CD3887960.6F828%25neale%40sinenomine.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043710.html">
   <LINK REL="Next"  HREF="043714.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] DateTime.Now</H1>
    <B>Neale Ferguson</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20DateTime.Now&In-Reply-To=%3CD3887960.6F828%25neale%40sinenomine.net%3E"
       TITLE="[Mono-dev] DateTime.Now">neale at sinenomine.net
       </A><BR>
    <I>Thu Jun 16 19:42:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043710.html">[Mono-dev] Race condition in named mutex
</A></li>
        <LI>Next message: <A HREF="043714.html">[Mono-dev] Bug preserving stack trace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43711">[ date ]</a>
              <a href="thread.html#43711">[ thread ]</a>
              <a href="subject.html#43711">[ subject ]</a>
              <a href="author.html#43711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>When DateTime.Now looks to adjust its value based on timezone (and
daylight saving requirements), it fetches a value UtcNow. This value is
obtained by a call to unmanaged code GetSystemTimeAsFileTime() which the
JIT maps to mono_100ns_datetime(). This routine uses gettimeofday() to
fetch the current time. However, this is the local time and it does not
adjust it to be UTC. So the comparison it makes in the test to see if the
datetime has transitioned to or from daylight saving or not is done
against local time and not UTC.


I have instrumented the code to show how the test against the rule appears
to be being made against local time and not UTC at
<A HREF="http://pastebin.ca/3629144.">http://pastebin.ca/3629144.</A>

Neale

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043710.html">[Mono-dev] Race condition in named mutex
</A></li>
	<LI>Next message: <A HREF="043714.html">[Mono-dev] Bug preserving stack trace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43711">[ date ]</a>
              <a href="thread.html#43711">[ thread ]</a>
              <a href="subject.html#43711">[ subject ]</a>
              <a href="author.html#43711">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
