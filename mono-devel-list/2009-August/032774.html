<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] New error handling framework for mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20error%20handling%20framework%20for%20mono&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032837.html">
   <LINK REL="Next"  HREF="032775.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] New error handling framework for mono</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20error%20handling%20framework%20for%20mono&In-Reply-To="
       TITLE="[Mono-dev] New error handling framework for mono">kumpera at gmail.com
       </A><BR>
    <I>Thu Aug 13 17:26:10 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032837.html">[Mono-dev] [PATCH] Cause libgc to return some unused memory to the	system
</A></li>
        <LI>Next message: <A HREF="032775.html">[Mono-dev] New error handling framework for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32774">[ date ]</a>
              <a href="thread.html#32774">[ thread ]</a>
              <a href="subject.html#32774">[ subject ]</a>
              <a href="author.html#32774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

The attached patch implements the basics for the new MonoError struct that
will be used for error handling in the runtime.
It has only the basics to support the current exceptions the runtime handle
for it's operation.

The usage is pretty much like the one in Paolo's email on the subject:

gboolean do_stuff () {
MonoError error;
mono_error_init (&amp;error, 0);
runtime_function_that_might_fail (..., &amp;error)
if (!mono_error_is_ok (&amp;error))
  goto fail;
return TRUE;

fail:
mono_error_cleaup (&amp;error);
return FALSE; //or raise an exception using mono_raise_exception
(mono_error_prepare_exception (&amp;error));
}

The idea is to replace all error handling code with using this (loader
error, type exception_data and JIT's exception_type).

Still open is how this would be integrated on 2.6 and if functions should
error out if passed an already set error object.
The last point enables more concise code like:

MonoError error;
MonoType *type = ...;
mono_error_init (&amp;error);
MonoClass *class = mono_class_from_mono_type (type, &amp;error);
mono_class_init (class, &amp;error);
MonoMethod *method = mono_class_get_method_from_name (class, &quot;Invoke&quot;, 1,
&amp;error);
if (!mono_error_ok (&amp;error))
  return NULL;
return mono_runtime_invoke (method, NULL, params, NULL);

I left behind some aditional features I would like to add to help
development, like logging, signaling a breakpoint and
asserting if setting a second error to the same MonoError.

It would be a good time to hear the feeback on everyone about this,
specially embedders, since this will be the basis for
error handling of the new API comming in 2.8.

Please comment,
Rodrigo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090813/12731f16/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090813/12731f16/attachment.html</A> 
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032837.html">[Mono-dev] [PATCH] Cause libgc to return some unused memory to the	system
</A></li>
	<LI>Next message: <A HREF="032775.html">[Mono-dev] New error handling framework for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32774">[ date ]</a>
              <a href="thread.html#32774">[ thread ]</a>
              <a href="subject.html#32774">[ subject ]</a>
              <a href="author.html#32774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
