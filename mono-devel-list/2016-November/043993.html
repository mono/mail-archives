<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] xbuild crash with mono 4.6.1?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20xbuild%20crash%20with%20mono%204.6.1%3F&In-Reply-To=%3C82ed1e55-b7a5-e830-781d-afcc2fb18815%40CeBiTec.Uni-Bielefeld.DE%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="043994.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] xbuild crash with mono 4.6.1?</H1>
    <B>Burkhard Linke</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20xbuild%20crash%20with%20mono%204.6.1%3F&In-Reply-To=%3C82ed1e55-b7a5-e830-781d-afcc2fb18815%40CeBiTec.Uni-Bielefeld.DE%3E"
       TITLE="[Mono-dev] xbuild crash with mono 4.6.1?">blinke at CeBiTec.Uni-Bielefeld.DE
       </A><BR>
    <I>Tue Nov  1 12:53:52 UTC 2016</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="043994.html">[Mono-dev] Increasing stack size? [was: Re: xbuild crash with	mono4.6.1?]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43993">[ date ]</a>
              <a href="thread.html#43993">[ thread ]</a>
              <a href="subject.html#43993">[ subject ]</a>
              <a href="author.html#43993">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,


we have encountered a similar problem using an application for large 
scale data processing. After allocating about 30 GB RAM the application 
crashed with SIGSEGV:


(gdb) bt
#0  alloc_sb (desc=0x7f3a1696a8c0) at lock-free-alloc.c:146
#1  alloc_from_new_sb (heap=0x987e70 &lt;allocators+48&gt;) at 
lock-free-alloc.c:411
#2  mono_lock_free_alloc (heap=0x987e70 &lt;allocators+48&gt;)
     at lock-free-alloc.c:440
#3  0x0000000000609b17 in sgen_alloc_internal_dynamic (size=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">size at entry</A>=32,
     type=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">type at entry</A>=11, assert_on_failure=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">assert_on_failure at entry</A>=1)
     at sgen-internal.c:171
#4  0x000000000061ab03 in sgen_pin_stats_register_address (
     addr=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">addr at entry</A>=0x7f3a1eb6d048 &quot;\350/\016\003&quot;, 
pin_type=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">pin_type at entry</A>=2)
     at sgen-pinning-stats.c:93
#5  0x00000000006046e2 in sgen_conservatively_pin_objects_from (
     start=0x30ead10, end=0x30eae10,
     start_nursery=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">start_nursery at entry</A>=0x7f3a1e800000,
     end_nursery=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">end_nursery at entry</A>=0x7f3a1ec00000, 
pin_type=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">pin_type at entry</A>=2)
     at sgen-gc.c:845
#6  0x0000000000604779 in pin_from_roots (start_nursery=0x7f3a1e800000,
     end_nursery=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">end_nursery at entry</A>=0x7f3a1ec00000, ctx=...) at sgen-gc.c:868
#7  0x0000000000607874 in collect_nursery (
     reason=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">reason at entry</A>=0x702f7d &quot;Nursery full&quot;,
     is_overflow=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">is_overflow at entry</A>=0, finish_up_concurrent_mark=0,
     unpin_queue=0x0) at sgen-gc.c:1563
#8  0x0000000000607f5c in major_start_concurrent_collection (
     reason=&lt;optimized out&gt;) at sgen-gc.c:2121
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#9  sgen_perform_collection (requested_size=4096, generation_to_collect=0,
     reason=0x702f7d &quot;Nursery full&quot;, wait_to_finish=0, stw=1) at 
sgen-gc.c:2277
#10 0x000000000060823c in sgen_ensure_free_space (size=&lt;optimized out&gt;,
     generation=&lt;optimized out&gt;) at sgen-gc.c:2232
#11 0x00000000005fb80d in sgen_alloc_obj_nolock (
     vtable=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">vtable at entry</A>=0x18068a8, size=80, <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">size at entry</A>=76) at 
sgen-alloc.c:262
#12 0x00000000005e8da1 in mono_gc_alloc_string (vtable=vtable(&quot;string&quot;),
     size=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">size at entry</A>=76, len=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">len at entry</A>=27) at sgen-mono.c:1833
#13 0x00000000005c5025 in mono_string_new_size_checked (domain=0x17d93e0,
     len=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">len at entry</A>=27, error=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">error at entry</A>=0x7f3a15048cc0) at object.c:6074
#14 0x0000000000597899 in ves_icall_System_String_InternalAllocateStr (
     length=27) at string-icalls.c:41
#15 0x00000000419fded2 in ?? ()
#16 0x00007f3a1eb14f10 in ?? ()
#17 0x00007f38044a3150 in ?? ()
#18 0x0000000000000000 in ?? ()


After having a closer look at the memory allocation we came across this:


$ wc -l /proc/44969/maps
65532 /proc/44969/maps
$ sysctl vm.max_map_count
vm.max_map_count = 65530

(44969 being the PID of the mono process)


Apparently the process is not able to mmap another chunk of memory. I'll 
test this by modifying the the sysctl value and do another run.


Does the 4.6 release introduces any changes to the memory layer, e.g. 
using a fine granularity for memory management (resulting in more 
mmap'ed chunks)?


Regards,

Burkhard

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="043994.html">[Mono-dev] Increasing stack size? [was: Re: xbuild crash with	mono4.6.1?]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43993">[ date ]</a>
              <a href="thread.html#43993">[ thread ]</a>
              <a href="subject.html#43993">[ subject ]</a>
              <a href="author.html#43993">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
