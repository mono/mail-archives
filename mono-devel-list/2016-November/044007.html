<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Still stuck in a bad place with TLS 1.2 support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20Still%20stuck%20in%20a%20bad%20place%20with%20TLS%201.2%20support&In-Reply-To=%3C2e6b38c5-c1b0-36b0-5591-0b2f7a347bb0%40UFO-Net.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044003.html">
   <LINK REL="Next"  HREF="044008.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Still stuck in a bad place with TLS 1.2 support</H1>
    <B>Ivo Smits</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20Still%20stuck%20in%20a%20bad%20place%20with%20TLS%201.2%20support&In-Reply-To=%3C2e6b38c5-c1b0-36b0-5591-0b2f7a347bb0%40UFO-Net.nl%3E"
       TITLE="[Mono-dev] Still stuck in a bad place with TLS 1.2 support">Ivo at UFO-Net.nl
       </A><BR>
    <I>Wed Nov  2 20:07:58 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044003.html">[Mono-dev] Still stuck in a bad place with TLS 1.2 support
</A></li>
        <LI>Next message (by thread): <A HREF="044008.html">[Mono-dev] Still stuck in a bad place with TLS 1.2 support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44007">[ date ]</a>
              <a href="thread.html#44007">[ thread ]</a>
              <a href="subject.html#44007">[ subject ]</a>
              <a href="author.html#44007">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Guerry,

I think a LetsEncrypt certificate should work with Mono's TLS 1.0 
implementation, but it often fails to get the certificate chain right. 
You need to have (only) the right certificates in the local CA store 
(use certmgr) for mono to build the correct chain. I had the same 
problem with other certificates.

While waiting for a stable solution in Mono, and also requiring a 
cross-platform TLS 1.2 implementation (apparently it's not enabled in 
Windows .NET by default) and partly as an exercise, I wrote my own TLS 
1.0-1.1-1.2 server implementation. It has just the bare minimum required 
by the RFC so it should work with all TLS1.0-1.2 clients out there. It's 
not unlikely that it has some (possibly serious) flaws - any feedback in 
this area is appreciated. At least it gives a pretty good A- score on 
the Qualys SSL test.

Source code: 
<A HREF="https://bitbucket.org/IvoSmits/ucis.core/src/42c10ce64a37242477c71bfebe104676255a71f2/NaCl/TLSStream.cs">https://bitbucket.org/IvoSmits/ucis.core/src/42c10ce64a37242477c71bfebe104676255a71f2/NaCl/TLSStream.cs</A>

I also wrote some helper code to handle certificate chains and keys in 
PEM format: 
<A HREF="https://bitbucket.org/IvoSmits/ucis.core/src/42c10ce64a37242477c71bfebe104676255a71f2/NaCl/SSLUtils.cs">https://bitbucket.org/IvoSmits/ucis.core/src/42c10ce64a37242477c71bfebe104676255a71f2/NaCl/SSLUtils.cs</A>

This helper allows you to put the private key + certificate + 
intermediates + root certificate in one PEM file to ensure the TLS 
server uses the intended certificate chain.

And a minimal client for LetsEncrypt (agreement URL is no longer valid): 
<A HREF="https://bitbucket.org/IvoSmits/ucis.core/src/42c10ce64a37242477c71bfebe104676255a71f2/NaCl/ACMEClient.cs">https://bitbucket.org/IvoSmits/ucis.core/src/42c10ce64a37242477c71bfebe104676255a71f2/NaCl/ACMEClient.cs</A>

Maybe this can be of some use to you or someone else.

--

Ivo


Op 1-11-2016 om 22:58 schreef gsemones:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I've posted before about this, but I've been away trying new approaches
</I>&gt;<i> which also did not work. I'm back to see if my new approaches have any
</I>&gt;<i> answers. My project is at a complete stand still and has been for several
</I>&gt;<i> months.
</I>&gt;<i>
</I>&gt;<i> I have a OS X console app that is hosting Owin as a web service and SignalR.
</I>&gt;<i> I need TLS 1.2 to work serving a certificate bound to a port on the Mac, as
</I>&gt;<i> well as for HTTP clients used in the service. The Mono Legacy TLS 1.0
</I>&gt;<i> Provider does not work, particularly with our certificate, which is
</I>&gt;<i> currently generated by LetsEncrypt, and which I believe is only authentic
</I>&gt;<i> for TLS 1.1 and 1.2. I guess I should try a certificate with TLS 1.0
</I>&gt;<i> support?
</I>&gt;<i>
</I>&gt;<i> Miguel and others have been very helpful, but no combination of things I've
</I>&gt;<i> tried up through last month worked. Then came the announcement that Boring
</I>&gt;<i> TLS was available in the latest Mono bits, and so I shifted gears.
</I>&gt;<i>
</I>&gt;<i> I built Mono and could see lots of references to Boring TLS. I built my Mono
</I>&gt;<i> project (not Xamarin.Mac) using the latest Mono and targeting .NET Framework
</I>&gt;<i> 4.6, and ran it using the same. No matter what I did, I could only get the
</I>&gt;<i> Legacy TLS provider, or if I specified &quot;btls&quot; it would fail with an
</I>&gt;<i> exception because Boring SSL was not found. I could not find any docs about
</I>&gt;<i> whether I need to build/install Boring separately or if the bundled copy in
</I>&gt;<i> Mono was supposed to get built. Is the Mono Boring TLS stuff only for
</I>&gt;<i> Android?
</I>&gt;<i>
</I>&gt;<i> I next read again about Apple TLS and Xamarin.Mac. I made a new Xamarin.Mac
</I>&gt;<i> project and ported my code to it. I found that Owin and other packages were
</I>&gt;<i> not available on Nuget for Xamarin.Mac Mobile Framework&quot; but I had success
</I>&gt;<i> with Xamarin.Mac .NET 4.5 Framework. However, the Apple TLS Provider does
</I>&gt;<i> not appear available and will not load. I only get the Legacy Provider. Does
</I>&gt;<i> the Apple TLS Provider only work with Xamarin.Mac Mobile Framework?
</I>&gt;<i>
</I>&gt;<i> I feel like I'm in a twisty maze of passages all alike.
</I>&gt;<i>
</I>&gt;<i> Is there a document somewhere that points up which TLS options are available
</I>&gt;<i> for which frameworks?
</I>&gt;<i>
</I>&gt;<i> Much thanks in advance,
</I>&gt;<i>
</I>&gt;<i> Guerry
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Still-stuck-in-a-bad-place-with-TLS-1-2-support-tp4669106.html">http://mono.1490590.n4.nabble.com/Still-stuck-in-a-bad-place-with-TLS-1-2-support-tp4669106.html</A>
</I>&gt;<i> Sent from the Mono - Dev mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">http://lists.dot.net/mailman/listinfo/mono-devel-list</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044003.html">[Mono-dev] Still stuck in a bad place with TLS 1.2 support
</A></li>
	<LI>Next message (by thread): <A HREF="044008.html">[Mono-dev] Still stuck in a bad place with TLS 1.2 support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44007">[ date ]</a>
              <a href="thread.html#44007">[ thread ]</a>
              <a href="subject.html#44007">[ subject ]</a>
              <a href="author.html#44007">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
