<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] (WCF) Binding elements order
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%28WCF%29%20Binding%20elements%20order&In-Reply-To=4C341552.8070208%40veritas-vos-liberabit.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035412.html">
   <LINK REL="Next"  HREF="035410.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] (WCF) Binding elements order</H1>
    <B>Thiago Padilha</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%28WCF%29%20Binding%20elements%20order&In-Reply-To=4C341552.8070208%40veritas-vos-liberabit.com"
       TITLE="[Mono-dev] (WCF) Binding elements order">tpadilha84 at gmail.com
       </A><BR>
    <I>Wed Jul  7 06:30:11 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035412.html">[Mono-dev] (WCF) Binding elements order
</A></li>
        <LI>Next message: <A HREF="035410.html">[Mono-dev] Preview 2.6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35413">[ date ]</a>
              <a href="thread.html#35413">[ thread ]</a>
              <a href="subject.html#35413">[ subject ]</a>
              <a href="author.html#35413">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>  Hi,

  Try this test on both plataforms :

       [Test]
       [ExpectedExceptionAttribute(typeof(InvalidOperationException))]
       public void BuildChannelListenerThrowsIfOrderIsIncorrect ()
       {
                        BindingElement[] bindingElements = new
BindingElement[2];
			bindingElements[1] = new WebMessageEncodingBindingElement ();
			bindingElements[0] = new HttpTransportBindingElement ();
			
			CustomBinding binding = new CustomBinding (bindingElements);
			
			IChannelListener&lt;IReplyChannel&gt; listener =
binding.BuildChannelListener&lt;IReplyChannel&gt; (new Uri
(&quot;<A HREF="http://127.0.0.1/&quot;">http://127.0.0.1/&quot;</A>), new BindingParameterCollection ());
       }

  It seems on Mono this runs fine, however on .NET it thows an
InvalidOperationException (
<A HREF="http://msdn.microsoft.com/en-us/library/ms405447.aspx">http://msdn.microsoft.com/en-us/library/ms405447.aspx</A> ).
  I got confused about having to sort the elements in
'CreateBindingElements'. It seems that should be done only when
writing custom binding profiles. If the user uses 'CustomBinding'
directly, then he must pass the elements in the correct order.

On Wed, Jul 7, 2010 at 2:49 AM, Atsushi Eno
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushieno at veritas-vos-liberabit.com</A>&gt; wrote:
&gt;<i> Hello Thiago,
</I>&gt;<i>
</I>&gt;<i> In what kind of situation does this bring an issue? Is it like, a binding
</I>&gt;<i> element after a
</I>&gt;<i> TransportBindingElement should not be ignored under certain usage?
</I>&gt;<i>
</I>&gt;<i> For reference, there is a test named BuildChannelFactoryIgnoresRemaining()
</I>&gt;<i> in HttpTransportBindingElementTest in our nunit test that confirms that
</I>&gt;<i> InvalidBindingElement is ignored after a transport binding element. (If it
</I>&gt;<i> is not ignored and called BuildChannelFactory&lt;T&gt;(), then it throws
</I>&gt;<i> NotSupportedException.)
</I>&gt;<i>
</I>&gt;<i> &#160; &#160; &#160; &#160;[Test]
</I>&gt;<i> &#160; &#160; &#160; &#160;public void BuildChannelFactoryIgnoresRemaining ()
</I>&gt;<i> &#160; &#160; &#160; &#160;{
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;BindingContext ctx = new BindingContext (
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;new CustomBinding (
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;new HttpTransportBindingElement (),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;new InvalidBindingElement ()),
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;empty_params);
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160;ctx.BuildInnerChannelFactory&lt;IRequestChannel&gt; ();
</I>&gt;<i> &#160; &#160; &#160; &#160;}
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno
</I>&gt;<i>
</I>&gt;<i> On 2010/07/06 21:34, Thiago Padilha wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; Hi Atsushi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; While examining the file &quot;Binding.cs&quot; I found the following comment
</I>&gt;&gt;<i> on the two overloads of &quot;CreateContext&quot; method :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;
</I>&gt;&gt;<i> // FIXME: it seems that binding elements are
</I>&gt;&gt;<i> // &quot;validated&quot; so that the last item is a transport.
</I>&gt;&gt;<i> &quot;
</I>&gt;&gt;<i> &#160; If you were unsure about where the binding elements should be
</I>&gt;&gt;<i> ordered take a look at this :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://msdn.microsoft.com/en-us/library/system.servicemodel.channels.binding.createbindingelements.aspx">http://msdn.microsoft.com/en-us/library/system.servicemodel.channels.binding.createbindingelements.aspx</A>
</I>&gt;&gt;<i> &#160; According to this document, the ordering should be done inside the
</I>&gt;&gt;<i> &quot;CreateBindingElements&quot; method for any class that inherits from
</I>&gt;&gt;<i> &quot;Binding&quot;. This could be fixed by using the following code in
</I>&gt;&gt;<i> &quot;CustomBinding.cs&quot; :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> public override BindingElementCollection CreateBindingElements ()
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;return new BindingElementCollection
</I>&gt;&gt;<i> (elements.OrderBy (be =&gt;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Type t = be.GetType ();
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if
</I>&gt;&gt;<i> (typeof(TransportBindingElement).IsAssignableFrom (t))
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;return 2;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if
</I>&gt;&gt;<i> (typeof(MessageEncodingBindingElement).IsAssignableFrom (t))
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;return 1;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;return 0;
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}));
</I>&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035412.html">[Mono-dev] (WCF) Binding elements order
</A></li>
	<LI>Next message: <A HREF="035410.html">[Mono-dev] Preview 2.6.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35413">[ date ]</a>
              <a href="thread.html#35413">[ thread ]</a>
              <a href="subject.html#35413">[ subject ]</a>
              <a href="author.html#35413">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
