<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Compiler warnings: what to report (Re: System.XML warning)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Compiler%20warnings%3A%20what%20to%20report%20%28Re%3A%20System.XML%20warning%29&In-Reply-To=423A9438.5080507%40seznam.cz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011059.html">
   <LINK REL="Next"  HREF="011061.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Compiler warnings: what to report (Re: System.XML warning)</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Compiler%20warnings%3A%20what%20to%20report%20%28Re%3A%20System.XML%20warning%29&In-Reply-To=423A9438.5080507%40seznam.cz"
       TITLE="[Mono-devel-list] Compiler warnings: what to report (Re: System.XML warning)">atsushi at ximian.com
       </A><BR>
    <I>Fri Mar 18 05:05:24 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011059.html">[Mono-devel-list] Re: System.XML warning
</A></li>
        <LI>Next message: <A HREF="011061.html">[Mono-devel-list] Compiler warnings: what to report (Re: System.XML warning)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11060">[ date ]</a>
              <a href="thread.html#11060">[ thread ]</a>
              <a href="subject.html#11060">[ subject ]</a>
              <a href="author.html#11060">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,


Marek Safar wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> Comments in lined.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> System.Xml/XmlReader.cs(1051) warning CS0169: The private method 
</I>&gt;&gt;&gt;<i> 'System.Xml.XmlReader.CheckSupport()' is never used
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is used in NET_2_0 part of code.
</I>&gt;&gt;<i> Should we enclose ALL of such members in _nasty_ preprocessor
</I>&gt;&gt;<i> directives? Does it ease developers read it?
</I>&gt;<i> 
</I>&gt;<i> Yes, it is easier to read and easier to maintain. If you don't enclose 
</I>&gt;<i> your members in #if NET_2_0 directive how can I know
</I>&gt;<i> that a field is not valid for NET_1_x ?. I have to search in your code 
</I>&gt;<i> and try to find out whether the field is valid or not.
</I>
IMO having ifdefs are much more nasty than just having unused fields.
If there are ifdefs in effect, in every block (not only field 
declarations) you must grep up to find whether it is valid block
or not.

If those warning output REALLY annoys developers, I'd just add
/nowarn:169 as well as 162, 612 and 618.

&gt;&gt;&gt;<i> System.Xml/XmlTextReader.cs(1672) warning CS0168: The variable 
</I>&gt;&gt;&gt;<i> 'dummyValue' is declared but never used
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is _required_ even though it is actually not used (otherwise mcs/csc
</I>&gt;&gt;<i> will reject this code). CSC never reports it as warning and I think
</I>&gt;&gt;<i> that regarding it as a warning is bad design.
</I>&gt;&gt;<i>
</I>&gt;<i> Is it some managed &lt;-&gt; unmanaged work ?
</I>
If you tried to remove that assignment statement for the dummy value,
csc will complain that:

     System.Xml\XmlTextReader.cs(1674,23): error CS0201: Only
     assignment, call, increment, decrement, and new object
     expressions can be used as a statement

and mcs saying that:

     syntax error, got token `SEMICOLON'
     System.Xml\XmlTextReader.cs(1674) error CS1002: Expecting `;'

Well, aside this code, there is possibility that those extra fields
might be used from other assemblies. For example, I used to have
XQueryCommandImpl type and field in System.Xml.dll and referenced it
from System.Data.SqlXml.dll via reflection.

&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(604) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xsltCleanupGlobals()' is 
</I>&gt;&gt;&gt;<i> never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(611) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlNewDoc( string)' is 
</I>&gt;&gt;&gt;<i> never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(614) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlSaveFile( string,  
</I>&gt;&gt;&gt;<i> System.IntPtr)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(626) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlCleanupParser()' is 
</I>&gt;&gt;&gt;<i> never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(629) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlDocDumpMemory( 
</I>&gt;&gt;&gt;<i> System.IntPtr, ref System.IntPtr&amp;, ref int&amp;)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(632) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlFree( System.IntPtr)' 
</I>&gt;&gt;&gt;<i> is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(649) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.valuePop( 
</I>&gt;&gt;&gt;<i> System.IntPtr)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(652) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.valuePush( 
</I>&gt;&gt;&gt;<i> System.IntPtr,  System.Xml.Xsl.UnmanagedXslTransform.xpathobject*)' 
</I>&gt;&gt;&gt;<i> is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(655) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathFreeObject( 
</I>&gt;&gt;&gt;<i> System.Xml.Xsl.UnmanagedXslTransform.xpathobject*)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(658) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathNewCString( 
</I>&gt;&gt;&gt;<i> string)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(661) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathNewFloat( 
</I>&gt;&gt;&gt;<i> double)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(664) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathNewBoolean( 
</I>&gt;&gt;&gt;<i> int)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(667) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathNewNodeSet( 
</I>&gt;&gt;&gt;<i> System.IntPtr)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(670) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathCastToBoolean( 
</I>&gt;&gt;&gt;<i> System.Xml.Xsl.UnmanagedXslTransform.xpathobject*)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(673) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathCastToNumber( 
</I>&gt;&gt;&gt;<i> System.Xml.Xsl.UnmanagedXslTransform.xpathobject*)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(676) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathCastToString( 
</I>&gt;&gt;&gt;<i> System.Xml.Xsl.UnmanagedXslTransform.xpathobject*)' is never used
</I>&gt;&gt;&gt;<i> System.Xml.Xsl/XslTransform.cs(679) warning CS0169: The private 
</I>&gt;&gt;&gt;<i> method 'System.Xml.Xsl.UnmanagedXslTransform.xmlXPathStringFunction( 
</I>&gt;&gt;&gt;<i> System.IntPtr,  int)' is never used
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Why are they reported as never used? They are actually in use.
</I>&gt;<i> 
</I>&gt;<i> Are you sure that they are used ?
</I>&gt;<i> 
</I>&gt;<i> I tried to remove 
</I>&gt;<i> 'System.Xml.Xsl.UnmanagedXslTransform.xsltCleanupGlobals' and no 
</I>&gt;<i> compilation error.
</I>
Mmm, sorry then I should have checked more in details. At least

 &gt;&gt;&gt; System.Xml.Xsl/XslTransform.cs(649) warning CS0169: The private
 &gt;&gt;&gt; method 'System.Xml.Xsl.UnmanagedXslTransform.valuePop(
 &gt;&gt;&gt; System.IntPtr)' is never used

this is really in use.

I'll check for each unmanaged methods and comment out if they are
unused.

&gt;&gt;&gt;<i> System.Xml.Schema/XmlSchemaSet.cs(134) warning CS3019: CLS compliance 
</I>&gt;&gt;&gt;<i> checking will not be performed on 
</I>&gt;&gt;&gt;<i> 'System.Xml.Schema.XmlSchemaSet.XmlResolver' because it is private or 
</I>&gt;&gt;&gt;<i> internal
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is reported just because this type is public only under NET_2_0.
</I>&gt;&gt;<i> When there are such types, should we put NET_2_0 on every such
</I>&gt;&gt;<i> attributes?
</I>&gt;<i> 
</I>&gt;<i> You can keep it. In this case Microsoft made custom property modifiers 
</I>&gt;<i> CLS-Compliant (similar case as generics). I am going to remove this 
</I>&gt;<i> warning soon.
</I>
Ok, cool.

&gt;&gt;<i> BTW how can we verify that those sources became clean after
</I>&gt;&gt;<i> manual warning elimination?
</I>&gt;<i> 
</I>&gt;<i> I will send you mcs patch.
</I>
Please don't send me but post it to the mail list so that everyone
can have a chance to try.

&gt;&gt;<i> Also, I think that some part of those warning report feature are
</I>&gt;&gt;<i> problematic. For example,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     - I think there is no (or little) need to report not-in-use
</I>&gt;&gt;<i>       private methods. When we found such methods that we don't
</I>&gt;&gt;<i>       know what it is, we usually grep (usually) single file
</I>&gt;&gt;<i>       and notice that it is not in use. I believe that why MS
</I>&gt;&gt;<i>       csc has such reporting feature for unused fields is that
</I>&gt;&gt;<i>       they might be confused with local variables or parameters.
</I>&gt;&gt;<i>       I don't think mcs should not let developers to be puritan
</I>&gt;&gt;<i>       that believes ALL unused members MUST be eliminated.
</I>&gt;<i> 
</I>&gt;<i>  From my point of view, there are several reasons why report &quot;unused&quot; code.
</I>&gt;<i> - I like every feature which tells me that something is &quot;wrong&quot; with my 
</I>&gt;<i> code.
</I>&gt;<i> - Your code can be easily faster/smaller. When you remove class member 
</I>&gt;<i> you allocate less.
</I>&gt;<i> When you remove method sometimes it leads to next methods/fields clean up.
</I>&gt;<i> 
</I>&gt;<i> Maybe I am wrong but why should I keep unused code ?
</I>
 From my point of view, there are many reasons not to report &quot;unused&quot; code.
- I like every feature which tells me that something is &quot;wrong&quot; with my
   code, only when it is REALLY wrong.
- It is too trivial contribution to performance to remove unused code,
   unless there are heavy reflection work.
- Those puritan warnings really discourages us at every point of
   incomplete development where we wonder if our refactory is fine.
   For example, suppose we were developing UnmanagedXslTransform and
   going to support all exposed functionality in unmanaged library,
   Checking every import is just a pain.

&gt;&gt;<i>
</I>&gt;&gt;<i>     - As I noted above, there are unexpected unused field check
</I>&gt;&gt;<i>       that at least csc does not regard as should-be-warned.
</I>&gt;&gt;<i>
</I>&gt;<i> If you know about any wrong warnings please let me know.
</I>
As for that unused field, I think I explaind understandably, though
I don't know that is the merginal line between those code that is
worthy of being warned and those code that is not.

&gt;<i> But csc is really not good in this area. They made some improvement for 
</I>&gt;<i> 2.0. But even
</I>&gt;<i> simple cases are still not detected.
</I>
Yes, csc 2.0 seems added some additional code analysis. But I doubt
if the remaining check is &quot;better&quot;. It sounds like design principle
difference.

Atsushi Eno

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011059.html">[Mono-devel-list] Re: System.XML warning
</A></li>
	<LI>Next message: <A HREF="011061.html">[Mono-devel-list] Compiler warnings: what to report (Re: System.XML warning)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11060">[ date ]</a>
              <a href="thread.html#11060">[ thread ]</a>
              <a href="subject.html#11060">[ subject ]</a>
              <a href="author.html#11060">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
