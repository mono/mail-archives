<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] patch for TypeBuilder.CreateType() and mcs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20patch%20for%20TypeBuilder.CreateType%28%29%20and%20mcs&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010881.html">
   <LINK REL="Next"  HREF="010884.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] patch for TypeBuilder.CreateType() and mcs</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20patch%20for%20TypeBuilder.CreateType%28%29%20and%20mcs&In-Reply-To="
       TITLE="[Mono-devel-list] patch for TypeBuilder.CreateType() and mcs">atsushi at ximian.com
       </A><BR>
    <I>Thu Mar 10 14:41:40 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010881.html">[Mono-devel-list] Leak in System.Timers.Timer?
</A></li>
        <LI>Next message: <A HREF="010884.html">[Mono-devel-list] patch for TypeBuilder.CreateType() and mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10882">[ date ]</a>
              <a href="thread.html#10882">[ thread ]</a>
              <a href="subject.html#10882">[ subject ]</a>
              <a href="author.html#10882">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I noticed that TypeBuilder never throws InvalidOperationException
when CreateType() is invoked twice. It is because of this change:

2004-12-06  Ben Maurer  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bmaurer at ximian.com</A>&gt;
	* TypeBuilder.cs (CreateType): Creating a type twice does not
	throw in msft.

Well, this is correct for .NET 2.0.

To see what happens, try attached example.

MSDN documentation (still) says that it will throw the exception.
<A HREF="http://msdn2.microsoft.com/library/y29h8wb9.aspx">http://msdn2.microsoft.com/library/y29h8wb9.aspx</A>

So, I think we could make compromised fix for them; just return
already-created type for NET_2_0, and throw exception otherwise.

I also noticed that GetMembers() never throws an exception in
TypeBuilder when there is not created type, but not sure if it
is intended. It might be too naive to fill the differences
between MS one. At least we should be very careful to change them
because mcs heavily depends on them. If it makes sense, I'll
track down more on this matter and file bugs.

For now, to apply this TypeBuilder fix, mcs is also needed to be
fixed (included in the patch).

Atsushi Eno
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: createtypetwice.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/78a4751b/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/78a4751b/attachment.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: create-type.patch
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/78a4751b/attachment-0001.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/78a4751b/attachment-0001.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010881.html">[Mono-devel-list] Leak in System.Timers.Timer?
</A></li>
	<LI>Next message: <A HREF="010884.html">[Mono-devel-list] patch for TypeBuilder.CreateType() and mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10882">[ date ]</a>
              <a href="thread.html#10882">[ thread ]</a>
              <a href="subject.html#10882">[ subject ]</a>
              <a href="author.html#10882">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
