<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] libintl does not work on windows?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20libintl%20does%20not%20work%20on%20windows%3F&In-Reply-To=1109898210.15700.3.camel%40krypton.home.rtfs.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010816.html">
   <LINK REL="Next"  HREF="010822.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] libintl does not work on windows?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20libintl%20does%20not%20work%20on%20windows%3F&In-Reply-To=1109898210.15700.3.camel%40krypton.home.rtfs.org"
       TITLE="[Mono-devel-list] libintl does not work on windows?">jonpryor at vt.edu
       </A><BR>
    <I>Fri Mar  4 07:40:11 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010816.html">[Mono-devel-list] libintl does not work on windows?
</A></li>
        <LI>Next message: <A HREF="010822.html">[Mono-devel-list] libintl does not work on windows?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10821">[ date ]</a>
              <a href="thread.html#10821">[ thread ]</a>
              <a href="subject.html#10821">[ subject ]</a>
              <a href="author.html#10821">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2005-03-04 at 02:03 +0100, Fabian Sturm wrote:
&gt;<i> Hi!
</I>&gt;<i> 
</I>&gt;<i> I have the simple problem that I can't use libintl on windows.
</I>
Do you have libintl.dll installed?

&gt;<i> A call to Mono.Unix.Catalog in mono-1.1.4 on windows produces:
</I>&gt;<i> 
</I>&gt;<i>  Unhandled Exception: System.DllNotFoundException: libc.so.6
</I>&gt;<i>  in &lt;0x00049&gt; (wrapper managed-to-native)  
</I>&gt;<i>  Mono.Unix.Catalog:bindtextdomain (intptr,intptr)
</I>&gt;<i>  in &lt;0x0002e&gt; Mono.Unix.Catalog:Init (string,string)
</I>&gt;<i>  in &lt;0x0001d&gt; TranslationTest:.ctor (string[])
</I>&gt;<i>  in &lt;0x0001d&gt; TranslationTest:Main (string[])
</I>&gt;<i> 
</I>&gt;<i> I do not understand where it references the libc.so.6?
</I>
I know what the problem is.  And I know of a solution for you.  But I
don't know what the correct, long-term solution is (suggestions
welcome).

The problem is this: following standard procedure, Mono.Unix.Catalog
DllImports libintl.dll, as that library exists on Windows.  However,
libintl.dll doesn't exist on all Unix platforms; the functions it
exports are usually part of libc.  Consequently, $prefix/etc/mono/config
contains a &lt;dllmap/&gt; redirecting libintl.dll to libc.so, which is why
you're seeing a DllNotFoundException for libc.so: mono is redirecting
libintl.dll to libc.so, even though the platform you're on doesn't
require such redirections.

This same issue will effect every library listed in
$prefix/etc/mono/config, including odbc32.dll, libmySQL.dll, and
cygwin1.dll (i.e. if your app depends on any of those libraries and runs
on mono/Win32, it will break due to the dll mapping).

The short-term solution for you is to edit $prefix/etc/mono/config and
remove the &lt;dllmap/&gt; elements for libintl and MonoPosixHelper.  You will
still need to have libintl.dll in your path, which is why I asked above.

I can see three long-term solutions to this:

 1. Ignore $prefix/etc/mono when running on Windows, on the assumption 
    that all assemblies will use Windows library names by default, 
    rendering the dll mapping pointless.
    Pros: 
      - This simplifies things, as you can assume (ha!) that the .config
        files will only be read on a non-windows system.
        Currently it seems that the .config file is read before probing
        for the DLL, so if e.g. Gtk# installed the .config files on 
        Windows, Mono will try to load libgtk-x11-2.0.so instead of 
        libgtk-win32-2.0-0.dll, which would be incorrect.
      - Mono acts more like .NET on Windows, as .NET doesn't have a
        dllmap capability.
    Con:
      - Mono doesn't act consistently across all platforms.

 2. Edit $prefix/etc/mono/config before creating the install program to
    remove all &lt;dllmap/&gt; elements, as they're superfluous on win32.
    (This is an evil solution, as it requires manual intervention.)

 3. Probe for the DllImport assembly *before* reading the relevant 
    config file and loading the mapped assembly.  This will provide
    consistent behavior across all platforms, and allow the correct
    win32 libraries to be found when running on win32.

 - Jon

PS: for all I know (3) is actually done.  I don't have time to test this
right now or read the source...



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010816.html">[Mono-devel-list] libintl does not work on windows?
</A></li>
	<LI>Next message: <A HREF="010822.html">[Mono-devel-list] libintl does not work on windows?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10821">[ date ]</a>
              <a href="thread.html#10821">[ thread ]</a>
              <a href="subject.html#10821">[ subject ]</a>
              <a href="author.html#10821">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
