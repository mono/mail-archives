<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [patch] #73864: DataGrind.PageCount should be &gt;0.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5Bpatch%5D%20%2373864%3A%20DataGrind.PageCount%20should%20be%20%3E0.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011295.html">
   <LINK REL="Next"  HREF="011278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [patch] #73864: DataGrind.PageCount should be &gt;0.</H1>
    <B>Sureshkumar T</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5Bpatch%5D%20%2373864%3A%20DataGrind.PageCount%20should%20be%20%3E0.&In-Reply-To="
       TITLE="[Mono-devel-list] [patch] #73864: DataGrind.PageCount should be &gt;0.">tsureshkumar at novell.com
       </A><BR>
    <I>Wed Mar 30 10:05:00 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011295.html">[Mono-devel-list] System.Diagnostics.PerformanceCounter (Publish and be dammed!!)
</A></li>
        <LI>Next message: <A HREF="011278.html">[Mono-devel-list] [ANN] X-develop 1.0 beta
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11276">[ date ]</a>
              <a href="thread.html#11276">[ thread ]</a>
              <a href="subject.html#11276">[ subject ]</a>
              <a href="author.html#11276">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This patch fixes bug #73864 (DataGrid, System.Web).

If nobody has any objection, this would go into svn.

This fix is based the assumptions

1. datagrid.datasource can have empty list. so AutoCreateColumns should
return empty column list.
2. datagrid.Pagecount always should be &gt;= 1. i.e. atleast a page.


Index: System.Web.UI.WebControls/PagedDataSource.cs
===================================================================
--- System.Web.UI.WebControls/PagedDataSource.cs        (revision 41888)
+++ System.Web.UI.WebControls/PagedDataSource.cs        (working copy)
@@ -226,7 +226,8 @@
                                                return 1;

                                        int total = DataSourceCount;
-                                       return (total + pageSize -
1)/pageSize;
+                                       int pages = (total + pageSize -
1)/pageSize;
+                                        return pages &gt; 0 ? pages : 1;
                                }
                                return 0;
                        }
Index: System.Web.UI.WebControls/DataGrid.cs
===================================================================
--- System.Web.UI.WebControls/DataGrid.cs       (revision 41888)
+++ System.Web.UI.WebControls/DataGrid.cs       (working copy)
@@ -1580,11 +1580,7 @@

((IDisposable)props).Dispose();
                                        }
                                }
-                               if(retVal.Count &gt; 0)
-                               {
-                                       return retVal;
-                               }
-                               throw new
HttpException(HttpRuntime.FormatResourceString(&quot;DataGrid_NoAutoGenColumns&quot;, ID));
+                                return retVal;
                        }
                        return null;
                }


suresh.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011295.html">[Mono-devel-list] System.Diagnostics.PerformanceCounter (Publish and be dammed!!)
</A></li>
	<LI>Next message: <A HREF="011278.html">[Mono-devel-list] [ANN] X-develop 1.0 beta
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11276">[ date ]</a>
              <a href="thread.html#11276">[ thread ]</a>
              <a href="subject.html#11276">[ subject ]</a>
              <a href="author.html#11276">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
