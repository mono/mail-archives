<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Is native codes for C# methods and CLI 	internal calls different?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Is%20native%20codes%20for%20C%23%20methods%20and%20CLI%20%0A%09internal%20calls%20different%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010789.html">
   <LINK REL="Next"  HREF="010797.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Is native codes for C# methods and CLI 	internal calls different?</H1>
    <B>Vivek, Bharath Varma (IE10)</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Is%20native%20codes%20for%20C%23%20methods%20and%20CLI%20%0A%09internal%20calls%20different%3F&In-Reply-To="
       TITLE="[Mono-devel-list] Is native codes for C# methods and CLI 	internal calls different?">Vivek.Varma at honeywell.com
       </A><BR>
    <I>Wed Mar  2 09:08:41 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010789.html">[Mono-devel-list] System.Text.Encoding patches
</A></li>
        <LI>Next message: <A HREF="010797.html">[Mono-devel-list] Re: [mono-vb] BC29999 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10795">[ date ]</a>
              <a href="thread.html#10795">[ thread ]</a>
              <a href="subject.html#10795">[ subject ]</a>
              <a href="author.html#10795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> If you have the filter in Console.WriteLine() and you call it from Main,
</I>why
&gt;<i> do you expect a huge stack walk? It looks correct that it just shows
</I>&gt;<i> WriteLine, Main and the invoke wrapper used to go from unmanaged
</I>&gt;<i> to managed code.
</I>
I verified this against the output using the --trace and yes it is CORRECT
that the stack walk shows only these 3 methods. Sorry about the hasty email!

I ran into another issue regarding stack walk, here's a short description,
I put the following lines of code into the &quot;DoAssemblyResolve&quot; method of 
AppDomain.cs in corlib
//Code starts here
System.Diagnostics.StackTrace st = new
System.Diagnostics.StackTrace(13,false);
for(int i =0; i&lt; st.FrameCount; i++ )
{
// High up the call stack, there is only one stack frame
System.Diagnostics.StackFrame sf = st.GetFrame(i);
sf.GetMethod();
}
//Code Ends here

I observed the stack walk in ves_icall_get_frame_info in mini-exceptions.c. 
The stackwalk showed me the following &lt;namespace.classname.methodname&gt;
combination.

//Start stack walk info
System.Diagnostics.Stackframe.get_frame_info
....
......
.....
HelloWorld.Class1.Main
HelloWorld.Class1.Main
System.Object.runtime_invoke_void

//End stack walk info

The problem: HelloWorld.Class1.Main appears twice in the stack walk,
although it is expected to appear only once. 
The other method in this stack walk that appear twice is
System.Appdomain.LoadAssembly, a managed-to-native wrapper BOTH the times.
Any idea why this would be happening?


A look at the code in mono_arch_find_jit_info showed me that 
We are doing a mono_jit_info_table_find with the (*lmf)-&gt;eip and then again
setting the new_ctx-&gt;SC_EIP = (*lmf)-&gt;eip. 
This seemed to be the reason why we see some methods appearing twice in the
stack walk. 

Is this possibly a bug?
However I'm not sure what the solution to avoid this is.

Any ideas please?


Thanks in anticipation!


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010789.html">[Mono-devel-list] System.Text.Encoding patches
</A></li>
	<LI>Next message: <A HREF="010797.html">[Mono-devel-list] Re: [mono-vb] BC29999 error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10795">[ date ]</a>
              <a href="thread.html#10795">[ thread ]</a>
              <a href="subject.html#10795">[ subject ]</a>
              <a href="author.html#10795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
