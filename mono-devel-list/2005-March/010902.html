<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Changes required to compile Mono HEAD with Visual	Studio.NET 2005
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Changes%20required%20to%20compile%20Mono%20HEAD%20with%20Visual%09Studio.NET%0A%202005&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010913.html">
   <LINK REL="Next"  HREF="010903.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Changes required to compile Mono HEAD with Visual	Studio.NET 2005</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Changes%20required%20to%20compile%20Mono%20HEAD%20with%20Visual%09Studio.NET%0A%202005&In-Reply-To="
       TITLE="[Mono-devel-list] [PATCH] Changes required to compile Mono HEAD with Visual	Studio.NET 2005">sebastien at ximian.com
       </A><BR>
    <I>Fri Mar 11 12:49:07 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010913.html">[Mono-devel-list] New Mono community
</A></li>
        <LI>Next message: <A HREF="010903.html">[Mono-devel-list] [PATCH] Changes required to compile Mono HEAD with Visual Studio.NET 2005
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10902">[ date ]</a>
              <a href="thread.html#10902">[ thread ]</a>
              <a href="subject.html#10902">[ subject ]</a>
              <a href="author.html#10902">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

Here's an updated patch to make mono HEAD compilable with VS.NET 2005
(and probably earlier versions too). Please note that most of the
changes are from the previous work of J Lothian. Thanks again!

There is no project/solution files attached as I still have to clean
them from system (mine) specific paths... and reorganize it to avoid
some warnings. With a little luck it will be possible to add them in SVN
alter without requiring much custom editing.

The changes do not seems to affect compilation/results of Mono under
cygwin or Linux. However I do not know if this affects compilation under
mingw. Anyone using mingw to compile Mono ?


*** Main issues ***

[1]	__builtin_frame_address(1) is a lot more complex to implement
	than __builtin_frame_address(0)

        This means that some samples (like the embedded samples) don't
        work but (hapilly ;-) I'm able to do the security stack walk
        (because they do not requires (1)).

        My last attempt to fix that (using naked functions) failed :-(.
        I will give it another try this weekend.

[2]	MS C (Microsoft C compiler) doesn't like empty enums. We got one
	like that in mini-x86.c.


Here is a description of the changes...

/mono/io-layer/

* io-layer.h
        Include &lt;winsock2.h&gt; before &lt;windows.h&gt;. Added missing includes
        required by MSC.


/mono/mono/metadata/

* appdomain.c
	Type casting to LPTHREAD_START_ROUTINE in CreateThread

* appdomain.h
        Changed inline to MONO_INLINE as MSC doesn't like this case of
        inlining

* assembly.c
	add include for &quot;msc.h&quot; (for MONO_ASSEMBLIES)

* domain.c
        Removed inline from functions (they are already inline in
        appdomain.h) because they cause link errors with MSC

* threads.c
	Add required typecast.
	MSC similar to MINGW32

* sysmath.h
	include &quot;msc.h&quot; when compiled with MSC

* rawbuffer.c
	include &lt;winsock2.h&gt; before &lt;windows.h&gt;

* rand.c
	include &lt;windows.h&gt; before &lt;WinCrypt.h&gt;
	removed warning (missing typecast)


/mono/mono/mini/

aot.c
* include &lt;winsock2.h&gt; before &lt;windows.h&gt;

mini.h
* include &quot;mono/metadata/msc.h&quot; (new file) when compiled with MSC

mini-exceptions.c
* replace usage of __builtin_frame_address and __builtin_return_address
(GCC) with MSC &quot;equivalent&quot;
	!!! See issue [1]

mini-x86.c
* MSC doesn't like empty enum vector;
	!!! not sure if this is ok !!! see [2]
* changed to inline assembly to MSC format

mini-x86.h
* MSC doesn't like empty struct


/mono/os/

gc_wrapper.h
        Include &lt;winsock2.h&gt; before including anything else (&lt;windows.h&gt;
        in particular) from gc.


-- 
Sebastien Pouliot  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&gt;
blog: <A HREF="http://pages.infinit.net/ctech/poupou.html">http://pages.infinit.net/ctech/poupou.html</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mono.vstudio.20050311.diff
Type: text/x-patch
Size: 14628 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/04277f79/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/04277f79/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: msc.h
Type: text/x-chdr
Size: 386 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/04277f79/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050311/04277f79/attachment-0001.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010913.html">[Mono-devel-list] New Mono community
</A></li>
	<LI>Next message: <A HREF="010903.html">[Mono-devel-list] [PATCH] Changes required to compile Mono HEAD with Visual Studio.NET 2005
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10902">[ date ]</a>
              <a href="thread.html#10902">[ thread ]</a>
              <a href="subject.html#10902">[ subject ]</a>
              <a href="author.html#10902">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
