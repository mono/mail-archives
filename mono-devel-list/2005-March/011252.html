<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] small fix
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20small%20fix&In-Reply-To=42497AA2.6080208%40mainsoft.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011242.html">
   <LINK REL="Next"  HREF="011264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] small fix</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20small%20fix&In-Reply-To=42497AA2.6080208%40mainsoft.com"
       TITLE="[Mono-devel-list] small fix">atsushi at ximian.com
       </A><BR>
    <I>Tue Mar 29 11:16:53 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011242.html">[Mono-devel-list] small fix
</A></li>
        <LI>Next message: <A HREF="011264.html">[Mono-devel-list] small fix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11252">[ date ]</a>
              <a href="thread.html#11252">[ thread ]</a>
              <a href="subject.html#11252">[ subject ]</a>
              <a href="author.html#11252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Kosta,

Yes, I think that is the way it should take. However, AFAIR, there
was an example case that GetEntity() consumed the whole stream up
and after it the network consumption never happened, or example
testcase that requires XmlUrlResolver to implement this way.
Let me find the example.

Atsushi Eno

Konstantin Triger wrote:
&gt;<i> Hello Eno,
</I>&gt;<i> 
</I>&gt;<i> I looked into XmlUrlResolver and found this code:
</I>&gt;<i> 
</I>&gt;<i>        // Methods
</I>&gt;<i>        public override object GetEntity (Uri absoluteUri, string role, 
</I>&gt;<i> Type ofObjectToReturn)
</I>&gt;<i>        {
</I>&gt;<i>            if (ofObjectToReturn == null)
</I>&gt;<i>                ofObjectToReturn = typeof (Stream);
</I>&gt;<i>            if (ofObjectToReturn != typeof (Stream))
</I>&gt;<i>                throw new XmlException (&quot;This object type is not 
</I>&gt;<i> supported.&quot;);
</I>&gt;<i> 
</I>&gt;<i>            if (absoluteUri.Scheme == &quot;file&quot;) {
</I>&gt;<i>                if (absoluteUri.AbsolutePath == String.Empty)
</I>&gt;<i>                    throw new ArgumentException (&quot;uri must be absolute.&quot;, 
</I>&gt;<i> &quot;absoluteUri&quot;);
</I>&gt;<i>                return new FileStream (UnescapeRelativeUriBody 
</I>&gt;<i> (absoluteUri.LocalPath), FileMode.Open, FileAccess.Read, FileShare.Read);
</I>&gt;<i>            }
</I>&gt;<i> 
</I>&gt;<i>            // (MS documentation says) parameter role isn't used yet.
</I>&gt;<i>            Stream s = null;
</I>&gt;<i>            using (s) {
</I>&gt;<i>                WebClient wc = new WebClient ();
</I>&gt;<i>                wc.Credentials = credential;
</I>&gt;<i>                byte [] data = wc.DownloadData (absoluteUri.ToString ());
</I>&gt;<i>                wc.Dispose ();
</I>&gt;<i>                return new MemoryStream (data, 0, data.Length);
</I>&gt;<i>             }
</I>&gt;<i>        }
</I>&gt;<i> 
</I>&gt;<i> Don't you think that the highlighted part should be replcaed with that 
</I>&gt;<i> following one (here we return the underlying reponse's stream instead of 
</I>&gt;<i> allocating a new one):
</I>&gt;<i> 
</I>&gt;<i>            WebRequest req = WebRequest.Create(absoluteUri);
</I>&gt;<i>            if (credential != null)
</I>&gt;<i>                req.Credentials = credential;
</I>&gt;<i> 
</I>&gt;<i>            return req.GetResponse().GetResponseStream();
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011242.html">[Mono-devel-list] small fix
</A></li>
	<LI>Next message: <A HREF="011264.html">[Mono-devel-list] small fix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11252">[ date ]</a>
              <a href="thread.html#11252">[ thread ]</a>
              <a href="subject.html#11252">[ subject ]</a>
              <a href="author.html#11252">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
