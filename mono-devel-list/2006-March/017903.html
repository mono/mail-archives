<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Building Mono on Linux/Alpha
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Building%20Mono%20on%20Linux/Alpha&In-Reply-To=442BFC2D.9010403%40solvo.ru">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017902.html">
   <LINK REL="Next"  HREF="017904.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Building Mono on Linux/Alpha</H1>
    <B>Zoltan Varga</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Building%20Mono%20on%20Linux/Alpha&In-Reply-To=442BFC2D.9010403%40solvo.ru"
       TITLE="[Mono-dev] Building Mono on Linux/Alpha">vargaz at gmail.com
       </A><BR>
    <I>Thu Mar 30 11:11:34 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017902.html">[Mono-dev] Building Mono on Linux/Alpha
</A></li>
        <LI>Next message: <A HREF="017904.html">[Mono-dev] svn down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17903">[ date ]</a>
              <a href="thread.html#17903">[ thread ]</a>
              <a href="subject.html#17903">[ subject ]</a>
              <a href="author.html#17903">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>                                     Hi,

=======================================================
&gt;<i> Do I understand it correctly that after the call of &quot;__emul_idiv&quot; the
</I>&gt;<i> return value should be
</I>&gt;<i> put into &quot;alpha_r14&quot; register? Where should I do it?
</I>&gt;<i> mini-amd64.c has function &quot;emit_move_return_value&quot; which for &quot;simple&quot;
</I>&gt;<i> calls just
</I>&gt;<i> asserts that ins-&gt;dreg should be equal to AMD64_RAX.
</I>&gt;<i> Now by calling convention return value returned in alpha_r0 register and
</I>&gt;<i> it works if the tests are ran
</I>&gt;<i> without optimizations. Should I add instruction to move return value
</I>&gt;<i> from R0 to ins-&gt;dreg?
</I>&gt;<i>
</I>
Either you should emit code to move from R0 to ins-&gt;dreg, or (better), modify
your cpu-alpha.md file and the register allocator macros in
mini-alpha.h to force
the local register allocator to allways allocate the dreg of the call
instruction to
R0. This way the reg allocator will emit the move instruction if it is
neccesary.

Here is what a call instruction looks like in cpu-pentium.md:

call: dest:a clob:c len:17

And the corresponding macro (only an example):
#define MONO_ARCH_INST_FIXED_REG(desc) ((desc == 'a') ? X86_EAX : -1)

&gt;<i> Using different options triggered some interesting code I had to
</I>&gt;<i> implement. My question is what is the difference between local and global
</I>&gt;<i> registers? As I undertood the local registers could be used temporary in
</I>&gt;<i> basic blocks, the global registers are used during optimizations.
</I>&gt;<i> Can I define all my local registers as global ones? It seems that they
</I>&gt;<i> couldn't mixed.
</I>
Global registers are used during global register allocation. They should be
distinct from the set of local registers. mono_arch_get_global_int_regs ()
returns the list of registers that should be used for global allocation. These
registers are usually the 'callee-saved' registers defined by the platform ABI.
The global register allocator will set cfg-&gt;used_int_regs if needed. I suggest
returning an empty list from get_global_int_regs () until all tests are running,
so you have a large set of regression tests which you can use to debug the
inevitable problems which will arose when some variables are allocated to
global registers.

                 Zoltan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017902.html">[Mono-dev] Building Mono on Linux/Alpha
</A></li>
	<LI>Next message: <A HREF="017904.html">[Mono-dev] svn down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17903">[ date ]</a>
              <a href="thread.html#17903">[ thread ]</a>
              <a href="subject.html#17903">[ subject ]</a>
              <a href="author.html#17903">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
