<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] New (faster) Implementaiton for managed CharCopy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20%28faster%29%20Implementaiton%20for%20managed%20CharCopy&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017660.html">
   <LINK REL="Next"  HREF="017661.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] New (faster) Implementaiton for managed CharCopy</H1>
    <B>Andreas Nahr</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20%28faster%29%20Implementaiton%20for%20managed%20CharCopy&In-Reply-To="
       TITLE="[Mono-dev] New (faster) Implementaiton for managed CharCopy">ClassDevelopment at A-SoftTech.com
       </A><BR>
    <I>Mon Mar 20 14:34:14 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017660.html">[Mono-dev] New (faster) Implementaiton for managed CharCopy
</A></li>
        <LI>Next message: <A HREF="017661.html">String performance boost (Re: [Mono-dev] Patch to boost	speedofUnicodeEncoding)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17664">[ date ]</a>
              <a href="thread.html#17664">[ thread ]</a>
              <a href="subject.html#17664">[ subject ]</a>
              <a href="author.html#17664">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> On 03/18/06 Andreas Nahr wrote:
</I>&gt;&gt;<i> ALL new Implementations are always faster, sometimes more than twice as
</I>&gt;&gt;<i> fast as current. The best overall is CharCopy autoalign. However I'm not
</I>&gt;&gt;<i> sure if this would work on non-x86 Platforms, but CC aligned should 
</I>&gt;&gt;<i> always
</I>&gt;&gt;<i> work if I understand the alignment issues right.
</I>&gt;<i>
</I>&gt;<i> Unaligned loads and stores are unacceptable, since they break at least
</I>&gt;<i> sparc and arm.
</I>
Unfortunatelly I don't have any sparc or arm system ready so I couldn't 
test, but the CC aligned implementation should work, because it is aligned.

&gt;<i> The current memcpy() was done because it is a compromise between speed
</I>&gt;<i> and code bloat.
</I>
The current implementation is 180 lines of code. The proposed one only has 
113 lines of code. Which one is more bloated?

&gt;<i> You could certainly unroll some more for some speed
</I>&gt;<i> gains.
</I>
It doesn't make any sense to unroll anymore, because each additional level 
of unrolling will make copying SHORT data much more slow. In fact if you 
look at the numbers the new Implementations are not much faster for huge 
strings, they are much faster for short and especially medium length 
strings.

&gt;<i> If you can provide significant gains with little code bloat in the
</I>&gt;<i> current methods, please do, but we're not going to add additional
</I>&gt;<i> specialized memory copy routines.
</I>
Well if a speedup of  up to &gt;100% isn't enough for you - how much should it 
be???

&gt;<i> memcpy is used also by the runtime and your methods only deal with
</I>&gt;<i> chars, so they are not a replacement.
</I>
And how much of the time they are called with using a byte? Two times for 
the entire Corelib? And the rest of the time they are called for characters.
Besides that it does not even seem semantically right to put something like 
memcopy into the STRING class.

I'd say put the specialized CharCopy into String and move the memcopy to 
e.g. Buffer if it is still needed.

&gt;<i> The way to speedup the code is to implement arch-specific hand-coded
</I>&gt;<i> managed implementations in the jit.
</I>
I absolutely agree on that, however I don't see any reason why we should 
have a managed fallback that is much slower than it could possibly be.
Especially as nobody has done this in the last few years.

In another thread you posted that you should measure against the icalls. 
Where is the sense in that if the managed implementation is known to be 
slow?

Greets
Andreas 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017660.html">[Mono-dev] New (faster) Implementaiton for managed CharCopy
</A></li>
	<LI>Next message: <A HREF="017661.html">String performance boost (Re: [Mono-dev] Patch to boost	speedofUnicodeEncoding)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17664">[ date ]</a>
              <a href="thread.html#17664">[ thread ]</a>
              <a href="subject.html#17664">[ subject ]</a>
              <a href="author.html#17664">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
