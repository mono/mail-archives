<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] PtrToStringAnsi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PtrToStringAnsi&In-Reply-To=440F30D9.5080309%40for.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017473.html">
   <LINK REL="Next"  HREF="017489.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] PtrToStringAnsi</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PtrToStringAnsi&In-Reply-To=440F30D9.5080309%40for.net"
       TITLE="[Mono-dev] PtrToStringAnsi">atsushi at ximian.com
       </A><BR>
    <I>Wed Mar  8 15:38:21 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017473.html">[Mono-dev] PtrToStringAnsi
</A></li>
        <LI>Next message: <A HREF="017489.html">[Mono-dev] PtrToStringAnsi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17474">[ date ]</a>
              <a href="thread.html#17474">[ thread ]</a>
              <a href="subject.html#17474">[ subject ]</a>
              <a href="author.html#17474">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Mono does not support non-UTF8 multibyte conversion by design. We
shouldn't change its behavior from current one. Actually it is pretty
classic matter which has been stated since 2003.
<A HREF="http://lists.ximian.com/archives/public/mono-list/2003-June/014500.html">http://lists.ximian.com/archives/public/mono-list/2003-June/014500.html</A>

It is Microsoft who should provide additional marshaling flags so that
it will be truly functional on every platforms (especially considering
that there is also Gtk+ on Windows which is apparently designed to work
on Windows and uses UTF-8 based marshaling). AFAIK they are also aware
on this matter through ECMA meetings.

Atsushi Eno


&gt;<i> While debugging a SqliteClient issue, I came across an interesting bug.
</I>&gt;<i>  The following returns null when I'm pretty sure it should not (it
</I>&gt;<i> doesn't on Windows):
</I>&gt;<i> 
</I>&gt;<i> Marshal.PtrToStringAnsi(Marshal.StringToCoTaskMemAnsi(&quot;&#252;&quot;))
</I>&gt;<i> 
</I>&gt;<i> In case the encoding of this email gets messed up, that's a u with
</I>&gt;<i> umlauts, (char)0xFC.
</I>&gt;<i> 
</I>&gt;<i> The encoding half &quot;works&quot; (Marshal.ReadByte reports the bytes (0xFC
</I>&gt;<i> 0x00)), on the assumption that I'm supposed to get ANSI out of this
</I>&gt;<i> method.  Internally, g_utf16_to_utf8 is used, which means that (besides
</I>&gt;<i> being surprised this call doesn't actually do ANSI encoding) I would
</I>&gt;<i> actually expect a multibyte representation of that character.  That's
</I>&gt;<i> from a few minutes of Googling for info on UTF-8.
</I>&gt;<i> 
</I>&gt;<i> So I'm confused.  Can someone with more knowledge about encodings tell
</I>&gt;<i> me whether this really doesn't make sense?
</I>&gt;<i> 
</I>&gt;<i> I'm using the latest RPMs.  Here's a test program:
</I>&gt;<i> 
</I>&gt;<i> using System;
</I>&gt;<i> using System.Runtime.InteropServices;
</I>&gt;<i> 
</I>&gt;<i> public class Test {
</I>&gt;<i>     public static void Main() 		
</I>&gt;<i> Console.WriteLine(Marshal.PtrToStringAnsi(Marshal.StringToCoTaskMemAnsi(&quot;&#252;&quot;)));
</I>&gt;<i> 	}
</I>&gt;<i> }
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017473.html">[Mono-dev] PtrToStringAnsi
</A></li>
	<LI>Next message: <A HREF="017489.html">[Mono-dev] PtrToStringAnsi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17474">[ date ]</a>
              <a href="thread.html#17474">[ thread ]</a>
              <a href="subject.html#17474">[ subject ]</a>
              <a href="author.html#17474">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
