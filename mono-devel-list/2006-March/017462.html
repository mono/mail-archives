<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] New managed code for unmanaged (Win32)	resourcehandling (SRE, PEAPI, MCS)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20New%20managed%20code%20for%20unmanaged%20%28Win32%29%0A%09resourcehandling%20%28SRE%2C%20PEAPI%2C%20MCS%29&In-Reply-To=BAY22-DAV434AB110EC06943F9C509A3EE0%40phx.gbl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017455.html">
   <LINK REL="Next"  HREF="017467.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] New managed code for unmanaged (Win32)	resourcehandling (SRE, PEAPI, MCS)</H1>
    <B>Marek Safar</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20New%20managed%20code%20for%20unmanaged%20%28Win32%29%0A%09resourcehandling%20%28SRE%2C%20PEAPI%2C%20MCS%29&In-Reply-To=BAY22-DAV434AB110EC06943F9C509A3EE0%40phx.gbl"
       TITLE="[Mono-dev] [PATCH] New managed code for unmanaged (Win32)	resourcehandling (SRE, PEAPI, MCS)">marek.safar at seznam.cz
       </A><BR>
    <I>Tue Mar  7 14:31:20 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017455.html">[Mono-dev] [PATCH] New managed code for unmanaged (Win32)	resourcehandling (SRE, PEAPI, MCS)
</A></li>
        <LI>Next message: <A HREF="017467.html">[Mono-dev] [PATCH] New managed code for unmanaged	(Win32)resourcehandling (SRE, PEAPI, MCS)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17462">[ date ]</a>
              <a href="thread.html#17462">[ thread ]</a>
              <a href="subject.html#17462">[ subject ]</a>
              <a href="author.html#17462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Korn&#233;l,
&gt;<i> Note that SRE and PEAPI parts were not discussed yet so I am waiting
</I>&gt;<i> comments on those parts from component owners.
</I>&gt;<i>
</I>&gt;&gt;<i> Well, I would prefer to use the memory solution.
</I>&gt;&gt;<i> 1. It's faster
</I>&gt;&gt;<i> 2. It's easier to implement, no problems with file removing, creating,
</I>&gt;&gt;<i> locking, etc.
</I>&gt;&gt;<i> 3. I don't believe that anyone will link more than 10 MB resource file.
</I>&gt;<i>
</I>&gt;<i> I think this is an important feature of my resource handling 
</I>&gt;<i> infrastructure
</I>&gt;<i> because you can use large resources if you want. But note that FileStream
</I>&gt;<i> provides it's own buffering over OS file cache, so you will notice no (or
</I>&gt;<i> little) difference for resource files smaller than 4K as they are 
</I>&gt;<i> retained
</I>&gt;<i> in memory by FileStream in fact. But note that only SRE is involved in 
</I>&gt;<i> this
</I>&gt;<i> question as mcs does no actual resource conversion.
</I>My concern was not about speed, but about reliability. I just don't 
believe it is worthwhile
to utilize file system when it can be done in memory.
Are you sure that the filename will be unique even when you run several 
instances of mcs simultaneously ?

&gt;&gt;<i> 2.  Please provide error tests for as many new error codes as possible.
</I>&gt;<i>
</I>&gt;<i> There are a lot of possible errors, but they are mapped to the same error
</I>&gt;<i> code. BTW can I place invalid .ico and .res files in errors directory 
</I>&gt;<i> where
</I>&gt;<i> the .cs files are?
</I>Yes, you can place there any files which you require for your test case.
It's good practice to use same file name as is name of test file, just 
add some prefix.

&gt;&gt;<i> I prefer this method of code sharing instead of copying all the sources
</I>&gt;&gt;<i> to every file. Please use reflection to get instance of your internal
</I>&gt;&gt;<i> classes. I know you are using several fields, so if you really need them
</I>&gt;&gt;<i> then a solution can be to introduce interface e.g. IResource with all
</I>&gt;&gt;<i> required properties and methods and distribute only this interface file
</I>&gt;&gt;<i> across. Of course, you will need some factory method to create this
</I>&gt;&gt;<i> interface but that is the trivial part.
</I>&gt;<i>
</I>&gt;<i> The Resource Table generation code is included only in SRE. Also note 
</I>&gt;<i> that
</I>&gt;<i> there are at least 7 classes (including DefaultResource that is the 
</I>&gt;<i> only one
</I>&gt;<i> directly used by mcs) that are not included in SRE as mcs generates
</I>&gt;<i> different default resource than SRE. And a lot of classes required by
</I>&gt;<i> resource converter are not included in mcs as resource conversion is
</I>&gt;<i> performed by SRE rather than mcs.
</I>&gt;<i>
</I>&gt;<i> I belive that it's better not to extend SRE with internal methods 
</I>&gt;<i> intended
</I>&gt;<i> to public use if it can be achieved using public methods available in 
</I>&gt;<i> MS.NET
</I>&gt;<i> as well. Whats the point of doing what you suggest?
</I>You are saying that all these files are not used by corlib ?

--- mcs/mcs/mcs.exe.sources    (revision 57534)
+++ mcs/mcs/mcs.exe.sources    (working copy)
@@ -36,4 +36,31 @@
 ../class/Mono.CompilerServices.SymbolWriter/MonoSymbolTable.cs
 ../class/Mono.CompilerServices.SymbolWriter/MonoSymbolWriter.cs
 ../class/corlib/Mono.Security.Cryptography/CryptoConvert.cs
+../class/corlib/Mono.UnmanagedResources/BITMAPINFOHEADER.cs
+../class/corlib/Mono.UnmanagedResources/DefaultResource.cs
+../class/corlib/Mono.UnmanagedResources/IconInfoHeader.cs
+../class/corlib/Mono.UnmanagedResources/ICONRESDIR.cs
+../class/corlib/Mono.UnmanagedResources/NEWHEADER.cs
+../class/corlib/Mono.UnmanagedResources/RESDIR.cs
+../class/corlib/Mono.UnmanagedResources/ResInfo.cs
+../class/corlib/Mono.UnmanagedResources/ResourceException.cs
+../class/corlib/Mono.UnmanagedResources/ResourceFile.cs
+../class/corlib/Mono.UnmanagedResources/RESOURCEHEADER.cs
+../class/corlib/Mono.UnmanagedResources/ResourceIdentifier.cs
+../class/corlib/Mono.UnmanagedResources/ResourceMemoryFlags.cs
+../class/corlib/Mono.UnmanagedResources/ResourceName.cs
+../class/corlib/Mono.UnmanagedResources/ResourceNode.cs
+../class/corlib/Mono.UnmanagedResources/ResourceOrdinal.cs
+../class/corlib/Mono.UnmanagedResources/ResourceStream.cs
+../class/corlib/Mono.UnmanagedResources/ResourceTypes.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoBlock.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoBlockCollection.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoFileFlags.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoFileOSes.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoFileSubtypes.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoFileTypes.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoResource.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoString.cs
+../class/corlib/Mono.UnmanagedResources/VersionInfoWordArray.cs
+../class/corlib/Mono.UnmanagedResources/VS_FIXEDFILEINFO.cs

&gt;&gt;<i> +            return ((languageId &lt;&lt; 16) | codePage).ToString(upperCase ?
</I>&gt;&gt;<i> &quot;X8&quot; : &quot;x8&quot;, CultureInfo.InvariantCulture);
</I>&gt;&gt;<i> Please use constants instead of X8, x8
</I>&gt;<i>
</I>&gt;<i> I don't really understand what you mean on using constants.
</I>I just don't know what these x8 and X8 strings are. If you declare 
constant with some explanatory name
it will be easier to understand what they are used for.

Marek


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017455.html">[Mono-dev] [PATCH] New managed code for unmanaged (Win32)	resourcehandling (SRE, PEAPI, MCS)
</A></li>
	<LI>Next message: <A HREF="017467.html">[Mono-dev] [PATCH] New managed code for unmanaged	(Win32)resourcehandling (SRE, PEAPI, MCS)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17462">[ date ]</a>
              <a href="thread.html#17462">[ thread ]</a>
              <a href="subject.html#17462">[ subject ]</a>
              <a href="author.html#17462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
