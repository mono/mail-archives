<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] PtrToStringAnsi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PtrToStringAnsi&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017472.html">
   <LINK REL="Next"  HREF="017474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] PtrToStringAnsi</H1>
    <B>Joshua Tauberer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20PtrToStringAnsi&In-Reply-To="
       TITLE="[Mono-dev] PtrToStringAnsi">tauberer at for.net
       </A><BR>
    <I>Wed Mar  8 14:30:33 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017472.html">[Mono-dev] Handling SQLITE_BUSY throush option in SqliteConnection
</A></li>
        <LI>Next message: <A HREF="017474.html">[Mono-dev] PtrToStringAnsi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17473">[ date ]</a>
              <a href="thread.html#17473">[ thread ]</a>
              <a href="subject.html#17473">[ subject ]</a>
              <a href="author.html#17473">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>While debugging a SqliteClient issue, I came across an interesting bug.
 The following returns null when I'm pretty sure it should not (it
doesn't on Windows):

Marshal.PtrToStringAnsi(Marshal.StringToCoTaskMemAnsi(&quot;&#252;&quot;))

In case the encoding of this email gets messed up, that's a u with
umlauts, (char)0xFC.

The encoding half &quot;works&quot; (Marshal.ReadByte reports the bytes (0xFC
0x00)), on the assumption that I'm supposed to get ANSI out of this
method.  Internally, g_utf16_to_utf8 is used, which means that (besides
being surprised this call doesn't actually do ANSI encoding) I would
actually expect a multibyte representation of that character.  That's
from a few minutes of Googling for info on UTF-8.

So I'm confused.  Can someone with more knowledge about encodings tell
me whether this really doesn't make sense?

I'm using the latest RPMs.  Here's a test program:

using System;
using System.Runtime.InteropServices;

public class Test {
    public static void Main() 		
Console.WriteLine(Marshal.PtrToStringAnsi(Marshal.StringToCoTaskMemAnsi(&quot;&#252;&quot;)));
	}
}

-- 
- Joshua Tauberer

<A HREF="http://taubz.for.net">http://taubz.for.net</A>

&quot;Unfortunately, we're having this discussion. It's too bad,
because guess who listens to the discussion: the enemy.&quot;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017472.html">[Mono-dev] Handling SQLITE_BUSY throush option in SqliteConnection
</A></li>
	<LI>Next message: <A HREF="017474.html">[Mono-dev] PtrToStringAnsi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17473">[ date ]</a>
              <a href="thread.html#17473">[ thread ]</a>
              <a href="subject.html#17473">[ subject ]</a>
              <a href="author.html#17473">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
