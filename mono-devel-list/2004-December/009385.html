<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Another C# ?: InvalidCastException
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Another%20C%23%20%3F%3A%20InvalidCastException&In-Reply-To=41BC9526.1090304%40cwazy.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009380.html">
   <LINK REL="Next"  HREF="009396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Another C# ?: InvalidCastException</H1>
    <B>Rafael Teixeira</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Another%20C%23%20%3F%3A%20InvalidCastException&In-Reply-To=41BC9526.1090304%40cwazy.co.uk"
       TITLE="[Mono-devel-list] Another C# ?: InvalidCastException">monoman at gmail.com
       </A><BR>
    <I>Mon Dec 13 10:06:51 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009380.html">[Mono-devel-list] Another C# ?: InvalidCastException
</A></li>
        <LI>Next message: <A HREF="009396.html">[Mono-devel-list] Another C# ?: InvalidCastException
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9385">[ date ]</a>
              <a href="thread.html#9385">[ thread ]</a>
              <a href="subject.html#9385">[ subject ]</a>
              <a href="author.html#9385">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>All fields are Not Null in the database? If not you can't cast then
directly, you have to check if they are null, because in that case
they are a dbnull object not a string and surely not a boxed integer
to be cast.

// out of loop

  int ord_deptime = reader.GetOrdinal(&quot;deptime&quot;);
  int ord_depqty = reader.GetOrdinal(&quot;depqty&quot;);

// in the loop

  if (reader.IsDBNull(ord_deptime))
    deptime = String.Empty; // or deptime = null;
  else
    deptime = reader.GetString(ord_deptime);
  if (reader.IsDBNull(ord_depqty))
    depqty = 0;
  else
    depqty = reader.GetInt32(ord_depqty);

Alternatively you can define deptime, depqty, etc... as SqlString,
SqlInt32, etc.. that are structs that receive the value and the null
state of the column, but it may have some undesirable impact in the
rest of your program.

Hope it helps,


On Sun, 12 Dec 2004 12:59:50 -0600, Eric Scott
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">scottclansman at cwazy.co.uk</A>&gt; wrote:
&gt;<i> Hey, once again I apologize for plopping newbie C# questions into this
</I>&gt;<i> list; if you know of a list that might be better suited for C#
</I>&gt;<i> newbie-ish stuff, let me know!
</I>&gt;<i> 
</I>&gt;<i> So I'm tinkering (again) with PostGreSQL access from C#.  I'm getting
</I>&gt;<i> the data from the database and putting it into my variables.... and
</I>&gt;<i> something goes haywire. Here's the code section:
</I>&gt;<i> 
</I>&gt;<i> &lt;yammer&gt;
</I>&gt;<i> string sql =
</I>&gt;<i>            &quot;SELECT deptime, depqty, depsite, descrip, arvtime, arvqty,
</I>&gt;<i> arvnote &quot; +
</I>&gt;<i>            &quot;FROM log&quot;;
</I>&gt;<i>        dbcmd.CommandText = sql;
</I>&gt;<i>        IDataReader reader = dbcmd.ExecuteReader();
</I>&gt;<i> 
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i> 
</I>&gt;<i> //(In a while loop here)
</I>&gt;<i>             deptime = (string) reader[&quot;deptime&quot;];
</I>&gt;<i>             depqty = (int) reader[&quot;depqty&quot;];
</I>&gt;<i>             depsite = (string) reader[&quot;depsite&quot;];
</I>&gt;<i>             descrip = (string) reader[&quot;descrip&quot;];
</I>&gt;<i>             arvtime = (string) reader[&quot;arvtime&quot;];
</I>&gt;<i>             arvqty = (int) reader[&quot;arvqty&quot;];
</I>&gt;<i>             arvnote = (string) reader[&quot;arvnote&quot;];
</I>&gt;<i> &lt;/yammer&gt;
</I>&gt;<i> 
</I>&gt;<i> Okay, compiles fine.  But when I run the exe I get:
</I>&gt;<i> 
</I>&gt;<i> &gt; Unhandled Exception: System.InvalidCastException: Cannot cast from
</I>&gt;<i> &gt; source type to destination type.
</I>&gt;<i> &gt; in &lt;0x0029c&gt; Test:Main (string[])
</I>&gt;<i> 
</I>&gt;<i> The &quot;deptim&quot; and &quot;depqty&quot; lines execute fine, as does the &quot;arvqty&quot; line,
</I>&gt;<i> but all the other strings give this error.   All of the values being put
</I>&gt;<i> into strings are varchar(32) in the databased, and all the variables
</I>&gt;<i> have been declared as int or string, respectively.
</I>&gt;<i>      Thanks,
</I>&gt;<i>            ES
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>

-- 
Rafael &quot;Monoman&quot; Teixeira
---------------------------------------
Just the 'crazy' me in a sane world, or would it be the reverse? I dunno...

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009380.html">[Mono-devel-list] Another C# ?: InvalidCastException
</A></li>
	<LI>Next message: <A HREF="009396.html">[Mono-devel-list] Another C# ?: InvalidCastException
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9385">[ date ]</a>
              <a href="thread.html#9385">[ thread ]</a>
              <a href="subject.html#9385">[ subject ]</a>
              <a href="author.html#9385">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
