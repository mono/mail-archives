<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] DllImport with multiple shared libraries
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DllImport%20with%20multiple%20shared%20libraries&In-Reply-To=0E9B61AF9C7F4C40854E6E59B7E537AD61A00C%40emsbax05.resdom.droot.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009549.html">
   <LINK REL="Next"  HREF="009552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] DllImport with multiple shared libraries</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DllImport%20with%20multiple%20shared%20libraries&In-Reply-To=0E9B61AF9C7F4C40854E6E59B7E537AD61A00C%40emsbax05.resdom.droot.net"
       TITLE="[Mono-devel-list] DllImport with multiple shared libraries">jonpryor at vt.edu
       </A><BR>
    <I>Thu Dec 23 21:10:14 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009549.html">[Mono-devel-list] DllImport with multiple shared libraries
</A></li>
        <LI>Next message: <A HREF="009552.html">[Mono-devel-list] Compressing the `CategoryData' table
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9554">[ date ]</a>
              <a href="thread.html#9554">[ thread ]</a>
              <a href="subject.html#9554">[ subject ]</a>
              <a href="author.html#9554">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 2004-12-23 at 20:51 +0100, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Heribert.Schuetz.extern at HVB.de</A> wrote:
&gt;<i> I'm trying to call into native code from C# within Mono (on Linux). It works
</I>&gt;<i> fine as long as the native function is completely implemented in a single
</I>&gt;<i> shared library. If, however, this shared library requires another shared
</I>&gt;<i> library, I don't know how I should tell Mono about this other library.
</I>
Short answer: you shouldn't need to.  Mono doesn't load the library, the
Linux Shared Library mechanism does, through dlopen(3).

The reason you shouldn't need to is because the library knows all the
libraries it statically depends on.  How's it know this?  Because you
provide them on the link line.

Except you're not, so everything breaks.  This is also why using
&lt;iostream&gt; breaks your app, you're not linking against the appropriate
libraries.

The fix?  This is untested, but it should get the point across:

	all: run

	.cpp.o:
		g++ -c -o $@ -fpic $&lt;

	libnative.so : native.o libnative2.so
		g++ -shared -o $@ -L. -lnative2 $^

	libnative2.so : native2.o
		g++ -shared -o $@ $^

	native.exe
		mcs $&lt;

	run: native.exe libnative2.so libnative.so
		LD_LIBRARY_PATH=`pwd` mono native.exe

The key points to keep in mind are:

1.  You're using the correct convention, *lib*native.so, not native.so.
This is Unix, not Windows, the prefix should be used (because of (2)).

2.  The libnative.so link line explicitly links against libnative2.so
(this is done by the -L. -- include the current directory in the link
path -- and -lnative2, which links against libnative2.so)

3.  You're using g++ to generate the final .so.  G++ knows to link in
the required C++ standard libraries, libstdc++.so, which should permit
you to #include &lt;iostream&gt; without having linker problems.

 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009549.html">[Mono-devel-list] DllImport with multiple shared libraries
</A></li>
	<LI>Next message: <A HREF="009552.html">[Mono-devel-list] Compressing the `CategoryData' table
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9554">[ date ]</a>
              <a href="thread.html#9554">[ thread ]</a>
              <a href="subject.html#9554">[ subject ]</a>
              <a href="author.html#9554">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
