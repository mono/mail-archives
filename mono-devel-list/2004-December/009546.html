<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] &quot;precise location handling&quot; patch for mcs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%22precise%20location%20handling%22%20patch%20for%20mcs&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009544.html">
   <LINK REL="Next"  HREF="009547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] &quot;precise location handling&quot; patch for mcs</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%22precise%20location%20handling%22%20patch%20for%20mcs&In-Reply-To="
       TITLE="[Mono-devel-list] &quot;precise location handling&quot; patch for mcs">atsushi at ximian.com
       </A><BR>
    <I>Thu Dec 23 13:12:22 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009544.html">[Mono-devel-list] MS Access database and Mono under RH9
</A></li>
        <LI>Next message: <A HREF="009547.html">[Mono-devel-list] &quot;precise location handling&quot; patch for mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9546">[ date ]</a>
              <a href="thread.html#9546">[ thread ]</a>
              <a href="subject.html#9546">[ subject ]</a>
              <a href="author.html#9546">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I made a &quot;precise location handling&quot; patch for mcs i.e. that provides
precise location information. For example, with the example code below:

---- Test.cs ----
public test class {
    public void MyDelegate (
	int foo,
	int bar);
-----------------

For MyDelegate, mcs used to represents its location like &quot;Test.cs(4)&quot;.
With this patch, it returns &quot;Test.cs(2,17)&quot;.

I put a performance comparison here (I think it is not so bad):
<A HREF="http://www24.brinkster.com/ginga/perf-org.txt">http://www24.brinkster.com/ginga/perf-org.txt</A>
<A HREF="http://www24.brinkster.com/ginga/perf-loc.txt">http://www24.brinkster.com/ginga/perf-loc.txt</A>
(In short: 53724KB -&gt; 55684KB)

It also fills location for SymbolWriter.

I have some problems/questions to solve:

	- In location.cs, I dare set token field as int. Thus when
	  there are many files to compile, it won't provide column
	  information nicely (those information are kept compact).

	  For example, our mscorlib.dll have nearly 1200 files and
	  mcs does not provide column numbers at best 7(!).

	  If I modify token field from int to long, it will mostly
	  handle precise columns more, but it results in huge memory
	  consumption (like from 55k to 72k for building mcs).

	  So which is the preferable solution, to use long or not?

	- In report.cs, there are many places that directly uses
	  Location members instead of Location.ToString(). Is there
	  any reason to do so?

If its basic direction looks good, I'll post a patch for the latest
svn (when svn server is back). Comments are welcome :-)

Atsushi Eno

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: mcs-location.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041224/1930da6e/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041224/1930da6e/attachment.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009544.html">[Mono-devel-list] MS Access database and Mono under RH9
</A></li>
	<LI>Next message: <A HREF="009547.html">[Mono-devel-list] &quot;precise location handling&quot; patch for mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9546">[ date ]</a>
              <a href="thread.html#9546">[ thread ]</a>
              <a href="subject.html#9546">[ subject ]</a>
              <a href="author.html#9546">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
