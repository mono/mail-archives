<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Using thirdparty lib with mono and linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Using%20thirdparty%20lib%20with%20mono%20and%20linux&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009551.html">
   <LINK REL="Next"  HREF="009544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Using thirdparty lib with mono and linux</H1>
    <B>Ulrich Meinicke</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Using%20thirdparty%20lib%20with%20mono%20and%20linux&In-Reply-To="
       TITLE="[Mono-devel-list] Using thirdparty lib with mono and linux">ulrich.meinicke at tepcon.de
       </A><BR>
    <I>Thu Dec 23 10:53:46 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009551.html">[Mono-devel-list] Special Characters
</A></li>
        <LI>Next message: <A HREF="009544.html">[Mono-devel-list] MS Access database and Mono under RH9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9545">[ date ]</a>
              <a href="thread.html#9545">[ thread ]</a>
              <a href="subject.html#9545">[ subject ]</a>
              <a href="author.html#9545">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

I developed a software with mono under Windows XP. It connects to
RFID-reader via Ethernet. Therefore I use a third-party library from the
reader manufacturer. 
Compiling and running with mono just works fine. Also with the .Net
Runtime. But it should also run under linux, but it doesn't.

This is a sample of the code:

using System;
using System.Net;

using ILRnet;
 class PortReader {
  
	static CiPort3Net  m_refReader = null;
		
	public static void Main() {

	    if ( m_refReader != null ){
	      m_refReader.Disconnect();
	    }
	   	m_refReader = new CiPort3Net();
	
	   	
	   	if (m_refReader.ConnectEthernet(&quot;192.168.1.44&quot;, 7070)){
	
	   	  m_refReader.SetActiveAntenna(1);

	   	  Console.WriteLine(&quot;Found Reader&quot;);
	   	}else{
	   	  	Console.WriteLine(&quot;Connection to reader failed.
Exit.&quot;);	 	  
	   	}  
  }
}

I compile it with: mcs -r:ILRNet.dll file.cs

When I start the program with &quot;mono file.exe&quot; the files ILRNet.dll and
ILR_SDK_DLL.dll must be in the same directory. It's a dll from the
reader manufacturer. My understanding is, that the ILRNet.dll is the
.Net Assembly and this dll calls functions from the ILR_SDK_DLL.dll
library. So the .Net assembly is just a wrapper. 

The reader manufacturer provides a library for linux. I tried to map the
ILR_SDK_DLL.dll  in the config file:
&lt;configuration&gt;
        &lt;dllmap dll=&quot;cygwin1.dll&quot; target=&quot;libc.so.6&quot; /&gt;
        &lt;dllmap dll=&quot;libc&quot; target=&quot;libc.so.6&quot; /&gt;
        &lt;dllmap dll=&quot;libintl&quot; target=&quot;libc.so.6&quot; /&gt;
        &lt;dllmap dll=&quot;libxslt.dll&quot; target=&quot;libxslt.so&quot; /&gt;
        &lt;dllmap dll=&quot;libmySQL.dll&quot; target=&quot;libmysqlclient.so&quot; /&gt;
        &lt;dllmap dll=&quot;odbc32.dll&quot; target=&quot;libodbc.so&quot; /&gt;
        &lt;dllmap dll=&quot;oci&quot; target=&quot;clntsh&quot; /&gt;
        &lt;dllmap dll=&quot;db2cli&quot; target=&quot;libdb2_36.so&quot;/&gt;
        &lt;dllmap dll=&quot;ILR_SDK_DLL.DLL&quot;
target=&quot;libILR_sdk-i386-gcc3-0.4.3.so&quot;
/&gt;
&lt;/configuration&gt;


As said before compiling this code with mono under linux is just fine. (
I use mono 1.0.4). But during runtime I get the following error:

Unhandled Exception: System.EntryPointNotFoundException: CreateiPort3Obj
in &lt;0x00053&gt; (wrapper managed-to-native)
ILRnet.CiPort3Net:CreateiPort3Obj()
in &lt;0x0001c&gt; ILRnet.CiPort3Net:.ctor ()
in &lt;0x00047&gt; PortReader:Main ()

Is there anything else I could do that the C (or C++) function and
classes of the reader manufacturer are used. I think the function and
class names are different in the .Net dll and the C++ dll.
But where's the mapping?

I appended the relevant include file from the linux c++ library which
the manufactuerer povides. Any further hints/information would be
helpful.

Thanks a lot!

Ulrich


iPortIII.h:

// iPortIII.h: interface for the CiPortIII class.
//
//////////////////////////////////////////////////////////////////////

#if
!defined(AFX_IPORTIII_H__7D35B2D2_B8CB_42E3_AE2F_B3A80EDC1715__INCLUDED_
)
#define AFX_IPORTIII_H__7D35B2D2_B8CB_42E3_AE2F_B3A80EDC1715__INCLUDED_

#if _MSC_VER &gt; 1000
#pragma once
#endif // _MSC_VER &gt; 1000

#include &quot;base_ip3.h&quot;
#include &quot;iTemperatureLog.h&quot;

// socket include for windows
#ifdef WIN32
  #include &lt;winsock.h&gt;
  // link with
  #ifdef _WIN32_WCE
    #pragma comment( lib, &quot;winsock&quot; )
  #else
    // tell the compiler to include socket library
    #pragma comment( lib, &quot;Ws2_32&quot; )
  #endif
#endif


#ifdef ILR_SDK_DLL_EXPORTS
#define ILR_SDK_API __declspec(dllexport) #else #ifdef
ILR_SDK_DLL_IMPORTS #define ILR_SDK_API __declspec(dllimport) #else
#define ILR_SDK_API #endif #endif

/// A class to encapsulate the IPort III functionality via a remote
connection class ILR_SDK_API CiPortIII : public CBase_iPortIII { friend
class CiQTag;
public:
	bool Connect(char *szIPAddress, const short sPortNumber);
	virtual bool Disconnect(void);
	CiPortIII();
	virtual ~CiPortIII();
	virtual bool GetInformation(char *szInformation, WORD
wBufferLength);


	//! \todo Implement me
	virtual bool SetRelays(bool bRelay1, bool bRelay2, bool bRelay3,
bool bRelay4);


private:

	virtual bool ReadTemperatureLog(CiQTag *piQTag, CiTemperatureLog
&amp;iTLog, int nRetries);
	virtual bool StopTemperatureLog(CiQTag *piQTag, int nRetries);
	virtual bool StartTemperatureLog(CiQTag *piQTag, WORD
wIntervalSeconds,int nRetries);
	virtual bool WriteRAM(CBaseTag *pTag, WORD wStartAddress, BYTE
*pbyData, WORD wBytesToWrite, int &amp;iBytesWritten, int retries =
USE_DEFAULT_RETRIES);
	virtual bool ReadRAM(CBaseTag *pTag, WORD wStartAddress, BYTE
*pbyData, WORD wBytesToRead, int &amp;iBytesRead, int retries =
USE_DEFAULT_RETRIES);

/*!\internal
*/
	virtual bool SessionSetup(CBaseTag* pTag, BYTE byMode, int
retries = -1);
	virtual bool SleepTag(CBaseTag* pTag, BYTE bySeconds, int
retries = -1);
	virtual bool ReadEEPROM(CBaseTag *pTag, WORD wStartAddress, BYTE
*pbyData, WORD wBytesToRead, int &amp;iBytesRead, int retries = -1);
	virtual bool WriteEEPROM(CBaseTag *pTag, WORD wStartAddress,
BYTE *pbyData, WORD wBytesToWrite, int &amp;iBytesWritten, int retries =
-1);


private:
	virtual int IPORTWriteConfKey(const char* szKey, int value);
	int  IPORTWriteConfKey(const char* szKey, const char* szValue);
	bool ILRScan(CTagArray &amp;tagArray);
	virtual bool ScanForiDTags(CTagArray &amp;tagArray, WORD
wTagsExpected, BYTE byMaxRollcall, BYTE byMode, int nScanType);
	virtual bool ScanForiQTags(CTagArray &amp;tagArray, WORD
wTagsExpected, BYTE byMaxRollcall, BYTE byMode, int nScanType);
	bool ParseBLINKResponse(CBaseTag* pTag);
	bool ParseWriteEEPROMResponse(CBaseTag *pTag, BYTE *pbyData, int
&amp;iBytesWritten);
	bool ParseReadEEPROMResponse(CBaseTag* pTag, BYTE *pbyData, int
&amp;iBytesRead);
	bool ParseScanResponse(CTagArray &amp;tagArray);
	bool ReceiveResponse(char* szRequestCode, unsigned int
nTimeout);
	bool ParseReadLogResponse(CiQTag *piQTag, CiTemperatureLog
&amp;iTLog);

	void ParseFieldStrengthFromBuffer(CBaseTag* pTag, char*
pBuffer);
	void ParseBatteryStatusFromBuffer(CBaseTag *pTag, char
*pBuffer);
	void ParseVersionFromBuffer(CBaseTag *pTag, char *pBuffer);
	void ParseTemperatureFromBuffer(CBaseTag *pTag, char *pBuffer);

	bool SendCommand(BYTE *pbyBuf, int nBufLen);
	bool IsFullMessageReceived(const int nCurrentLength);
	bool CalculateCRC(BYTE *pbyBuffer, const unsigned int
nBufferLength, char *szResult);

	void SetTime_t(time_t &amp;lTime, int wSecond, int wMinute, int
wHour, int wDay, int wMonth, int wYear);

	SOCKET m_socket;
	SOCKADDR_IN m_sa;
	char m_cBuffer[1024*8];

};

#endif //
!defined(AFX_IPORTIII_H__7D35B2D2_B8CB_42E3_AE2F_B3A80EDC1715__INCLUDED_
)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009551.html">[Mono-devel-list] Special Characters
</A></li>
	<LI>Next message: <A HREF="009544.html">[Mono-devel-list] MS Access database and Mono under RH9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9545">[ date ]</a>
              <a href="thread.html#9545">[ thread ]</a>
              <a href="subject.html#9545">[ subject ]</a>
              <a href="author.html#9545">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
