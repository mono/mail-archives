<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] signal issue? crash when debugger attached and web request fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20signal%20issue%3F%20crash%20when%20debugger%20attached%20and%20web%0A%20request%20fails&In-Reply-To=%3C5412AD91-B845-4A39-9F4A-E16D6E9A04AB%40mugginsoft.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044156.html">
   <LINK REL="Next"  HREF="044160.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] signal issue? crash when debugger attached and web request fails</H1>
    <B>Jonathan Mitchell</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20signal%20issue%3F%20crash%20when%20debugger%20attached%20and%20web%0A%20request%20fails&In-Reply-To=%3C5412AD91-B845-4A39-9F4A-E16D6E9A04AB%40mugginsoft.com%3E"
       TITLE="[Mono-dev] signal issue? crash when debugger attached and web request fails">lists at mugginsoft.com
       </A><BR>
    <I>Tue Feb 21 13:53:01 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044156.html">[Mono-dev] signal issue? crash when debugger attached and web request fails
</A></li>
        <LI>Next message (by thread): <A HREF="044160.html">[Mono-dev] signal issue? crash when debugger attached and web	request fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44158">[ date ]</a>
              <a href="thread.html#44158">[ thread ]</a>
              <a href="subject.html#44158">[ subject ]</a>
              <a href="author.html#44158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>


&gt;<i> On 20 Feb 2017, at 16:18, Zoltan Varga &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">vargaz at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i>   Where is the crash location ? The runtime implements null reference exception checking by catching the SIGSEGV signal, so if a nullref happens in managed code while running under lldb, it will look like a crash. Running with 
</I>&gt;<i> MONO_DEBUG=explicit-null-checks
</I>&gt;<i> turns this behavior off.
</I>&gt;<i> 
</I>
Hi 

Thanks for that.

And yes using MONO_DEBUG=explicit-null-checks mitigates the issue.
I can detect when LLDB is attached and set the env var as required <A HREF="https://github.com/ThesaurusSoftware/Dubrovnik/commit/15b86e3e6c9381944d95488e52ecaad314a1ed81.">https://github.com/ThesaurusSoftware/Dubrovnik/commit/15b86e3e6c9381944d95488e52ecaad314a1ed81.</A>

This issue was occurring on a background worker thread which has perhaps complicated things.
The code is cross platform and WIndows does not raise NullReferenceException at any point.
This may explain why (with LLDB detached) the WIndows error reporting has valid reason for failure detail whereas the Mono implement is empty.

I have some test code for for raising NullReferenceException that I previously used to see just how my app processes managed exceptions into Obj-C ones.
When LLDB is attached the behaviour for this test code is that LLDB does NOT catch the SIGSEGV - which i find curious:
 
scenario 1
========

methodA raises an uncaught NullReferenceException.

    monoResult = mono_runtime_invoke(methodA, NULL, monoArgs, &amp;monoException);
    if (monoException != NULL) {
        @throw(NSExceptionFromMonoException(monoException, @{}));
    }
In this case SIGSEGV is not caught by LLDB and I see NSExceptionFromMonoException raised.

Scenario 2
========

// no monoException argument
monoResult = mono_runtime_invoke(methodA, NULL, monoArgs, NULL);

In this case the exception handler I have installed on AppDomain_UnhandledException gets called and still SIGSEGV is not caught by LLDB.

Is the fact that the NullReferenceException is occurring on a background worker thread significant?
I do have a custom System.Threading.SynchronizationContext installed to route worker thread completion code back onto the Obj-C main thread but we never get that far in this case.

J

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044156.html">[Mono-dev] signal issue? crash when debugger attached and web request fails
</A></li>
	<LI>Next message (by thread): <A HREF="044160.html">[Mono-dev] signal issue? crash when debugger attached and web	request fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44158">[ date ]</a>
              <a href="thread.html#44158">[ thread ]</a>
              <a href="subject.html#44158">[ subject ]</a>
              <a href="author.html#44158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
