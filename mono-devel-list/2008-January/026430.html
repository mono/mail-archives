<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Control-C handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Control-C%20handler&In-Reply-To=flgghd%24tko%241%40ger.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026426.html">
   <LINK REL="Next"  HREF="026435.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Control-C handler</H1>
    <B>Avery Pennarun</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Control-C%20handler&In-Reply-To=flgghd%24tko%241%40ger.gmane.org"
       TITLE="[Mono-dev] Control-C handler">apenwarr at gmail.com
       </A><BR>
    <I>Wed Jan  2 13:08:07 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026426.html">[Mono-dev] Control-C handler
</A></li>
        <LI>Next message: <A HREF="026435.html">[Mono-dev] Control-C handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26430">[ date ]</a>
              <a href="thread.html#26430">[ thread ]</a>
              <a href="subject.html#26430">[ subject ]</a>
              <a href="author.html#26430">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/01/2008, Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt; wrote:
&gt;<i> Avery Pennarun wrote:
</I>&gt;<i> &gt; Surely there must be *some* way to handle signals from inside a mono
</I>&gt;<i> &gt; app?  This seems like a huge omission.  Even perl can do it!
</I>&gt;<i> &gt; (<A HREF="http://search.cpan.org/~lbaxter/Sys-SigAction-0.10/lib/Sys/SigAction.pm">http://search.cpan.org/~lbaxter/Sys-SigAction-0.10/lib/Sys/SigAction.pm</A>)
</I>&gt;<i>
</I>&gt;<i> Well, perl's standard signal handlers suffer from the same limitations
</I>&gt;<i> like mono's and the new &quot;deferred&quot; signal handlers are just a lame
</I>&gt;<i> compromise.
</I>
All signal handlers in any language suffer from the same limitations:
there's no guarantee that the mainline is in a safe state at the time
the signal handler is called.  That means the set of &quot;safe&quot; things you
can do in a signal handler is extremely limited.  In C, this basically
restricts you to direct syscalls (ie. manpages section 2, not section
3) and setting variables.  Generally this is enough, leading to two
safe options in C:

1) Set a (volatile) variable in the signal handler and check it from
the mainline.

2) write() to a pipe during a signal, and poll the read side of the
pipe in the mainline so that it wakes up.  This is safe in a signal
handler because write() is a syscall.

and one unfortunately all-too-common unsafe option:

3) Just ignore the fact that it might not work and do whatever you
want in the signal handler anyhow.  It'll work 99% of the time.

It seems like if mono could guarantee certain things, such as the fact
that an already-JITted function will never be thrown away, that a safe
implementation of #1 would be possible as Jonathan Pryor posted above.
 Does mono make that guarantee?  Will it continue to do so?

Currently implementation #2 is probably impossible (or unsafe) in mono
since the socket code is probably much more complex than a syscall and
may still be in an unsafe state.  Perl has a similar problem, which is
why the &quot;deferred&quot; signal handlers were created.

Option #3 is probably not 99% safe in mono, which has more runtime
state outside the kernel than a C program would.

What makes the perl ones a &quot;lame compromise&quot; in your opinion?

How does Microsoft's .Net handle Windows-style &quot;signals&quot;, such as
memory-access errors?  Could we use a similar method in mono?

Have fun,

Avery

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026426.html">[Mono-dev] Control-C handler
</A></li>
	<LI>Next message: <A HREF="026435.html">[Mono-dev] Control-C handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26430">[ date ]</a>
              <a href="thread.html#26430">[ thread ]</a>
              <a href="subject.html#26430">[ subject ]</a>
              <a href="author.html#26430">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
