<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Simplifying/optimizing CodeGenerator.cs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Simplifying/optimizing%20CodeGenerator.cs&In-Reply-To=1199660659.7075.23.camel%40funnyfarm.hotfeet.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026497.html">
   <LINK REL="Next"  HREF="026519.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Simplifying/optimizing CodeGenerator.cs</H1>
    <B>Robert Jordan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Simplifying/optimizing%20CodeGenerator.cs&In-Reply-To=1199660659.7075.23.camel%40funnyfarm.hotfeet.ch"
       TITLE="[Mono-dev] [PATCH] Simplifying/optimizing CodeGenerator.cs">robertj at gmx.net
       </A><BR>
    <I>Mon Jan  7 07:26:24 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026497.html">[Mono-dev] [PATCH] Simplifying/optimizing CodeGenerator.cs
</A></li>
        <LI>Next message: <A HREF="026519.html">[Mono-dev] [PATCH] Simplifying/optimizing CodeGenerator.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26513">[ date ]</a>
              <a href="thread.html#26513">[ thread ]</a>
              <a href="subject.html#26513">[ subject ]</a>
              <a href="author.html#26513">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Juray,

Juraj Skripsky wrote:
&gt;<i> Adding a abstract method to CodeObject, e.g.
</I>&gt;<i> 
</I>&gt;<i> abstract void GenerateCode(CodeGenerator generator);
</I>&gt;<i> 
</I>&gt;<i> and implementing/overriding it in each subclass (where it calls the
</I>&gt;<i> appropriate CodeGenerator.GenerateXYZ mehtod) would indeed result in
</I>&gt;<i> nicer and faster code.
</I>

This is not quite &quot;Visitor&quot;, but it will do it as well.
The drawback is that the CodeObject hierarchy will depend
on internal CodeGenerator members.

With Visitor, this dependency can be eliminated (at the cost
of some bookkeeping acrobatics):

public class CodeObject {
	...
	internal abstract void Accept(CodeDomVisitor visitor);
}

public class CodeArrayCreateExpression : CodeObject {
	...
	internal override void Accept(CodeDomVisitor visitor)
	{
		visitor.Visit (this);
	}
}

...

internal class CodeDomVisitor {
	public abstract void Visit (CodeArrayCreateExpression o);
	public abstract void Visit (CodeArgumentReferenceExpression o);
	public abstract void Visit (CodeArrayCreateExpression o);
	...
}

public class CodeGenerator {
	internal class Visitor : CodeDomVisitor {
		CodeGenerator g;

		public override void Visit (CodeArrayCreateExpression o)
		{
			g.GenerateArrayCreateExpression (o);
		}

		public override void Visit (CodeArgumentReferenceExpression o)
		{
			g.GenerateArgumentReferenceExpression (o);
		}
		...
	}
}

&gt;<i> 
</I>&gt;<i> - Juraj
</I>&gt;<i> 
</I>
Robert



&gt;<i> 
</I>&gt;<i> On Sun, 2008-01-06 at 23:45 +0100, Juraj Skripsky wrote:
</I>&gt;&gt;<i> Hi Robert,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I don't see how to use the visitor pattern in the implementation of
</I>&gt;&gt;<i> CodeGenerator. But I'm probably to close to the details right now to see
</I>&gt;&gt;<i> the big picture.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Could you roughly describe how you meant to apply the visitor pattern to
</I>&gt;&gt;<i> this class?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - Juraj
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Sun, 2008-01-06 at 23:15 +0100, Robert Jordan wrote:
</I>&gt;&gt;&gt;<i> Hi Juraj,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Juraj Skripsky wrote:
</I>&gt;&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Attached you'll find a patch for CodeGenerator.cs (in
</I>&gt;&gt;&gt;&gt;<i> System.CodeDom.Compiler). It simplifies two methods considerably and
</I>&gt;&gt;&gt;&gt;<i> might also bring a small performance improvement (perf. tests pending).
</I>&gt;&gt;&gt;<i> I think using a visitor pattern would be more appropriate.
</I>&gt;&gt;&gt;<i> Performance and style-wise.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Robert
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026497.html">[Mono-dev] [PATCH] Simplifying/optimizing CodeGenerator.cs
</A></li>
	<LI>Next message: <A HREF="026519.html">[Mono-dev] [PATCH] Simplifying/optimizing CodeGenerator.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26513">[ date ]</a>
              <a href="thread.html#26513">[ thread ]</a>
              <a href="subject.html#26513">[ subject ]</a>
              <a href="author.html#26513">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
