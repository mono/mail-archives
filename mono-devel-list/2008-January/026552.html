<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] ToString() performace in Mono revisited
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20ToString%28%29%20performace%20in%20Mono%20revisited&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026571.html">
   <LINK REL="Next"  HREF="026569.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] ToString() performace in Mono revisited</H1>
    <B>Eyal Alaluf</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20ToString%28%29%20performace%20in%20Mono%20revisited&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] ToString() performace in Mono revisited">eyala at mainsoft.com
       </A><BR>
    <I>Wed Jan  9 04:03:00 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026571.html">[Mono-dev] [SPAM]  Re:  Tests failures when running on MS.NET
</A></li>
        <LI>Next message: <A HREF="026569.html">[Mono-dev] [SPAM] Re: [PATCH] ToString() performace in Mono	revisited
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26552">[ date ]</a>
              <a href="thread.html#26552">[ thread ]</a>
              <a href="subject.html#26552">[ subject ]</a>
              <a href="author.html#26552">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Miguel.

Can I go ahead and commit this important patch?

Thanks, Eyal.

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Eyal
Alaluf
Sent: 06 January 2008 16:34
To: Andreas Nahr; Prakash Punnoor; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Cc: Atsushi Eno; Miguel de Icaza; Juraj Skripsky
Subject: Re: [Mono-dev] [SPAM] Re: [SPAM] Re: ToString() performace
inMono revisited

Hi, all.

I have attached a patch following Andreas suggestions below. Please
review, especially the metadata part.

I saw once that Mono checks compatibility of Mscorlib with the runtime,
is this happenening automatically whenever an internal call is added?

BTW, since now the numberFormatter tables become arrays of magic numbers
in mono/metadata, is there a place where I should put the program that
generates these numbers?

Thanks, Eyal.

-----Original Message-----
From: Andreas Nahr [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ClassDevelopment at A-SoftTech.com</A>] 
Sent: 04 January 2008 00:26
To: Eyal Alaluf; 'Andreas Nahr'; 'Prakash Punnoor';
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Cc: 'Atsushi Eno'; 'Miguel de Icaza'; 'Juraj Skripsky'
Subject: AW: [SPAM] Re: [Mono-dev] [SPAM] Re: ToString() performace in
Mono revisited

&gt;<i> It does make sense to make the 'DblExpTab' common to all appdomains.
</I>&gt;<i> How do you implement such a scheme in Mono? Is it possible to 
</I>&gt;<i> achieve this without going out to unsafe code and internal methods?
</I>
Afaik to gain all the advantages you need one internal method to return
the
pointers and unsafe code for accepting the pointer.
The scheme is pretty straightforward (compare Char or CultureInfo):
Runtime:
* Pregenerate the table data
* convert to a C constant array
* embed that into the runtime (e.g.
<A HREF="http://anonsvn.mono-project.com/viewcvs/trunk/mono/mono/metadata/culture">http://anonsvn.mono-project.com/viewcvs/trunk/mono/mono/metadata/culture</A>
-inf
o-tables.h?rev=88796&amp;view=auto)
* Create one runtime method to return a pointer to the array
Classlib:
* Define internalcall to the runtime method
* Store the retrieved pointer in a static variable
* Use the pointer as you would use the array (syntax is compatible, so
no
need to change the code)
* Get Array-Bounds-Check-Removal for free :)

&gt;<i> If the above is complicated, do you think that it makes sense 
</I>&gt;<i> to consider the above as a separate task since the array size 
</I>&gt;<i> is now 24K and a scenario with 1000 domains is a rare scenario?
</I>
Well I personally am much more concerned about the additional startup
cost
of the current suggestion (Managed already has a high startup cost and
this
is measurably increasing it) than the additional memory cost. But not
everybody will think that way...
So imho it would be worth implementing in the runtime.
 
Greetings Andreas

P.S. WAY back then I tried to do the same without runtime support by
acquiring a pointer to an embedded resource file. I don't know if this
works
now, but back then it didn't (as far as I can remember).
A starting point MIGHT be Assembly.GetManifestResourceInternal

-------------- next part --------------
A non-text attachment was scrubbed...
Name: NumberFormatter.zip
Type: application/x-zip-compressed
Size: 46673 bytes
Desc: NumberFormatter.zip
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080109/197433d9/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080109/197433d9/attachment.bin</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT07837.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080109/197433d9/attachment.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080109/197433d9/attachment.txt</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026571.html">[Mono-dev] [SPAM]  Re:  Tests failures when running on MS.NET
</A></li>
	<LI>Next message: <A HREF="026569.html">[Mono-dev] [SPAM] Re: [PATCH] ToString() performace in Mono	revisited
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26552">[ date ]</a>
              <a href="thread.html#26552">[ thread ]</a>
              <a href="subject.html#26552">[ subject ]</a>
              <a href="author.html#26552">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
