<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mod_mono and xsp patches
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mod_mono%20and%20xsp%20patches&In-Reply-To=20080121181428.07f43067%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026694.html">
   <LINK REL="Next"  HREF="026697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mod_mono and xsp patches</H1>
    <B>Joshua Tauberer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mod_mono%20and%20xsp%20patches&In-Reply-To=20080121181428.07f43067%40gmail.com"
       TITLE="[Mono-dev] mod_mono and xsp patches">jit at occams.info
       </A><BR>
    <I>Mon Jan 21 13:45:54 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026694.html">[Mono-dev] mod_mono and xsp patches
</A></li>
        <LI>Next message: <A HREF="026697.html">[Mono-dev] mod_mono and xsp patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26696">[ date ]</a>
              <a href="thread.html#26696">[ thread ]</a>
              <a href="subject.html#26696">[ subject ]</a>
              <a href="author.html#26696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Marek Habersack wrote:
&gt;<i> They're OK to go in, thanks!
</I>
Great, in that case, I'm attaching another patch for mod_mono that 
implements rate limiting. I had found that under relatively heavy load, 
mod-mono-server would deadlock. Incoming requests would hang forever, 
with the result that all of the Apache child processes would get tied up 
as more requests came in, and so all websites on the server would stop.

There are only so many worker threads in the XSP thread pool, and at a 
certain point they're going to get used up. I forget how many threads 
there are by default, maybe 128, but at a few workers per request, that 
number gets used up quickly. Obviously the right thing to do would be to 
make sure mod-mono-server doesn't hang when it runs out of worker 
threads (if this was even the problem), but barring a fix there, this 
did the job.

In my case, I was having problems when the number of concurrent requests 
went above 20 or 25. (I forget the details. I've been using this patch 
for around 3-4 months... modulo changes I made today.)

The patch by default limits the number of concurrent requests passed to 
mod-mono-server to 20. After that, it holds onto (by default) up to 20 
more, checking periodically until the initial 20 decreases or a timeout 
(hard-coded at 10 seconds). The two 20's are configurable with 
MonoMaxActiveRequests and MonoMaxWaitingRequests.

This will only work on Apache2 since it relies on the shared memory 
dashboards.

-- 
- Josh Tauberer

<A HREF="http://razor.occams.info">http://razor.occams.info</A>

&quot;Yields falsehood when preceded by its quotation!  Yields
falsehood when preceded by its quotation!&quot; Achilles to
Tortoise (in &quot;G&#246;del, Escher, Bach&quot; by Douglas Hofstadter)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mod_mono.diff
Type: text/x-patch
Size: 9105 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080121/816baeec/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080121/816baeec/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026694.html">[Mono-dev] mod_mono and xsp patches
</A></li>
	<LI>Next message: <A HREF="026697.html">[Mono-dev] mod_mono and xsp patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26696">[ date ]</a>
              <a href="thread.html#26696">[ thread ]</a>
              <a href="subject.html#26696">[ subject ]</a>
              <a href="author.html#26696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
