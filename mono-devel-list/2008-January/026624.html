<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono dtrace provider?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20dtrace%20provider%3F&In-Reply-To=20070927135951.GZ25385%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026649.html">
   <LINK REL="Next"  HREF="026628.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono dtrace provider?</H1>
    <B>Andreas F&#228;rber</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20dtrace%20provider%3F&In-Reply-To=20070927135951.GZ25385%40debian.org"
       TITLE="[Mono-dev] Mono dtrace provider?">andreas.faerber at web.de
       </A><BR>
    <I>Sat Jan 12 19:54:49 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026649.html">[Mono-dev] Ubuntu Gutsy + Monodevelop beta 3(0.18.1)
</A></li>
        <LI>Next message: <A HREF="026628.html">[Mono-dev] Mono dtrace provider?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26624">[ date ]</a>
              <a href="thread.html#26624">[ thread ]</a>
              <a href="subject.html#26624">[ subject ]</a>
              <a href="author.html#26624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Am 27.09.2007 um 15:59 schrieb Paolo Molaro:

&gt;<i> On 09/26/07 Jason Brazile wrote:
</I>&gt;&gt;<i> I know this would only be applicable to Solaris, FreeBSD
</I>&gt;&gt;<i> (<A HREF="http://marc.info/?l=freebsd-current&amp;m=114982741014845&amp;w=2">http://marc.info/?l=freebsd-current&amp;m=114982741014845&amp;w=2</A>) or MacOSX
</I>&gt;&gt;<i> (<A HREF="http://blogs.sun.com/mws/#dtrace_on_macos_x_at">http://blogs.sun.com/mws/#dtrace_on_macos_x_at</A>) but is there a
</I>&gt;&gt;<i> C#/Mono dtrace provider available e.g.
</I>&gt;<i>
</I>&gt;<i> We don't, though feel free to contribute one.
</I>
I've looked into adding USDT probes to Mono; in theory this is very  
easy:
- write a .d provider file with definitions of the probes,
- generate a C header file from the .d file (dtrace -h),
- use macros from the .h file in source file,
- compile sources to .o,
- provide .d file and .o files to dtrace -G and get an additional .o  
file, and
- compile all .o files to executable.
This works fine for a test app.

Mono however uses libtool+automake for building: First, there seem to  
be PIC and non-PIC .o files generated; then most .o files are compiled  
into .a archives; and finally, all these .o files are handled  
automagically by libtool/automake/whatever so it's difficult to add  
such manual build steps.

I tried on Solaris Express 9/07 and finally got Mono building with a  
probe in mini.c enabled, but at runtime it's not there, so something  
goes wrong with my attached build process hack but I don't know  
where. ;)

I thought data/ would be an obvious choice for the .d file, and chose  
mono/utils for the generated header and object file but the object  
file seems to depend on all object files with the probes, here mini.o  
(and seems to update those with nops), so this kind of breaks that idea.
Obviously DTrace support would need to be enabled by configure, and  
the dtrace path shouldn't be hardcoded (dtrace on OSX) etc., but  
anything working would be a start!

If someone has a suggestion...

Andreas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dtrace-hack.diff
Type: application/octet-stream
Size: 2834 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080113/323a2043/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080113/323a2043/attachment.obj</A> 
-------------- next part --------------



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026649.html">[Mono-dev] Ubuntu Gutsy + Monodevelop beta 3(0.18.1)
</A></li>
	<LI>Next message: <A HREF="026628.html">[Mono-dev] Mono dtrace provider?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26624">[ date ]</a>
              <a href="thread.html#26624">[ thread ]</a>
              <a href="subject.html#26624">[ subject ]</a>
              <a href="author.html#26624">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
