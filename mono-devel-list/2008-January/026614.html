<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Program Option Parsing Library
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Program%20Option%20Parsing%20Library&In-Reply-To=1200080343.4616.77.camel%40lina.magi.jprl.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026610.html">
   <LINK REL="Next"  HREF="026622.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Program Option Parsing Library</H1>
    <B>Jay Logue</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Program%20Option%20Parsing%20Library&In-Reply-To=1200080343.4616.77.camel%40lina.magi.jprl.com"
       TITLE="[Mono-dev] Program Option Parsing Library">jay-MonoDev at toaster.com
       </A><BR>
    <I>Fri Jan 11 17:06:13 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026610.html">[Mono-dev] Program Option Parsing Library
</A></li>
        <LI>Next message: <A HREF="026622.html">[Mono-dev] Program Option Parsing Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26614">[ date ]</a>
              <a href="thread.html#26614">[ thread ]</a>
              <a href="subject.html#26614">[ subject ]</a>
              <a href="author.html#26614">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jonathan Pryor wrote:
&gt;<i> (aside from syntax and tests) Options _should_ currently be .NET 2.0 compatible
</I>&gt;<i>   
</I>I think 2.0 compatibility is important.  Not everybody is ready to jump 
on the C# 3.0 bandwagon (my company included).
&gt;<i> I guess I should create a new delegate type:
</I>&gt;<i>
</I>&gt;<i> 	delegate string OptionLocalizer (string format, string[] args);
</I>&gt;<i>
</I>&gt;<i> Other possible type names appreciated (and I don't like Rafael's
</I>&gt;<i> TranslateIt name. ;-)
</I>&gt;<i>   
</I>I like this approach.  Would it be used for option descriptions as well? 
&gt;<i> This is also a good idea, and suffers the same problem as providing the
</I>&gt;<i> actual option used: the callback doesn't have that information, and thus
</I>&gt;<i> can't provide it in the OptionException.
</I>&gt;<i>   
</I>I faced this exact issue in a configuration system I wrote, except there 
the problem was exacerbated by the need to have file and line 
information in the exception (plus it was based on .NET 1.1, so no anon 
delegates to make things prettier). I  solved it by requiring the use of 
a context object.

How about this.  Create a delegate that takes the necessary context 
information, e.g.:

    delegate void OptionAction&lt;T&gt;(T v, string optionName);

and use this as the argument to the workhorse Add&lt;T&gt; method:

    public Options Add&lt;T&gt; (string options, string description, 
OptionAction&lt;T&gt; action)

then create an overloaded Add&lt;T&gt; that accepts an Action&lt;T&gt; and calls the 
workhorse method:

    public Options Add&lt;T&gt;(string options, string description, Action&lt;T&gt; 
action)
    {
        return Add(options, description, delegate(T v, string 
optionName) { action(v); });
    }

That way the user can make use of the context when they want too, but 
the type conversion code has access to it all the time.
&gt;<i> Foo isn't a stand-in for the real type, it *is* the real type.  Just as
</I>&gt;<i> `int' is the real type, not System.ComponentModel.Int32Converter (the
</I>&gt;<i> actual type that does the string-&gt;int conversion).
</I>What about the case where you want an option that accepts standard 
binary abbreviations, e.g. 1K for 1024?  The type of the value is 
clearly an integer, but I need a custom parser to handle the syntax.   
I'd rather not have to wrap the integer in a custom type just to get 
special parsing behavior (e.g. class Int32ThatSupportsBinAbbrevs :-).

That said, if you solve the problem of user thrown exceptions having 
access to the parsing context, then I can just handle this myself in the 
Action code.

-- Jay

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080111/5ee77bc8/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080111/5ee77bc8/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026610.html">[Mono-dev] Program Option Parsing Library
</A></li>
	<LI>Next message: <A HREF="026622.html">[Mono-dev] Program Option Parsing Library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26614">[ date ]</a>
              <a href="thread.html#26614">[ thread ]</a>
              <a href="subject.html#26614">[ subject ]</a>
              <a href="author.html#26614">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
