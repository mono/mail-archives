<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono generates inefficient vectorized code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20generates%20inefficient%20vectorized%20code&In-Reply-To=19e4cfaf1003111530s57ad1f82sb14a6efa43ff7a1e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034323.html">
   <LINK REL="Next"  HREF="034325.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono generates inefficient vectorized code</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20generates%20inefficient%20vectorized%20code&In-Reply-To=19e4cfaf1003111530s57ad1f82sb14a6efa43ff7a1e%40mail.gmail.com"
       TITLE="[Mono-dev] Mono generates inefficient vectorized code">kumpera at gmail.com
       </A><BR>
    <I>Thu Mar 11 18:56:26 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034323.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
        <LI>Next message: <A HREF="034325.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34324">[ date ]</a>
              <a href="thread.html#34324">[ thread ]</a>
              <a href="subject.html#34324">[ subject ]</a>
              <a href="author.html#34324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sergei,

On Thu, Mar 11, 2010 at 8:30 PM, Sergei Dyshel &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">qyron.private at gmail.com</A>&gt;wrote:

&gt;<i> Hello,
</I>&gt;<i> I'm doing some research on vectorization using Mono. I've noticed that
</I>&gt;<i> code generated by Mono's JIT contains many unnecessary memory loads
</I>&gt;<i> and stores. Here is simple example, the full code is attached:
</I>&gt;<i>
</I>&gt;<i> public static unsafe int sum(int* a, int size) {
</I>&gt;<i>  Vector4i temp = new Vector4i();
</I>&gt;<i>  Vector4i* p = (Vector4i*) a;
</I>&gt;<i>  for (int i = 0; i &lt; size/4; i++) {
</I>&gt;<i>    temp += *p;
</I>&gt;<i>    p += 1;
</I>&gt;<i>  }
</I>&gt;<i>  return temp.X + temp.Y + temp.Z + temp.W;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>
The problem you're seen of going to memory when not needed is due to the
fact that
mono lacks a working global register allocator. If you use a value in a
single basic block,
you'll notice that it's kept in memory the whole time.

We don't eliminate a lot of redundancies, even under SSA, because our JIT
doesn't know how
to handle SIMD ops under that form. It's an open problem requiring some
work. The same
applies to our global register allocator.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100311/5e74622c/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100311/5e74622c/attachment.html</A> 
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034323.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
	<LI>Next message: <A HREF="034325.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34324">[ date ]</a>
              <a href="thread.html#34324">[ thread ]</a>
              <a href="subject.html#34324">[ subject ]</a>
              <a href="author.html#34324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
