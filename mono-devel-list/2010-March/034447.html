<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] stressing mono and xsp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20stressing%20mono%20and%20xsp&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034444.html">
   <LINK REL="Next"  HREF="034448.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] stressing mono and xsp</H1>
    <B>Hugo Ribeiro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20stressing%20mono%20and%20xsp&In-Reply-To="
       TITLE="[Mono-dev] stressing mono and xsp">hribeiro at janeladigital.com
       </A><BR>
    <I>Mon Mar 22 12:34:33 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034444.html">[Mono-dev] Embedding Scenario with MonoReflectionType
</A></li>
        <LI>Next message: <A HREF="034448.html">[Mono-dev] Regex.Match(string, int, int) behaves differently than Microsoft's implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34447">[ date ]</a>
              <a href="thread.html#34447">[ thread ]</a>
              <a href="subject.html#34447">[ subject ]</a>
              <a href="author.html#34447">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Been testing xsp with 500 simultaneous users per second and found out two 
issues in code. Also had been getting some annoying exceptions.

-Connection.cs (i sink the disposed exception, because sometimes the socket is 
closed on endrequest right away)

	while (!stop &amp;&amp; (UnfinishedRequests || keep_alive));
				
	if (requests.Count == 0) {
		try
		{
			socket.Close ();
			server.EndConnection (this);
			server.ReleaseBuffers (receive_buffer, send_buffer);
		}
		catch (System.ObjectDisposedException) 
		{
			//do nothing, already disposed on endrequest
		}
	}

-Server.cs (on RequestCount property)
		/*
		foreach (Connection c in connections)
			requests += c.RequestCount;
		*/
		for(int i=0;i&lt;connections.Count;i++)
		{
			requests += ((Connection)connections[i]).RequestCount;
		}
		return requests;

The first aproach i didnt like it very much, is a pain to sink an exception. 
We should only make the close on one place.

The second change i didnt have more the exception that the collection had 
change, but isnt thread safe also. It resolve the problem because i think it 
was on the add and not on the remove.

A curious fact was that with the second change the pages started to be 
processed 30% faster.

Are these good changes to apply or should we make the changes another way?

Regards,
Ribeiro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100322/e410ff14/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100322/e410ff14/attachment.html</A> 
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034444.html">[Mono-dev] Embedding Scenario with MonoReflectionType
</A></li>
	<LI>Next message: <A HREF="034448.html">[Mono-dev] Regex.Match(string, int, int) behaves differently than Microsoft's implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34447">[ date ]</a>
              <a href="thread.html#34447">[ thread ]</a>
              <a href="subject.html#34447">[ subject ]</a>
              <a href="author.html#34447">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
