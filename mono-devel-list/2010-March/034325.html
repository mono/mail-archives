<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono generates inefficient vectorized code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20generates%20inefficient%20vectorized%20code&In-Reply-To=8cca42d81003111556h6547c528t6eff3f647be32204%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034324.html">
   <LINK REL="Next"  HREF="034327.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono generates inefficient vectorized code</H1>
    <B>Sergei Dyshel</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20generates%20inefficient%20vectorized%20code&In-Reply-To=8cca42d81003111556h6547c528t6eff3f647be32204%40mail.gmail.com"
       TITLE="[Mono-dev] Mono generates inefficient vectorized code">qyron.private at gmail.com
       </A><BR>
    <I>Thu Mar 11 19:15:36 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034324.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
        <LI>Next message: <A HREF="034327.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34325">[ date ]</a>
              <a href="thread.html#34325">[ thread ]</a>
              <a href="subject.html#34325">[ subject ]</a>
              <a href="author.html#34325">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Rodrigo,
Thanks for the quick answer! But do you mean by it that the only
problem is in lack of global register allocator? What if 'temp' was
not vector but some bare 'int' temporary, would it be loaded and
stored in each iteration?

Another question. I know that there is also LLVM engine in Mono and
LLVM generally supports vector instructions in his IR. Is it hard to
add SIMD support to mono-llvm.c?
-- 
Regards,
Sergei Dyshel



On Fri, Mar 12, 2010 at 01:56, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:
&gt;<i> Hi Sergei,
</I>&gt;<i>
</I>&gt;<i> On Thu, Mar 11, 2010 at 8:30 PM, Sergei Dyshel &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">qyron.private at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i> I'm doing some research on vectorization using Mono. I've noticed that
</I>&gt;&gt;<i> code generated by Mono's JIT contains many unnecessary memory loads
</I>&gt;&gt;<i> and stores. Here is simple example, the full code is attached:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> public static unsafe int sum(int* a, int size) {
</I>&gt;&gt;<i> &#160;Vector4i temp = new Vector4i();
</I>&gt;&gt;<i> &#160;Vector4i* p = (Vector4i*) a;
</I>&gt;&gt;<i> &#160;for (int i = 0; i &lt; size/4; i++) {
</I>&gt;&gt;<i> &#160; &#160;temp += *p;
</I>&gt;&gt;<i> &#160; &#160;p += 1;
</I>&gt;&gt;<i> &#160;}
</I>&gt;&gt;<i> &#160;return temp.X + temp.Y + temp.Z + temp.W;
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The problem you're seen of going to memory when not needed is due to the
</I>&gt;<i> fact that
</I>&gt;<i> mono lacks a working global register allocator. If you use a value in a
</I>&gt;<i> single basic block,
</I>&gt;<i> you'll notice that it's kept in memory the whole time.
</I>&gt;<i>
</I>&gt;<i> We don't eliminate a lot of redundancies, even under SSA, because our JIT
</I>&gt;<i> doesn't know how
</I>&gt;<i> to handle SIMD ops under that form. It's an open problem requiring some
</I>&gt;<i> work. The same
</I>&gt;<i> applies to our global register allocator.
</I>&gt;<i>
</I></PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034324.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
	<LI>Next message: <A HREF="034327.html">[Mono-dev] Mono generates inefficient vectorized code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34325">[ date ]</a>
              <a href="thread.html#34325">[ thread ]</a>
              <a href="subject.html#34325">[ subject ]</a>
              <a href="author.html#34325">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
