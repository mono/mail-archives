<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Equivalent to LockFileEx on Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Equivalent%20to%20LockFileEx%20on%20Linux&In-Reply-To=443734.92952.qm%40web30801.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034260.html">
   <LINK REL="Next"  HREF="034264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Equivalent to LockFileEx on Linux</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Equivalent%20to%20LockFileEx%20on%20Linux&In-Reply-To=443734.92952.qm%40web30801.mail.mud.yahoo.com"
       TITLE="[Mono-dev] Equivalent to LockFileEx on Linux">jonpryor at vt.edu
       </A><BR>
    <I>Tue Mar  2 16:28:15 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034260.html">[Mono-dev] Equivalent to LockFileEx on Linux
</A></li>
        <LI>Next message: <A HREF="034264.html">[Mono-dev] Equivalent to LockFileEx on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34263">[ date ]</a>
              <a href="thread.html#34263">[ thread ]</a>
              <a href="subject.html#34263">[ subject ]</a>
              <a href="author.html#34263">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2010-03-02 at 12:29 -0800, Daniel Morgan wrote:
&gt;<i> Is there an equivalent to LockFileEx on Linux?  What would it be?
</I>
No.  There's flock(2) and fcntl(2), but these are advisory in nature
only.  (Meaning that any other process with access rights to the file
can come along, ignore the advisory lock, and change the file underneath
you.)

In managed code, there's System.IO.FileStream.Lock(long, long) and
System.IO.FileStream.Unlock(long, long), but these use fcntl(2)'s
F_SETLK functionality.

Mandatory locking (according to fcntl(2)) requires that the file system
opt-in (via the '-o mand' option to mount(8)) AND enabled on the file by
disabling group execute permission and enabling the set-group-ID
permission bit.  None of my systems have '-o mand' specified, and I
doubt that very many systems do.

&gt;<i> How would you lock a file that will work on .net on windows and mono
</I>&gt;<i> on linux and mono on windows and mono on mac os x, etc?
</I>
You don't.  Bwa-ha-ha-ha-ha.

Sorry.

Related question: why do you need this?  Linux and Unix seem to get
along just fine without system-wide mandatory locking...

Perhaps as an alternative you should read/write to a temporary file,
flush the file, then rename the file (assuming file renames are atomic,
which is *usually* the case).  You might lose data if two processes
attempt to overwrite the same file at the same time, but at least your
DB will be consistent and not corrupted...

 - Jon


</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034260.html">[Mono-dev] Equivalent to LockFileEx on Linux
</A></li>
	<LI>Next message: <A HREF="034264.html">[Mono-dev] Equivalent to LockFileEx on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34263">[ date ]</a>
              <a href="thread.html#34263">[ thread ]</a>
              <a href="subject.html#34263">[ subject ]</a>
              <a href="author.html#34263">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
