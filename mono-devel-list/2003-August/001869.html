<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Different behaviour deserializing ISerializable trees Mono &lt;-&gt; .NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Different%20behaviour%20deserializing%20ISerializable%20trees%20Mono%20%3C-%3E%20.NET&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001862.html">
   <LINK REL="Next"  HREF="001870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Different behaviour deserializing ISerializable trees Mono &lt;-&gt; .NET</H1>
    <B>J&#246;rg Rosenkranz</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Different%20behaviour%20deserializing%20ISerializable%20trees%20Mono%20%3C-%3E%20.NET&In-Reply-To="
       TITLE="[Mono-devel-list] Different behaviour deserializing ISerializable trees Mono &lt;-&gt; .NET">joergr at voelcker.com
       </A><BR>
    <I>Mon Aug 25 09:29:11 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001862.html">[Mono-devel-list] Porting Mono to Other OS
</A></li>
        <LI>Next message: <A HREF="001870.html">[Mono-devel-list] Different behaviour deserializing	ISerializable trees Mono &lt;-&gt; .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1869">[ date ]</a>
              <a href="thread.html#1869">[ thread ]</a>
              <a href="subject.html#1869">[ subject ]</a>
              <a href="author.html#1869">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I have run into a problem serializing/deserializing classes which 
implement ISerializable.

I have two classes:
1) A data holding class.
2) A collection class for objects of class 1

Both classes implement ISerializable. The class 1 objects are 
stored in class 2 in a Hashtable internally. I want to restore key 
to object relation in the deserialization constructor of the 
collection class.

My problem is that the collection elements are deserialized *after* the 
collection class. When I access them in the constructor of class 2
they are empty.

You can try the attached sample. It doesn't use Hashtable but shows 
the different behaviour. Using Mono it prints:

========== Serialization ==========
Serializing TestCollection...
0 - Adding member: Value1=member1, Value2=test1 ...
1 - Adding member: Value1=member2, Value2=test2 ...
2 - Adding member: Value1=member3, Value2=test3 ...
TestCollection serialized.
Serializing TestMember: Value1=member3, Value2=test3 ...
TestMember serialized.
Serializing TestMember: Value1=member1, Value2=test1 ...
TestMember serialized.
Serializing TestMember: Value1=member2, Value2=test2 ...
TestMember serialized.
========== Deserialization ==========
Deserializing TestCollection...
0 - New deserialized member: Value1=, Value2= ...
1 - New deserialized member: Value1=, Value2= ...
2 - New deserialized member: Value1=, Value2= ...
Deserialized TestCollection.
Deserializing TestMember...
Deserialized TestMember: Value1=member3, Value2=test3
Deserializing TestMember...
Deserialized TestMember: Value1=member1, Value2=test1
Deserializing TestMember...
Deserialized TestMember: Value1=member2, Value2=test2
========== Result ==========
0: Value1=member1, Value2=test1
1: Value1=member2, Value2=test2
2: Value1=member3, Value2=test3

Running (and compiled too!!) under MS .NET:

========== Serialization ==========
Serializing TestCollection...
0 - Adding member: Value1=member1, Value2=test1 ...
1 - Adding member: Value1=member2, Value2=test2 ...
2 - Adding member: Value1=member3, Value2=test3 ...
TestCollection serialized.
Serializing TestMember: Value1=member1, Value2=test1 ...
TestMember serialized.
Serializing TestMember: Value1=member2, Value2=test2 ...
TestMember serialized.
Serializing TestMember: Value1=member3, Value2=test3 ...
TestMember serialized.
========== Deserialization ==========
Deserializing TestMember...
Deserialized TestMember: Value1=member1, Value2=test1
Deserializing TestMember...
Deserialized TestMember: Value1=member2, Value2=test2
Deserializing TestMember...
Deserialized TestMember: Value1=member3, Value2=test3
Deserializing TestCollection...
0 - New deserialized member: Value1=member1, Value2=test1 ...
1 - New deserialized member: Value1=member2, Value2=test2 ...
2 - New deserialized member: Value1=member3, Value2=test3 ...
Deserialized TestCollection.
========== Result ==========
0: Value1=member1, Value2=test1
1: Value1=member2, Value2=test2
2: Value1=member3, Value2=test3


As you can see the result is the same after deserialization
but not inside the constructor.

Is this a bug or a feature or simply bad usage of serialization? ;-)

And no, I can't serialize the Hashtable directly because then it
would be binary imcompatible between Mono and .NET.

Thanks in advance for any comments,
J&#246;rg
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ClassSerialization.cs
Type: application/octet-stream
Size: 3750 bytes
Desc: ClassSerialization.cs
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20030825/6e46256c/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20030825/6e46256c/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001862.html">[Mono-devel-list] Porting Mono to Other OS
</A></li>
	<LI>Next message: <A HREF="001870.html">[Mono-devel-list] Different behaviour deserializing	ISerializable trees Mono &lt;-&gt; .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1869">[ date ]</a>
              <a href="thread.html#1869">[ thread ]</a>
              <a href="subject.html#1869">[ subject ]</a>
              <a href="author.html#1869">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
