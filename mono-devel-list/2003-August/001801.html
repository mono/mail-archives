<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] System.ServiceProcess (RE: [Mono-list] services and daemons)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20System.ServiceProcess%20%28RE%3A%20%5BMono-list%5D%20services%20and%20daemons%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001816.html">
   <LINK REL="Next"  HREF="001802.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] System.ServiceProcess (RE: [Mono-list] services and daemons)</H1>
    <B>Moore, Paul</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20System.ServiceProcess%20%28RE%3A%20%5BMono-list%5D%20services%20and%20daemons%29&In-Reply-To="
       TITLE="[Mono-devel-list] System.ServiceProcess (RE: [Mono-list] services and daemons)">Paul.Moore06 at ca.com
       </A><BR>
    <I>Mon Aug 18 12:36:36 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001816.html">[Mono-devel-list] [PATCH] Bug #47429 - Closed SqlConnections	are put back into the connection pool.
</A></li>
        <LI>Next message: <A HREF="001802.html">[Mono-devel-list] X86 interpreter patch + struct layout patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1801">[ date ]</a>
              <a href="thread.html#1801">[ thread ]</a>
              <a href="subject.html#1801">[ subject ]</a>
              <a href="author.html#1801">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think there is a simpler implementation. We don't need to emulate the windows service infrastructure at all. We just need to make sure that the same code runs in both places - and that in the linux world it feels like a normal linux daemon. I would suggest doing the following

User creates an app using ServiceProcessBase etc (Using mono implmenation - see later). Say its call daemon.exe

The user then does &quot;mono daemon.exe&quot;. This command runs and completes. Daemon.exe is running in the background (under what uid ? Hmm). User code starts via call to OnStart
This command can be put in an SXX start script or wherever

To stop the 'service' the user does &quot;mono daemon.exe -s&quot;. This stops the app (runs the onstop method). Can be put in a Sxxx stop script

To run in the foreground (for testing or debugging) the user does &quot;mono daemon.exe -d&quot;. From the user (coders) viewpoint this is transparent 

This reproduces the simple way that most unix daemons run (ignoring inetd). And the user code is transportable from unix to windows and back again

How to do it.

The Main function calls ServiceProcess.Run (like in windows implementation). This forks the whole image, the forker writes a pid file and exits.
The forkee then calls OnStart. Does fork work? - it seems to.

To shutdown. A static constructor for the ServiceProcess class reads the command line see the -s and signals the pid in the pid file. Question. What happens if I send a SIGINT to a mono app - not tried. It should generate an exception. We catch this exception and do the OnStop call. If the signal method doesn't work then have the daemon wait on a tcp remoting channel for a stop call - write the socket number to the pid file instead of the pid. OK just tested SIGINT and the app silently terminates - end of plan a. It really should generate an exception don't you think?

No support for pause and resume - but then unix doesn't really have that concept (I know it does but nobody uses it for real daemons). No Power events, ...



-----Original Message-----
From: A Rafael D Teixeira [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">rafaelteixeirabr at hotmail.com</A>] 
Sent: Tuesday, August 05, 2003 5:27 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">duncan at ximian.com</A>; Moore, Paul
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-devel-list] System.ServiceProcess (RE: [Mono-list] services and daemons)


&gt;<i>From my brief discussion with Miguel, I think the plan was to write one
</I>&gt;<i>'Mono Service launcher' thing
</I>
We tentatively call it monod or monoserver.

&gt;<i>and install that to the SysV runlevel
</I>&gt;<i>system. This service launcher would then be hooked up with the classes
</I>&gt;<i>in the System.ServiceProcess namespace.
</I>
That is the plan.

&gt;<i>Nothing is set in stone at all, so I'm bringing this conversation to the
</I>&gt;<i>mono-devel mailing list. Has anyone else given any thought to the
</I>&gt;<i>implementation of the System.ServiceProcess namespace?
</I>
Yes, I started that skeleton to be able to write MonoQLE [Indeed I created 
MonoQLEServer in VS.NET as a service project and created all the skeleton 
for the library classes needed for it to compile on Mono/Linux], but had 
little time to make more than that. I hope to further develop it soon, but 
don't hold your breath. Anyone that wants to work on it, please do it!!!

Happy 'services',

Rafael Teixeira
Brazilian Polymath
Mono Hacker since 16 Jul 2001

_________________________________________________________________
MSN Messenger: instale gr&#225;tis e converse com seus amigos. 
<A HREF="http://messenger.msn.com.br">http://messenger.msn.com.br</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001816.html">[Mono-devel-list] [PATCH] Bug #47429 - Closed SqlConnections	are put back into the connection pool.
</A></li>
	<LI>Next message: <A HREF="001802.html">[Mono-devel-list] X86 interpreter patch + struct layout patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1801">[ date ]</a>
              <a href="thread.html#1801">[ thread ]</a>
              <a href="subject.html#1801">[ subject ]</a>
              <a href="author.html#1801">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
