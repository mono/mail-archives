<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] about Metada
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20about%20Metada&In-Reply-To=1059987667.645.7.camel%40alambix.local.igalia.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001710.html">
   <LINK REL="Next"  HREF="001712.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] about Metada</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20about%20Metada&In-Reply-To=1059987667.645.7.camel%40alambix.local.igalia.com"
       TITLE="[Mono-devel-list] about Metada">lupus at ximian.com
       </A><BR>
    <I>Mon Aug  4 07:09:12 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001710.html">[Mono-devel-list] about Metada
</A></li>
        <LI>Next message: <A HREF="001712.html">[Mono-devel-list] about Metada
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1711">[ date ]</a>
              <a href="thread.html#1711">[ thread ]</a>
              <a href="subject.html#1711">[ subject ]</a>
              <a href="author.html#1711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/04/03 Fernando Diaz wrote:
&gt;<i> I have the Class Prueba with three atributes, the source code is:
</I>&gt;<i> 
</I>&gt;<i> class Prueba{
</I>&gt;<i> 	private string texto;
</I>&gt;<i> 	private Prueba puntero;	
</I>&gt;<i>         private int entero;
</I>&gt;<i>         
</I>&gt;<i>         public Prueba(string texto,Prueba puntero,int entero){
</I>&gt;<i> 		this.texto=texto;
</I>&gt;<i> 		this.puntero=puntero;
</I>&gt;<i>                 this.entero=entero;
</I>&gt;<i>         }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> If i examine the memory to look for this atributes (it would be after de
</I>&gt;<i> object header) i get this (look the picture). The data isn't after the
</I>&gt;<i> object header and the data isn't static.
</I>
The data is not static because all the three field are instance fields,
not static fields. And from the picture, you're not looking at the data
after the object header, but at some random MonoClass field.
I'll try to explain it again with different words, but I suggest you
read a good book on computer architectures and C. Someone with better
graphics skills than me may be able to draw a pretty picture of it and
post it somewhere, too.

A C# object in mono is represented as a pointer to a MonoObject structure.
A pointer is simply a memory address, lets say 0x80000000.
The MonoObject structure as you can see in metadata/object.h has two
fields (two pointers) that are stored in memory (on a 32 bit system)
at address 0x80000000 (vtable) and 0x80000000 + 4 (synchronisation).
The MonoObject structure is also called object header, because all the
objects have it at the start of the memory allocated for them.
After the object header, the instance fields for the objects are stored,
in our case, starting from the address 0x80000000 + 8 (8 being the size
of the object header, or sizeof (MonoObject) in C code).
If the object at the address 0x80000000 is a Prueba, then, you'll find
out that the three fields are at offset 8, 12 and 16 from the address
exactly like inspecting the MonoClassField offset field for them will
tell you.
Now, you can get the address of a field. To know the value, you'll need
to dereference the address. For an integer, the C code will look like
this:

	MonoClassField *prueba_entero_classfield = ...get it from MonoClass;
	gint32 *prueba_entero_address = (char*)prueba_obj + prueba_entero_classfield-&gt;offset;
	gint32 prueba_entero_value = *prueba_entero_address;

Hope this helps (and hope we're done with basic C lessons on
mono-devel-list:-).

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001710.html">[Mono-devel-list] about Metada
</A></li>
	<LI>Next message: <A HREF="001712.html">[Mono-devel-list] about Metada
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1711">[ date ]</a>
              <a href="thread.html#1711">[ thread ]</a>
              <a href="subject.html#1711">[ subject ]</a>
              <a href="author.html#1711">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
