<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] BitVector32 patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20BitVector32%20patch&In-Reply-To=1219438514.4178.382.camel%40linux-1p3a.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028950.html">
   <LINK REL="Next"  HREF="028751.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] BitVector32 patch</H1>
    <B>Scott Peterson</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20BitVector32%20patch&In-Reply-To=1219438514.4178.382.camel%40linux-1p3a.site"
       TITLE="[Mono-dev] BitVector32 patch">lunchtimemama at gmail.com
       </A><BR>
    <I>Tue Aug 26 05:35:01 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028950.html">[Mono-dev] BitVector32 patch
</A></li>
        <LI>Next message: <A HREF="028751.html">[Mono-dev] VisualwebGUI 6.0.4, Framework 2.0 working with Linux + Mono.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28976">[ date ]</a>
              <a href="thread.html#28976">[ thread ]</a>
              <a href="subject.html#28976">[ subject ]</a>
              <a href="author.html#28976">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK, the bug is fixed and the fix is committed. I've done up another
patch with the other minor fixes (a few logical things and a few style
things). Patch is attached and inline.

- Scott

Index: class/System/System.Collections.Specialized/BitVector32.cs
===================================================================
--- class/System/System.Collections.Specialized/BitVector32.cs	(revision 111591)
+++ class/System/System.Collections.Specialized/BitVector32.cs	(working copy)
@@ -33,15 +33,13 @@
 using System.Text;

 namespace System.Collections.Specialized {
-	
 	public struct BitVector32 {
-		int bits;
-
 		public struct Section {
 			private short mask;
 			private short offset;
 			
-			internal Section (short mask, short offset) {
+			internal Section (short mask, short offset)
+			{
 				this.mask = mask;
 				this.offset = offset;
 			}
@@ -84,14 +82,12 @@

 			public override int GetHashCode ()
 			{
-				return (((Int16) mask).GetHashCode () &lt;&lt; 16) +
-				       ((Int16) offset).GetHashCode ();
+				return mask &lt;&lt; offset;
 			}
 			
 			public override string ToString ()
 			{
-				return &quot;Section{0x&quot; + Convert.ToString(mask, 16) +
-				       &quot;, 0x&quot; + Convert.ToString(offset, 16) + &quot;}&quot;;
+				return ToString (this);
 			}

 			public static string ToString (Section value)
@@ -106,12 +102,14 @@
 				return b.ToString ();
 			}
 		}
+
+		int bits;
 		
 		// Constructors
 		
 		public BitVector32 (BitVector32 source)
+			: this (source.bits)
 		{
-			bits = source.bits;
 		}

 		public BitVector32 (int init)
@@ -197,10 +195,7 @@
 		
 		public override bool Equals (object o)
 		{
-			if (!(o is BitVector32))
-				return false;
-
-			return bits == ((BitVector32) o).bits;
+			return (o is BitVector32) &amp;&amp; bits == ((BitVector32) o).bits;
 		}

 		public override int GetHashCode ()
@@ -218,7 +213,7 @@
 			StringBuilder b = new StringBuilder ();
 			b.Append (&quot;BitVector32{&quot;);
 			long mask = (long) 0x80000000;
-			while (mask &gt; 0) {
+			while (mask != 0) {
 				b.Append (((value.bits &amp; mask) == 0) ? '0' : '1');
 				mask &gt;&gt;= 1;
 			}
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bitvector32.patch
Type: text/x-diff
Size: 1888 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080826/d4cc70ea/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080826/d4cc70ea/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028950.html">[Mono-dev] BitVector32 patch
</A></li>
	<LI>Next message: <A HREF="028751.html">[Mono-dev] VisualwebGUI 6.0.4, Framework 2.0 working with Linux + Mono.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28976">[ date ]</a>
              <a href="thread.html#28976">[ thread ]</a>
              <a href="subject.html#28976">[ subject ]</a>
              <a href="author.html#28976">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
