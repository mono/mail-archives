<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Fix for failing TreeNode tests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Fix%20for%20failing%20TreeNode%20tests&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015997.html">
   <LINK REL="Next"  HREF="016009.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Fix for failing TreeNode tests</H1>
    <B>Dieter Bremes</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Fix%20for%20failing%20TreeNode%20tests&In-Reply-To="
       TITLE="[Mono-dev] Fix for failing TreeNode tests">dbjobs at snafu.de
       </A><BR>
    <I>Sat Nov 26 14:55:40 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="015997.html">[Mono-dev] patch to add FontOptions to Mono.Cairo
</A></li>
        <LI>Next message: <A HREF="016009.html">[Mono-dev] Fix for failing TreeNode tests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16001">[ date ]</a>
              <a href="thread.html#16001">[ thread ]</a>
              <a href="subject.html#16001">[ subject ]</a>
              <a href="author.html#16001">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

below are 2 fixes + an additional test for the TreeNode's FullPath and 
Index properties.

I also added the namespace for TreeNodeTest but didn't update the 
indentation because it would obscure the diff.

Dieter



* TreeNode.cs : Fixed bugs that caused FullPathTest + Traverse to fail.

* TreeNodeTest.cs : Added namespace + SingleNodeIndexTest.
                     Fixed warning CS0219.


Index: System.Windows.Forms/TreeNode.cs
===================================================================
--- System.Windows.Forms/TreeNode.cs	(Revision 53205)
+++ System.Windows.Forms/TreeNode.cs	(Arbeitskopie)
@@ -199,7 +199,7 @@

  		public string FullPath {
  			get {
-				if (tree_view == null)
+				if (TreeView == null)
  					throw new Exception (&quot;No TreeView associated&quot;);

  				StringBuilder builder = new StringBuilder ();
@@ -498,9 +498,10 @@

  		public int Index {
  			get {
-				if (parent == null)
-					return -1;
-				return parent.Nodes.IndexOf (this);
+				if (parent != null)
+					return parent.Nodes.IndexOf (this);
+				else
+					return 0;
  			}
  		}

Index: Test/System.Windows.Forms/TreeNodeTest.cs
===================================================================
--- Test/System.Windows.Forms/TreeNodeTest.cs	(Revision 53205)
+++ Test/System.Windows.Forms/TreeNodeTest.cs	(Arbeitskopie)
@@ -1,7 +1,11 @@
  using System;
  using NUnit.Framework;
  using System.Windows.Forms;
+using SystemDrawingNamespace = System.Drawing; // Prevent CS0234

+namespace MonoTests.System.Windows.Forms
+{
+
  [TestFixture]
  public class TreeNodeTest {

@@ -100,6 +104,9 @@
  	public void FullPathException ()
  	{
  		string s = new TreeNode (&quot;&quot;).FullPath;
+		// Prevent CS0219, will never write anything
+		// due to previous statement throwing Exception
+		Console.WriteLine(s);
  	}

  	[Test]
@@ -126,8 +133,8 @@
  		TreeNode orig = new TreeNode (&quot;text&quot;, 2, 3, new TreeNode [] { new 
TreeNode (&quot;child&quot;, 22, 33) });
  		orig.Tag = FlatStyle.Flat;
  		orig.Checked = true;
-		orig.BackColor = System.Drawing.Color.AliceBlue;
-		orig.ForeColor = System.Drawing.Color.Beige;
+		orig.BackColor = SystemDrawingNamespace.Color.AliceBlue;
+		orig.ForeColor = SystemDrawingNamespace.Color.Beige;

  		TreeNode clone = (TreeNode)orig.Clone ();
  		Assert.AreEqual (&quot;text&quot;, clone.Text, &quot;#1&quot;);
@@ -138,8 +145,20 @@
  		Assert.IsTrue (clone.Checked, &quot;#6&quot;);
  		Assert.AreEqual (&quot;child&quot;, clone.Nodes [0].Text, &quot;#10&quot;);
  		Assert.AreEqual (22, clone.Nodes [0].ImageIndex, &quot;#11&quot;);
-		Assert.AreEqual (System.Drawing.Color.AliceBlue, clone.BackColor, &quot;#12&quot;);
-		Assert.AreEqual (System.Drawing.Color.Beige, clone.ForeColor, &quot;#13&quot;);
+		Assert.AreEqual (SystemDrawingNamespace.Color.AliceBlue, 
clone.BackColor, &quot;#12&quot;);
+		Assert.AreEqual (SystemDrawingNamespace.Color.Beige, clone.ForeColor, 
&quot;#13&quot;);
  	}

+	[Test]
+	public void SingleNodeIndexTest ()
+	{
+		TreeNode tn_1 = new TreeNode (&quot;A&quot;);
+		Assert.AreEqual (0, tn_1.Index, &quot;#1&quot;);
+		TreeView tv = new TreeView ();
+		tv.Nodes.Add (tn_1);
+		Assert.AreEqual (0, tn_1.Index, &quot;#2&quot;);
+	}
+
+}
+
  }
\ No newline at end of file

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015997.html">[Mono-dev] patch to add FontOptions to Mono.Cairo
</A></li>
	<LI>Next message: <A HREF="016009.html">[Mono-dev] Fix for failing TreeNode tests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16001">[ date ]</a>
              <a href="thread.html#16001">[ thread ]</a>
              <a href="subject.html#16001">[ subject ]</a>
              <a href="author.html#16001">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
