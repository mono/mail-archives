<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] another corcompare patch to hide	extraneous&quot;IsVirtual&quot;differences
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20another%20corcompare%20patch%20to%20hide%0A%09extraneous%22IsVirtual%22differences&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015610.html">
   <LINK REL="Next"  HREF="015553.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] another corcompare patch to hide	extraneous&quot;IsVirtual&quot;differences</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20another%20corcompare%20patch%20to%20hide%0A%09extraneous%22IsVirtual%22differences&In-Reply-To="
       TITLE="[Mono-dev] another corcompare patch to hide	extraneous&quot;IsVirtual&quot;differences">kornelpal at hotmail.com
       </A><BR>
    <I>Fri Nov  4 04:24:35 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="015610.html">[Mono-dev] another corcompare patch to hide	extraneous&quot;IsVirtual&quot;differences
</A></li>
        <LI>Next message: <A HREF="015553.html">[Mono-dev] [Mono-patches] r52427 - trunk/mcs/mbas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15611">[ date ]</a>
              <a href="thread.html#15611">[ thread ]</a>
              <a href="subject.html#15611">[ subject ]</a>
              <a href="author.html#15611">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Now I understand why you mentioned internal interfaces.

My problem is that IsVirtual affects IL code emitted by compilers for source
code that reference assemblies that will result in different IL code when
compiling on MS.NET and when Mono. The difference is &quot;call&quot; or &quot;callvirt&quot;.
Altough you are treating this difference as a non-practical difference this
is a big difference.

When a non-virtual public method implements an interface it will be &quot;newslot
virtual final&quot;. This is treated as equal to a method without any of these
modifiers and will be called using &quot;call&quot;. As a result there is no
difference.

So I think the solution is to compare &quot;virtual&quot; but treat &quot;newslot virtual
final&quot; equal to non-virtual. This is something very similar to your original
idea. And there should be no checks for interface things in this comparsion.

The only problem is that the above is the behavior of MS csc.exe while mcs
generates different metadata and IL code.:) As MS csc.exe behavior is the
expected as it makes possible some relaxations of corcompare I'm going to
report it as a bug.

To avoid the override behavior problem I described in my previous message.
Note that this is an important difference and in fact it covers 4 cases if
you invert MS.NET and Mono and/or invert private syntax and public syntax.

If we don't want to force interface method implementation syntax to be the
same corcompare still has to treat public methods of a type different from
the methods that implement interface methods. Of course they can be the same
method but this single method should be accepted by corcopare for both
public and interface method if and only if the attributes are compatible
with both the public method and the interface method. non-virtual ==
&quot;newslot virtual final&quot; in this case as well. I think the easiest way to
implement this is to check the publics method and the interface methods as
separate methods.

Korn&#233;l

----- Original Message -----
From: &quot;Atsushi Eno&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushi at ximian.com</A>&gt;
To: &quot;Korn&#233;l P&#225;l&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at hotmail.com</A>&gt;
Cc: &quot;mono-devel mailing list&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Friday, November 04, 2005 6:55 AM
Subject: Re: [Mono-dev] another corcompare patch to hide
extraneous&quot;IsVirtual&quot;differences


&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Korn&#233;l P&#225;l wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Of course people assuming unusual things or depending on bugs will suck
</I>&gt;&gt;<i> anyway and I usually don't support their nonsense but if we allow this
</I>&gt;&gt;<i> difference different IL code will be generated from the same source code
</I>&gt;&gt;<i> on
</I>&gt;&gt;<i> Mono and MS.NET because the referenced assemblies would have different
</I>&gt;&gt;<i> API.
</I>&gt;&gt;<i> Having internal interfaces is not a problem. The problem is when the
</I>&gt;&gt;<i> virtual
</I>&gt;&gt;<i> status of a publically visible (public or protected) method differ
</I>&gt;&gt;<i> between
</I>&gt;&gt;<i> MS.NET and Mono as that results in different IL code and behavior on Mono
</I>&gt;&gt;<i> and MS.NET. So IsVirtual has to match MS.NET without regard to IsSealed
</I>&gt;&gt;<i> or
</I>&gt;&gt;<i> to anything else.
</I>&gt;<i>
</I>&gt;<i> Having internal interfaces affects on IsVirtual value. Thus we can't
</I>&gt;<i> just expect exactly same MethodAttributes values.
</I>&gt;<i>
</I>&gt;<i> Or you might be suggesting that corcompare should check if each method
</I>&gt;<i> implements internal interfaces or not, but it will result in significant
</I>&gt;<i> performance issue for that too-niche purpose.
</I>&gt;<i>
</I>&gt;<i> Anyways it would be time to introduce some &quot;options&quot; in corcompare
</I>&gt;<i> tools to check both practical API compatibility and to satisfy
</I>&gt;<i> those canonicalized people who think everything must be equivalent
</I>&gt;<i> to MS.NET. There is another discussion that we don't need ComVisible
</I>&gt;<i> attribute check, Serializable on enums/delegates, and so on.
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015610.html">[Mono-dev] another corcompare patch to hide	extraneous&quot;IsVirtual&quot;differences
</A></li>
	<LI>Next message: <A HREF="015553.html">[Mono-dev] [Mono-patches] r52427 - trunk/mcs/mbas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15611">[ date ]</a>
              <a href="thread.html#15611">[ thread ]</a>
              <a href="subject.html#15611">[ subject ]</a>
              <a href="author.html#15611">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
