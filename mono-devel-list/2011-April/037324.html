<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Bug in Dispatcher.cs VerifyAccess or am I confused on the mono threading model?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Bug%20in%20Dispatcher.cs%20VerifyAccess%20or%20am%20I%20confused%20on%0A%20the%20mono%20threading%20model%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037323.html">
   <LINK REL="Next"  HREF="037329.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Bug in Dispatcher.cs VerifyAccess or am I confused on the mono threading model?</H1>
    <B>Brad Cunningham</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Bug%20in%20Dispatcher.cs%20VerifyAccess%20or%20am%20I%20confused%20on%0A%20the%20mono%20threading%20model%3F&In-Reply-To="
       TITLE="[Mono-dev] Bug in Dispatcher.cs VerifyAccess or am I confused on the mono threading model?">brad at bradcunningham.net
       </A><BR>
    <I>Mon Apr  4 20:54:24 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037323.html">[Mono-dev] StackOverflow on System.Delegate.Equals
</A></li>
        <LI>Next message: <A HREF="037329.html">[Mono-dev] GSoC Proposal : FreshBuild - Help XBuild to Support MSVC and GCC , and Translating Makefiles to MSBuild Projects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37324">[ date ]</a>
              <a href="thread.html#37324">[ thread ]</a>
              <a href="subject.html#37324">[ subject ]</a>
              <a href="author.html#37324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I just upgraded to 2.10 and am getting strange behavior that I wasn't seeing
in 2.8.1

I call VerifyAccess in my code which is the method in the Dispatcher class
that will compare the calling thread with the thread that the dispatcher was
created on, if they differ it will throw an exception. In 2.8.1 it seemed
that the Dispatcher object was always null so I never called these methods.

In 2.10 it seems the Dispatcher is no longer null so I am making it into my
calls to VerifyAccess and it is throwing an exception:

System.InvalidOperationException: &quot;The calling thread is not the same as the
creation thread&quot;


a few things that are strange about this:

Prior to calling verify access I am doing some sanity checks
1. Dispatcher is not null
2. It's hash code matches the Thread.CurrentThreads hash code
3. Dispatcher.Thread == Thread.CurrentThread evaluates true

4. Looking at the code from the 2.10 branch for dispatcher this doesn't
appear to be the error text that should be thrown so I assume something else
is going on here.


That seems to tell me that they are in fact the same thread and the
exception should NOT be thrown. Since the error message doesn't seem correct
I assume something else is going on here that I don't understand.


Any ideas?




-- 
Brad Cunningham
Microsoft MVP: C#

<A HREF="http://blog.bradcunningham.net">http://blog.bradcunningham.net</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110404/8bf5a59e/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110404/8bf5a59e/attachment.html</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037323.html">[Mono-dev] StackOverflow on System.Delegate.Equals
</A></li>
	<LI>Next message: <A HREF="037329.html">[Mono-dev] GSoC Proposal : FreshBuild - Help XBuild to Support MSVC and GCC , and Translating Makefiles to MSBuild Projects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37324">[ date ]</a>
              <a href="thread.html#37324">[ thread ]</a>
              <a href="subject.html#37324">[ subject ]</a>
              <a href="author.html#37324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
