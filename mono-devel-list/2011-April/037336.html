<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Possible QuickSort optimizations for Array.Sort()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Possible%20QuickSort%20optimizations%20for%20Array.Sort%28%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037354.html">
   <LINK REL="Next"  HREF="037342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Possible QuickSort optimizations for Array.Sort()</H1>
    <B>Jeffrey Stedfast</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Possible%20QuickSort%20optimizations%20for%20Array.Sort%28%29&In-Reply-To="
       TITLE="[Mono-dev] Possible QuickSort optimizations for Array.Sort()">fejj at novell.com
       </A><BR>
    <I>Tue Apr  5 18:48:59 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037354.html">[Mono-dev] GSOC MonoDevelop Project
</A></li>
        <LI>Next message: <A HREF="037342.html">[Mono-dev] Possible QuickSort optimizations for Array.Sort()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37336">[ date ]</a>
              <a href="thread.html#37336">[ thread ]</a>
              <a href="subject.html#37336">[ subject ]</a>
              <a href="author.html#37336">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Attached you'll find qsort.cs which includes 3 QuickSort implementations:

1. QuickSortBasic[R]: This is a basic QuickSort implementation and the 
one currently in use as the sorting function in Array.Sort(). This 
implementation always uses the middle element as the pivot.

2. QuickSortMedian[R]: This implementation is also a basic QuickSort 
implementation which attempts choose a better pivot based on the first, 
last, and middle elements. For sorted inputs and random inputs, this 
seems to help performance somewhat as the array gets larger and larger. 
However, for reverse-sorted inputs, it seems to kill performance. 
Perhaps if I choose 3 random points to feed into Median() it will do better.

3. QuickSortInsertion[R]: This implementation includes the above perf 
trick and also includes an Insertion Sort fallback when partitions are 
broken down smaller than some threshold # of elements (7 in the attached 
code). It also falls back to Insertion Sort when it encounters a 
worst-case scenario. As always, the performance improvement with this is 
greater as the number of elements increases and/or as the comparison 
function becomes more complex.


You'll notice that the attached test program will print out the number 
of comparisons that each sort routine uses in order to complete its job. 
It's important to keep in mind that the more complex the comparison 
function is, the more important it is that the number of comparisons is 
kept to a minimum.

Here are some example runs:


[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fejj at warpig</A> sorting]$ mono ./qsort.exe -random 100000000
Basic QuickSort comparisons needed:     3807986012
QuickSort+Median comparisons needed:    3077915654
QuickSort+Insertion comparisons needed: 3021355043
Basic QuickSort finished in:     00:00:43.8178721s
QuickSort+Median finished in:    00:00:37.3047443s
QuickSort+Insertion finished in: 00:00:36.6122681s


[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fejj at warpig</A> sorting]$ mono ./qsort.exe -sorted 100000000
Basic QuickSort comparisons needed:     2632227866
QuickSort+Median comparisons needed:    2632227867
QuickSort+Insertion comparisons needed: 2483222808
Basic QuickSort finished in:     00:00:21.8213618s
QuickSort+Median finished in:    00:00:21.2622527s
QuickSort+Insertion finished in: 00:00:19.0837352s


(Note: I reduced the array size here due to wanting to head home for dinner)
[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fejj at warpig</A> sorting]$ mono ./qsort.exe -reversed 10000
Basic QuickSort comparisons needed:     129546
QuickSort+Median comparisons needed:    12522499
QuickSort+Insertion comparisons needed: 39993
Basic QuickSort finished in:     00:00:00.0016905s
QuickSort+Median finished in:    00:00:00.0911385s
QuickSort+Insertion finished in: 00:00:00.0008721s


Jeff
-------------- next part --------------
A non-text attachment was scrubbed...
Name: qsort.cs
Type: text/x-csharp
Size: 7895 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110405/bee0a775/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110405/bee0a775/attachment.bin</A> 
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037354.html">[Mono-dev] GSOC MonoDevelop Project
</A></li>
	<LI>Next message: <A HREF="037342.html">[Mono-dev] Possible QuickSort optimizations for Array.Sort()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37336">[ date ]</a>
              <a href="thread.html#37336">[ thread ]</a>
              <a href="subject.html#37336">[ subject ]</a>
              <a href="author.html#37336">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
