<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Possible QuickSort optimizations for Array.Sort()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Possible%20QuickSort%20optimizations%20for%20Array.Sort%28%29&In-Reply-To=4D9C13DE.7050008%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037352.html">
   <LINK REL="Next"  HREF="037383.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Possible QuickSort optimizations for Array.Sort()</H1>
    <B>Jeffrey Stedfast</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Possible%20QuickSort%20optimizations%20for%20Array.Sort%28%29&In-Reply-To=4D9C13DE.7050008%40gmail.com"
       TITLE="[Mono-dev] Possible QuickSort optimizations for Array.Sort()">fejj at novell.com
       </A><BR>
    <I>Sat Apr  9 16:39:43 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037352.html">[Mono-dev] Possible QuickSort optimizations for Array.Sort()
</A></li>
        <LI>Next message: <A HREF="037383.html">[Mono-dev] Possible QuickSort optimizations for Array.Sort()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37379">[ date ]</a>
              <a href="thread.html#37379">[ thread ]</a>
              <a href="subject.html#37379">[ subject ]</a>
              <a href="author.html#37379">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/06/2011 03:18 AM, Marek Safar wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> 	public class Sort&lt;T&gt;  {
</I>&gt;<i> 		public delegate int Comparison (T v0, T v1);
</I>&gt;<i>
</I>&gt;<i> You don't need yet another delegate, just use standard Func
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> 		static readonly int INSERTIONSORT_THRESHOLD = 7;
</I>&gt;<i>
</I>&gt;<i> Why not to used const int ?
</I>&gt;<i>
</I>&gt;<i> More importantly what is performance of sorting array of 10-20 
</I>&gt;<i> elements called 1000000 times ?
</I>&gt;<i>
</I>
Attached is another test program with 2 newer/faster implementations of 
QuickSort, one of which is Non-Recursive.

You can run this program like so:

mono ./qsort.exe [-random, -sorted, -reversed] [array size] [# loops]

These 2 new implementations manage to reduce the number of comparisons 
done by merging the Median() function from the previous set into the 
main body of the QuickSort function and swapping those 3 elements into 
ascending order as it compares to find the optimal pivot. This has the 
advantage of allowing our loops to start at low+1 and high-1 (thus 
reducing our compares by 2 for each partition).

My previous implementation was able to reduce the compares by 1 by 
starting at low+1 by moving the pivot into low, but this has the 
negative impact of destroying performance on reverse-sorted arrays. My 
new implementation doesn't have this problem (and therefore, we don't 
need to fall back to that insertion-sort if we detect that pathological 
case).

Interestingly, the NonRecursiveQuickSort() implementation does not 
noticeably improve performance over the recursive version and in fact is 
slower than even our current implementation for sorting small arrays 
(made evident when looped millions of times).

How do you feel about replacing corlib's qsort() implementation with my 
FasterQuickSort() implementation?

Jeff

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110409/80b31484/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110409/80b31484/attachment-0001.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: qsort.cs
Type: text/x-csharp
Size: 8709 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110409/80b31484/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110409/80b31484/attachment-0001.bin</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037352.html">[Mono-dev] Possible QuickSort optimizations for Array.Sort()
</A></li>
	<LI>Next message: <A HREF="037383.html">[Mono-dev] Possible QuickSort optimizations for Array.Sort()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37379">[ date ]</a>
              <a href="thread.html#37379">[ thread ]</a>
              <a href="subject.html#37379">[ subject ]</a>
              <a href="author.html#37379">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
