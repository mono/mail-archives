<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] wrong generic method signature
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20wrong%20generic%20method%20signature&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028447.html">
   <LINK REL="Next"  HREF="028454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] wrong generic method signature</H1>
    <B>Denis ERCHOFF</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20wrong%20generic%20method%20signature&In-Reply-To="
       TITLE="[Mono-dev] wrong generic method signature">d_erchoff at hotmail.com
       </A><BR>
    <I>Tue Jul  8 04:09:57 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028447.html">[Mono-dev] [PATCH] Exceptions on Winx64
</A></li>
        <LI>Next message: <A HREF="028454.html">[Mono-dev] wrong generic method signature
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28452">[ date ]</a>
              <a href="thread.html#28452">[ thread ]</a>
              <a href="subject.html#28452">[ subject ]</a>
              <a href="author.html#28452">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I would like to share with you a small modification in the mono C# compiler.

Initially the problem was :

    i write a simple generic method like this :

          public void test_generic_method&lt;A&gt;(int B)

    using the ms compiler + the VS object viewer, the signature appear 
in the format :
      
          test_generic_method&lt;A&gt;(int)

    using the mono compiler + the VS object viewer, the signature appear 
in the format :

           test_generic_method&lt;A&gt;() &lt;--- where is the paranter signature 
part ?
          If i use the Luts Roeader's.Net Reflector, it crashed when i 
try to parse the class containing this method.


---&gt; The mono .net framework is not installed in my computer. I use only 
a ms .net framework. So maybe the problem doesn't occur with the mono 
framework.


It seems that the MethodBuilder.SetParameters doesn't work as expected 
if you don't define parameters when calling the method 
TypeBuilder.DefineMethod.

So i tryed to change the mono c# compiler to have the expected signature :

In the Mono.CSharp.MethodOrOperator.DefineGenericMethod i removed all 
the generic related code :

protected bool DefineGenericMethod ()
        {
            if (!DoDefineBase ())
                return false;
            return true;
          }



And i rewrited the Mono.CSharp.MethodData.DefineMethodBuilder as :



        void DefineMethodBuilder (TypeContainer container, string 
method_name, Type[] ParameterTypes)
        {
            if (builder == null) {
                builder = container.TypeBuilder.DefineMethod (
                    method_name, flags, method.CallingConventions,
                    method.ReturnType, ParameterTypes);
#if GMCS_SOURCE
                if (GenericMethod != null)
                {
                    //MethodBuilder = 
Parent.TypeBuilder.DefineMethod(GetFullName(MemberName), flags);
                    GenericMethod.Define(MethodBuilder, null);
                }

                if (builder.Attributes != flags)
                {
                    try
                    {
                        if (methodbuilder_attrs_field == null)
                            methodbuilder_attrs_field = 
typeof(MethodBuilder).GetField(&quot;attrs&quot;, BindingFlags.NonPublic | 
BindingFlags.Instance);
                        methodbuilder_attrs_field.SetValue(builder, flags);
                    }
                    catch
                    {
                        Report.RuntimeMissingSupport(method.Location, 
&quot;Generic method MethodAttributes&quot;);
                    }
                }
#endif

                return;
            }
}

Like this, all seems to be good ( event the   Luts Roeader's.Net 
Reflector ).

Tell me if something is wrong.

Denis.

P.s. : I attached a patch file to this email.
 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: wrong_generic_method_signature.patch
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080708/8b961747/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20080708/8b961747/attachment.pl</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028447.html">[Mono-dev] [PATCH] Exceptions on Winx64
</A></li>
	<LI>Next message: <A HREF="028454.html">[Mono-dev] wrong generic method signature
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28452">[ date ]</a>
              <a href="thread.html#28452">[ thread ]</a>
              <a href="subject.html#28452">[ subject ]</a>
              <a href="author.html#28452">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
