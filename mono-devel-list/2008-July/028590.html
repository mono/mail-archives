<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Profiler extension
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Profiler%20extension&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028586.html">
   <LINK REL="Next"  HREF="028591.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Profiler extension</H1>
    <B>Massimiliano Mantione</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Profiler%20extension&In-Reply-To="
       TITLE="[Mono-dev] Profiler extension">massi at ximian.com
       </A><BR>
    <I>Sun Jul 20 10:59:14 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028586.html">[Mono-dev] Debug symbols not available from Mono tools
</A></li>
        <LI>Next message: <A HREF="028591.html">[Mono-dev] Profiler extension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28590">[ date ]</a>
              <a href="thread.html#28590">[ thread ]</a>
              <a href="subject.html#28590">[ subject ]</a>
              <a href="author.html#28590">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello!

Rodrigo and others were asking to extend the stat profiler to recognize
also trampolines and thunks (right now they show up as &quot;unknown&quot;).

I have looked at the code, and found that the different categories of
&quot;thunks&quot; we have are, roughly:

- create_fnptr
&#65279;- load_aot_method
&#65279;- imt thunk
&#65279;- jump table
&#65279;- debugger code
&#65279;- exception call filter
&#65279;&#65279;- &#65279;trampoline (various types)
&#65279;&#65279;&#65279;&#65279;&#65279;- throw corlib exception
&#65279;- restore context
&#65279;- throw exception by name
&#65279;- handle stack overflow
- throw exception
- delegate invoke implementation
- cpuid code :-)

There are more than 70 places in the code that reserve memory from a
code manager to produce those small code snippets that we'd like to
track.

Typically, when we add profiling infrastructure, we do not change the
runtime API, we just insert calls to the profiler APIs in the relevant
places.
However, in this case I'd really, really prefer to:
- create an enum with all the &quot;thunk categories&quot; above,
- add it as a parameter to &quot;mono_code_manager_reserve*&quot; functions, and
- call the new profiler API from there.
This will make the code more compact (without those 70+ calls to
profiler APIs scattered around), will make sure I don't miss any spot,
and (most important) will make sure that future code maintenance will
not forget to call the profiler API as well.

But before doing that I wanted to know if changing the code manager API
was OK...

Ciao,
  Massi


</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028586.html">[Mono-dev] Debug symbols not available from Mono tools
</A></li>
	<LI>Next message: <A HREF="028591.html">[Mono-dev] Profiler extension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28590">[ date ]</a>
              <a href="thread.html#28590">[ thread ]</a>
              <a href="subject.html#28590">[ subject ]</a>
              <a href="author.html#28590">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
