<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev]	[Mono-patches]	r107145	-	trunk/mcs/class/System.Data/System.Data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%0A%09%5BMono-patches%5D%09r107145%09-%09trunk/mcs/class/System.Data/System.Data&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028461.html">
   <LINK REL="Next"  HREF="028463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev]	[Mono-patches]	r107145	-	trunk/mcs/class/System.Data/System.Data</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%0A%09%5BMono-patches%5D%09r107145%09-%09trunk/mcs/class/System.Data/System.Data&In-Reply-To="
       TITLE="[Mono-dev]	[Mono-patches]	r107145	-	trunk/mcs/class/System.Data/System.Data">gert.driesen at telenet.be
       </A><BR>
    <I>Wed Jul  9 03:39:14 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="028461.html">[Mono-dev]	[Mono-patches]	r107145	-	trunk/mcs/class/System.Data/System.Data
</A></li>
        <LI>Next message: <A HREF="028463.html">[Mono-dev]	[Mono-patches]	r107145	-	trunk/mcs/class/System.Data/System.Data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28462">[ date ]</a>
              <a href="thread.html#28462">[ thread ]</a>
              <a href="subject.html#28462">[ subject ]</a>
              <a href="author.html#28462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

--------------------------------------------------
From: &quot;Veerapuram Varadhan&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">vvaradhan at novell.com</A>&gt;
Sent: Wednesday, July 09, 2008 8:42 AM
To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at telenet.be</A>&gt;
Cc: &quot;'mono-devel-list'&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at ximian.com</A>&gt;
Subject: Re: [Mono-dev][Mono-patches]	r107145	-trunk/mcs/class/System.Data/System.Data&gt; Hi Gert,
&gt;<i>
</I>&gt;<i> On Fri, 2008-07-04 at 21:35 +0200, Gert Driesen wrote:
</I>&gt;&gt;<i> Hey Veerapuram,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've attached a patch for the changes I mentioned. However, I found out 
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i> on the 1.0 profile we should still allow the value to be set to null if 
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> datatype of the column is string. This matches the behavior before 
</I>&gt;&gt;<i> r107145.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Let me know if it's ok to commit.
</I>&gt;&gt;<i>
</I>&gt;<i> In case of 2.0 profile, in case of reference types, we have to set value
</I>&gt;<i> to DBNull instead of NULL - which the patch is missing. Except that,
</I>&gt;<i> patch looks good - please commit along with the mentioned changes.
</I>
Are you sure that we need to set it to DBNull? Do you have a test that shows 
this to be necessary?

At least one of the unit tests I shows that 
DataColumnChangeEventArgs.ProposedValue of the ColumnChanged/ColumnChanging 
events has value NULL (and not DBNull) on MS.NET 2.0.

My patch passed all unit tests, and I created a few connected tests to be 
sure I did not break anthing.

It's of course more important not to break existing application than to get 
some unit test to pass.

However, if not setting the value to DBNull indead breaks applications, then 
I'd like to have a test for this (to ensure we won't be breaking this in the 
future).

Gert

&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
</I>&gt;&gt;<i> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Veerapuram
</I>&gt;&gt;<i> Varadhan
</I>&gt;&gt;<i> Sent: vrijdag 4 juli 2008 12:18
</I>&gt;&gt;<i> To: Gert Driesen
</I>&gt;&gt;<i> Cc: 'mono-devel-list'
</I>&gt;&gt;<i> Subject: Re: [Mono-dev] [Mono-patches] r107145 -
</I>&gt;&gt;<i> trunk/mcs/class/System.Data/System.Data
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi Gert,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, 2008-07-03 at 18:19 +0200, Gert Driesen wrote:
</I>&gt;&gt;<i> &gt; Hey Veerapuram,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I don't think this change is correct. I've done some more tests, and 
</I>&gt;&gt;<i> &gt; this
</I>&gt;&gt;<i> is
</I>&gt;&gt;<i> &gt; the behavior I'm seeing:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; * on 1.0 profile, you are never allowed to set value to NULL.
</I>&gt;&gt;<i> &gt; * on 2.0 profile, you are only allowed to set value to NULL if the 
</I>&gt;&gt;<i> &gt; column
</I>&gt;&gt;<i> is
</I>&gt;&gt;<i> &gt; backed by a reference type.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I'll add unit tests for this to DataRowTest2.cs in a few minutes, and 
</I>&gt;&gt;<i> &gt; mark
</I>&gt;&gt;<i> &gt; them NotWorking.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Let me know if you want me to submit a patch that changes our
</I>&gt;&gt;<i> implementation
</I>&gt;&gt;<i> &gt; accordingly.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> That would be great.  Feel free to submit tests and the patch.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> V. Varadhan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Gert
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; -----Original Message-----
</I>&gt;&gt;<i> &gt; From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-patches-bounces at lists.ximian.com</A>
</I>&gt;&gt;<i> &gt; [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-patches-bounces at lists.ximian.com</A>] On Behalf Of Veerapuram
</I>&gt;&gt;<i> &gt; Varadhan (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">vvaradhan at novell.com</A>)
</I>&gt;&gt;<i> &gt; Sent: donderdag 3 juli 2008 15:38
</I>&gt;&gt;<i> &gt; To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-patches at lists.ximian.com</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ximian.monolist at gmail.com</A>;
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-svn-patches-garchive-20758 at googlegroups.com</A>
</I>&gt;&gt;<i> &gt; Subject: [Mono-patches] r107145 - 
</I>&gt;&gt;<i> &gt; trunk/mcs/class/System.Data/System.Data
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Author: varadhan
</I>&gt;&gt;<i> &gt; Date: 2008-07-03 09:38:09 -0400 (Thu, 03 Jul 2008)
</I>&gt;&gt;<i> &gt; New Revision: 107145
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Modified:
</I>&gt;&gt;<i> &gt;    trunk/mcs/class/System.Data/System.Data/ChangeLog
</I>&gt;&gt;<i> &gt;    trunk/mcs/class/System.Data/System.Data/DataRow.cs
</I>&gt;&gt;<i> &gt; Log:
</I>&gt;&gt;<i> &gt; Use DBNull value instead of throwing an exception
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Modified: trunk/mcs/class/System.Data/System.Data/ChangeLog
</I>&gt;&gt;<i> &gt; ===================================================================
</I>&gt;&gt;<i> &gt; --- trunk/mcs/class/System.Data/System.Data/ChangeLog 2008-07-03 
</I>&gt;&gt;<i> &gt; 13:37:14
</I>&gt;&gt;<i> &gt; UTC (rev 107144)
</I>&gt;&gt;<i> &gt; +++ trunk/mcs/class/System.Data/System.Data/ChangeLog 2008-07-03 
</I>&gt;&gt;<i> &gt; 13:38:09
</I>&gt;&gt;<i> &gt; UTC (rev 107145)
</I>&gt;&gt;<i> &gt; @@ -1,3 +1,7 @@
</I>&gt;&gt;<i> &gt; +2008-07-03  Marek Habersack  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mhabersack at novell.com</A>&gt;
</I>&gt;&gt;<i> &gt; +
</I>&gt;&gt;<i> &gt; + * DataRow.cs (this []): Use DBNull instead of throwing an exception
</I>&gt;&gt;<i> &gt; +
</I>&gt;&gt;<i> &gt;  2008-07-01  Rodrigo Kumpera  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">rkumpera at novell.com</A>&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;  * DataTable.cs: Kill some foreach loops.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Modified: trunk/mcs/class/System.Data/System.Data/DataRow.cs
</I>&gt;&gt;<i> &gt; ===================================================================
</I>&gt;&gt;<i> &gt; --- trunk/mcs/class/System.Data/System.Data/DataRow.cs 2008-07-03
</I>&gt;&gt;<i> 13:37:14
</I>&gt;&gt;<i> &gt; UTC (rev 107144)
</I>&gt;&gt;<i> &gt; +++ trunk/mcs/class/System.Data/System.Data/DataRow.cs 2008-07-03
</I>&gt;&gt;<i> 13:38:09
</I>&gt;&gt;<i> &gt; UTC (rev 107145)
</I>&gt;&gt;<i> &gt; @@ -178,9 +178,8 @@
</I>&gt;&gt;<i> &gt;  DataColumn column =
</I>&gt;&gt;<i> &gt; _table.Columns[columnIndex];
</I>&gt;&gt;<i> &gt;  _table.ChangingDataColumn (this, column,
</I>&gt;&gt;<i> &gt; value);
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; - if (value == null &amp;&amp; column.DataType !=
</I>&gt;&gt;<i> &gt; typeof(string)) {
</I>&gt;&gt;<i> &gt; - throw new ArgumentException(&quot;Cannot
</I>&gt;&gt;<i> &gt; set column &quot; + column.ColumnName + &quot; to be null, Please use DBNull
</I>&gt;&gt;<i> &gt; instead&quot;);
</I>&gt;&gt;<i> &gt; - }
</I>&gt;&gt;<i> &gt; + if (value == null &amp;&amp; column.DataType !=
</I>&gt;&gt;<i> &gt; typeof(string))
</I>&gt;&gt;<i> &gt; + value = DBNull.Value;
</I>&gt;&gt;<i> &gt;  _rowChanged = true;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;  CheckValue (value, column);
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; Mono-patches maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-patches at lists.ximian.com</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-patches">http://lists.ximian.com/mailman/listinfo/mono-patches</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028461.html">[Mono-dev]	[Mono-patches]	r107145	-	trunk/mcs/class/System.Data/System.Data
</A></li>
	<LI>Next message: <A HREF="028463.html">[Mono-dev]	[Mono-patches]	r107145	-	trunk/mcs/class/System.Data/System.Data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28462">[ date ]</a>
              <a href="thread.html#28462">[ thread ]</a>
              <a href="subject.html#28462">[ subject ]</a>
              <a href="author.html#28462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
