<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] I: Re: System.Diagnostics.Process.Start() crashes when trying to allocate more than 255 processes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20I%3A%20Re%3A%20System.Diagnostics.Process.Start%28%29%20crashes%0A%20when%20trying%20to%20allocate%20more%20than%20255%20processes&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037685.html">
   <LINK REL="Next"  HREF="037690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] I: Re: System.Diagnostics.Process.Start() crashes when trying to allocate more than 255 processes</H1>
    <B>fcolle at libero.it</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20I%3A%20Re%3A%20System.Diagnostics.Process.Start%28%29%20crashes%0A%20when%20trying%20to%20allocate%20more%20than%20255%20processes&In-Reply-To="
       TITLE="[Mono-dev] I: Re: System.Diagnostics.Process.Start() crashes when trying to allocate more than 255 processes">fcolle at libero.it
       </A><BR>
    <I>Tue Jun 14 02:47:27 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037685.html">[Mono-dev] compiling (2.10.2) on a beagleboard-xm running Ubuntu
</A></li>
        <LI>Next message: <A HREF="037690.html">[Mono-dev] Feasibility and performance of Mono on WinCE?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37687">[ date ]</a>
              <a href="thread.html#37687">[ thread ]</a>
              <a href="subject.html#37687">[ subject ]</a>
              <a href="author.html#37687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes, Tom, I think it could be the problem.For the moment I solved with a workaround. I changed the architecture and made up threads instead of processes. Anyways I think there are several situations where having more than 255 processes is possible.Another difference I noticed is that when you create child processes and kill the main program, under windows the processes are killed, whereas they continue to live on linux. 
Tom wrote:Might it have to do with the fact that Mono only allows 256 shared handles?

See _WAPI_HANDLE_INITIAL_COUNT in wapi-private.h and the &quot;/* FIXME: grow
the arrays */&quot; in handles.c _wapi_handle_real_new().

We ran into a problem like this on a build box that exec'd a lot of
processes but we worked around it by using GC.Collect();
GC.WaitForPendingFinalizers(); GC.Collect(); to clean up the handles.

Tom



----Messaggio originale----

Da: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fcolle at libero.it</A>

Data: 13/06/2011 16.10

A: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;

Ogg: System.Diagnostics.Process.Start() crashes when trying to allocate more than 255 processes




Dear all,
 my linux application needs to start a big number (400) of processes. Each process is a mono application. 
I found the when trying to run more then 255 processes the runtime generates an exception.

The problem does NOT arise when executing other processes, like e.g. bash.

Example


The following two executables classes are a simple proof of concept. 
Just compile the second class and put in into the /tmp folder
MAIN PROGRAM


using System;
using System.Collections.Generic;
using System.Text;

using System.Diagnostics;

namespace CrashTester
{
    class Program
    {
        static void Main(string[] args)
        {
            ///In the real application this dictionary
            /// contains useful data. When a process dies,
            /// it can be started again with the same input parameters
            
            try
            {
                for (int i = 0; i &lt; 260; i++)
                {
                    Console.Error.WriteLine(&quot;STARTING PROCESS: &quot;+(i+1).ToString());
                    ProcessStartInfo startinfo = new ProcessStartInfo();
                    startinfo.FileName = &quot;/usr/local/bin/mono&quot;;				
                    startinfo.Arguments = &quot;/tmp/ToCrash.exe &quot;+(i+1).ToString();
                    startinfo.UseShellExecute = false;
                    startinfo.RedirectStandardError = false;
                    startinfo.RedirectStandardOutput = false;
                    Process p = new Process();
                    p.StartInfo = startinfo;                    
                    p.Start();
                }
            }
            catch (Exception ex)
            {
                Console.Error.WriteLine(ex.Message);
                Console.Error.WriteLine(&quot;ERROR IN START PROCESS!&quot;);
            }
			
            Console.ReadKey();

        }
    }
}




CHILD PROCESSES


using System;
using System.Collections.Generic;
using System.Text;

namespace ToCrash
{
    class Program
    {
        static void Main(string[] args)
        {
			if((args!=null)&amp;amp;&amp;amp;(args.Length&gt;0))
			{
              Console.WriteLine(args[0]);
			}
            Console.ReadLine();
        }
    }
} 



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110614/fba76f52/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110614/fba76f52/attachment.html</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037685.html">[Mono-dev] compiling (2.10.2) on a beagleboard-xm running Ubuntu
</A></li>
	<LI>Next message: <A HREF="037690.html">[Mono-dev] Feasibility and performance of Mono on WinCE?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37687">[ date ]</a>
              <a href="thread.html#37687">[ thread ]</a>
              <a href="subject.html#37687">[ subject ]</a>
              <a href="author.html#37687">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
