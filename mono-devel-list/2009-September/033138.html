<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Issues with GC due to libgc
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Issues%20with%20GC%20due%20to%20libgc&In-Reply-To=4AC10905.5090106%40terra.es">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033136.html">
   <LINK REL="Next"  HREF="033144.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Issues with GC due to libgc</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Issues%20with%20GC%20due%20to%20libgc&In-Reply-To=4AC10905.5090106%40terra.es"
       TITLE="[Mono-dev] Issues with GC due to libgc">miguel at novell.com
       </A><BR>
    <I>Mon Sep 28 17:41:33 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033136.html">[Mono-dev] Issues with GC due to libgc
</A></li>
        <LI>Next message: <A HREF="033144.html">[Mono-dev] Issues with GC due to libgc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33138">[ date ]</a>
              <a href="thread.html#33138">[ thread ]</a>
              <a href="subject.html#33138">[ subject ]</a>
              <a href="author.html#33138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

&gt;<i> Libgc supports this kind of descriptors and mono already generates
</I>&gt;<i> them
</I>&gt;<i> for the sgen gc, so it's just a matter of joining those together
</I>&gt;<i> (which
</I>&gt;<i> should beeasy to do). This should improve a great number of scans in
</I>&gt;<i> the
</I>&gt;<i> arking process, leaving only stacks and several minor objects without
</I>&gt;<i> precise marking. (Should become similar to the current sgen idea,
</I>&gt;<i> where
</I>&gt;<i> stacks and other roots are scanned conservatively, although not
</I>&gt;<i> compacting).
</I>
Mono already uses those descriptors for the heap;   There are only two
cases when it does not use that:

	* Scanning the stack, this is done with the conservative 
	  collector.

	* Any AppDomains that are not the root appdomain.    

The problem with scanning the stack precisely is that it requires the
JIT and the GC to work as a team to be able to at any point of the
execution to determine which values on the stack are pointers and which
values are not.    This is not trivial.

The problem with AppDomains is that upon unloading there is a potential
for leaking vtables, something that I do not particular think is as
important as being able to scan the AppDomains precisely.   We should
bring Ben's patch into Mono and just default to this.

There are ways of minimizing the problems that you are experiencing
today, some techniques might work better than others, but:

	* Do not allocate large blocks of data, as they tend to fragment
	  your heap;   Instead use smaller allocations, or use unmanaged
	  buffers if you need to.

	  This technique is used in Mono's ASP.NET precisely for that
	  reason.

	  See System.Web/HttpResponseStream.cs

	* Make your stacks shallower.

Miguel.

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033136.html">[Mono-dev] Issues with GC due to libgc
</A></li>
	<LI>Next message: <A HREF="033144.html">[Mono-dev] Issues with GC due to libgc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33138">[ date ]</a>
              <a href="thread.html#33138">[ thread ]</a>
              <a href="subject.html#33138">[ subject ]</a>
              <a href="author.html#33138">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
