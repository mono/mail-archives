<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring	API in sync with .NET 2.0 SP2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20HttpRuntime%20and%20HttpServerUtility%20to%20bring%0A%09API%20in%20sync%20with%20.NET%202.0%20SP2&In-Reply-To=4ABBBB2A.3030601%40twistedcode.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033112.html">
   <LINK REL="Next"  HREF="033114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring	API in sync with .NET 2.0 SP2</H1>
    <B>Nick Berardi</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20HttpRuntime%20and%20HttpServerUtility%20to%20bring%0A%09API%20in%20sync%20with%20.NET%202.0%20SP2&In-Reply-To=4ABBBB2A.3030601%40twistedcode.net"
       TITLE="[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring	API in sync with .NET 2.0 SP2">nberardi at zigamorph.com
       </A><BR>
    <I>Thu Sep 24 16:02:45 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033112.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring API in sync with .NET 2.0 SP2
</A></li>
        <LI>Next message: <A HREF="033114.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring API in sync with .NET 2.0 SP2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33113">[ date ]</a>
              <a href="thread.html#33113">[ thread ]</a>
              <a href="subject.html#33113">[ subject ]</a>
              <a href="author.html#33113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Marek,

It is ultimately up to the team to apply or not apply the patch.  So I
support whatever they choose is best for the Mono project.

However I see no reason to wait to add these stub method in place.  Because
currently any application that relies on either of these API's, get ugly
exceptions like this:

Stack Trace: System.MissingMethodException: Method not found:
'System.Web.HttpServerUtility.TransferRequest'.
at System.Web.HttpApplication+&lt;&gt;c__CompilerGenerated1.MoveNext () [0x00000]
at System.Web.HttpApplication+&lt;&gt;c__CompilerGenerated2.MoveNext () [0x00000]
at System.Web.HttpApplication.Tick () [0x00000]

So there is not even a way to gracefully handle the exception from with in
the application.

And there are many ASP.NET applications, mine is one of them, out there now
that check to see if they are running on the Integrated Pipeline or not.
And handle things differently based on this flag.

But by leaving out these stub API's the Mono project is essentially
forbidding any application that references these API's from running on their
software, even if the application fully supports .NET 2.0 pre and post SP2.
(which is when they were introduced)  At the very least these API's should
be marked with MonoTODOAttribute and committed so that applications that
want to work around API's not currently implemented in Mono can do so.

All that I am really asking for is a graceful way to handle support for Mono
with in my application. Currently I can't even support Mono because I get a
ton of runtime errors about Missing Methods.  At least if the stubs where in
place, I could work around them, but setting a flag in the Web.config or
searching for something Mono specific in the runtime.

Nick

On Thu, Sep 24, 2009 at 2:32 PM, Marek Habersack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>&gt;wrote:

&gt;<i> Nick Berardi wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Marek,
</I>&gt;&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i>  I am a little hesitant to to implement this for Mono for the following
</I>&gt;&gt;<i> reasons.
</I>&gt;&gt;<i> /Number 1/ is the description Microsoft provides for it
</I>&gt;&gt;<i> &quot;Gets a value that indicates whether the current application is running
</I>&gt;&gt;<i> *in the integrated-pipeline mode of IIS 7.0*.&quot;
</I>&gt;&gt;<i>
</I>&gt;<i> You can ignore this particular part of the description. As I wrote in the
</I>&gt;<i> previous mail, Mono effectively implements what was introduced in IIS 7 and
</I>&gt;<i> termed &quot;integrated-pipeline mode&quot;. Therefore it's perfectly fine to
</I>&gt;<i> implement that in Mono.
</I>&gt;<i>
</I>&gt;<i>  /Number 2/ is that the key feature of the integrated-pipeline is that
</I>&gt;&gt;<i> outside processes still run through the .NET framework first, such as, you
</I>&gt;&gt;<i> can use IHttpModules to process request/response data from for example PHP
</I>&gt;&gt;<i> code, I don't know enough about Mono/XPS to get something like this working.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> XSP doesn't implement that and it doesn't have to, it's just a development
</I>&gt;<i> server. Apache, otoh, provides a full filter/pipelining infrastructure with
</I>&gt;<i> which Mono should work just fine (i.e. you can define a module to act as a
</I>&gt;<i> filter and pass its output to another module, etc etc) - I have never tried
</I>&gt;<i> it, but I mod_mono is no different to other modules and it should work just
</I>&gt;<i> fine. It will NOT use IHttpModules, of course, because Apache (being IIS
</I>&gt;<i> counterpart) doesn't have that notion, but functionality is exactly the
</I>&gt;<i> same. We might (just might) approach it at some point and extend mod_mono
</I>&gt;<i> (or create an auxiliary module) in the way which will expose IHttpModules
</I>&gt;<i> etc to Apache, but it's definitely not a priority. Mono/mod_mono/XSP is much
</I>&gt;<i> more flexible than .NET + IIS combo, so the elements are more losely coupled
</I>&gt;<i> but they can be arranged to work in the same way as IIS.
</I>&gt;<i>
</I>&gt;<i>  Many developers use the UsingIntegratedPipeline flag to indicate if they
</I>&gt;&gt;<i> are running in IIS 7.0 integrated mode or the older &quot;classic mode.&quot;  I
</I>&gt;&gt;<i> really feel that getting both the &quot;classic mode&quot; and integrated mode working
</I>&gt;&gt;<i> under Mono would be a huge undertaking, especially in regards to some of the
</I>&gt;&gt;<i> built in support for their Rewriter Module that they have
</I>&gt;&gt;<i>
</I>&gt;<i> We don't have to aim for 1:1 compatibility in this regard - Apache has
</I>&gt;<i> rewriter modules which can easily replace their IIS counterpart, and we do
</I>&gt;<i> not aim to make Mono a replacement for .NET under IIS. Therefore, if a
</I>&gt;<i> developer deploys an ASP.NET application to Mono/Apache/mod_mono they
</I>&gt;<i> should be aware of architectural differences. But, again, that doesn't stop
</I>&gt;<i> us from supporting the APIs (and other &quot;integrated pipeline&quot; ones) for the
</I>&gt;<i> benefit of applications and developers.
</I>&gt;<i>
</I>&gt;<i>  added in to the .NET 2.0 SP2 framework.  Also because a number of
</I>&gt;&gt;<i> sub-routines change in ASP.NET &lt;<A HREF="http://ASP.NET">http://ASP.NET</A>&gt; depending on this one
</I>&gt;&gt;<i> flag.
</I>&gt;&gt;<i>
</I>&gt;<i> Nothing prevents us from defaulting to false for UsingIntegratedPipeline
</I>&gt;<i> and providing a mechanism to turn it on (by e.g. providing a
</I>&gt;<i> MonoServerEnableIntegratedPipeline AppSettings entry - we already have a
</I>&gt;<i> number of them, documented in the xsp and mod_mono manpages)
</I>&gt;<i>
</I>&gt;<i>  I would like to commit the patch as is for now, to complete some of the
</I>&gt;&gt;<i> missing parts of the API, and I will look in to what it will take to really
</I>&gt;&gt;<i> get this supported in the Mono framework.
</I>&gt;&gt;<i>
</I>&gt;<i> What the patch generally does is provide stub implementations of the API
</I>&gt;<i> (with, perhaps, the exception of the property) which we don't generally like
</I>&gt;<i> to do, especially if the functionality is relatively easy to implement as in
</I>&gt;<i> this case. I'd rather vote on not commiting the patch in this state, but
</I>&gt;<i> rather wait till you (or somebody else, perhaps even me) provides full
</I>&gt;<i> support for the APIs together with tests etc.
</I>&gt;<i>
</I>&gt;<i> best regards,
</I>&gt;<i>
</I>&gt;<i> marek
</I>&gt;<i>
</I>&gt;<i>  Thanks,
</I>&gt;&gt;<i> Nick
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> P.S. I know of a dozen places where having integrated mode turned on will
</I>&gt;&gt;<i> allow you to do things that you weren't allowed to before.  For example when
</I>&gt;&gt;<i> integrated mode is enabled you can directly add headers using
</I>&gt;&gt;<i> /HttpRequest.Headers.Add/, instead of getting an exception thrown.
</I>&gt;&gt;<i>
</I>&gt;<i> You can do it just fine with Mono as well. As said before, we treat Mono as
</I>&gt;<i> working in the integrated pipeline mode. There's nothing wrong in not having
</I>&gt;<i> full support for all of its features right away, we can implement it step by
</I>&gt;<i> step.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> On Thu, Sep 24, 2009 at 4:56 AM, Marek Habersack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>&lt;mailto:
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Nick Berardi wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Hello group,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        This is my first time submitting a patch.  So if anything I have
</I>&gt;&gt;<i>        done is out of the norm, please let me know so that I can
</I>&gt;&gt;<i>        correct it.          There are two API's related to IIS 7.0 that
</I>&gt;&gt;<i> were added as part
</I>&gt;&gt;<i>        of the .NET 2.0 SP2 release that I need supported for an Open
</I>&gt;&gt;<i>        Source project that I work on (<A HREF="http://urlrewriter.codeplex.com">http://urlrewriter.codeplex.com</A>).
</I>&gt;&gt;<i>         (
</I>&gt;&gt;<i> <A HREF="http://urlrewriter.codeplex.com/WorkItem/View.aspx?WorkItemId=7187">http://urlrewriter.codeplex.com/WorkItem/View.aspx?WorkItemId=7187</A>)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        The patch that I am submitting is for the following APIs:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>           * HttpRuntime.UsingIntegratedPipeline { get; }
</I>&gt;&gt;<i>           *
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  HttpServerUtility.TransferRequest(string,[bool],[string],[NameValueCollection])
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Since both of these API's are IIS 7.0+ specific and that they
</I>&gt;&gt;<i>        require the Integrated Pipeline to function.  I have the first
</I>&gt;&gt;<i>        property UsingIntegratedPipeline always returning false, since
</I>&gt;&gt;<i>        it is currently impossible to put Mono in to the core of IIS
</I>&gt;&gt;<i>        7.0, so Integrated Pipeline
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Technically Mono has always been using what IIS 7 calls &quot;integrated
</I>&gt;&gt;<i>    pipeline&quot; - there are no plans to make Mono run in the IIS core, so
</I>&gt;&gt;<i>    we should try to implement whatever functionality makes sense in
</I>&gt;&gt;<i>    Mono context without looking whether or not it works in this or that
</I>&gt;&gt;<i>    IIS mode. I'd say UsingIntegratedPipeline could return 'true'
</I>&gt;&gt;<i>    without harm.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        can't currently be supported.  So I hoped to achieve the 2nd
</I>&gt;&gt;<i>        best option of API completeness.  The second method
</I>&gt;&gt;<i>        TransferRequest relies on the Integrated Pipeline so again it
</I>&gt;&gt;<i>        will not be supported.  So I have the method just throwing the
</I>&gt;&gt;<i>        publically available exceptions shows on MSDN.  This second
</I>&gt;&gt;<i>        method will always throw PlatformNotSupported, for API
</I>&gt;&gt;<i>        completeness with the .NET 2.0 SP2 framework.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    This method, as well, can be implemented to perform its function on
</I>&gt;&gt;<i>    Mono just fine. If you feel like giving it a try, I'd welcome a new
</I>&gt;&gt;<i>    patch which implements it. If not, I will accept the patch as it is
</I>&gt;&gt;<i>    now and implement the API fully at some point.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Please let me know what the next steps are or if there is
</I>&gt;&gt;<i>        anything that I need to change in order to get this patch moved
</I>&gt;&gt;<i>        into production.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Thanks,
</I>&gt;&gt;<i>        Nick
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    best regards,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    marek
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090924/a01b7a1d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090924/a01b7a1d/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033112.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring API in sync with .NET 2.0 SP2
</A></li>
	<LI>Next message: <A HREF="033114.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring API in sync with .NET 2.0 SP2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33113">[ date ]</a>
              <a href="thread.html#33113">[ thread ]</a>
              <a href="subject.html#33113">[ subject ]</a>
              <a href="author.html#33113">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
