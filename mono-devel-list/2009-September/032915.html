<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Gtk depends on Winforms &#191;?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%3D%3Fiso-8859-1%3Fq%3FGtk_depends_on_Winforms_%3DBF%3D3F%3F%3D&In-Reply-To=4aa36b53.0e35640a.095f.ffff88a1%40mx.google.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032914.html">
   <LINK REL="Next"  HREF="032916.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Gtk depends on Winforms &#191;?</H1>
    <B>Christian Hoff</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%3D%3Fiso-8859-1%3Fq%3FGtk_depends_on_Winforms_%3DBF%3D3F%3F%3D&In-Reply-To=4aa36b53.0e35640a.095f.ffff88a1%40mx.google.com"
       TITLE="[Mono-dev] Gtk depends on Winforms &#191;?">christian_hoff at gmx.net
       </A><BR>
    <I>Sun Sep  6 05:55:48 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032914.html">[Mono-dev] Gtk depends on Winforms &#191;?
</A></li>
        <LI>Next message: <A HREF="032916.html">[Mono-dev] Gtk depends on Winforms &#191;?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32915">[ date ]</a>
              <a href="thread.html#32915">[ thread ]</a>
              <a href="subject.html#32915">[ subject ]</a>
              <a href="author.html#32915">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Vladimir Dimitrov wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Or you can use something like this:
</I>&gt;<i>
</I>&gt;<i>                 try {
</I>&gt;<i>                     // This is needed in order for GTK# 2.12.8 to get the
</I>&gt;<i> proper theming
</I>&gt;<i>                     Assembly winForms = Assembly.Load
</I>&gt;<i> (&quot;System.Windows.Forms, Version=2.0.0.0, Culture=neutral,
</I>&gt;<i> PublicKeyToken=b77a5c561934e089&quot;);
</I>&gt;<i>                     Type appType = winForms.GetType
</I>&gt;<i> (&quot;System.Windows.Forms.Application&quot;);
</I>&gt;<i>                     MethodInfo method = appType.GetMethod
</I>&gt;<i> (&quot;EnableVisualStyles&quot;, BindingFlags.Static | BindingFlags.Public);
</I>&gt;<i>                     method.Invoke (null, null);
</I>&gt;<i>
</I>&gt;<i>                     method = appType.GetMethod (&quot;DoEvents&quot;,
</I>&gt;<i> BindingFlags.Static | BindingFlags.Public);
</I>&gt;<i>                     method.Invoke (null, null);
</I>&gt;<i>                 } catch { }
</I>&gt;<i>
</I>&gt;<i> I used that block before when the bug with the visual styles was not fixed,
</I>&gt;<i> to evade using references to SWF.
</I>&gt;<i>   
</I>This is exactly the workaround as it is in Gtk# at the moment. We do not 
refernce Winforms directly, but load the assembly via reflection. The 
only problem is that we're missing the &quot;try&quot;-block.

This workaround is necessary to enable XP's visual styles with the 
default native Windows Gtk+ theme (in winforms apps, calling 
System.Windows.Forms.Application.EnableVisualStyles does this job for 
you). As I said, nobody has ever found out what DoEvents does and why 
produces the desired results. We'd really like to avoid loading SWF at 
runtime, but so far nobody has come up with a better solution :-) .

This issue will be fixed in Gtk# 2.12.10, it's on my list and will be 
I'll get to it ASAP. I already added the try-block in my local copy, I'd 
just appreciate some feedback from Mike before I commit this.


Christian
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Andoni Morales wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have recently tried to upgrade  from Mono 2.4 to 2.4.2.2 in Windows
</I>&gt;&gt;<i> XP, which comes with gtk-sharp-2.12.9
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My aplication does not depends on Winforms and using Mono 2.4 I can
</I>&gt;&gt;<i> launch it without any problems. But  when I use Mono 2.4.2.2 I run
</I>&gt;&gt;<i> into this exception:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Unhandled Exception: System.TypeInitializationException: An exception
</I>&gt;&gt;<i> was thrown by the type initializer for Gtk.Application ---&gt;
</I>&gt;&gt;<i> System.IO.FileNotFoundException: Could not load file or assembly
</I>&gt;&gt;<i> 'System.Windows.Forms, Version=2.0.0.0, Culture=neutral,
</I>&gt;&gt;<i> PublicKeyToken=b77a5c561934e089' or one of its dependencies. The
</I>&gt;&gt;<i> system cannot find the file specified.
</I>&gt;&gt;<i> File name: 'System.Windows.Forms, Version=2.0.0.0, Culture=neutral,
</I>&gt;&gt;<i> PublicKeyToken=b77a5c561934e089'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does that means that with gtk-sharp-2.12.9 I need System.Windows.Forms
</I>&gt;&gt;<i> to run a Gtk app?
</I>&gt;&gt;<i>     
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032914.html">[Mono-dev] Gtk depends on Winforms &#191;?
</A></li>
	<LI>Next message: <A HREF="032916.html">[Mono-dev] Gtk depends on Winforms &#191;?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32915">[ date ]</a>
              <a href="thread.html#32915">[ thread ]</a>
              <a href="subject.html#32915">[ subject ]</a>
              <a href="author.html#32915">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
