<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono's reflection implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%27s%20reflection%20implementation&In-Reply-To=mailman.9912.1252527255.14358.mono-devel-list%40lists.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032963.html">
   <LINK REL="Next"  HREF="032967.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono's reflection implementation</H1>
    <B>Kris Mok</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%27s%20reflection%20implementation&In-Reply-To=mailman.9912.1252527255.14358.mono-devel-list%40lists.ximian.com"
       TITLE="[Mono-dev] Mono's reflection implementation">rednaxela0607 at hotmail.com
       </A><BR>
    <I>Thu Sep 10 03:53:53 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032963.html">[Mono-dev] [PATCH] Calling COM methods with delegates
</A></li>
        <LI>Next message: <A HREF="032967.html">[Mono-dev] Mono's reflection implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32965">[ date ]</a>
              <a href="thread.html#32965">[ thread ]</a>
              <a href="subject.html#32965">[ subject ]</a>
              <a href="author.html#32965">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I was trying out some tricks and needed reflection to pull them off. But 
when I tried to retrieve private instance fields of an object, I found a 
difference in behavior on Type.GetFields between Microsoft's CLR and Mono. I 
tried this on Ubuntu 9.04 with Mono 2.0.1 from apt-get, and Mono 2.4.3.2 
from source tarball.

Here's a repro:

using System;
using System.Reflection;

static class Program {
    static void PrintNonPublicInstanceFields(Type type) {
        Console.WriteLine(&quot;non-public instance fields of {0}&quot;, type);
        var mInfos = type.GetFields(BindingFlags.NonPublic | 
BindingFlags.Instance);
        if (0 == mInfos.Length) Console.WriteLine(&quot;mInfos is empty&quot;);
        foreach (var mi in mInfos) {
            Console.WriteLine(mi);
        }
    }

    static void Main(string[] args) {
        // Mono 2.0.1 doesn't handle GetFields correctly:
        // it only searches declared ones, not inherited ones
        // Mono 2.4.3.2 behaves the same...
        PrintNonPublicInstanceFields(typeof(Func&lt;int, int&gt;));
        Console.WriteLine();
        PrintNonPublicInstanceFields(typeof(Delegate));
    }
}

On Mono, the program's output is:
non-public instance fields of System.Func`2[System.Int32,System.Int32]
mInfos is empty

non-public instance fields of System.Delegate
System.IntPtr method_ptr
System.IntPtr invoke_impl
System.Object m_target
System.IntPtr method
System.IntPtr delegate_trampoline
System.IntPtr method_code
System.Reflection.MethodInfo method_info
System.Reflection.MethodInfo original_method_info
System.DelegateData data

where as on Microsoft's CLR, the output is:
non-public instance fields of System.Func`2[System.Int32,System.Int32]
System.Object _target
System.Reflection.MethodBase _methodBase
IntPtr _methodPtr
IntPtr _methodPtrAux

non-public instance fields of System.Delegate
System.Object _target
System.Reflection.MethodBase _methodBase
IntPtr _methodPtr
IntPtr _methodPtrAux

I know the difference in actual private fields is due to different internal 
implementations, what I'm trying to say is that Mono's Type.GetFields 
doesn't return inherited fields.

According to Mono's documentation, here:
<A HREF="http://go-mono.org/docs/monodoc.ashx?link=M%3aSystem.Type.GetFields(System.Reflection.BindingFlags">http://go-mono.org/docs/monodoc.ashx?link=M%3aSystem.Type.GetFields(System.Reflection.BindingFlags</A>)
it says: System.Reflection.BindingFlags.DeclaredOnly to search only the 
fields declared in the type, not fields that were simply inherited.
I thought this should imply Type.GetFields will return inherited fields if I 
don't call it with BindingFlags.DeclaredOnly. Is the current behavior 
by-design or a bug? 

</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032963.html">[Mono-dev] [PATCH] Calling COM methods with delegates
</A></li>
	<LI>Next message: <A HREF="032967.html">[Mono-dev] Mono's reflection implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32965">[ date ]</a>
              <a href="thread.html#32965">[ thread ]</a>
              <a href="subject.html#32965">[ subject ]</a>
              <a href="author.html#32965">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
