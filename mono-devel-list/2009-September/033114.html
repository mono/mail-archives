<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring API in sync with .NET 2.0 SP2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20HttpRuntime%20and%20HttpServerUtility%20to%20bring%0A%20API%20in%20sync%20with%20.NET%202.0%20SP2&In-Reply-To=f1c2e2880909241302g595c71d8p827b7455f7e4969e%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033113.html">
   <LINK REL="Next"  HREF="033115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring API in sync with .NET 2.0 SP2</H1>
    <B>Marek Habersack</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20HttpRuntime%20and%20HttpServerUtility%20to%20bring%0A%20API%20in%20sync%20with%20.NET%202.0%20SP2&In-Reply-To=f1c2e2880909241302g595c71d8p827b7455f7e4969e%40mail.gmail.com"
       TITLE="[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring API in sync with .NET 2.0 SP2">grendel at twistedcode.net
       </A><BR>
    <I>Thu Sep 24 16:20:33 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033113.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring	API in sync with .NET 2.0 SP2
</A></li>
        <LI>Next message: <A HREF="033115.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring	API in sync with .NET 2.0 SP2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33114">[ date ]</a>
              <a href="thread.html#33114">[ thread ]</a>
              <a href="subject.html#33114">[ subject ]</a>
              <a href="author.html#33114">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Nick Berardi wrote:
&gt;<i> Hi Marek,
</I>Hey Nick,

&gt;<i> 
</I>&gt;<i> It is ultimately up to the team to apply or not apply the patch.  So I 
</I>&gt;<i> support whatever they choose is best for the Mono project. 
</I>Well... I'm part of the team... and in charge of ASP.NET... :)

&gt;<i> However I see no reason to wait to add these stub method in place.  
</I>&gt;<i> Because currently any application that relies on either of these API's, 
</I>&gt;<i> get ugly exceptions like this:
</I>&gt;<i> 
</I>&gt;<i> Stack Trace: System.MissingMethodException: Method not found: 
</I>&gt;<i> 'System.Web.HttpServerUtility.Trans
</I>&gt;<i> ferRequest'.
</I>&gt;<i> at System.Web.HttpApplication+&lt;&gt;c__CompilerGenerated1.MoveNext () [0x00000]
</I>&gt;<i> at System.Web.HttpApplication+&lt;&gt;c__CompilerGenerated2.MoveNext () [0x00000]
</I>&gt;<i> at System.Web.HttpApplication.Tick () [0x00000]
</I>&gt;<i> 
</I>&gt;<i> So there is not even a way to gracefully handle the exception from with 
</I>&gt;<i> in the application.
</I>I realize that, but I would really prefer to accept a patch which does implement the API correctly.

&gt;<i> And there are many ASP.NET &lt;<A HREF="http://ASP.NET">http://ASP.NET</A>&gt; applications, mine is one of 
</I>&gt;<i> them, out there now that check to see if they are running on the 
</I>&gt;<i> Integrated Pipeline or not.  And handle things differently based on this 
</I>&gt;<i> flag. 
</I>Your report is actually the first one we got regarding the issue, so I'm not sure if it's that 
common (at least among apps running on Mono)

&gt;<i> But by leaving out these stub API's the Mono project is essentially 
</I>&gt;<i> forbidding any application that references these API's from running on 
</I>&gt;<i> their software, even if the application fully supports .NET 2.0 pre and 
</I>&gt;<i> post SP2.  (which is when they were introduced)  At the very least these 
</I>&gt;<i> API's should be marked with MonoTODOAttribute and committed so that 
</I>&gt;<i> applications that want to work around API's not currently implemented in 
</I>&gt;<i> Mono can do so.
</I>Frankly, I don't understand your resistance to implementing the transfer API - what are the 
technical reasons for not doing it? From MSDN docs it seems it should be pretty simple to implement, 
why not just do it (I can't do it right now as I'm busy with other things atm) and commit the full 
support?

&gt;<i> All that I am really asking for is a graceful way to handle support for 
</I>&gt;<i> Mono with in my application. Currently I can't even support Mono because 
</I>&gt;<i> I get a ton of runtime errors about Missing Methods.  At least if the 
</I>&gt;<i> stubs where in place, I could work around them, but setting a flag in 
</I>&gt;<i> the Web.config or searching for something Mono specific in the runtime.
</I>I understand the issue, but it's not very hard to patch your copy of Mono, recompile and copy just 
the System.Web.dll assembly to your server. Alternatively you can just introduce an #if in your code 
to skip that part when compiling for Mono. Adding stubbed APIs just before 2.6 is to be branched is 
not acceptable IMO and should be the very last resort.

best regards,

marek

&gt;<i> Nick
</I>&gt;<i> 
</I>&gt;<i> On Thu, Sep 24, 2009 at 2:32 PM, Marek Habersack 
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     Nick Berardi wrote:
</I>&gt;<i> 
</I>&gt;<i>         Hi Marek,
</I>&gt;<i> 
</I>&gt;<i>     Hello,
</I>&gt;<i> 
</I>&gt;<i>         I am a little hesitant to to implement this for Mono for the
</I>&gt;<i>         following reasons.
</I>&gt;<i>         /Number 1/ is the description Microsoft provides for it
</I>&gt;<i>         &quot;Gets a value that indicates whether the current application is
</I>&gt;<i>         running *in the integrated-pipeline mode of IIS 7.0*.&quot;
</I>&gt;<i> 
</I>&gt;<i>     You can ignore this particular part of the description. As I wrote
</I>&gt;<i>     in the previous mail, Mono effectively implements what was
</I>&gt;<i>     introduced in IIS 7 and termed &quot;integrated-pipeline mode&quot;. Therefore
</I>&gt;<i>     it's perfectly fine to implement that in Mono.
</I>&gt;<i> 
</I>&gt;<i>         /Number 2/ is that the key feature of the integrated-pipeline is
</I>&gt;<i>         that outside processes still run through the .NET framework
</I>&gt;<i>         first, such as, you can use IHttpModules to process
</I>&gt;<i>         request/response data from for example PHP code, I don't know
</I>&gt;<i>         enough about Mono/XPS to get something like this working.
</I>&gt;<i> 
</I>&gt;<i>     XSP doesn't implement that and it doesn't have to, it's just a
</I>&gt;<i>     development server. Apache, otoh, provides a full filter/pipelining
</I>&gt;<i>     infrastructure with which Mono should work just fine (i.e. you can
</I>&gt;<i>     define a module to act as a filter and pass its output to another
</I>&gt;<i>     module, etc etc) - I have never tried it, but I mod_mono is no
</I>&gt;<i>     different to other modules and it should work just fine. It will NOT
</I>&gt;<i>     use IHttpModules, of course, because Apache (being IIS counterpart)
</I>&gt;<i>     doesn't have that notion, but functionality is exactly the same. We
</I>&gt;<i>     might (just might) approach it at some point and extend mod_mono (or
</I>&gt;<i>     create an auxiliary module) in the way which will expose
</I>&gt;<i>     IHttpModules etc to Apache, but it's definitely not a priority.
</I>&gt;<i>     Mono/mod_mono/XSP is much more flexible than .NET + IIS combo, so
</I>&gt;<i>     the elements are more losely coupled but they can be arranged to
</I>&gt;<i>     work in the same way as IIS.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         Many developers use the UsingIntegratedPipeline flag to indicate
</I>&gt;<i>         if they are running in IIS 7.0 integrated mode or the older
</I>&gt;<i>         &quot;classic mode.&quot;  I really feel that getting both the &quot;classic
</I>&gt;<i>         mode&quot; and integrated mode working under Mono would be a huge
</I>&gt;<i>         undertaking, especially in regards to some of the built in
</I>&gt;<i>         support for their Rewriter Module that they have
</I>&gt;<i> 
</I>&gt;<i>     We don't have to aim for 1:1 compatibility in this regard - Apache
</I>&gt;<i>     has rewriter modules which can easily replace their IIS counterpart,
</I>&gt;<i>     and we do not aim to make Mono a replacement for .NET under IIS.
</I>&gt;<i>     Therefore, if a developer deploys an ASP.NET &lt;<A HREF="http://ASP.NET">http://ASP.NET</A>&gt;
</I>&gt;<i>     application to Mono/Apache/mod_mono they should be aware of
</I>&gt;<i>     architectural differences. But, again, that doesn't stop us from
</I>&gt;<i>     supporting the APIs (and other &quot;integrated pipeline&quot; ones) for the
</I>&gt;<i>     benefit of applications and developers.
</I>&gt;<i> 
</I>&gt;<i>         added in to the .NET 2.0 SP2 framework.  Also because a number
</I>&gt;<i>         of sub-routines change in ASP.NET &lt;<A HREF="http://ASP.NET">http://ASP.NET</A>&gt;
</I>&gt;<i>         &lt;<A HREF="http://ASP.NET">http://ASP.NET</A>&gt; depending on this one flag.
</I>&gt;<i> 
</I>&gt;<i>     Nothing prevents us from defaulting to false for
</I>&gt;<i>     UsingIntegratedPipeline and providing a mechanism to turn it on (by
</I>&gt;<i>     e.g. providing a MonoServerEnableIntegratedPipeline AppSettings
</I>&gt;<i>     entry - we already have a number of them, documented in the xsp and
</I>&gt;<i>     mod_mono manpages)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         I would like to commit the patch as is for now, to complete some
</I>&gt;<i>         of the missing parts of the API, and I will look in to what it
</I>&gt;<i>         will take to really get this supported in the Mono framework.
</I>&gt;<i> 
</I>&gt;<i>     What the patch generally does is provide stub implementations of the
</I>&gt;<i>     API (with, perhaps, the exception of the property) which we don't
</I>&gt;<i>     generally like to do, especially if the functionality is relatively
</I>&gt;<i>     easy to implement as in this case. I'd rather vote on not commiting
</I>&gt;<i>     the patch in this state, but rather wait till you (or somebody else,
</I>&gt;<i>     perhaps even me) provides full support for the APIs together with
</I>&gt;<i>     tests etc.
</I>&gt;<i> 
</I>&gt;<i>     best regards,
</I>&gt;<i> 
</I>&gt;<i>     marek
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         Thanks,
</I>&gt;<i>         Nick
</I>&gt;<i> 
</I>&gt;<i>         P.S. I know of a dozen places where having integrated mode
</I>&gt;<i>         turned on will allow you to do things that you weren't allowed
</I>&gt;<i>         to before.  For example when integrated mode is enabled you can
</I>&gt;<i>         directly add headers using /HttpRequest.Headers.Add/, instead of
</I>&gt;<i>         getting an exception thrown.
</I>&gt;<i> 
</I>&gt;<i>     You can do it just fine with Mono as well. As said before, we treat
</I>&gt;<i>     Mono as working in the integrated pipeline mode. There's nothing
</I>&gt;<i>     wrong in not having full support for all of its features right away,
</I>&gt;<i>     we can implement it step by step.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         On Thu, Sep 24, 2009 at 4:56 AM, Marek Habersack
</I>&gt;<i>         &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>&gt;
</I>&gt;<i>         &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>
</I>&gt;<i>         &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>&gt;&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>            Nick Berardi wrote:
</I>&gt;<i> 
</I>&gt;<i>                Hello group,
</I>&gt;<i> 
</I>&gt;<i>            Hello,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>                This is my first time submitting a patch.  So if anything
</I>&gt;<i>         I have
</I>&gt;<i>                done is out of the norm, please let me know so that I can
</I>&gt;<i>                correct it.          There are two API's related to IIS
</I>&gt;<i>         7.0 that were added as part
</I>&gt;<i>                of the .NET 2.0 SP2 release that I need supported for an Open
</I>&gt;<i>                Source project that I work on
</I>&gt;<i>         (<A HREF="http://urlrewriter.codeplex.com">http://urlrewriter.codeplex.com</A>).
</I>&gt;<i>                
</I>&gt;<i>         (<A HREF="http://urlrewriter.codeplex.com/WorkItem/View.aspx?WorkItemId=7187">http://urlrewriter.codeplex.com/WorkItem/View.aspx?WorkItemId=7187</A>)
</I>&gt;<i> 
</I>&gt;<i>                The patch that I am submitting is for the following APIs:
</I>&gt;<i> 
</I>&gt;<i>                   * HttpRuntime.UsingIntegratedPipeline { get; }
</I>&gt;<i>                   *
</I>&gt;<i>              
</I>&gt;<i>          HttpServerUtility.TransferRequest(string,[bool],[string],[NameValueCollection])
</I>&gt;<i> 
</I>&gt;<i>                Since both of these API's are IIS 7.0+ specific and that they
</I>&gt;<i>                require the Integrated Pipeline to function.  I have the
</I>&gt;<i>         first
</I>&gt;<i>                property UsingIntegratedPipeline always returning false,
</I>&gt;<i>         since
</I>&gt;<i>                it is currently impossible to put Mono in to the core of IIS
</I>&gt;<i>                7.0, so Integrated Pipeline
</I>&gt;<i> 
</I>&gt;<i>            Technically Mono has always been using what IIS 7 calls
</I>&gt;<i>         &quot;integrated
</I>&gt;<i>            pipeline&quot; - there are no plans to make Mono run in the IIS
</I>&gt;<i>         core, so
</I>&gt;<i>            we should try to implement whatever functionality makes sense in
</I>&gt;<i>            Mono context without looking whether or not it works in this
</I>&gt;<i>         or that
</I>&gt;<i>            IIS mode. I'd say UsingIntegratedPipeline could return 'true'
</I>&gt;<i>            without harm.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>                can't currently be supported.  So I hoped to achieve the 2nd
</I>&gt;<i>                best option of API completeness.  The second method
</I>&gt;<i>                TransferRequest relies on the Integrated Pipeline so again it
</I>&gt;<i>                will not be supported.  So I have the method just
</I>&gt;<i>         throwing the
</I>&gt;<i>                publically available exceptions shows on MSDN.  This second
</I>&gt;<i>                method will always throw PlatformNotSupported, for API
</I>&gt;<i>                completeness with the .NET 2.0 SP2 framework.
</I>&gt;<i> 
</I>&gt;<i>            This method, as well, can be implemented to perform its
</I>&gt;<i>         function on
</I>&gt;<i>            Mono just fine. If you feel like giving it a try, I'd welcome
</I>&gt;<i>         a new
</I>&gt;<i>            patch which implements it. If not, I will accept the patch as
</I>&gt;<i>         it is
</I>&gt;<i>            now and implement the API fully at some point.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>                Please let me know what the next steps are or if there is
</I>&gt;<i>                anything that I need to change in order to get this patch
</I>&gt;<i>         moved
</I>&gt;<i>                into production.
</I>&gt;<i> 
</I>&gt;<i>                Thanks,
</I>&gt;<i>                Nick
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>            best regards,
</I>&gt;<i> 
</I>&gt;<i>            marek
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i>         _______________________________________________
</I>&gt;<i>         Mono-devel-list mailing list
</I>&gt;<i>         <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i>         &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i>         <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033113.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring	API in sync with .NET 2.0 SP2
</A></li>
	<LI>Next message: <A HREF="033115.html">[Mono-dev] Patch for HttpRuntime and HttpServerUtility to bring	API in sync with .NET 2.0 SP2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33114">[ date ]</a>
              <a href="thread.html#33114">[ thread ]</a>
              <a href="subject.html#33114">[ subject ]</a>
              <a href="author.html#33114">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
