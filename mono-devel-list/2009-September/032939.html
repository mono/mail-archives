<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] New error handling framework for mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20error%20handling%20framework%20for%20mono&In-Reply-To=20090903153612.GA31216%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032903.html">
   <LINK REL="Next"  HREF="032904.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] New error handling framework for mono</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20error%20handling%20framework%20for%20mono&In-Reply-To=20090903153612.GA31216%40debian.org"
       TITLE="[Mono-dev] New error handling framework for mono">kumpera at gmail.com
       </A><BR>
    <I>Tue Sep  8 17:33:39 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032903.html">[Mono-dev] New error handling framework for mono
</A></li>
        <LI>Next message: <A HREF="032904.html">[Mono-dev] Debugger not working on trunk?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32939">[ date ]</a>
              <a href="thread.html#32939">[ thread ]</a>
              <a href="subject.html#32939">[ subject ]</a>
              <a href="author.html#32939">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Sep 3, 2009 at 12:36 PM, Paolo Molaro &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>&gt; wrote:

&gt;<i> I'm not happy with both the MONO_ERROR_STORE_FULL_MESSAGE and
</I>&gt;<i> MONO_ERROR_DONT_COPY_STRINGS flags you introduced.
</I>&gt;<i> For the message this could be handled automatically: if it doesn't fit
</I>&gt;<i> into the buffer you can malloc it at set time, the code that initializes
</I>&gt;<i> the
</I>&gt;<i> MonoError has no way to know if the message will fit or not.
</I>&gt;<i> Similarly, the initializing code can't know if any of the strings need
</I>&gt;<i> to be strduped because it's far away from the code that sets it.
</I>&gt;<i> This should be decided at the callsite, either passing a flag or calling
</I>&gt;<i> a separate function that does the dup.
</I>&gt;<i>
</I>
I introduced mono_error_dup_strings which let's the caller control if the
supplied
strings are to be released.


&gt;<i> A small note on overlong messages. I think we should have a policy like
</I>&gt;<i> this:
</I>&gt;<i> *) error messages should be short sentences
</I>&gt;<i> *) any non-essential description of the error and suggestions for
</I>&gt;<i> workarounds should go into either or both the logging mechanism and the
</I>&gt;<i> documentation (wiki etc.)
</I>&gt;<i>
</I>
Makes sense, one thing we could improve in the logged messages is to provide
some sort of unique code describing it. This helps a lot troubleshooting
users
problems and is very google friendly.



&gt;<i> &gt; But what should be done when we get an allocation failure on the
</I>&gt;<i> &gt; mono_exception_set_*
</I>&gt;<i> &gt; function? Should we just convert such error into an OOM, abort due to a
</I>&gt;<i> &gt; double-fault or
</I>&gt;<i> &gt; silently ignore those arguments (and print something on console).
</I>&gt;<i>
</I>&gt;<i> It is tricky. In some cases we want to communicate an OOM exception to
</I>&gt;<i> the managed code. In some others we can't: we need to give the caller
</I>&gt;<i> code a chance to handle the error and not crash.
</I>&gt;<i> Using a flag here can be helpful: something like MONO_ERROR_INCOMPLETE
</I>&gt;<i> to signal that the full info was not stored for whatever reason.
</I>&gt;<i> That should about strike a good balance between being robust and keeping
</I>&gt;<i> track of as much info as we can. Aborting here is not an option, IMHO.
</I>&gt;<i>
</I>
I added a MONO_ERROR_INCOMPLETE used for that.

&gt;<i> +void
</I>&gt;<i> &gt; +mono_error_set_corlib_exception (MonoError *oerror, const char
</I>&gt;<i> *name_space, const char *name)
</I>&gt;<i> &gt; +{
</I>&gt;<i> &gt; +     MonoErrorInternal *error = (MonoErrorInternal*)oerror;
</I>&gt;<i> &gt; +
</I>&gt;<i> &gt; +     if (error-&gt;flags &amp; MONO_ERROR_DONT_COPY_STRINGS) {
</I>&gt;<i> &gt; +             error-&gt;exception_name_space = name_space;
</I>&gt;<i> &gt; +             error-&gt;exception_name = name;
</I>&gt;<i> &gt; +     } else {
</I>&gt;<i> &gt; +             error-&gt;exception_name_space = g_strdup (name_space);
</I>&gt;<i> &gt; +             error-&gt;exception_name = g_strdup (name);
</I>&gt;<i> &gt; +     }
</I>&gt;<i>
</I>&gt;<i> This should set error_code as well (maybe have it passed as an argument).
</I>&gt;<i>
</I>&gt;<i>
</I>I removed those functions from the API as they add no value at all. The way
to go is to
use one of the provided error-setting functions. Using those setter
functions won't make
difference for reporting the error.
If it's not enough, then it's better to just add another entry in the error
codes array and a
new error-setting function.

Attached is a revised patch.

Cheers,
Rodrigo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090908/80b6a25e/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090908/80b6a25e/attachment-0001.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mono-error-patch-2.diff
Type: text/x-diff
Size: 17122 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090908/80b6a25e/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090908/80b6a25e/attachment-0001.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032903.html">[Mono-dev] New error handling framework for mono
</A></li>
	<LI>Next message: <A HREF="032904.html">[Mono-dev] Debugger not working on trunk?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32939">[ date ]</a>
              <a href="thread.html#32939">[ thread ]</a>
              <a href="subject.html#32939">[ subject ]</a>
              <a href="author.html#32939">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
