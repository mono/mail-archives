<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: Mono-devel-list digest, Vol 1 #1576 - 3	msgs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20Mono-devel-list%20digest%2C%20Vol%201%20%231576%20-%203%0A%09msgs&In-Reply-To=1112411406.5844.11.camel%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011327.html">
   <LINK REL="Next"  HREF="011335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: Mono-devel-list digest, Vol 1 #1576 - 3	msgs</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20Mono-devel-list%20digest%2C%20Vol%201%20%231576%20-%203%0A%09msgs&In-Reply-To=1112411406.5844.11.camel%40localhost"
       TITLE="[Mono-devel-list] Re: Mono-devel-list digest, Vol 1 #1576 - 3	msgs">jonpryor at vt.edu
       </A><BR>
    <I>Sat Apr  2 11:05:14 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011327.html">[Mono-devel-list] Re: Mono-devel-list digest, Vol 1 #1576 - 3 msgs
</A></li>
        <LI>Next message: <A HREF="011335.html">[Mono-devel-list] Patches for FreeBSD (and other BSD flavors, likely)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11347">[ date ]</a>
              <a href="thread.html#11347">[ thread ]</a>
              <a href="subject.html#11347">[ subject ]</a>
              <a href="author.html#11347">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 2005-04-02 at 05:10 +0200, Michael Rasmussen wrote:
&gt;<i> This is fine if you want to call an external function in unmanage code
</I>&gt;<i> but in my case this is not want I want. I want to be able to start an
</I>&gt;<i> application written in C# and then, if so requested, fork the entire
</I>&gt;<i> application to the background running as a daemon.
</I>
It appears that this won't be possible, at least for now.  The primary
reason is that Mono is multi-threaded by default -- a &quot;Hello World&quot;-
style program has 3 threads active by default (I don't know what they're
doing, but I'm seeing 3 process id's in /proc/PID/task under Linux, and
IIRC each &quot;task&quot; is a thread).

Since it appears that TLS data isn't preserved after the fork(2) call,
you can't do a P/Invoke call at all after a fork -- meaning I should
remove fork and exec from Mono.Unix.Syscall, and replace the pair of
them with a MS-DOS &quot;spawn&quot; equivalent (or just skip the whole thing and
have people use System.Diagnostics.Process instead, which sounds better
all the time...).

To fix this, we'd either need to (a) have only 1 thread active by
default, or (b) find a way to do P/Invoke without using TLS.  I'm not
sure how practical either of these solutions is.

&gt;<i> Maybe I have missed an importing thing about your solutions, but in my
</I>&gt;<i> opinion they does not meet my requirements. As far as I have been able
</I>&gt;<i> to test with my prototypes it all work as intended in my specific case
</I>&gt;<i> due to the fact that it seems mono simply copies the functionality from
</I>&gt;<i> bg on unix - running the task as a background process in the current
</I>&gt;<i> shells environment see IEEE Std 1003.1.
</I>&gt;<i> 
</I>&gt;<i> I could off course make a wrapper in C which forked off by calling mono
</I>&gt;<i> with exec but that is not very portable and undermines the hole idea
</I>&gt;<i> behind C#.
</I>
You could write a wrapper in sh(1), and avoid the C code. :-)

This is especially attractive, as the mono convention is to provide a
shell script to start your program (/usr/bin/mcs is a shell-script), so
you could modify this shell script to run &quot;nohup mono myprogram.exe&quot; if
your --background option is specified.

As for portability, you've lost portability as soon as you use
Mono.Unix, which (except for Stdlib and related classes) will only run
under Unix-like platforms.  If you're on a Unix-like platform, you
should be able to add your own P/Invoke calls relying upon unix
functionality.

I think we also have differing opinions behind the &quot;whole idea behind
C#&quot;.  It is not a Java replacement, attempting to provide &quot;write once,
run anywhere&quot; portability -- just looking at System.Windows.Forms should
reinforce this.  Mono/C# is an environment allowing greater productivity
while still making the most of your target platform.  If you can do this
while being portability, so much the better, but Mono won't try to
ensure portability.  The ease of P/Invoke should reinforce this view.

 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011327.html">[Mono-devel-list] Re: Mono-devel-list digest, Vol 1 #1576 - 3 msgs
</A></li>
	<LI>Next message: <A HREF="011335.html">[Mono-devel-list] Patches for FreeBSD (and other BSD flavors, likely)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11347">[ date ]</a>
              <a href="thread.html#11347">[ thread ]</a>
              <a href="subject.html#11347">[ subject ]</a>
              <a href="author.html#11347">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
