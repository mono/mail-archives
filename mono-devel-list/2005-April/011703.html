<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Authenticode / signcode / chktrust  problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Authenticode%20/%20signcode%20/%20chktrust%20%20problem&In-Reply-To=00cc01c546aa%245a6dd820%245200010a%40FOO">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011689.html">
   <LINK REL="Next"  HREF="011669.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Authenticode / signcode / chktrust  problem</H1>
    <B>S&#233;bastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Authenticode%20/%20signcode%20/%20chktrust%20%20problem&In-Reply-To=00cc01c546aa%245a6dd820%245200010a%40FOO"
       TITLE="[Mono-devel-list] Authenticode / signcode / chktrust  problem">spouliot at videotron.ca
       </A><BR>
    <I>Fri Apr 22 08:40:03 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011689.html">[Mono-devel-list] Authenticode / signcode / chktrust  problem
</A></li>
        <LI>Next message: <A HREF="011669.html">[Mono-devel-list] Default stack alignment for emitted code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11703">[ date ]</a>
              <a href="thread.html#11703">[ thread ]</a>
              <a href="subject.html#11703">[ subject ]</a>
              <a href="author.html#11703">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Daryn,

Open a bug report at bugzilla.ximian.com and attach the following...

(a) the unsigned EXE file (as small as possible, e.g. an hello world);
(b) the Mono signed EXE file (i.e. not working);
(c) the Windows signed EXE file (i.e. working);
(d) the SPC file (which contains only public stuff);
(e) the private key _ONLY_IF_ it's a test key (NOT if you paid for it);

Thanks,
Sebastien Pouliot
home: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">spouliot at videotron.ca</A>
blog: <A HREF="http://pages.infinit.net/ctech/poupou.html">http://pages.infinit.net/ctech/poupou.html</A>


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Daryn Nakhuda [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">daryn at spamarrest.com</A>]
</I>&gt;<i> Sent: 21 avril 2005 15:43
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">spouliot at videotron.ca</A>; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-devel-list] Authenticode / signcode / chktrust
</I>&gt;<i> problem
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> Sorry to bug the list again, but I haven't been able to find any
</I>&gt;<i> more useful
</I>&gt;<i> information in the faq, man pages, or archives in regards to this problem.
</I>&gt;<i>
</I>&gt;<i> My cert is from thawte.  If I use an invalid cert or key I get an
</I>&gt;<i> error, so
</I>&gt;<i> I think they're okay.  I've imported the root CA's into the TRUST store
</I>&gt;<i> (contents of store attached).
</I>&gt;<i>
</I>&gt;<i> However, while the application appears to get signed (no errors from
</I>&gt;<i> signcode),  it doesn't checkout in either chktrust or on windows.
</I>&gt;<i>
</I>&gt;<i> chktrust says:
</I>&gt;<i>             WARNING!  Setup.exe is not timestamped!
</I>&gt;<i>             ERROR!  Setup.exe couldn't find the certificate that
</I>&gt;<i> signed the
</I>&gt;<i> file!
</I>&gt;<i>
</I>&gt;<i> chktrust.exe on windows says: &quot;The digital signature of the
</I>&gt;<i> object did not
</I>&gt;<i> verify&quot;.  It does, however, correctly show my name under the signer
</I>&gt;<i> information, and my certificate under &quot;view certificate&quot;.
</I>&gt;<i>
</I>&gt;<i> If anyone wants me to sign something so you can see what's
</I>&gt;<i> happening, just
</I>&gt;<i> let me know.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Daryn
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i> From: &quot;S&#233;bastien Pouliot&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">spouliot at videotron.ca</A>&gt;
</I>&gt;<i> To: &quot;Daryn Nakhuda&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">daryn at spamarrest.com</A>&gt;;
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> Sent: Thursday, April 21, 2005 4:50 AM
</I>&gt;<i> Subject: RE: [Mono-devel-list] Authenticode / signcode / chktrust problem
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Hello Daryn,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; I'm having a problem signing some code  (the pvk &amp; spc are valid,
</I>&gt;<i> &gt;&gt; and work
</I>&gt;<i> &gt;&gt; fine for signing on windows using signcode.exe)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; 1. signcode -spc mycert.spc -v mykey.pvk -t
</I>&gt;<i> &gt;&gt; <A HREF="http://timestamp.verisign.com/scripts/timstamp.dll">http://timestamp.verisign.com/scripts/timstamp.dll</A> Setup.exe
</I>&gt;<i> &gt;&gt;             Mono SignCode - version 1.1.5.0
</I>&gt;<i> &gt;&gt;             Sign assemblies and PE files using Authenticode(tm).
</I>&gt;<i> &gt;&gt;             Copyright 2002, 2003 Motus Technologies. Copyright
</I>&gt;<i> 2004-2005
</I>&gt;<i> &gt;&gt; Novell. BSD licensed.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; 2. chktrust -v /root/Setup.exe
</I>&gt;<i> &gt;&gt;             Mono CheckTrust - version 1.1.5.0
</I>&gt;<i> &gt;&gt;             Verify if an PE executable has a valid Authenticode(tm)
</I>&gt;<i> &gt;&gt; signature
</I>&gt;<i> &gt;&gt;             Copyright 2002, 2003 Motus Technologies. Copyright
</I>&gt;<i> 2004-2005
</I>&gt;<i> &gt;&gt; Novell. BSD licensed.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;             Verifying file Setup.exe for Authenticode(tm) signatures...
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;             WARNING! Setup.exe is not timestamped!
</I>&gt;<i> &gt;&gt;             ERROR! Setup.exe couldn't find the certificate that
</I>&gt;<i> &gt;&gt; signed the
</I>&gt;<i> &gt;&gt; file!
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; My guess is that perhaps this has something to do with CA's,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Maybe but this isn't the error that chktrust would normally
</I>&gt;<i> display if it
</I>&gt;<i> &gt; was missing the root certificate.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; and I've
</I>&gt;<i> &gt;&gt; downloaded the CA Certs from thawte and verisign, but I'm not sure I've
</I>&gt;<i> &gt;&gt; installed them correctly using certmgr, as I'm not sure the
</I>&gt;<i> proper use of
</I>&gt;<i> &gt;&gt; the various stores.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is your certificate from Thawte or VeriSign ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Some people had problem with the SPC file supplied by VeriSign
</I>&gt;<i> because it
</I>&gt;<i> &gt; use undefined length encoding in it's ASN.1 structure. The &quot;trick&quot; is to
</I>&gt;<i> &gt; import it in Windows then export it back to a SPC file. Windows
</I>&gt;<i> will have
</I>&gt;<i> &gt; converted the structure to &quot;defined&quot; length - which Mono tools can
</I>&gt;<i> &gt; understand.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Look in bugzilla for #68903 for a detailled workaround.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; This is what I did (for every CA cert I could find):
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; certmgr -add -c -m CA ThawteServerCA.cer
</I>&gt;<i> &gt;&gt;             Mono Certificate Manager - version 1.1.5.0
</I>&gt;<i> &gt;&gt;             Manage X.509 certificates and CRL from stores.
</I>&gt;<i> &gt;&gt;             Copyright 2002, 2003 Motus Technologies. Copyright
</I>&gt;<i> 2004-2005
</I>&gt;<i> &gt;&gt; Novell. BSD licensed.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;             1 certificate(s) added to store CA.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Wrong store. You must use the Trust store if you want chktrust
</I>&gt;<i> to validate
</I>&gt;<i> &gt; your signatures. The CA store can be used for any type of CA (i.e. not
</I>&gt;<i> &gt; only
</I>&gt;<i> &gt; root CA).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; <A HREF="http://www.mono-project.com/FAQ:_Security">http://www.mono-project.com/FAQ:_Security</A>
</I>&gt;<i> &gt; or
</I>&gt;<i> &gt; &quot;man certmgr&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Also, on Widows, when I look at the properties &gt; digital
</I>&gt;<i> signatures, the
</I>&gt;<i> &gt;&gt; signature IS there, but it says it is &quot;not valid&quot;.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Can anyone provide some guidance?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The FAQ and the man pages of the tools should be able to answers most
</I>&gt;<i> &gt; questions. Also have a look at the mailing list archives.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sebastien Pouliot
</I>&gt;<i> &gt; home: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">spouliot at videotron.ca</A>
</I>&gt;<i> &gt; blog: <A HREF="http://pages.infinit.net/ctech/poupou.html">http://pages.infinit.net/ctech/poupou.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011689.html">[Mono-devel-list] Authenticode / signcode / chktrust  problem
</A></li>
	<LI>Next message: <A HREF="011669.html">[Mono-devel-list] Default stack alignment for emitted code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11703">[ date ]</a>
              <a href="thread.html#11703">[ thread ]</a>
              <a href="subject.html#11703">[ subject ]</a>
              <a href="author.html#11703">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
