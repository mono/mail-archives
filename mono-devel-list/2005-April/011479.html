<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] PATCH: reworked async IO for Socket
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20PATCH%3A%20reworked%20async%20IO%20for%20Socket&In-Reply-To=97B71C0C860DEC40A993AB9F7F0D43350ACD8B%40fattire.winfessor.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011477.html">
   <LINK REL="Next"  HREF="011481.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] PATCH: reworked async IO for Socket</H1>
    <B>Gonzalo Paniagua Javier</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20PATCH%3A%20reworked%20async%20IO%20for%20Socket&In-Reply-To=97B71C0C860DEC40A993AB9F7F0D43350ACD8B%40fattire.winfessor.com"
       TITLE="[Mono-devel-list] PATCH: reworked async IO for Socket">gonzalo at ximian.com
       </A><BR>
    <I>Fri Apr  8 15:22:46 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="011477.html">[Mono-devel-list] PATCH: reworked async IO for Socket
</A></li>
        <LI>Next message: <A HREF="011481.html">[Mono-devel-list] PATCH: reworked async IO for Socket
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11479">[ date ]</a>
              <a href="thread.html#11479">[ thread ]</a>
              <a href="subject.html#11479">[ subject ]</a>
              <a href="author.html#11479">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2005-04-08 at 11:07 -0700, JD Conley wrote:
&gt;<i> &gt; This patch intercepts the calls before they are added to the thread
</I>&gt;<i> pool
</I>&gt;<i> &gt; and uses a single thread for polling on all the sockets running
</I>&gt;<i> &gt; asynchronous read/write. Once sockets are ready, it dispatches the
</I>&gt;<i> work
</I>&gt;<i> &gt; item to the threadpool which will not be blocked. The patch also
</I>&gt;<i> &gt; serializes read/write calls and allows for multiple Begin* calls on a
</I>&gt;<i> &gt; given socket at the same time (this fails with current mono from SVN).
</I>&gt;<i> 
</I>&gt;<i> This patch is a good start, but this is a fairly serious issue.
</I>&gt;<i> Asynchronous IO is at the heart of high performance, scalable, network
</I>&gt;<i> servers.  Is anyone planning on integrating asynchronous sockets with IO
</I>&gt;<i> Completion Ports (on Windows) and whatever the equivalent is on the
</I>&gt;<i> other platforms?  There has to be a faster way with some kernel level
</I>&gt;<i> asynchronous APIs, rather than playing in user space.
</I>
&gt;<i> Of course, maybe I just misunderstood this thread.  I haven't actually
</I>&gt;<i> looked at the code that does this work.
</I>
For windows, well, patches for using its asynch. IO functions are
welcome :).

For the rest, aio_(read|write) are not always available and/or
SIGEV_THREAD does not work. Even when SIGEV_THREAD works, the thread
that calls the callback function will be killed if the callback takes
&quot;too much&quot; time, which is not much. So we had to use another thread to
actually invoke the managed callback (and the thread has to be from the
threadpool, to behave like MS).

The code that we have right does not have any performance issue and
works on any system that have select(). And we are just 'wasting' one
thread for polling on all the sockets with ongoing async. operations.

-Gonzalo



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011477.html">[Mono-devel-list] PATCH: reworked async IO for Socket
</A></li>
	<LI>Next message: <A HREF="011481.html">[Mono-devel-list] PATCH: reworked async IO for Socket
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11479">[ date ]</a>
              <a href="thread.html#11479">[ thread ]</a>
              <a href="subject.html#11479">[ subject ]</a>
              <a href="author.html#11479">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
