<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for Bug 650365
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20Bug%20650365&In-Reply-To=4CCC720A.7080303%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036183.html">
   <LINK REL="Next"  HREF="036197.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for Bug 650365</H1>
    <B>Stifu</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20Bug%20650365&In-Reply-To=4CCC720A.7080303%40gmail.com"
       TITLE="[Mono-dev] Patch for Bug 650365">stifu at free.fr
       </A><BR>
    <I>Sun Oct 31 04:35:34 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="036183.html">[Mono-dev] Patch for Bug 650365
</A></li>
        <LI>Next message: <A HREF="036197.html">[Mono-dev] Patch for Bug 650365
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36193">[ date ]</a>
              <a href="thread.html#36193">[ thread ]</a>
              <a href="subject.html#36193">[ subject ]</a>
              <a href="author.html#36193">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Note that you may attach the patch directly to the bug report, which may be
more convenient and make it less likely to get lost.

Also, if you provide unit tests that highlight what your patch fixes (as a
2nd patch, that updates the existing unit tests), then developers are likely
to apply your patch faster, as they'll be more confident in the changes.


Nikolaos Georgiou-2 wrote:
&gt;<i> 
</I>&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> earlier this day I discovered a bug in System.Resources:
</I>&gt;<i> <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=650365">https://bugzilla.novell.com/show_bug.cgi?id=650365</A>
</I>&gt;<i> 
</I>&gt;<i> I was able to fix it by myself. The patch is in the attached file. It 
</I>&gt;<i> includes the modification in the source code and one unit test.
</I>&gt;<i> 
</I>&gt;<i> Is this the correct way to submit a fix? Should I do something else?
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Nikolaos Georgiou
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> diff --git
</I>&gt;<i> a/mcs/class/Managed.Windows.Forms/System.Resources/ResXResourceWriter.cs
</I>&gt;<i> b/mcs/class/Managed.Windows.Forms/System.Resources/ResXResourceWriter.cs
</I>&gt;<i> index 5c274ab..fa03e85 100644
</I>&gt;<i> ---
</I>&gt;<i> a/mcs/class/Managed.Windows.Forms/System.Resources/ResXResourceWriter.cs
</I>&gt;<i> +++
</I>&gt;<i> b/mcs/class/Managed.Windows.Forms/System.Resources/ResXResourceWriter.cs
</I>&gt;<i> @@ -241,7 +241,7 @@ namespace System.Resources
</I>&gt;<i>  		private void AddResource (string name, object value, string comment)
</I>&gt;<i>  		{
</I>&gt;<i>  			if (value is string) {
</I>&gt;<i> -				AddResource (name, (string) value);
</I>&gt;<i> +				AddResource (name, (string) value, comment);
</I>&gt;<i>  				return;
</I>&gt;<i>  			}
</I>&gt;<i>  
</I>&gt;<i> @@ -294,6 +294,11 @@ namespace System.Resources
</I>&gt;<i>  		
</I>&gt;<i>  		public void AddResource (string name, string value)
</I>&gt;<i>  		{
</I>&gt;<i> +			AddResource (name, value, string.Empty);
</I>&gt;<i> +		}
</I>&gt;<i> +
</I>&gt;<i> +		public void AddResource (string name, string value, string comment)
</I>&gt;<i> +		{
</I>&gt;<i>  			if (name == null)
</I>&gt;<i>  				throw new ArgumentNullException (&quot;name&quot;);
</I>&gt;<i>  
</I>&gt;<i> @@ -306,7 +311,7 @@ namespace System.Resources
</I>&gt;<i>  			if (writer == null)
</I>&gt;<i>  				InitWriter ();
</I>&gt;<i>  
</I>&gt;<i> -			WriteString (name, value);
</I>&gt;<i> +			WriteString (name, value, null, comment);
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i>  #if NET_2_0
</I>&gt;<i> diff --git
</I>&gt;<i> a/mcs/class/Managed.Windows.Forms/Test/System.Resources/WriterTest.cs
</I>&gt;<i> b/mcs/class/Managed.Windows.Forms/Test/System.Resources/WriterTest.cs
</I>&gt;<i> index 90abb81..5814719 100644
</I>&gt;<i> --- a/mcs/class/Managed.Windows.Forms/Test/System.Resources/WriterTest.cs
</I>&gt;<i> +++ b/mcs/class/Managed.Windows.Forms/Test/System.Resources/WriterTest.cs
</I>&gt;<i> @@ -8,6 +8,7 @@
</I>&gt;<i>  using System;
</I>&gt;<i>  using System.Collections;
</I>&gt;<i>  using System.ComponentModel;
</I>&gt;<i> +using System.ComponentModel.Design;
</I>&gt;<i>  using System.Drawing;
</I>&gt;<i>  using System.Globalization;
</I>&gt;<i>  using System.IO;
</I>&gt;<i> @@ -101,6 +102,39 @@ namespace MonoTests.System.Resources
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i>  		[Test]
</I>&gt;<i> +		public void AddResource_WithComment ()
</I>&gt;<i> +		{
</I>&gt;<i> +			ResXResourceWriter w = new ResXResourceWriter (fileName);
</I>&gt;<i> +			ResXDataNode node = new ResXDataNode (&quot;key&quot;, &quot;value&quot;);
</I>&gt;<i> +    			node.Comment = &quot;comment is preserved&quot;;
</I>&gt;<i> +			w.AddResource (node);
</I>&gt;<i> +			w.Generate ();
</I>&gt;<i> +			w.Close ();
</I>&gt;<i> +
</I>&gt;<i> +			ResXResourceReader r = new ResXResourceReader (fileName);
</I>&gt;<i> +			ITypeResolutionService typeres = null;
</I>&gt;<i> +			r.UseResXDataNodes = true;
</I>&gt;<i> +			
</I>&gt;<i> +			int count = 0;
</I>&gt;<i> +			foreach (DictionaryEntry o in r)
</I>&gt;<i> +			{
</I>&gt;<i> +				string key = o.Key.ToString();
</I>&gt;<i> +				node = (ResXDataNode)o.Value;
</I>&gt;<i> +				string value = node.GetValue (typeres).ToString ();
</I>&gt;<i> +				string comment = node.Comment;
</I>&gt;<i> +
</I>&gt;<i> +				Assert.AreEqual (&quot;key&quot;, key, &quot;key&quot;);
</I>&gt;<i> +				Assert.AreEqual (&quot;value&quot;, value, &quot;value&quot;);
</I>&gt;<i> +				Assert.AreEqual (&quot;comment is preserved&quot;, comment, &quot;comment&quot;);
</I>&gt;<i> +				Assert.AreEqual (0, count, &quot;too many nodes&quot;);
</I>&gt;<i> +				count++;
</I>&gt;<i> +			}
</I>&gt;<i> +			r.Close ();
</I>&gt;<i> +
</I>&gt;<i> +			File.Delete (fileName);
</I>&gt;<i> +		}
</I>&gt;<i> +
</I>&gt;<i> +		[Test]
</I>&gt;<i>  		public void TestWriter ()
</I>&gt;<i>  		{
</I>&gt;<i>  			ResXResourceWriter w = new ResXResourceWriter (fileName);
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Patch-for-Bug-650365-tp3020580p3020918.html">http://mono.1490590.n4.nabble.com/Patch-for-Bug-650365-tp3020580p3020918.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036183.html">[Mono-dev] Patch for Bug 650365
</A></li>
	<LI>Next message: <A HREF="036197.html">[Mono-dev] Patch for Bug 650365
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36193">[ date ]</a>
              <a href="thread.html#36193">[ thread ]</a>
              <a href="subject.html#36193">[ subject ]</a>
              <a href="author.html#36193">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
