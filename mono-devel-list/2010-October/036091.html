<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Error in Mono but not on IIS: A null reference or invalid value was found [GDI+ status: InvalidParameter]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Error%20in%20Mono%20but%20not%20on%20IIS%3A%20A%20null%20reference%20or%0A%20invalid%20value%20was%20found%20%5BGDI%2B%20status%3A%20InvalidParameter%5D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036099.html">
   <LINK REL="Next"  HREF="036092.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Error in Mono but not on IIS: A null reference or invalid value was found [GDI+ status: InvalidParameter]</H1>
    <B>Matthew Urbano</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Error%20in%20Mono%20but%20not%20on%20IIS%3A%20A%20null%20reference%20or%0A%20invalid%20value%20was%20found%20%5BGDI%2B%20status%3A%20InvalidParameter%5D&In-Reply-To="
       TITLE="[Mono-dev] Error in Mono but not on IIS: A null reference or invalid value was found [GDI+ status: InvalidParameter]">matthew.urbano at trailerpark.com
       </A><BR>
    <I>Mon Oct 18 15:03:55 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="036099.html">[Mono-dev] Where should I install my pkg-config files on OS X?
</A></li>
        <LI>Next message: <A HREF="036092.html">[Mono-dev] Error in Mono but not on IIS: A null reference or invalid value was found [GDI+ status: InvalidParameter]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36091">[ date ]</a>
              <a href="thread.html#36091">[ thread ]</a>
              <a href="subject.html#36091">[ subject ]</a>
              <a href="author.html#36091">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Mono world!  I am having a difficult time trying to figure out a way to create an image cropping tool using c# and JQuery's Jcrop plug-in.  I can get the code to work perfectly in plain old .net, but mono gives me the following error:

A null reference or invalid value was found [GDI+ status: InvalidParameter]

Description: HTTP 500. Error processing request.

Stack Trace:

System.ArgumentException: A null reference or invalid value was found [GDI+ status: InvalidParameter]
  at System.Drawing.GDIPlus.CheckStatus (Status status) [0x00000] in &lt;filename unknown&gt;:0
  at System.Drawing.Bitmap.SetResolution (Single xDpi, Single yDpi) [0x00000] in &lt;filename unknown&gt;:0
  at (wrapper remoting-invoke-with-check) System.Drawing.Bitmap:SetResolution (single,single)
  at Fankit.ProfilePictures.btnCrop_Click (System.Object sender, System.EventArgs e) [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.WebControls.Button.OnClick (System.EventArgs e) [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.WebControls.Button.RaisePostBackEvent (System.String eventArgument) [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.WebControls.Button.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent (System.String eventArgument) [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.Page.RaisePostBackEvent (IPostBackEventHandler sourceControl, System.String eventArgument) [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.Page.RaisePostBackEvents () [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.Page.ProcessRaiseEvents () [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.Page.InternalProcessRequest () [0x00000] in &lt;filename unknown&gt;:0
  at System.Web.UI.Page.ProcessRequest (System.Web.HttpContext context) [0x00000] in &lt;filename unknown&gt;:0

Here is the code behind:

protected void btnCrop_Click(object sender, EventArgs e)
        {
            string ImageName = CurrentImage.Value;
            string ImageNameOnly = CurrentImage.Value.Substring(CurrentImage.Value.LastIndexOf(&quot;/&quot;) + 1, CurrentImage.Value.Length - CurrentImage.Value.LastIndexOf(&quot;/&quot;) - 1);
            int w = Convert.ToInt32(W.Value);
            int h = Convert.ToInt32(H.Value);
            int x = Convert.ToInt32(X.Value);
            int y = Convert.ToInt32(Y.Value);

            string originalFile = Server.MapPath(&quot;~/cms/uploads/&quot; + ImageNameOnly);

            using (var photo = System.Drawing.Image.FromFile(Server.MapPath(&quot;~/cms/uploads/&quot; + ImageNameOnly)))

            using (var result = new Bitmap(w, h, photo.PixelFormat))
            {
                result.SetResolution(photo.HorizontalResolution, photo.VerticalResolution);

                using (var g = Graphics.FromImage(result))
                {
                    g.InterpolationMode = InterpolationMode.HighQualityBicubic;

                    g.DrawImage(photo, new Rectangle(0, 0, 100, 100),
                         new Rectangle(x, y, w, h),
                         GraphicsUnit.Pixel);

                    photo.Dispose();

                    //result.Save(sp + &quot;crop-&quot; + ImageNameOnly);
                    imgCropped.ImageUrl = &quot;/cms/uploads/crop-&quot; + ImageNameOnly;

                }

            }
         }


It seems like this line is the root of the problem: using (var photo = System.Drawing.Image.FromFile(Server.MapPath(&quot;~/cms/uploads/&quot; + ImageNameOnly)))

Is there a way around this error??

--
Matthew Urbano | Web Developer
Trailer Park Interactive
6922 Hollywood Blvd., 7th floor
Hollywood, CA  90028
T: 310-845-3021
M: 305-790-1805
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">matthew.urbano at trailerpark.com</A>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">matthew.urbano at trailerpark.com</A>&gt;

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20101018/91a5535d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20101018/91a5535d/attachment.html</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036099.html">[Mono-dev] Where should I install my pkg-config files on OS X?
</A></li>
	<LI>Next message: <A HREF="036092.html">[Mono-dev] Error in Mono but not on IIS: A null reference or invalid value was found [GDI+ status: InvalidParameter]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36091">[ date ]</a>
              <a href="thread.html#36091">[ thread ]</a>
              <a href="subject.html#36091">[ subject ]</a>
              <a href="author.html#36091">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
