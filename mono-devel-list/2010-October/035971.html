<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] CIL optimizer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20CIL%20optimizer&In-Reply-To=AANLkTikm4yBa9kVRTD%3DyYZqRTO_abD1gDgYMMqv40_My%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035970.html">
   <LINK REL="Next"  HREF="035972.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] CIL optimizer</H1>
    <B>Justin Malcolm</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20CIL%20optimizer&In-Reply-To=AANLkTikm4yBa9kVRTD%3DyYZqRTO_abD1gDgYMMqv40_My%40mail.gmail.com"
       TITLE="[Mono-dev] CIL optimizer">malcolm.justin at gmail.com
       </A><BR>
    <I>Sat Oct  2 14:23:54 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035970.html">[Mono-dev] CIL optimizer
</A></li>
        <LI>Next message: <A HREF="035972.html">[Mono-dev] CIL optimizer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35971">[ date ]</a>
              <a href="thread.html#35971">[ thread ]</a>
              <a href="subject.html#35971">[ subject ]</a>
              <a href="author.html#35971">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you for the reply Rodrigo,

Do you mean that there is not much room for optimization of the output from
'mcs' or just of CIL in general?  I have heard that the Microsoft C++
compiler output better code than the C# one did (at least at some point) so
I assumed that CIL efficiency mattered.

I was thinking that a generic CIL optimizer would make it possible for
compiler writers (and others) to worry less about optimization.  I am
writing a compiler myself and I was thinking of keeping the compiler
optimization stupid and implementing a stand-alone CIL optimizer to go with
it.  That is why I wanted to know if anybody else had done any work on it.

I know one thing, my current compiler puts out some pretty bad CIL.  For
example, compiling 5+4*3-6/3 in my compiler results in a bunch of 'i4'
literals along with 'mul', 'add', 'sub', and 'div' instructions.  Clearly
this could be better.  I figured, why do it in every compiler when I could
just write a generic optimizer instead.

I guess I do not really know what optimizations .NET and Mono do at the JIT
level so I am not sure how the CIL affects the quality of the machine code
that actually gets executed.  Do things like dead code elimination, constant
propagation, loop unrolling, conversion avoidance, and changing things like
&quot;idc.i4&quot; to &quot;idc.i4.s&quot; affect the final result at all or just the JIT time?

It sounds like you are implying that the JIT manages pretty well even when
you feed it inefficient CIL.  Then again, your instrumentation comment makes
me wonder if I have that right.  If you could elaborate, I would appreciate
knowing if I would be wasting my time to go down this road.

If you were going to optimize the CIL, where would you expect to get a
return on your efforts?

I did not expect that anything had been done but I guess there was no harm
in asking.  If I get there myself,  I will let you know.

Thanks.

On 2 October 2010 07:26, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:

&gt;<i> Nothing happened on this front for two reasons.
</I>&gt;<i>
</I>&gt;<i> First that nobody had the time for it. It's a major undertaking.
</I>&gt;<i>
</I>&gt;<i> Second, not one is sure that it will yield any improvements at all. Given
</I>&gt;<i> CIL
</I>&gt;<i> is a quite high level format with some rigid structure requirements, there
</I>&gt;<i> isn't
</I>&gt;<i> much room for optimization - at least at glance.
</I>&gt;<i>
</I>&gt;<i> It has been suggested that producing a different format, that is more
</I>&gt;<i> amendable
</I>&gt;<i> for optimization would allow for better results but, again, it's an even
</I>&gt;<i> harder task
</I>&gt;<i> with the same level of uncertainty.
</I>&gt;<i>
</I>&gt;<i> A CIL optimizer has one valid use case thou, that is to optimize code that
</I>&gt;<i> has
</I>&gt;<i> been instrumented. This would avoid the instrumentation writer having to
</I>&gt;<i> care
</I>&gt;<i> about emitting efficient CIL bytecode.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sat, Oct 2, 2010 at 4:54 AM, jmalcolm &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">malcolm.justin at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I remember reading a very long while back that there might be a plan to
</I>&gt;&gt;<i> create a generic CIL optimizer.  I understood this to mean CIL in and
</I>&gt;&gt;<i> better
</I>&gt;&gt;<i> CIL out.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Did anything ever happen with this?  Is there any code anywhere I can dig
</I>&gt;&gt;<i> up?
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> View this message in context:
</I>&gt;&gt;<i> <A HREF="http://mono.1490590.n4.nabble.com/CIL-optimizer-tp2952239p2952239.html">http://mono.1490590.n4.nabble.com/CIL-optimizer-tp2952239p2952239.html</A>
</I>&gt;&gt;<i> Sent from the Mono - Dev mailing list archive at Nabble.com.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20101002/afc149e6/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20101002/afc149e6/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035970.html">[Mono-dev] CIL optimizer
</A></li>
	<LI>Next message: <A HREF="035972.html">[Mono-dev] CIL optimizer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35971">[ date ]</a>
              <a href="thread.html#35971">[ thread ]</a>
              <a href="subject.html#35971">[ subject ]</a>
              <a href="author.html#35971">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
