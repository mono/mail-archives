<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] building for Mono under msbuild
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20building%20for%20Mono%20under%20msbuild&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015317.html">
   <LINK REL="Next"  HREF="015319.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] building for Mono under msbuild</H1>
    <B>Andy Waddell</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20building%20for%20Mono%20under%20msbuild&In-Reply-To="
       TITLE="[Mono-dev] building for Mono under msbuild">awaddell at fnfr.com
       </A><BR>
    <I>Tue Oct 11 22:13:56 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="015317.html">[Mono-dev] building for Mono under msbuild
</A></li>
        <LI>Next message: <A HREF="015319.html">[Mono-dev] building for Mono under msbuild
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15318">[ date ]</a>
              <a href="thread.html#15318">[ thread ]</a>
              <a href="subject.html#15318">[ subject ]</a>
              <a href="author.html#15318">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Right, sorry.  If you right click on the References folder and then &quot;Add Reference&quot; you get a form with a Projects tab.  I guess these are all the projects in your solution.  If you add one of those, then a ProjectReference Item will get added to the project.  I think the way the MS targets get around to doing it is a bit more complicated, but I just made the assumption that the referenced project was generating a dll, and used the transform to get the path I would need.  It ends up being the same as the portion of the Csc.exe command line that I seen when I do the MS compile.

By the way I just did a little more work on my Mono.targets file to copy the ProjectRefernce'd dll's into the local output directory so if you're building an executable, you'll have all the stuff you need to run in one place (no need to set MONO_PATH).  I'll post if there is interest.

--andy

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Gustavo Guerra
Sent: Tuesday, October 11, 2005 6:51 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-dev] building for Mono under msbuild

My question was not about the transform, but about what the 
&quot;ProjectReference&quot; item is, as I've only seen the &quot;Reference&quot; item. I've 
searched in Microsoft.Common.Targest, and it seems to apply to VC??

Regards,
Gustavo Guerra


&quot;Andy Waddell&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">awaddell at fnfr.com</A>&gt; wrote in message 
news:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">619FD34741327C47AC7FBA8DBADBF5E04C2F5C at ffex01.fnfr.com...</A>
It's an MSBuild &quot;Transform&quot; that will resolve to a bunch of /reference 
arguments to gmcs.  Each one will correspond to a so-call &quot;ProjectReference&quot; 
which I assume is just the MS way of specifying assemblies not in the GAC. 
If your project doesn't have any project references, it will resolve to 
nothing.

--andy




From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> 
[mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Gustavo 
Guerra
Sent: Tuesday, October 11, 2005 4:56 PM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-dev] building for Mono under msbuild

Hi there:

Can you please explain this arguments of gmcs?:
@(ProjectReference-&gt;'/reference:%(RelativeDir)$(OutputPathMono)\%(Filename).dll
Best regards,
Gustavo Guerra
&quot;Andy Waddell&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">awaddell at fnfr.com</A>&gt; wrote in message 
news:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">619FD34741327C47AC7FBA8DBADBF5E04C2F2A at ffex01.fnfr.com...</A>
I have an application that needs to run under both .NET and Mono and I came 
up with a pretty simple way to get MS DevStudio to build both.  I don't know 
how others have solved this problem, but I thought I would offer it up in 
case it helps someone else with the same issue.  The basic approach I took 
was to call the Mono compiler after the Microsoft build has already run. 
Microsoft has a well known target &quot;AfterBuild&quot; which I have hooked to invoke 
gmcs with pretty much the same arguments that csc.exe takes with some minor 
modifications.  I put all the Mono build stuff in a file called 
Mono.targets, so it only take a one line addition to the standard *.csproj 
file to get the functionality:

  &lt;Import Project=&quot;$(MSBuildBinPath)\Microsoft.CSharp.targets&quot; /&gt;
Add this line&#224;  &lt;Import Project=&quot;&lt;your path&gt;\Mono.targets&quot; /&gt;

This will make your build essentially a dual pass build with all the 
Microsoft stuff running and then the Mono compiler running with all the 
warnings and erros showing up in the IDE as you would expect.  The work is 
not complete (I don't pass all the options possible, etc), but I think it's 
fairly obvious how to expand it if needed.

I'm sure there are many other ways to skin this cat, but for a quick and 
dirty solution, it seems to work pretty well.

ToDo: invesitgate xbuild to do my Linux builds.

--andy




_______________________________________________
Mono-devel-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>



_______________________________________________
Mono-devel-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A> 



_______________________________________________
Mono-devel-list mailing list
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015317.html">[Mono-dev] building for Mono under msbuild
</A></li>
	<LI>Next message: <A HREF="015319.html">[Mono-dev] building for Mono under msbuild
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15318">[ date ]</a>
              <a href="thread.html#15318">[ thread ]</a>
              <a href="subject.html#15318">[ subject ]</a>
              <a href="author.html#15318">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
