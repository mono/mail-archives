<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] (Nevermind) Asp.net thread abort issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%28Nevermind%29%20Asp.net%20thread%20abort%20issue&In-Reply-To=1128890881.2751.17.camel%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015269.html">
   <LINK REL="Next"  HREF="015253.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] (Nevermind) Asp.net thread abort issue</H1>
    <B>Joshua Tauberer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%28Nevermind%29%20Asp.net%20thread%20abort%20issue&In-Reply-To=1128890881.2751.17.camel%40localhost"
       TITLE="[Mono-dev] (Nevermind) Asp.net thread abort issue">tauberer at for.net
       </A><BR>
    <I>Mon Oct 10 10:27:48 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="015269.html">[Mono-dev] (Nevermind) Asp.net thread abort issue
</A></li>
        <LI>Next message: <A HREF="015253.html">[Mono-dev] [Fwd: [Mono-patches] r51466 -	trunk/mcs/class/System.XML/System.Xml.XPath]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15276">[ date ]</a>
              <a href="thread.html#15276">[ thread ]</a>
              <a href="subject.html#15276">[ subject ]</a>
              <a href="author.html#15276">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gonzalo Paniagua Javier wrote:
&gt;<i> On Sun, 2005-10-09 at 08:04 -0400, Joshua Tauberer wrote:
</I>&gt;&gt;<i> Gonzalo Paniagua Javier wrote:
</I>&gt;&gt;<i>   &gt; Anyway, if you ever decide to catch ThreadAbortException anywhere in the
</I>&gt;&gt;&gt;<i> asp.net pipeline, bear in mind that it's used also when the configured
</I>&gt;&gt;&gt;<i> timeout is reached.
</I>&gt;&gt;<i> The timeout for what?
</I>&gt;<i> 
</I>&gt;<i> For the maximum request processing time set in machine.config/web.config
</I>&gt;<i> (httpRuntime/executionTimeout).
</I>
Ahha.

&gt;&gt;<i> For instance, if you abort the thread within a method called by 
</I>&gt;&gt;<i> reflection, when Invoke() finishes the exception is a 
</I>&gt;&gt;<i> TargetInvocationException and not a ThreadAbortException, confusing my 
</I>&gt;&gt;<i> catch clauses higher up.
</I>&gt;<i> Yes, the behavior is right. However, a ThreadAbortException should be
</I>&gt;<i> rethrown after the finally clause, even when catched, if ResetAbort() is
</I>&gt;<i> not called.
</I>
The thing I was getting at is that you can't rely on catching 
ThreadAbortException to detect if Response.Redirect was called or if the 
processing has timed out -- the exception might be wrapped in another 
exception if the code executing at the time the exception was thrown was 
called with reflection.

All of the ThreadAbortException catches in HttpApplication, for 
instance, are potential problems.  Instead, you probably need to check
   (Thread.CurrentThread.ThreadState &amp; ThreadState.AbortRequested) != 0
in every catch block.

What has been particularly strange, though, is the ThreadAbortExceptions 
appears to be thrown later on again after the first exception burried 
inside another exception was caught and ignored (without ResetAbort 
being called).  I think this is something I experienced (but couldn't 
reproduce in a small exe), and looks to be what's happening in the 
recent mono-list post &quot;ASPX page randomly crashes.&quot;  (Well, maybe.)

Meanwhile, I found 1.1.8 RPMs on my box (I realized this morning that 
yum nicely keeps old RPMs hanging around a while) and went back to that, 
and my site is working smoothly again.  I think we need more advanced 
regression testing. :)  (That or my site was somehow relying on a bug 
that was fixed after 1.1.8.)  I don't know how I can help find the 
problems without taking my site down, though.

-- 
- Joshua Tauberer

<A HREF="http://taubz.for.net">http://taubz.for.net</A>

** Nothing Unreal Exists **



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015269.html">[Mono-dev] (Nevermind) Asp.net thread abort issue
</A></li>
	<LI>Next message: <A HREF="015253.html">[Mono-dev] [Fwd: [Mono-patches] r51466 -	trunk/mcs/class/System.XML/System.Xml.XPath]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15276">[ date ]</a>
              <a href="thread.html#15276">[ thread ]</a>
              <a href="subject.html#15276">[ subject ]</a>
              <a href="author.html#15276">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
