<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] GetFolderPath improvements
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20GetFolderPath%20improvements&In-Reply-To=1087344865.2902.20.camel%40164-99-120-44.boston.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006487.html">
   <LINK REL="Next"  HREF="006489.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] GetFolderPath improvements</H1>
    <B>Todd Berman</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20GetFolderPath%20improvements&In-Reply-To=1087344865.2902.20.camel%40164-99-120-44.boston.ximian.com"
       TITLE="[Mono-devel-list] [PATCH] GetFolderPath improvements">tberman at sevenl.net
       </A><BR>
    <I>Tue Jun 15 20:14:32 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006487.html">[Mono-devel-list] [PATCH] GetFolderPath improvements
</A></li>
        <LI>Next message: <A HREF="006489.html">[Mono-devel-list] [PATCH] GetFolderPath improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6488">[ date ]</a>
              <a href="thread.html#6488">[ thread ]</a>
              <a href="subject.html#6488">[ subject ]</a>
              <a href="author.html#6488">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So we are moving a chunk of code from corlib to the runtime to prevent a 
  switch in a method that is not used more than once or twice if even at 
all in an average program's lifecycle?

--Todd

Ben Maurer wrote:
&gt;<i> I should have explained this part, thank you for reminding me.
</I>&gt;<i> 
</I>&gt;<i> As I mentioned on IRC, this is so that we can use #ifdef to do specific
</I>&gt;<i> testing for platforms. IMHO, this is something that is cleaner if we can
</I>&gt;<i> use the autoconf information.
</I>&gt;<i> 
</I>&gt;<i> -- Ben
</I>&gt;<i> 
</I>&gt;<i> On Tue, 2004-06-15 at 19:56, Todd Berman wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>Why is this becoming an icall?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>--Todd
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Ben Maurer wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Hey guys,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>GetFolderPath was returning paths that are not really consistent with
</I>&gt;&gt;&gt;<i>the Linux background. The attached path will make us do the following
</I>&gt;&gt;&gt;<i>mappings:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Desktop
</I>&gt;&gt;&gt;<i>DesktopDirectory
</I>&gt;&gt;&gt;<i>        ~/Desktop -- Luis says that this is the default on all GNOME and
</I>&gt;&gt;&gt;<i>        KDE systems. That should pretty much cover us for Linux.
</I>&gt;&gt;&gt;<i>Personal
</I>&gt;&gt;&gt;<i>        ~ -- as before
</I>&gt;&gt;&gt;<i>ApplicationData
</I>&gt;&gt;&gt;<i>        The config directory as per fd.o's XDG spec. This defaults to
</I>&gt;&gt;&gt;<i>        ~/.config
</I>&gt;&gt;&gt;<i>LocalApplicationData
</I>&gt;&gt;&gt;<i>        The data folder per XDG. Defaults to ~/.local/share
</I>&gt;&gt;&gt;<i>CommonApplicationData
</I>&gt;&gt;&gt;<i>        /etc. Should this be /usr/share.
</I>&gt;&gt;&gt;<i>System
</I>&gt;&gt;&gt;<i>        /etc. Maybe /bin is more correct?
</I>&gt;&gt;&gt;<i>Program Files
</I>&gt;&gt;&gt;<i>	/usr/bin
</I>&gt;&gt;&gt;<i>CommonApplicationData
</I>&gt;&gt;&gt;<i>	/usr/share
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>All other folders return &quot;&quot;. Per the MSDN docs, if a folder has not been
</I>&gt;&gt;&gt;<i>created on the computer, the method should return String.Empty. Before
</I>&gt;&gt;&gt;<i>we would return a semi-related folder for things.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Another open issue is if we should probe for the existence of the folder
</I>&gt;&gt;&gt;<i>before returning it. In the windows code, it looks like we even try to
</I>&gt;&gt;&gt;<i>create the file before giving up. I would appreciate comments on this.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>-- Ben
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>------------------------------------------------------------------------
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Index: Environment.cs
</I>&gt;&gt;&gt;<i>===================================================================
</I>&gt;&gt;&gt;<i>RCS file: /cvs/public/mcs/class/corlib/System/Environment.cs,v
</I>&gt;&gt;&gt;<i>retrieving revision 1.76
</I>&gt;&gt;&gt;<i>diff -u -r1.76 Environment.cs
</I>&gt;&gt;&gt;<i>--- Environment.cs	11 Jun 2004 01:59:23 -0000	1.76
</I>&gt;&gt;&gt;<i>+++ Environment.cs	15 Jun 2004 22:41:06 -0000
</I>&gt;&gt;&gt;<i>@@ -90,6 +90,8 @@
</I>&gt;&gt;&gt;<i> 			MyPictures = 0x27,
</I>&gt;&gt;&gt;<i> 			CommonProgramFiles = 0x2b,
</I>&gt;&gt;&gt;<i> 		}
</I>&gt;&gt;&gt;<i>+		
</I>&gt;&gt;&gt;<i>+		const SpecialFolder MAX_SPECIAL_FOLDER = SpecialFolder.CommonProgramFiles;
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 		// TODO: Make sure the security attributes do what I expect
</I>&gt;&gt;&gt;<i> 			
</I>&gt;&gt;&gt;<i>@@ -367,96 +369,24 @@
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 		[MethodImplAttribute (MethodImplOptions.InternalCall)]
</I>&gt;&gt;&gt;<i>-		private extern static string GetWindowsFolderPath (int folder);
</I>&gt;&gt;&gt;<i>+		private extern static string GetFolderPathInternal (int folder);
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>+		static string [] get_folder_path_cache;
</I>&gt;&gt;&gt;<i> 		/// &lt;summary&gt;
</I>&gt;&gt;&gt;<i> 		/// Returns the fully qualified path of the
</I>&gt;&gt;&gt;<i> 		/// folder specified by the &quot;folder&quot; parameter
</I>&gt;&gt;&gt;<i> 		/// &lt;/summary&gt;
</I>&gt;&gt;&gt;<i> 		public static string GetFolderPath (SpecialFolder folder)
</I>&gt;&gt;&gt;<i> 		{
</I>&gt;&gt;&gt;<i>-			if ((int) Platform != 128)
</I>&gt;&gt;&gt;<i>-				return GetWindowsFolderPath ((int) folder);
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			// we can do this in managed code for non-Windows environments
</I>&gt;&gt;&gt;<i>-			string path = String.Empty;
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			string home = GetEnvironmentVariable (&quot;HOME&quot;);
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			// <A HREF="http://freedesktop.org/Standards/basedir-spec/basedir-spec-0.6.html">http://freedesktop.org/Standards/basedir-spec/basedir-spec-0.6.html</A>
</I>&gt;&gt;&gt;<i>-			string data = GetEnvironmentVariable (&quot;XDG_DATA_HOME&quot;);
</I>&gt;&gt;&gt;<i>-			if ((data == null) || (data == String.Empty)) {
</I>&gt;&gt;&gt;<i>-				data = Path.Combine (home, &quot;.local&quot;);
</I>&gt;&gt;&gt;<i>-				data = Path.Combine (data, &quot;share&quot;);
</I>&gt;&gt;&gt;<i>-			}
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			string config = GetEnvironmentVariable (&quot;XDG_CONFIG_HOME&quot;);
</I>&gt;&gt;&gt;<i>-			if ((config == null) || (config == String.Empty)) {
</I>&gt;&gt;&gt;<i>-				config = Path.Combine (home, &quot;.config&quot;);
</I>&gt;&gt;&gt;<i>-			}
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			string cache = GetEnvironmentVariable (&quot;XDG_CACHE_HOME&quot;);
</I>&gt;&gt;&gt;<i>-			if ((cache == null) || (cache == String.Empty)) {
</I>&gt;&gt;&gt;<i>-				cache = Path.Combine (home, &quot;.cache&quot;);
</I>&gt;&gt;&gt;<i>+			if (get_folder_path_cache != null) {
</I>&gt;&gt;&gt;<i>+				string s = get_folder_path_cache [(int) folder];
</I>&gt;&gt;&gt;<i>+				if (s != null)
</I>&gt;&gt;&gt;<i>+					return s;
</I>&gt;&gt;&gt;<i>+			} else {
</I>&gt;&gt;&gt;<i>+				get_folder_path_cache = new string [(int)MAX_SPECIAL_FOLDER + 1];
</I>&gt;&gt;&gt;<i> 			}
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			switch (folder) {
</I>&gt;&gt;&gt;<i>-#if NET_1_1
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.MyComputer: // MyComputer is a virtual directory
</I>&gt;&gt;&gt;<i>-				path = &quot;&quot;;
</I>&gt;&gt;&gt;<i>-				break;
</I>&gt;&gt;&gt;<i>-#endif				      
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Personal:
</I>&gt;&gt;&gt;<i>-				path = home;
</I>&gt;&gt;&gt;<i>-				break;
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			// data related
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.ApplicationData:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.LocalApplicationData:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.MyMusic:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.MyPictures:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Templates:
</I>&gt;&gt;&gt;<i>-				path = data;
</I>&gt;&gt;&gt;<i>-				break;
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			// configuration related
</I>&gt;&gt;&gt;<i>-#if NET_1_1
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Desktop:
</I>&gt;&gt;&gt;<i>-#endif
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.DesktopDirectory:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Favorites:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Programs:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.SendTo:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.StartMenu:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Startup:
</I>&gt;&gt;&gt;<i>-				path = config;
</I>&gt;&gt;&gt;<i>-				break;
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			// cache related (could disappear)
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Cookies:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.History:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.InternetCache:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.Recent:
</I>&gt;&gt;&gt;<i>-				path = cache;
</I>&gt;&gt;&gt;<i>-				break;
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			// programs
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.CommonProgramFiles:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.ProgramFiles:
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.System:
</I>&gt;&gt;&gt;<i>-				break;
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			// Directories shared by all users
</I>&gt;&gt;&gt;<i>-			case SpecialFolder.CommonApplicationData:
</I>&gt;&gt;&gt;<i>-				path = Path.GetDirectoryName (GetMachineConfigPath ());
</I>&gt;&gt;&gt;<i>-				break;
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			default:
</I>&gt;&gt;&gt;<i>-				throw new ArgumentException (&quot;Invalid SpecialFolder&quot;);
</I>&gt;&gt;&gt;<i>-                        }
</I>&gt;&gt;&gt;<i>-
</I>&gt;&gt;&gt;<i>-			return path;
</I>&gt;&gt;&gt;<i>+			
</I>&gt;&gt;&gt;<i>+			return get_folder_path_cache [(int) folder] = GetFolderPathInternal ((int) folder);
</I>&gt;&gt;&gt;<i>                 }
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 		public static string[] GetLogicalDrives ()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>------------------------------------------------------------------------
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>? t
</I>&gt;&gt;&gt;<i>Index: icall.c
</I>&gt;&gt;&gt;<i>===================================================================
</I>&gt;&gt;&gt;<i>RCS file: /cvs/public/mono/mono/metadata/icall.c,v
</I>&gt;&gt;&gt;<i>retrieving revision 1.498
</I>&gt;&gt;&gt;<i>diff -u -r1.498 icall.c
</I>&gt;&gt;&gt;<i>--- icall.c	12 Jun 2004 11:32:35 -0000	1.498
</I>&gt;&gt;&gt;<i>+++ icall.c	15 Jun 2004 22:39:30 -0000
</I>&gt;&gt;&gt;<i>@@ -4443,13 +4443,38 @@
</I>&gt;&gt;&gt;<i> 	return mono_string_new (mono_domain_get (), mono_assembly_getrootdir ());
</I>&gt;&gt;&gt;<i> }
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>+typedef enum {
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_DESKTOP = 0x00,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_MYCOMPUTER = 0x11,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_PROGRAMS = 0x02,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_PERSONAL = 0x05,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_FAVORITES = 0x06,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_STARTUP = 0x07,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_RECENT = 0x08,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_SENDTO = 0x09,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_STARTMENU = 0x0b,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_MYMUSIC = 0x0d,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_DESKTOPDIRECTORY = 0x10,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_TEMPLATES = 0x15,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_APPLICATIONDATA	= 0x1a,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_LOCALAPPLICATIONDATA = 0x1c,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_INTERNETCACHE = 0x20,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_COOKIES = 0x21,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_HISTORY = 0x22,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_COMMONAPPLICATIONDATA	= 0x23,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_SYSTEM = 0x25,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_PROGRAMFILES = 0x26,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_MYPICTURES = 0x27,
</I>&gt;&gt;&gt;<i>+	MONO_FOLDER_PATH_COMMONPROGRAMFILES = 0x2b
</I>&gt;&gt;&gt;<i>+} MonoFolderPathEnum;
</I>&gt;&gt;&gt;<i>+
</I>&gt;&gt;&gt;<i> static MonoString*
</I>&gt;&gt;&gt;<i>-ves_icall_System_Environment_GetWindowsFolderPath (int folder)
</I>&gt;&gt;&gt;<i>+ves_icall_System_Environment_GetFolderPathInternal (int folder)
</I>&gt;&gt;&gt;<i> {
</I>&gt;&gt;&gt;<i>-#if defined (PLATFORM_WIN32)
</I>&gt;&gt;&gt;<i>-	#ifndef CSIDL_FLAG_CREATE
</I>&gt;&gt;&gt;<i>-		#define CSIDL_FLAG_CREATE	0x8000
</I>&gt;&gt;&gt;<i>-	#endif
</I>&gt;&gt;&gt;<i>+#ifdef PLATFORM_WIN32
</I>&gt;&gt;&gt;<i>+#	ifndef CSIDL_FLAG_CREATE
</I>&gt;&gt;&gt;<i>+#		define CSIDL_FLAG_CREATE	0x8000
</I>&gt;&gt;&gt;<i>+#	endif
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 	WCHAR path [MAX_PATH];
</I>&gt;&gt;&gt;<i> 	/* Create directory if no existing */
</I>&gt;&gt;&gt;<i>@@ -4460,7 +4485,81 @@
</I>&gt;&gt;&gt;<i> 		return mono_string_new_utf16 (mono_domain_get (), path, len);
</I>&gt;&gt;&gt;<i> 	}
</I>&gt;&gt;&gt;<i> #else
</I>&gt;&gt;&gt;<i>-	g_warning (&quot;ves_icall_System_Environment_GetWindowsFolderPath should only be called on Windows!&quot;);
</I>&gt;&gt;&gt;<i>+	char* path;
</I>&gt;&gt;&gt;<i>+	MonoString* ret;
</I>&gt;&gt;&gt;<i>+	switch (folder) {
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_DESKTOP:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_DESKTOPDIRECTORY:
</I>&gt;&gt;&gt;<i>+		path = g_strconcat (g_get_home_dir (), &quot;/Desktop&quot;, NULL);
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), path);
</I>&gt;&gt;&gt;<i>+		g_free (path);
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_MYCOMPUTER:
</I>&gt;&gt;&gt;<i>+		/* this is a virtual folder, we return &quot;&quot; as does MS */
</I>&gt;&gt;&gt;<i>+		ret = NULL;
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_PERSONAL:
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), g_get_home_dir ());
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_PROGRAMS:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_FAVORITES:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_STARTUP:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_RECENT:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_SENDTO:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_STARTMENU:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_MYMUSIC:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_INTERNETCACHE:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_COOKIES:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_HISTORY:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_TEMPLATES:
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_MYPICTURES:
</I>&gt;&gt;&gt;<i>+		/* all of these either a) dont exist on linux, or b) are not
</I>&gt;&gt;&gt;<i>+		 * standard enough to be worth giving here
</I>&gt;&gt;&gt;<i>+		 */
</I>&gt;&gt;&gt;<i>+		ret = NULL;
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_APPLICATIONDATA:
</I>&gt;&gt;&gt;<i>+		/* use FDO's CONFIG_HOME. This data will be synced across a
</I>&gt;&gt;&gt;<i>+		 * network like the windows counterpart.
</I>&gt;&gt;&gt;<i>+		 */
</I>&gt;&gt;&gt;<i>+		 
</I>&gt;&gt;&gt;<i>+		path = g_getenv (&quot;XDG_CONFIG_HOME&quot;);
</I>&gt;&gt;&gt;<i>+		if (!path)
</I>&gt;&gt;&gt;<i>+			path = g_strconcat (g_get_home_dir (), &quot;/.config&quot;, NULL);
</I>&gt;&gt;&gt;<i>+		
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), path);
</I>&gt;&gt;&gt;<i>+		g_free (path);
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_LOCALAPPLICATIONDATA:
</I>&gt;&gt;&gt;<i>+		/* use FDO's DATA_HOME. This is *NOT* synced. */
</I>&gt;&gt;&gt;<i>+		 
</I>&gt;&gt;&gt;<i>+		path = g_getenv (&quot;XDG_DATA_HOME&quot;);
</I>&gt;&gt;&gt;<i>+		if (!path)
</I>&gt;&gt;&gt;<i>+			path = g_strconcat (g_get_home_dir (), &quot;/.local/share&quot;, NULL);
</I>&gt;&gt;&gt;<i>+		
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), path);
</I>&gt;&gt;&gt;<i>+		g_free (path);
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_COMMONAPPLICATIONDATA:
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), &quot;/etc&quot;);
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_SYSTEM:
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), &quot;/etc&quot;);
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_PROGRAMFILES:
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), &quot;/usr/bin&quot;);
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	case MONO_FOLDER_PATH_COMMONPROGRAMFILES:
</I>&gt;&gt;&gt;<i>+		ret = mono_string_new (mono_domain_get (), &quot;/usr/share&quot;);
</I>&gt;&gt;&gt;<i>+		break;
</I>&gt;&gt;&gt;<i>+	default:
</I>&gt;&gt;&gt;<i>+		g_assert_not_reached ();
</I>&gt;&gt;&gt;<i>+	}
</I>&gt;&gt;&gt;<i>+	
</I>&gt;&gt;&gt;<i>+	/* should we test that the file exists? */
</I>&gt;&gt;&gt;<i>+	if (ret)
</I>&gt;&gt;&gt;<i>+		return ret;
</I>&gt;&gt;&gt;<i> #endif
</I>&gt;&gt;&gt;<i> 	return mono_string_new (mono_domain_get (), &quot;&quot;);
</I>&gt;&gt;&gt;<i> }
</I>&gt;&gt;&gt;<i>@@ -5128,10 +5227,10 @@
</I>&gt;&gt;&gt;<i> 	{&quot;GetCommandLineArgs&quot;, mono_runtime_get_main_args},
</I>&gt;&gt;&gt;<i> 	{&quot;GetEnvironmentVariable&quot;, ves_icall_System_Environment_GetEnvironmentVariable},
</I>&gt;&gt;&gt;<i> 	{&quot;GetEnvironmentVariableNames&quot;, ves_icall_System_Environment_GetEnvironmentVariableNames},
</I>&gt;&gt;&gt;<i>+	{&quot;GetFolderPathInternal&quot;, ves_icall_System_Environment_GetFolderPathInternal},
</I>&gt;&gt;&gt;<i> 	{&quot;GetLogicalDrivesInternal&quot;, ves_icall_System_Environment_GetLogicalDrives },
</I>&gt;&gt;&gt;<i>  	{&quot;GetMachineConfigPath&quot;, ves_icall_System_Configuration_DefaultConfig_get_machine_config_path},
</I>&gt;&gt;&gt;<i>  	{&quot;GetOSVersionString&quot;, ves_icall_System_Environment_GetOSVersionString},
</I>&gt;&gt;&gt;<i>-	{&quot;GetWindowsFolderPath&quot;, ves_icall_System_Environment_GetWindowsFolderPath},
</I>&gt;&gt;&gt;<i> 	{&quot;get_ExitCode&quot;, mono_environment_exitcode_get},
</I>&gt;&gt;&gt;<i> 	{&quot;get_HasShutdownStarted&quot;, ves_icall_System_Environment_get_HasShutdownStarted},
</I>&gt;&gt;&gt;<i> 	{&quot;get_MachineName&quot;, ves_icall_System_Environment_get_MachineName},
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006487.html">[Mono-devel-list] [PATCH] GetFolderPath improvements
</A></li>
	<LI>Next message: <A HREF="006489.html">[Mono-devel-list] [PATCH] GetFolderPath improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6488">[ date ]</a>
              <a href="thread.html#6488">[ thread ]</a>
              <a href="subject.html#6488">[ subject ]</a>
              <a href="author.html#6488">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
