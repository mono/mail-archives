<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Mono strings 10x slower than .NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Mono%20strings%2010x%20slower%20than%20.NET&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006377.html">
   <LINK REL="Next"  HREF="006245.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Mono strings 10x slower than .NET</H1>
    <B>William Garrison</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Mono%20strings%2010x%20slower%20than%20.NET&In-Reply-To="
       TITLE="[Mono-devel-list] Mono strings 10x slower than .NET">monodevlist at mobydisk.com
       </A><BR>
    <I>Sat Jun  5 11:24:24 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006377.html">[Mono-devel-list] Mono and windows
</A></li>
        <LI>Next message: <A HREF="006245.html">[Mono-devel-list] Mono strings 10x slower than .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6234">[ date ]</a>
              <a href="thread.html#6234">[ thread ]</a>
              <a href="subject.html#6234">[ subject ]</a>
              <a href="author.html#6234">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I just compiled my first application in Mono.  It's a code highlighter &amp; 
diff tool.  It runs great under Mono, except that it runs 10 times 
slower than under .NET!  .NET runs my standard test case in 2-3 seconds, 
while Mono takes 19-23 seconds.  The times are the same on both Windows 
and Linux (RH9) and with the EXE file compiled under both .NET and Mono.

I used the --profile option, and the problem appears to be 
System.String::Compare.  My code is unoptimized, and does LOTS of string 
compares.  When profiling, the code took 32 seconds to run, with 24 
seconds being the string compares.

I know that I could optimize the code to do fewer string compares and to 
use hashes.  Currently I do O(N^2) compares to perform the diff.  But 
since the performance difference between Mono and .NET is so huge, I 
think time would be better spent in notifying the developers of the 
disparity and seeing what can be done to fix it.

After all that, I want to know:
1) What is the current status of string performance under Mono?
2) What can I give someone to help demonstrate or track down the problem?

Below is the relevant portion of the profiling output.

Total time spent compiling 787 methods (sec): 0.22
Slowest method to compile (sec): 0.01: System.IntPtr::.ctor(int)
Time(ms) Count   P/call(ms) Method name
########################
  31486.000       1  31486.000 
System.Object::runtime_invoke_void_string[](object,intptr,intptr,intptr)
   Callers (with count) that contribute at least for 1%:
########################
  31486.000       1  31486.000 
MobyDisk.CodeReview.CodeReview::Main(string[])
   Callers (with count) that contribute at least for 1%:
            1  100 % 
System.Object::runtime_invoke_void_string[](object,intptr,intptr,intptr)
########################
  31476.000       1  31476.000 
MobyDisk.CodeReview.CodeReview::DoStuff(string[])
   Callers (with count) that contribute at least for 1%:
            1  100 % MobyDisk.CodeReview.CodeReview::Main(string[])
########################
  24485.000       1  24485.000 
MobyDisk.CodeReview.Difference::ApplyDifference()
   Callers (with count) that contribute at least for 1%:
            1  100 % MobyDisk.CodeReview.CodeReview::DoStuff(string[])
########################
  20899.000 2117344    0.010 
MobyDisk.CodeReview.Difference::stringMatch(string,string)
   Callers (with count) that contribute at least for 1%:
      2117344  100 % MobyDisk.CodeReview.Difference::ApplyDifference()
########################
  20108.000 2117382    0.009   System.String::Compare(string,string,bool)
   Callers (with count) that contribute at least for 1%:
      2117344  99 % 
MobyDisk.CodeReview.Difference::stringMatch(string,string)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006377.html">[Mono-devel-list] Mono and windows
</A></li>
	<LI>Next message: <A HREF="006245.html">[Mono-devel-list] Mono strings 10x slower than .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6234">[ date ]</a>
              <a href="thread.html#6234">[ thread ]</a>
              <a href="subject.html#6234">[ subject ]</a>
              <a href="author.html#6234">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
