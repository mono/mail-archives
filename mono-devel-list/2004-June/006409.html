<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: [PATCH] Improper free of return-value string pointers from unmanagedcalls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BPATCH%5D%20Improper%20free%20of%20return-value%20string%20pointers%20from%20unmanagedcalls&In-Reply-To=572D2FC4793D8C4BA6BC37E65EED384E1753FE%40MKServer01.monkey.monkey.tv">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006407.html">
   <LINK REL="Next"  HREF="006411.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: [PATCH] Improper free of return-value string pointers from unmanagedcalls</H1>
    <B>Steven Brown</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BPATCH%5D%20Improper%20free%20of%20return-value%20string%20pointers%20from%20unmanagedcalls&In-Reply-To=572D2FC4793D8C4BA6BC37E65EED384E1753FE%40MKServer01.monkey.monkey.tv"
       TITLE="[Mono-devel-list] Re: [PATCH] Improper free of return-value string pointers from unmanagedcalls">swbrown at ucsd.edu
       </A><BR>
    <I>Fri Jun 11 03:51:08 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006407.html">[Mono-devel-list] RE: [PATCH] Improper free of return-value string pointers from unmanagedcalls
</A></li>
        <LI>Next message: <A HREF="006411.html">[Mono-devel-list] EnumBuilder patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6409">[ date ]</a>
              <a href="thread.html#6409">[ thread ]</a>
              <a href="subject.html#6409">[ subject ]</a>
              <a href="author.html#6409">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Chris Day wrote:
&gt;<i> In this case ([1]) yes it is an out parameter, however the sentiment is
</I>&gt;<i> still the same.
</I>
It's not the same.  'void foo(out string)' is the conceptual equivilant 
of 'string foo(void)'.  The MSDN guy (quite correctly) is saying to 
avoid 'void foo(string)' when the string is to be treated as mutable - a 
different issue entirely.

What's at issue is if the marshaller when returning from an unmanaged 
'string foo(void)' (really, 'void foo(out string)' as well) should call 
the C library's free() on the underlying 'char *'.  Microsoft's .NET 
implementation doesn't, but Marcus has pointed to a MSDN page that says 
it does.  I'd say it's a documentation bug, as it doesn't make sense for 
the marshaller to do this.  What if the string was in .rodata, on the 
stack, a COM object, or from a different allocator?  There's a lot of 
code like that (e.g., strerror).  Freeing would only work in a few 
cases, leaving folks to use IntPtr + PtrToString.. for the rest.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006407.html">[Mono-devel-list] RE: [PATCH] Improper free of return-value string pointers from unmanagedcalls
</A></li>
	<LI>Next message: <A HREF="006411.html">[Mono-devel-list] EnumBuilder patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6409">[ date ]</a>
              <a href="thread.html#6409">[ thread ]</a>
              <a href="subject.html#6409">[ subject ]</a>
              <a href="author.html#6409">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
