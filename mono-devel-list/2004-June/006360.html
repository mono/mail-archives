<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: [Mono-patches] mcs/class/System.Web/System.Web ChangeLog,1.210,1.211 HttpContext.cs,1.26,1.27
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BMono-patches%5D%20mcs/class/System.Web/System.Web%20ChangeLog%2C1.210%2C1.211%20HttpContext.cs%2C1.26%2C1.27&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006387.html">
   <LINK REL="Next"  HREF="006361.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: [Mono-patches] mcs/class/System.Web/System.Web ChangeLog,1.210,1.211 HttpContext.cs,1.26,1.27</H1>
    <B>Torstensson, Patrik</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BMono-patches%5D%20mcs/class/System.Web/System.Web%20ChangeLog%2C1.210%2C1.211%20HttpContext.cs%2C1.26%2C1.27&In-Reply-To="
       TITLE="[Mono-devel-list] Re: [Mono-patches] mcs/class/System.Web/System.Web ChangeLog,1.210,1.211 HttpContext.cs,1.26,1.27">patrik.torstensson at intel.com
       </A><BR>
    <I>Wed Jun  9 18:58:49 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006387.html">[Mono-devel-list] GC Warning: Insufficient space for /proc read - error on sparc So laris9 build
</A></li>
        <LI>Next message: <A HREF="006361.html">[Mono-devel-list] macosx beta2 binary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6360">[ date ]</a>
              <a href="thread.html#6360">[ thread ]</a>
              <a href="subject.html#6360">[ subject ]</a>
              <a href="author.html#6360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Time to help.. ;-)

MS does NOT set the principal when calling Context.User = Principal but it does when executing a new step in the execution pipeline in HttpApplication. So, setting the principal in an event changes the principal after the event is executed but before the page is executed.

This would be easy to fix in our implementation, we just need to track the principal in the state machine (same as culture info). Make sure that we set the principal from context.user when entering a thread  (saving current) and restore when leaving (to the saved).

Cheers,
 Patrik Torstensson 

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A> 
</I>&gt;<i> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>] On Behalf Of 
</I>&gt;<i> S&#233;bastien Pouliot
</I>&gt;<i> Sent: den 9 juni 2004 23:11
</I>&gt;<i> To: Mono Development
</I>&gt;<i> Subject: RE: [Mono-devel-list] Re: [Mono-patches] 
</I>&gt;<i> mcs/class/System.Web/System.Web ChangeLog,1.210,1.211 
</I>&gt;<i> HttpContext.cs,1.26,1.27
</I>&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I think this issue is a little more complex. See #59683 for 
</I>&gt;<i> another sample.
</I>&gt;<i> The authentication section of the web.config file may change 
</I>&gt;<i> the behaviour of the property (which would explain the 
</I>&gt;<i> different results).
</I>&gt;<i> 
</I>&gt;<i> Sebastien Pouliot
</I>&gt;<i> <A HREF="http://pages.infinit.net/ctech/poupou.html">http://pages.infinit.net/ctech/poupou.html</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>]On Behalf Of 
</I>&gt;<i> Gonzalo Paniagua Javier
</I>&gt;<i> Sent: 9 juin 2004 16:16
</I>&gt;<i> To: Pedro Martinez; Mono Development
</I>&gt;<i> Subject: [Mono-devel-list] Re: [Mono-patches] 
</I>&gt;<i> mcs/class/System.Web/System.Web ChangeLog,1.210,1.211
</I>&gt;<i> HttpContext.cs,1.26,1.27
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> El mi&#233;, 09-06-2004 a las 15:27, Pedro Martinez  escribi&#243;:
</I>&gt;<i> &gt; Update of /cvs/public/mcs/class/System.Web/System.Web
</I>&gt;<i> &gt; In directory mono-cvs.ximian.com:/tmp/cvs-serv30119
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Modified Files:
</I>&gt;<i> &gt; 	ChangeLog HttpContext.cs
</I>&gt;<i> &gt; Log Message:
</I>&gt;<i> &gt; 2004-06-09  Pedro Mart&#237;nez Juli&#225;  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">yoros at wanadoo.es</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     * HttpContext: User property returns its own &quot;user&quot; 
</I>&gt;<i> value because
</I>&gt;<i> &gt;     the context can walk through different Threads. When 
</I>&gt;<i> &quot;User&quot; property
</I>&gt;<i> &gt;     is changed, change &quot;Thread.CurrentPrincipal&quot; too.
</I>&gt;<i> 
</I>&gt;<i> This patch is wrong. Changing Context.User does not affect 
</I>&gt;<i> the Thread.CurrentPrincipal, as you can see in the attached 
</I>&gt;<i> simple test case. I've reverted it.
</I>&gt;<i> 
</I>&gt;<i> -Gonzalo
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006387.html">[Mono-devel-list] GC Warning: Insufficient space for /proc read - error on sparc So laris9 build
</A></li>
	<LI>Next message: <A HREF="006361.html">[Mono-devel-list] macosx beta2 binary
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6360">[ date ]</a>
              <a href="thread.html#6360">[ thread ]</a>
              <a href="subject.html#6360">[ subject ]</a>
              <a href="author.html#6360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
