<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: [PATCH] Improper free of return-value	string pointers from unmanaged calls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BPATCH%5D%20Improper%20free%20of%20return-value%09string%0A%20pointers%20from%20unmanaged%20calls&In-Reply-To=1086951492.7762.34.camel%40melchior">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006414.html">
   <LINK REL="Next"  HREF="006402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: [PATCH] Improper free of return-value	string pointers from unmanaged calls</H1>
    <B>Steven Brown</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BPATCH%5D%20Improper%20free%20of%20return-value%09string%0A%20pointers%20from%20unmanaged%20calls&In-Reply-To=1086951492.7762.34.camel%40melchior"
       TITLE="[Mono-devel-list] Re: [PATCH] Improper free of return-value	string pointers from unmanaged calls">swbrown at ucsd.edu
       </A><BR>
    <I>Fri Jun 11 20:55:24 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006414.html">[Mono-devel-list] Re: [PATCH] Improper free of return-value	string pointers from unmanaged calls
</A></li>
        <LI>Next message: <A HREF="006402.html">[Mono-devel-list] mono-debugger 0.8 on redhat linux 9.0 - config.log - failed build
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6423">[ date ]</a>
              <a href="thread.html#6423">[ thread ]</a>
              <a href="subject.html#6423">[ subject ]</a>
              <a href="author.html#6423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jonathan Pryor wrote:

&gt;<i> On Fri, 2004-06-11 at 01:32, Steven Brown wrote:
</I>[...]
&gt;&gt;<i>MEMEAT_API char *foo(void)
</I>&gt;&gt;<i>{
</I>&gt;&gt;<i>	static char *str = &quot;Hello there&quot;;
</I>&gt;&gt;<i>	static int i = 0;
</I>&gt;&gt;<i>	char *newstr = (char *) malloc(strlen(str) + 1);
</I>&gt;&gt;<i>	strcpy(newstr, str);
</I>&gt;&gt;<i>	printf(&quot;%i: %s\n&quot;, i++, newstr);
</I>&gt;&gt;<i>	return newstr;
</I>&gt;&gt;<i>}
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> This code is wrong for .NET anyway.  Malloc/free isn't used under .NET;
</I>&gt;<i> CoTaskMemAlloc()/CoTaskMemFree() is.
</I>
And there's my error.  I had been using malloc/strdup/etc. to test if it 
leaked.  I was sure I also tried CoTaskMemAlloc last night, but I must 
have screwed that test up.  It seems CoTaskMemFree as used by the 
marshaller hadn't been causing any apparent badness or errors when 
called on addresses not allocated by CoTaskMemAlloc which is why the 
existing code I've been trying to get running on Mono had been working 
seemingly flawlessly for years on Microsoft's .NET.  I'll correct it to 
use IntPtr.

I apologize for the snipe hunt.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006414.html">[Mono-devel-list] Re: [PATCH] Improper free of return-value	string pointers from unmanaged calls
</A></li>
	<LI>Next message: <A HREF="006402.html">[Mono-devel-list] mono-debugger 0.8 on redhat linux 9.0 - config.log - failed build
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6423">[ date ]</a>
              <a href="thread.html#6423">[ thread ]</a>
              <a href="subject.html#6423">[ subject ]</a>
              <a href="author.html#6423">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
