<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Generic Variance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Generic%20Variance&In-Reply-To=0016e64b9d08480c090461efe4dc%40google.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030761.html">
   <LINK REL="Next"  HREF="030763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Generic Variance</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Generic%20Variance&In-Reply-To=0016e64b9d08480c090461efe4dc%40google.com"
       TITLE="[Mono-dev] Generic Variance">kumpera at gmail.com
       </A><BR>
    <I>Mon Feb  2 09:13:08 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="030761.html">[Mono-dev] Generic Variance
</A></li>
        <LI>Next message: <A HREF="030763.html">[Mono-dev] Generic Variance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30762">[ date ]</a>
              <a href="thread.html#30762">[ thread ]</a>
              <a href="subject.html#30762">[ subject ]</a>
              <a href="author.html#30762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 2, 2009 at 11:54 AM, &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lunchtimemama at gmail.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> &gt; 2)mono_class_is_assignable_from
</I>&gt;<i> &gt; Don't do unneeded changes to existing conditions that just make your
</I>&gt;<i> patch harder to read. By merging the two conditions your
</I>&gt;<i> &gt; patch got huge for no reason at all. Please revert this change so the
</I>&gt;<i> patch is smaller.
</I>&gt;<i>
</I>&gt;<i> The chunk of code was extracted into the mono_class_is_variant_of method
</I>&gt;<i> because it is also needed in mono_class_interface_offset. Duplicating the
</I>&gt;<i> code in both places would just cause problems in the long-run.
</I>&gt;<i>
</I>
Makes sense. Keep it that way then.



&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 3)mono_class_interface_offset
</I>&gt;<i> &gt; This function is used to define layout of classes, vtables and the such.
</I>&gt;<i> You patch lacks neither a proper Changelog notice on why this change is
</I>&gt;<i> needed or tests that evidence it.
</I>&gt;<i>
</I>&gt;<i> Tests are a bit of a chicken-and-egg problem. They can't be written in C#
</I>&gt;<i> until it has variance support (there is a patch for that on the list which
</I>&gt;<i> Marek is handling), and the C# patch has tests which require these VM
</I>&gt;<i> changes. I _could_ write a test in IL, but that would take me a while. The
</I>&gt;<i> changes to mono_class_interface_offset look for a legal variant of the
</I>&gt;<i> supplied interface if nothing was found with the binary search. How specific
</I>&gt;<i> do you want me to be in the ChangeLog?
</I>&gt;<i>
</I>&gt;<i>
</I>Why this change is required to make variance works?
mono_class_interface_offset is a low level function used mainly to setup
vtable layout.

This change affects vtable layout code, remoting and reflection. Without
proper testing to make sure it doesn't break stuff and is compatible with MS
this patch is a no go.

The chicken and egg situation for testing can be overcome by either using IL
just for the interfaces, the rest can be done with C#; or you can use
System.Reflection.Emit to build types with variance.


Cheers,
Rodrigo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090202/29a0f890/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090202/29a0f890/attachment.html</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030761.html">[Mono-dev] Generic Variance
</A></li>
	<LI>Next message: <A HREF="030763.html">[Mono-dev] Generic Variance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30762">[ date ]</a>
              <a href="thread.html#30762">[ thread ]</a>
              <a href="subject.html#30762">[ subject ]</a>
              <a href="author.html#30762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
