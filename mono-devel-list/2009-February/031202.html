<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] misc: C# request info
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20misc%3A%20C%23%20request%20info&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031200.html">
   <LINK REL="Next"  HREF="031168.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] misc: C# request info</H1>
    <B>BGB</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20misc%3A%20C%23%20request%20info&In-Reply-To="
       TITLE="[Mono-dev] misc: C# request info">cr88192 at hotmail.com
       </A><BR>
    <I>Tue Feb 24 17:36:59 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031200.html">[Mono-dev] misc: C# request info
</A></li>
        <LI>Next message: <A HREF="031168.html">[Mono-dev]  Making your own programming language for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31202">[ date ]</a>
              <a href="thread.html#31202">[ thread ]</a>
              <a href="subject.html#31202">[ subject ]</a>
              <a href="author.html#31202">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
----- Original Message ----- 
From: &quot;Jonathan Pryor&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>&gt;
To: &quot;BGB&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">cr88192 at hotmail.com</A>&gt;
Cc: &quot;Marek Safar&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">marek.safar at seznam.cz</A>&gt;; 
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Wednesday, February 25, 2009 3:22 AM
Subject: Re: [Mono-dev] misc: C# request info


&gt;<i> On Tue, 2009-02-24 at 20:46 +1000, BGB wrote:
</I>&gt;&gt;<i> &gt; C# has some tricky syntax too, some tokens change behaviour of 
</I>&gt;&gt;<i> &gt; following
</I>&gt;&gt;<i> &gt; block. Some are just tricky to parse like generics, nullables, lambdas,
</I>&gt;&gt;<i> &gt; etc.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Here is one example
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Foo (x &lt;y, z&gt; (0));
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> AFAIK the above can't be a generic since a generic can't appear in this
</I>&gt;&gt;<i> context (I will assume this being an expression...).
</I>&gt;<i>
</I>&gt;<i> Behold the proof that it works:
</I>&gt;<i>
</I>&gt;<i> public static bool x&lt;T1, T2&gt;(int n) {return n != 0;}
</I>&gt;<i>
</I>&gt;<i> If you have types y and z in scope, and a method Foo(bool), then the
</I>&gt;<i> call Foo(x&lt;y,z&gt;(0)) is in fact, valid, calling the method Foo() with the
</I>&gt;<i> result of the generic method call x&lt;y,z&gt;(0).
</I>&gt;<i>
</I>&gt;&gt;<i> (funcall Foo (&lt; x y) (&gt; z 0))
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> unless generics can appear in a expression context, which AFAIK they 
</I>&gt;&gt;<i> can't.
</I>&gt;<i>
</I>&gt;<i> In fact, they can, as demonstrated above.  Don't forget about generic
</I>&gt;<i> methods. :-)
</I>&gt;<i>
</I>
hmm... yes...


well, this adds to the complexity a little...

now that I remember, the disambiguation rule given in this case was that the 
'&gt;' '(' sequence was used to detect this case, otherwise it is assumed to be 
an expression.

however, this still follows under the try-and-fail approach, only that in 
this case it first has to try matching a generic, and fail if it doesn't 
meet the criteria...


actually, all of this has led to a special case:
I have a modified token function which fails to parse '&gt;&gt;' or '&gt;&gt;=', or '&gt;=' 
as a single token, but will instead parse the '&gt;' as a brace and leave the 
rest for later.

but, yes, generics pose a difficulty (which continues leaving me wondering 
why the C++ people originally decided on using this syntax to begin 
with...). for example, couldn't they just as easily have use '{' and '}' for 
templates and have avoided this whole mess?...

&quot;Foo{T};&quot; or even custom braces &quot;Foo&lt;{T}&gt;&quot;, rather then create the syntactic 
mess that this notation has caused?...

but, then again, this is the C family, historically known for its adherence 
to difficult to parse syntax...
(unlike the LISP family which has very simple syntax which most people would 
not want to use, and where using tricks to extend the number of brace types 
is common-place...).


oh well, at least I have more ideas for exception handling.
I had the idea that I can actually make a generic C-based API (making the 
handling C-usable), and probably internally use a potentially optimized form 
of this interface.

tehState state; //exception handling state
state=tehBegin();
if(tehTryP(state))
{
    ...
}else if(tehCatchP(state, &quot;Foo&quot;))
{
    //specific exception class
}else if(tehCatchP(state, NULL))
{
    //generic unhandled exception
}else if(tehUnwindP(state))
{
    //cleanup/finally
}else
{
    //unknown state
}
//finally
tehEnd(state);

now, this is not the lowest-possible-overhead route, but it is probably not 
like large amounts of time will be going into tight-loop exception handling 
either...


still unsure how to best represent exception handling in RPNIL (my 
compiler's native IL).

I am currently thinking:
begin_try
try_p $L0 jmp_true
$Foo catch_p $L1 jmp_true
unwind_p $L2 jmp_true
$RuntimeError throw
L0: &lt;try...&gt; $L3 jmp
L1: &lt;handler...&gt; $L3 jmp
L2: &lt;finally...&gt; rethrow
L3: &lt;finally...&gt;
end_try

actually, it may seem odd, but I use a vaguely similar construction to 
represent something analogous to the phi operator (allowing multiple-path 
stack item merging). note that the stack used here is not the machine stack, 
and typically also pushes literals, registers, symbols, blocks, ... onto the 
stack as well (and likewise, code which will conditionally modify the stack 
is not allowed).

&quot;%cond $L0 jmp_true exch L0:&quot; is an error condition...


for the time being I will ignore generics at this level...

&gt;<i> - Jon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031200.html">[Mono-dev] misc: C# request info
</A></li>
	<LI>Next message: <A HREF="031168.html">[Mono-dev]  Making your own programming language for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31202">[ date ]</a>
              <a href="thread.html#31202">[ thread ]</a>
              <a href="subject.html#31202">[ subject ]</a>
              <a href="author.html#31202">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
