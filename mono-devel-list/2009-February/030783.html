<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] HttpWebResponse ConnectStream blocks on empty stream
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20HttpWebResponse%20ConnectStream%20blocks%20on%20empty%20stream&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030780.html">
   <LINK REL="Next"  HREF="030799.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] HttpWebResponse ConnectStream blocks on empty stream</H1>
    <B>Arne Claassen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20HttpWebResponse%20ConnectStream%20blocks%20on%20empty%20stream&In-Reply-To="
       TITLE="[Mono-dev] HttpWebResponse ConnectStream blocks on empty stream">arnec at mindtouch.com
       </A><BR>
    <I>Tue Feb  3 12:29:13 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="030780.html">[Mono-dev] high precision real &amp; cpu time in MONO (on linux)
</A></li>
        <LI>Next message: <A HREF="030799.html">[Mono-dev] HttpWebResponse ConnectStream blocks on empty stream
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30783">[ date ]</a>
              <a href="thread.html#30783">[ thread ]</a>
              <a href="subject.html#30783">[ subject ]</a>
              <a href="author.html#30783">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been having a problem with HttpWebResponse locking up on  
GetResponseSream and BeingGetResponseStream never returning on  
responses that have no content-length header and no content. On .NET  
this will return immediately, but on mono (1.9.1, 2.0.1 and 2.02) the  
read will block only to be killed if the request itself has a timeout.  
A simple repro is to his a site, get it's Etag/LastModified and hit it  
again for the 304 response which should have no content. However  
getting that response stream still shouldn't lock up.

I couldn't find a bug on this yet, but wanted to check here before  
filing.

Repro -----------------------------------------------------
using System;
using System.IO;
using System.Net;

namespace BugRepro {
     class Program {
         const string URL = &quot;<A HREF="http://blog.developer.mindtouch.com/feed/&quot;;">http://blog.developer.mindtouch.com/feed/&quot;;</A>

         static void Main(string[] args) {
             // first request (which should be 200)
             HttpWebRequest request = WebRequest.Create(URL) as  
HttpWebRequest;
             request.Method = &quot;GET&quot;;
             HttpWebResponse response =  
(HttpWebResponse)request.GetResponse();
             Console.WriteLine(&quot;response: {0}&quot;, response.StatusCode);
             Stream stream = response.GetResponseStream();
             byte[] buffer = new byte[4096];
             int read = stream.Read(buffer, 0, buffer.Length);
             Console.WriteLine(&quot;{0} bytes read&quot;, read);
             stream.Close();

             // second request which should be 304)
             request = WebRequest.Create(URL) as HttpWebRequest;
             request.Method = &quot;GET&quot;;
             request.Headers.Add(HttpRequestHeader.IfNoneMatch,  
response.Headers[HttpResponseHeader.ETag]);
             request.IfModifiedSince = response.LastModified;
             response.Close();
             try {
                 response = (HttpWebResponse)request.GetResponse();
             } catch(WebException e) {
                 response = (HttpWebResponse)e.Response;
             }
             Console.WriteLine(&quot;response: {0}&quot;, response.StatusCode);
             stream = response.GetResponseStream();
             buffer = new byte[4096];
             read = stream.Read(buffer, 0, buffer.Length);

             // don't get here until the request timeout hits
             Console.WriteLine(&quot;{0} bytes read&quot;, read);
             stream.Close();
         }
     }
}
Repro -----------------------------------------------------

Arne Claassen

MindTouch
San Diego, CA
<A HREF="http://twitter.com/sdether">http://twitter.com/sdether</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090203/ed80f3ba/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090203/ed80f3ba/attachment-0001.html</A> 
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030780.html">[Mono-dev] high precision real &amp; cpu time in MONO (on linux)
</A></li>
	<LI>Next message: <A HREF="030799.html">[Mono-dev] HttpWebResponse ConnectStream blocks on empty stream
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30783">[ date ]</a>
              <a href="thread.html#30783">[ thread ]</a>
              <a href="subject.html#30783">[ subject ]</a>
              <a href="author.html#30783">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
