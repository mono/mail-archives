<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] unixOdbc System.Data.Obdc and Output parameters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20unixOdbc%20System.Data.Obdc%20and%20Output%20parameters&In-Reply-To=21997273.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031034.html">
   <LINK REL="Next"  HREF="031037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] unixOdbc System.Data.Obdc and Output parameters</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20unixOdbc%20System.Data.Obdc%20and%20Output%20parameters&In-Reply-To=21997273.post%40talk.nabble.com"
       TITLE="[Mono-dev] unixOdbc System.Data.Obdc and Output parameters">monodanmorg at yahoo.com
       </A><BR>
    <I>Fri Feb 13 11:18:03 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031034.html">[Mono-dev]  unixOdbc System.Data.Obdc and Output parameters
</A></li>
        <LI>Next message: <A HREF="031037.html">[Mono-dev] unixOdbc System.Data.Obdc and Output parameters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31036">[ date ]</a>
              <a href="thread.html#31036">[ thread ]</a>
              <a href="subject.html#31036">[ subject ]</a>
              <a href="author.html#31036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Maybe System.Data.Odbc should be modified to use the ODBC call procedure syntax when calling a stored procedure using the CommandType of StoredProcedure.

The ODBC call procedure syntax is enclosed with curly braces.  It has the keyword call, the procedure name, parentheses, and commas separating the parameters.  Of course, a question mark and equals signs indicates a return parameter.

{? = call usp_TestParameters (?, ?)}

<A HREF="http://support.microsoft.com/kb/310130">http://support.microsoft.com/kb/310130</A>


--- On Fri, 2/13/09, Bartolomeo Nicolotti &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bnicolotti at siapcn.it</A>&gt; wrote:

&gt;<i> From: Bartolomeo Nicolotti &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bnicolotti at siapcn.it</A>&gt;
</I>&gt;<i> Subject: [Mono-dev]  unixOdbc System.Data.Obdc and Output parameters
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Date: Friday, February 13, 2009, 9:24 AM
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm trying unixodbc with System.Data.ODBC
</I>&gt;<i> 
</I>&gt;<i> I can do select, see this file 
</I>&gt;<i> <A HREF="http://www.nabble.com/file/p21997273/helloODBC.cs">http://www.nabble.com/file/p21997273/helloODBC.cs</A>
</I>&gt;<i> helloODBC.cs , but I've
</I>&gt;<i> some problems with out parameters of stored procedueres.
</I>&gt;<i> 
</I>&gt;<i> With this file 
</I>&gt;<i> <A HREF="http://www.nabble.com/file/p21997273/helloODBCCommand.cs">http://www.nabble.com/file/p21997273/helloODBCCommand.cs</A>
</I>&gt;<i> helloODBCCommand.cs  I get:
</I>&gt;<i> 
</I>&gt;<i> Hello, Dunkel
</I>&gt;<i> Eseguo:CALL QGPL.WBC022(9)
</I>&gt;<i> Eseguo:CALL GIANLUCA.PROVACS
</I>&gt;<i> System.Data.Odbc.OdbcException: ERROR [42000]
</I>&gt;<i> [unixODBC][IBM][iSeries Access
</I>&gt;<i> ODBC Driver][DB2 UDB]SQL0104 - Token GIANLUCA non valido.
</I>&gt;<i> Token validi: (
</I>&gt;<i> END GET SET CALL DROP FREE HOLD LOCK OPEN WITH ALTER.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> It seems that setting the CommandType to StoredProcedure
</I>&gt;<i> has no effect, as
</I>&gt;<i> one can also see from the source of mono (I've
</I>&gt;<i> installed mono from source)
</I>&gt;<i> 
</I>&gt;<i> /home/siap/dwn/src/mono/mono-2.2/mcs/class/System.Data/System.Data.Odbc/OdbcCommand
</I>&gt;<i> 
</I>&gt;<i> the ExecuteNonQuery member function call ExecSQL that
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> private int ExecuteNonQuery (bool freeHandle) 
</I>&gt;<i> 		{
</I>&gt;<i> ...
</I>&gt;<i> 			ExecSQL(CommandText);
</I>&gt;<i> 
</I>&gt;<i> ExecSQL is:
</I>&gt;<i> 
</I>&gt;<i> 		private void ExecSQL (string sql)
</I>&gt;<i> 		{
</I>&gt;<i> 			OdbcReturn ret;
</I>&gt;<i> 			if (! prepared &amp;&amp; Parameters.Count &lt;= 0) {
</I>&gt;<i> 
</I>&gt;<i> 				ReAllocStatment ();
</I>&gt;<i> 				
</I>&gt;<i> 				ret = libodbc.SQLExecDirect (hstmt, sql,
</I>&gt;<i> libodbc.SQL_NTS);
</I>&gt;<i> 				if ((ret != OdbcReturn.Success) &amp;&amp; (ret !=
</I>&gt;<i> OdbcReturn.SuccessWithInfo)
</I>&gt;<i> &amp;&amp;
</I>&gt;<i> 				    (ret != OdbcReturn.NoData))
</I>&gt;<i> 					throw connection.CreateOdbcException
</I>&gt;<i> (OdbcHandleType.Stmt, hstmt);
</I>&gt;<i> 				return;
</I>&gt;<i> 			}
</I>&gt;<i> 
</I>&gt;<i> 			if (!prepared)
</I>&gt;<i> 				Prepare();
</I>&gt;<i> 
</I>&gt;<i> 			BindParameters ();
</I>&gt;<i> 			ret = libodbc.SQLExecute (hstmt);
</I>&gt;<i> 			if (ret != OdbcReturn.Success &amp;&amp; ret !=
</I>&gt;<i> OdbcReturn.SuccessWithInfo)
</I>&gt;<i> 				throw connection.CreateOdbcException
</I>&gt;<i> (OdbcHandleType.Stmt, hstmt);
</I>&gt;<i> 		}
</I>&gt;<i> 
</I>&gt;<i> Should I use prepared to BindParameters?
</I>&gt;<i> 
</I>&gt;<i> How can I get the output parameter of a Stored Procedure?
</I>&gt;<i> 
</I>&gt;<i> Many thanks
</I>&gt;<i> 
</I>&gt;<i> Best regards
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Bartolomeo Nicolotti wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Da: 	Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">monodanmorg at yahoo.com</A>&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Have you considered using ODBC provider instead?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; System.Data.Odbc namespace is included in System.Data
</I>&gt;<i> assembly.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; You can use iodbc or unixodbc on linux.  There's
</I>&gt;<i> commercial odbc solutions
</I>&gt;<i> &gt; for linux too.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; <A HREF="http://mono-project.com/ODBC">http://mono-project.com/ODBC</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; <A HREF="http://www.unixodbc.com/doc/db2.html">http://www.unixodbc.com/doc/db2.html</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Novell maintains System.Data.Odbc; however, I do not
</I>&gt;<i> think anyone is
</I>&gt;<i> &gt; maintaining IBM.Data.DB2 in Mono.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; --- On Wed, 2/11/09, Bartolomeo Nicolotti
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bnicolotti at siapcn.it</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Bartolomeo Nicolotti wrote:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; IBM.Data.DB2.DB2Exception: Unable to allocate
</I>&gt;<i> statement handle
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; by Bartolomeo Nicolotti :: Rate this Message:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Reply | Reply to Author | View Threaded | Show
</I>&gt;<i> Only this Message
</I>&gt;<i> &gt;&gt; Hello,
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I've installed mono, and xsp (not yet
</I>&gt;<i> mod_mono) on ubuntu following the
</I>&gt;<i> &gt;&gt; instruction here:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; <A HREF="http://ubuntuforums.org/showthread.php?t=803743">http://ubuntuforums.org/showthread.php?t=803743</A>
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; in view of using mod_mono together with php on
</I>&gt;<i> ubuntu server 8.04, to
</I>&gt;<i> &gt;&gt; migrate a web service that access a db2/as400
</I>&gt;<i> database.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I've also installed db2exc from ubuntu
</I>&gt;<i> repository as said here:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; <A HREF="http://www.ubuntu.com/partners/ibm/db2">http://www.ubuntu.com/partners/ibm/db2</A>
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I can compile a test program that does a query to
</I>&gt;<i> the db:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;  <A HREF="http://www.nabble.com/file/p21953488/helloDB2.cs">http://www.nabble.com/file/p21953488/helloDB2.cs</A>
</I>&gt;<i> helloDB2.cs 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">siap at LxPC54</A>:~/src/test$ gmcs
</I>&gt;<i> -r:/usr/lib/mono/1.0/IBM.Data.DB2.dll
</I>&gt;<i> &gt;&gt; -r:/usr/lib/mono/2.0/System.Data.dll helloDB2.cs
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; but when I execute it:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">siap at LxPC54</A>:~/src/test$ sudo MONO_LOG_LEVEL=debug
</I>&gt;<i> mono helloDB2.exe bart
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; ....
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Mono-INFO: Assembly Ref addref System.Data
</I>&gt;<i> 0x8362e10 -&gt; System.Xml
</I>&gt;<i> &gt;&gt; 0x83719d8: 2
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Hello, bart
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for 'SQLAllocHandle'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLAllocHandle'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLAllocHandle'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for 'SQLAllocHandle'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLAllocHandle'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLAllocHandle'.
</I>&gt;<i> &gt;&gt; Bart
</I>&gt;<i> &gt;&gt; not useLibCli
</I>&gt;<i> &gt;&gt; Bart
</I>&gt;<i> &gt;&gt; not useLibCli
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for
</I>&gt;<i> 'SQLDriverConnectW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLDriverConnectW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLDriverConnectW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for
</I>&gt;<i> 'SQLDriverConnectW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLDriverConnectW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLDriverConnectW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for 'SQLGetInfoW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetInfoW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLGetInfoW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for 'SQLGetInfoW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetInfoW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLGetInfoW'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for 'SQLGetDiagRec'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetDiagRec'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLGetDiagRec'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport attempting to load:
</I>&gt;<i> 'libdb2'.
</I>&gt;<i> &gt;&gt; Mono-INFO: DllImport loading location:
</I>&gt;<i> 'libdb2.so'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Searching for 'SQLGetDiagRec'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Probing 'SQLGetDiagRec'.
</I>&gt;<i> &gt;&gt; Mono-INFO: Found as 'SQLGetDiagRec'.
</I>&gt;<i> &gt;&gt; Bart
</I>&gt;<i> &gt;&gt; not useLibCli
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Unhandled Exception: IBM.Data.DB2.DB2Exception:
</I>&gt;<i> ERROR [08003] [IBM][CLI
</I>&gt;<i> &gt;&gt; Driver] CLI0106E  Connection is closed.
</I>&gt;<i> SQLSTATE=08003
</I>&gt;<i> &gt;&gt; InternalExecuteNonQuery: Unable to allocate
</I>&gt;<i> statement handle.
</I>&gt;<i> &gt;&gt;   at IBM.Data.DB2.DB2Command.AllocateStatement
</I>&gt;<i> (System.String location)
</I>&gt;<i> &gt;&gt; [0x00000]
</I>&gt;<i> &gt;&gt;   at
</I>&gt;<i> IBM.Data.DB2.DB2Command.ExecuteNonQueryInternal
</I>&gt;<i> (CommandBehavior
</I>&gt;<i> &gt;&gt; behavior) [0x00000]
</I>&gt;<i> &gt;&gt;   at IBM.Data.DB2.DB2Command.ExecuteReader
</I>&gt;<i> (CommandBehavior behavior)
</I>&gt;<i> &gt;&gt; [0x00000]
</I>&gt;<i> &gt;&gt;   at IBM.Data.DB2.DB2Command.ExecuteReader ()
</I>&gt;<i> [0x00000]
</I>&gt;<i> &gt;&gt;   at (wrapper remoting-invoke-with-check)
</I>&gt;<i> &gt;&gt; IBM.Data.DB2.DB2Command:ExecuteReader ()
</I>&gt;<i> &gt;&gt;   at HelloWorldDb2.Main (System.String[] args)
</I>&gt;<i> [0x00000] 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://www.nabble.com/IBM.Data.DB2.DB2Exception%3A-Unable-to-allocate-statement-handle-tp21953488p21997273.html">http://www.nabble.com/IBM.Data.DB2.DB2Exception%3A-Unable-to-allocate-statement-handle-tp21953488p21997273.html</A>
</I>&gt;<i> Sent from the Mono - Dev mailing list archive at
</I>&gt;<i> Nabble.com.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>

      
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031034.html">[Mono-dev]  unixOdbc System.Data.Obdc and Output parameters
</A></li>
	<LI>Next message: <A HREF="031037.html">[Mono-dev] unixOdbc System.Data.Obdc and Output parameters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31036">[ date ]</a>
              <a href="thread.html#31036">[ thread ]</a>
              <a href="subject.html#31036">[ subject ]</a>
              <a href="author.html#31036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
