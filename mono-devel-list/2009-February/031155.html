<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Unable to call methods on managed objects while running Mono on the iPhone
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Unable%20to%20call%20methods%20on%20managed%20objects%20while%20running%0A%20Mono%20on%20the%20iPhone&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031176.html">
   <LINK REL="Next"  HREF="031156.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Unable to call methods on managed objects while running Mono on the iPhone</H1>
    <B>mobbe</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Unable%20to%20call%20methods%20on%20managed%20objects%20while%20running%0A%20Mono%20on%20the%20iPhone&In-Reply-To="
       TITLE="[Mono-dev] Unable to call methods on managed objects while running Mono on the iPhone">peter.moberg at gmail.com
       </A><BR>
    <I>Sun Feb 22 23:17:58 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031176.html">[Mono-dev] Making your own programming language for mono
</A></li>
        <LI>Next message: <A HREF="031156.html">[Mono-dev] Unable to call methods on managed objects while running Mono on the iPhone
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31155">[ date ]</a>
              <a href="thread.html#31155">[ thread ]</a>
              <a href="subject.html#31155">[ subject ]</a>
              <a href="author.html#31155">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Over the past couple of weeks I have been working with getting the Mono
framework up and running on the iPhone and I am darn close to have it all
working.. .I have been able to get the AOT compilation to work and was able
this morning to startup Mono in full aot mode on the device. Big thanks to
Zoltan Varga for helping me through all the roadblocks I ran into.  I have
been working with a SVN HEAD version that I updated last week sometime.

Next step I took was to try to invoke some methods on classes in the msorlib
assembly to see if I could execute managed code and this is where I ran into
a new road block..

It looks like I am only able to execute .ctor methods!? During the startup
of Mono it creates a few exceptions (OutOfMemoryException etc..) and it
invokes its constructor method and passes in parameters. This works just
fine...and here it is executing managed code.

However, I tried to execute the ToString() method on an instance of the
Exception class and then the program is interrupted and stopped in the
prolog for the function mono_get_lmf_addr.. if I continue to run the
program
I get a BAD_INSTRUCTION message and the whole thing shuts down...

Here is the code I am trying to execute... 

MonoDomain * domain = mono_jit_init(&quot;&quot;); 
MonoAssembly* msCorlib = mono_domain_assembly_open (domain,&quot;mscorlib&quot;); 
MonoImage* image = mono_assembly_get_image(msCorlib);
	
MonoClass *klass = mono_class_from_name (image, &quot;System&quot;, &quot;Exception&quot;);
MonoObject* o = mono_object_new (domain, klass);

MonoMethodDesc* methodDesc = mono_method_desc_new(&quot;System.Object:ToString&quot;,
TRUE);
MonoMethod* toStringMethod = mono_method_desc_search_in_class(methodDesc,
klass);
MonoObject* result = mono_runtime_invoke(toStringMethod, o, NULL, NULL);


I don't know if it would help you but here is the assembly where it all
stops... 
mono_get_lmf_addr
0x001d5bdc  &lt;+0000&gt;  push {r4, r5, r7, lr}
0x001d5bde  &lt;+0002&gt;  add r7, sp, #8
0x001d5be0  &lt;+0004&gt;  sub sp, #12 &lt;-- stops here
0x001d5be2  &lt;+0006&gt;  ldr r3, [pc, #76] (0x1d5c30
&lt;mono_get_lmf_addr+84&gt;)
0x001d5be4  &lt;+0008&gt;  add r3, pc
0x001d5be6  &lt;+0010&gt;  ldr r3, [r3, #0]
0x001d5be8  &lt;+0012&gt;  adds r0, r3, #0
0x001d5bea  &lt;+0014&gt;  bl 0x3e640 &lt;TlsGetValue&gt;

I get the same problem if I try to run other methods on other objects or
static methods as well...Only constructor methods seems to work.

It looks to me that the stack isn't setup properly since it always throws
the EXC_BAD_INSTRUCTION when trying to access the stack pointer. 

I have been banging my head against this problem for two days and right now
I am not able to figure out how to troubleshoot this. If there is anyone out
there that have any suggestion on how I should go about troubleshooting this
I would really appreciate it. It stings a bit to come this close and not be
able to cross the finish line... 


Thanks,

-- 
View this message in context: <A HREF="http://www.nabble.com/Unable-to-call-methods-on-managed-objects-while-running-Mono-on-the-iPhone-tp22155202p22155202.html">http://www.nabble.com/Unable-to-call-methods-on-managed-objects-while-running-Mono-on-the-iPhone-tp22155202p22155202.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.

</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031176.html">[Mono-dev] Making your own programming language for mono
</A></li>
	<LI>Next message: <A HREF="031156.html">[Mono-dev] Unable to call methods on managed objects while running Mono on the iPhone
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31155">[ date ]</a>
              <a href="thread.html#31155">[ thread ]</a>
              <a href="subject.html#31155">[ subject ]</a>
              <a href="author.html#31155">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
