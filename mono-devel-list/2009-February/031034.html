<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev]  unixOdbc System.Data.Obdc and Output parameters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20unixOdbc%20System.Data.Obdc%20and%20Output%20parameters&In-Reply-To=21971654.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031011.html">
   <LINK REL="Next"  HREF="031036.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev]  unixOdbc System.Data.Obdc and Output parameters</H1>
    <B>Bartolomeo Nicolotti</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20unixOdbc%20System.Data.Obdc%20and%20Output%20parameters&In-Reply-To=21971654.post%40talk.nabble.com"
       TITLE="[Mono-dev]  unixOdbc System.Data.Obdc and Output parameters">bnicolotti at siapcn.it
       </A><BR>
    <I>Fri Feb 13 09:24:53 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031011.html">[Mono-dev] IBM.Data.DB2.DB2Exception: Unable to allocate statement handle
</A></li>
        <LI>Next message: <A HREF="031036.html">[Mono-dev] unixOdbc System.Data.Obdc and Output parameters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31034">[ date ]</a>
              <a href="thread.html#31034">[ thread ]</a>
              <a href="subject.html#31034">[ subject ]</a>
              <a href="author.html#31034">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

I'm trying unixodbc with System.Data.ODBC

I can do select, see this file 
<A HREF="http://www.nabble.com/file/p21997273/helloODBC.cs">http://www.nabble.com/file/p21997273/helloODBC.cs</A> helloODBC.cs , but I've
some problems with out parameters of stored procedueres.

With this file  <A HREF="http://www.nabble.com/file/p21997273/helloODBCCommand.cs">http://www.nabble.com/file/p21997273/helloODBCCommand.cs</A>
helloODBCCommand.cs  I get:

Hello, Dunkel
Eseguo:CALL QGPL.WBC022(9)
Eseguo:CALL GIANLUCA.PROVACS
System.Data.Odbc.OdbcException: ERROR [42000] [unixODBC][IBM][iSeries Access
ODBC Driver][DB2 UDB]SQL0104 - Token GIANLUCA non valido. Token validi: (
END GET SET CALL DROP FREE HOLD LOCK OPEN WITH ALTER.


It seems that setting the CommandType to StoredProcedure has no effect, as
one can also see from the source of mono (I've installed mono from source)

/home/siap/dwn/src/mono/mono-2.2/mcs/class/System.Data/System.Data.Odbc/OdbcCommand

the ExecuteNonQuery member function call ExecSQL that


private int ExecuteNonQuery (bool freeHandle) 
		{
...
			ExecSQL(CommandText);

ExecSQL is:

		private void ExecSQL (string sql)
		{
			OdbcReturn ret;
			if (! prepared &amp;&amp; Parameters.Count &lt;= 0) {

				ReAllocStatment ();
				
				ret = libodbc.SQLExecDirect (hstmt, sql, libodbc.SQL_NTS);
				if ((ret != OdbcReturn.Success) &amp;&amp; (ret != OdbcReturn.SuccessWithInfo)
&amp;&amp;
				    (ret != OdbcReturn.NoData))
					throw connection.CreateOdbcException (OdbcHandleType.Stmt, hstmt);
				return;
			}

			if (!prepared)
				Prepare();

			BindParameters ();
			ret = libodbc.SQLExecute (hstmt);
			if (ret != OdbcReturn.Success &amp;&amp; ret != OdbcReturn.SuccessWithInfo)
				throw connection.CreateOdbcException (OdbcHandleType.Stmt, hstmt);
		}

Should I use prepared to BindParameters?

How can I get the output parameter of a Stored Procedure?

Many thanks

Best regards





Bartolomeo Nicolotti wrote:
&gt;<i> 
</I>&gt;<i> Da: 	Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">monodanmorg at yahoo.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Have you considered using ODBC provider instead?
</I>&gt;<i> 
</I>&gt;<i> System.Data.Odbc namespace is included in System.Data assembly.
</I>&gt;<i> 
</I>&gt;<i> You can use iodbc or unixodbc on linux.  There's commercial odbc solutions
</I>&gt;<i> for linux too.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://mono-project.com/ODBC">http://mono-project.com/ODBC</A>
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.unixodbc.com/doc/db2.html">http://www.unixodbc.com/doc/db2.html</A>
</I>&gt;<i> 
</I>&gt;<i> Novell maintains System.Data.Odbc; however, I do not think anyone is
</I>&gt;<i> maintaining IBM.Data.DB2 in Mono.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --- On Wed, 2/11/09, Bartolomeo Nicolotti &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bnicolotti at siapcn.it</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Bartolomeo Nicolotti wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> IBM.Data.DB2.DB2Exception: Unable to allocate statement handle
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> by Bartolomeo Nicolotti :: Rate this Message:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Reply | Reply to Author | View Threaded | Show Only this Message
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've installed mono, and xsp (not yet mod_mono) on ubuntu following the
</I>&gt;&gt;<i> instruction here:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="http://ubuntuforums.org/showthread.php?t=803743">http://ubuntuforums.org/showthread.php?t=803743</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> in view of using mod_mono together with php on ubuntu server 8.04, to
</I>&gt;&gt;<i> migrate a web service that access a db2/as400 database.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've also installed db2exc from ubuntu repository as said here:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="http://www.ubuntu.com/partners/ibm/db2">http://www.ubuntu.com/partners/ibm/db2</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I can compile a test program that does a query to the db:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>  <A HREF="http://www.nabble.com/file/p21953488/helloDB2.cs">http://www.nabble.com/file/p21953488/helloDB2.cs</A> helloDB2.cs 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">siap at LxPC54</A>:~/src/test$ gmcs -r:/usr/lib/mono/1.0/IBM.Data.DB2.dll
</I>&gt;&gt;<i> -r:/usr/lib/mono/2.0/System.Data.dll helloDB2.cs
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> but when I execute it:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">siap at LxPC54</A>:~/src/test$ sudo MONO_LOG_LEVEL=debug mono helloDB2.exe bart
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ....
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Mono-INFO: Assembly Ref addref System.Data 0x8362e10 -&gt; System.Xml
</I>&gt;&gt;<i> 0x83719d8: 2
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Hello, bart
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLAllocHandle'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLAllocHandle'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLAllocHandle'.
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLAllocHandle'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLAllocHandle'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLAllocHandle'.
</I>&gt;&gt;<i> Bart
</I>&gt;&gt;<i> not useLibCli
</I>&gt;&gt;<i> Bart
</I>&gt;&gt;<i> not useLibCli
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLDriverConnectW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLDriverConnectW'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLDriverConnectW'.
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLDriverConnectW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLDriverConnectWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLDriverConnectW'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLDriverConnectW'.
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLGetInfoW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetInfoW'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLGetInfoW'.
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLGetInfoW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetInfoWW'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetInfoW'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLGetInfoW'.
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLGetDiagRec'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetDiagRec'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLGetDiagRec'.
</I>&gt;&gt;<i> Mono-INFO: DllImport attempting to load: 'libdb2'.
</I>&gt;&gt;<i> Mono-INFO: DllImport loading location: 'libdb2.so'.
</I>&gt;&gt;<i> Mono-INFO: Searching for 'SQLGetDiagRec'.
</I>&gt;&gt;<i> Mono-INFO: Probing 'SQLGetDiagRec'.
</I>&gt;&gt;<i> Mono-INFO: Found as 'SQLGetDiagRec'.
</I>&gt;&gt;<i> Bart
</I>&gt;&gt;<i> not useLibCli
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Unhandled Exception: IBM.Data.DB2.DB2Exception: ERROR [08003] [IBM][CLI
</I>&gt;&gt;<i> Driver] CLI0106E  Connection is closed. SQLSTATE=08003
</I>&gt;&gt;<i> InternalExecuteNonQuery: Unable to allocate statement handle.
</I>&gt;&gt;<i>   at IBM.Data.DB2.DB2Command.AllocateStatement (System.String location)
</I>&gt;&gt;<i> [0x00000]
</I>&gt;&gt;<i>   at IBM.Data.DB2.DB2Command.ExecuteNonQueryInternal (CommandBehavior
</I>&gt;&gt;<i> behavior) [0x00000]
</I>&gt;&gt;<i>   at IBM.Data.DB2.DB2Command.ExecuteReader (CommandBehavior behavior)
</I>&gt;&gt;<i> [0x00000]
</I>&gt;&gt;<i>   at IBM.Data.DB2.DB2Command.ExecuteReader () [0x00000]
</I>&gt;&gt;<i>   at (wrapper remoting-invoke-with-check)
</I>&gt;&gt;<i> IBM.Data.DB2.DB2Command:ExecuteReader ()
</I>&gt;&gt;<i>   at HelloWorldDb2.Main (System.String[] args) [0x00000] 
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://www.nabble.com/IBM.Data.DB2.DB2Exception%3A-Unable-to-allocate-statement-handle-tp21953488p21997273.html">http://www.nabble.com/IBM.Data.DB2.DB2Exception%3A-Unable-to-allocate-statement-handle-tp21953488p21997273.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.

</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031011.html">[Mono-dev] IBM.Data.DB2.DB2Exception: Unable to allocate statement handle
</A></li>
	<LI>Next message: <A HREF="031036.html">[Mono-dev] unixOdbc System.Data.Obdc and Output parameters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31034">[ date ]</a>
              <a href="thread.html#31034">[ thread ]</a>
              <a href="subject.html#31034">[ subject ]</a>
              <a href="author.html#31034">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
