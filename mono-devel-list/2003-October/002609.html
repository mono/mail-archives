<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Serialization of RSAParameters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Serialization%20of%20RSAParameters&In-Reply-To=LNEAJLBKIAFKOPHEICIDGEPICJAA.spouliot%40videotron.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002608.html">
   <LINK REL="Next"  HREF="002617.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Serialization of RSAParameters</H1>
    <B>Christian Rudh</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Serialization%20of%20RSAParameters&In-Reply-To=LNEAJLBKIAFKOPHEICIDGEPICJAA.spouliot%40videotron.ca"
       TITLE="[Mono-devel-list] Serialization of RSAParameters">christian at rudh.se
       </A><BR>
    <I>Tue Oct 21 17:42:53 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002608.html">[Mono-devel-list] Serialization of RSAParameters
</A></li>
        <LI>Next message: <A HREF="002617.html">[Mono-devel-list] Palm Runtimeenvirment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2609">[ date ]</a>
              <a href="thread.html#2609">[ thread ]</a>
              <a href="subject.html#2609">[ subject ]</a>
              <a href="author.html#2609">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

Thanks for the explanation and the advice!
I got it to work using the .ToXmlString() now :)

/Christian

On Tue, 2003-10-21 at 23:18, Sebastien Pouliot wrote:
&gt;<i> Christian,
</I>&gt;<i> 
</I>&gt;<i> This is why it wont work:
</I>&gt;<i> 
</I>&gt;<i> 	[Serializable]
</I>&gt;<i> 	public struct RSAParameters {
</I>&gt;<i> 		[NonSerialized]
</I>&gt;<i> 		public byte[] P;
</I>&gt;<i> 		[NonSerialized]
</I>&gt;<i> 		public byte[] Q;
</I>&gt;<i> 		[NonSerialized]
</I>&gt;<i> 		public byte[] D;
</I>&gt;<i> 		[NonSerialized]
</I>&gt;<i> 		public byte[] DP;
</I>&gt;<i> 		[NonSerialized]
</I>&gt;<i> 		public byte[] DQ;
</I>&gt;<i> 		[NonSerialized]
</I>&gt;<i> 		public byte[] InverseQ;
</I>&gt;<i> 
</I>&gt;<i> 		public byte[] Modulus;
</I>&gt;<i> 		public byte[] Exponent;
</I>&gt;<i> 	}
</I>&gt;<i> 
</I>&gt;<i> The private key is never serialized because it would introduce many security
</I>&gt;<i> issues. This means that both signature and decryption are impossible using a
</I>&gt;<i> serialized keypair.
</I>&gt;<i> 
</I>&gt;<i> This is also the case for MS framework
</I>&gt;<i> (<A HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html</A>
</I>&gt;<i> /frlrfsystemsecuritycryptographyrsaparametersclassdtopic.asp) so your sample
</I>&gt;<i> shouldn't work under Windows.
</I>&gt;<i> 
</I>&gt;<i> The best way to get the full keypair is to use RSA.ToXmlString(true). This
</I>&gt;<i> will give you an XML string containing the full keypair. You can then
</I>&gt;<i> serialize with, of course, the proper security the resulting string.
</I>&gt;<i> 
</I>&gt;<i> Sebastien Pouliot
</I>&gt;<i> Security Architect, Motus Technologies, <A HREF="http://www.motus.com">http://www.motus.com</A>
</I>&gt;<i> work: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">spouliot at motus.com</A>
</I>&gt;<i> home: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">spouliot at videotron.ca</A>
</I>&gt;<i> blog: <A HREF="http://pages.infinit.net/ctech/poupou.html">http://pages.infinit.net/ctech/poupou.html</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>]On Behalf Of Christian
</I>&gt;<i> Rudh
</I>&gt;<i> Sent: 21 octobre 2003 10:12
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: [Mono-devel-list] Serialization of RSAParameters
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I am trying to serialize the RSA-keys into a bytestream so I can write
</I>&gt;<i> them to disk (and a few other things). I'm able now to serialize them
</I>&gt;<i> and then use it in encryption, but it doesn't work in decryption. I
</I>&gt;<i> export to RSAParameters using the true-flag so I get everything, but
</I>&gt;<i> when I deserialize it seems as if I only get the parts of the public key
</I>&gt;<i> back? That's why encryption works fine, but not decryption.
</I>&gt;<i> 
</I>&gt;<i> I have compiled the following sources from various places and with my
</I>&gt;<i> own code. It crashes when (in the end) it uses RSA2.decrypt. But if you
</I>&gt;<i> comment out where it gets the RSAParameters from the deserialization
</I>&gt;<i> (----2----) and instead import from the original RSA (-----1----) it
</I>&gt;<i> works fine.
</I>&gt;<i> 
</I>&gt;<i> So are there any problems with serialization of RSAParameters or am I
</I>&gt;<i> missing something?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Christian Rudh
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> //Create a UnicodeEncoder to convert between byte array and string.
</I>&gt;<i> UnicodeEncoding ByteConverter = new UnicodeEncoding();
</I>&gt;<i> 
</I>&gt;<i> //Create byte arrays to hold original, encrypted, and decrypted data.
</I>&gt;<i> byte[] dataToEncrypt = ByteConverter.GetBytes(&quot;Text to Encrypt&quot;);
</I>&gt;<i> byte[] encryptedData;
</I>&gt;<i> byte[] decryptedData;
</I>&gt;<i> 
</I>&gt;<i> //Create a new pair of keys
</I>&gt;<i> RSACryptoServiceProvider RSA = new RSACryptoServiceProvider(1024);
</I>&gt;<i> 
</I>&gt;<i> //Export the public key
</I>&gt;<i> RSAParameters RSAP = RSA.ExportParameters(true);
</I>&gt;<i> 
</I>&gt;<i> //Serialize the public key
</I>&gt;<i> MemoryStream ms = new MemoryStream();
</I>&gt;<i> BinaryFormatter b = new BinaryFormatter();
</I>&gt;<i> b.Serialize(ms, RSAP);
</I>&gt;<i> byte[] keyHolder = ms.ToArray();
</I>&gt;<i> ms.Close();
</I>&gt;<i> 
</I>&gt;<i> //Deserialize the public key and store it in newRSAP
</I>&gt;<i> MemoryStream ms2 = new MemoryStream(keyHolder);
</I>&gt;<i> BinaryFormatter b2 = new BinaryFormatter();
</I>&gt;<i> RSAParameters newRSAP = (RSAParameters)b2.Deserialize(ms2);
</I>&gt;<i> ms2.Close();
</I>&gt;<i> 
</I>&gt;<i> //Encrypt the data using newRSAP which holds the RSAParameters
</I>&gt;<i> RSACryptoServiceProvider RSA1 = new RSACryptoServiceProvider();
</I>&gt;<i> RSA1.ImportParameters(newRSAP);
</I>&gt;<i> encryptedData = RSA1.Encrypt(dataToEncrypt, false);
</I>&gt;<i> 
</I>&gt;<i> //Decrypt the data using newRSAP which holds the RSAParameters
</I>&gt;<i> RSACryptoServiceProvider RSA2 = new RSACryptoServiceProvider();
</I>&gt;<i> //-------------1-------------
</I>&gt;<i> //RSA2.ImportParameters(RSA.ExportParameters(true));
</I>&gt;<i> //-------------2-------------
</I>&gt;<i> RSA2.ImportParameters(newRSAP);
</I>&gt;<i> decryptedData = RSA2.Decrypt(encryptedData, false);
</I>&gt;<i> 
</I>&gt;<i> //Display the decrypted plaintext to the console.
</I>&gt;<i> Console.WriteLine(&quot;Decrypted plaintext: {0}&quot;,
</I>&gt;<i> ByteConverter.GetString(decryptedData));
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002608.html">[Mono-devel-list] Serialization of RSAParameters
</A></li>
	<LI>Next message: <A HREF="002617.html">[Mono-devel-list] Palm Runtimeenvirment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2609">[ date ]</a>
              <a href="thread.html#2609">[ thread ]</a>
              <a href="subject.html#2609">[ subject ]</a>
              <a href="author.html#2609">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
