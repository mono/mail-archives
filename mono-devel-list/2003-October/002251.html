<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] ResourceManager is calling an incorrect constructor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20ResourceManager%20is%20calling%20an%20incorrect%20constructor&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002250.html">
   <LINK REL="Next"  HREF="002323.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] ResourceManager is calling an incorrect constructor</H1>
    <B>Francisco Figueiredo Jr.</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20ResourceManager%20is%20calling%20an%20incorrect%20constructor&In-Reply-To="
       TITLE="[Mono-devel-list] [PATCH] ResourceManager is calling an incorrect constructor">fxjrlists at yahoo.com.br
       </A><BR>
    <I>Wed Oct  1 14:01:44 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002250.html">[Mono-devel-list] [PATCH] bugs in System.Data.DataRow
</A></li>
        <LI>Next message: <A HREF="002323.html">[Mono-devel-list] [PATCH] ResourceManager is calling an	incorrect constructor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2251">[ date ]</a>
              <a href="thread.html#2251">[ thread ]</a>
              <a href="subject.html#2251">[ subject ]</a>
              <a href="author.html#2251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi all.

I found this small bug in ResourceManager.

It tries in the line 290:

set=(ResourceSet)Activator.CreateInstance(resourceSetType, args);

to call a constructor in the type resourceSetType which only exists in 
the ResourceSet type and possible subtypes.

If I use this constructor as

resman = new ResourceManager(typeof(MyType));

it will try to call the constructor in MyType which for sure will not 
know anything about loading resources.

This is caused by an misinitialization of the resourceSetType in the 
ResourceManager constructor which takes a Type as a parameter.

In the docs, it is said this Type is used by ResourceManager to get info 
about assembly and other things, but not to use this type as the source 
of resources.

So I think this field initialization should be the same as the default 
constructor, typeof(ResourceSet).

I'm using this modification in my projects and they are working very well.

I will create a test case and add it to the test cases.

Thanks for attention.


[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fxjr at IGARAPAVA</A> System.Resources]$ cvs -z3 diff -u
cvs server: Diffing .
Index: ResourceManager.cs
===================================================================
RCS file: /mono/mcs/class/corlib/System.Resources/ResourceManager.cs,v
retrieving revision 1.19
diff -u -r1.19 ResourceManager.cs
--- ResourceManager.cs  6 May 2003 19:12:13 -0000       1.19
+++ ResourceManager.cs  1 Oct 2003 17:54:22 -0000
@@ -49,7 +49,7 @@

                         BaseNameField = resourceSource.FullName;
                         MainAssembly = resourceSource.Assembly;
-                       resourceSetType = resourceSource;
+                       resourceSetType= typeof(ResourceSet);
                         neutral_culture = 
GetNeutralResourcesLanguage(MainAssembly);
                 }



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002250.html">[Mono-devel-list] [PATCH] bugs in System.Data.DataRow
</A></li>
	<LI>Next message: <A HREF="002323.html">[Mono-devel-list] [PATCH] ResourceManager is calling an	incorrect constructor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2251">[ date ]</a>
              <a href="thread.html#2251">[ thread ]</a>
              <a href="subject.html#2251">[ subject ]</a>
              <a href="author.html#2251">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
