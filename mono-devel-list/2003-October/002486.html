<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Non ASCII characters in filenames / command line parameters (also sent to: mono-list at lists.ximian.com)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Non%20ASCII%20characters%20in%20filenames%20/%20command%20line%20parameters%20%28also%20sent%20to%3A%20mono-list%40lists.ximian.com%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002481.html">
   <LINK REL="Next"  HREF="002491.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Non ASCII characters in filenames / command line parameters (also sent to: mono-list at lists.ximian.com)</H1>
    <B>Uwe Oertel</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Non%20ASCII%20characters%20in%20filenames%20/%20command%20line%20parameters%20%28also%20sent%20to%3A%20mono-list%40lists.ximian.com%29&In-Reply-To="
       TITLE="[Mono-devel-list] Non ASCII characters in filenames / command line parameters (also sent to: mono-list at lists.ximian.com)">uweo at voelcker.com
       </A><BR>
    <I>Tue Oct 14 07:12:58 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002481.html">[Mono-devel-list] Building mcs module with csc on cygwin
</A></li>
        <LI>Next message: <A HREF="002491.html">[Mono-devel-list] VB.NET support in xsp and mbas problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2486">[ date ]</a>
              <a href="thread.html#2486">[ thread ]</a>
              <a href="subject.html#2486">[ subject ]</a>
              <a href="author.html#2486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello there,

regarding the problem using language specific characters,
like German &#196;&#214;&#220; in filenames or command line characters,
mono (0.28) only supports UTF-8 character encoding for filenames and command line parameters ( see: <A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=30781">http://bugzilla.ximian.com/show_bug.cgi?id=30781</A> ).

Therefore you will have to enable UTF-8 mode on the console (e.g. with: echo -e &quot;\033%G&quot;), if you want to call the following C# programm:

// ---------------- 8&lt; ------------------ &gt;8 ---------------------

using System;
using System.IO;

namespace CreatePath
{
	public class CreatePath
	{
		public static void Main(string []args)
		{
			Directory.CreateDirectory(args[0]);
		}
	}
}

// ---------------- 8&lt; ------------------ &gt;8 ---------------------

with:

$mono CreatePath.exe Dir&#196;&#214;&#220;&#228;&#246;&#252;&#223;001

otherwise you will get the following exception:

Unhandled Exception: System.ArgumentNullException: Argument cannot be null Parameter name: path in &lt;0x00036&gt; System.IO.Directory:CreateDirectory (string) in &lt;0x00020&gt; CreatePath.CreatePath:Main (string[])

.

On our linux environment we partly use &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">de_DE at euro</A>&quot; for language encoding (LC_CTYPE = <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">de_DE at euro</A>), that works fine with Samba 2.2.7a, which does not support UTF-8. I did a small patch in unicode.c (mono/io-layer/unicode.c) and unicode.h (mono/io-layer/unicode.h) to test, whether it works with locale encoding for directory-/filenames and it does.

If you use the following conversion functions (primary the first and 
second):

/*  ---------------- 8&lt; ------------------ &gt;8 --------------------- */

#include &lt;glib.h&gt;
#include &lt;glib/gconvert.h&gt;

gchar *_wapi_unicode_to_locale(const gunichar2 *uni)
{
	GError *error = NULL;
	gchar *res = NULL;
	gchar *utf8_ret;

	utf8_ret = g_utf16_to_utf8 (uni, -1, NULL, NULL, &amp;error);

	if (utf8_ret)
	{
		res = _wapi_utf8_to_locale (utf8_ret);
	}

	g_assert(!error);

	return res;
}

gunichar2 *_wapi_locale_to_unicode(const gchar *locale)
{
	GError *error = NULL;
	gunichar2 *res = NULL;
	gchar *utf8_ret;

	utf8_ret = _wapi_locale_to_utf8 (locale);

	if (utf8_ret)
	{
		res = g_utf8_to_utf16(utf8_ret, -1, NULL, NULL, &amp;error);
	}

	g_assert(!error);

	return res;
}

gchar *_wapi_locale_to_utf8(const gchar *locale)
{
	GError *error = NULL;
	gchar *res;
	gsize bytes_written = 0;

	res = g_locale_to_utf8 (locale, -1, NULL,
		&amp;bytes_written, &amp;error);

	g_assert(!error);

	return res;
}

gchar *_wapi_utf8_to_locale(const gchar *utf8)
{
	GError *error = NULL;
	gchar *res;
	gsize bytes_written = 0;

	res = g_locale_from_utf8 (utf8, -1, NULL,
		&amp;bytes_written, &amp;error);

	g_assert (!error);

	return res;
}

/*  ---------------- 8&lt; ------------------ &gt;8 --------------------- */

it should work for both, reading command line parameters and reading / creating directories and files with any locale character encoding (even UTF-8).

It would be great, if such a conversion could be implemented in mono.

Thanks a lot,

Uwe Oertel


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002481.html">[Mono-devel-list] Building mcs module with csc on cygwin
</A></li>
	<LI>Next message: <A HREF="002491.html">[Mono-devel-list] VB.NET support in xsp and mbas problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2486">[ date ]</a>
              <a href="thread.html#2486">[ thread ]</a>
              <a href="subject.html#2486">[ subject ]</a>
              <a href="author.html#2486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
