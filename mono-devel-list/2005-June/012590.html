<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Reworked unified Locale classes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Reworked%20unified%20Locale%20classes&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012584.html">
   <LINK REL="Next"  HREF="012603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Reworked unified Locale classes</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Reworked%20unified%20Locale%20classes&In-Reply-To="
       TITLE="[Mono-devel-list] [PATCH] Reworked unified Locale classes">kornelpal at hotmail.com
       </A><BR>
    <I>Thu Jun 16 14:09:17 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012584.html">[Mono-devel-list] [PATCH] Reworked unified Locale classes
</A></li>
        <LI>Next message: <A HREF="012603.html">[Mono-devel-list] [PATCH] Reworked unified Locale classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12590">[ date ]</a>
              <a href="thread.html#12590">[ thread ]</a>
              <a href="subject.html#12590">[ subject ]</a>
              <a href="author.html#12590">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> From: Ben Maurer
</I>&gt;<i> Benchmarks really don't matter here I think. The *only* reason people
</I>&gt;<i> would use the Locale class is when an exception gets thrown and we need
</I>&gt;<i> to get the error message. Since an exception is 1) exceptional and 2)
</I>&gt;<i> already slow, not too much harm in slowing it down more :-).
</I>
OK.:)

&gt;<i> So, we should go for the simplest design. I think the simplest one was
</I>&gt;<i> the one using ThreadStatic.
</I>
I think a lock on the resource manager is better as it requires no thread
variables and it is locked anyway so it does not degrade performance.

&gt;<i> if (inside_gettext)
</I>&gt;<i>    // don't do anything
</I>&gt;<i>    return msg;
</I>
Because as you mentioned this can occur only when getting message for
exceptions furthermore only when the exception occurs in ResouceManager or
classes it uses it's better to append &quot;GetText recursion: &quot; as the exception
message is for informational purposes.

&gt;<i> try {
</I>&gt;<i>    inside_gettext = true;
</I>
Neither lock nor using is generated in this way either by CSC or MCS. They
all create object or acrique lock outside the protected block so I think the
current code is correct.

&gt;<i>    return ...
</I>&gt;<i> } catch {
</I>&gt;<i>    inside_gettext = false;
</I>&gt;<i> }
</I>
It's better to use finally.

&gt;<i> From: Peter Dennis Bartok
</I>&gt;<i> Ben, you are not correct. In MWF, the Locale class is used for getting
</I>&gt;<i> localized text for buttons in dialogs, for retrieving built-in images (for
</I>&gt;<i> dialogs), icons and cursors, and to retrieve the category and description
</I>&gt;<i> for viewing properties in propertygrid. Those are not in the main code
</I>&gt;<i> path
</I>&gt;<i> and don't demand ultra-high speed, but performance does matter a bit
</I>
You can make sure that it will cause no more performance overhead as it
currently does because MWF is already using ResourceManager for images. And
of course this synchronization is only for corlib and GetText.

&gt;<i> From: Ben Maurer
</I>&gt;<i> Anyways, I am sure that localization is going to incur some overhead for
</I>&gt;<i> non-english cultures. For english, we should strive to make the overhead
</I>&gt;<i> near 0.
</I>
Localization allways cause some overhead but just look at MS.NET it is
localized, it has it's English resouces in resouce files as well and I think
it has good performance.

I think the best solution is to do what I have done: using a custom
ResouceSet that returns the identifiers in GetString methods because
ResourceManager falls back to parent cultures. Furthermore if there are no
invariant resources it will throw MissingManifestResourceException. And
because ResouceManager select the appropriate ResouceSet using it's own
logic it we add some logic for English in GetText then it will degrade the
performace when using any other languages.

Korn&#233;l


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012584.html">[Mono-devel-list] [PATCH] Reworked unified Locale classes
</A></li>
	<LI>Next message: <A HREF="012603.html">[Mono-devel-list] [PATCH] Reworked unified Locale classes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12590">[ date ]</a>
              <a href="thread.html#12590">[ thread ]</a>
              <a href="subject.html#12590">[ subject ]</a>
              <a href="author.html#12590">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
