<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] System.Net.FtpWebRequest
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20System.Net.FtpWebRequest&In-Reply-To=1119810486.6595.85.camel%40linux.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012826.html">
   <LINK REL="Next"  HREF="012864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] System.Net.FtpWebRequest</H1>
    <B>Martin Hinks</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20System.Net.FtpWebRequest&In-Reply-To=1119810486.6595.85.camel%40linux.site"
       TITLE="[Mono-devel-list] [PATCH] System.Net.FtpWebRequest">mhinks at gmail.com
       </A><BR>
    <I>Mon Jun 27 03:48:57 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012826.html">[Mono-devel-list] [PATCH] System.Net.FtpWebRequest
</A></li>
        <LI>Next message: <A HREF="012864.html">[Mono-devel-list] [PATCH] System.Net.FtpWebRequest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12857">[ date ]</a>
              <a href="thread.html#12857">[ thread ]</a>
              <a href="subject.html#12857">[ subject ]</a>
              <a href="author.html#12857">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Miguel,

I have read your comments and will make some changes...

1.) ABOR - yes, you are write - the Out-of-band thing only applies if
there is a connected data socket correct?

2.) I'll add the code to send TYPE commands for mode

3.) MS.NET states that you cannot change the properties while an
operation is in progress and that a InvalidOperationException should
be thrown, so this is the correct behaviour.

4.) I am not sure what I should do about broken comms, MS.Net does not
specify what action it will take in the MSDN docs if it loses the
connection, but, seeing as the rest of the spec is using
ProtocolViolationExceptions when there is a problem it will probably
throw one of these, maybe I will do that for now.

5.) Hehe, sorry for the XML comments then, damn! that took ages :p

6.) As regards my .RegisterPrefix comment, when you write a pluggable
protocol using WebRequest you have to register the prefix, so at the
moment you have to do WebRequest.RegisterPrefix(&quot;ftp:&quot;) and (&quot;ftps&quot;)
in the application using System.Net.FtpWebRequest. This is incorrect
behaviour as can be seen using the HttpWebRequest where it is NOT
necessary to register &quot;http&quot; as it is pre-registered somewhere... I'll
do a post asking about it.


Thanks for the feedback, I'll make those changes and check out the
source you sent, hopefully I can get my contribution used :)

Martin

On 6/26/05, Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at ximian.com</A>&gt; wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i>   Excellent work Martin.
</I>&gt;<i> 
</I>&gt;<i>   I have attached a few comments:
</I>&gt;<i> 
</I>&gt;<i> &gt; 4.) I did XML doc for it all - don't know how much that helps....
</I>&gt;<i> 
</I>&gt;<i> In Mono we tend not to use the inline-XML documentation, and instead we
</I>&gt;<i> put the documentation on a separate file.   Could you resend the code
</I>&gt;<i> without XML comments?
</I>&gt;<i> 
</I>&gt;<i> The comments we can reuse in Monodoc (install your new libraries, and
</I>&gt;<i> run the monodocer command).
</I>&gt;<i> 
</I>&gt;<i> &gt; 5.) I haven't modified it so that you don't need to do .RegisterPrefix
</I>&gt;<i> &gt; (and am not sure how either)
</I>&gt;<i> 
</I>&gt;<i> Am confused about that.
</I>&gt;<i> 
</I>&gt;<i> &gt; The main classes (FtpAsyncResult, FtpWebRequest, FtpWebResponse, FtpEnums)
</I>&gt;<i> &gt; FtpTest.cs - a usage example - takes ftp:// or ftps:// as cmd line arg
</I>&gt;<i> &gt; and connects, lists the dir etc...
</I>&gt;<i> &gt; FtpWebRequestTest.cs - a VERY basic test class - it will test you
</I>&gt;<i> &gt; didn't completely break it but not much else yet - I'll do more later.
</I>&gt;<i> 
</I>&gt;<i> I have not looked very closely to the code, but a few things are worth
</I>&gt;<i> mentioning:
</I>&gt;<i> 
</I>&gt;<i>        * The abort code does not prepare the socket to send an
</I>&gt;<i>          Out-of-Band message before it sends the abort.
</I>&gt;<i> 
</I>&gt;<i>        * The abort code I think is &quot;ABOR&quot;, not &quot;ABORT&quot;
</I>&gt;<i> 
</I>&gt;<i>        * Although there are properties for setting binary transfer,
</I>&gt;<i>          there does not seem to be any code to actually change the
</I>&gt;<i>          transfer mode, since the default in most servers is ASCII
</I>&gt;<i>          this probably will cause trouble.
</I>&gt;<i> 
</I>&gt;<i>        * When changing properties of a connection, maybe the code
</I>&gt;<i>          should queue changes (unless the MS.NET implementation does
</I>&gt;<i>          it differently), for example, it should be possible to
</I>&gt;<i>          change the binary mode while a transfer is in progress.
</I>&gt;<i> 
</I>&gt;<i>          On the next operation, it could send all of the pending
</I>&gt;<i>          changes down the line.
</I>&gt;<i> 
</I>&gt;<i>        * The code does not seem to handle broken communications,
</I>&gt;<i>          for instance, consider the &quot;SendCommand&quot; routine, it
</I>&gt;<i>          should probably loop around:
</I>&gt;<i> 
</I>&gt;<i>           net.Write(sendBuffer, 0, sendBuffer.GetLength(0));
</I>&gt;<i> 
</I>&gt;<i>          And catch errors;  And if an error happens while sending
</I>&gt;<i>          the command or receiving the reply, it should throw the
</I>&gt;<i>          proper exception (or try to recover, not sure what MS
</I>&gt;<i>          does here).
</I>&gt;<i> 
</I>&gt;<i> I have attached the source code to the ftp client that is used in the
</I>&gt;<i> Midnight Commander which might be useful as a reference for
</I>&gt;<i> miss-behaving ftp sites.  The code has extra stuff that you can safely
</I>&gt;<i> ignore, but the underlying ftp client should be a good reference.
</I>&gt;<i> 
</I>&gt;<i> Miguel.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>

-- 
Martin Hinks

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012826.html">[Mono-devel-list] [PATCH] System.Net.FtpWebRequest
</A></li>
	<LI>Next message: <A HREF="012864.html">[Mono-devel-list] [PATCH] System.Net.FtpWebRequest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12857">[ date ]</a>
              <a href="thread.html#12857">[ thread ]</a>
              <a href="subject.html#12857">[ subject ]</a>
              <a href="author.html#12857">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
