<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Oracle ORA-24374: Fetch errors only on solaris	but not linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Oracle%20ORA-24374%3A%20Fetch%20errors%20only%20on%20solaris%0A%09but%20not%20linux&In-Reply-To=20050608183523.47797.qmail%40web52106.mail.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012397.html">
   <LINK REL="Next"  HREF="012494.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Oracle ORA-24374: Fetch errors only on solaris	but not linux</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Oracle%20ORA-24374%3A%20Fetch%20errors%20only%20on%20solaris%0A%09but%20not%20linux&In-Reply-To=20050608183523.47797.qmail%40web52106.mail.yahoo.com"
       TITLE="[Mono-devel-list] Oracle ORA-24374: Fetch errors only on solaris	but not linux">danielmorgan at verizon.net
       </A><BR>
    <I>Sat Jun 11 22:43:21 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012397.html">[Mono-devel-list] Oracle ORA-24374: Fetch errors only on solaris	but not linux
</A></li>
        <LI>Next message: <A HREF="012494.html">[Mono-devel-list] Oracle ORA-24374: Fetch errors only on solaris	but not linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12469">[ date ]</a>
              <a href="thread.html#12469">[ thread ]</a>
              <a href="subject.html#12469">[ subject ]</a>
              <a href="author.html#12469">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As I mentioned earlier, it could be a byte-ordering problem.  65536 is 
not a valid statement type.

This is how OciStatementType is defined in System.Data.OracleClient.

namespace System.Data.OracleClient.Oci {
    internal enum OciStatementType {
        Default = 0x00,
        Select = 0x01,
        Update = 0x02,
        Delete = 0x03,
        Insert = 0x04,
        Create = 0x05,
        Drop = 0x06,
        Alter = 0x07,
        Begin = 0x08,
        Declare = 0x09
    }
}

OCI documentation says OCI_ATTR_STMT_TYPE is an ub2 which is an unsigned 
16-bit integer.

If you look at GetStatementType in StatementHandle, it uses 
GetAttributeInt32 to return an Int32.  Maybe, it should be returning an 
UInt16?  This could be done via GetAttributeUInt16 which is defined in 
OciHandle.

The OciStatementType could be defined as ushort.

    internal enum OciStatementType : ushort {

Can you try this and let me know?

Are you running Solaris on Sparc or x86?

Doug wrote:

&gt;<i>After some tracing and testing I am getting down to
</I>&gt;<i>what is causing problems of mono on Solaris and using
</I>&gt;<i>Oracle.  In the
</I>&gt;<i>mcs/class/System.Data.OracleClient/System.Data.OracleClient
</I>&gt;<i>directory, the file OracleCommand.cs has a private
</I>&gt;<i>class called IsNonQuery.  This class is used to
</I>&gt;<i>determine if a Statement being fed into the Oracle
</I>&gt;<i>connection is a query or a DML statement.  The
</I>&gt;<i>IsNonQuery is failing and ALWAYS returns false
</I>&gt;<i>(because OciStatementType statementType =
</I>&gt;<i>statementHandle.GetStatementType(); returns the number
</I>&gt;<i> 65536 instead of the word Select?) This causes all
</I>&gt;<i>statements to be treated like a DML statement even if
</I>&gt;<i>it is a SELECT statement.  That causes Oracle to
</I>&gt;<i>return an Error because a Select is treated different
</I>&gt;<i>than DML.
</I>&gt;<i>  If you are just using Selects to return data in
</I>&gt;<i>mono, then a quick fix is just to always return false
</I>&gt;<i>in the IsNonQuery function.  HOWEVER, if a DML
</I>&gt;<i>statement such as Create table is used, there will be
</I>&gt;<i>an Oracle Error returned with this approach.  Another
</I>&gt;<i>quick fix approach would just be to scan the statement
</I>&gt;<i>for Select and if it is found, then the IsNonQuery
</I>&gt;<i>will return False, otherwise will return True.  
</I>&gt;<i>   I am as yet unsure how to fix it correctly but if I
</I>&gt;<i>figure it out, I will post a fix.  If anyone else can
</I>&gt;<i>dig deeper and find the problem and the fix first,
</I>&gt;<i>please let me know.  
</I>&gt;<i>
</I>&gt;<i>--- Daniel Morgan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">danielmorgan at verizon.net</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>The problem might be with byte order - little-endian
</I>&gt;&gt;<i>vs. big-endian.  It 
</I>&gt;&gt;<i>works on Windows 2000/XP and Linux/x86.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>There is a bug for for OracleClient not working on
</I>&gt;&gt;<i>PPC (Mac OS X).  At 
</I>&gt;&gt;<i>the end of the bug, someone mentions it does not
</I>&gt;&gt;<i>work on Solaris either.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i><A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=71318">http://bugzilla.ximian.com/show_bug.cgi?id=71318</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Patches are welcomed though.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Also, if you take Mono's
</I>&gt;&gt;<i>System.Data.OracleClient.dll and run it on 
</I>&gt;&gt;<i>Microsoft .NET, it will fail to retrieve data. 
</I>&gt;&gt;<i>Maybe it does not 
</I>&gt;&gt;<i>marshall the data the way it should be.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Doug wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>We have installed and tested Mono 1.1.7 on both
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>Linux
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>and Solaris and have windows forms working on both.
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>However the exact same code fails with a 
</I>&gt;&gt;&gt;<i>  ERROR: ORA-24374: define not done before fetch
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>or
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>execute and fetch
</I>&gt;&gt;&gt;<i>  on solaris but works fine on the Linux machine. 
</I>&gt;&gt;&gt;<i>Both machines have the same Oracle version and are
</I>&gt;&gt;&gt;<i>connecting to the same database.  Has anyone else
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>seen
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>this problem or have any ideas of how to resolve
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>it?
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012397.html">[Mono-devel-list] Oracle ORA-24374: Fetch errors only on solaris	but not linux
</A></li>
	<LI>Next message: <A HREF="012494.html">[Mono-devel-list] Oracle ORA-24374: Fetch errors only on solaris	but not linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12469">[ date ]</a>
              <a href="thread.html#12469">[ thread ]</a>
              <a href="subject.html#12469">[ subject ]</a>
              <a href="author.html#12469">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
