<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] mcs patch for precise location handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20mcs%20patch%20for%20precise%20location%20handling&In-Reply-To=42C1836C.1040505%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012911.html">
   <LINK REL="Next"  HREF="012943.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] mcs patch for precise location handling</H1>
    <B>Marek Safar</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20mcs%20patch%20for%20precise%20location%20handling&In-Reply-To=42C1836C.1040505%40ximian.com"
       TITLE="[Mono-devel-list] mcs patch for precise location handling">marek.safar at seznam.cz
       </A><BR>
    <I>Wed Jun 29 11:37:39 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012911.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
        <LI>Next message: <A HREF="012943.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12936">[ date ]</a>
              <a href="thread.html#12936">[ thread ]</a>
              <a href="subject.html#12936">[ subject ]</a>
              <a href="author.html#12936">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Eno,

&gt;<i> Sorry, the last patch actually didn't include the fix for bug
</I>&gt;<i> #57047. This time it should be included (I found it running diff
</I>&gt;<i> against two diff files).
</I>&gt;<i> This time the patch changes only a few things than before:
</I>&gt;<i> <A HREF="http://monkey.workarea.jp/tmp/20050627/precise-location-20050628_2.diff">http://monkey.workarea.jp/tmp/20050627/precise-location-20050628_2.diff</A>
</I>&gt;<i>
</I>I think can be useful make 'public class LocatedToken' struct as is 
passed only as an argument.
And use this class in similar way as MemberName for every relevant 
consumers.
For example:

@@ -334,17 +334,18 @@
 	: USING IDENTIFIER ASSIGN 
 	  namespace_or_type_name SEMICOLON
 	  {
-		current_namespace.UsingAlias ((string) $2, (MemberName) $4, lexer.Location);
+		LocatedToken lt = (LocatedToken) $2;
+		current_namespace.UsingAlias (lt.StringValue, (MemberName) $4, lt.Location);
 	  }
 	| USING error {
-		CheckIdentifierToken (yyToken);
+		CheckIdentifierToken (yyToken, GetLocation ($2));
 	  }
 	;
 
 using_namespace_directive
 	: USING namespace_name SEMICOLON 
 	  {
-		current_namespace.Using ((MemberName) $2, lexer.Location);
+		current_namespace.Using ((MemberName) $2, (Location) $1);
           }
 	;


next example can be this one.

 constant_declarator
 	: IDENTIFIER ASSIGN constant_expression
 	  {
-		$$ = new VariableDeclaration ((string) $1, $3, lexer.Location);
+		LocatedToken lt = (LocatedToken) $1;
+		$$ = new VariableDeclaration (lt.StringValue, $3, lt.Location);
 	  }



One more MemberName

 		current_namespace = new NamespaceEntry (
-			current_namespace, file, name.GetName (), lexer.Location);
+			current_namespace, file, name.GetName (), name.Location);
 	  }


Why is there so many locations ?

@@ -475,7 +475,7 @@
 
 		void Define_Fields ()
 		{
-			Location loc = Location.Null;
+			Location loc = Location;
 
 			pc_field = new Field (
 				this, TypeManager.system_int32_expr, Modifiers.PRIVATE, &quot;PC&quot;,
@@ -536,8 +536,7 @@
 			Constructor ctor = new Constructor (
 				this, Name, Modifiers.PUBLIC, ctor_params,
 				new ConstructorBaseInitializer (
-					null, Parameters.EmptyReadOnlyParameters, Location),
-				Location);
+					null, Parameters.EmptyReadOnlyParameters, Location), Location);
 			AddConstructor (ctor);


MemberBase is derived from MemberCore

+Location GetLocation (object obj)
+{
+    if (obj is MemberCore)
+        return ((MemberCore) obj).Location;
+    if (obj is MemberName)
+        return ((MemberName) obj).Location;


The instance property IsNull can be more suitable.

-                if (location.Equals (Location.Null)) {
+                if (Location.IsNull (location)) {

&gt;&gt;<i> It can save a lot.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Actually it was 77618 KB to 77570 KB ;) But yeah, still better.
</I>
Yeah, it will be better.


Marek

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012911.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
	<LI>Next message: <A HREF="012943.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12936">[ date ]</a>
              <a href="thread.html#12936">[ thread ]</a>
              <a href="subject.html#12936">[ subject ]</a>
              <a href="author.html#12936">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
