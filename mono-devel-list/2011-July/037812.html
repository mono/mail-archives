<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mixed Mode Assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mixed%20Mode%20Assemblies&In-Reply-To=CAPSBeuGg_AViqzi5tixRm_NxxrEHNNRo1Z7xJMU-yd2dyWPFiw%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037811.html">
   <LINK REL="Next"  HREF="037813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mixed Mode Assemblies</H1>
    <B>Tom Spink</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mixed%20Mode%20Assemblies&In-Reply-To=CAPSBeuGg_AViqzi5tixRm_NxxrEHNNRo1Z7xJMU-yd2dyWPFiw%40mail.gmail.com"
       TITLE="[Mono-dev] Mixed Mode Assemblies">tspink at gmail.com
       </A><BR>
    <I>Sat Jul  9 14:56:22 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037811.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
        <LI>Next message: <A HREF="037813.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37812">[ date ]</a>
              <a href="thread.html#37812">[ thread ]</a>
              <a href="subject.html#37812">[ subject ]</a>
              <a href="author.html#37812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9 July 2011 19:31, Alex Corrado &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">alexander.corrado at gmail.com</A>&gt; wrote:

&gt;<i> On Sat, Jul 9, 2011 at 2:12 PM, Tom Spink &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tspink at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; I agree with you here, Jon, and it sounds like quite an interesting
</I>&gt;<i> &gt; exercise. Of course, one of the other interesting things here would be
</I>&gt;<i> what
</I>&gt;<i> &gt; compiler do you use to generate a mixed-mode ELF?  Or, how do you embed
</I>&gt;<i> IL
</I>&gt;<i> &gt; (and associated metadata) into your ELF - what process do you run to
</I>&gt;<i> create
</I>&gt;<i> &gt; this combination ELF?
</I>&gt;<i>
</I>&gt;<i> That would be nice and easy if the linker supported adding arbitrary
</I>&gt;<i> sections. Then we'd just need a tool to extract the CLI parts from the
</I>&gt;<i> PE file and create a binary blob that could be passed off to the
</I>&gt;<i> linker. We would also need a way to generate native stubs that would
</I>&gt;<i> load and initialize the mono runtime and a way to expose the managed
</I>&gt;<i> API as native entry points. Since the CLI is OO, it would make sense
</I>&gt;<i> to expose the managed API in a way that would be consumable from some
</I>&gt;<i> native object system, like C++, Obj-C, or GObject.
</I>&gt;<i>
</I>
Well, ld is our friend here.  You can pretty much do any sort of linking you
want, given the right linker script.

And embedding a wee stub to load mono should be easy enough.


&gt;<i> &gt; Also, not having looked at the Mono PE loader (in depth), I don't know
</I>&gt;<i> how
</I>&gt;<i> &gt; hard it would be to abstract the container format away from reading
</I>&gt;<i> &gt; metadata.  And after having glanced at it just now - it doesn't look
</I>&gt;<i> /too/
</I>&gt;<i> &gt; horrendous.
</I>&gt;<i>
</I>&gt;<i> Would this really be necessary? Wouldn't it be cleaner if the
</I>&gt;<i> ELF/Mach-o binary just linked with libMono and we exposed a native
</I>&gt;<i> entry point that would use the Mono embedding APIs to call the managed
</I>&gt;<i> Main method?
</I>&gt;<i>
</I>
Hmm, I think probably yes, because at some point Mono still needs to read
the metadata header, and associated metadata tables, which means it'll need
to do a bit o' parsing to get the location of those structures into memory.
 Provided, however, the metadata format is kept exactly the same, then all
that would need to happen is to locate the start of the metadata header, and
(luckily) all the metadata just follows that.


&gt;<i> This does, indeed sound like quite an interesting exercise.
</I>&gt;<i>
</I>&gt;<i> Best,
</I>&gt;<i>
</I>&gt;<i> Alex Corrado
</I>&gt;<i>
</I>
-- 
Tom Spink
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110709/e632ad1e/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110709/e632ad1e/attachment.html</A> 
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037811.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
	<LI>Next message: <A HREF="037813.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37812">[ date ]</a>
              <a href="thread.html#37812">[ thread ]</a>
              <a href="subject.html#37812">[ subject ]</a>
              <a href="author.html#37812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
