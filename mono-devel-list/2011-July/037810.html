<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mixed Mode Assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mixed%20Mode%20Assemblies&In-Reply-To=7EBB75CB-FE62-40F7-8C0D-679E9962EF56%40vt.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037809.html">
   <LINK REL="Next"  HREF="037811.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mixed Mode Assemblies</H1>
    <B>Tom Spink</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mixed%20Mode%20Assemblies&In-Reply-To=7EBB75CB-FE62-40F7-8C0D-679E9962EF56%40vt.edu"
       TITLE="[Mono-dev] Mixed Mode Assemblies">tspink at gmail.com
       </A><BR>
    <I>Sat Jul  9 14:12:56 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037809.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
        <LI>Next message: <A HREF="037811.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37810">[ date ]</a>
              <a href="thread.html#37810">[ thread ]</a>
              <a href="subject.html#37810">[ subject ]</a>
              <a href="author.html#37810">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9 July 2011 18:57, Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>&gt; wrote:

&gt;<i> On Jul 9, 2011, at 1:06 PM, arkain wrote:
</I>&gt;<i> &gt; Here's another possibility. I don't see what the problem would be in
</I>&gt;<i> &gt; embedding ELF objects into a PE following the usual COFF objects. Doesn't
</I>&gt;<i> PE
</I>&gt;<i> &gt; have a text section that could be used to tag for extraction the native
</I>&gt;<i> &gt; portion of the assembly? If that were used, then it would be possible to
</I>&gt;<i> &gt; create a PE that contained COFF for the .NET  code and ELF for the native
</I>&gt;<i> &gt; code (on linux). The assembly loader in Linux could then extract the ELF
</I>&gt;<i> &gt; content into a separate file in a temp directory and load it with dlopen.
</I>&gt;<i>
</I>&gt;<i> That's only a halfway solution. One of the Nice Things about C++/CLI (and
</I>&gt;<i> COM interop, for that matter) is that native clients can load managed
</I>&gt;<i> assemblies without even realizing it [0]. Things Just Work because
</I>&gt;<i> LoadLibrary() loads a mixed-mode assembly the same way it loads any other
</I>&gt;<i> native library, and the loading app doesn't need to do anything differently.
</I>&gt;<i>
</I>&gt;<i> Consequently, what you really want is to embed IL/etc. into ELF/Mach-O/etc.
</I>&gt;<i> file formats, and add support to mono for these alternative file formats.
</I>&gt;<i> This would allow existing native code to continue to use dlopen(3)/etc.
</I>&gt;<i> against platform-native libraries which &quot;just happen&quot; to contain IL as well,
</I>&gt;<i> implicitly pulling in mono (via shared library dependencies, more or less
</I>&gt;<i> how things work with PE on Windows).
</I>&gt;<i>
</I>&gt;<i> This was previously discussed on this thread, and given that ELF allows
</I>&gt;<i> embedding ~arbitrary text/binary sections into .so files (and presumably
</I>&gt;<i> .dylib does as well), adding support for this likely wouldn't be _too_
</I>&gt;<i> difficult...
</I>&gt;<i>
</I>&gt;<i>  - Jon
</I>&gt;<i>
</I>
I agree with you here, Jon, and it sounds like quite an interesting
exercise.  Of course, one of the other interesting things here would be what
compiler do you use to generate a mixed-mode ELF?  Or, how do you embed IL
(and associated metadata) into your ELF - what process do you run to create
this combination ELF?

Also, not having looked at the Mono PE loader (in depth), I don't know how
hard it would be to abstract the container format away from reading
metadata.  And after having glanced at it just now - it doesn't look /too/
horrendous.

-- 
Tom Spink
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110709/28d11f87/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110709/28d11f87/attachment.html</A> 
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037809.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
	<LI>Next message: <A HREF="037811.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37810">[ date ]</a>
              <a href="thread.html#37810">[ thread ]</a>
              <a href="subject.html#37810">[ subject ]</a>
              <a href="author.html#37810">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
