<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mixed Mode Assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mixed%20Mode%20Assemblies&In-Reply-To=CAJasgkBqamy7xKa7Tojo9jXWk04uv%2ByEa31J%3DTLSWygsWnFw8g%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037859.html">
   <LINK REL="Next"  HREF="037845.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mixed Mode Assemblies</H1>
    <B>Ivo Smits</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mixed%20Mode%20Assemblies&In-Reply-To=CAJasgkBqamy7xKa7Tojo9jXWk04uv%2ByEa31J%3DTLSWygsWnFw8g%40mail.gmail.com"
       TITLE="[Mono-dev] Mixed Mode Assemblies">Ivo at UFO-Net.nl
       </A><BR>
    <I>Thu Jul 21 18:56:13 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037859.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
        <LI>Next message: <A HREF="037845.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37844">[ date ]</a>
              <a href="thread.html#37844">[ thread ]</a>
              <a href="subject.html#37844">[ subject ]</a>
              <a href="author.html#37844">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Op 20-7-2011 15:14, Tom Spink schreef:
&gt;<i> Hi Guys - if you're still watching this thread,
</I>&gt;<i>
</I>&gt;<i> So I may have done something brilliant - or something terrible.  I 
</I>&gt;<i> don't quite know yet - I need your feedback to see if I'm heading 
</I>&gt;<i> along the right lines.
</I>&gt;<i>
</I>&gt;<i> What I've done is to create a tool that creates a shared library with 
</I>&gt;<i> an embedded PE assembly inside.  The shared library exports symbols 
</I>&gt;<i> that pertain to methods of the assembly, and when you link against 
</I>&gt;<i> this shared library, in a native application, you can then call those 
</I>&gt;<i> methods, without having to bother with using Mono's embedding API.
</I>That doesn't give the full power of Mixed Mode assemblies, but I think 
it's definitely an interesting approach with many potential uses. 
Especially, I think, when replacing existing libraries or building 
plugins or extensions for existing software.

&gt;<i> Essentially, a bunch of method stubs are created that when called 
</I>&gt;<i> ensure the runtime is initialised, the assembly loaded (from inside 
</I>&gt;<i> the shared library) and then locate and call the appropriate method. 
</I>&gt;<i>  After the runtime has been loaded, the first few bytes of the method 
</I>&gt;<i> are overwritten with NOPs to ensure the runtime isn't loaded twice.
</I>I would rather skip the rewriting, and just start with a simple 'if 
(!initialized) initialize();' and leave the code unpatched. Doesn't cost 
much (especially considering the rest of the code) and works independent 
of the compiler/platform.

&gt;<i> The symbols exposed take the form of 'Namespace_Class_MethodName', 
</I>&gt;<i> which just works for static methods, but to call instance methods, you 
</I>&gt;<i> construct the class with a call to a 'new_Namespace_Class' function, 
</I>&gt;<i> then pass in the object instance as the first member.
</I>What happens if either the namespace or class name contains dots? Are 
they converted to underscores? Also, I think it might be interesting to 
be able to override these generated names, perhaps using (custom) code 
attributes, to help in replacing or implementing existing libraries, 
plugins, ... Attributes might also be useful to specify how variables 
should be marshaled.

Also, I think that eventually the 'reverse interop code' could be 
generated from an assembly file by using the Reflection framework. You 
could make the code generator a managed application.

--
Ivo
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037859.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
	<LI>Next message: <A HREF="037845.html">[Mono-dev] Mixed Mode Assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37844">[ date ]</a>
              <a href="thread.html#37844">[ thread ]</a>
              <a href="subject.html#37844">[ subject ]</a>
              <a href="author.html#37844">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
