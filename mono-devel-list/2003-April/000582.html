<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Reflection[.Emit] / Copy an Assembly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Reflection%5B.Emit%5D%20/%20Copy%20an%20Assembly&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000578.html">
   <LINK REL="Next"  HREF="000584.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Reflection[.Emit] / Copy an Assembly</H1>
    <B>Adam Chester</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Reflection%5B.Emit%5D%20/%20Copy%20an%20Assembly&In-Reply-To="
       TITLE="[Mono-devel-list] Reflection[.Emit] / Copy an Assembly">a.chester at sph.uq.edu.au
       </A><BR>
    <I>Mon Apr 28 14:26:14 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000578.html">[Mono-devel-list] Strategy for 1.0 and 1.1
</A></li>
        <LI>Next message: <A HREF="000584.html">[Mono-devel-list] Reflection[.Emit] / Copy an Assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#582">[ date ]</a>
              <a href="thread.html#582">[ thread ]</a>
              <a href="subject.html#582">[ subject ]</a>
              <a href="author.html#582">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Mono people,

For now, I'm attempting this on the MS runtime, sooner or later I need
to make it work on Mono.

Background:
I need to create a copy of a dynamic assembly (one created in memory),
however the copy must be modifiable first. That is, I need to add
properties and members and attributes to any System.Type in the newly
created copy of the original assembly. Then using Reflection.Emit (or
another API such as CodeDom+Compile) to create the new improved
assembly, which does not need to be saved to disk (but could be if
necessary).

Problem:
So, after various failed attempts at doing this, the only small problem
left now is that I need a way of copying the dynamic assembly's
metadata, in particular I am concerned about Custom Attributes. I would
need to get the attribute instantiation information, rather than the
more easily obtainable (from Reflection) instance of the custom
attribute.

In reflection, myType.GetCustomAttributes() returns an object array of
instances of the attributes, however this is not what I want. I need to
get the information necessary to to create (for example) a
System.Reflection.Emit.CustomAttributeBuilder, which generally means
I'll need to know which constructor was called on the attribute, and the
parameter values that were given to it.

You will see an example of the format in an MS-Generated assembly for a
custom attribute:

.custom instance void
[System.Xml]System.Xml.Serialization.XmlTypeAttribute::.ctor() = ( 01 00
02 00 54 0E 09 4E 61 6D 65 73 70 61 63 65   // ....T..Namespace ...

There is a constructor signature there, and some binary formatted data
which provides parameter values (presumably) to the constructor, so the
runtime can create instances of the attributes.

I need to take this custom attribute information out of a generated
dynamic assembly using reflection or some other mechanism, and then put
the same information into a
System.Reflection.Emit.CustomAttributeBuilder instance. There seems to
be allowance for doing this (Eg.
Module.SetCustomAttribute(System.Reflection.ConstructorInfo, byte[])),
but I don't quite understand the binary (byte[]) format necessary.

Thank you very much in advance for your help,

- Adam Chester


-----
Adam Chester (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">a.chester at sph.uq.edu.au</A>)
Computer Programmer / Database Developer
HISDU : <A HREF="http://www.sph.uq.edu.au/hisdu/">http://www.sph.uq.edu.au/hisdu/</A>
School of Population Health (<A HREF="http://www.sph.uq.edu.au">http://www.sph.uq.edu.au</A>)
University Of Queensland (<A HREF="http://www.uq.edu.au">http://www.uq.edu.au</A>)

Phone: +61 7 33655530
Mobile: +61 411 752520


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000578.html">[Mono-devel-list] Strategy for 1.0 and 1.1
</A></li>
	<LI>Next message: <A HREF="000584.html">[Mono-devel-list] Reflection[.Emit] / Copy an Assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#582">[ date ]</a>
              <a href="thread.html#582">[ thread ]</a>
              <a href="subject.html#582">[ subject ]</a>
              <a href="author.html#582">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
