<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Socket Send/ReceiveTimeouts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Socket%20Send/ReceiveTimeouts&In-Reply-To=2FFC516B-65C0-11D7-BF97-003065FB2D72%40in.tum.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000270.html">
   <LINK REL="Next"  HREF="000275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Socket Send/ReceiveTimeouts</H1>
    <B>Aleksey Demakov</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Socket%20Send/ReceiveTimeouts&In-Reply-To=2FFC516B-65C0-11D7-BF97-003065FB2D72%40in.tum.de"
       TITLE="[Mono-devel-list] Socket Send/ReceiveTimeouts">avd at openlinksw.com
       </A><BR>
    <I>Thu Apr  3 08:57:53 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000270.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
        <LI>Next message: <A HREF="000275.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#271">[ date ]</a>
              <a href="thread.html#271">[ thread ]</a>
              <a href="subject.html#271">[ subject ]</a>
              <a href="author.html#271">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias Sessler wrote:
&gt;<i> 
</I>&gt;<i> The second option would be to only abort the thread which is waiting for 
</I>&gt;<i> the send/receive. Is this possible with mono? The ms framework would 
</I>&gt;<i> abort the thread after send/receive method would return.
</I>&gt;<i> 
</I>
I don't think there's any need for timers, threads and such. There is
very wonderful poll method which does the trick quite well. At the
application level you could write something like this:

if (false == socket.Poll (microSeconds, SelectMode.SelectRead))
{
	socket.Close ();
	throw new Exception ();
}
socket.Receive (...);

As compared to the use of timeout socket option (when it's actually
supported) this has only slight disadvantage that you have two system
calls per a read instead of one. This might matter only for very busy
server applications which probably would use select anyway for i/o
multiplexing and most likely would be written in C :).

If you really want to fix the problem at the Mono level, I think
the best way for this is to change the SetSocketOption_internal,
Receive_internal, and Send_internal methods in the following way:

- SetSocketOption_internal calls setsockopt() for SO_RCVTIMEO
   and SO_SNDTIMEO options in case they are supported by the system,
   otherwise store them somewhere.
- In case timeout options are supported Receive_internal/Send_internal 

   call recv()/send() immediately, otherwise if a timeout option was set
   first call select() and throw an exception in case of timeout.

Regards,
Aleksey

&gt;<i> Does anyone know how java does this on linux?
</I>&gt;<i> 
</I>&gt;<i> regards
</I>&gt;<i> /matthias
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000270.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
	<LI>Next message: <A HREF="000275.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#271">[ date ]</a>
              <a href="thread.html#271">[ thread ]</a>
              <a href="subject.html#271">[ subject ]</a>
              <a href="author.html#271">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
