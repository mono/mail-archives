<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Socket Send/ReceiveTimeouts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Socket%20Send/ReceiveTimeouts&In-Reply-To=3E8BE55C.5040507%40openlinksw.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000268.html">
   <LINK REL="Next"  HREF="000270.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Socket Send/ReceiveTimeouts</H1>
    <B>Matthias Sessler</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Socket%20Send/ReceiveTimeouts&In-Reply-To=3E8BE55C.5040507%40openlinksw.com"
       TITLE="[Mono-devel-list] Socket Send/ReceiveTimeouts">sessler at in.tum.de
       </A><BR>
    <I>Thu Apr  3 05:17:07 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000268.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
        <LI>Next message: <A HREF="000270.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#269">[ date ]</a>
              <a href="thread.html#269">[ thread ]</a>
              <a href="subject.html#269">[ subject ]</a>
              <a href="author.html#269">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>hi
&gt;<i> I'm sorry, is it correct that this code closes the socket
</I>&gt;<i> on send or receive timeout? If so I don't think that's
</I>&gt;<i> right. I believe that on systems that do support setting of
</I>&gt;<i> SO_RCVTIMEO and SO_SNDTIMEO the way to go is obviously to
</I>&gt;<i> employ these options. On systems that do not support these
</I>&gt;<i> I would call select or poll with appropriate timeout just
</I>&gt;<i> before send/recv.
</I>I don't know how other systems work with these settings, but from what 
i tested, the ms .net framework closes the socket, after a timeout 
appears.
A solution would be to try to set these settings and if a Exception is 
thrown, use my code. But this would result in different behaivour on 
different mono plattforms which sould at least be documented if not 
prohibited.

&gt;<i> Additionally, although I didn't analyze the code carefully
</I>&gt;<i> enough, it looks like it might be a subject to race conditions.
</I>I hope not. These are the scenarios that i considered:

1. Timeout apears while socket is waiting:
- timeout method closes the socket, Exception is thrown, everything is 
fine.

2. Timeout apears after the internal socket method returned.
2.1 the DisableTimeout method is first to lock the timer object
- the timeout is disabled, and a TimeoutActive is set to false (this is 
set to true in the InitTimeout methods)
- then the OnTimeout method acquires the lock and because TimeoutActive 
is false, the socket will not be closed
- the method returns correct

2.2 the OnTimeout method is first to lock the timer object
- the OnTimeout method closes the socket
- then the DisableTimeout method acquires the lock and because the 
socket is closed, the method will throw a SocketException

3. The Timeout apears after the send/receive returned
- timeout is disabled everything is fine.

If i missed something please tell me.

The only downside is 2.2 where you got the result, but have to throw it 
away. I found know way to perhibit this. At least it returns a correct 
(Exception and socket closed/value and sockte open) to the upper level.

regards
/matthias


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000268.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
	<LI>Next message: <A HREF="000270.html">[Mono-devel-list] Socket Send/ReceiveTimeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#269">[ date ]</a>
              <a href="thread.html#269">[ thread ]</a>
              <a href="subject.html#269">[ subject ]</a>
              <a href="author.html#269">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
