<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PROPOSAL] gendarme - support for displaying	the	source code of violations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPROPOSAL%5D%20gendarme%20-%20support%20for%20displaying%0A%09the%09source%20code%20of%20violations&In-Reply-To=5ce88b280609271037m4fafa110lb6a2cff02bd635db%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020666.html">
   <LINK REL="Next"  HREF="020674.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PROPOSAL] gendarme - support for displaying	the	source code of violations</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPROPOSAL%5D%20gendarme%20-%20support%20for%20displaying%0A%09the%09source%20code%20of%20violations&In-Reply-To=5ce88b280609271037m4fafa110lb6a2cff02bd635db%40mail.gmail.com"
       TITLE="[Mono-dev] [PROPOSAL] gendarme - support for displaying	the	source code of violations">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Wed Sep 27 14:07:21 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020666.html">[Mono-dev] [PROPOSAL] gendarme - support for displaying the source code of violations
</A></li>
        <LI>Next message: <A HREF="020674.html">[Mono-dev] [PROPOSAL] gendarme - support for displaying the	source code of violations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20668">[ date ]</a>
              <a href="thread.html#20668">[ thread ]</a>
              <a href="subject.html#20668">[ subject ]</a>
              <a href="author.html#20668">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Christian,

Yes, it's definitively something coming for Gendarme :-)

JB and I discussed about this a few weeks ago when he committed this new
feature to SVN. We will resume this talk (and hopefully code) when we
meet at the Mono meeting in October.

[more inline]

On Wed, 2006-09-27 at 19:37 +0200, Christian Birkl wrote:
&gt;<i> Hi,
</I>&gt;<i>  
</I>&gt;<i> currently gendarme just displays TypeName::MethodName::Offset of
</I>&gt;<i> violations. This results for example in the following output:
</I>&gt;<i>  
</I>&gt;<i> [snip]
</I>&gt;<i> 1. NewLineLiteralRule
</I>&gt;<i> 
</I>&gt;<i> Problem: The method 'System.Void
</I>&gt;<i> Mono.Xml.MiniParser::Parse(Mono.Xml.MiniParser/IReader,Mono.Xml.MiniParser/IHandler)' use some literal values for new lines (e.g. \r\n) which aren't portable across operating systems.
</I>&gt;<i> 
</I>&gt;<i> Details:
</I>&gt;<i>   Mono.Xml.MiniParser::Parse:00b5
</I>&gt;<i> 
</I>&gt;<i> [/snip]
</I>&gt;<i> 
</I>&gt;<i> Thanks to Jb Mono.Cecil has support of reading debug files of MS.NET
</I>&gt;<i> (pdb) and mono (mdb). With just a few lines of code we can embed this
</I>&gt;<i> feature into gendarme. I've &quot;hacked&quot; together a sample implementation
</I>&gt;<i> which  produces the following output: 
</I>&gt;<i> 
</I>&gt;<i> [snip]
</I>&gt;<i> 
</I>&gt;<i> 1. NewLineLiteralRule
</I>&gt;<i> 
</I>&gt;<i> Problem: The method 'System.Void
</I>&gt;<i> Mono.Xml.MiniParser::Parse(Mono.Xml.MiniParser/IReader,Mono.Xml.MiniParser/IHandler)' use some literal values for new lines (e.g. \r\n) which aren't portable across operating systems.
</I>&gt;<i> 
</I>&gt;<i> Details:
</I>&gt;<i>   Mono.Xml.MiniParser::Parse:00b5: Found string: &quot;&lt;&gt;/?=&amp;'&quot;![ ]  \r\n&quot;
</I>&gt;<i>   Source Text:
</I>&gt;<i> 
</I>&gt;<i>                                 int charCode = &quot;&lt;&gt;/?=&amp;'\&quot;![ ]\t\r
</I>&gt;<i> \n&quot;.IndexOf((char)currCh) &amp; 0xF;
</I>&gt;<i> --------------------------------^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 
</I>&gt;<i>                                 if (charCode == (int)CharKind.CR)
</I>&gt;<i> continue; // ignore
</I>&gt;<i> 
</I>&gt;<i> [/snip]
</I>&gt;<i> 
</I>&gt;<i> The changes for supporting this stuff aren't a big deal, but since I
</I>&gt;<i> haven't worked with Mono.Cecil.Mdb and/or Mono.Cecil.Pdb I'd like to
</I>&gt;<i> hear what other might think about this implementation:
</I>&gt;<i> 
</I>&gt;<i> 1) Add Runner::LoadDebugInfos (AssemblyDefinition, string fileName):
</I>&gt;<i> 
</I>&gt;<i>   private Hashtable symbolReaders = new Hashtable ();
</I>&gt;<i> 
</I>&gt;<i>   public void LoadDebugInfos (AssemblyDefinition ad, string fileName)
</I>&gt;<i> {
</I>&gt;<i>    symbolReaders.Clear ();
</I>&gt;<i> 
</I>&gt;<i>    ISymbolStoreFactory factory = GetSymbolStoreFactory (fileName);
</I>&gt;<i>    if (factory == null)
</I>&gt;<i>     return;
</I>&gt;<i>    
</I>&gt;<i>    foreach (ModuleDefinition md in ad.Modules) {    
</I>&gt;<i>     symbolReaders [md] = factory.CreateReader (md, fileName);
</I>&gt;<i>    }   
</I>&gt;<i>   }
</I>&gt;<i> 
</I>&gt;<i>   private ISymbolStoreFactory GetSymbolStoreFactory (string fileName)
</I>&gt;<i> {   
</I>&gt;<i>    string pdbFileName = Path.ChangeExtension (fileName, &quot;pdb&quot;);
</I>&gt;<i>    if (File.Exists (pdbFileName)) {    
</I>&gt;<i>     return new Mono.Cecil.Pdb.PdbFactory ();
</I>&gt;<i>    }
</I>&gt;<i> 
</I>&gt;<i>    string mdbFileName = Path.ChangeExtension (fileName, &quot;mdb&quot;);
</I>&gt;<i>    if (File.Exists (mdbFileName)) {
</I>&gt;<i>     return new Mono.Cecil.Mdb.MdbFactory ();
</I>&gt;<i>    }
</I>&gt;<i>    
</I>&gt;<i>    return null;
</I>&gt;<i>   }
</I>&gt;<i> 
</I>&gt;<i> 3) Add reading code to the foreach loop in Runner::Process to read
</I>&gt;<i> debugging infos (if available)
</I>&gt;<i> 
</I>&gt;<i> 4) Change Location.cs and add a new Constructor (MethodDeclaration,
</I>&gt;<i> Instruction) to load the source text out of the SequencePoint of the
</I>&gt;<i> given instruction. Read in the file name specified in the document and
</I>&gt;<i> extract the source text beginning at StartLine. 
</I>&gt;<i> 
</I>&gt;<i> 5) Modify Runner(s) to display the new Source Text.
</I>&gt;<i> 
</I>&gt;<i> Any ideas how this can be easier/better/... done? Should there be a
</I>&gt;<i> command line flag to specifiy where to search for debug files or to
</I>&gt;<i> enable/disable debug symbol resolving? Does this really belong into
</I>&gt;<i> the framework or is it something each runner need to implement on its
</I>&gt;<i> own? 
</I>
I haven't (yet) looked at the new Cecil code, nor where it would be best
to implement it (framework versus runner). Please feel free to
experiment (and report to the list) with the feature until the API
freeze (and that JB release a version of Cecil with it).

One thing for sure we need this feature to works in future GUI runners,
e.g. imagine a Gendarme plugin for MonoDevelop where you can
double-click any defect and see the exact line to fix :-)

&gt;<i> BTW - It seems like &quot;Mono.Cecil.Pdb&quot; and &quot;Mono.Cecil.Mdb&quot; aren't part
</I>&gt;<i> of the &quot;official&quot; Mono.Cecil package - at least they aren't download
</I>&gt;<i> able from the cecil homepage. Are they intended to be used by other
</I>&gt;<i> applications yet? 
</I>
AFAIK no Cecil version has been released since the new assemblies were
added in SVN (so you can't download them). Also I'm not sure if (or
when) their API will be frozen.

&gt;<i> Christian
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>-- 
Sebastien Pouliot  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&gt;
Blog: <A HREF="http://pages.infinit.net/ctech/">http://pages.infinit.net/ctech/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020666.html">[Mono-dev] [PROPOSAL] gendarme - support for displaying the source code of violations
</A></li>
	<LI>Next message: <A HREF="020674.html">[Mono-dev] [PROPOSAL] gendarme - support for displaying the	source code of violations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20668">[ date ]</a>
              <a href="thread.html#20668">[ thread ]</a>
              <a href="subject.html#20668">[ subject ]</a>
              <a href="author.html#20668">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
