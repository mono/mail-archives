<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Howto improve Error-Messages of GDI-Functions?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Howto%20improve%20Error-Messages%20of%20GDI-Functions%3F&In-Reply-To=200702281942.44333.latency%40gmx.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022681.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Howto improve Error-Messages of GDI-Functions?</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Howto%20improve%20Error-Messages%20of%20GDI-Functions%3F&In-Reply-To=200702281942.44333.latency%40gmx.de"
       TITLE="[Mono-dev] Howto improve Error-Messages of GDI-Functions?">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Wed Feb 28 14:58:30 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022681.html">[Mono-dev] Howto improve Error-Messages of GDI-Functions?
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22682">[ date ]</a>
              <a href="thread.html#22682">[ thread ]</a>
              <a href="subject.html#22682">[ subject ]</a>
              <a href="author.html#22682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

On Wed, 2007-02-28 at 19:42 +0100, <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">latency at gmx.de</A> wrote:
&gt;<i> I recently ran into a problem where Bitmap.GetPixel(int, int) threw 
</I>&gt;<i> ArgumentException with the Message: &quot;Invalid Parameter. A null reference or 
</I>&gt;<i> invalid value was found.&quot;
</I>&gt;<i> 
</I>&gt;<i> As you can image, that does not help at all when debugging your application.
</I>
It may not be precise but it's hardly not helping &quot;at all&quot; !?!

I'm sure people doing C find this very helpful when compared to
functions that would return a BOOL or void. I know I do ;-) even if an
error code is primitive compared to a nice stack trace with source code
line numbers.

&gt;<i> Therefore I've made a quick fix which helped me to have a better exception 
</I>&gt;<i> message (btw. the path implements behavior which is specified in MS 
</I>&gt;<i> documentation of GetPixel),
</I>
Don't trust documentation as it's often incorrect. The only way to be
sure about the errors/exceptions are to write a few unit tests. 

The first ones for the managed Bitmap.GetPixel method (which will
confirm which exception should be thrown) and next for the unmanaged
(wrapped) GDI+ function, GdipBitmapGetPixel.

The goal is to both exception type (System.Drawing.dll) and error code
(libgdiplus) compatible with MS implementation.

&gt;<i>  but still, is there a way to improve the 
</I>&gt;<i> exceptions messages of gdi+ in general? 
</I>
All GDI+ functions return a GpStatus (int) with *very* generic (and
often misleading) error codes. This results get mapped into an exception
by System.Drawing - however the message can't describe the specifics of
the error.

It has been suggested to add a few functions in libgdiplus to keep more
information about errors, which our System.Drawing.dll could use to
retrieve more meaningful exception messages.

However this leads to other issues. It wouldn't work under Windows (not
that I really mind this one), it would require us, someday, to add
localization to libgdiplus (so far this isn't required for anything
else), it requires to add code (and strings) to every function in
libgdiplus (yuck) and, finally, it's not a complete solution as it
doesn't cover all cases (e.g. errors coming from Cairo won't have any
more information).

Another approach would be to duplicate the GDI+ checks in
System.Drawing.dll and throw exceptions with more useful messages. We
already do that in some cases, where we don't have the choice (*), but
in general we avoid double checks.

(*) e.g. if the GpStatus doesn't map to the thrown exception - which is
where the unit tests come handy

&gt;<i> Or do we have to do what I've done with GetPixel?
</I>
It depends. Like I said some times we just don't have the choice.
Generally this indicates that MS does the (same) check(s) in both
System.Drawing.dll and GDI+ (uncommon) and we can (well must for
compatibility) throw the same exception type (and are free to use a more
meaningful error message).


As for your patch, please provide unit tests showing the documented
behavior is the correct one and I'll commit them (fix+tests) to SVN.

Thanks,
Sebastien

&gt;<i> 
</I>&gt;<i> Kind Regards,
</I>&gt;<i> Valentin S.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>-- 
Sebastien Pouliot  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&gt;
Blog: <A HREF="http://pages.infinit.net/ctech/">http://pages.infinit.net/ctech/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022681.html">[Mono-dev] Howto improve Error-Messages of GDI-Functions?
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22682">[ date ]</a>
              <a href="thread.html#22682">[ thread ]</a>
              <a href="subject.html#22682">[ subject ]</a>
              <a href="author.html#22682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
