<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use	locale-dependent decimal separator
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20ASP.NET%20-%20make%20FontUnit%20NOT%20use%0A%09locale-dependent%20decimal%20separator&In-Reply-To=20070212143227.1a1aa2a0%40beowulf">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022509.html">
   <LINK REL="Next"  HREF="022532.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use	locale-dependent decimal separator</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20ASP.NET%20-%20make%20FontUnit%20NOT%20use%0A%09locale-dependent%20decimal%20separator&In-Reply-To=20070212143227.1a1aa2a0%40beowulf"
       TITLE="[Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use	locale-dependent decimal separator">gert.driesen at telenet.be
       </A><BR>
    <I>Mon Feb 12 16:02:28 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022509.html">[Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use locale-dependent decimal separator
</A></li>
        <LI>Next message: <A HREF="022532.html">[Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use locale-dependent decimal separator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22531">[ date ]</a>
              <a href="thread.html#22531">[ thread ]</a>
              <a href="subject.html#22531">[ subject ]</a>
              <a href="author.html#22531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Marek Habersack [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendello at gmail.com</A>]
</I>&gt;<i> Sent: maandag 12 februari 2007 14:32
</I>&gt;<i> To: Gert Driesen
</I>&gt;<i> Cc: 'Mono Development List'
</I>&gt;<i> Subject: Re: [Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use locale-
</I>&gt;<i> dependent decimal separator
</I>&gt;<i> 
</I>&gt;<i> On Sat, 10 Feb 2007 14:28:54 +0100, &quot;Gert Driesen&quot;
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at telenet.be</A>&gt;
</I>&gt;<i> scribbled:
</I>&gt;<i> 
</I>&gt;<i> &gt; &gt; -----Original Message-----
</I>&gt;<i> &gt; &gt; From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; [mailto:mono-devel-list- <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of
</I>&gt;<i> &gt; &gt; Marek Habersack
</I>&gt;<i> &gt; &gt; Sent: zaterdag 10 februari 2007 6:20
</I>&gt;<i> &gt; &gt; To: Mono Development List
</I>&gt;<i> &gt; &gt; Subject: [Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use locale-
</I>&gt;<i> &gt; &gt; dependent decimal separator
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Hello,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;   The attached diff fixes the issue mentioned in the subject.
</I>&gt;<i> &gt; &gt; Currently mono will fail to parse font-size=0.Xem (etc) correctly
</I>&gt;<i> if
</I>&gt;<i> &gt; &gt; the current thread culture is set to a locale that uses , as the
</I>&gt;<i> &gt; &gt; decimal point separator (e.g. de, pl). Please review, thanks
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This does not match the MS behavior. I've added a unit test to
</I>&gt;<i> &gt; FontUnitTest.cs to verify this, and fixed FontUnit.ToString() to use
</I>&gt;<i> &gt; the current locale.
</I>&gt;<i> Alas, this doesn't fix the problem. Please run xsp2 with the attached
</I>&gt;<i> test file
</I>&gt;<i> - you will get an exception thrown, because the Unit constructor cannot
</I>&gt;<i> parse the passed 0.9em value with cultures which have a decimal
</I>&gt;<i> separator different to a dot. In other words, Unit (and FontUnit) in
</I>&gt;<i> mono right now expect culture-dependent input while it gets the CSS
</I>&gt;<i> decimal font size, which will always use the dot as a separator.
</I>&gt;<i> ASP.NET parser uses the FontUnit(string) constructor - and that one, in
</I>&gt;<i> turn, invokes the FontUnit(string, CultureInfo) one. By saying that the
</I>&gt;<i> behavior is not MS-compatible, are you claiming that Microsoft parse
</I>&gt;<i> the 0.9em value and turn it into locale-specific form (e.g.
</I>&gt;<i> 0,9em) before passing it to the first FontUnit constructor above?
</I>
Apparently, MS uses FontUnitConverter.ConvertFromInvariantString to parse
the value:

[FormatException]: The numeric part ('3,5') of '3,5em' cannot be parsed as a
numeric part of a Em unit.
   at System.Web.UI.WebControls.Unit..ctor(String value, CultureInfo
culture, UnitType defaultType)
   at System.Web.UI.WebControls.FontUnit..ctor(String value, CultureInfo
culture)
   at System.Web.UI.WebControls.FontUnit.Parse(String s, CultureInfo
culture)
   at
System.Web.UI.WebControls.FontUnitConverter.ConvertFrom(ITypeDescriptorConte
xt context, CultureInfo culture, Object value)
   at System.ComponentModel.TypeConverter.ConvertFromInvariantString(String
text)
   at System.Web.UI.PropertyConverter.ObjectFromString(Type objType,
MemberInfo propertyInfo, String value)
   at System.Web.UI.PropertySetter.AddPropertyInternal(String name, String
value, ControlBuilder builder, Boolean fItemProp)
   at System.Web.UI.ControlBuilder.PreprocessAttribute(String attribname,
String attribvalue)
   at System.Web.UI.ControlBuilder.PreprocessAttributes(IDictionary attribs)
   at System.Web.UI.ControlBuilder.Init(TemplateParser parser,
ControlBuilder parentBuilder, Type type, String tagName, String id,
IDictionary attribs)
   at System.Web.UI.ControlBuilder.CreateBuilderFromType(TemplateParser
parser, ControlBuilder parentBuilder, Type type, String tagName, String id,
IDictionary attribs, Int32 line, String sourceFileName)
   at System.Web.UI.ControlBuilder.CreateChildBuilder(String tagName,
IDictionary attribs, TemplateParser parser, ControlBuilder parentBuilder,
String id, Int32 line, String sourceFileName, Type&amp; childType)
   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp;
completedSynchronously)
   at System.Web.UI.TemplateParser.ProcessBeginTag(Match match, String
inputText)
   at System.Web.UI.TemplateParser.ParseStringInternal(String text)
   at System.Web.UI.TemplateParser.ParseString(String text, String
virtualPath, String basePhysicalDir)

Gert



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022509.html">[Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use locale-dependent decimal separator
</A></li>
	<LI>Next message: <A HREF="022532.html">[Mono-dev] [PATCH] ASP.NET - make FontUnit NOT use locale-dependent decimal separator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22531">[ date ]</a>
              <a href="thread.html#22531">[ thread ]</a>
              <a href="subject.html#22531">[ subject ]</a>
              <a href="author.html#22531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
