<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Methods implementing interfaces are emitted twice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Methods%20implementing%20interfaces%20are%20emitted%20twice&In-Reply-To=20060529150504.B19D5D4012%40hoboe1bl1.telenet-ops.be">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018720.html">
   <LINK REL="Next"  HREF="018721.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Methods implementing interfaces are emitted twice</H1>
    <B>Zac Bowling</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Methods%20implementing%20interfaces%20are%20emitted%20twice&In-Reply-To=20060529150504.B19D5D4012%40hoboe1bl1.telenet-ops.be"
       TITLE="[Mono-dev] Methods implementing interfaces are emitted twice">zac at zacbowling.com
       </A><BR>
    <I>Mon May 29 20:31:07 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018720.html">[Mono-dev] Methods implementing interfaces are emitted twice
</A></li>
        <LI>Next message: <A HREF="018721.html">AW: [Mono-dev] Umlaute/special Chars
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18725">[ date ]</a>
              <a href="thread.html#18725">[ thread ]</a>
              <a href="subject.html#18725">[ subject ]</a>
              <a href="author.html#18725">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>One is just an implicate interface override and the other is just an
override on object's version of to string. There really isn't any harm
in having the two versions since they both do the same thing but its
easily fixable. 

But if you they did do something different you could access the the
IConvertable version by casting it to that interface to
(somestring.ToString(..) instead of
((IConvertable)something).ToString(..)). 

It's completely reproducible outside of mscorlib if you do something
like

public class MyStuff : IConvertable
{
...
   public override string ToString(FormatProvider fm)
   { 
     ...
   }

   string IConvertable.ToString(FormatProvider fm)
   {
     ... 
   }
...
} 

On Mon, 2006-05-29 at 17:05 +0200, Gert Driesen wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I noticed that methods that implement an interface member are emitted twice
</I>&gt;<i> by mcs: once as a normal method and once as an explicit inteface
</I>&gt;<i> implementation. 
</I>&gt;<i> 
</I>&gt;<i> For example, take a look at the IL for System.String in mscorlib. It
</I>&gt;<i> contains the following methods:
</I>&gt;<i> 
</I>&gt;<i>     // method line 741
</I>&gt;<i>     .method private final  virtual  hidebysig  newslot 
</I>&gt;<i>            instance default string System.IConvertible.ToString (class
</I>&gt;<i> System.IFormatProvider format)  cil managed 
</I>&gt;<i>     {
</I>&gt;<i>         // Method begins at RVA 0xa740
</I>&gt;<i> 	.override class System.IConvertible::ToString
</I>&gt;<i> 	// Code size 2 (0x2)
</I>&gt;<i> 	.maxstack 8
</I>&gt;<i> 	IL_0000:  ldarg.0 
</I>&gt;<i> 	IL_0001:  ret 
</I>&gt;<i>     } // end of method String::instance default string
</I>&gt;<i> System.IConvertible.ToString (class System.IFormatProvider format) 
</I>&gt;<i> 
</I>&gt;<i>     .method public hidebysig 
</I>&gt;<i>            instance default string ToString (class System.IFormatProvider
</I>&gt;<i> provider)  cil managed 
</I>&gt;<i>     {
</I>&gt;<i>         // Method begins at RVA 0xb7ec
</I>&gt;<i> 	// Code size 2 (0x2)
</I>&gt;<i> 	.maxstack 8
</I>&gt;<i> 	IL_0000:  ldarg.0 
</I>&gt;<i> 	IL_0001:  ret 
</I>&gt;<i>     } // end of method String::instance default string ToString (class
</I>&gt;<i> System.IFormatProvider provider) 
</I>&gt;<i> 
</I>&gt;<i> while there should have only been this method:
</I>&gt;<i> 
</I>&gt;<i> 	.method public hidebysig newslot virtual final 
</I>&gt;<i>         	instance string  ToString(class System.IFormatProvider
</I>&gt;<i> provider) cil managed
</I>&gt;<i> 	{
</I>&gt;<i> 	  .maxstack  8
</I>&gt;<i> 	  IL_0000:  ldarg.0
</I>&gt;<i> 	  IL_0001:  ret
</I>&gt;<i> 	}
</I>&gt;<i> 
</I>&gt;<i> Problem is that I can only see evidence of this in mscorlib, and I cannot
</I>&gt;<i> reproduce it using another custom-built assembly.
</I>&gt;<i> 
</I>&gt;<i> Can someone look into this ?
</I>&gt;<i> 
</I>&gt;<i> As a result of this issue, we get quite some bogus warnings in the class
</I>&gt;<i> status pages for the NET_1_1 profile
</I>&gt;<i> (<A HREF="http://mono.ximian.com/class-status/mono-HEAD-vs-fx-1-1/class-status-mscorl">http://mono.ximian.com/class-status/mono-HEAD-vs-fx-1-1/class-status-mscorl</A>
</I>&gt;<i> ib.html), as corcompare is complaining that the Mono methods are not virtual
</I>&gt;<i> final.
</I>&gt;<i> 
</I>&gt;<i> As for the class status page warnings: there's an easy workaround to get rid
</I>&gt;<i> of the warnings, but it would need a rebuild of the masterinfos for MS.NET.
</I>&gt;<i> 
</I>&gt;<i> Let me know if you want me to submit a patch for that workaround (but I'd
</I>&gt;<i> prefer a real fix for the issue instead).
</I>&gt;<i> 
</I>&gt;<i> Gert
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>-- 
Zac Bowling &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">zac at zacbowling.com</A>&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018720.html">[Mono-dev] Methods implementing interfaces are emitted twice
</A></li>
	<LI>Next message: <A HREF="018721.html">AW: [Mono-dev] Umlaute/special Chars
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18725">[ date ]</a>
              <a href="thread.html#18725">[ thread ]</a>
              <a href="subject.html#18725">[ subject ]</a>
              <a href="author.html#18725">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
