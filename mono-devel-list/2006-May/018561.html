<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] DES problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DES%20problem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018571.html">
   <LINK REL="Next"  HREF="018562.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] DES problem</H1>
    <B>Arnhoffer K&#225;roly</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DES%20problem&In-Reply-To="
       TITLE="[Mono-dev] DES problem">karnhoffer at ecron.hu
       </A><BR>
    <I>Fri May 12 05:36:11 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018571.html">[Mono-dev] A question about MS Office and Mono.
</A></li>
        <LI>Next message: <A HREF="018562.html">[Mono-dev] DES problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18561">[ date ]</a>
              <a href="thread.html#18561">[ thread ]</a>
              <a href="subject.html#18561">[ subject ]</a>
              <a href="author.html#18561">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've got a service application which uses encrypted data over network. My decrypting function gives different results with the same inputs on Mono which does not occour on .NET. The other mighty thing is that when I grab this function out of the service and test it in itself this problem does not happen again. What is wrong here?

My function looks as follows (test version):

    Friend Function DecryptDataDES(ByVal tbytaData As Byte(), ByVal tbytaDESKey As Byte(), ByVal tbytaDESIV As Byte(), ByRef tbytaDecryptedData As Byte()) As Boolean
        Dim lobjMemStream As MemoryStream
        Dim lobjCryptoStream As CryptoStream
        Dim lbytaDESKey As Byte()
        Dim lbytaDESIV As Byte()
        Try
            'console.writeline()
            ReDim lbytaDESKey(tbytaDESKey.Length - 1)
            ReDim lbytaDESIV(tbytaDESIV.Length - 1)
            tbytaDESKey.CopyTo(lbytaDESKey, 0)
            tbytaDESIV.CopyTo(lbytaDESIV, 0)

            Console.WriteLine(&quot;tbytaData: &quot; &amp; Convert.ToBase64String(tbytaData))
            Console.WriteLine(&quot;lbytaDESKey: &quot; &amp; Convert.ToBase64String(lbytaDESKey))
            Console.WriteLine(&quot;lbytaDESIV: &quot; &amp; Convert.ToBase64String(lbytaDESIV))

            'teszt
            If Not InitTripleDESCSP(lbytaDESKey, lbytaDESIV) Then
                'ak20050721: ha nem k&#233;nyszer&#237;tj&#252;k ki az &#250;jrainicializ&#225;l&#225;st, akkor linux/mono-n ugyanolyan bemenet mellett elt&#233;r&#337; eredm&#233;nyt fog
                'adni a DecryptDataDES f&#252;ggv&#233;ny. Emiatt InitTripleDESCSP(lbytaDESKey, lbytaDESIV) helyett InitTripleDESCSP(lbytaDESKey, lbytaDESIV, True)
                'szerepel a h&#237;v&#225;sban
                'console.writeline(&quot;Forced reinit...&quot;)
                'If Not InitTripleDESCSP(lbytaDESKey, lbytaDESIV, True) Then
                'mobjApp.Errors.Add(mstrResName, CommErrEnum.CantDecryptDataDES, , , &quot;InitTripleDESCSP&quot;).Raise()
                Console.WriteLine(&quot;InitTripleDESCSP failed&quot;)
            End If

            Console.WriteLine(&quot;lbytaDESKey: &quot; &amp; Convert.ToBase64String(lbytaDESKey))
            Console.WriteLine(&quot;lbytaDESIV: &quot; &amp; Convert.ToBase64String(lbytaDESIV))

            lobjMemStream = New MemoryStream()
            lobjCryptoStream = New CryptoStream(lobjMemStream, mobjDecryptTransform, CryptoStreamMode.Write)
            '&#205;r&#225;s k&#246;zben dek&#243;dolja az adatot
            lobjCryptoStream.Write(tbytaData, 0, tbytaData.Length)
            lobjCryptoStream.FlushFinalBlock()
            lobjCryptoStream.Close()    'e n&#233;lk&#252;l nem m&#369;k&#246;dik!!!
            'Kiolvassuk a dek&#243;dolt adatot
            tbytaDecryptedData = lobjMemStream.ToArray()

            Console.WriteLine(&quot;tbytaDecryptedData: &quot; &amp; Convert.ToBase64String(tbytaDecryptedData))

            Return True
        Catch ex As Exception
            Console.WriteLine(&quot;DecryptDataDES failed&quot;)
        Finally
            Try
                If Not lobjMemStream Is Nothing Then lobjMemStream.Close()
                If Not lobjCryptoStream Is Nothing Then lobjCryptoStream.Close()
            Catch
            End Try
        End Try
    End Function

Thanks!

K&#225;roly

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018571.html">[Mono-dev] A question about MS Office and Mono.
</A></li>
	<LI>Next message: <A HREF="018562.html">[Mono-dev] DES problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18561">[ date ]</a>
              <a href="thread.html#18561">[ thread ]</a>
              <a href="subject.html#18561">[ subject ]</a>
              <a href="author.html#18561">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
