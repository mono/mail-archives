<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] improved patch for ApplyTheme
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20improved%20patch%20for%20ApplyTheme&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018634.html">
   <LINK REL="Next"  HREF="018632.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] improved patch for ApplyTheme</H1>
    <B>Andrew Skiba</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20improved%20patch%20for%20ApplyTheme&In-Reply-To="
       TITLE="[Mono-dev] improved patch for ApplyTheme">andrews at mainsoft.com
       </A><BR>
    <I>Sun May 21 10:12:25 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018634.html">*****SPAM***** Re: [Mono-dev] typeof(Byte[]).GetInterfacesMap
</A></li>
        <LI>Next message: <A HREF="018632.html">[Mono-dev] RE: improved patch for ApplyTheme
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18631">[ date ]</a>
              <a href="thread.html#18631">[ thread ]</a>
              <a href="subject.html#18631">[ subject ]</a>
              <a href="author.html#18631">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, Chris.

Sorry for the late answer. Please look at the test in
sys.web/Tests/standalone/themes/PageLinks. On dotnet it outputs 

child.set_ImageUrl
child.OnInit
parent.set_ImageUrl
parent.OnInit
page.OnInit

The property setters set_ImageUrl are called when the theme is applied.

This is the output of unpatched sys.web:

page.OnInit
child.OnInit
parent.OnInit

In addition to the incorrect flow, this test shows the invalid behaviour
(missing image). After applying the patch, both the flow and the image
are fixed.

Here is how the flow changed. Was:

1. InitializeTheme + ApplyThemeRecursive (incorrect recursion, should be
in the same depth-first search as OnInit)
2. Init Recursive
3. ApplyMasterPage

As result, 'ApplyThemeRecursive' did not affect any controls related to
the master page feature. 

After the fix the flow became:

1. Initialize Theme
2. ApplyMasterPage
3. InitRecursive + ApplyTheme

As a result, when the theme is applied, all the controls are already
created.

When I started to trace the order of set_ImageUrl, I found a mistake in
my previous patch: first child.OnInit should be called, and only then
ApplyTheme. Anyway, it's easy to see that on dotnet ApplyTheme (however
it's named) is called during the same tree travel as OnInit.

If no one objects I will commit.

Andrew.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ApplyTheme.patch
Type: application/octet-stream
Size: 2026 bytes
Desc: ApplyTheme.patch
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060521/39ee0591/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060521/39ee0591/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018634.html">*****SPAM***** Re: [Mono-dev] typeof(Byte[]).GetInterfacesMap
</A></li>
	<LI>Next message: <A HREF="018632.html">[Mono-dev] RE: improved patch for ApplyTheme
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18631">[ date ]</a>
              <a href="thread.html#18631">[ thread ]</a>
              <a href="subject.html#18631">[ subject ]</a>
              <a href="author.html#18631">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
