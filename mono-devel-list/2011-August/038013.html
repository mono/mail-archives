<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] substantial performance regression between 2.10 and	2.6 or impl diff?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20substantial%20performance%20regression%20between%202.10%20and%0A%092.6%20or%20impl%20diff%3F&In-Reply-To=CACmR%2BBDM4h3_4B_UjeFfje4gOUpu-OVf1zYmrq_iHkOEdCJM5g%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038012.html">
   <LINK REL="Next"  HREF="038000.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] substantial performance regression between 2.10 and	2.6 or impl diff?</H1>
    <B>Jonathan Shore</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20substantial%20performance%20regression%20between%202.10%20and%0A%092.6%20or%20impl%20diff%3F&In-Reply-To=CACmR%2BBDM4h3_4B_UjeFfje4gOUpu-OVf1zYmrq_iHkOEdCJM5g%40mail.gmail.com"
       TITLE="[Mono-dev] substantial performance regression between 2.10 and	2.6 or impl diff?">jonathan.shore at gmail.com
       </A><BR>
    <I>Sat Aug 27 19:58:30 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="038012.html">[Mono-dev] substantial performance regression between 2.10 and	2.6 or impl diff?
</A></li>
        <LI>Next message: <A HREF="038000.html">[Mono-dev] substantial performance regression between 2.10 and	2.6 or impl diff?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38013">[ date ]</a>
              <a href="thread.html#38013">[ thread ]</a>
              <a href="subject.html#38013">[ subject ]</a>
              <a href="author.html#38013">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Here are the #s for ubuntu 11.4 on a core i7 box with different versions of mono.

Mono 2.6.7 (default Boehm GC)
struct sum: 5000089998356.48, time: 1.7 secs
class sum: 5000089998356.48, time: 9.5 secs

Mono 2.6.10 (default Boehm GC)
struct sum: 5000089998356.48, time: 1.7 secs
class sum: 5000089998356.48, time: 17.2 secs

Mono 2.6.10 (default Generational GC)
struct sum: 5000089998356.48, time: 1.7 secs
class sum: 5000089998356.48, time: 2.0 secs

The linux implementations seem to have the same performance across the struct-based benchmarks.   The default Boehm GC in 2.6.10 is about 2x slower than the implementation or parameters in 2.6.7.   Finally, the generational GC is more than 4x faster than the best Boehm GC time (for this trivial benchmark).

So I with gc=sgen, quite fine with the results.   I'm not sure if sgen is stable or not, but perhaps it should be the default on osx.   The osx performance is very poor (not shown here).


On Aug 27, 2011, at 7:09 PM, Rodrigo Kumpera wrote:

&gt;<i> There are a few points to note here.
</I>&gt;<i> 
</I>&gt;<i> Linux with the default GC is much faster than OSX since the laster can't use fast object allocation.
</I>&gt;<i> 
</I>&gt;<i> OSX 2.6 shipped with default parallel mark enabled on OSX, but it was later disabled due to bugs in boehm.
</I>&gt;<i> 
</I>&gt;<i> Given no one is actively working on boehm, this was the best option. My suggestion is that you try using the new GC
</I>&gt;<i> try running 2.10 with --gc=sgen. Performance will be substantially better for your test.
</I>&gt;<i>   
</I>&gt;<i> 
</I>&gt;<i> On Sat, Aug 27, 2011 at 2:27 PM, Jonathan Shore &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonathan.shore at gmail.com</A>&gt; wrote:
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I was doing some benchmarks of struct vs class based creation (I have an application that will generate millions of small objects).   I was doing the tests in a ubuntu 11.4 VM on my mac pro and found the following:
</I>&gt;<i> 
</I>&gt;<i> 	mono 2.6.7 was 4x faster on my linux VM than 2.10.4 running on OSX (same machine)
</I>&gt;<i> 
</I>&gt;<i> I don't know whether this may be because of one of the following:
</I>&gt;<i> 
</I>&gt;<i> - performance in 2.10.4 regressed vs 2.6.7
</I>&gt;<i> - mono JIT implementation for OSX has a completely different JiT codebase and does not perform
</I>&gt;<i> - difference in GC (only relevant for second part of the test)
</I>&gt;<i> 
</I>&gt;<i> Note that I tried this with separate compilations with mcs -optimize+  on both environments as well as running the same exe on both.
</I>&gt;<i> 
</I>&gt;<i> I can live with slower performance on OSX, but want to make sure that linux and windows versions of mono 2.10.x have the performance of 2.6.7 or better.
</I>&gt;<i> 
</I>&gt;<i> Can someone clue me in?   I've included the simple test code with this posting.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> Jonathan
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110827/baa7aae4/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110827/baa7aae4/attachment.html</A> 
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038012.html">[Mono-dev] substantial performance regression between 2.10 and	2.6 or impl diff?
</A></li>
	<LI>Next message: <A HREF="038000.html">[Mono-dev] substantial performance regression between 2.10 and	2.6 or impl diff?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38013">[ date ]</a>
              <a href="thread.html#38013">[ thread ]</a>
              <a href="subject.html#38013">[ subject ]</a>
              <a href="author.html#38013">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
