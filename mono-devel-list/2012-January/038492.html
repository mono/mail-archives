<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Reference queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Reference%20queue&In-Reply-To=%3C1327397646.1915.17.camel%40ubuntu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038491.html">
   <LINK REL="Next"  HREF="038493.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Reference queue</H1>
    <B>Konrad M. Kruczy&#324;ski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Reference%20queue&In-Reply-To=%3C1327397646.1915.17.camel%40ubuntu%3E"
       TITLE="[Mono-dev] Reference queue">konrad.kruczynski at gmail.com
       </A><BR>
    <I>Tue Jan 24 09:34:06 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="038491.html">[Mono-dev] Reference queue
</A></li>
        <LI>Next message: <A HREF="038493.html">[Mono-dev] Reference queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38492">[ date ]</a>
              <a href="thread.html#38492">[ thread ]</a>
              <a href="subject.html#38492">[ subject ]</a>
              <a href="author.html#38492">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,
I think I was misunderstood. This is not beginner's question on how to
write classes with Disposable pattern (you mentioned) -- believe me, I
know that very well. Problem is rather as follows. Let's say we have an
object whose life is short - it is collected on first GC scan after
creation. But then if it has a finalizer it is not collected. Instead,
it is marked for finalization. After some time its finalizer is called.
And it is finally collected after next GC scan - so much more later than
in the first case. Things will get worse if it will be promoted to next
generation in the meantime. In other words such kind of object with
finalizer will stay in memory longer than it should and that is the
source of performance problems I mentioned. It can also hold reference
to another (fully managed) objects, that one to another and so on.

This is well known problem with objects implementing finalizers and one
of the reasons (among unpredictability) for recommending explicit (via
Dispose) release. But how can one do that if object is shared (the thing
you would, for instance in C++, do with reference counting)? Finalizers
are best as back-ups for such release, not the main mean, as you have
written.

I think that callback after death mechanism is the solution here. About
the I/O operation invoked - I would not put it in the callback directly,
rather enqueue it in thread pool.

Oh, I've just found an article which talks about what I exactly meant:
<A HREF="http://www.bluebytesoftware.com/blog/2011/11/12/ABriefNoteOnObjectMortality.aspx">http://www.bluebytesoftware.com/blog/2011/11/12/ABriefNoteOnObjectMortality.aspx</A>
Apparently this is possible in Java. It could be therefore useful also
for IKVM, as it has to be provided by it. I do not know how it is
implemented in it currently - probably using small objects with
finalizers on which they make proper notifications.

I hope it is clearer now.

--
Regards,
 Konrad

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038491.html">[Mono-dev] Reference queue
</A></li>
	<LI>Next message: <A HREF="038493.html">[Mono-dev] Reference queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38492">[ date ]</a>
              <a href="thread.html#38492">[ thread ]</a>
              <a href="subject.html#38492">[ subject ]</a>
              <a href="author.html#38492">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
