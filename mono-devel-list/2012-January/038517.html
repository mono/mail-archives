<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono.Data.Sqlite performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Mono.Data.Sqlite%20performance&In-Reply-To=%3CF5377CC5-B35B-4515-B004-323264747E5A%40ritter.demon.co.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038516.html">
   <LINK REL="Next"  HREF="038518.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono.Data.Sqlite performance</H1>
    <B>David A Knight</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Mono.Data.Sqlite%20performance&In-Reply-To=%3CF5377CC5-B35B-4515-B004-323264747E5A%40ritter.demon.co.uk%3E"
       TITLE="[Mono-dev] Mono.Data.Sqlite performance">david at ritter.demon.co.uk
       </A><BR>
    <I>Fri Jan 27 18:40:22 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="038516.html">[Mono-dev] Mono.Data.Sqlite performance
</A></li>
        <LI>Next message: <A HREF="038518.html">[Mono-dev] MPAPI documentation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38517">[ date ]</a>
              <a href="thread.html#38517">[ thread ]</a>
              <a href="subject.html#38517">[ subject ]</a>
              <a href="author.html#38517">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27 Jan 2012, at 17:27, Robert Jordan wrote:

&gt;<i> On 27.01.2012 15:54, David A Knight wrote:
</I>&gt;&gt;<i> I have been looking at changing an iOS app over to using Monotouch
</I>&gt;&gt;<i> and run into an issue with Sqlite performance.  Writing some test
</I>&gt;&gt;<i> code (not running on a device) that just opens a database and does a
</I>&gt;&gt;<i> number of inserts (in a transaction) the performance difference
</I>&gt;&gt;<i> between C (using Core Foundation for unicode strings) and C# is
</I>&gt;&gt;<i> massive.  ~37k compared to ~14k inserts per second under MacOSX
</I>&gt;&gt;<i> (including the iOS simulator) / Linux.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Looking at Mono.Data.Sqlite I can't see any code that would cause
</I>&gt;&gt;<i> this and so have come to the conclusion (wrongly or rightly) that the
</I>&gt;&gt;<i> difference in performance is down to Sqlite functions being called
</I>&gt;&gt;<i> via P/Invoke and the overhead it causes.  Is there anything that can
</I>&gt;&gt;<i> be done to reduce this overhead that isn't already in place?  Am I
</I>&gt;&gt;<i> wrong that the difference is caused by the P/Invoke?
</I>&gt;<i> 
</I>&gt;<i> It's hard to say w/out a test case.
</I>&gt;<i> 
</I>&gt;<i> If you did not specify SqliteConnection's &quot;UseUTF16Encoding=true&quot;
</I>&gt;<i> option, the p/invoke layer would have to marshal strings  back and
</I>&gt;<i> forth between UTF-8 and UTF-16. This might add substantial overhead
</I>&gt;<i> to apps that need 37k transactions per second.
</I>

UTF-16, hence the use of Core Foundation for the C version.  Test code attached.  Timing is only of the inserts, not including the commit.  exception handling deliberately left out.  Loop times without inserts occurring, but still building the parameter string values are as good as identical between C and C#

-------------- next part --------------
A non-text attachment was scrubbed...
Name: speedtest.cs
Type: application/octet-stream
Size: 4293 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120127/b39ccbea/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120127/b39ccbea/attachment.obj</A>&gt;
-------------- next part --------------


It isn't so much needs 37k inserts per second, just that the drop in performance would look very bad.  On a device the figure (for C) is obviously lower, but given a similar drop in speed it isn't an acceptable user experience for me unfortunately.



David
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038516.html">[Mono-dev] Mono.Data.Sqlite performance
</A></li>
	<LI>Next message: <A HREF="038518.html">[Mono-dev] MPAPI documentation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38517">[ date ]</a>
              <a href="thread.html#38517">[ thread ]</a>
              <a href="subject.html#38517">[ subject ]</a>
              <a href="author.html#38517">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
