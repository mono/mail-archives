<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [Crosspost Ikvm-developers] Issues with JNI on Mono	(IKVM Trunk)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20%5BCrosspost%20Ikvm-developers%5D%20Issues%20with%20JNI%20on%20Mono%0A%09%28IKVM%20Trunk%29&In-Reply-To=%3CCAAWSfZPBz1beN-uVQ4FYT3fozA-pCB9U6RTSXT8BEUrsktHx8g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041762.html">
   <LINK REL="Next"  HREF="041763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [Crosspost Ikvm-developers] Issues with JNI on Mono	(IKVM Trunk)</H1>
    <B>Tommy Ettinger</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20%5BCrosspost%20Ikvm-developers%5D%20Issues%20with%20JNI%20on%20Mono%0A%09%28IKVM%20Trunk%29&In-Reply-To=%3CCAAWSfZPBz1beN-uVQ4FYT3fozA-pCB9U6RTSXT8BEUrsktHx8g%40mail.gmail.com%3E"
       TITLE="[Mono-dev] [Crosspost Ikvm-developers] Issues with JNI on Mono	(IKVM Trunk)">tommy.ettinger at gmail.com
       </A><BR>
    <I>Thu Jul 17 21:34:52 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041762.html">[Mono-dev] Hi System.xml.parse error in compiling mono
</A></li>
        <LI>Next message: <A HREF="041763.html">[Mono-dev] question about directory with white space
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41761">[ date ]</a>
              <a href="thread.html#41761">[ thread ]</a>
              <a href="subject.html#41761">[ subject ]</a>
              <a href="author.html#41761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was recommended by the author of IKVM to ask here about my Mono
incompatibility issue.  I'm using the latest IKVM with the natives
self-compiled for Linux 64-bit (not the ones shipped with Mono, which are
years out of date).  When I run an application (that I wrote) on on Windows
(7, 64-bit), it works fine, and prints this in the Output window of Visual
Studio: <A HREF="http://pastebin.com/u8GkwE2P">http://pastebin.com/u8GkwE2P</A> (mostly output from an App.config
trace switch, &lt;add name=&quot;jni&quot; value=&quot;4&quot; /&gt;).  I am not sure how to get the
same type of trace output on Mono, especially since it isn't printed to the
console on Windows.  The issue seems to be related to JNI failing at
runtime with IKVM on Mono, so being able to have the JNI information traced
would be handy.  I am running the application on Fedora 20, AMD64 (in a VM)
with the command:
MONO_LOG_LEVEL=debug mono CommandersUnite.exe
I don't have any typemaps for DLLs, and the application loads native code
at runtime via JNI.  Could this be a problem?  I've referenced the previous
list thread below.
Thank you for your time.

---------- Forwarded message ----------
From: Jeroen Frijters &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jeroen at sumatra.nl</A>&gt;
Date: Thu, Jul 17, 2014 at 1:06 AM
Subject: RE: [Ikvm-developers] Issues with JNI on Mono (IKVM Trunk)
To: Tommy Ettinger &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tommy.ettinger at gmail.com</A>&gt;
Cc: &quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ikvm-developers at lists.sourceforge.net</A>&quot; &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ikvm-developers at lists.sourceforge.net</A>&gt;


You should really ask on the Mono list about this. I don't know enough
about Mono on Linux, but this looks seriously broken.

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Tommy Ettinger [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tommy.ettinger at gmail.com</A>]
</I>&gt;<i> Sent: Wednesday, July 16, 2014 22:56
</I>&gt;<i> To: Jeroen Frijters
</I>&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ikvm-developers at lists.sourceforge.net</A>
</I>&gt;<i> Subject: Re: [Ikvm-developers] Issues with JNI on Mono (IKVM Trunk)
</I>&gt;<i>
</I>&gt;<i> Ah, figured out how to load the config on Mono.  I think.  Unfortunately
</I>&gt;<i> it gives a very different error: <A HREF="http://pastebin.com/GAsQyfA5">http://pastebin.com/GAsQyfA5</A> The
</I>&gt;<i> App.config is here
</I>&gt;<i> <A HREF="https://github.com/tommyettinger/CommandersUnite/blob/master/CU/CU/App.c">https://github.com/tommyettinger/CommandersUnite/blob/master/CU/CU/App.c</A>
</I>&gt;<i> onfig
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, Jul 16, 2014 at 1:30 PM, Tommy Ettinger
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tommy.ettinger at gmail.com</A> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tommy.ettinger at gmail.com</A>&gt; &gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       My last message was too long for the list, so here it is with
</I>&gt;<i> pastebin links.
</I>&gt;<i>       With those lines added to App.config, It gives the following output
</I>&gt;<i> on Windows 7 in Visual Studio's output window (and nothing new on Mono):
</I>&gt;<i>       Visual Studio output: <A HREF="http://pastebin.com/6Jpi5FxV">http://pastebin.com/6Jpi5FxV</A>
</I>&gt;<i>       Mono output: <A HREF="http://pastebin.com/BEMyAerk">http://pastebin.com/BEMyAerk</A>
</I>&gt;<i>
</I>&gt;<i>       Thanks for your speedy reply on this, IKVM worked brilliantly until
</I>&gt;<i> I tried to get it to run on Mono.  IKVM is a pretty incredible piece of
</I>&gt;<i> software.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       On Wed, Jul 16, 2014 at 6:01 AM, Jeroen Frijters &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jeroen at sumatra.nl</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jeroen at sumatra.nl</A>&gt; &gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               Hi Tommy,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               Can you try enabling JNI tracing by adding the following to
</I>&gt;<i> your app.config:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               &lt;system.diagnostics&gt;
</I>&gt;<i>
</I>&gt;<i>               &lt;switches&gt;
</I>&gt;<i>
</I>&gt;<i>               &lt;add name=&quot;jni&quot; value=&quot;4&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i>               &lt;/switches&gt;
</I>&gt;<i>
</I>&gt;<i>               &lt;/system.diagnostics&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               Regards,
</I>&gt;<i>
</I>&gt;<i>               Jeroen
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               From: Tommy Ettinger [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tommy.ettinger at gmail.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tommy.ettinger at gmail.com</A>&gt; ]
</I>&gt;<i>               Sent: Wednesday, July 16, 2014 14:00
</I>&gt;<i>               To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ikvm-developers at lists.sourceforge.net</A> &lt;mailto:ikvm-
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">developers at lists.sourceforge.net</A>&gt;
</I>&gt;<i>               Subject: [Ikvm-developers] Issues with JNI on Mono (IKVM
</I>&gt;<i> Trunk)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               I've been struggling for the last two days to port my C#
</I>IKVM
&gt;<i> application that uses the Java library libgdx to Linux.  The application
</I>&gt;<i> works just fine on Windows/.NET, but something is wrong with the linking
</I>&gt;<i> for JNI code AFAICT.  Using libgdx you have a choice of backends for how
</I>&gt;<i> to display graphics, one of which is LWJGL and one of which is JGLFW.
</I>&gt;<i> LWJGL failed on both 32- and 64-bit Linux (after I figured out how to
</I>&gt;<i> get it to load its dependencies from the right folder) with an
</I>&gt;<i> UnsatisfiedLinkError in
</I>&gt;<i> org.lwjgl.DefaultSysImplementation.getPointerSize()I , which (in the
</I>&gt;<i> LWJGL source) is a native method with no body in the .java file.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               JGLFW failed on 64-bit Linux (haven't built it on 32-bit)
</I>&gt;<i> with a different error, still in a native method:
</I>&gt;<i>
</I>&gt;<i>               java.lang.UnsatisfiedLinkError:
</I>&gt;<i> com/badlogic/jglfw/Glfw.glfwInitJni()Z
</I>&gt;<i>
</I>&gt;<i>                         at cli.IKVM.Runtime.JNI$Frame.GetFuncPtr(Unknown
</I>&gt;<i> Source)
</I>&gt;<i>
</I>&gt;<i>               I have had issues setting LD_LIBRARY_PATH on this machine (a
</I>&gt;<i> VM running Fedora 20, 64-bit; the VM is run by VirtualBox on Windows 7
</I>&gt;<i> 64-bit), and I believe java.library.path is unset, but the libraries are
</I>&gt;<i> all in the current folder (same as the exe).  My application is open
</I>&gt;<i> source and the latest code is at
</I>&gt;<i> <A HREF="https://github.com/tommyettinger/CommandersUnite/">https://github.com/tommyettinger/CommandersUnite/</A> and the only IKVM-
</I>&gt;<i> specific code is in
</I>&gt;<i> <A HREF="https://github.com/tommyettinger/CommandersUnite/blob/master/CU/CU/GameG">https://github.com/tommyettinger/CommandersUnite/blob/master/CU/CU/GameG</A>
</I>&gt;<i> DX.cs#L478 .  I built gdx-jglfw.dll using the command:
</I>&gt;<i>
</I>&gt;<i>               &quot;%IKVM_HOME%/ikvmc.exe&quot; -target:library -out:gdx-jglfw.dll -
</I>&gt;<i> sharedclassloader gdx.jar gdx-natives.jar gdx-backend-jglfw.jar gdx-
</I>&gt;<i> backend-jglfw-natives.jar
</I>&gt;<i>
</I>&gt;<i>               where %IKVM_HOME% evaluated to the bin directory of the
</I>&gt;<i> current trunk/head/master (latest) of the IKVM CVS on SourceForge (it
</I>&gt;<i> actually may have been the latest nightly from the IKVM weblog, it is a
</I>&gt;<i> version 8 or higher nightly).  That command was run on the libgdx 1.2.0
</I>&gt;<i> binary release.  I then extracted the dll and so files from the natives
</I>&gt;<i> jars, copied them into the project, and set them to copy into the
</I>&gt;<i> release directory.
</I>&gt;<i>
</I>&gt;<i>               So my question is, is there a bug in my code, or in IKVM,
</I>&gt;<i> here that can be fixed?  Does JNI work at all under Mono/Linux?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>               --
</I>&gt;<i>
</I>&gt;<i>               Thomas (Tommy) Ettinger
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       --
</I>&gt;<i>
</I>&gt;<i>       Thomas (Tommy) Ettinger
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Thomas (Tommy) Ettinger
</I>


-- 

Thomas (Tommy) Ettinger
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140717/2eaa06a0/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140717/2eaa06a0/attachment-0001.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041762.html">[Mono-dev] Hi System.xml.parse error in compiling mono
</A></li>
	<LI>Next message: <A HREF="041763.html">[Mono-dev] question about directory with white space
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41761">[ date ]</a>
              <a href="thread.html#41761">[ thread ]</a>
              <a href="subject.html#41761">[ subject ]</a>
              <a href="author.html#41761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
