<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mutex Bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Mutex%20Bug&In-Reply-To=%3Ce39764ce65eb44e4a41091b3f6f1f7fe%40BL2PR08MB451.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041702.html">
   <LINK REL="Next"  HREF="041705.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mutex Bug</H1>
    <B>Edward Ned Harvey (mono)</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Mutex%20Bug&In-Reply-To=%3Ce39764ce65eb44e4a41091b3f6f1f7fe%40BL2PR08MB451.namprd08.prod.outlook.com%3E"
       TITLE="[Mono-dev] Mutex Bug">edward.harvey.mono at clevertrove.com
       </A><BR>
    <I>Thu Jul  3 03:32:38 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041702.html">[Mono-dev] Mutex Bug
</A></li>
        <LI>Next message: <A HREF="041705.html">[Mono-dev] Mutex Bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41704">[ date ]</a>
              <a href="thread.html#41704">[ thread ]</a>
              <a href="subject.html#41704">[ subject ]</a>
              <a href="author.html#41704">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> From: Brandon Perry [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bperry.volatile at gmail.com</A>]
</I>&gt;<i> 
</I>&gt;<i> Do you *have* to write to the same file?
</I>
Yes.  Here is the situation:
<A HREF="https://tinhatrandom.org">https://tinhatrandom.org</A> 
An open source, MIT licensed class library aimed at improving crypto random available to the application developer...

One of the things we need to do is this:  Assuming we have collected a lot of good entropy from various entropy sources, save a good strong random seed file on disk.  Later, any number of applications may be launched, potentially at the same time, which need to read &amp; write the file, mutually exclusively.

The reason it needs to be one file, is because that's the whole point - If the user has already entered random keyboard input, random mouse input, and we gathered entropy from the internet, and RNGCryptoServiceProvider, and other sources, then every application launch shouldn't need to repeat that.  First one does it; everyone later benefits from it.

Right now, I believe, if I use FileMode.Open,  FileAccess.ReadWrite, and FileShare.None, that should work cross-platform to ensure only a single process may access the file at a time.  The process/thread that has the file lock can read the seed, write a new seed, and flush and close.  It will work reliably, I believe, for the first process that gets there, and to prevent any subsequent processes from accessing the same seed file before it is reseeded.  Any subsequent processes that fail to open the file (because another process already has it open) I think, will simply have to Sleep(1) and retry opening the file.  It's a little ghetto, but it should work AFAIK.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041702.html">[Mono-dev] Mutex Bug
</A></li>
	<LI>Next message: <A HREF="041705.html">[Mono-dev] Mutex Bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41704">[ date ]</a>
              <a href="thread.html#41704">[ thread ]</a>
              <a href="subject.html#41704">[ subject ]</a>
              <a href="author.html#41704">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
