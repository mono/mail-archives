<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Trouble with HttpWebResponse
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Trouble%20with%20HttpWebResponse&In-Reply-To=1046719343.16395.15.camel%40portatil">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000008.html">
   <LINK REL="Next"  HREF="000016.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Trouble with HttpWebResponse</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Trouble%20with%20HttpWebResponse&In-Reply-To=1046719343.16395.15.camel%40portatil"
       TITLE="[Mono-devel-list] Trouble with HttpWebResponse">lupus at ximian.com
       </A><BR>
    <I>Tue Mar  4 05:41:39 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000008.html">[Mono-devel-list] Trouble with HttpWebResponse
</A></li>
        <LI>Next message: <A HREF="000016.html">[Mono-devel-list] Trouble with HttpWebResponse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15">[ date ]</a>
              <a href="thread.html#15">[ thread ]</a>
              <a href="subject.html#15">[ subject ]</a>
              <a href="author.html#15">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/03/03 Gonzalo Paniagua Javier wrote:
&gt;<i> El lun, 03 de 03 de 2003 a las 19:54, Peter Magnusson escribi&#243;:
</I>&gt;<i> &gt; At first I thougt I had some trouble with System.IO.StreamReader.ReadToEnd 
</I>&gt;<i> &gt; but it seems that there is trouble elsewhere..
</I>&gt;<i> &gt; The test described below works fine with Microsoft .NET SDK and the csc 
</I>&gt;<i> &gt; compiler but it doesn't work with mono, at least not in SuSE 8.1 Pro.
</I>&gt;<i> 
</I>&gt;<i> I just tried your program and it works here (debian sid/x86).
</I>&gt;<i> 
</I>&gt;<i> At first, I thought it was failing because after a couple of seconds I
</I>&gt;<i> saw no network traffic and I interrupted it.
</I>&gt;<i> 
</I>&gt;<i> Then I run it again and waited a few seconds more and...woot!
</I>
I straced it and found that it gets the data from the server in about 3
seconds (just like lynx -dump) and then gooes into a loop:

[pid 31923] 09:53:16.038282 nanosleep({0, 99524000},  &lt;unfinished ...&gt;
[pid 31920] 09:53:16.038313 nanosleep({0, 99524000},  &lt;unfinished ...&gt;
[pid 31923] 09:53:16.147281 &lt;... nanosleep resumed&gt; NULL) = 0
[pid 31920] 09:53:16.147309 &lt;... nanosleep resumed&gt; NULL) = 0
[pid 31923] 09:53:16.147374 rt_sigprocmask(SIG_SETMASK, [RTMIN], &lt;unfinished ...&gt;
[pid 31920] 09:53:16.147427 rt_sigprocmask(SIG_SETMASK, [RTMIN], &lt;unfinished ...&gt;
[pid 31923] 09:53:16.147465 &lt;... rt_sigprocmask resumed&gt; NULL, 8) = 0
[pid 31920] 09:53:16.147489 &lt;... rt_sigprocmask resumed&gt; NULL, 8) = 0
[pid 31923] 09:53:16.147524 gettimeofday( &lt;unfinished ...&gt;
[pid 31920] 09:53:16.147552 gettimeofday( &lt;unfinished ...&gt;
[pid 31923] 09:53:16.147580 &lt;... gettimeofday resumed&gt; {1046767996, 147568}, NULL) = 0
[pid 31920] 09:53:16.147620 &lt;... gettimeofday resumed&gt; {1046767996, 147569}, NULL) = 0
[pid 31923] 09:53:16.147695 rt_sigprocmask(SIG_BLOCK, NULL,  &lt;unfinished ...&gt;
[pid 31920] 09:53:16.147726 rt_sigprocmask(SIG_BLOCK, NULL,  &lt;unfinished ...&gt;
[pid 31923] 09:53:16.147755 &lt;... rt_sigprocmask resumed&gt; [RTMIN], 8) = 0
[pid 31920] 09:53:16.147787 &lt;... rt_sigprocmask resumed&gt; [RTMIN], 8) = 0
[pid 31923] 09:53:16.147825 rt_sigprocmask(SIG_UNBLOCK, [RTMIN], &lt;unfinished ...&gt;
[pid 31920] 09:53:16.147863 rt_sigprocmask(SIG_UNBLOCK, [RTMIN], &lt;unfinished ...&gt;
[pid 31923] 09:53:16.147901 &lt;... rt_sigprocmask resumed&gt; [RTMIN], 8) = 0
[pid 31920] 09:53:16.147932 &lt;... rt_sigprocmask resumed&gt; [RTMIN], 8) = 0
[pid 31923] 09:53:16.148017 gettimeofday( &lt;unfinished ...&gt;
[pid 31920] 09:53:16.148045 gettimeofday( &lt;unfinished ...&gt;
[pid 31923] 09:53:16.148074 &lt;... gettimeofday resumed&gt; {1046767996, 148061}, NULL) = 0
[pid 31920] 09:53:16.148101 &lt;... gettimeofday resumed&gt; {1046767996, 148062}, NULL) = 0

and gets back to the nanosleep.
Calls to nanosleep with a NULL second argument are in:
io-layer/handles.c:			nanosleep (&amp;sleepytime, NULL);
io-layer/mono-mutex.c:		nanosleep (&amp;sleepytime, NULL);
io-layer/shared.c:		nanosleep (&amp;sleepytime, NULL);

The loop continues for about 16 seconds. Note that threads 31920 and
31923 are not the threads downloading the file (31924).

The loop terminates with:
[pid 31920] 09:53:16.258170 nanosleep({0, 99476000},  &lt;unfinished ...&gt;
[pid 31924] 09:53:16.355116 &lt;... recvfrom resumed&gt; &quot;&quot;, 102650, 0x4000, NULL, NULL) = 0
[pid 31924] 09:53:16.356942 getpid()    = 31924
[pid 31924] 09:53:16.357153 kill(31920, SIGPWR) = 0
[pid 31920] 09:53:16.357203 &lt;... nanosleep resumed&gt; 0) = -1 EINTR (Interrupted system call)
[pid 31924] 09:53:16.357272 kill(31923, SIGPWR &lt;unfinished ...&gt;
[pid 31920] 09:53:16.357313 --- SIGPWR (Power failure) @ 0 (0) ---
[pid 31924] 09:53:16.357417 &lt;... kill resumed&gt; ) = 0

The recvfrom started at:
[pid 31924] 09:53:00.078878 recvfrom(11,  &lt;unfinished ...&gt;

Hope this helps.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000008.html">[Mono-devel-list] Trouble with HttpWebResponse
</A></li>
	<LI>Next message: <A HREF="000016.html">[Mono-devel-list] Trouble with HttpWebResponse
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15">[ date ]</a>
              <a href="thread.html#15">[ thread ]</a>
              <a href="subject.html#15">[ subject ]</a>
              <a href="author.html#15">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
