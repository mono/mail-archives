<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Mono GC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Mono%20GC&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000062.html">
   <LINK REL="Next"  HREF="000049.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Mono GC</H1>
    <B>Jerome Laban</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Mono%20GC&In-Reply-To="
       TITLE="[Mono-devel-list] Mono GC">jlaban at wanadoo.fr
       </A><BR>
    <I>Thu Mar  6 15:45:48 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="000062.html">[Mono-devel-list] floating point compares
</A></li>
        <LI>Next message: <A HREF="000049.html">[Mono-devel-list] Native Win32 Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47">[ date ]</a>
              <a href="thread.html#47">[ thread ]</a>
              <a href="subject.html#47">[ subject ]</a>
              <a href="author.html#47">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi monoers,

    Here is some simple code involving finalization process :

&lt;code&gt;
using System;

namespace myns {
 class Class2 {
  ~Class2() {
   Console.WriteLine(&quot;Finalizer called&quot;);
  }
 }

 class Class1 {
  Class2 a = new Class2();

  void Run() {
   a = null;
   GC.Collect();             /// Finalizer should be called from here
  }

  static void Main(string[] args) {
   Class1 instance = new Class1();
   instance.Run();

   /// GC.Collect();        /// It is actually called from here in mono

   Console.ReadLine();  /// Finalizers are called asynchonously, let the
                                  /// time for the GC to do it.
  }
 }
}
&lt;/code&gt;

The problem here is that the finalizer is not called roght after the first
call to GC.Collect, as it is on MS.NET runtime. Mono 0.21 needs to have a
second call to GC.Collect avec the call to Class1.Run to have the finalizer
called.

    My guess is that the internal reference to the instance of Class2
maintained somewhere in something like the stack and during its collection
passes, the GC finds this ghost reference, thus never collecting the freed
memory. Leaving the Class1.Run scope somehow erases this reference.

    Is my assumption correct ? If it is, how should this be addressed ?

Jerome.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000062.html">[Mono-devel-list] floating point compares
</A></li>
	<LI>Next message: <A HREF="000049.html">[Mono-devel-list] Native Win32 Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47">[ date ]</a>
              <a href="thread.html#47">[ thread ]</a>
              <a href="subject.html#47">[ subject ]</a>
              <a href="author.html#47">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
