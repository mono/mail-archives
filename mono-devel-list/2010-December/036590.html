<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] more support for Google Native Client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20more%20support%20for%20Google%20Native%20Client&In-Reply-To=AANLkTikmobHLaE5bFVWQRKisDbmfJyUo0F38sh_ud8sq%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036589.html">
   <LINK REL="Next"  HREF="036571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] more support for Google Native Client</H1>
    <B>Elijah Taylor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20more%20support%20for%20Google%20Native%20Client&In-Reply-To=AANLkTikmobHLaE5bFVWQRKisDbmfJyUo0F38sh_ud8sq%40mail.gmail.com"
       TITLE="[Mono-dev] [PATCH] more support for Google Native Client">elijahtaylor at google.com
       </A><BR>
    <I>Sat Dec 25 12:27:59 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="036589.html">[Mono-dev] [PATCH] more support for Google Native Client
</A></li>
        <LI>Next message: <A HREF="036571.html">[Mono-dev] WCF: netTcpBinding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36590">[ date ]</a>
              <a href="thread.html#36590">[ thread ]</a>
              <a href="subject.html#36590">[ subject ]</a>
              <a href="author.html#36590">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Rodrigo,

On Sat, Dec 25, 2010 at 5:01 AM, Rodrigo Kumpera &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kumpera at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> The patchset is indeed huge and will take quite some review effort to get
</I>&gt;<i> it in. I'll start by reviewing the bug fixes then move to ILP32 support.
</I>&gt;<i>
</I>
Yes, sorry about that.  I would have loved to have sent more targetted
changes, but there were always &quot;gotchas&quot; with a lot of stuff not working
until the whole system worked.  No rush on getting this checked in, it's
your codebase.

&gt;<i>
</I>&gt;<i> Since you guys had to add GC support for cooperative parking, it would be
</I>&gt;<i> interesting to merge this effort with the current one toward adding it
</I>&gt;<i> to sgen, which has received quite some reviewing and testing. Mark Probst
</I>&gt;<i> can better talk about it once he gets back from his vacations.
</I>&gt;<i>
</I>
I would very much love to get GC working with Sgen, but haven't put in the
effort yet.  We were working off of a snapshot from earlier this year prior
to 2.8 so we just had boehm mature enough to work on.


One problem I see in the general description of how parking is been done is
&gt;<i> that it doesn't handle blocking syscalls, which might lead to a single
</I>&gt;<i> thread make the GC halt.
</I>&gt;<i>
</I>&gt;<i>
</I>I glazed over the details a little coarsely, but we do handle this case.
 All OS syscalls in Native Client are handled by the trusted runtime
component of our system.  Any time we issue a Native Client syscall (move
from untrusted code to trusted code) that has a chance of blocking I store a
context and count that thread as &quot;parked&quot; (threads in trusted code can't
permute untrusted GC memory).  Upon returning from trusted code I check if
we're in the middle of GC and if so actually park until it's done.  For
details you can check libgc/pthread_stop_world.c, search for &quot;syscall&quot;  and
you can see the enter and exit hooks I've exposed from our syscall
interface.


I'll start reviewing/cherry picking patches next year once I get back to
&gt;<i> work. Just wanted to give you a heads up.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I> Great, ping me if you have any questions or concerns and I'll try to get
back to you quickly.  I'm on vacation off and on until after the new year,
but I'll have email access most of the time.

-Elijah
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20101225/3ee79d42/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20101225/3ee79d42/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036589.html">[Mono-dev] [PATCH] more support for Google Native Client
</A></li>
	<LI>Next message: <A HREF="036571.html">[Mono-dev] WCF: netTcpBinding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36590">[ date ]</a>
              <a href="thread.html#36590">[ thread ]</a>
              <a href="subject.html#36590">[ subject ]</a>
              <a href="author.html#36590">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
