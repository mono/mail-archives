<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Global register allocator in JIT
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Global%20register%20allocator%20in%20JIT&In-Reply-To=295e750a0610111234o693a7c9bia844cecb98a908fe%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020877.html">
   <LINK REL="Next"  HREF="020851.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Global register allocator in JIT</H1>
    <B>Sergey Tikhonov</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Global%20register%20allocator%20in%20JIT&In-Reply-To=295e750a0610111234o693a7c9bia844cecb98a908fe%40mail.gmail.com"
       TITLE="[Mono-dev] Global register allocator in JIT">tsv at solvo.ru
       </A><BR>
    <I>Wed Oct 11 16:11:52 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020877.html">[Mono-dev] Global register allocator in JIT
</A></li>
        <LI>Next message: <A HREF="020851.html">[Mono-dev] Mono on the 390
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20879">[ date ]</a>
              <a href="thread.html#20879">[ thread ]</a>
              <a href="subject.html#20879">[ subject ]</a>
              <a href="author.html#20879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Zoltan Varga wrote:
&gt;<i>                                 Hi,
</I>&gt;<i>
</I>&gt;<i> To match the example, these should use OP_LADD instead of CEE_ADD. The
</I>&gt;<i> burg phase has an optimization to avoid useless moves when compiling
</I>&gt;<i> trees of the form:
</I>&gt;<i> (stind.i regvar[REG] (TREE))
</I>&gt;<i> It is turned on by defining MONO_ARCH_ENABLE_EMIT_STATE_OPT in the
</I>&gt;<i> mini-&lt;ARCH&gt;.h file. It is defined for alpha, so I don't know why it is
</I>&gt;<i> not working
</I>&gt;<i> there. It does on other architectures.
</I>Thank you. The macro was not defined (it was in file, but was not active 
:<i>) ).
</I>I defined it and it helped. The code looks better now, but there are 
still some issues.
I checked generated code for amd64 - here is something interesting (the 
same method):
LABEL BLOCK 12:
 (stind.i2 (long_add (long_conv_to_i (ldind.i regvar[%r13])) iconst[0]) 
(ldind.i2 (long_add (long_conv_to_i (ldind.i regvar[%r14])) iconst[0])))
 (stind.i regvar[%r13] (long_add (long_conv_to_i (ldind.i regvar[%r13])) 
iconst[2]))
 (stind.i regvar[%r14] (long_add (long_conv_to_i (ldind.i regvar[%r14])) 
iconst[2]))
 (stind.i4 regvar[%r15] (sub (ldind.i4 regvar[%r15]) iconst[2]))

LOCAL REGALLOC: BASIC BLOCK: 12
        1  move R16 &lt;- %r13
        2  move R19 &lt;- %r14
        3  loadi2_membase R18 &lt;- R19
        4  storei2_membase_reg [R16] &lt;- R18
        5  move R21 &lt;- %r13
        6  add_imm %r13 &lt;- R21 clobbers: 1
        7  move %r13 &lt;- %r13
        8  move R23 &lt;- %r14
        9  add_imm %r14 &lt;- R23 clobbers: 1
        10 move %r14 &lt;- %r14
        11 sub_imm %r15 &lt;- %r15 clobbers: 1

&lt;BB&gt;:12
  b0:   49 8b c5                mov    %r13,%rax
  b3:   49 8b ce                mov    %r14,%rcx
  b6:   48 0f bf 09             movswq (%rcx),%rcx
  ba:   66 89 08                mov    %cx,(%rax)
  bd:   49 8b c5                mov    %r13,%rax     &lt;-- ????
  c0:   49 83 c5 02             add    $0x2,%r13
  c4:   49 8b c6                mov    %r14,%rax    &lt;-- ????
  c7:   49 83 c6 02             add    $0x2,%r14
  cb:   49 83 ef 02             sub    $0x2,%r15


Thank you for helping me out (I will have more questions :) )

Regards,
Sergey.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020877.html">[Mono-dev] Global register allocator in JIT
</A></li>
	<LI>Next message: <A HREF="020851.html">[Mono-dev] Mono on the 390
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20879">[ date ]</a>
              <a href="thread.html#20879">[ thread ]</a>
              <a href="subject.html#20879">[ subject ]</a>
              <a href="author.html#20879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
