<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Replacing/Removing I18N
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Replacing/Removing%20I18N&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020871.html">
   <LINK REL="Next"  HREF="020878.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Replacing/Removing I18N</H1>
    <B>Andreas Nahr</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Replacing/Removing%20I18N&In-Reply-To="
       TITLE="[Mono-dev] Replacing/Removing I18N">ClassDevelopment at A-SoftTech.com
       </A><BR>
    <I>Wed Oct 11 15:10:25 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020871.html">[Mono-dev] Replacing/Removing I18N
</A></li>
        <LI>Next message: <A HREF="020878.html">[Mono-dev] Replacing/Removing I18N
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20876">[ date ]</a>
              <a href="thread.html#20876">[ thread ]</a>
              <a href="subject.html#20876">[ subject ]</a>
              <a href="author.html#20876">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> On 10/09/06 Andreas Nahr wrote:
</I>&gt;&gt;<i> Current situation:
</I>&gt;&gt;<i> I18N is located in multiple separate assemblies that contain encoding
</I>&gt;&gt;<i> classes that are autogenerated. The single-byte encodings (my current
</I>&gt;&gt;<i> focus) use a potentially big CASE-Structure to compute the output.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Problems:
</I>&gt;<i> [...]
</I>&gt;&gt;<i> Considerations for change:
</I>&gt;&gt;<i> * Data must not be in private memory but shared as much as possible
</I>&gt;&gt;<i> (currently most is shareable)
</I>&gt;&gt;<i> * If possible avoid internal-calls and other direct runtime-support
</I>&gt;&gt;<i> (currently does not need any)
</I>&gt;<i>
</I>&gt;<i> I'm all for dumping the current I18N assemblies, the problems you list
</I>&gt;<i> are real, we just need someone to write and test all the code.
</I>&gt;<i> What I don't agree with is avoiding internal calls and runtime support.
</I>&gt;<i> The reason is simple: the most efficient way to export to the manage
</I>&gt;<i> world arrays of data is to have them as C arrays in the mono runtime or
</I>&gt;<i> as data files that mono loads and mmaps, returning a pointer for use in
</I>&gt;<i> usafe code in the assembly implementation. See the locale data for
</I>&gt;<i> examples. I18n tables are best put outside the mono binary, usually
</I>
Well this was my first thought also to do it this way. However 
internal-calls reduce the maintainability of the code, because you have to 
manually ensure it stays in synch and it makes using corelib much harder for 
other projects. So I tried to search for another way to archieve the same 
goal and my proposal could be the solution (Again: If I'm somewhere making 
wrong assumptions, please correct me).

It seems I couldn't make clear enough how this should work, so here is a 
simplified pseudocode example about how I imagine this would work:

class Enc
{
    byte* table;
    public Enc (int codepage)
    {
        IntPtrStream s = Assembly.GetManifestResourceStream(codepage);
        table = s.memStart;
    }
    public byte GetByte (char char)
    {
        return table[char];
    }
}

The real implementation wouldn't actually be much more complicated than 
this.
Also this would obviously be (much) faster than the current solution (I 
don't know how Atsushi got to the point that this would be slower than 
current code).
Moreover it has the advantage that you could remove resources from the file 
in a much simpler than removing code in the c source files...

Assumed benefits:
* Simple solution
* Simple code
* Fast
* Data completely shareable between processes

In fact it seems to be such a simple and good solution that I'm somehow even 
waiting some someone to say: Gotcha this doesn't work because...

&gt;<i> (except latin1 support). The aim is to optionally move outside also
</I>&gt;<i> other tables that are currently hardcoded inside mono.
</I>&gt;<i> Note: resources in assemblies are mmapped, but still using datadirectly
</I>&gt;<i> from mono is more efficient.
</I>&gt;<i>
</I>&gt;<i> A small comment of your considerations, though: using a 64KB table when
</I>&gt;<i> a much smaller one is sufficient would be a waste. We need to keep in
</I>&gt;<i> mind also disk-space issues.
</I>
Currently my focus was actually trying to find out if this could work at 
all, the change to two tables (already wrote about it) would only be a small 
change. 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020871.html">[Mono-dev] Replacing/Removing I18N
</A></li>
	<LI>Next message: <A HREF="020878.html">[Mono-dev] Replacing/Removing I18N
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20876">[ date ]</a>
              <a href="thread.html#20876">[ thread ]</a>
              <a href="subject.html#20876">[ subject ]</a>
              <a href="author.html#20876">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
