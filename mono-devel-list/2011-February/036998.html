<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Unable to catch ArgumentException from constructor in lambda expression
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Unable%20to%20catch%20ArgumentException%20from%20constructor%20in%0A%20lambda%20expression&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037001.html">
   <LINK REL="Next"  HREF="037002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Unable to catch ArgumentException from constructor in lambda expression</H1>
    <B>Patrick Timm</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Unable%20to%20catch%20ArgumentException%20from%20constructor%20in%0A%20lambda%20expression&In-Reply-To="
       TITLE="[Mono-dev] Unable to catch ArgumentException from constructor in lambda expression">patrick at isharp.dk
       </A><BR>
    <I>Wed Feb 23 04:16:23 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037001.html">[Mono-dev] Mono based web browser?
</A></li>
        <LI>Next message: <A HREF="037002.html">[Mono-dev] Trouble compiling on opensuse 11.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36998">[ date ]</a>
              <a href="thread.html#36998">[ thread ]</a>
              <a href="subject.html#36998">[ subject ]</a>
              <a href="author.html#36998">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

I am using the Samus MongoDB C# driver (Version 0.90.0.1) with some very
simple documents in a mod_mono application.

The following was my original code. It filters the documents in the
(typed) collection &quot;collection&quot; using an Oid (object ID). The
constructor for &quot;Oid&quot; takes a 24 character string. In the following I
supply an invalid ID string which make the Oid.ctor call throw a
System.ArgumentException. However the mod_mono runtime crashes -
bypassing my try..catch.

&lt;failingCode&gt;
try
{
	// delete the link document with the given ID
	collection.Remove(x =&gt; (Oid)x.Id == new Oid(&quot;invalidinput&quot;));
}

catch (ArgumentException)
{
	// given ID has invalid length (must be 24 characters)
	return;
}
&lt;/failingCode&gt;

Results in the following stacktrace...

&lt;stacktrace&gt;
System.ArgumentException: Oid strings should be 24 characters
at MongoDB.Oid.ValidateHex (string) &lt;IL 0x0004b, 0x000d3&gt;
at MongoDB.Oid.ParseBytes (string) &lt;IL 0x00015, 0x00043&gt;
at MongoDB.Oid..ctor (string) &lt;IL 0x00020, 0x0003b&gt;
at (wrapper dynamic-method)
System.Runtime.CompilerServices.ExecutionScope.lambda_method
(System.Runtime.CompilerServices.ExecutionScope) &lt;IL 0x00005, 0x00039&gt;
at (wrapper managed-to-native)
System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;IL 0x0001c, 0x00068&gt;
at System.Reflection.MonoMethod.Invoke
(object,System.Reflection.BindingFlags,System.Reflection.Binder,object[],System.Globalization.CultureInfo) [0x000d0] in /tmp/mono/trunk/src/mono-2.6.4/mcs/class/corlib/System.Reflection/MonoMethod.cs:213
&lt;/stacktrace&gt;

Rewriting the code to the following works as expected. The catch is run.

&lt;workingCode&gt;
try
{
	Oid alala = new Oid(&quot;invalidinput&quot;);
	
	// delete the link document with the given ID
	collection.Remove(x =&gt; (Oid)x.Id == alala);
}

catch (ArgumentException)
{
	return;
}
&lt;/workingCode&gt;

Is my opinion these code snippets are functionally equal and should both
work.

Is this an error in the mono-runtime, mongo db driver or just me :o)


Kind regards

Patrick

</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037001.html">[Mono-dev] Mono based web browser?
</A></li>
	<LI>Next message: <A HREF="037002.html">[Mono-dev] Trouble compiling on opensuse 11.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36998">[ date ]</a>
              <a href="thread.html#36998">[ thread ]</a>
              <a href="subject.html#36998">[ subject ]</a>
              <a href="author.html#36998">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
