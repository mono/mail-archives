<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Marshal.SizeOf differences on .NET and Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Marshal.SizeOf%20differences%20on%20.NET%20and%20Mono&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036868.html">
   <LINK REL="Next"  HREF="036870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Marshal.SizeOf differences on .NET and Mono</H1>
    <B>Joe Dluzen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Marshal.SizeOf%20differences%20on%20.NET%20and%20Mono&In-Reply-To="
       TITLE="[Mono-dev] Marshal.SizeOf differences on .NET and Mono">jdluzen at gmail.com
       </A><BR>
    <I>Thu Feb  3 17:08:24 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036868.html">[Mono-dev] Symlinks not created
</A></li>
        <LI>Next message: <A HREF="036870.html">[Mono-dev] StreamReader.ReadToEnd crashes sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36869">[ date ]</a>
              <a href="thread.html#36869">[ thread ]</a>
              <a href="subject.html#36869">[ subject ]</a>
              <a href="author.html#36869">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I'm not entirely sure who has the bug here, Mono seems like it is more
logically correct, but perhaps I'm missing an attribute somewhere.

Marshal.SizeOf(typeof(ImClasses)) is not what you'd expect, and is
different depending on if it runs under Mono 2.8 (on Windows) or .NET
3.5.

.NET: Class size: 8
Mono: Class size: 1

Struct sizes are both 1.

Thanks,
Joe

using System;
using System.Runtime.InteropServices;
class Program
{
    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public class ImaClass
    {
        public byte A;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public class ImClasses
    {
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 1)]
        public ImaClass[] Classes;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct ImaStruct
    {
        public byte A;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct ImStructs
    {
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = 1)]
        public ImaStruct[] Structs;
    }

    static void Main(string[] args)
    {
        int sizeofClasses = Marshal.SizeOf(typeof(ImClasses));
        int sizeofStructs = Marshal.SizeOf(typeof(ImStructs));
        Console.WriteLine(&quot;Class size: &quot; + sizeofClasses);
        Console.WriteLine(&quot;Struct size: &quot; + sizeofStructs);
    }
}
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036868.html">[Mono-dev] Symlinks not created
</A></li>
	<LI>Next message: <A HREF="036870.html">[Mono-dev] StreamReader.ReadToEnd crashes sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36869">[ date ]</a>
              <a href="thread.html#36869">[ thread ]</a>
              <a href="subject.html#36869">[ subject ]</a>
              <a href="author.html#36869">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
