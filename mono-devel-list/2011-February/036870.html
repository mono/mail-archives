<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] StreamReader.ReadToEnd crashes sometimes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20StreamReader.ReadToEnd%20crashes%20sometimes&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036869.html">
   <LINK REL="Next"  HREF="036871.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] StreamReader.ReadToEnd crashes sometimes</H1>
    <B>cs_eps</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20StreamReader.ReadToEnd%20crashes%20sometimes&In-Reply-To="
       TITLE="[Mono-dev] StreamReader.ReadToEnd crashes sometimes">christian.schmid at eps.ch
       </A><BR>
    <I>Fri Feb  4 08:06:39 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036869.html">[Mono-dev] Marshal.SizeOf differences on .NET and Mono
</A></li>
        <LI>Next message: <A HREF="036871.html">[Mono-dev] StreamReader.ReadToEnd crashes sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36870">[ date ]</a>
              <a href="thread.html#36870">[ thread ]</a>
              <a href="subject.html#36870">[ subject ]</a>
              <a href="author.html#36870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hallo experts!

Once in a while StreamReader.ReadToEnd() crashes with the following stack
trace:

Mprotect failed at 0x4621e000 (length 20480) with errno 12
Stacktrace:

  at (wrapper managed-to-native)
object.__icall_wrapper_mono_array_new_specific (intptr,int) &lt;0xffffffff&gt;
  at System.IO.StreamReader.ReadToEnd () &lt;0x00063&gt;
  at Skywalker.Core.Platform.CPlatformLinux.ExecSync (string,string,string&amp;)
&lt;0x001eb&gt;
  at Skywalker.Core.Platform.CPlatformArchos5._ReadBattery () &lt;0x0005f&gt;
  at Skywalker.Core.Platform.CPlatformArchos5.get_BatteryLevel () &lt;0x0001b&gt;
  at Skywalker.UserInterface.Controls.CPnlEnvCUBattery.UpdateBatteryState ()
&lt;0x00037&gt;
  at (wrapper remoting-invoke-with-check)
Skywalker.UserInterface.Controls.CPnlEnvCUBattery.UpdateBatteryState ()
&lt;0x00067&gt;
  at Skywalker.UserInterface.Controls.CEnvStatusBar.OnEnvTimerTick
(object,System.EventArgs) &lt;0x00043&gt;
  at System.Windows.Forms.Timer.OnTick (System.EventArgs) &lt;0x0003b&gt;
  at System.Windows.Forms.Timer.FireTick () &lt;0x0002f&gt;
  at (wrapper remoting-invoke-with-check)
System.Windows.Forms.Timer.FireTick () &lt;0x00067&gt;
  at System.Windows.Forms.XplatUIX11.CheckTimers
(System.Collections.ArrayList,System.DateTime) &lt;0x00313&gt;
  at System.Windows.Forms.XplatUIX11.UpdateMessageQueue
(System.Windows.Forms.XEventQueue) &lt;0x003c3&gt;
  at System.Windows.Forms.XplatUIX11.GetMessage
(object,System.Windows.Forms.MSG&amp;,intptr,int,int) &lt;0x002cf&gt;
  at System.Windows.Forms.XplatUI.GetMessage
(object,System.Windows.Forms.MSG&amp;,intptr,int,int) &lt;0x00067&gt;
  at System.Windows.Forms.Application.RunLoop
(bool,System.Windows.Forms.ApplicationContext) &lt;0x00c1b&gt;
  at System.Windows.Forms.Application.Run
(System.Windows.Forms.ApplicationContext) &lt;0x0005b&gt;
  at System.Windows.Forms.Application.Run (System.Windows.Forms.Form)
&lt;0x00033&gt;
  at Skywalker.Program.Main.Program.Main () &lt;0x0007f&gt;
  at (wrapper runtime-invoke) object.runtime_invoke_void
(object,intptr,intptr,intptr) &lt;0x0009f&gt;

Native stacktrace:

    mono [0xeecb8]
    mono [0x134fb4]
    /lib/libc.so.6(__default_rt_sa_restorer_v2+0) [0x4010bb20]
    mono [0x2c391c]
    mono [0x2c3370]
    mono [0x2c978c]
    mono [0x2c9d18]
    mono [0x2c9fdc]
    mono [0x258be0]
    mono(mono_array_new_specific+0x98) [0x258d38]
    [0x4084e470]
    mono(mono_array_new_specific+0xc) [0x258cac]
    mono(mono_array_new_specific+0xc) [0x258cac]
    mono(mono_array_new_specific+0xc) [0x258cac]
    mono(mono_array_new_specific+0xc) [0x258cac]

...
...
...
warning: Unable to find libthread_db matching inferior's thread library,
thread debugging will not be available.
warning: Unable to find libthread_db matching inferior's thread library,
thread debugging will not be available.
warning: Unable to find libthread_db matching inferior's thread library,
thread debugging will not be available.
Cannot access memory at address 0x44ef
0x400be3b4 in read () from /lib/libpthread.so.0
* 1 process 26404  0x400be3b4 in read () from /lib/libpthread.so.0

Thread 1 (process 26404):
#0  0x400be3b4 in read () from /lib/libpthread.so.0
#1  0x400bdd94 in ?? () from /lib/libpthread.so.0
#2  0xbede9fcc in ?? ()
Backtrace stopped: previous frame identical to this frame (corrupt stack?)

=================================================================
Got a SIGABRT while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries 
used by your application.
=================================================================


Here the code snippet that causes the exception. Unfortunately we can not
catch it, so the application terminates.
using (Process p = new Process())
            {
                // Redirect the output stream of the child process.
                p.StartInfo.UseShellExecute = false; //true for open
documents with the associated application
                p.StartInfo.RedirectStandardOutput = true;
                p.StartInfo.FileName = p_Process;
                p.StartInfo.Arguments = p_Arguments;

                try
                {
                    if (p.Start() &amp;&amp; p.Id &gt; 0)
                    {
                        pid = p.Id;

                        _Logger.Debug(string.Format(&quot;process {0} {1} started
with pid={2}&quot;, p_Process, p_Arguments, pid));

                        // Do not wait for the child process to exit before
                        // reading to the end of its redirected stream.
                        p_Output = p.StandardOutput.ReadToEnd();

                        //wait for completion
                        p.WaitForExit();
                        // fetch the exit code
                        exitCode = p.ExitCode;

                        _Logger.Debug(string.Format(&quot;process with pid={0}
exited with code {1}&quot;, pid, exitCode));
                    }
                    else
                    {
                        _Logger.Warn(string.Format(&quot;process {0} {1} did not
start&quot;, p_Process, p_Arguments));
                        CompactMemory();
                    }
                }
                catch (Exception ex)
                {
                    _Logger.Warn(string.Format(&quot;exception in process {0}:
{1} &quot;, p_Process, ex.Message));
                }
            }

Is there a fix for this? or a workaround?

Every help is appreciated!
-- 
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/StreamReader-ReadToEnd-crashes-sometimes-tp3260133p3260133.html">http://mono.1490590.n4.nabble.com/StreamReader-ReadToEnd-crashes-sometimes-tp3260133p3260133.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036869.html">[Mono-dev] Marshal.SizeOf differences on .NET and Mono
</A></li>
	<LI>Next message: <A HREF="036871.html">[Mono-dev] StreamReader.ReadToEnd crashes sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36870">[ date ]</a>
              <a href="thread.html#36870">[ thread ]</a>
              <a href="subject.html#36870">[ subject ]</a>
              <a href="author.html#36870">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
