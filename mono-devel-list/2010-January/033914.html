<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for CookieContainer.SetCookies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20CookieContainer.SetCookies&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033912.html">
   <LINK REL="Next"  HREF="033915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for CookieContainer.SetCookies</H1>
    <B>Tom Philpot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20CookieContainer.SetCookies&In-Reply-To="
       TITLE="[Mono-dev] Patch for CookieContainer.SetCookies">tom.philpot at logos.com
       </A><BR>
    <I>Mon Jan 18 18:31:37 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="033912.html">[Mono-dev] Mono 2.6.1 and HPPA-HPUX
</A></li>
        <LI>Next message: <A HREF="033915.html">[Mono-dev] Patch for CookieContainer.SetCookies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33914">[ date ]</a>
              <a href="thread.html#33914">[ thread ]</a>
              <a href="subject.html#33914">[ subject ]</a>
              <a href="author.html#33914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The current implementation of CookieContainer.SetCookies does not handle the case where a cookie contains an &quot;expires=...&quot; attribute.

As documented on MSDN here: <A HREF="http://msdn.microsoft.com/en-us/library/aa384321%28VS.85%29.aspx">http://msdn.microsoft.com/en-us/library/aa384321%28VS.85%29.aspx</A> the &quot;Set-Cookie:&quot; header expires attribute uses the following format: DAY, DD-MMM-YYYY HH:MM:SS GMT

The current version of SetCookies simply does a split on ',' in the header which totally causes the CookieContainer to choke when the expires attribute is set as MS recommends.

Also, the Add (Cookie) method of CookieContainer does not clone all the properties of the incoming cookie before adding it to the collection. Using SetCookies(Uri, string) should clone all the properties, so that is fixes as well in the patch and a test is added in the test cases.

I believe this makes the behavior of CookieContainer more &quot;bug-compatible&quot; with .NET.

Please review the patch and the test cases.

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: CookieContainerPatch.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0004.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0004.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT00001..txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0005.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0005.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: CookieContainerTest_Patch.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0006.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0006.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT00002..txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0007.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100118/3778125f/attachment-0007.txt</A> 
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033912.html">[Mono-dev] Mono 2.6.1 and HPPA-HPUX
</A></li>
	<LI>Next message: <A HREF="033915.html">[Mono-dev] Patch for CookieContainer.SetCookies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33914">[ date ]</a>
              <a href="thread.html#33914">[ thread ]</a>
              <a href="subject.html#33914">[ subject ]</a>
              <a href="author.html#33914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
