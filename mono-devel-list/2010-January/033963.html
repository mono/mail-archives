<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mac Boehm CG question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mac%20Boehm%20CG%20question&In-Reply-To=EBB0DA68-1388-4F4E-A57D-DC449924DC25%40logos.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033962.html">
   <LINK REL="Next"  HREF="033966.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mac Boehm CG question</H1>
    <B>Geoff Norton</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mac%20Boehm%20CG%20question&In-Reply-To=EBB0DA68-1388-4F4E-A57D-DC449924DC25%40logos.com"
       TITLE="[Mono-dev] Mac Boehm CG question">gnorton at novell.com
       </A><BR>
    <I>Mon Jan 25 17:49:46 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="033962.html">[Mono-dev] Mac Boehm CG question
</A></li>
        <LI>Next message: <A HREF="033966.html">[Mono-dev] Mac Boehm CG question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33963">[ date ]</a>
              <a href="thread.html#33963">[ thread ]</a>
              <a href="subject.html#33963">[ subject ]</a>
              <a href="author.html#33963">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tom,

  Looking back, apple had some issues with trylock in the 10.2/10.3 days, and this came over for safety when we did the initial osx86 port.  Its probably safe to make this change on x86 on trunk, but I'd like some metrics if you could.

#1, run it for a bit make sure you dont get any random hangs.
#2, do you have any perf increase numbers?

Thanks

Geoff

On 2010-01-25, at 4:59 PM, Tom Philpot wrote:

&gt;<i> Rodrigo,
</I>&gt;<i> 
</I>&gt;<i> Thanks for the input. Any of the other Mono/MacOS X folks have an opinion on this change? I've been running our heavily multi-threaded app which embeds Mono and haven't seen any issues. We're going to start removing this #define on our build machine and our dev's Mono installs and see if we can detect any issues since the speed up is so significant in certain cases in our app.
</I>&gt;<i> 
</I>&gt;<i> Tom
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Jan 22, 2010, at 2:08 PM, Rodrigo Kumpera wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> pthread mutexes on OSX are ridiculously slow. So no matter what you do, GC performance will be significantly worse than on linux.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> But we should check if this change is ok if it does give a nice boost.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Fri, Jan 22, 2010 at 8:05 PM, Tom Philpot &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tom.philpot at logos.com</A>&gt; wrote:
</I>&gt;&gt;<i> While investigating some performance problems in our application which uses the embedded Mono runtime on Mac OS X targeting 10.5 and 10.6, I noticed that several operations spent an extreme amount of time in GC_lock. That code lead me back to gcconfig.h where NO_PTHREAD_TRYLOCK is defined. I've commented out that #define it on my local Mono build and things seem MUCH faster. In fact I'm now able to do real work on more than 2 threads without a ton of overhead.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The question is now, does this check still need to be there for later versions of Mac OS X? The original commit was back in August 2003, which was probably around the timeframe of 10.2 and 10.3 and definitely before the Intel Macs. Also, since I don't have a PPC to test on, I didn't comment that #define.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ws1048-snow:mono tom.philpot$ svn diff libgc/include/private/gcconfig.h
</I>&gt;&gt;<i> Index: libgc/include/private/gcconfig.h
</I>&gt;&gt;<i> ===================================================================
</I>&gt;&gt;<i> --- libgc/include/private/gcconfig.h    (revision 150077)
</I>&gt;&gt;<i> +++ libgc/include/private/gcconfig.h    (working copy)
</I>&gt;&gt;<i> @@ -329,7 +329,7 @@
</I>&gt;&gt;<i>  #    define GETPAGESIZE() getpagesize()
</I>&gt;&gt;<i>       /* There seems to be some issues with trylock hanging on darwin. This
</I>&gt;&gt;<i>          should be looked into some more */
</I>&gt;&gt;<i> -#     define NO_PTHREAD_TRYLOCK
</I>&gt;&gt;<i> +//#     define NO_PTHREAD_TRYLOCK
</I>&gt;&gt;<i>  #   elif defined(__arm__)
</I>&gt;&gt;<i>  #    define ARM
</I>&gt;&gt;<i>  #    define mach_type_known
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100125/9a3e1d5d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100125/9a3e1d5d/attachment.html</A> 
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033962.html">[Mono-dev] Mac Boehm CG question
</A></li>
	<LI>Next message: <A HREF="033966.html">[Mono-dev] Mac Boehm CG question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33963">[ date ]</a>
              <a href="thread.html#33963">[ thread ]</a>
              <a href="subject.html#33963">[ subject ]</a>
              <a href="author.html#33963">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
