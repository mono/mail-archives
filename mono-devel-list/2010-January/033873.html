<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] JIT floating point behaviour change between 2.4.2 and 2.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20JIT%20floating%20point%20behaviour%20change%20between%202.4.2%20and%202.6&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033872.html">
   <LINK REL="Next"  HREF="033874.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] JIT floating point behaviour change between 2.4.2 and 2.6</H1>
    <B>Lucas Meijer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20JIT%20floating%20point%20behaviour%20change%20between%202.4.2%20and%202.6&In-Reply-To="
       TITLE="[Mono-dev] JIT floating point behaviour change between 2.4.2 and 2.6">lucas at lucasmeijer.com
       </A><BR>
    <I>Tue Jan 12 10:27:22 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="033872.html">[Mono-dev] Listening in on a port (was the daemon thingy a week or so back)
</A></li>
        <LI>Next message: <A HREF="033874.html">[Mono-dev] JIT floating point behaviour change between 2.4.2	and 2.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33873">[ date ]</a>
              <a href="thread.html#33873">[ thread ]</a>
              <a href="subject.html#33873">[ subject ]</a>
              <a href="author.html#33873">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

In our process to upgrade to mono 2.6, we've hit a snag where floating 
point behaviour of the JIT is slightly differently. This program prints 
&quot;PASS&quot; on mono2.6, and &quot;FAIL&quot; on mono2.4, on both osx, and win32.

using System;

public class Test
{
         static private float x;
         static private float y;

         private static void Main()
         {
                 //input
                 float a = DecodeSingle(0x3070787f);
                 float b = DecodeSingle(0x48a296ba);
                 float c = DecodeSingle(0x3ddc0d93);

                 x = DecodeSingle(0xbfc2f2e5);
                 y = DecodeSingle(0xbd35e18b);

                 // test
                 float abc = (a * b * c);

                 float s = ((a * b * c) / sqrMagnitude);
//same calculation,just using a temporary variable, which seems to matter
                 float t = ((abc) / sqrMagnitude);

                 Console.WriteLine(&quot;Test: {0}&quot;, ((s == t) ? &quot;PASSED&quot; : 
&quot;FAILED&quot;));
         }

         static private float sqrMagnitude
         {
                 get { return ((x * x) + (y * y)); }
         }

         private static float DecodeSingle(uint value)
         {
                 return 
BitConverter.ToSingle(BitConverter.GetBytes(value), 0);
         }
}

The good news is that mono2.6 behaviour looks correct, and Mono2.4 
behaviour wrong. I would really like to find out which svn revision has 
caused this change. We like the new behaviour, but want to temporarily 
get the old behaviour back, so we can succesfully run all our 
integrationtests, and feel confident that the mono upgrade didn't break 
anything. Because of the floating point difference, it's causing a lot 
of games in our regression suite to play back completely differently, 
which makes it hard to see if something else changed as well, or if the 
different playback is purely due to the floating point differences.

I hope one of the JIT guys has a rough guess where this change might 
have been introduced,  if not I'll start a the big boring svn based 
binary search.

Thanks in advance,

   Lucas
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033872.html">[Mono-dev] Listening in on a port (was the daemon thingy a week or so back)
</A></li>
	<LI>Next message: <A HREF="033874.html">[Mono-dev] JIT floating point behaviour change between 2.4.2	and 2.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33873">[ date ]</a>
              <a href="thread.html#33873">[ thread ]</a>
              <a href="subject.html#33873">[ subject ]</a>
              <a href="author.html#33873">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
