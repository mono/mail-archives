<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mono crash on exits when using COM.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mono%20crash%20on%20exits%20when%20using%20COM.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034001.html">
   <LINK REL="Next"  HREF="033952.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mono crash on exits when using COM.</H1>
    <B>tom hindle</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mono%20crash%20on%20exits%20when%20using%20COM.&In-Reply-To="
       TITLE="[Mono-dev] mono crash on exits when using COM.">tom_hindle at sil.org
       </A><BR>
    <I>Fri Jan 22 18:16:51 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034001.html">[Mono-dev] Mac Boehm CG question
</A></li>
        <LI>Next message: <A HREF="033952.html">[Mono-dev] mono crash on exits when using COM.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33951">[ date ]</a>
              <a href="thread.html#33951">[ thread ]</a>
              <a href="subject.html#33951">[ subject ]</a>
              <a href="author.html#33951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I have been investigating some seemingly random crash on exit problems
that our application has been having.

I have managed mostly reliably to reproduce the issue by following this
set of steps: 

1. Create a managed object ManagedObj 
2. Create a COM object COMObj for which its rcw is likely to be Garbage
collected after ManagedObj and during mono shutdown. 
3. Make COMObj contain a ref to ManagedObj's ccw 
4. Set ManagedObj ref to null 
5. Call GC.Collect() to encourage GC. 

If Garbage Collection of COMObj's rcw happens after the Garbage
Collection of ManagedObj's ccw, then when COMObj calls Release on its
ref to ManagedObj's ccw a segv is produced.

Normally it seems that ref counts for the wrappers are respected,
however this doesn't seem to be the case on program shutdown.

Some pseudo code which reproduces the problem:

public class TestComRelease
{
static COMObj cObj;

[Test]
public void Test()
{
   ManagedObj mObj = new ManagedObj()
   cObj = new COMObj();
   cObj.SetManagedRef(mObj);
   mObj = null;
   GC.Collect();
}

}

I am attempting to find the cause of this in mono. Any pointers would be
grateful received.

Thanks
Tom

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034001.html">[Mono-dev] Mac Boehm CG question
</A></li>
	<LI>Next message: <A HREF="033952.html">[Mono-dev] mono crash on exits when using COM.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33951">[ date ]</a>
              <a href="thread.html#33951">[ thread ]</a>
              <a href="subject.html#33951">[ subject ]</a>
              <a href="author.html#33951">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
