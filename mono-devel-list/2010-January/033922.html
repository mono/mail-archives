<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for CookieContainer.SetCookies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20CookieContainer.SetCookies&In-Reply-To=93ED628A-6BFF-4ABC-B73A-F92F8A4246D4%40logos.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033917.html">
   <LINK REL="Next"  HREF="033923.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for CookieContainer.SetCookies</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20CookieContainer.SetCookies&In-Reply-To=93ED628A-6BFF-4ABC-B73A-F92F8A4246D4%40logos.com"
       TITLE="[Mono-dev] Patch for CookieContainer.SetCookies">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Wed Jan 20 16:36:08 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="033917.html">[Mono-dev] Patch for CookieContainer.SetCookies
</A></li>
        <LI>Next message: <A HREF="033923.html">[Mono-dev] Patch for CookieContainer.SetCookies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33922">[ date ]</a>
              <a href="thread.html#33922">[ thread ]</a>
              <a href="subject.html#33922">[ subject ]</a>
              <a href="author.html#33922">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Tom,

On Mon, 2010-01-18 at 15:31 -0800, Tom Philpot wrote:
&gt;<i> The current implementation of CookieContainer.SetCookies does not handle the case where a cookie contains an &quot;expires=...&quot; attribute.
</I>&gt;<i> 
</I>&gt;<i> As documented on MSDN here: <A HREF="http://msdn.microsoft.com/en-us/library/aa384321%28VS.85%29.aspx">http://msdn.microsoft.com/en-us/library/aa384321%28VS.85%29.aspx</A> the &quot;Set-Cookie:&quot; header expires attribute uses the following format: DAY, DD-MMM-YYYY HH:MM:SS GMT
</I>&gt;<i> 
</I>&gt;<i> The current version of SetCookies simply does a split on ',' in the header which totally causes the CookieContainer to choke when the expires attribute is set as MS recommends.
</I>&gt;<i> 
</I>&gt;<i> Also, the Add (Cookie) method of CookieContainer does not clone all the properties of the incoming cookie before adding it to the collection. Using SetCookies(Uri, string) should clone all the properties, so that is fixes as well in the patch and a test is added in the test cases.
</I>&gt;<i> 
</I>&gt;<i> I believe this makes the behavior of CookieContainer more &quot;bug-compatible&quot; with .NET.
</I>&gt;<i> 
</I>&gt;<i> Please review the patch and the test cases.
</I>&gt;<i> 
</I>
Tests run: 5665, Failures: 2, Not run: 30, Time: 93.143 seconds

Test Case Failures:
1) MonoTests.System.Net.CookieContainerTest.SaveAndLoadViaSetCookies :
#A7
  Expected: 2015-01-01 05:00:00.000
  But was:  2015-01-01 08:00:00.000

at MonoTests.System.Net.CookieContainerTest.SaveAndLoadViaSetCookies ()
[0x00109]
in /home/poupou/svn/mcs/class/System/Test/System.Net/CookieContainerTest.cs:1624
at (wrapper managed-to-native)
System.Reflection.MonoMethod:InternalInvoke
(System.Reflection.MonoMethod*,object,object[],System.Exception&amp;)
at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags
invokeAttr, System.Reflection.Binder binder, System.Object[] parameters,
System.Globalization.CultureInfo culture) [0x000ca]
in /home/poupou/svn/mcs/class/corlib/System.Reflection/MonoMethod.cs:212

I get the above error while testing your patch on HEAD. Please fix the
test and re-issue your patch with the correct coding convention.

Thanks
Sebastien

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033917.html">[Mono-dev] Patch for CookieContainer.SetCookies
</A></li>
	<LI>Next message: <A HREF="033923.html">[Mono-dev] Patch for CookieContainer.SetCookies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33922">[ date ]</a>
              <a href="thread.html#33922">[ thread ]</a>
              <a href="subject.html#33922">[ subject ]</a>
              <a href="author.html#33922">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
