<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mac Boehm CG question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mac%20Boehm%20CG%20question&In-Reply-To=97710563-C3DC-4545-A952-04C452E7B49C%40logos.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033949.html">
   <LINK REL="Next"  HREF="033962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mac Boehm CG question</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mac%20Boehm%20CG%20question&In-Reply-To=97710563-C3DC-4545-A952-04C452E7B49C%40logos.com"
       TITLE="[Mono-dev] Mac Boehm CG question">kumpera at gmail.com
       </A><BR>
    <I>Fri Jan 22 17:08:52 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="033949.html">[Mono-dev] Mac Boehm CG question
</A></li>
        <LI>Next message: <A HREF="033962.html">[Mono-dev] Mac Boehm CG question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33950">[ date ]</a>
              <a href="thread.html#33950">[ thread ]</a>
              <a href="subject.html#33950">[ subject ]</a>
              <a href="author.html#33950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>pthread mutexes on OSX are ridiculously slow. So no matter what you do, GC
performance will be significantly worse than on linux.

But we should check if this change is ok if it does give a nice boost.



On Fri, Jan 22, 2010 at 8:05 PM, Tom Philpot &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tom.philpot at logos.com</A>&gt; wrote:

&gt;<i> While investigating some performance problems in our application which uses
</I>&gt;<i> the embedded Mono runtime on Mac OS X targeting 10.5 and 10.6, I noticed
</I>&gt;<i> that several operations spent an extreme amount of time in GC_lock. That
</I>&gt;<i> code lead me back to gcconfig.h where NO_PTHREAD_TRYLOCK is defined. I've
</I>&gt;<i> commented out that #define it on my local Mono build and things seem MUCH
</I>&gt;<i> faster. In fact I'm now able to do real work on more than 2 threads without
</I>&gt;<i> a ton of overhead.
</I>&gt;<i>
</I>&gt;<i> The question is now, does this check still need to be there for later
</I>&gt;<i> versions of Mac OS X? The original commit was back in August 2003, which was
</I>&gt;<i> probably around the timeframe of 10.2 and 10.3 and definitely before the
</I>&gt;<i> Intel Macs. Also, since I don't have a PPC to test on, I didn't comment that
</I>&gt;<i> #define.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ws1048-snow:mono tom.philpot$ svn diff libgc/include/private/gcconfig.h
</I>&gt;<i> Index: libgc/include/private/gcconfig.h
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- libgc/include/private/gcconfig.h    (revision 150077)
</I>&gt;<i> +++ libgc/include/private/gcconfig.h    (working copy)
</I>&gt;<i> @@ -329,7 +329,7 @@
</I>&gt;<i>  #    define GETPAGESIZE() getpagesize()
</I>&gt;<i>       /* There seems to be some issues with trylock hanging on darwin. This
</I>&gt;<i>          should be looked into some more */
</I>&gt;<i> -#     define NO_PTHREAD_TRYLOCK
</I>&gt;<i> +//#     define NO_PTHREAD_TRYLOCK
</I>&gt;<i>  #   elif defined(__arm__)
</I>&gt;<i>  #    define ARM
</I>&gt;<i>  #    define mach_type_known
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100122/b793986a/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100122/b793986a/attachment-0001.html</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033949.html">[Mono-dev] Mac Boehm CG question
</A></li>
	<LI>Next message: <A HREF="033962.html">[Mono-dev] Mac Boehm CG question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33950">[ date ]</a>
              <a href="thread.html#33950">[ thread ]</a>
              <a href="subject.html#33950">[ subject ]</a>
              <a href="author.html#33950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
