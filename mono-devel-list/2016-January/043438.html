<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Multiplatform support with P/Invoke
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Multiplatform%20support%20with%20P/Invoke&In-Reply-To=%3CCANqeOFq2ZxR8BqxdKMGMFFiVpY%3DYgzL6_vQqYA-PyxVREiouxw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043437.html">
   <LINK REL="Next"  HREF="043439.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Multiplatform support with P/Invoke</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Multiplatform%20support%20with%20P/Invoke&In-Reply-To=%3CCANqeOFq2ZxR8BqxdKMGMFFiVpY%3DYgzL6_vQqYA-PyxVREiouxw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Multiplatform support with P/Invoke">miguel at xamarin.com
       </A><BR>
    <I>Fri Jan  1 02:47:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043437.html">[Mono-dev] Multiplatform support with P/Invoke
</A></li>
        <LI>Next message: <A HREF="043439.html">[Mono-dev] Multiplatform support with P/Invoke
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43438">[ date ]</a>
              <a href="thread.html#43438">[ thread ]</a>
              <a href="subject.html#43438">[ subject ]</a>
              <a href="author.html#43438">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Re-reading your original question makes me wonder if you really need
something as heavy handed as the approach on Mono.Posix.

The challenge that Mono.Posix faces is that the structures exposed in each
Unix is slightly different (different location for fields, different data
types for fields), so Mono.Posix resorts to defining its own interface, say
instead of using &quot;struct stat&quot; and trying to have one universal
implementation that works across many different Unix systems - it instead
defines a &quot;struct MyStat&quot; which has well known fields at well known
locations with well known sizes.

Then the C glue maps between those two.

But in your case, it is not clear if you are trying to bind libc and their
structures, or trying to bind your own C library that already has a stable
ABI.  If you are coping with the latter, you do not need a setup as tedious
as the one that Mono.Posix does, you merely need to ship your native
library for each platform you intend to support and your C# code that calls
into it.

Miguel

On Thu, Dec 31, 2015 at 8:15 PM, Jason Curl &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jcurlnews at arcor.de</A>&gt; wrote:

&gt;<i> Thank you Mr. Icaza.
</I>&gt;<i>
</I>&gt;<i> Is there more information on what uses the MapAttribute than what's in
</I>&gt;<i> Syscall.cs? Even though it's internal and I won't use it, I'd like to
</I>&gt;<i> understand how you solve the problem of ABI compatibility.
</I>&gt;<i>
</I>&gt;<i> I'd like to set up a solution where copying the files from one
</I>&gt;<i> architecture to another simply works (assuming all dependencies from the
</I>&gt;<i> runtime are present), and the runtime/mylib chooses the most appropriate
</I>&gt;<i> native library (based on OSVersion and Syscall.uname) for all supported
</I>&gt;<i> platforms. Something like:
</I>&gt;<i> * MyLib.dll (assembly)
</I>&gt;<i> * MyNativeLib.Linux.x86.so
</I>&gt;<i> * MyNativeLib.Linux.x64.so
</I>&gt;<i> * MyNativeLib.FreeBSD.x86.so
</I>&gt;<i> * MyNativeLib.Darwin.x86.so
</I>&gt;<i> * MyNativeLib.Win.x86.dll (windows native)
</I>&gt;<i> * MyNativeLib.Win.x64.dll (windows native)
</I>&gt;<i> * MyNativeLib.[dll|so] (backup for local builds)
</I>&gt;<i>
</I>&gt;<i> Your solution (Mono.Unix.Native) looks different, more compact, but I'm
</I>&gt;<i> not sure if/how it supports side-by-side. My solution requires a lot of
</I>&gt;<i> work, duplicate code with small changes in defining the structs/DllImports
</I>&gt;<i> with different offsets and library names.
</I>&gt;<i>
</I>&gt;<i> I've yet to look into the Dll mapping mechanism of Mono if that's also
</I>&gt;<i> suitable.
</I>&gt;<i>
</I>&gt;<i> Thank you very much and for giving me the opportunity to use Mono.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Jason.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 2015-12-31 02:04, Miguel de Icaza wrote:
</I>&gt;<i>
</I>&gt;<i> For something like libc, you can use an approach similar to what
</I>&gt;<i> Mono.Posix does, where an intermediate C glue file acts as a bridge between
</I>&gt;<i> the API differences.
</I>&gt;<i>
</I>&gt;<i> See the P/Invokes for the Mono.Posix assembly, and its supporting glue
</I>&gt;<i> code in mono/support/
</I>&gt;<i>
</I>&gt;<i> On Wed, Dec 30, 2015 at 5:58 AM, Jason Curl &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jcurlnews at arcor.de</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm investigating the best way on how to support multiplatform software
</I>&gt;&gt;<i> especially when using P/Invokes, but have not found any reasonable advice
</I>&gt;&gt;<i> on the Wiki.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can someone point to me on how to handle different architectures,
</I>&gt;&gt;<i> especially when the underlying libc might use different structures or API
</I>&gt;&gt;<i> signatures?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Jason.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20151231/f5df8b3f/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20151231/f5df8b3f/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043437.html">[Mono-dev] Multiplatform support with P/Invoke
</A></li>
	<LI>Next message: <A HREF="043439.html">[Mono-dev] Multiplatform support with P/Invoke
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43438">[ date ]</a>
              <a href="thread.html#43438">[ thread ]</a>
              <a href="subject.html#43438">[ subject ]</a>
              <a href="author.html#43438">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
