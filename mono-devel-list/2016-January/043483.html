<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] ZipArchiveEntry - issue with reopening entries
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ZipArchiveEntry%20-%20issue%20with%20reopening%20entries&In-Reply-To=%3C1453976992060-4667333.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043481.html">
   <LINK REL="Next"  HREF="043484.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] ZipArchiveEntry - issue with reopening entries</H1>
    <B>Numpsy</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ZipArchiveEntry%20-%20issue%20with%20reopening%20entries&In-Reply-To=%3C1453976992060-4667333.post%40n4.nabble.com%3E"
       TITLE="[Mono-dev] ZipArchiveEntry - issue with reopening entries">webby at beardmouse.org.uk
       </A><BR>
    <I>Thu Jan 28 10:29:52 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043481.html">[Mono-dev] Data protection failed exception
</A></li>
        <LI>Next message: <A HREF="043484.html">[Mono-dev] mkbundle --mono : Cannot find assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43483">[ date ]</a>
              <a href="thread.html#43483">[ thread ]</a>
              <a href="subject.html#43483">[ subject ]</a>
              <a href="author.html#43483">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been trying to use the latest version of the Open XML SDK with Mono
4.3.3 (built off the master branch), and as described at
<A HREF="https://github.com/OfficeDev/Open-XML-SDK/issues/74">https://github.com/OfficeDev/Open-XML-SDK/issues/74</A> I'm running into a
problem that looks to be a Mono issue.

I think it essentially reduces down to the situation that the code


using (ZipArchive archive = new ZipArchive(input, ZipArchiveMode.Update))
     {
         ZipArchiveEntry selectorEntry = archive.GetEntry(&quot;readme.txt&quot;);
         using (Stream temp = selectorEntry.Open())
          {
              Console.WriteLine(&quot;Open1&quot;);
          }

         using (Stream temp = selectorEntry.Open())
          {
               Console.WriteLine(&quot;Open2&quot;);
          }
     }

Works on MS .NET4.5 but on Mono throws an exception on the second open,
because it thinks the stream is already open although it has actually been
closed.

I'm wondering, should the

 if (openStream != null &amp;&amp; Archive.Mode == ZipArchiveMode.Update)
                throw new IOException(&quot;The entry is already currently open
for writing.&quot;);

In ZipArchiveEntry.Open() be a bit more clever, and do something like check
if the stream has been disposed, even though it's non-null?



--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/ZipArchiveEntry-issue-with-reopening-entries-tp4667333.html">http://mono.1490590.n4.nabble.com/ZipArchiveEntry-issue-with-reopening-entries-tp4667333.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043481.html">[Mono-dev] Data protection failed exception
</A></li>
	<LI>Next message: <A HREF="043484.html">[Mono-dev] mkbundle --mono : Cannot find assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43483">[ date ]</a>
              <a href="thread.html#43483">[ thread ]</a>
              <a href="subject.html#43483">[ subject ]</a>
              <a href="author.html#43483">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
