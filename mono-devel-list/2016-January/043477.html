<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] How to debug native code?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20How%20to%20debug%20native%20code%3F&In-Reply-To=%3C56A00DF4.8030809%40linux.vnet.ibm.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043473.html">
   <LINK REL="Next"  HREF="043474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] How to debug native code?</H1>
    <B>Bill Seurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20How%20to%20debug%20native%20code%3F&In-Reply-To=%3C56A00DF4.8030809%40linux.vnet.ibm.com%3E"
       TITLE="[Mono-dev] How to debug native code?">seurer at linux.vnet.ibm.com
       </A><BR>
    <I>Wed Jan 20 22:45:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043473.html">[Mono-dev] How to debug native code?
</A></li>
        <LI>Next message: <A HREF="043474.html">[Mono-dev] Strange build problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43477">[ date ]</a>
              <a href="thread.html#43477">[ thread ]</a>
              <a href="subject.html#43477">[ subject ]</a>
              <a href="author.html#43477">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>When I am debugging problems with native code I use gdb to debug it.  I 
have used other debuggers, too.

If you watch the commands that are running you should be able to see 
when the mono program is called.  Note the parameters.  Then run the 
debugger on mono and then run the program within the debugger using the 
parameters you noted.  When the segmentation fault occurs you can see 
where it happened.

If you add -v options on mono (try using more than one) you can get a 
trace of what native functions are called and the assembler for those 
functions.

Within the debugger you can use this command:

print mono_pmip($pc)

to see the name of the native function you are inside of.


On 01/18/16 20:14, Pin Cheng wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I am trying to port Mono into Aix host, I have am very fundamental question:
</I>&gt;<i>
</I>&gt;<i> How are you guys debug native code?
</I>&gt;<i>
</I>&gt;<i> Because JIT compiler compiles assembly into native code then JIT invoke it,
</I>&gt;<i>
</I>&gt;<i> I am very curious if there errors in native code How do you find out the
</I>&gt;<i> bug and fix it.
</I>&gt;<i>
</I>&gt;<i> And if you updates the cpu-&lt;ARCH&gt;.md or &lt;ARCH&gt;-codegen.h how do you
</I>&gt;<i> verify your changes is ok?
</I>&gt;<i>
</I>&gt;<i> There must be somewhat effect method to debug the JIT and it specific
</I>&gt;<i> architecture.
</I>&gt;<i>
</I>&gt;<i> Since I am porting Mono into Aix, I got  assembler code which
</I>&gt;<i> disassembled from native code:
</I>&gt;<i>
</I>&gt;<i>     0:         7c 08 02 a6           mflr    r0
</I>&gt;<i>
</I>&gt;<i>     4:         90 01 00 04          stw     r0,4(r1)
</I>&gt;<i>
</I>&gt;<i>     8:         94 21 ff b0           stwu    r1,-80(r1)
</I>&gt;<i>
</I>&gt;<i>     c:          93 61 00 48          stw     r27,72(r1)
</I>&gt;<i>
</I>&gt;<i>    10:        93 e1 00 4c          stw     r31,76(r1)
</I>&gt;<i>
</I>&gt;<i>    14:        7c 3f 0b 78           mr      r31,r1
</I>&gt;<i>
</I>&gt;<i>    18:        90 7f 00 28           stw     r3,40(r31)
</I>&gt;<i>
</I>&gt;<i>    1c:        90 9f 00 2c           stw     r4,44(r31)
</I>&gt;<i>
</I>&gt;<i>    20:        90 bf 00 30           stw     r5,48(r31)
</I>&gt;<i>
</I>&gt;<i>    24:        90 df 00 34           stw     r6,52(r31)
</I>&gt;<i>
</I>&gt;<i>    28:        38 60 00 00          li      r3,0
</I>&gt;<i>
</I>&gt;<i>    2c:        90 7f 00 20           stw     r3,32(r31)
</I>&gt;<i>
</I>&gt;<i>    30:        38 60 00 00          li      r3,0
</I>&gt;<i>
</I>&gt;<i>    34:        90 7f 00 24           stw     r3,36(r31)
</I>&gt;<i>
</I>&gt;<i>    38:        80 7f 00 30           lwz     r3,48(r31)
</I>&gt;<i>
</I>&gt;<i>    3c:        2c 03 00 00           cmpwi   r3,0
</I>&gt;<i>
</I>&gt;<i>    40:        41 82 00 a4          beq     0xe4
</I>&gt;<i>
</I>&gt;<i>    44:        3c 60 20 03           lis     r3,8195
</I>&gt;<i>
</I>&gt;<i>    48:        60 63 e5 04          ori     r3,r3,58628
</I>&gt;<i>
</I>&gt;<i>    4c:        80 63 00 00          lwz     r3,0(r3)
</I>&gt;<i>
</I>&gt;<i>    50:        2c 03 00 00           cmpwi   r3,0
</I>&gt;<i>
</I>&gt;<i>    54:        41 82 00 38          beq     0x8c
</I>&gt;<i>
</I>&gt;<i>    58:        3d 80 30 3c          lis     r12,12348
</I>&gt;<i>
</I>&gt;<i>    5c:        61 8c cd d8          ori     r12,r12,52696
</I>&gt;<i>
</I>&gt;<i>    60:        7d 88 03 a6          mtlr    r12
</I>&gt;<i>
</I>&gt;<i>    64:        4e 80 00 21          blrl
</I>&gt;<i>
</I>&gt;<i>    68:        7c 64 1b 78          mr      r4,r3
</I>&gt;<i>
</I>&gt;<i>    6c:        7c 9b 23 78          mr      r27,r4
</I>&gt;<i>
</I>&gt;<i>    70:        2c 03 00 00           cmpwi   r3,0
</I>&gt;<i>
</I>&gt;<i>    74:        41 82 00 18          beq     0x8c
</I>&gt;<i>
</I>&gt;<i>    78:        7f 63 db 78          mr      r3,r27
</I>&gt;<i>
</I>&gt;<i>    7c:        3d 80 30 00          lis     r12,12288
</I>&gt;<i>
</I>&gt;<i>    80:        61 8c 82 90           ori     r12,r12,33424
</I>&gt;<i>
</I>&gt;<i>    84:        7d 88 03 a6          mtlr    r12
</I>&gt;<i>
</I>&gt;<i>    88:        4e 80 00 21          blrl
</I>&gt;<i>
</I>&gt;<i>    8c:        80 7f 00 2c           lwz     r3,44(r31)
</I>&gt;<i>
</I>&gt;<i>    90:        80 83 00 00          lwz     r4,0(r3)
</I>&gt;<i>
</I>&gt;<i>    94:        80 7f 00 28           lwz     r3,40(r31)
</I>&gt;<i>
</I>&gt;<i>    98:        80 bf 00 34           lwz     r5,52(r31)
</I>&gt;<i>
</I>&gt;<i>    9c:        7c a8 03 a6           mtlr    r5
</I>&gt;<i>
</I>&gt;<i>    a0:        4e 80 00 21          blrl
</I>&gt;<i>
</I>&gt;<i>    a4:        48 00 00 38          b       0xdc
</I>&gt;<i>
</I>&gt;<i>    a8:        80 7f 00 1c           lwz     r3,28(r31)
</I>&gt;<i>
</I>&gt;<i>    ac:        80 7f 00 1c           lwz     r3,28(r31)
</I>&gt;<i>
</I>&gt;<i>    b0:        90 7f 00 24           stw     r3,36(r31)
</I>&gt;<i>
</I>&gt;<i>    b4:        80 7f 00 30           lwz     r3,48(r31)
</I>&gt;<i>
</I>&gt;<i>    b8:        80 9f 00 24           lwz     r4,36(r31)
</I>&gt;<i>
</I>&gt;<i>    bc:        90 9f 00 40           stw     r4,64(r31)
</I>&gt;<i>
</I>&gt;<i>    c0:        90 83 00 00          stw     r4,0(r3)
</I>&gt;<i>
</I>&gt;<i>    c4:        3d 80 30 3c          lis     r12,12348
</I>&gt;<i>
</I>&gt;<i>    c8:        61 8c cf 50            ori     r12,r12,53072
</I>&gt;<i>
</I>&gt;<i>    cc:         7d 88 03 a6          mtlr    r12
</I>&gt;<i>
</I>&gt;<i>    d0:        4e 80 00 21          blrl
</I>&gt;<i>
</I>&gt;<i>    d4:        80 7f 00 40           lwz     r3,64(r31)
</I>&gt;<i>
</I>&gt;<i>    d8:        48 00 00 04          b       0xdc
</I>&gt;<i>
</I>&gt;<i>    dc:        80 7f 00 20           lwz     r3,32(r31)
</I>&gt;<i>
</I>&gt;<i>    e0:        48 00 00 38          b       0x118
</I>&gt;<i>
</I>&gt;<i>    e4:        3c 60 20 03           lis     r3,8195
</I>&gt;<i>
</I>&gt;<i>    e8:        60 63 e5 04          ori     r3,r3,58628
</I>&gt;<i>
</I>&gt;<i>    ec:        80 63 00 00          lwz     r3,0(r3)
</I>&gt;<i>
</I>&gt;<i>    f0:         28 03 00 00          cmplwi  r3,0
</I>&gt;<i>
</I>&gt;<i>    f4:         40 82 00 40          bne     0x134
</I>&gt;<i>
</I>&gt;<i>    f8:         48 00 00 04          b       0xfc
</I>&gt;<i>
</I>&gt;<i>    fc:         80 7f 00 2c           lwz     r3,44(r31)
</I>&gt;<i>
</I>&gt;<i> 100:       80 83 00 00          lwz     r4,0(r3)
</I>&gt;<i>
</I>&gt;<i> 104:       80 7f 00 28           lwz     r3,40(r31)
</I>&gt;<i>
</I>&gt;<i> 108:       80 bf 00 34           lwz     r5,52(r31)
</I>&gt;<i>
</I>&gt;<i> 10c:       7c a8 03 a6           mtlr    r5
</I>&gt;<i>
</I>&gt;<i> 110:       4e 80 00 21          blrl
</I>&gt;<i>
</I>&gt;<i> 114:       80 7f 00 20           lwz     r3,32(r31)
</I>&gt;<i>
</I>&gt;<i> 118:       80 1f 00 54           lwz     r0,84(r31)
</I>&gt;<i>
</I>&gt;<i> 11c:       7c 08 03 a6           mtlr    r0
</I>&gt;<i>
</I>&gt;<i> 120:       7f ec fb 78           mr      r12,r31
</I>&gt;<i>
</I>&gt;<i> 124:       83 7f 00 48           lwz     r27,72(r31)
</I>&gt;<i>
</I>&gt;<i> 128:       83 ff 00 4c            lwz     r31,76(r31)
</I>&gt;<i>
</I>&gt;<i> 12c:       38 2c 00 50           addi    r1,r12,80
</I>&gt;<i>
</I>&gt;<i> 130:       4e 80 00 20          blr
</I>&gt;<i>
</I>&gt;<i> 134:       3d 80 30 3c          lis     r12,12348
</I>&gt;<i>
</I>&gt;<i> 138:       61 8c cd d8          ori     r12,r12,52696
</I>&gt;<i>
</I>&gt;<i> 13c:       7d 88 03 a6          mtlr    r12
</I>&gt;<i>
</I>&gt;<i> 140:       4e 80 00 21          blrl
</I>&gt;<i>
</I>&gt;<i> 144:       7c 64 1b 78          mr      r4,r3
</I>&gt;<i>
</I>&gt;<i> 148:       7c 9b 23 78          mr      r27,r4
</I>&gt;<i>
</I>&gt;<i> 14c:       2c 03 00 00           cmpwi   r3,0
</I>&gt;<i>
</I>&gt;<i> 150:       41 82 ff ac            beq     0xfc
</I>&gt;<i>
</I>&gt;<i> 154:       7f 63 db 78          mr      r3,r27
</I>&gt;<i>
</I>&gt;<i> 158:       3d 80 30 00          lis     r12,12288
</I>&gt;<i>
</I>&gt;<i> 15c:       61 8c 82 90           ori     r12,r12,33424
</I>&gt;<i>
</I>&gt;<i> 160:       7d 88 03 a6          mtlr    r12
</I>&gt;<i>
</I>&gt;<i> 164:       4e 80 00 21          blrl
</I>&gt;<i>
</I>&gt;<i> This code leads to core dump, it is the body of
</I>&gt;<i>
</I>&gt;<i> method ((wrapper runtime-invoke)
</I>&gt;<i> &lt;Module&gt;:runtime_invoke_void__this___object (object,intptr,intptr,intptr))
</I>&gt;<i>
</I>&gt;<i>  From such code, How could I tell where leads to core dump?
</I>&gt;<i>
</I>&gt;<i> Please help me or give me a clue.
</I>&gt;<i>
</I>&gt;<i> Thank you very much!
</I>&gt;<i>
</I>&gt;<i> *//*
</I>&gt;<i>
</I>&gt;<i> */Pin /*
</I>&gt;<i>
</I>&gt;<i> ================================
</I>&gt;<i> Rocket Software, Inc. and subsidiaries &#9632; 77 Fourth Avenue, Waltham MA
</I>&gt;<i> 02451 &#9632; +1 800.966.3270 &#9632; +1 781.577.4321
</I>&gt;<i> Unsubscribe From Commercial Email &#8211; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">unsubscribe at rocketsoftware.com</A>
</I>&gt;<i> Manage Your Subscription Preferences -
</I>&gt;<i> <A HREF="http://info.rocketsoftware.com/GlobalSubscriptionManagementEmailFooter_SubscriptionCenter.html">http://info.rocketsoftware.com/GlobalSubscriptionManagementEmailFooter_SubscriptionCenter.html</A>
</I>&gt;<i> Privacy Policy - <A HREF="http://www.rocketsoftware.com/company/legal/privacy-policy">http://www.rocketsoftware.com/company/legal/privacy-policy</A>
</I>&gt;<i> ================================
</I>&gt;<i>
</I>&gt;<i> This communication and any attachments may contain confidential
</I>&gt;<i> information of Rocket Software, Inc. All unauthorized use, disclosure or
</I>&gt;<i> distribution is prohibited. If you are not the intended recipient,
</I>&gt;<i> please notify Rocket Software immediately and destroy all copies of this
</I>&gt;<i> communication. Thank you.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

-- 

-Bill Seurer

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043473.html">[Mono-dev] How to debug native code?
</A></li>
	<LI>Next message: <A HREF="043474.html">[Mono-dev] Strange build problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43477">[ date ]</a>
              <a href="thread.html#43477">[ thread ]</a>
              <a href="subject.html#43477">[ subject ]</a>
              <a href="author.html#43477">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
