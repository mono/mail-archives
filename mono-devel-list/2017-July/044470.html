<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Sync of mono Cert Store
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20Sync%20of%20mono%20Cert%20Store&In-Reply-To=%3CCAAZEOjsamuT0qMJBWgZwAPonSUx2i40E-qcUX-mZ0fZApbZy_A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="044467.html">
   <LINK REL="Next"  HREF="044472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Sync of mono Cert Store</H1>
    <B>Rick Tillery</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20Sync%20of%20mono%20Cert%20Store&In-Reply-To=%3CCAAZEOjsamuT0qMJBWgZwAPonSUx2i40E-qcUX-mZ0fZApbZy_A%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Sync of mono Cert Store">rtillerywork at gmail.com
       </A><BR>
    <I>Mon Jul 17 15:39:44 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="044467.html">[Mono-dev] Sync of mono Cert Store
</A></li>
        <LI>Next message (by thread): <A HREF="044472.html">[Mono-dev] Sync of mono Cert Store
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44470">[ date ]</a>
              <a href="thread.html#44470">[ thread ]</a>
              <a href="subject.html#44470">[ subject ]</a>
              <a href="author.html#44470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just FYI, I don't see anything in the CentOS packaging to keep the mono
cert store sync'd with the system cert store after the initial sync during
install.

The method used by Debian appears to be use of a feature included with the
system's update-ca-certificates script, causing additional scripts added to
/etc/ca-certificates/update.d/ to be executed after a certificate update.
However, the update-ca-trust script, which seems to be the equivalent in
CentOS/RHEL(/Fedora?), does not have a similar design.

We're considering a couple of approaches, and if the chosen method is not
specific to our project, and if there is interest, I'd like to share it
here for potential inclusion with the mono rpm package.

With that in mind, I thought I could share some options and ask the experts
here for any advice or comments:

1. cron job to call cert-sync
2. use systemd.path (el7) and inotifywait (&lt;el7) to monitor for writes to
/etc/pki/tls/certs/ca-bundle.crt
3. use systemd.path (el7) and inotifywait (&lt;el7) to monitor for reads
from /usr/bin/update-ca-trust
4. use FileSystemWatcher to monitor for writes to
/etc/pki/tls/certs/ca-bundle.crt
5. use FileSystemWatcher to monitor for reads from /usr/bin/update-ca-trust

In all cases, /etc/pki/tls/certs/ca-bundle.crt timestamp would be checked
against the last sync date (either explicitly stored or by referencing the
timestamps in /use/share/.mono/certs) before calling cert-sync, to cut down
on unnecessary syncs.

Clearly #1 is not a great idea (blindly, continuously polling for a very
rare occurrence).

For &lt;el7, #2 &amp; #3 require installation of the inotify-tools package.  This
is in the epel repository, but this repo is not enabled by default, and we
are reluctant to force our customers to enable this.  Alternatively, we
could include the inotify tools in our package, but this will require extra
research and testing to ensure that what is included doesn't have other
dependencies in alternative repos or have compatibility issues with certain
versions of CentOS/RHEL.

Additionally, monitoring /etc/pki/tls/certs/ca-bundle.crt seems like it
could be a problem, as this is a symlink and might change going forward.
OTOH, the installation of mono-core uses this specific path for the initial
sync, meaning a change here would already affect mono cert store syncing.

So at this point, we're considering option #5 vs a product-specific
approach (syncing before each call back to our server), assuming
FileSystemWatcher will work for both CentOS/RHEL 7 and CentOS/RHEL 6.

Does anyone have any thoughts on this?

Rick

On Jul 13, 2017 7:01 PM, &quot;Rick Tillery&quot; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">rtillerywork at gmail.com</A>&gt; wrote:

&gt;<i> Fantastic! I don't see that in the RPM, but I'll take a look.
</I>&gt;<i>
</I>&gt;<i> Thanks again!
</I>&gt;<i> Rick
</I>&gt;<i>
</I>&gt;<i> On Jul 13, 2017 6:18 PM, &quot;Alexander KÃ¶plinger&quot; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">alkpli at microsoft.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> When Mono is installed from our packages (specifically the
</I>&gt;&gt;<i> ca-certificates-mono package*), we're adding a hook
</I>&gt;&gt;<i> into /etc/ca-certificates/update.d/ which runs cert-sync automatically
</I>&gt;&gt;<i> whenever the system certificates are updated by the update-ca-certificates
</I>&gt;&gt;<i> command.
</I>&gt;&gt;<i> This is the same approach that Java is taking as far as I know, so it
</I>&gt;&gt;<i> should &quot;just work&quot; out of the box :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I guess you could do something similar for your bundled Mono.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - Alex
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * at least that's how it works on Debian et.al., I'm not really familiar
</I>&gt;&gt;<i> with how we're doing it on RPM distros
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 14 Jul 2017, at 00:13, Rick Tillery &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">rtillerywork at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks, Dave. Yes, that's how our install syncs in the first place.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The thing is that customers would need to know to run this on their
</I>&gt;&gt;<i> machines in addition to modifying the system cert store.  (Plus, it's a bit
</I>&gt;&gt;<i> more complicated &amp; nonstandard because we have a bundled mono, while
</I>&gt;&gt;<i> they're may not even be any system mono installed.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm willing to create a method to automatically update the mono cert
</I>&gt;&gt;<i> store when the system cert store changes, but I want to understand whether
</I>&gt;&gt;<i> there is a different expectation about how cert updates are done &amp; if there
</I>&gt;&gt;<i> are issues to consider with such a tool.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Rick
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Jul 13, 2017 5:04 PM, &quot;David Curylo&quot; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">curylod at asme.org</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Rick,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can run `cert-sync` at any time to synchronize new certs with your
</I>&gt;&gt;<i> mono cert store.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Dave
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; On Jul 13, 2017, at 6:01 PM, Rick Tillery &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">rtillerywork at gmail.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; As a follow-up my previous question (thanks Alex), we have a concern
</I>&gt;&gt;<i> about changes to the system certificate store &amp; synchronization with the
</I>&gt;&gt;<i> mono cert store.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I see that the system cert store is imported to mono on install (&amp; we
</I>&gt;&gt;<i> now do this as well in our install), but what is the expected approach to
</I>&gt;&gt;<i> keeping the mono cert store updated? For example, if a certificate needs to
</I>&gt;&gt;<i> be added or revoked, is it expected that the admin knows that the mono cert
</I>&gt;&gt;<i> store needs to be manually updated too (and doesn't Java have a separate
</I>&gt;&gt;<i> cert store too, meaning that must be manually dealt with as well?)?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; (I didn't find there proper search terms with Google to show me much
</I>&gt;&gt;<i> about this.)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Is there a reason not to create a method of syncing these, so changes
</I>&gt;&gt;<i> to the system cert store automatically get copied into the mono cert store?
</I>&gt;&gt;<i> Is there an accepted (safe) method of doing this?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Rick
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">http://lists.dot.net/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i> &lt;<A HREF="https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.dot.net%2Fmailman%2Flistinfo%2Fmono-devel-list&amp;data=02%7C01%7Calkpli%40microsoft.com%7Ce25377d6f7f04f432e3708d4ca3c667a%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636355808162250712&amp;sdata=pT9S5%2FDYxUHMMbfUOv1UX%2BzuIxHYt8JRNdyMTDtQZTM%3D&amp;reserved=0">https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Flists.dot.net%2Fmailman%2Flistinfo%2Fmono-devel-list&amp;data=02%7C01%7Calkpli%40microsoft.com%7Ce25377d6f7f04f432e3708d4ca3c667a%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636355808162250712&amp;sdata=pT9S5%2FDYxUHMMbfUOv1UX%2BzuIxHYt8JRNdyMTDtQZTM%3D&amp;reserved=0</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;&gt;<i> <A HREF="https://na01.safelinks.protection.outlook.com/?url=http%3A%2">https://na01.safelinks.protection.outlook.com/?url=http%3A%2</A>
</I>&gt;&gt;<i> F%2Flists.dot.net%2Fmailman%2Flistinfo%2Fmono-devel-list&amp;dat
</I>&gt;&gt;<i> a=02%7C01%7Calkpli%40microsoft.com%7Ce25377d6f7f04f432e3708d
</I>&gt;&gt;<i> 4ca3c667a%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C63635
</I>&gt;&gt;<i> 5808162250712&amp;sdata=pT9S5%2FDYxUHMMbfUOv1UX%2BzuIxHYt8JRNdyM
</I>&gt;&gt;<i> TDtQZTM%3D&amp;reserved=0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20170717/a242b255/attachment.html">http://lists.dot.net/pipermail/mono-devel-list/attachments/20170717/a242b255/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="044467.html">[Mono-dev] Sync of mono Cert Store
</A></li>
	<LI>Next message (by thread): <A HREF="044472.html">[Mono-dev] Sync of mono Cert Store
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#44470">[ date ]</a>
              <a href="thread.html#44470">[ thread ]</a>
              <a href="subject.html#44470">[ subject ]</a>
              <a href="author.html#44470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
