<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] minimal setup for embedded application
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20minimal%20setup%20for%20embedded%20application&In-Reply-To=%3C1096BD3D-7F58-48D9-BF8D-6D9733D6DC9C%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038725.html">
   <LINK REL="Next"  HREF="038726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] minimal setup for embedded application</H1>
    <B>Jonathan Shore</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20minimal%20setup%20for%20embedded%20application&In-Reply-To=%3C1096BD3D-7F58-48D9-BF8D-6D9733D6DC9C%40gmail.com%3E"
       TITLE="[Mono-dev] minimal setup for embedded application">jonathan.shore at gmail.com
       </A><BR>
    <I>Tue Apr  3 00:26:12 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="038725.html">[Mono-dev] The ServiceHost must have at least one application	endpoint
</A></li>
        <LI>Next message: <A HREF="038726.html">[Mono-dev] minimal setup for embedded application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38724">[ date ]</a>
              <a href="thread.html#38724">[ thread ]</a>
              <a href="subject.html#38724">[ subject ]</a>
              <a href="author.html#38724">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

So I've been running some embedded apps with mono for a while successfully.   In each case have a full mono installation available locally on the box on which the application is run.

I needed to create a minimal mono environment  so can run the app with embedded mono, but without a full mono installation.   My application just depends on mscorlib.dll, System.Core.dll, and System.Data.dll (4.0).  I am testing on a virgin install of ubuntu 10.4, which for better or worse has an ancient mono installed (2.4.4), but would represent the typical target environment.  

I created a very minimal install and directed the mono VM to find what it needs in the application-local install, with:

   mono_set_dirs (myapp_lib, myapp_etc);
This appears to work as expected.   Was able to load my assembly and start evaluation of a function.   However, ran into a problem when one of the functions attempts to use reflection to find a type.   I called Assembly.GetTypes() on the System.Core assembly, but throws the following exception:

searching assembly: System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
exception: System.Reflection.ReflectionTypeLoadException: The classes in the module cannot be loaded.
  at (wrapper managed-to-native) System.Reflection.Assembly:GetTypes (System.Reflection.Assembly,bool)
  at System.Reflection.Assembly.GetTypes () [0x00000] in &lt;filename unknown&gt;:0 

(the &quot;searching&quot; message is a diagnostic from my code).   I believe it successfully located System.Core, but for some reason is failing to load the classes.   Previously I did not have System.Core.dll in the same directory with my application dll and it complained about not finding (so it has definitely found the dll).

Any ideas on what causes the System.Reflection.ReflectionTypeLoadException to be thrown?

My setup is as follows:

$ ls lib
com.gf.core.dll  mono  System.Core.dll  System.Data.dll

$ ls mono
2.0 4.0

$ ls mono/2.0
mscorlib.dll  System.Core.dll  System.Data.dll

$ ls mono/4.0
mscorlib.dll  System.Core.dll  System.Data.dll

In my code, mono_set_dirs (...) is set to point to lib, and appears to pick up the dlls correctly.    Would the exception result from a DLL dependency or environmental element that is required?   Could the ancient mono 2.4.4 bundled with ubuntu be interfering?


Thanks
Jonathan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120402/7cf9c6ed/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20120402/7cf9c6ed/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038725.html">[Mono-dev] The ServiceHost must have at least one application	endpoint
</A></li>
	<LI>Next message: <A HREF="038726.html">[Mono-dev] minimal setup for embedded application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38724">[ date ]</a>
              <a href="thread.html#38724">[ thread ]</a>
              <a href="subject.html#38724">[ subject ]</a>
              <a href="author.html#38724">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
