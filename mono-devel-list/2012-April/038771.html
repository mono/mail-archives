<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] DllImport(&quot;__Internal&quot;) and libMonoPosixHelper static build
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20DllImport%28%22__Internal%22%29%20and%20libMonoPosixHelper%0A%20static%20build&In-Reply-To=%3C855C3728-219B-4B26-A194-165FBA11C31F%40vt.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038761.html">
   <LINK REL="Next"  HREF="038762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] DllImport(&quot;__Internal&quot;) and libMonoPosixHelper static build</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20DllImport%28%22__Internal%22%29%20and%20libMonoPosixHelper%0A%20static%20build&In-Reply-To=%3C855C3728-219B-4B26-A194-165FBA11C31F%40vt.edu%3E"
       TITLE="[Mono-dev] DllImport(&quot;__Internal&quot;) and libMonoPosixHelper static build">jonpryor at vt.edu
       </A><BR>
    <I>Mon Apr 16 17:32:52 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="038761.html">[Mono-dev] DllImport(&quot;__Internal&quot;) and libMonoPosixHelper	static build
</A></li>
        <LI>Next message: <A HREF="038762.html">[Mono-dev] Building a code optimizer for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38771">[ date ]</a>
              <a href="thread.html#38771">[ thread ]</a>
              <a href="subject.html#38771">[ subject ]</a>
              <a href="author.html#38771">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 12, 2012, at 3:43 AM, ralphbariz wrote:
&gt;<i> I'm trying to compile a static one binary mono(Because the target system has an incompatible loader).
</I>
What platform is this? What kind of loader does your target system have? Does it have any shared library loader?

&gt;<i> After a few tries, I got also this, changed all DllImport(MPH) calls in Mono.Posix.dll to DllImport(&quot;__Internal&quot;),
</I>
DllImport(&quot;__Internal&quot;) requires that the target platform (1) support dlopen(NULL, mode) to open the main executable, and (2) that dlsym() be able to find symbols within the main executable.

Note that (1) is not true for Windows, so [DllImport(&quot;__Internal&quot;)] will not work on Windows (iirc).

&gt;<i> it still gives me a TypeInitializationexception when I try to access the stat symbol of the libMonoPosixHelper.
</I>
That's odd; Syscall.stat() P/Invokes Mono_Posix_Syscall_stat(), not stat():

	<A HREF="https://github.com/mono/mono/blob/master/mcs/class/Mono.Posix/Mono.Unix.Native/Syscall.cs#L2851">https://github.com/mono/mono/blob/master/mcs/class/Mono.Posix/Mono.Unix.Native/Syscall.cs#L2851</A>

Mono_Posix_Syscall_stat(), meanwhile, is just a simple wrapper around stat(2):

	<A HREF="https://github.com/mono/mono/blob/master/support/sys-stat.c#L25">https://github.com/mono/mono/blob/master/support/sys-stat.c#L25</A>

If your program is dying because Mono_Posix_Syscall_stat() can't be found, then the problem is probably that dlopen(NULL, mode) is not supported on your platform. If stat() can't be found, then (1) your platform doesn't provide stat(2), or (2) (somehow) your program is being improperly linked and stat() isn't being found.

 - Jon

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038761.html">[Mono-dev] DllImport(&quot;__Internal&quot;) and libMonoPosixHelper	static build
</A></li>
	<LI>Next message: <A HREF="038762.html">[Mono-dev] Building a code optimizer for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38771">[ date ]</a>
              <a href="thread.html#38771">[ thread ]</a>
              <a href="subject.html#38771">[ subject ]</a>
              <a href="author.html#38771">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
