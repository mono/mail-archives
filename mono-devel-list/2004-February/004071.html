<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Detecting Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Detecting%20Mono&In-Reply-To=002c01c3f4b5%24b42d9550%248119fea9%40siena">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004070.html">
   <LINK REL="Next"  HREF="004085.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Detecting Mono</H1>
    <B>Ben Maurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Detecting%20Mono&In-Reply-To=002c01c3f4b5%24b42d9550%248119fea9%40siena"
       TITLE="[Mono-devel-list] Detecting Mono">bmaurer at users.sourceforge.net
       </A><BR>
    <I>Mon Feb 16 13:23:03 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004070.html">[Mono-devel-list] Detecting Mono
</A></li>
        <LI>Next message: <A HREF="004085.html">[Mono-devel-list] Detecting Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4071">[ date ]</a>
              <a href="thread.html#4071">[ thread ]</a>
              <a href="subject.html#4071">[ subject ]</a>
              <a href="author.html#4071">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I really, really dont think this is the way to go.

Software should not work like this:
&quot;if you are running on windows, pressing `foo' will result in blah. As
an exception, on windows 98, nothing will happen. On linux, it will do
bar if it is running on RedHat 9 or Fedora, but will do baz if it is
running on any other linux system.&quot;

You might have a feature that is implemented in different ways on
different systems -- for example, maybe on Windows you store a key in
the registry, but on Linux you store it in a dot file.

In the above case, your test should *not* look like this:

[Test] [Platform (&quot;!linux&quot;)]
public void TestWinSettings ()
{
    Settings.Store (foo, bar);
    AssertEquals (Registry.Get (foo), bar);
}


[Test] [Platform (&quot;linux&quot;)]
public void TestLinuxSettings ()
{
    Settings.Store (foo, bar);
    AssertEquals (GConf.Get (foo), bar);
}

Rather, you should write your test like:

[Test]
public void TestSettings ()
{
    Setttings.Store (foo, bar);
    AssertEquals (Settings.Get (foo), bar);
}

You should be running the tests on the *result* not the implementation.

Now, I realize some platforms will not support something specifc. Lets
say you want to make NUnit runnable as a service (eg, so that you could
run tests in the background). Right now, Mono does not really support
this (you can work around it via some command line stuff, but we do not
support the api). Rather then testing for *mono* you should test for the
*feature*. In your code, you should write something like:

#if CAN_RUN_AS_SERVICE
   // APIs for running as service
#endif

In your tests, you can write:

#if CAN_RUN_AS_SERVICE
  // my service test suite
#endif

You could even have these tests in a special assembly that you only used
if the service feature was enabled.

One other problem I realize exists is that you might know a specific
feature fails right now under mono. Rather than not running the test, I
would rather see a feature where you could write:

[Test]
[Note (&quot;This test fails on Mono, see Ximian bugzilla #12345&quot;)]
public void MyTest ()
{
}

You could allow someone to also annotate that with:
[KnownFailSet (&quot;MONO_FAILURES&quot;)]

Then, when run under Mono you can do:

nunit-however-you-invoke-the-thing /knownfailset:MONO_FAILURES

The program could then still give you the nice Red/Green light.

This actually has nice uses for normal usage. For example, lets say I am
programming feature `Foo'. What I can do is to add 20 tests that I know
will fail. Then I can build up the Foo feature. As I am writing code, I
can test to make sure I did not cause any regressions. Before, without
this annotation, I would have to count the number of failures, and make
sure no regressions were happening. With this sort of markup, I could
avoid that and just get a red/green. As I am going, i can remove the tag
from sub-components that I have implemented, to make sure I am not
regressing on my newly written code.

Having different tests for different platforms implies that you intend
for the program to work differently in each platform. This isnt really
consistant with having a program that is really cross platform.

On Mon, 2004-02-16 at 12:52, Charlie Poole wrote:
&gt;<i> Hi Jarek,
</I>&gt;<i> 
</I>&gt;<i> Elaborating on my earlier reply to Nick - Nunit itself /is/ one of those
</I>&gt;<i> apps that runs on multiple platforms and needs this facility. Currently,
</I>&gt;<i> we detect Win98 /in/ the test for AssemblyWatcher and just pass it if we
</I>&gt;<i> are on that platform. This seems better to me than ignoring, as yellow
</I>&gt;<i> is just another kind of red to me. :-)
</I>&gt;<i> 
</I>&gt;<i> That's where the logic comes from for simply leaving things out of the
</I>&gt;<i> test tree if they are for some other platform: they can never be run,
</I>&gt;<i> and none of the three colors really makes sense.
</I>&gt;<i> 
</I>&gt;<i> Now that I think of it, an ignore type check is probably at least as
</I>&gt;<i> common as a positive check. The syntax I was imagining was something
</I>&gt;<i> like:
</I>&gt;<i> 
</I>&gt;<i> 	[Platform(&quot;net-1.0,net-1.1&quot;)]
</I>&gt;<i> 
</I>&gt;<i> Perhaps an alternative would be to also support
</I>&gt;<i> 
</I>&gt;<i> 	[Platform( Exclude=&quot;mono&quot; )]
</I>&gt;<i> 
</I>&gt;<i> Charlie Poole
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">cpoole at pooleconsulting.com</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A> 
</I>&gt;<i> &gt; [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-admin at lists.ximian.com</A>] On Behalf Of 
</I>&gt;<i> &gt; Jaroslaw Kowalski
</I>&gt;<i> &gt; Sent: Monday, February 16, 2004 9:09 AM
</I>&gt;<i> &gt; To: Nick Drochak; 'Charlie Poole'; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; Cc: ! nant
</I>&gt;<i> &gt; Subject: Re: [Mono-devel-list] Detecting Mono
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; It'd be great if we had some attributes like &quot;IgnoreDotNet&quot; and
</I>&gt;<i> &gt; &quot;IgnoreMono&quot;
</I>&gt;<i> &gt; &gt; with which we could decorate a test to avoid running tests 
</I>&gt;<i> &gt; on specific 
</I>&gt;<i> &gt; &gt; CLR's.  My quick hack to the code would be to change
</I>&gt;<i> &gt; &gt; TestCaseBuilder.HasIgnoreAttribute() check for the full 
</I>&gt;<i> &gt; Ignore, or see
</I>&gt;<i> &gt; what
</I>&gt;<i> &gt; &gt; runtime we are on and check for the specific attributes accordingly.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; How about using a textual name of the plaftorm for this 
</I>&gt;<i> &gt; purpose? The naming schema could be adopted from NAnt, e.g:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; net-1.0
</I>&gt;<i> &gt; net-1.1
</I>&gt;<i> &gt; net-1.2
</I>&gt;<i> &gt; netcf-1.0
</I>&gt;<i> &gt; sscli-1.0
</I>&gt;<i> &gt; mono-1.0
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This way we could even employ some wildcards. Like &quot;mono-1.*&quot; 
</I>&gt;<i> &gt; to represent any mono v1.x.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Same thing should apply to OSes (&quot;platforms&quot; in NAnt 
</I>&gt;<i> &gt; terminology). One should be able to run the test on a 
</I>&gt;<i> &gt; particular OS or platform. For example if your test uses 
</I>&gt;<i> &gt; filesystemwatcher it shouldn't be ran on Win95.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Some ideas below:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [Test]
</I>&gt;<i> &gt; [IgnoreOnFramework(&quot;net-1.0&quot;)]
</I>&gt;<i> &gt; void A()
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [Test]
</I>&gt;<i> &gt; [IgnoreOnFramework(&quot;net-1.1&quot;)] // this would not run on .NET 
</I>&gt;<i> &gt; 1.1 void B() { }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [Test]
</I>&gt;<i> &gt; [IgnoreOnFramework(&quot;net-1.*&quot;)]    // this would not run on ALL .NET
</I>&gt;<i> &gt; platforms
</I>&gt;<i> &gt; void C()
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [Test]
</I>&gt;<i> &gt; [IgnoreOnPlatform(Platform.Win32)]    // this would not run on Win32
</I>&gt;<i> &gt; platforms
</I>&gt;<i> &gt; void D()
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [Test]
</I>&gt;<i> &gt; [IgnoreOnPlatform(Platform.Unix)]    // this would not run on 
</I>&gt;<i> &gt; Unix platforms
</I>&gt;<i> &gt; void E()
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [Test]
</I>&gt;<i> &gt; [RunOnPlatform(Platform.Win32)]    // this would run only on 
</I>&gt;<i> &gt; Win32 platforms
</I>&gt;<i> &gt; void F()
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; [Test]
</I>&gt;<i> &gt; [RunOnFramework(&quot;mono-1.*&quot;)]    // this would run only on Mono
</I>&gt;<i> &gt; void G()
</I>&gt;<i> &gt; {
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; There are more (open source) tools that target multiple 
</I>&gt;<i> &gt; platforms/oses. I think it would be great to have some 
</I>&gt;<i> &gt; agreement on this attribute usage. For example in NAnt we're 
</I>&gt;<i> &gt; discussing the possibility of implementing os-specific or 
</I>&gt;<i> &gt; platform-specific tasks,types or functions in a single 
</I>&gt;<i> &gt; codebase. We've tentatively decided that using such 
</I>&gt;<i> &gt; attributes is a way to go.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; BTW. I think that the &quot;excluded because of the framework/os&quot; 
</I>&gt;<i> &gt; status shouldn't be the same thing as &quot;ignored&quot; in NUnit. 
</I>&gt;<i> &gt; Tests are &quot;ignored&quot; because they are known to temporarily 
</I>&gt;<i> &gt; fail, while RunOn... and IgnoreOn... means something different here.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Jarek
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A> 
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-">http://lists.ximian.com/mailman/listinfo/mono-</A>&gt; devel-list
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004070.html">[Mono-devel-list] Detecting Mono
</A></li>
	<LI>Next message: <A HREF="004085.html">[Mono-devel-list] Detecting Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4071">[ date ]</a>
              <a href="thread.html#4071">[ thread ]</a>
              <a href="subject.html#4071">[ subject ]</a>
              <a href="author.html#4071">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
