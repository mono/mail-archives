<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Principal support for AppDomain and Thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Principal%20support%20for%20AppDomain%20and%20Thread&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003926.html">
   <LINK REL="Next"  HREF="003878.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Principal support for AppDomain and Thread</H1>
    <B>S&#233;bastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Principal%20support%20for%20AppDomain%20and%20Thread&In-Reply-To="
       TITLE="[Mono-devel-list] [PATCH] Principal support for AppDomain and Thread">spouliot at videotron.ca
       </A><BR>
    <I>Mon Feb  2 12:03:30 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="003926.html">[Mono-devel-list] Hardware Requirements (Porting)
</A></li>
        <LI>Next message: <A HREF="003878.html">[Mono-devel-list] [PATCH] Principal support for AppDomain and Thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3877">[ date ]</a>
              <a href="thread.html#3877">[ thread ]</a>
              <a href="subject.html#3877">[ subject ]</a>
              <a href="author.html#3877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Mono,

Here's a patch to add support principals to AppDomain and Thread (with unit
tests). This should enable role-based access control using imperative
permissions.

Some tests requiring unloading appdomains are [Ignore]d for the moment
because they freeze nunit-console.
IIRC unloading support is incomplte or maybe I did something wrong ?

S&#233;bastien

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PrincipalSupport.diff
Type: application/octet-stream
Size: 11911 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20040202/8b331dde/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20040202/8b331dde/attachment.obj</A> 
-------------- next part --------------
//
// AppDomainTest.cs - NUnit Test Cases for AppDomain
//
// Author:
//	Sebastien Pouliot (<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>)
//
// (C) 2004 Novell (<A HREF="http://www.novell.com">http://www.novell.com</A>)
//

using NUnit.Framework;
using System;
using System.Collections;
using System.IO;
using System.Reflection;
using System.Reflection.Emit;
using System.Security;
using System.Security.Policy;
using System.Security.Principal;

namespace MonoTests.System {

	[TestFixture]
	public class AppDomainTest : Assertion {

		private AppDomain ad;
		private ArrayList files = new ArrayList ();

		[TearDown]
		public void Unload () 
		{
			if (ad != null) {
				try {
// Mono has a problem unloading AppDomain
//					AppDomain.Unload (ad);
					ad = null;
				}
				catch {} // do not affect unit test results in TearDown
			}
			foreach (string fname in files) {
				File.Delete (fname);
			}
			files.Clear ();
		}

		[Test]
		public void SetThreadPrincipal () 
		{
			IIdentity i = new GenericIdentity (&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&quot;, &quot;rfc822&quot;);
			IPrincipal p = new GenericPrincipal (i, null);
			ad = AppDomain.CreateDomain (&quot;SetThreadPrincipal&quot;);
			ad.SetThreadPrincipal (p);
		}

		[Test]
		[ExpectedException (typeof (ArgumentNullException))]
		public void SetThreadPrincipalNull ()
		{
			AppDomain.CurrentDomain.SetThreadPrincipal (null);
		}

		[Test]
		[ExpectedException (typeof (PolicyException))]
		public void SetThreadPrincipalTwice () 
		{
			IIdentity i = new GenericIdentity (&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&quot;, &quot;rfc822&quot;);
			IPrincipal p = new GenericPrincipal (i, null);
			ad = AppDomain.CreateDomain (&quot;SetThreadPrincipalTwice&quot;);
			ad.SetThreadPrincipal (p);
			// you only live twice (or so James told me ;-)
			ad.SetThreadPrincipal (p);
		}

		[Test]
		[ExpectedException (typeof (AppDomainUnloadedException))]
		[Ignore (&quot;Unloading cause a failure in Mono - stopping the unit tests&quot;)]
		public void SetThreadPrincipalUnloaded () 
		{
			ad = AppDomain.CreateDomain (&quot;Ximian&quot;);
			AppDomain.Unload (ad);
			IIdentity i = new GenericIdentity (&quot;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">sebastien at ximian.com</A>&quot;, &quot;rfc822&quot;);
			IPrincipal p = new GenericPrincipal (i, null);
			ad.SetThreadPrincipal (p);
		}

		[Test]
		public void SetPrincipalPolicy_NoPrincipal () 
		{
			AppDomain.CurrentDomain.SetPrincipalPolicy (PrincipalPolicy.NoPrincipal);
		}

		[Test]
		public void SetPrincipalPolicy_UnauthenticatedPrincipal () 
		{
			AppDomain.CurrentDomain.SetPrincipalPolicy (PrincipalPolicy.UnauthenticatedPrincipal);
		}

		[Test]
		public void SetPrincipalPolicy_WindowsPrincipal () 
		{
			AppDomain.CurrentDomain.SetPrincipalPolicy (PrincipalPolicy.WindowsPrincipal);
		}

		[Test]
		[ExpectedException (typeof (AppDomainUnloadedException))]
		[Ignore (&quot;Unloading cause a failure in Mono - stopping the unit tests&quot;)]
		public void SetPrincipalPolicyUnloaded () 
		{
			AppDomain ad = AppDomain.CreateDomain (&quot;Ximian&quot;);
			AppDomain.Unload (ad);
			ad.SetPrincipalPolicy (PrincipalPolicy.NoPrincipal);
		}
	}
}
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003926.html">[Mono-devel-list] Hardware Requirements (Porting)
</A></li>
	<LI>Next message: <A HREF="003878.html">[Mono-devel-list] [PATCH] Principal support for AppDomain and Thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3877">[ date ]</a>
              <a href="thread.html#3877">[ thread ]</a>
              <a href="subject.html#3877">[ subject ]</a>
              <a href="author.html#3877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
