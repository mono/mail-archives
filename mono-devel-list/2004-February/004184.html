<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Performance w/ boxing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Performance%20w/%20boxing&In-Reply-To=1077330269.29687.131.camel%40melchior.magi">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004181.html">
   <LINK REL="Next"  HREF="004188.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Performance w/ boxing</H1>
    <B>Jonathan Gilbert</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Performance%20w/%20boxing&In-Reply-To=1077330269.29687.131.camel%40melchior.magi"
       TITLE="[Mono-devel-list] Performance w/ boxing">2a5gjx302 at sneakemail.com
       </A><BR>
    <I>Sat Feb 21 15:10:45 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004181.html">[Mono-devel-list] Performance w/ boxing
</A></li>
        <LI>Next message: <A HREF="004188.html">[Mono-devel-list] Performance w/ boxing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4184">[ date ]</a>
              <a href="thread.html#4184">[ thread ]</a>
              <a href="subject.html#4184">[ subject ]</a>
              <a href="author.html#4184">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 09:24 PM 20/02/2004 -0500, you wrote:
&gt;<i>Below...
</I>&gt;<i>
</I>&gt;<i>On Fri, 2004-02-20 at 17:33, Jonathan Gilbert wrote:
</I>[snip]
&gt;&gt;<i> This isn't quite right. An 'out' parameter is in fact uninitialized and
</I>&gt;&gt;<i> does not carry any value at all.
</I>&gt;<i>
</I>&gt;<i>Not quite.  The value to which the parameter refers to is (can be)
</I>&gt;<i>uninitialized.  The parameter itself is initialized to a well-known
</I>&gt;<i>value.
</I>[snip]
&gt;&gt;<i> A 'ref' parameter must not be
</I>&gt;&gt;<i> uninitialized in the calling context when it is passed to the function, but
</I>&gt;&gt;<i> it may be initialized to 'null'.
</I>&gt;<i>
</I>&gt;<i>See above.  I'm referring to the pointer itself, not what the pointer
</I>&gt;<i>refers to.  The pointer *cannot* be null in C#, but what the pointer
</I>&gt;<i>refers to certainly can be null.
</I>
We are talking at different reference levels here :-) I am in fact very
familiar with C++ and have written several simple compilers, some of which
include support for arbitrary reference levels, just as C/C++ allow
arbitrary numbers of '*' in a pointer type. Yes, it is true that you
cannot, in C#, pass a reference which would result in a null pointer in the
underlying implementation :-)

[snip]
&gt;&gt;<i> An 'object' can be checked for a boxed value type with the 'is' operator.
</I>&gt;&gt;<i> However, it isn't possible to restrict the type of the object that may be
</I>&gt;&gt;<i> boxed for a given call, not in C# or CIL, because it's impossible to tell
</I>&gt;&gt;<i> what an 'object' reference variable will refer to at compile time. 
</I>&gt;<i>
</I>&gt;<i>Indeed, but CIL does permit you to say &quot;this is a managed pointer to
</I>&gt;<i>&lt;some type/&gt;, which could be null&quot;.  For example, managed C++ permits
</I>&gt;<i>you to pass a boxed int directly to a function, and have the function
</I>&gt;<i>accept a boxed int.
</I>&gt;<i>
</I>&gt;<i>What actually happens in Managed C++ is that you can get a managed
</I>&gt;<i>pointer *into* a boxed int.  Syntax is similar to (from memory):
</I>&gt;<i>
</I>&gt;<i>	void Foo (int __gc* n);
</I>&gt;<i>	int n = 42;
</I>&gt;<i>	System::Object __gc* o = &amp;n;
</I>&gt;<i>	// this might need a different cast syntax; i can't remember
</I>&gt;<i>	int __gc* pn = (int __gc*) o;
</I>&gt;<i>	Foo (pn);
</I>&gt;<i>
</I>&gt;<i>The neat thing is that Managed C++ allows you to refer to the the
</I>&gt;<i>integer *inside* the boxed integer, allowing cool things like that.  CIL
</I>&gt;<i>permits it as well, but C# has no syntax to expose the functionality.
</I>True, but this is still different from having a function which receives an
object reference that can only be a boxed int. The function in this case is
simply receiving a pointer to the integer value.

&gt;&gt;<i> That
</I>&gt;&gt;<i> said, the function can always complain at runtime, which is about as good
</I>&gt;&gt;<i> as it gets.
</I>&gt;<i> 
</I>&gt;<i>Indeed.  For C#.
</I>
Well, that, or explicit boxing as I mentioned. The design that I presented
was aimed to solve the &quot;can be null&quot; problem, and you no doubt read Joshua
Tauberer's post which further addresses the performance issue.

Joshua Tauberer's struct, being a value type, is effectively no different
from using a separate 'bool' parameter to indicate whether the variable is
present, except that it wraps it up nicely into a single parameter.

void Foo(int value, bool value_is_actually_present)
{
  if (!value_is_actually_present) { ...}
  else { ... }
}

Of course, this is rather ugly. However, when there are a number of
integers, it can become useful to use a bitmapped flags parameter. Some
Win32 APIs work this way; the flags specify which parameters are actually
given meaningful values, and the information passed for other parameters is
ignored.

[Flags]
enum HasValue
{
  value1 = 1, value2 = 2, value3 = 4, value4 = 8,
}

void Foo(int value1, int value2, int value3, int value4, HasValue flags)
{
  if ((flags &amp; HasValue.value1) == 0) { ... }
  else { ... }
  if ((flags &amp; HasValue.value2) == 0) { ... }
  else { ... }
  /* etc. */
}

Jonathan


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004181.html">[Mono-devel-list] Performance w/ boxing
</A></li>
	<LI>Next message: <A HREF="004188.html">[Mono-devel-list] Performance w/ boxing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4184">[ date ]</a>
              <a href="thread.html#4184">[ thread ]</a>
              <a href="subject.html#4184">[ subject ]</a>
              <a href="author.html#4184">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
