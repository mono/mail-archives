<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Thread safety of readonly data members?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Thread%20safety%20of%20readonly%20data%20members%3F&In-Reply-To=1077104974.19836.22.camel%40melchior.magi">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004103.html">
   <LINK REL="Next"  HREF="004117.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Thread safety of readonly data members?</H1>
    <B>gabor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Thread%20safety%20of%20readonly%20data%20members%3F&In-Reply-To=1077104974.19836.22.camel%40melchior.magi"
       TITLE="[Mono-devel-list] Thread safety of readonly data members?">gabor at z10n.net
       </A><BR>
    <I>Wed Feb 18 11:06:23 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004103.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
        <LI>Next message: <A HREF="004117.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4115">[ date ]</a>
              <a href="thread.html#4115">[ thread ]</a>
              <a href="subject.html#4115">[ subject ]</a>
              <a href="author.html#4115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2004-02-18 at 12:49, Jonathan Pryor wrote:
&gt;<i> Moving on to Mono, one major problem is that the CLI standard, as
</I>&gt;<i> currently specified, uses effectively the same memory consistency model
</I>&gt;<i> as Java.  Meaning, C++ techniques such as double-checked locking ARE NOT
</I>&gt;<i> VALID:
</I>&gt;<i> 
</I>&gt;<i> 	private static Class1 foo;
</I>&gt;<i> 
</I>&gt;<i> 	public static Foo {
</I>&gt;<i> 		get {
</I>&gt;<i> 			// This will likely work on most platforms, such
</I>&gt;<i> 			// as x86, but it is NOT guaranteed to work on 
</I>&gt;<i> 			// all potential hardware platforms.
</I>&gt;<i> 			if (foo == null) {
</I>&gt;<i> 				lock (typeof(Something)) {
</I>&gt;<i> 					if (foo == null)
</I>&gt;<i> 						foo = new Class1();
</I>&gt;<i> 				}
</I>&gt;<i> 			}
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> 
</I>&gt;<i> In C++, you could use code similar to the above, and you WOULD NOT need
</I>&gt;<i> to lock both the class constructor and the accessor methods, as the
</I>&gt;<i> calling code ensures that the class has properly constructed before
</I>&gt;<i> invoking any member functions.
</I>&gt;<i> 
</I>&gt;<i> The problem is that double-checked locking isn't really portable in
</I>&gt;<i> .NET, so you either need to (a) always lock the code that will construct
</I>&gt;<i> the object, or (b) use the static loader lock, described below.
</I>
hmmm.. could you explain one more time why is that code wrong?
 for example can you give me an example when it goes wrong?

for me it seems that it really guarantees that only 1 thread will be
able to construct the object.

and btw.  is reading or writing a native/simple/non-object ( i don't
know the exact term for this. i mean something like int, char and so on)
an atomic operation?

for example if i have two threads, one writes to a variable randomly 1
or 10. the other thread reads the variable in a loop and writes it to
the screen. can i be sure that i will only see the numbers 1 and 10? 

thanks,
gabor


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004103.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
	<LI>Next message: <A HREF="004117.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4115">[ date ]</a>
              <a href="thread.html#4115">[ thread ]</a>
              <a href="subject.html#4115">[ subject ]</a>
              <a href="author.html#4115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
