<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Thread safety of readonly data members?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Thread%20safety%20of%20readonly%20data%20members%3F&In-Reply-To=1077145742.11995.11.camel%40flare">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004127.html">
   <LINK REL="Next"  HREF="004131.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Thread safety of readonly data members?</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Thread%20safety%20of%20readonly%20data%20members%3F&In-Reply-To=1077145742.11995.11.camel%40flare"
       TITLE="[Mono-devel-list] Thread safety of readonly data members?">jonpryor at vt.edu
       </A><BR>
    <I>Wed Feb 18 19:18:17 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004127.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
        <LI>Next message: <A HREF="004131.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4129">[ date ]</a>
              <a href="thread.html#4129">[ thread ]</a>
              <a href="subject.html#4129">[ subject ]</a>
              <a href="author.html#4129">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Below...

On Wed, 2004-02-18 at 18:09, Carl Witty wrote:
&lt;snip/&gt;
&gt;<i> &gt; I forgot to mention this, but in C++ the static member would also need
</I>&gt;<i> &gt; to be declared as &quot;volatile&quot; for double-checked locking to properly
</I>&gt;<i> &gt; work, IIRC.
</I>&gt;<i> 
</I>&gt;<i> Are you sure this works?  This would require that compilers for some
</I>&gt;<i> platforms (at least for Alpha) put memory-barrier instructions around
</I>&gt;<i> accesses of volatile variables; I'd check to make sure that this really
</I>&gt;<i> happens before relying on double-checked locking with that compiler.
</I>
I am reasonably sure this works.  At least, this is generally what most
books on threading that I've read have recommended.

Furthermore, the C++ standard I have, in section 1.9 (Program execution)
has the following statements:

        7.  Accessing an object designated by a volatile lvalue (3.10),
        modifying an object, calling a library I/O function, or calling
        a function that does any of these operations are all side
        effects, which are changes in the state of the execution
        environment...  At certain specified points in the execution
        sequence called sequence points, all side effects of previous
        evaluations shall be complete and no side effects of subsequent
        evaluations shall have taken place.  [Sequence points occur
        after every complete statement.]
        
        ...
        
        11.  The least requirements on a conforming implementation are:
                - At sequence points, volatile objects are stable in the
                sense that previous evaluations are complete and
                subsequent evaluations have not yet occurred.
                ...

This would imply to me that my understanding is correct, but I haven't
written a compiler, so I could be wrong.

 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004127.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
	<LI>Next message: <A HREF="004131.html">[Mono-devel-list] Thread safety of readonly data members?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4129">[ date ]</a>
              <a href="thread.html#4129">[ thread ]</a>
              <a href="subject.html#4129">[ subject ]</a>
              <a href="author.html#4129">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
