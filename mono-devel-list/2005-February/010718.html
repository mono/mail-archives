<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Is native codes for C# methods and CLI internal calls different?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Is%20native%20codes%20for%20C%23%20methods%20and%20CLI%20internal%20calls%20different%3F&In-Reply-To=df373f90050225094873647329%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010689.html">
   <LINK REL="Next"  HREF="010690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Is native codes for C# methods and CLI internal calls different?</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Is%20native%20codes%20for%20C%23%20methods%20and%20CLI%20internal%20calls%20different%3F&In-Reply-To=df373f90050225094873647329%40mail.gmail.com"
       TITLE="[Mono-devel-list] Is native codes for C# methods and CLI internal calls different?">lupus at ximian.com
       </A><BR>
    <I>Mon Feb 28 05:28:28 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010689.html">[Mono-devel-list] Is native codes for C# methods and CLI internal calls different?
</A></li>
        <LI>Next message: <A HREF="010690.html">[Mono-devel-list] develop under Microsoft .NET and porting to Mono is correct?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10718">[ date ]</a>
              <a href="thread.html#10718">[ thread ]</a>
              <a href="subject.html#10718">[ subject ]</a>
              <a href="author.html#10718">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/25/05 Okehee Goh wrote:
&gt;<i> I'm using mono1.1.4 with JIT in Linux on X86.
</I>&gt;<i> I'd like to check native codes generated for C# applications with JIT. 
</I>&gt;<i> I want to see how C# methods and Mono Internal calls are translated
</I>&gt;<i> into native codes, and also how stack frames for them are different? 
</I>&gt;<i> Ultimately I'd like to know that we could distinguish whether certain
</I>&gt;<i> stack frames of a thread are from C# methods or CLI internal functions
</I>&gt;<i> by checking stack frames?
</I>&gt;<i> 
</I>&gt;<i> For example, Directory.GetCurrentDirectory ()  is C# method.  This is
</I>&gt;<i> eventually implemented by calling CLI internal function
</I>&gt;<i> ves_icall_System_IO_MonoIO_GetCurrentDirectory().
</I>&gt;<i> Are they both translated into 'call' assembly instruction in X86, for example?
</I>
When going from managed stack frames to unmanaged stack frames (this happens
both to call internal calls and to call p/invoke functions), we use a
wrapper method that takes care of adjusting for differences in the calling
convention, marshaling types if needed and setting up the data the JIT
needs to unwind the stack. The latter consists in setting up a MonoLMF
(Last Managed Frame) structure on the stack and linking it in a thread-lcoal
list. The MonoLMF contains the registers, a pointer to the method
info etc.

&gt;<i> In summary, my question is (1) how i can see native codes generated
</I>&gt;<i> for method invocations
</I>&gt;<i> and internal function calls, and (2) whether i can distinguish the stack frames?
</I>
To see the code generated you can run mono -v -v program.exe.
You can grep for &quot;managed-to-native&quot; to find the wrapper methods.
The meat of the code for wrapper methods is generated from
mini/mini-ARCH.c, search for save_lmf.

Stack frames are distinguished by the instruction pointer: from the instruction
pointer you can get the MonoJitInfo using mono_jit_info_table_find().
If it returns NULL, the frame belongs to the unmanaged world, so
it could be an external library or a mono internal call (there is no
easy way to distinguish the last two). From the MonoJitInfo struct
you can inspect the MonoMethod and see if the method was a wrapper
or a completely managed method etc.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010689.html">[Mono-devel-list] Is native codes for C# methods and CLI internal calls different?
</A></li>
	<LI>Next message: <A HREF="010690.html">[Mono-devel-list] develop under Microsoft .NET and porting to Mono is correct?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10718">[ date ]</a>
              <a href="thread.html#10718">[ thread ]</a>
              <a href="subject.html#10718">[ subject ]</a>
              <a href="author.html#10718">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
