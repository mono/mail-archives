<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] MySQL timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20MySQL%20timeout&In-Reply-To=873bvpj3zt.fsf%40linuxfr.localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010600.html">
   <LINK REL="Next"  HREF="010603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] MySQL timeout</H1>
    <B>Rafael Teixeira</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20MySQL%20timeout&In-Reply-To=873bvpj3zt.fsf%40linuxfr.localhost"
       TITLE="[Mono-devel-list] MySQL timeout">monoman at gmail.com
       </A><BR>
    <I>Mon Feb 21 11:41:09 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010600.html">[Mono-devel-list] MySQL timeout
</A></li>
        <LI>Next message: <A HREF="010603.html">[Mono-devel-list] MySQL timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10602">[ date ]</a>
              <a href="thread.html#10602">[ thread ]</a>
              <a href="subject.html#10602">[ subject ]</a>
              <a href="author.html#10602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well it sure looks like both mono and the mysql connector are doing
the right thing.
You is the one that is responsible for dealing with such conditions,
if needed, as your try/catches show that you understand how.

The problem is that you should be using the common ADO.NET idiom:

Open Connection
Execute Query
Read Data (if needed)
Close Connection

That way scales a lot better, even for Desktop Clients, as most
ADO.NET providers (connectors) implement connection pooling.

We should just determine if the connection pool manager of the mysql
connector, aside from killing unused connections after a timeout that
can alleviate your problem, has some checkConnectionLiveness feature
to avoid throwing that same exception in your face, when reusing a
connection...

HIH,

On Mon, 21 Feb 2005 17:02:14 +0100, Fabien Penso &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">penso at linuxfr.org</A>&gt; wrote:
&gt;<i> Hi !
</I>&gt;<i> 
</I>&gt;<i> I am trying to use the mysql connector MySql.Data.MySqlClient, and try
</I>&gt;<i> to not crash when the mysld goes away.
</I>&gt;<i> 
</I>&gt;<i> The test program only does a select count(*), wait 10sec, goes
</I>&gt;<i> again. The mysqld has a timeout value of 5 seconds (just to test) and
</I>&gt;<i> here is what I get :
</I>&gt;<i> 
</I>&gt;<i> state of con: Open
</I>&gt;<i> Connection unexpectedly terminated
</I>&gt;<i> 
</I>&gt;<i> Unhandled Exception: System.IO.IOException: Write failure ---&gt; System.Net.Sockets.SocketException: The socket has been shut down
</I>&gt;<i> in &lt;0x00078&gt; System.Net.Sockets.Socket:Send_nochecks (byte[],int,int,System.Net.Sockets.SocketFlags)
</I>&gt;<i> in &lt;0x000c3&gt; System.Net.Sockets.Socket:Send (byte[],int,int,System.Net.Sockets.SocketFlags)
</I>&gt;<i> in &lt;0x000fb&gt; System.Net.Sockets.NetworkStream:Write (byte[],int,int)
</I>&gt;<i> --- End of inner exception stack trace ---
</I>&gt;<i> 
</I>&gt;<i> in &lt;0x00152&gt; System.Net.Sockets.NetworkStream:Write (byte[],int,int)
</I>&gt;<i> in &lt;0x0008f&gt; System.IO.BufferedStream:Flush ()
</I>&gt;<i> in &lt;0x00182&gt; MySql.Data.MySqlClient.PacketWriter:FlushBuffer ()
</I>&gt;<i> in &lt;0x000ed&gt; MySql.Data.MySqlClient.PacketWriter:Flush ()
</I>&gt;<i> in &lt;0x000b8&gt; MySql.Data.MySqlClient.NativeDriver:AuthenticateOld ()
</I>&gt;<i> in &lt;0x00075&gt; MySql.Data.MySqlClient.NativeDriver:Authenticate ()
</I>&gt;<i> in &lt;0x00049&gt; MySql.Data.MySqlClient.NativeDriver:Reset ()
</I>&gt;<i> in &lt;0x001e6&gt; MySql.Data.MySqlClient.MySqlPool:GetPooledConnection ()
</I>&gt;<i> in &lt;0x0004e&gt; MySql.Data.MySqlClient.MySqlPool:GetConnection ()
</I>&gt;<i> in &lt;0x00124&gt; MySql.Data.MySqlClient.MySqlPoolManager:GetConnection (MySql.Data.MySqlClient.MySqlConnectionString)
</I>&gt;<i> in &lt;0x00071&gt; MySql.Data.MySqlClient.MySqlConnection:Open ()
</I>&gt;<i> 
</I>&gt;<i> The piece of code is attached to this mail. Is there a way to see a
</I>&gt;<i> mysqld has gone away and not crash ? I'm not so sure this is a problem
</I>&gt;<i> with mono or the mysqld connector but any idea is welcome :)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Fabien Penso
</I>&gt;<i> <A HREF="http://penso.info/">http://penso.info/</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>

-- 
Rafael &quot;Monoman&quot; Teixeira
---------------------------------------
I'm trying to become a &quot;Rosh Gadol&quot; before my own eyes. 
See <A HREF="http://www.joelonsoftware.com/items/2004/12/06.html">http://www.joelonsoftware.com/items/2004/12/06.html</A> for enlightment.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010600.html">[Mono-devel-list] MySQL timeout
</A></li>
	<LI>Next message: <A HREF="010603.html">[Mono-devel-list] MySQL timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10602">[ date ]</a>
              <a href="thread.html#10602">[ thread ]</a>
              <a href="subject.html#10602">[ subject ]</a>
              <a href="author.html#10602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
