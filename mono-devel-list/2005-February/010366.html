<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Embedding Mono in a Virtual World
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Embedding%20Mono%20in%20a%20Virtual%20World&In-Reply-To=20050126182309.GE5351%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010379.html">
   <LINK REL="Next"  HREF="010395.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Embedding Mono in a Virtual World</H1>
    <B>Jim Purbrick</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Embedding%20Mono%20in%20a%20Virtual%20World&In-Reply-To=20050126182309.GE5351%40debian.org"
       TITLE="[Mono-devel-list] Embedding Mono in a Virtual World">jimpurbrick at yahoo.co.uk
       </A><BR>
    <I>Wed Feb  9 13:06:32 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010379.html">[Mono-devel-list] Re: not-so-good patch
</A></li>
        <LI>Next message: <A HREF="010395.html">[Mono-devel-list] Embedding Mono in a Virtual World
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10366">[ date ]</a>
              <a href="thread.html#10366">[ thread ]</a>
              <a href="subject.html#10366">[ subject ]</a>
              <a href="author.html#10366">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> --- Paolo Molaro &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>&gt; wrote: 
&gt;<i> &gt; I need to restart the scripts transparently, as if
</I>&gt;<i> &gt; they were running in a thread or fiber. 
</I>&gt;<i> &gt; Currently each running script has a stack, 
</I>&gt;<i> &gt; heap and registers which are saved when 
</I>&gt;<i> &gt; another script is scheduled.
</I>&gt;<i> 
</I>&gt;<i> I think you have two options:
</I>&gt;<i> *) inject code into the scripts to make them state
</I>&gt;<i> machines
</I>&gt;<i> that will periodically check the timeout info and
</I>&gt;<i> save the state to 
</I>&gt;<i> an object and reload it when it's restarted, similar
</I>&gt;<i> to how the C#
</I>&gt;<i> compiler handles the yield construct.
</I>
I've started trying this approach out using yields and
think it might well work, although with yields strange
things happen mixing them with recursion. I'm not sure
how generally a call graph can be mapped to a state
machine, especially in the presence of recursion.

The easiest way to represent the information would be
to build a stack for each script, but could I mess
with the stack pointer to switch stacks or would I
have to emulate a stack using heaps and would that be
horribly inefficient?

I keep coming back to the idea that what I really want
is a light weight user threads library. I've seen some
stuff about people using Win32 fibers to run managed
code. Would it be possible to use a Linux light weight
threads library in a similar way?

A final alternative would be to change the way the
runtime handles threads to use light weight threads,
but this seems even more work than trying to emulate
threads in bytecode.

Just wanted to get your thoughts on these options
before I got heavily in to implementing the state
machine option.

&gt;<i> *) use the threadpool as initially suggested: you
</I>&gt;<i> will queue all the scripts for execution.
</I>
I looked at this approach and implemented a simple
test app which used Abort and ResetAbort to cancel
processing after some timeout. While this would stop
DOS attacks it would also cancel arbitrarily long
valid processing, which is not the current model and
so not acceptable.

Cheers,

Jim.


	
	
		
___________________________________________________________ 
ALL-NEW Yahoo! Messenger - all new features - even more fun! <A HREF="http://uk.messenger.yahoo.com">http://uk.messenger.yahoo.com</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010379.html">[Mono-devel-list] Re: not-so-good patch
</A></li>
	<LI>Next message: <A HREF="010395.html">[Mono-devel-list] Embedding Mono in a Virtual World
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10366">[ date ]</a>
              <a href="thread.html#10366">[ thread ]</a>
              <a href="subject.html#10366">[ subject ]</a>
              <a href="author.html#10366">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
