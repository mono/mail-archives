<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Bug Fix for GetTickCount in WAPI IO Layer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Bug%20Fix%20for%20GetTickCount%20in%20WAPI%20IO%0A%20Layer&In-Reply-To=16155.207.180.207.254.1109620275.squirrel%40webmail.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010750.html">
   <LINK REL="Next"  HREF="010755.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Bug Fix for GetTickCount in WAPI IO Layer</H1>
    <B>Jesse Towner</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Bug%20Fix%20for%20GetTickCount%20in%20WAPI%20IO%0A%20Layer&In-Reply-To=16155.207.180.207.254.1109620275.squirrel%40webmail.ximian.com"
       TITLE="[Mono-devel-list] [PATCH] Bug Fix for GetTickCount in WAPI IO Layer">townerj at gmail.com
       </A><BR>
    <I>Mon Feb 28 16:26:53 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="010750.html">[Mono-devel-list] [PATCH] Bug Fix for GetTickCount in WAPI IO Layer
</A></li>
        <LI>Next message: <A HREF="010755.html">[Mono-devel-list] [PATCH] Bug Fix for GetTickCount in WAPI IO	Layer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10753">[ date ]</a>
              <a href="thread.html#10753">[ thread ]</a>
              <a href="subject.html#10753">[ subject ]</a>
              <a href="author.html#10753">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ben Maurer wrote:

&gt;&gt;<i>Yes, sure. I can do that. However, I'm a little unsure if I should
</I>&gt;&gt;<i>bother with all of these changes if they're not going to be committed
</I>&gt;&gt;<i>anyway. I know of at least a few people who have mistakenly used
</I>&gt;&gt;<i>System.Environment.TickCount and complained it didn't work the
</I>&gt;&gt;<i>way they expected it to on Mono. That's why I set out to see if I
</I>&gt;&gt;<i>could fix it in the first place.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>What applications are doing this? They should be aware that their program
</I>&gt;<i>*does not work* on the msft platform or on mono. It will start giving
</I>&gt;<i>bogus results after 23-24 days or something (the .net version has half the
</I>&gt;<i>resolution of the native one, because it is signed and we do not use the
</I>&gt;<i>negative bits).
</I>&gt;<i>
</I>&gt;<i>We should document this in monodoc. Also, if this method is in the ECMA
</I>&gt;<i>spec, it would be nice to get a warning measured there.
</I>&gt;<i>
</I>&gt;<i>-- Ben
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>I don't believe these applications are of a critical nature (I hope).
It's documented in the CLI
and MSDN references that System.Environment.TickCount wraps over to
Int32.MinValue
after 24.8 days, and then starts increasing in value for the next 24.8
days. Even so, some
people insist on using it. Just do a google search for &quot;C# TickCount
system uptime&quot; to see
what I mean (note this returns both correct and incorrect examples).

The correct way to determine the system uptime with the MSFT .NET FX
libraries is to use
System.Diagnostics.PerformanceCounter:

&lt;code&gt;
PerformanceCounter pc = new PerformanceCounter(&quot;System&quot;, &quot;System Up Time&quot;);

*pc.NextValue(); *

*TimeSpan uptime = TimeSpan.FromSeconds(pc.NextValue());*

&lt;/code&gt;

However, this is not a CLI library feature, and I'm not sure if it's
supported in Mono.

Anyway, as to the philosophy of implementing something so that it works
in a particular
scenario, even though it shouldn't be used there, I offer the following.

I used to work on hardware simulation software (and known sometimes as
emulators, although
the correct terminology is simulator). Sometimes, we'd come across a
program that used
an undocumented feature of the hardware we were simulating. Or sometimes
it would use
a feature in such a way that was dangerous. If our implementation of the
simulator deviated
only slightly from the real system's behavior, it would break these
programs.

Now, not to say Mono &quot;simulates&quot; the MSFT .NET FX, it's a CLI
implementation. And the
CLI class library documentation does say that
System.Environment.TickCount returns the
number of milliseconds since the system booted.

It's possible to envision a windows service or daemon that uses
System.Environment.TickCount
when it is first activated a boot-time, and then subsequently polls it
to determine the system
uptime, detecting any 32-bit integer wrap-arounds and accounting for
them. In fact, such code
exists out there:  <A HREF="http://www.thecodeproject.com/useritems/UpTime.asp">http://www.thecodeproject.com/useritems/UpTime.asp</A>

------------------------------------------------------------------------
Jesse Towner, Lead Programmer, Hybrid Mobile Technologies, LLC
Email Addresses: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jtowner at hybrid-mobile.com</A>&gt;, &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">townerj at gmail.com</A>&gt;
PGP Public Key: <A HREF="http://www.virtuallyonline.net/personal/jesse/pgp.html">http://www.virtuallyonline.net/personal/jesse/pgp.html</A>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050228/8717d99d/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050228/8717d99d/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010750.html">[Mono-devel-list] [PATCH] Bug Fix for GetTickCount in WAPI IO Layer
</A></li>
	<LI>Next message: <A HREF="010755.html">[Mono-devel-list] [PATCH] Bug Fix for GetTickCount in WAPI IO	Layer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10753">[ date ]</a>
              <a href="thread.html#10753">[ thread ]</a>
              <a href="subject.html#10753">[ subject ]</a>
              <a href="author.html#10753">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
