<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] An issue with nested lamdas
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20An%20issue%20with%20nested%20lamdas&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036700.html">
   <LINK REL="Next"  HREF="036690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] An issue with nested lamdas</H1>
    <B>timeslip</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20An%20issue%20with%20nested%20lamdas&In-Reply-To="
       TITLE="[Mono-dev] An issue with nested lamdas">timeslip at users.sourceforge.net
       </A><BR>
    <I>Wed Jan 12 05:48:43 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036700.html">[Mono-dev] Regression in git master
</A></li>
        <LI>Next message: <A HREF="036690.html">[Mono-dev] An issue with nested lamdas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36689">[ date ]</a>
              <a href="thread.html#36689">[ thread ]</a>
              <a href="subject.html#36689">[ subject ]</a>
              <a href="author.html#36689">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

I'm attempting to port a linq-based compiler from .net to mono. For the most
part everything works well, but I'm getting unexpected
TargetParameterCountException's being thrown when using the languages
equivalent of function pointers. I've reduced my problem down to this
simple test case:

using System;
using System.Linq.Expressions;

namespace DelegateTest {
  static class MainClass {
    public static int DynCall(Delegate func) {
      return (int)func.DynamicInvoke();
    }
		
    public static void Main () {
      LambdaExpression ex=Expression.Lambda(typeof(Func&lt;int&gt;),
        Expression.Constant(5));
      LambdaExpression ex2=Expression.Lambda(typeof(Func&lt;int&gt;),
        Expression.Call(typeof(MainClass).GetMethod(&quot;DynCall&quot;), ex));
      Func&lt;int&gt; func=(Func&lt;int&gt;)ex2.Compile();
      Console.WriteLine(func());
    }
  }
}

On mono 2.8.2 (running on opensuse 11.1) it throws a
TargetParameterCountException on the func.DynamicInvoke(). The same code
prints the '5' I was expecting when run on .net.

Doing a bit of digging, the problem seems to be that the m_target of the
Delegate is null, instead of pointing at the CompilerServices.Closure that
it should be. As a result, the method invocation ends up with one parameter
less than it was expecting. I don't know enough about mono to see why or
where the Closure is getting lost.

Is this a bug/unimplemented feature in mono, or am I trying to do something
unsupported? (And if so, what is the mono-friendly way of doing this?)

Thanks.
-- 
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/An-issue-with-nested-lamdas-tp3213717p3213717.html">http://mono.1490590.n4.nabble.com/An-issue-with-nested-lamdas-tp3213717p3213717.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036700.html">[Mono-dev] Regression in git master
</A></li>
	<LI>Next message: <A HREF="036690.html">[Mono-dev] An issue with nested lamdas
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36689">[ date ]</a>
              <a href="thread.html#36689">[ thread ]</a>
              <a href="subject.html#36689">[ subject ]</a>
              <a href="author.html#36689">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
