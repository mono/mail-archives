<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Incorrect%20signal%20handling%20for%20Sys%20V%20signal%0A%09handler&In-Reply-To=F799DECC-F25C-4669-AFF5-AF50186BEF88%40vt.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036836.html">
   <LINK REL="Next"  HREF="036848.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Incorrect%20signal%20handling%20for%20Sys%20V%20signal%0A%09handler&In-Reply-To=F799DECC-F25C-4669-AFF5-AF50186BEF88%40vt.edu"
       TITLE="[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler">miguel at novell.com
       </A><BR>
    <I>Thu Jan 27 13:11:13 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036836.html">[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal handler
</A></li>
        <LI>Next message: <A HREF="036848.html">[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36837">[ date ]</a>
              <a href="thread.html#36837">[ thread ]</a>
              <a href="subject.html#36837">[ subject ]</a>
              <a href="author.html#36837">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    I have other concerns about this use of signal.   Perhaps it
should be using sigaction with the proper flags to configure how we
want signals to be delivered instead.

Miguel

On Thu, Jan 27, 2011 at 12:52 PM, Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>&gt; wrote:
&gt;<i> I can't speak to the rest of the patch, but the mono/support patch can't go in as-is, as mono/support/signal.c is also built for Windows (it's part of MPH_C_SOURCE in mono/support/Makefile.am, which is included in the HOST_WIN32 build).
</I>&gt;<i>
</I>&gt;<i> MSVCRT.DLL DOES contain signal(3); it does NOT contain sigset(3), and thus this would break the Windows build.
</I>&gt;<i>
</I>&gt;<i> Furthermore, OSX doesn't provide sigset(3) either, so this would break the OSX build as well.
</I>&gt;<i>
</I>&gt;<i> You should patch configure.in to check for sigset, and wrap the sigset calls with HAVE_SIGSET, otherwise keep the existing signal calls.
</I>&gt;<i>
</I>&gt;<i> &#160;- Jon
</I>&gt;<i>
</I>&gt;<i> On Jan 27, 2011, at 10:06 AM, Burkhard Linke wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> signal handlers registered with signal(3) behave in a somewhat different way
</I>&gt;&gt;<i> for Sys V systems, e.g. Solaris. The manpage states that during the execution
</I>&gt;&gt;<i> of the signal handler, the signal disposition is set to SIG_DFL. This raises
</I>&gt;&gt;<i> two problems:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> a) a possible race condition, if the same signal occurs during the execution
</I>&gt;&gt;<i> of its signal handler
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> b) handling the signal a second time, since the manpage (and the
</I>&gt;&gt;<i> implementation under Solaris..) does not reinstall the signal handler.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The attached test program uses Mono.Unix.Signal to catch signals. Executing it
</I>&gt;&gt;<i> under Solaris/x86 running Mono 2.8.1, Mono 2.6.7 and the git master gives the
</I>&gt;&gt;<i> following output:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> running as process 29499
</I>&gt;&gt;<i> sending first HUP
</I>&gt;&gt;<i> sending second HUP
</I>&gt;&gt;<i> Hangup
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The second SIGHUP is not catched by the signal handler, terminating the
</I>&gt;&gt;<i> application (which is the default for SIGHUP).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The applied patch solves the problem by replacing signal(3) with sigset(3).
</I>&gt;&gt;<i> sigset's semantic differs from signal's one; Instead of setting the signal to
</I>&gt;&gt;<i> default handling, it adds the signal to the process/threads signal masks,
</I>&gt;&gt;<i> executed the signal handler and restores the signal mask. Both problems
</I>&gt;&gt;<i> mentioned above are solved. Test program output after applying the patch to
</I>&gt;&gt;<i> git master:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> running as process 172
</I>&gt;&gt;<i> sending first HUP
</I>&gt;&gt;<i> sending second HUP
</I>&gt;&gt;<i> sending third HUP
</I>&gt;&gt;<i> terminating
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> With best regards,
</I>&gt;&gt;<i> Burkhard Linke
</I>&gt;&gt;<i> &lt;mono_sigset.diff&gt;&lt;Main.cs&gt;_______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036836.html">[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal handler
</A></li>
	<LI>Next message: <A HREF="036848.html">[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36837">[ date ]</a>
              <a href="thread.html#36837">[ thread ]</a>
              <a href="subject.html#36837">[ subject ]</a>
              <a href="author.html#36837">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
