<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Alignment issue when interoperate with native code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Alignment%20issue%20when%20interoperate%20with%20native%20code&In-Reply-To=4D45D081.1070402%40plauener.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036843.html">
   <LINK REL="Next"  HREF="036845.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Alignment issue when interoperate with native code</H1>
    <B>Robert Jordan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Alignment%20issue%20when%20interoperate%20with%20native%20code&In-Reply-To=4D45D081.1070402%40plauener.de"
       TITLE="[Mono-dev] Alignment issue when interoperate with native code">robertj at gmx.net
       </A><BR>
    <I>Sun Jan 30 17:25:46 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036843.html">[Mono-dev] Alignment issue when interoperate with native code
</A></li>
        <LI>Next message: <A HREF="036845.html">[Mono-dev] Someone to review libgdiplus patches?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36844">[ date ]</a>
              <a href="thread.html#36844">[ thread ]</a>
              <a href="subject.html#36844">[ subject ]</a>
              <a href="author.html#36844">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Christian,

On 30.01.2011 21:56, Christian Krause wrote:
&gt;<i> It would be great if someone could confirm whether my findings are
</I>&gt;<i> correct. ;-) Thank you very much in advance!
</I>
Your findings are correct :) Mono is aligning its structs and
classes using GCC's __alignof__ builtin which returns
optimal alignments that do not always match the ABI.
Floats in the x86 ABI are such a notable exception.

Although the marshaller normally takes care of this mismatch,
in your case (unsafe pointers) the struct remains unmarshalled
because it is assumed to be fully blittable.

You can test alignment mismatches of a given type
with these macros:

#define MONO_ALIGN(type) __alignof__(type)
#define ABI_ALIGN(type) offsetof(struct { char c; type x; }, x)

Robert

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036843.html">[Mono-dev] Alignment issue when interoperate with native code
</A></li>
	<LI>Next message: <A HREF="036845.html">[Mono-dev] Someone to review libgdiplus patches?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36844">[ date ]</a>
              <a href="thread.html#36844">[ thread ]</a>
              <a href="subject.html#36844">[ subject ]</a>
              <a href="author.html#36844">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
