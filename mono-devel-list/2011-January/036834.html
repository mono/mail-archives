<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Incorrect%20signal%20handling%20for%20Sys%20V%20signal%0A%09handler&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036833.html">
   <LINK REL="Next"  HREF="036836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler</H1>
    <B>Burkhard Linke</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Incorrect%20signal%20handling%20for%20Sys%20V%20signal%0A%09handler&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal	handler">blinke at cebitec.uni-bielefeld.de
       </A><BR>
    <I>Thu Jan 27 10:06:06 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036833.html">[Mono-dev] [PATCH] Support for newer Boehm-GC versiobs (7.2 +	cvs)
</A></li>
        <LI>Next message: <A HREF="036836.html">[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36834">[ date ]</a>
              <a href="thread.html#36834">[ thread ]</a>
              <a href="subject.html#36834">[ subject ]</a>
              <a href="author.html#36834">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

signal handlers registered with signal(3) behave in a somewhat different way 
for Sys V systems, e.g. Solaris. The manpage states that during the execution 
of the signal handler, the signal disposition is set to SIG_DFL. This raises 
two problems:

a) a possible race condition, if the same signal occurs during the execution 
of its signal handler

b) handling the signal a second time, since the manpage (and the 
implementation under Solaris..) does not reinstall the signal handler.

The attached test program uses Mono.Unix.Signal to catch signals. Executing it 
under Solaris/x86 running Mono 2.8.1, Mono 2.6.7 and the git master gives the 
following output:

running as process 29499
sending first HUP
sending second HUP
Hangup

The second SIGHUP is not catched by the signal handler, terminating the 
application (which is the default for SIGHUP).

The applied patch solves the problem by replacing signal(3) with sigset(3). 
sigset's semantic differs from signal's one; Instead of setting the signal to 
default handling, it adds the signal to the process/threads signal masks, 
executed the signal handler and restores the signal mask. Both problems 
mentioned above are solved. Test program output after applying the patch to 
git master:

running as process 172
sending first HUP
sending second HUP
sending third HUP
terminating


With best regards,
Burkhard Linke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mono_sigset.diff
Type: text/x-diff
Size: 1893 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110127/c19947b0/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110127/c19947b0/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Main.cs
Type: text/x-c++src
Size: 1089 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110127/c19947b0/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20110127/c19947b0/attachment-0001.bin</A> 
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036833.html">[Mono-dev] [PATCH] Support for newer Boehm-GC versiobs (7.2 +	cvs)
</A></li>
	<LI>Next message: <A HREF="036836.html">[Mono-dev] [PATCH] Incorrect signal handling for Sys V signal handler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36834">[ date ]</a>
              <a href="thread.html#36834">[ thread ]</a>
              <a href="subject.html#36834">[ subject ]</a>
              <a href="author.html#36834">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
