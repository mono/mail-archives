<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] File not found error when using Activator.CreateInstanceFrom()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20File%20not%20found%20error%20when%20using%0A%20Activator.CreateInstanceFrom%28%29&In-Reply-To=1294352007193-3178277.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036656.html">
   <LINK REL="Next"  HREF="036744.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] File not found error when using Activator.CreateInstanceFrom()</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20File%20not%20found%20error%20when%20using%0A%20Activator.CreateInstanceFrom%28%29&In-Reply-To=1294352007193-3178277.post%40n4.nabble.com"
       TITLE="[Mono-dev] File not found error when using Activator.CreateInstanceFrom()">jonpryor at vt.edu
       </A><BR>
    <I>Fri Jan  7 09:37:34 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036656.html">[Mono-dev] File not found error when using	Activator.CreateInstanceFrom()
</A></li>
        <LI>Next message: <A HREF="036744.html">[Mono-dev] File not found error when using	Activator.CreateInstanceFrom()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36660">[ date ]</a>
              <a href="thread.html#36660">[ thread ]</a>
              <a href="subject.html#36660">[ subject ]</a>
              <a href="author.html#36660">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 6, 2011, at 5:13 PM, mike wrote:
&gt;<i> Thanks for the reply. Not sure what you mean as I'm not doing a
</I>&gt;<i> LoadLibrary().
</I>
Yes, &quot;you&quot; are: it's implicit to P/Invoke.  (OK, so .NET is doing it on your behalf under the covers, but a LoadLibrary() is still occurring.)

Since you're on Windows, LD_LIBRARY_PATH has no effect (that's a Unix environment variable).  Setting PATH might help; see:

	<A HREF="http://mono-project.com/DllImport#Windows_DLL_Search_Path">http://mono-project.com/DllImport#Windows_DLL_Search_Path</A>

&gt;<i> Compile the sample code(s) above in this post for an example
</I>&gt;<i> of how to produce the error.
</I>
The fundamental problem is that your example is still incomplete.  Providing a .zip may be more appropriate, but the fundamental question is this:  how _exactly_ you're compiling your native libraries?

For example, when I extract your source files from the relevant email and compile like this:

	CL /c MyEnviron.cpp
	LINK /DLL /OUT:Native\Environ.dll MyEnviron.obj

	CL /c MyLib.cpp
	LINK /DLL /OUT:Native\Test_Native.dll MyLib.obj Native\Environ.lib

	CSC app.cs /platform:x86

The above allows your code to work, but it took me an hour to re-learn enough CL+LINK to make it work.  (My first effort at `CL /LD /FoNative\Test_Native.dll MyLib.cpp` failed horribly, for reasons I can't fathom.  Thanks, Microsoft!)  I'm not sure why this would be failing under Mono, so that does appear to be a bug.

However, a workaround for mono is to place the .DLL files into the same directory as your .EXE, instead of into a &quot;Native&quot; sub-directory.  (At least, this works for me.)

Furthermore, your C# code appears wrong (or you're doing something different when compiling your native libraries).  Specifically:

		// Test Method
		[DllImport(&quot;Native\\Test_Native.dll&quot;,
		EntryPoint = &quot;Test&quot;,
		ExactSpelling = false,
		CallingConvention = CallingConvention.StdCall)]
		static extern void _Test();		

Test_Native.dll!Test() will default to Cdecl calling convention, not StdCall, so your calling convention is wrong.  This often won't immediately break things (as .NET will occasionally detect the stack mismatch and fix it), but it can break things, and thus should be fixed.  I'm also not sure why you're setting ExactSpelling at all.

 - Jon

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036656.html">[Mono-dev] File not found error when using	Activator.CreateInstanceFrom()
</A></li>
	<LI>Next message: <A HREF="036744.html">[Mono-dev] File not found error when using	Activator.CreateInstanceFrom()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36660">[ date ]</a>
              <a href="thread.html#36660">[ thread ]</a>
              <a href="subject.html#36660">[ subject ]</a>
              <a href="author.html#36660">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
