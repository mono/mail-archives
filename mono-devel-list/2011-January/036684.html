<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [Mono-list] RSA with SHA512 hash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BMono-list%5D%20RSA%20with%20SHA512%20hash&In-Reply-To=20110111070319.8302E68000E%40maelstrom.oregan.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036686.html">
   <LINK REL="Next"  HREF="036685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [Mono-list] RSA with SHA512 hash</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BMono-list%5D%20RSA%20with%20SHA512%20hash&In-Reply-To=20110111070319.8302E68000E%40maelstrom.oregan.net"
       TITLE="[Mono-dev] [Mono-list] RSA with SHA512 hash">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Tue Jan 11 09:25:10 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="036686.html">[Mono-dev] Announcing Monoreports - report designer and	reporting engine
</A></li>
        <LI>Next message: <A HREF="036685.html">[Mono-dev] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36684">[ date ]</a>
              <a href="thread.html#36684">[ thread ]</a>
              <a href="subject.html#36684">[ subject ]</a>
              <a href="author.html#36684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

Please always c.c. the mailing-list. Someone else may have the same
question/issue in the future and private replies won't help them when
googling.

On Tue, 2011-01-11 at 07:03 +0000, Jeremy Poulter wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Thank you for this. Do you still want me to add a bug report?
</I>
That's up to you - but this is how you can be notified when (and how)
the issue is fixed inside mono. It's also (a low risk in this case) the
best way to ensure this cannot be forgotten (like email reports can
easily be).

&gt;<i> What is the work around?
</I>
// However there's no such limit when using the [De]Formatter class.

that means using: RSAPKCS1SignatureFormatter
<A HREF="http://msdn.microsoft.com/en-us/library/system.security.cryptography.rsapkcs1signatureformatter.aspx">http://msdn.microsoft.com/en-us/library/system.security.cryptography.rsapkcs1signatureformatter.aspx</A>

which IMO is a lot better (than using RSACryptoServiceProvider) since
the class can be used with (almost) any hash algorithm and (almost) any
RSA-derived type.

Sebastien

&gt;<i> Cheers,
</I>&gt;<i> 
</I>&gt;<i> Jeremy
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Sebastien Pouliot
</I>&gt;<i> Sent:  10/01/2011 8:32:21 pm
</I>&gt;<i> Subject:  Re: [Mono-list] RSA with SHA512 hash
</I>&gt;<i> 
</I>&gt;<i> Hello again,
</I>&gt;<i> 
</I>&gt;<i> &gt;From source code:
</I>&gt;<i> 
</I>&gt;<i> 		// LAMESPEC: str is not the hash name but an OID
</I>&gt;<i> 		// NOTE: this method is LIMITED to SHA1 and MD5 like the MS framework 1.0 
</I>&gt;<i> 		// and 1.1 because there's no method to get a hash algorithm from an OID. 
</I>&gt;<i> 		// However there's no such limit when using the [De]Formatter class.
</I>&gt;<i> 		public byte[] SignHash (byte[] rgbHash, string str) 
</I>&gt;<i> 
</I>&gt;<i> So this is something that has changed after 1.x (likely 2.0 or 3.5).
</I>&gt;<i> I'll fix this soon in GIT (maybe in time for 2.10). In the mean time the
</I>&gt;<i> workaround will work on all Mono / .NET releases.
</I>&gt;<i> 
</I>&gt;<i> Sebastien
</I>&gt;<i> 
</I>&gt;<i> On Mon, 2011-01-10 at 07:53 -0500, Sebastien Pouliot wrote:
</I>&gt;<i> &gt; Hello Jeremy,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This was not supported in earlier version of Windows. Most of MS .NET
</I>&gt;<i> &gt; cryptography is not managed and redirected to CryptoAPI, which features
</I>&gt;<i> &gt; varies by Windows versions (which means your code won't work on all
</I>&gt;<i> &gt; Windows versions out there).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In any case Mono can support this (all managed and no dependency on the
</I>&gt;<i> &gt; OS). Please fill a bug report on bugzilla.novell.com with a
</I>&gt;<i> &gt; self-contained test case and I'll look at it asap.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt; Sebastien
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Mon, 2011-01-10 at 01:50 -0800, jeremy.poulter wrote:
</I>&gt;<i> &gt; &gt; I have been developing an application that uses an SHA512 hash signed with a
</I>&gt;<i> &gt; &gt; RSA private key for a digital signature.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; This is working fine on Windows under .Net but when I try this on Linux
</I>&gt;<i> &gt; &gt; under Mono I get the following exception;
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; System.NotSupportedException: 2.16.840.1.101.3.4.2.3 is an unsupported hash
</I>&gt;<i> &gt; &gt; algorithm for RSA signing
</I>&gt;<i> &gt; &gt;   at
</I>&gt;<i> &gt; &gt; System.Security.Cryptography.RSACryptoServiceProvider.GetHashNameFromOID
</I>&gt;<i> &gt; &gt; (System.String oid) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Security.Cryptography.RSACryptoServiceProvider.SignHash
</I>&gt;<i> &gt; &gt; (System.Byte[] rgbHash, System.String str) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at Oregan.Utilities.DigitalSignature.DigitalSignature.Sign (HashType
</I>&gt;<i> &gt; &gt; hashType, System.IO.Stream stream) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at Oregan.FilePackBuilder.FilePack.Save (System.String sPath,
</I>&gt;<i> &gt; &gt; Oregan.Utilities.DigitalSignature.DigitalSignature digitalSignature, Boolean
</I>&gt;<i> &gt; &gt; bPreserveName) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at Oregan.FilePackBuilder.FilePackViewer.filepackToolStripMenuItem1_Click
</I>&gt;<i> &gt; &gt; (System.Object sender, System.EventArgs e) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripItem.OnClick (System.EventArgs e)
</I>&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripMenuItem.OnClick (System.EventArgs e)
</I>&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripMenuItem.HandleClick (System.EventArgs e)
</I>&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripItem.FireEvent (System.EventArgs e,
</I>&gt;<i> &gt; &gt; ToolStripItemEventType met) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at (wrapper remoting-invoke-with-check)
</I>&gt;<i> &gt; &gt; System.Windows.Forms.ToolStripItem:FireEvent
</I>&gt;<i> &gt; &gt; (System.EventArgs,System.Windows.Forms.ToolStripItemEventType)
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStrip.OnMouseUp
</I>&gt;<i> &gt; &gt; (System.Windows.Forms.MouseEventArgs mea) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripDropDown.OnMouseUp
</I>&gt;<i> &gt; &gt; (System.Windows.Forms.MouseEventArgs mea) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.Control.WmLButtonUp (System.Windows.Forms.Message&amp;
</I>&gt;<i> &gt; &gt; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.Control.WndProc (System.Windows.Forms.Message&amp; m)
</I>&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ScrollableControl.WndProc
</I>&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStrip.WndProc (System.Windows.Forms.Message&amp;
</I>&gt;<i> &gt; &gt; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripDropDown.WndProc
</I>&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.Control+ControlWindowTarget.OnMessage
</I>&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.Control+ControlNativeWindow.WndProc
</I>&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt;   at System.Windows.Forms.NativeWindow.WndProc (IntPtr hWnd, Msg msg, IntPtr
</I>&gt;<i> &gt; &gt; wParam, IntPtr lParam) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; FYI the code I used is;
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt;     public byte[] Sign(HashType hashType, Stream stream)
</I>&gt;<i> &gt; &gt;     {
</I>&gt;<i> &gt; &gt;       switch (hashType)
</I>&gt;<i> &gt; &gt;       {
</I>&gt;<i> &gt; &gt;         case HashType.MD5:
</I>&gt;<i> &gt; &gt;         {
</I>&gt;<i> &gt; &gt;           MD5 md5 = new MD5CryptoServiceProvider();
</I>&gt;<i> &gt; &gt;           byte[] hash = md5.ComputeHash(stream);
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt;           return key.SignHash(hash, CryptoConfig.MapNameToOID(&quot;MD5&quot;));
</I>&gt;<i> &gt; &gt;         }
</I>&gt;<i> &gt; &gt;         case HashType.SHA512:
</I>&gt;<i> &gt; &gt;         {
</I>&gt;<i> &gt; &gt;           SHA512 shaM = new SHA512Managed();
</I>&gt;<i> &gt; &gt;           byte[] hash = shaM.ComputeHash(stream);
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt;           return key.SignHash(hash, CryptoConfig.MapNameToOID(&quot;SHA512&quot;));
</I>&gt;<i> &gt; &gt;         }
</I>&gt;<i> &gt; &gt;       }
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt;       return null;
</I>&gt;<i> &gt; &gt;     }
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Any feedback is appreciated.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Cheers,
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Jeremy
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036686.html">[Mono-dev] Announcing Monoreports - report designer and	reporting engine
</A></li>
	<LI>Next message: <A HREF="036685.html">[Mono-dev] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36684">[ date ]</a>
              <a href="thread.html#36684">[ thread ]</a>
              <a href="subject.html#36684">[ subject ]</a>
              <a href="author.html#36684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
