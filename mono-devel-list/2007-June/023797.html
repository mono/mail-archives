<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] New Mono.Data.Sqlite problems with UTF8 conversion on	Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20Mono.Data.Sqlite%20problems%20with%20UTF8%20conversion%20on%0A%09Windows&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023807.html">
   <LINK REL="Next"  HREF="023811.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] New Mono.Data.Sqlite problems with UTF8 conversion on	Windows</H1>
    <B>Kamil Skalski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20New%20Mono.Data.Sqlite%20problems%20with%20UTF8%20conversion%20on%0A%09Windows&In-Reply-To="
       TITLE="[Mono-dev] New Mono.Data.Sqlite problems with UTF8 conversion on	Windows">kamil.skalski at gmail.com
       </A><BR>
    <I>Sat Jun  2 12:27:30 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023807.html">[Mono-dev] Ximian services (SVN,	mailing lists) down for the weekend.
</A></li>
        <LI>Next message: <A HREF="023811.html">[Mono-dev] New Mono.Data.Sqlite problems with UTF8 conversion on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23797">[ date ]</a>
              <a href="thread.html#23797">[ thread ]</a>
              <a href="subject.html#23797">[ subject ]</a>
              <a href="author.html#23797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello!

I was trying to use the new implementation of Sqlite provider
available now on mono, but I had  several problems with it...
First of all it failed to perform BindParameters properly when I tried
to use named parameters. After some debugging it appeared that the
names of parameters are improperly read from data returned by sqlite
native function. The problem was the usage of
Marshal.PtrToStrAuto   in SQLiteConvert.cs
function, which didn't properly decode strings on Windows system.
I patched the implementation with the way it is done in old
Mono.Data.SqliteClient - the implementation isn't very elegant, since
it adds usage of unsafe pointer, but it worked well in the old
implementation. If anybody knows a better way to convert unmanaged
utf8 strings into managed string, without adding dependency on other
libraries, then we could do this better.

The second problem I encounter with new implementation is that it
seems to deadlock when there are two threads using the same
data-base... I use separate connections for each thread, but it looks
like when I perform data-modify operations from both, it locks totally
(concurrent reads seems to be ok). If anyone has some suggestions,
please let me know. For now I will stick with old implementation.

-- 
Kamil Skalski
<A HREF="http://nazgul.omega.pl">http://nazgul.omega.pl</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sqlite_utf.diff
Type: application/octet-stream
Size: 1710 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070602/b7bf1930/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070602/b7bf1930/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023807.html">[Mono-dev] Ximian services (SVN,	mailing lists) down for the weekend.
</A></li>
	<LI>Next message: <A HREF="023811.html">[Mono-dev] New Mono.Data.Sqlite problems with UTF8 conversion on Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23797">[ date ]</a>
              <a href="thread.html#23797">[ thread ]</a>
              <a href="subject.html#23797">[ subject ]</a>
              <a href="author.html#23797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
