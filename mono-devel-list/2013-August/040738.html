<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Portability: System.Drawing.Image vs	GDIPlus.GdipLoadImageFromFile
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Portability%3A%20System.Drawing.Image%20vs%0A%09GDIPlus.GdipLoadImageFromFile&In-Reply-To=%3C520CDE2D.3020206%40terrorise.me.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040737.html">
   <LINK REL="Next"  HREF="040739.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Portability: System.Drawing.Image vs	GDIPlus.GdipLoadImageFromFile</H1>
    <B>Francis Fisher</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Portability%3A%20System.Drawing.Image%20vs%0A%09GDIPlus.GdipLoadImageFromFile&In-Reply-To=%3C520CDE2D.3020206%40terrorise.me.uk%3E"
       TITLE="[Mono-dev] Portability: System.Drawing.Image vs	GDIPlus.GdipLoadImageFromFile">lists.ximian.com at terrorise.me.uk
       </A><BR>
    <I>Thu Aug 15 13:57:01 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040737.html">[Mono-dev] Non-sensical stack trace (possible issue with	generic sharing?)
</A></li>
        <LI>Next message: <A HREF="040739.html">[Mono-dev] BitBlt from gdi32.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40738">[ date ]</a>
              <a href="thread.html#40738">[ thread ]</a>
              <a href="subject.html#40738">[ subject ]</a>
              <a href="author.html#40738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've encountered an issue in some software that calls 
System.Drawing.Image (), passing in a filename that is not portable 
which I've raised as bug #14002.

System.Drawing.Image () verifies the file's existence with File.Exists 
(which uses the Mono.IO portability framework), then passes the filename 
to GDIPlus.GdipLoadImageFromFile () which does not use the portability 
framework and fails to open the file.

To fix this, I either need to make GdipLoadImageFromFile use the same 
portability mechanism as has been built into Mono.IO, or 
System.Drawing.Image () needs to convert the filename it receives (if 
necessary) before passing it to GdipLoadImageFromFile ().

As I see it, the disadvantage of fixing GDIPlus is that as a separate 
library to Mono, it may require code duplication which might lead to 
divergent code bugs in the future. On the other hand, if its common 
practice for user software (and not just the class libraries) to call 
GDIPlus.GdipLoadImageFromFile, then it absolutely has to be fixed in the 
GDIPlus library - converting the filename within System.Drawing.Image 
would only solve a subset of the issue.

If user software never calls GDIPlus.GdipLoadImageFromFile directly, 
then it could be quite safe to fix it in System.Drawing.Image, which 
would mean that we don't have to duplicate code between mono and GDIPlus.

A 3rd option that would avoid duplicating code between GDIPlus and 
Mono.IO could be to have some kind of managed code wrapper to 
GdipLoadImageFromFile that calls a function in Mono.IO to find the 
correct filename, before passing the converted filename onwards. That 
would leave the portability code in one place, but still allow GDIPlus 
to take advantage of it.

Any thoughts about which route I should go down?

Regards,
Frankie Fisher
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040737.html">[Mono-dev] Non-sensical stack trace (possible issue with	generic sharing?)
</A></li>
	<LI>Next message: <A HREF="040739.html">[Mono-dev] BitBlt from gdi32.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40738">[ date ]</a>
              <a href="thread.html#40738">[ thread ]</a>
              <a href="subject.html#40738">[ subject ]</a>
              <a href="author.html#40738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
