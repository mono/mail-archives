<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] DataRowCollection.Remove performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20DataRowCollection.Remove%20performance&In-Reply-To=%3C51F9EAF9.7080205%40energyexemplar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="040643.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] DataRowCollection.Remove performance</H1>
    <B>Julian Hamilton</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20DataRowCollection.Remove%20performance&In-Reply-To=%3C51F9EAF9.7080205%40energyexemplar.com%3E"
       TITLE="[Mono-dev] DataRowCollection.Remove performance">julian.hamilton at energyexemplar.com
       </A><BR>
    <I>Thu Aug  1 04:58:33 UTC 2013</I>
    <P><UL>
        
        <LI>Next message: <A HREF="040643.html">[Mono-dev] DataRowCollection.Remove performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40640">[ date ]</a>
              <a href="thread.html#40640">[ thread ]</a>
              <a href="subject.html#40640">[ subject ]</a>
              <a href="author.html#40640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, I've never posted here before, so forgive me if I break etiquette. 
However, I'm trying to submit a suggestion for a code change. While 
developing our product which runs on both Windows and Linux, our Linux 
users reported a significant difference in speed between the application 
running on Windows under MS.NET versus Mono. I've tracked down the main 
cause of the problem and I thought I'd share my change for possible 
inclusion in a future release of Mono.

This is the current code for DataRowCollection.RemoveInternal...

internal void RemoveInternal (DataRow row)
{
     if (row == null)
         throw new IndexOutOfRangeException (&quot;The given datarow is not 
in the current DataRowCollection.&quot;);
     int index = List.IndexOf (row);
     if (index &lt; 0)
         throw new IndexOutOfRangeException (&quot;The given datarow is not 
in the current DataRowCollection.&quot;);
     List.RemoveAt (index);
     for (; index &lt; List.Count; ++index)
         ((DataRow) List [index]).RowID = index;
}

Using List.IndexOf(row) is causing the poor performance. However, 
DataRowCollection has its own IndexOf() method which is designed to be 
fast and safe, taking advantage of the cached RowID member and testing 
that the row is a member in the DataRowCollection. This should be used 
here instead, resulting in the following code change...

internal void RemoveInternal (DataRow row)
{
     if (row == null)
         throw new IndexOutOfRangeException (&quot;The given datarow is not 
in the current DataRowCollection.&quot;);
-   int index = List.IndexOf (row);
+   int index = this.IndexOf (row);
     if (index &lt; 0)
         throw new IndexOutOfRangeException (&quot;The given datarow is not 
in the current DataRowCollection.&quot;);
     List.RemoveAt (index);
     for (; index &lt; List.Count; ++index)
         ((DataRow) List [index]).RowID = index;
}

In my own testing this sped up row deletions by approximately 360%, but 
you can ascertain a more accurate measure for yourself.

Thanks,
-Julian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130801/07644366/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130801/07644366/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="040643.html">[Mono-dev] DataRowCollection.Remove performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40640">[ date ]</a>
              <a href="thread.html#40640">[ thread ]</a>
              <a href="subject.html#40640">[ subject ]</a>
              <a href="author.html#40640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
