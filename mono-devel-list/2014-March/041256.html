<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Bug with Ssl cert validation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Bug%20with%20Ssl%20cert%20validation&In-Reply-To=%3C8e6fd3392a004214bcab91b4f4e88d79%40BL2PR08MB451.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041255.html">
   <LINK REL="Next"  HREF="041257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Bug with Ssl cert validation</H1>
    <B>Edward Ned Harvey (mono)</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Bug%20with%20Ssl%20cert%20validation&In-Reply-To=%3C8e6fd3392a004214bcab91b4f4e88d79%40BL2PR08MB451.namprd08.prod.outlook.com%3E"
       TITLE="[Mono-dev] Bug with Ssl cert validation">edward.harvey.mono at clevertrove.com
       </A><BR>
    <I>Tue Mar 18 02:43:23 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041255.html">[Mono-dev] How to workaround old LinqBridge ExtensionAttribute	error.
</A></li>
        <LI>Next message: <A HREF="041257.html">[Mono-dev] Fwd:  Bug with Ssl cert validation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41256">[ date ]</a>
              <a href="thread.html#41256">[ thread ]</a>
              <a href="subject.html#41256">[ subject ]</a>
              <a href="author.html#41256">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This *has* to be a bug in mono.  I repeated this problem with mono 3.2.7 (the standard distribution MDK) on mac osx Mavericks fully updated, and 3.2.8 on linux, built from source.  No problem on windows.  (Win 8.1 Pro fully updated)

On mac and linux, I am aware that there are no trusted root CA's by default.  So I ran &quot;mozroots --import --sync&quot; and repeated - still got the same problem - and I tried &quot;sudo mozroots --import --sync --machine&quot; and once again confirmed the same problem.  I confirmed that the mozilla root CA's were downloaded and installed to ~/.config/.mono/certs/Trust/ and /usr/share/.mono/certs/Trust/, but still the behavior remains unchanged.  Problem on both mac &amp; linux.

Sample code below.  When run on mono, throws &quot;System.IO.IOException: The authentication or decryption has failed. ---&gt; Mono.Security.Protocol.Tls.TlsException: Invalid certificate received from server.&quot;  

Does not throw exception on windows.

using System;
using System.Net;
using System.Net.Sockets;
using System.Net.Security;
using System.Security.Authentication;
using System.Security.Cryptography.X509Certificates;

namespace FunWithSsl
{
	class MainClass
	{
		public static void Main (string[] args)
		{
			string targetHost = &quot;verisign.com&quot;;	// pick a site, any site.  https server
			IPAddress[] addresses = Dns.GetHostAddresses (targetHost);
			var client = new TcpClient ();
			client.Connect (addresses [0],443);
			var mySslStream = new SslStream (client.GetStream(), false, ValidateServerCertificate);
			try
			{
				mySslStream.AuthenticateAsClient (targetHost, null, SslProtocols.Tls, false);
				System.Console.WriteLine (&quot;Passed&quot;);
			}
			catch (Exception e)
			{
				System.Console.WriteLine (&quot;Failed: \n&quot;+e.ToString());
			}
		}
		private static bool ValidateServerCertificate(object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
		{
			System.Console.WriteLine (sslPolicyErrors.ToString ());
			//System.Console.WriteLine(chain.ToString());
			System.Console.WriteLine(certificate.ToString());
			return (sslPolicyErrors == SslPolicyErrors.None);
		}
	}
}
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041255.html">[Mono-dev] How to workaround old LinqBridge ExtensionAttribute	error.
</A></li>
	<LI>Next message: <A HREF="041257.html">[Mono-dev] Fwd:  Bug with Ssl cert validation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41256">[ date ]</a>
              <a href="thread.html#41256">[ thread ]</a>
              <a href="subject.html#41256">[ subject ]</a>
              <a href="author.html#41256">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
