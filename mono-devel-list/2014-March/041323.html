<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Register allocation and overlapping registers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Register%20allocation%20and%20overlapping%20registers&In-Reply-To=%3CCAJR-0p9eSttW8nKsGOC4yaJF73dG6tNDTY-WZtZeiZZAUOofEw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041321.html">
   <LINK REL="Next"  HREF="041330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Register allocation and overlapping registers</H1>
    <B>Zoltan Varga</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Register%20allocation%20and%20overlapping%20registers&In-Reply-To=%3CCAJR-0p9eSttW8nKsGOC4yaJF73dG6tNDTY-WZtZeiZZAUOofEw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Register allocation and overlapping registers">vargaz at gmail.com
       </A><BR>
    <I>Tue Mar 25 17:10:09 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041321.html">[Mono-dev] Register allocation and overlapping registers
</A></li>
        <LI>Next message: <A HREF="041330.html">[Mono-dev] Printing under Windows with Gtk#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41323">[ date ]</a>
              <a href="thread.html#41323">[ thread ]</a>
              <a href="subject.html#41323">[ subject ]</a>
              <a href="author.html#41323">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

  The mono JIT only uses double precision registers in most cases and only
uses single precision ones for temporary purposes, like to implement casts.
There were some problems with choosing these temporary registers, but they
should be fixed in 3.4.0/master.

             Zoltan


On Tue, Mar 25, 2014 at 12:23 PM, SilentBob &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">cinnamondonkey at gmail.com</A>&gt;wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm hoping someone can provide some insight into how the cross-compiler
</I>&gt;<i> handles allocating registers when the registers overlap.
</I>&gt;<i>
</I>&gt;<i> I'm looking at a case on ARM where the following code:
</I>&gt;<i>
</I>&gt;<i>     double d = 7.2199997900000001;
</I>&gt;<i>     float f = (f)d;
</I>&gt;<i>
</I>&gt;<i> Results in:
</I>&gt;<i>
</I>&gt;<i>     vcvt.f32.f64 s4, d2
</I>&gt;<i>
</I>&gt;<i> Because the 'd' registers are made up of pairs of 's' registers (in this
</I>&gt;<i> case d2 overlaps with s4 and s5) there is the potential for collision as in
</I>&gt;<i> this case. The end result is that d2 changes as s4 is updated. It would be
</I>&gt;<i> fine if it was not for d2 then being used immediately by the next
</I>&gt;<i> instruction.
</I>&gt;<i>
</I>&gt;<i> mono_local_regalloc () in mini-codegen.c seems to be translating
</I>&gt;<i> 'float_conv_to_r4 R25 &lt;- R24' and ending up with dreg = 4 and sreg1 = 4
</I>&gt;<i> this
</I>&gt;<i> eventually gets emitted as above.
</I>&gt;<i>
</I>&gt;<i> Thank you in advance for all help.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Shaun
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://mono.1490590.n4.nabble.com/Register-allocation-and-overlapping-registers-tp4662363.html">http://mono.1490590.n4.nabble.com/Register-allocation-and-overlapping-registers-tp4662363.html</A>
</I>&gt;<i> Sent from the Mono - Dev mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140325/d3685b09/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140325/d3685b09/attachment.html</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041321.html">[Mono-dev] Register allocation and overlapping registers
</A></li>
	<LI>Next message: <A HREF="041330.html">[Mono-dev] Printing under Windows with Gtk#
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41323">[ date ]</a>
              <a href="thread.html#41323">[ thread ]</a>
              <a href="subject.html#41323">[ subject ]</a>
              <a href="author.html#41323">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
