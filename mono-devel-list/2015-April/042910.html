<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Assemblies in the CLR system directory and F#	scripting.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Assemblies%20in%20the%20CLR%20system%20directory%20and%20F%23%0A%09scripting.&In-Reply-To=%3C552F9A44.2000907%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042909.html">
   <LINK REL="Next"  HREF="042912.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Assemblies in the CLR system directory and F#	scripting.</H1>
    <B>Matthias Dittrich</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Assemblies%20in%20the%20CLR%20system%20directory%20and%20F%23%0A%09scripting.&In-Reply-To=%3C552F9A44.2000907%40gmail.com%3E"
       TITLE="[Mono-dev] Assemblies in the CLR system directory and F#	scripting.">matthi.d at googlemail.com
       </A><BR>
    <I>Thu Apr 16 11:17:24 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="042909.html">[Mono-dev] Assemblies in the CLR system directory and F# scripting.
</A></li>
        <LI>Next message: <A HREF="042912.html">[Mono-dev] LLVM + mac deploys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42910">[ date ]</a>
              <a href="thread.html#42910">[ thread ]</a>
              <a href="subject.html#42910">[ subject ]</a>
              <a href="author.html#42910">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 16.04.2015 12:37, Alexander K&#246;plinger wrote:
&gt;<i> EntityFramework was already removed from the upcoming Mono 4.0.
</I>&gt;<i> I also just checked and on Windows I have System.Web.Razor.dll (Razor
</I>&gt;<i> 2.0) in the GAC as well, so maybe there's some other issue here?
</I>
I'm not talking about the GAC, you are right: Leaving a (mono
compatible) version in the GAC is probably good idea.

On Windows the corresponding CLR system directory is (on my machine)
&quot;C:\Windows\Microsoft.NET\Framework\v4.0.30319&quot; and there is no
&quot;System.Web.Razor.dll&quot; in there.
(System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory()).

To clarify:
GAC-Linux:  /usr/lib/mono/gac/ &lt;- having a compatible
System.Web.Razor.dll is a good thing
GAC-Windows: somewhere &lt;- doesn't matter (for completeness: has a
2.0.0.0 version of System.Web.Razor on my machine, like mono)
CLR-Dir-Windows: &quot;C:\Windows\Microsoft.NET\Framework\v4.0.30319&quot; &lt;- does
not have a System.Web.Razor.dll (at least on my machine)
CLR-Dir-Linux: /usr/lib/mono/4.5 (number depends on the runtime used) &lt;-
has System.Web.Razor.dll (= problem I was describing in the last email)

Please correct me if my analysis is incorrect.

If you indeed have a System.Web.Razor.dll in the CLR directory it might
have been installed with some additional package?

-- Matthias
&gt;<i>  
</I>&gt;<i> -- Alex
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">matthi.d at googlemail.com</A>
</I>&gt;&gt;<i> Date: Thu, 16 Apr 2015 12:08:54 +0200
</I>&gt;&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> Subject: [Mono-dev] Assemblies in the CLR system directory and F#
</I>&gt;<i> scripting.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> TL;DR: We should remove System.Web.Razor.dll, EntityFramework.dll (and
</I>&gt;&gt;<i> possibly more) from &quot;/usr/lib/mono/4.5&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I noticed that some assemblies (namely &quot;EntityFramework&quot; and
</I>&gt;&gt;<i> &quot;System.Web.Razor&quot; and possibly more) lead to problems when used within
</I>&gt;&gt;<i> a F# script file. The problem is the following:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Assume you use NuGet to download the latest Razor-3 package and then do
</I>&gt;&gt;<i> the following (in an F# script file):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #I &quot;packages/Microsoft.AspNet.Razor/lib/net45&quot;
</I>&gt;&gt;<i> #r &quot;System.Web.Razor.dll&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that this is the usual way of loading assemblies in F# scripting
</I>&gt;&gt;<i> and it works fine on Windows/.NET.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However because this is the same as using
</I>&gt;&gt;<i> &quot;/lib:packages/Microsoft.AspNet.Razor/lib/net45
</I>&gt;&gt;<i> /reference:System.Web.Razor.dll&quot; on the C# compiler and because mono has
</I>&gt;&gt;<i> a &quot;System.Web.Razor.dll&quot; in its CLR system directory (/usr/lib/mono/4.5)
</I>&gt;&gt;<i> it will redirect the reference (CLR system directory is always
</I>&gt;&gt;<i> preferred, see <A HREF="https://msdn.microsoft.com/en-us/library/s5bac5fx.aspx">https://msdn.microsoft.com/en-us/library/s5bac5fx.aspx</A>).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This already hit me several times:
</I>&gt;&gt;<i> - <A HREF="https://github.com/fsharp/FSharp.Compiler.Service/issues/313">https://github.com/fsharp/FSharp.Compiler.Service/issues/313</A>
</I>&gt;&gt;<i> - <A HREF="https://github.com/tpetricek/FSharp.Formatting/pull/279">https://github.com/tpetricek/FSharp.Formatting/pull/279</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm not really sure why mono actually needs those file to live there.
</I>&gt;&gt;<i> For referencing the NuGet package should be fine. To load the correct
</I>&gt;&gt;<i> (mono compatible) version on runtime the GAC should do it.
</I>&gt;&gt;<i> IMHO we can just remove the System.Web.Razor.dll (and possibly others?)
</I>&gt;&gt;<i> from the runtime directory.
</I>&gt;&gt;<i> @akoeplinger noted the following in the gitter chat: It would be a
</I>&gt;&gt;<i> breaking change for people depending on &quot;/reference:System.Web.Razor&quot; to
</I>&gt;&gt;<i> just work.
</I>&gt;&gt;<i> But I'm not sure how common that is with the NuGet package in place.
</I>&gt;&gt;<i> IIRC xbuild and msbuild always use fully qualified references, so it
</I>&gt;&gt;<i> shouldn't be a problem for them.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So... Is removing those file something we can do? I just wanted to bring
</I>&gt;&gt;<i> attention to this issue as it can be *really* hard to debug. The
</I>&gt;&gt;<i> workarounds in place for this are required anyway to work with older
</I>&gt;&gt;<i> mono versions. The workaround in itself is simple you just need to use
</I>&gt;&gt;<i> the fully qualified reference instead:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #r &quot;packages/Microsoft.AspNet.Razor/lib/net45/System.Web.Razor.dll&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However this can be a problem if you don't know in advance in which of
</I>&gt;&gt;<i> the included directories (&quot;#I&quot;) the file is living. (Because F# will
</I>&gt;&gt;<i> stop executing if the fully qualified reference doesn't exists).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Matthias
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042909.html">[Mono-dev] Assemblies in the CLR system directory and F# scripting.
</A></li>
	<LI>Next message: <A HREF="042912.html">[Mono-dev] LLVM + mac deploys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42910">[ date ]</a>
              <a href="thread.html#42910">[ thread ]</a>
              <a href="subject.html#42910">[ subject ]</a>
              <a href="author.html#42910">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
