<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] SEGV in runtime related to GC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SEGV%20in%20runtime%20related%20to%20GC&In-Reply-To=20060213134105.GF25823%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017100.html">
   <LINK REL="Next"  HREF="017146.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] SEGV in runtime related to GC</H1>
    <B>Thong Nguyen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SEGV%20in%20runtime%20related%20to%20GC&In-Reply-To=20060213134105.GF25823%40debian.org"
       TITLE="[Mono-dev] SEGV in runtime related to GC">tum at veridicus.com
       </A><BR>
    <I>Tue Feb 14 04:35:00 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017100.html">[Mono-dev] SEGV in runtime related to GC
</A></li>
        <LI>Next message: <A HREF="017146.html">[Mono-dev] SEGV in runtime related to GC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17131">[ date ]</a>
              <a href="thread.html#17131">[ thread ]</a>
              <a href="subject.html#17131">[ subject ]</a>
              <a href="author.html#17131">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Lupis,

I have traced the problem down to arrays of generic structs.  It doesn't not
occur on arrays of non-generic structs.  This may or may not be related to
bug #75479 (also mentioned in object.c).

Pretty weird and maybe related to the vtable pointer and generic class
related pointers referenced within (though theoretically the boehm gc
shouldn't even scan the vtable as AFAIK, it isn't allocated on the gc-heap).

I don't have a simple test case yet but I'm working on it...

Patch to make non-generic structs not allocated ptrfree attached...

^Tum

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:mono-devel-list-
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of Paolo Molaro
</I>&gt;<i> Sent: Tuesday, 14 February 2006 2:41 a.m.
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-dev] SEGV in runtime related to GC
</I>&gt;<i> 
</I>&gt;<i> On 02/14/06 Thong Nguyen wrote:
</I>&gt;<i> &gt; I've been getting some memory corruption running an application after
</I>&gt;<i> the GC
</I>&gt;<i> &gt; runs.  I've tracked it down to the allocation of primitive arrays (in
</I>&gt;<i> &gt; metadata/object.c) using GC_ALLOC_ATOMIC (or the mono equivalent).  Now,
</I>&gt;<i> &gt; theoretically it should be fine, but changing it to a normal GC_ALLOC
</I>&gt;<i> seems
</I>&gt;<i> &gt; to fix (or maybe hide) the issue.
</I>&gt;<i> 
</I>&gt;<i> It is very likely only hiding the issue.
</I>&gt;<i> 
</I>&gt;<i> &gt; Do mono objects contain links to any GC allocated memory?  A primitive
</I>&gt;<i> array
</I>&gt;<i> &gt; might not contain any managed references but the object header *may*
</I>&gt;<i> contain
</I>&gt;<i> &gt; some pointers.  I know at one point mono objects used to heap allocate
</I>&gt;<i> &gt; object monitors but that doesn't appear to be the case anymore so that
</I>&gt;<i> &gt; doesn't appear to be the issue...
</I>&gt;<i> 
</I>&gt;<i> Right, the object header doesn't contain references to objects.
</I>&gt;<i> 
</I>&gt;<i> &gt; Any ideas?
</I>&gt;<i> 
</I>&gt;<i> A test case that replicates the issue would be the best way to allow us to
</I>&gt;<i> debug and see where the real problem is.
</I>&gt;<i> 
</I>&gt;<i> lupus
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> -----------------------------------------------------------------
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: objectarray.diff
Type: application/octet-stream
Size: 1547 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060214/7ebfc847/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20060214/7ebfc847/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017100.html">[Mono-dev] SEGV in runtime related to GC
</A></li>
	<LI>Next message: <A HREF="017146.html">[Mono-dev] SEGV in runtime related to GC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17131">[ date ]</a>
              <a href="thread.html#17131">[ thread ]</a>
              <a href="subject.html#17131">[ subject ]</a>
              <a href="author.html#17131">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
