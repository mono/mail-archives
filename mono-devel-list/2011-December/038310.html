<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] SWIG Corrupt Strings - Delegate/System.String inner working changed from mono-2.8 to mono-2.10?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SWIG%20Corrupt%20Strings%20-%20Delegate/System.String%20inner%0A%20working%20changed%20from%20mono-2.8%20to%20mono-2.10%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038309.html">
   <LINK REL="Next"  HREF="038311.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] SWIG Corrupt Strings - Delegate/System.String inner working changed from mono-2.8 to mono-2.10?</H1>
    <B>Sen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20SWIG%20Corrupt%20Strings%20-%20Delegate/System.String%20inner%0A%20working%20changed%20from%20mono-2.8%20to%20mono-2.10%3F&In-Reply-To="
       TITLE="[Mono-dev] SWIG Corrupt Strings - Delegate/System.String inner working changed from mono-2.8 to mono-2.10?">sen121 at yopmail.com
       </A><BR>
    <I>Fri Dec  2 14:28:12 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="038309.html">[Mono-dev] Suggested fix for dropped SQL connection
</A></li>
        <LI>Next message: <A HREF="038311.html">[Mono-dev] Candidate Fix for 699643
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38310">[ date ]</a>
              <a href="thread.html#38310">[ thread ]</a>
              <a href="subject.html#38310">[ subject ]</a>
              <a href="author.html#38310">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been using SWIG for a while now, and never had any problems with Mono
2.6, but ever since I upgraded to Mono 2.10.6, all strings coming from C++
get completely corrupted. (using Windows/VC.NET here, with predistributed
binaries).

Tried to isolate between which versions the string handling broke, and it
seems to be working fine with Mono 2.8, but breaks with 2.10(.0).

How SWIG returns its strings is by a callback, to generate a System.String
from a char*:


And then through a P/Invoke function where a string is returned:


Which is bound through the following C# class:


Already done some debugging by adding System.Console.WriteLine(cString) in
the &quot;static string CreateString(string cString)&quot; function. This yields a
corrupt string (expected Test 1, got something like T&amp;e^s ). Replacing that
by a System.IntPtr and using Marshal.PtrToStringAnsi, does yield the
expected string in Mono 2.10, but then the ultimate string given back
through P/Invoke is still corrupt.

Also tried to remove the &quot;jresult = SWIG_csharp_string_callback((const char
*)result);&quot; part, and just return the char* string directly; this gives a
similar corrupt string.

I have no idea what change from Mono 2.8 to Mono 2.10 triggered this
behavior; I've tried looking for clues in the changelog but nothing mentions
a major change to either the string class or delegate handling, so I'm
totally lost on how to fix something like this..

Any clues?

Kind regards,
L Sikkes

--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/SWIG-Corrupt-Strings-Delegate-System-String-inner-working-changed-from-mono-2-8-to-mono-2-10-tp4148689p4148689.html">http://mono.1490590.n4.nabble.com/SWIG-Corrupt-Strings-Delegate-System-String-inner-working-changed-from-mono-2-8-to-mono-2-10-tp4148689p4148689.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038309.html">[Mono-dev] Suggested fix for dropped SQL connection
</A></li>
	<LI>Next message: <A HREF="038311.html">[Mono-dev] Candidate Fix for 699643
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38310">[ date ]</a>
              <a href="thread.html#38310">[ thread ]</a>
              <a href="subject.html#38310">[ subject ]</a>
              <a href="author.html#38310">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
