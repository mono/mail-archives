<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for Mono.SqliteClient.SqliteDataReader REVIEW	NEEDED
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20Mono.SqliteClient.SqliteDataReader%20REVIEW%0A%09NEEDED&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026387.html">
   <LINK REL="Next"  HREF="026369.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for Mono.SqliteClient.SqliteDataReader REVIEW	NEEDED</H1>
    <B>Scott Peterson</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20Mono.SqliteClient.SqliteDataReader%20REVIEW%0A%09NEEDED&In-Reply-To="
       TITLE="[Mono-dev] Patch for Mono.SqliteClient.SqliteDataReader REVIEW	NEEDED">lunchtimemama at gmail.com
       </A><BR>
    <I>Sat Dec 29 04:45:41 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="026387.html">[Mono-dev] mono xml
</A></li>
        <LI>Next message: <A HREF="026369.html">[Mono-dev] Patch for Mono.SqliteClient.SqliteDataReader REVIEW	NEEDED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26365">[ date ]</a>
              <a href="thread.html#26365">[ thread ]</a>
              <a href="subject.html#26365">[ subject ]</a>
              <a href="author.html#26365">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm about to look at fixing this:
<A HREF="http://codicesoftware.blogspot.com/2007/11/c-mono-performance.html.">http://codicesoftware.blogspot.com/2007/11/c-mono-performance.html.</A> I'm
acquainting myself with the relevant files and this is an optimization I
noticed off the bat. If someone could just make sure this is A-O.K., I'll go
ahead and commit it. Next, if anyone who's familiar with the database
binding code could brief me on all of the places IDataRecord and IDataReader
are implemented, that would be great.


Index:
class/Mono.Data.SqliteClient/Mono.Data.SqliteClient/SqliteDataReader.cs
===================================================================
---
class/Mono.Data.SqliteClient/Mono.Data.SqliteClient/SqliteDataReader.cs
(revision 92007)
+++
class/Mono.Data.SqliteClient/Mono.Data.SqliteClient/SqliteDataReader.cs
(working copy)
@@ -65,14 +65,7 @@
         internal SqliteDataReader (SqliteCommand cmd, IntPtr pVm, int
version)
         {
             command = cmd;
-            rows = new ArrayList ();
-            column_names_sens = new Hashtable ();
-#if NET_2_0
-            column_names_insens = new Hashtable (
StringComparer.InvariantCulture);
-#else
-            column_names_insens = new Hashtable (
CaseInsensitiveHashCodeProvider.DefaultInvariant,
-                                 CaseInsensitiveComparer.DefaultInvariant);
-#endif
+
             closed = false;
             current_row = -1;
             reading = true;
@@ -147,6 +140,16 @@
                 // For the first row, get the column information
                 if (first) {
                     first = false;
+
+                    rows = new ArrayList (pN);
+                    column_names_sens = new Hashtable (pN);
+#if NET_2_0
+                    column_names_insens = new Hashtable (pN,
StringComparer.InvariantCulture);
+#else
+                    column_names_insens = new Hashtable (pN,
+
CaseInsensitiveHashCodeProvider.DefaultInvariant,
+
CaseInsensitiveComparer.DefaultInvariant);
+#endif

                     if (version == 3) {
                         // A decltype might be null if the type is unknown
to sqlite.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071229/eb7555b9/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071229/eb7555b9/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026387.html">[Mono-dev] mono xml
</A></li>
	<LI>Next message: <A HREF="026369.html">[Mono-dev] Patch for Mono.SqliteClient.SqliteDataReader REVIEW	NEEDED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26365">[ date ]</a>
              <a href="thread.html#26365">[ thread ]</a>
              <a href="subject.html#26365">[ subject ]</a>
              <a href="author.html#26365">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
