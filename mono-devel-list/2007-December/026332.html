<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Web Services Under Linux/OSX
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Web%20Services%20Under%20Linux/OSX&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026358.html">
   <LINK REL="Next"  HREF="026333.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Web Services Under Linux/OSX</H1>
    <B>Gavin Landon</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Web%20Services%20Under%20Linux/OSX&In-Reply-To="
       TITLE="[Mono-dev] Web Services Under Linux/OSX">Gavin.Landon at ignitetech.com
       </A><BR>
    <I>Wed Dec 26 11:21:14 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="026358.html">[Mono-dev] [Mono-docs-list]  Can not checkout trunk on windows
</A></li>
        <LI>Next message: <A HREF="026333.html">[Mono-dev] Interprocess communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26332">[ date ]</a>
              <a href="thread.html#26332">[ thread ]</a>
              <a href="subject.html#26332">[ subject ]</a>
              <a href="author.html#26332">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Using:
	Mono 1.2.6
	SharpDev 2.2.1 2648
	Mono References Only

I've created a very simple web server demo below, which works under
Windows, but will not launch under Linux/OSX.   This is a console app,
to make things simple, running as a web server.   I added a writelog to
the very first line of Main() which is never written as if the EXE will
not even attempt to start on Linux/OSX.  Anyone have any ideas why?   I
have other applications in Mono 1.2.6 running on the same Linux/OSX
machines without any issues.

/*
 * Created by SharpDevelop.
 * User: gavin.landon
 * Date: 12/26/2007
 * Time: 9:43 AM
 * 
 * To change this template use Tools | Options | Coding | Edit Standard
Headers.
 */
using System;
using System.IO;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;

namespace WebTest
{
	class Program
	{
		static private TcpListener myListener;

        static bool WriteLog(string szBuffer, string szFileName, bool
bAppend)
        {
            try
            {
                szBuffer = DateTime.Now.ToString() + &quot; - &quot; + szBuffer;
                szBuffer = szBuffer + &quot;\n&quot;;

                if (!File.Exists(szFileName))
                {
                    // Create the file.
                    using (FileStream fs = File.Create(szFileName))
                    {
                        Byte[] info = new
UTF8Encoding(true).GetBytes(szBuffer);
                        fs.Write(info, 0, info.Length);

                        return true;
                    }
                }
                else
                {
                    if (bAppend)
                        File.AppendAllText(szFileName, szBuffer);
                    else
                        File.WriteAllText(szFileName, szBuffer);

                    return true;
                }
            }
            catch (Exception e)
            {
            	Console.WriteLine(&quot;An Exception Occurred while Listening
:<i> {0}&quot;, e);
</I>                return false;
            }
        } //end WriteLog
        
		static public void Main(string[] args)
		{
			WriteLog(&quot;Entered Main()&quot;, &quot;info.log&quot;, true);
			try
			{
				//start listing on the given port
				myListener = new
TcpListener(IPAddress.Any, 5000);
				myListener.Start();
				Console.WriteLine(&quot;Web Server Running...
Press ^C to Stop...&quot;);
				//start the thread which calls the
method 'StartListen'
				Thread th = new Thread(new
ThreadStart(StartListen));
				th.Start();

			}
			catch (Exception e)
			{
				WriteLog(e.ToString(), &quot;error.log&quot;,
true);
				Console.WriteLine(&quot;An Exception Occurred
while Listening : {0}&quot;, e);
			}
		}
		
		static void StartListen()
		{
			while (true)
            {
				//Accept a new connection
				Socket mySocket =
myListener.AcceptSocket();
				Console.WriteLine(&quot;Socket Type &quot; +
mySocket.SocketType);
				if (mySocket.Connected)
				{
					Console.WriteLine(&quot;\nAt {1}
Client IP {0} Connected.\n&quot;,
	
mySocket.RemoteEndPoint, System.DateTime.Now);
					//make a byte array and receive
data from the client
					Byte[] bReceive = new
Byte[1024];
					int i =
mySocket.Receive(bReceive, bReceive.Length, 0);
	
					//Convert Byte to String
					string sBuffer =
Encoding.ASCII.GetString(bReceive);
	
					Console.WriteLine(&quot;\nBuffer =
{0}\n&quot;, sBuffer);
					
					
					string sResponse = &quot;Data
Received&quot;;
					int iTotBytes =
sResponse.Length;
					byte[] writebytes = new
byte[iTotBytes];
					writebytes =
Encoding.ASCII.GetBytes(sResponse);
					
					SendHeader(&quot;HTTP/1.1&quot;,
&quot;text/html&quot;, iTotBytes, &quot; 200 OK&quot;, ref mySocket);
					SendToBrowser(writebytes, ref
mySocket);
					mySocket.Close();
				}
			}
		}
		
		static void SendHeader(string sHttpVersion, string
sMIMEHeader, int iTotBytes, string sStatusCode, ref Socket mySocket)
		{

			string sBuffer = &quot;&quot;;

			// if Mime type is not provided set default to
text/html
			if (sMIMEHeader.Length == 0)
				sMIMEHeader = &quot;text/html&quot;;  // Default
Mime Type is text/html

			sBuffer = sBuffer + sHttpVersion + sStatusCode +
&quot;\r\n&quot;;
			sBuffer = sBuffer + &quot;Server: &quot; +
Environment.MachineName + &quot;\r\n&quot;;
			sBuffer = sBuffer + &quot;Content-Type: &quot; +
sMIMEHeader + &quot;\r\n&quot;;
			sBuffer = sBuffer + &quot;Accept-Ranges: bytes\r\n&quot;;
			sBuffer = sBuffer + &quot;Content-Length: &quot; +
iTotBytes + &quot;\r\n\r\n&quot;;

			Byte[] bSendData =
Encoding.ASCII.GetBytes(sBuffer);
			SendToBrowser(bSendData, ref mySocket);
		}
		
		static void SendToBrowser(string sData, ref Socket
mySocket)
		{
			SendToBrowser(Encoding.ASCII.GetBytes(sData),
ref mySocket);
		}

		static void SendToBrowser(Byte[] bSendData, ref Socket
mySocket)
		{
			int numBytes = 0;

			try
			{
				if (mySocket.Connected)
				{
					if ((numBytes =
mySocket.Send(bSendData, bSendData.Length, 0)) == -1)
	
Console.WriteLine(&quot;Socket Error cannot Send Packet&quot;);
					else
						Console.WriteLine(&quot;No.
of bytes send {0}&quot;, numBytes);
				}
				else
					Console.WriteLine(&quot;Connection
Dropped....&quot;);
			}
			catch (Exception e)
			{
				Console.WriteLine(&quot;Error Occurred : {0}
&quot;, e);

			}
		}
	}
}

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026358.html">[Mono-dev] [Mono-docs-list]  Can not checkout trunk on windows
</A></li>
	<LI>Next message: <A HREF="026333.html">[Mono-dev] Interprocess communication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26332">[ date ]</a>
              <a href="thread.html#26332">[ thread ]</a>
              <a href="subject.html#26332">[ subject ]</a>
              <a href="author.html#26332">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
