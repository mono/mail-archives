<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Minor change to Array.cs CODE REVIEW NEEDED
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Minor%20change%20to%20Array.cs%20CODE%20REVIEW%20NEEDED&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026369.html">
   <LINK REL="Next"  HREF="026373.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Minor change to Array.cs CODE REVIEW NEEDED</H1>
    <B>Scott Peterson</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Minor%20change%20to%20Array.cs%20CODE%20REVIEW%20NEEDED&In-Reply-To="
       TITLE="[Mono-dev] Minor change to Array.cs CODE REVIEW NEEDED">lunchtimemama at gmail.com
       </A><BR>
    <I>Sat Dec 29 16:23:19 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="026369.html">[Mono-dev] Patch for Mono.SqliteClient.SqliteDataReader REVIEW	NEEDED
</A></li>
        <LI>Next message: <A HREF="026373.html">[Mono-dev] Minor change to Array.cs CODE REVIEW NEEDED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26370">[ date ]</a>
              <a href="thread.html#26370">[ thread ]</a>
              <a href="subject.html#26370">[ subject ]</a>
              <a href="author.html#26370">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a minor change to the quicksort algorithm in Array.cs. It eliminates
an unnecessary comparison in a while loop. This is safe because that
comparison is done at the start of the qsort method and at the end of every
iteration of the while loop. If someone can O.K. this, I'll commit it.


Index: class/corlib/System/Array.cs
===================================================================
--- class/corlib/System/Array.cs    (revision 92007)
+++ class/corlib/System/Array.cs    (working copy)
@@ -1490,7 +1490,7 @@
             int mid = low + ((high - low) / 2);
             object objPivot = keys.GetValueImpl (mid);

-            while (low &lt;= high) {
+            while (true) {
                 // Move the walls in
                 while (low &lt; high0 &amp;&amp; compare (keys.GetValueImpl (low),
objPivot, comparer) &lt; 0)
                     ++low;
@@ -1501,7 +1501,8 @@
                     swap (keys, items, low, high);
                     ++low;
                     --high;
-                }
+                } else
+                    break;
             }

             if (low0 &lt; high)
@@ -1690,7 +1691,7 @@
             int mid = low + ((high - low) / 2);
             K keyPivot = keys [mid];

-            while (low &lt;= high) {
+            while (true) {
                 // Move the walls in
                 //while (low &lt; high0 &amp;&amp; comparer.Compare (keys [low],
keyPivot) &lt; 0)
                 while (low &lt; high0 &amp;&amp; compare (keys [low], keyPivot,
comparer) &lt; 0)
@@ -1703,7 +1704,8 @@
                     swap&lt;K, V&gt; (keys, items, low, high);
                     ++low;
                     --high;
-                }
+                } else
+                    break;
             }

             if (low0 &lt; high)
@@ -1741,7 +1743,7 @@
             int mid = low + ((high - low) / 2);
             T keyPivot = array [mid];

-            while (low &lt;= high) {
+            while (true) {
                 // Move the walls in
                 while (low &lt; high0 &amp;&amp; comparison (array [low], keyPivot) &lt;
0)
                     ++low;
@@ -1752,7 +1754,8 @@
                     swap&lt;T&gt; (array, low, high);
                     ++low;
                     --high;
-                }
+                } else
+                    break;
             }

             if (low0 &lt; high)

-- 
Scott.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071229/41bee505/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071229/41bee505/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Array.patch
Type: text/x-patch
Size: 1482 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071229/41bee505/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071229/41bee505/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026369.html">[Mono-dev] Patch for Mono.SqliteClient.SqliteDataReader REVIEW	NEEDED
</A></li>
	<LI>Next message: <A HREF="026373.html">[Mono-dev] Minor change to Array.cs CODE REVIEW NEEDED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26370">[ date ]</a>
              <a href="thread.html#26370">[ thread ]</a>
              <a href="subject.html#26370">[ subject ]</a>
              <a href="author.html#26370">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
