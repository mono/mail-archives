<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Generics sharing issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Generics%20sharing%20issues&In-Reply-To=711aea6b0712102125y448fc07fu659f52683570c73%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026030.html">
   <LINK REL="Next"  HREF="026021.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Generics sharing issues</H1>
    <B>Mark Probst</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Generics%20sharing%20issues&In-Reply-To=711aea6b0712102125y448fc07fu659f52683570c73%40mail.gmail.com"
       TITLE="[Mono-dev] Generics sharing issues">mark.probst at gmail.com
       </A><BR>
    <I>Tue Dec 11 04:13:14 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="026030.html">[Mono-dev] Generics sharing issues
</A></li>
        <LI>Next message: <A HREF="026021.html">[Mono-dev] DriveInfo reloaded!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26034">[ date ]</a>
              <a href="thread.html#26034">[ thread ]</a>
              <a href="subject.html#26034">[ subject ]</a>
              <a href="author.html#26034">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Kamil!

&gt;<i> Just to note - specification explicitly states that all instantiations
</I>&gt;<i> must be finite. The above code is invalid (though csc has a bug
</I>&gt;<i> allowing it to compile, it will still fail in runtime on MS.NET).
</I>&gt;<i> The exact description is in ECMA 355 Part II 9.2  Generics and
</I>&gt;<i> recursive inheritance graphs
</I>
Thanks for the info!  Unfortunately, it doesn't make our lives much
easier, i.e., it doesn't save us from implementing a check when
accessing at least some fields in the rgctx, because of the other
example:

class A&lt;T&gt; {
  public static int test (int n) {
    if (n &lt;= 1)
      return 123;
    else
      return A&lt;A&lt;T&gt;&gt;.test (n - 1);
  }
}

This example successfully runs in the MS runtime with values for n of
up to 100.  101 fails.  That means they're either instantiating the
nested generic class lazily and just do a nesting depth check when
creating a new instantiation, or they're instantiating eagerly but
have a marker for those cases where instantiation failed (because the
nesting depth limit was reached).  In either case a check at method
run-time is necessary.

Something I forgot: We also discussed doing the check via the MMU,
i.e. putting NULL in the not-yet-instantiated fields and just deref
the field as a check.  In the NULL case we'll get a SEGV and the
handler can reconstruct what happened.  Hairy to implement but almost
cost-free at run-time.

&gt;<i> This probably does not help solving the problem, since runtime has no
</I>&gt;<i> way to easily detect the wrong cycles - the algorithm described in
</I>&gt;<i> spec seems a bit costy.
</I>
Actually it's a pretty cheap algorithm, but the MS runtime doesn't
seem to use it.  They just instantiate types until they hit the
nesting depth of 100, at which point they throw an exception.

Mark

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026030.html">[Mono-dev] Generics sharing issues
</A></li>
	<LI>Next message: <A HREF="026021.html">[Mono-dev] DriveInfo reloaded!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26034">[ date ]</a>
              <a href="thread.html#26034">[ thread ]</a>
              <a href="subject.html#26034">[ subject ]</a>
              <a href="author.html#26034">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
