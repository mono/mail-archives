<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] DriveInfo implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DriveInfo%20implementation&In-Reply-To=bda1cfca0712060533r79a4307bqd85ab695ceedd35c%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025974.html">
   <LINK REL="Next"  HREF="025977.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] DriveInfo implementation</H1>
    <B>Javier Mart&#237;n</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DriveInfo%20implementation&In-Reply-To=bda1cfca0712060533r79a4307bqd85ab695ceedd35c%40mail.gmail.com"
       TITLE="[Mono-dev] DriveInfo implementation">lordhabbit at gmail.com
       </A><BR>
    <I>Thu Dec  6 09:30:40 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025974.html">[Mono-dev] DriveInfo implementation
</A></li>
        <LI>Next message: <A HREF="025977.html">[Mono-dev] DriveInfo implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25975">[ date ]</a>
              <a href="thread.html#25975">[ thread ]</a>
              <a href="subject.html#25975">[ subject ]</a>
              <a href="author.html#25975">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Robert Jordan wrote:
&gt;<i>Hi Javier,
</I>&gt;<i>
</I>&gt;<i>The PLATFORM_WIN32 conditional in icall.c must be avoided.
</I>&gt;<i>Since you're going to implement GetDiskFreeSpaceEx in io-layer
</I>&gt;<i>it will be not necessary. But I guess you already know this
</I>&gt;<i>and tried to keep the code compilable, correct?
</I>
Er, no. At the time I wrote that code I was in doubt. I didn't know if
I would take the Win32+iolayer way (which seems the most probable now)
or the ifdef+posix way (which is used in other icalls like the ones
from System.Environment). The first way seems cleaner at first, but
the second avoids double marshaling of strings (first to utf16 at the
icall for the win32 API, then to utf8 at io-layer for the POSIX call).
Also, as you said, I wanted my patch to keep the SVN tree compilable
on all supported platforms. So, when I get to the posix port, I will
either remove that #ifdef or fill the #else case.

&gt;<i>Also, do not use g_assert if you already thrown an exception.
</I>&gt;<i>This will kill the runtime.
</I>
Ok, so I'm leaving the checks code as exceptions, not as assertions.
By the way, does the unmanaged method return immediately when an
exception is raised or does it need to actually execute a &quot;return&quot;?

&gt;<i>On DriveInfo.diff: we all know about the
</I>&gt;<i>&quot;if (platform == 4 || platform == 128)&quot; trick. There is no
</I>&gt;<i>need to comment it like this :-)
</I>&gt;<i>
</I>&gt;<i>Since you're in corlib, you should use the internal property
</I>&gt;<i>Environment.IsRunningOnWindows anyways.
</I>
That was not my code, I only added the comment. Besides, I think that
particular check should be right since a newer .NET FW (3.5, I
believe) adds a PlatformID for the Xbox 360, and, in general, for
future compatibility, you should always check for what you want, not
for !everythingelse. IsRunningOnWindows was appropiate (and I used it)
in the modifications i made to the constructor.

Conclusion: since all the fuss is about two coments (one about
assertions in icall.c and one about the Unix PlatformID hack in
DriveInfo.cs), I'm too lazy to submit an updated patch just for that
u_u. I'll remove them (if noone does it first) when I submit the posix
port patch.

Habbit

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025974.html">[Mono-dev] DriveInfo implementation
</A></li>
	<LI>Next message: <A HREF="025977.html">[Mono-dev] DriveInfo implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25975">[ date ]</a>
              <a href="thread.html#25975">[ thread ]</a>
              <a href="subject.html#25975">[ subject ]</a>
              <a href="author.html#25975">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
