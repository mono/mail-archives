<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] ToString() performace in Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20ToString%28%29%20performace%20in%20Mono&In-Reply-To=ACF298F2AB3247FAA02E247E1860EAF4%40ansirua">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026086.html">
   <LINK REL="Next"  HREF="026087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] ToString() performace in Mono</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20ToString%28%29%20performace%20in%20Mono&In-Reply-To=ACF298F2AB3247FAA02E247E1860EAF4%40ansirua"
       TITLE="[Mono-dev] ToString() performace in Mono">atsushi at ximian.com
       </A><BR>
    <I>Thu Dec 13 11:16:33 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="026086.html">[Mono-dev] [PATCH] New shutdown code
</A></li>
        <LI>Next message: <A HREF="026087.html">[Mono-dev] MoMA: Changes in 1.2.6 Version
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26081">[ date ]</a>
              <a href="thread.html#26081">[ thread ]</a>
              <a href="subject.html#26081">[ subject ]</a>
              <a href="author.html#26081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

What is the status for the patch (&quot;the patch&quot; I mean, from Kazuki) ?

I'm not sure what Andreas is trying to change (a patch would be
more persuasive) but my understanding is that it does not conflict
with the patch.

If no objection, I'll test the patch and check it in svn.

Atsushi Eno


Andreas Nahr wrote:
&gt;<i> The following code (add to NumberFormatter) and redirect the ToStrings
</I>&gt;<i> improves performance even more:
</I>&gt;<i> 
</I>&gt;<i> Old Formatter: 1266
</I>&gt;<i> New Formatter with negative number: 953
</I>&gt;<i> New Formatter with positive number: 750
</I>&gt;<i> 
</I>&gt;<i> Tested on Windows XP, Mono 1.2.5
</I>&gt;<i> 
</I>&gt;<i> 		internal static string FormatInteger (ref NumberStore ns)
</I>&gt;<i> 		{
</I>&gt;<i> 			// Add one additional char for default sign, one for
</I>&gt;<i> potential 0-padding
</I>&gt;<i> 			StringBuilder cb = new StringBuilder
</I>&gt;<i> (ns.IntegerDigits + 2);
</I>&gt;<i> 
</I>&gt;<i> 			if (!ns.Positive &amp;&amp; !ns.CheckZeroOnlyInteger ())
</I>&gt;<i> 				cb.Append
</I>&gt;<i> (NumberFormatInfo.CurrentInfo.NegativeSign);
</I>&gt;<i> 
</I>&gt;<i> 			ns.AppendIntegerString (ns.IntegerDigits &gt; 0 ?
</I>&gt;<i> ns.IntegerDigits : 1, cb);
</I>&gt;<i> 			return cb.ToString ();
</I>&gt;<i> 		}
</I>&gt;<i> 
</I>&gt;<i> The additional performance in Comparison to Kazuki Oikawa suggestion is
</I>&gt;<i> mainly gained through not retrieving NumberFormatInfo.CurrentInfo in cases
</I>&gt;<i> where it's not needed (and other small things like ref struct).
</I>&gt;<i> NumberFormatInfo.CurrentInfo should be optimized anyways. It just shouldn't
</I>&gt;<i> be as slow as it is as it is likely used in other situations, too.
</I>&gt;<i> 
</I>&gt;<i> Greetings
</I>&gt;<i> Andreas
</I>&gt;<i> 
</I>&gt;<i> -----Urspr&#252;ngliche Nachricht-----
</I>&gt;<i> Von: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] Im Auftrag von Kazuki
</I>&gt;<i> Oikawa
</I>&gt;<i> Gesendet: Samstag, 24. November 2007 06:02
</I>&gt;<i> An: pablosantosluac
</I>&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Betreff: Re: [Mono-dev] ToString() performace in Mono
</I>&gt;<i> 
</I>&gt;<i> Hi.
</I>&gt;<i> 
</I>&gt;<i> This patch improves ToString performance (30% faster).
</I>&gt;<i> 
</I>&gt;<i> Running on Opteron 270 (2GHz), Gentoo Linux 2007.0 x86_64 $ mono hoge.exe
</I>&gt;<i> val is 5999999 and time 7008 (before) $ mono hoge.exe val is 5999999 and
</I>&gt;<i> time 5078 (after)
</I>&gt;<i> 
</I>&gt;<i> Current code is use &quot;G&quot; format but this equals &quot;D&quot; format when precision is
</I>&gt;<i> not defined and value is integer.
</I>&gt;<i> 
</I>&gt;<i> Best regards.
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Kazuki Oikawa
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026086.html">[Mono-dev] [PATCH] New shutdown code
</A></li>
	<LI>Next message: <A HREF="026087.html">[Mono-dev] MoMA: Changes in 1.2.6 Version
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26081">[ date ]</a>
              <a href="thread.html#26081">[ thread ]</a>
              <a href="subject.html#26081">[ subject ]</a>
              <a href="author.html#26081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
