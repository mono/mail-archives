<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] DriveInfo implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DriveInfo%20implementation&In-Reply-To=1196852673.4803.44.camel%40erandi.boston.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025951.html">
   <LINK REL="Next"  HREF="025955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] DriveInfo implementation</H1>
    <B>Javier Mart&#237;n</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20DriveInfo%20implementation&In-Reply-To=1196852673.4803.44.camel%40erandi.boston.ximian.com"
       TITLE="[Mono-dev] DriveInfo implementation">lordhabbit at gmail.com
       </A><BR>
    <I>Wed Dec  5 06:58:13 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025951.html">[Mono-dev] DriveInfo implementation
</A></li>
        <LI>Next message: <A HREF="025955.html">[Mono-dev] DriveInfo implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25953">[ date ]</a>
              <a href="thread.html#25953">[ thread ]</a>
              <a href="subject.html#25953">[ subject ]</a>
              <a href="author.html#25953">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi again,

&gt;<i> Hello Javier,
</I>&gt;<i> 
</I>&gt;<i> &gt; Another possible problem with my modifications is that they could
</I>&gt;<i> &gt; require building corlib.dll with a reference to Mono.Posix.dll. It's not
</I>&gt;<i> &gt; the fact that it can lead to chicken-and-egg problems, I'm sure Mono's
</I>&gt;<i> &gt; build systems can handle that, but the thing that bugs me is that, if
</I>&gt;<i> &gt; nothing else in corlib uses Mono.Posix apart from this new code, the
</I>&gt;<i> &gt; reference and everything using it should be inside an #if block so that
</I>&gt;<i> &gt; a corlib build for Windows does not uselessly (though harmlessly, I
</I>&gt;<i> &gt; hope) reference Mono.Posix.
</I>&gt;<i> 
</I>&gt;<i> Ah, but we should not be adding a dependency to Mono.Posix to mscorlib,
</I>&gt;<i> that is a no-go.
</I>&gt;<i> 
</I>&gt;<i> Robert Jordan's suggestion seems like the right one: this code should
</I>&gt;<i> likely be implemented in the io-layer.
</I>&gt;<i> 
</I>
So I thought: the platform differences can be accounted for with some C
support code, while the managed code can just do an internal call and
receive a nice structure with the right fields. However, it's a pity
that the code will need to cope with all the marshaling that Mono.Posix
automagically did...

By the way, I did that reboot and found out that MS's implementation
does tap into live data for every call to the drive space properties, so
I'd have had to change the implementation nevertheless.

Before starting, however, I'd like to gather opinions on how this should
be accomplished. From the look of the current io-layer code and Robert's
suggestions, I'd probably have to find a Win32 API that does the job,
then implement a *nix substitute for it with the same signature in
io-layer using whatever posix calls I feel like. This is not as clean as
I would have wanted it to be, but still good enough. The &quot;bad&quot; thing is
that I'd have to create a working Windows implementation first and only
then reimplement it through io-layer. The other way around is using
statvfs and then creating a substitute for it in io-layer. Not
impossible, but until now never done in mono AFAIK.

I'm currently split between two ways to do the trick with Win32 calls:
the first, easy way GetDiskFreeSpaceEx, which does 99% of the required
work. The only way it could go awry would be if space quotas are in
effect. The second, tough way is DeviceIoControl (ioctl for friends)
with IOCTL_DISK_GET_LENGTH_INFO as the argument. More complicated and
error-prone, but will always report total figures. What do you think,
people?


Habbit


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025951.html">[Mono-dev] DriveInfo implementation
</A></li>
	<LI>Next message: <A HREF="025955.html">[Mono-dev] DriveInfo implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25953">[ date ]</a>
              <a href="thread.html#25953">[ thread ]</a>
              <a href="subject.html#25953">[ subject ]</a>
              <a href="author.html#25953">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
