<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] inline_method doesn't clean loader erros
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20inline_method%20doesn%27t%20clean%20loader%20erros&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026411.html">
   <LINK REL="Next"  HREF="026416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] inline_method doesn't clean loader erros</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20inline_method%20doesn%27t%20clean%20loader%20erros&In-Reply-To="
       TITLE="[Mono-dev] inline_method doesn't clean loader erros">kumpera at gmail.com
       </A><BR>
    <I>Mon Dec 31 15:28:43 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="026411.html">[Mono-dev] [PATCH] assembly name fixes for AssemblyName and runtime
</A></li>
        <LI>Next message: <A HREF="026416.html">[Mono-dev] ANN: NUnit 2.4.6 Released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26414">[ date ]</a>
              <a href="thread.html#26414">[ thread ]</a>
              <a href="subject.html#26414">[ subject ]</a>
              <a href="author.html#26414">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

While testing my last commit to mono I found a quite odd situation. What
happens is that once a method been inlined
and it fails due to a loader error, this error won't be clean up and it
could cause unwanted errors in mono_method_to_ir if it call mono_class_init.

The test I added, test/invalid-token.il, can be used to reproduce this
situation. Uncommenting the lines in Main will trigger this error.
At first it will crash since BadImageFormatException is not expected as a
class loading error. The attached patch fixes that.
After applying it, the code will die with a BadImageFormatException been
reported for System.Console.

This happens because the inlining of InvalidMethodDef() fails but leaves a
pending loader error (the BadImageFormatException), which is later consumed
by mono_class_init
when it called later by mono_method_to_ir.

What I'm not sure here is which part of the code is responsible for
consuming the loader error. Anyone could give me some light on that subject?
As this requires some fixing.

Thanks,
Rodrigo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071231/2d7b284e/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071231/2d7b284e/attachment.html</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bad_img.diff
Type: text/x-patch
Size: 519 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071231/2d7b284e/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071231/2d7b284e/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026411.html">[Mono-dev] [PATCH] assembly name fixes for AssemblyName and runtime
</A></li>
	<LI>Next message: <A HREF="026416.html">[Mono-dev] ANN: NUnit 2.4.6 Released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26414">[ date ]</a>
              <a href="thread.html#26414">[ thread ]</a>
              <a href="subject.html#26414">[ subject ]</a>
              <a href="author.html#26414">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
