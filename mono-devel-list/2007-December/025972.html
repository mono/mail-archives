<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] runtime dbg library API proposal/impl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20runtime%20dbg%20library%20API%20proposal/impl&In-Reply-To=20071206105339.GV5889%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025970.html">
   <LINK REL="Next"  HREF="025961.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] runtime dbg library API proposal/impl</H1>
    <B>Martin Baulig</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20runtime%20dbg%20library%20API%20proposal/impl&In-Reply-To=20071206105339.GV5889%40debian.org"
       TITLE="[Mono-dev] runtime dbg library API proposal/impl">martin at ximian.com
       </A><BR>
    <I>Thu Dec  6 08:24:27 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025970.html">[Mono-dev] runtime dbg library API proposal/impl
</A></li>
        <LI>Next message: <A HREF="025961.html">[Mono-dev] [Mono-list] Memory leak with mod_mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25972">[ date ]</a>
              <a href="thread.html#25972">[ thread ]</a>
              <a href="subject.html#25972">[ subject ]</a>
              <a href="author.html#25972">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Thu, 2007-12-06 at 11:53 +0100, Paolo Molaro wrote:
&gt;<i> On 12/05/07 Martin Baulig wrote:
</I>&gt;<i> &gt; There is just one important thing to keep in mind:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; public TargetAddress MonoClassGetMonoImage (ITargetMemoryAccess memory,
</I>&gt;<i> &gt; &gt;                                             TargetAddress klass)
</I>&gt;<i> &gt; &gt;                 {
</I>&gt;<i> &gt; &gt;                         IntPtr image = mono_debugger_support_mono_class_get_image (
</I>&gt;<i> &gt; &gt;                                 memory.ReadMemory, klass.Address);
</I>&gt;<i> &gt; &gt;                         return new TargetAddress (image);
</I>&gt;<i> &gt; &gt;                 }
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; You have to use the `memory' instance to read memory (we may add other
</I>&gt;<i> &gt; methods to it if necessary) - but you do not &quot;own&quot; it.  It is absolutely
</I>&gt;<i> &gt; forbidden to store this anywhere or use it after the method returned
</I>&gt;<i> &gt; control back to the debugger.
</I>&gt;<i> 
</I>&gt;<i> Can you elaborate why you have this requirement?
</I>
That's a little bit incorrect:

&gt;<i> When you're debugging a target process it's either alive and you can use
</I>&gt;<i> ptrace or access /proc/pid/mem or it's dead and you access the core
</I>&gt;<i> file: why would you want to switch to one mechanism or the other on the
</I>&gt;<i> fly?
</I>
Correct is:

&quot;When you're debugging a target process it's either alive _and stopped_
and you can use ... or it's dead and you access the file, or it's
running and you can't do any of these.&quot;

That's the reason why you're not allowed to store the `memory' instance
anywhere: the corresponding thread is guaranteed to be stopped at the
time of the call, but it may be resumed by the debugger immediately
after returning from the call.

Also, ptrace() operates on threads, not processes.

I saw that you tried to use ptrace() on the process id or
access /proc/&lt;process-id&gt;/mem - this is wrong since the process id is in
fact just a thread for the linux kernel - so you would always read from
the main thread, and there is no guarantee that it will be stopped.

Instead, the debugger needs to give your API some kind of
`target access' / `thread' pointer and only this single thread is
guaranteed to be stopped at the point of the call.

-- 
Martin Baulig - <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">martin at novell.com</A>
Novell GmbH, D&#252;sseldorf
GF: Volker Smid, Djamel Souici; HRB 21108 (AG D&#252;sseldorf)



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025970.html">[Mono-dev] runtime dbg library API proposal/impl
</A></li>
	<LI>Next message: <A HREF="025961.html">[Mono-dev] [Mono-list] Memory leak with mod_mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25972">[ date ]</a>
              <a href="thread.html#25972">[ thread ]</a>
              <a href="subject.html#25972">[ subject ]</a>
              <a href="author.html#25972">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
