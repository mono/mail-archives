<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Static fields initialization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Static%20fields%20initialization&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008679.html">
   <LINK REL="Next"  HREF="008684.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Static fields initialization</H1>
    <B>mono at evain.net</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Static%20fields%20initialization&In-Reply-To="
       TITLE="[Mono-devel-list] Static fields initialization">mono at evain.net
       </A><BR>
    <I>Thu Nov  4 14:48:23 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008679.html">[Mono-devel-list] MONO_PATH versus GAC problem in DLLImport resolution was keeping me from running GTK# apps in mono
</A></li>
        <LI>Next message: <A HREF="008684.html">[Mono-devel-list] Static fields initialization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8683">[ date ]</a>
              <a href="thread.html#8683">[ thread ]</a>
              <a href="subject.html#8683">[ subject ]</a>
              <a href="author.html#8683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, 

The Mono runtime and the MS CLR does not behave in the same way for static 
fields initialization. Here is a simple example : 

.assembly extern mscorlib {} 

.assembly test {} 

.module test.exe 

.class public EntryPoint extends [mscorlib]System.Object { 

  .field public static int32 m_test = int32(2) 

  .method public static void Main() cil managed {
      .entrypoint
      ldsfld int32 EntryPoint::m_test
      box [mscorlib]System.Int32
      call void [mscorlib]System.Console::WriteLine(object)
      ret
  }
} 


Using Mono runtime, the output is 2, but with MS, it is 0.
If I found that Mono's behaviour is much more logical, here is a quote from 
the ECMA CLI Standard (line 14, page 85): 

&quot;The &lt;fieldInit&gt; information is stored in metadata and this information can 
be queried from metadata.  But the CLI does not use this information to 
automatically initialize the corresponding fields.&quot; 

And here is a quote from Inside MS.NET IL Assembler : 

&quot;What will the value of the field be when the class is loaded? Correct 
answer: 0. Why? Because default values specified in the Constant table are 
not used by the loader to initialize the items to which they are assigned. 
If we want to initialize a field to its default value, we must explicitly 
call the respective Reflection method to retrieve the value from metadata 
and then store this value in the field. This doesn't sound too nice, but, on 
the other hand, we should not forget that these are default values rather 
than initial values, so formally the loader might be right.&quot; 

I've already told that I do prefer Mono's behaviour here, but I would like 
to have some guru's opinions about this. 

Thanks, 

Jean-Baptiste Evain

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008679.html">[Mono-devel-list] MONO_PATH versus GAC problem in DLLImport resolution was keeping me from running GTK# apps in mono
</A></li>
	<LI>Next message: <A HREF="008684.html">[Mono-devel-list] Static fields initialization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8683">[ date ]</a>
              <a href="thread.html#8683">[ thread ]</a>
              <a href="subject.html#8683">[ subject ]</a>
              <a href="author.html#8683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
