<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Patch for full-featured mcs /doc support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20for%20full-featured%20mcs%20/doc%20support&In-Reply-To=41A4D7A0.7070505%40seznam.cz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009053.html">
   <LINK REL="Next"  HREF="009068.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Patch for full-featured mcs /doc support</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20for%20full-featured%20mcs%20/doc%20support&In-Reply-To=41A4D7A0.7070505%40seznam.cz"
       TITLE="[Mono-devel-list] Patch for full-featured mcs /doc support">atsushi at ximian.com
       </A><BR>
    <I>Fri Nov 26 03:24:36 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009053.html">[Mono-devel-list] Patch for full-featured mcs /doc support
</A></li>
        <LI>Next message: <A HREF="009068.html">[Mono-devel-list] Patch for full-featured mcs /doc support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9067">[ date ]</a>
              <a href="thread.html#9067">[ thread ]</a>
              <a href="subject.html#9067">[ subject ]</a>
              <a href="author.html#9067">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Thanks for several checks!

&gt;<i> + public string consume_doc_comment ()
</I>&gt;<i> + {
</I>&gt;<i> + if (xml_comment_buffer.Length &gt; 0) {
</I>&gt;<i> + string ret = null;
</I>&gt;<i> + if (xmlCommentSavePoint &gt; 0) {
</I>&gt;<i> + ret = xml_comment_buffer.ToString (0, xmlCommentSavePoint);
</I>&gt;<i> + xml_comment_buffer.Remove (0, xmlCommentSavePoint);
</I>&gt;<i> + } else {
</I>&gt;<i> + ret = xml_comment_buffer.ToString ();
</I>&gt;<i> + xml_comment_buffer.Length = 0;
</I>&gt;<i> + }
</I>&gt;<i> + xmlCommentSavePoint = 0;
</I>&gt;<i> + return ret;
</I>&gt;<i> + }
</I>&gt;<i> + else
</I>&gt;<i> + return null;
</I>&gt;<i> + }
</I>&gt;<i> 
</I>&gt;<i> The last else is useless and xmlCommentSavePoint = 0 should be only for
</I>&gt;<i> xmlCommentSavePoint &gt; 0.
</I>
Ok. Actually I noticed that push_xml_comment() is not required anymore
(since I implemented invalid comment state transition), I just removed
it as well as xmlCommentSavePoint which is also not required anymore.

&gt;<i> + public enum XmlCommentState {
</I>&gt;<i> + OK,
</I>&gt;<i> + NG,
</I>&gt;<i> + Error
</I>&gt;<i> + }
</I>&gt;<i> 
</I>&gt;<i> What is NG ?
</I>
OK, I found that NG is kind of Japanglish ;-) so just renamed
OK as Allowed and NG as NotAllowed.

&gt;<i> + MemberInfo mi = FindDocumentedMember (type, memberName,
</I>&gt;<i> parameterTypes, ds, out warnResult);
</I>&gt;<i> + switch (warnResult) {
</I>&gt;<i> + case 1581:
</I>&gt;<i> + Report.Warning (1581, 1, Location, &quot;Invalid return type in XML comment
</I>&gt;<i> cref attribute '{0}'&quot;, cref);
</I>&gt;<i> + return;
</I>&gt;<i> + case 1584:
</I>&gt;<i> + Report.Warning (1020, 1, Location, &quot;Overloadable {0} operator is
</I>&gt;<i> expected&quot;, parameterTypes.Length == 2 ? &quot;binary&quot; : &quot;unary&quot;);
</I>&gt;<i> + Report.Warning (1584, 1, Location, &quot;XML comment on '{0}' has
</I>&gt;<i> syntactically incorrect attribute '{1}'&quot;, GetSignatureForError (), cref);
</I>&gt;<i> + return;
</I>&gt;<i> + }
</I>&gt;<i> 
</I>&gt;<i> Why don't do it inside FindDocumentMember to avoid copy&amp;paste.
</I>
Fixed.

&gt;<i> - : IDENTIFIER
</I>&gt;<i> + : IDENTIFIER
</I>&gt;<i> + {
</I>&gt;<i> + tmpComment = Lexer.consume_doc_comment ();
</I>&gt;<i> + Lexer.doc_state = XmlCommentState.OK;
</I>&gt;<i> + }
</I>&gt;<i> OPEN_PARENS opt_formal_parameter_list CLOSE_PARENS
</I>&gt;<i> {
</I>&gt;<i> oob_stack.Push (lexer.Location);
</I>&gt;<i> 
</I>&gt;<i> - current_local_parameters = (Parameters) $3;
</I>&gt;<i> + current_local_parameters = (Parameters) $4;
</I>&gt;<i> }
</I>&gt;<i> opt_constructor_initializer
</I>&gt;<i> {
</I>&gt;<i> Location l = (Location) oob_stack.Pop ();
</I>&gt;<i> - $$ = new Constructor (current_class, (string) $1, 0, (Parameters) $3,
</I>&gt;<i> - (ConstructorInitializer) $6, l);
</I>&gt;<i> + $$ = new Constructor (current_class, (string) $1, 0, (Parameters) $4,
</I>&gt;<i> + (ConstructorInitializer) $7, l);
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> I am confuse, what has been changed.
</I>
I cannot understand what you mean. It should not be regarded as
confusion, since it must happen whenever any of you guys have to
insert logic between tokens.

&gt;<i> + } catch (NotImplementedException ex) {
</I>&gt;<i> + Report.Error (1569, &quot;Error generating XML documentation file '{0}'
</I>&gt;<i> ('{1}')&quot;, xml_documentation_file, ex.Message);
</I>&gt;<i> + return false;
</I>&gt;<i> 
</I>&gt;<i> Does make a sense to catch this exception ?
</I>
Oops, it should just be Exception (to catch xml-output errors).

&gt;<i> + vd.DocComment = ConsumeStoredComment ();
</I>&gt;<i> + Lexer.doc_state = XmlCommentState.OK;
</I>&gt;<i> 
</I>&gt;<i> Why don't call this tricky property in ConsumeStroredComment I found
</I>&gt;<i> only one place where this combination is missing (bug ??). Should be
</I>&gt;<i> possible also to rename this property ?
</I>
Made as such.

&gt;<i> BTW: I think we should call this call only for /doc option.
</I>
Ok, now everything in .jay checks RootContext.NeedDocument.

I've attached the latest diff in mcs/mcs and mcs/tests, and added
new tests in mcs/errors (cs1587-*.cs). It still needs some love
on the files in tests (test-harness is not working properly; am
asking Hari about that).

Atsushi Eno

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: mcs-doc-20041126.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cs1587-26.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0001.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0001.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cs1587-27.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0002.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0002.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cs1587-28.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0003.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0003.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: mcs-doc-tests-20041126.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0004.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20041126/174e7899/attachment-0004.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009053.html">[Mono-devel-list] Patch for full-featured mcs /doc support
</A></li>
	<LI>Next message: <A HREF="009068.html">[Mono-devel-list] Patch for full-featured mcs /doc support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9067">[ date ]</a>
              <a href="thread.html#9067">[ thread ]</a>
              <a href="subject.html#9067">[ subject ]</a>
              <a href="author.html#9067">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
