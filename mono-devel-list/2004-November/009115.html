<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Move%20of%20Interlocked.Increment/Decrement/Exchange%20I4%20to%20op%20codes&In-Reply-To=1101730781.5624.53.camel%40omega.maurer">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009109.html">
   <LINK REL="Next"  HREF="009014.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Move%20of%20Interlocked.Increment/Decrement/Exchange%20I4%20to%20op%20codes&In-Reply-To=1101730781.5624.53.camel%40omega.maurer"
       TITLE="[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes">lupus at ximian.com
       </A><BR>
    <I>Mon Nov 29 09:38:47 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009109.html">[Mono-devel-list] [PATCH] Move of	Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
        <LI>Next message: <A HREF="009014.html">[Mono-devel-list] monodoc and gtkhtml-sharp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9115">[ date ]</a>
              <a href="thread.html#9115">[ thread ]</a>
              <a href="subject.html#9115">[ subject ]</a>
              <a href="author.html#9115">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/29/04 Ben Maurer wrote:
&gt;<i> &gt; Of course we should remember to change the aot format every time we change
</I>&gt;<i> &gt; the internal data structures used in the code, or we should add to the file
</I>&gt;<i> &gt; a description of all the dependencies. For example, we embed in
</I>&gt;<i> &gt; the code the offsets of many fields in some runtime structures.
</I>&gt;<i> &gt; To make the representation compact we could take the md5sum of all the 
</I>&gt;<i> &gt; needed data and store that.
</I>&gt;<i> 
</I>&gt;<i> I think there is an easier way to do this. We need to make sure the GUID
</I>&gt;<i> of all the assemblies we depend on has not changed. Why? Field offsets
</I>
Sigh, this is already done since like, one or two years.

&gt;<i> could have changed, also, with inlining we might have inlined a method
</I>&gt;<i> that has changed.
</I>&gt;<i> 
</I>&gt;<i> With our current system, every time you do a build, mscorlib.dll is
</I>&gt;<i> built, and thus has a different GUID. This will invalidate every aot'd
</I>&gt;<i> assembly. So no need to look at the runtime really, as the corlib change
</I>&gt;<i> will invalidate it for us.
</I>
No, you don't understand the issue.
Run
	grep G_STRUCT_OFFSET mini/*.c
for some examples of the problem. The emitted code has many dependencies
on the runtime internals and those need to be tracked somehow. This has
nothing to do with changes to corlib, which are already handled.
The offsets of course are only part of the issue, there are many other
dependencies on algorithms etc.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009109.html">[Mono-devel-list] [PATCH] Move of	Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
	<LI>Next message: <A HREF="009014.html">[Mono-devel-list] monodoc and gtkhtml-sharp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9115">[ date ]</a>
              <a href="thread.html#9115">[ thread ]</a>
              <a href="subject.html#9115">[ subject ]</a>
              <a href="author.html#9115">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
