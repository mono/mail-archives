<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Move of	Interlocked.Increment/Decrement/Exchange I4 to op codes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Move%20of%0A%09Interlocked.Increment/Decrement/Exchange%20I4%20to%20op%20codes&In-Reply-To=20041129183156.GR2153%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009119.html">
   <LINK REL="Next"  HREF="009137.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Move of	Interlocked.Increment/Decrement/Exchange I4 to op codes</H1>
    <B>Ben Maurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Move%20of%0A%09Interlocked.Increment/Decrement/Exchange%20I4%20to%20op%20codes&In-Reply-To=20041129183156.GR2153%40debian.org"
       TITLE="[Mono-devel-list] [PATCH] Move of	Interlocked.Increment/Decrement/Exchange I4 to op codes">bmaurer at ximian.com
       </A><BR>
    <I>Mon Nov 29 16:54:07 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009119.html">[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
        <LI>Next message: <A HREF="009137.html">[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9120">[ date ]</a>
              <a href="thread.html#9120">[ thread ]</a>
              <a href="subject.html#9120">[ subject ]</a>
              <a href="author.html#9120">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2004-11-29 at 19:31 +0100, Paolo Molaro wrote:
&gt;<i> BTW: please don't send me _three_ copies of the same mail.
</I>&gt;<i> Just post to the list.
</I>Sorry about that. Hit the wrong button twice ;-)

&gt;<i> On 11/29/04 Ben Maurer wrote:
</I>&gt;<i> &gt; &gt; for some examples of the problem. The emitted code has many
</I>&gt;<i> &gt; &gt; dependencies on the runtime internals and those need to be tracked
</I>&gt;<i> &gt; &gt; somehow. This has nothing to do with changes to corlib, which are
</I>&gt;<i> &gt; &gt; already handled. The offsets of course are only part of the issue,
</I>&gt;<i> &gt; &gt; there are many other dependencies on algorithms etc.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Every time you make install, corlib will be built along with the
</I>&gt;<i> &gt; runtime, (even if the code was unchanged in corlib), so the aot will be
</I>&gt;<i> &gt; invalidated.
</I>&gt;<i> 
</I>&gt;<i> Luckily the build system is not retarded: it doesn't build anything on
</I>&gt;<i> make install. You'll also note, if you try, that corlib is not rebuilt
</I>&gt;<i> if, for example, mini is changed. So your assumption is wrong.
</I>Ah, someone changed that behavior. With make bootstrap it always did
that.

&gt;<i> The first is best handled with the existing MONO_AOT_FILE_VERSION,
</I>&gt;<i> augmented with the mono release version. 
</I>That would work. __DATE__ and __TIME__ would give us something that
would work without the release version (ie, for developers). (actually,
I guess this is a bit messy because the file that the macros are in
might not have changed. But am sure we can hack a clever way to deal
with that. In fact, it'd be nice to do that so we could display
svnversion in --version, but thats another issue)

&gt;<i> Note that this data
</I>&gt;<i> is built into the mono binary, so it can't never happen that
</I>&gt;<i> it's accidentally changed (like a corlib version which can
</I>&gt;<i> be different than the one compiled together with mono: which itself
</I>&gt;<i> is fine).
</I>You can't take the corlib from version 1.0.2 and use the runtime from
1.0.4. That would be buggy at best, and at worse could make a system
with a security hole. 

&gt;<i> Also, from a security standpoint, I prefer to add the info about the
</I>&gt;<i> embedded offsets and other automatically checked data, because it
</I>&gt;<i> reduces the chances there is a human error in increasing the aot 
</I>&gt;<i> version. Your solution would be a security nightmare.
</I>
For releases, using the version that automake gets should be fine. We
absolutely know that we won't forget to increment this (otherwise
packages would be fucked up). The developers could get __DATE__ and
__TIME__ to help them.

Not to mention, executing an untrusted .so aot file is a security hole
by any means. I can go in, use objdump, change a few lines of assembly,
reassemble. I might have to change the assembly so that the data was
valid.

The abi is more than a list of fields and offsets. The meaning of a
field can be changed without changing its name. There are also many
other changes that could be made (for example, sorting instance fields
so that we avoid holes) which would not change this ABI. Rather than
relying on the developer to evaluate if old AOT files would work with
his new code, it is much safer to just clobber the AOT file with every
change.

IMHO, an AOT file is specific to:
      * The *exact* system it was generated on (processor model, number
        of processors, etc)
      * The mono runtime it was generated with
      * The dlls it was linked against

Taking the &quot;The mono runtime it was generated with&quot; and making it &quot;the
abi of the runtime it was generated with&quot; is much, much more error
prone.

-- Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009119.html">[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
	<LI>Next message: <A HREF="009137.html">[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9120">[ date ]</a>
              <a href="thread.html#9120">[ thread ]</a>
              <a href="subject.html#9120">[ subject ]</a>
              <a href="author.html#9120">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
