<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Move%20of%20Interlocked.Increment/Decrement/Exchange%20I4%20to%20op%20codes&In-Reply-To=899040034C23FB4B96DF7C936B2F7247CD1AA9%40swsmsx403.ger.corp.intel.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009006.html">
   <LINK REL="Next"  HREF="009011.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes</H1>
    <B>Ben Maurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Move%20of%20Interlocked.Increment/Decrement/Exchange%20I4%20to%20op%20codes&In-Reply-To=899040034C23FB4B96DF7C936B2F7247CD1AA9%40swsmsx403.ger.corp.intel.com"
       TITLE="[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes">bmaurer at ximian.com
       </A><BR>
    <I>Tue Nov 23 15:07:54 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="009006.html">[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
        <LI>Next message: <A HREF="009011.html">[Mono-devel-list] [PATCH] Move of  Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9009">[ date ]</a>
              <a href="thread.html#9009">[ thread ]</a>
              <a href="subject.html#9009">[ subject ]</a>
              <a href="author.html#9009">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> This patch moves the implementation of Interlocked functions for x86 to
</I>&gt;<i> op codes. The patch detects uniprocessor machines to allow skipping the
</I>&gt;<i> bus lock prefix (2,5 x speed difference).
</I>This is looking very nice.

&gt;<i> this patch; it should ignore the mp check when doing AOT, havn't had the
</I>&gt;<i> time to fix that in this patch (simple.. Just check for AOT in
</I>&gt;<i> detection)
</I>
No, I don't think so. AOT code should be considered to be specific to the
box it is generated on. For example, if we are on a p4, we can use cmov
and sse.

For `OP_ATOMIC_EXCHANGE_I4', I never understood why we can't use xchg
here. Is there any specific reason.

Also, if you want something in eax or another register, you should just
specify that in the regalloc spec, and not us push/pop.

I think that the inc/dec should use a common path OP_ATOMIC_ADD. In 2.0
there is Interlocked.Add, which adds any number. ALso, we should add
optimizations so that:

Interlocked.Increment (ref foo)

gets turned into

[lock; ] inc [foo]

rather than an xadd type thing.

-- Ben



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009006.html">[Mono-devel-list] [PATCH] Move of Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
	<LI>Next message: <A HREF="009011.html">[Mono-devel-list] [PATCH] Move of  Interlocked.Increment/Decrement/Exchange I4 to op codes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9009">[ date ]</a>
              <a href="thread.html#9009">[ thread ]</a>
              <a href="subject.html#9009">[ subject ]</a>
              <a href="author.html#9009">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
