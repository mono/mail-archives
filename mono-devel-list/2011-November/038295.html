<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Http Content Type Header Problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Http%20Content%20Type%20Header%20Problem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="038296.html">
   <LINK REL="Next"  HREF="038297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Http Content Type Header Problem</H1>
    <B>monoUser</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Http%20Content%20Type%20Header%20Problem&In-Reply-To="
       TITLE="[Mono-dev] Http Content Type Header Problem">cancomert at gmail.com
       </A><BR>
    <I>Tue Nov 22 11:23:17 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="038296.html">[Mono-dev] sgen gc &amp; ephemerons arrays bug
</A></li>
        <LI>Next message: <A HREF="038297.html">[Mono-dev] SqlDbType.Structured
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38295">[ date ]</a>
              <a href="thread.html#38295">[ thread ]</a>
              <a href="subject.html#38295">[ subject ]</a>
              <a href="author.html#38295">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'm trying to implement a WCF Web service in C#. I run the service under
Mono in a Linux system.
I'm creating a SelfHost host for my test cases.

I can test the service on both mono and .Net runtime with my own client
application written in C# and shares contract library without any problem.

But this service should be able to used by other clients also. So that I'm
testing the service by using SoapUi tool.

The problem is the when I send the following request I get an error about
the content type
but the content type itself seems exactly same except one space between
text/xml;(there is no space in soap ui request)charset=utf-8

POST <A HREF="http://soda5-update-test:100/Calculator/Service">http://soda5-update-test:100/Calculator/Service</A> HTTP/1.1
Content-Type: text/xml;charset=utf-8      &lt;==Mono Server Complains about
this line
SOAPAction: &quot;<A HREF="http://tempuri.org/ICalculator/Add&quot;">http://tempuri.org/ICalculator/Add&quot;</A>
User-Agent: Jakarta Commons-HttpClient/3.1
Host: soda5-update-test:100
Expect: 100-continue
Content-Length: 338

&lt;soapenv:Envelope xmlns:soapenv=&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/&quot;">http://schemas.xmlsoap.org/soap/envelope/&quot;</A>
xmlns:tem=&quot;<A HREF="http://tempuri.org/&quot;">http://tempuri.org/&quot;</A>&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;tem:Add&gt;
         
         &lt;tem:n1&gt;5&lt;/tem:n1&gt;
         
         &lt;tem:n2&gt;10&lt;/tem:n2&gt;
      &lt;/tem:Add&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;

This is the response I get from the server.

HTTP/1.1 415 Expected content-type 'text/xml; charset=utf-8' but got
'text/xml;charset=utf-8'
Server: Mono-HTTPAPI/1.0
Date: Tue, 22 Nov 2011 15:51:57 GMT
Content-Length: 0
Keep-Alive: timeout=15,max=99

My mono --version output is

Mono JIT compiler version 2.10.5 (/ Fri Sep  2 12:26:51 CEST 2011)
Copyright (C) 2002-2011 Novell, Inc, Xamarin, Inc and Contributors.
www.mono-project.com
        TLS:           __thread
        SIGSEGV:       altstack
        Notifications: epoll
        Architecture:  amd64
        Disabled:      none
        Misc:          softdebug
        LLVM:          supported, not enabled.
        GC:            Included Boehm (with typed GC and Parallel Mark)


The same service is working for the following response and request pair
properly.
These are the successful execution traffic examples.

POST /Calculator/Service HTTP/1.1
Content-Type: text/xml; charset=utf-8
SOAPAction: &quot;<A HREF="http://tempuri.org/ICalculator/Add&quot;">http://tempuri.org/ICalculator/Add&quot;</A>
Host: soda5-update-test:100
Content-Length: 159
Expect: 100-continue
Accept-Encoding: gzip, deflate
Connection: Keep-Alive


HTTP/1.1 100 Continue


&lt;s:Envelope xmlns:s=&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/&quot;">http://schemas.xmlsoap.org/soap/envelope/&quot;</A>&gt;&lt;s:Body&gt;&lt;Add
xmlns=&quot;<A HREF="http://tempuri.org/&quot;">http://tempuri.org/&quot;</A>&gt;&lt;n1&gt;100&lt;/n1&gt;&lt;n2&gt;15.99&lt;/n2&gt;&lt;/Add&gt;&lt;/s:Body&gt;&lt;/s:Envelope&gt;
HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
Server: Mono-HTTPAPI/1.0
Date: Tue, 22 Nov 2011 16:03:46 GMT
Content-Length: 219
Keep-Alive: timeout=15,max=100

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;s:Envelope
xmlns:s=&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/&quot;">http://schemas.xmlsoap.org/soap/envelope/&quot;</A>&gt;&lt;s:Body&gt;&lt;AddResponse
xmlns=&quot;<A HREF="http://tempuri.org/&quot;">http://tempuri.org/&quot;</A>&gt;&lt;AddResult&gt;115.99&lt;/AddResult&gt;&lt;/AddResponse&gt;&lt;/s:Body&gt;&lt;/s:Envelope&gt;

I'm also adding the server side  testing code below

namespace WCFMonoTestServer
{
    class Program
    {
        static void Main(string[] args)
        {
            // Step 1 of the address configuration procedure: Create a URI
to serve as the base address.            

            Uri baseAddress = new Uri(string.Format(
                                      &quot;<A HREF="http://{0}:100/Calculator/Service&quot;,">http://{0}:100/Calculator/Service&quot;,</A>
                                      Environment.MachineName));
            
            Console.WriteLine(&quot;Service starts on 
&quot;+baseAddress.AbsoluteUri);

            // Step 2 of the hosting procedure: Create ServiceHost
            ServiceHost selfHost = new
ServiceHost(typeof(WCFMonoCalculatorService), baseAddress);

            try
            {
                ServiceMetadataBehavior metadataBehavior =
                        new ServiceMetadataBehavior();
                metadataBehavior.HttpGetEnabled = true;               
                metadataBehavior.HttpGetUrl = new Uri(string.Format(
                                     
&quot;<A HREF="http://{0}:100/Calculator/Service/CalculatorService.svc&quot;,">http://{0}:100/Calculator/Service/CalculatorService.svc&quot;,</A>
                                      Environment.MachineName));                
                selfHost.Description.Behaviors.Add(metadataBehavior);

                ServiceDebugBehavior debugBehavior = (  from behavior in
selfHost.Description.Behaviors
                                                          where behavior is
ServiceDebugBehavior
                                                          select behavior as
ServiceDebugBehavior).First();           
                
                selfHost.Description.Behaviors.Remove(debugBehavior);

                debugBehavior.IncludeExceptionDetailInFaults=true;

                selfHost.Description.Behaviors.Add(debugBehavior);

                CustomBinding customBinding = new CustomBinding();
                customBinding.Elements.Add(new
TextMessageEncodingBindingElement()
                {
                    WriteEncoding = System.Text.UTF8Encoding.UTF8,
                    MessageVersion =
MessageVersion.CreateVersion(EnvelopeVersion.Soap11,
AddressingVersion.None),
                });
                customBinding.Elements.Add(new
HttpTransportBindingElement());


                //BasicHttpBinding binding = new BasicHttpBinding();
                // Step 3 of the hosting procedure: Add a service endpoint.
                selfHost.AddServiceEndpoint(typeof(ICalculator),
                    // new
SodaCustomBinding(SodaCustomTrasnportMode.HTTPTransport,SodaCustomEncodingMode.MtomMessage)            
                    customBinding    //binding
                    , baseAddress);
                                               
                // Step 4 of the hosting procedure: Enable metadata
exchange.
                //ServiceMetadataBehavior smb = new
ServiceMetadataBehavior();
                //smb.HttpGetEnabled = true;
                //selfHost.Description.Behaviors.Add(smb);

                // Step 5 of the hosting procedure: Start (and then stop)
the service.
                
                selfHost.Open();

                selfHost.Faulted += new EventHandler(selfHost_Faulted);
                selfHost.UnknownMessageReceived += new
EventHandler&lt;UnknownMessageReceivedEventArgs&gt;(selfHost_UnknownMessageReceived);

                Console.WriteLine(&quot;The service is ready.&quot;);
                Console.WriteLine(&quot;Press &lt;ENTER&gt; to terminate service.&quot;);
                Console.WriteLine();
                Console.ReadKey();

                // Close the ServiceHostBase to shutdown the service.
                selfHost.Close();
            }
            catch (CommunicationException ce)
            {
                Console.WriteLine(&quot;An exception occurred: {0}&quot;, ce.Message);
                selfHost.Abort();
                Console.ReadKey();
            }
            catch (Exception ex) {
                Console.WriteLine(&quot;An exception occurred: {0}&quot;, ex.Message);
                Console.WriteLine(ex.StackTrace);
                selfHost.Abort();
                Console.ReadKey();
            
            }
        }

        static void selfHost_Faulted(object sender, EventArgs e)
        {
            Console.WriteLine(e.ToString());
        }

        static void selfHost_UnknownMessageReceived(object sender,
UnknownMessageReceivedEventArgs e)
        {
            Console.WriteLine(e.Message);
        }
    }
}

What can I do to be able to handle the other  client such as soapUi tool
requests?

Thanks in advice.
Best Regards

--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Http-Content-Type-Header-Problem-tp4096321p4096321.html">http://mono.1490590.n4.nabble.com/Http-Content-Type-Header-Problem-tp4096321p4096321.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="038296.html">[Mono-dev] sgen gc &amp; ephemerons arrays bug
</A></li>
	<LI>Next message: <A HREF="038297.html">[Mono-dev] SqlDbType.Structured
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#38295">[ date ]</a>
              <a href="thread.html#38295">[ thread ]</a>
              <a href="subject.html#38295">[ subject ]</a>
              <a href="author.html#38295">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
