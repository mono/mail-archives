<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Number of elements in a fixed buffer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Number%20of%20elements%20in%20a%20fixed%20buffer&In-Reply-To=%3C55C8BAD2.1080404%40linux.vnet.ibm.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043169.html">
   <LINK REL="Next"  HREF="043178.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Number of elements in a fixed buffer</H1>
    <B>Bill Seurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Number%20of%20elements%20in%20a%20fixed%20buffer&In-Reply-To=%3C55C8BAD2.1080404%40linux.vnet.ibm.com%3E"
       TITLE="[Mono-dev] Number of elements in a fixed buffer">seurer at linux.vnet.ibm.com
       </A><BR>
    <I>Mon Aug 10 14:53:06 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="043169.html">[Mono-dev] Number of elements in a fixed buffer
</A></li>
        <LI>Next message: <A HREF="043178.html">[Mono-dev] Number of elements in a fixed buffer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43177">[ date ]</a>
              <a href="thread.html#43177">[ thread ]</a>
              <a href="subject.html#43177">[ subject ]</a>
              <a href="author.html#43177">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The only mention of FixedBufferAttribute I see is in the C# code in mcs.

I looked through all the mono C code and I see several places where 
MonoCustomAttrInfo is used but no where is it doing anything with fixed 
buffers.  Is there some documentation or more examples of what is in the 
MonoCustomAttrInfo data for something like this?

I experimented a bit and used mono_custom_attrs_from_class() to pull the 
MonoCustomAttrInfo for the class.  It looks like there are two attributes.

{num_attrs = 2, cached = 0, image = 0x10566ed0, attrs = 0x1061c630}

So looking at the two attributes I see

attrs[0]:  {ctor = 0x1061cb10, data_size = 4, data = 0x3fffb7840e71 &quot;\001&quot;}
attrs[1]:  {ctor = 0x1061c990, data_size = 4, data = 0x3fffb7840e71 &quot;\001&quot;}


The data fields are identical and are 01 00 00 00 or maybe the other way 
around depending on what the field represents (this is a LE machine).

The ctors are

(gdb) print cinfo-&gt;attrs[0].ctor-&gt;klass-&gt;name
$14 = 0x3fffb5b225b6 &quot;UnsafeValueTypeAttribute&quot;
(gdb) print cinfo-&gt;attrs[1].ctor-&gt;klass-&gt;name
$15 = 0x3fffb5b22281 &quot;CompilerGeneratedAttribute&quot;

What do those represent?


On 08/06/2015 12:23 PM, Zoltan Varga wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>    The type has a FixedBufferAttribute custom attribute which contains
</I>&gt;<i> the length of the array. There are some functions in reflection.c
</I>&gt;<i> like mono_custom_attrs_from_class () which can return information about it.
</I>&gt;<i>
</I>&gt;<i>                 Zoltan
</I>&gt;<i>
</I>&gt;<i> On Thu, Aug 6, 2015 at 12:32 PM, Bill Seurer &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">seurer at linux.vnet.ibm.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">seurer at linux.vnet.ibm.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     In some code in mono/mini I need to figure out how many elements
</I>&gt;<i>     there are in a fixed buffer field in a struct, something like this:
</I>&gt;<i>
</I>&gt;<i>              public unsafe struct double_array4 {
</I>&gt;<i>                      public fixed double f1[4];
</I>&gt;<i>              }
</I>&gt;<i>
</I>&gt;<i>     So I'd need to know &quot;4&quot;.
</I>&gt;<i>
</I>&gt;<i>     I can get the MonoClass of the field from the MonoFieldType and if I
</I>&gt;<i>     print out the name I get
</I>&gt;<i>
</I>&gt;<i>     Test_double.double_array4.&lt;f1&gt;__FixedBuffer0
</I>&gt;<i>
</I>&gt;<i>     so it knows it is a fixed buffer.  If I look at the fields of the
</I>&gt;<i>     struct in the above example there is just one and it's a double.
</I>&gt;<i>
</I>&gt;<i>     So how can I figure out the number of elements?
</I>&gt;<i>
</I>&gt;<i>     Thanks!
</I>

-- 

-Bill Seurer

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043169.html">[Mono-dev] Number of elements in a fixed buffer
</A></li>
	<LI>Next message: <A HREF="043178.html">[Mono-dev] Number of elements in a fixed buffer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43177">[ date ]</a>
              <a href="thread.html#43177">[ thread ]</a>
              <a href="subject.html#43177">[ subject ]</a>
              <a href="author.html#43177">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
