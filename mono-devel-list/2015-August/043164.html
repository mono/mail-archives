<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Embedded mono crash on exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Embedded%20mono%20crash%20on%20exception&In-Reply-To=%3C1088502677.35718.1438859623321.JavaMail.yahoo%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043163.html">
   <LINK REL="Next"  HREF="043179.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Embedded mono crash on exception</H1>
    <B>Trigve Siver</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Embedded%20mono%20crash%20on%20exception&In-Reply-To=%3C1088502677.35718.1438859623321.JavaMail.yahoo%40mail.yahoo.com%3E"
       TITLE="[Mono-dev] Embedded mono crash on exception">trigves at yahoo.com
       </A><BR>
    <I>Thu Aug  6 11:13:43 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="043163.html">[Mono-dev] Embedded mono crash on exception
</A></li>
        <LI>Next message: <A HREF="043179.html">[Mono-dev] Embedded mono crash on exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43164">[ date ]</a>
              <a href="thread.html#43164">[ thread ]</a>
              <a href="subject.html#43164">[ subject ]</a>
              <a href="author.html#43164">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>



----- Original Message -----
&gt;<i> From: Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt;
</I>&gt;<i> To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Cc: 
</I>&gt;<i> Sent: Thursday, August 6, 2015 10:31 AM
</I>&gt;<i> Subject: Re: [Mono-dev] Embedded mono crash on exception
</I>&gt;<i> 
</I>&gt;<i> On 06.08.2015 08:12, Trigve wrote:
</I>&gt;&gt;<i>  I'm using embedded mono (using unity) in C++ DLL. I'm calling some 
</I>&gt;<i> managed
</I>&gt;&gt;<i>  functions using mono_runtime_invoke(). The function does throw an 
</I>&gt;<i> exception,
</I>&gt;&gt;<i>  which I caught with the MonoException argument. Then I want to unwind stack
</I>&gt;&gt;<i>  (in C++) so I throw my custom exception. But application crashes at address
</I>&gt;&gt;<i>  00000000 (last function on the stack is <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ExecuteHandler2 at 20</A>()). So it looks
</I>&gt;&gt;<i>  like some exception handler is set pointing to the NULL.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I'm pasting this from the Nabble Forum because it didn't make
</I>&gt;<i> into the mail:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>  First-chance exception at 0x7548C42D in Unity.exe: Microsoft C++ exception: 
</I>&gt;<i> ExceptionAlreadySet at memory location 0x0028D63C.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>  First-chance exception at 0x00000000 in Unity.exe: 0xC0000005: Access 
</I>&gt;<i> violation executing location 0x00000000.
</I>&gt;<i> 
</I>&gt;<i> Not sure about Unity's Mono (it's a customized version) but
</I>&gt;<i> &quot;First-chance exception at 0x00000000&quot; is usually not an error,
</I>&gt;<i> at least not in the old Mono version Unity is using.
</I>&gt;<i> 
</I>&gt;<i> This exception is an artifact of Mono's NullReferenceException handling.
</I>&gt;<i> You are supposed to ignore it.
</I>&gt;<i> 
</I>

Thanks for the reply,
yes I know that mono handle the access violation as NullReferenceException. But I'm not sure this is the case. Because the whole application crashed. But this only happens only after the mono_runtime_invoke() returns the exception. If no exception is returned, and I throw C++ exception, everything is working right. Also if you notice the call stack, the crash happens at calling the NULL location in exception handler, so to me it looks like some memory corruption or what. But I can't pinpoint the source of it.

Here is the call stack from the original mail:
00000000() Unknown
[Frames below may be incorrect and/or missing]
ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ExecuteHandler2 at 20</A>() Unknown
ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ExecuteHandler at 20</A>() Unknown
ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">_RtlDispatchException at 8</A>() Unknown
ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">_KiUserExceptionDispatcher at 8</A>() Unknown
KernelBase.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">_RaiseException at 16</A>() Unknown
msvcr120d.dll!_CxxThrowException(void * pExceptionObject=0x0028d658, const _s__ThrowInfo * pThrowInfo=0x2313ffe0) Line 154 C++

Thanks

Trigve
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043163.html">[Mono-dev] Embedded mono crash on exception
</A></li>
	<LI>Next message: <A HREF="043179.html">[Mono-dev] Embedded mono crash on exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43164">[ date ]</a>
              <a href="thread.html#43164">[ thread ]</a>
              <a href="subject.html#43164">[ subject ]</a>
              <a href="author.html#43164">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
