<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono sandbox is not verifying on load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20sandbox%20is%20not%20verifying%20on%20load&In-Reply-To=op.vb6wy7q9tyk4fl%40tardis.lindenlab.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034922.html">
   <LINK REL="Next"  HREF="034915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono sandbox is not verifying on load</H1>
    <B>Robert Jordan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Mono%20sandbox%20is%20not%20verifying%20on%20load&In-Reply-To=op.vb6wy7q9tyk4fl%40tardis.lindenlab.com"
       TITLE="[Mono-dev] Mono sandbox is not verifying on load">robertj at gmx.net
       </A><BR>
    <I>Wed May  5 16:31:51 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034922.html">[Mono-dev] Mono sandbox is not verifying on load
</A></li>
        <LI>Next message: <A HREF="034915.html">[Mono-dev] Looking for Article on using Moonlight
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34923">[ date ]</a>
              <a href="thread.html#34923">[ thread ]</a>
              <a href="subject.html#34923">[ subject ]</a>
              <a href="author.html#34923">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04.05.2010 18:48, Pete Forman wrote:
&gt;<i> I would like to verify all byte code when it is loaded into embedded
</I>&gt;<i> Mono. Verification has been turned on using
</I>&gt;<i> mono_security_enable_core_clr() but that is only performing
</I>&gt;<i> verification when the code is executed.
</I>&gt;<i>
</I>&gt;<i> My test cases are based on some working code that has been
</I>&gt;<i> disassembled to IL. An 'add' instruction without any preceding loads
</I>&gt;<i> is inserted into (case A) the constructor or (case B) another method.
</I>&gt;<i> It is expected that &quot;System.InvalidProgramException: Stack underflow,
</I>&gt;<i> required 2, but have 0 at 0x0000&quot; be thrown.
</I>&gt;<i>
</I>&gt;<i> Case A does produce the exception as the object is constructed when I
</I>&gt;<i> load the assembly.
</I>&gt;<i>
</I>&gt;<i> Case B does not produce the exception when I load it. It does when the
</I>&gt;<i> hacked method is called.
</I>&gt;<i>
</I>&gt;<i> pedump successfully identifies the errors in both cases (as does
</I>&gt;<i> peverify in .Net).
</I>
mono_security_enable_core_clr() is not intended to start
a full IL validation. It rather ensures that the verifier
will detect whether the assembly is verifiable, i.e.
it won't crash later on during the IL validation that will
be performed lazily (JIT-driven) at runtime.

OTOH, pedump &amp; peverify are not JIT-driven. They are eagerly
IL-validating every method.

If you need this functionality, then have a look at
how metadata/peverify.c is iterating over the methods
while invoking the verifier on each one.

Robert

</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034922.html">[Mono-dev] Mono sandbox is not verifying on load
</A></li>
	<LI>Next message: <A HREF="034915.html">[Mono-dev] Looking for Article on using Moonlight
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34923">[ date ]</a>
              <a href="thread.html#34923">[ thread ]</a>
              <a href="subject.html#34923">[ subject ]</a>
              <a href="author.html#34923">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
