<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Status of the Windows build (with patches)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Status%20of%20the%20Windows%20build%20%28with%20patches%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035114.html">
   <LINK REL="Next"  HREF="035118.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Status of the Windows build (with patches)</H1>
    <B>Robert Jordan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Status%20of%20the%20Windows%20build%20%28with%20patches%29&In-Reply-To="
       TITLE="[Mono-dev] Status of the Windows build (with patches)">robertj at gmx.net
       </A><BR>
    <I>Fri May 28 10:01:40 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035114.html">[Mono-dev] [Mono-Dev]System.Xml.Schema.Extensions unit tests
</A></li>
        <LI>Next message: <A HREF="035118.html">[Mono-dev] Status of the Windows build (with patches)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35116">[ date ]</a>
              <a href="thread.html#35116">[ thread ]</a>
              <a href="subject.html#35116">[ subject ]</a>
              <a href="author.html#35116">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

One of the main causes of the Windows build breakage was the
use of cygwin paths for &quot;mcs_topdir&quot;. Because this var is mainly
used for MONO_PATH and the gmcs path, the runtime was utterly
failing on them.

This is fixed by configure.in.diff. With this patch the
runtime unit tests are working again.


The second issue is a SIGSEGV during the full mscorlib
compilation (also reported by Atsushi). It seems to be
caused by the basic bootstrap corlib, but I did not debug
it in the hope that one of the Reflection.Emit gods is
able to pinpoint the issue by just looking at the backtrace
and my patch.

See backtrace.txt and icall.c.diff. The offending enums are

System.Runtime.InteropServices.CharSet
System.Runtime.InteropServices.CallingConvention

For both, the following expression is true:

	class-&gt;element_class == class

which is causing  mono_class_enum_basetype() to return NULL.

It seems that the issue is related to the emission of DllImports.


The third issue was eglib related. See eglib.diff.

With these 3 patches, both glib and eglib bootstraps
are working again.

Regards,
Robert

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: configure.in.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: backtrace.txt
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment.txt">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment.txt</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: icall.c.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment-0001.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment-0001.pl</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: eglib.diff
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment-0002.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100528/21977807/attachment-0002.pl</A> 
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035114.html">[Mono-dev] [Mono-Dev]System.Xml.Schema.Extensions unit tests
</A></li>
	<LI>Next message: <A HREF="035118.html">[Mono-dev] Status of the Windows build (with patches)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35116">[ date ]</a>
              <a href="thread.html#35116">[ thread ]</a>
              <a href="subject.html#35116">[ subject ]</a>
              <a href="author.html#35116">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
