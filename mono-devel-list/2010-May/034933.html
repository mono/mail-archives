<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Self Hosted web service unstable &#8211; we see a new active port connection for each call
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%3D%3Fwindows-1252%3Fq%3FSelf_Hosted_web_service_unstable_%3D96_%3F%3D%0A%09%3D%3Fwindows-1252%3Fq%3Fwe_see_a_new_active_port_connection_for_each_call%3F%3D&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034929.html">
   <LINK REL="Next"  HREF="034952.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Self Hosted web service unstable &#8211; we see a new active port connection for each call</H1>
    <B>Vilius Adamkavicius</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%3D%3Fwindows-1252%3Fq%3FSelf_Hosted_web_service_unstable_%3D96_%3F%3D%0A%09%3D%3Fwindows-1252%3Fq%3Fwe_see_a_new_active_port_connection_for_each_call%3F%3D&In-Reply-To="
       TITLE="[Mono-dev] Self Hosted web service unstable &#8211; we see a new active port connection for each call">vilius.adamkavicius at invade.net
       </A><BR>
    <I>Fri May  7 11:14:52 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034929.html">[Mono-dev] Mono 2.8 (trunk) compiling on Mac OS X 10.6 (SL)
</A></li>
        <LI>Next message: <A HREF="034952.html">[Mono-dev] Self Hosted web service unstable &#8211; we see a new active port connection for each call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34933">[ date ]</a>
              <a href="thread.html#34933">[ thread ]</a>
              <a href="subject.html#34933">[ subject ]</a>
              <a href="author.html#34933">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We have implemented a simple self hosted web service in .NET using
ServiceHost.  The Client is a simple Silverlight app that polls for updated
info every 5 seconds. The return messages tend to be no more that 1-10K.



 We ported the web service (self-hosted)  to MONO 2.6. This seemed to go
perfectly and it stood up to stress testing in devel...then we deployed it.
Now we find that the service is unstable and can just hangs after anywhere
between 2 minutes and 2 days.

IP traces show that when it hangs the XML Post gets (request) gets received
by the webservice but nothing is ever transmitted back.  Also when it hangs
netstat shows a persistent active connection on the port to which it is
allocated.



In an attempt to diagnose this we looked at the port behaviour using
netstat. We looked at this while the MONO implementation of the webservice
was running without problem; we compare this to the active port connection
behaviour of the windows/.NET implementation- what found was worrying.



When we run a single client and connect the windows/.NET version of the
webservice we see *one port connection that persists*.

When we run a single client and connect the MONO version of the webservice
we see it holds around *12-16 active port connections at any one time*...and
these seem to be continuously dying and regenerating.

We postulated that each call to the webservice was making a new connection
(unlike Windows); each connection would be used once and then timeout. Given
the rate that the client polls we estimated that the timeout must be around
a minute...then we found this in the MONO DefaultCommunicationTimeouts.cs



Vilius: private DefaultCommunicationTimeouts ()
{
close = open = send = TimeSpan.FromMinutes (1);
receive = TimeSpan.FromMinutes (10);
}

This strongly supports our theory...

The question is why does it keep creating a new connection for each call?
Can the MONO 2.6 implementation of ServiceHost maintain a single connection
for an application session (like Windows .NET) ? What is the ramification of
this?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100507/fd52c85d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100507/fd52c85d/attachment.html</A> 
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034929.html">[Mono-dev] Mono 2.8 (trunk) compiling on Mac OS X 10.6 (SL)
</A></li>
	<LI>Next message: <A HREF="034952.html">[Mono-dev] Self Hosted web service unstable &#8211; we see a new active port connection for each call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34933">[ date ]</a>
              <a href="thread.html#34933">[ thread ]</a>
              <a href="subject.html#34933">[ subject ]</a>
              <a href="author.html#34933">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
