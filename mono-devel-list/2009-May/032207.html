<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Resolving dependencies while compiling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Resolving%20dependencies%20while%20compiling&In-Reply-To=20090520152329.GA32374%40stallman.rootnode.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032236.html">
   <LINK REL="Next"  HREF="032209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Resolving dependencies while compiling</H1>
    <B>Rafael Teixeira</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Resolving%20dependencies%20while%20compiling&In-Reply-To=20090520152329.GA32374%40stallman.rootnode.net"
       TITLE="[Mono-dev] Resolving dependencies while compiling">monoman at gmail.com
       </A><BR>
    <I>Wed May 20 12:31:19 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032236.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
        <LI>Next message: <A HREF="032209.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32207">[ date ]</a>
              <a href="thread.html#32207">[ thread ]</a>
              <a href="subject.html#32207">[ subject ]</a>
              <a href="author.html#32207">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>VS.NET does allow for you (each developer as it goes in the .user file) to
specify a library path for a project, what probably means something like 6.
So we end up using a mix of setiing a per project library path (somewhat
like 6) and keeping tier0/1 in a common libraries folder (part of 4).

In pratice I've noted that even VS.NET/CSC get confused about such
references vs visibility issues and I need to add some more references from
the lower tiers,meaning duplicated libs in each subproject folder.

See that the project files (really msbuild files) do have more flexibility
than what the IDE provides and sometimes I do hand-tune them to make things
easier, while still being compatible with the IDE assumptions.

Fun

On Wed, May 20, 2009 at 12:23 PM, Grzegorz Sobanski &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">silk at boktor.net</A>&gt; wrote:

&gt;<i> * Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>&gt; [2009-05-20 15:59]:
</I>&gt;<i> [cut everything about extra copies and referencing]
</I>&gt;<i> &gt;       gmcs -t:library -lib:b/bin/Debug,a/bin/Debug c/c.cs -r:b.dll
</I>&gt;<i> -r:a.dll
</I>&gt;<i>
</I>&gt;<i> Yeap, all the above is true. And is the same for both VS and Mono.
</I>&gt;<i>
</I>&gt;<i> But I think, that paszczi in his original mail missed the real problem:
</I>&gt;<i>
</I>&gt;<i> &gt; Now, if you don't want to specify the entire assembly dependency chain
</I>&gt;<i> &gt; (e.g. you only want to specify b.dll or X.dll, not both a.dll+b.dll or
</I>&gt;<i> &gt; X.dll+Y.dll), then you *must* have a copy/symlink:
</I>&gt;<i>
</I>&gt;<i> The &quot;must&quot; is (un)fortunately not true for VS.
</I>&gt;<i>
</I>&gt;<i> &gt;       cp a/bin/Debug/a.dll b/bin/Debug
</I>&gt;<i> &gt;       gmcs -t:library c/c.cs -r:b/bin/Debug/b.dll
</I>&gt;<i>
</I>&gt;<i> It is only true if c.cs (c.dll) uses types from a.dll.
</I>&gt;<i>
</I>&gt;<i> Ex: if a.dll contains class LibA {...}
</I>&gt;<i> And b.dll contains
</I>&gt;<i> class LibB {
</I>&gt;<i>  public string Met1 () { return &quot;hey!&quot;; }
</I>&gt;<i>  public LibA Met2 () { return new LibA (); }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> I can sucessfully compile c.dll in VS if it only calls Met1, without
</I>&gt;<i> referencing a.dll, and without having any copies of a.dll laying around.
</I>&gt;<i> (after compiling b.dll I have deleted all a.dll files)
</I>&gt;<i> And I can even execute c.dll without having a.dll (as dependecies
</I>&gt;<i> are resolved at call time not at startup time. It is the same in Mono
</I>&gt;<i> I believe).
</I>&gt;<i>
</I>&gt;<i> Unfortunately to compile c.dll in gmcs I need a a.dll even if c.dll
</I>&gt;<i> does not use any type from a.dll.
</I>&gt;<i>
</I>&gt;<i> (If b.dll is referencing a.dll but does not have anything from a.dll
</I>&gt;<i> in it's public contract, then c.dll will compile fine in gmcs)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Now, some real-life example.
</I>&gt;<i> We are building modular software and using a bunch of libraries, for
</I>&gt;<i> example: Castle.MicroKernel, Castle.ActiveRecord, etc. (let's call them
</I>&gt;<i> tier 1)
</I>&gt;<i> They reference some more libaries. Iesi.Collections, NHibernate (tier 0)
</I>&gt;<i>
</I>&gt;<i> We build modules (tier 2): ModuleA, ModuleB referencing and using a lot
</I>&gt;<i> of tier 1 libraries (Castle.* mainly).
</I>&gt;<i>
</I>&gt;<i> And those modules are used by some applications (tier 3). Now even if
</I>&gt;<i> application is not using any types from Tier1 they are still needed
</I>&gt;<i> at compile time (in mono, not in VS). What's more, even dlls from Tier0
</I>&gt;<i> are needed.
</I>&gt;<i>
</I>&gt;<i> There are different solutions we could use:
</I>&gt;<i> 1) gmcs could compile like VS, not knowing the types from Tier0/1 -
</I>&gt;<i>   ideal
</I>&gt;<i> 2) reference all dll's from Tier0/1 in application - bad
</I>&gt;<i> 3) copy (symlink) all dll's from Tier0/1 to directory of every Module*
</I>&gt;<i> (Tier2)
</I>&gt;<i>   - that's what we've been using until now. But it started to be
</I>&gt;<i>     a real maintenance problem.
</I>&gt;<i> 4) put all dll's from all Tiers to one directory - we want to avoid that
</I>&gt;<i> 5) use MONO_PATH= during compilation to show directories where Tier0/1
</I>&gt;<i>   dll's can be found - we are using it now (I know it is 'not
</I>&gt;<i>   recommended' :P)
</I>&gt;<i> 6) use -lib instead of MONO_PATH - but that would still mean adding to
</I>&gt;<i>   every project from Tier3 every directory from Tier0/1.
</I>&gt;<i>
</I>&gt;<i> To sum up - problem is when I'm using b.dll which has something
</I>&gt;<i> from a.dll in it's public API, but I'm not consuming it. I would
</I>&gt;<i> like to skip a reference to a.dll in c.dll then.
</I>&gt;<i>
</I>&gt;<i> (We can ensure in some other way that all needed dll's from tier0/1
</I>&gt;<i> will be available at runtime).
</I>&gt;<i>
</I>&gt;<i> Uff, a long mail ;P
</I>&gt;<i> greets
</I>&gt;<i>
</I>&gt;<i> silk
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>


-- 
Rafael &quot;Monoman&quot; Teixeira
---------------------------------------
&quot;To be creative means to be in love with life. You can be creative only if
you love life enough that you want to enhance its beauty, you want to bring
a little more music to it, a little more poetry to it, a little more dance
to it.&quot;
Osho
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090520/c920737d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090520/c920737d/attachment.html</A> 
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032236.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
	<LI>Next message: <A HREF="032209.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32207">[ date ]</a>
              <a href="thread.html#32207">[ thread ]</a>
              <a href="subject.html#32207">[ subject ]</a>
              <a href="author.html#32207">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
