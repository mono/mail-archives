<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev]  [PATCH] Adding hooks for BSTR Marshaling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20%5BPATCH%5D%20Adding%20hooks%20for%20BSTR%20Marshaling&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032240.html">
   <LINK REL="Next"  HREF="032294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev]  [PATCH] Adding hooks for BSTR Marshaling</H1>
    <B>Bill Holmes</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20%5BPATCH%5D%20Adding%20hooks%20for%20BSTR%20Marshaling&In-Reply-To="
       TITLE="[Mono-dev]  [PATCH] Adding hooks for BSTR Marshaling">billholmes54 at gmail.com
       </A><BR>
    <I>Fri May 22 12:15:12 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032240.html">[Mono-dev] Alpha blending in libgdiplus (call for testers)
</A></li>
        <LI>Next message: <A HREF="032294.html">[Mono-dev] [PATCH] Adding hooks for BSTR Marshaling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32241">[ date ]</a>
              <a href="thread.html#32241">[ thread ]</a>
              <a href="subject.html#32241">[ subject ]</a>
              <a href="author.html#32241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The attached patch allows hook functions to be registered with mono to
use when marshaling BSTRs.  I need this functionality because the
Win32 API emulator we use requires that the encoding is ucs4 and
another allocator be used.

This patch only correct part of my problem.  If this is approved I
will be adding similar code for Marshal.AllocCoTaskMem and
Marshal.AllocHGlobal, which will be a separate commit.

2009-05-22  Bill Holmes  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">billholmes54 at gmail.com</A>&gt;

	* cominterop.c : mono_string_to_bstr, mono_string_from_bstr and
	  mono_free_bstr changed to call external hooks if installed.
	  mono_install_bstr_funcs added to the set the hooks.

	* marshal-hooks.h : Added to declare mono_install_bstr_funcs

	* Makefile.am : Adding marshal-hooks.h to the list of public API
	  header files.

	Code is contributed under MIT/X11 license.

-bill
-------------- next part --------------
A non-text attachment was scrubbed...
Name: monocomstring_new4.patch
Type: application/octet-stream
Size: 4397 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090522/880b2fb4/attachment-0001.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090522/880b2fb4/attachment-0001.obj</A> 
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032240.html">[Mono-dev] Alpha blending in libgdiplus (call for testers)
</A></li>
	<LI>Next message: <A HREF="032294.html">[Mono-dev] [PATCH] Adding hooks for BSTR Marshaling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32241">[ date ]</a>
              <a href="thread.html#32241">[ thread ]</a>
              <a href="subject.html#32241">[ subject ]</a>
              <a href="author.html#32241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
