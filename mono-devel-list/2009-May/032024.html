<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] eglib patch to avoid double overflow in win32	gtimers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20eglib%20patch%20to%20avoid%20double%20overflow%20in%20win32%0A%09gtimers&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032059.html">
   <LINK REL="Next"  HREF="032031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] eglib patch to avoid double overflow in win32	gtimers</H1>
    <B>Jeffrey Stedfast</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20eglib%20patch%20to%20avoid%20double%20overflow%20in%20win32%0A%09gtimers&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] eglib patch to avoid double overflow in win32	gtimers">fejj at novell.com
       </A><BR>
    <I>Wed May  6 12:19:11 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032059.html">[Mono-dev] What mono branch/tag to use from svn
</A></li>
        <LI>Next message: <A HREF="032031.html">[Mono-dev] [PATCH] eglib patch to avoid double overflow	in	win32 gtimers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32024">[ date ]</a>
              <a href="thread.html#32024">[ thread ]</a>
              <a href="subject.html#32024">[ subject ]</a>
              <a href="author.html#32024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The calculation:
    *microseconds = (gulong)(1000000.0 * (stop - timer-&gt;start) / freq);

isn't ideal ordering for long-running timers and may overflow after
multiplying by 1000000.0 but before having a chance to divide by freq. A
simple reordering of operations makes this less likely.

Also, I made it so that it only needs to query the performance counter
frequency once rather than each time. The patch also handles errors
getting the performance counter frequency (currently falls back to freq
= 1, but perhaps it should use freq = 1000000? Does anyone have hardware
where this actually fails?). This prevents possible divide-by-zero
exceptions.

Jeff

-------------- next part --------------
A non-text attachment was scrubbed...
Name: gtimer.patch
Type: text/x-patch
Size: 1509 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090506/c7e973b7/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090506/c7e973b7/attachment.bin</A> 
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032059.html">[Mono-dev] What mono branch/tag to use from svn
</A></li>
	<LI>Next message: <A HREF="032031.html">[Mono-dev] [PATCH] eglib patch to avoid double overflow	in	win32 gtimers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32024">[ date ]</a>
              <a href="thread.html#32024">[ thread ]</a>
              <a href="subject.html#32024">[ subject ]</a>
              <a href="author.html#32024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
