<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Fixes for	System.Collections.Generic.ICollection&lt;T&gt;.CopyTo
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Fixes%20for%0A%09System.Collections.Generic.ICollection%3CT%3E.CopyTo&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032027.html">
   <LINK REL="Next"  HREF="032032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Fixes for	System.Collections.Generic.ICollection&lt;T&gt;.CopyTo</H1>
    <B>Pia Eriksson</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Fixes%20for%0A%09System.Collections.Generic.ICollection%3CT%3E.CopyTo&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] Fixes for	System.Collections.Generic.ICollection&lt;T&gt;.CopyTo">pe at hallerud.se
       </A><BR>
    <I>Wed May  6 17:16:58 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032027.html">[Mono-dev] libgdiplus drawing performance
</A></li>
        <LI>Next message: <A HREF="032032.html">[Mono-dev] [PATCH] Fixes	for	System.Collections.Generic.ICollection&lt;T&gt;.CopyTo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32028">[ date ]</a>
              <a href="thread.html#32028">[ thread ]</a>
              <a href="subject.html#32028">[ subject ]</a>
              <a href="author.html#32028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I was porting some .net code to mono and ran into issues with CopyTo on
classes in System.Collections.Generic. Some implementations works as
documented, others don't. To be specific, the problem it's what happens
when you call CopyTo on an empty collection.

Docs:
<A HREF="http://msdn.microsoft.com/en-us/library/0efx51xw.aspx">http://msdn.microsoft.com/en-us/library/0efx51xw.aspx</A>

Check out the condition for ArgumentException. My interpretation is that
nothing should happen if the collection is empty, but mono throws
ArgumentException. MS implementations does not. The key issue here is
consistency. As I said, some classes (ex. Stack) works as expected already. 
In corlib's Dictionary we have:
// we want no exception for index==array.Length &amp;&amp; Count == 0

I don't think we need an argument about what's correct :-) There is a bugzilla
bug #497720 also, but it only mentions one of the problems that needs a patch.

Since I don't have (and don't want or need) svn access I leave the following
patches in your hands. Please review and then commit if accepted:

generic.diff:
Actual code fixes for the collections that don't work as expected

generic_test.diff:
Updated tests for Collections.Geneneric. Existing tests for CopyTo updated
with a test for the problem described. If no test existed, new ones written.

Keep up the good work!

/Pia
-------------- next part --------------
A non-text attachment was scrubbed...
Name: generic_test.diff
Type: text/x-patch
Size: 6532 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090506/f593ad54/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090506/f593ad54/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: generic.diff
Type: text/x-patch
Size: 2978 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090506/f593ad54/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090506/f593ad54/attachment-0001.bin</A> 
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032027.html">[Mono-dev] libgdiplus drawing performance
</A></li>
	<LI>Next message: <A HREF="032032.html">[Mono-dev] [PATCH] Fixes	for	System.Collections.Generic.ICollection&lt;T&gt;.CopyTo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32028">[ date ]</a>
              <a href="thread.html#32028">[ thread ]</a>
              <a href="subject.html#32028">[ subject ]</a>
              <a href="author.html#32028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
