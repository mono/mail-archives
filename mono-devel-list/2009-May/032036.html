<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Crazy StackAlloc
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Crazy%20StackAlloc&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032084.html">
   <LINK REL="Next"  HREF="032039.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Crazy StackAlloc</H1>
    <B>Jambunathan K</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Crazy%20StackAlloc&In-Reply-To="
       TITLE="[Mono-dev] Crazy StackAlloc">kjambunathan.devel at gmail.com
       </A><BR>
    <I>Thu May  7 07:52:11 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032084.html">[Mono-dev] [PATCH] Suggested patch for bug #501666
</A></li>
        <LI>Next message: <A HREF="032039.html">[Mono-dev] Crazy StackAlloc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32036">[ date ]</a>
              <a href="thread.html#32036">[ thread ]</a>
              <a href="subject.html#32036">[ subject ]</a>
              <a href="author.html#32036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was little out of my mind and I tried crazy stackalloc both on Mono
and Windows XP.

The intention was to find out the max stack size available. There are
a couple of surprises both Windows and Mono. Both the runtimes was
behaving differently from my expectations.

On Windows, there is __no__ StackOverflowException as one would expect.
There was only a NullReferenceException.

On Mono, there is a StackOverflowException with the runtime getting
starved stack space.

My mono version is 2.4. My .NET - 1.1 environment is atleast 4 years old.

Please don't question the reasonableness of stackalloc size. What
interests me is the runtime behaviour.

You might have to play around with 'size' to get the runtime to behave crazily.

Output on Windows is down below. Audience can check out the behaviour
on Mono for
themselves.

C:\Documents and Settings\Owner&gt;type StackAllocCrazy.cs
using System;

class T
{

        public unsafe static void Main ()
        {
        int size = 1 * 1024 * 1024 * 1024;

        while (size != 0) {
                Console.WriteLine (&quot;Trying &quot; + size + &quot; bytes ...&quot;);

                try {
                        long *buf = stackalloc long[size];

                        for (int i = 0; i &lt; size; ++i)
                                buf[i] = 0;

                } catch (Exception e) {
                        Console.WriteLine (&quot;Caught &quot; + e);
                        size /= 2;
                        continue;
                }

                Console.WriteLine (&quot;Can stackalloc &quot; + size + &quot; longs&quot;);
                break;
        }
        }
}

C:\Documents and Settings\Owner&gt;csc /unsafe StackAllocCrazy.cs
Microsoft (R) Visual C# .NET Compiler version 7.10.3052.4
for Microsoft (R) .NET Framework version 1.1.4322
Copyright (C) Microsoft Corporation 2001-2002. All rights reserved.


C:\Documents and Settings\Owner&gt;StackAllocCrazy.exe
Trying 1073741824 bytes ...
Caught System.NullReferenceException: Object reference not set to an instance of
 an object.
   at T.Main()
Trying 536870912 bytes ...
Caught System.NullReferenceException: Object reference not set to an instance of
 an object.
   at T.Main()
Trying 268435456 bytes ...


Regards,
Jambunathan K.
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032084.html">[Mono-dev] [PATCH] Suggested patch for bug #501666
</A></li>
	<LI>Next message: <A HREF="032039.html">[Mono-dev] Crazy StackAlloc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32036">[ date ]</a>
              <a href="thread.html#32036">[ thread ]</a>
              <a href="subject.html#32036">[ subject ]</a>
              <a href="author.html#32036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
