<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Resolving dependencies while compiling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Resolving%20dependencies%20while%20compiling&In-Reply-To=1242827861.5014.355.camel%40lina">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032203.html">
   <LINK REL="Next"  HREF="032206.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Resolving dependencies while compiling</H1>
    <B>Grzegorz Sobanski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Resolving%20dependencies%20while%20compiling&In-Reply-To=1242827861.5014.355.camel%40lina"
       TITLE="[Mono-dev] Resolving dependencies while compiling">silk at boktor.net
       </A><BR>
    <I>Wed May 20 11:23:29 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032203.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
        <LI>Next message: <A HREF="032206.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32204">[ date ]</a>
              <a href="thread.html#32204">[ thread ]</a>
              <a href="subject.html#32204">[ subject ]</a>
              <a href="author.html#32204">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>* Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jonpryor at vt.edu</A>&gt; [2009-05-20 15:59]:
[cut everything about extra copies and referencing]
&gt;<i> 	gmcs -t:library -lib:b/bin/Debug,a/bin/Debug c/c.cs -r:b.dll -r:a.dll
</I>
Yeap, all the above is true. And is the same for both VS and Mono.

But I think, that paszczi in his original mail missed the real problem:

&gt;<i> Now, if you don't want to specify the entire assembly dependency chain
</I>&gt;<i> (e.g. you only want to specify b.dll or X.dll, not both a.dll+b.dll or
</I>&gt;<i> X.dll+Y.dll), then you *must* have a copy/symlink:
</I>
The &quot;must&quot; is (un)fortunately not true for VS.
 
&gt;<i> 	cp a/bin/Debug/a.dll b/bin/Debug
</I>&gt;<i> 	gmcs -t:library c/c.cs -r:b/bin/Debug/b.dll
</I>
It is only true if c.cs (c.dll) uses types from a.dll.

Ex: if a.dll contains class LibA {...}
And b.dll contains 
class LibB {
  public string Met1 () { return &quot;hey!&quot;; }
  public LibA Met2 () { return new LibA (); }
}

I can sucessfully compile c.dll in VS if it only calls Met1, without
referencing a.dll, and without having any copies of a.dll laying around.
(after compiling b.dll I have deleted all a.dll files)
And I can even execute c.dll without having a.dll (as dependecies
are resolved at call time not at startup time. It is the same in Mono
I believe).

Unfortunately to compile c.dll in gmcs I need a a.dll even if c.dll
does not use any type from a.dll.

(If b.dll is referencing a.dll but does not have anything from a.dll
in it's public contract, then c.dll will compile fine in gmcs)


Now, some real-life example.
We are building modular software and using a bunch of libraries, for
example: Castle.MicroKernel, Castle.ActiveRecord, etc. (let's call them
tier 1)
They reference some more libaries. Iesi.Collections, NHibernate (tier 0)

We build modules (tier 2): ModuleA, ModuleB referencing and using a lot 
of tier 1 libraries (Castle.* mainly).

And those modules are used by some applications (tier 3). Now even if 
application is not using any types from Tier1 they are still needed
at compile time (in mono, not in VS). What's more, even dlls from Tier0
are needed.

There are different solutions we could use:
1) gmcs could compile like VS, not knowing the types from Tier0/1 -
   ideal
2) reference all dll's from Tier0/1 in application - bad
3) copy (symlink) all dll's from Tier0/1 to directory of every Module* (Tier2)
   - that's what we've been using until now. But it started to be 
     a real maintenance problem.
4) put all dll's from all Tiers to one directory - we want to avoid that
5) use MONO_PATH= during compilation to show directories where Tier0/1
   dll's can be found - we are using it now (I know it is 'not
   recommended' :P)
6) use -lib instead of MONO_PATH - but that would still mean adding to
   every project from Tier3 every directory from Tier0/1.
  
To sum up - problem is when I'm using b.dll which has something
from a.dll in it's public API, but I'm not consuming it. I would
like to skip a reference to a.dll in c.dll then.

(We can ensure in some other way that all needed dll's from tier0/1 
will be available at runtime).

Uff, a long mail ;P
greets

silk
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032203.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
	<LI>Next message: <A HREF="032206.html">[Mono-dev] Resolving dependencies while compiling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32204">[ date ]</a>
              <a href="thread.html#32204">[ thread ]</a>
              <a href="subject.html#32204">[ subject ]</a>
              <a href="author.html#32204">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
