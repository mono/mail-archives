<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] libgdiplus drawing performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20libgdiplus%20drawing%20performance&In-Reply-To=23395461.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="032034.html">
   <LINK REL="Next"  HREF="032012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] libgdiplus drawing performance</H1>
    <B>Sebastien Pouliot</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20libgdiplus%20drawing%20performance&In-Reply-To=23395461.post%40talk.nabble.com"
       TITLE="[Mono-dev] libgdiplus drawing performance">sebastien.pouliot at gmail.com
       </A><BR>
    <I>Wed May  6 13:48:05 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="032034.html">[Mono-dev] libgdiplus drawing performance
</A></li>
        <LI>Next message: <A HREF="032012.html">[Mono-dev] [PATCH] String.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32025">[ date ]</a>
              <a href="thread.html#32025">[ thread ]</a>
              <a href="subject.html#32025">[ subject ]</a>
              <a href="author.html#32025">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2009-05-05 at 13:36 -0700, Shade1974 wrote:
&gt;<i> First, let me say, I have been really excited about the mono project and am
</I>&gt;<i> an enthusiast on the grounds that it potentially might allow us to take our
</I>&gt;<i> C# programming multi-platform.  We are developing a C# application that
</I>&gt;<i> needs to draw thousands of separate lines.  I have been having trouble with
</I>&gt;<i> getting drawing to work quickly.  This is one of those unfortunate scenarios
</I>&gt;<i> where it seems almost impossible to Google anything useful, and it took a
</I>&gt;<i> long time before I discovered that you could group thousands of lines
</I>&gt;<i> together into a single drawing path and draw them all at once with a single
</I>&gt;<i> call to the graphics device (GDI+ API).  This is on the order of THOUSANDS
</I>&gt;<i> of times faster, not merely one or two times as fast.  Now, imagine my
</I>&gt;<i> distress after having implemented this blazingly quick drawing in windows
</I>&gt;<i> only to discover that MONO seems to be unable to duplicate this
</I>&gt;<i> optimization.  I believe that the problem originates because the managed
</I>&gt;<i> mono wrapper must take the single DrawPath instruction and sub-divide it
</I>&gt;<i> into the individual calls to the API.  This might be necessary when talking
</I>&gt;<i> to Cairo, but I thought on windows this was simply supposed to forward the
</I>&gt;<i> instructions to GDI+.  The fact that even the windows implementation is slow
</I>&gt;<i> tells me that it's possible that the authors simply didn't know that there
</I>&gt;<i> was a huge performance gain by calling a chunky DrawPath instead of chatty
</I>&gt;<i> individual calls, or else they would at least have supported it in the case
</I>&gt;<i> of windows.
</I>
You do realize that this is _all_ open source, right ? That makes it
easy (and faster) to look, instead of speculate, about what the code
actually does (or what the authors knows or not ;-)

Since you did not supply any code it's hard to be sure what could be
causing your problem. I won't speculate besides showing you that your
assumption is wrong since our managed DrawPath is quite simple:

		public void DrawPath (Pen pen, GraphicsPath path)
		{
			if (pen == null)
				throw new ArgumentNullException (&quot;pen&quot;);
			if (path == null)
				throw new ArgumentNullException (&quot;path&quot;);
			Status status = GDIPlus.GdipDrawPath (nativeObject, pen.nativeObject, path.nativePath);
			GDIPlus.CheckStatus (status);
		}

which in turns calls directly into unmanaged code (&#65279;so the path is *not*
broken into &quot;chatty&quot; api calls).

                [DllImport (&quot;gdiplus.dll&quot;)]
                static internal extern Status GdipDrawPath (IntPtr graphics, IntPtr pen, IntPtr path);

That means that this calls _directly_ on gdiplus.dll (which is MD GDI+
on Windows*). If MS.NET is faster on Windows (than Mono) then the real
performance problem lies elsewhere.

* &#65279;you'll need to look at libgdiplus source code for other platforms

&gt;<i> 
</I>&gt;<i> Anyway, like I said it took a huge amount of time before I even figured out
</I>&gt;<i> the optimization in the first place and I have just started to work with
</I>&gt;<i> mono.  It's quite probable that I am overlooking something straight forward,
</I>&gt;<i> but I'm having trouble figuring out what it is.  If anyone knows some
</I>&gt;<i> information that could help I'd be grateful.
</I>
In general (not graphics or even mono related) if you find a performance
problem please supply a test case that shows the issue*. That will help
people helping you. Otherwise you'll, at best, end up with various
opinions about (in this case) wrong facts - all time consuming for you
(and everyone else wanting to help).

Sebastien

* &#65279;extra bonus for filling it as a bug report on bugzilla.novell.com so
it does not get lost :)

</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="032034.html">[Mono-dev] libgdiplus drawing performance
</A></li>
	<LI>Next message: <A HREF="032012.html">[Mono-dev] [PATCH] String.cs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#32025">[ date ]</a>
              <a href="thread.html#32025">[ thread ]</a>
              <a href="subject.html#32025">[ subject ]</a>
              <a href="author.html#32025">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
