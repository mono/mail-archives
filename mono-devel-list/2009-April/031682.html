<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Using mdoc for internal documentation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Using%20mdoc%20for%20internal%20documentation&In-Reply-To=1F4C1056-2C26-4B18-8FCA-684C9D882535%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031678.html">
   <LINK REL="Next"  HREF="031683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Using mdoc for internal documentation</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Using%20mdoc%20for%20internal%20documentation&In-Reply-To=1F4C1056-2C26-4B18-8FCA-684C9D882535%40gmail.com"
       TITLE="[Mono-dev] Using mdoc for internal documentation">jonpryor at vt.edu
       </A><BR>
    <I>Thu Apr  9 17:20:01 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031678.html">[Mono-dev] Using mdoc for internal documentation
</A></li>
        <LI>Next message: <A HREF="031683.html">[Mono-dev] Using mdoc for internal documentation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31682">[ date ]</a>
              <a href="thread.html#31682">[ thread ]</a>
              <a href="subject.html#31682">[ subject ]</a>
              <a href="author.html#31682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 2009-04-09 at 12:56 -0700, Casey Marshall wrote:
&gt;<i> Nope. At least, it doesn't if I run monodoc like this:
</I>&gt;<i> 
</I>&gt;<i>    mdoc update --out=generated-docs --import=xmldoc/bar.xml
</I>&gt;<i> bin/Debug/bar.dll
</I>&gt;<i> 
</I>&gt;<i> ...and don't specify all the .dlls that foo.dll links to on the  
</I>&gt;<i> command line.
</I>
That should still cause problems anyway, though, as in some contexts
mdoc _needs_ the other assemblies, and it won't be able to find them (as
you're not listing them all).

For example:

	// assembly A.dll
	class Base&lt;TKey, TValue&gt; ...

	// assembly B.dll
	class Derived : Base&lt;string, string&gt; ...

The resulting Derived.xml file will contain:

  &lt;Base&gt;
    &lt;BaseTypeName&gt;Base&amp;lt;System.String,System.String&amp;gt;&lt;/BaseTypeName&gt;
    &lt;BaseTypeArguments&gt;
      &lt;BaseTypeArgument TypeParamName=&quot;TKey&quot;&gt;System.String&lt;/BaseTypeArgument&gt;
      &lt;BaseTypeArgument TypeParamName=&quot;TValue&quot;&gt;System.String&lt;/BaseTypeArgument&gt;
    &lt;/BaseTypeArguments&gt;
  &lt;/Base&gt;

However, mdoc can't determine the TypeParamName values without looking
up the Base&lt;TKey,TValue&gt; type, and if you don't specify all assemblies
then it won't be able to find it...

It sounds like mdoc needs to support a -r:ASSEMBLY argument (or
-lib:PATH), to reference assemblies (for later lookup) but NOT document
them, thus assisting these cross-assembly dependencies.

&gt;<i> From my understanding of things, the patch wouldn't fix  
</I>&gt;<i> this, since an assembly could still get constructed outside the method
</I>&gt;<i> modified there, and thus with a default resolver instance.
</I>
Indeed, yet another thing that hadn't occurred to me. :-(

&gt;<i> If I add all the assemblies involved to the command line, I get  
</I>&gt;<i> undocumented entries for all the members of those assemblies, since  
</I>&gt;<i> I'm not giving any --import options for their XML doc files. So, I'd  
</I>&gt;<i> rather not do it that way.
</I>
As an aside, it should be possible to merge all the XML from your
various assemblies and then import them all at once...but I don't know
of any automated way to do this, so constructing the merged XML would be
a manual process (and thus not ideal).

That said, I'm not sure it actually matters.  Sure, for the *first*
import, you'll get &quot;To be added&quot; members, but you can import multiple
times, e.g.

	ASSEMBLIES = A/bin/Debug/A.dll B/bin/Debug/B.dll # ...
	XML_DOCS = $(ASSEMBLIES:.dll=.xml)

	for doc in $(XML_DOCS) ; do \
	  mdoc update -o generated-docs -i $$doc $(ASSEMBLIES) ; \
	done

So (unfortunately from a performance perspective) you're still importing
all the assemblies multiple times, but you won't lose anything in
subsequent updates, and you'll import all the documentation you have.
This would also allow mdoc to find all the needed assemblies...

(The downside to this, which -r would fix, is that there are some
assemblies you depend upon but don't wish to document, e.g. libraries
that come from a third party.  So for this reason supporting -r would be
beneficial.)

&gt;<i> I applied the attached patch, and it seems to fix this for me. This is
</I>&gt;<i> probably wrong for various reasons, but it helps me get docs  
</I>&gt;<i> generated. What the patch does is use the idea of a static  
</I>&gt;<i> DefaultAssemblyResolver, and it falls back to that one if  
</I>&gt;<i> `type.Module.Assembly.Resolver' didn't look up the type successfully  
</I>&gt;<i> in DocUtils.GetTypeDefinition.
</I>
I find it similar to mine, actually, except for the added support for
assembly lookup in DocUtils.GetTypeDefinition() -- good catch, that --
but I'm still not certain that this is the best way.  Even with this
patch, it can't find all required assemblies in all circumstances (and
thus will return `null'), which would result in a loss of functionality
in certain corner cases (such as with Base&lt;TKey,TValue&gt;, above).

Do you think a -r or -lib option would work for you (or the &quot;multiple
import&quot; workaround suggested above)?

Thanks,
 - Jon


</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031678.html">[Mono-dev] Using mdoc for internal documentation
</A></li>
	<LI>Next message: <A HREF="031683.html">[Mono-dev] Using mdoc for internal documentation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31682">[ date ]</a>
              <a href="thread.html#31682">[ thread ]</a>
              <a href="subject.html#31682">[ subject ]</a>
              <a href="author.html#31682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
