<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Fixes related to the profiler writer thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Fixes%20related%20to%20the%20profiler%20writer%20thread&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031705.html">
   <LINK REL="Next"  HREF="031689.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Fixes related to the profiler writer thread</H1>
    <B>Massimiliano Mantione</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Fixes%20related%20to%20the%20profiler%20writer%20thread&In-Reply-To="
       TITLE="[Mono-dev] Fixes related to the profiler writer thread">massi at ximian.com
       </A><BR>
    <I>Fri Apr 10 07:03:02 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031705.html">[Mono-dev] Installer
</A></li>
        <LI>Next message: <A HREF="031689.html">[Mono-dev] Npgsql in SVN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31688">[ date ]</a>
              <a href="thread.html#31688">[ thread ]</a>
              <a href="subject.html#31688">[ subject ]</a>
              <a href="author.html#31688">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello!

I am running the runtime tests under the logging profiler (with various
options).

One problem I noticed is that the runtime sometimes waits for the
profiler writer thread, even if its manage callback returns false.
This makes so that some of the tests never terminates.

Another problem related to the profiler writer thread is that to detect
when it must detach from the runtime (and never access runtime data
structures again) it uses the thread manage callback.
The problem is, this callback is called as soon as the main thread
terminates, and in this way the profiler does not profile any thread
that continues its execution.
For this Rodrigo coded a patch in the past, that added one more callback
to MonoThread, but it has never been applied (it was not ok in that
form).

The attached patch is an attempt to solve the two problems.
It does not add generic mechanisms and is totally profiler-specific.
However, for the profiler's needs it's OK.

In the end the profiler needs two things:
- that its thread is left running (like the finalizer), and
- to know when its small_id is going to disappear (because the
statistical profiler cannot work without it).
So in the patch I do exactly these two things.

Is it acceptable or should we solve this problem in a different way?

Thanks!
  Massi

-------------- next part --------------
A non-text attachment was scrubbed...
Name: profiler-thread-callbacks.diff
Type: text/x-patch
Size: 3324 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090410/c88daaa7/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090410/c88daaa7/attachment.bin</A> 
</PRE>
















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031705.html">[Mono-dev] Installer
</A></li>
	<LI>Next message: <A HREF="031689.html">[Mono-dev] Npgsql in SVN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31688">[ date ]</a>
              <a href="thread.html#31688">[ thread ]</a>
              <a href="subject.html#31688">[ subject ]</a>
              <a href="author.html#31688">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
