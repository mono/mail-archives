<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Use eglib as a default for mono 2.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Use%20eglib%20as%20a%20default%20for%20mono%202.6&In-Reply-To=1240520750.17881.156.camel%40erandi.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031872.html">
   <LINK REL="Next"  HREF="031849.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Use eglib as a default for mono 2.6</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Use%20eglib%20as%20a%20default%20for%20mono%202.6&In-Reply-To=1240520750.17881.156.camel%40erandi.site"
       TITLE="[Mono-dev] Use eglib as a default for mono 2.6">lupus at ximian.com
       </A><BR>
    <I>Fri Apr 24 12:35:42 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031872.html">[Mono-dev] Use eglib as a default for mono 2.6
</A></li>
        <LI>Next message: <A HREF="031849.html">[Mono-dev] Mono 2.4 - glib requirement issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31879">[ date ]</a>
              <a href="thread.html#31879">[ thread ]</a>
              <a href="subject.html#31879">[ subject ]</a>
              <a href="author.html#31879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/23/09 Miguel de Icaza wrote:
&gt;<i>     The cons are:
</I>&gt;<i> 
</I>&gt;<i> 	* We still need to deprecate/break the API for the functions
</I>&gt;<i> 	  listed in [1]
</I>
At some point we need to break API/ABI anyway, since it's required for
the new GC, we need to hide some implementation details that are
currently exposed, like MonoArrayType, MonoMethodSignature, MonoType
itself, MonoTypeNameParse, MonoArray and a few ugly API entry points.
We need to coordinate to break the API/ABI just once for all the needs,
we can't break it 2-3 times.

&gt;<i> There are still a handful of places where glib is better than eglib,
</I>&gt;<i> tiny bits here and there, but nothing really major.
</I>
There are several reasons for having our own code, in no particular
order:
*) remove a dependency which is getting bigger every day
*) being able to inspect inside the data structures (GHashTable for
example is opaque and several times I needed to inspect it for
debugging; in other cases we'd need to check if the hash distribution is
good and we can't with GHashTable)
*) GLib doesn't support some APIs we need: a GHashTable foreach that can
be early-terminated is one example, we currently waste time visiting it
all even if we found what we were looking for.
*) we'll never be able to control out of memory cases with glib since it
just dies. This can happen in many cases even if plenty of memory is
otherwise available for recovery or graceful handling.
*) glib installs a compiler-specific file, so the same compiler must be
used for mono and glib (this mainly confuses the solaris users, but there
are also other cases)
*) mono can't be used as a plugin in single-threaded apps that use glib
(glib inited without threading support-&gt; we die)
*) we need about 50 kb of readonly text section to implement the
features we need, just linking with glib brings 20 KB of writable
memory and several pages of text.
*) we really just use a tiny subset of glib the API/ABI break is a good
time to switch for the above advantages

&gt;<i> We could also make sure that the structures map 1 to 1 to the Glib
</I>&gt;<i> structures for the ones that we use, that would prevent the need to even
</I>&gt;<i> break the API when using the remapping macros. 
</I>
It doesn't matter, we need to break the API/ABI anyway and such hacks
are better avoided.

&gt;<i> But I can see why this last one might make some people uncomfortable.
</I>&gt;<i> 
</I>&gt;<i> [1] This is the list of public API entry points that expose Glib data
</I>&gt;<i> structures.
</I>&gt;<i> 
</I>&gt;<i> metadata/assembly.h:void      mono_assembly_foreach    (GFunc func, gpointer user_data);
</I>&gt;<i> metadata/verify.h:GSList* mono_image_verify_tables (MonoImage *image, int level);
</I>&gt;<i> metadata/verify.h:GSList* mono_method_verify       (MonoMethod *method, int level);
</I>&gt;<i> metadata/verify.h:void    mono_free_verify_list    (GSList *list);
</I>[...]

There are others, like the ones exposing MonoTypeNameParse, plus all the
ones where one is supposed to free results with g_free().

As for the cases where glib might be faster than eglib (small struct
allocations, for examples) it's likely that we should optimize mono not
do abuse them, because if it's significant in the overall time for mono
apps something looks wrong.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031872.html">[Mono-dev] Use eglib as a default for mono 2.6
</A></li>
	<LI>Next message: <A HREF="031849.html">[Mono-dev] Mono 2.4 - glib requirement issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31879">[ date ]</a>
              <a href="thread.html#31879">[ thread ]</a>
              <a href="subject.html#31879">[ subject ]</a>
              <a href="author.html#31879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
