<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Implement support for compiled regular	expressions in profile 1.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Implement%20support%20for%20compiled%20regular%0A%09expressions%20in%20profile%201.x&In-Reply-To=F862A637-3A1E-414B-9038-F374CBF8A744%40unity3d.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031666.html">
   <LINK REL="Next"  HREF="031665.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Implement support for compiled regular	expressions in profile 1.x</H1>
    <B>Zoltan Varga</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Implement%20support%20for%20compiled%20regular%0A%09expressions%20in%20profile%201.x&In-Reply-To=F862A637-3A1E-414B-9038-F374CBF8A744%40unity3d.com"
       TITLE="[Mono-dev] [PATCH] Implement support for compiled regular	expressions in profile 1.x">vargaz at gmail.com
       </A><BR>
    <I>Thu Apr  9 09:00:36 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="031666.html">[Mono-dev] [PATCH] Implement support for compiled regular	expressions in profile 1.x
</A></li>
        <LI>Next message: <A HREF="031665.html">[Mono-dev] Mono 1.0 and 2.0 profiles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31672">[ date ]</a>
              <a href="thread.html#31672">[ thread ]</a>
              <a href="subject.html#31672">[ subject ]</a>
              <a href="author.html#31672">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

  The new JIT in mono 2.4 generates better/smaller code. Here are some
numbers:

1.0 mscorlib produced by mono 2.0: 3724380
1.0 mscorlib produced by mono 2.4: 3364076
2.0 mscorlib produced by mono SVN HEAD: 4255364

Obviously the mscorlib 2.0 stuff still needs some work, but the 1.0 number
is much better.

                 Zoltan

On Wed, Apr 8, 2009 at 4:50 PM, Mantas Puida &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mantas at unity3d.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can you give us a breakdown of the size of the many files produced by mono?
</I>&gt;<i> Like sizes of the runtime, assemblies after linking/stripping and AOT'd
</I>&gt;<i> binaries.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I can't get exact numbers for profile 2.0 because it doesn't work with
</I>&gt;<i> mono-2-0 AOT, so best what I can do is to extrapolate numbers from profile
</I>&gt;<i> 1.0 data.
</I>&gt;<i>
</I>&gt;<i> There are some numbers for profile 1.0 when mono linker is NOT used:
</I>&gt;<i>
</I>&gt;<i> Total size for sample iPhone application made with Unity (it includes Unity
</I>&gt;<i> engine + .NET interface to its functions, physX, libcurl, mono runtime and
</I>&gt;<i> AOTed mscorlib.dll):
</I>&gt;<i> 15,999,648 bytes
</I>&gt;<i>
</I>&gt;<i> breakdown of this number
</I>&gt;<i> a) Mono runtime compiled for ARM
</I>&gt;<i>  with --enable-minimal=jit,reflection_emit,profiler,com option
</I>&gt;<i> takes 1,790,384 bytes.
</I>&gt;<i> b) mscorlib.dll (.dll size 2,081,280 bytes) AOTed code size:  6,703,136
</I>&gt;<i> c) UnityEngine.dll (.dll size 376,320 bytes) AOTed code size: 2,313,696
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Numbers when mono linker IS used:
</I>&gt;<i>
</I>&gt;<i> Total size for sample iPhone application made with Unity (it includes Unity
</I>&gt;<i> engine + .NET interface to its functions, physX, libcurl, mono runtime and
</I>&gt;<i> AOTed mscorlib.dll):
</I>&gt;<i> 11,791,088 bytes
</I>&gt;<i> breakdown of this number
</I>&gt;<i> a) Mono runtime compiled for ARM
</I>&gt;<i>  with --enable-minimal=jit,reflection_emit,profiler,com option
</I>&gt;<i> takes 1,790,384 bytes.
</I>&gt;<i> b) mscorlib.dll (.dll size 1,418,240 bytes, we use less strict than default
</I>&gt;<i> monolinker blacklist for mscorlib) AOTed code size:  4,259,216 bytes
</I>&gt;<i> c) UnityEngine.dll (.dll size 112,128 bytes) AOTed code size: 543,024 bytes
</I>&gt;<i>
</I>&gt;<i> In general mono linker does great job (when supplied with &quot;optimized&quot;
</I>&gt;<i> blacklists).
</I>&gt;<i>
</I>&gt;<i> Numbers written above are just for empty application and if you add
</I>&gt;<i> something useful like Sockets to you C# scripts then suddenly main binary
</I>&gt;<i> size explodes, reaches 28 MB and more, iPhone SDK linker fails to link it,
</I>&gt;<i> so use of .NET Sockets without mono linker step is impossible.
</I>&gt;<i>
</I>&gt;<i> Numbers for application that uses Sockets and goes through mono linker:
</I>&gt;<i>
</I>&gt;<i> Total size: 14,0334,40 bytes.
</I>&gt;<i>
</I>&gt;<i> breakdown of this number
</I>&gt;<i> a) Mono runtime compiled for ARM
</I>&gt;<i>  with --enable-minimal=jit,reflection_emit,profiler,com option
</I>&gt;<i> takes 1,790,384 bytes.
</I>&gt;<i> b) mscorlib.dll (.dll size 1,430,016 bytes) AOTed code size:  4,298,672
</I>&gt;<i> c) System.Xml.dll (.dll size 557,056 bytes after mono linker) AOTed code
</I>&gt;<i> size:  1,725,872 bytes
</I>&gt;<i> d) System.dll (.dll size 130048 bytes after mono linker) AOTed code size:
</I>&gt;<i>  462,416 bytes
</I>&gt;<i> e) UnityEngine.dll (.dll size 112,128 bytes) AOTed code size: 543,024
</I>&gt;<i>
</I>&gt;<i> So adding of reference to .NET Socket API adds two new dependencies
</I>&gt;<i> System.dll and System.Xml.dll and ends up with 2.1 MB of additional ARM
</I>&gt;<i> code.
</I>&gt;<i>
</I>&gt;<i> I checked what dependencies would be in the case of 2.0 profile when
</I>&gt;<i> application is using sockets:
</I>&gt;<i> Mono.Security.dll - official size 285,696 bytes, after monolinker - N/A*
</I>&gt;<i> System.Configuration.dll - official size 117,760 bytes, after monolinker -
</I>&gt;<i> N/A*
</I>&gt;<i> System.Security.dll - official size 132,608 bytes, after monolinker - N/A*
</I>&gt;<i> System.Xml.dll - official size 1,250,304 bytes, after monolinker - N/A*
</I>&gt;<i> System.dll - official size 1,467,392 bytes, after monolinker - N/A*
</I>&gt;<i> mscorlib.dll - official size 2,508,288 bytes, after monolinker - 1,640,960.
</I>&gt;<i>
</I>&gt;<i> after monolinker - N/A* means that currently my version of monolinker
</I>&gt;<i> strips these dll too much (no exported types are left), so I can't get these
</I>&gt;<i> numbers without fixing mono linker.
</I>&gt;<i>
</I>&gt;<i> I would estimate that in total it would increase our footprint for sample
</I>&gt;<i> Sockets application at least by 1 MB (bigger mscorlib + 3 additional
</I>&gt;<i> dependencies)
</I>&gt;<i>
</I>&gt;<i> Would us help Silverlight profile? I doubt it, because we are using shorter
</I>&gt;<i> mono linker blacklist for mscorlib  and we are achieving smaller working
</I>&gt;<i> size of this lib already.
</I>&gt;<i> I think these big binary size (and also big memory footprint) is common for
</I>&gt;<i> other embedded devices, not just iPhone.
</I>&gt;<i>
</I>&gt;<i> I see mscorlib (and other libraries) profile 1.0 as best fit for embedded
</I>&gt;<i> devices.
</I>&gt;<i>
</I>&gt;<i> Miguel, I saw your comment that people who are using profile 1.0  should
</I>&gt;<i> stick with mono-2-4 then I would like to ask what about AOT on other
</I>&gt;<i> platforms support? Let's say mono adds PPC AOT support to mono-2-6 will it
</I>&gt;<i> be backported to mono-2-4? If not then I see the problem how mono based
</I>&gt;<i> applications could be developed for small devices that currently are not
</I>&gt;<i> supported by mono-2-4, but maybe will be supported in the next versions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> There are a lot of optimizations that can be done to reduce footprint like
</I>&gt;<i> embedding
</I>&gt;<i> assemblies content in the AOT'd image in a compact form and improving the
</I>&gt;<i> ARM code
</I>&gt;<i> generator.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Embedding something into AOT'd image (mean linked into main app binary)
</I>&gt;<i> makes everything worse in respect to binary size and maybe memory footprint.
</I>&gt;<i> Maybe I'm missing something in your idea?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Mantas Puida
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090409/7498c943/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20090409/7498c943/attachment.html</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031666.html">[Mono-dev] [PATCH] Implement support for compiled regular	expressions in profile 1.x
</A></li>
	<LI>Next message: <A HREF="031665.html">[Mono-dev] Mono 1.0 and 2.0 profiles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31672">[ date ]</a>
              <a href="thread.html#31672">[ thread ]</a>
              <a href="subject.html#31672">[ subject ]</a>
              <a href="author.html#31672">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
