<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: mcs/class/corlib/System.Collections CaseInsensitiveHashCodeProvider.cs,1.11,1.12 ChangeLog,1.114,1.115
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20mcs/class/corlib/System.Collections%0A%20CaseInsensitiveHashCodeProvider.cs%2C1.11%2C1.12%20ChangeLog%2C1.114%2C1.115&In-Reply-To=20040425114254.3170A9474B%40mono-cvs.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005145.html">
   <LINK REL="Next"  HREF="005149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: mcs/class/corlib/System.Collections CaseInsensitiveHashCodeProvider.cs,1.11,1.12 ChangeLog,1.114,1.115</H1>
    <B>Lluis Sanchez</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20mcs/class/corlib/System.Collections%0A%20CaseInsensitiveHashCodeProvider.cs%2C1.11%2C1.12%20ChangeLog%2C1.114%2C1.115&In-Reply-To=20040425114254.3170A9474B%40mono-cvs.ximian.com"
       TITLE="[Mono-devel-list] Re: mcs/class/corlib/System.Collections CaseInsensitiveHashCodeProvider.cs,1.11,1.12 ChangeLog,1.114,1.115">lluis at ximian.com
       </A><BR>
    <I>Mon Apr 26 05:17:45 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005145.html">[Mono-devel-list] Corlib status
</A></li>
        <LI>Next message: <A HREF="005149.html">[Mono-devel-list] [PATCH] Don't spill return from call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5146">[ date ]</a>
              <a href="thread.html#5146">[ thread ]</a>
              <a href="subject.html#5146">[ subject ]</a>
              <a href="author.html#5146">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

This change will make CaseInsensitiveHashCodeProvider to always use the
culture of the thread that created the instance, not the current culture
of the calling thread. I wonder if this is the intended behavior.

Lluis.

On dg, 2004-04-25 at 13:42, Andreas Nahr  wrote:
&gt;<i> Update of /cvs/public/mcs/class/corlib/System.Collections
</I>&gt;<i> In directory mono-cvs.ximian.com:/tmp/cvs-serv12155
</I>&gt;<i> 
</I>&gt;<i> Modified Files:
</I>&gt;<i> 	CaseInsensitiveHashCodeProvider.cs ChangeLog 
</I>&gt;<i> Log Message:
</I>&gt;<i> 2004-04-25  Andreas Nahr &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ClassDevelopment at A-SoftTech.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 	* CaseInsensitiveHashCodeProvider.cs: Fix the default constructor (needs to
</I>&gt;<i> 	  set CurrentCulture, Add null check to other constructor, Call correct function
</I>&gt;<i> 	  for invariant case, ensure culture is set to null for invariant case, removed
</I>&gt;<i> 	  static constructor, made invariant version available as internal in .Net 1.0
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Index: CaseInsensitiveHashCodeProvider.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> RCS file: /cvs/public/mcs/class/corlib/System.Collections/CaseInsensitiveHashCodeProvider.cs,v
</I>&gt;<i> retrieving revision 1.11
</I>&gt;<i> retrieving revision 1.12
</I>&gt;<i> diff -u -d -r1.11 -r1.12
</I>&gt;<i> --- CaseInsensitiveHashCodeProvider.cs	21 Apr 2004 21:29:28 -0000	1.11
</I>&gt;<i> +++ CaseInsensitiveHashCodeProvider.cs	25 Apr 2004 11:42:52 -0000	1.12
</I>&gt;<i> @@ -16,31 +16,31 @@
</I>&gt;<i>  	[Serializable]
</I>&gt;<i>  	public class CaseInsensitiveHashCodeProvider : IHashCodeProvider {
</I>&gt;<i>  
</I>&gt;<i> -		private static CaseInsensitiveHashCodeProvider singleton;
</I>&gt;<i> -		private static CaseInsensitiveHashCodeProvider singletonInvariant;
</I>&gt;<i> +		private static CaseInsensitiveHashCodeProvider singleton = new CaseInsensitiveHashCodeProvider ();
</I>&gt;<i> +		private static CaseInsensitiveHashCodeProvider singletonInvariant = new CaseInsensitiveHashCodeProvider (true);
</I>&gt;<i>  		
</I>&gt;<i>  		CultureInfo culture;
</I>&gt;<i>  
</I>&gt;<i> -
</I>&gt;<i> -		// Class constructor
</I>&gt;<i> -
</I>&gt;<i> -		static CaseInsensitiveHashCodeProvider ()
</I>&gt;<i> -		{
</I>&gt;<i> -			singleton = new CaseInsensitiveHashCodeProvider ();
</I>&gt;<i> -			singletonInvariant = new CaseInsensitiveHashCodeProvider (CultureInfo.InvariantCulture);
</I>&gt;<i> -		}
</I>&gt;<i> -
</I>&gt;<i> -
</I>&gt;<i> -
</I>&gt;<i>  		// Public instance constructor
</I>&gt;<i>  
</I>&gt;<i>  		public CaseInsensitiveHashCodeProvider ()
</I>&gt;<i> -		{
</I>&gt;<i> +		{
</I>&gt;<i> +			culture = CultureInfo.CurrentCulture;
</I>&gt;<i> +		}
</I>&gt;<i> +
</I>&gt;<i> +		public CaseInsensitiveHashCodeProvider (bool invariant)
</I>&gt;<i> +		{
</I>&gt;<i> +			// leave culture == null
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i>  		public CaseInsensitiveHashCodeProvider (CultureInfo culture)
</I>&gt;<i> -		{
</I>&gt;<i> -			this.culture = culture;
</I>&gt;<i> +		{
</I>&gt;<i> +			if (culture == null)
</I>&gt;<i> + 				throw new ArgumentNullException (&quot;culture&quot;);
</I>&gt;<i> +
</I>&gt;<i> +			if (culture.LCID != CultureInfo.InvariantCulture.LCID)
</I>&gt;<i> +				this.culture = culture;
</I>&gt;<i> +			// else leave culture == null
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> @@ -55,13 +55,15 @@
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i>  #if NET_1_1
</I>&gt;<i> -		public static CaseInsensitiveHashCodeProvider DefaultInvariant {
</I>&gt;<i> +		public
</I>&gt;<i> +#else
</I>&gt;<i> +		internal
</I>&gt;<i> +#endif
</I>&gt;<i> +		static CaseInsensitiveHashCodeProvider DefaultInvariant {
</I>&gt;<i>  			get {
</I>&gt;<i>  				return singletonInvariant;
</I>&gt;<i>  			}
</I>&gt;<i>  		}
</I>&gt;<i> -#endif
</I>&gt;<i> -
</I>&gt;<i>  
</I>&gt;<i>  		//
</I>&gt;<i>  		// Instance methods
</I>&gt;<i> @@ -73,9 +75,8 @@
</I>&gt;<i>  
</I>&gt;<i>  		public int GetHashCode (object obj)
</I>&gt;<i>  		{
</I>&gt;<i> -			if (obj == null) {
</I>&gt;<i> -				throw new ArgumentNullException (&quot;obj is null&quot;);
</I>&gt;<i> -			}
</I>&gt;<i> +			if (obj == null)
</I>&gt;<i> +				throw new ArgumentNullException (&quot;obj&quot;);
</I>&gt;<i>  
</I>&gt;<i>  			string str = obj as string;
</I>&gt;<i>  
</I>&gt;<i> @@ -94,7 +95,7 @@
</I>&gt;<i>  			}
</I>&gt;<i>  			else {
</I>&gt;<i>  				for (int i = 0;i&lt;length;i++) {
</I>&gt;<i> -					c = Char.ToLower (str [i]);
</I>&gt;<i> +					c = Char.ToLowerInvariant (str [i]);
</I>&gt;<i>  					h = h * 31 + c;
</I>&gt;<i>  				}
</I>&gt;<i>  			}
</I>&gt;<i> 
</I>&gt;<i> Index: ChangeLog
</I>&gt;<i> ===================================================================
</I>&gt;<i> RCS file: /cvs/public/mcs/class/corlib/System.Collections/ChangeLog,v
</I>&gt;<i> retrieving revision 1.114
</I>&gt;<i> retrieving revision 1.115
</I>&gt;<i> diff -u -d -r1.114 -r1.115
</I>&gt;<i> --- ChangeLog	21 Apr 2004 21:29:28 -0000	1.114
</I>&gt;<i> +++ ChangeLog	25 Apr 2004 11:42:52 -0000	1.115
</I>&gt;<i> @@ -1,3 +1,10 @@
</I>&gt;<i> +2004-04-25  Andreas Nahr &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ClassDevelopment at A-SoftTech.com</A>&gt;
</I>&gt;<i> +
</I>&gt;<i> +	* CaseInsensitiveHashCodeProvider.cs: Fix the default constructor (needs to
</I>&gt;<i> +	  set CurrentCulture, Add null check to other constructor, Call correct function
</I>&gt;<i> +	  for invariant case, ensure culture is set to null for invariant case, removed
</I>&gt;<i> +	  static constructor, made invariant version available as internal in .Net 1.0
</I>&gt;<i> +
</I>&gt;<i>  2004-04-21  Lluis Sanchez Gual  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lluis at ximian.com</A>&gt;
</I>&gt;<i>  
</I>&gt;<i>  	* CaseInsensitiveHashCodeProvider.cs: If the culture is null, don't use
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-patches maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-patches at ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-patches">http://lists.ximian.com/mailman/listinfo/mono-patches</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005145.html">[Mono-devel-list] Corlib status
</A></li>
	<LI>Next message: <A HREF="005149.html">[Mono-devel-list] [PATCH] Don't spill return from call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5146">[ date ]</a>
              <a href="thread.html#5146">[ thread ]</a>
              <a href="subject.html#5146">[ subject ]</a>
              <a href="author.html#5146">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
