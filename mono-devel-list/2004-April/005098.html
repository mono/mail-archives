<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Extension to mcs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Extension%20to%20mcs&In-Reply-To=1082661960.2852.40.camel%40juerg-p4.bitron.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005097.html">
   <LINK REL="Next"  HREF="005101.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Extension to mcs</H1>
    <B>Kamil Skalski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Extension%20to%20mcs&In-Reply-To=1082661960.2852.40.camel%40juerg-p4.bitron.ch"
       TITLE="[Mono-devel-list] Extension to mcs">nazgul at omega.pl
       </A><BR>
    <I>Thu Apr 22 16:29:23 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005097.html">[Mono-devel-list] Extension to mcs
</A></li>
        <LI>Next message: <A HREF="005101.html">[Mono-devel-list] Extension to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5098">[ date ]</a>
              <a href="thread.html#5098">[ thread ]</a>
              <a href="subject.html#5098">[ subject ]</a>
              <a href="author.html#5098">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thursday 22 of April 2004 21:26, J&#252;rg Billeter wrote:
&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i> I'd like to add support for &quot;Design by Contract&quot; [1] to the Mono C#
</I>&gt;<i> compiler using custom attributes - kind of what eXtensible C# [2] does.
</I>
It's quite interesting, as we work on similar thing in Nemerle 
(<A HREF="http://nemerle.org">http://nemerle.org</A>). Our language introduces general compile-time macros. We 
already have working meta-programming system transforming parse-trees just 
before typing procedures during compilation. We have also special system of 
&quot;code quotation&quot; (derived from Template Haskell, Scheme, etc.) to build and 
decompose parsetrees. 

Our macros are currently used like common functions
def k = 5;
print (&quot;There are $k nodes&quot;);  // print is a macro which prints value of k

(they transform syntax-trees passed to them by parameters and returns new 
syntax tree, which is inlined in the place where they occur)

Next stage of our development with regard to macros is placing their 
invocation in custom attributes.
[AddSerializeMethod]
class Customer {
...
public Foo ([NotNull] o : object) : void { .. }
}

so we can algorithmically transform classes and their bodies at compile-time.

So, any design decision you will make about macros in attributes would be very 
interesting for me, as I will also implement them in near future.

&gt;<i> This requires the dynamic modification of the code tree after the parse
</I>&gt;<i> step of mcs. At the moment there is AFAIK no possibility to extend mcs
</I>
In general it is possible to embedd macro system into compiler in a very 
elegant way. In Nemerle we just have one or two places between parsing and 
typing, where macro expansion is done. Much more work comes when you want to 
make manipulation of given syntax trees easier for programmer - this involves 
quotation system, hygine, lexical scoping, etc. It is also very interesting 
for me what design would you choose to manipulate code. As I looked at 
eXtensible C# they use pure (and hard to read) API to do this.

&gt;<i> like that without forking it. But it seems that such extensions are
</I>&gt;<i> possible with very little modification of mcs. Specifically that'd be:
</I>&gt;<i> - a hook event after the parse step, probably in MainDriver
</I>&gt;<i> - a public get property for the statements member in the Block class
</I>
I'm also curious if macro system could be as relatively easily added to mcs 
compiler as in Nemerle. 

&gt;<i>
</I>&gt;<i> Perhaps more changes will become necessary but such little modifications
</I>&gt;<i> shouldn't hurt. So, my question is now, can I assume that a patch
</I>&gt;<i> integrating these changes would be accepted or are there some
</I>&gt;<i> fundamental issues I've overlooked?
</I>
Compiling and loading of code transformation programs comes into my mind, but 
it can be also solved easily. Much depends on power which you would like to 
give your custom attributes and design decisions about how they are written.

Kamil Skalski
----
Nemerle developer;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005097.html">[Mono-devel-list] Extension to mcs
</A></li>
	<LI>Next message: <A HREF="005101.html">[Mono-devel-list] Extension to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5098">[ date ]</a>
              <a href="thread.html#5098">[ thread ]</a>
              <a href="subject.html#5098">[ subject ]</a>
              <a href="author.html#5098">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
