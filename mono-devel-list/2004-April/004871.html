<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Opcode decomposition
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Opcode%20decomposition&In-Reply-To=1081206804.5111.5.camel%40Ben">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004866.html">
   <LINK REL="Next"  HREF="004879.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Opcode decomposition</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Opcode%20decomposition&In-Reply-To=1081206804.5111.5.camel%40Ben"
       TITLE="[Mono-devel-list] [PATCH] Opcode decomposition">lupus at ximian.com
       </A><BR>
    <I>Tue Apr  6 07:28:55 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004866.html">[Mono-devel-list] [PATCH] Opcode decomposition
</A></li>
        <LI>Next message: <A HREF="004879.html">[Mono-devel-list] [PATCH] Opcode decomposition
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4871">[ date ]</a>
              <a href="thread.html#4871">[ thread ]</a>
              <a href="subject.html#4871">[ subject ]</a>
              <a href="author.html#4871">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/05/04 Ben Maurer wrote:
&gt;<i> On Mon, 2004-04-05 at 14:24, Paolo Molaro wrote:
</I>&gt;<i> &gt; &gt; +#define NEW_LOAD_MEMBASE(cfg,dest,source,offset,op) do { \
</I>&gt;<i> &gt; &gt; +		MonoInst* load_source; \
</I>&gt;<i> &gt; &gt; +		if (offset != 0) { \
</I>&gt;<i> &gt; &gt; +			MonoInst* offset_inst; \
</I>&gt;<i> &gt; &gt; +			NEW_ICONST (cfg, offset_inst, offset); \
</I>&gt;<i> &gt; &gt; +			MONO_INST_NEW (cfg, load_source, CEE_ADD); \
</I>&gt;<i> &gt; &gt; +			load_source-&gt;cil_code = source-&gt;cil_code; \
</I>&gt;<i> &gt; &gt; +			load_source-&gt;inst_left = source; \
</I>&gt;<i> &gt; &gt; +			load_source-&gt;inst_right = offset_inst; \
</I>&gt;<i> &gt; &gt; +			load_source-&gt;type = STACK_MP; \
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; STACK_MP is not always correct when you use the macro in this way.
</I>&gt;<i> &gt; In the new jit we try to maintain the info on managed/unmanaged
</I>&gt;<i> &gt; pointers, at least until burg is involved or going to a precise GC will
</I>&gt;<i> &gt; be even more difficult than it already is.
</I>&gt;<i> 
</I>&gt;<i> I copied this code over from CEE_LDFLD, I am not sure exactly what I
</I>&gt;<i> should be doing here. And it should probably be fixed there too...
</I>
No, it's perfectly correct there: read the spec about managed pointers.
It's your code which is incorrect. When it's used to implement STRLEN
it's fine, since the length is stored in managed memory. When you use it
to access fields in unmanaged structures it's no longer correct.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004866.html">[Mono-devel-list] [PATCH] Opcode decomposition
</A></li>
	<LI>Next message: <A HREF="004879.html">[Mono-devel-list] [PATCH] Opcode decomposition
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4871">[ date ]</a>
              <a href="thread.html#4871">[ thread ]</a>
              <a href="subject.html#4871">[ subject ]</a>
              <a href="author.html#4871">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
