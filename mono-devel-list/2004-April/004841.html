<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] &quot;xml-trace&quot; option for mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%22xml-trace%22%20option%20for%20mono&In-Reply-To=1081084872.3664.84.camel%40Cyprus">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004833.html">
   <LINK REL="Next"  HREF="005045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] &quot;xml-trace&quot; option for mono</H1>
    <B>Gonzalo Paniagua Javier</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%22xml-trace%22%20option%20for%20mono&In-Reply-To=1081084872.3664.84.camel%40Cyprus"
       TITLE="[Mono-devel-list] &quot;xml-trace&quot; option for mono">gonzalo at ximian.com
       </A><BR>
    <I>Sun Apr  4 19:22:20 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004833.html">[Mono-devel-list] &quot;xml-trace&quot; option for mono
</A></li>
        <LI>Next message: <A HREF="005045.html">[Mono-devel-list] &quot;xml-trace&quot; option for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4841">[ date ]</a>
              <a href="thread.html#4841">[ thread ]</a>
              <a href="subject.html#4841">[ subject ]</a>
              <a href="author.html#4841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>El dom, 04-04-2004 a las 15:21, Juraj Skripsky escribi&#243;:
&gt;<i> Hello Paolo,
</I>&gt;<i> 
</I>&gt;<i> I cooked up a patch which adds a loadable trace profiler. It's not quite
</I>&gt;<i> finished as I ran into a few problems.
</I>&gt;<i> 
</I>&gt;<i> The new trace profiler should offer all the feature of the current one.
</I>&gt;<i> The profiler interface needs to be changed/extended to make this
</I>&gt;<i> possible:
</I>&gt;<i> 
</I>&gt;<i> - The callback functions for method_enter and method_leave need to
</I>&gt;<i> receive not only the method signature but also parameters passed to it
</I>&gt;<i> as well as the value returned. Today's tracing code uses this:
</I>&gt;<i> 
</I>&gt;<i>   void mono_trace_enter_method (MonoMethod *method, char *ebp)
</I>&gt;<i>   void mono_trace_leave_method (MonoMethod *method, ...)
</I>&gt;<i> 
</I>&gt;<i> I could add &quot;char *ebp&quot; and &quot;...&quot; to the enter and leave function
</I>&gt;<i> signature as this information might be interesting for other profilers
</I>&gt;<i> too. A new flag in MonoProfileFlags (MONO_PROFILE_ENTER_LEAVE_DATA?)
</I>&gt;<i> would control whether &quot;ebp&quot;/&quot;...&quot;  are filled or left &quot;empty&quot;. The code
</I>&gt;<i> in mono_arch_instrument_{prolog,epilog} would probably have to be
</I>&gt;<i> adjusted for the &quot;empty&quot; case.
</I>&gt;<i> 
</I>&gt;<i> - There are no profiling hooks yet in the exception code (but there is a
</I>&gt;<i> MONO_PROFILE_EXCEPTIONS flag). Today's tracing code prints messages
</I>&gt;<i> whenever an exception is thrown, caught or &quot;finallyed&quot; (just grep for
</I>&gt;<i> &quot;mono_jit_trace_calls != NULL&quot;...).
</I>&gt;<i> I haven't looked at the exception code too closely, so I have no idea
</I>&gt;<i> whether it is difficult to add the hooks or not...
</I>&gt;<i> 
</I>&gt;<i> - The mono_profiler_startup(const char *desc) function needs an
</I>&gt;<i> additional parameter &quot;MonoAssembly *assembly&quot; so we can still have
</I>&gt;<i> program-traces (i.e. &quot;mono --trace=program ...&quot;). Knowing the &quot;home&quot;
</I>&gt;<i> assembly would be interesting to other profilers too.
</I>&gt;<i> A gboolean return value for mono_profiler_startup would also be nice to
</I>&gt;<i> be able to signal invalid profiling options in &quot;desc&quot;.
</I>&gt;<i> (btw: I modified the code of &quot;mono_profiler_load&quot; to strip away the
</I>&gt;<i> &quot;modulename:&quot; before passing the options to mono_profiler_startup. This
</I>&gt;<i> makes the code shorter and more simple.)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Should I also replace the trace calls in &quot;aot.c&quot; (grep for
</I>&gt;<i> &quot;mono_trace_calls != NULL&quot;) with profiler hooks?
</I>&gt;<i> 
</I>&gt;<i> I also tried to move the default profiler out of &quot;profiler.c&quot; and into a
</I>&gt;<i> loadable module (called &quot;simple&quot; for now). It compiles fine but mono
</I>&gt;<i> stops with:
</I>&gt;<i>   mono: relocation error: /usr/local/lib/libmono-profiler-simple.so:
</I>&gt;<i>   undefined symbol: TlsAlloc
</I>&gt;<i> 
</I>&gt;<i> This looks like some sort of linking problem. Unfortunately, the world
</I>&gt;<i> of autoconf/-make/libtool/... still look pretty mysterious to me. So I'm
</I>&gt;<i> completely lost with this problem...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I left the current trace code in for now. The new trace profiler takes
</I>&gt;<i> the same arguments and can be started like this:
</I>&gt;<i>   mono --profile=trace:T:System.String test.exe
</I>&gt;<i> 
</I>&gt;<i> The attached .c files go into the profiler directory.
</I>&gt;<i> 
</I>&gt;<i> What do you think?
</I>
I suggest using a GSList for keeping more than one method filter.

-Gonzalo



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004833.html">[Mono-devel-list] &quot;xml-trace&quot; option for mono
</A></li>
	<LI>Next message: <A HREF="005045.html">[Mono-devel-list] &quot;xml-trace&quot; option for mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4841">[ date ]</a>
              <a href="thread.html#4841">[ thread ]</a>
              <a href="subject.html#4841">[ subject ]</a>
              <a href="author.html#4841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
