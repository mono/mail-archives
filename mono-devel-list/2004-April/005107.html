<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Extension to mcs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Extension%20to%20mcs&In-Reply-To=001901c428c6%24c37c5ec0%24fe00a8c0%40bambook">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005101.html">
   <LINK REL="Next"  HREF="005099.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Extension to mcs</H1>
    <B>Kamil Skalski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Extension%20to%20mcs&In-Reply-To=001901c428c6%24c37c5ec0%24fe00a8c0%40bambook"
       TITLE="[Mono-devel-list] Extension to mcs">nazgul at omega.pl
       </A><BR>
    <I>Fri Apr 23 10:29:16 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005101.html">[Mono-devel-list] Extension to mcs
</A></li>
        <LI>Next message: <A HREF="005099.html">[Mono-devel-list] Extension to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5107">[ date ]</a>
              <a href="thread.html#5107">[ thread ]</a>
              <a href="subject.html#5107">[ subject ]</a>
              <a href="author.html#5107">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Friday 23 of April 2004 02:06, Rodrigo B. de Oliveira wrote:

&gt;<i> Very interesting! Amazing how a lot of different projects around the world
</I>&gt;<i> have got to similar ideas on language/compiler extensibility, my
</I>
Recently I saw two Java compile-time systems for trasforming programs: 
OpenJava and Java Syntax Extensions (JSE). First one introduces features 
similar to those you are mentioning - enriching object environment and 
changing classes by means of special objects operating of AST (their 
definitions are also given by classes using API to ASTs). JSE is somewhat 
closer to Nemerle, because it uses special quotation syntax and gives 
possibility to do any transformation of any expressions in program. 

&gt;<i> The getter attribute would look something like the following:
</I>&gt;<i>
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i> import Boo.Lang.Compiler
</I>&gt;<i> import Boo.Lang.Compiler.Ast
</I>&gt;<i>
</I>&gt;<i> class GetterAttribute(AbstractAstAttribute):
</I>&gt;<i>     _name as ReferenceExpression
</I>&gt;<i>
</I>&gt;<i>     def constructor([required] name as ReferenceExpression):
</I>&gt;<i>          _name = name
</I>&gt;<i>
</I>&gt;<i>     override def Apply([required] node as Node):
</I>&gt;<i>          field as Field = node
</I>&gt;<i>
</I>&gt;<i>          property = Property(_name.Name)
</I>&gt;<i>          property.Getter = Method(&quot;get&quot;)
</I>&gt;<i>          property.Getter.Body.Add(
</I>&gt;<i>                   ReturnStatement(
</I>&gt;<i>                            ReferenceExpression(field.Name)))
</I>&gt;<i>
</I>&gt;<i>          field.DeclaringType.Members.Add(property)
</I>&gt;<i> &lt;/snip&gt;
</I>&gt;<i>
</I>&gt;<i> My hope is that it should be somewhat easy to see what's going on:
</I>&gt;<i>
</I>&gt;<i>     * ReferenceExpression, Node, Property, Method and ReturnStatement are
</I>&gt;<i> all AST node classes;
</I>&gt;<i>
</I>&gt;<i>     * the attribute's constructor defines exactly how the attribute should
</I>&gt;<i> be used syntax-wise, in this
</I>&gt;<i> case, the attribute must be used with a reference, [getter(&quot;Disposed&quot;)]
</I>&gt;<i> would be signaled as an error
</I>&gt;<i> by the compiler with an apropriate message;
</I>&gt;<i>
</I>&gt;<i>     * the Apply method receives the node to which the attribute was
</I>&gt;<i> attached to and can do anything with it; yes,
</I>&gt;<i> that's kind of dangerous but I'd rather put the programmers in charge than
</I>&gt;<i> trying to protect them from themselves;
</I>
Our macros are also compiled as special classes operating on AST, but we give 
them some additional syntax sugar. 

macro getter (c : Class, refer) {
   c.DefineMember (&lt;[ method: public get () { $refer } ]&gt;)
   c
}

So it takes class it operates on, adds a method, which returns given 
expression.

&gt;<i> I think the main thing is to have a clear and easy API for AST
</I>&gt;<i> manipulation, this should give
</I>&gt;<i> programmers a enough power.
</I>
IMHO if you want to use macros for some non-trivial tasks, you should consider 
adding quotation system to your language. For example

&lt;[ foo (4 + x) ]&gt;

is equivalent to something like this (Nemerle ASTs)

E_call (E_ref (&quot;foo&quot;), E_call (E_ref (&quot;+&quot;), E_literal (4), E_ref (&quot;x&quot;)))

It's obvius, that no matter what API for AST you can create, it won't be so 
elegant and readable as quotations. You can also inline some values to 
quotations:
def x = &lt;[ foo (4) ]&gt;;
&lt;[ bar (76) + $x ]&gt;   == &lt;[ bar (76) + foo (4) ]&gt;
(and x can be just any external variable containing some expression)

&gt;<i>
</I>&gt;<i> I'd love to hear your thoughts.
</I>&gt;<i>
</I>&gt;<i> BTW, there's one more extensibility mechanism in boo: custom compilation
</I>&gt;<i> pipelines but I'll leave
</I>&gt;<i> that for the language docs ;-)
</I>
It would be nice to continue our discussion and exchange ideas on more related 
mailing list. For example at Nemerle development list
<A HREF="https://nemerle.org/mailman/listinfo/devel-en">https://nemerle.org/mailman/listinfo/devel-en</A>

Do you have some web page of your language?

Kamil Skalski
----
Nemerle developer

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005101.html">[Mono-devel-list] Extension to mcs
</A></li>
	<LI>Next message: <A HREF="005099.html">[Mono-devel-list] Extension to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5107">[ date ]</a>
              <a href="thread.html#5107">[ thread ]</a>
              <a href="subject.html#5107">[ subject ]</a>
              <a href="author.html#5107">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
