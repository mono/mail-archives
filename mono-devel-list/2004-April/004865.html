<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Patch for String.Equals
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20for%20String.Equals&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004853.html">
   <LINK REL="Next"  HREF="004954.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Patch for String.Equals</H1>
    <B>Andreas Nahr</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20for%20String.Equals&In-Reply-To="
       TITLE="[Mono-devel-list] Patch for String.Equals">ClassDevelopment at A-SoftTech.com
       </A><BR>
    <I>Mon Apr  5 18:16:05 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004853.html">[Mono-devel-list] Patch for String.Equals
</A></li>
        <LI>Next message: <A HREF="004954.html">[Mono-devel-list] Re: Patch for String.Equals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4865">[ date ]</a>
              <a href="thread.html#4865">[ thread ]</a>
              <a href="subject.html#4865">[ subject ]</a>
              <a href="author.html#4865">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I haven't too much (any?) knowledge about any alignments and similar things.
However I can tell that on my platform (which is a Athlon x86 2GHz the long
compares are NOTABLY faster than int compares (And don't ask me why - I have
NO clue).

Here are some example timings from my microbenchmark for a string which
differs at char 90 (case to demonstrate loop speed):
Original (current mono): 29853ms
Suggested patch modified to use only int compares: 20089ms
Suggested patch modified to use only int compares (alternative
implementation): 20039ms
Suggested patch using long (on x86 32bit!): 15963ms

So even on x86 the long compare seems to be a LOT faster. On 64bit machines
the margin should probably get even bigger.
The question is if it will RUN on all plattforms (somebody suggested it
might not even work on other architectures).

----- Original Message ----- 
From: &quot;Ben Maurer&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">05mauben at hawken.edu</A>&gt;
To: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">malekith at pld-linux.org</A>&gt;
Sent: Monday, April 05, 2004 4:31 PM
Subject: Re: [Mono-devel-list] Patch for String.Equals


&gt;<i> oops, sorry it is sizeof (char)/sizeof (void*)
</I>&gt;<i>
</I>&gt;<i> The problem with long ops is that we cant optimize as much for them. The
</I>&gt;<i> burg rules are simply not there. the benefit seen from this may actually
</I>&gt;<i> be from unrolling the loop. It is possible that better performance (on
</I>&gt;<i> the 32 bit) would be obtained by just doing two integer compares.
</I>&gt;<i>
</I>&gt;<i> I can take a look at the code we are generating later...
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; Michal Moskal &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">malekith at pld-linux.org</A>&gt; 04/05/04 10:27 AM &gt;&gt;&gt;
</I>&gt;<i> On Mon, Apr 05, 2004 at 07:43:07AM -0400, Ben Maurer wrote:
</I>&gt;<i> &gt; To optimize for both platforms, the native integer size should be
</I>&gt;<i> used.
</I>&gt;<i> &gt; You can do this by casting the char* to a void**, and using
</I>&gt;<i> &gt; string.Length * sizeof (char*) / sizeof (void**).
</I>&gt;<i>
</I>&gt;<i> As far as I can tell sizeof(char*)==sizeof(void**), at least in C on all
</I>&gt;<i> sane platforms. So the code above isn't very helpful.
</I>&gt;<i>
</I>&gt;<i> Anyway if the long compares doesn't hurt performance on x86, why avoid
</I>&gt;<i> it?
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> : Michal Moskal :: <A HREF="http://www.kernel.pl/~malekith">http://www.kernel.pl/~malekith</A> :: GCS !tv h e&gt;+++ b++
</I>&gt;<i> : When in doubt, use brute force. -- Ken Thompson :: UL++++$ C++ E--- a?
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004853.html">[Mono-devel-list] Patch for String.Equals
</A></li>
	<LI>Next message: <A HREF="004954.html">[Mono-devel-list] Re: Patch for String.Equals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4865">[ date ]</a>
              <a href="thread.html#4865">[ thread ]</a>
              <a href="subject.html#4865">[ subject ]</a>
              <a href="author.html#4865">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
