<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] DbDataAdapter fix for out of memory	errors when filling datasets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DbDataAdapter%20fix%20for%20out%20of%20memory%09errors%0A%20when%20filling%20datasets&In-Reply-To=s133d1aa.067%40lucius.provo.novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007744.html">
   <LINK REL="Next"  HREF="007750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] DbDataAdapter fix for out of memory	errors when filling datasets</H1>
    <B>Francisco Figueiredo Jr.</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DbDataAdapter%20fix%20for%20out%20of%20memory%09errors%0A%20when%20filling%20datasets&In-Reply-To=s133d1aa.067%40lucius.provo.novell.com"
       TITLE="[Mono-devel-list] DbDataAdapter fix for out of memory	errors when filling datasets">fxjrlists at yahoo.com.br
       </A><BR>
    <I>Tue Aug 31 19:58:24 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007744.html">[Mono-devel-list] DbDataAdapter fix for out of memory	errors when filling datasets
</A></li>
        <LI>Next message: <A HREF="007750.html">[Mono-devel-list] patch to add poll to Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7751">[ date ]</a>
              <a href="thread.html#7751">[ thread ]</a>
              <a href="subject.html#7751">[ subject ]</a>
              <a href="author.html#7751">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>S Umadevi wrote:
&gt;<i> Hi 
</I>
Hi Umadevi!

&gt;<i>   The patch looks ok for DbDataAdapater. Can you please go ahead and
</I>&gt;<i> commit it to the HEAD and the mono_1_0 branch..
</I>&gt;<i> 
</I>
Ok. Patched in HEAD, but when I tried to checkout mono_1_0 branch, I
was getting the following error:


cvs -z3 -d <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fxjr at mono-cvs.ximian.com</A>:/cvs/public co -r mono_1_0 mcs
cvs: lock.c:178: lock_name: Assertion `(__extension__ 
(__builtin_constant_p (strlen (current_parsed_root-&gt;directory)) &amp;&amp; 
((__builtin_constant_p (repository) &amp;&amp; strlen (repository) &lt; ((size_t) 
(strlen (current_parsed_root-&gt;directory)))) || (__builtin_constant_p 
(current_parsed_root-&gt;directory) &amp;&amp; strlen 
(current_parsed_root-&gt;directory) &lt; ((size_t) (strlen 
(current_parsed_root-&gt;directory))))) ? __extension__ ({ size_t __s1_len, 
__s2_len; (__builtin_constant_p (repository) &amp;&amp; __builtin_constant_p 
(current_parsed_root-&gt;directory) &amp;&amp; (__s1_len = strlen (repository), 
__s2_len = strlen (current_parsed_root-&gt;directory), (!((size_t)(const 
void *)((repository) + 1) - (size_t)(const void *)(repository) == 1) || 
__s1_len &gt;= 4) &amp;&amp; (!((size_t)(const void 
*)((current_parsed_root-&gt;directory) + 1) - (size_t)(const void 
*)(current_parsed_root-&gt;directory) == 1) || __s2_len &gt;= 4)) ? memcmp 
((__const char *) (repository), (__const char *) 
(current_parsed_root-&gt;directory), (__s1_len &lt; __s2_len ? __s1_len : 
__s2_len) + 1) : (__builtin_constant_p (repository) &amp;&amp; ((size_t)(const 
void *)((repository) + 1) - (size_t)(const void *)(repository) == 1) &amp;&amp; 
(__s1_len = strlen (repository), __s1_len &lt; 4) ? (__builtin_constant_p 
(current_parsed_root-&gt;directory) &amp;&amp; ((size_t)(const void 
*)((current_parsed_root-&gt;directory) + 1) - (size_t)(const void 
*)(current_parsed_root-&gt;directory) == 1) ? (__extension__ ({ register 
int __result = (((__const unsigned char *) (__const char *) 
(repository))[0] - ((__const unsigned char *) (__const char 
*)(current_parsed_root-&gt;directory))[0]); if (__s1_len &gt; 0 &amp;&amp; __result == 
0) { __result = (((__const unsigned char *) (__const char *) 
(repository))[1] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[1]); if (__s1_len &gt; 1 &amp;&amp; __result == 
0) { __result = (((__const unsigned char *) (__const char *) 
(repository))[2] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[2]); if (__s1_len &gt; 2 &amp;&amp; __result == 
0) __result = (((__const unsigned char *) (__const char *) 
(repository))[3] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[3]); } } __result; })) : 
(__extension__ ({ __const unsigned char *__s2 = (__const unsigned char 
*) (__const char *) (current_parsed_root-&gt;directory); register int 
__result = (((__const unsigned char *) (__const char *) (repository))[0] 
- __s2[0]); if (__s1_len &gt; 0 &amp;&amp; __result == 0) { __result = (((__const 
unsigned char *) (__const char *) (repository))[1] - __s2[1]); if 
(__s1_len &gt; 1 &amp;&amp; __result == 0) { __result = (((__const unsigned char *) 
(__const char *) (repository))[2] - __s2[2]); if (__s1_len &gt; 2 &amp;&amp; 
__result == 0) __result = (((__const unsigned char *) (__const char *) 
(repository))[3] - __s2[3]); } } __result; }))) : (__builtin_constant_p 
(current_parsed_root-&gt;directory) &amp;&amp; ((size_t)(const void 
*)((current_parsed_root-&gt;directory) + 1) - (size_t)(const void 
*)(current_parsed_root-&gt;directory) == 1) &amp;&amp; (__s2_len = strlen 
(current_parsed_root-&gt;directory), __s2_len &lt; 4) ? (__builtin_constant_p 
(repository) &amp;&amp; ((size_t)(const void *)((repository) + 1) - 
(size_t)(const void *)(repository) == 1) ? (__extension__ ({ register 
int __result = (((__const unsigned char *) (__const char *) 
(repository))[0] - ((__const unsigned char *) (__const char 
*)(current_parsed_root-&gt;directory))[0]); if (__s2_len &gt; 0 &amp;&amp; __result == 
0) { __result = (((__const unsigned char *) (__const char *) 
(repository))[1] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[1]); if (__s2_len &gt; 1 &amp;&amp; __result == 
0) { __result = (((__const unsigned char *) (__const char *) 
(repository))[2] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[2]); if (__s2_len &gt; 2 &amp;&amp; __result == 
0) __result = (((__const unsigned char *) (__const char *) 
(repository))[3] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[3]); } } __result; })) : 
(__extension__ ({ __const unsigned char *__s1 = (__const unsigned char 
*) (__const char *) (repository); register int __result = __s1[0] - 
((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[0]; if (__s2_len &gt; 0 &amp;&amp; __result == 0) 
{ __result = (__s1[1] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[1]); if (__s2_len &gt; 1 &amp;&amp; __result == 
0) { __result = (__s1[2] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[2]); if (__s2_len &gt; 2 &amp;&amp; __result == 
0) __result = (__s1[3] - ((__const unsigned char *) (__const char *) 
(current_parsed_root-&gt;directory))[3]); } } __result; }))) : strcmp 
(repository, current_parsed_root-&gt;directory)))); }) : strncmp 
(repository, current_parsed_root-&gt;directory, strlen 
(current_parsed_root-&gt;directory)))) == 0' failed.
Terminated with fatal signal 11



I don't have any idea about what this problem is.

So, I couldn't add the patch to mono_1_0 branch.


&gt;<i> Thanks for finding the problem.
</I>&gt;<i> 
</I>
You are welcome!


Regards,

Francisco Figueiredo Jr.


&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i>&quot;Francisco Figueiredo Jr.&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">fxjrlists at yahoo.com.br</A>&gt; 8/28/2004
</I>&gt;<i> 
</I>&gt;<i> 9:57:29 AM &gt;&gt;&gt;
</I>&gt;<i> 
</I>&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> Here is a patch for handling out of memory exceptions when trying to 
</I>&gt;<i> fill datasets with queries which doesn't return a resultset like
</I>&gt;<i> insert, 
</I>&gt;<i> delete, update.
</I>&gt;<i> 
</I>&gt;<i> The out of memory exception happens in the following line of 
</I>&gt;<i> DbDataAdapter.cs:
</I>&gt;<i> 
</I>&gt;<i> around line 502.
</I>&gt;<i> int[] mapping = new int[reader.FieldCount]; // mapping the reader 
</I>&gt;<i> indexes to the datatable indexes
</I>&gt;<i> 
</I>&gt;<i> The problem is that when the query is an insert, update or delete, the
</I>&gt;<i> 
</I>&gt;<i> FieldCount property is -1 which gives the problem.
</I>&gt;<i> 
</I>&gt;<i> The compiler can detect when you try to create an array with a negative
</I>&gt;<i> 
</I>&gt;<i> index. But when this index is in a var, the runtime doesn't handle it 
</I>&gt;<i> and gives the error. The error is like that:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> System.OutOfMemoryException: Out of memory.
</I>&gt;<i> in (unmanaged) (wrapper managed-to-native) 
</I>&gt;<i> System.Object:__icall_wrapper_mono_array_new_specific (intptr,int)
</I>&gt;<i> in &lt;0x00004&gt; (wrapper managed-to-native) 
</I>&gt;<i> System.Object:__icall_wrapper_mono_array_new_specific (intptr,int)
</I>&gt;<i> in &lt;0x00091&gt; System.Data.Common.DbDataAdapter:BuildSchema 
</I>&gt;<i> (System.Data.IDataReader,System.Data.DataTable,System.Data.SchemaType)
</I>&gt;<i> in &lt;0x00079&gt; (wrapper remoting-invoke-with-check) 
</I>&gt;<i> System.Data.Common.DbDataAdapter:BuildSchema 
</I>&gt;<i> (System.Data.IDataReader,System.Data.DataTable,System.Data.SchemaType)
</I>&gt;<i> in &lt;0x00086&gt; System.Data.Common.DbDataAdapter:FillTable 
</I>&gt;<i> (System.Data.DataTable,System.Data.IDataReader,int,int,int&amp;)
</I>&gt;<i> in &lt;0x000ad&gt; (wrapper remoting-invoke-with-check) 
</I>&gt;<i> System.Data.Common.DbDataAdapter:FillTable 
</I>&gt;<i> (System.Data.DataTable,System.Data.IDataReader,int,int,int&amp;)
</I>&gt;<i> in &lt;0x0017d&gt; System.Data.Common.DbDataAdapter:Fill 
</I>&gt;<i> (System.Data.DataSet,string,System.Data.IDataReader,int,int)
</I>&gt;<i> in &lt;0x000da&gt; System.Data.Common.DbDataAdapter:Fill 
</I>&gt;<i> (System.Data.DataSet,int,int,string,System.Data.IDbCommand,System.Data.CommandBehavior)
</I>&gt;<i> in &lt;0x00049&gt; System.Data.Common.DbDataAdapter:Fill 
</I>&gt;<i> (System.Data.DataSet,string)
</I>&gt;<i> in &lt;0x0006b&gt; (wrapper remoting-invoke-with-check) 
</I>&gt;<i> System.Data.Common.DbDataAdapter:Fill (System.Data.DataSet,string)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> May I have to add a bugzilla entry?
</I>&gt;<i> 
</I>&gt;<i> The patch is attached.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Francisco Figueiredo Jr.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007744.html">[Mono-devel-list] DbDataAdapter fix for out of memory	errors when filling datasets
</A></li>
	<LI>Next message: <A HREF="007750.html">[Mono-devel-list] patch to add poll to Mono.Posix
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7751">[ date ]</a>
              <a href="thread.html#7751">[ thread ]</a>
              <a href="subject.html#7751">[ subject ]</a>
              <a href="author.html#7751">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
