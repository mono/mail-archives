<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Re: [Mono-list] inlining of methods using structs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BMono-list%5D%20inlining%20of%20methods%20using%20structs&In-Reply-To=freemail.20040718145800.11147%40fm12.freemail.hu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007598.html">
   <LINK REL="Next"  HREF="007601.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Re: [Mono-list] inlining of methods using structs</H1>
    <B>R&#252;diger Klaehn</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Re%3A%20%5BMono-list%5D%20inlining%20of%20methods%20using%20structs&In-Reply-To=freemail.20040718145800.11147%40fm12.freemail.hu"
       TITLE="[Mono-devel-list] Re: [Mono-list] inlining of methods using structs">rudi at gamemakers.de
       </A><BR>
    <I>Fri Aug 20 05:40:41 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007598.html">[Mono-devel-list] statistical profiler (hack)
</A></li>
        <LI>Next message: <A HREF="007601.html">[Mono-devel-list] ASP.NET Page Life Cycle || Bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7600">[ date ]</a>
              <a href="thread.html#7600">[ thread ]</a>
              <a href="subject.html#7600">[ subject ]</a>
              <a href="author.html#7600">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Varga Zoltan wrote:

&gt;<i>                                                  Hi,
</I>&gt;<i> 
</I>&gt;<i>    There is no reason why such methods can't be inlined. It
</I>&gt;<i> is just that
</I>&gt;<i> the neccessary code is not yet implemented, or not tested
</I>&gt;<i> enough to be
</I>&gt;<i> enabled.
</I>&gt;<i> 
</I>I managed to get the mini code generator to inline all methods involving 
structs. I just had to comment out some assertions and change the 
inlining cost heuristics in mono_method_check_inlining.

It works, but it is actually slower than without inlining. The problem 
is that inlining is only worth it if subsequent optimizations like 
temporary struct elimination happen. That does not seem to be the case.

For example in this line:

Complex x,c;
...
x=x*x+c;

there are two temporary structs generated. One by the multiplication 
operator and one by the addition operator method. Ideally the JIT should 
eliminate these temporary structs and produce code similar to the 
manually inlined version:

//x=x*x...
t = xre * xre - xim * xim;
xim = xre * xim + xre * xim;
xre = t;
//...+c;
xre += cre;
xim += cim;

It is really a pity that this does not work, since otherwise mono would 
be extremely interesting for scientific computing and general high 
performance computing.

best regards

R&#252;diger

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007598.html">[Mono-devel-list] statistical profiler (hack)
</A></li>
	<LI>Next message: <A HREF="007601.html">[Mono-devel-list] ASP.NET Page Life Cycle || Bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7600">[ date ]</a>
              <a href="thread.html#7600">[ thread ]</a>
              <a href="subject.html#7600">[ subject ]</a>
              <a href="author.html#7600">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
