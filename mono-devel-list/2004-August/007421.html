<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Issue of binary portability of a hello world	application
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Issue%20of%20binary%20portability%20of%20a%20hello%20world%0A%09application&In-Reply-To=411575B6.1040409%40grad.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007397.html">
   <LINK REL="Next"  HREF="007426.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Issue of binary portability of a hello world	application</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Issue%20of%20binary%20portability%20of%20a%20hello%20world%0A%09application&In-Reply-To=411575B6.1040409%40grad.com"
       TITLE="[Mono-devel-list] Issue of binary portability of a hello world	application">jonpryor at vt.edu
       </A><BR>
    <I>Mon Aug  9 10:57:23 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007397.html">[Mono-devel-list] Issue of binary portability of a hello world application
</A></li>
        <LI>Next message: <A HREF="007426.html">[Mono-devel-list] Issue of binary portability of a hello world application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7421">[ date ]</a>
              <a href="thread.html#7421">[ thread ]</a>
              <a href="subject.html#7421">[ subject ]</a>
              <a href="author.html#7421">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 2004-08-07 at 20:37, Ioannis Vranos wrote:
&lt;snip/&gt;
&gt;<i> I created a simple CLI hello world  program with current C++ &quot;Managed
</I>&gt;<i> Extensions&quot; in VS 2003 and these are the contents of  the main .cpp
</I>&gt;<i> file:
</I>&gt;<i> 
</I>&gt;<i> #include &quot;stdafx.h&quot;
</I>&gt;<i> 
</I>&gt;<i> #using &lt;mscorlib.dll&gt;
</I>&gt;<i> 
</I>&gt;<i> using namespace System;
</I>&gt;<i> 
</I>&gt;<i> int _tmain()
</I>&gt;<i> {
</I>&gt;<i>     Console::WriteLine(S&quot;Hello World&quot;);
</I>&gt;<i>     return 0;
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Well when I run the executable in GNU/Linux using mono Manage.exe I
</I>&gt;<i> get the error:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ** ERROR **: file marshal.c: line 3096
</I>&gt;<i> (mono_marshal_get_native_wrapper): assertion failed:
</I>&gt;<i> (method-&gt;signature-&gt;pinvoke)
</I>&gt;<i> aborting...
</I>&gt;<i> Aborted
</I>
As others have already mentioned, the program generated by CL.EXE
contains native code by default, which Mono can't handle.  It's also not
portable, either -- if you wanted to run your program on a Mac,
WINE-integration wouldn't help you (you'd need Mono to integrate with a
x86 emulator, which is even less likely to happen...).

What hasn't been mentioned is that: (1) this is a FAQ, and (2) the FAQ
contains more information than has been posted so far.

See: <A HREF="http://www.mono-project.com/about/technical.html#q63">http://www.mono-project.com/about/technical.html#q63</A>

In particular:

        You need a fully-managed assembly to run under Mono, and getting
        the Visual C++ .NET compiler to generate such an executable can
        be difficult. You need to use only the .NET-framework
        assemblies, not the C libraries (you can't use printf(3) for
        example.), and you need to use the linker options /nodefaultlib
        /entry:main mscoree.lib in addition to the /clr compiler flag.
        You can still use certain compiler intrinsic functions (such as
        memcpy(3)) and the STL. You should also see &quot;Converting Managed
        Extensions for C++ Projects from Mixed Mode to Pure Intermediate
        Language&quot; [1] at MSDN. Finally, you can use PEVERIFY.EXE from
        the .NET SDK to determine if the assembly is fully managed.

[1] <A HREF="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vcmex/html/vcgrfconvertingmanagedextensionsforcprojectsfrommixed-modetopureil.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vcmex/html/vcgrfconvertingmanagedextensionsforcprojectsfrommixed-modetopureil.asp</A>

(Beware line wrapping in the above URL.)

As has also been mentioned, using the Visual Studio 2005 Beta C++/CLI
compiler should also work, but you need to make sure you're generating
pure IL.  I believe the /clr:pure or /clr:safe CL.EXE flags can be used
to do this.

See also:
	<A HREF="http://msdn.microsoft.com/msdnmag/issues/04/05/VisualC2005/default.aspx">http://msdn.microsoft.com/msdnmag/issues/04/05/VisualC2005/default.aspx</A>

 - Jon



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007397.html">[Mono-devel-list] Issue of binary portability of a hello world application
</A></li>
	<LI>Next message: <A HREF="007426.html">[Mono-devel-list] Issue of binary portability of a hello world application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7421">[ date ]</a>
              <a href="thread.html#7421">[ thread ]</a>
              <a href="subject.html#7421">[ subject ]</a>
              <a href="author.html#7421">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
