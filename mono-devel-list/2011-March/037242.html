<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Faster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Faster&In-Reply-To=5B994953-D710-49D2-B4EE-F56C64BA29D4%40mindtouch.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="037240.html">
   <LINK REL="Next"  HREF="037244.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Faster</H1>
    <B>Stifu</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Faster&In-Reply-To=5B994953-D710-49D2-B4EE-F56C64BA29D4%40mindtouch.com"
       TITLE="[Mono-dev] Faster">stifu at free.fr
       </A><BR>
    <I>Thu Mar 24 12:31:05 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="037240.html">[Mono-dev] Faster
</A></li>
        <LI>Next message: <A HREF="037244.html">[Mono-dev] Faster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37242">[ date ]</a>
              <a href="thread.html#37242">[ thread ]</a>
              <a href="subject.html#37242">[ subject ]</a>
              <a href="author.html#37242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>From my experience, null checks are really, really cheap, to the point I've
</I>had troubles measuring any difference between code paths with and without
null checks. So, to me, this sounds like more troubles than it's worth, and
time better spent elsewhere. But for the hell of it, it could be measured to
check what the possible gains are.


Steve Bjorg wrote:
&gt;<i> 
</I>&gt;<i> Is the cost of the if-null check greater than setting up an exception
</I>&gt;<i> catch handler?
</I>&gt;<i> 
</I>&gt;<i> - Steve
</I>&gt;<i> 
</I>&gt;<i> ---------------------------------
</I>&gt;<i> Steve G. Bjorg
</I>&gt;<i> MindTouch
</I>&gt;<i> San Diego, CA
</I>&gt;<i>  
</I>&gt;<i> 619.795.8459 office
</I>&gt;<i> 425.891.5913 mobile
</I>&gt;<i> <A HREF="http://twitter.com/bjorg">http://twitter.com/bjorg</A>
</I>&gt;<i> 
</I>&gt;<i> On Mar 24, 2011, at 9:00 AM, Miguel de Icaza wrote:
</I>&gt;<i> 
</I>&gt;<i> &amp;gt; Hello guys,
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; Today in the shower I had an idea that I believe we could use to
</I>&gt;<i> &amp;gt; improve the performance of our class library code.
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; Plenty of our class library code has code like this:
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; void Foo (Something x)
</I>&gt;<i> &amp;gt; {
</I>&gt;<i> &amp;gt;    if (x == null)
</I>&gt;<i> &amp;gt;        throw new ArgumentNullException (&amp;quot;x&amp;quot;);
</I>&gt;<i> &amp;gt;    x.DoSomething ();
</I>&gt;<i> &amp;gt;    x.AndThenMore ();
</I>&gt;<i> &amp;gt; }
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; Arguably, if this could be inlined, and the JIT could prove that x is
</I>&gt;<i> &amp;gt; not null, we would skip the first test, for example:
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; Foo (new Something ());
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; But this is the exception, in general, the JIT would not be able to
</I>&gt;<i> &amp;gt; know this kind of information for even trivial uses like:
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; Foo (Bar.GetSomething ());
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; Rendering the optimization not very effective.
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; But what if we changed our code in Foo across our class libraries to
</I>&gt;<i> &amp;gt; do this instead:
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; void Foo (Something x)
</I>&gt;<i> &amp;gt; {
</I>&gt;<i> &amp;gt;    try {
</I>&gt;<i> &amp;gt;        x.DoSomething ();
</I>&gt;<i> &amp;gt;    } catch (NullReferenceException e){
</I>&gt;<i> &amp;gt;        if (x == null)
</I>&gt;<i> &amp;gt;             throw new ArgumentNullException (&amp;quot;x&amp;quot;);
</I>&gt;<i> &amp;gt;        else
</I>&gt;<i> &amp;gt;              throw;
</I>&gt;<i> &amp;gt;    }
</I>&gt;<i> &amp;gt;    x.AndThenMore ();
</I>&gt;<i> &amp;gt; }
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; This has the advantage that the test for the value of &amp;quot;x&amp;quot;
</I>&gt;<i> being null
</I>&gt;<i> &amp;gt; is delayed until we actually need it.    The downside of course is
</I>&gt;<i> &amp;gt; that DoSomething could actually take other forms and might end up
</I>&gt;<i> &amp;gt; running code that we do not need before it touches x, for example,
</I>&gt;<i> &amp;gt; this would be a problem:
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; // We should never add null values.
</I>&gt;<i> &amp;gt; void AddToCache (Something x)
</I>&gt;<i> &amp;gt; {
</I>&gt;<i> &amp;gt;    cache.Add (x);
</I>&gt;<i> &amp;gt; }
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; void Foo (Something x)
</I>&gt;<i> &amp;gt; {
</I>&gt;<i> &amp;gt;      if (x == null)
</I>&gt;<i> &amp;gt;          throw new ArgumentNullException (&amp;quot;x&amp;quot;);
</I>&gt;<i> &amp;gt;      AddToCache (x);
</I>&gt;<i> &amp;gt; }
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; If we rewrite the above code, we would end up with a bug like the one
</I>&gt;<i> &amp;gt; I described.
</I>&gt;<i> &amp;gt; 
</I>&gt;<i> &amp;gt; Miguel
</I>&gt;<i> &amp;gt; _______________________________________________
</I>&gt;<i> &amp;gt; Mono-devel-list mailing list
</I>&gt;<i> &amp;gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &amp;gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>

--
View this message in context: <A HREF="http://mono.1490590.n4.nabble.com/Faster-tp3402943p3403041.html">http://mono.1490590.n4.nabble.com/Faster-tp3402943p3403041.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="037240.html">[Mono-dev] Faster
</A></li>
	<LI>Next message: <A HREF="037244.html">[Mono-dev] Faster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#37242">[ date ]</a>
              <a href="thread.html#37242">[ thread ]</a>
              <a href="subject.html#37242">[ subject ]</a>
              <a href="author.html#37242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
