<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%0A%20%3D%3Futf-8%3Fq%3FPotential_issue_with_async_sockets_in_Raspbe%3F%3D%0A%20%3D%3Futf-8%3Fq%3Frry_ARM_%3DE2%3D80%3D93_Mono_4%3D2E4%3D2E0%3F%3D&In-Reply-To=%3C45E8A49DE8DF9B4E9A8038276F135D3AAE4AC4D0%40RWC-EXCH02.trionworld.priv%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043818.html">
   <LINK REL="Next"  HREF="043822.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0</H1>
    <B>Chris Swiedler</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%0A%20%3D%3Futf-8%3Fq%3FPotential_issue_with_async_sockets_in_Raspbe%3F%3D%0A%20%3D%3Futf-8%3Fq%3Frry_ARM_%3DE2%3D80%3D93_Mono_4%3D2E4%3D2E0%3F%3D&In-Reply-To=%3C45E8A49DE8DF9B4E9A8038276F135D3AAE4AC4D0%40RWC-EXCH02.trionworld.priv%3E"
       TITLE="[Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0">cswiedler at trionworlds.com
       </A><BR>
    <I>Fri Sep  9 16:11:41 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043818.html">[Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0
</A></li>
        <LI>Next message (by thread): <A HREF="043822.html">[Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43819">[ date ]</a>
              <a href="thread.html#43819">[ thread ]</a>
              <a href="subject.html#43819">[ subject ]</a>
              <a href="author.html#43819">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>From what I understand it’s dangerous to do blocking reads on the callback from something like BeginReceive. The callback will happen on a threadpool thread, and the blocking reads could then cause the threadpool to be exhausted. I don’t know if that’s causing your specific problem (it could, if the reads really do block and you have enough of them) but it’s something to watch out for.

chris

From: Mono-devel-list [mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.dot.net</A>] On Behalf Of <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">psantosl at codicesoftware.com</A>
Sent: Friday, September 09, 2016 2:42 AM
To: <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list at lists.dot.net</A>
Cc: dude &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">rdealba at codicesoftware.com</A>&gt;
Subject: [Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0

Hi,

I’m posting here hoping someone can throw some light into the problem. I'm a little bit lost now.

Our server code (Plastic SCM) running on Raspberry on Mono 4.4.0 (exact version below) ends up not awaking from socket.BeginReceive after a while.

I mean, client connects and requests data in 4MB chunks, and depending on the run, it can transfer a few GB but it ends up not awaking. The client just sits waiting on a “socket recv” but the server doesn’t answer. Connection is established (can be checked at OS level).

The code could be simplified as follows:

            mSocket.BeginReceive(buffer, 0, 0, SocketFlags.None,
                OnMessageReceived, null);

OnMessageReceived =&gt; does the EndReceive and then reads data and enqueues the request for a threadpool to attend it. Once the request is attented and the response sent, BeginReceive is invoked again. Important: all “BeginReceive()” calls are done from the same thread which NEVER dies.

All we use the BeginReceive for is to decouple socket from thread, so we do not have a 1-1. You see we do pass “zero” as bytes to read, because all we want to achieve is to get awakened when new data is received, then just read using blocking calls (no async).

I’m asking if there could be something about Mono because I read 4.6 release notes (<A HREF="http://www.mono-project.com/docs/about-mono/releases/4.6.0/">http://www.mono-project.com/docs/about-mono/releases/4.6.0/</A>) and the “atomic fixes for ARM64”. Could it be related somehow.

The same code runs on Windows and Linux PCs (even Macs) without issues. We use the same code on all our production servers and even our Cloud roles, and we are not aware of issues.
Now we are testing a new faster storage and using Raspberry to check how fast it goes on slower hardware.

Complete Mono version:
Mono JIT compiler version 4.4.0 (tarball Tue Jun 14 13:44:06 UTC 2016)
Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. www.mono-project.com&lt;<A HREF="http://www.mono-project.com">http://www.mono-project.com</A>&gt;
        TLS:           __thread
        SIGSEGV:       normal
        Notifications: epoll
        Architecture:  armel,vfp+hard
        Disabled:      none
        Misc:          softdebug
        LLVM:          supported, not enabled.
        GC:            sgen
.

Thanks!

Pablo Santos
www.plasticscm.com&lt;<A HREF="http://www.plasticscm.com">http://www.plasticscm.com</A>&gt;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20160909/1633d4b3/attachment.html">http://lists.dot.net/pipermail/mono-devel-list/attachments/20160909/1633d4b3/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043818.html">[Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0
</A></li>
	<LI>Next message (by thread): <A HREF="043822.html">[Mono-dev] Potential issue with async sockets in Raspberry ARM – Mono 4.4.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43819">[ date ]</a>
              <a href="thread.html#43819">[ thread ]</a>
              <a href="subject.html#43819">[ subject ]</a>
              <a href="author.html#43819">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
