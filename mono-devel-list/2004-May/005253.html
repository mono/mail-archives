<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] GAC (design) issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005252.html">
   <LINK REL="Next"  HREF="005254.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] GAC (design) issues</H1>
    <B>Jaroslaw Kowalski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To="
       TITLE="[Mono-devel-list] GAC (design) issues">jaak at zd.com.pl
       </A><BR>
    <I>Sat May  1 04:02:35 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005252.html">[Mono-devel-list] GAC (design) issues
</A></li>
        <LI>Next message: <A HREF="005254.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5253">[ date ]</a>
              <a href="thread.html#5253">[ thread ]</a>
              <a href="subject.html#5253">[ subject ]</a>
              <a href="author.html#5253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>+1 to Ian and Gert. We all suffer from NAnt not working on Linux. Fixing
nant to deal with the current mono behaviour would be a major hack, because
you can no longer specify system assemblies references in a portable manner.

Some more issues to consider before shipping v1:

1. AssemblyFolders

Having an established system for AssemblyFolders would be great to have on
mono, too. This would make dealing with installed mono-dependent
applications/libraries much easier and would help in porting Visual
Studio.NET solutions to Mono (using for example nant's &lt;solution&gt; task).

The idea:

Every application package installs its public dlls (to be used for
compilation) in some place and puts the path information in a well-known
place.

This would be similar to:

HKLM\Software\Microsoft\.NETFramework\AssemblyFolders
HKLM\Software\Microsoft\\VisualStudio\7.0\AssemblyFolders
HKLM\Software\Microsoft\\VisualStudio\7.1\AssemblyFolders

HKCU\Software\Microsoft\.NETFramework\AssemblyFolders
HKCU\Software\Microsoft\\VisualStudio\7.0\AssemblyFolders
HKCU\Software\Microsoft\\VisualStudio\7.1\AssemblyFolders

This setup is currently used for Visual Studio to populate &quot;Add
Reference...&quot; dialog box. VS.NET stores file references in a portable manner
by storing the name of the assemblyfolder used to find the reference in
addition to storing the actual path name. Same thing could be done in
MonoDevelop to achieve compatibility.

BTW. Note that VS.NET doesn't display GAC assemblies in &quot;Add Reference...&quot;,
as you cannot reference a file in the GAC while compiling.

On unix the structure used to keep this package information would be:

/etc/mono/packages.d/ - for system version-neutral packages
/etc/mono/1.0/packages.d/ - for system version-specific packages
/etc/mono/2.0/packages.d/ - for system version-specific packages
~/.mono/packages.d/ - for user version-neutral packages
~/.mono/1.0/packages.d/ - for user version-specific packages
~/.mono/2.0/packages.d/ - for user version-specific packages

Each directory would hold XML description files:

&lt;package&gt;
    &lt;name&gt;package1&lt;/name&gt;
    &lt;description&gt;Some package1&lt;/description&gt;
    &lt;version&gt;0.0.1&lt;/version&gt;
    &lt;assemblyfolder&gt;/opt/somepackage/lib&lt;/assemblyfolder&gt;
&lt;/package&gt;

A tool could be created that would manage files stored in this manner,
similar to &quot;pkgconfig&quot;.

2. Framework mapping

I also think that it would be convenient to see a
framework-version-to-mono-version mapping defined in some public and
unmovable place. It would be reused across mono versions (like
/etc/mono/frameworks.conf)

v1.0.3750 -&gt; 1.0
v1.1.4322 -&gt; 1.1
v2.0.3600 -&gt; 2.0

This way a small &quot;starter&quot; application could be created (simiar to what
mscoree.dll does) that would just read the expected mscorlib.dll version and
route to the appropriate mono runtime.

3. Flat &quot;framework&quot; structure

I would refine Gert's idea of filesystem layout. I personally see no reason
to thave &quot;mcs.exe&quot; in the &quot;bin&quot; directory while the rest goes into &quot;lib&quot;
directory.

I'd love to have each framework installed in a separate flat directory,
where all the compilers and core libraries would go:

$PREFIX/mono/1.0/
$PREFIX/mono/1.1/
$PREFIX/mono/2.0/

This simple setup would solve all the issues Gert mentioned.

Jarek

----- Original Message ----- 
From: &quot;Ian MacLean&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ianm at ActiveState.com</A>&gt;
To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>&gt;
Cc: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;; &quot;Jackson Harper&quot;
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jackson at ximian.com</A>&gt;; &quot;Miguel de Icaza&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at novell.com</A>&gt;
Sent: Saturday, May 01, 2004 6:32 AM
Subject: Re: [Mono-devel-list] GAC (design) issues


&gt;<i> +1 . On the ms implementation the gac is considered a special system
</I>&gt;<i> location and is unaccessible from the filesystem ie you can't reference
</I>&gt;<i> an assembly in the gac using a filesystem path. Thats why all system
</I>&gt;<i> assemblies are mirrored at \WINDOWS\Microsoft.NET\Framework\{version_no}
</I>&gt;<i> as well as being stored in the gac.
</I>&gt;<i>
</I>&gt;<i> Ian
</I>&gt;<i>
</I>&gt;<i> Gert Driesen wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;Hi Jackson,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;In my opinion, the current implementation of GAC in mono has three
</I>(major?)
&gt;<i> &gt;issues :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;1. Mono system assemblies are no longer copied to a lib directory
</I>directory
&gt;<i> &gt;where developers can explicitly reference a certain version of a system
</I>&gt;<i> &gt;assembly using a full path.  Can this please be put back in ?  Moreover,
</I>&gt;<i> &gt;wouldn't it be better to have a lib/mono/&lt;mono version&gt; directory (where
</I>&gt;<i> &gt;&lt;mono version&gt; is actually a major version.minor version number for major
</I>&gt;<i> &gt;releases, so 1.0 or 2.0 for now)  ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;You'd get the following directory structure :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;lib\
</I>&gt;<i> &gt;    mono\
</I>&gt;<i> &gt;        gac\
</I>&gt;<i> &gt;            System\
</I>&gt;<i> &gt;                1.0.5000.0__b77a5c561934e089\
</I>&gt;<i> &gt;                    System.dll
</I>&gt;<i> &gt;            ....
</I>&gt;<i> &gt;        1.0\
</I>&gt;<i> &gt;            System.dll
</I>&gt;<i> &gt;            ....
</I>&gt;<i> &gt;        2.0\
</I>&gt;<i> &gt;bin\
</I>&gt;<i> &gt;    mono\
</I>&gt;<i> &gt;        1.0\
</I>&gt;<i> &gt;        2.0\
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;This is similar to what MS does.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Currently, removing a system assembly from the GAC will remove it
</I>completely
&gt;<i> &gt;from your system, as its only stored in the GAC.  this would be resolved
</I>too
&gt;<i> &gt;when these assemblies are stored in the GAC and in a Mono
</I>(version-specific)
&gt;<i> &gt;lib directory.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;2. In order to compile applications referencing system assemblies using
</I>mcs,
&gt;<i> &gt;mcs was updated to allow unqualified assembly references to be resolved
</I>&gt;<i> &gt;using the  GAC (see Mono.CSharp.Driver.LoadAssemblyFromGac).  I assume
</I>this
&gt;<i> &gt;change was only introduced to copy with the fact that system assemblies
</I>are
&gt;<i> &gt;now only stored in the GAC, so resolving issue 1 would remove the need
</I>for
&gt;<i> &gt;this change to mcs.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;3. As part of mcs clean, assembies are removed from the gac using the
</I>&gt;<i> &gt;basename of the assembly, eg to remove System.Data, Version=1.0.5000.0,
</I>&gt;<i> &gt;Culture=neutral, PublicKeyToken=b77a5c561934e089 from the GAC, the
</I>following
&gt;<i> &gt;command is executed :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    gacutil /u System.Data
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;This could cause other versions of the System.Data assembly to be removed
</I>&gt;<i> &gt;from the GAC too. We should always use the fully qualified assembly names
</I>to
&gt;<i> &gt;remove assemblies from the GAC.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Gert
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;_______________________________________________
</I>&gt;<i> &gt;Mono-devel-list mailing list
</I>&gt;<i> &gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005252.html">[Mono-devel-list] GAC (design) issues
</A></li>
	<LI>Next message: <A HREF="005254.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5253">[ date ]</a>
              <a href="thread.html#5253">[ thread ]</a>
              <a href="subject.html#5253">[ subject ]</a>
              <a href="author.html#5253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
