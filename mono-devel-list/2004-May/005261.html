<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] GAC (design) issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=007201c42f5d%24c8ea5180%242000a8c0%40jarekxp">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005260.html">
   <LINK REL="Next"  HREF="005267.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] GAC (design) issues</H1>
    <B>Todd Berman</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=007201c42f5d%24c8ea5180%242000a8c0%40jarekxp"
       TITLE="[Mono-devel-list] GAC (design) issues">tberman at sevenl.net
       </A><BR>
    <I>Sat May  1 12:50:38 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005260.html">[Mono-devel-list] GAC (design) issues
</A></li>
        <LI>Next message: <A HREF="005267.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5261">[ date ]</a>
              <a href="thread.html#5261">[ thread ]</a>
              <a href="subject.html#5261">[ subject ]</a>
              <a href="author.html#5261">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 2004-01-05 at 11:22 +0200, Jaroslaw Kowalski wrote:
&gt;<i> &gt; &gt; +1 to Ian and Gert. We all suffer from NAnt not working on Linux. Fixing
</I>&gt;<i> &gt; &gt; nant to deal with the current mono behaviour would be a major hack,
</I>&gt;<i> because
</I>&gt;<i> &gt; &gt; you can no longer specify system assemblies references in a portable
</I>&gt;<i> manner.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; How exactly do you do this on ms.net? by setting up your path properly?
</I>&gt;<i> &gt; that sounds like the original hack.
</I>&gt;<i> 
</I>&gt;<i> No. NAnt eploys the concept of &quot;frameworks&quot;. At startup it detects the
</I>&gt;<i> available CLI runtimes found on the system (net-1.0, net-1.1, net-2.0,
</I>&gt;<i> mono-1.0, sscli, netcf-1.0) and determines (among other things) the path
</I>&gt;<i> where all system libraries are located. Now you can have a single build
</I>&gt;<i> script and re-target the compilation for a specific platform. Note that you
</I>&gt;<i> can compile for some other platform than the one nant is running on. For
</I>&gt;<i> example you can run on .NET 1.0 and compile for .NET 1.1 or mono-1.0. NAnt
</I>&gt;<i> always feeds the compiler with a list of fully qualified source and
</I>&gt;<i> reference names, so that you can have 100% repeatable builds independently
</I>&gt;<i> of the PATH settings.
</I>
My understanding of how it does that is by probing the registry, and by
some Nant.exe.config file. I assume that gives it the ability to set an
environment variable or something similar that would alleviate this
problem on the mono runtimes, as it *already* special cases each
runtime.

&gt;<i> 
</I>&gt;<i> csc.exe doesn't have to be added to the PATH. NAnt is detects it and always
</I>&gt;<i> invokes it with a fully qualified path name.
</I>&gt;<i> 
</I>&gt;<i> &gt; &gt; Some more issues to consider before shipping v1:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 1. AssemblyFolders
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; Well, it seems like if a dll is public it should be in the gac.
</I>&gt;<i> &gt; and if mcs can resolve libraries out of the gac, then there really isnt a
</I>&gt;<i> need
</I>&gt;<i> &gt; for this registry + filepath hack.
</I>&gt;<i> 
</I>&gt;<i> Yes, it works. If you really want to type:
</I>&gt;<i> 
</I>&gt;<i> mcs -r &quot;System.Data, Version=1.0.3300.0, Culture=neutral,
</I>&gt;<i> PublicKeyToken=b77a5c561934e089&quot;
</I>&gt;<i> 
</I>&gt;<i> each time you compile. OK. I know that mcs can be taught to know to use
</I>&gt;<i> &quot;System.Data&quot; with the appropriate version (it's kind-of &quot;core&quot;) but it's a
</I>&gt;<i> hack.
</I>
Its no more of a hack than Assembly.LoadWithPartialName. The idea is
that if you dont care what version you get, you get the latest, if you
do, then make mcs know about it. And I might be completely wrong, but I
think System.Data,Version=1.0.3300.0 is enough.

&gt;<i> 
</I>&gt;<i> But what about non-system assemblies like nunit.framework.dll,
</I>&gt;<i> NDoc.Core.dll, ICSharpCode.SharpCvsLib.dll, ICSharpCode.SharpZipLib.dll
</I>&gt;<i> which come strong-named and in different versions? Are you prepared to type
</I>&gt;<i> (actually copy/paste, because you have no chance to remember it) the full
</I>&gt;<i> name including the public key token and exact version number?
</I>&gt;<i> 
</I>
A) people build from makefiles, that solves the need to paste and/or
remember it.
B) Most of the time I am going to want the latest version of these
assemblies.

&gt;<i> &gt; So you would prefer we change the default (seemingly sensical) behaviour
</I>&gt;<i> &gt; and then add this hack to fix an issue fixed by the current solution?
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> OK. MS.NET developers do it the other way and it does work. IMHO the current
</I>&gt;<i> Mono GAC structure will cause more trouble than good.
</I>&gt;<i> 
</I>
I personally think this is an implementation detail, and if it ends up
working the same to the end user/developer it shouldnt matter. All of
what I have heard so far, there is still no answer given for exactly
*why* nant needs to be able to physically ref the exact files.

&gt;<i> &gt; &gt; This setup is currently used for Visual Studio to populate &quot;Add
</I>&gt;<i> &gt; &gt; Reference...&quot; dialog box. VS.NET stores file references in a portable
</I>&gt;<i> manner
</I>&gt;<i> &gt; &gt; by storing the name of the assemblyfolder used to find the reference in
</I>&gt;<i> &gt; &gt; addition to storing the actual path name. Same thing could be done in
</I>&gt;<i> &gt; &gt; MonoDevelop to achieve compatibility.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; the name of the assemblyfolder? you mean the registry key it found it in
</I>&gt;<i> &gt; i assume.
</I>&gt;<i> 
</I>&gt;<i> Yes.
</I>
Exactly how would such compatibility be achieved on a linux system with
no registry?

&gt;<i> 
</I>&gt;<i> &gt; I dont see how MonoDevelop would maintain that kind of
</I>&gt;<i> &gt; portability.
</I>&gt;<i> 
</I>&gt;<i> Simple. Same as VS.NET. Assuming the package names will match AssemblyFolder
</I>&gt;<i> names there shouldn't be any problem.
</I>&gt;<i> 
</I>&gt;<i> &gt; The current thinking for MonoDevelop is pretty simple:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Add a GAC based reference, compile using mcs and it finds it because its
</I>&gt;<i> &gt; in the gac. When you go to deploy the package, the configure script
</I>&gt;<i> &gt; probes the gac and complains if it cant find the library.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Seems to be pretty easy.
</I>&gt;<i> 
</I>&gt;<i> So you're hereby eliminating the possibility of running on MS.NET and using
</I>&gt;<i> csc.exe to compile, right? I think that in the future versions of .NET, GAC
</I>&gt;<i> might not even be a filesystem-backed store.
</I>&gt;<i> 
</I>
I am for the foreseeable future. MonoDevelop *REQUIRES* a host of other
libraries that are nowhere near ready for the windows platform. We need
a full gnome stack installed to run properly. I don't see that happening
any time soon, as it is yet to happen at all so far. I think writing
compatibility support for something that is not likely to occur any time
soon is not a good idea, and really a misuse of developer time.

&gt;<i> &gt; &gt; This way a small &quot;starter&quot; application could be created (simiar to what
</I>&gt;<i> &gt; &gt; mscoree.dll does) that would just read the expected mscorlib.dll version
</I>&gt;<i> and
</I>&gt;<i> &gt; &gt; route to the appropriate mono runtime.
</I>&gt;<i> 
</I>&gt;<i> &gt; There is only one runtime as far as I can tell. And the version of the
</I>&gt;<i> &gt; libraries that mono attempts to use should be based off the corlib
</I>&gt;<i> &gt; version included in your executable, not a config mapping.
</I>&gt;<i> 
</I>&gt;<i> I'm not sure if this means &quot;perfect backward compatibility&quot;, but I may be
</I>&gt;<i> wrong. If I'm right though, it means the dependency hell is likely to arise.
</I>&gt;<i> Remember that the runtime itself can have issues which some applications
</I>&gt;<i> will rely upon which will ultimately break them when the runtime is &quot;fixed&quot;.
</I>&gt;<i> 
</I>
Again, this seems to be moot. If your application was built with a 1.1
runtime, it should use those libraries on mono. If it was built with a
2.0 runtime, it should use those libraries. Where is the dependency
hell? Seems like it doing the right and smart behaviour.

&gt;<i> &gt; Again, I dont understand why Gert needs to reference these assemblies
</I>&gt;<i> &gt; explicitly, and if he does, why $PREFIX/mono/$VERSION/$ASSEMBLYNAME is
</I>&gt;<i> &gt; any easier than
</I>&gt;<i> &gt; $PREFIX/lib/mono/gac/$ASSEMBLYNAME/$VERSION__$PUBTOKEN/$ASSEMBLYNAME .
</I>&gt;<i> &gt; (Other than it obviously being easier to type).
</I>&gt;<i> 
</I>&gt;<i> GAC is not a filesystem and shouldn't be treaded as such. Ideally the MS
</I>&gt;<i> should have encrypted the contents of &quot;\Windows\assembly\GAC&quot; folder or put
</I>&gt;<i> it into a ZIP file in the past.
</I>&gt;<i> 
</I>
As miguel pointed out, Our gac is. and as you said above, NAnt already
special cases each and every one of the platforms. So whats the problem
with it changing its mono special case?

--Todd


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005260.html">[Mono-devel-list] GAC (design) issues
</A></li>
	<LI>Next message: <A HREF="005267.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5261">[ date ]</a>
              <a href="thread.html#5261">[ thread ]</a>
              <a href="subject.html#5261">[ subject ]</a>
              <a href="author.html#5261">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
