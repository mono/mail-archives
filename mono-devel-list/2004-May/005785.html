<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Approval needed] Re: [Mono-devel-list] Patch for Char. Pleasetest if it breaks your assembly!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BApproval%20needed%5D%20Re%3A%20%5BMono-devel-list%5D%20Patch%20for%20Char.%20Pleasetest%20if%20it%20breaks%20your%20assembly%21&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005781.html">
   <LINK REL="Next"  HREF="005788.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Approval needed] Re: [Mono-devel-list] Patch for Char. Pleasetest if it breaks your assembly!</H1>
    <B>Andreas Nahr</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BApproval%20needed%5D%20Re%3A%20%5BMono-devel-list%5D%20Patch%20for%20Char.%20Pleasetest%20if%20it%20breaks%20your%20assembly%21&In-Reply-To="
       TITLE="[Approval needed] Re: [Mono-devel-list] Patch for Char. Pleasetest if it breaks your assembly!">ClassDevelopment at A-SoftTech.com
       </A><BR>
    <I>Mon May 17 13:21:58 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005781.html">[Approval needed] Re: [Mono-devel-list] Patch for Char. Please	test if it breaks your assembly!
</A></li>
        <LI>Next message: <A HREF="005788.html">[Approval needed] Re: [Mono-devel-list] Patch for Char.	Pleasetest if it breaks your assembly!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5785">[ date ]</a>
              <a href="thread.html#5785">[ thread ]</a>
              <a href="subject.html#5785">[ subject ]</a>
              <a href="author.html#5785">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Sun, 2004-05-16 at 17:26, Miguel de Icaza wrote:
</I>&gt;<i> &gt; Hello,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; But we need to do this change at some point in time...
</I>&gt;<i> &gt; &gt; So if nobody objects I'll commit soon.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I want Dick and Paolo to approve this patch before it goes into CVS.
</I>&gt;<i>
</I>&gt;<i> I don't know what the comment (&quot;needs to call line below, but that would
</I>&gt;<i> probably break a lot of things right now&quot;) is referring to.  The comment
</I>&gt;<i> was written by Andreas when he wrote the Invariant optimisations.
</I>
I added this line when I made the optimizations because I found the bug that
we are not calling ToLower/ToUpper with the current culture but with
invariant culture.
I did not make the change back then because doing the change would have
broken code. Why? Because at the time nearly all of the corelib code in mono
depended on that bug (there was only one exception). I changed the possible
problematic areas in corelib. But as I saw that in corelib there were nearly
20 places where this would have produced problems and only 1 place where it
was correct I assumed that in other assemblies the situation might be the
same and decided to not do the patch back then.
All that was probably 1-2 months ago. Back then I wrote that people need to
check the assemblies for code that calls Char.ToLower/Upper and depends on
this being the INVARIANT version (which it shouldn't be).
It seemed to me that either nobody did check anything or there were no bugs,
that's why I wanted to commit now

&gt;<i> The spec says the current culture should be used, so this should be
</I>&gt;<i> committed.
</I>
Thats the reason why this needs to be applied.

However if we have code like:
char CaseInsensitiveRegex = 'R';
if (Char.ToLower(CaseInsensitiveRegex) == 'r')

Then this will fail in turkish locale after the patch (at least I think the
R was one of those problematic chars) because the author probably wanted to
call:
if (Char.ToLower(CaseInsensitiveRegex, CultureInfo.InvariantCulture) == 'r')

And as I sayed: I found lots of code like this in corlib so I thougth it may
be likely that such bugs (depending on the Char.ToLower bug) may also exist
in other assemblies.

Andreas


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005781.html">[Approval needed] Re: [Mono-devel-list] Patch for Char. Please	test if it breaks your assembly!
</A></li>
	<LI>Next message: <A HREF="005788.html">[Approval needed] Re: [Mono-devel-list] Patch for Char.	Pleasetest if it breaks your assembly!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5785">[ date ]</a>
              <a href="thread.html#5785">[ thread ]</a>
              <a href="subject.html#5785">[ subject ]</a>
              <a href="author.html#5785">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
