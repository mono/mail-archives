<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] GAC (design) issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005292.html">
   <LINK REL="Next"  HREF="005298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] GAC (design) issues</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To="
       TITLE="[Mono-devel-list] GAC (design) issues">gert.driesen at pandora.be
       </A><BR>
    <I>Mon May  3 05:48:07 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005292.html">[Mono-devel-list] GAC (design) issues
</A></li>
        <LI>Next message: <A HREF="005298.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5294">[ date ]</a>
              <a href="thread.html#5294">[ thread ]</a>
              <a href="subject.html#5294">[ subject ]</a>
              <a href="author.html#5294">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>----- Original Message -----
From: &quot;Todd Berman&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tberman at sevenl.net</A>&gt;
To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>&gt;
Cc: &quot;Ian MacLean&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ianm at activestate.com</A>&gt;; &quot;Carl-Adam Brengesj&#246;&quot;
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ca.brengesjo at telia.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Monday, May 03, 2004 11:15 AM
Subject: Re: [Mono-devel-list] GAC (design) issues


&gt;<i> On Mon, 2004-03-05 at 11:01 +0200, Gert Driesen wrote:
</I>&gt;<i> &gt; ----- Original Message -----
</I>&gt;<i> &gt; From: &quot;Todd Berman&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tberman at sevenl.net</A>&gt;
</I>&gt;<i> &gt; To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>&gt;
</I>&gt;<i> &gt; Cc: &quot;Ian MacLean&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ianm at activestate.com</A>&gt;; &quot;Carl-Adam Brengesj&#246;&quot;
</I>&gt;<i> &gt; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ca.brengesjo at telia.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; Sent: Monday, May 03, 2004 10:44 AM
</I>&gt;<i> &gt; Subject: Re: [Mono-devel-list] GAC (design) issues
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; On Mon, 2004-03-05 at 10:14 +0200, Gert Driesen wrote:
</I>&gt;<i> &gt; &gt; &gt; ----- Original Message -----
</I>&gt;<i> &gt; &gt; &gt; From: &quot;Todd Berman&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tberman at sevenl.net</A>&gt;
</I>&gt;<i> &gt; &gt; &gt; To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>&gt;
</I>&gt;<i> &gt; &gt; &gt; Cc: &quot;Ian MacLean&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ianm at activestate.com</A>&gt;; &quot;Carl-Adam Brengesj&#246;&quot;
</I>&gt;<i> &gt; &gt; &gt; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ca.brengesjo at telia.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; &gt; &gt; Sent: Monday, May 03, 2004 8:53 AM
</I>&gt;<i> &gt; &gt; &gt; Subject: Re: [Mono-devel-list] GAC (design) issues
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; or just mcs /r:System.Data
</I>&gt;<i> &gt; &gt; have you guys even tested this? I can say that MonoDevelop (arguably
</I>the
&gt;<i> &gt; &gt; largest mono project available right now) compiles, and runs
</I>*perfectly*
&gt;<i> &gt; &gt; with this gac setup. the build system required *no* changes, and the
</I>&gt;<i> &gt; &gt; only changes required to the runtime was *changing* gac assumptions
</I>that
&gt;<i> &gt; &gt; #D makes about the windows GAC.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Have you guys tested having multiple versions of a single assembly in
</I>the
&gt;<i> &gt; GAC, and referencing a specific version ?  No, because it won't work
</I>(right
&gt;<i> &gt; now) ... What else is there to test ?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> As you said, it doesnt work right now, but since *nothing* uses this,
</I>&gt;<i> its not such a big deal to have it working.
</I>
So there are no existing .NET applications that use assemblies of which
mulitple versions were released ?


&gt;<i>
</I>&gt;<i> &gt; &gt; Well, then do: mcs /r:System.Data, Version=whatever when (and not if)
</I>&gt;<i> &gt; &gt; that gets implemented. For now its not there, but it will be.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sure, that will improve portability of make files, or other build
</I>scripts :(
&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Its no less portable than:
</I>&gt;<i>
</I>&gt;<i> export PATH=&quot;C:\Some\Win32\Path\To\Required\.NET\SDK&quot; make
</I>&gt;<i>
</I>&gt;<i> which is what you *need* to do *always* with the ms framework.
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; Ok, here is what I don't get. We implement it the same as MS, what we
</I>&gt;<i> &gt; &gt; dont do is replicate every implementation detail of their SDK. Note,
</I>&gt;<i> &gt; &gt; thats the SDK not the framework itself.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; And no, any other existing .NET tool that operates on assembly
</I>&gt;<i> &gt; &gt; references will not be affected assuming they are writing proper code.
</I>&gt;<i> &gt; &gt; In fact, MCS itself is most likely going to change from using that
</I>&gt;<i> &gt; &gt; LoadFromGac method to something else to be even more correct, however
</I>&gt;<i> &gt; &gt; the implementation itself is being worked out.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; For the 7th time (slight exaggeration), will you *PLEASE* explain why
</I>&gt;<i> &gt; &gt; getting the absolute path to the assembly is so important to you? You
</I>&gt;<i> &gt; &gt; keep explaining that you need it, without explaining why you need it.
</I>In
&gt;<i> &gt; &gt; my (intentionally uninformed, as you wont explain) opinion, you are
</I>&gt;<i> &gt; &gt; doing something that takes advantage of the ms.net sdk's
</I>implementation
&gt;<i> &gt; &gt; details (like pathing) and are irritated that you might have to refit
</I>&gt;<i> &gt; &gt; that code to actually work properly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Todd, I'm definitely not irritated ... Sorry if I sound irritated ....
</I>Again
&gt;<i> &gt; I just want to ensure Mono (and applications targeting Mono) stay
</I>portable,
&gt;<i> &gt; both at runtime and at compile time ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I would love to be wrong, please help me understand.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Its quite simple : its all about having portable build scripts (whether
</I>its
&gt;<i> &gt; make or NAnt, or whatever) ...
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> As I said, make seems to handle this change just fine (as evidenced by
</I>&gt;<i> MD building with *no* changes). So at this point its NAnt.
</I>&gt;<i>
</I>&gt;<i> So lets discuss the NAnt issue in specific, as this seems to be
</I>&gt;<i> completely local to NAnt, and not something affecting other
</I>&gt;<i> applications.
</I>&gt;<i>
</I>&gt;<i> Keep in mind that my nant experience is very limited (no offense to nant
</I>&gt;<i> meant at all, just a fact). The last time i even looked at nant it
</I>&gt;<i> required setting some variables in a .exe.config file with locations
</I>&gt;<i> such as /usr/bin and /usr/lib to get it working. Has this changed?
</I>&gt;<i>
</I>&gt;<i> If not, that seems to be your root problem. First of all, (and this
</I>&gt;<i> would obviously require some shell script frontend to nant), all of that
</I>&gt;<i> info can be gleaned via pkg-config at runtime, so there should be no
</I>&gt;<i> need for that.
</I>
For linux, this hasn't changed no, as I couldn't find a way to determine
which Mono versions are installed, and in what locations ...  For Windows,
the available frameworks are automatically determined.

It would be great, if you could supply this information to us ... None of
the active NAnt contributors are linux experts (I've no problem admitting
this) ...

Note: we need to be able to obtain this information for all installed
frameworks (mono versions) ...

&gt;<i> Now. Assuming everything is the same, it seems that before you worry
</I>&gt;<i> about making portable build scripts, you need to worry about making
</I>&gt;<i> portable assumptions. As assuming that the path is the only way to
</I>&gt;<i> specify the framework version you want doesn't seem portable.
</I>&gt;<i>
</I>&gt;<i> And yet again, I still dont see why you need the path to the assembly
</I>&gt;<i> absolutely. I would assume that your xml format for references is
</I>&gt;<i> something like:
</I>&gt;<i>
</I>&gt;<i> &lt;reference name=&quot;AssemblyName&quot; version=&quot;0.0.0.0&quot; pubtoken=&quot;something&quot;
</I>&gt;<i> culture=&quot;somethingelse&quot;/&gt;
</I>
Nope, as that would not make these references portable.  NAnt allows you to
switch the target framework on the fly, by always using the fully qualified
assembly names you wouldn't be able to target both .NET 1.0 and .NET 1.1
using the same build script ... at least not in a clean matter ...

In NAnt, you'd actually use the following xml format :

&lt;references&gt;
    &lt;includes name=&quot;&lt;path to a third party assembly&gt;&quot; /&gt;
    &lt;includes name=&quot;System.dll&quot; /&gt;
    &lt;includes name=&quot;lib/*.dll&quot; /&gt;
&lt;/references&gt;

So, we allow full or partial paths to an assembly, and wildcards.  When an
assembly is not found in the base dir, we search for the assembly in the
framework assembly directory.

&gt;<i> I dont understand how there would be any problem adapting the
</I>&gt;<i> information given there to generate a commandline that works for mcs,
</I>&gt;<i> and csc given any subset of that data.
</I>
Always using fully qualified assembly names is not an option, and for Mono,
we would not be able to search for an assembly in the framework assembly
directory, as there would no longer be such a dir (all system assemblies are
in the GAC), and we can't scan the GAC as that would mean we'd have to guess
too ...

And we can't just determine the fully qualified assembly name of a given
assembly file, as you could have NAnt running on NET 1.0 while targeting and
referencing a .NET 2.0 assembly. Meaning we wouldn't even be able to load
the assembly ...

&gt;<i>
</I>&gt;<i> However, on the other hand, if your reference setup basically takes the
</I>&gt;<i> name, and tacks it onto the end of whatever is put in as the
</I>&gt;<i> frameworkDirectory in the config file, *THAT* is the portability
</I>&gt;<i> problem, not the mono GAC implementation.
</I>
I agree our implementation is far from perfect (perhaps I would've done it
some other way, but we can't just break every existing build file out
there), but I don't see a good alternative if you want to maintain support
for multiple target frameworks, and maintain portability of the build files
... But we definitely are open to suggestions ...

Gert


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005292.html">[Mono-devel-list] GAC (design) issues
</A></li>
	<LI>Next message: <A HREF="005298.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5294">[ date ]</a>
              <a href="thread.html#5294">[ thread ]</a>
              <a href="subject.html#5294">[ subject ]</a>
              <a href="author.html#5294">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
