<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] GAC (design) issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=002901c430f3%24bcf3b190%24d9071fac%40ordab.ordab.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005294.html">
   <LINK REL="Next"  HREF="005313.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] GAC (design) issues</H1>
    <B>Todd Berman</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=002901c430f3%24bcf3b190%24d9071fac%40ordab.ordab.com"
       TITLE="[Mono-devel-list] GAC (design) issues">tberman at sevenl.net
       </A><BR>
    <I>Mon May  3 06:10:33 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005294.html">[Mono-devel-list] GAC (design) issues
</A></li>
        <LI>Next message: <A HREF="005313.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5298">[ date ]</a>
              <a href="thread.html#5298">[ thread ]</a>
              <a href="subject.html#5298">[ subject ]</a>
              <a href="author.html#5298">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2004-03-05 at 11:48 +0200, Gert Driesen wrote:
&gt;<i> ----- Original Message -----
</I>&gt;<i> From: &quot;Todd Berman&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tberman at sevenl.net</A>&gt;
</I>&gt;<i> To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>&gt;
</I>&gt;<i> Cc: &quot;Ian MacLean&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ianm at activestate.com</A>&gt;; &quot;Carl-Adam Brengesj&#246;&quot;
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ca.brengesjo at telia.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> Sent: Monday, May 03, 2004 11:15 AM
</I>&gt;<i> Subject: Re: [Mono-devel-list] GAC (design) issues
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; On Mon, 2004-03-05 at 11:01 +0200, Gert Driesen wrote:
</I>&gt;<i> &gt; &gt; ----- Original Message -----
</I>&gt;<i> &gt; &gt; From: &quot;Todd Berman&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tberman at sevenl.net</A>&gt;
</I>&gt;<i> &gt; &gt; To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>&gt;
</I>&gt;<i> &gt; &gt; Cc: &quot;Ian MacLean&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ianm at activestate.com</A>&gt;; &quot;Carl-Adam Brengesj&#246;&quot;
</I>&gt;<i> &gt; &gt; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ca.brengesjo at telia.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; &gt; Sent: Monday, May 03, 2004 10:44 AM
</I>&gt;<i> &gt; &gt; Subject: Re: [Mono-devel-list] GAC (design) issues
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; On Mon, 2004-03-05 at 10:14 +0200, Gert Driesen wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; ----- Original Message -----
</I>&gt;<i> &gt; &gt; &gt; &gt; From: &quot;Todd Berman&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tberman at sevenl.net</A>&gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; To: &quot;Gert Driesen&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gert.driesen at pandora.be</A>&gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Cc: &quot;Ian MacLean&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ianm at activestate.com</A>&gt;; &quot;Carl-Adam Brengesj&#246;&quot;
</I>&gt;<i> &gt; &gt; &gt; &gt; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ca.brengesjo at telia.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Sent: Monday, May 03, 2004 8:53 AM
</I>&gt;<i> &gt; &gt; &gt; &gt; Subject: Re: [Mono-devel-list] GAC (design) issues
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; or just mcs /r:System.Data
</I>&gt;<i> &gt; &gt; &gt; have you guys even tested this? I can say that MonoDevelop (arguably
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; &gt; largest mono project available right now) compiles, and runs
</I>&gt;<i> *perfectly*
</I>&gt;<i> &gt; &gt; &gt; with this gac setup. the build system required *no* changes, and the
</I>&gt;<i> &gt; &gt; &gt; only changes required to the runtime was *changing* gac assumptions
</I>&gt;<i> that
</I>&gt;<i> &gt; &gt; &gt; #D makes about the windows GAC.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Have you guys tested having multiple versions of a single assembly in
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; GAC, and referencing a specific version ?  No, because it won't work
</I>&gt;<i> (right
</I>&gt;<i> &gt; &gt; now) ... What else is there to test ?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As you said, it doesnt work right now, but since *nothing* uses this,
</I>&gt;<i> &gt; its not such a big deal to have it working.
</I>&gt;<i> 
</I>&gt;<i> So there are no existing .NET applications that use assemblies of which
</I>&gt;<i> mulitple versions were released ?
</I>&gt;<i> 
</I>
Not that I am aware of that currently run on mono right now. This is
moot though, as it will be fixed ASAP, and is not an issue.

&gt;<i> 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; Well, then do: mcs /r:System.Data, Version=whatever when (and not if)
</I>&gt;<i> &gt; &gt; &gt; that gets implemented. For now its not there, but it will be.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Sure, that will improve portability of make files, or other build
</I>&gt;<i> scripts :(
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Its no less portable than:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; export PATH=&quot;C:\Some\Win32\Path\To\Required\.NET\SDK&quot; make
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; which is what you *need* to do *always* with the ms framework.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; Ok, here is what I don't get. We implement it the same as MS, what we
</I>&gt;<i> &gt; &gt; &gt; dont do is replicate every implementation detail of their SDK. Note,
</I>&gt;<i> &gt; &gt; &gt; thats the SDK not the framework itself.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; And no, any other existing .NET tool that operates on assembly
</I>&gt;<i> &gt; &gt; &gt; references will not be affected assuming they are writing proper code.
</I>&gt;<i> &gt; &gt; &gt; In fact, MCS itself is most likely going to change from using that
</I>&gt;<i> &gt; &gt; &gt; LoadFromGac method to something else to be even more correct, however
</I>&gt;<i> &gt; &gt; &gt; the implementation itself is being worked out.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; For the 7th time (slight exaggeration), will you *PLEASE* explain why
</I>&gt;<i> &gt; &gt; &gt; getting the absolute path to the assembly is so important to you? You
</I>&gt;<i> &gt; &gt; &gt; keep explaining that you need it, without explaining why you need it.
</I>&gt;<i> In
</I>&gt;<i> &gt; &gt; &gt; my (intentionally uninformed, as you wont explain) opinion, you are
</I>&gt;<i> &gt; &gt; &gt; doing something that takes advantage of the ms.net sdk's
</I>&gt;<i> implementation
</I>&gt;<i> &gt; &gt; &gt; details (like pathing) and are irritated that you might have to refit
</I>&gt;<i> &gt; &gt; &gt; that code to actually work properly.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Todd, I'm definitely not irritated ... Sorry if I sound irritated ....
</I>&gt;<i> Again
</I>&gt;<i> &gt; &gt; I just want to ensure Mono (and applications targeting Mono) stay
</I>&gt;<i> portable,
</I>&gt;<i> &gt; &gt; both at runtime and at compile time ...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I would love to be wrong, please help me understand.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Its quite simple : its all about having portable build scripts (whether
</I>&gt;<i> its
</I>&gt;<i> &gt; &gt; make or NAnt, or whatever) ...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As I said, make seems to handle this change just fine (as evidenced by
</I>&gt;<i> &gt; MD building with *no* changes). So at this point its NAnt.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So lets discuss the NAnt issue in specific, as this seems to be
</I>&gt;<i> &gt; completely local to NAnt, and not something affecting other
</I>&gt;<i> &gt; applications.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Keep in mind that my nant experience is very limited (no offense to nant
</I>&gt;<i> &gt; meant at all, just a fact). The last time i even looked at nant it
</I>&gt;<i> &gt; required setting some variables in a .exe.config file with locations
</I>&gt;<i> &gt; such as /usr/bin and /usr/lib to get it working. Has this changed?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If not, that seems to be your root problem. First of all, (and this
</I>&gt;<i> &gt; would obviously require some shell script frontend to nant), all of that
</I>&gt;<i> &gt; info can be gleaned via pkg-config at runtime, so there should be no
</I>&gt;<i> &gt; need for that.
</I>&gt;<i> 
</I>&gt;<i> For linux, this hasn't changed no, as I couldn't find a way to determine
</I>&gt;<i> which Mono versions are installed, and in what locations ...  For Windows,
</I>&gt;<i> the available frameworks are automatically determined.
</I>&gt;<i> 
</I>&gt;<i> It would be great, if you could supply this information to us ... None of
</I>&gt;<i> the active NAnt contributors are linux experts (I've no problem admitting
</I>&gt;<i> this) ...
</I>&gt;<i> 
</I>&gt;<i> Note: we need to be able to obtain this information for all installed
</I>&gt;<i> frameworks (mono versions) ...
</I>&gt;<i> 
</I>
Well, There is no tried and true guarenteed method, as linux software
installation is always a *interesting* setup ;)

However, in general if you run:

pkg-config --variable=prefix mono

you will get back a path. That path can then have /bin and /lib appended
to it to get what you guys have hardcoded.

There are times with a 'interesting' mono setup that the above
commandline will not return proper info, however this is realistically
going to work 99% of the time (RPM users) and 99.9% of the time for
people who wouldnt understand what is going on.

&gt;<i> &gt; Now. Assuming everything is the same, it seems that before you worry
</I>&gt;<i> &gt; about making portable build scripts, you need to worry about making
</I>&gt;<i> &gt; portable assumptions. As assuming that the path is the only way to
</I>&gt;<i> &gt; specify the framework version you want doesn't seem portable.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And yet again, I still dont see why you need the path to the assembly
</I>&gt;<i> &gt; absolutely. I would assume that your xml format for references is
</I>&gt;<i> &gt; something like:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;reference name=&quot;AssemblyName&quot; version=&quot;0.0.0.0&quot; pubtoken=&quot;something&quot;
</I>&gt;<i> &gt; culture=&quot;somethingelse&quot;/&gt;
</I>&gt;<i> 
</I>&gt;<i> Nope, as that would not make these references portable.  NAnt allows you to
</I>&gt;<i> switch the target framework on the fly, by always using the fully qualified
</I>&gt;<i> assembly names you wouldn't be able to target both .NET 1.0 and .NET 1.1
</I>&gt;<i> using the same build script ... at least not in a clean matter ...
</I>&gt;<i> 
</I>
Well, you would target the different libraries with the version element,
but thats unimportant ;)

&gt;<i> In NAnt, you'd actually use the following xml format :
</I>&gt;<i> 
</I>&gt;<i> &lt;references&gt;
</I>&gt;<i>     &lt;includes name=&quot;&lt;path to a third party assembly&gt;&quot; /&gt;
</I>&gt;<i>     &lt;includes name=&quot;System.dll&quot; /&gt;
</I>&gt;<i>     &lt;includes name=&quot;lib/*.dll&quot; /&gt;
</I>&gt;<i> &lt;/references&gt;
</I>&gt;<i> 
</I>&gt;<i> So, we allow full or partial paths to an assembly, and wildcards.  When an
</I>&gt;<i> assembly is not found in the base dir, we search for the assembly in the
</I>&gt;<i> framework assembly directory.
</I>&gt;<i> 
</I>&gt;<i> &gt; I dont understand how there would be any problem adapting the
</I>&gt;<i> &gt; information given there to generate a commandline that works for mcs,
</I>&gt;<i> &gt; and csc given any subset of that data.
</I>&gt;<i> 
</I>&gt;<i> Always using fully qualified assembly names is not an option, and for Mono,
</I>&gt;<i> we would not be able to search for an assembly in the framework assembly
</I>&gt;<i> directory, as there would no longer be such a dir (all system assemblies are
</I>&gt;<i> in the GAC), and we can't scan the GAC as that would mean we'd have to guess
</I>&gt;<i> too ...
</I>&gt;<i> 
</I>&gt;<i> And we can't just determine the fully qualified assembly name of a given
</I>&gt;<i> assembly file, as you could have NAnt running on NET 1.0 while targeting and
</I>&gt;<i> referencing a .NET 2.0 assembly. Meaning we wouldn't even be able to load
</I>&gt;<i> the assembly ...
</I>&gt;<i> 
</I>
And this is solved by referencing the assembly on the commandline by an
absolute path name?

Well, if the issue is just which assembly you default to, a (sample)
solution would be:

if you cant find the assembly anywhere else, and are going to check the
frameworkdir and are on mono, you could look at `pkg-config
--variable=libdir mono`/mono/gac/ASSEMBLYNAME/defaultversion_* and see
if it exists, and if so, pass /r:ASSEMBLYNAME, Version=defaultversion in
the command line.

Obviously you would need some way in nant of saying you wanted the mono
thats 1.1 compat or the one thats 2.0 compat or what have you.

Just a quick potential solution, not sure how feasible it is to
implement in your framework.

&gt;<i> &gt;
</I>&gt;<i> &gt; However, on the other hand, if your reference setup basically takes the
</I>&gt;<i> &gt; name, and tacks it onto the end of whatever is put in as the
</I>&gt;<i> &gt; frameworkDirectory in the config file, *THAT* is the portability
</I>&gt;<i> &gt; problem, not the mono GAC implementation.
</I>&gt;<i> 
</I>&gt;<i> I agree our implementation is far from perfect (perhaps I would've done it
</I>&gt;<i> some other way, but we can't just break every existing build file out
</I>&gt;<i> there), but I don't see a good alternative if you want to maintain support
</I>&gt;<i> for multiple target frameworks, and maintain portability of the build files
</I>&gt;<i> ... But we definitely are open to suggestions ...
</I>&gt;<i> 
</I>
I dont understand how adding new potential elements to your xml would
break older versions. It should be possible to support both &lt;include&gt;
schemas.

Let me know if any of this info helped, as having nant working on mono
is important to everyone involved I would assume.

&gt;<i> Gert
</I>&gt;<i> 
</I>
--Todd


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005294.html">[Mono-devel-list] GAC (design) issues
</A></li>
	<LI>Next message: <A HREF="005313.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5298">[ date ]</a>
              <a href="thread.html#5298">[ thread ]</a>
              <a href="subject.html#5298">[ subject ]</a>
              <a href="author.html#5298">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
