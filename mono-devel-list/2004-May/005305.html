<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] GAC (design) issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=1083593277.1928.6.camel%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005304.html">
   <LINK REL="Next"  HREF="005306.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] GAC (design) issues</H1>
    <B>Ian MacLean</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20%28design%29%20issues&In-Reply-To=1083593277.1928.6.camel%40localhost.localdomain"
       TITLE="[Mono-devel-list] GAC (design) issues">ianm at ActiveState.com
       </A><BR>
    <I>Mon May  3 10:36:53 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005304.html">[Mono-devel-list] GAC (design) issues
</A></li>
        <LI>Next message: <A HREF="005306.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5305">[ date ]</a>
              <a href="thread.html#5305">[ thread ]</a>
              <a href="subject.html#5305">[ subject ]</a>
              <a href="author.html#5305">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Todd Berman wrote:

&gt;<i>On Mon, 2004-03-05 at 09:36 -0400, Joshua Tauberer wrote:
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Ian MacLean wrote:
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> From my understanding of things .net compiler references should 
</I>&gt;&gt;&gt;<i>*always* be file paths. The assembly probing mechanism is intended for 
</I>&gt;&gt;&gt;<i>*runtime* resolution of assemblies not compile time references.
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>Great point.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Agreed, this was something that I brought up with jackson a handful of
</I>&gt;<i>days ago (believe it or not), however we decided to see what we could do
</I>&gt;<i>with just gac references.
</I>&gt;<i>
</I>&gt;<i>The basic issue boils down to this. Having a /usr/lib/net-1.1/ assembly
</I>&gt;<i>that mcs uses to resolve is no problem, ship it in the -devel rpms, etc.
</I>&gt;<i>No issue. The issue comes with something like gtk-sharp.
</I>&gt;<i>
</I>&gt;<i>Do you put the gtk-sharp libraries in net-1.1 and net-2.0, etc, etc?
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>only if the gtk-sharp libraries need to be different between 1.1 and 2.0 
otherwise they can just reside in a gtk-sharp directory. MS only uses 
the \WINDOWS\Microsoft.NET\Framework\v1.1.4322\ directory for 'system' 
or 'framework' assemblies - ie those that ship with the base framework. 
So for mono I guess it comes down to where you draw the boundary of 
which are the 'core' assemblies. If gtk-sharp is considered to be in 
this list then it would reside with corlib.dll and friends otherwise it 
would be somewhere else.

&gt;<i> If so, that becomes unmanagable really really fast.
</I>&gt;<i>
</I>&gt;<i>So then you say, OK, 3rd party libraries install their stuff
</I>&gt;<i>into /usr/lib/LIBRARYNAME-VERSION/ and then somehow tell mcs to probe
</I>&gt;<i>that directory for runtime assemblies.
</I>&gt;<i>
</I>why does mcs need to probe ? Just pass 
\r:/usr/lib/LIBRARYNAME-VERSION.dll or \r:/opt/foo/assemblyname.dll or 
whatever. gcc doesn't probe to find .h files so why should mcs.exe need 
to probe to find assembly references ?

&gt;<i> To us, that seemed avoidable by
</I>&gt;<i>just resolving mcs references out of the gac. It also seems like a
</I>&gt;<i>better solution in the long term.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>except that now you have to know the public key token in order to 
generate a file based reference rather than just using a known base 
path. The other issue is 3rd party compilers ( nemerle, ikvm etc ) that 
will also have to implement this auto gac probing mechanism to work on mono.

&gt;<i>However, if someone can come up with a good 3rd party solution (taking
</I>&gt;<i>into account different prefixes and all those permissions issues) I
</I>&gt;<i>would love to hear it.
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>Do you mean a solution for 3rd party apps or just an alternative 
solution to the current setup ?
If we can agree that storing a seperate copy of assemblies that reside 
in the gac for the purposes of referencing them is a reasonable thing to 
do then we'll have made a good start.


Ian

&gt;<i>--Todd
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>I don't usually speak up on these issues, but is there any reason not to 
</I>&gt;&gt;<i>do it both ways (actually all four ways)?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>It's obviously important (now obvious to me thanks to Ian) to be able to 
</I>&gt;&gt;<i>reference an assembly by path name.  If a /r is an absolute path, look 
</I>&gt;&gt;<i>for the assembly at that location.  This would be compatibile with MS. 
</I>&gt;&gt;<i>(e.g. /r:/usr/lib/whatever/System.dll)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Next, if the assembly is exactly the name of one of the core framework 
</I>&gt;&gt;<i>assemblies that MS places in the same directory as csc, load the 
</I>&gt;&gt;<i>appropriate version of the assembly from the GAC.  (The one that 
</I>&gt;&gt;<i>corresponds to the version of the invoked mcs, or something.)  This 
</I>&gt;&gt;<i>maintains compatibility with MS (and is a nice feature to boot).  (e.g. 
</I>&gt;&gt;<i>/r:System.dll)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Next, if the /r is a relative path, look for the assembly relative to 
</I>&gt;&gt;<i>the current directory.  (e.g. /r:./System.dll or /r:YourAssembly.dll)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Finally, if the /r specifies an assembly name, load it from the GAC with 
</I>&gt;&gt;<i>the normal GAC rules.  (e.g. /r:System[, Version=blah])
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>In the few minutes I've thought about it, it seems to me it would work 
</I>&gt;&gt;<i>well and not break anything, and also not require multiple copies of 
</I>&gt;&gt;<i>anything (provided absolute paths into the GAC work).  Apologies if I've 
</I>&gt;&gt;<i>missed something obvious, of course.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>-- 
</I>&gt;&gt;<i>- Joshua Tauberer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i><A HREF="http://taubz.for.net">http://taubz.for.net</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>** Nothing Unreal Exists **
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>_______________________________________________
</I>&gt;&gt;<i>Mono-devel-list mailing list
</I>&gt;&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>

-- 
Ian MacLean, Developer, 
ActiveState, a division of Sophos
<A HREF="http://www.ActiveState.com">http://www.ActiveState.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005304.html">[Mono-devel-list] GAC (design) issues
</A></li>
	<LI>Next message: <A HREF="005306.html">[Mono-devel-list] GAC (design) issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5305">[ date ]</a>
              <a href="thread.html#5305">[ thread ]</a>
              <a href="subject.html#5305">[ subject ]</a>
              <a href="author.html#5305">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
