<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] (no subject)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%28no%20subject%29&In-Reply-To=487C7BED8BFCDD4C9B1E4EA3DCEA5FC7047BBD7A%40swsmsx402.ger.corp.intel.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005693.html">
   <LINK REL="Next"  HREF="005697.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] (no subject)</H1>
    <B>Lluis Sanchez</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%28no%20subject%29&In-Reply-To=487C7BED8BFCDD4C9B1E4EA3DCEA5FC7047BBD7A%40swsmsx402.ger.corp.intel.com"
       TITLE="[Mono-devel-list] (no subject)">lluis at ximian.com
       </A><BR>
    <I>Thu May 13 14:27:40 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="005693.html">[Mono-devel-list] (no subject)
</A></li>
        <LI>Next message: <A HREF="005697.html">[Mono-devel-list] Automated builds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5696">[ date ]</a>
              <a href="thread.html#5696">[ thread ]</a>
              <a href="subject.html#5696">[ subject ]</a>
              <a href="author.html#5696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Patrik,

The behavior of async calls for proxies changed from .NET 1.0 to 1.1.
The current implementation behaves like 1.0. 

It seems that in 1.1 some functionality that was implemented in
RemotingProxy has been moved to RealProxy. I think we should do the
same. I don't like checking for RemotingProxy inside RealProxy. It
should be independent. For the EndInvoke call there is no problem since
it has to do the same for RemotingProxy and custom proxies. 

For BeginInvoke, after the Invoke call, the RealProxy has to know if the
call has been completed synchronously (always true for custom proxies,
and may be true for RemotingProxy for some specific methods like
GetType()) or if it is being executed asynchronously. We could use
AsyncResult.IsCompleted for this. Thus, the sequence in RealProxy would
be:
1) Set AsyncResult.IsCompleted to true.
2) Call proxy.Invoke()
3) if AsyncResult.IsCompleted is still true, call
AsyncResult.SyncProcessMessage
4) if not, just return.

RemotingProxy.Invoke would do:
1) if the method is GetHashCode or GetType, run it and return
2) if not, set IsCompleted to false, execute the message asynchronously
and return.

Does this make sense?

(BTW, we should avoid adding new FIXMEs at this time, since mono 1.0 is
getting closer ;-)

Lluis.

On dj, 2004-05-13 at 17:15, Torstensson, Patrik wrote: 
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> This patch solves problem with custom proxies together with async
</I>&gt;<i> delegeate calls, the behavior matches MS. This patch misses handling
</I>&gt;<i> constructor calls to the customer proxy something that also needs to be
</I>&gt;<i> handled in the remoting proxy.
</I>&gt;<i> 
</I>&gt;<i> The metadata patch is just to make sure that mono_method_get_param_names
</I>&gt;<i> (loader.c line 931) that compare method address get the correct method
</I>&gt;<i> not a wrapper (same goes for some other methods used in
</I>&gt;<i> mono_message_init). This was the reason why a custom proxy didn't pickup
</I>&gt;<i> the arg names correctly.
</I>&gt;<i> 
</I>&gt;<i> This patch fixes remoting2/3 mono test.
</I>&gt;<i> 
</I>&gt;<i> Ok to commit?
</I>&gt;<i> 
</I>&gt;<i> Cheers, 
</I>&gt;<i>  Patrik
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005693.html">[Mono-devel-list] (no subject)
</A></li>
	<LI>Next message: <A HREF="005697.html">[Mono-devel-list] Automated builds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5696">[ date ]</a>
              <a href="thread.html#5696">[ thread ]</a>
              <a href="subject.html#5696">[ subject ]</a>
              <a href="author.html#5696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
