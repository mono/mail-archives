<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] GAC Information and Assembly Versioning
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20Information%20and%20Assembly%20Versioning&In-Reply-To=1085744603.10019.39.camel%40melchior">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006033.html">
   <LINK REL="Next"  HREF="006040.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] GAC Information and Assembly Versioning</H1>
    <B>Todd Berman</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20GAC%20Information%20and%20Assembly%20Versioning&In-Reply-To=1085744603.10019.39.camel%40melchior"
       TITLE="[Mono-devel-list] GAC Information and Assembly Versioning">tberman at sevenl.net
       </A><BR>
    <I>Fri May 28 10:02:30 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006033.html">[Mono-devel-list] GAC Information and Assembly Versioning
</A></li>
        <LI>Next message: <A HREF="006040.html">[Mono-devel-list] GAC Information and Assembly Versioning
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6039">[ date ]</a>
              <a href="thread.html#6039">[ thread ]</a>
              <a href="subject.html#6039">[ subject ]</a>
              <a href="author.html#6039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is pretty much on, I will try and add comments inline to where
there is more info available.

On Fri, 2004-28-05 at 07:43 -0400, Jonathan Pryor wrote:
&gt;<i> I apologize profusely for even mentioning the GAC again, as every time
</I>&gt;<i> it comes up a large thread is spawned...  I fear this will be no
</I>&gt;<i> different.
</I>&gt;<i> 
</I>&gt;<i> First, is there any public document describing the current GAC system,
</I>&gt;<i> it's aims, how it works, and how to use it?
</I>&gt;<i> 
</I>&gt;<i> In a sense, the first part of this email is an attempt at documenting
</I>&gt;<i> some of this, to ensure that (1) I understand what's going on, and (2)
</I>&gt;<i> the current situation will actually be documented.
</I>&gt;<i> 
</I>&gt;<i> The second part asks a question regarding the current setup and
</I>&gt;<i> interaction with assembly versions.
</I>&gt;<i> 
</I>&gt;<i> At present, the GAC directory structure appears to be:
</I>&gt;<i> 
</I>&gt;<i> 	$prefix/lib/mono/&lt;assembly-name&gt;/&lt;assembly-version&gt;/&lt;files&gt;
</I>&gt;<i> 
</I>
In fact, the setup is $prefix/lib/mono/gac/&lt;assembly-name&gt;/&lt;assembly-
version&gt;_&lt;assembly-culture&gt;_&lt;assembly-publickeytoken&gt;/&lt;assembly-name&gt;.
dll

because most assemblies have a neutral culture, they are inserted
without a culture string so you end up with __.

Notice that at the end it is &lt;assembly-name&gt;.dll. This is a bit
different than what you might expect.

MCS assigns the assembly name based on the -out: parameter to your
compile command, however, you can always rename it later to something
else. If you created gaclib.dll, renamed it somethingelse.dll and put it
in the gac, it would show up as gaclib.dll, not somethingelse. Not
normally something to worry about, but just more info.

&gt;<i> For example, Gtk# is installed in
</I>&gt;<i> 
</I>&gt;<i> 	/usr/lib/mono/gac/gtk-sharp/1.0.0.0__35e10195dab3c99f/gtk-sharp.dll
</I>&gt;<i> 
</I>&gt;<i> To compile against Gtk#, we can either explicitly use pkg-config:
</I>&gt;<i> 
</I>&gt;<i> 	mcs my-app.cs `pkg-config --libs gtk-sharp`
</I>&gt;<i> 
</I>&gt;<i> Or we can use the new -pkg mcs flag:
</I>&gt;<i> 
</I>&gt;<i> 	mcs my-app.cs -pkg:gtk-sharp
</I>&gt;<i> 
</I>&gt;<i> Which is analogous to the above.
</I>&gt;<i> 
</I>&gt;<i> Pkg-config, in turn, refers to files located in:
</I>&gt;<i> 
</I>&gt;<i> 	$prefix/lib/pkgconfig/&lt;assembly-name&gt;.pc
</I>&gt;<i> 
</I>&gt;<i> In the case of Gtk#, /usr/lib/pkgconfig/gtk-sharp.pc.
</I>&gt;<i> 
</I>&gt;<i> The pkg-config (.pc) file in turn contains both the required assembly
</I>&gt;<i> reference arguments (-r:glib-sharp, etc.) and directories to add for the
</I>&gt;<i> search path (-lib:/usr/lib/mono/gtk-sharp).
</I>
The current pc files directly reference the symlinks, as 5 /r:s with
full path are faster than one /lib and 5 /r's with just a dll name.

so for gtk-sharp my Libs: line looks like:

-r:/usr/lib/mono/gtk-sharp/glib-sharp.dll -r:/usr/lib/mono/gtk-sharp/
pango-sharp.dll -r:/usr/lib/mono/gtk-sharp/atk-sharp.dll -r:/usr/lib/
mono/gtk-sharp/gdk-sharp.dll -r:/usr/lib/mono/gtk-sharp/gtk-sharp.dll

A bit long looking, but since this is something you dont have to deal
with directly, it works out fine.

&gt;<i> 
</I>&gt;<i> What's in the library search path?  Symbolic links from:
</I>&gt;<i> 
</I>&gt;<i> 	$prefix/lib/mono/&lt;project-name&gt;/&lt;assembly-name&gt;.dll
</I>&gt;<i> 
</I>&gt;<i> which refer to the actual files within the GAC.  Project-name is a new
</I>&gt;<i> construct, grouping related assemblies within the same project.  For
</I>&gt;<i> example, the &quot;gtk-sharp&quot; project contains symbolic links for
</I>&gt;<i> art-sharp.dll, atk-sharp.dll, gdk-sharp.dll, glad-sharp.dll,
</I>&gt;<i> glib-sharp.dll, gtk-sharp.dll, and pango-sharp.dll.  Project-name could
</I>&gt;<i> also be the assembly-name, if the project contains only one assembly.
</I>&gt;<i> 
</I>
Actually, there are a lot more things installing into the gtk-sharp
'package' currently. In addition to gnome, gconf, etc, right now gecko-
sharp and gtksourceview-sharp also go there. Part of this was the need
to use them before -pkg was ready, and part of this was that it just
makes sense.

&gt;<i> All of this appears to be the case for CVS so far.
</I>&gt;<i> 
</I>&gt;<i> Now, the question: how do we handle development against multiple
</I>&gt;<i> assembly versions?  Todd Berman first asked this on May 11, and I didn't
</I>&gt;<i> see anything that directly answered his question, and the problem didn't
</I>&gt;<i> occur to me until recently.
</I>&gt;<i> 
</I>
That is actually pretty easy.

Gtk# 1.0 installs all its pc files, dlls, etc, the way it does now. Then
Gtk# 1.2 comes along, and names its pc files and 'package' gtk-sharp-1.2
or whatever. You would end up with:

$prefix/lib/pkgconfig/gtk-sharp-1.2.pc

and

$prefix/lib/mono/gac/gtk-sharp-1.2/gtk-sharp.dll

which would be a symlink to the 1.2 assembly in the gac.

This would allow a developer who wants to compile against the 1.2
libraries to just pass -pkg:gtk-sharp-1.2 to mcs.

Gtk# 1.0 and 1.2 would then become parallel installable.

So both developers and users would be set at both runtime, and compile
time.

--Todd

&gt;<i> When Mono 1.0 is released, Gtk# 1.0 will also be released.
</I>&gt;<i> 
</I>&gt;<i> When Gnome 2.8 is released in September, Gtk# 1.2 will likely be
</I>&gt;<i> released.  (Last I heard, Gtk# would try to follow the Gnome Language
</I>&gt;<i> Bindings schedule after 1.0, which is tied to the Gnome schedule.)
</I>&gt;<i> 
</I>&gt;<i> Consequently, before the end of the year we're likely to have two
</I>&gt;<i> different (and upwardly compatible) versions of Gtk# installed on our
</I>&gt;<i> machines.
</I>&gt;<i> 
</I>&gt;<i> What happens if we want to develop against *both* of them?  It's
</I>&gt;<i> entirely plausible that developers will have both versions installed,
</I>&gt;<i> but users will have a mix between the two, with some users sticking to
</I>&gt;<i> Gtk# 1.0 because they don't have GTK+ 2.4 yet (slow Red Hat 9 users, for
</I>&gt;<i> example).
</I>&gt;<i> 
</I>&gt;<i> Since the current use of pkg-config presently ignores versions, as the
</I>&gt;<i> -lib directory is unversioned, how do we handle this development
</I>&gt;<i> scenario?  It seems that we could only have one Gtk# development package
</I>&gt;<i> installed at a time.
</I>&gt;<i> 
</I>&gt;<i> This might not be too bad, as GTK+ can only have one development version
</I>&gt;<i> installed at a time, IIRC.  (That is, you can't have GTK+ 2.2 and GTK+
</I>&gt;<i> 2.4 development packages installed at the same time, as the header files
</I>&gt;<i> will conflict with each other.  Furthermore, some of the headers have
</I>&gt;<i> changed between the versions, preventing code compiled against the GTK+
</I>&gt;<i> 2.4 headers from running on a GTK+ 2.2 system.)
</I>&gt;<i> 
</I>&gt;<i> Alternatively, we could version the pkg-config files, resulting in
</I>&gt;<i> gtk-sharp-1.0.pc and gtk-sharp-1.2.pc, and each could refer to a
</I>&gt;<i> different, versioned, directory in the -lib: argument.  However, this
</I>&gt;<i> might be non-obvious, as the command:
</I>&gt;<i> 
</I>&gt;<i> 	mcs my-app.cs -pkg:gtk-sharp-1.0
</I>&gt;<i> 
</I>&gt;<i> would generate assembly references to gtk-sharp.dll.
</I>&gt;<i> 
</I>&gt;<i> Do we want to support development against multiple assembly versions? 
</I>&gt;<i> If so, how should we support it?  We should probably solve this before
</I>&gt;<i> Mono 1.0 is released, as we'll likely run into these issues before Mono
</I>&gt;<i> 1.2 is shipped at the end of the year.
</I>&gt;<i> 
</I>&gt;<i>  - Jon
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006033.html">[Mono-devel-list] GAC Information and Assembly Versioning
</A></li>
	<LI>Next message: <A HREF="006040.html">[Mono-devel-list] GAC Information and Assembly Versioning
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6039">[ date ]</a>
              <a href="thread.html#6039">[ thread ]</a>
              <a href="subject.html#6039">[ subject ]</a>
              <a href="author.html#6039">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
