<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] reloading mono domain or assemblies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20reloading%20mono%20domain%20or%20assemblies&In-Reply-To=i43jel%2438k%241%40dough.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035673.html">
   <LINK REL="Next"  HREF="035677.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] reloading mono domain or assemblies</H1>
    <B>Lucas Meijer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20reloading%20mono%20domain%20or%20assemblies&In-Reply-To=i43jel%2438k%241%40dough.gmane.org"
       TITLE="[Mono-dev] reloading mono domain or assemblies">lucas at lucasmeijer.com
       </A><BR>
    <I>Fri Aug 13 12:19:03 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035673.html">[Mono-dev] reloading mono domain or assemblies
</A></li>
        <LI>Next message: <A HREF="035677.html">[Mono-dev] reloading mono domain or assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35674">[ date ]</a>
              <a href="thread.html#35674">[ thread ]</a>
              <a href="subject.html#35674">[ subject ]</a>
              <a href="author.html#35674">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>  On 8/13/10 4:04 PM, Robert Jordan wrote:
&gt;<i> Well, it doesn't really matter who's creating the domains
</I>&gt;<i> and loading the assemblies. It's by far easier to implement
</I>&gt;<i> this in C# and then mono_runtime_invoke it from C++.
</I>&gt;<i>
</I>&gt;<i> Of course, you can invoke everything from C++ but this will
</I>&gt;<i> likely triplicate the amount of code to be written.
</I>&gt;<i>
</I>&gt;<i> Furthermore, the only safe way to create a domain in C++ is
</I>&gt;<i> mono_runtime_invoke-ing System.AppDomain.CreateDomain(), IIRC.
</I>you can use mono_domain_create() and mono_domain_unload() just fine from 
c.  In fact, I suspect it's actually
easier to do from native code these days.  basically what you should do is:

create domain
set it active
load your assemblies
run your code

when you want to reload code,

unload the domain
load your assemblies again
run your code.

It gets tricky though, as you need to somehow maintain the &quot;state&quot; of 
your program. We use custom serialization
to remember the state of all objects,   tear down everything,  load new 
assemblies,  recreate all objects, and reconfigure them the way they were.
not an easy task by any means.

also make sure you load your assemblies from memory instead of from 
disk.  at least on windows, if you read them from disk, you will not be 
allowed to
overwrite your assemblies with new ones.

domain unloading/reloading is a bit of a notorious area, with plenty of 
memory leaks and bugs.  mostly because it is a way to use mono that not that
many people seem to be doing.  I would say from all the mono related 
work I do at Unity, about 80% is related to problems relating to domain 
unloading.

Bye, Lucas
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035673.html">[Mono-dev] reloading mono domain or assemblies
</A></li>
	<LI>Next message: <A HREF="035677.html">[Mono-dev] reloading mono domain or assemblies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35674">[ date ]</a>
              <a href="thread.html#35674">[ thread ]</a>
              <a href="subject.html#35674">[ subject ]</a>
              <a href="author.html#35674">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
