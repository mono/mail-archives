<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Strange Casting bug in .net 4 profile
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Strange%20Casting%20bug%20in%20.net%204%20profile&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035705.html">
   <LINK REL="Next"  HREF="035707.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Strange Casting bug in .net 4 profile</H1>
    <B>Gary Thomas</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Strange%20Casting%20bug%20in%20.net%204%20profile&In-Reply-To="
       TITLE="[Mono-dev] Strange Casting bug in .net 4 profile">Gary.Thomas at ioko.com
       </A><BR>
    <I>Wed Aug 18 07:52:24 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035705.html">[Mono-dev] ARM9 Soft Float Arithmetic
</A></li>
        <LI>Next message: <A HREF="035707.html">[Mono-dev] Strange Casting bug in .net 4 profile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35706">[ date ]</a>
              <a href="thread.html#35706">[ thread ]</a>
              <a href="subject.html#35706">[ subject ]</a>
              <a href="author.html#35706">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,
	I have been using mono from trunk and playing with the WCF stuff when I noticed an InvalidCastException being thrown. I figured out that this only happened when using the .net 4 profile, when using .net 3.5 profile it didn't happen.
I have put together a simple app to show the problem and here are the results.

With .net 4:

[mono] ~/Projects/CastBug @ dmcs CastBug.cs /reference:System.Configuration /reference:System.ServiceModel
CastBug.cs(19,41): warning CS0219: The variable `ss' is assigned but its value is never used
Compilation succeeded - 1 warning(s)
[mono] ~/Projects/CastBug @ mono CastBug.exe 
System.ServiceModel.Configuration.ServicesSection
section is ConfigurationSection True
section is ServicesSection False
ServiceSection type System.ServiceModel.Configuration.ServicesSection
Casting section

Unhandled Exception: System.InvalidCastException: Cannot cast from source type to destination type.
  at CastBug.MainClass.Main (System.String[] args) [0x00000] in &lt;filename unknown&gt;:0


With .net 3.5:

[mono] ~/Projects/CastBug @ gmcs CastBug.cs /reference:System.Configuration /reference:System.ServiceModel
CastBug.cs(19,41): warning CS0219: The variable `ss' is assigned but its value is never used
Compilation succeeded - 1 warning(s)
[mono] ~/Projects/CastBug @ mono CastBug.exe 
System.ServiceModel.Configuration.ServicesSection
section is ConfigurationSection True
section is ServicesSection True
ServiceSection type System.ServiceModel.Configuration.ServicesSection
Casting section
Done casting section

The runtime reports the type of the object as ServicesSection but casting it to a ServicesSection causes an InvalidCastException.

Here is the test app:

using System;
using System.Configuration;
using System.ServiceModel.Configuration;

namespace CastBug
{
        class MainClass
        {
                public static void Main (string[] args)
                {
                        var section = ConfigurationManager.GetSection(&quot;system.serviceModel/services&quot;);
                        Console.WriteLine(section.GetType().ToString());
                        Console.WriteLine(&quot;section is ConfigurationSection {0}&quot;, section is ConfigurationSection);
                        Console.WriteLine(&quot;section is ServicesSection {0}&quot;, section is ServicesSection);
                        Console.WriteLine(&quot;ServiceSection type {0}&quot;, typeof(ServicesSection).ToString());

                        Console.WriteLine(&quot;Casting section&quot;);
                        // throws an InvalidCastException
                        ServicesSection ss = (ServicesSection)section;
                        Console.WriteLine(&quot;Done casting section&quot;);

                }
        }
}

Is this a known issue? Should I report a bug? If it was a simple bug in the c# libraries I would have a go at fixing myself but this seem more fundamental than that.

Thanks,
Gary
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035705.html">[Mono-dev] ARM9 Soft Float Arithmetic
</A></li>
	<LI>Next message: <A HREF="035707.html">[Mono-dev] Strange Casting bug in .net 4 profile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35706">[ date ]</a>
              <a href="thread.html#35706">[ thread ]</a>
              <a href="subject.html#35706">[ subject ]</a>
              <a href="author.html#35706">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
