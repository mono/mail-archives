<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Is there any reason to not add instead a flag?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Is%20there%20any%20reason%20to%20not%20add%20instead%20a%20flag%3F&In-Reply-To=20100810183823.76DA72206C%40mono.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035668.html">
   <LINK REL="Next"  HREF="035649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Is there any reason to not add instead a flag?</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Is%20there%20any%20reason%20to%20not%20add%20instead%20a%20flag%3F&In-Reply-To=20100810183823.76DA72206C%40mono.ximian.com"
       TITLE="[Mono-dev] Is there any reason to not add instead a flag?">miguel at novell.com
       </A><BR>
    <I>Tue Aug 10 15:41:10 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="035668.html">[Mono-dev] Mono Application Dependencies
</A></li>
        <LI>Next message: <A HREF="035649.html">[Mono-dev] Is there any reason to not add instead a flag?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35642">[ date ]</a>
              <a href="thread.html#35642">[ thread ]</a>
              <a href="subject.html#35642">[ subject ]</a>
              <a href="author.html#35642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In your recent commit, you added a new command to mcs/tools/corcompare,
the mono-abi-info tool.   I do not know what this tool does, and I do
not know why we could not just have used mono-api-info with a new flag
--abi instead of installing another executable.

It goes against the &quot;If it is not documented, it does not exist&quot; rule.

So can we:

	(a) get this merged into mono-api-info
	(b) document this on the wiki or the relevant man pages?

miguel

&gt;<i> Branch: refs/heads/master
</I>&gt;<i>   Home: <A HREF="http://github.com/mono/mono">http://github.com/mono/mono</A>
</I>&gt;<i> 
</I>&gt;<i> Commit: c508a786c106ceff274b9b985919368b6b404342
</I>&gt;<i> Author: Andr&#233;s G. Aragoneses &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">knocte at gmail.com</A>&gt;
</I>&gt;<i>   Date: 08/10/2010 14:36:27
</I>&gt;<i>    URL: <A HREF="http://github.com/mono/mono/commit/c508a786c106ceff274b9b985919368b6b404342">http://github.com/mono/mono/commit/c508a786c106ceff274b9b985919368b6b404342</A>
</I>&gt;<i> 
</I>&gt;<i> Added new ABI mode to mono-api-info tool, wrapped in a mono-abi-info script.
</I>&gt;<i> 
</I>&gt;<i> 2010-08-05  Andr&#233;s G. Aragoneses  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">andres at lindenlab.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> * mcs/tools/corcompare/mono-api-info.cs: Implemented new mode to show ABI.
</I>&gt;<i> * mcs/tools/corcompare/Makefile: added mono-abi-info autofoo.
</I>&gt;<i> * scripts/.gitignore: added mono-abi-info.
</I>&gt;<i> * scripts/Makefile.am: added mono-abi-info autofoo.
</I>&gt;<i> 
</I>&gt;<i> Changed paths:
</I>&gt;<i>  M ChangeLog
</I>&gt;<i>  M mcs/tools/corcompare/ChangeLog
</I>&gt;<i>  M mcs/tools/corcompare/Makefile
</I>&gt;<i>  M mcs/tools/corcompare/mono-api-info.cs
</I>&gt;<i>  M scripts/.gitignore
</I>&gt;<i>  M scripts/Makefile.am
</I>&gt;<i> 
</I>&gt;<i> Modified: ChangeLog
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- a/ChangeLog
</I>&gt;<i> +++ b/ChangeLog
</I>&gt;<i> @@ -1,3 +1,8 @@
</I>&gt;<i> +2010-08-05  Andr??s G. Aragoneses  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">andres at lindenlab.com</A>&gt;
</I>&gt;<i> +
</I>&gt;<i> +	* scripts/.gitignore: added mono-abi-info.
</I>&gt;<i> +	* scripts/Makefile.am: added mono-abi-info autofoo.
</I>&gt;<i> +
</I>&gt;<i>  2010-07-16  Zoltan Varga  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">vargaz at gmail.com</A>&gt;
</I>&gt;<i>  
</I>&gt;<i>  	* configure.in: Remove the 'LLVM backend is experimental' warning.
</I>&gt;<i> Modified: mcs/tools/corcompare/ChangeLog
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- a/mcs/tools/corcompare/ChangeLog
</I>&gt;<i> +++ b/mcs/tools/corcompare/ChangeLog
</I>&gt;<i> @@ -1,3 +1,8 @@
</I>&gt;<i> +2010-08-05  Andr??s G. Aragoneses  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">andres at lindenlab.com</A>&gt;
</I>&gt;<i> +
</I>&gt;<i> +	* mono-api-info.cs: Implemented new mode to show ABI.
</I>&gt;<i> +	* Makefile: added mono-abi-info autofoo.
</I>&gt;<i> +
</I>&gt;<i>  2010-04-16  C.J. Adams-Collier	&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">cjac at colliertech.org</A>&gt;
</I>&gt;<i>  
</I>&gt;<i>  	* mono-api-diff.cs: revived from the mono-2-2 branch and applied
</I>&gt;<i> Modified: mcs/tools/corcompare/Makefile
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- a/mcs/tools/corcompare/Makefile
</I>&gt;<i> +++ b/mcs/tools/corcompare/Makefile
</I>&gt;<i> @@ -2,7 +2,7 @@ thisdir = tools/corcompare
</I>&gt;<i>  SUBDIRS =
</I>&gt;<i>  include ../../build/rules.make
</I>&gt;<i>  
</I>&gt;<i> -ALL_PROGRAMS = mono-api-info.exe
</I>&gt;<i> +ALL_PROGRAMS = mono-api-info.exe mono-abi-info.exe
</I>&gt;<i>  
</I>&gt;<i>  CECIL = ../../class/lib/net_2_0/Mono.Cecil.dll
</I>&gt;<i>  
</I>&gt;<i> @@ -43,3 +43,6 @@ dist-local: dist-default
</I>&gt;<i>  
</I>&gt;<i>  mono-api-info.exe: $(APIINFO_SOURCES)
</I>&gt;<i>  	$(CSCOMPILE) -r:$(CECIL) -out:$@ $^
</I>&gt;<i> +
</I>&gt;<i> +mono-abi-info.exe: $(APIINFO_SOURCES)
</I>&gt;<i> +	$(CSCOMPILE) -r:$(CECIL) -d:ABI -out:$@ $^
</I>&gt;<i> Modified: mcs/tools/corcompare/mono-api-info.cs
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- a/mcs/tools/corcompare/mono-api-info.cs
</I>&gt;<i> +++ b/mcs/tools/corcompare/mono-api-info.cs
</I>&gt;<i> @@ -29,6 +29,9 @@ namespace CorCompare
</I>&gt;<i>  			if (args.Length == 0)
</I>&gt;<i>  				return 1;
</I>&gt;<i>  
</I>&gt;<i> +			AbiMode = false;
</I>&gt;<i> +			SetAbiMode ();
</I>&gt;<i> +
</I>&gt;<i>  			AssemblyCollection acoll = new AssemblyCollection ();
</I>&gt;<i>  
</I>&gt;<i>  			foreach (string fullName in args) {
</I>&gt;<i> @@ -45,6 +48,14 @@ namespace CorCompare
</I>&gt;<i>  			doc.WriteTo (writer);
</I>&gt;<i>  			return 0;
</I>&gt;<i>  		}
</I>&gt;<i> +
</I>&gt;<i> +		[System.Diagnostics.Conditional (&quot;ABI&quot;)]
</I>&gt;<i> +		private static void SetAbiMode ()
</I>&gt;<i> +		{
</I>&gt;<i> +			AbiMode = true;
</I>&gt;<i> +		}
</I>&gt;<i> +
</I>&gt;<i> +		internal static bool AbiMode { get; private set; }
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i>  	public class Utils {
</I>&gt;<i> @@ -211,7 +222,7 @@ namespace CorCompare
</I>&gt;<i>  				if (string.IsNullOrEmpty (t.Namespace))
</I>&gt;<i>  					continue;
</I>&gt;<i>  
</I>&gt;<i> -				if ((t.Attributes &amp; TypeAttributes.VisibilityMask) != TypeAttributes.Public)
</I>&gt;<i> +				if (!Driver.AbiMode &amp;&amp; ((t.Attributes &amp; TypeAttributes.VisibilityMask) != TypeAttributes.Public))
</I>&gt;<i>  					continue;
</I>&gt;<i>  
</I>&gt;<i>  				if (t.DeclaringType != null)
</I>&gt;<i> @@ -409,28 +420,31 @@ namespace CorCompare
</I>&gt;<i>  				AddAttribute (nclass, &quot;enumtype&quot;, Utils.CleanupTypeName (value_type.FieldType));
</I>&gt;<i>  			}
</I>&gt;<i>  
</I>&gt;<i> -			MethodDefinition [] ctors = GetConstructors (type);
</I>&gt;<i> -			if (ctors.Length &gt; 0) {
</I>&gt;<i> -				Array.Sort (ctors, MemberReferenceComparer.Default);
</I>&gt;<i> -				members.Add (new ConstructorData (document, nclass, ctors));
</I>&gt;<i> -			}
</I>&gt;<i> +			if (!Driver.AbiMode) {
</I>&gt;<i>  
</I>&gt;<i> -			PropertyDefinition[] properties = GetProperties (type);
</I>&gt;<i> -			if (properties.Length &gt; 0) {
</I>&gt;<i> -				Array.Sort (properties, MemberReferenceComparer.Default);
</I>&gt;<i> -				members.Add (new PropertyData (document, nclass, properties));
</I>&gt;<i> -			}
</I>&gt;<i> +				MethodDefinition [] ctors = GetConstructors (type);
</I>&gt;<i> +				if (ctors.Length &gt; 0) {
</I>&gt;<i> +					Array.Sort (ctors, MemberReferenceComparer.Default);
</I>&gt;<i> +					members.Add (new ConstructorData (document, nclass, ctors));
</I>&gt;<i> +				}
</I>&gt;<i>  
</I>&gt;<i> -			EventDefinition [] events = GetEvents (type);
</I>&gt;<i> -			if (events.Length &gt; 0) {
</I>&gt;<i> -				Array.Sort (events, MemberReferenceComparer.Default);
</I>&gt;<i> -				members.Add (new EventData (document, nclass, events));
</I>&gt;<i> -			}
</I>&gt;<i> +				PropertyDefinition[] properties = GetProperties (type);
</I>&gt;<i> +				if (properties.Length &gt; 0) {
</I>&gt;<i> +					Array.Sort (properties, MemberReferenceComparer.Default);
</I>&gt;<i> +					members.Add (new PropertyData (document, nclass, properties));
</I>&gt;<i> +				}
</I>&gt;<i> +
</I>&gt;<i> +				EventDefinition [] events = GetEvents (type);
</I>&gt;<i> +				if (events.Length &gt; 0) {
</I>&gt;<i> +					Array.Sort (events, MemberReferenceComparer.Default);
</I>&gt;<i> +					members.Add (new EventData (document, nclass, events));
</I>&gt;<i> +				}
</I>&gt;<i>  
</I>&gt;<i> -			MethodDefinition [] methods = GetMethods (type);
</I>&gt;<i> -			if (methods.Length &gt; 0) {
</I>&gt;<i> -				Array.Sort (methods, MemberReferenceComparer.Default);
</I>&gt;<i> -				members.Add (new MethodData (document, nclass, methods));
</I>&gt;<i> +				MethodDefinition [] methods = GetMethods (type);
</I>&gt;<i> +				if (methods.Length &gt; 0) {
</I>&gt;<i> +					Array.Sort (methods, MemberReferenceComparer.Default);
</I>&gt;<i> +					members.Add (new MethodData (document, nclass, methods));
</I>&gt;<i> +				}
</I>&gt;<i>  			}
</I>&gt;<i>  
</I>&gt;<i>  			foreach (MemberData md in members)
</I>&gt;<i> @@ -542,12 +556,19 @@ namespace CorCompare
</I>&gt;<i>  				if (field.IsSpecialName)
</I>&gt;<i>  					continue;
</I>&gt;<i>  
</I>&gt;<i> +				if (Driver.AbiMode &amp;&amp; field.IsStatic)
</I>&gt;<i> +					continue;
</I>&gt;<i> +
</I>&gt;<i>  				// we're only interested in public or protected members
</I>&gt;<i>  				FieldAttributes maskedVisibility = (field.Attributes &amp; FieldAttributes.FieldAccessMask);
</I>&gt;<i> -				if (maskedVisibility == FieldAttributes.Public
</I>&gt;<i> -					|| maskedVisibility == FieldAttributes.Family
</I>&gt;<i> -					|| maskedVisibility == FieldAttributes.FamORAssem) {
</I>&gt;<i> +				if (Driver.AbiMode &amp;&amp; !field.IsNotSerialized) {
</I>&gt;<i>  					list.Add (field);
</I>&gt;<i> +				} else {
</I>&gt;<i> +					if (maskedVisibility == FieldAttributes.Public
</I>&gt;<i> +						|| maskedVisibility == FieldAttributes.Family
</I>&gt;<i> +						|| maskedVisibility == FieldAttributes.FamORAssem) {
</I>&gt;<i> +						list.Add (field);
</I>&gt;<i> +					}
</I>&gt;<i>  				}
</I>&gt;<i>  			}
</I>&gt;<i>  
</I>&gt;<i> Modified: scripts/.gitignore
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- a/scripts/.gitignore
</I>&gt;<i> +++ b/scripts/.gitignore
</I>&gt;<i> @@ -42,6 +42,7 @@
</I>&gt;<i>  /mkbundle2
</I>&gt;<i>  /mod
</I>&gt;<i>  /mono-api-diff
</I>&gt;<i> +/mono-abi-info
</I>&gt;<i>  /mono-api-info
</I>&gt;<i>  /mono-api-info1
</I>&gt;<i>  /mono-api-info2
</I>&gt;<i> Modified: scripts/Makefile.am
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- a/scripts/Makefile.am
</I>&gt;<i> +++ b/scripts/Makefile.am
</I>&gt;<i> @@ -82,6 +82,7 @@ scripts_4_0 = \
</I>&gt;<i>  	mconfig$(SCRIPT_SUFFIX)			\
</I>&gt;<i>  	mod$(SCRIPT_SUFFIX)			\
</I>&gt;<i>  	monolinker$(SCRIPT_SUFFIX)		\
</I>&gt;<i> +	mono-abi-info$(SCRIPT_SUFFIX) 		\
</I>&gt;<i>  	mono-api-info$(SCRIPT_SUFFIX) 		\
</I>&gt;<i>  	mono-shlib-cop$(SCRIPT_SUFFIX) 		\
</I>&gt;<i>  	mozroots$(SCRIPT_SUFFIX)		\
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-patches maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-patches at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-patches">http://lists.ximian.com/mailman/listinfo/mono-patches</A>
</I>

</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035668.html">[Mono-dev] Mono Application Dependencies
</A></li>
	<LI>Next message: <A HREF="035649.html">[Mono-dev] Is there any reason to not add instead a flag?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35642">[ date ]</a>
              <a href="thread.html#35642">[ thread ]</a>
              <a href="subject.html#35642">[ subject ]</a>
              <a href="author.html#35642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
