<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Should we replace MemoryStream?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Should%20we%20replace%20MemoryStream%3F&In-Reply-To=hdc8mq%24b8c%241%40ger.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033486.html">
   <LINK REL="Next"  HREF="033488.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Should we replace MemoryStream?</H1>
    <B>Avery Pennarun</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Should%20we%20replace%20MemoryStream%3F&In-Reply-To=hdc8mq%24b8c%241%40ger.gmane.org"
       TITLE="[Mono-dev] Should we replace MemoryStream?">apenwarr at gmail.com
       </A><BR>
    <I>Tue Nov 10 12:56:46 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033486.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
        <LI>Next message: <A HREF="033488.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33487">[ date ]</a>
              <a href="thread.html#33487">[ thread ]</a>
              <a href="subject.html#33487">[ subject ]</a>
              <a href="author.html#33487">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Nov 10, 2009 at 12:42 PM, Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt; wrote:
&gt;<i> An algorithm based on a MemoryStream implemented with chunks will
</I>&gt;<i> perform better in average. I fully agree with that.
</I>&gt;<i>
</I>&gt;<i> The problem is that one method (GetBuffer) *will be* unexpected
</I>&gt;<i> slower,
</I>
I just don't believe this is true.  I think we're moving the slowness
from &quot;add to buffer&quot; into GetBuffer().  However, it is not
*additional* slowness.  It is simply displaced slowness, and it's
potentially *less* slowness overall.

I'm not sure I can imagine a program that would be negatively affected
by this.  Doesn't the gc cause random slowness sometimes anyway?

&gt;<i> and another one, much harder to fix: it is allowed to change
</I>&gt;<i> the buffer even before the stream has been closed. This means that
</I>&gt;<i> after every GetBuffer call, the implementation must behave differently
</I>&gt;<i> because it must somehow deal with a changed underlying buffer.
</I>
I don't think this is a problem either.  Since you're now using the
returned buffer as your one-and-only chunk, you can use it just as you
always would.  If someone then pushes so much new data into the stream
that you would exceed the buffer size, you would have to do what you
would do in the non-chunked implementation; either a) reject it, or b)
not guarantee that it ends up in the array from the earlier
GetBuffer().  I'm not sure which is the correct behaviour, but both
are easily implemented in the chunked implementation too, particularly
since it has to support user-supplied fixed-length buffers anyhow.

Perhaps I'm missing something...

Avery
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033486.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
	<LI>Next message: <A HREF="033488.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33487">[ date ]</a>
              <a href="thread.html#33487">[ thread ]</a>
              <a href="subject.html#33487">[ subject ]</a>
              <a href="author.html#33487">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
