<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Should we replace MemoryStream?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Should%20we%20replace%20MemoryStream%3F&In-Reply-To=000101ca6174%24b0e308d0%2412a91a70%24%40com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033457.html">
   <LINK REL="Next"  HREF="033462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Should we replace MemoryStream?</H1>
    <B>Steve Bjorg</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Should%20we%20replace%20MemoryStream%3F&In-Reply-To=000101ca6174%24b0e308d0%2412a91a70%24%40com"
       TITLE="[Mono-dev] Should we replace MemoryStream?">steveb at mindtouch.com
       </A><BR>
    <I>Mon Nov  9 16:00:59 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033457.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
        <LI>Next message: <A HREF="033462.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33460">[ date ]</a>
              <a href="thread.html#33460">[ thread ]</a>
              <a href="subject.html#33460">[ subject ]</a>
              <a href="author.html#33460">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The implementation could be adapted so that if the chunked memory  
stream is initialized with an existing byte array it behaves like it  
did in the past.  It's possible that the best approached can be  
derived for the various MemoryStream constructors.

The question is what is the most common usage pattern?  If it's  
GetBuffer(), then there will be a performance and overhead hit.   
However, if it's using Write()/Read() as we do, then there are some  
significant gains to be had.  GetBytes() would also benefit, though  
not as much.

- Steve

--------------
Steve G. Bjorg
<A HREF="http://mindtouch.com">http://mindtouch.com</A>
<A HREF="http://twitter.com/bjorg">http://twitter.com/bjorg</A>
irc.freenode.net #mindtouch

On Nov 9, 2009, at 11:41 AM, Andreas Nahr wrote:

&gt;<i> Are you talking about System.IO.MemoryStream?
</I>&gt;<i> Then imho this would be a problematic move.
</I>&gt;<i> Most people are used to new MemoryStream (someByteArray) being O(0)  
</I>&gt;<i> time,
</I>&gt;<i> but with ChunkedStream would be O(n). In fact in those cases  
</I>&gt;<i> ChunkedStream
</I>&gt;<i> would need twice the memory because it would still need to retain the
</I>&gt;<i> original byte array (e.g. for GetBuffer).
</I>&gt;<i>
</I>&gt;<i> Happy hacking
</I>&gt;<i> Andreas
</I>&gt;<i>
</I>&gt;<i> -----Urspr&#252;ngliche Nachricht-----
</I>&gt;<i> Von: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] Im Auftrag von  
</I>&gt;<i> Miguel de
</I>&gt;<i> Icaza
</I>&gt;<i> Gesendet: Montag, 9. November 2009 19:10
</I>&gt;<i> An: mono-devel-list
</I>&gt;<i> Betreff: [Mono-dev] Should we replace MemoryStream?
</I>&gt;<i>
</I>&gt;<i> Hello folks,
</I>&gt;<i>
</I>&gt;<i>    I just blogged about a memory fragmentation issue here:
</I>&gt;<i>
</I>&gt;<i> 	<A HREF="http://tirania.org/blog/archive/2009/Nov-09.html">http://tirania.org/blog/archive/2009/Nov-09.html</A>
</I>&gt;<i>
</I>&gt;<i>    And I am wondering: since MemoryStream is one of these sources of
</I>&gt;<i> problems, we could replace this implementation with MindTouch's
</I>&gt;<i> ChunkedStream.
</I>&gt;<i>
</I>&gt;<i> Miguel.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033457.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
	<LI>Next message: <A HREF="033462.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33460">[ date ]</a>
              <a href="thread.html#33460">[ thread ]</a>
              <a href="subject.html#33460">[ subject ]</a>
              <a href="author.html#33460">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
