<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] xbuild usability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20xbuild%20usability&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033510.html">
   <LINK REL="Next"  HREF="033411.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] xbuild usability</H1>
    <B>Jonathan Pryor</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20xbuild%20usability&In-Reply-To="
       TITLE="[Mono-dev] xbuild usability">jonpryor at vt.edu
       </A><BR>
    <I>Tue Nov  3 14:04:42 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033510.html">[Mono-dev] [PATCH] Re:  Input method context switch
</A></li>
        <LI>Next message: <A HREF="033411.html">[Mono-dev] xbuild usability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33405">[ date ]</a>
              <a href="thread.html#33405">[ thread ]</a>
              <a href="subject.html#33405">[ subject ]</a>
              <a href="author.html#33405">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm toying with migrating Mono.Rocks to rely exclusively on MSBuild
(it's the future!  plus it simplifies life for VS users).  This looks
like it'll largely be trivial, but that's not the point of this email.
This is just context.

The point is improving the usability of xbuild so that it approaches the
usability of make(1).

So, usability point number one is already taken care of.  What's the
most common thing to do with make?  Invoking the default target:

        $ make

Fortunately, xbuild also does this:

        $ xbuild

...unless you have more than one .sln and/or .csproj in a directory.

        rocks$ ls
        Mono.Rocks.csproj  Mono.Rocks.sln ...

Oops.  So already my usability with Mono.Rocks is hampered:

        rocks$ xbuild
        MSBUILD: error MSBUILD0005: Please specify the project or
        solution file to build, as more than one solution or project
        file was found in the current directory

Proposal Number 1: .sln files should have higher precedence over
other .*proj files, so if there is only one .sln file in a directory and
also one or more .csproj files, an &quot;unqualified&quot; xbuild command will
build the .sln file.

Otherwise I'd need to do:

        rocks$ xbuild Mono.Rocks.csproj

I'm lazy; I don't want to type that much if I can avoid it. :-)

Bonus: this is what MSBuild does as well -- 'msbuild' will runs
Mono.Rocks.sln and ignores Mono.Rocks.csproj.  So implementing Proposal
1 improves MSBuild compatibility.  Yay.

However, this raises us to the next &quot;problem.&quot;  Makefiles make it easy
to provide one-off &quot;helper&quot; targets:

        # Makefile
        shell:
        	csharp -r:lib/mono-rocks/Mono.Rocks.dll
        
        check:
        	nunit-console2 $(mrdir)/Mono.Rocks.Tests.dll
        # ...

These logically belong to the solution as a whole, and should be
executable from the topdir:

        rocks$ xbuild /t:shell
        rocks$ xbuild /t:check
        
The question then becomes, how do we support this?

If we follow the advice of Proposal # 1, the .sln will be executed,
but .sln files don't support inserting &lt;Target/&gt;s.  We could place the
&lt;Target/&gt;'s into a .csproj, but then we can't invoke the targets without
also specifying the .csproj file (and since I'm lazy, I don't want to do
that).

There are several possible solutions here:

Proposal 2a: Just use make(1)!

Given that I'm attempting to stay within the confines of xbuild, this is
a non-answer, but it may be the most workable answer regardless.

Proposal 2b: Add support to xbuild to look for a .targets file which
will be loaded inserted into the generated .proj file.  This .targets
file would share the same basename as the .sln.  Thus rocks could have
solution-level targets by adding a Mono.Rocks.targets file.

Proposal 2c: Like 2b, except it looks for a .proj file instead of
a .targets file.

Proposal 2d: We could add a custom section to the .sln file file which
explicitly references the .targets file, e.g. a
CustomTargetsFile=foo.targets section.

Proposal 2e: We add the &lt;Target/&gt; to an existing .csproj which is
referenced by the .sln, and if the target specified on the command line
isn't found within the .sln then xbuild looks within all .csproj files
referenced by the .sln and executes the first matching &lt;Target/&gt;.

The problem with all of these is that they amount to an extension of
MSBuild.  I don't particularly care, though, as it would simplify
command-line usage, and (as we all know) VS users don't use the command
line, so these extensions wouldn't matter (as much). :-)

That said, it is worth considering Microsoft's stance.  Some Googling
time shows that the lack of &quot;proper&quot; solution support is biting *lots*
of people, to the extent that dropping .sln file and moving entirely
to .proj files within VS was the 3rd most requested feature for MSBuild:

        <A HREF="http://blogs.msdn.com/msbuild/archive/2007/11/30/response-to-the-feature-poll.aspx">http://blogs.msdn.com/msbuild/archive/2007/11/30/response-to-the-feature-poll.aspx</A>

.proj files, being &quot;proper&quot; MSBuild files, would allow adding &lt;Target/&gt;
elements directly, so long term this would be the sane thing to do (for
MSBuild and for xbuild), but it doesn't address what to do wrt .sln
files (aside from &quot;replace them&quot;, which isn't an option for *current* VS
users).

This does suggest that (2c) should be dropped (we don't want special
support for .proj files if .proj may become the new default) and (2e)
(rather complicated behavior that ankit wasn't thrilled with).

This leaves (2a) (suck it!), (2b) (sane), and (2d).  I don't like (2d)
because it requires mucking with a largely undocumented file format.

Ankit also seems to like the (2b) solution as well.

Thoughts?

 - Jon


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033510.html">[Mono-dev] [PATCH] Re:  Input method context switch
</A></li>
	<LI>Next message: <A HREF="033411.html">[Mono-dev] xbuild usability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33405">[ date ]</a>
              <a href="thread.html#33405">[ thread ]</a>
              <a href="subject.html#33405">[ subject ]</a>
              <a href="author.html#33405">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
