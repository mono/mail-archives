<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] An asynchronous System.Runtime.Remoting.Channels.Tcp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20An%20asynchronous%20System.Runtime.Remoting.Channels.Tcp&In-Reply-To=B75E2690-600B-4CD0-950B-868900609369%40codicesoftware.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033400.html">
   <LINK REL="Next"  HREF="033403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] An asynchronous System.Runtime.Remoting.Channels.Tcp</H1>
    <B>pablosantosluac at terra.es</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20An%20asynchronous%20System.Runtime.Remoting.Channels.Tcp&In-Reply-To=B75E2690-600B-4CD0-950B-868900609369%40codicesoftware.com"
       TITLE="[Mono-dev] An asynchronous System.Runtime.Remoting.Channels.Tcp">pablosantosluac at terra.es
       </A><BR>
    <I>Mon Nov  2 09:31:34 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033400.html">[Mono-dev] mkbundle + System.Text.GetEncoding	=	NotSupportedException
</A></li>
        <LI>Next message: <A HREF="033403.html">[Mono-dev] 'IPPROTO_TCP' undeclared
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33401">[ date ]</a>
              <a href="thread.html#33401">[ thread ]</a>
              <a href="subject.html#33401">[ subject ]</a>
              <a href="author.html#33401">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Dick and I were talking about the possible race conditions (we've found
one on our code) that the system ThreadPool can have when used from the
channel and the code (remember the *current* tcp channel does not use
the system threadpool but a custom and really simple one).

Would it be possible to use two different thread pools instantiating the
system ones?

Also, would it be possible to commit this code?


Another related idea: it is possible (I think) to greatly improve the
current TcpChannel by returning threads to the pool when they're waiting
at PlasticTcpClientConnection.ProcessMessages.

The problem right now is that each client connection will create a
thread on the server and the thread won't be returned to the pool until
the client closes the connection, even if it's just waiting for data.
This is not good for high-perf environments were many requests must be
processed, since a huge number of threads could be potentially spawned.

My idea would be: we already have a thread for the &quot;socket accept&quot;,
create a new one for Socket.Select, so that threads are returned to the
pool (and its socket passed to the Socket.Select call) and then the
method ProcessMessages would be called again when &quot;select&quot; returns. It's
not like a full asynch channel but I think it can be even better on most
situations (less overhead) and it will greatly improve responsiveness.



pablo


www.plasticscm.com


Dick Porter wrote:
&gt;<i> Hi all
</I>&gt;<i> 
</I>&gt;<i> Attached is a patch to add an optional asynchronous path for the TCP
</I>&gt;<i> remoting channel server.
</I>&gt;<i> 
</I>&gt;<i> The main benefit we see with this change is in reliability; when a
</I>&gt;<i> single server is servicing many clients at once (we test with over 100)
</I>&gt;<i> with large data transfers the standard synchronous channel will often
</I>&gt;<i> drop connections.  We tracked this down to the Accept() call in
</I>&gt;<i> TcpServerChannel.cs not being able to get to incoming connections
</I>&gt;<i> quickly enough.
</I>&gt;<i> 
</I>&gt;<i> I was hoping that throughput of large transfers might be improved by
</I>&gt;<i> using the threadpool's asynchronous sockets support, but it turns out
</I>&gt;<i> that performance is pretty much the same as the current implementation.
</I>&gt;<i> 
</I>&gt;<i> Any comments/suggestions for improvement?
</I>&gt;<i> 
</I>&gt;<i> - Dick
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033400.html">[Mono-dev] mkbundle + System.Text.GetEncoding	=	NotSupportedException
</A></li>
	<LI>Next message: <A HREF="033403.html">[Mono-dev] 'IPPROTO_TCP' undeclared
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33401">[ date ]</a>
              <a href="thread.html#33401">[ thread ]</a>
              <a href="subject.html#33401">[ subject ]</a>
              <a href="author.html#33401">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
