<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Should we replace MemoryStream?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Should%20we%20replace%20MemoryStream%3F&In-Reply-To=32541b130911091029r228d1100wd7b073eb279a84c7%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033454.html">
   <LINK REL="Next"  HREF="033458.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Should we replace MemoryStream?</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Should%20we%20replace%20MemoryStream%3F&In-Reply-To=32541b130911091029r228d1100wd7b073eb279a84c7%40mail.gmail.com"
       TITLE="[Mono-dev] Should we replace MemoryStream?">alan.mcgovern at gmail.com
       </A><BR>
    <I>Mon Nov  9 14:36:31 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033454.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
        <LI>Next message: <A HREF="033458.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33456">[ date ]</a>
              <a href="thread.html#33456">[ thread ]</a>
              <a href="subject.html#33456">[ subject ]</a>
              <a href="author.html#33456">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

On Mon, Nov 9, 2009 at 6:29 PM, Avery Pennarun &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">apenwarr at gmail.com</A>&gt; wrote:

&gt;<i> On Mon, Nov 9, 2009 at 1:10 PM, Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at novell.com</A>&gt; wrote:
</I>&gt;<i> &gt;    I just blogged about a memory fragmentation issue here:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;        <A HREF="http://tirania.org/blog/archive/2009/Nov-09.html">http://tirania.org/blog/archive/2009/Nov-09.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    And I am wondering: since MemoryStream is one of these sources of
</I>&gt;<i> &gt; problems, we could replace this implementation with MindTouch's
</I>&gt;<i> &gt; ChunkedStream.
</I>&gt;<i>
</I>&gt;<i> Probably stupid question: why is a compacting garbage collector
</I>&gt;<i> actually needed?  C programs have survived for a *long* time without
</I>&gt;<i> any ability whatsoever to compact memory, simply by carefully
</I>&gt;<i> optimizing their allocation algorithms to avoid fragmentation.  Is the
</I>&gt;<i> mono allocator very non-optimal in this respect?
</I>&gt;<i>
</I>
One of the causes is that in a garbage collected language you allocate when
you need something and discard it when you're done. If you do this with
large buffers which are pinned in memory and have just the wrong allocation
pattern, you can bloat your memory usage. There's nothing mono can do in
this case as essentially it's the user causing the bloat.

One thing you can do is keep a cache of buffers yourself and re-use them.
For example if your application allocates 10 chunked memory streams a second
and Dispose () them when you're done, you could add/remove the 'chunks' from
a cache. This way you'd only ever allocate 10xsizeof (chunked stream) bytes
of memory and you'd constantly re-use them.

Alan.



&gt;<i> Like I said, I feel like this is a stupid question.  But I'm curious
</I>&gt;<i> about the answer, and neither your blog post nor the linked page on
</I>&gt;<i> the sgen collector addresses it.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Avery
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091109/58b2d558/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091109/58b2d558/attachment.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033454.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
	<LI>Next message: <A HREF="033458.html">[Mono-dev] Should we replace MemoryStream?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33456">[ date ]</a>
              <a href="thread.html#33456">[ thread ]</a>
              <a href="subject.html#33456">[ subject ]</a>
              <a href="author.html#33456">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
