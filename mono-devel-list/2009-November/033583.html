<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] MONO_IOMAP reporting option - string	allocation locations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20MONO_IOMAP%20reporting%20option%20-%20string%0A%09allocation%20locations&In-Reply-To=295e750a0911261622q509ae48aq542bea853524e41a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033579.html">
   <LINK REL="Next"  HREF="033586.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] MONO_IOMAP reporting option - string	allocation locations</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20MONO_IOMAP%20reporting%20option%20-%20string%0A%09allocation%20locations&In-Reply-To=295e750a0911261622q509ae48aq542bea853524e41a%40mail.gmail.com"
       TITLE="[Mono-dev] [PATCH] MONO_IOMAP reporting option - string	allocation locations">kumpera at gmail.com
       </A><BR>
    <I>Fri Nov 27 08:29:35 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033579.html">[Mono-dev] [PATCH] MONO_IOMAP reporting option - string	allocation locations
</A></li>
        <LI>Next message: <A HREF="033586.html">[Mono-dev] [PATCH] MONO_IOMAP reporting option - string allocation locations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33583">[ date ]</a>
              <a href="thread.html#33583">[ thread ]</a>
              <a href="subject.html#33583">[ subject ]</a>
              <a href="author.html#33583">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I agree with Zoltan, we better figure out how to extend the profilling
interface to support such tool than
to increase the complexity of the runtime.


On Thu, Nov 26, 2009 at 10:22 PM, Zoltan Varga &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">vargaz at gmail.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>   This patch adds code to the string allocation functions which need to be
</I>&gt;<i> as fast as
</I>&gt;<i> possible. I think it might be better to implement this as a profiler
</I>&gt;<i> module, a profiler can already receive notifications when an object is
</I>&gt;<i> allocated.
</I>&gt;<i>
</I>&gt;<i>                         Zoltan
</I>&gt;<i>
</I>&gt;<i> On Fri, Nov 27, 2009 at 1:08 AM, Marek Habersack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendel at twistedcode.net</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello everybody,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Attached is an update to the original code I posted last week. The
</I>&gt;&gt;<i> update adds support for reporting string allocation locations. It is useful
</I>&gt;&gt;<i> with large code base where strings may be created in one location but used
</I>&gt;&gt;<i> in many others. The code adds a new internal function which does the job of
</I>&gt;&gt;<i> backtrace (3) but supports mono JIT. It's basically a lighter version of
</I>&gt;&gt;<i> mono_jit_walk_stack which was too heavy for this purpose. The code needs to
</I>&gt;&gt;<i> record stack location for each and every string allocated in the application
</I>&gt;&gt;<i> and the runtime only to store it for later use when IOMAP kicks in. Doing
</I>&gt;&gt;<i> that with mono_stack_walk rendered Mono many times slower and made debugging
</I>&gt;&gt;<i> the application virtually impossible. The patch makes execution just
</I>&gt;&gt;<i> slightly slower than usual. The reporting code uses simple heuristics to
</I>&gt;&gt;<i> select the possible string allocation location - it attempts to ignore all
</I>&gt;&gt;<i> methods from assemblies installed in GAC, from corlib and, should the two
</I>&gt;&gt;<i> checks fail, from a list of assemblies and classes to ignore. This is done
</I>&gt;&gt;<i> based on the premise that the Mono runtime and class libraries are
</I>&gt;&gt;<i> case-sensitive and don't have the problem some applications might have
</I>&gt;&gt;<i> (there's actually an instance where that assumption is incorrect - in
</I>&gt;&gt;<i> System.Web we check for existence of web.config, Web.config and Web.Config -
</I>&gt;&gt;<i> but it's intended :)). The results of the selection algorithm might not
</I>&gt;&gt;<i> always be accurate, but they should be close enough to aid the developer to
</I>&gt;&gt;<i> spot the location where string was allocated.
</I>&gt;&gt;<i>        Please review and let me know if I can commit.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> marek
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091127/811741b5/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091127/811741b5/attachment.html</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033579.html">[Mono-dev] [PATCH] MONO_IOMAP reporting option - string	allocation locations
</A></li>
	<LI>Next message: <A HREF="033586.html">[Mono-dev] [PATCH] MONO_IOMAP reporting option - string allocation locations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33583">[ date ]</a>
              <a href="thread.html#33583">[ thread ]</a>
              <a href="subject.html#33583">[ subject ]</a>
              <a href="author.html#33583">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
