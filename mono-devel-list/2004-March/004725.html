<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] VTable layout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20VTable%20layout&In-Reply-To=1080059229.8937.7.camel%40Ben">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004723.html">
   <LINK REL="Next"  HREF="004726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] VTable layout</H1>
    <B>Jonathan Gilbert</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20VTable%20layout&In-Reply-To=1080059229.8937.7.camel%40Ben"
       TITLE="[Mono-devel-list] [PATCH] VTable layout">2a5gjx302 at sneakemail.com
       </A><BR>
    <I>Wed Mar 24 02:10:47 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="004723.html">[Mono-devel-list] [PATCH] VTable layout
</A></li>
        <LI>Next message: <A HREF="004726.html">[Mono-devel-list] [PATCH] VTable layout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4725">[ date ]</a>
              <a href="thread.html#4725">[ thread ]</a>
              <a href="subject.html#4725">[ subject ]</a>
              <a href="author.html#4725">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't understand how this is possible. Consider a method which takes a
reference to an object of type 'A'. Unbeknownst to the JIT, this type will
later on be used with remoting. It is not yet used. The JIT emits this
method and directly inlines the calls to A's non-virtual methods. That is,
since they cannot be overridden, the calls point directly at the target
methods' JIT output.

All is good and fine, and the caller passes various instances of 'A' to
this method. Then, it sets up a remoting session and obtains a reference to
an instance of 'A' on the server. It passes this instance to the method.

How are the calls to the method going to proxied?

Jonathan

At 11:27 AM 23/03/2004 -0500, you wrote:
&gt;<i>They seem to get their own wrapper methods that are not affected by the
</I>&gt;<i>patch.
</I>&gt;<i>
</I>&gt;<i>The test with proxies that was working still works.
</I>&gt;<i>
</I>&gt;<i>-- Ben
</I>&gt;<i>
</I>&gt;<i>On Tue, 2004-03-23 at 17:52, Jonathan Gilbert wrote:
</I>&gt;&gt;<i> An issue was raised earlier that I don't recall seeing a response to: How
</I>&gt;&gt;<i> does this affect transparent proxies for remoting?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Jonathan
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> At 09:21 PM 22/03/2004 +0100, you wrote:
</I>&gt;&gt;<i> &gt;On dg, 2004-03-21 at 17:27, Paolo Molaro wrote:
</I>&gt;&gt;<i> &gt;&gt; On 03/20/04 Ben Maurer wrote:
</I>&gt;&gt;<i> &gt;&gt; &gt; A changelog:
</I>&gt;&gt;<i> &gt;&gt; &gt; 
</I>&gt;&gt;<i> &gt;&gt; &gt;       * class.c -- do not insert non-virtual methods in the vtable 
</I>&gt;&gt;<i> &gt;&gt; &gt;       * icall.c, mono-debug-debugger.c, object.c: if method-&gt;slot
</I>== -1,
&gt;&gt;<i> &gt;&gt; &gt;         that means the method is non-virtual. This never would have
</I>&gt;&gt;<i> &gt;&gt; &gt;         happened before.
</I>&gt;&gt;<i> &gt;&gt; &gt; 
</I>&gt;&gt;<i> &gt;&gt; &gt; No regressions occur on the mini regression tests, the mono tests, nor
</I>&gt;&gt;<i> &gt;&gt; &gt; the corlib tests.
</I>&gt;&gt;<i> &gt;&gt; 
</I>&gt;&gt;<i> &gt;&gt; If lluis can confirm there are no regressions, please commit.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;The patch seems to be ok. I found no regressions.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Lluis.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt; 
</I>&gt;&gt;<i> &gt;&gt; &gt; Index: icall.c
</I>&gt;&gt;<i> &gt;&gt; &gt; ===================================================================
</I>&gt;&gt;<i> &gt;&gt; &gt; RCS file: /cvs/public/mono/mono/metadata/icall.c,v
</I>&gt;&gt;<i> &gt;&gt; &gt; retrieving revision 1.434
</I>&gt;&gt;<i> &gt;&gt; &gt; diff -u -r1.434 icall.c
</I>&gt;&gt;<i> &gt;&gt; &gt; --- icall.c	17 Mar 2004 23:59:47 -0000	1.434
</I>&gt;&gt;<i> &gt;&gt; &gt; +++ icall.c	20 Mar 2004 20:42:14 -0000
</I>&gt;&gt;<i> &gt;&gt; &gt; @@ -2549,9 +2549,12 @@
</I>&gt;&gt;<i> &gt;&gt; &gt;  		}
</I>&gt;&gt;<i> &gt;&gt; &gt;  		
</I>&gt;&gt;<i> &gt;&gt; &gt;  		match = 0;
</I>&gt;&gt;<i> &gt;&gt; &gt; -		if (g_hash_table_lookup (method_slots, GUINT_TO_POINTER
</I>&gt;&gt;<i> (method-&gt;slot)))
</I>&gt;&gt;<i> &gt;&gt; &gt; -			continue;
</I>&gt;&gt;<i> &gt;&gt; &gt; -		g_hash_table_insert (method_slots, GUINT_TO_POINTER (method-&gt;slot),
</I>&gt;&gt;<i> method);
</I>&gt;&gt;<i> &gt;&gt; &gt; +		if (method-&gt;slot != -1) {
</I>&gt;&gt;<i> &gt;&gt; &gt; +			if (g_hash_table_lookup (method_slots, GUINT_TO_POINTER
</I>&gt;&gt;<i> (method-&gt;slot)))
</I>&gt;&gt;<i> &gt;&gt; &gt; +				continue;
</I>&gt;&gt;<i> &gt;&gt; &gt; +			g_hash_table_insert (method_slots, GUINT_TO_POINTER
</I>&gt;&gt;<i> (method-&gt;slot), method);
</I>&gt;&gt;<i> &gt;&gt; &gt; +		}
</I>&gt;&gt;<i> &gt;&gt; &gt; +		
</I>&gt;&gt;<i> &gt;&gt; 
</I>&gt;&gt;<i> &gt;&gt; After this patch is committed and tested, you could try to use a
</I>&gt;&gt;<i> &gt;&gt; MonoBitset instead of the hashtable: it may give a measurable speedup.
</I>&gt;&gt;<i> &gt;&gt; Also, looking at the code, it's not clear to me what would happen for
</I>&gt;&gt;<i> &gt;&gt; properties which override just the get or the set method: maybe in that
</I>&gt;&gt;<i> &gt;&gt; case we need to consider both the setter and the getter slots in the
</I>&gt;&gt;<i> &gt;&gt; hashtable. Could you write a test case for that and try to break the
</I>&gt;&gt;<i> &gt;&gt; current code?
</I>&gt;&gt;<i> &gt;&gt; Thanks.
</I>&gt;&gt;<i> &gt;&gt; 
</I>&gt;&gt;<i> &gt;&gt; lupus
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;_______________________________________________
</I>&gt;&gt;<i> &gt;Mono-devel-list mailing list
</I>&gt;&gt;<i> &gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> &gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-devel-list mailing list
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004723.html">[Mono-devel-list] [PATCH] VTable layout
</A></li>
	<LI>Next message: <A HREF="004726.html">[Mono-devel-list] [PATCH] VTable layout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4725">[ date ]</a>
              <a href="thread.html#4725">[ thread ]</a>
              <a href="subject.html#4725">[ subject ]</a>
              <a href="author.html#4725">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
