<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] What's the most efficient way to do XOR two byte arrays?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20What%27s%20the%20most%20efficient%20way%20to%20do%20XOR%20two%20byte%20arrays%3F&In-Reply-To=%3Cf62898ba7155481fb6299343eba1592f%40BN3PR0801MB1154.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="042431.html">
   <LINK REL="Next"  HREF="042364.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] What's the most efficient way to do XOR two byte arrays?</H1>
    <B>Edward Ned Harvey (mono)</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20What%27s%20the%20most%20efficient%20way%20to%20do%20XOR%20two%20byte%20arrays%3F&In-Reply-To=%3Cf62898ba7155481fb6299343eba1592f%40BN3PR0801MB1154.namprd08.prod.outlook.com%3E"
       TITLE="[Mono-dev] What's the most efficient way to do XOR two byte arrays?">edward.harvey.mono at clevertrove.com
       </A><BR>
    <I>Wed Nov 19 02:18:14 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="042431.html">[Mono-dev] Using .so file in Android Library Project and then using it in an Android App
</A></li>
        <LI>Next message: <A HREF="042364.html">[Mono-dev] What's the most efficient way to do XOR two byte	arrays?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42363">[ date ]</a>
              <a href="thread.html#42363">[ thread ]</a>
              <a href="subject.html#42363">[ subject ]</a>
              <a href="author.html#42363">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Obviously, I could just use a for-loop.  But then my code is theoretically telling the system to XOR each byte individually, wasting most of the CPU on each instruction.

I wrote unsafe code to do this with 32-bit and 64-bit int pointers.  Surprisingly they both performed about the same (I guess, at least on my system, 64bit instructions take longer to execute, effectively eliminating most of the gains of the wider bus).  Unsurprisingly, they greatly outperformed the unoptimized for-loop.

Surprisingly, the difference between the optimized unsafe code and the optimized for-loop suggested it was a waste of effort.  (Only marginally faster.)

I don't know what kind of optimizations the compilers are able to perform on this code:

for (int i=0; i&lt;buf1.Length; i++) {
    buf2[i] = (byte)(buf1[i] ^ buf2[i]);
}

I am surprised if that optimizes so well as to literally make it a waste of time to pursue anything better.  But if someone here says so, I'll have to believe you.

I haven't benchmarked, but rumor on the internet suggests that the for-loop for copying bytes from one buffer to another is slow compared to Array.Copy, which is slower still than Buffer.BlockCopy.  Assuming this is correct, I have to assume it's possible to have an optimized method of XOR'ing blocks of data too.  But I haven't found any such method in .Net.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20141119/d376a02c/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20141119/d376a02c/attachment.html</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="042431.html">[Mono-dev] Using .so file in Android Library Project and then using it in an Android App
</A></li>
	<LI>Next message: <A HREF="042364.html">[Mono-dev] What's the most efficient way to do XOR two byte	arrays?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#42363">[ date ]</a>
              <a href="thread.html#42363">[ thread ]</a>
              <a href="subject.html#42363">[ subject ]</a>
              <a href="author.html#42363">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
