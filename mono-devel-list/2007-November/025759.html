<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] ToString() performace in Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20ToString%28%29%20performace%20in%20Mono&In-Reply-To=84776a970711220326v7077e451h933caa89bf2763f5%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025757.html">
   <LINK REL="Next"  HREF="025760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] ToString() performace in Mono</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20ToString%28%29%20performace%20in%20Mono&In-Reply-To=84776a970711220326v7077e451h933caa89bf2763f5%40mail.gmail.com"
       TITLE="[Mono-dev] ToString() performace in Mono">alan.mcgovern at gmail.com
       </A><BR>
    <I>Thu Nov 22 09:23:43 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025757.html">[Mono-dev] ToString() performace in Mono
</A></li>
        <LI>Next message: <A HREF="025760.html">[Mono-dev] ToString() performace in Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25759">[ date ]</a>
              <a href="thread.html#25759">[ thread ]</a>
              <a href="subject.html#25759">[ subject ]</a>
              <a href="author.html#25759">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>StringBuilder is only faster if you're concatenating a lot of variables. In
this case, there's no benefit to using stringbuilder. If he was
concatenating all the numbers from i=0-&gt;1000, then yes, a stringbuilder
would be better.

It might be worth cracking out a profiler and seeing where the time is
spent.

As NumberStore is a struct, you would get a performance boost if it was
passed by ref as opposed to be value. I'd guesstimate that it'd be at least
a double digit increase (&gt; 10%). If someone has the time to modify their
mono checkout to change the Int32.ToString() codepath to pass the
NumberStore by ref all the way through, let me know what the performance
diff is.

It should only take about 10 mins of hacking to do the change. If the boost
is significant enough, maybe a patch would be accepted into mono to do this.

Alan.

On Nov 22, 2007 11:26 AM, Petit Eric &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">surfzoid at gmail.com</A>&gt; wrote:

&gt;<i> 2007/11/22, pablosantosluac &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">pablosantosluac at terra.es</A>&gt;:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Ok, but I'm not doing string &quot;concat&quot; but just converting to string, and
</I>&gt;<i> &gt; using StringBuilder in this scenario, it isn't faster, as you have just
</I>&gt;<i> &gt; pointed to...
</I>&gt;<i> yes complety right, but the first idea was about the fact for string
</I>&gt;<i> performance, stringbuilder is fastest, but aparently not at the
</I>&gt;<i> instance time, only to append a long text.
</I>&gt;<i> oki
</I>&gt;<i> now we are fixed lol
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My point is that ToString is about 3 times slower in Mono than its .NET
</I>&gt;<i> &gt; counterpart. We'll try to get rid of it as much as we can, but some
</I>&gt;<i> &gt; optimization would be really great.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; pablo
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----- Original Message -----
</I>&gt;<i> &gt; From: &quot;Petit Eric&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">surfzoid at gmail.com</A>&gt;
</I>&gt;<i> &gt; To: &quot;pablosantosluac&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">pablosantosluac at terra.es</A>&gt;
</I>&gt;<i> &gt; Cc: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; Sent: Thursday, November 22, 2007 11:56 AM
</I>&gt;<i> &gt; Subject: Re: [Mono-dev] ToString() performace in Mono
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Windows and String
</I>&gt;<i> &gt; &gt; val is 5999999 and time 4391
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Windows and StringBuilder
</I>&gt;<i> &gt; &gt; val is 5999999 and time 5688
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Code For StringBuilder :
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; using System;
</I>&gt;<i> &gt; &gt; using System.Collections.Generic;
</I>&gt;<i> &gt; &gt; using System.Text;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; namespace compareCompare
</I>&gt;<i> &gt; &gt; {
</I>&gt;<i> &gt; &gt;    class Program
</I>&gt;<i> &gt; &gt;    {
</I>&gt;<i> &gt; &gt;        static void Main(string[] args)
</I>&gt;<i> &gt; &gt;        {
</I>&gt;<i> &gt; &gt;            int ini = Environment.TickCount;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;            System.Text.StringBuilder k = new System.Text.StringBuilder
</I>&gt;<i> ();
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;            for (int i = 0; i &lt; 6000000; ++i)
</I>&gt;<i> &gt; &gt;            {
</I>&gt;<i> &gt; &gt;                k = new System.Text.StringBuilder(i.ToString());
</I>&gt;<i> &gt; &gt;            }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;            Console.WriteLine(&quot;val is {0} and time {1}&quot;, k,
</I>&gt;<i> &gt; &gt; Environment.TickCount - ini);
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;            while (true)
</I>&gt;<i> &gt; &gt;            {
</I>&gt;<i> &gt; &gt;                if (Console.ReadKey() != null) break;
</I>&gt;<i> &gt; &gt;            }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;        }
</I>&gt;<i> &gt; &gt;    }
</I>&gt;<i> &gt; &gt; }
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 2007/11/22, pablosantosluac &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">pablosantosluac at terra.es</A>&gt;:
</I>&gt;<i> &gt; &gt;&gt; Anyway, how would you use it in the sample I attached to improve
</I>&gt;<i> &gt; &gt;&gt; performance? I need to convert a different integer each pass...
</I>&gt;<i> &gt; &gt;&gt; ----- Original Message -----
</I>&gt;<i> &gt; &gt;&gt; From: &quot;Petit Eric&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">surfzoid at gmail.com</A>&gt;
</I>&gt;<i> &gt; &gt;&gt; To: &quot;pablosantosluac&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">pablosantosluac at terra.es</A>&gt;
</I>&gt;<i> &gt; &gt;&gt; Cc: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> &gt; &gt;&gt; Sent: Thursday, November 22, 2007 10:24 AM
</I>&gt;<i> &gt; &gt;&gt; Subject: Re: [Mono-dev] ToString() performace in Mono
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt; Do you try to replace String by a System.Text.StringBuilder ?
</I>&gt;<i> &gt; &gt;&gt; &gt;
</I>&gt;<i> &gt; &gt;&gt; &gt; 2007/11/22, pablosantosluac &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">pablosantosluac at terra.es</A>&gt;:
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; Hi,
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; I've detected a performance hit on &quot;plastic server&quot; running on
</I>&gt;<i> mono. I
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; was
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; actually shocked because when I checked something similar working
</I>&gt;<i> with
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; integers, Mono was actually faster than .NET. But it seems it is
</I>&gt;<i> not
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; the
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; case with strings.
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; Please consider the following code sample:
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; using System;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; namespace compareCompare
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; {
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;     class Class1
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;     {
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;         static void Main(string[] args)
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;         {
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;             int ini = Environment.TickCount;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;             string k = string.Empty;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;             for( int i = 0; i &lt; 6000000; ++i )
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;             {
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;                 k = i.ToString();
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;             }
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;             Console.WriteLine(&quot;val is {0} and time {1}&quot;, k,
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; Environment.TickCount - ini);
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;         }
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;     }
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; }
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; And the following results:
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; &gt;compareCompare.exe
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; val is 5999999 and time 3525
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; &gt;&quot;c:\Archivos de programa\Mono-1.2.5.2\bin\mono.exe&quot;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; &gt;compareCompare.exe
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; val is 5999999 and time 11577
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; Thanks,
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; pablo
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt; &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071122/4b64993d/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20071122/4b64993d/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025757.html">[Mono-dev] ToString() performace in Mono
</A></li>
	<LI>Next message: <A HREF="025760.html">[Mono-dev] ToString() performace in Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25759">[ date ]</a>
              <a href="thread.html#25759">[ thread ]</a>
              <a href="subject.html#25759">[ subject ]</a>
              <a href="author.html#25759">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
