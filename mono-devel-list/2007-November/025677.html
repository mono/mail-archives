<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] mono_path_canonicalize strips \\ from network paths on	Windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mono_path_canonicalize%20strips%20%5C%5C%20from%20network%20paths%20on%0A%09Windows&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025681.html">
   <LINK REL="Next"  HREF="025680.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] mono_path_canonicalize strips \\ from network paths on	Windows</H1>
    <B>Aras Pranckevicius</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20mono_path_canonicalize%20strips%20%5C%5C%20from%20network%20paths%20on%0A%09Windows&In-Reply-To="
       TITLE="[Mono-dev] mono_path_canonicalize strips \\ from network paths on	Windows">aras at unity3d.com
       </A><BR>
    <I>Fri Nov 16 03:55:12 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025681.html">[Mono-dev] Would reading this &quot;contaminate&quot; a programer	inthe	eyes of Mono?
</A></li>
        <LI>Next message: <A HREF="025680.html">[Mono-dev] [PATCH] Generic sharing: Static field access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25677">[ date ]</a>
              <a href="thread.html#25677">[ thread ]</a>
              <a href="subject.html#25677">[ subject ]</a>
              <a href="author.html#25677">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Some of our customers noticed that our Windows games don't run if
launched from network shares (e.g. \\somecomputer\path\game.exe).
Turns out AppDomain.CreateDomain throws exception when assemblies are
referenced via network path.

When debugging, I noticed that image open functions turn paths like
'\\somecomputer\path' into '\somecomputer\path' (turns double
backslash into a single one). mono_path_canonicalize does this.

In our case, changing this:
	if (dest != lastpos) {
		strcpy (dest, lastpos);
	}
at the end of mono_path_canonicalize into this:
	if (dest != lastpos) {
		/* on Windows, do not strip '\\' from the beginning of network paths */
		#if defined (PLATFORM_WIN32)
		if( dest &amp;&amp; dest[0] == G_DIR_SEPARATOR &amp;&amp; lastpos &amp;&amp; lastpos[0] == 0 )
		{
		}
		else
		#endif
			strcpy (dest, lastpos);
	}
fixes the issue and makes everything work on network shares.


But as you can see from the code, I obviously don't know what I'm
doing and the same effect can probably be achieved much more
elegantly.


-- 
Aras Pranckevicius
work: <A HREF="http://unity3d.com">http://unity3d.com</A>
home: <A HREF="http://aras-p.info">http://aras-p.info</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025681.html">[Mono-dev] Would reading this &quot;contaminate&quot; a programer	inthe	eyes of Mono?
</A></li>
	<LI>Next message: <A HREF="025680.html">[Mono-dev] [PATCH] Generic sharing: Static field access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25677">[ date ]</a>
              <a href="thread.html#25677">[ thread ]</a>
              <a href="subject.html#25677">[ subject ]</a>
              <a href="author.html#25677">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
