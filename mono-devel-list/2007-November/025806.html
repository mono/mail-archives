<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Remoting Server Events problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Remoting%20Server%20Events%20problem&In-Reply-To=ficvla%24r6q%241%40ger.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025801.html">
   <LINK REL="Next"  HREF="025746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Remoting Server Events problem</H1>
    <B>buhochileno at gmail.com</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Remoting%20Server%20Events%20problem&In-Reply-To=ficvla%24r6q%241%40ger.gmane.org"
       TITLE="[Mono-dev] Remoting Server Events problem">buhochileno at gmail.com
       </A><BR>
    <I>Mon Nov 26 20:45:32 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025801.html">[Mono-dev] Remoting Server Events problem
</A></li>
        <LI>Next message: <A HREF="025746.html">[Mono-dev] Regression in SVN - (g)mcs crash &amp; xbuild problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25806">[ date ]</a>
              <a href="thread.html#25806">[ thread ]</a>
              <a href="subject.html#25806">[ subject ]</a>
              <a href="author.html#25806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Robert:

I finally understend your code and work like a charme!!!, thanks a lote, 
is a very nice and clean remoting event implementation...,
I don't want take advantage of your kind help, but I have a 
&quot;distributed&quot; scenario on my app, and I wonder if you have some suggestions:
- I understend your code and the server/client relationship with the 
AsyncEvents schema, is very good to traslate messages from the server to 
the client, but in my case the server have to expose other app objects 
than the server itself, let me explain me a littel bit:
My app is something like the new Visual Robotics from MS, but this 
&quot;monoBotic&quot; is for the opensource comunity, so I have a lost off classes 
like Motor, MotorsController, Sensor, WebCam, RobotKit, etc...
for example I have a WebCamOrbit traditional class (inherit from a base 
abstract class, implements interface and all that kind of stuff), the 
class deal with all the stuff related with the logitech webcam orbit (a 
pan/tilt webcam), the class also have some events like 
OnPositionChange(object  e, PanTiltEventArgs e), and  some methods like 
SetPanTilt(int pan, int tilt) (this method  also trigger the 
OnPositionChange event...)...In the monoBotic the programmer can choose 
a &quot;local WebCamOrbit object&quot; is the robotic app is going to run in the 
same robot machine (for example a PC based robot or other sensors/motors 
connected directly to the PC), this is easy becouse in this scenario I 
only have to create a instance of WebCamOrbit, but in other scenarios 
the programmer perhaps want a &quot;remoting WebCamOrbit object&quot; becouse 
perhaps the camera is connected in other machine and maybe in one 
machine ask for the image in a camera in other machine, analyse the 
image and send the result and take advantache of the remotung technologie.
So, all this is going to be possible to make &quot;by hand&quot; using the 
monoBotic framework if you are a programmer, but also monoBotic want to 
generate some code to make things easy. So, if is possible the &quot;local 
version&quot; of the WebCamOrbit and the &quot;remote version&quot; have to be the most 
similar as possible (method calls, event asociation, etc...)
Thow I was thinking in may be have the traditional WebCamOrbit for local 
porpuses and also a ServerWebCamOrbit and also a ClientWebCamOrbit.
In the server side each object that is intended to use with remoting 
(like the WebCamOrbit or a Motor, etc) is like a &quot;remoting 
server&quot;(ServerWebCamOrbit) and deals with the AsyncEvent and make the 
bindings with the traditional WebCamOrbit.
In the client side, the ClientWebCamOrbit get the remote 
ServerWebCamOrbit object and implement the necesary bindigs to look to 
the programer as a traditional WebCamOrbitObject (may be with diferent 
contructor to pass the object URL..etc).

This sounds like have any sense to you? :-S , I think that in this way I 
can controll the methods and events that can be handled with remoting 
and not expose all the methods and events from the original WebCamOrbit, 
but the problem is I need to have a &quot;Remoting Server&quot; for each object, 
in fact in this escenario, each object that is supose to work in a 
remotng way is a server.
And in the client side with the client version of the class, I can make 
all the necesary bindigs to expose the client version of the object as 
similar as is posible to the traditional/local WebCamOrbit...But 
offcourse all this is not ver scalable and need a lote of code to 
maintein each server and client version of each class...

So, I need a lote of design help I think ... :-S

Sorry to bored you with such a long mail...
And in advance, thank you very much..

Mauricio.

Robert Jordan wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">buhochileno at gmail.com</A> wrote:
</I>&gt;&gt;<i> Thanks Robert, I very confuse with this, becouse I read a lote of 
</I>&gt;&gt;<i> diferent approach (event broadcast engines, shared objects, etc) to 
</I>&gt;&gt;<i> do this, but most of them don't work :-S ,  I wondore if you have a 
</I>&gt;&gt;<i> simple working example of the correct way to do this?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Events only make sense in local cross appdomain contexts.
</I>&gt;<i> Anything else is a world of pain. See
</I>&gt;<i> <A HREF="http://www.thinktecture.com/resourcearchive/net-remoting-faq/remotingusecases">http://www.thinktecture.com/resourcearchive/net-remoting-faq/remotingusecases</A> 
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The attached sample is still using events on the server side but
</I>&gt;<i> it requires that clients implement a certain interface that
</I>&gt;<i> was declared in the shared assembly.
</I>&gt;<i>
</I>&gt;<i> The server is using a special &quot;AsyncEvent&quot; that doesn't have the
</I>&gt;<i> drawbacks of a simple CLI event:
</I>&gt;<i>
</I>&gt;<i> - the clients are notified sequentially. This doesn't scale
</I>&gt;<i>
</I>&gt;<i> - if a client doesn't respond, the next clients won't be called
</I>&gt;<i>   back anymore. This is far from being reliable.
</I>&gt;<i>
</I>&gt;<i> AsyncEvent is calling the clients in parallel and it also disconnects
</I>&gt;<i> failing clients. This is still not optimal because it doesn't scale
</I>&gt;<i> at large: Imagine you have 1000 connected clients ...
</I>&gt;<i>
</I>&gt;<i> Robert
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> in advance, thank you very much.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Mauricio
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">buhochileno at gmail.com</A> wrote:
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Hi:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I know that is very possible that this is a basic remoting 
</I>&gt;&gt;&gt;&gt;<i> question, but I read some info about the native .NET approach used 
</I>&gt;&gt;&gt;&gt;<i> with remoting and I think that my code is supose it to work:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I write a class with a method to trigger some event (this is the 
</I>&gt;&gt;&gt;&gt;<i> object resgitered by the remoting server):
</I>&gt;&gt;&gt;&gt;<i> [Serializable]
</I>&gt;&gt;&gt;&gt;<i> public class Camera: MarshalByRefObject
</I>&gt;&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;&gt;<i>    public void SetZoom(int amount)
</I>&gt;&gt;&gt;&gt;<i>    {...//zoom code
</I>&gt;&gt;&gt;&gt;<i>        SomeDelegate h = this.SomeEvent; //some test event triger, 
</I>&gt;&gt;&gt;&gt;<i> the SomeDelegate is public...
</I>&gt;&gt;&gt;&gt;<i>        if ((h != null) &amp;&amp; (SomeEvent != null))
</I>&gt;&gt;&gt;&gt;<i>                h (this, new EventArgs());
</I>&gt;&gt;&gt;&gt;<i>        else
</I>&gt;&gt;&gt;&gt;<i>                Console.WriteLine(&quot;null then?&quot;); //allways is null
</I>&gt;&gt;&gt;&gt;<i>       }
</I>&gt;&gt;&gt;&gt;<i> ...On the client side I use a special &quot;RemoteCamera&quot;, this class 
</I>&gt;&gt;&gt;&gt;<i> deal with all the remoting stuff related to get the object from the 
</I>&gt;&gt;&gt;&gt;<i> server...something like:
</I>&gt;&gt;&gt;&gt;<i> [Serializable]
</I>&gt;&gt;&gt;&gt;<i> public class RemoteCamera: MarshalByRefObject
</I>&gt;&gt;&gt;&gt;<i>        public RemoteOrbitKit()
</I>&gt;&gt;&gt;&gt;<i>        { .../channel registration, etc...
</I>&gt;&gt;&gt;&gt;<i>             
</I>&gt;&gt;&gt;&gt;<i> camera(ICamerat)Activator.GetObject(typeof(ICamera),_fullObjectURLPath); 
</I>&gt;&gt;&gt;&gt;<i> //....
</I>&gt;&gt;&gt;&gt;<i>            camera.SomeEvent += new SomeDelegate(SomeMethod);
</I>&gt;&gt;&gt;&gt;<i>             ...
</I>&gt;&gt;&gt;&gt;<i>             camera.SetZoom(50); //this work, but the event is not 
</I>&gt;&gt;&gt;&gt;<i> triggered...
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>        }
</I>&gt;&gt;&gt;&gt;<i>        public SomeMethod(object sender, EventArgs e)
</I>&gt;&gt;&gt;&gt;<i>        {
</I>&gt;&gt;&gt;&gt;<i>             Console.WriteLine(&quot;method called&quot;); //This methis is 
</I>&gt;&gt;&gt;&gt;<i> never called becouse the Event/method asociation allways is null
</I>&gt;&gt;&gt;&gt;<i>        }
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Do you see what is my mistake?
</I>&gt;&gt;&gt;&gt;<i> sugestions?, ideas?
</I>&gt;&gt;&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1. The server must know the type &quot;RemoteCamera&quot;, because the delegate
</I>&gt;&gt;&gt;<i>     is containing a reference to an instance of this class.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     You can circumvent this by using a public static method as
</I>&gt;&gt;&gt;<i>     an event handler.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2. The client must start a listener as well. This is done with
</I>&gt;&gt;&gt;<i>     &quot;new TcpChannel (0)&quot; or &quot;new HttpChannel (0)&quot; or with a
</I>&gt;&gt;&gt;<i>     corresponding remoting configuration setting.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 3. The client must not be firewalled because it is
</I>&gt;&gt;&gt;<i>     called back by the server.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Robert
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>   
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025801.html">[Mono-dev] Remoting Server Events problem
</A></li>
	<LI>Next message: <A HREF="025746.html">[Mono-dev] Regression in SVN - (g)mcs crash &amp; xbuild problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25806">[ date ]</a>
              <a href="thread.html#25806">[ thread ]</a>
              <a href="subject.html#25806">[ subject ]</a>
              <a href="author.html#25806">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
