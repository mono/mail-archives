<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] thread race during code generation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20thread%20race%20during%20code%20generation&In-Reply-To=20071104.013428.267396613.davem%40davemloft.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025547.html">
   <LINK REL="Next"  HREF="025549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] thread race during code generation</H1>
    <B>David Miller</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20thread%20race%20during%20code%20generation&In-Reply-To=20071104.013428.267396613.davem%40davemloft.net"
       TITLE="[Mono-dev] thread race during code generation">davem at davemloft.net
       </A><BR>
    <I>Mon Nov 12 03:57:36 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025547.html">[Mono-dev] thread race during code generation
</A></li>
        <LI>Next message: <A HREF="025549.html">[Mono-dev] Size of Microsoft.Scripting.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25626">[ date ]</a>
              <a href="thread.html#25626">[ thread ]</a>
              <a href="subject.html#25626">[ subject ]</a>
              <a href="author.html#25626">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>From: David Miller &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">davem at davemloft.net</A>&gt;
Date: Sun, 04 Nov 2007 01:34:28 -0700 (PDT)

&gt;<i> With this information, I hope it should be pretty easy for someone
</I>&gt;<i> to fix this bug. :-)
</I>
Can someone please look at this?

This triggers every time I run the nunit testsuite on basically every
platform I've tried it on (x86, sparc, and ppc so far).  As a result I
have to manually watch over the testsuite runs and kill off the stuck
mono thread when this race condition triggers or else the &quot;make check&quot;
wedges forever.

The only solutions I see to this problem are:

1) Check for pending exceptions and events such as a thread
   state change right before every time we jump into managed
   code.

   This unfortunately, is also racey, the signal can arrive
   right after we retest and before we jump into the managed
   code.

2) Mask out the thread event signal, and somehow atomically
   unmask that signal and branch to the managed code.  Perhaps
   using a setcontext() call from a trampoline of some sort.

Or, we could simply allow thread abort events to be processed
even if they arrive while compiling, if that can be managed
properly wrt. dropping domain locks and things of that
nature.

Thanks.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025547.html">[Mono-dev] thread race during code generation
</A></li>
	<LI>Next message: <A HREF="025549.html">[Mono-dev] Size of Microsoft.Scripting.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25626">[ date ]</a>
              <a href="thread.html#25626">[ thread ]</a>
              <a href="subject.html#25626">[ subject ]</a>
              <a href="author.html#25626">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
