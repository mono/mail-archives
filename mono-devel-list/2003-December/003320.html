<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Add /addmodule: support to mcs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Add%20/addmodule%3A%20support%20to%20mcs&In-Reply-To=20031218080950.GB25213%40miscrit.be">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003313.html">
   <LINK REL="Next"  HREF="003342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Add /addmodule: support to mcs</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Add%20/addmodule%3A%20support%20to%20mcs&In-Reply-To=20031218080950.GB25213%40miscrit.be"
       TITLE="[Mono-devel-list] Add /addmodule: support to mcs">lupus at ximian.com
       </A><BR>
    <I>Thu Dec 18 06:55:45 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003313.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
        <LI>Next message: <A HREF="003342.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3320">[ date ]</a>
              <a href="thread.html#3320">[ thread ]</a>
              <a href="subject.html#3320">[ subject ]</a>
              <a href="author.html#3320">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/18/03 Peter Ross wrote:
&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; I was wondering if anyone can give me any pointers on what would need to
</I>&gt;<i> &gt; &gt; be done to add /addmodule support to mcs?
</I>[...]
&gt;<i> My plan is to look at monodis, factor out some of the code into a
</I>&gt;<i> library, build a .NET assembly above the library using PInvoke and then
</I>&gt;<i> integrate the library into mcs.
</I>
The library already exists, the code is in metadata/.

&gt;<i> Why am I doing this?  I would like to get Mercury [1] building under
</I>&gt;<i> Mono, and for that I need a C# compiler that accepts /addmodule and a
</I>&gt;<i> minimal implementation of al.exe.
</I>
Didn't the mercury compiler generate IL code? Or does it generate both
IL and C# code?

I think the way to go is to implement the Assembly::LoadModule()
method. It may be that the MS runtime already supports the kind of use
we need to implement /addmodule.
Anyway, the implementation of the method should work in the context of
an AssemblyBuilder: when mcs creates the Assemblybuilder, it just
uses abuilder.LoadModule (...) for each /addmodule argument.
The loaded module gets added to the modules for the assembly builder
and things should mostly work ok, but no doubt some changes will be
needed, both when doing type lookups and when writing the pe file...
al.exe, I think, could be implemented with the same trick.
Alternatively, al.exe could be probably written using PEAPI.dll
instead of Reflection.Emit.
Another related (but minor) issue is getting mcs to create modules:
we can probably overload the assembly builder flags to add a Module
item, so Reflection.Emit will emit a module instead of a full assembly
in that case.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003313.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
	<LI>Next message: <A HREF="003342.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3320">[ date ]</a>
              <a href="thread.html#3320">[ thread ]</a>
              <a href="subject.html#3320">[ subject ]</a>
              <a href="author.html#3320">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
