<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Npgsql possible bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Npgsql%20possible%20bug&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003372.html">
   <LINK REL="Next"  HREF="003368.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Npgsql possible bug</H1>
    <B>Jaroslaw Kowalski</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Npgsql%20possible%20bug&In-Reply-To="
       TITLE="[Mono-devel-list] Npgsql possible bug">jaak at zd.com.pl
       </A><BR>
    <I>Thu Dec 25 17:37:06 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003372.html">[Mono-devel-list] Managed XSLT release
</A></li>
        <LI>Next message: <A HREF="003368.html">[Mono-devel-list] Npgsql possible bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3361">[ date ]</a>
              <a href="thread.html#3361">[ thread ]</a>
              <a href="subject.html#3361">[ subject ]</a>
              <a href="author.html#3361">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all!

This is my first post to nant-devel-list, so please excuse any &quot;formal&quot;
mistakes. I'm in progress of porting my O/R mapping solution to
Mono/PostgreSQL and I've encountered the bug in Npgsql. Is this the right
list to report this problem to?

The problem is related to the fact that NpgsqlCommand calls
connection.Dispose() in it's Dispose method. This causes problems with
constructs like the following, which are legal in MS.NET with MSSQL:

---------------------------8&lt;--CUT HERE------------------------------
NpgsqlConnection conn = new NpgsqlConnection();

using (NpgsqlCommand cmd1 = new NpgsqlCommand(&quot;select * from ...&quot;, conn))
{
    cmd1.Execute...();
}
//
// after exiting from the &quot;using&quot; block the Dispose on &quot;conn&quot;
// is called causing it to close. The following command will
// fail because the connection is no longer open.
//
using (NpgsqlCommand cmd2 = new NpgsqlCommand(&quot;select * from ...&quot;, conn))
{
    cmd2.Execute...();
}
---------------------------8&lt;--CUT HERE------------------------------

Proposed patch (made against today's AnonCVS) is to comment out the
&quot;connection.Dispose()&quot; call. I believe this to be the correct semantics.

---------------------------8&lt;--CUT HERE------------------------------
cvs server: Diffing .
Index: NpgsqlCommand.cs
===================================================================
RCS file: /mono/mcs/class/Npgsql/Npgsql/NpgsqlCommand.cs,v
retrieving revision 1.11
diff -u -r1.11 NpgsqlCommand.cs
--- NpgsqlCommand.cs    12 Dec 2003 21:00:04 -0000      1.11
+++ NpgsqlCommand.cs    25 Dec 2003 23:34:26 -0000
@@ -619,10 +619,6 @@
             NpgsqlEventLog.LogMethodEnter(LogLevel.Debug, CLASSNAME,
&quot;Dispose&quot;);
             if (disposing)
             {
-                if (connection != null)
-                {
-                    connection.Dispose();
-                }
                 base.Dispose(disposing);

             }

---------------------------8&lt;--CUT HERE------------------------------

Can anyone review the patch and possibly commit it to CVS. I found it to be
working quite well with my existing codebase.

Regards,

Jarek


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003372.html">[Mono-devel-list] Managed XSLT release
</A></li>
	<LI>Next message: <A HREF="003368.html">[Mono-devel-list] Npgsql possible bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3361">[ date ]</a>
              <a href="thread.html#3361">[ thread ]</a>
              <a href="subject.html#3361">[ subject ]</a>
              <a href="author.html#3361">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
