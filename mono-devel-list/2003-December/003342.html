<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Add /addmodule: support to mcs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Add%20/addmodule%3A%20support%20to%20mcs&In-Reply-To=20031218115545.GA22111%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003320.html">
   <LINK REL="Next"  HREF="003346.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Add /addmodule: support to mcs</H1>
    <B>Peter Ross</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Add%20/addmodule%3A%20support%20to%20mcs&In-Reply-To=20031218115545.GA22111%40debian.org"
       TITLE="[Mono-devel-list] Add /addmodule: support to mcs">pro at missioncriticalit.com
       </A><BR>
    <I>Sun Dec 21 06:30:52 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003320.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
        <LI>Next message: <A HREF="003346.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3342">[ date ]</a>
              <a href="thread.html#3342">[ thread ]</a>
              <a href="subject.html#3342">[ subject ]</a>
              <a href="author.html#3342">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Dec 18, 2003 at 12:55:45PM +0100, Paolo Molaro wrote:
&gt;<i> On 12/18/03 Peter Ross wrote:
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; I was wondering if anyone can give me any pointers on what would need to
</I>&gt;<i> &gt; &gt; &gt; be done to add /addmodule support to mcs?
</I>&gt;<i> [...]
</I>&gt;<i> &gt; My plan is to look at monodis, factor out some of the code into a
</I>&gt;<i> &gt; library, build a .NET assembly above the library using PInvoke and then
</I>&gt;<i> &gt; integrate the library into mcs.
</I>&gt;<i> 
</I>&gt;<i> The library already exists, the code is in metadata/.
</I>&gt;<i> 
</I>Thanks.

&gt;<i> &gt; Why am I doing this?  I would like to get Mercury [1] building under
</I>&gt;<i> &gt; Mono, and for that I need a C# compiler that accepts /addmodule and a
</I>&gt;<i> &gt; minimal implementation of al.exe.
</I>&gt;<i> 
</I>&gt;<i> Didn't the mercury compiler generate IL code? Or does it generate both
</I>&gt;<i> IL and C# code?
</I>&gt;<i> 
</I>The compiler generates IL, but one can also specify that the
implementation of a function is in a foreign language.  We use this to
do some of the low level stuff (IO, sockets, etc., etc.) is in the
standard library.  Thus some of the mercury standard library is written
in C#, which is placed into modules, which are then linked together by
al.exe to form the assembly mercury.dll.


&gt;<i> I think the way to go is to implement the Assembly::LoadModule()
</I>&gt;<i> method. It may be that the MS runtime already supports the kind of use
</I>&gt;<i> we need to implement /addmodule.
</I>&gt;<i> Anyway, the implementation of the method should work in the context of
</I>&gt;<i> an AssemblyBuilder: when mcs creates the Assemblybuilder, it just
</I>&gt;<i> uses abuilder.LoadModule (...) for each /addmodule argument.
</I>&gt;<i> The loaded module gets added to the modules for the assembly builder
</I>&gt;<i> and things should mostly work ok, but no doubt some changes will be
</I>&gt;<i> needed, both when doing type lookups and when writing the pe file...
</I>&gt;<i> al.exe, I think, could be implemented with the same trick.
</I>&gt;<i> Alternatively, al.exe could be probably written using PEAPI.dll
</I>&gt;<i> instead of Reflection.Emit.
</I>&gt;<i> Another related (but minor) issue is getting mcs to create modules:
</I>&gt;<i> we can probably overload the assembly builder flags to add a Module
</I>&gt;<i> item, so Reflection.Emit will emit a module instead of a full assembly
</I>&gt;<i> in that case.
</I>&gt;<i> 
</I>Thanks for this tips, I will look further into this.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003320.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
	<LI>Next message: <A HREF="003346.html">[Mono-devel-list] Add /addmodule: support to mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3342">[ date ]</a>
              <a href="thread.html#3342">[ thread ]</a>
              <a href="subject.html#3342">[ subject ]</a>
              <a href="author.html#3342">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
