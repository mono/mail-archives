<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Problems with OracleClient
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Problems%20with%20OracleClient&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003325.html">
   <LINK REL="Next"  HREF="003326.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Problems with OracleClient</H1>
    <B>J&#246;rg Rosenkranz</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Problems%20with%20OracleClient&In-Reply-To="
       TITLE="[Mono-devel-list] Problems with OracleClient">joergr at voelcker.com
       </A><BR>
    <I>Thu Dec 18 09:33:25 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003325.html">[Mono-devel-list] Re: [Mono-list] Urgent: new Bitmap() does not work because of gdiplus.dll ?
</A></li>
        <LI>Next message: <A HREF="003326.html">[Mono-devel-list] Code Access Security - Initial thoughts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3323">[ date ]</a>
              <a href="thread.html#3323">[ thread ]</a>
              <a href="subject.html#3323">[ subject ]</a>
              <a href="author.html#3323">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

We are running into several problems regarding OracleClient. 
Our initial problem was &quot;ORA-01000: maximum open cursors exceeded&quot;.
After some research I've found out that Dispose of OciStatementHandle
objects is nearly never called. All handles are disposed by the 
Finalizer which leads to this problem if many statements are fired in
short intervals. I have filed following bug report for this:

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=52288">http://bugzilla.ximian.com/show_bug.cgi?id=52288</A>

I have created the attached patch to fix this problem. This patch now
leads to the following problem in our real world app which is using 
different threads (each one with it's own connection):

Segmentation fault with message
ORA-21500: internal error code, arguments: [ttcdrv-recursivecall], [],
[], [], [], [], [], [] in OCIStmtExecute

This error occurs after some time and I am not able to reproduce it in
a simple test case. The crash never happens when I let the garbage 
collector dispose the handles.

After some research I have found out that libcntsh.so (which 
OracleClient PInvokes into) is linked against libpthreads.so. 
I remember that there were problems using code that is compiled without 
the garbage collector includes.

Is this anything that rings a bell for anyone? Is there a way to fix 
this?

Please do not commit this patch ;-)

Thanks,
Joerg.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Patch_OracleClient_52288.diff
Type: application/octet-stream
Size: 8778 bytes
Desc: Patch_OracleClient_52288.diff
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20031218/070332be/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20031218/070332be/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003325.html">[Mono-devel-list] Re: [Mono-list] Urgent: new Bitmap() does not work because of gdiplus.dll ?
</A></li>
	<LI>Next message: <A HREF="003326.html">[Mono-devel-list] Code Access Security - Initial thoughts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3323">[ date ]</a>
              <a href="thread.html#3323">[ thread ]</a>
              <a href="subject.html#3323">[ subject ]</a>
              <a href="author.html#3323">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
