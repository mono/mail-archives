<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] mono-service bugs - please review
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20mono-service%20bugs%20-%20please%20review&In-Reply-To=cebf8d110802070250n75e7bbf4jb343dac0cfb8d67%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026847.html">
   <LINK REL="Next"  HREF="026850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] mono-service bugs - please review</H1>
    <B>Avery Pennarun</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20mono-service%20bugs%20-%20please%20review&In-Reply-To=cebf8d110802070250n75e7bbf4jb343dac0cfb8d67%40mail.gmail.com"
       TITLE="[Mono-dev] [PATCH] mono-service bugs - please review">apenwarr at gmail.com
       </A><BR>
    <I>Thu Feb  7 15:38:29 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026847.html">[Mono-dev] [PATCH] mono-service bugs - please review
</A></li>
        <LI>Next message: <A HREF="026850.html">[Mono-dev] [PATCH] mono-service bugs - please review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26849">[ date ]</a>
              <a href="thread.html#26849">[ thread ]</a>
              <a href="subject.html#26849">[ subject ]</a>
              <a href="author.html#26849">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>J&#246;rg Rosenkranz wrote:
&gt;<i> Avery wrote:
</I>&gt;<i> &gt; - mono-service can overwrite its lockfile if the lockfile isn't
</I>&gt;<i> &gt;   lockf'ed.  This seems to be what was originally intended, but didn't
</I>&gt;<i> &gt;   quite get implemented correctly.
</I>&gt;<i>
</I>&gt;<i> Did you have a look at bug #77340
</I>&gt;<i> (<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=MONO77340">https://bugzilla.novell.com/show_bug.cgi?id=MONO77340</A>)? For me it
</I>&gt;<i> looks like you are reopening this security hole with your patch.
</I>
Oh dear. Well, my patch definitely brings back that one.  I think the
right fix is to open the existing file, lockf, unlink, and then create
a new one O_CREAT|O_EXCL|O_NOFOLLOW.  In the event that a new file is
created in between unlink and create, just give up.  If it works,
close the original file and throw it away.  Keep the new file's handle
open to preserve the lockf until the program dies.  (Same as current
behaviour.)

Of course no sensible person should leave their lock files in /tmp in
production, but that's a separate question.  I can see why it's the
default.  Another reasonable default would be $PWD.

Then Jonathan Pryor wrote:
&gt;<i> The UnixSignal patch was committed to head earlier this week, and I just
</I>&gt;<i> migrated mono-service to use UnixSignal and UnixSignal.WaitAny() instead
</I>&gt;<i> of Stdlib.signal().  Consequently the polling code has been removed with
</I>&gt;<i> extreme prejudice, and we now have wonderful select(2)-based sleeping
</I>&gt;<i> care of UnixSignal.WaitAny().
</I>&gt;<i>
</I>&gt;<i> This change also adds support for SIGINT, treating it identically with
</I>&gt;<i> SIGTERM.
</I>
Excellent, problem solved.  And mono services will now start and stop
much faster than Microsoft ones with their arbitrary delays :)

So I need to submit a new lockfile patch.  Any comments on the
UserInteractive stuff?  That's actually the part I'm most suspicious
that I did wrong.

Thanks,

Avery

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026847.html">[Mono-dev] [PATCH] mono-service bugs - please review
</A></li>
	<LI>Next message: <A HREF="026850.html">[Mono-dev] [PATCH] mono-service bugs - please review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26849">[ date ]</a>
              <a href="thread.html#26849">[ thread ]</a>
              <a href="subject.html#26849">[ subject ]</a>
              <a href="author.html#26849">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
