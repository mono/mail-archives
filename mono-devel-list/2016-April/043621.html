<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Cross%20Platform%20on%20Linux/Windows%20with%20Mono.Posix%0A%20reference%20on%20Linux&In-Reply-To=%3C57054F06.60403%40arcor.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043620.html">
   <LINK REL="Next"  HREF="043622.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux</H1>
    <B>Jason Curl</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Cross%20Platform%20on%20Linux/Windows%20with%20Mono.Posix%0A%20reference%20on%20Linux&In-Reply-To=%3C57054F06.60403%40arcor.de%3E"
       TITLE="[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux">jcurlnews at arcor.de
       </A><BR>
    <I>Wed Apr  6 18:01:42 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="043620.html">[Mono-dev] Regressions on 3.13.0-46-generic -&gt; 3.13.0-48-generic
</A></li>
        <LI>Next message: <A HREF="043622.html">[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43621">[ date ]</a>
              <a href="thread.html#43621">[ thread ]</a>
              <a href="subject.html#43621">[ subject ]</a>
              <a href="author.html#43621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks all for your ideas.

My project (github.com/jcurl/serialportstream) ended up including 
Mono.Posix via nuget to allow it to compile on Windows. I found an 
option that doesn't copy the assembly to the target path. I thought 
Greg's reply would be useful to tell MonoDevelop on Linux not to even 
reference the nuget package, but I didn't get that working. The IDE 
would still parse the entries and download from NuGet. So i assume when 
I compile on Linux, it's linking against the nuget version and not the 
OS version, but when running, it must be using the OS version and the 
library isn't copied to the destination.

I had already implemented a factory OO model, which I use to instantiate 
either WinNativeSerial or UnixNativeSerial on knowing the environment 
platform ID that's in use.

If &quot;the JIT compiler can or will or might in the future, eagerly link 
assemblies at runtime&quot; were sometime to become true, then I've got a 
problem - I certainly don't want to distribute Mono.Posix.

Could I expect problems when compiling against a different version 
(nuget) that is being used at run-time (os)?

Thankyou!

On 29/03/2016 17:58, Chris Swiedler wrote:
&gt;<i> Why not just include references to Mono.Posix.dll in the Windows build? You don't have to install the full framework. We have a similar issue with server apps that are developed on Windows and run on Linux. We just put a win32 build of Mono into our source tree and added Mono.Posix as a reference. Everywhere we invoke any Posix code, we just wrap the statements in something like &quot;if  (Environment.OSVersion.Platform == PlatformID.Unix)&quot;.
</I>&gt;<i>
</I>&gt;<i> chris
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Edward Ned Harvey (mono)
</I>&gt;<i> Sent: Tuesday, March 29, 2016 5:49 AM
</I>&gt;<i> To: Greg Young &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gregoryyoung1 at gmail.com</A>&gt;; Jason Curl &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">jcurlnews at arcor.de</A>&gt;
</I>&gt;<i> Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> Subject: Re: [Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
</I>&gt;<i>
</I>&gt;&gt;<i> From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
</I>&gt;&gt;<i> [mailto:mono-devel-list- <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of Greg
</I>&gt;&gt;<i> Young
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;Reference Include=&quot;Mono.Posix&quot; Condition=&quot; '$(OS)' != 'Windows_NT' &quot;
</I>&gt;&gt;<i> /&gt;
</I>&gt;<i> (for clarification of my previous response, because I was asked for clarification off-list)
</I>&gt;<i>
</I>&gt;<i> If you have some code that calls Mono.Posix.Something(), and you have a conditional reference to Mono.Posix in the project, then you're able to build on Mono, but on windows, without the reference, your call to Mono.Posix.Something() will not compile, which prevents you from building, even though at runtime you might never make that call. In order to compile on windows, you'll need to comment-out your Mono.Posix.Something() line, via #if or [Conditional], which means you need a compiler symbol to indicate whether you're building on mono or windows. This could be either separate project files, or multiple build configurations. (Or dynamically generated project files).
</I>&gt;<i>
</I>&gt;<i> Maybe you can have a conditional reference to Mono.Posix on mono, and have a separate conditional reference to ../../ExtraClassLibraries/Mono.Posix.dll on windows, with copy-to-destination, so you can get the same code to build on both mono and windows, resulting in an effectively identical cross-platform binary... But I'm almost certain I recall somebody on this list telling me, that the JIT compiler can or will or might in the future, eagerly link assemblies at runtime (or just before runtime), so the Mono.Posix.dll file must be present on windows at runtime in order to avoid runtime exceptions, even though the runtime code execution will never execute that path.
</I>&gt;<i>
</I>&gt;<i> You avoid all these problems by abstracting the functionality you want into an interface or abstract class, and using a factory to perform a runtime dynamic load of a mono-specific or windows-specific assembly with a derivative class. You can build the mono-specific assembly on mono, or maybe you can use the double-conditional described above and get the mono-specific assembly to also be buildable on windows. No need to copy Mono.Posix.dll to the destination, because Mono.Posix will only be called at runtime when run on mono.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043620.html">[Mono-dev] Regressions on 3.13.0-46-generic -&gt; 3.13.0-48-generic
</A></li>
	<LI>Next message: <A HREF="043622.html">[Mono-dev] Cross Platform on Linux/Windows with Mono.Posix reference on Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43621">[ date ]</a>
              <a href="thread.html#43621">[ thread ]</a>
              <a href="subject.html#43621">[ subject ]</a>
              <a href="author.html#43621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
