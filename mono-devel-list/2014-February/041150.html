<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Recent xbuild fixes causing issues with finding mcs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Recent%20xbuild%20fixes%20causing%20issues%20with%20finding%20mcs&In-Reply-To=%3CCAHiqFxR9DAjC8_wBBa72O5FWd5fMyP%2B26FdJHyMbeL5Bt9Yqig%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041149.html">
   <LINK REL="Next"  HREF="041153.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Recent xbuild fixes causing issues with finding mcs</H1>
    <B>Michael Franz</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Recent%20xbuild%20fixes%20causing%20issues%20with%20finding%20mcs&In-Reply-To=%3CCAHiqFxR9DAjC8_wBBa72O5FWd5fMyP%2B26FdJHyMbeL5Bt9Yqig%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Recent xbuild fixes causing issues with finding mcs">mvfranz at gmail.com
       </A><BR>
    <I>Sun Feb 16 03:13:11 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041149.html">[Mono-dev] Recent xbuild fixes causing issues with finding mcs
</A></li>
        <LI>Next message: <A HREF="041153.html">[Mono-dev] Recent xbuild fixes causing issues with finding mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41150">[ date ]</a>
              <a href="thread.html#41150">[ thread ]</a>
              <a href="subject.html#41150">[ subject ]</a>
              <a href="author.html#41150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Feb 15, 2014 at 10:02 PM, Michael Hutchinson &lt;
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">m.j.hutchinson at gmail.com</A>&gt; wrote:

&gt;<i> AFAIK something's wrong with the installation if
</I>&gt;<i> $prefix/lib/mono/4.5/mcs.exe is missing.
</I>&gt;<i>
</I>&gt;<i> What does your $prefix/bin/mcs point to?
</I>&gt;<i>
</I>&gt;<i>
</I>It  points to a binary that does not run on its own.
bash-4.1$ ./lib/mono/4.5/mcs.exe --version
bash: ./lib/mono/4.5/mcs.exe: cannot execute binary file

but, if I run it with mono it will work.
bash-4.1$ bin/mono ./lib/mono/4.5/mcs.exe --version
Mono C# compiler version 3.2.7.0

Prior to the change, it was the mcs wrapper that was being executed, after
the change, it is trying to run the .NET binary directly.  The contents of
mcs is:
#!/bin/sh
exec /opt/local/JenkinsBuilds/bin/mono $MONO_OPTIONS
/opt/local/JenkinsBuilds/lib/mono/4.5/mcs.exe &quot;$@&quot;



On 15 February 2014 10:51, Michael Franz &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mvfranz at gmail.com</A>&gt; wrote:
&gt;<i> &gt; On Sat, Feb 15, 2014 at 9:46 AM, Michael Franz &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mvfranz at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Hi,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I see there have been a few changes to xbuild since February 10th, 2014.
</I>&gt;<i> &gt;&gt; February 10th is the last time I was able to build my local C# project
</I>&gt;<i> using
</I>&gt;<i> &gt;&gt; mono head.  This is a simple project that I have just started and am
</I>&gt;<i> planing
</I>&gt;<i> &gt;&gt; to build on both mono and .NET.  The issue seems to be that xbuild has
</I>&gt;<i> &gt;&gt; changed how it finds mcs.  /opt/local/JenkinsBuilds/bin/mcs -&gt;
</I>&gt;<i> &gt;&gt; /opt/local/JenkinsBuilds/lib/mono/4.5/mcs.exe - see below.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; My locally build mono install is in /opt/local/JenkinsBuilds and my
</I>&gt;<i> builds
</I>&gt;<i> &gt;&gt; are all run via Jenkins.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The build process is:
</I>&gt;<i> &gt;&gt; - use premake5 to generate Visual Studio 2012 project files (note I am
</I>&gt;<i> &gt;&gt; using .net 4.5 specific features)
</I>&gt;<i> &gt;&gt; - use xbuild to build
</I>&gt;<i> &gt;&gt; - use mono version of nunit to test
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The working build out put was like this:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; + /opt/local/JenkinsBuilds/bin/xbuild QTS.sln
</I>&gt;<i> &gt;&gt; XBuild Engine Version 12.0
</I>&gt;<i> &gt;&gt; Mono, Version 3.2.7.0
</I>&gt;<i> &gt;&gt; Copyright (C) 2005-2013 Various Mono authors
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Build started 2/10/2014 9:56:00 PM.
</I>&gt;<i> &gt;&gt; __________________________________________________
</I>&gt;<i> &gt;&gt; Project &quot;/var/lib/jenkins/jobs/CI/workspace/QTS.sln&quot; (default
</I>&gt;<i> target(s)):
</I>&gt;<i> &gt;&gt;      Target ValidateSolutionConfiguration:
</I>&gt;<i> &gt;&gt;              Building solution configuration &quot;Debug|Any CPU&quot;.
</I>&gt;<i> &gt;&gt;      Target Build:
</I>&gt;<i> &gt;&gt;              Project
</I>&gt;<i> &quot;/var/lib/jenkins/jobs/CI/workspace/QTS/QTS.csproj&quot; (default
</I>&gt;<i> &gt;&gt; target(s)):
</I>&gt;<i> &gt;&gt;                      Target PrepareForBuild:
</I>&gt;<i> &gt;&gt;                              Configuration: Debug Platform: AnyCPU
</I>&gt;<i> &gt;&gt;                      Target GenerateSatelliteAssemblies:
</I>&gt;<i> &gt;&gt;                      No input files were specified for target
</I>&gt;<i> GenerateSatelliteAssemblies,
</I>&gt;<i> &gt;&gt; skipping.
</I>&gt;<i> &gt;&gt;                      Target GenerateTargetFrameworkMonikerAttribute:
</I>&gt;<i> &gt;&gt;                      Skipping target
</I>&gt;<i> &quot;GenerateTargetFrameworkMonikerAttribute&quot; because its
</I>&gt;<i> &gt;&gt; outputs are up-to-date.
</I>&gt;<i> &gt;&gt;                      Target CoreCompile:
</I>&gt;<i> &gt;&gt;                              Tool /opt/local/JenkinsBuilds/bin/mcs
</I>&gt;<i> execution started with
</I>&gt;<i> &gt;&gt; arguments: /noconfig /debug:full /debug+ /optimize-
</I>&gt;<i> /out:obj/Debug/QTS.dll
</I>&gt;<i> &gt;&gt; Properties/AssemblyInfo.cs
</I>&gt;<i> Utilities/Measurements/PerformanceStatistics.cs
</I>&gt;<i> &gt;&gt; /target:library /define:&quot;DEBUG;TRACE&quot; /platform:AnyCPU
</I>&gt;<i> &gt;&gt; /reference:/opt/local/JenkinsBuilds/lib/mono/4.5/System.dll
</I>&gt;<i> &gt;&gt; /reference:/opt/local/JenkinsBuilds/lib/mono/4.5/System.Core.dll /warn:4
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The broken build is now producing:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; + /opt/local/JenkinsBuilds/bin/xbuild QTS.sln
</I>&gt;<i> &gt;&gt; XBuild Engine Version 12.0
</I>&gt;<i> &gt;&gt; Mono, Version 3.2.7.0
</I>&gt;<i> &gt;&gt; Copyright (C) 2005-2013 Various Mono authors
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Build started 2/15/2014 8:50:52 AM.
</I>&gt;<i> &gt;&gt; __________________________________________________
</I>&gt;<i> &gt;&gt; Project &quot;/var/lib/jenkins/jobs/CI/workspace/QTS.sln&quot; (default
</I>&gt;<i> target(s)):
</I>&gt;<i> &gt;&gt;      Target ValidateSolutionConfiguration:
</I>&gt;<i> &gt;&gt;              Building solution configuration &quot;Debug|Any CPU&quot;.
</I>&gt;<i> &gt;&gt;      Target Build:
</I>&gt;<i> &gt;&gt;              Project
</I>&gt;<i> &quot;/var/lib/jenkins/jobs/CI/workspace/QTS/QTS.csproj&quot; (default
</I>&gt;<i> &gt;&gt; target(s)):
</I>&gt;<i> &gt;&gt;                      Target PrepareForBuild:
</I>&gt;<i> &gt;&gt;                              Configuration: Debug Platform: AnyCPU
</I>&gt;<i> &gt;&gt;                              Created directory &quot;bin/Debug/&quot;
</I>&gt;<i> &gt;&gt;                              Created directory &quot;obj/Debug/&quot;
</I>&gt;<i> &gt;&gt;                      Target CopyFilesMarkedCopyLocal:
</I>&gt;<i> &gt;&gt;                              Copying file from
</I>&gt;<i> '/opt/local/JenkinsBuilds/lib/mono/4.5/mscorlib.dll'
</I>&gt;<i> &gt;&gt; to '/var/lib/jenkins/jobs/CI/workspace/QTS/bin/Debug/mscorlib.dll'
</I>&gt;<i> &gt;&gt;                              Copying file from
</I>&gt;<i> &gt;&gt; '/opt/local/JenkinsBuilds/lib/mono/4.5/mscorlib.dll.mdb' to
</I>&gt;<i> &gt;&gt; '/var/lib/jenkins/jobs/CI/workspace/QTS/bin/Debug/mscorlib.dll.mdb'
</I>&gt;<i> &gt;&gt;                      Target GenerateSatelliteAssemblies:
</I>&gt;<i> &gt;&gt;                      No input files were specified for target
</I>&gt;<i> GenerateSatelliteAssemblies,
</I>&gt;<i> &gt;&gt; skipping.
</I>&gt;<i> &gt;&gt;                      Target CoreCompile:
</I>&gt;<i> &gt;&gt;                              Tool
</I>&gt;<i> /opt/local/JenkinsBuilds/lib/mono/4.5/mcs.exe execution started
</I>&gt;<i> &gt;&gt; with arguments: /noconfig /debug:full /debug+ /optimize-
</I>&gt;<i> &gt;&gt; /out:obj/Debug/QTS.dll Properties/AssemblyInfo.cs Utilities/Math.cs
</I>&gt;<i> &gt;&gt; Utilities/Measurements/PerformanceStatistics.cs
</I>&gt;<i> &gt;&gt; obj/Debug/.NETFramework,Version=v4.5.AssemblyAttribute.cs
</I>&gt;<i> /target:library
</I>&gt;<i> &gt;&gt; /define:&quot;DEBUG;TRACE&quot; /nostdlib /platform:AnyCPU
</I>&gt;<i> &gt;&gt; /reference:/opt/local/JenkinsBuilds/lib/mono/4.5/System.dll
</I>&gt;<i> &gt;&gt; /reference:/opt/local/JenkinsBuilds/lib/mono/4.5/System.Core.dll
</I>&gt;<i> &gt;&gt; /reference:/opt/local/JenkinsBuilds/lib/mono/4.5/mscorlib.dll /warn:4
</I>&gt;<i> &gt;&gt; /opt/local/JenkinsBuilds/lib/mono/4.5/Microsoft.CSharp.targets: error :
</I>&gt;<i> &gt;&gt; Error executing tool '/opt/local/JenkinsBuilds/lib/mono/4.5/mcs.exe':
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I checked the commit logs, and it looks like there are commits that
</I>&gt;<i> would
</I>&gt;<i> &gt;&gt; affect this behavior.  Now, it might be that I was doing something wrong
</I>&gt;<i> &gt;&gt; from the start and now I need to fix the process, but it seems like a
</I>&gt;<i> simple
</I>&gt;<i> &gt;&gt; process.
</I>&gt;<i> &gt;&gt; e753ca2 Michael Hutchinson [xbuild] Fix dependency in C# targets
</I>&gt;<i> &gt;&gt; c197478 Michael Hutchinson [xbuild] Fix 2.0 tests to handle mcs sdk
</I>&gt;<i> &gt;&gt; argument
</I>&gt;<i> &gt;&gt; 693176c Michael Hutchinson [xbuild] Fix Tooltask.ToolPath behaviour to
</I>&gt;<i> &gt;&gt; match .NET
</I>&gt;<i> &gt;&gt; df52831 Michael Hutchinson [xbuild] Make ToolLocationHelper work better
</I>&gt;<i> &gt;&gt; for 2.0/3.5
</I>&gt;<i> &gt;&gt; a55c588 Michael Hutchinson [xbuild] Fix typo that broke 2.0/3.5 targets
</I>&gt;<i> &gt;&gt; c705849 Michael Hutchinson [xbuild] Fix mscorlib resolution for custom
</I>&gt;<i> &gt;&gt; frameworks
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; So, is this a bug in xbuild?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Thank you
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Michael
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I did some rollbacks and have confirmed that change c705849b breaks my
</I>&gt;<i> build
</I>&gt;<i> &gt; process, Revision 85fbadaf is the last version that works for me.  I have
</I>&gt;<i> &gt; not looked at the change in detail, but it does seem to be relevant to my
</I>&gt;<i> &gt; problem.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Michael
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Michael Hutchinson
</I>&gt;<i> <A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140215/6412a8de/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140215/6412a8de/attachment-0001.html</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041149.html">[Mono-dev] Recent xbuild fixes causing issues with finding mcs
</A></li>
	<LI>Next message: <A HREF="041153.html">[Mono-dev] Recent xbuild fixes causing issues with finding mcs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41150">[ date ]</a>
              <a href="thread.html#41150">[ thread ]</a>
              <a href="subject.html#41150">[ subject ]</a>
              <a href="author.html#41150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
