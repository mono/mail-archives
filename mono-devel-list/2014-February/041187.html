<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Unix-sockets%20%26%20Mono.WebServer.FastCgi&In-Reply-To=%3CCAB1r_%2BXbQu_JbuNkVWa9sK-EpNnkD6_r8pnNvq0%2Bf72SZoHcjQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041188.html">
   <LINK REL="Next"  HREF="041186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi</H1>
    <B>Daniel Lo Nigro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Unix-sockets%20%26%20Mono.WebServer.FastCgi&In-Reply-To=%3CCAB1r_%2BXbQu_JbuNkVWa9sK-EpNnkD6_r8pnNvq0%2Bf72SZoHcjQ%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi">lists at dan.cx
       </A><BR>
    <I>Thu Feb 20 06:45:16 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041188.html">[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi
</A></li>
        <LI>Next message: <A HREF="041186.html">[Mono-dev] which branch is recent SqlBulkCopy fix in?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41187">[ date ]</a>
              <a href="thread.html#41187">[ thread ]</a>
              <a href="subject.html#41187">[ subject ]</a>
              <a href="author.html#41187">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That sounds like a bug - It's probably worth reporting it as such.


On Mon, Feb 17, 2014 at 10:36 PM, SirNoSkill &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">quandary82 at hailmail.net</A>&gt;wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I downloaded the sources for XSP from git.
</I>&gt;<i> And it seems Mono.WebServer.FastCgi has been under quite a bit of
</I>&gt;<i> change.
</I>&gt;<i> First I wanted to thank the person(s) responsible for it, seems like the
</I>&gt;<i> fastcgi server is finally stable, or at least stable enough that it
</I>&gt;<i> hasn't crashed once in the last 2 weeks, including a performance load
</I>&gt;<i> test.
</I>&gt;<i> Keep up the good work.
</I>&gt;<i>
</I>&gt;<i> One thing though:
</I>&gt;<i> It worked fine with TCP, but when I tried with unix sockets, I got this
</I>&gt;<i> error:
</I>&gt;<i> Error parsing permissions &quot;&quot;. Use octal.&quot;
</I>&gt;<i>
</I>&gt;<i> In file
</I>&gt;<i> /xsp/src/Mono.WebServer.FastCgi/main.cs
</I>&gt;<i> in function public static bool TryCreateUnixSocket (string path, out
</I>&gt;<i> Socket socket, string perm = null)
</I>&gt;<i>
</I>&gt;<i> there is this code:
</I>&gt;<i> if (perm == null) {
</I>&gt;<i>     socket = new UnixSocket (realPath);
</I>&gt;<i>     Logger.Write (LogLevel.Debug, &quot;Listening on file {0} with default
</I>&gt;<i>     permissions&quot;, realPath);
</I>&gt;<i> } else {
</I>&gt;<i>     ushort uperm;
</I>&gt;<i>     if (!UInt16.TryParse (perm, out uperm)) {
</I>&gt;<i>         Logger.Write (LogLevel.Error, &quot;Error parsing permissions
</I>&gt;<i>         \&quot;{0}\&quot;. Use octal.&quot;, perm);
</I>&gt;<i>         return false;
</I>&gt;<i>     }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> that should probably be
</I>&gt;<i> if(string.IsNullOrEmpty(perm)){
</I>&gt;<i> because UInt16.TryParse will fail if perm is string.Empty.
</I>&gt;<i>
</I>&gt;<i> If I fix this, fastcgi-server starts, but I get a HTTP 502.
</I>&gt;<i> Since the config works fine if I use TCP, I guess this is a
</I>&gt;<i> fastcgi-server bug.
</I>&gt;<i> Just thought I let you know.
</I>&gt;<i>
</I>&gt;<i> It's unlikely it's a permission bug, since I let fastcgi-mono-server4
</I>&gt;<i> run as root.
</I>&gt;<i> Just in case, here my configuration settings:
</I>&gt;<i>
</I>&gt;<i> This is my fastcgi-start script
</I>&gt;<i>
</I>&gt;<i> #!/bin/sh
</I>&gt;<i>
</I>&gt;<i> ### BEGIN INIT INFO
</I>&gt;<i> # Provides:          monoserve.sh
</I>&gt;<i> # Required-Start:    $local_fs $syslog $remote_fs
</I>&gt;<i> # Required-Stop:     $local_fs $syslog $remote_fs
</I>&gt;<i> # Default-Start:     2 3 4 5
</I>&gt;<i> # Default-Stop:      0 1 6
</I>&gt;<i> # Short-Description: Start fastcgi mono server with hosts
</I>&gt;<i> ### END INIT INFO
</I>&gt;<i>
</I>&gt;<i> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
</I>&gt;<i> DAEMON=/usr/bin/mono
</I>&gt;<i> NAME=monoserver
</I>&gt;<i> DESC=monoserver
</I>&gt;<i>
</I>&gt;<i> MONOSERVER=$(which fastcgi-mono-server4)
</I>&gt;<i> MONOSERVER_PID=$(ps auxf | grep fastcgi-mono-server4.exe | grep -v grep
</I>&gt;<i> | awk '{print $2}')
</I>&gt;<i>
</I>&gt;<i> WEBAPPS=&quot;www.example.com:
</I>&gt;<i> /:/root/VS2010/SqlWebAdmin/SqlWebAdmin/,example.com:
</I>&gt;<i> /:/root/VS2010/SqlWebAdmin/SqlWebAdmin/&quot;
</I>&gt;<i>
</I>&gt;<i> #WEBAPPS=&quot;www.domain1.xyz:/:/var/www/domain1.xyz/,www.domain2.xyz:/:/var/www/domain2.xyz/&quot;
</I>&gt;<i>
</I>&gt;<i> case &quot;$1&quot; in
</I>&gt;<i>         start)
</I>&gt;<i>                 if [ -z &quot;${MONOSERVER_PID}&quot; ]; then
</I>&gt;<i>                         echo &quot;starting mono server&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>                         # ${MONOSERVER} /applications=${WEBAPPS}
</I>&gt;<i>                         /socket=unix:/tmp/fastcgi.socket &amp;
</I>&gt;<i>                         # ${MONOSERVER} /applications=${WEBAPPS}
</I>&gt;<i>                         /socket=tcp:127.0.0.1:9000 &amp;
</I>&gt;<i>                         ${MONOSERVER} /applications=${WEBAPPS}
</I>&gt;<i>                         /socket=unix:/var/run/mono3-fcgi.sock &amp;
</I>&gt;<i>                         echo &quot;mono server started&quot;
</I>&gt;<i>                 else
</I>&gt;<i>                         echo ${WEBAPPS}
</I>&gt;<i>                         echo &quot;mono server is running&quot;
</I>&gt;<i>                 fi
</I>&gt;<i>         ;;
</I>&gt;<i>         stop)
</I>&gt;<i>                 if [ -n &quot;${MONOSERVER_PID}&quot; ]; then
</I>&gt;<i>                         kill ${MONOSERVER_PID}
</I>&gt;<i>                         echo &quot;mono server stopped&quot;
</I>&gt;<i>                 else
</I>&gt;<i>                         echo &quot;mono server is not running&quot;
</I>&gt;<i>                 fi
</I>&gt;<i>         ;;
</I>&gt;<i>         *) echo &quot;You have provided no or an invalid command line
</I>&gt;<i>         argument.&quot;
</I>&gt;<i>         ;;
</I>&gt;<i> esac
</I>&gt;<i>
</I>&gt;<i> exit 0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> and this the nginx configuration
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ##
</I>&gt;<i> # You should look at the following URL's in order to grasp a solid
</I>&gt;<i> understanding
</I>&gt;<i> # of Nginx configuration files in order to fully unleash the power of
</I>&gt;<i> Nginx.
</I>&gt;<i> # <A HREF="http://wiki.nginx.org/Pitfalls">http://wiki.nginx.org/Pitfalls</A>
</I>&gt;<i> # <A HREF="http://wiki.nginx.org/QuickStart">http://wiki.nginx.org/QuickStart</A>
</I>&gt;<i> # <A HREF="http://wiki.nginx.org/Configuration">http://wiki.nginx.org/Configuration</A>
</I>&gt;<i> #
</I>&gt;<i> # Generally, you will want to move this file somewhere, and start with a
</I>&gt;<i> clean
</I>&gt;<i> # file but keep this around for reference. Or just disable in
</I>&gt;<i> sites-enabled.
</I>&gt;<i> #
</I>&gt;<i> # Please see /usr/share/doc/nginx-doc/examples/ for more detailed
</I>&gt;<i> examples.
</I>&gt;<i> ##
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  server {
</I>&gt;<i>          listen   80;
</I>&gt;<i>          server_name www.example.com example.com;
</I>&gt;<i>          access_log   /var/log/nginx/your.domain1.xyz.access.log;
</I>&gt;<i>
</I>&gt;<i>          location / {
</I>&gt;<i>                  root /root/VS2010/SqlWebAdmin/SqlWebAdmin;
</I>&gt;<i>                  #index index.html index.htm default.aspx Default.aspx;
</I>&gt;<i>                  #fastcgi_index Default.aspx;
</I>&gt;<i>                  #fastcgi_pass 127.0.0.1:9000;
</I>&gt;<i>                  fastcgi_pass unix:/var/run/mono3-fcgi.sock;
</I>&gt;<i>                  include /etc/nginx/fastcgi_params;
</I>&gt;<i>          }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         location /doc {
</I>&gt;<i>                 root /usr/share;
</I>&gt;<i>                 autoindex on;
</I>&gt;<i>                 allow 127.0.0.1;
</I>&gt;<i>                 deny all;
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>         location /shared_images {
</I>&gt;<i>                 root /usr/share;
</I>&gt;<i>                 autoindex off;
</I>&gt;<i>         }
</I>&gt;<i>
</I>&gt;<i>         error_page 404 /CustomErrors/404.htm;
</I>&gt;<i>
</I>&gt;<i>         # redirect server error pages to the static page /50x.html
</I>&gt;<i>         #
</I>&gt;<i>         #error_page 500 502 503 504 /50x.html;
</I>&gt;<i>         #location = /50x.html {
</I>&gt;<i>         #       root /usr/share/nginx/www;
</I>&gt;<i>         #}
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> /etc/hosts entries:
</I>&gt;<i> 127.0.0.1       example.com
</I>&gt;<i> 127.0.0.1 www.example.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Kind regards
</I>&gt;<i>
</I>&gt;<i> NoSkillz
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> <A HREF="http://www.fastmail.fm">http://www.fastmail.fm</A> - IMAP accessible web-mail
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140219/900ab75a/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20140219/900ab75a/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041188.html">[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi
</A></li>
	<LI>Next message: <A HREF="041186.html">[Mono-dev] which branch is recent SqlBulkCopy fix in?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41187">[ date ]</a>
              <a href="thread.html#41187">[ thread ]</a>
              <a href="subject.html#41187">[ subject ]</a>
              <a href="author.html#41187">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
