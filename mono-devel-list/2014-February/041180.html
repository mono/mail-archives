<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Unix-sockets%20%26%20Mono.WebServer.FastCgi&In-Reply-To=%3C1392705398.9492.84536545.4EDE3CA1%40webmail.messagingengine.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041185.html">
   <LINK REL="Next"  HREF="041184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi</H1>
    <B>SirNoSkill</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Unix-sockets%20%26%20Mono.WebServer.FastCgi&In-Reply-To=%3C1392705398.9492.84536545.4EDE3CA1%40webmail.messagingengine.com%3E"
       TITLE="[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi">quandary82 at hailmail.net
       </A><BR>
    <I>Tue Feb 18 06:36:38 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="041185.html">[Mono-dev] Failure to compile Mono 3.2.7-branch from source
</A></li>
        <LI>Next message: <A HREF="041184.html">[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41180">[ date ]</a>
              <a href="thread.html#41180">[ thread ]</a>
              <a href="subject.html#41180">[ subject ]</a>
              <a href="author.html#41180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I downloaded the sources for XSP from git. 
And it seems Mono.WebServer.FastCgi has been under quite a bit of
change. 
First I wanted to thank the person(s) responsible for it, seems like the
fastcgi server is finally stable, or at least stable enough that it
hasn't crashed once in the last 2 weeks, including a performance load
test. 
Keep up the good work.

One thing though: 
It worked fine with TCP, but when I tried with unix sockets, I got this
error:
Error parsing permissions &quot;&quot;. Use octal.&quot;

In file
/xsp/src/Mono.WebServer.FastCgi/main.cs
in function public static bool TryCreateUnixSocket (string path, out
Socket socket, string perm = null)

there is this code:
if (perm == null) {
    socket = new UnixSocket (realPath);
    Logger.Write (LogLevel.Debug, &quot;Listening on file {0} with default
    permissions&quot;, realPath);
} else {
    ushort uperm;
    if (!UInt16.TryParse (perm, out uperm)) {
        Logger.Write (LogLevel.Error, &quot;Error parsing permissions
        \&quot;{0}\&quot;. Use octal.&quot;, perm);
        return false;
    }


that should probably be 
if(string.IsNullOrEmpty(perm)){ 
because UInt16.TryParse will fail if perm is string.Empty.

If I fix this, fastcgi-server starts, but I get a HTTP 502. 
Since the config works fine if I use TCP, I guess this is a
fastcgi-server bug.
Just thought I let you know.

It's unlikely it's a permission bug, since I let fastcgi-mono-server4
run as root.
Just in case, here my configuration settings:

This is my fastcgi-start script 

#!/bin/sh

### BEGIN INIT INFO
# Provides:          monoserve.sh
# Required-Start:    $local_fs $syslog $remote_fs
# Required-Stop:     $local_fs $syslog $remote_fs
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Start fastcgi mono server with hosts
### END INIT INFO

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
DAEMON=/usr/bin/mono
NAME=monoserver
DESC=monoserver

MONOSERVER=$(which fastcgi-mono-server4)
MONOSERVER_PID=$(ps auxf | grep fastcgi-mono-server4.exe | grep -v grep
|<i> awk '{print $2}')
</I>
WEBAPPS=&quot;www.example.com:/:/root/VS2010/SqlWebAdmin/SqlWebAdmin/,example.com:/:/root/VS2010/SqlWebAdmin/SqlWebAdmin/&quot;
#WEBAPPS=&quot;www.domain1.xyz:/:/var/www/domain1.xyz/,www.domain2.xyz:/:/var/www/domain2.xyz/&quot;

case &quot;$1&quot; in
        start)
                if [ -z &quot;${MONOSERVER_PID}&quot; ]; then
                        echo &quot;starting mono server&quot;

                        
                        # ${MONOSERVER} /applications=${WEBAPPS}
                        /socket=unix:/tmp/fastcgi.socket &amp;
                        # ${MONOSERVER} /applications=${WEBAPPS}
                        /socket=tcp:127.0.0.1:9000 &amp;
                        ${MONOSERVER} /applications=${WEBAPPS}
                        /socket=unix:/var/run/mono3-fcgi.sock &amp;
                        echo &quot;mono server started&quot;
                else
                        echo ${WEBAPPS}
                        echo &quot;mono server is running&quot;
                fi
        ;;
        stop)
                if [ -n &quot;${MONOSERVER_PID}&quot; ]; then
                        kill ${MONOSERVER_PID}
                        echo &quot;mono server stopped&quot;
                else
                        echo &quot;mono server is not running&quot;
                fi
        ;;
        *) echo &quot;You have provided no or an invalid command line
        argument.&quot;
        ;;
esac

exit 0



and this the nginx configuration 


##
# You should look at the following URL's in order to grasp a solid
understanding
# of Nginx configuration files in order to fully unleash the power of
Nginx.
# <A HREF="http://wiki.nginx.org/Pitfalls">http://wiki.nginx.org/Pitfalls</A>
# <A HREF="http://wiki.nginx.org/QuickStart">http://wiki.nginx.org/QuickStart</A>
# <A HREF="http://wiki.nginx.org/Configuration">http://wiki.nginx.org/Configuration</A>
#
# Generally, you will want to move this file somewhere, and start with a
clean
# file but keep this around for reference. Or just disable in
sites-enabled.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed
examples.
##


 server {
         listen   80;
         server_name www.example.com example.com;
         access_log   /var/log/nginx/your.domain1.xyz.access.log;
 
         location / {
                 root /root/VS2010/SqlWebAdmin/SqlWebAdmin;
                 #index index.html index.htm default.aspx Default.aspx;
                 #fastcgi_index Default.aspx;
                 #fastcgi_pass 127.0.0.1:9000;
                 fastcgi_pass unix:/var/run/mono3-fcgi.sock;
                 include /etc/nginx/fastcgi_params;
         }
 



	location /doc {
		root /usr/share;
		autoindex on;
		allow 127.0.0.1;
		deny all;
	}

	location /shared_images {
		root /usr/share;
		autoindex off;
	}

	error_page 404 /CustomErrors/404.htm;

	# redirect server error pages to the static page /50x.html
	#
	#error_page 500 502 503 504 /50x.html;
	#location = /50x.html {
	#       root /usr/share/nginx/www;
	#}

}


/etc/hosts entries:
127.0.0.1       example.com
127.0.0.1 www.example.com


Kind regards

NoSkillz

-- 
<A HREF="http://www.fastmail.fm">http://www.fastmail.fm</A> - IMAP accessible web-mail

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041185.html">[Mono-dev] Failure to compile Mono 3.2.7-branch from source
</A></li>
	<LI>Next message: <A HREF="041184.html">[Mono-dev] Unix-sockets &amp; Mono.WebServer.FastCgi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41180">[ date ]</a>
              <a href="thread.html#41180">[ thread ]</a>
              <a href="subject.html#41180">[ subject ]</a>
              <a href="author.html#41180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
