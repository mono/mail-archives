<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] .NET Remoting: Upload of a file from a Win32 MS .NET	client to a Linux Mono .NET server.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20.NET%20Remoting%3A%20Upload%20of%20a%20file%20from%20a%20Win32%20MS%20.NET%0A%09client%20to%20a%20Linux%20Mono%20.NET%20server.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014799.html">
   <LINK REL="Next"  HREF="014489.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] .NET Remoting: Upload of a file from a Win32 MS .NET	client to a Linux Mono .NET server.</H1>
    <B>Yngve Zackrisson</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20.NET%20Remoting%3A%20Upload%20of%20a%20file%20from%20a%20Win32%20MS%20.NET%0A%09client%20to%20a%20Linux%20Mono%20.NET%20server.&In-Reply-To="
       TITLE="[Mono-dev] .NET Remoting: Upload of a file from a Win32 MS .NET	client to a Linux Mono .NET server.">yngve.zackrisson at mobila-kontoret.se
       </A><BR>
    <I>Fri Sep  2 04:30:22 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014799.html">[Mono-dev] Re: [Mono-devel-list] TimeStamp support on oracle...
</A></li>
        <LI>Next message: <A HREF="014489.html">[Mono-dev] .NET Remoting: Upload of a file from a Win32 MS .NET	client to a Linux Mono .NET server.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14477">[ date ]</a>
              <a href="thread.html#14477">[ thread ]</a>
              <a href="subject.html#14477">[ subject ]</a>
              <a href="author.html#14477">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there.

This is the first time I send a mail to this list.

I am currently trying to set up a .NET Remoting application.
For the communication I use HTTP with binary formating 
as a communication  channel.
I have got the application work with MS .NET Win32 on both 
the client and server side.

After some struggle (with configuration files and custom channel) 
I am now able to do remote invocations from my Win32 MS .NET client 
to my Linux (Fedora3) Mono .NET host (console) application.
All works well having primitive datatypes and DataSets as parameters 
and returns in the methods.

The problems (now) arise when i try to upload a zip file from 
the client to the server.
I use a parameter with a (File)Stream object to do &quot;callbacks&quot; 
to Read the file in blocks from the client into the server.
When calling the Read(buffer, 0, buffer.Length) method 
I get index out of range exception messages on my the Mono server.

Here is the code snippet for a simplified test example : 

public class RemoteObject : MarshalByRefObject
{

  ...

  // AFAIK not more than 350 Kb can be serialized in .NET.
  //private const int PORTION_SIZE = (256 * 1024);
  //private const int PORTION_SIZE = 1024;
  private const int PORTION_SIZE = 64;

  ...

  /// &lt;summary&gt;
  /// Method FileUpload to test the remoting.
  /// &lt;/summary&gt;
  public bool FileUpload(Stream fileIn, long fileInLength)
  {
	bool returnValue = false;
	// Download large files in shunks.
	long bytesDownloadedIn = 0L;
	FileStream fileOut = new FileStream(&quot;FileOut.txt&quot;,
		FileMode.OpenOrCreate, FileAccess.Write);
	long bytesDownloadedOut = 0L;
	try 
	{
		for (bytesDownloadedIn = 0L; bytesDownloadedIn &lt; 			fileInLength; )
		{
			// request the next portion
			int sizeToRead = (int)Math.Min(PORTION_SIZE, 				fileInLength -
bytesDownloadedIn);
			byte[] buffer = new byte[sizeToRead];
			fileIn.Read(buffer, 0, buffer.Length);	//&lt;err&gt;	 			// update counters
			bytesDownloadedIn += buffer.Length;
			// save it into the file
			fileOut.Write(buffer, 0, buffer.Length);
			fileOut.Flush();
			bytesDownloadedOut = bytesDownloadedIn;
		}
		returnValue = true;
	}
	catch (RemotingException remex) 
	{
		Console.WriteLine(&quot;FileUpload - RemotingException: &quot; + remex.Message);
		returnValue = false;
	}
	catch (IOException ioex) 
	{
		Console.WriteLine(&quot;FileUpload - IOException: &quot; + ioex.Message);
		returnValue = false;
	}
	catch (Exception ex) 
	{
		Console.WriteLine(&quot;FileUpload - Exception: &quot; + ex.Message);
		returnValue = false;
	}
	finally 
	{
		fileOut.Close();
	}
	return returnValue;
  }

...

}

The error occur at &lt;err&gt; above.

The error message I get on the Mono server is:

EXCEPTION handling: IndexOutOfRangeException
EXCEPTION handling: IndexOutOfRangeException
FileUpload - Exception: Array index is out of range.



I have elaborated using FileStream and Stream, 
using different PORTION_SIZE and doing the 
buffer 1 byte longer than the sizeToRead.
The fileInLength is set at the client (to fileIn.Length) 
to avoid an extra roundtrip.

Can anyone advice me how I should do to upload 
a file from Win32 MS .NET to Linux Mono .NET.
The issue is critical to get my application to work on Mono.
Is there some other stream class I can use to transfer 
a file from the client to the server.

As an aside I also want to report back the progress 
of the file upload to the client.
I want to update a progressbar on my Win32 client. 
I have succeded to do that on my pure Win32 application, 
though some progressbar handling technique.
Am I expected to get any trouble using the ProgressBar 
indirectly as a method parameter?.

Regards 

Yngve Zackrisson











</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014799.html">[Mono-dev] Re: [Mono-devel-list] TimeStamp support on oracle...
</A></li>
	<LI>Next message: <A HREF="014489.html">[Mono-dev] .NET Remoting: Upload of a file from a Win32 MS .NET	client to a Linux Mono .NET server.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14477">[ date ]</a>
              <a href="thread.html#14477">[ thread ]</a>
              <a href="subject.html#14477">[ subject ]</a>
              <a href="author.html#14477">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
