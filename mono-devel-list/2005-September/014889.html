<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Win32 Shell Icons in MWF with high	levelsystemicon abstraction layer in XplatUI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Win32%20Shell%20Icons%20in%20MWF%20with%20high%0A%09levelsystemicon%20abstraction%20layer%20in%20XplatUI&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014884.html">
   <LINK REL="Next"  HREF="014885.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Win32 Shell Icons in MWF with high	levelsystemicon abstraction layer in XplatUI</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Win32%20Shell%20Icons%20in%20MWF%20with%20high%0A%09levelsystemicon%20abstraction%20layer%20in%20XplatUI&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] Win32 Shell Icons in MWF with high	levelsystemicon abstraction layer in XplatUI">kornelpal at hotmail.com
       </A><BR>
    <I>Thu Sep 22 13:34:38 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014884.html">[Mono-dev] [PATCH] Win32 Shell Icons in MWF with high level	systemicon abstraction layer in XplatUI
</A></li>
        <LI>Next message: <A HREF="014885.html">[Mono-dev] porting tool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14889">[ date ]</a>
              <a href="thread.html#14889">[ thread ]</a>
              <a href="subject.html#14889">[ subject ]</a>
              <a href="author.html#14889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Some comments on the things you have written:

Using ImageList is the best solution as ListView only accepts ImageLists.
This means that if we return Images then we have to store them in an
internal ImageList. As MimeIconEngine and Windows Shell stores file icons in
ImageLists the most effective solution is to use these ImageLists directly.
This entire solution is internal to MWF so there should be no problem. Note
that system image list of Windows Shell is exposed outside of Shell and you
could modify it if you want so this solution is still more safe.:)

And if you look at system icon consumers you will see that only 5 Buttons
need Images while thousends of ListView and if we implement icon handling in
folder browser hunderds of TreeView items as well need ImageLists. So it's
easier to get Images from ImageLists for that 5 button than adding hundereds
of Images to ImageLists. In the latter case we should take care about index
mapping as well (like in SizedIcons). Note that I think those buttons should
be replaced by a single ToolBar that uses ImageList as well.

Moving things to themes is simple as icon handling functions can be added to
the theme interface as well that can either use XplatUI or provide it's own
implementation. As functions in Theme will have the same signature as in
XplatUI this change can be made only by changing XplatUI... to
ThemeEngine.Current... in the code. This change can be done at any time so I
think we should do it only when it will be needed as our needs may change
when we will be about to do such things.

Using the same indexes for large and small icons seems to be the best
solution so we don't need separate functions or flags. Both MimeIconEngine
and Windows Shell loads and chaches large and small icons in a single step.
And if ListView items weren't reloaded from file system if you change view
using same indexes could save time.

The directory flag comes from the current MimeIconEngine based solution if
MimeIconEngine checks for directories there is no use to have that flag. I
simply don't wanted to mess up MimeIconEngine.

You did not mention the open flag but I think that should stay because it
makes
lists more cool and more Windows-like if the currently open folder has open
icon. And I think open folder icon exists in KDE and GNOME as well.

Korn&#233;l

----- Original Message -----
From: &quot;Peter Dennis Bartok&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">peter at novonyx.com</A>&gt;
To: &quot;Korn&#233;l P&#225;l&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at hotmail.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Thursday, September 22, 2005 5:29 PM
Subject: Re: [Mono-dev] [PATCH] Win32 Shell Icons in MWF with high
levelsystemicon abstraction layer in XplatUI


&gt;<i> Kornel,
</I>&gt;<i>
</I>&gt;<i> Thanks for all the work you put into the patch. I did a quick review, I
</I>&gt;<i> will
</I>&gt;<i> need more time before approving it. One thing that already know needs to
</I>&gt;<i> be
</I>&gt;<i> different is where the special icons are pulled from. We need to allow
</I>&gt;<i> themes to provide the special icons to be used, so the file dialog will
</I>&gt;<i> need
</I>&gt;<i> to call into the theme to get them. The theme then has the choice of
</I>&gt;<i> pulling
</I>&gt;<i> it from the driver or from somewhere else. But, we possibly might go one
</I>&gt;<i> step further and move the complete composition of the file dialog into the
</I>&gt;<i> theme, which could allow a theme using the native openfile dialog
</I>&gt;<i> (assuming
</I>&gt;<i> the theme finds a way to have a match in features)
</I>&gt;<i>
</I>&gt;<i> Also, I think the methods for the icons in the driver are not
</I>&gt;<i> straightforward enough. I want something along the lines of &quot;Image
</I>&gt;<i> GetIcon(string path)&quot; or maybe &quot;Image GetIcon(string path, bool
</I>&gt;<i> wantLargeIcon)&quot;. The rest should be hidden underneath. There's no reason
</I>&gt;<i> to
</I>&gt;<i> pass in a bool whether or not the path is a directory, the code returning
</I>&gt;<i> the icon can check that itself. Returning an index instead of the actual
</I>&gt;<i> image just makes it more complicated to use above.
</I>&gt;<i>
</I>&gt;<i> More later when I had some time to review.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>  Peter
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: &quot;Korn&#233;l P&#225;l&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at hotmail.com</A>&gt;
</I>&gt;<i> To: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> Date: 22 September, 2005 05:54
</I>&gt;<i> Subject: [Mono-dev] [PATCH] Win32 Shell Icons in MWF with high level
</I>&gt;<i> systemicon abstraction layer in XplatUI
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Originally I only wanted to create a shell icon handler for Windows but it
</I>&gt;&gt;<i>figured out that the current abstraction of icon handling is not abstract
</I>&gt;&gt;<i>enough. So I created a new abstraction in XplatUI that is based on file
</I>&gt;&gt;<i>name
</I>&gt;&gt;<i>rather than on MIME type. And I added special icon handling that can
</I>&gt;&gt;<i>provide
</I>&gt;&gt;<i>system specific icons for OpenFileDialog for example.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Please review the patch and please approve it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Note that special icons should either mapped to KDE and GNOME icons or
</I>&gt;&gt;<i>resources from Default handler should be used in MimeIconEngine. I didn't
</I>&gt;&gt;<i>implement this. Unless it will be implemented unknown/unknown icon will be
</I>&gt;&gt;<i>used for undefined special icons. Optionally and open folter icon could be
</I>&gt;&gt;<i>implemented in MimeIconEngine as well by using directory/open for example.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>This is the expected behaviour of ImageList and is required by the other
</I>&gt;&gt;<i>patch:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>ImageList.cs: Modified to copy Images when adding or getting them.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>ChangeLog:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>System.Windows.Forms.dll.sources: Added SizedIcons.cs and
</I>&gt;&gt;<i>Win32ShellIcons.cs.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>XplatUIStructs.cs: Added SpecialIcons enumeration.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>XplatUIDriver.cs: Added LargeIcons, SmallIcons, GetIconIndex and
</I>&gt;&gt;<i>GetSpecialIconIndex for system icon handling. Default implementation uses
</I>&gt;&gt;<i>MimeIconEngine.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>XplatUI.cs: Added LargeIcons, SmallIcons, GetIconIndex and
</I>&gt;&gt;<i>GetSpecialIconIndex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Win32ShellIcons.cs: New shell icon handler for Windows. Supports 32-bit
</I>&gt;&gt;<i>icons with alpha channel and caches system image list icons in managed
</I>&gt;&gt;<i>ImageLists to provide compatibility with ListView.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>XplatUIWin32.cs: Implemented LargeIcons, SmallIcons, GetIconIndex and
</I>&gt;&gt;<i>GetSpecialIconIndex using Win32ShellIcons.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>SizedIcons.cs: New icon handler that wraps XplatUI icon handler and
</I>&gt;&gt;<i>provides
</I>&gt;&gt;<i>ImageLists with constant size.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>FileDialog.cs: Modified to use XplatUI and SizedIcons instead of
</I>&gt;&gt;<i>MimeIconEngine and GetResource.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>MimeIcon.cs: Removed GetIconForMimeTypeAndSize as it is superseded by
</I>&gt;&gt;<i>SizedIcons. Removed code that prevented MIME types returned other than
</I>&gt;&gt;<i>inode/directory and unknown/unknown when using PlatformDefaultHandler.
</I>&gt;&gt;<i>Added
</I>&gt;&gt;<i>special icons to PlatformDefaultHandler.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Mime.cs: Removed code that assumed it is used on Windows.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Korn&#233;l
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014884.html">[Mono-dev] [PATCH] Win32 Shell Icons in MWF with high level	systemicon abstraction layer in XplatUI
</A></li>
	<LI>Next message: <A HREF="014885.html">[Mono-dev] porting tool
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14889">[ date ]</a>
              <a href="thread.html#14889">[ thread ]</a>
              <a href="subject.html#14889">[ subject ]</a>
              <a href="author.html#14889">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
