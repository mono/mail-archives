<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] TimeZone/RegionInfo patches
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20TimeZone/RegionInfo%20patches&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014806.html">
   <LINK REL="Next"  HREF="014851.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] TimeZone/RegionInfo patches</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20TimeZone/RegionInfo%20patches&In-Reply-To="
       TITLE="[Mono-dev] TimeZone/RegionInfo patches">kornelpal at hotmail.com
       </A><BR>
    <I>Tue Sep 20 05:02:17 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014806.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
        <LI>Next message: <A HREF="014851.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14847">[ date ]</a>
              <a href="thread.html#14847">[ thread ]</a>
              <a href="subject.html#14847">[ subject ]</a>
              <a href="author.html#14847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

&gt;<i> 2) TZ environment variable support on Win32. If TZ environment
</I>&gt;<i> variable is set, then it uses posix-compat timezone names
</I>&gt;<i> (its behavior depends on mingw though).
</I>
I don't think that this is a good idea. Time zone is used to convert local
time to UTC so if TZ contains a time zone other than that Windows uses you
will assume wrong offset of local time and will get a wrong UTC value.

I have never used mingw but using TZ environment variable should be done
only if mingw provides local time converted to TZ offset using it's own
runtime functions instead of a local time based on the Windows time zone
offset.

&gt;<i> 3) tiny change on RegionInfo.CurrentRegion to construct
</I>&gt;<i> apart from CultureInfo. In fact I have further patch to store
</I>&gt;<i> it inside Thread (as once Kornel suggested) but it is not
</I>&gt;<i> working perfectly now, so I just extracted minimal working part.
</I>&gt;<i> (This looks like independent but it shares a function with 1).
</I>
I never suggested to store current region inside Thread.:) Current region
should be stored in a static field of RegionInfo and should be initialized
when CurrentRegion is called for the first time and it should be the same
inside the entire AppDomain until CultureInfo.ClearCachedData() is called
that clear cached data that will be reinitialized when next time
CurrentRegion is called.

On Windows CurrentRegion and CurrentCulture sould be initialized based on
the value of GetUserDefaultLCID as it may change without restart.
CurrentUICulture should be initialized based on GetUserDefaultUILanguage.
But after their singleton instance was created on the first query they
should not be modified. On Posix some functionally equivalent value should
be used.

For more information:
<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/2005-August/014128.html">http://lists.ximian.com/pipermail/mono-devel-list/2005-August/014128.html</A>

4) And I think parsing locale name in get_current_locale_id is not required
at least on Windows as it returns current locale as an LCID that currently
is converted to a name then it is coverted back to and LCID.

The functionality of the other parts looks OK to me.

Korn&#233;l

----- Original Message -----
From: &quot;Atsushi Eno&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">atsushi at ximian.com</A>&gt;
To: &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Friday, September 16, 2005 7:30 AM
Subject: [Mono-dev] TimeZone/RegionInfo patches


&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I made a set of patches for a few globalization related stuff.
</I>&gt;<i>
</I>&gt;<i> 1) native TimeZone name support. Now it returns native names
</I>&gt;<i> as long as they are provided by the locale-builder.
</I>&gt;<i>
</I>&gt;<i> Am also planning to update locale data to the latest version
</I>&gt;<i> of CLDR (it has much more timezone names than existing one).
</I>&gt;<i>
</I>&gt;<i> 2) TZ environment variable support on Win32. If TZ environment
</I>&gt;<i> variable is set, then it uses posix-compat timezone names
</I>&gt;<i> (its behavior depends on mingw though).
</I>&gt;<i>
</I>&gt;<i> 3) tiny change on RegionInfo.CurrentRegion to construct
</I>&gt;<i> apart from CultureInfo. In fact I have further patch to store
</I>&gt;<i> it inside Thread (as once Kornel suggested) but it is not
</I>&gt;<i> working perfectly now, so I just extracted minimal working part.
</I>&gt;<i> (This looks like independent but it shares a function with 1).
</I>&gt;<i>
</I>&gt;<i> Comments are welcome :-)
</I>&gt;<i>
</I>&gt;<i> Atsushi Eno
</I>&gt;<i>
</I>&gt;<i>
</I>

--------------------------------------------------------------------------------


&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014806.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
	<LI>Next message: <A HREF="014851.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14847">[ date ]</a>
              <a href="thread.html#14847">[ thread ]</a>
              <a href="subject.html#14847">[ subject ]</a>
              <a href="author.html#14847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
