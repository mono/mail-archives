<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] TimeZone/RegionInfo patches
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20TimeZone/RegionInfo%20patches&In-Reply-To=BAY22-DAV3BB6B8C6AEEF2B7E20419A3950%40phx.gbl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014847.html">
   <LINK REL="Next"  HREF="014871.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] TimeZone/RegionInfo patches</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20TimeZone/RegionInfo%20patches&In-Reply-To=BAY22-DAV3BB6B8C6AEEF2B7E20419A3950%40phx.gbl"
       TITLE="[Mono-dev] TimeZone/RegionInfo patches">atsushi at ximian.com
       </A><BR>
    <I>Tue Sep 20 07:32:23 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014847.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
        <LI>Next message: <A HREF="014871.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14851">[ date ]</a>
              <a href="thread.html#14851">[ thread ]</a>
              <a href="subject.html#14851">[ subject ]</a>
              <a href="author.html#14851">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

&gt;&gt;<i> 2) TZ environment variable support on Win32. If TZ environment
</I>&gt;&gt;<i> variable is set, then it uses posix-compat timezone names
</I>&gt;&gt;<i> (its behavior depends on mingw though).
</I>&gt;<i> 
</I>&gt;<i> I don't think that this is a good idea. Time zone is used to convert local
</I>&gt;<i> time to UTC so if TZ contains a time zone other than that Windows uses you
</I>&gt;<i> will assume wrong offset of local time and will get a wrong UTC value.
</I>&gt;<i> 
</I>&gt;<i> I have never used mingw but using TZ environment variable should be done
</I>&gt;<i> only if mingw provides local time converted to TZ offset using it's own
</I>&gt;<i> runtime functions instead of a local time based on the Windows time zone
</I>&gt;<i> offset.
</I>
Mingw does provide TZ environment based timezone support, though
it is not good as we see today's Linux boxes (it does not support
e.g. &quot;Asia/Tokyo&quot;, only &quot;JST&quot;). Mingw also seems using Windows
API if TZ settings are not avaiable, but it is precise POSIX
behavior (in such case default timezone is dependent on the system).

As I said, it is done &quot;if TZ environment variable is set&quot; and
otherwise it keeps using Windows API. TZ is not used by Windows.

However, if people can still debug TimeZone related things easily
without this mode, then it is OK for me.

&gt;&gt;<i> 3) tiny change on RegionInfo.CurrentRegion to construct
</I>&gt;&gt;<i> apart from CultureInfo. In fact I have further patch to store
</I>&gt;&gt;<i> it inside Thread (as once Kornel suggested) but it is not
</I>&gt;&gt;<i> working perfectly now, so I just extracted minimal working part.
</I>&gt;&gt;<i> (This looks like independent but it shares a function with 1).
</I>&gt;<i> 
</I>&gt;<i> I never suggested to store current region inside Thread.:) Current region
</I>&gt;<i> should be stored in a static field of RegionInfo and should be initialized
</I>&gt;<i> when CurrentRegion is called for the first time and it should be the same
</I>&gt;<i> inside the entire AppDomain until CultureInfo.ClearCachedData() is called
</I>&gt;<i> that clear cached data that will be reinitialized when next time
</I>&gt;<i> CurrentRegion is called.
</I>
Oh X-)

Well, then now I don't think we don't need any changes from the
existing RegioinInfo code at all. Current code uses static field to
store CurrentRegion, using the initial culture LCID which is
retrieved via Windows API (and nothing to do with *Current*Culture) .

If there is a proof of code that existing one is incorrect, then
I'd fix it.

&gt;<i> 4) And I think parsing locale name in get_current_locale_id is not required
</I>&gt;<i> at least on Windows as it returns current locale as an LCID that currently
</I>&gt;<i> is converted to a name then it is coverted back to and LCID.
</I>
Agreed. I added a tiny switch for PLATFORM_WIN32 in that function.

Atsushi Eno


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014847.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
	<LI>Next message: <A HREF="014871.html">[Mono-dev] TimeZone/RegionInfo patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14851">[ date ]</a>
              <a href="thread.html#14851">[ thread ]</a>
              <a href="subject.html#14851">[ subject ]</a>
              <a href="author.html#14851">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
