<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Bug in mono 3.0.1 MVC3 File/FileResult
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Bug%20in%20mono%203.0.1%20MVC3%20File/FileResult&In-Reply-To=%3C1360251084.28143.140661188143689.4A84D86D%40webmail.messagingengine.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040149.html">
   <LINK REL="Next"  HREF="040154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Bug in mono 3.0.1 MVC3 File/FileResult</H1>
    <B>SirNoSkill</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Bug%20in%20mono%203.0.1%20MVC3%20File/FileResult&In-Reply-To=%3C1360251084.28143.140661188143689.4A84D86D%40webmail.messagingengine.com%3E"
       TITLE="[Mono-dev] Bug in mono 3.0.1 MVC3 File/FileResult">quandary82 at hailmail.net
       </A><BR>
    <I>Thu Feb  7 15:31:24 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040149.html">[Mono-dev] Bug in mono 3.0.1 MVC3 File/FileResult
</A></li>
        <LI>Next message: <A HREF="040154.html">[Mono-dev] Bug in mono 3.0.1 MVC3 File/FileResult
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40150">[ date ]</a>
              <a href="thread.html#40150">[ thread ]</a>
              <a href="subject.html#40150">[ subject ]</a>
              <a href="author.html#40150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,



I've forwarded the error to the nginx mailing list.



<A HREF="http://forum.nginx.org/read.php?2,235985,235988#msg-235988">http://forum.nginx.org/read.php?2,235985,235988#msg-235988</A>



The response I got:

It's bad idea to use &quot;Transfer-Encoding&quot; while working via CGI and

derived protocols like FastCGI. Quote from RFC 3875,

[1]<A HREF="http://tools.ietf.org/html/rfc3875#section-6.3.4:">http://tools.ietf.org/html/rfc3875#section-6.3.4:</A>



The script MUST NOT return any header fields that relate to

client-side communication issues and could affect the server's

ability to send the response to the client.



As you are talking to nginx via FastCGI, not HTTP, it won't try to

dig into content returned and decode it according to any

Transfer-Encoding. Instead, the &quot;Transfer-Encoding&quot; header

returned will be just dropped by nginx as per RFC 3875.













On Sat, Feb 2, 2013, at 09:00 PM, SirNoSkill wrote:

I have more details on the bug.

The extra bytes that are at the beginning

31 39 36 62 36 38 0D 0A

which reads 196b68/r/n in ASCII

196b68 is the filesize of the original image in hex...



All details + hexdump links added here:

[2]<A HREF="http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-e">http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-e</A>
xtra-bytes-at-the-beginning-of-image







All traffic to that URL [[3]www.daniel-steiger.ch] (except for the
folders /doc and /images), but including images in /Content, is
directly forwarded to fastcgi by nginx, as per fastcgi config file for
domain.





 server {

         listen   80;

         server_name [4]www.daniel-steiger.ch daniel-steiger.ch;

         access_log   /var/log/nginx/daniel-steiger.ch.access.log;



         location / {

                 root /home/danillo/www/HomePage;

                 #index index.html index.htm default.aspx Default.aspx;

                 #fastcgi_index Default.aspx;

                 fastcgi_pass 127.0.0.1:9000;

                 include /etc/nginx/fastcgi_params;

         }





location /doc {

root /usr/share;

autoindex on;

allow 127.0.0.1;

deny all;

}



location /images {

root /usr/share;

autoindex off;

}



#error_page 404 /404.html;



# redirect server error pages to the static page /50x.html

#

error_page 500 501 503 504 /50x.html;

location = /50x.html {

root /home/danillo/www/HomePage;

}





error_page 502 /502.html;

location = /502.html {

root /home/danillo/www/HomePage;

}



}





It's sufficient to have the file served without FileResult.

Of course it's more efficient if nginx serves it directly, but this is
a very low traffic website, so performance is really not my problem ;)



And by the way, the problem is not finding a workaround.

I have already fixed it with a workaround about a week ago.

I really just want to know where the bug is, because if FileResult
malfunctions, there's probably more to it, and I don't want to walk
into a subtle not at the first sight spottable bug later, like a
botched binary upload/download file.











On Sat, Feb 2, 2013, at 06:51 AM, Daniel Lo Nigro wrote:

Hmm... Maybe try an X-Accel-Redirect header instead. This lets Nginx
serve the file instead of Mono having to serve it, which makes it more
efficient. See if that makes a difference, or if it has the same issue.

Why not just link directly to the file, instead of serving it through
your C# code?



On Sun, Feb 3, 2013 at 1:43 AM, quandary82 &lt;[5]<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">quandary82 at hailmail.net</A>&gt;
wrote:

Corrected the mime, but seems to be a mono-bug (or fastcgi) anyway.



More here:

[6]<A HREF="http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-e">http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-e</A>
xtra-bytes-at-the-beginning-of-image







--

View this message in context:
[7]<A HREF="http://mono.1490590.n4.nabble.com/Bug-in-mono-3-0-1-MVC3-File-FileRe">http://mono.1490590.n4.nabble.com/Bug-in-mono-3-0-1-MVC3-File-FileRe</A>
sult-tp4658382p4658422.html

Sent from the Mono - Dev mailing list archive at Nabble.com.

_______________________________________________
Mono-devel-list mailing list
[8]<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
[9]<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>



--

SirNoSkill

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">quandary82 at hailmail.net</A>

--
<A HREF="http://www.fastmail.fm">http://www.fastmail.fm</A> - mmm... Fastmail...



--

SirNoSkill

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">quandary82 at hailmail.net</A>

References

1. <A HREF="http://tools.ietf.org/html/rfc3875#section-6.3.4">http://tools.ietf.org/html/rfc3875#section-6.3.4</A>
2. <A HREF="http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-extra-bytes-at-the-beginning-of-image">http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-extra-bytes-at-the-beginning-of-image</A>
3. <A HREF="http://www.daniel-steiger.ch/">http://www.daniel-steiger.ch/</A>
4. <A HREF="http://www.daniel-steiger.ch/">http://www.daniel-steiger.ch/</A>
5. mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">quandary82 at hailmail.net</A>
6. <A HREF="http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-extra-bytes-at-the-beginning-of-image">http://stackoverflow.com/questions/14662795/why-do-i-have-unwanted-extra-bytes-at-the-beginning-of-image</A>
7. <A HREF="http://mono.1490590.n4.nabble.com/Bug-in-mono-3-0-1-MVC3-File-FileResult-tp4658382p4658422.html">http://mono.1490590.n4.nabble.com/Bug-in-mono-3-0-1-MVC3-File-FileResult-tp4658382p4658422.html</A>
8. mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
9. <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>

-- 
<A HREF="http://www.fastmail.fm">http://www.fastmail.fm</A> - IMAP accessible web-mail

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130207/f7805f20/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130207/f7805f20/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040149.html">[Mono-dev] Bug in mono 3.0.1 MVC3 File/FileResult
</A></li>
	<LI>Next message: <A HREF="040154.html">[Mono-dev] Bug in mono 3.0.1 MVC3 File/FileResult
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40150">[ date ]</a>
              <a href="thread.html#40150">[ thread ]</a>
              <a href="subject.html#40150">[ subject ]</a>
              <a href="author.html#40150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
