<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] ARM/NativeClient port
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ARM/NativeClient%20port&In-Reply-To=%3CCAAR%2BGz1V-nir0KyK_%3DxYip9nhX%3Dpb%2B3q72%3D6S-_cM5o1-QBgMw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040119.html">
   <LINK REL="Next"  HREF="040134.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] ARM/NativeClient port</H1>
    <B>Nikolay Igotti</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20ARM/NativeClient%20port&In-Reply-To=%3CCAAR%2BGz1V-nir0KyK_%3DxYip9nhX%3Dpb%2B3q72%3D6S-_cM5o1-QBgMw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] ARM/NativeClient port">olonho at google.com
       </A><BR>
    <I>Mon Feb  4 09:34:19 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040119.html">[Mono-dev] ARM/NativeClient port
</A></li>
        <LI>Next message: <A HREF="040134.html">[Mono-dev] ARM/NativeClient port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40125">[ date ]</a>
              <a href="thread.html#40125">[ thread ]</a>
              <a href="subject.html#40125">[ subject ]</a>
              <a href="author.html#40125">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>   Hi Zoltan,

 For PC-relative addressing at least 2 conditions has to be satisfied:
 1. code must know which PC it runs at
 2. offset to data must be smaller than 4K to fit into immediate encoding

If we're not using inline constant pools, it would lead to rather tricky
memory layout of code
interleaved with data.

  Nikolay


On Sun, Feb 3, 2013 at 10:09 PM, Zoltan Varga &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">vargaz at gmail.com</A>&gt; wrote:

&gt;<i> &gt;  Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  We're working on implementation of Mono JIT/ARM for Native Client, and
</I>&gt;<i> want to discuss certain details about design of our solution.
</I>&gt;<i> &gt;  Native Client's sandboxing mechanism, being a SFI solution, has rather
</I>&gt;<i> strict  limitations on how verifiable machine code may look like. To be
</I>&gt;<i> precise:
</I>&gt;<i>
</I>&gt;<i> &gt;  Our idea is to emit per-method (or per class?) &quot;jump table&quot; somewhere
</I>&gt;<i> in .data, which contains list of all relocations, and use some register to
</I>&gt;<i> point to this table.
</I>&gt;<i> &gt; So for example, trampoline like this:
</I>&gt;<i> &gt;        ldr ip, [pc, #0]
</I>&gt;<i> &gt; b skip
</I>&gt;<i> &gt;        .word target
</I>&gt;<i> &gt;      skip:
</I>&gt;<i> &gt; mov lr, pc
</I>&gt;<i> &gt; mov pc, ip
</I>&gt;<i> &gt; would become (if r10 is used as jump table base register):
</I>&gt;<i> &gt;      .align 4 # for NaCl only
</I>&gt;<i> &gt;         ldr ip, [r10, #32] # unique (per-method or class) index for
</I>&gt;<i> every callsite
</I>&gt;<i> &gt;         nop  # for NaCl only, to have bl at bundle end
</I>&gt;<i> &gt;         bic r10, r10, #0xc000000f # for NaCl only
</I>&gt;<i> &gt;         bl ip # or blx
</I>&gt;<i> &gt;  r10 could point somewhere in method metadata, where its relocation
</I>&gt;<i> table is stored.
</I>&gt;<i>
</I>&gt;<i> &gt; So our question is if someone sees problem with such approach, or could
</I>&gt;<i> suggest better alternative. Also advises which register could be used as
</I>&gt;<i> the jump table base, and where &gt; to store
</I>&gt;<i> &gt; such a table (maybe patch info?) are very welcome.
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> ARM has PC relative addressing, so it would be easier to use that instead
</I>&gt;<i> of reserving a register.
</I>&gt;<i>
</I>&gt;<i>                  Zoltan
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130204/fe615c2a/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130204/fe615c2a/attachment.html</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040119.html">[Mono-dev] ARM/NativeClient port
</A></li>
	<LI>Next message: <A HREF="040134.html">[Mono-dev] ARM/NativeClient port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40125">[ date ]</a>
              <a href="thread.html#40125">[ thread ]</a>
              <a href="subject.html#40125">[ subject ]</a>
              <a href="author.html#40125">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
