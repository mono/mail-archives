<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Bug in Assembly.Load: overriding assembly location
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Bug%20in%20Assembly.Load%3A%20overriding%20assembly%20location&In-Reply-To=%3CCAAWtsQwCa9GTGzTZPcZ8PyhvK7zdi5_teHZ8VWJ1OXnb9SbLTQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040168.html">
   <LINK REL="Next"  HREF="040174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Bug in Assembly.Load: overriding assembly location</H1>
    <B>Robin Neatherway</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Bug%20in%20Assembly.Load%3A%20overriding%20assembly%20location&In-Reply-To=%3CCAAWtsQwCa9GTGzTZPcZ8PyhvK7zdi5_teHZ8VWJ1OXnb9SbLTQ%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Bug in Assembly.Load: overriding assembly location">robin.neatherway at gmail.com
       </A><BR>
    <I>Wed Feb 13 10:59:51 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040168.html">[Mono-dev] Cross-compilation on OS X host to Windows target
</A></li>
        <LI>Next message: <A HREF="040174.html">[Mono-dev] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40171">[ date ]</a>
              <a href="thread.html#40171">[ thread ]</a>
              <a href="subject.html#40171">[ subject ]</a>
              <a href="author.html#40171">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have found a mismatch in behaviour between mono and .NET

Mono version: Mono JIT compiler version 3.0.4 (master/e5fba9d Wed Jan 30
18:38:48 GMT 2013)
.NET version: 4.5 from VS2012

Running the simple program below which reads mscorlib.dll into memory and
then loads in with Assembly.Load causes Mono to afterwards return the
location of mscorlib as the empty string. On .NET the original location of
mscorlib is returned.


Program:

open System.Reflection
open System

[&lt;EntryPoint&gt;]
let main args =
  let asmBytes =
System.IO.File.ReadAllBytes(&quot;/home/scratch/local_mono/lib/mono/4.5/mscorlib.dll&quot;)
  printfn &quot;Location of mscorlib: '%s'&quot;
(typeof&lt;System.Object&gt;.Assembly.Location)
  let assm = Assembly.Load(asmBytes)
  printfn &quot;Location of mscorlib: '%s'&quot;
(typeof&lt;System.Object&gt;.Assembly.Location)
  0

Output:

Location of mscorlib: '/home/scratch/local_mono/lib/mono/4.5/mscorlib.dll'
Location of mscorlib: ''

On Windows I change ReadAllBytes to load
from @&quot;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorlib.dll&quot;, and
the output is:

Location of mscorlib:
'C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorlib.
dll'
Location of mscorlib:
'C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorlib.
dll'


This causes problems if you try to do this during xbuild because some tasks
(in my case the Fsc task) try to find the mono location and call into
MonoLocationHelper.cs:47 which is below:

assemblyLocation = Path.GetDirectoryName (typeof
(object).Assembly.Location);

This line then returns the empty string and everything goes wrong from
there.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130213/2af9eecd/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20130213/2af9eecd/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040168.html">[Mono-dev] Cross-compilation on OS X host to Windows target
</A></li>
	<LI>Next message: <A HREF="040174.html">[Mono-dev] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40171">[ date ]</a>
              <a href="thread.html#40171">[ thread ]</a>
              <a href="subject.html#40171">[ subject ]</a>
              <a href="author.html#40171">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
