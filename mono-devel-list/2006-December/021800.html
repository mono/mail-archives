<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Incorrect cultured SatelliteAssembly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Incorrect%20cultured%20SatelliteAssembly&In-Reply-To=e12cf8660612180523y36e4e07fna317056785778588%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021806.html">
   <LINK REL="Next"  HREF="021801.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Incorrect cultured SatelliteAssembly</H1>
    <B>Armand du Plessis</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Incorrect%20cultured%20SatelliteAssembly&In-Reply-To=e12cf8660612180523y36e4e07fna317056785778588%40mail.gmail.com"
       TITLE="[Mono-dev] Incorrect cultured SatelliteAssembly">armand at dotnet.org.za
       </A><BR>
    <I>Mon Dec 18 08:28:57 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021806.html">[Mono-dev] ASP.NET MySql connection
</A></li>
        <LI>Next message: <A HREF="021801.html">[Mono-dev] Incorrect cultured SatelliteAssembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21800">[ date ]</a>
              <a href="thread.html#21800">[ thread ]</a>
              <a href="subject.html#21800">[ subject ]</a>
              <a href="author.html#21800">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Came across a small problem when loading satellite assemblies for a
specific Assembly.

&gt;<i>From MSDN Assembly.GetSatelliteAssembly should throw
</I>System.IO.FileLoadException when the satellite assembly is found but
the culture don't match ie. If U.S. English (en-us) satellite assembly
is requested but culture &quot;English&quot; is found in the expected location
(/en-us) then FileLoadException should be thrown instead of returning
found assembly with incorrect culture.

I've attached a test case for above mentioned scenario and a possible
patch, however the patch will still causes the incorrect assembly to
be loaded into the AppDomain which is different from behavior on
Microsoft who don't load the assembly if the culture is incorrect. I
assume a better place for this check would be in the LoadAssembly
internal call?

Regards,

Armand

PS. The attached test case is zipped as it contains embedded mock
assemblies which bloats the test file quite a bit.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: AssemblyTestFixture.zip
Type: application/zip
Size: 11826 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20061218/cc9152c6/attachment.zip">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20061218/cc9152c6/attachment.zip</A> 
-------------- next part --------------
Index: Assembly.cs
===================================================================
--- Assembly.cs	(revision 69656)
+++ Assembly.cs	(working copy)
@@ -422,7 +422,14 @@
 
 			aname.CultureInfo = culture;
 			aname.Name = aname.Name + &quot;.resources&quot;;
-			return Load (aname);
+			
+            Assembly satellite = Load (aname);            
+            AssemblyName satelliteName = satellite.GetName();
+            
+            if (satelliteName.CultureInfo == culture)
+                return satellite;
+
+            throw new FileLoadException(&quot;Satellite assembly with matching name found, culture did not match the one specified&quot;);
 		}
 		
 		[MethodImplAttribute (MethodImplOptions.InternalCall)]
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021806.html">[Mono-dev] ASP.NET MySql connection
</A></li>
	<LI>Next message: <A HREF="021801.html">[Mono-dev] Incorrect cultured SatelliteAssembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21800">[ date ]</a>
              <a href="thread.html#21800">[ thread ]</a>
              <a href="subject.html#21800">[ subject ]</a>
              <a href="author.html#21800">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
