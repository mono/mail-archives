<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Inconsistent HResult setting in two BCL Exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Inconsistent%20HResult%20setting%20in%20two%20BCL%20Exceptions&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021816.html">
   <LINK REL="Next"  HREF="021820.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Inconsistent HResult setting in two BCL Exceptions</H1>
    <B>Andy Hume</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Inconsistent%20HResult%20setting%20in%20two%20BCL%20Exceptions&In-Reply-To="
       TITLE="[Mono-dev] Inconsistent HResult setting in two BCL Exceptions">andyhume32 at yahoo.co.uk
       </A><BR>
    <I>Tue Dec 19 05:03:37 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021816.html">[Mono-dev] [PATCH] Add --remote-mode to monodoc browser
</A></li>
        <LI>Next message: <A HREF="021820.html">[Mono-dev] ObjectDisposedException etc lacks #ctor(String,	Exception)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21817">[ date ]</a>
              <a href="thread.html#21817">[ thread ]</a>
              <a href="subject.html#21817">[ subject ]</a>
              <a href="author.html#21817">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In doing some work to check what Exception constructors are missing I noted that the HResult value is set manually in each constructor, and wondered if it was set correctly in each constructor in each exception type.

I produced the attached program to check this.  It shows two cases in Corlib:

* System.ArgumentNullException
Inconsistent HResult, was 80004003, now 80070057.
    (Params: {String message, Exception innerException})

* System.NotFiniteNumberException
Inconsistent HResult, was 80070216, now 80131528.
    (Params: {Double offendingNumber})
Inconsistent HResult, was 80070216, now 80131528.
    (Params: {String message})
Inconsistent HResult, was 80070216, now 80131528.
    (Params: {String message, Double offendingNumber})
Inconsistent HResult, was 80070216, now 80131528.
    (Params: {String message, Double offendingNumber, Exception innerException})

These are simply fixed by copying to &quot;public ArgumentNullException (string message, Exception innerException)&quot; the respective line from a neighbour constructor, and similarly to &quot;public NotFiniteNumberException ()&quot;, in fact in both cases the line is
			HResult = Result;

(I wonder if there's some better pattern that can be used so that the explict setting is not required...?)


In System.dll there is one false positive, Win32Exception which reads the HResult value from Marshal.GetLastWin32Error(), so depends on the state of the environment.  I attempted to solve this by P/Invoking something that will always fail.  However there is apparently something else failing with error code 0x80131501 in the Mono environment.


Which other of the assemblies should this be called on?
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: MonoBug05bExceptionHresultConsistency.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20061219/41c83089/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20061219/41c83089/attachment.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021816.html">[Mono-dev] [PATCH] Add --remote-mode to monodoc browser
</A></li>
	<LI>Next message: <A HREF="021820.html">[Mono-dev] ObjectDisposedException etc lacks #ctor(String,	Exception)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21817">[ date ]</a>
              <a href="thread.html#21817">[ thread ]</a>
              <a href="subject.html#21817">[ subject ]</a>
              <a href="author.html#21817">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
