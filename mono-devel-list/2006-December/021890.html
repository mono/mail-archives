<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev]  Re: Cross Compiling Mono For ARM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20Re%3A%20Cross%20Compiling%20Mono%20For%20ARM&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021885.html">
   <LINK REL="Next"  HREF="021889.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev]  Re: Cross Compiling Mono For ARM</H1>
    <B>Buchegger Hanspeter</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%20Re%3A%20Cross%20Compiling%20Mono%20For%20ARM&In-Reply-To="
       TITLE="[Mono-dev]  Re: Cross Compiling Mono For ARM">hanspeter.buchegger at leister.com
       </A><BR>
    <I>Thu Dec 21 12:13:37 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021885.html">[Mono-dev] api-diff/api-info problems
</A></li>
        <LI>Next message: <A HREF="021889.html">[Mono-dev] Extending C# compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21890">[ date ]</a>
              <a href="thread.html#21890">[ thread ]</a>
              <a href="subject.html#21890">[ subject ]</a>
              <a href="author.html#21890">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I&#8217;m trying to use mono for an embedded system with a Cirrus ARM9 processor, running Linux 2.4.

Here is a short description of my experience. Maybe it helps other users and/or maybe there is some advice for me to get it fixed.

The packages used are:
- mono-1.2.1
- glib-2.12.4
- cross-compiler gcc-3.3.2 (compiler has a prefix of 'arm-unknown-linux-gnu')

First, I had to cross- compile the Glib (from the GTK- project), mono depends on it.
I&#8217;ve done this on a cygwin- installation under windows (no, I'm not a Windows-fan and would prefer to have a Linux- box to do this :-)), so maybe under Linux it might be different. I used the following configure:

configure &#8211;host=arm-unknown-linux-gnu &#8211;cache-file=arm_cross.cache &#8211;prefix=/usr/local

The cache- file is needed due to the fact that configure can&#8217;t compile/run test-code while cross- compiling. So we have to set all variables which afford test-runs manually. I&#8217;ve found the symbols on the GTK- project- website.
My cache- file (named arm_cross.cache, see above):

glib_cv_long_long_format=ll
glib_cv_stack_grows=no
glib_cv_sane_realloc=yes
glib_cv_have_strlcpy=no
glib_cv_va_val_copy=yes
glib_cv_rtldglobal_broken=no
glib_cv_uscore=no
glib_cv_monotonic_clock=no
ac_cv_func_nonposix_getpwuid_r=no
ac_cv_func_posix_getpwuid_r=yes
glib_cv_use_pid_surrogate=yes
ac_cv_func_printf_unix98=no
ac_cv_func_vsnprintf_c99=yes

Ok, now I started &#8216;make&#8217;, then I ran into problems with &#8216;global_symbol_pipe&#8217;, configure stopped somewhere in libtool with a syntax- error. The problem is based on the failure of configure to set the variable &#8216;global_symbol_pipe&#8217;. To avoid further stops I put the following line directly into &#8216;libtool&#8217;:

global_symbol_pipe=&quot;sed -n -e 's/^.*[   ]\\([ABCDGIRSTW][ABCDGIRSTW]*\\)[       ][      ]*\\(\\)\\([_A-Za-z][_A-Za-z0-9]*\\)\$/\\1\\2\\3 \\3/p'&quot;

I got this from another package, I don&#8217;t understand exactly, what it does (I have some personal troubles with regExp&#8217;s in general :-) ), but it worked. My first attempt to ignore the 'global_symbol_pipe' by simply putting &#8216;cat&#8217; into it, wasn&#8217;t working. The above regExp is used to filter output from the nm- tool. If it isn&#8217;t filtered correctly, the linker will stop with something like &#8216;syntax error in VERSION file&#8217;. 
Attention: put this in the &#8216;libtool&#8217;- file AFTER you&#8217;ve successfully run 'configure'. &#8216;libtool&#8217; is generated by configure, if you restart configure, a new &#8216;libtool&#8217;- file is generated and therefore your changes are lost. I don&#8217;t have the time to investigate the problem further; advice to fix it is desired.

&#8216;make&#8217; then terminated without problems. I ran &#8216;make install&#8217; to put the libs into the right place (in my case /usr/local/lib ...). But be careful: if you are working on a Linux- box, which might have the glib- /gtk- libraries installed to run GTK- based software (example: gimp), make sure you do not overwrite the native libs used to run it. The generated libs are native ARM- code and therefore do not run on a Linux- X86 box.

Next step: to cross-compile mono itself, but I got endless troubles, which are, in my opinion, related to the cygwin- environment. I&#8217;m doing another attempt on my Linux- box at home (Kernel 2.6.x, cross-gcc4.0.x) and it seems to work much better, glib compiled and installed with the above mentioned cache-file without any troubles. Still mono doesn&#8217;t compile without errors. If there is any interest in this, I can post my experiences.

So, now I have glib, but still no mono. To get around the problem, I got the Mono- package for the Nokia 770- device (from the mono- project- website). This is a debian- package, so I unpacked it (dpkg-deb  ) and installed the mono- binary and the mscorelib.dll manually. You also need librt-so.1 (librt-2.3.2.so) from the debian- ARM- package libc6 (package- names see below).

Nokia- package           : mono-nokia_1.1.13-1_arm.deb
Debian-ARM libc6- package: libc6_2.3.2.ds1-22sarge4_arm.deb (to extract librt-2.3.2.so)

And guess what? It works.... I was able to run some simple console- programs with mono on my EP93xx- based ARM. Windows-Forms will not work with my setup, but my platform doesn&#8217;t have any video- device and is used as an embedded controller, so I&#8217;m not interested in GUI&#8217;s. Maybe my complicated setup will work for my purposes; I have to do some tests to verify. 

Regards
hp.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021885.html">[Mono-dev] api-diff/api-info problems
</A></li>
	<LI>Next message: <A HREF="021889.html">[Mono-dev] Extending C# compiler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21890">[ date ]</a>
              <a href="thread.html#21890">[ thread ]</a>
              <a href="subject.html#21890">[ subject ]</a>
              <a href="author.html#21890">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
