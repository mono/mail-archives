<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Embedding Mono and HandleRef...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Embedding%20Mono%20and%20HandleRef...&In-Reply-To=45972D7A.3010601%40novell.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021965.html">
   <LINK REL="Next"  HREF="021964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Embedding Mono and HandleRef...</H1>
    <B>Robert Jordan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Embedding%20Mono%20and%20HandleRef...&In-Reply-To=45972D7A.3010601%40novell.com"
       TITLE="[Mono-dev] Embedding Mono and HandleRef...">robertj at gmx.net
       </A><BR>
    <I>Sun Dec 31 10:01:20 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021965.html">[Mono-dev] Embedding Mono and HandleRef...
</A></li>
        <LI>Next message: <A HREF="021964.html">[Mono-dev] Module constructor of external assembly not getting	called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21968">[ date ]</a>
              <a href="thread.html#21968">[ thread ]</a>
              <a href="subject.html#21968">[ subject ]</a>
              <a href="author.html#21968">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thomas Wiest wrote:
&gt;<i> Robert Jordan wrote:
</I>&gt;&gt;<i> You don't need HandleRefs when using icalls and the embedded API.
</I>&gt;&gt;<i> Just declare the icalls as non-static and they will automatically
</I>&gt;&gt;<i> get the MonoObject* pointer of the managed object:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Ah, very interesting. I assume this increases the ref count which 
</I>&gt;<i> assures that the object won't get collected until after the native code 
</I>&gt;<i> returns. Is that right?
</I>
It doesn't increase any ref count because Mono'n GC is not
based on ref counts.

The circumstance that you're able to call the icall at all,
means that the object is still alive, i.e. it's on the
current execution stack or stored in another object that is
still alive. During the icall itself the object is on the
stack (1) (it's the first argument of the icall), hence it can't
be GCed.

Since P/Invoke methods don't have the &quot;this&quot; parameter (they
are static), the object could be GCed during the p/invoke
call. That's why GCHandles and HandeRefs are needed.

(1) or in a processor register, but they are monitored
as well.

&gt;<i> Also, to pass the person struct IntPtr from C# to C, which is 
</I>&gt;<i> recommended; pass it as a parameter, or use mono_runtime_invoke to pull 
</I>&gt;<i> it out of the property? I would assume that passing it as a parameter is 
</I>&gt;<i> quicker since it saves a function call.
</I>
It is faster to pass it as a parameter.

Robert


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021965.html">[Mono-dev] Embedding Mono and HandleRef...
</A></li>
	<LI>Next message: <A HREF="021964.html">[Mono-dev] Module constructor of external assembly not getting	called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21968">[ date ]</a>
              <a href="thread.html#21968">[ thread ]</a>
              <a href="subject.html#21968">[ subject ]</a>
              <a href="author.html#21968">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
