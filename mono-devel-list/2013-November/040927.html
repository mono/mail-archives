<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Fix for using GTK# in mono embedded application
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Fix%20for%20using%20GTK%23%20in%20mono%20embedded%20application&In-Reply-To=%3CCAKxVXYKU7nvenL6Y34CB0vXiE-8AR3hYAwYfjhkRHguf%2BayHaw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040926.html">
   <LINK REL="Next"  HREF="040928.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Fix for using GTK# in mono embedded application</H1>
    <B>Vardar Sahin</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Fix%20for%20using%20GTK%23%20in%20mono%20embedded%20application&In-Reply-To=%3CCAKxVXYKU7nvenL6Y34CB0vXiE-8AR3hYAwYfjhkRHguf%2BayHaw%40mail.gmail.com%3E"
       TITLE="[Mono-dev] Fix for using GTK# in mono embedded application">sakirsoft at gmail.com
       </A><BR>
    <I>Sat Nov  2 21:10:32 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="040926.html">[Mono-dev] Fix for using GTK# in mono embedded application
</A></li>
        <LI>Next message: <A HREF="040928.html">[Mono-dev] Fix for using GTK# in mono embedded application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40927">[ date ]</a>
              <a href="thread.html#40927">[ thread ]</a>
              <a href="subject.html#40927">[ subject ]</a>
              <a href="author.html#40927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Andr&#233;s,

thanks for the quick replay. I am not sure if this will fix the problem. I
think the problem is that you can not call Environment.GetCommandLineArgs()
when you embed mono.
Environment.GetCommandLineArgs() is an internal call and it seems like it
is not registered when you embed mono.

Best
Sahin




2013/11/2 &quot;Andr&#233;s G. Aragoneses&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">knocte at gmail.com</A>&gt;

&gt;<i> On 02/11/13 21:42, Vardar Sahin wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hey monodev fellows,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> first of all I appreciate all your hard work and want to contribute this
</I>&gt;&gt;<i> to the mono project.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Right now it is not possible to use GTK# with an application which
</I>&gt;&gt;<i> embeds mono. GTK# works just fine if you use mono as a standalone
</I>&gt;&gt;<i> application eg mono.exe.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The reason why GTK# does not works when you embed mono is as fallowing.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Each GTK# Application has to call Application.Init().
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This functions is like this.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> public static void Init ()
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> SetPrgname ();
</I>&gt;&gt;<i> IntPtr argv = new IntPtr(0);
</I>&gt;&gt;<i> int argc = 0;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> gtk_init (ref argc, ref argv);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SynchronizationContext.SetSynchronizationContext (new
</I>&gt;&gt;<i> GLib.GLibSynchronizationContext ());}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Init will fail on SetPrgname (); when mono is embedded in an application.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> static void SetPrgname ()
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> GLib.Global.ProgramName = System.IO.Path.GetFileNameWithoutExtension
</I>&gt;&gt;<i> (Environment.GetCommandLineArgs () [0]);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When embedding Mono, Environment.GetCommandLineArgs () will fail because
</I>&gt;&gt;<i> it is not set to anything. When you run the same on mono as a standalone
</I>&gt;&gt;<i> application it will work because mono will pass the command line
</I>&gt;&gt;<i> argument via Environment.GetCommandLineArgs().
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I fixed it by registering the internal call for
</I>&gt;&gt;<i> Environment.GetCommandLineArgs to my own fucntion and return just a
</I>&gt;&gt;<i> dummy string.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My suggestion would be to do the same in mono when you embed it or to
</I>&gt;&gt;<i> change SetPrgname  to not relay on Environment.GetCommandLineArgs ().
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sahin, wouldn't this also fix your use case?
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://github.com/mono/gtk-sharp/pull/90/files">https://github.com/mono/gtk-sharp/pull/90/files</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131102/5cfd9d2f/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20131102/5cfd9d2f/attachment.html</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040926.html">[Mono-dev] Fix for using GTK# in mono embedded application
</A></li>
	<LI>Next message: <A HREF="040928.html">[Mono-dev] Fix for using GTK# in mono embedded application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40927">[ date ]</a>
              <a href="thread.html#40927">[ thread ]</a>
              <a href="subject.html#40927">[ subject ]</a>
              <a href="author.html#40927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
