<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [Mono-Dev]: Modifications to System.Web javascript	for J2EE portal support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BMono-Dev%5D%3A%20Modifications%20to%20System.Web%20javascript%0A%09for%20J2EE%20portal%20support&In-Reply-To=20070122194014.7c57200a%40beowulf">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022203.html">
   <LINK REL="Next"  HREF="022204.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [Mono-Dev]: Modifications to System.Web javascript	for J2EE portal support</H1>
    <B>Eyal Alaluf</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BMono-Dev%5D%3A%20Modifications%20to%20System.Web%20javascript%0A%09for%20J2EE%20portal%20support&In-Reply-To=20070122194014.7c57200a%40beowulf"
       TITLE="[Mono-dev] [Mono-Dev]: Modifications to System.Web javascript	for J2EE portal support">eyala at mainsoft.com
       </A><BR>
    <I>Thu Jan 25 09:35:11 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022203.html">[Mono-dev] [Mono-Dev]: Modifications to System.Web javascript for J2EE portal support
</A></li>
        <LI>Next message: <A HREF="022204.html">[Mono-dev] Preparing for the 1.2.3 release: tree and release notes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22234">[ date ]</a>
              <a href="thread.html#22234">[ thread ]</a>
              <a href="subject.html#22234">[ subject ]</a>
              <a href="author.html#22234">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Marek &amp; all.

Following up on our discussion attached a new patch with minimal changes
to JS API that goes according to the following guide lines
  1. Whenever possible use the ctrl hierarchy to find the form
containing the ctrl
  2. When the method is attached to the form (e.g. 
WebForm_SaveScrollPositionSubmit) use this as the form.
  3. When all else fails append a new parameter to the function. Pass
the form as this param. In the function if the param is not defined use
'theForm'. Thus we still support invoking the function as before.

Any comments are welcome.

Eyal.

-----Original Message-----
From: Marek Habersack [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">grendello at gmail.com</A>] 
Sent: 22 January 2007 20:40
To: Eyal Alaluf
Cc: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-Dev]: Modifications to System.Web javascript for J2EE
portal support

On Mon, 22 Jan 2007 09:17:40 -0800, &quot;Eyal Alaluf&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">eyala at mainsoft.com</A>&gt;
scribbled:

&gt;<i> Hi, Marek and everyone.
</I>Hello Eyal,

&gt;<i> Attached is a diff to improve support for J2EE portlets for the
</I>&gt;<i> TARGET_J2EE configuration. In order to keep the code paths common,
</I>most
&gt;<i> of the diff is not under '#if TARGET_j2EE'. Therefore I'd like you to
</I>&gt;<i> review and approve it before I can commit.
</I>&gt;<i> 
</I>&gt;<i> The main issue stems from the fact that portlets in J2EE render HTML
</I>&gt;<i> fragments and not the whole page. That is one page can contain several
</I>&gt;<i> portlets and therefore several ASP.Net pages. This breaks implicit
</I>code
&gt;<i> assumptions about uniqueness of global variables. The most important
</I>&gt;<i> example is the 'theForm' variable. For Portlet support one cannot
</I>assume
&gt;<i> that on the client side there is exactly one 'theForm' defined.
</I>&gt;<i> 
</I>&gt;<i> The changes common with Mono are:
</I>&gt;<i> 
</I>&gt;<i> *        An internal property called 'theForm' is added to
</I>&gt;<i> System.Web.UI.Page. Its value for TARGET_J2EE will be different for
</I>&gt;<i> every portlet.
</I>This is fine

&gt;<i> *        We pass the 'theForm' as a parameter to all the JavaScript
</I>&gt;<i> functions that use it directly.
</I>&gt;<i> 
</I>&gt;<i> a.    In cases of callback functions (like functions assigned to
</I>&gt;<i> window.onload) we create a function whose name depends upon the
</I>portlet
&gt;<i> namespace and that passes 'theForm' to the global JavaScript function.
</I>&gt;<i> 
</I>&gt;<i> *        We save a reference to 'theForm' within the tree view data
</I>&gt;<i> (also in details view and grid view data). This allows the JavaScript
</I>of
&gt;<i> these controls to pass the form to the 'WebForm_DoCallback' function.
</I>&gt;<i> 
</I>&gt;<i> It is important to note that before this change some key JavaScript
</I>&gt;<i> functions were compatible with MS JavaScript functions. After the
</I>change
&gt;<i> these methods have an extra parameter indicating the form. This means
</I>&gt;<i> that if someone used such a function from his JavaScript code then his
</I>&gt;<i> code will be broken. 
</I>&gt;<i> 
</I>&gt;<i> Do you think that being compatible with MS on JavaScript is an
</I>important
&gt;<i> feature? Unlike the C# API MS does not document these functions and
</I>even
&gt;<i> tries to abstract their existence in some of System.Web API (e.g. the
</I>&gt;<i> ClientScriptManager class).
</I>As for the above changes I personally would prefer that the JavaScript
code
remains compatible with MS as far as possible, even though the
documentation
doesn't exist for their JS API. The reason for this is that they may
start
documenting their JS API (the sign of this is the ajax.asp.net stuff,
which
does include documented JS API which, I imagine, would have to be
modified in
the above way when mono includes the implementation of MS AJAX). I think
there
is another way to work around the theForm problem in JS. I'm assuming
that
every portlet has its own identifier of some sort and that this
identifier
could be used to index a table of theForms from within the JS functions
that
need to access it. The array can be generated conditionally for
TARGET_J2EE
from C# code and its existence checked for inside the JS functions (you
could
also add a hidden field with a value specifying that the JS is running
under
mono compiled for TARGET_J2EE. That way all the J2EE specific changes
would be
hidden from the &quot;public&quot; API and the possible future compatibility would
be
preserved.

best regards,

marek
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Portal.jscript.diff
Type: application/octet-stream
Size: 17400 bytes
Desc: Portal.jscript.diff
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070125/c69ff756/attachment.obj">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070125/c69ff756/attachment.obj</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022203.html">[Mono-dev] [Mono-Dev]: Modifications to System.Web javascript for J2EE portal support
</A></li>
	<LI>Next message: <A HREF="022204.html">[Mono-dev] Preparing for the 1.2.3 release: tree and release notes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22234">[ date ]</a>
              <a href="thread.html#22234">[ thread ]</a>
              <a href="subject.html#22234">[ subject ]</a>
              <a href="author.html#22234">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
