<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] AssemblyLinker (AL) fixes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20AssemblyLinker%20%28AL%29%20fixes&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022137.html">
   <LINK REL="Next"  HREF="022139.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] AssemblyLinker (AL) fixes</H1>
    <B>Gert Driesen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20AssemblyLinker%20%28AL%29%20fixes&In-Reply-To="
       TITLE="[Mono-dev] [PATCH] AssemblyLinker (AL) fixes">gert.driesen at telenet.be
       </A><BR>
    <I>Sun Jan 14 15:44:54 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022137.html">[Mono-dev] [Bulk] Re: recharge.sh problems	(monocharge-20070111.tar.gz)
</A></li>
        <LI>Next message: <A HREF="022139.html">[Mono-dev] [PATCH] AssemblyLinker (AL) fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22136">[ date ]</a>
              <a href="thread.html#22136">[ thread ]</a>
              <a href="subject.html#22136">[ subject ]</a>
              <a href="author.html#22136">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've attached a patch for AssemblyLinker (al) which fixes several
issues, and improved compatibility with the MS AssemblyLinker.

* Al.cs: Use DelaySign enum to capture whether a delaysign (+ or -)
option was specified, and what value was set. This was necessary to
make a distinction between leaving the default value (possibly
obtained from a template assembly), and explicitly turned delay signing
off. Removed unused IsStrongName method. Added support for absolute
paths for modules on unix (borrowed from mcs). Previously absolute
paths where reportd as unrecognized command line options. Only add
AssemblyDelaySignAttribute, AssemblyKeyFileAttribute and
AssemblyKeyNameAttribute on 1.0 profile. Do not add an
AssemblyCultureAttribute if culture is specified, instead set the
culture on the AssemblyName. When template is not an absolute path,
then consider it to relative to the current directory. Removed unused
AddResource method. Do not require template to be strongly signed;
although MSDN states this, MS does not enforce this (and it should not).
Template option take a file name, not an assembly name. Fixed bug
#80440. When a template is set, use the keyfile specified in
AssemblyKeyFileAttribute of that template assembly to sign the 
assembly (unless overridden by /keyfile option). Same goes for
AssemblyDelaySignAttribute and AssemblyKeyNameAttribute. Fixes bug
#80472.

Besides the patch for AssemblyLinker, I've attached a gzipped tar
archive containing a full repro for the issues resolved in the patch.
Tested again Mono (1.0/2.0 profile), and MS .NET (1.1 and 2.0).

I had hoped to be able to provide a Makefile for it, but I had to resort
to a NAnt build file to &quot;drive it&quot;. I couldn't find a way to have a
single makefile that works for both Mono and MS, and that allows you to
check exit codes of the tools used in the Makefile. I'm sure it can be
done, I'm just not good at it.

Also, you need the fix for bug #80513 to allow the NAnt build file to
verify whether AL's delay signing indeed works. I could attached the fix
for that bug to that bug report (it's a trivial fix).

Let me know if it's ok to commit.

Gert
-------------- next part --------------
A non-text attachment was scrubbed...
Name: al.patch
Type: text/x-patch
Size: 21277 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070114/5a667e73/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070114/5a667e73/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tests.tar.gz
Type: application/x-compressed-tar
Size: 16820 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070114/5a667e73/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070114/5a667e73/attachment-0001.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022137.html">[Mono-dev] [Bulk] Re: recharge.sh problems	(monocharge-20070111.tar.gz)
</A></li>
	<LI>Next message: <A HREF="022139.html">[Mono-dev] [PATCH] AssemblyLinker (AL) fixes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22136">[ date ]</a>
              <a href="thread.html#22136">[ thread ]</a>
              <a href="subject.html#22136">[ subject ]</a>
              <a href="author.html#22136">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
