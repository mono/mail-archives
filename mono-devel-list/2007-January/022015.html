<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Allocating unmanaged memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Allocating%20unmanaged%20memory&In-Reply-To=enit04%24bnl%241%40sea.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022014.html">
   <LINK REL="Next"  HREF="022016.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Allocating unmanaged memory</H1>
    <B>Jon Chambers</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Allocating%20unmanaged%20memory&In-Reply-To=enit04%24bnl%241%40sea.gmane.org"
       TITLE="[Mono-dev] Allocating unmanaged memory">joncham at gmail.com
       </A><BR>
    <I>Thu Jan  4 07:59:26 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022014.html">[Mono-dev] Allocating unmanaged memory
</A></li>
        <LI>Next message: <A HREF="022016.html">[Mono-dev] Allocating unmanaged memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22015">[ date ]</a>
              <a href="thread.html#22015">[ thread ]</a>
              <a href="subject.html#22015">[ subject ]</a>
              <a href="author.html#22015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just a minor note, only recently has mono started using GlobalAlloc and
GlobalFree for the Marshal.*HGlobal routines on Windows. It was previously
using  g_free on all platforms. I think only the svn version currently has
this change, so I am not sure what will happen if you try to free the memory
on Windows using Marshal.FreeHGlobal with released versions of mono. You may
need to pinvoke GlobalFree yourself on windows to release the memory until
the next release of mono.

- Jonathan

On 1/4/07, Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Leszek Ciesielski wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I need to allocate unmanaged memory AND make sure it is filled with
</I>&gt;<i> &gt; 0's. Is there some clever/fast way to do this?  So far, I found only
</I>&gt;<i> &gt; Marshal.WriteByte, which sets one byte at a time.
</I>&gt;<i>
</I>&gt;<i> untested:
</I>&gt;<i>
</I>&gt;<i> public static IntPtr Alloc (int bytes)
</I>&gt;<i> {
</I>&gt;<i>         int p = (int) Environment.OSVersion.Platform;
</I>&gt;<i>          if ((p == 4) || (p == 128)) {
</I>&gt;<i>                 // unix
</I>&gt;<i>                 return calloc (bytes, 1);
</I>&gt;<i>         } else {
</I>&gt;<i>                 return GlobalAlloc (GMEM_ZEROINIT, bytes);
</I>&gt;<i>         }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> [DllImport(&quot;libc&quot;)]
</I>&gt;<i> static extern IntPtr calloc (int nmemb, int size);
</I>&gt;<i>
</I>&gt;<i> const int GMEM_ZEROINIT = 0x40;
</I>&gt;<i>
</I>&gt;<i> [DllImport(&quot;kernel32&quot;)]
</I>&gt;<i> static extern IntPtr GlobalAlloc (int flags, int bytes);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On both platforms the memory can be released with Marshal.FreeHGlobal.
</I>&gt;<i>
</I>&gt;<i> Robert
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070104/2138c72a/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20070104/2138c72a/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022014.html">[Mono-dev] Allocating unmanaged memory
</A></li>
	<LI>Next message: <A HREF="022016.html">[Mono-dev] Allocating unmanaged memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22015">[ date ]</a>
              <a href="thread.html#22015">[ thread ]</a>
              <a href="subject.html#22015">[ subject ]</a>
              <a href="author.html#22015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
