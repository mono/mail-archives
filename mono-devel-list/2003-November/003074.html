<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Patch for System.Text.RegularExpressions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20for%20System.Text.RegularExpressions&In-Reply-To=1069279983.3911.24.camel%40Cyprus">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003052.html">
   <LINK REL="Next"  HREF="003041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Patch for System.Text.RegularExpressions</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20for%20System.Text.RegularExpressions&In-Reply-To=1069279983.3911.24.camel%40Cyprus"
       TITLE="[Mono-devel-list] Patch for System.Text.RegularExpressions">lupus at ximian.com
       </A><BR>
    <I>Fri Nov 21 10:34:44 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003052.html">[Mono-devel-list] Patch for System.Text.RegularExpressions
</A></li>
        <LI>Next message: <A HREF="003041.html">[Mono-devel-list] Compiling from CVS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3074">[ date ]</a>
              <a href="thread.html#3074">[ thread ]</a>
              <a href="subject.html#3074">[ subject ]</a>
              <a href="author.html#3074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/19/03 Juraj Skripsky wrote:
&gt;<i> Attached is a patch for System.Text.RegularExpression.QuickSearch and a
</I>&gt;<i> new test case (which goes into
</I>&gt;<i> class/System/Test/System.Text.RegularExpressions).
</I>&gt;<i> 
</I>&gt;<i> This will also reduce memory consumption quite a bit when using regular
</I>&gt;<i> expressions.
</I>&gt;<i> 
</I>&gt;<i> * quicksearch.cs: Use hashtable instead of array (which should have had
</I>&gt;<i> size 0x10000 instead of 0x1000 in the first place) for shift table.
</I>
I posted a patch that addressed the same issue a while ago (included at
the end of the mail). It disables the boyer-moore algorithm completely,
because it really doesn't buy us anything. At the very least, it should
be used only when the search string is very large, but even in that case
we should do some measurements to see if it really is effective.
I saw miguel committed your patch, but the real fix is to not use the
QuickSearch class at all. That will fix both speed and memory
consumption issues. Care to remove the use of the class from
interpreter.cs and simply do a 'dumb' search as with the patch?

&gt;<i> * RegexTest.cs: New test case using a string containing a character &gt;
</I>&gt;<i> 0x1000.
</I>&gt;<i> 
</I>&gt;<i> Should I send future ChangeLog entries as diffs as well?
</I>
Yes, please also send ChangeLog entries.

Thanks.

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

Index: quicksearch.cs
===================================================================
RCS file: /cvs/public/mcs/class/System/System.Text.RegularExpressions/quicksearch.cs,v
retrieving revision 1.1
diff -u -p -r1.1 quicksearch.cs
--- quicksearch.cs	31 Jan 2002 08:00:16 -0000	1.1
+++ quicksearch.cs	7 Oct 2003 13:30:19 -0000
@@ -20,7 +20,7 @@ namespace System.Text.RegularExpressions
 			this.len = str.Length;
 			this.ignore = ignore;
 		
-			Setup ();
+			//Setup ();
 		}
 		
 		public string String {
@@ -38,7 +38,7 @@ namespace System.Text.RegularExpressions
 		public int Search (string text, int start, int end) {
 			if (end &gt; text.Length - len)
 				end = text.Length - len;
-		
+	
 			int ptr = start;
 			if (!ignore) {
 				while (ptr &lt;= end) {
@@ -49,7 +49,7 @@ namespace System.Text.RegularExpressions
 					}
 
 					if (ptr &lt; end)
-						ptr += shift[text[ptr + len]];
+						ptr++;
 					else
 						break;
 				}
@@ -66,7 +66,7 @@ namespace System.Text.RegularExpressions
 					}
 
 					if (ptr &lt; end)
-						ptr += shift[text[ptr + len]];
+						ptr++;
 					else
 						break;
 				}

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003052.html">[Mono-devel-list] Patch for System.Text.RegularExpressions
</A></li>
	<LI>Next message: <A HREF="003041.html">[Mono-devel-list] Compiling from CVS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3074">[ date ]</a>
              <a href="thread.html#3074">[ thread ]</a>
              <a href="subject.html#3074">[ subject ]</a>
              <a href="author.html#3074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
