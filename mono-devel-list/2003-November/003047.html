<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] proposed patch for	System.Configuration.ConfigurationSetting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20proposed%20patch%20for%0A%09System.Configuration.ConfigurationSetting&In-Reply-To=20031120004550.GA29177%405stops.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003044.html">
   <LINK REL="Next"  HREF="003048.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] proposed patch for	System.Configuration.ConfigurationSetting</H1>
    <B>Gonzalo Paniagua Javier</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20proposed%20patch%20for%0A%09System.Configuration.ConfigurationSetting&In-Reply-To=20031120004550.GA29177%405stops.com"
       TITLE="[Mono-devel-list] proposed patch for	System.Configuration.ConfigurationSetting">gonzalo at ximian.com
       </A><BR>
    <I>Wed Nov 19 23:30:40 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003044.html">[Mono-devel-list] proposed patch for System.Configuration.ConfigurationSetting
</A></li>
        <LI>Next message: <A HREF="003048.html">[Mono-devel-list] proposed patch for System.Configuration.ConfigurationSetting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3047">[ date ]</a>
              <a href="thread.html#3047">[ thread ]</a>
              <a href="subject.html#3047">[ subject ]</a>
              <a href="author.html#3047">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>El jue, 20-11-2003 a las 01:45, eric lindvall escribi&#243;:
&gt;<i> comments inlined:
</I>&gt;<i> 
</I>&gt;<i> On Wed, 19 Nov 2003, Gonzalo Paniagua Javier wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; El mi&#233;, 19-11-2003 a las 18:35, eric lindvall escribi&#243;:
</I>&gt;<i> &gt; &gt; sorry, forgot to cvs update first.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; +		lock (typeof (DefaultConfig)) {
</I>&gt;<i> &gt;  			if (instance == null) {
</I>&gt;<i> &gt; -				instance = new DefaultConfig ();
</I>&gt;<i> &gt; -				instance.Init ();
</I>&gt;<i> &gt; +                               Interlocked.Exchange (
</I>&gt;<i> &gt; +                              ref instance, new DefaultConfig());}
</I>&gt;<i> &gt; -					
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; There's no need to use Interlocked here, as we're already inside a lock.
</I>&gt;<i> 
</I>&gt;<i> isn't it going to be possible that the first &quot;instance == null&quot; check
</I>&gt;<i> could find a half-assigned object ref? i debated that one for a bit, but
</I>&gt;<i> it seems it is &quot;more correct&quot; to do the exchange.
</I>
You're already inside the lock. That could happen if you do:
        if (instace != null)
        	return instace;
        lock (typeof (DefaultConfig) {
        	blah
        }
        
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; IMO, the changes to GetDocumentForSection are not needed. I vote for
</I>&gt;<i> &gt; leaving the current code as it is.
</I>&gt;<i> 
</I>&gt;<i> the filename check is now completely redundant, and there are cases (if
</I>&gt;<i> you get exceptions from within the method) where we will leak fd's if you
</I>&gt;<i> don't use a using() statement (or try/finally).
</I>
If we leak fd's, then the GC is not doing its work. The GC will call the
FileStream finalizer in case of an exception in between. We don't set
the fd free inmediately, but well...

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; Also if I try to run an application that uses ConfigurationSettings and
</I>&gt;<i> &gt; there's no application configuration file (ie, only machine.config is
</I>&gt;<i> &gt; read), i get an exception:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Unhandled Exception: System.IO.FileNotFoundException: Could not find
</I>&gt;<i> &gt; file &quot;/home/gpanjav/go-mono/appsettings.exe.config&quot;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This should not happen.
</I>&gt;<i> 
</I>&gt;<i> correct. i'm not sure why i didn't find that when i was running my tests
</I>&gt;<i> (i didn't have an app.config file either).
</I>
Okay. You should test xsp a bit when modifying this stuff, with and
without web.config file.

-Gonzalo



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003044.html">[Mono-devel-list] proposed patch for System.Configuration.ConfigurationSetting
</A></li>
	<LI>Next message: <A HREF="003048.html">[Mono-devel-list] proposed patch for System.Configuration.ConfigurationSetting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3047">[ date ]</a>
              <a href="thread.html#3047">[ thread ]</a>
              <a href="subject.html#3047">[ subject ]</a>
              <a href="author.html#3047">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
