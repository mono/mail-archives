<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Socket.BeginReceive never throw Exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Socket.BeginReceive%20never%20throw%20Exception&In-Reply-To=u2y117799f01004090831x630290e0r538c711d0ed73962%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034744.html">
   <LINK REL="Next"  HREF="034762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Socket.BeginReceive never throw Exception</H1>
    <B>Stefan [At]</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Socket.BeginReceive%20never%20throw%20Exception&In-Reply-To=u2y117799f01004090831x630290e0r538c711d0ed73962%40mail.gmail.com"
       TITLE="[Mono-dev] Socket.BeginReceive never throw Exception">swieser1983 at gmail.com
       </A><BR>
    <I>Mon Apr 12 04:22:46 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034744.html">[Mono-dev] Socket.BeginReceive never throw Exception
</A></li>
        <LI>Next message: <A HREF="034762.html">[Mono-dev] Socket.BeginReceive never throw Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34761">[ date ]</a>
              <a href="thread.html#34761">[ thread ]</a>
              <a href="subject.html#34761">[ subject ]</a>
              <a href="author.html#34761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> Is there a testcase for this? This works fine for me, I'm inclined to
</I>&gt;<i> believe there's a bug in the testcase.
</I>
My code relying on the callback on disconnect works fine with Microsoft's
.NET and it doesn't work with Mono because the callback never occurs. Thus,
the behaviour from both frameworks deviate. I think my original message
never posted to the mailing list, so essentially, this is the code I'm
using:

Socket socket = server.AcceptSocket();
socket.NoDelay = true;
socket.Blocking = false;

[...]

socket.BeginReceive(receive_buffer, 0, buffer_size, 0, new
AsyncCallback(ReceiveDone), socket);

[...]

public void ReceiveDone(IAsyncResult result) {
    Socket socket = (Socket)result.AsyncState;
    int bytes_read = socket.EndReceive(result);

[...]

}

The workaround to run through all Sockets and check for the Connected
property being set to false works with Mono and isn't needed for Microsoft's
.NET (as the event properly fires). Sockets are set into NoDelay,
NonBlocking mode and then use asynchronous calls with BeginReceive and
EndReceive. Maybe it is that particular constellation, or maybe the g++
compiler, or maybe the host system. 

bash-3.2# mono --version
Mono JIT compiler version 2.6.1 (tarball Thu Apr  8 13:02:55 UTC 2010)
Copyright (C) 2002-2008 Novell, Inc and Contributors. www.mono-project.com
        TLS:           __thread
        GC:            Included Boehm (with typed GC and Parallel Mark)
        SIGSEGV:       altstack
        Notifications: epoll

I know, this is not the most recent version ATM, but the OP replied that
this behaviour occurs with 2.6.3 as well and I do trust their judgement. 

I've never gotten into the notion on having to defend my bug reports. I do
my own test cases and testing, but you are welcome to put it down as a bug
in my code. As I only need Mono for a quick internal use case in two weeks'
time, I'll get away using a workaround. Good luck getting this fixed (should
you decide to treat it as a valid issue), and take care ;)
-- 
View this message in context: <A HREF="http://n4.nabble.com/Socket-BeginReceive-never-throw-Exception-tp1679973p1836801.html">http://n4.nabble.com/Socket-BeginReceive-never-throw-Exception-tp1679973p1836801.html</A>
Sent from the Mono - Dev mailing list archive at Nabble.com.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034744.html">[Mono-dev] Socket.BeginReceive never throw Exception
</A></li>
	<LI>Next message: <A HREF="034762.html">[Mono-dev] Socket.BeginReceive never throw Exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34761">[ date ]</a>
              <a href="thread.html#34761">[ thread ]</a>
              <a href="subject.html#34761">[ subject ]</a>
              <a href="author.html#34761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
