<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Summer of Code / C++ Interop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Summer%20of%20Code%20/%20C%2B%2B%20Interop&In-Reply-To=DE0B422B-5FF4-4F90-A25E-2EB5CFFACC3C%40web.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034723.html">
   <LINK REL="Next"  HREF="034703.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Summer of Code / C++ Interop</H1>
    <B>Alex Corrado</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Summer%20of%20Code%20/%20C%2B%2B%20Interop&In-Reply-To=DE0B422B-5FF4-4F90-A25E-2EB5CFFACC3C%40web.de"
       TITLE="[Mono-dev] Summer of Code / C++ Interop">alexander.corrado at gmail.com
       </A><BR>
    <I>Fri Apr  9 03:04:25 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034723.html">[Mono-dev] Summer of Code / C++ Interop
</A></li>
        <LI>Next message: <A HREF="034703.html">[Mono-dev] [PATCH] WCF multithreaded and property handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34733">[ date ]</a>
              <a href="thread.html#34733">[ thread ]</a>
              <a href="subject.html#34733">[ subject ]</a>
              <a href="author.html#34733">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Andreas,

On Thu, Apr 8, 2010 at 6:06 AM, Andreas F&#228;rber &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">andreas.faerber at web.de</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> CSimpleClass.cs looks as if it was written manually. I see a problem with
</I>&gt;<i> changing C++ code there: To allow managed code to instantiate such a class,
</I>&gt;<i> your private struct needs to match exactly the size of the native code. If
</I>&gt;<i> however someone adds a private field in C++ but does not update the interop
</I>&gt;<i> code, it will fail. Would it be possible to leave the memory allocation to
</I>&gt;<i> C++ (the ABI document mentions &quot;nw&quot; in the name-mangling section) and in C#
</I>&gt;<i> just map the methods we actually want to call?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>From my brief review of the ABI document, I think the &quot;nw&quot; function you
</I>mention is only defined when the &quot;new&quot; operator is overridden. Although, if
that operator is overridden, the interop code should probably respect that
and use that function to allocate the memory for the object instead of doing
it manually. (I guess I'll have to add that to the TODO list :).

However, I'm pretty sure that in most cases there is no such function and
that, in C++, the caller usually allocates the memory when instantiating an
object and passes the pointer to the constructor. This is usually pretty
straightforward, since including the header includes the class definition,
which defines the exact size of the class. My eventual goal is to have a
tool that will parse C++ headers and generate the managed interface and
struct for you. At this point, however, the interface does have to be
written manually, and the struct does have to reflect the exact size of the
C++ class.


&gt;<i> For your proposed project, would you be focussing on the p/invoke ABI
</I>&gt;<i> infrastructure only? Any plans for SWIG-like autogeneration of the (C#)
</I>&gt;<i> proxy interfaces from C++ headers? And what about C++ interop inside Mono's
</I>&gt;<i> class libraries?
</I>&gt;<i>
</I>
I think that, for the scope of the Summer of Code, I will focus on making
the implementation of the Itanium ABI more complete. Since this is an open
standard that is implemented by GCC 3.2+, and GCC is the primary C++
compiler on Mac and Linux, this will be a big step for C++ interop in Mono.

Eventually, I'd like to implement a SWIG-like generation of the managed
interfaces from the C++ headers like you mention, and I'd like to implement
the Microsoft Visual C++ ABI as well. But it will probably be quite awhile
until those features are implemented, unless I have some help :). I'm not
sure what you mean by C++ interop inside Mono's class libraries. If you mean
including the interop features I'm developing in the core class libraries,
I'm all for it, but I guess that's up to the Mono maintainers.

I really appreciate your feedback. Please let me know if I can clarify
anything else for you.

Cheers,
Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100409/8bc821d7/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20100409/8bc821d7/attachment.html</A> 
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034723.html">[Mono-dev] Summer of Code / C++ Interop
</A></li>
	<LI>Next message: <A HREF="034703.html">[Mono-dev] [PATCH] WCF multithreaded and property handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34733">[ date ]</a>
              <a href="thread.html#34733">[ thread ]</a>
              <a href="subject.html#34733">[ subject ]</a>
              <a href="author.html#34733">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
