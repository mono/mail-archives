<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Socket.BeginReceive never throw Exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Socket.BeginReceive%20never%20throw%20Exception&In-Reply-To=1271060566429-1836801.post%40n4.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034761.html">
   <LINK REL="Next"  HREF="034746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Socket.BeginReceive never throw Exception</H1>
    <B>Alan McGovern</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Socket.BeginReceive%20never%20throw%20Exception&In-Reply-To=1271060566429-1836801.post%40n4.nabble.com"
       TITLE="[Mono-dev] Socket.BeginReceive never throw Exception">alan.mcgovern at gmail.com
       </A><BR>
    <I>Mon Apr 12 05:20:25 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034761.html">[Mono-dev] Socket.BeginReceive never throw Exception
</A></li>
        <LI>Next message: <A HREF="034746.html">[Mono-dev] gmcs stacktrace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34762">[ date ]</a>
              <a href="thread.html#34762">[ thread ]</a>
              <a href="subject.html#34762">[ subject ]</a>
              <a href="author.html#34762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

It really does look like a valid issue but as it stands there's no
testcase to reproduce the issue. I do this *all* the time in the
testcases for MonoTorrent and my callbacks are always invoked. I
explicitly test for this in some of my testcases. There are times when
EndReceive is not supposed to throw an exception even though the
socket is not connected. Maybe you're hitting this case. It's just
impossible for me to see this bug happening so it's impossible for us
to fix it.

I'm not asking you to defend your bug report, i'm just asking you to
make it easy for us to fix it. You have a testcase which can reproduce
the bug 100% of the time. If that testcase could be supplied as part
of the bug report, it would be so much easier to resolve the issue.
All you need to do is put the testcase in a console app so that we can
just compile and run it to see the issue.

Thanks,
Alan.

On Mon, Apr 12, 2010 at 9:22 AM, Stefan [At] &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">swieser1983 at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;&gt;<i> Is there a testcase for this? This works fine for me, I'm inclined to
</I>&gt;&gt;<i> believe there's a bug in the testcase.
</I>&gt;<i>
</I>&gt;<i> My code relying on the callback on disconnect works fine with Microsoft's
</I>&gt;<i> .NET and it doesn't work with Mono because the callback never occurs. Thus,
</I>&gt;<i> the behaviour from both frameworks deviate. I think my original message
</I>&gt;<i> never posted to the mailing list, so essentially, this is the code I'm
</I>&gt;<i> using:
</I>&gt;<i>
</I>&gt;<i> Socket socket = server.AcceptSocket();
</I>&gt;<i> socket.NoDelay = true;
</I>&gt;<i> socket.Blocking = false;
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> socket.BeginReceive(receive_buffer, 0, buffer_size, 0, new
</I>&gt;<i> AsyncCallback(ReceiveDone), socket);
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> public void ReceiveDone(IAsyncResult result) {
</I>&gt;<i> &#160; &#160;Socket socket = (Socket)result.AsyncState;
</I>&gt;<i> &#160; &#160;int bytes_read = socket.EndReceive(result);
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> The workaround to run through all Sockets and check for the Connected
</I>&gt;<i> property being set to false works with Mono and isn't needed for Microsoft's
</I>&gt;<i> .NET (as the event properly fires). Sockets are set into NoDelay,
</I>&gt;<i> NonBlocking mode and then use asynchronous calls with BeginReceive and
</I>&gt;<i> EndReceive. Maybe it is that particular constellation, or maybe the g++
</I>&gt;<i> compiler, or maybe the host system.
</I>&gt;<i>
</I>&gt;<i> bash-3.2# mono --version
</I>&gt;<i> Mono JIT compiler version 2.6.1 (tarball Thu Apr &#160;8 13:02:55 UTC 2010)
</I>&gt;<i> Copyright (C) 2002-2008 Novell, Inc and Contributors. www.mono-project.com
</I>&gt;<i> &#160; &#160; &#160; &#160;TLS: &#160; &#160; &#160; &#160; &#160; __thread
</I>&gt;<i> &#160; &#160; &#160; &#160;GC: &#160; &#160; &#160; &#160; &#160; &#160;Included Boehm (with typed GC and Parallel Mark)
</I>&gt;<i> &#160; &#160; &#160; &#160;SIGSEGV: &#160; &#160; &#160; altstack
</I>&gt;<i> &#160; &#160; &#160; &#160;Notifications: epoll
</I>&gt;<i>
</I>&gt;<i> I know, this is not the most recent version ATM, but the OP replied that
</I>&gt;<i> this behaviour occurs with 2.6.3 as well and I do trust their judgement.
</I>&gt;<i>
</I>&gt;<i> I've never gotten into the notion on having to defend my bug reports. I do
</I>&gt;<i> my own test cases and testing, but you are welcome to put it down as a bug
</I>&gt;<i> in my code. As I only need Mono for a quick internal use case in two weeks'
</I>&gt;<i> time, I'll get away using a workaround. Good luck getting this fixed (should
</I>&gt;<i> you decide to treat it as a valid issue), and take care ;)
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://n4.nabble.com/Socket-BeginReceive-never-throw-Exception-tp1679973p1836801.html">http://n4.nabble.com/Socket-BeginReceive-never-throw-Exception-tp1679973p1836801.html</A>
</I>&gt;<i> Sent from the Mono - Dev mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I></PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034761.html">[Mono-dev] Socket.BeginReceive never throw Exception
</A></li>
	<LI>Next message: <A HREF="034746.html">[Mono-dev] gmcs stacktrace
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34762">[ date ]</a>
              <a href="thread.html#34762">[ thread ]</a>
              <a href="subject.html#34762">[ subject ]</a>
              <a href="author.html#34762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
