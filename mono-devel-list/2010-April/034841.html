<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Make System.IO.Ports work on UNIX systems other than	Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Make%20System.IO.Ports%20work%20on%20UNIX%20systems%20other%20than%0A%09Linux&In-Reply-To=9413BFF9-9123-4000-878E-7488317B9D3E%40web.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034840.html">
   <LINK REL="Next"  HREF="034843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Make System.IO.Ports work on UNIX systems other than	Linux</H1>
    <B>Tom Spink</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Make%20System.IO.Ports%20work%20on%20UNIX%20systems%20other%20than%0A%09Linux&In-Reply-To=9413BFF9-9123-4000-878E-7488317B9D3E%40web.de"
       TITLE="[Mono-dev] Make System.IO.Ports work on UNIX systems other than	Linux">tspink at gmail.com
       </A><BR>
    <I>Thu Apr 22 14:42:36 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="034840.html">[Mono-dev] Make System.IO.Ports work on UNIX systems other than	Linux
</A></li>
        <LI>Next message: <A HREF="034843.html">[Mono-dev] Make System.IO.Ports work on UNIX systems other than Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34841">[ date ]</a>
              <a href="thread.html#34841">[ thread ]</a>
              <a href="subject.html#34841">[ subject ]</a>
              <a href="author.html#34841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys,

We may be able to get some hints from the sysfs filesystem, if running
on Linux.  In /sys/class/tty, we have the available TTY ports -
whether or not they're physical serial ports is another issue - but
maybe it doesn't matter.  If on Linux, and the /sys/class/tty
directory is available, it may suffice to allow a port that is present
there.

-- Tom

On 22 April 2010 18:48, Andreas F&#228;rber &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">andreas.faerber at web.de</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Am 22.04.2010 um 18:45 schrieb Robert Nagy:
</I>&gt;<i>
</I>&gt;&gt;<i> Can someone please have a look at this?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On (2010-04-20 23:26), Robert Nagy wrote:
</I>&gt;&gt;&gt;<i> The attached diff makes SerialPort.GetPortNames() work on
</I>&gt;&gt;&gt;<i> all Unix systems other than Linux too, because ttyS* and
</I>&gt;&gt;&gt;<i> ttyUSB* is linux specific and on *BSD the serial ports are
</I>&gt;&gt;&gt;<i> tty[0-9]+.
</I>&gt;&gt;&gt;<i> (I've tested this code on Linux and it should also support
</I>&gt;&gt;&gt;<i> ttySG0 (SGI running Linux (ia64)).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The other way would be to add a different platform id for
</I>&gt;&gt;&gt;<i> *BSDs.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Comments? (My C# is not good :))
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Index: class/System/System.IO.Ports/SerialPort.cs
</I>&gt;&gt;&gt;<i> ===================================================================
</I>&gt;&gt;&gt;<i> --- class/System/System.IO.Ports/SerialPort.cs &#160; &#160; &#160; (revision 155801)
</I>&gt;&gt;&gt;<i> +++ class/System/System.IO.Ports/SerialPort.cs &#160; &#160; &#160; (working copy)
</I>&gt;&gt;&gt;<i> @@ -24,6 +24,7 @@
</I>&gt;&gt;&gt;<i> using System.ComponentModel;
</I>&gt;&gt;&gt;<i> using System.Diagnostics;
</I>&gt;&gt;&gt;<i> using System.Text;
</I>&gt;&gt;&gt;<i> +using System.Text.RegularExpressions;
</I>&gt;&gt;&gt;<i> using System.Runtime.InteropServices;
</I>&gt;&gt;&gt;<i> using Microsoft.Win32;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> @@ -525,10 +526,18 @@
</I>&gt;&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;// Are we on Unix?
</I>&gt;&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (p == 4 || p == 128 || p == 6) {
</I>&gt;&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;string[] ttys = Directory.GetFiles(&quot;/dev/&quot;, &quot;tty*&quot;);
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Regex lnx = new Regex(@&quot;^\/dev\/tty(S(G)?|USB)[0-9]+$&quot;);
</I>&gt;<i>
</I>&gt;<i> I'm not a Linux expert, but I think the regex still may be incomplete.
</I>&gt;<i> For instance, I've seen tty0 (virtio), ttyPZ0 (ppc), ttySC0 (sh4 R2D),
</I>&gt;<i> ttyAMA0 (arm RealView) as kernel parameters.
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Regex rem = new Regex(@&quot;^\/dev\/tty(U)?[0-9]+$&quot;);
</I>&gt;&gt;&gt;<i> +
</I>&gt;&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;foreach (string dev in ttys) {
</I>&gt;&gt;&gt;<i> - &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (dev.StartsWith(&quot;/dev/ttyS&quot;) || dev.StartsWith(&quot;/dev/
</I>&gt;&gt;&gt;<i> ttyUSB&quot;))
</I>&gt;&gt;&gt;<i> - &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;serial_ports.Add(dev);
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (lnx.Match(dev).Success)
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;rem = lnx;
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;serial_ports.Add(dev);
</I>&gt;&gt;&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;for (int i = serial_ports.Count - 1; i &gt;= 0; i--) {
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;if (!rem.Match(serial_ports[i]).Success)
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;serial_ports.RemoveAt(i);
</I>&gt;&gt;&gt;<i> + &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;}
</I>&gt;<i>
</I>&gt;<i> This seems overly complicated to me. Both the variable naming and
</I>&gt;<i> cross-assignment and the first-add-then-remove approach.
</I>&gt;<i>
</I>&gt;<i> I think we should either try to find one universal regex like /dev/
</I>&gt;<i> tty[A-Z]*[0-9]+ or initialize the regex based on platform. Either way
</I>&gt;<i> we'd hopefully have one regex we could use to add to the list and
</I>&gt;<i> could drop the second loop.
</I>&gt;<i>
</I>&gt;<i> Platform identification could be done by recognizing a non-Windows
</I>&gt;<i> platform and p/invoking uname.
</I>&gt;<i>
</I>&gt;<i> Andreas
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>


-- 
Tom Spink
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034840.html">[Mono-dev] Make System.IO.Ports work on UNIX systems other than	Linux
</A></li>
	<LI>Next message: <A HREF="034843.html">[Mono-dev] Make System.IO.Ports work on UNIX systems other than Linux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34841">[ date ]</a>
              <a href="thread.html#34841">[ thread ]</a>
              <a href="subject.html#34841">[ subject ]</a>
              <a href="author.html#34841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
