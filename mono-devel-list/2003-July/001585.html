<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] RE: [Gc] Segmentation fault with &quot;GC_ENABLE_INCREMENTAL&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20Segmentation%20fault%20with%20%22GC_ENABLE_INCREMENTAL%22&In-Reply-To=75A9FEBA25015040A761C1F74975667D01442217%40hplex4.hpl.hp.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001584.html">
   <LINK REL="Next"  HREF="001592.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] RE: [Gc] Segmentation fault with &quot;GC_ENABLE_INCREMENTAL&quot;</H1>
    <B>Okehee Goh</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20Segmentation%20fault%20with%20%22GC_ENABLE_INCREMENTAL%22&In-Reply-To=75A9FEBA25015040A761C1F74975667D01442217%40hplex4.hpl.hp.com"
       TITLE="[Mono-devel-list] RE: [Gc] Segmentation fault with &quot;GC_ENABLE_INCREMENTAL&quot;">ogoh at asu.edu
       </A><BR>
    <I>Fri Jul 18 16:31:18 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001584.html">[Mono-devel-list] reflection.c patch
</A></li>
        <LI>Next message: <A HREF="001592.html">[Mono-devel-list] Re: Synching WSDL work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1585">[ date ]</a>
              <a href="thread.html#1585">[ thread ]</a>
              <a href="subject.html#1585">[ subject ]</a>
              <a href="author.html#1585">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
 Hello Dr.Boehm,
 Thank you so much for your reply.
 I am looking at libgc that comes with Mono-0.25. I'd like to understand it
firmly.

 The memory protection during an incremental GC in BoehmGC6.1 seems to be
enabled such that
   (1) SIGSEV is associated to trigger GC_write_fault_handler at
GC_dirty_init(), and GC_write_fault_handler() records pages that violate a
write protection,
   (2) a heap is protected as just read-only during incremental GC at
GC_read_dirty() which is called at stopped_mark(),
   (3) dirty pages are re-visited again at mark_some()...
( os_dep.c is very complicating to support various platforms. I followed
functions for MPROTECT_VDB for my system, i386 and Linux)

 If so, some system calls from Mono, that attempt to write on a protected
heap can cause SIGSEV even though they are nothing to do with application's
memory writing that must be caught for Write Barrier.
 But, why aren't they trapped by GC_write_fault_handler()?
 And also could you give any advice about what to check or what to do to
support the current implementation for an incremental GC with Mono?

 This is another question.
 At the end of GC_write_fault_handler(), it releases the protection of the
page that violates a write protection after recording the page as a dirty
page. But, I couldn't find where the protection for other pages  are
released before starting an application(mutator).

 Thank you so much in advance.

 Regards,

 Okehee


-----Original Message-----
From: Boehm, Hans [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">hans_boehm at hp.com</A>]
Sent: Wednesday, July 16, 2003 3:45 PM
To: 'Okehee Goh'; '<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gc at linux.hpl.hp.com</A>'; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ximian-mono-list at ximian.com</A>
Subject: RE: [Gc] Segmentation fault with &quot;GC_ENABLE_INCREMENTAL&quot;


Unless Mono specifically supports this by being careful about where system
calls can write, this is unlikely to work.

It will almost certainly fail if any system calls (e.g. &quot;read&quot;) write to
heap sections allocated with GC_malloc, though sometimes sections allocated
with GC_malloc_atomic are OK.  There are vague plans to hide all of this and
make this directly usable in gcj, but I don't think it has happened there
yet, either.

I assume you're doing this because you saw unacceptable pause times without
incremental collection?  Other things that might help a bit are:

1) Making sure that pointer-free objects (e.g. bitmaps, arrays of numbers)
are known by the collector to be pointer-free.  I don't know whether Mono
already does this, or whether you are allocating any other objects to which
this might apply.

2) If you are running on a dual processor (or possibly &quot;hyperthreaded&quot; P4),
turn on the parallel GC.

Hans

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Okehee Goh [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ogoh at asu.edu</A>]
</I>&gt;<i> Sent: Wednesday, July 16, 2003 2:11 PM
</I>&gt;<i> To: '<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">gc at linux.hpl.hp.com</A>'; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ximian-mono-list at ximian.com</A>
</I>&gt;<i> Subject: [Gc] Segmentation fault with &quot;GC_ENABLE_INCREMENTAL&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Hello,
</I>&gt;<i>  I run Mono-0.25 with &quot;GC_ENABLE_INCREMENTAL&quot; to enable an
</I>&gt;<i> incremental GC.
</I>&gt;<i>  But it just gave a segmentation fault.
</I>&gt;<i>  One of documents regarding Boehm's GC says that the
</I>&gt;<i> incremental GC can
</I>&gt;<i> cause &quot;unintended system call failure.&quot;
</I>&gt;<i>  (Refer to the following..)
</I>&gt;<i>  Is there anybody who didn't encounter this problem? My
</I>&gt;<i> system is Linux
</I>&gt;<i> kernel 2.4 and i686.
</I>&gt;<i>
</I>&gt;<i>   ---
</I>&gt;<i>  GC_ENABLE_INCREMENTAL - Turn on incremental collection at
</I>&gt;<i> startup. Note
</I>&gt;<i> that,
</I>&gt;<i> depending on platform and collector configuration, this
</I>&gt;<i> may involve write protecting pieces of the heap to
</I>&gt;<i> track modifications. These pieces may include pointerfree
</I>&gt;<i> objects or not. Although this is intended to be
</I>&gt;<i> transparent, it may cause unintended system call failures.
</I>&gt;<i> Use with caution.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Any suggestion will be appreciated.
</I>&gt;<i>
</I>&gt;<i>  Regards,
</I>&gt;<i>
</I>&gt;<i>  Okehee
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Gc mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Gc at linux.hpl.hp.com</A>
</I>&gt;<i> <A HREF="http://linux.hpl.hp.com/cgi-bin/mailman/listinfo/gc">http://linux.hpl.hp.com/cgi-bin/mailman/listinfo/gc</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001584.html">[Mono-devel-list] reflection.c patch
</A></li>
	<LI>Next message: <A HREF="001592.html">[Mono-devel-list] Re: Synching WSDL work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1585">[ date ]</a>
              <a href="thread.html#1585">[ thread ]</a>
              <a href="subject.html#1585">[ subject ]</a>
              <a href="author.html#1585">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
