<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] String constants and localization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20String%20constants%20and%20localization&In-Reply-To=002a01c349e3%248a0d7f10%24a67c06d5%40ansuria">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001494.html">
   <LINK REL="Next"  HREF="001508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] String constants and localization</H1>
    <B>Miguel de Icaza</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20String%20constants%20and%20localization&In-Reply-To=002a01c349e3%248a0d7f10%24a67c06d5%40ansuria"
       TITLE="[Mono-devel-list] String constants and localization">miguel at ximian.com
       </A><BR>
    <I>Mon Jul 14 13:50:46 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001494.html">AW: [Mono-devel-list] String constants and localization
</A></li>
        <LI>Next message: <A HREF="001508.html">[Mono-devel-list] String constants and localization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1503">[ date ]</a>
              <a href="thread.html#1503">[ thread ]</a>
              <a href="subject.html#1503">[ subject ]</a>
              <a href="author.html#1503">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello!

&gt;<i> I've read your answer, but it seems that at quite some points you overlooked
</I>&gt;<i> advantages (maybe I'm also wrong with any of these, but I don't think so).
</I>&gt;<i> So I added some addidional comments to it
</I>
Thanks for getting back to me.

I do agree that there were various of advantages, but from a maintenance
point of view, I did not get the feeling that those improvements were
enough to justify the design change.  This is purely my personal
feeling, so we should definitely continue exploring this topic.

That being said, one of the successful policies we used in Gnumeric was
that we aimed for maintainability, completeness and only in a third
place about performance and memory consumption.  

This allowed us to focus on getting things done right, and getting the
basic infrastructure in place.  And only later we did performance and
memory improvements.  This turned out to be good, because most
ahead-of-time optimizations turn out to be wrong.

Let me give you an example.  In the C# compiler I was very worried that
using the various &quot;Cast&quot; classes was going to be very slow, and I
decided that one day, I would rewrite the whole cast system to avoid
these objects.

Well, turns out that in the execution time profiles and in the memory
profiles, these do not even show up.  So we are able to keep the elegant
design, and profiling showed that the issues were elsewhere: in
unsuspected places.

So, anyways, after getting the philosophical bits out of the way, lets
get to the meat of it:

&gt;<i> * Much faster
</I>&gt;<i> * Much smaller Assembly size (see below)
</I>&gt;<i> * Much smaller RAM need
</I>
These are the items that we can measure, and we will have to balance
with the proposed changes, and the maintainance issues.

&gt;<i> * More safe when programing because of compile errors for e.g. typos
</I>
There are already tools in place to cope with this things.  For example,
we can use gettext to pull the strings out, so this is actually an
automated process, and one that existing translatros are familiar with.

The enumeration approach on the other hand, opens the doors to new
problems in the build system and on the setup;  Maybe not terribly hard
to fix, but they add to the plate.

&gt;<i> OK - but IMHO your solution just has two flaws:
</I>&gt;<i> * Reimplement the chunks we already have for handling resources
</I>&gt;<i>    in corlib to cope with all the CultureInfo bits (which is exactly what
</I>&gt;<i> you wanted to avoid above)
</I>
This piece is left intact.  The only change is that we have to expose an
internal method that will perform the string -&gt; index mapping in the
ResourceReader without using the Enumerator-based API.

This is fairly simple to do (and is in fact, what Microsoft does).

&gt;<i> * Sooner or later you will always come to the GetResourceStream function,
</I>&gt;<i> which actually provides a memory stream, which is: loading all things into
</I>&gt;<i> memory (and if you want to provide a complete second infrastructure for
</I>&gt;<i> strings, then the work that has to be done would be IMHO FAR more work than
</I>&gt;<i> anything you might have to do to implement something like my suggested
</I>&gt;<i> solution)
</I>
Well, we do not need to make GetResourceStream load everything into
memory;  In fact, if this is the case today, it sounds like we should
optimize that process as well.

&gt;<i> Sorry but IMHO this it total overkill. You want to perform a binary search
</I>&gt;<i> DIRECTLY on a file containing an estimated 200KB string values EVERY time we
</I>&gt;<i> do a string lookup. Are you sure this won't totally fry your HDD. And what
</I>&gt;<i> about if the assembly we are accessing is on e.g. a network share that has
</I>&gt;<i> slow access times?
</I>
It works fine enough for Monodoc, I can really not tell the difference
of disk access.  Now, lets assume we have 8k strings, that turns out to
be 12 different seeks+reads, and for the later cases, they will probably
hit the cache.  

Gettext works like this today, and there are no complaints about fully
localized systems today about the speed.  And keep in mind that with
gettext, every app on the system is doing this process all the time.

Anyways, the summary is that I do not think that deviating today from
the .NET framework setup is worth it.

Miguel.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001494.html">AW: [Mono-devel-list] String constants and localization
</A></li>
	<LI>Next message: <A HREF="001508.html">[Mono-devel-list] String constants and localization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1503">[ date ]</a>
              <a href="thread.html#1503">[ thread ]</a>
              <a href="subject.html#1503">[ subject ]</a>
              <a href="author.html#1503">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
