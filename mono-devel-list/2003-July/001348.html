<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Deserialization (reflection) bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Deserialization%20%28reflection%29%20bug&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001356.html">
   <LINK REL="Next"  HREF="001352.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Deserialization (reflection) bug</H1>
    <B>Herscovici, Avi</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Deserialization%20%28reflection%29%20bug&In-Reply-To="
       TITLE="[Mono-devel-list] Deserialization (reflection) bug">AHerscovici at Empirix.com
       </A><BR>
    <I>Wed Jul  2 12:52:55 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001356.html">[Mono-devel-list] mini/Makefile.am patch for non JIT platforms
</A></li>
        <LI>Next message: <A HREF="001352.html">[Mono-devel-list] Deserialization (reflection) bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1348">[ date ]</a>
              <a href="thread.html#1348">[ thread ]</a>
              <a href="subject.html#1348">[ subject ]</a>
              <a href="author.html#1348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys + lluis,

  Got a new deserialization bug.  I've pasted code.  Problem goes away when
I get rid of the second Add method in obj1 class.  Seems like reflection
doesn't like overloaded methods?  May also have to do with implementing
CollectionBase.  I think I've had the exact same problem that came from the
XmlSerializer constructor (that Lluis fixed) with an example that
implemented collectionbase, but now it is coming from deserialize. Either
way here are the files and the error:


// --------------test.cs---------------
using System;
using System.Xml.Serialization;
using System.IO;
using System.Xml;
using Test;


namespace Serial.test {

public class sertest {

		public static void Save(System.IO.Stream stream, object x)
		{
			XmlSerializer ser = new XmlSerializer(typeof(obj1));
			ser.Serialize(stream, x);
		}

		public static void Save(string filename, object x)
		{
			FileStream str = new FileStream(filename,
FileMode.Create, FileAccess.Write);
			Save(str, x);
			str.Close();
		}

		public static object Load(System.IO.Stream stream)
		{
			object s;
			Console.WriteLine(&quot;Debug line 1a&quot;);
			XmlSerializer ser = new XmlSerializer(typeof(obj1));
			Console.WriteLine(&quot;Debug line 2a&quot;);
			s = (object)ser.Deserialize(stream);
			return s;
		}


		public static object Load(string filename)
		{
				object s;
				Console.WriteLine(&quot;Debug line 2&quot;);
				FileStream str = new FileStream(filename,
FileMode.Open, FileAccess.Read);
				Console.WriteLine(&quot;Debug line 3&quot;);
				s = Load(str);
				Console.WriteLine(&quot;Debug line 4&quot;);
				str.Close();
				return s;
		}

	static void Main() {
	string filename = &quot;st4.ser&quot;;
	obj1 x =  new obj1();
	x.Add(new obj2());
	Save(filename, x);
	obj1 temp = (obj1)Load(filename);
	Console.WriteLine(&quot;Finished&quot;);
	}
}
}

// ----------------- obj1.cs -------------
using System;
using System.Collections;
using System.Diagnostics;

namespace Test
{
	public sealed class obj1 : CollectionBase
	{
		public void Add(obj2 sllp)
		{
			InnerList.Add(sllp);
		}

		public void Add(object name, object val)
		{
			InnerList.Add(new obj2(name, val));
		}

		public void Remove(obj2 sllp)
		{
			InnerList.Remove(sllp);
		}

		public obj2 this[int index]
		{
			[DebuggerStepThrough]
			get { return (obj2)InnerList[index]; }
			[DebuggerStepThrough]
			set { InnerList[index] = value; }
		}
	}
}
// ---------------obj2.cs------------------
using System;
using System.Diagnostics;
using System.Collections;

namespace Test
{
	public class obj2
	{
		private object m_name = null;
		private object m_value = null;

		public obj2()
		{
		}

		public obj2(object name, object val)
		{
			m_name = name;
			m_value = val;
		}

		public object Name
		{
			[DebuggerStepThrough]
			get { return m_name; }
			[DebuggerStepThrough]
			set { m_name = value; }
		}

		public object Value
		{
			[DebuggerStepThrough]
			get { return m_value; }
			[DebuggerStepThrough]
			set { m_value = value; }
		}

	}
}

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001356.html">[Mono-devel-list] mini/Makefile.am patch for non JIT platforms
</A></li>
	<LI>Next message: <A HREF="001352.html">[Mono-devel-list] Deserialization (reflection) bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1348">[ date ]</a>
              <a href="thread.html#1348">[ thread ]</a>
              <a href="subject.html#1348">[ subject ]</a>
              <a href="author.html#1348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
