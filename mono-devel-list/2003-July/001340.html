<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Patch to use ExpectedException in Test XmlTextWriterTests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20to%20use%20ExpectedException%20in%20Test%20XmlTextWriterTests&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001344.html">
   <LINK REL="Next"  HREF="001341.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Patch to use ExpectedException in Test XmlTextWriterTests</H1>
    <B>Martin Willemoes Hansen</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Patch%20to%20use%20ExpectedException%20in%20Test%20XmlTextWriterTests&In-Reply-To="
       TITLE="[Mono-devel-list] Patch to use ExpectedException in Test XmlTextWriterTests">mwh at sysrq.dk
       </A><BR>
    <I>Wed Jul  2 09:20:08 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="001344.html">[Mono-devel-list] More 64 bit changes
</A></li>
        <LI>Next message: <A HREF="001341.html">[Mono-devel-list] Patch to use ExpectedException in Test XmlTextWriterTests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1340">[ date ]</a>
              <a href="thread.html#1340">[ thread ]</a>
              <a href="subject.html#1340">[ subject ]</a>
              <a href="author.html#1340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

I changed mcs/class/System.XML/Test/System.Xml/XmlTextWriterTests to
make use of the ExpectedExceptionAttribute

Okay to commit?
-- 
Martin Willemoes Hansen

--------------------------------------------------------
E-Mail	<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mwh at sysrq.dk</A>	Website	mwh.sysrq.dk
IRC     MWH, freenode.net
--------------------------------------------------------               

-------------- next part --------------
? XmlTextWriterTests.cs.diff
Index: XmlTextWriterTests.cs
===================================================================
RCS file: /cvs/public/mcs/class/System.XML/Test/System.Xml/XmlTextWriterTests.cs,v
retrieving revision 1.5
diff -u -r1.5 XmlTextWriterTests.cs
--- XmlTextWriterTests.cs	15 Jun 2003 18:09:46 -0000	1.5
+++ XmlTextWriterTests.cs	1 Jul 2003 19:41:38 -0000
@@ -92,13 +92,13 @@
 		public void AttributeNamespacesXmlnsXmlns ()
 		{
 			xtw.WriteStartElement (&quot;foo&quot;);
-			try {
-				xtw.WriteAttributeString (&quot;xmlns&quot;, &quot;xmlns&quot;, null, &quot;<A HREF="http://abc.def&quot;">http://abc.def&quot;</A>);
-				// This should not be allowed, even though
-				// MS.NET doesn't treat as an error.
-				Fail (&quot;any prefix which name starts from \&quot;xml\&quot; must not be allowed.&quot;);
-			}
- 			catch (ArgumentException e) {}
+			try {
+				xtw.WriteAttributeString (&quot;xmlns&quot;, &quot;xmlns&quot;, null, &quot;<A HREF="http://abc.def&quot;">http://abc.def&quot;</A>);
+				// This should not be allowed, even though
+				// MS.NET doesn't treat as an error.
+				Fail (&quot;any prefix which name starts from \&quot;xml\&quot; must not be allowed.&quot;);
+			}
+ 			catch (ArgumentException e) {}
 			xtw.WriteAttributeString (&quot;&quot;, &quot;xmlns&quot;, null, &quot;<A HREF="http://abc.def&quot;">http://abc.def&quot;</A>);
 		}
 
@@ -142,17 +142,13 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (InvalidOperationException))]
 		public void AttributeWriteAttributeStringNotInsideOpenStartElement ()
 		{
 			xtw.WriteStartElement (&quot;foo&quot;);
 			xtw.WriteString (&quot;bar&quot;);
 			
-			try 
-			{
-				xtw.WriteAttributeString (&quot;baz&quot;, &quot;quux&quot;);
-				Fail (&quot;Expected an InvalidOperationException to be thrown.&quot;);
-			} 
-			catch (InvalidOperationException) {}
+			xtw.WriteAttributeString (&quot;baz&quot;, &quot;quux&quot;);
 		}
 
 		[Test]
@@ -173,13 +169,10 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void CDataInvalid ()
 		{
-			try {
-				xtw.WriteCData(&quot;foo]]&gt;bar&quot;);
-				Fail(&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) { }
+			xtw.WriteCData(&quot;foo]]&gt;bar&quot;);
 		}
 
 		[Test]
@@ -263,19 +256,11 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void CommentInvalid ()
 		{
-			try {
-				xtw.WriteComment(&quot;foo-&quot;);
-				Fail(&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) { }
-
-			try {
-				xtw.WriteComment(&quot;foo--&gt;bar&quot;);
-				Fail(&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) { }
+			xtw.WriteComment(&quot;foo-&quot;);
+			xtw.WriteComment(&quot;foo--&gt;bar&quot;);
 		}
 
 		[Test]
@@ -333,23 +318,13 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (InvalidOperationException))]
 		public void DocumentStart ()
 		{
 			xtw.WriteStartDocument ();
 			AssertEquals (&quot;XmlDeclaration is incorrect.&quot;, &quot;&lt;?xml version='1.0' encoding='utf-16'?&gt;&quot;, StringWriterText);
 
-			try 
-			{
-				xtw.WriteStartDocument ();
-				Fail(&quot;Should have thrown an InvalidOperationException.&quot;);
-			} 
-			catch (InvalidOperationException e) {
-				// Don't rely on English message assertion.
-				// It is enough to check an exception occurs.
-//				AssertEquals (&quot;Exception message is incorrect.&quot;,
-//					&quot;WriteStartDocument should be the first call.&quot;, e.Message);
-			}
-
+			xtw.WriteStartDocument ();
 			xtw = new XmlTextWriter (sw = new StringWriter ());
 			xtw.QuoteChar = '\'';
 			xtw.WriteStartDocument (true);
@@ -471,6 +446,7 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void NamespacesElementsPassingInNamespaces ()
 		{
 			xtw.Namespaces = false;
@@ -490,35 +466,12 @@
 
 			// These should throw ArgumentException because they pass in a
 			// namespace when Namespaces = false.
-			try {
-				xtw.WriteElementString (&quot;qux&quot;, &quot;<A HREF="http://netsack.com/&quot;,">http://netsack.com/&quot;,</A> String.Empty);
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
-
-			try {
-				xtw.WriteStartElement (&quot;foo&quot;, &quot;<A HREF="http://netsack.com/&quot;">http://netsack.com/&quot;</A>);
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
-
-			try {
-				xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, &quot;<A HREF="http://netsack.com/&quot;">http://netsack.com/&quot;</A>);
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
-
-			try {
-				xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, null);
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
-
-			try {
-				xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, &quot;&quot;);
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
-
-			try {
-				xtw.WriteStartElement (&quot;foo&quot;, &quot;&quot;, &quot;&quot;);
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
+			xtw.WriteElementString (&quot;qux&quot;, &quot;<A HREF="http://netsack.com/&quot;,">http://netsack.com/&quot;,</A> String.Empty);
+			xtw.WriteStartElement (&quot;foo&quot;, &quot;<A HREF="http://netsack.com/&quot;">http://netsack.com/&quot;</A>);
+			xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, &quot;<A HREF="http://netsack.com/&quot;">http://netsack.com/&quot;</A>);
+			xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, null);
+			xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, &quot;&quot;);
+			xtw.WriteStartElement (&quot;foo&quot;, &quot;&quot;, &quot;&quot;);
 		}
 
 		[Test]
@@ -546,31 +499,19 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void NamespacesPrefixWithEmptyAndNullNamespace ()
 		{
-			try {
-				xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, &quot;&quot;);
-				Fail (&quot;Should have thrown an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
-
-			try 
-			{
-				xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, null);
-				Fail (&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) {}
+			xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, &quot;&quot;);
+			xtw.WriteStartElement (&quot;foo&quot;, &quot;bar&quot;, null);
 		}
 
 		[Test]
+		[ExpectedException (typeof (InvalidOperationException))]
 		public void NamespacesSettingWhenWriteStateNotStart ()
 		{
 			xtw.WriteStartElement (&quot;foo&quot;);
-			try 
-			{
-				xtw.Namespaces = false;
-				Fail (&quot;Expected an InvalidOperationException.&quot;);
-			} 
-			catch (InvalidOperationException) {}
+			xtw.Namespaces = false;
 			AssertEquals (true, xtw.Namespaces);
 		}
 
@@ -582,35 +523,13 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void ProcessingInstructionInvalid ()
 		{
-			try 
-			{
-				xtw.WriteProcessingInstruction(&quot;fo?&gt;o&quot;, &quot;bar&quot;);
-				Fail(&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) { }
-
-			try 
-			{
-				xtw.WriteProcessingInstruction(&quot;foo&quot;, &quot;ba?&gt;r&quot;);
-				Fail(&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) { }
-
-			try 
-			{
-				xtw.WriteProcessingInstruction(&quot;&quot;, &quot;bar&quot;);
-				Fail(&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) { }
-
-			try 
-			{
-				xtw.WriteProcessingInstruction(null, &quot;bar&quot;);
-				Fail(&quot;Should have thrown an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) { }
+			xtw.WriteProcessingInstruction(&quot;fo?&gt;o&quot;, &quot;bar&quot;);
+			xtw.WriteProcessingInstruction(&quot;foo&quot;, &quot;ba?&gt;r&quot;);
+			xtw.WriteProcessingInstruction(&quot;&quot;, &quot;bar&quot;);
+			xtw.WriteProcessingInstruction(null, &quot;bar&quot;);
 		}
 
 		[Test]
@@ -630,12 +549,10 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void QuoteCharInvalid ()
 		{
-			try {
-				xtw.QuoteChar = 'x';
-				Fail (&quot;Should have thrown an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
+			xtw.QuoteChar = 'x';
 		}
 
 		[Test]
@@ -668,6 +585,7 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void WriteCharEntity ()
 		{
 			xtw.WriteCharEntity ('a');
@@ -682,38 +600,23 @@
 			xtw.WriteCharEntity ('K');
 			AssertEquals (&quot;&amp;#x61;&amp;#x41;&amp;#x31;&amp;#x4B;&quot;, StringWriterText);
 
-			try {
-				xtw.WriteCharEntity ((char)0xd800);
-			} catch (ArgumentException) {}
+			xtw.WriteCharEntity ((char)0xd800);
 		}
 
 		[Test]
+		[ExpectedException (typeof (InvalidOperationException))]
 		public void WriteEndAttribute ()
 		{
-			try 
-			{
-				xtw.WriteEndAttribute ();
-				Fail (&quot;Should have thrown an InvalidOperationException.&quot;);
-			}
-			catch (InvalidOperationException) {}
+			xtw.WriteEndAttribute ();
 		}
 
 		[Test]
+		[ExpectedException (typeof (ArgumentException))]
 		public void WriteEndDocument ()
 		{
-			try {
-				xtw.WriteEndDocument ();
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} catch (ArgumentException) {}
-
+			xtw.WriteEndDocument ();
 			xtw.WriteStartDocument ();
-
-			try 
-			{
-				xtw.WriteEndDocument ();
-				Fail (&quot;Expected an ArgumentException.&quot;);
-			} 
-			catch (ArgumentException) {}
+			xtw.WriteEndDocument ();
 
 			xtw.WriteStartElement (&quot;foo&quot;);
 			xtw.WriteStartAttribute (&quot;bar&quot;, null);
@@ -725,16 +628,13 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (InvalidOperationException))]
 		public void WriteEndElement ()
 		{
-			try {
-				xtw.WriteEndElement ();
-				Fail (&quot;Should have thrown an InvalidOperationException.&quot;);
-			} catch (InvalidOperationException e) {
-				// Don't rely on English message assertion.
-				// It is enough to check an exception occurs.
-//				AssertEquals (&quot;Exception message is incorrect.&quot;, &quot;There was no XML start tag open.&quot;, e.Message);
-			}
+			xtw.WriteEndElement ();
+			// Don't rely on English message assertion.
+			// It is enough to check an exception occurs.
+			// AssertEquals (&quot;Exception message is incorrect.&quot;, &quot;There was no XML start tag open.&quot;, e.Message);
 
 			xtw.WriteStartElement (&quot;foo&quot;);
 			xtw.WriteEndElement ();
@@ -814,12 +714,11 @@
 		}
 
 		[Test]
+		[ExpectedException (typeof (InvalidOperationException))]
 		public void WriteString ()
 		{
 			xtw.WriteStartDocument ();
-			try {
-				xtw.WriteString(&quot;foo&quot;);
-			} catch (InvalidOperationException) {}
+			xtw.WriteString(&quot;foo&quot;);
 
 			// Testing attribute values
 
@@ -1039,34 +938,34 @@
 		[Test]
 		public void WriteWhitespace ()
 		{
-			xtw.WriteStartElement (&quot;a&quot;);
-			xtw.WriteWhitespace (&quot;\n\t&quot;);
-			xtw.WriteStartElement (&quot;b&quot;);
-			xtw.WriteWhitespace (&quot;\n\t&quot;);
-			xtw.WriteEndElement ();
-			xtw.WriteWhitespace (&quot;\n&quot;);
-			xtw.WriteEndElement ();
-			xtw.WriteWhitespace (&quot;\n&quot;);
-			xtw.Flush ();
+			xtw.WriteStartElement (&quot;a&quot;);
+			xtw.WriteWhitespace (&quot;\n\t&quot;);
+			xtw.WriteStartElement (&quot;b&quot;);
+			xtw.WriteWhitespace (&quot;\n\t&quot;);
+			xtw.WriteEndElement ();
+			xtw.WriteWhitespace (&quot;\n&quot;);
+			xtw.WriteEndElement ();
+			xtw.WriteWhitespace (&quot;\n&quot;);
+			xtw.Flush ();
 			AssertEquals (&quot;&lt;a&gt;\n\t&lt;b&gt;\n\t&lt;/b&gt;\n&lt;/a&gt;\n&quot;, StringWriterText);
 		}
 
-		[Test]
-		public void FlushDoesntCloseTag ()
-		{
-			xtw.WriteStartElement (&quot;foo&quot;);
-			xtw.WriteAttributeString (&quot;bar&quot;, &quot;baz&quot;);
-			xtw.Flush ();
-			AssertEquals (&quot;&lt;foo bar='baz'&quot;, StringWriterText);
-		}
-
-		[Test]
-		public void WriteWhitespaceClosesTag ()
-		{
-			xtw.WriteStartElement (&quot;foo&quot;);
-			xtw.WriteAttributeString (&quot;bar&quot;, &quot;baz&quot;);
-			xtw.WriteWhitespace (&quot; &quot;);
-			AssertEquals (&quot;&lt;foo bar='baz'&gt; &quot;, StringWriterText);
-		}
+		[Test]
+		public void FlushDoesntCloseTag ()
+		{
+			xtw.WriteStartElement (&quot;foo&quot;);
+			xtw.WriteAttributeString (&quot;bar&quot;, &quot;baz&quot;);
+			xtw.Flush ();
+			AssertEquals (&quot;&lt;foo bar='baz'&quot;, StringWriterText);
+		}
+
+		[Test]
+		public void WriteWhitespaceClosesTag ()
+		{
+			xtw.WriteStartElement (&quot;foo&quot;);
+			xtw.WriteAttributeString (&quot;bar&quot;, &quot;baz&quot;);
+			xtw.WriteWhitespace (&quot; &quot;);
+			AssertEquals (&quot;&lt;foo bar='baz'&gt; &quot;, StringWriterText);
+		}
 	}
 }
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001344.html">[Mono-devel-list] More 64 bit changes
</A></li>
	<LI>Next message: <A HREF="001341.html">[Mono-devel-list] Patch to use ExpectedException in Test XmlTextWriterTests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1340">[ date ]</a>
              <a href="thread.html#1340">[ thread ]</a>
              <a href="subject.html#1340">[ subject ]</a>
              <a href="author.html#1340">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
