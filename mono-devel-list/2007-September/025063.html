<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Linq sample?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Linq%20sample%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025066.html">
   <LINK REL="Next"  HREF="025080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Linq sample?</H1>
    <B>pablosantosluac</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Linq%20sample%3F&In-Reply-To="
       TITLE="[Mono-dev] Linq sample?">pablosantosluac at terra.es
       </A><BR>
    <I>Tue Sep 25 12:52:45 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="025066.html">[Mono-dev] Linq sample?
</A></li>
        <LI>Next message: <A HREF="025080.html">[Mono-dev] Linq sample?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25063">[ date ]</a>
              <a href="thread.html#25063">[ thread ]</a>
              <a href="subject.html#25063">[ subject ]</a>
              <a href="author.html#25063">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Oh... come on! I was so happy! :-(

Here is my code: it is just a dumb test. Note I commented out the 
&quot;console.writeline&quot; line.

I'm not using SQL, just searching in an in-memory array...

One question too, I'm totally new to linq so, is there a way to build the 
queries dynamically? I mean, maybe something like building them from a 
string that you can build at runtime or so??

pablo


using System;
using System.Linq;
using System.Collections.Generic;

namespace test
{

    class Revision
    {
        public long ObjId;
        public long RevNo;
        public long BranchId;
        public long ItemId;
        public bool Last;
        public string comment;
        public short Type;
        public long Size;
        public bool CheckedOut;
        public long ParentId = -1;
        public string Hash;
        public long Changeset;

        public Revision(long objid, long revno, long brid, long itemid, bool 
last,
            string comment, short type, long size, bool co, long parent, 
string hash,
            long cset)
        {
            this.ObjId = objid;
            this.RevNo = revno;
            this.BranchId = brid;
            this.ItemId = itemid;
            this.Last = last;
            this.comment = comment;
            this.Type = type;
            this.Size = size;
            this.CheckedOut = co;
            this.ParentId = parent;
            this.Hash = hash;
            this.Changeset = cset;
        }
    }


    class app
    {

        static void     Main(string[] args)
        {
            Revision[] revs = new Revision[int.Parse(args[0])];

            for( int i = 0; i &lt; revs.Length; ++i )
            {
                revs[i] = new Revision(i, i % 4, i &lt; 8000 ? 4 : i % 5, 0, i 
% 12 == 0,
                &quot;this is a comment&quot;, 0, i, false, 1, 
&quot;jakdjfalskjfasjfasjfasjf&quot;, 10);
            }

            int ini = Environment.TickCount;

            IEnumerable&lt;Revision&gt; query = from s in revs
                                where s.BranchId == 4 &amp;&amp; s.Last
                                select s;

            int time = Environment.TickCount - ini;
            int num = 0;
            foreach( Revision r in query )
            {
//             Console.WriteLine(&quot;{0} - objid:{1}&quot;, num, r.ObjId);
               ++num;
            }
            Console.WriteLine(&quot;time retrieving {0} {1} ms&quot;, num, time);

            num = 0;
            ini = Environment.TickCount;
            foreach( Revision r in revs )
              if( r.Last &amp;&amp; r.BranchId == 4)
                 ++num;

            Console.WriteLine(&quot;time retrieving iteratively {0} {1} ms&quot;, num, 
Environment.TickCount - ini);
        }
    }
}



----- Original Message ----- 
From: &quot;Kamil Skalski&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kamil.skalski at gmail.com</A>&gt;
To: &quot;pablosantosluac&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">pablosantosluac at terra.es</A>&gt;
Cc: &quot;Marek Safar&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">marek.safar at seznam.cz</A>&gt;; &quot;Robert Jordan&quot; 
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">robertj at gmx.net</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Sent: Tuesday, September 25, 2007 5:04 PM
Subject: Re: [Mono-dev] Linq sample?


&gt;<i> 2007/9/25, pablosantosluac &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">pablosantosluac at terra.es</A>&gt;:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well, I've just tried some simple tests yet, but I'd say performance is
</I>&gt;&gt;<i> awsome... I mean, searching in an array of 120 Million objects, using 
</I>&gt;&gt;<i> about
</I>&gt;&gt;<i> 1GB RAM looking for a simple query checking a couple of properties needed
</I>&gt;&gt;<i> only 185ms to finish!!!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Doing it iteratively (looping through the array) took 284ms against 3 in 
</I>&gt;&gt;<i> a
</I>&gt;&gt;<i> 12Million array (linq is faster!).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> After getting such results I would guess there is some problem with
</I>&gt;<i> the benchmark. You could post it here, so we can look at it. Such
</I>&gt;<i> results are hardly possible, since linq is mostly just a layer about
</I>&gt;<i> the standard search code, so it should never actually run faster
</I>&gt;<i> (unless we speak about some complex Linq to SQL stuff involving code
</I>&gt;<i> generation etc.).
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> Kamil Skalski
</I>&gt;<i> <A HREF="http://nazgul.omega.pl">http://nazgul.omega.pl</A> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025066.html">[Mono-dev] Linq sample?
</A></li>
	<LI>Next message: <A HREF="025080.html">[Mono-dev] Linq sample?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25063">[ date ]</a>
              <a href="thread.html#25063">[ thread ]</a>
              <a href="subject.html#25063">[ subject ]</a>
              <a href="author.html#25063">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
