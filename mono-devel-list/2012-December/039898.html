<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Mono on PowerPC-64
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Mono%20on%20PowerPC-64&In-Reply-To=%3C50BE2F71.8060905%40saillune.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="039897.html">
   <LINK REL="Next"  HREF="039899.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Mono on PowerPC-64</H1>
    <B>Ben Carter</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=Re%3A%20%5BMono-dev%5D%20Mono%20on%20PowerPC-64&In-Reply-To=%3C50BE2F71.8060905%40saillune.net%3E"
       TITLE="[Mono-dev] Mono on PowerPC-64">benml at saillune.net
       </A><BR>
    <I>Tue Dec  4 17:14:25 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="039897.html">[Mono-dev] Order problem in runtime shutdown flow
</A></li>
        <LI>Next message: <A HREF="039899.html">[Mono-dev] Question about Mono.Data.Tds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39898">[ date ]</a>
              <a href="thread.html#39898">[ thread ]</a>
              <a href="subject.html#39898">[ subject ]</a>
              <a href="author.html#39898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

 I'm currently trying to get Mono 2.11.4 running on a PPC64 (ilp32)
system, and I've hit a problem that I'm a bit puzzled by.

 Basically, I'm running an AOT pass on mscorlib (on the target, not
cross-compiling), and when it tries to convert
Microsoft.Win32.KeyHandler:LoadKey(System.Security.SecurityElement) it
hits an assert in mono_spill_global_vars in method_to_ir.c (line 11976
or thereabouts) - specifically in the SREG spilling:

g_assert (var-&gt;opcode == OP_REGOFFSET);

...which fails because var-&gt;opcode is 328 (OP_LOCAL, as far as I can see)

With the verbose level cranked up, the block it's processing looks like
this:

SPILL BLOCK 30:
 load_membase R215 &lt;- [R32 + 0x10]
	 ii  215 32
	1  load_membase R215 &lt;- [r27 + 0x10]
 checkthis [R33 + 0x0]
	  i  -1 33
	1  checkthis [r28 + 0x0]
 not_null R33
	  i  -1 33
	1  not_null r28
 load_membase R227 &lt;- [R33 + 0x8]
	 ii  227 33
	1  load_membase R227 &lt;- [r28 + 0x8]
 lcall R224 &lt;- [long:Parse (string)] [r3 &lt;- R227] clobbers: c
	 l   224
	1  lcall r24 &lt;- [long:Parse (string)] [r3 &lt;- R227] clobbers: c
 got_entry R230 &lt;- [R46 + 0x0]
	 ii  230 46
	1  got_entry R230 &lt;- [r30 + 0x0]
 call R229 &lt;- [mono_object_new_ptrfree_box] [r3 &lt;- R230] clobbers: c
	 i   229
	1  call R229 &lt;- [mono_object_new_ptrfree_box] [r3 &lt;- R230] clobbers: c
 storei4_membase_reg [R229 + 0x8] &lt;- R226
	  ii -1 226

var is apparently &quot;local R226 &lt;-&quot; if I dump it out.

Now, I'm not particularly familiar with the mono codebase, so I'm having
a bit of trouble figuring out what this means. I'm quite suspicious of
the fact that R226 looks like it isn't actually ever written to anywhere
in the instruction dump I've got - there are several instances where
like this is gets stored out, but unless I've missed something I'm
guessing that it would be normal to expect a &quot;R226 &lt;-&quot; instruction to
appear somewhere to actually load/set it...?

Another bit of weirdness is that this problem doesn't appear if I set
the architecture to PPC32 - doing that allows me to compile the whole
assembly fine and generates a &quot;working&quot; version (which doesn't
/actually/ work, because of the different handling of function pointers
between PPC64 and PPC32, but by eye it looks right).

Does anyone have any suggestions as to what might be going wrong here,
or where I should look next to try and figure out the problem?

 Many thanks in advance!
-- 
 Ben Carter - <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ben at saillune.net</A>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="039897.html">[Mono-dev] Order problem in runtime shutdown flow
</A></li>
	<LI>Next message: <A HREF="039899.html">[Mono-dev] Question about Mono.Data.Tds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#39898">[ date ]</a>
              <a href="thread.html#39898">[ thread ]</a>
              <a href="subject.html#39898">[ subject ]</a>
              <a href="author.html#39898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
