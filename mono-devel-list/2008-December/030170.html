<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] JIT: MonoReg to replace gssize for registers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20JIT%3A%20MonoReg%20to%20replace%20gssize%20for%20registers&In-Reply-To=E15A49F2-C68F-41DE-8195-E9BD80A3F84F%40upwardaccess.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030168.html">
   <LINK REL="Next"  HREF="030171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] JIT: MonoReg to replace gssize for registers</H1>
    <B>Andreas F&#228;rber</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20JIT%3A%20MonoReg%20to%20replace%20gssize%20for%20registers&In-Reply-To=E15A49F2-C68F-41DE-8195-E9BD80A3F84F%40upwardaccess.com"
       TITLE="[Mono-dev] JIT: MonoReg to replace gssize for registers">andreas.faerber at web.de
       </A><BR>
    <I>Sat Dec 13 15:27:20 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="030168.html">[Mono-dev] JIT: MonoReg to replace gssize for registers
</A></li>
        <LI>Next message: <A HREF="030171.html">[Mono-dev] JIT: MonoReg to replace gssize for registers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30170">[ date ]</a>
              <a href="thread.html#30170">[ thread ]</a>
              <a href="subject.html#30170">[ subject ]</a>
              <a href="author.html#30170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On ppc there is a similar feature, SPE, which allows some 64-bit ops  
on a 32-bit machine.

There, the general-purpose registers appear to be all 64-bit but  
regular instructions only access the lower 32 bits. Special  
instructions are used to access full 64-bit registers, similar to  
Altivec instructions using (separate) 128-bit registers on an  
otherwise 32- or 64-bit system.

 From that point of view, technically the MonoReg distinction makes  
sense, to allow sizeof(MonoReg) &gt;= sizeof(gssize).

But as pointed out below, changing the variable type is only a start.  
Should anyone want to make Mono use SPE on ppc, probably all places  
that save and restore registers would need to be reworked, introducing  
a special code path for those systems that support it. The only Mono  
feature benefitting would probably be System.Int64, so I'm not sure if  
this is really needed.

Andreas

Am 13.12.2008 um 19:55 schrieb Mark Mason:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> Not ... necessarily.  The mips/n32 abi is one example.  Code runs in a
</I>&gt;<i> 32-bit address space (so pointers, and sizeof(void *) are 32-bits),
</I>&gt;<i> but with 64-bit registers and 64-bit operations available.
</I>&gt;<i>
</I>&gt;<i> This is distinct from n64, which does have 64-bit pointers.
</I>&gt;<i>
</I>&gt;<i> /Mark
</I>&gt;<i>
</I>&gt;<i> On Dec 13, 2008, at 7:01 AM, Zoltan Varga wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> gssize is the size needed to hold a memory address, if the machine
</I>&gt;&gt;<i> has 64 bit registers,
</I>&gt;&gt;<i> this is 64 bits. On that mips machine, this is 32 bits ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                 Zoltan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Dec 11, 2008 at 8:40 PM, Mark Mason
</I>&gt;&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mmason at upwardaccess.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> Hello all,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Along the same lines as the SIZEOF_VOID_P change, I'd like to offer
</I>&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;<i> following new type to replace to use of 'gssize' when referring to a
</I>&gt;&gt;&gt;<i> machine register. 'gssize' comes from glib, and simply represents  
</I>&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;<i> size of an integer -- which is not necessarily always the same as  
</I>&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;<i> size of the underlying integer registers.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> There are some other uses of gssize in mini/ that will need to be
</I>&gt;&gt;&gt;<i> updated as well, but this is a start.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Comments most welcome.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks in advance,
</I>&gt;&gt;&gt;<i> Mark
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Index: mini.h
</I>&gt;&gt;&gt;<i> ===================================================================
</I>&gt;&gt;&gt;<i> --- mini.h      (revision 121269)
</I>&gt;&gt;&gt;<i> +++ mini.h      (working copy)
</I>&gt;&gt;&gt;<i> @@ -400,6 +400,13 @@
</I>&gt;&gt;&gt;<i>      int size, align;
</I>&gt;&gt;&gt;<i> } MonoMemcpyArgs;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> +/* C type matching the size of a machine register. Not always the
</I>&gt;&gt;&gt;<i> same
</I>&gt;&gt;&gt;<i> as 'int' */
</I>&gt;&gt;&gt;<i> +#if SIZEOF_REGISTER == 4
</I>&gt;&gt;&gt;<i> +typedef gint32 MonoReg;
</I>&gt;&gt;&gt;<i> +#elif SIZEOF_REGISTER == 8
</I>&gt;&gt;&gt;<i> +typedef gint64 MonoReg;
</I>&gt;&gt;&gt;<i> +#endif
</I>&gt;&gt;&gt;<i> +
</I>&gt;&gt;&gt;<i> struct MonoInst {
</I>&gt;&gt;&gt;<i>      guint16 opcode;
</I>&gt;&gt;&gt;<i>      guint8  type; /* stack type */
</I>&gt;&gt;&gt;<i> @@ -415,7 +422,7 @@
</I>&gt;&gt;&gt;<i>              union {
</I>&gt;&gt;&gt;<i>                      MonoInst *src;
</I>&gt;&gt;&gt;<i>                      MonoMethodVar *var;
</I>&gt;&gt;&gt;<i> -                       gssize const_val;
</I>&gt;&gt;&gt;<i> +                       MonoReg const_val;
</I>&gt;&gt;&gt;<i>                      gpointer p;
</I>&gt;&gt;&gt;<i>                      MonoMethod *method;
</I>&gt;&gt;&gt;<i>                      MonoMethodSignature *signature;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mono-devel-list mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030168.html">[Mono-dev] JIT: MonoReg to replace gssize for registers
</A></li>
	<LI>Next message: <A HREF="030171.html">[Mono-dev] JIT: MonoReg to replace gssize for registers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30170">[ date ]</a>
              <a href="thread.html#30170">[ thread ]</a>
              <a href="subject.html#30170">[ subject ]</a>
              <a href="author.html#30170">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
