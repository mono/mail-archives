<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] TcpChannel hang on Windows.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20TcpChannel%20hang%20on%20Windows.&In-Reply-To=37c5788d0812220759g760998f2t94f6bbbbf9a97860%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030293.html">
   <LINK REL="Next"  HREF="030281.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] TcpChannel hang on Windows.</H1>
    <B>Korn&#233;l P&#225;l</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20TcpChannel%20hang%20on%20Windows.&In-Reply-To=37c5788d0812220759g760998f2t94f6bbbbf9a97860%40mail.gmail.com"
       TITLE="[Mono-dev] [PATCH] TcpChannel hang on Windows.">kornelpal at gmail.com
       </A><BR>
    <I>Tue Dec 30 13:02:42 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="030293.html">[Mono-dev] [PATCH] TcpChannel hang on Windows.
</A></li>
        <LI>Next message: <A HREF="030281.html">[Mono-dev] [PATCH] TcpChannel hang on Windows.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30343">[ date ]</a>
              <a href="thread.html#30343">[ thread ]</a>
              <a href="subject.html#30343">[ subject ]</a>
              <a href="author.html#30343">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

This simple test case shows that background threads are killed even if 
they are executing managed code. The easiest way to kill the threads is 
to kill the process itself so I think that this is what MS.NET does but 
killing the threads one by one results in the same behavior.

Programs that would break on Mono because of this change are broken on 
MS.NET as well.

This is the MS.NET behavior that can be easily shown using simple test 
cases.

I know that you are aware of this and you have described this in your 
messages but this behavior cannot be worked around (unless you call 
ExitProcess) this has to be implemented in the runtime.

If Mono aims to be MS.NET compatible, and this is an important 
difference that should be addressed.

Also note that your workaround for Accept is not compatible with MS.NET 
because that makes Accept abortable that is not the case in MS.NET either.

Korn&#233;l

Bill Holmes wrote:
&gt;<i> Korn&#233;l,
</I>&gt;<i> 
</I>&gt;<i> I do agree that this is a general problem and not only an issue with
</I>&gt;<i> accept.  Also I do know that the patch is a workaround, or as we like
</I>&gt;<i> to say treading the symptom and not that cause.
</I>&gt;<i> 
</I>&gt;<i> I have spent much time trying to understand the shutdown behavior of
</I>&gt;<i> MS.  From what I can gather I does appear that MS kills the thread or
</I>&gt;<i> simply ignores it.  (So we agree on that as well.)
</I>&gt;<i> 
</I>&gt;<i> For Mono I would suggest that killing all background threads on
</I>&gt;<i> shutdown.  (and only shutdown.)  Ignoring the thread and allowing it
</I>&gt;<i> to live on allows a window of opportunity to attempt to interact with
</I>&gt;<i> other Mono internal objects that have been destroyed.  Therefore
</I>&gt;<i> killing the thread I believe is the better option.
</I>&gt;<i> 
</I>&gt;<i> Another reason I believe that MS simply kills the thread is a
</I>&gt;<i> different sample I tried.  Consider a program that spawns a background
</I>&gt;<i> thread.  That thread only PInvokes into a call that simply loops.
</I>&gt;<i> (while (1);)  The program does exit with MS.Net.
</I>&gt;<i> 
</I>&gt;<i> I have discussed this on IRC with a few others and exiting the thread
</I>&gt;<i> is an unpopular solution.  Killing a thread is about as accepted as
</I>&gt;<i> using goto statements.  ;)
</I>&gt;<i> 
</I>&gt;<i> To be honest, even though I have spent 2 weeks looking at this I still
</I>&gt;<i> do not feel comfortable that the Mono shutdown logic can handle
</I>&gt;<i> killing threads.  Another way to put it I am afraid that changing the
</I>&gt;<i> shutdown logic would cause currently working Mono apps to start
</I>&gt;<i> bombing because I just do not understand the full picture.
</I>&gt;<i> 
</I>&gt;<i> -bill
</I>&gt;<i> 
</I>-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: BackgroundThread.cs
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20081230/e627580a/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20081230/e627580a/attachment.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030293.html">[Mono-dev] [PATCH] TcpChannel hang on Windows.
</A></li>
	<LI>Next message: <A HREF="030281.html">[Mono-dev] [PATCH] TcpChannel hang on Windows.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30343">[ date ]</a>
              <a href="thread.html#30343">[ thread ]</a>
              <a href="subject.html#30343">[ subject ]</a>
              <a href="author.html#30343">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
