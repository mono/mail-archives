<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Proposed change to TestDriver.dll
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Proposed%20change%20to%20TestDriver.dll&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030047.html">
   <LINK REL="Next"  HREF="030034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Proposed change to TestDriver.dll</H1>
    <B>Mark Mason</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Proposed%20change%20to%20TestDriver.dll&In-Reply-To="
       TITLE="[Mono-dev] Proposed change to TestDriver.dll">mmason at upwardaccess.com
       </A><BR>
    <I>Tue Dec  2 05:01:58 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="030047.html">[Mono-dev] MIPS port update
</A></li>
        <LI>Next message: <A HREF="030034.html">[Mono-dev] Proposed change to TestDriver.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30031">[ date ]</a>
              <a href="thread.html#30031">[ thread ]</a>
              <a href="subject.html#30031">[ subject ]</a>
              <a href="author.html#30031">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,

I'd like to propose the following change to TestDriver.dll. The purpose
of this patch is to avoid using the DateTime class unless timings are
explicitly called for. DateTime pulls in a lot of additional
infrastructure code which may cause the test harness itself to fail.
With this change, it's a lot easier to run the regression tests such as
basic.cs &amp; others with a JIT port in progress.

[Which is where the MIPS port is right now. There's something failing
waaaay down in the guts of DateTime, daylight savings time computations,
and such. It'd be a lot better to be able to uncover these problems with
the simple test cases in basic*.cs]

Thanks in advance,
Mark

Index: TestDriver.cs
===================================================================
--- TestDriver.cs       (revision 120080)
+++ TestDriver.cs       (working copy)
@@ -13,7 +13,6 @@
                bool do_timings = false;
                bool verbose = false;
                int tms = 0;
-               DateTime start, end = DateTime.Now;
 
                if (args != null &amp;&amp; args.Length &gt; 0) {
                        for (j = 0; j &lt; args.Length; j++) {
@@ -61,15 +60,18 @@
                        if (verbose)
                                Console.WriteLine (&quot;Running '{0}' ...&quot;,
name);
                        expected = Int32.Parse (name.Substring (5, j -
5));
-                       start = DateTime.Now;
-                       result = (int)methods [i].Invoke (null, null);
                        if (do_timings) {
-                               end = DateTime.Now;
+                               DateTime start = DateTime.Now;
+                               result = (int)methods [i].Invoke (null,
null);
+                               DateTime end = DateTime.Now;
                                long tdiff = end.Ticks - start.Ticks;
                                int mdiff = (int)tdiff/10000;
                                tms += mdiff;
                                Console.WriteLine (&quot;{0} took {1} ms&quot;,
name, mdiff);
                        }
+                       else {
+                               result = (int)methods [i].Invoke (null,
null);
+                       }
                        ran++;
                        if (result != expected) {
                                failed++;


</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030047.html">[Mono-dev] MIPS port update
</A></li>
	<LI>Next message: <A HREF="030034.html">[Mono-dev] Proposed change to TestDriver.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30031">[ date ]</a>
              <a href="thread.html#30031">[ thread ]</a>
              <a href="subject.html#30031">[ subject ]</a>
              <a href="author.html#30031">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
