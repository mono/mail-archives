<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] inlining and performance of SIMD code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20inlining%20and%20performance%20of%20SIMD%20code&In-Reply-To=4ADDE0F7.70606%40inria.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033619.html">
   <LINK REL="Next"  HREF="033623.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] inlining and performance of SIMD code</H1>
    <B>Rodrigo Kumpera</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20inlining%20and%20performance%20of%20SIMD%20code&In-Reply-To=4ADDE0F7.70606%40inria.fr"
       TITLE="[Mono-dev] inlining and performance of SIMD code">kumpera at gmail.com
       </A><BR>
    <I>Wed Dec  2 13:43:34 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033619.html">[Mono-dev] [PATCH] Use trampolines for vtable fixups (Windows)	(updated)
</A></li>
        <LI>Next message: <A HREF="033623.html">[Mono-dev] DateTimeOffset Test and Patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33620">[ date ]</a>
              <a href="thread.html#33620">[ thread ]</a>
              <a href="subject.html#33620">[ subject ]</a>
              <a href="author.html#33620">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Oct 20, 2009 at 2:10 PM, Erven Rohou &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">erven.rohou at inria.fr</A>&gt; wrote:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I have a few questions about inlining:
</I>&gt;<i>
</I>&gt;<i> - I am curious what the heuristics are. I looked at the function
</I>&gt;<i> mono_method_check_inlining, but even when the function returns TRUE, the
</I>&gt;<i> function might not be inlined. Could you point me the relevant piece of
</I>&gt;<i> code? Is
</I>&gt;<i> there any high level rule to make a guess, like complex control flow, use
</I>&gt;<i> of
</I>&gt;<i> certain opcode, etc?
</I>&gt;<i>
</I>
The code in mono_method_check_inlining is just an heristics of what methods
to
try to inline. The code that decides what gets inlined or not is in
mono_method_to_ir,
look for INLINE_FAILURE calls.




&gt;<i>
</I>&gt;<i> - Can I force inlining of a given function? Even a hack is fine, I am
</I>&gt;<i> trying to
</I>&gt;<i> evaluate several code generation schemes, and I would like to measure the
</I>&gt;<i> impact
</I>&gt;<i> of inlining. Whatever works is fine.
</I>&gt;<i>
</I>
This has been requested a few times, there is a patch floating on the
mailing list
that adds the beginning of the code required for such thing. Other than
that, no, there
is not way to force inlining.

As a hack you can simply change the heristics function to check against an
env var
and then make the call to inline_method pass true to the last argument.



&gt;<i> It seems that a simple copy propagation followed by dead code elimination
</I>&gt;<i> would
</I>&gt;<i> fix it. But I am not sure where I should look. Any comment or suggestion?
</I>&gt;<i>
</I>&gt;<i>
</I>Generating good code without the simd ops enabled was never the idea, but to
improve
it I fear we would need a scalar replacement pass, which is very tricky.

We could get most of the same benefit by using high level load/store from
vtypes
instructions and decompose them later. This would enable us to do apply the
usual
optimizations which right now are not enabled since we generate indirect
loads instructions
which disable most optimizations.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091202/e7d77b86/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091202/e7d77b86/attachment.html</A> 
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033619.html">[Mono-dev] [PATCH] Use trampolines for vtable fixups (Windows)	(updated)
</A></li>
	<LI>Next message: <A HREF="033623.html">[Mono-dev] DateTimeOffset Test and Patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33620">[ date ]</a>
              <a href="thread.html#33620">[ thread ]</a>
              <a href="subject.html#33620">[ subject ]</a>
              <a href="author.html#33620">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
