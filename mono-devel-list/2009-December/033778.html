<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] How to improve Dataset Performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20to%20improve%20Dataset%20Performance&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033768.html">
   <LINK REL="Next"  HREF="033612.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] How to improve Dataset Performance</H1>
    <B>APS</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20How%20to%20improve%20Dataset%20Performance&In-Reply-To="
       TITLE="[Mono-dev] How to improve Dataset Performance">dev.malst at apsystems.it
       </A><BR>
    <I>Thu Dec 24 03:57:55 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033768.html">[Mono-dev] How to improve Dataset Performance
</A></li>
        <LI>Next message: <A HREF="033612.html">[Mono-dev] Webservice Method that Returns a DataTable not working.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33778">[ date ]</a>
              <a href="thread.html#33778">[ thread ]</a>
              <a href="subject.html#33778">[ subject ]</a>
              <a href="author.html#33778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Jonathan,

as for the bug on Linq I hope this can help to improve performance of mono.

At 16.01 23/12/2009, Jonathan Chambers wrote:
&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>Here is some summarized profiler output in case 
</I>&gt;<i>anyone is interested in where the time is going. 
</I>&gt;<i>This is the above sample for 1000 rows instead 
</I>&gt;<i>of 10000, and with --profiler=default:time.
</I>&gt;<i>
</I>&gt;<i>Thanks,
</I>&gt;<i>Jonathan
</I>&gt;<i>
</I>&gt;<i>On Wed, Dec 9, 2009 at 9:20 AM, Oskar Berggren 
</I>&gt;<i>&lt;&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">oskar.berggren at gmail.com</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">oskar.berggren at gmail.com</A>&gt; wrote:
</I>&gt;<i>2009/12/9 APS &lt;&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dev.malst at apsystems.it</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dev.malst at apsystems.it</A>&gt;:
</I>&gt;<i> &gt; For sure I can pass a test case, is better 
</I>&gt;<i> that I file a bug report? I think
</I>&gt;<i> &gt; that Mono team already knows where datasets 
</I>&gt;<i> are slower than MS.Net and maybe
</I>&gt;<i> &gt; can suggest me some &quot;best practice&quot;.
</I>&gt;<i> &gt; Btw with the code provided below with MS.Net 
</I>&gt;<i> on a standard developer machine
</I>&gt;<i> &gt; and Mono on a bi-processor testing machine (with 2GB of ram):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1000 rows
</I>&gt;<i> &gt; MS.Net: 130ms
</I>&gt;<i> &gt; Mono 2.4.3:  1.2s
</I>&gt;<i> &gt; Mono 2.0.1:  3.5s
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 10.000 rows
</I>&gt;<i> &gt; MS.Net: less than a second
</I>&gt;<i> &gt; Mono 2.4.3: 114s
</I>&gt;<i> &gt; Mono 2.0.1: 361s
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>So when the data size increase by a factor of 
</I>&gt;<i>10, on &lt;<A HREF="http://ms.net">http://ms.net</A>&gt;ms.net the time
</I>&gt;<i>taken also seem to increase by a factor of 10, but on mono by a factor
</I>&gt;<i>of 100. Seems like an an O(N) versus an O(N&#178;) algorithm.
</I>&gt;<i>
</I>&gt;<i>The code below contains a loop and you claim the Select part is taking
</I>&gt;<i>the most time. If that is true, it seems to 
</I>&gt;<i>indicate that &lt;<A HREF="http://ms.net">http://ms.net</A>&gt;ms.net
</I>&gt;<i>Select() for this case is O(1) but mono's O(N), with N being the
</I>&gt;<i>number of rows in the table.
</I>&gt;<i>
</I>&gt;<i>/Oskar
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I have tables with more than 50.000 rows...I 
</I>&gt;<i> don't know how much it takes to
</I>&gt;<i> &gt; perform the elaboration. RowFilter speed up only if applied on small
</I>&gt;<i> &gt; rowsets.
</I>&gt;<i> &gt; The problem is in the .Select method, removing those lines the elaboration
</I>&gt;<i> &gt; is quicker in Mono. Testing machines are not 
</I>&gt;<i> with the same resources but the
</I>&gt;<i> &gt; difference is too much to think to an hardware difference.
</I>&gt;<i> &gt; Here is the code...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;             DataSet ds1 = new DataSet();
</I>&gt;<i> &gt;             ds1.Tables.Add();
</I>&gt;<i> &gt;             ds1.Tables[0].Columns.Add(&quot;COL1&quot;, typeof(string));
</I>&gt;<i> &gt;             ds1.Tables[0].Columns.Add(&quot;COL2&quot;, typeof(int));
</I>&gt;<i> &gt;             ds1.Tables[0].Columns.Add(&quot;COL3&quot;, typeof(bool));
</I>&gt;<i> &gt;             for (int i = 0; i &lt; 10000; i++) {
</I>&gt;<i> &gt;                 ds1.Tables[0].Rows.Add(new object[] { &quot;test&quot;, i, true });
</I>&gt;<i> &gt;             }
</I>&gt;<i> &gt;             DataSet ds2 = new DataSet();
</I>&gt;<i> &gt;             ds2.Tables.Add();
</I>&gt;<i> &gt;             ds2.Tables[0].Columns.Add(&quot;COL1&quot;, typeof(string));
</I>&gt;<i> &gt;             ds2.Tables[0].Columns.Add(&quot;COL2&quot;, typeof(int));
</I>&gt;<i> &gt;             ds2.Tables[0].Columns.Add(&quot;COL3&quot;, typeof(bool));
</I>&gt;<i> &gt;             for (int i = 0; i &lt; 10000; i++) {
</I>&gt;<i> &gt;                 ds2.Tables[0].Rows.Add(new object[] { &quot;test&quot;, i, true });
</I>&gt;<i> &gt;             }
</I>&gt;<i> &gt;             DataSet ds3 = new DataSet();
</I>&gt;<i> &gt;             ds3.Tables.Add();
</I>&gt;<i> &gt;             ds3.Tables[0].Columns.Add(&quot;COL1&quot;, typeof(string));
</I>&gt;<i> &gt;             ds3.Tables[0].Columns.Add(&quot;COL2&quot;, typeof(int));
</I>&gt;<i> &gt;             ds3.Tables[0].Columns.Add(&quot;COL3&quot;, typeof(bool));
</I>&gt;<i> &gt;             for (int i = 0; i &lt; 10000; i++) {
</I>&gt;<i> &gt;                 ds3.Tables[0].Rows.Add(new object[] { &quot;test&quot;, i, true });
</I>&gt;<i> &gt;             }
</I>&gt;<i> &gt;             int idx=0;
</I>&gt;<i> &gt;             foreach (DataRow dr in ds1.Tables[0].Rows) {
</I>&gt;<i> &gt;                 DataRow[] dr2 = ds2.Tables[0].Select(&quot;COL2=&quot; + idx);
</I>&gt;<i> &gt;                 DataRow[] dr3 = ds3.Tables[0].Select(&quot;COL2=&quot; + idx);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;                 idx++;
</I>&gt;<i> &gt;             }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; At 21.59 02/12/2009, Nagappan Alagappan wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hello,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Do you have a test case to reproduce this issue, which you could share with
</I>&gt;<i> &gt; the Mono team ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt; Nagappan
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Wed, Dec 2, 2009 at 4:05 AM, APS 
</I>&gt;<i> &lt;&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dev.malst at apsystems.it</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">dev.malst at apsystems.it</A> &gt; wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm testing some old elaboration that cycles on a large datatable and
</I>&gt;<i> &gt; for every rows makes several selections on separated datatables.
</I>&gt;<i> &gt; This elaboration is really slow on mono and 
</I>&gt;<i> fast on &lt;<A HREF="http://MS.NET">http://MS.NET</A>&gt;MS.NET, let say
</I>&gt;<i> &gt; 400secs vs 4 secs.
</I>&gt;<i> &gt; It seems that last rows are slower that first rows.
</I>&gt;<i> &gt; I made some test on datasets scroll and I saw that mono performance
</I>&gt;<i> &gt; is better than &lt;<A HREF="http://MS.NET">http://MS.NET</A>&gt;MS.NET so the 
</I>&gt;<i> delay is due to inner selections.
</I>&gt;<i> &gt; I changed datatable.select in defaultview.sort and I gained 200secs,
</I>&gt;<i> &gt; still too slow.
</I>&gt;<i> &gt; Now I've identified some datatable.compute as the main delay source.
</I>&gt;<i> &gt; I'll try to change them using Linq but the question is: there's some
</I>&gt;<i> &gt; known performance problem in dataset heavy usage, there's some best
</I>&gt;<i> &gt; pratice that you can suggest to speed up elaborations?
</I>&gt;<i> &gt; Thanks in advance.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Linux Desktop (GUI Application) Testing Project -
</I>&gt;<i> &gt; &lt;<A HREF="http://ldtp.freedesktop.org">http://ldtp.freedesktop.org</A>&gt;<A HREF="http://ldtp.freedesktop.org">http://ldtp.freedesktop.org</A>
</I>&gt;<i> &gt; <A HREF="http://nagappanal.blogspot.com">http://nagappanal.blogspot.com</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Il messaggio e' stato analizzato alla ricerca di virus o
</I>&gt;<i> &gt; contenuti pericolosi da MailScanner, ed e'
</I>&gt;<i> &gt; risultato non infetto.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; &lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-devel-list mailing list
</I>&gt;<i>&lt;mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>&gt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>Il messaggio e' stato analizzato alla ricerca di virus o
</I>&gt;<i>contenuti pericolosi da &lt;<A HREF="http://www.mailscanner.info/">http://www.mailscanner.info/</A>&gt;MailScanner, ed e'
</I>&gt;<i>risultato non infetto.
</I>&gt;<i>Content-Type: text/plain; charset=US-ASCII; name=&quot;out.txt&quot;
</I>&gt;<i>Content-Disposition: attachment; filename=&quot;out.txt&quot;
</I>&gt;<i>X-Attachment-Id: f_g3k896wd0
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091224/babdb7e9/attachment-0001.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091224/babdb7e9/attachment-0001.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033768.html">[Mono-dev] How to improve Dataset Performance
</A></li>
	<LI>Next message: <A HREF="033612.html">[Mono-dev] Webservice Method that Returns a DataTable not working.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33778">[ date ]</a>
              <a href="thread.html#33778">[ thread ]</a>
              <a href="subject.html#33778">[ subject ]</a>
              <a href="author.html#33778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
