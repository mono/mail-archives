<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] [PATCH] Bind d(n)gettext in Mono.Unix.Catalog
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Bind%20d%28n%29gettext%20in%20Mono.Unix.Catalog&In-Reply-To=1259863770.4707.334.camel%40lina.magi.jprl.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033638.html">
   <LINK REL="Next"  HREF="033637.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] [PATCH] Bind d(n)gettext in Mono.Unix.Catalog</H1>
    <B>Stephane Delcroix</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20%5BPATCH%5D%20Bind%20d%28n%29gettext%20in%20Mono.Unix.Catalog&In-Reply-To=1259863770.4707.334.camel%40lina.magi.jprl.com"
       TITLE="[Mono-dev] [PATCH] Bind d(n)gettext in Mono.Unix.Catalog">stephane at delcroix.org
       </A><BR>
    <I>Thu Dec  3 15:02:04 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033638.html">[Mono-dev] [PATCH] Bind d(n)gettext in Mono.Unix.Catalog
</A></li>
        <LI>Next message: <A HREF="033637.html">[Mono-dev] Getting rid of String.InternalSetLength
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33639">[ date ]</a>
              <a href="thread.html#33639">[ thread ]</a>
              <a href="subject.html#33639">[ subject ]</a>
              <a href="author.html#33639">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>	After some thought, this patch isn't a good idea, as you're supposed to
bindtextdomain() prior to d(n)gettext, and even if Catalog.Init () do
the bindtextdomain(), it also does an extra textdomain() call which is
unfortunate in this case.

	So, let's forget about this, we found a solution with lluis earlier
today, reusing MA translation code.

S


On Thu, 2009-12-03 at 13:09 -0500, Jonathan Pryor wrote:
&gt;<i> On Thu, 2009-12-03 at 13:22 +0100, Stephane Delcroix wrote:
</I>&gt;<i> &gt; Here's a patch for Mono.Unix that P/Invoke d(n)gettext in addition to
</I>&gt;<i> &gt; (n)gettext. It's quite useful for writing libraries requiring
</I>&gt;<i> &gt; translations (think of Mono.Addins.Gui), esp. since GNU-gettext doesn't
</I>&gt;<i> &gt; support multiple domains.
</I>&gt;<i> 
</I>&gt;<i> One problem: you're *removing*
</I>&gt;<i> Catalog.GetPluralString(string,string.int).  That's bad. :-)
</I>&gt;<i> 
</I>&gt;<i> Also, for your new GetPluralString() method, instead of using
</I>&gt;<i> MarshalStrings() (with an _ignore argument) +
</I>&gt;<i> UnixMarshal.StringToHeap(), combine the two so that MarshalStrings()
</I>&gt;<i> isn't getting an _ignore argument.
</I>&gt;<i> 
</I>&gt;<i> That aside, it looks good, though I do wonder if the overloading here is
</I>&gt;<i> a good idea.
</I>&gt;<i> 
</I>&gt;<i> Basically, we'll wind up with this:
</I>&gt;<i> 
</I>&gt;<i>         public class Catalog {
</I>&gt;<i>                 public static string GetPluralString (string s, string p, int n);
</I>&gt;<i>                 public static string GetPluralString (string domain, string s, string p, int n);
</I>&gt;<i>                 
</I>&gt;<i>                 public static string GetString (string s);
</I>&gt;<i>                 public static string GetString (string domain, string
</I>&gt;<i>                 s);
</I>&gt;<i>                 // ...
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i> Generally, when overloading a method the first arguments should have the
</I>&gt;<i> same meaning, and &quot;optional&quot; arguments should be last.  Thus:
</I>&gt;<i> 
</I>&gt;<i>         public class Catalog { 
</I>&gt;<i>                 public static string GetPluralString (string s, string p, int n);
</I>&gt;<i>                 public static string GetPluralString (string s, string p, int n, string domain);
</I>&gt;<i>                 
</I>&gt;<i>                 public static string GetString (string s);
</I>&gt;<i>                 public static string GetString (string s, string
</I>&gt;<i>                 domain);
</I>&gt;<i>                 // ...
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i> &quot;Prior art,&quot; as it were, is System.Diagnostics.Trace.WriteLine[0]:
</I>&gt;<i> 
</I>&gt;<i>         public class Trace {
</I>&gt;<i>                 public static void WriteLine (string message);
</I>&gt;<i>                 public static void WriteLine (string message, string
</I>&gt;<i>                 category);
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i> So I'm torn as to the &quot;proper&quot; thing to do here, as we have three
</I>&gt;<i> choices:
</I>&gt;<i> 
</I>&gt;<i>      1. Follow convention and make the 'domain' parameter last (above).
</I>&gt;<i>      2. Break convention and make the 'domain' parameter first
</I>&gt;<i>         (original).
</I>&gt;<i>      3. Use different method names, e.g. GetDomainString(),
</I>&gt;<i>         GetPluralDomainString(), and keep 'domain' as the first
</I>&gt;<i>         parameter.
</I>&gt;<i> 
</I>&gt;<i> Of these choices, I'm inclined toward (3) or (1), but could be argued
</I>&gt;<i> either way.
</I>&gt;<i> 
</I>&gt;<i> Thoughts?
</I>&gt;<i> 
</I>&gt;<i>  - Jon
</I>&gt;<i> 
</I>&gt;<i> [0]
</I>&gt;<i> <A HREF="http://msdn.microsoft.com/en-us/library/system.diagnostics.trace.writeline.aspx">http://msdn.microsoft.com/en-us/library/system.diagnostics.trace.writeline.aspx</A>
</I>&gt;<i> 
</I>

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033638.html">[Mono-dev] [PATCH] Bind d(n)gettext in Mono.Unix.Catalog
</A></li>
	<LI>Next message: <A HREF="033637.html">[Mono-dev] Getting rid of String.InternalSetLength
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33639">[ date ]</a>
              <a href="thread.html#33639">[ thread ]</a>
              <a href="subject.html#33639">[ subject ]</a>
              <a href="author.html#33639">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
