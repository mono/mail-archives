<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] System.Reflection.Assembly::Load Performance?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20System.Reflection.Assembly%3A%3ALoad%20Performance%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033601.html">
   <LINK REL="Next"  HREF="033604.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] System.Reflection.Assembly::Load Performance?</H1>
    <B>Babbage Linden</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20System.Reflection.Assembly%3A%3ALoad%20Performance%3F&In-Reply-To="
       TITLE="[Mono-dev] System.Reflection.Assembly::Load Performance?">babbage at lindenlab.com
       </A><BR>
    <I>Tue Dec  1 12:02:11 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="033601.html">[Mono-dev] Mono 2.6 preview tarball misses mcs/class/dlr
</A></li>
        <LI>Next message: <A HREF="033604.html">[Mono-dev] System.Reflection.Assembly::Load Performance?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33602">[ date ]</a>
              <a href="thread.html#33602">[ thread ]</a>
              <a href="subject.html#33602">[ subject ]</a>
              <a href="author.html#33602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I'm currently investigating a performance problem which is causing complex
objects in Second Life containing many scripts to take a long time to load.

We embed Mono in the Second Life simulator, so I turned on the profiler
before initialising the runtime:

mono_profiler_load(&quot;default:stat&quot;);
mono_jit_init(&quot;root domain&quot;);
mono_internal_call_init();

After shutting down the simulator, the profiler reported the slow method as
being System.Reflection.Assembly::Load(byte[]), with each call taking
19.961ms:

Time(ms) Count   P/call(ms) Method name
########################
 4052.135     203   19.961   System.Reflection.Assembly::Load(byte[])
  Callers (with count) that contribute at least for 1%:
         102  50 % LindenLab.SecondLife.Script::.ctor(string,byte[],long&amp;)
         101  49 % LindenLab.SecondLife.Script::Deserialize(byte[],byte[])

Does this seem right? We're just passing an assembly as bytes to Mono and
asking it to turn it in to an assembly, 19ms seems like a long time to do
that.

Are there any faster ways we could do this? In the example above an object
with 200 scripts in it is taking 4s to load, which is much faster than with
an LSL script.

I get similar results using mono 1.2.6 (which we have embedded in Second
Life) or revision 146428, which is pretty close to the tip of svn.

Also, the profiler seems to output it's results the first time we unload a
domain, is there a way to stop that happening, so we get the full output on
shut down?

(How should we be creating and destroying appdomains from unmanaged code:
we're currently using ves_icall_System_AppDomain_InternalUnload from
unmanaged code to unload domains, which is less than ideal...)

Cheers,

Jim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091201/8f6f6d45/attachment.html">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20091201/8f6f6d45/attachment.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033601.html">[Mono-dev] Mono 2.6 preview tarball misses mcs/class/dlr
</A></li>
	<LI>Next message: <A HREF="033604.html">[Mono-dev] System.Reflection.Assembly::Load Performance?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33602">[ date ]</a>
              <a href="thread.html#33602">[ thread ]</a>
              <a href="subject.html#33602">[ subject ]</a>
              <a href="author.html#33602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
