<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] TimeStamp support on oracle...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20TimeStamp%20support%20on%20oracle...&In-Reply-To=200507281750.29575.informatique.internet%40fiducial.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013500.html">
   <LINK REL="Next"  HREF="013537.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] TimeStamp support on oracle...</H1>
    <B>Daniel Morgan</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20TimeStamp%20support%20on%20oracle...&In-Reply-To=200507281750.29575.informatique.internet%40fiducial.fr"
       TITLE="[Mono-devel-list] TimeStamp support on oracle...">danielmorgan at verizon.net
       </A><BR>
    <I>Thu Jul 28 20:48:02 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013500.html">[Mono-devel-list] TimeStamp support on oracle...
</A></li>
        <LI>Next message: <A HREF="013537.html">[Mono-devel-list] TimeStamp support on oracle...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13531">[ date ]</a>
              <a href="thread.html#13531">[ thread ]</a>
              <a href="subject.html#13531">[ subject ]</a>
              <a href="author.html#13531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You need to modify OciDefineHandle to deal with the TIMESTAMP.

See Define(), DefineDate(), and GetValue().

You can create a new function called DefineTimestamp() based on 
DefineDate() and allocate space for it based OciDataType.TimeStamp.

What about TIMESTAMP WITH TIMEZONE and TIMESTAMP WITH LOCAL TIMEZONE?

There is also INTERVAL YEAR TO MONTH and INTERVAL DAY TO SECOND data 
types. This is equivalent to System.TimeSpan and 
System.Data.OracleClient types OracleMonthSpan and OracleTimeSpan.   
These have not been implemented either.

Also, in OracleParameter, you need to allocate space for the Timestamp 
for the output parameter, and you need to convert a .NET DateTime to an 
Oracle TIMESTAMP by using OCIDateTime functions for the input parameter.

An Oracle Date uses OCIDate while TIMESTAMP uses an OCIDateTime.

You will need to DllImport into function OCIDateTimeConstruct() to 
create and set the date and time in a OCIDateTime.  You will also need 
to DllImport into function OCIDateTimeGetTime() to get the time from the 
OCIDateTime and OCIDateTimeGetDate() to get the date from the 
OCIDateTime.  There are other functions for the time zone, etc...

<A HREF="http://download-east.oracle.com/docs/cd/B19306_01/appdev.102/b14250/oci18map002.htm#i512069">http://download-east.oracle.com/docs/cd/B19306_01/appdev.102/b14250/oci18map002.htm#i512069</A>

Hubert FONGARNAND wrote:

&gt;<i>I really need the new TimeStamp type (supported starting from oracle 9). It's 
</I>&gt;<i>a MS.NET supported type (i've made tests)...
</I>&gt;<i>I've begin to do a little patch (attached) to add the timestamp type to 
</I>&gt;<i>oracle.client...
</I>&gt;<i>but... I've a strange error when i try to do a Fill, it failed with:
</I>&gt;<i>
</I>&gt;<i>Unhandled Exception: System.Data.OracleClient.OracleException:
</I>&gt;<i>in &lt;0x0013d&gt; System.Data.OracleClient.Oci.OciStatementHandle:Fetch ()
</I>&gt;<i>in &lt;0x0002c&gt; System.Data.OracleClient.OracleDataReader:Read ()
</I>&gt;<i>in &lt;0x002f4&gt; System.Data.Common.DbDataAdapter:FillTable (System.Data.DataTable 
</I>&gt;<i>dataTable, IDataReader dataReader, Int32 startRecord, Int32 maxRecords, 
</I>&gt;<i>System.Int32 counter)
</I>&gt;<i>in &lt;0x0011f&gt; System.Data.Common.DbDataAdapter:Fill (System.Data.DataSet 
</I>&gt;<i>dataSet, System.String srcTable, IDataReader dataReader, Int32 startRecord, 
</I>&gt;<i>Int32 maxRecords)
</I>&gt;<i>in &lt;0x000d5&gt; System.Data.Common.DbDataAdapter:Fill (System.Data.DataSet 
</I>&gt;<i>dataSet, Int32 startRecord, Int32 maxRecords, System.String srcTable, 
</I>&gt;<i>IDbCommand command, CommandBehavior behavior)
</I>&gt;<i>in &lt;0x00044&gt; System.Data.Common.DbDataAdapter:Fill (System.Data.DataSet 
</I>&gt;<i>dataSet)
</I>&gt;<i>in &lt;0x007b8&gt; ConsoleIntranet.Class1:TestTimestamp ()
</I>&gt;<i>in &lt;0x00015&gt; ConsoleIntranet.Class1:Main (System.String[] args)
</I>&gt;<i>
</I>&gt;<i>Could someone help me how to resolve this issue?
</I>&gt;<i>thanks
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Ce message et les &#233;ventuels documents joints peuvent contenir des informations confidentielles.
</I>&gt;<i>Au cas o&#249; il ne vous serait pas destin&#233;, nous vous remercions de bien vouloir le supprimer et en aviser imm&#233;diatement l'exp&#233;diteur. Toute utilisation de ce message non conforme &#224; sa destination, toute diffusion ou publication, totale ou partielle et quel qu'en soit le moyen est formellement interdite.
</I>&gt;<i>Les communications sur internet n'&#233;tant pas s&#233;curis&#233;es, l'int&#233;grit&#233; de ce message n'est pas assur&#233;e et la soci&#233;t&#233; &#233;mettrice ne peut &#234;tre tenue pour responsable de son contenu.
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>Index: mcs/class/System.Data.OracleClient/System.Data.OracleClient/OracleParameter.cs
</I>&gt;<i>===================================================================
</I>&gt;<i>--- mcs/class/System.Data.OracleClient/System.Data.OracleClient/OracleParameter.cs      (revision 47807)
</I>&gt;<i>+++ mcs/class/System.Data.OracleClient/System.Data.OracleClient/OracleParameter.cs      (working copy)
</I>&gt;<i>@@ -258,7 +258,7 @@
</I>&gt;<i>                        OciDataType bindType = ociType;
</I>&gt;<i>                        IntPtr bindValue = IntPtr.Zero;
</I>&gt;<i>                        int rsize = 0;
</I>&gt;<i>-
</I>&gt;<i>+                       Console.WriteLine(&quot;Parametre : &quot;+ociType.ToString());
</I>&gt;<i>                        // TODO: handle InputOutput and Return parameters
</I>&gt;<i>                        if (direction == ParameterDirection.Output) {
</I>&gt;<i>                                // TODO: need to figure out how OracleParameter
</I>&gt;<i>@@ -324,9 +324,11 @@
</I>&gt;<i>                                bindSize = 0;
</I>&gt;<i>                        }
</I>&gt;<i>                        else {
</I>&gt;<i>+                               Console.WriteLine(&quot;OracleType &quot;+oracleType.ToString());
</I>&gt;<i>                                // TODO: do other data types and oracle data types
</I>&gt;<i>                                // should I be using IConvertible to convert?
</I>&gt;<i>                                if (oracleType == OracleType.DateTime) {
</I>&gt;<i>+                                       Console.WriteLine(&quot;DATE!!!&quot;);
</I>&gt;<i>                                        string oraDateFormat = connection.GetSessionDateFormat ();
</I>&gt;<i>                                        string sysDateFormat = OracleDateTime.ConvertOracleDateFormatToSystemDateTime (oraDateFormat);
</I>&gt;<i>
</I>&gt;<i>@@ -637,8 +639,11 @@
</I>&gt;<i>                                dbType = DbType.AnsiStringFixedLength;
</I>&gt;<i>                                ociType = OciDataType.Char;
</I>&gt;<i>                                break;
</I>&gt;<i>+                       case OracleType.Timestamp:
</I>&gt;<i>+                               dbType = DbType.DateTime;
</I>&gt;<i>+                               ociType = OciDataType.TimeStamp;
</I>&gt;<i>+                               break;
</I>&gt;<i>                        case OracleType.DateTime:
</I>&gt;<i>-                       case OracleType.Timestamp:
</I>&gt;<i>                        case OracleType.TimestampLocal:
</I>&gt;<i>                        case OracleType.TimestampWithTZ:
</I>&gt;<i>                                dbType = DbType.DateTime;
</I>&gt;<i>Index: mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciDataType.cs
</I>&gt;<i>===================================================================
</I>&gt;<i>--- mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciDataType.cs      (revision 47807)
</I>&gt;<i>+++ mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciDataType.cs      (working copy)
</I>&gt;<i>@@ -43,6 +43,7 @@
</I>&gt;<i>                Blob = 0x71,
</I>&gt;<i>                BFile = 0x72,
</I>&gt;<i>                OciString = 0x9b,
</I>&gt;<i>-               OciDate = 0x9c
</I>&gt;<i>+               OciDate = 0x9c,
</I>&gt;<i>+               TimeStamp = 0xbb
</I>&gt;<i>        }
</I>&gt;<i> }
</I>&gt;<i>Index: mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciParameterDescriptor.cs
</I>&gt;<i>===================================================================
</I>&gt;<i>--- mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciParameterDescriptor.cs   (revision 47807)
</I>&gt;<i>+++ mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciParameterDescriptor.cs   (working copy)
</I>&gt;<i>@@ -67,6 +67,7 @@
</I>&gt;<i>
</I>&gt;<i>                public static OracleType OciDataTypeToOracleType (OciDataType ociType)
</I>&gt;<i>                {
</I>&gt;<i>+                       Console.WriteLine(ociType.ToString());
</I>&gt;<i>                        switch (ociType) {
</I>&gt;<i>                        case OciDataType.VarChar2:
</I>&gt;<i>                                return OracleType.VarChar;
</I>&gt;<i>@@ -120,6 +121,8 @@
</I>&gt;<i>                                return OracleType.VarChar;
</I>&gt;<i>                        case OciDataType.OciDate:
</I>&gt;<i>                                return OracleType.DateTime;
</I>&gt;<i>+                       case OciDataType.TimeStamp:
</I>&gt;<i>+                               return OracleType.Timestamp;
</I>&gt;<i>                        default:
</I>&gt;<i>                                throw new NotImplementedException ();
</I>&gt;<i>                        }
</I>&gt;<i>@@ -180,6 +183,8 @@
</I>&gt;<i>                                return typeof (System.String);
</I>&gt;<i>                        case &quot;OciDate&quot;:
</I>&gt;<i>                                return typeof (System.DateTime);
</I>&gt;<i>+                       case &quot;TimeStamp&quot;:
</I>&gt;<i>+                               return typeof (System.DateTime);
</I>&gt;<i>                        default:
</I>&gt;<i>                                // FIXME: are these types correct?
</I>&gt;<i>                                return typeof(System.String);
</I>&gt;<i>@@ -242,6 +247,8 @@
</I>&gt;<i>                                        return &quot;OciString&quot;;
</I>&gt;<i>                                case OciDataType.OciDate:
</I>&gt;<i>                                        return &quot;OciDate&quot;;
</I>&gt;<i>+                               case OciDataType.TimeStamp:
</I>&gt;<i>+                                       return &quot;TimeStamp&quot;;
</I>&gt;<i>                                default:
</I>&gt;<i>                                        return &quot;Unknown&quot;;
</I>&gt;<i>                        }
</I>&gt;<i>Index: mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciStatementHandle.cs
</I>&gt;<i>===================================================================
</I>&gt;<i>--- mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciStatementHandle.cs       (revision 47807)
</I>&gt;<i>+++ mcs/class/System.Data.OracleClient/System.Data.OracleClient.Oci/OciStatementHandle.cs       (working copy)
</I>&gt;<i>@@ -212,8 +212,9 @@
</I>&gt;<i>                                1,
</I>&gt;<i>                                2,
</I>&gt;<i>                                0);
</I>&gt;<i>-
</I>&gt;<i>+               Console.WriteLine(&quot;FETCH &quot;+status.ToString());
</I>&gt;<i>                        switch (status) {
</I>&gt;<i>+
</I>&gt;<i>                        case OciGlue.OCI_NO_DATA:
</I>&gt;<i>                                moreResults = false;
</I>&gt;<i>                                break;
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i>------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Mono-devel-list mailing list
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i><A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>  
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013500.html">[Mono-devel-list] TimeStamp support on oracle...
</A></li>
	<LI>Next message: <A HREF="013537.html">[Mono-devel-list] TimeStamp support on oracle...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13531">[ date ]</a>
              <a href="thread.html#13531">[ thread ]</a>
              <a href="subject.html#13531">[ subject ]</a>
              <a href="author.html#13531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
