<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20%5BPATCH%5D%20Race%20condition%20when%20restarting%0A%09threads&In-Reply-To=65953E8166311641A685BDF71D8658262B707F%40cacexc12.americas.cpqcorp.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013136.html">
   <LINK REL="Next"  HREF="013126.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads</H1>
    <B>Ben Maurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20RE%3A%20%5BGc%5D%20%5BPATCH%5D%20Race%20condition%20when%20restarting%0A%09threads&In-Reply-To=65953E8166311641A685BDF71D8658262B707F%40cacexc12.americas.cpqcorp.net"
       TITLE="[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads">bmaurer at ximian.com
       </A><BR>
    <I>Tue Jul 12 14:22:27 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013136.html">[Mono-devel-list] SQLServer SessionState
</A></li>
        <LI>Next message: <A HREF="013126.html">[Mono-devel-list] mono + asp.net + cyrillic characters problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13125">[ date ]</a>
              <a href="thread.html#13125">[ thread ]</a>
              <a href="subject.html#13125">[ subject ]</a>
              <a href="author.html#13125">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 2005-07-12 at 11:13 -0700, Boehm, Hans wrote:
&gt;<i> I think I generally also prefer your solution.
</I>&gt;<i> 
</I>&gt;<i> But it seems to me that it has a very low probability memory ordering
</I>&gt;<i> issue.
</I>&gt;<i> 
</I>&gt;<i> If I see GC_world_is_stopped set because I'm trying to stop the
</I>&gt;<i> world for the next GC, but I still see the old value of GC_stop_count
</I>&gt;<i> (due to compiler or hardware memory reordering), I think it deadlocks.
</I>&gt;<i> My ugly version will just pause for 25msecs and then recover.
</I>&gt;<i> 
</I>&gt;<i> I think I'll go with your version for GC7, where I have a cleaner
</I>&gt;<i> way of enforcing the memory ordering, and keep my version for 6.6.
</I>&gt;<i> (This assumes we find no other problems.  This stuff is much too
</I>&gt;<i> subtle.)
</I>
Your patch had the fields set as volatile, so shouldn't the compiler
ensure that the cpu does not reorder the stores?

What if you only used one field for both the stop count and world is
stopped field (setting the flag for stopped on the highest bit). The
value is only modified in one thread at a time, so you don't have to CAS
or anything. The cpu would be forbidden from reordering writes (they
shouldn't reorder writes to the same field).

-- Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013136.html">[Mono-devel-list] SQLServer SessionState
</A></li>
	<LI>Next message: <A HREF="013126.html">[Mono-devel-list] mono + asp.net + cyrillic characters problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13125">[ date ]</a>
              <a href="thread.html#13125">[ thread ]</a>
              <a href="subject.html#13125">[ subject ]</a>
              <a href="author.html#13125">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
