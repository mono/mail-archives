<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] The first (attempt to checkin) managed collation	patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20The%20first%20%28attempt%20to%20checkin%29%20managed%20collation%0A%09patch&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013252.html">
   <LINK REL="Next"  HREF="013260.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] The first (attempt to checkin) managed collation	patch</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20The%20first%20%28attempt%20to%20checkin%29%20managed%20collation%0A%09patch&In-Reply-To="
       TITLE="[Mono-devel-list] The first (attempt to checkin) managed collation	patch">atsushi at ximian.com
       </A><BR>
    <I>Wed Jul 20 13:12:50 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013252.html">[Mono-devel-list] [PATCH] Correct some events thrown by DataView
</A></li>
        <LI>Next message: <A HREF="013260.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13258">[ date ]</a>
              <a href="thread.html#13258">[ thread ]</a>
              <a href="subject.html#13258">[ subject ]</a>
              <a href="author.html#13258">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I think it could be the time to merge my managed collation patch
that enables Windows like collation at managed code side.

** The changes I want to make

The attached patch. Actually it is already in svn:
mcs/class/corlib/Mono.Globalization.Unicode/managed-collation.patch

But besides the patch, I need to checkin 7 prebuilt binary resource
files in mcs/class/corlib directory, though they can be built when
you run &quot;make&quot; in mcs/class/corlib/Mono.Globalization.Unicode. [*1]
I put all the binaries here:
<A HREF="http://monkey.workarea.jp/tmp/20050720">http://monkey.workarea.jp/tmp/20050720</A>

** How it affects on mono

It still does not enable managed collation unless you explicitly
set environment variable MONO_USE_MANAGED_COLLATION=yes.

I can build mcs with this managed collation mode and all corlib
tests pass (I guess other tests as well).

When this managed collation is enabled, it will eat huge managed
resource (and will make you sad when you run mono --profile ;-).
I can make this into unmanaged header file if we want.

Also, currently managed collation is extremely *slow* since it
lacks a significant optimization, to just compare codepoints
as long as possible (safe character comparison).

** How it is stable

It is not stable yet, but most of the expected changes are 1)sortkey
table fixes, 2) culture-dependent tailoring data, and 3)optimization.

It still does not work fine on Latin, Greek, Cyrillic and Arabic
(mostly, on those characters with diacritical mark).

There are already a couple of working managed collation tests that
do not run unless the environment variable is set.

This fixes bug #69771, #70478, #71111, #73417 i.e. all reported
collation bugs (for #69771 Microsoft's sample code is buggy though).


Would there be any problem if I commit this patch? Comments are
welcome.

----
[*1] I don't think it can be incorporated in the build step since
1) it requires some downloads like locale-builder, 2) the table
generation is so slow, and 3) sometimes it might generate broken
table because the binary resource generator is also written in C#
and it's not always ordinal (I should sanitize the code at some
stage when it became stable though).


Atsushi Eno
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: managed-collation.patch
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050721/c75311ba/attachment.pl">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050721/c75311ba/attachment.pl</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013252.html">[Mono-devel-list] [PATCH] Correct some events thrown by DataView
</A></li>
	<LI>Next message: <A HREF="013260.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13258">[ date ]</a>
              <a href="thread.html#13258">[ thread ]</a>
              <a href="subject.html#13258">[ subject ]</a>
              <a href="author.html#13258">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
