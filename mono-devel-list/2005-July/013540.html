<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] MonoDevelop autopackage example
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20MonoDevelop%20autopackage%20example&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013560.html">
   <LINK REL="Next"  HREF="013541.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] MonoDevelop autopackage example</H1>
    <B>Mike Hearn</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20MonoDevelop%20autopackage%20example&In-Reply-To="
       TITLE="[Mono-devel-list] MonoDevelop autopackage example">m.hearn at signal.QinetiQ.com
       </A><BR>
    <I>Fri Jul 29 05:09:08 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013560.html">[Mono-devel-list] [PATCH] Assembly.GetReferencedAssemblies
</A></li>
        <LI>Next message: <A HREF="013541.html">[Mono-devel-list] Re: Mono-devel-list Digest, Vol 3, Issue 83
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13540">[ date ]</a>
              <a href="thread.html#13540">[ thread ]</a>
              <a href="subject.html#13540">[ subject ]</a>
              <a href="author.html#13540">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Last night I put together a basic autopackage of MonoDevelop. I also wrote a
simple C stub program to replace the startup shell script, so it can be fully
relocatable.

I haven't tested the package extensively, beyond a simple &quot;does it install and
run?&quot; check. A MonoDevelop developer would be the best person to create such a
package, as they understand their own software better than I ever will.

Nonetheless, I wanted to show that it's really not hard at all.
To create the package, you feed the specfile to the &quot;makeinstaller&quot; program,
and out pops a package, same as RPM or NSIS or any similar system.

Please note: I haven't been able to upload the package anywhere, as I only
have web/email access during the week, no ssh or FTP. I'll upload the actual
binary package for people to play with at the weekend.

OK, here is the specfile:

----------------------------------------------------------------------------


# -*-shell-script-*-

[Meta]
RootName: @monodevelop.com/monodevelop:$SOFTWAREVERSION
DisplayName: MonoDevelop Integrated Development Environment
ShortName: monodevelop
Maintainer: Todd Berman &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">tberman at off.net</A>&gt;
Packager: Mike Hearn &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mike at plan99.net</A>&gt;
Summary: MonoDevelop is a development environment for the .NET platform
URL: <A HREF="http://www.monodevelop.com/">http://www.monodevelop.com/</A>
License: GNU General Public License, Version 2
SoftwareVersion: 0.7
PackageVersion: 1
AutopackageTarget: 1.0

# Only uncomment InterfaceVersion if your package exposes interfaces
# to other software, for instance if it includes DSOs or python/perl
# modules. See the developer guide for more info, or ask on
# autopackage-dev if you don't understand interface versioning.
#
# FIXME: MonoDevelop has a plugin interface of some kind so we should set this.
#
# InterfaceVersion: 0.0

[BuildPrepare]
prepareBuild

# this stub program should really come with autopackage, and be easier
# to integrate. for for a proof of concept we will compile it
# ourselves. the stub takes care of making us binary relocatable.

cd $source_dir/autopackage
gcc -Os -o monodevelop -DPREFIXPATH=\&quot;lib/monodevelop/bin/MonoDevelop.exe\&quot; monostub.c binreloc.c
cd -

[BuildUnprepare]
unprepareBuild

[Imports]
# replace the shell script with a nice C wrapper
rm bin/monodevelop
cp $source_dir/autopackage/monodevelop bin/monodevelop

# we want to ship everything
echo '*' | import

[Prepare]
#
# Dependency handling here is interesting. Technically I guess
# we should check for GTK#, GNOME#, Gecko# blah blah blah.
#
# What'd be much better is if the Mono team defined the &quot;Mono
# Desktop Platform&quot; to include all of these things, so we can
# depend on everything M-D needs with a single dependency.
#
# That saves us work, because we don't need to specify everything.
#
# It saves the user work because they can download the MDP in
# one go and not have to wait while extra stuff is installed
# later.
#
# And it saves the developer work: on the website it can just
# have a little &quot;MDP 1.1&quot; button or badge, instead of a huge list
# of separately enumerated dependencies.
#
#
#
# For now let's cheat, and only check that Mono itself is available.

require @mono-project.org/runtime 1.0

[Install]
installExe bin/monodevelop
copyFiles lib/monodevelop &quot;$PREFIX/lib&quot;

installPkgconfig lib/pkgconfig/*
installDesktop &quot;Programming&quot; share/applications/*.desktop
installLocale share/locale
installMime share/mime/packages/*.xml

# MD should use the icon theme spec really (and have an SVG icon!)
copyFile share/pixmaps/monodevelop.png &quot;$PREFIX/share/pixmaps/monodevelop.png&quot;

[Uninstall]
# Usually just the following line is enough to uninstall everything
uninstallFromLog

----------------------------------------------------------------------------


A few notes:

* It may look quite long, but most of it is metadata and comments to
   show you what each bit does. A real specfile could be much shorter.
   I think 95% of it is also very obvious.

* You don't have to write all that. The bulk of it is automatically
   generated by the following command:

   &quot;makeinstaller --mkspec &gt;default.apspec&quot;

   Then you just customize it to fit your project.

* As you can see, it only does one dependency check, on the Mono runtime
   itself. Really it should check for all the dependencies, but that
   would have taken longer to do and as it says in the comments, what we
   really need is for you guys to define a Mono Desktop Platform. I'm keen on
   desktop platforms. We need more of them.

* A lot of the specfile could be trivially auto-generated on the fly,
   as it can be written mechanically. But nobody wrote the patches to
   do that yet. Certainly it'd be easier to simplify writing autopackage
   specfiles than to create a dedicated Mono installer!

This file is normally put in a dedicated &quot;autopackage&quot; directory in your
source tree, but it doesn't have to be. In this case, you need to put the
attached files in that directory too so the C stub program can be compiled
and shipped.

OK, so what do you guys think? Application developers - can you see yourselves
building such packages? If not, what can we do to convince you?

thanks -mike
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: monostub.c
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050729/149013da/attachment.c">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050729/149013da/attachment.c</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: binreloc.c
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050729/149013da/attachment-0001.c">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050729/149013da/attachment-0001.c</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: binreloc.h
Url: <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050729/149013da/attachment.h">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050729/149013da/attachment.h</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013560.html">[Mono-devel-list] [PATCH] Assembly.GetReferencedAssemblies
</A></li>
	<LI>Next message: <A HREF="013541.html">[Mono-devel-list] Re: Mono-devel-list Digest, Vol 3, Issue 83
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13540">[ date ]</a>
              <a href="thread.html#13540">[ thread ]</a>
              <a href="subject.html#13540">[ subject ]</a>
              <a href="author.html#13540">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
