<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Correct some events thrown by DataView
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Correct%20some%20events%20thrown%20by%20DataView&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013251.html">
   <LINK REL="Next"  HREF="013258.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Correct some events thrown by DataView</H1>
    <B>Marc Haisenko</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Correct%20some%20events%20thrown%20by%20DataView&In-Reply-To="
       TITLE="[Mono-devel-list] [PATCH] Correct some events thrown by DataView">haisenko at webport.de
       </A><BR>
    <I>Wed Jul 20 11:14:02 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013251.html">[Mono-devel-list] mono AES performance woes (was: poor PPC JIT	output)
</A></li>
        <LI>Next message: <A HREF="013258.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13252">[ date ]</a>
              <a href="thread.html#13252">[ thread ]</a>
              <a href="subject.html#13252">[ subject ]</a>
              <a href="author.html#13252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi folks,
the next patch. This one is about the events thrown by DataView.

Problem currently is that DataView throws an event too often or when it 
shouldn't be thrown. This caused major problems in a huge .NET project for 
which I fix bugs in DotGNU/Mono.

Now when you run the attached test application with Monos System.Data 
namespace you'll see a lot of ListChanged events with ListChangedType.Reset 
where no such event should be thrown (adding a row, changing an item, 
deleting a row). This is because the (Mono internal) method 
DataView.UpdateIndex always throws this event, and UpdateIndex is called a 
lot.

The attached patched removes this event from UpdateIndex and throws it 
manually where needed (set_Sort, set_Table). It also corrects one incorrect 
throwing of the ListChanged event in Reset () (where the event was thrown 
twice, BTW, since Reset calls Open which in turn calls UpdateIndex).

I've also attached a little test application which writes what it does and the 
events thrown (plus their arguments) into a file. Of course it's no complete 
unit test but catches the most important cases, I think. Also included in the 
directory with the executable is a sample output from MS.NET. To compare the 
output from MS.NET with the one produced by Mono you have to do &quot;diff -uw 
TableTest.log.MS TableTest.log&quot; to ignore the different line endings.

I've also noted that in some cases the order in which events are thrown are 
switched, it's always:
MS: DataView.ListChanged then DataTable.RowChanged
Mono: DataTable.RowChanged then DataView.ListChanged

Not sure whether this should be fixed as well but I think the most important 
thing is that the same events are thrown (in the same amount ;-), not the 
order...

C'ya,
	Marc
-- 
Marc Haisenko
Systemspezialist
Webport IT-Services GmbH
mailto: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">haisenko at webport.de</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: DataView.cs.Events.patch
Type: text/x-diff
Size: 1278 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050720/8523124b/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050720/8523124b/attachment.bin</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: TableTest.zip
Type: application/x-zip
Size: 11637 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050720/8523124b/attachment-0001.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20050720/8523124b/attachment-0001.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013251.html">[Mono-devel-list] mono AES performance woes (was: poor PPC JIT	output)
</A></li>
	<LI>Next message: <A HREF="013258.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13252">[ date ]</a>
              <a href="thread.html#13252">[ thread ]</a>
              <a href="subject.html#13252">[ subject ]</a>
              <a href="author.html#13252">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
