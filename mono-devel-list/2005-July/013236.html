<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] malloc and free on CLI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20malloc%20and%20free%20on%20CLI&In-Reply-To=1121752614.9423.35.camel%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013221.html">
   <LINK REL="Next"  HREF="013237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] malloc and free on CLI</H1>
    <B>Jeyasankar Kottalam</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20malloc%20and%20free%20on%20CLI&In-Reply-To=1121752614.9423.35.camel%40localhost.localdomain"
       TITLE="[Mono-devel-list] malloc and free on CLI">mono at jey.kottalam.net
       </A><BR>
    <I>Tue Jul 19 12:47:13 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013221.html">[Mono-devel-list] malloc and free on CLI
</A></li>
        <LI>Next message: <A HREF="013237.html">[Mono-devel-list] malloc and free on CLI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13236">[ date ]</a>
              <a href="thread.html#13236">[ thread ]</a>
              <a href="subject.html#13236">[ subject ]</a>
              <a href="author.html#13236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Quoting Massimiliano Mantione &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">massi at ximian.com</A>&gt;:

&gt;<i>
</I>&gt;<i> On Mon, 2005-07-18 at 11:26 +0200, Paolo Molaro wrote:
</I>&gt;&gt;<i> Icalls are completely out of the question
</I>&gt;&gt;<i> as an implementation for this.
</I>&gt;<i>
</I>&gt;<i> Happy to hear this!
</I>&gt;<i>
</I>&gt;&gt;<i> The managed C compiler should implement two patterns, both of which
</I>&gt;&gt;<i> are required:
</I>&gt;&gt;<i> 1) map a function call to a dllimport
</I>&gt;&gt;<i> 2) map a function call to corlib/System/ManagedLibc methods
</I>&gt;<i>
</I>&gt;<i> This makes sense, and I would add (maybe it was implied) that case
</I>&gt;<i> 2 includes any kind of managed code, including any C library that
</I>&gt;<i> has been compiled into a managed dll.
</I>&gt;<i>
</I>&gt;<i> Later on you describe a way of using C attributes to specify how
</I>&gt;<i> to resolve the two kinds of mapping.
</I>&gt;<i> I agree this should be done, but IMHO another way should also be
</I>&gt;<i> provided.
</I>&gt;<i>
</I>&gt;<i> Think of the following scenario: a library (say zlib) is compiled
</I>&gt;<i> to managed code (so we have zlib.dll).
</I>&gt;<i> Another existing C program that we want to compile to managed code
</I>&gt;<i> uses zlib (which means its sources include the zlib headers).
</I>&gt;<i> Now, the zlib headers do not contain any mapping attribute (and
</I>&gt;<i> IMHO they should stay as they are), so we need another way to tell
</I>&gt;<i> the C compiler how to map those calls.
</I>&gt;<i> I presume the C compiler generates a class with a lot of static
</I>&gt;<i> methods, one for each C function.
</I>&gt;<i> One easy way to specify the mapping outside of the header files
</I>&gt;<i> would be to tell the compiler &quot;all the static methods of these
</I>&gt;<i> classes are managed C functions, and they have precedence over
</I>&gt;<i> their unmanaged dllimported ones&quot;.
</I>&gt;<i> Since the C namespace (for linking) is flat, this should work very
</I>&gt;<i> well.
</I>
My current plan is to use the linker to automatically determine and 
resolve such
cases by generating the appropriate P/Invoke declarations. This is on my TODO
list for this week.

I also think it would be nice if the linker could look into assemblies and
automagically resolve dependencies from &quot;Managed C&quot; to Mono classes. However
this would require some mechanism to generate header files to provide the
declarations to the compiler, or each language front-end would need to be
modified to automatically pick up the prototypes from the assembles. (e.g.
using libmono to read assemblies)

FYI- The compilation process is something like:

    1. compile every foo.{c, cpp, pas, f, ...} to foo.s. foo.s contains &quot;linker
annotations&quot; and CIL
    2. link all *.s to foo.il
    3. ilasm foo.il to foo.exe

-Jey Kottalam



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013221.html">[Mono-devel-list] malloc and free on CLI
</A></li>
	<LI>Next message: <A HREF="013237.html">[Mono-devel-list] malloc and free on CLI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13236">[ date ]</a>
              <a href="thread.html#13236">[ thread ]</a>
              <a href="subject.html#13236">[ subject ]</a>
              <a href="author.html#13236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
