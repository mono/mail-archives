<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] Precise allocation / leaking vtables
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Precise%20allocation%20/%20leaking%20vtables&In-Reply-To=1121818446.4162.15.camel%40omega.boston.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013242.html">
   <LINK REL="Next"  HREF="013243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] Precise allocation / leaking vtables</H1>
    <B>Paolo Molaro</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20Precise%20allocation%20/%20leaking%20vtables&In-Reply-To=1121818446.4162.15.camel%40omega.boston.ximian.com"
       TITLE="[Mono-devel-list] Precise allocation / leaking vtables">lupus at ximian.com
       </A><BR>
    <I>Thu Jul 21 13:01:17 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013242.html">[Mono-devel-list] Precise allocation / leaking vtables
</A></li>
        <LI>Next message: <A HREF="013243.html">[Mono-devel-list] NetworkStream
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13302">[ date ]</a>
              <a href="thread.html#13302">[ thread ]</a>
              <a href="subject.html#13302">[ subject ]</a>
              <a href="author.html#13302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/19/05 Ben Maurer wrote:
&gt;<i> Miguel wanted a patch that would give us precise (ie, gcj style)
</I>&gt;<i> allocation in all domains, even if it means that we need to leak
</I>&gt;<i> vtables.
</I>&gt;<i> 
</I>&gt;<i> The attach patch makes this tradeoff. Miguel's logic is that the use of
</I>&gt;<i> unloading is relatively rare compared to the use of xsp, etc, which make
</I>&gt;<i> large amounts of allocations outside of the root domain.
</I>
Well, now that you have a patch, run the tests and see if there is
any improvement.
I already did a while ago the changes to make the arrays ptrfree when
possible and they are the biggest source of data that could make the GC
behave badly (besides the stacks). The improvement was there, but
it was relatively small. My feeling is that the extra mile will bring
little or no benefit. Introducing a leak is a very bad idea, IMHO.

&gt;<i> One other option would be to do a full gc during app domain unloading
</I>&gt;<i> and then install some sort of in libgc that would remove objects in the
</I>&gt;<i> doomed domain. This is basically what msft does (according to one of
</I>&gt;<i> cbrumme's logs). However, because they have a precise gc, they *know*
</I>&gt;<i> that all objects in the doomed domain will die and don't have to add any
</I>&gt;<i> extra code to enforce that.
</I>
We don't need to remove the objects, we just need to change their vtable
pointer to a vtable that the GC can use and that tells it there are
no pointers in the object anymore (and we need to remove them from the
finalizer queue).
Of course, this is likely to trigger bugs elsewhere...

lupus

-- 
-----------------------------------------------------------------
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at debian.org</A>                                     debian/rules
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">lupus at ximian.com</A>                             Monkeys do it better

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013242.html">[Mono-devel-list] Precise allocation / leaking vtables
</A></li>
	<LI>Next message: <A HREF="013243.html">[Mono-devel-list] NetworkStream
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13302">[ date ]</a>
              <a href="thread.html#13302">[ thread ]</a>
              <a href="subject.html#13302">[ subject ]</a>
              <a href="author.html#13302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
