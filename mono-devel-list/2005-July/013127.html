<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] DateTime Parameters in MSSQL Server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DateTime%20Parameters%20in%20MSSQL%20Server&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013126.html">
   <LINK REL="Next"  HREF="013128.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] DateTime Parameters in MSSQL Server</H1>
    <B>John BouAntoun</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20DateTime%20Parameters%20in%20MSSQL%20Server&In-Reply-To="
       TITLE="[Mono-devel-list] DateTime Parameters in MSSQL Server">jbouantoun at rogen.com.au
       </A><BR>
    <I>Tue Jul 12 19:15:31 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013126.html">[Mono-devel-list] mono + asp.net + cyrillic characters problem
</A></li>
        <LI>Next message: <A HREF="013128.html">[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13127">[ date ]</a>
              <a href="thread.html#13127">[ thread ]</a>
              <a href="subject.html#13127">[ subject ]</a>
              <a href="author.html#13127">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi guys,

Just thought I'd add my 2 cents worth.

Being from australia, I'm quite used to dealing with badly coded software -&gt; SQL date handling.

In the Australian locale we have our dates in the format dd/MM/yyyy, which is the oposite to the US way. 

The way we get around any issues that arise from, for example the webserver being set up in an australian locale and the SQL server being set uo in a US locale, is to use the abbreviated month name. 

I've found you can't go wrong with using abbreviated month name in either this format:

dd MMM yyyy

Or the other way around

MMM dd yyyy

Perhaps we should be doing this when we pass dates into sql server?

-----Original Message-----
From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A> [mailto:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>] On Behalf Of Hubert FONGARNAND
Sent: Wednesday, 13 July 2005 12:40 AM
To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
Subject: Re: [Mono-devel-list] DateTime Parameters in MSSQL Server

Here's my patch to solve my problem :

I've added an other little modification :
With my patch it's possible (like MS.NET) to pass a byte array with a null length as a binary parameter.

Le Mardi 12 Juillet 2005 16:30, Hubert FONGARNAND a &#233;crit&#160;:
&gt;<i> Le Mardi 12 Juillet 2005 15:50, Hubert FONGARNAND a &#233;crit&#160;:
</I>&gt;<i> I've found where is the problem
</I>&gt;<i>
</I>&gt;<i> Fri Jan 7 08:26:07 2005 suresh has submitted a patch wich change the 
</I>&gt;<i> format of datetime parameters from :
</I>&gt;<i>  value = String.Format(System.Globalization.CultureInfo.InvariantCulture,
</I>&gt;<i>                                            '{0:MM/dd/yyyy hh:mm:ss 
</I>&gt;<i> tt}'&quot;, d );
</I>&gt;<i>
</I>&gt;<i> to
</I>&gt;<i> value = String.Format(System.Globalization.CultureInfo.InvariantCulture,
</I>&gt;<i> 		 &quot;'{0:MMM dd yyyy hh:mm:ss tt}'&quot;, d );
</I>&gt;<i>
</I>&gt;<i> i've restored the old line (0:MM/dd/yyyy hh:mm:ss tt) and it works for 
</I>&gt;<i> me now! but I think this problems comes from the database culture...
</I>&gt;<i>
</I>&gt;<i> Is it possible that the Tds drivers could adapt it automatically to 
</I>&gt;<i> the database???
</I>&gt;<i> I think, it's a very bad idea to change the mono code source each time 
</I>&gt;<i> you change your database...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> thanks
</I>&gt;<i>
</I>&gt;<i> &gt; The problems comes from the method
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; private string FormatParameter (TdsMetaParameter parameter)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; in Mono.Data.tds.protocol
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; wich encode parameters in order to send them to SQL Server. With 
</I>&gt;<i> &gt; MS.NET, parameters are send using a binary format, with mono, 
</I>&gt;<i> &gt; parameters are sent using the &quot;string&quot; format...
</I>&gt;<i> &gt; It's a problem when dealing with dates :
</I>&gt;<i> &gt; case &quot;datetime&quot;:
</I>&gt;<i> &gt;                                DateTime d = (DateTime)parameter.Value;
</I>&gt;<i> &gt;                                 value = 
</I>&gt;<i> &gt; String.Format(System.Globalization.CultureInfo.InvariantCulture,
</I>&gt;<i> &gt;                                                       &quot;'{0:MMM dd 
</I>&gt;<i> &gt; yyyy hh:mm:ss tt}'&quot;, d );
</I>&gt;<i> &gt;                                 break;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is the format &quot;MMM dd yyyy hh:mm:ss tt&quot; correct? for all SQL Server 
</I>&gt;<i> &gt; 2000 (french version)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Le Mardi 12 Juillet 2005 15:42, Chris van Wyk a &#233;crit&#160;:
</I>&gt;<i> &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Datetime has also been giving me huge amounts of problems.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The work around for me was to convert the item using 
</I>&gt;<i> &gt; &gt; ToString(&quot;s&quot;). If you are going to use stored procs, you will need 
</I>&gt;<i> &gt; &gt; to modify your stored proc parameters in the sql statement to string in stead of datetime.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I have also been able to get the Microsoft.ApplicationBlocks.Data 
</I>&gt;<i> &gt; &gt; going with modification to specific DateTime parameter formatting.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; There seems to be problems with the data adapter using the 
</I>&gt;<i> &gt; &gt; sqlhelper from the above. I am getting concurrency errors on 
</I>&gt;<i> &gt; &gt; updates for instance. If someone else has had concurrency errors 
</I>&gt;<i> &gt; &gt; please let me know as I have been able to work round this, but I'm 
</I>&gt;<i> &gt; &gt; not sure if it is a bug in Mono.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I am using 1.1.7 and have not tested the above on 1.1.8
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Regards
</I>&gt;<i> &gt; &gt; Chris
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; -----Original Message-----
</I>&gt;<i> &gt; &gt; &gt; From: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; &gt; [mailto:mono-devel-list- <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bounces at lists.ximian.com</A>] On Behalf Of 
</I>&gt;<i> &gt; &gt; &gt; Hubert FONGARNAND
</I>&gt;<i> &gt; &gt; &gt; Sent: 12 July 2005 03:28 PM
</I>&gt;<i> &gt; &gt; &gt; To: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; &gt; Subject: [Mono-devel-list] DateTime Parameters in MSSQL Server
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I've an issue with datetime parameters with MSSQL Server in Mono...
</I>&gt;<i> &gt; &gt; &gt; It seem's that the parameters is badly sent to the SQL Server...
</I>&gt;<i> &gt; &gt; &gt; Please test that :
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; using System;
</I>&gt;<i> &gt; &gt; &gt; using System.Data;
</I>&gt;<i> &gt; &gt; &gt; using System.Data.SqlClient;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; class MainClass
</I>&gt;<i> &gt; &gt; &gt; {
</I>&gt;<i> &gt; &gt; &gt; 	static string cnx=&quot;user id=sa;password=sa;data 
</I>&gt;<i> &gt; &gt; &gt; source=10.69.100.93;initial catalog=Fiche_Produit&quot;;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; 	public static void Main(string[] args)
</I>&gt;<i> &gt; &gt; &gt; 	{
</I>&gt;<i> &gt; &gt; &gt; 		Console.WriteLine(&quot;Hello World!&quot;);
</I>&gt;<i> &gt; &gt; &gt; 		SqlCommand cmd=new SqlCommand();
</I>&gt;<i> &gt; &gt; &gt; 		cmd.Connection=new SqlConnection(cnx);
</I>&gt;<i> &gt; &gt; &gt; 		cmd.CommandText=&quot;INSERT INTO essais (date) VALUES (@date)&quot;;
</I>&gt;<i> &gt; &gt; &gt; 		cmd.Parameters.Clear();
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; 	cmd.Parameters.Add(&quot;@date&quot;,SqlDbType.DateTime).Value=DateTime.Now;
</I>&gt;<i> &gt; &gt; &gt; 		cmd.Connection.Open();
</I>&gt;<i> &gt; &gt; &gt; 		cmd.ExecuteNonQuery();
</I>&gt;<i> &gt; &gt; &gt; 		cmd.Connection.Close();
</I>&gt;<i> &gt; &gt; &gt; 	}
</I>&gt;<i> &gt; &gt; &gt; }
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; it returns :
</I>&gt;<i> &gt; &gt; &gt; Unhandled Exception: System.Data.SqlClient.SqlException: Erreur 
</I>&gt;<i> &gt; &gt; &gt;de  conversion  du type de donn&#233;es varchar en datetime.
</I>&gt;<i> &gt; &gt; &gt; Erreur de conversion du type de donn&#233;es varchar en datetime.
</I>&gt;<i> &gt; &gt; &gt; in [0x00034]
</I>&gt;<i> &gt; &gt; &gt; (at
</I>&gt;<i> &gt; &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt;/home/hubert/mono/mcs/class/System.Data/System.Data.SqlClient/Sql
</I>&gt;<i> &gt; &gt; &gt;Conn
</I>&gt;<i> &gt; &gt; &gt;ec ti o n.cs:266)
</I>&gt;<i> &gt; &gt; &gt; System.Data.SqlClient.SqlConnection:ErrorHandler (System.Object  
</I>&gt;<i> &gt; &gt; &gt;sender, Mono.Data.Tds.Protocol.TdsInternalErrorMessageEventArgs 
</I>&gt;<i> &gt; &gt; &gt;e)  in (wrapper delegate-invoke)  
</I>&gt;<i> &gt; &gt; &gt;System.MulticastDelegate:invoke_void_object_TdsInternalErrorMessa
</I>&gt;<i> &gt; &gt; &gt;geEv
</I>&gt;<i> &gt; &gt; &gt;en tA r gs
</I>&gt;<i> &gt; &gt; &gt; (object,Mono.Data.Tds.Protocol.TdsInternalErrorMessageEventArgs)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; In english : error when converting a varchar datatype into a 
</I>&gt;<i> &gt; &gt; &gt; datetime
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; thanks
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; Ce message et les &#233;ventuels documents joints peuvent contenir 
</I>&gt;<i> &gt; &gt; &gt; des informations confidentielles.
</I>&gt;<i> &gt; &gt; &gt; Au cas o&#249; il ne vous serait pas destin&#233;, nous vous remercions de 
</I>&gt;<i> &gt; &gt; &gt; bien vouloir le supprimer et en aviser imm&#233;diatement 
</I>&gt;<i> &gt; &gt; &gt; l'exp&#233;diteur. Toute utilisation de ce message non conforme &#224; sa 
</I>&gt;<i> &gt; &gt; &gt; destination, toute diffusion ou publication, totale ou partielle 
</I>&gt;<i> &gt; &gt; &gt; et quel qu'en soit le moyen est formellement interdite.
</I>&gt;<i> &gt; &gt; &gt; Les communications sur internet n'&#233;tant pas s&#233;curis&#233;es, 
</I>&gt;<i> &gt; &gt; &gt; l'int&#233;grit&#233; de ce message n'est pas assur&#233;e et la soci&#233;t&#233; 
</I>&gt;<i> &gt; &gt; &gt; &#233;mettrice ne peut &#234;tre tenue pour responsable de son contenu.
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A> 
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Ce message et les &#233;ventuels documents joints peuvent contenir des 
</I>&gt;<i> &gt; informations confidentielles. Au cas o&#249; il ne vous serait pas 
</I>&gt;<i> &gt; destin&#233;, nous vous remercions de bien vouloir le supprimer et en 
</I>&gt;<i> &gt; aviser imm&#233;diatement l'exp&#233;diteur. Toute utilisation de ce message 
</I>&gt;<i> &gt; non conforme &#224; sa destination, toute diffusion ou publication, 
</I>&gt;<i> &gt; totale ou partielle et quel qu'en soit le moyen est formellement 
</I>&gt;<i> &gt; interdite. Les communications sur internet n'&#233;tant pas s&#233;curis&#233;es, 
</I>&gt;<i> &gt; l'int&#233;grit&#233; de ce message n'est pas assur&#233;e et la soci&#233;t&#233; &#233;mettrice 
</I>&gt;<i> &gt; ne peut &#234;tre tenue pour responsable de son contenu. 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-devel-list mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Ce message et les &#233;ventuels documents joints peuvent contenir des 
</I>&gt;<i> informations confidentielles. Au cas o&#249; il ne vous serait pas destin&#233;, 
</I>&gt;<i> nous vous remercions de bien vouloir le supprimer et en aviser 
</I>&gt;<i> imm&#233;diatement l'exp&#233;diteur. Toute utilisation de ce message non 
</I>&gt;<i> conforme &#224; sa destination, toute diffusion ou publication, totale ou 
</I>&gt;<i> partielle et quel qu'en soit le moyen est formellement interdite. Les 
</I>&gt;<i> communications sur internet n'&#233;tant pas s&#233;curis&#233;es, l'int&#233;grit&#233; de ce 
</I>&gt;<i> message n'est pas assur&#233;e et la soci&#233;t&#233; &#233;mettrice ne peut &#234;tre tenue 
</I>&gt;<i> pour responsable de son contenu. 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">http://lists.ximian.com/mailman/listinfo/mono-devel-list</A>
</I>_______________________________________________
Ce message et les &#233;ventuels documents joints peuvent contenir des informations confidentielles.
Au cas o&#249; il ne vous serait pas destin&#233;, nous vous remercions de bien vouloir le supprimer et en aviser imm&#233;diatement l'exp&#233;diteur. Toute utilisation de ce message non conforme &#224; sa destination, toute diffusion ou publication, totale ou partielle et quel qu'en soit le moyen est formellement interdite.
Les communications sur internet n'&#233;tant pas s&#233;curis&#233;es, l'int&#233;grit&#233; de ce message n'est pas assur&#233;e et la soci&#233;t&#233; &#233;mettrice ne peut &#234;tre tenue pour responsable de son contenu.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013126.html">[Mono-devel-list] mono + asp.net + cyrillic characters problem
</A></li>
	<LI>Next message: <A HREF="013128.html">[Mono-devel-list] RE: [Gc] [PATCH] Race condition when restarting	threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13127">[ date ]</a>
              <a href="thread.html#13127">[ thread ]</a>
              <a href="subject.html#13127">[ subject ]</a>
              <a href="author.html#13127">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
