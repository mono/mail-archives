<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] The first (attempt to checkin) managed collation	patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20The%20first%20%28attempt%20to%20checkin%29%20managed%20collation%0A%09patch&In-Reply-To=42DE8612.1060508%40ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013258.html">
   <LINK REL="Next"  HREF="013266.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] The first (attempt to checkin) managed collation	patch</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20The%20first%20%28attempt%20to%20checkin%29%20managed%20collation%0A%09patch&In-Reply-To=42DE8612.1060508%40ximian.com"
       TITLE="[Mono-devel-list] The first (attempt to checkin) managed collation	patch">atsushi at ximian.com
       </A><BR>
    <I>Wed Jul 20 13:32:12 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013258.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
        <LI>Next message: <A HREF="013266.html">[Mono-devel-list] The first (attempt to checkin) managed	collation patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13260">[ date ]</a>
              <a href="thread.html#13260">[ thread ]</a>
              <a href="subject.html#13260">[ subject ]</a>
              <a href="author.html#13260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I forgot to mention what this patch fixes, on String.cs and
CompareInfo.cs.

String.cs : The length of compared string might not be equal
to another one, so we should not use the length of &quot;value&quot;
in IsPrefix().

CompareInfo.cs : It switches between managed collation and
unmanaged one (not working now). I also removed some &quot;short cuts&quot;
are invalid when it comes to real collation.

Also, in Makefile I replaced SortKey.cs with new one, for
managed collation support.

Atsushi Eno


Atsushi Eno wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I think it could be the time to merge my managed collation patch
</I>&gt;<i> that enables Windows like collation at managed code side.
</I>&gt;<i> 
</I>&gt;<i> ** The changes I want to make
</I>&gt;<i> 
</I>&gt;<i> The attached patch. Actually it is already in svn:
</I>&gt;<i> mcs/class/corlib/Mono.Globalization.Unicode/managed-collation.patch
</I>&gt;<i> 
</I>&gt;<i> But besides the patch, I need to checkin 7 prebuilt binary resource
</I>&gt;<i> files in mcs/class/corlib directory, though they can be built when
</I>&gt;<i> you run &quot;make&quot; in mcs/class/corlib/Mono.Globalization.Unicode. [*1]
</I>&gt;<i> I put all the binaries here:
</I>&gt;<i> <A HREF="http://monkey.workarea.jp/tmp/20050720">http://monkey.workarea.jp/tmp/20050720</A>
</I>&gt;<i> 
</I>&gt;<i> ** How it affects on mono
</I>&gt;<i> 
</I>&gt;<i> It still does not enable managed collation unless you explicitly
</I>&gt;<i> set environment variable MONO_USE_MANAGED_COLLATION=yes.
</I>&gt;<i> 
</I>&gt;<i> I can build mcs with this managed collation mode and all corlib
</I>&gt;<i> tests pass (I guess other tests as well).
</I>&gt;<i> 
</I>&gt;<i> When this managed collation is enabled, it will eat huge managed
</I>&gt;<i> resource (and will make you sad when you run mono --profile ;-).
</I>&gt;<i> I can make this into unmanaged header file if we want.
</I>&gt;<i> 
</I>&gt;<i> Also, currently managed collation is extremely *slow* since it
</I>&gt;<i> lacks a significant optimization, to just compare codepoints
</I>&gt;<i> as long as possible (safe character comparison).
</I>&gt;<i> 
</I>&gt;<i> ** How it is stable
</I>&gt;<i> 
</I>&gt;<i> It is not stable yet, but most of the expected changes are 1)sortkey
</I>&gt;<i> table fixes, 2) culture-dependent tailoring data, and 3)optimization.
</I>&gt;<i> 
</I>&gt;<i> It still does not work fine on Latin, Greek, Cyrillic and Arabic
</I>&gt;<i> (mostly, on those characters with diacritical mark).
</I>&gt;<i> 
</I>&gt;<i> There are already a couple of working managed collation tests that
</I>&gt;<i> do not run unless the environment variable is set.
</I>&gt;<i> 
</I>&gt;<i> This fixes bug #69771, #70478, #71111, #73417 i.e. all reported
</I>&gt;<i> collation bugs (for #69771 Microsoft's sample code is buggy though).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Would there be any problem if I commit this patch? Comments are
</I>&gt;<i> welcome.
</I>&gt;<i> 
</I>&gt;<i> ----
</I>&gt;<i> [*1] I don't think it can be incorporated in the build step since
</I>&gt;<i> 1) it requires some downloads like locale-builder, 2) the table
</I>&gt;<i> generation is so slow, and 3) sometimes it might generate broken
</I>&gt;<i> table because the binary resource generator is also written in C#
</I>&gt;<i> and it's not always ordinal (I should sanitize the code at some
</I>&gt;<i> stage when it became stable though).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Atsushi Eno
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013258.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
	<LI>Next message: <A HREF="013266.html">[Mono-devel-list] The first (attempt to checkin) managed	collation patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13260">[ date ]</a>
              <a href="thread.html#13260">[ thread ]</a>
              <a href="subject.html#13260">[ subject ]</a>
              <a href="author.html#13260">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
