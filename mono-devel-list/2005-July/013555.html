<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] [PATCH] Profile 2.0 assembly versions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Profile%202.0%20assembly%20versions&In-Reply-To=005501c5940f%24a16c8070%246464a8c0%40ansirua">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013539.html">
   <LINK REL="Next"  HREF="013558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] [PATCH] Profile 2.0 assembly versions</H1>
    <B>Ben Maurer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20%5BPATCH%5D%20Profile%202.0%20assembly%20versions&In-Reply-To=005501c5940f%24a16c8070%246464a8c0%40ansirua"
       TITLE="[Mono-devel-list] [PATCH] Profile 2.0 assembly versions">bmaurer at ximian.com
       </A><BR>
    <I>Fri Jul 29 10:48:02 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013539.html">[Mono-devel-list] [PATCH] Profile 2.0 assembly versions
</A></li>
        <LI>Next message: <A HREF="013558.html">[Mono-devel-list] [PATCH] Profile 2.0 assembly versions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13555">[ date ]</a>
              <a href="thread.html#13555">[ thread ]</a>
              <a href="subject.html#13555">[ subject ]</a>
              <a href="author.html#13555">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2005-07-29 at 09:32 +0200, Andreas Nahr wrote:
&gt;<i> ----- Original Message ----- 
</I>&gt;<i> From: &quot;Ben Maurer&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">bmaurer at ximian.com</A>&gt;
</I>&gt;<i> To: &quot;Andreas Nahr&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">ClassDevelopment at A-SoftTech.com</A>&gt;
</I>&gt;<i> Cc: &quot;Korn&#233;l P&#225;l&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">kornelpal at hotmail.com</A>&gt;; &quot;Miguel de Icaza&quot; 
</I>&gt;<i> &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">miguel at ximian.com</A>&gt;; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
</I>&gt;<i> Sent: Friday, July 29, 2005 1:15 AM
</I>&gt;<i> Subject: Re: [Mono-devel-list] [PATCH] Profile 2.0 assembly versions
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; On Fri, 2005-07-29 at 00:42 +0200, Andreas Nahr wrote:
</I>&gt;<i> &gt;&gt; Yes - it would make a lot of sense to put them into a single file. 
</I>&gt;<i> &gt;&gt; However
</I>&gt;<i> &gt;&gt; it would come at a cost of up to 2kb of size added to EACH assembly that
</I>&gt;<i> &gt;&gt; uses Consts.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Maybe the *FILE* will be 2 kb, but the metadata added probably won't be.
</I>&gt;<i> &gt; To add a class with a single const we'd need to add:
</I>&gt;<i> 
</I>&gt;<i> If we merge everything into a single file we probably have about 20 consts, 
</I>&gt;<i> each about 50 chars long.
</I>&gt;<i> Depending whether this is saved in the assembly as unicode or ascii (which i 
</I>&gt;<i> don't know) this should be 1-2kb just for the strings in the string heap.
</I>
stuff on the ldstr table is in unicode. That assumes that the 20 consts
never get used, however. If they are used in the code at all, they will
need to be in the ldstr table.

&gt;<i> All the fields are NEVER used at runtime, so I hope they do not get loaded 
</I>&gt;<i> at all ;)
</I>&gt;<i> There is no access to these fields. They are only used at compile time, but 
</I>&gt;<i> not at runtime.
</I>
They don't.

&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; In fact I think we could do something really clever to our compiler here,
</I>&gt;<i> &gt;&gt; that would also benefit for a lot of other cases.
</I>&gt;<i> &gt;&gt; AFAIK the compiler can already eliminate dead code. I would propose a 
</I>&gt;<i> &gt;&gt; step
</I>&gt;<i> &gt;&gt; that allows the compiler to scan for dead code again AFTER constants are
</I>&gt;<i> &gt;&gt; resolved. This way the compiler would be able to completely eliminate the
</I>&gt;<i> &gt;&gt; Consts Class after compiling. This would also add lots of added value to
</I>&gt;<i> &gt;&gt; other applications. It's quite common to use private consts and 
</I>&gt;<i> &gt;&gt; especially
</I>&gt;<i> &gt;&gt; enums to structure the code and make it more readable. With the proposed
</I>&gt;<i> &gt;&gt; compiler function all of these things could be thrown out at 
</I>&gt;<i> &gt;&gt; compile-time,
</I>&gt;<i> &gt;&gt; which could help a lot of applications to get smaller.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; A cecil based il-to-il optimizer could do that in the future. Of course,
</I>&gt;<i> &gt; if you really want to look at &quot;how can we make teh metadata smaller&quot; we
</I>&gt;<i> &gt; could do a simple obfuscator -- we could rename private / internal
</I>&gt;<i> &gt; methods/classes to have small names, etc.
</I>&gt;<i> 
</I>&gt;<i> There are obfuscators out there that you can use, however that is not 
</I>&gt;<i> exactly what I mean:
</I>&gt;<i> 
</I>&gt;<i> Look at the example:
</I>&gt;<i> 
</I>&gt;<i> const string a = &quot;Hello &quot;;
</I>&gt;<i> const string b = &quot;World&quot;;
</I>&gt;<i> 
</I>&gt;<i> [SomeStringAttribute (a+b)]
</I>&gt;<i> private void Out () { }
</I>&gt;<i> 
</I>&gt;<i> If I understand thing right we end up having the following strings in the 
</I>&gt;<i> assembly:
</I>&gt;<i> &quot;Hello World&quot; (as part of the attribute)
</I>&gt;<i> &quot;Hello &quot;, &quot;World&quot; (in our case these use their own class)
</I>&gt;<i> 
</I>&gt;<i> However after compilation the strings &quot;Hello &quot; and &quot;World&quot; are never used 
</I>&gt;<i> anywhere at runtime, so we could delete them.
</I>&gt;<i> AFAIK not even the MS compiler is able to do that ;)
</I>
That's correct.

Anyways, as I said to Kornel, Feel free to come back with data about
what effect the optimization will have. Otherwise, let's just spend time
on real performance issues with measurable results.

-- Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013539.html">[Mono-devel-list] [PATCH] Profile 2.0 assembly versions
</A></li>
	<LI>Next message: <A HREF="013558.html">[Mono-devel-list] [PATCH] Profile 2.0 assembly versions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13555">[ date ]</a>
              <a href="thread.html#13555">[ thread ]</a>
              <a href="subject.html#13555">[ subject ]</a>
              <a href="author.html#13555">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
