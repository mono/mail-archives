<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] The first (attempt to checkin) managed collation	patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20The%20first%20%28attempt%20to%20checkin%29%20managed%20collation%0A%09patch&In-Reply-To=20050725094155.GF18612%40debian.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013376.html">
   <LINK REL="Next"  HREF="013396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] The first (attempt to checkin) managed collation	patch</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20The%20first%20%28attempt%20to%20checkin%29%20managed%20collation%0A%09patch&In-Reply-To=20050725094155.GF18612%40debian.org"
       TITLE="[Mono-devel-list] The first (attempt to checkin) managed collation	patch">atsushi at ximian.com
       </A><BR>
    <I>Mon Jul 25 10:45:40 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013376.html">[Mono-devel-list] The first (attempt	to	checkin)	managed	collation patch
</A></li>
        <LI>Next message: <A HREF="013396.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13381">[ date ]</a>
              <a href="thread.html#13381">[ thread ]</a>
              <a href="subject.html#13381">[ subject ]</a>
              <a href="author.html#13381">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Paolo Molaro wrote:
&gt;<i> On 07/24/05 Miguel de Icaza wrote:
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i>It can be done in two ways: embed the files in the mono binary like we do
</I>&gt;&gt;&gt;&gt;<i>with the char tables or load the files from where mscorlib was loaded.
</I>&gt;&gt;&gt;&gt;<i>Both are trivial to implement.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>For now I took the latter approach. That means however we need some
</I>&gt;&gt;&gt;<i>love on the build system.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I personally like the idea of having this data on the dll files
</I>&gt;&gt;<i>themselves more, you can embed the resources with -resource and then get
</I>&gt;&gt;<i>the same IntPtr without adding a new icall like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>int size;
</I>&gt;&gt;<i>Module module;
</I>&gt;&gt;<i>IntPtr data = GetManifestResourceInternal (name, out size, out module);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>We reuse the existing framework, do not require build system love and do
</I>&gt;&gt;<i>not have to introduce a new icall.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> All of that is fine, except that you get incorrect data, since we have arrays
</I>&gt;<i> of shorts or ints, so we either give incorrect results on bigendian systems
</I>&gt;<i> or we introduce code to byteswap at runtime, needlessly slowing down the code.
</I>&gt;<i> 
</I>&gt;<i> The code should do what we already do for the char data: embed the arrays
</I>&gt;<i> in mono so the endianess is correct and there are no build systems changes.
</I>&gt;<i> Using managed resources for this is a net loss. Using and mmapping external files
</I>&gt;<i> instead of embedding them has the same (well, less) build system complexity
</I>&gt;<i> of embedding the correct endian files as managed resources.
</I>
Oh, I see. Then maybe we had better use C header. However as far as
I know, having the table as C header introduces some problems:

	- The file becomes too big. I created C header output and
	  it became about 800 KB:
	  <A HREF="http://monkey.workarea.jp/tmp/20050725/collation-tables.h">http://monkey.workarea.jp/tmp/20050725/collation-tables.h</A>

	- Runtime constants are fixed between versions. For example,
	  Char.GetUnicodeCategory() returns inconsistent values
	  between .NET 1.x and 2.0 (because of dependent Unicode
	  version difference). So if the results were inconsistent,
	  we need some kind of hack to fill the gap.

	  Since Microsoft seems to have lost the source of the
	  collation tables, it is not likely to happen.
	  <A HREF="http://blogs.msdn.com/michkap/archive/2005/06/30/434223.aspx">http://blogs.msdn.com/michkap/archive/2005/06/30/434223.aspx</A>
	  But am not sure if they can never find the sources and
	  fix bugs (or even that person above wrote the truth).

But I think the former is not critical and the latter *won't* happen
(I hope).

Atsushi Eno


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013376.html">[Mono-devel-list] The first (attempt	to	checkin)	managed	collation patch
</A></li>
	<LI>Next message: <A HREF="013396.html">[Mono-devel-list] The first (attempt to checkin) managed collation	patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13381">[ date ]</a>
              <a href="thread.html#13381">[ thread ]</a>
              <a href="subject.html#13381">[ subject ]</a>
              <a href="author.html#13381">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
