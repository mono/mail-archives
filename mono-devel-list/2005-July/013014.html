<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-devel-list] mcs patch for precise location handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20mcs%20patch%20for%20precise%20location%20handling&In-Reply-To=42C56F94.2010403%40seznam.cz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012981.html">
   <LINK REL="Next"  HREF="013018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-devel-list] mcs patch for precise location handling</H1>
    <B>Atsushi Eno</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-devel-list%5D%20mcs%20patch%20for%20precise%20location%20handling&In-Reply-To=42C56F94.2010403%40seznam.cz"
       TITLE="[Mono-devel-list] mcs patch for precise location handling">atsushi at ximian.com
       </A><BR>
    <I>Mon Jul  4 01:40:26 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="012981.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
        <LI>Next message: <A HREF="013018.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13014">[ date ]</a>
              <a href="thread.html#13014">[ thread ]</a>
              <a href="subject.html#13014">[ subject ]</a>
              <a href="author.html#13014">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Martin gave some comments on the patch, so I made a few changes:

	- removed &quot;dont_progress_location&quot; conditions in tokenizer
	- fixed incorrectly modified &quot;public int token&quot; in location.cs
	- renamed &quot;StringValue&quot; to &quot;Value&quot; in LocatedToken.

And merged the patch to the latest trunk as:
<A HREF="http://monkey.workarea.jp/tmp/20050704/precise-location-20050704.diff">http://monkey.workarea.jp/tmp/20050704/precise-location-20050704.diff</A>

&gt;<i> Only where it is appropriate not for `if', `foreach', etc.
</I>&gt;<i> I think it will be easier to read and probably a little bit faster.
</I>&gt;<i> 
</I>&gt;<i> Like this
</I>&gt;<i> 
</I>&gt;<i> +        LocatedToken lt = (LocatedToken) $1;
</I>&gt;<i> +        LabeledStatement labeled = new LabeledStatement 
</I>&gt;<i> (lt.StringValue, lt.Location);
</I>&gt;<i> 
</I>&gt;<i> or this
</I>&gt;<i> 
</I>&gt;<i> -        CheckBinaryOperator ((Operator.OpType) $3);
</I>&gt;<i> +        LocatedToken ltParam1 = (LocatedToken) $6;
</I>&gt;<i> +        LocatedToken ltParam2 = (LocatedToken) $9;
</I>&gt;<i> +        CheckBinaryOperator ((Operator.OpType) $3, (Location) $2);
</I>&gt;<i> 
</I>&gt;<i>         Parameter [] pars = new Parameter [2];
</I>&gt;<i> 
</I>&gt;<i>         Expression typeL = (Expression) $5;
</I>&gt;<i>         Expression typeR = (Expression) $8;
</I>&gt;<i> 
</I>&gt;<i> -           pars [0] = new Parameter (typeL, (string) $6, 
</I>&gt;<i> Parameter.Modifier.NONE, null, lexer.Location);
</I>&gt;<i> -           pars [1] = new Parameter (typeR, (string) $9, 
</I>&gt;<i> Parameter.Modifier.NONE, null, lexer.Location);
</I>&gt;<i> +           pars [0] = new Parameter (typeL, ltParam1.StringValue, 
</I>&gt;<i> Parameter.Modifier.NONE, null, ltParam1.Location);
</I>&gt;<i> +           pars [1] = new Parameter (typeR, ltParam2.StringValue, 
</I>&gt;<i> Parameter.Modifier.NONE, null, ltParam2.Location);
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I once thought about that, but it makes those constructors too
</I>&gt;&gt;<i> parser-specific while some of them are invoked inside some other
</I>&gt;&gt;<i> types (Iterators etc.) where we have dare
</I>&gt;&gt;<i> to create LocatedToken. So I felt that it won't be worthy of
</I>&gt;&gt;<i> making those changes just to make parser a bit readable. Especially
</I>&gt;&gt;<i> I was afraid that there might be need for LocatedToken-less
</I>&gt;&gt;<i> ctor()s in the future (or that could already happen in gmcs).
</I>&gt;<i> 
</I>&gt;<i> I think 99% are parser specific. Otherwise Iterator can always create 
</I>&gt;<i> this container.
</I>&gt;<i> I cannot talk about gmcs as I don't know the sources.
</I>
Am so skeptical about the good effect (code readability) as
compared to the bad effect (performance, cost of work, and in
fact code readability also here). Sure, it might improve
readability for some readers, but on the other hand it introduces
extraneous new LocatedToken() in its internal processing stage.

Actally I tried to make such changes from reviewing all LocatedToken
usage in cs-parser.jay, but there were much more cases that I had
to change. For example when I changed LocalVariableReference.ctor()
to accept LocatedToken, it requires to introduce &quot;new LocatedToken()&quot;
in DoSimpleNameResolve() whose invocation count is not small in
the profiler result.

(Of course avoiding LocatedToken for such specific cases will
just make code inconsistent.)

The changes are also being so massive that I wonder if it is
really worthy of changing. It is far from mandatory changes.

If the majority of mcs hackers still want this change, I'll
restart this.

&gt;<i> But you don't need to introduce the `LocatedToken' when you just reuse 
</I>&gt;<i> `MemberName'.
</I>&gt;<i> It will simplify this mainly when you rewrite `VariableDeclaration' to 
</I>&gt;<i> hold this MemberName then
</I>&gt;<i> we will have just 1 name container.
</I>
Yes, but I am not sure if member names and variable name are in
the same semantics (esp. am not sure if those constraints are/
will be the same) or not and thus if MemberName can be used or not.

&gt;&gt;&gt;<i> MemberBase is derived from MemberCore
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> +Location GetLocation (object obj)
</I>&gt;&gt;&gt;<i> +{
</I>&gt;&gt;&gt;<i> +    if (obj is MemberCore)
</I>&gt;&gt;&gt;<i> +        return ((MemberCore) obj).Location;
</I>&gt;&gt;&gt;<i> +    if (obj is MemberName)
</I>&gt;&gt;&gt;<i> +        return ((MemberName) obj).Location;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Mmm, I couldn't understand what you meant. MemberBase will be
</I>&gt;&gt;<i> thus handled here, so I don't see possible improvements here.
</I>&gt;<i> 
</I>&gt;<i> +    if (obj is MemberName)
</I>&gt;<i> This `if' never happens.
</I>
Well, I don't think MemberName is derived from MemberCore.

Atsushi Eno

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012981.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
	<LI>Next message: <A HREF="013018.html">[Mono-devel-list] mcs patch for precise location handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13014">[ date ]</a>
              <a href="thread.html#13014">[ thread ]</a>
              <a href="subject.html#13014">[ subject ]</a>
              <a href="author.html#13014">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
