<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] xbuild crash with mono 4.6.1?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20xbuild%20crash%20with%20mono%204.6.1%3F&In-Reply-To=%3CBA43CD6A-DC1B-4D03-B6E4-4CB10EB0C14D%40microsoft.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043955.html">
   <LINK REL="Next"  HREF="043971.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] xbuild crash with mono 4.6.1?</H1>
    <B>Vlad Brezae</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20xbuild%20crash%20with%20mono%204.6.1%3F&In-Reply-To=%3CBA43CD6A-DC1B-4D03-B6E4-4CB10EB0C14D%40microsoft.com%3E"
       TITLE="[Mono-dev] xbuild crash with mono 4.6.1?">vlbrez at microsoft.com
       </A><BR>
    <I>Tue Oct 18 21:10:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043955.html">[Mono-dev] xbuild crash with mono 4.6.1?
</A></li>
        <LI>Next message (by thread): <A HREF="043971.html">[Mono-dev] xbuild crash with mono 4.6.1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43960">[ date ]</a>
              <a href="thread.html#43960">[ thread ]</a>
              <a href="subject.html#43960">[ subject ]</a>
              <a href="author.html#43960">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello David,

    Based on the crash site, it would seem that we fail to allocate memory from the OS, which means we have an OOM situation, which we poorly handle as of right now.

     Could you check whether this is the case, whether there are mono instances that use more memory than expected. You could consider trying to limit the heap from growing too much by passing MONO_GC_PARAMS=soft-heap-limit=&lt;heap_limit&gt;, unless something is leaking.

Vlad

From: Mono-devel-list &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.dot.net</A>&gt; on behalf of David Evans &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">devans at pacificbiosciences.com</A>&gt;
Date: Tuesday, 18 October 2016 at 20:50
To: mono-devel &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list at lists.ximian.com</A>&gt;
Subject: [Mono-dev] xbuild crash with mono 4.6.1?

I just started building and testing with mono 4.6.1 and I’m seeing an intermittent crash (memory corruption?) now during the build. Happens for me about one time out of ten. Anyone else seeing this or is there a solution already available that I could patch with? We have a fairly large project which uses a lot of memory, but I haven’t seen anything like this building with 4.0.4.1 or when I tried out 4.2.x or 4.3.x Thanks!

Appears to be crashing in sgen when allocating, hence my corruption guess, here’s the native portion of the dying thread:

1.       Thread 1 (Thread 0x7f5ac59f0780 (LWP 2273)):
2.       #0  0x00007f5ac4eccee9 in __libc_waitpid (pid=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">pid at entry</A>=2872, stat_loc=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">stat_loc at entry</A>=0x7f5ac59ff11c, options=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">options at entry</A>=0) at ../sysdeps/unix/sysv/linux/waitpid.c:40
3.       #1  0x00000000004b0bae in mono_handle_native_sigsegv (signal=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">signal at entry</A>=11, ctx=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">ctx at entry</A>=0x7f5ac59ffac0, info=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">info at entry</A>=0x7f5ac59ffbf0) at mini-exceptions.c:2427
4.       #2  0x000000000050674e in mono_arch_handle_altstack_exception (sigctx=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">sigctx at entry</A>=0x7f5ac59ffac0, siginfo=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">siginfo at entry</A>=0x7f5ac59ffbf0, fault_addr=&lt;optimized out&gt;, stack_ovf=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">stack_ovf at entry</A>=0) at exceptions-amd64.c:795
5.       #3  0x0000000000425af2 in mono_sigsegv_signal_handler (_dummy=11, _info=0x7f5ac59ffbf0, context=0x7f5ac59ffac0) at mini-runtime.c:2865
6.       #4  &lt;signal handler called&gt;
7.       #5  alloc_sb (desc=0x7f5aa9fd88c0) at lock-free-alloc.c:146
8.       #6  alloc_from_new_sb (heap=0x993310 &lt;allocators+400&gt;) at lock-free-alloc.c:411
9.       #7  mono_lock_free_alloc (heap=0x993310 &lt;allocators+400&gt;) at lock-free-alloc.c:440
10.   #8  0x00000000006079ce in sgen_alloc_internal (type=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">type at entry</A>=14) at sgen-internal.c:206
11.   #9  0x0000000000606aea in sgen_gray_object_alloc_queue_section (queue=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">queue at entry</A>=0x992f80 &lt;gray_queue&gt;) at sgen-gray.c:58
12.   #10 0x0000000000606b4c in sgen_gray_object_enqueue (queue=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">queue at entry</A>=0x992f80 &lt;gray_queue&gt;, obj=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">obj at entry</A>=0x7f57e1c25530, desc=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">desc at entry</A>=32762) at sgen-gray.c:108
13.   #11 0x0000000000610025 in GRAY_OBJECT_ENQUEUE (desc=&lt;optimized out&gt;, obj=0x7f57e1c25530, queue=0x992f80 &lt;gray_queue&gt;) at ../../mono/sgen/sgen-gray.h:164
14.   #12 major_copy_or_mark_object_no_evacuation (queue=0x992f80 &lt;gray_queue&gt;, obj=&lt;optimized out&gt;, ptr=0x7f57b2a7f580) at sgen-marksweep-drain-gray-stack.h:176
15.   #13 major_scan_object_no_evacuation (queue=0x992f80 &lt;gray_queue&gt;, desc=&lt;optimized out&gt;, full_object=&lt;optimized out&gt;) at sgen-scan-object.h:56
16.   #14 drain_gray_stack_no_evacuation (queue=&lt;optimized out&gt;) at sgen-marksweep-drain-gray-stack.h:309
17.   #15 drain_gray_stack (queue=&lt;optimized out&gt;) at sgen-marksweep.c:1217
18.   #16 0x00000000006023c2 in finish_gray_stack (generation=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">generation at entry</A>=1, ctx=...) at sgen-gc.c:1074
19.   #17 0x000000000060313c in major_finish_collection (reason=0x702ca3 &quot;LOS overflow&quot;, is_overflow=0, old_next_pin_slot=136, forced=0) at sgen-gc.c:1957
20.   #18 0x00000000006034dc in major_do_collection (reason=0x702ca3 &quot;LOS overflow&quot;, is_overflow=0, forced=0) at sgen-gc.c:2083
21.   #19 0x0000000000605c6f in sgen_perform_collection (requested_size=3730512, generation_to_collect=1, reason=0x702ca3 &quot;LOS overflow&quot;, wait_to_finish=0, stw=1) at sgen-gc.c:2279
22.   #20 0x000000000060602c in sgen_ensure_free_space (size=&lt;optimized out&gt;, generation=&lt;optimized out&gt;) at sgen-gc.c:2232
23.   #21 0x000000000060803e in sgen_los_alloc_large_inner (vtable=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">vtable at entry</A>=0x1eb8a38, size=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">size at entry</A>=3730512) at sgen-los.c:379
24.   #22 0x00000000005f93f8 in sgen_alloc_obj_nolock (vtable=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">vtable at entry</A>=0x1eb8a38, size=<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">size at entry</A>=3730512) at sgen-alloc.c:175
25.   #23 0x00000000005e6901 in mono_gc_alloc_vector (vtable=vtable(&quot;Microsoft.Build.Framework.ITaskItem[]&quot;), size=3730512, max_length=466310) at sgen-mono.c:1744
…

And the managed stack looks like:

1.         at &lt;unknown&gt; &lt;0xffffffff&gt;
2.         at (wrapper managed-to-native) object.__icall_wrapper_mono_gc_alloc_vector (intptr,intptr,intptr) &lt;IL 0x00009, 0x0005d&gt;
3.         at (wrapper alloc) object.AllocVector (intptr,intptr) &lt;IL 0x000b3, 0x00143&gt;
4.         at Microsoft.Build.BuildEngine.BuildItemGroup.ConvertToITaskItemArray (Microsoft.Build.BuildEngine.Expression,Microsoft.Build.BuildEngine.Expression,Microsoft.Build.BuildEngine.ExpressionOptions) [0x0001e] in /home/pbi/git/mono/runtime/sources-4.6.1.0/mono-4.6.1/mcs/class/Microsoft.Build.Engine/Microsoft.Build.BuildEngine/BuildItemGroup.cs:256
5.         at Microsoft.Build.BuildEngine.ItemReference.ConvertToITaskItemArray (Microsoft.Build.BuildEngine.Project,Microsoft.Build.BuildEngine.ExpressionOptions) [0x00013] in /home/pbi/git/mono/runtime/sources-4.6.1.0/mono-4.6.1/mcs/class/Microsoft.Build.Engine/Microsoft.Build.BuildEngine/ItemReference.cs:80
6.         at Microsoft.Build.BuildEngine.ExpressionCollection.ConvertToITaskItemArray (Microsoft.Build.BuildEngine.Project,Microsoft.Build.BuildEngine.ExpressionOptions) [0x001cc] in /home/pbi/git/mono/runtime/sources-4.6.1.0/mono-4.6.1/mcs/class/Microsoft.Build.Engine/Microsoft.Build.BuildEngine/ExpressionCollection.cs:228
7.       …

Full traces here:
<A HREF="http://pastebin.com/vQ4630Dv&lt;https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fpastebin.com%2FvQ4630Dv&amp;data=02%7C01%7Cvlbrez%40microsoft.com%7C14c7f03e35954cd37bf608d3f77f5695%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636124098705789846&amp;sdata=E8axBm%2BOnKauibPynBuXu4En5X9%2FrCvIWJewgApwlJA%3D&amp;reserved=0">http://pastebin.com/vQ4630Dv&lt;https://na01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fpastebin.com%2FvQ4630Dv&amp;data=02%7C01%7Cvlbrez%40microsoft.com%7C14c7f03e35954cd37bf608d3f77f5695%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C636124098705789846&amp;sdata=E8axBm%2BOnKauibPynBuXu4En5X9%2FrCvIWJewgApwlJA%3D&amp;reserved=0</A>&gt;

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20161018/313f110b/attachment-0001.html">http://lists.dot.net/pipermail/mono-devel-list/attachments/20161018/313f110b/attachment-0001.html</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043955.html">[Mono-dev] xbuild crash with mono 4.6.1?
</A></li>
	<LI>Next message (by thread): <A HREF="043971.html">[Mono-dev] xbuild crash with mono 4.6.1?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43960">[ date ]</a>
              <a href="thread.html#43960">[ thread ]</a>
              <a href="subject.html#43960">[ subject ]</a>
              <a href="author.html#43960">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
