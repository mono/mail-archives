<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] Patch for mkbundle and embedding Mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20mkbundle%20and%20embedding%20Mono&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021577.html">
   <LINK REL="Next"  HREF="021582.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] Patch for mkbundle and embedding Mono</H1>
    <B>Joshua Tauberer</B> 
    <A HREF="mailto:mono-devel-list%40lists.ximian.com?Subject=%5BMono-dev%5D%20Patch%20for%20mkbundle%20and%20embedding%20Mono&In-Reply-To="
       TITLE="[Mono-dev] Patch for mkbundle and embedding Mono">jit at occams.info
       </A><BR>
    <I>Wed Nov 29 15:12:44 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021577.html">[Mono-dev] mcs and gmcs: help needed [urgent]
</A></li>
        <LI>Next message: <A HREF="021582.html">[Mono-dev] Patch for mkbundle and embedding Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21581">[ date ]</a>
              <a href="thread.html#21581">[ thread ]</a>
              <a href="subject.html#21581">[ subject ]</a>
              <a href="author.html#21581">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I recently found that I could use mkbundle to embed Mono and some
assemblies within an existing native application -- that is, to use
mkbundle not to create a standalone executable, but to package
everything up in a single .o object file.  To do this, I generated the c
stub with the -c option and then basically removed the main() function,
and then linked that into the native app.

I'm attaching a patch that adds a new option --nomain so that mkbundle
can be used to create the c wrapper file without a &quot;int main(...)&quot;
function so that it can be embedded as a library in other applications.
 To do this, I factored out the &quot;int main(...)&quot; code from the
initialization stuff in the C templates and put it into a separate template.

With the patch, the --nomain option only works with the -c (generate
code but don't compile &amp; link) option.  In order to make it work without
-c (to produce the .o file directly), the gcc command line arguments
would have to be modified to produce the .o instead of the linked
executable, and I didn't want to get into that (yet).

(Btw--- This was for one of the most rapid projects I've ever done.  In
3 hours, I took an existing app with a strange internal scripting
language and replaced the scripting language with JavaScript, by
convering the Rhino interpreter from Java to .NET (with my favorite tool
IKVM), embedding Mono in the native app, and using mkbundle to embed
Rhino and other assemblies within the app.  The next step is to get JB's
Linker tool to cut down the IKVM libs to just what I need to embed.)

Comments/permission?

-- 
- Josh Tauberer

<A HREF="http://razor.occams.info">http://razor.occams.info</A>

&quot;Yields falsehood when preceded by its quotation!  Yields
falsehood when preceded by its quotation!&quot; Achilles to
Tortoise (in &quot;G&#246;del, Escher, Bach&quot; by Douglas Hofstadter)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mkbundle.diff
Type: text/x-patch
Size: 4868 bytes
Desc: not available
Url : <A HREF="http://lists.ximian.com/pipermail/mono-devel-list/attachments/20061129/dd264131/attachment.bin">http://lists.ximian.com/pipermail/mono-devel-list/attachments/20061129/dd264131/attachment.bin</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021577.html">[Mono-dev] mcs and gmcs: help needed [urgent]
</A></li>
	<LI>Next message: <A HREF="021582.html">[Mono-dev] Patch for mkbundle and embedding Mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21581">[ date ]</a>
              <a href="thread.html#21581">[ thread ]</a>
              <a href="subject.html#21581">[ subject ]</a>
              <a href="author.html#21581">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
