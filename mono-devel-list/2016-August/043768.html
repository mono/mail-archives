<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-dev] SMTP with SSL, and intermediate certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20SMTP%20with%20SSL%2C%20and%20intermediate%20certificates&In-Reply-To=%3CFAF7289A-7F4C-438E-B9FD-F0F3081E29A6%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="043767.html">
   <LINK REL="Next"  HREF="043780.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-dev] SMTP with SSL, and intermediate certificates</H1>
    <B>Brandon Perry</B> 
    <A HREF="mailto:mono-devel-list%40lists.dot.net?Subject=Re%3A%20%5BMono-dev%5D%20SMTP%20with%20SSL%2C%20and%20intermediate%20certificates&In-Reply-To=%3CFAF7289A-7F4C-438E-B9FD-F0F3081E29A6%40gmail.com%3E"
       TITLE="[Mono-dev] SMTP with SSL, and intermediate certificates">bperry.volatile at gmail.com
       </A><BR>
    <I>Fri Aug 12 14:15:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="043767.html">[Mono-dev] SMTP with SSL, and intermediate certificates
</A></li>
        <LI>Next message (by thread): <A HREF="043780.html">[Mono-dev] SMTP with SSL, and intermediate certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43768">[ date ]</a>
              <a href="thread.html#43768">[ thread ]</a>
              <a href="subject.html#43768">[ subject ]</a>
              <a href="author.html#43768">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I recently had to deal with a similar issue, but ended up with a ridiculous solution that can’t be put into production.

I set up a proxy between the mono app like Burpsuite or another transparent proxy (that can do SMTP in your case) that will happily negotiate a TLS v1.0 connection for the client and a TLS v1.1/1.2 connection for the server.

Hope it helps.

&gt;<i> On Aug 12, 2016, at 9:05 AM, Alexander Köplinger via Mono-devel-list &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list at lists.dot.net</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Correct, mozroots should no longer be required/used.
</I>&gt;<i> 
</I>&gt;<i> The cert-sync tool is the recommended approach for populating Mono’s certificate store on Linux now: <A HREF="http://www.mono-project.com/docs/about-mono/releases/3.12.0/#cert-sync">http://www.mono-project.com/docs/about-mono/releases/3.12.0/#cert-sync</A>
</I>&gt;<i> The Xamarin .deb/.rpm packages run this during package installation, if you built Mono from source you need to run it yourself.
</I>&gt;<i> 
</I>&gt;<i> TLS1.2 support is still a work in progress as far as I know.
</I>&gt;<i> 
</I>&gt;<i> - Alex
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 12/08/16 15:44, &quot;Mono-devel-list on behalf of Edward Ned Harvey (mono)&quot; &lt;<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.dot.net</A> on behalf of <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">edward.harvey.mono at clevertrove.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> From: Mono-devel-list [mailto:<A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">mono-devel-list-bounces at lists.dot.net</A>] On
</I>&gt;&gt;<i> Behalf Of Craig McQueen
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On a Yocto-built embedded Linux system, we're trying to send e-mails
</I>&gt;&gt;<i> through SMTP with SSL (port 465) or MSA (port 587). We're testing with
</I>&gt;&gt;<i> smtp.gmail.com and smtp.zoho.com. We have code that works fine with
</I>&gt;&gt;<i> Windows. But with Mono, we're getting System.IO.IOException: The
</I>&gt;&gt;<i> authentication or decryption has failed.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> We've found on the Mono Security FAQ that we need:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> a) to install root certificates using mozroots or similar.
</I>&gt;&gt;<i> b) to get the intermediate certificates from the SMTPS port 465, using
</I>&gt;&gt;<i> certmgr.
</I>&gt;<i> 
</I>&gt;<i>    Historically, the above was necessary, and maybe some of it still is just because you're on an unusual linux system. (The above is automatically done during rpm/deb install, for later versions of red hat and debian/ubuntu).
</I>&gt;<i> 
</I>&gt;<i>    Historically, there were problems with the SSL/TLS classes in mono, in which a mono server would fail to send intermediates to a client, and a mono client would fail to cache any intermediates received from a non-mono server, resulting in mono client being able to talk to non-mono servers, and mono servers being able to talk to non-mono clients, but mono clients couldn't talk to mono servers.
</I>&gt;<i> 
</I>&gt;<i>    Much of this should hopefully be history now. First of all, there are ways of making mono use the OS crypto API, rather than use its own classes. I can't tell you exactly how to do that, so if you're interested, start a new thread saying exactly how you try to connect to your server (Are you using HttpClient?), and ask if that's using the old mono classes or the OS API, and ask if there's a different constructor you can use (or something) that would force the use of the OS API. (For example, using ModernHttpClient instead?)
</I>&gt;<i> 
</I>&gt;<i>    Also, I've heard, but haven't personally checked or tested, that mono is now using the microsoft TLS stack, including full support for TLS 1.2. So before anything else, try updating to the very latest stable version of mono, and see if that solves your problem.
</I>&gt;<i>    _______________________________________________
</I>&gt;<i>    Mono-devel-list mailing list
</I>&gt;<i>    <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;<i>    <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">http://lists.dot.net/mailman/listinfo/mono-devel-list</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mono-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">Mono-devel-list at lists.dot.net</A>
</I>&gt;<i> <A HREF="http://lists.dot.net/mailman/listinfo/mono-devel-list">http://lists.dot.net/mailman/listinfo/mono-devel-list</A>
</I>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 842 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: &lt;<A HREF="http://lists.dot.net/pipermail/mono-devel-list/attachments/20160812/4e0c1363/attachment-0001.sig">http://lists.dot.net/pipermail/mono-devel-list/attachments/20160812/4e0c1363/attachment-0001.sig</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="043767.html">[Mono-dev] SMTP with SSL, and intermediate certificates
</A></li>
	<LI>Next message (by thread): <A HREF="043780.html">[Mono-dev] SMTP with SSL, and intermediate certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43768">[ date ]</a>
              <a href="thread.html#43768">[ thread ]</a>
              <a href="subject.html#43768">[ subject ]</a>
              <a href="author.html#43768">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.dot.net/mailman/listinfo/mono-devel-list">More information about the Mono-devel-list
mailing list</a><br>
</body></html>
