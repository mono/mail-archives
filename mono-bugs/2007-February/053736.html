<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 80756][Wis] Changed - OutOfMemoryException in	System.Drawing.Graphics.ClipBounds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2080756%5D%5BWis%5D%20Changed%20-%20OutOfMemoryException%20in%0A%09System.Drawing.Graphics.ClipBounds&In-Reply-To=bug-80756%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="053735.html">
   <LINK REL="Next"  HREF="053737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 80756][Wis] Changed - OutOfMemoryException in	System.Drawing.Graphics.ClipBounds</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2080756%5D%5BWis%5D%20Changed%20-%20OutOfMemoryException%20in%0A%09System.Drawing.Graphics.ClipBounds&In-Reply-To=bug-80756%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 80756][Wis] Changed - OutOfMemoryException in	System.Drawing.Graphics.ClipBounds">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Thu Feb  8 10:09:05 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="053735.html">[Mono-bugs] [Bug 80758][Wis] Changed - [WIN] DrawIcon does not work
</A></li>
        <LI>Next message: <A HREF="053737.html">[Mono-bugs] [Bug 80765][Wis] New - Mono	PreviewPrintController.Translation matrix result differs from	the MS one in OnPrintPage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53736">[ date ]</a>
              <a href="thread.html#53736">[ thread ]</a>
              <a href="subject.html#53736">[ subject ]</a>
              <a href="author.html#53736">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sebastien at ximian.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=80756">http://bugzilla.ximian.com/show_bug.cgi?id=80756</A>

--- shadow/80756	2007-02-07 21:09:37.000000000 -0500
+++ shadow/80756.tmp.12964	2007-02-08 10:09:05.000000000 -0500
@@ -1,23 +1,23 @@
 Bug#: 80756
 Product: Mono: Class Libraries
-Version: unspecified
-OS: 
-OS Details: 
+Version: 1.2
+OS: All
+OS Details: non-windows
 Status: NEW   
 Resolution: 
-Severity: 
-Priority: Normal
-Component: Sys.Drawing.
+Severity: Unknown
+Priority: Wishlist
+Component: libgdiplus
 AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>                            
 ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">vlad.dimitrov at gmail.com</A>               
 QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
 TargetMilestone: ---
 URL: 
 Cc: 
-Summary: Crash in System.Drawing.Graphics.ClipBounds
+Summary: OutOfMemoryException in System.Drawing.Graphics.ClipBounds
 
 Please fill in this template when reporting a bug, unless you know what you
 are doing.
 Description of Problem:
 I finally reproduced that bug and figured out the reason for it.
 
@@ -76,6 +76,70 @@
 large as the region but failes.
 
 ------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">vlad.dimitrov at gmail.com</A>  2007-02-07 21:09 -------
 Created an attachment (id=18645)
 Test case to reproduce the problem. Works every time with me.
 
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sebastien at ximian.com</A>  2007-02-08 10:09 -------
+It's not a &quot;crash&quot;, it an (catchable) exception.
+
+&gt; mono ConsoleApplication.exe
+&gt;&gt;&gt;OnPrintPage called
+&gt;&gt;&gt;matrix element #0 = 2
+&gt;&gt;&gt;matrix element #1 = 0
+&gt;&gt;&gt;matrix element #2 = 0
+&gt;&gt;&gt;matrix element #3 = 2
+&gt;&gt;&gt;matrix element #4 = 0
+&gt;&gt;&gt;matrix element #5 = 0
+
+** (&lt;unknown&gt;:28994): WARNING **: Path conversion requested 0 bytes
+(4194304 x 4194304). Maximum size is 8388608 bytes.
+
+Unhandled Exception: System.OutOfMemoryException: Out of memory.
+  at System.Drawing.GDIPlus.CheckStatus (Status status) [0x00000]
+  at System.Drawing.Graphics.get_ClipBounds () [0x00000]
+  at (wrapper remoting-invoke-with-check)
+System.Drawing.Graphics:get_ClipBounds ()
+  at ConsoleApplication.MyPrintDocument.OnPrintPage
+(System.Drawing.Printing.PrintPageEventArgs e) [0x00000]
+  at System.Drawing.Printing.PrintDocument.Print () [0x00000]
+  at (wrapper remoting-invoke-with-check)
+System.Drawing.Printing.PrintDocument:Print ()
+  at ConsoleApplication.Window1.button1_Clicked (System.Object sender,
+System.EventArgs e) [0x00000]
+  at (wrapper delegate-invoke)
+System.MulticastDelegate:invoke_void_object_EventArgs
+(object,System.EventArgs)
+  at GLib.Signal.voidObjectCallback (IntPtr handle, IntPtr gch) [0x00000]
+  at (wrapper native-to-managed) GLib.Signal:voidObjectCallback
+(intptr,intptr)
+  at &lt;0x00000&gt; &lt;unknown method&gt;
+  at (wrapper managed-to-native) Gtk.Application:gtk_main ()
+  at Gtk.Application.Run () [0x00000]
+  at ConsoleApplication.Program.Main (System.String[] args) [0x00000]
+
+Please always include exception (or crash) log when filling bugs.
+
+This is, like we discussed on IRC, two problems. Filling a single bug
+for multiple issues is a good way to get it only half-solved
+(generally the part not included in the summary doesn't get noticed).
+Please fill a separate issue for steps 1-3 as Mono (matrix) result
+differs from the MS one.
+
+Part 4-6 isn't a bug, it's a design limitation. Our region code is
+either math based (if all region parts are rectangle) or bitmap based
+(when non-rectangular parts are present). Bitmap based region can be
+quite large, possibly too large to fit in memory (e.g. operations done
+on infinity). Applying a matrix to a region will change it's shape to
+a (potentially) non-rectangular one (and transform any
+rectangular-based region to a bitmap-based region).
+
+In some cases, like an empty (identity) matrix or a translation-only
+matrix, the existing code won't convert the region to a bitmap (this
+is what happens in step #4). This isn't, currently, the case for a
+scaling matrix (the result of step #3) but this case could be, like
+the previous one, optimized not to require a convertion. This
+optimization, while not a general solution, would solve your
+particular problem.
+
+Setting the bug priority to wishlist.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="053735.html">[Mono-bugs] [Bug 80758][Wis] Changed - [WIN] DrawIcon does not work
</A></li>
	<LI>Next message: <A HREF="053737.html">[Mono-bugs] [Bug 80765][Wis] New - Mono	PreviewPrintController.Translation matrix result differs from	the MS one in OnPrintPage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#53736">[ date ]</a>
              <a href="thread.html#53736">[ thread ]</a>
              <a href="subject.html#53736">[ subject ]</a>
              <a href="author.html#53736">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
