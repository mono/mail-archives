<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 502944] New: StackOverflowException caused by	TraceSource
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20502944%5D%20New%3A%20StackOverflowException%20caused%20by%0A%09TraceSource&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="088784.html">
   <LINK REL="Next"  HREF="088789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 502944] New: StackOverflowException caused by	TraceSource</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20502944%5D%20New%3A%20StackOverflowException%20caused%20by%0A%09TraceSource&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 502944] New: StackOverflowException caused by	TraceSource">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon May 11 23:02:47 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="088784.html">[Mono-bugs] [Bug 446172] the main() generated by mkbundle2 should be Unicode aware
</A></li>
        <LI>Next message: <A HREF="088789.html">[Mono-bugs] [Bug 502944] StackOverflowException caused by	TraceSource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88787">[ date ]</a>
              <a href="thread.html#88787">[ thread ]</a>
              <a href="subject.html#88787">[ subject ]</a>
              <a href="author.html#88787">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=502944">http://bugzilla.novell.com/show_bug.cgi?id=502944</A>


           Summary: StackOverflowException caused by TraceSource
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US;
rv:1.9.0.10) Gecko/2009042315 Firefox/3.0.10 GTB5

(translating reported bug from Japanese community)

If we write settings for trace source in the app config, it results in
StackOverflowException.

It is probably because the r133291 changes caused TraceListenerCollection
constructor giving infinite loop.
<A HREF="http://anonsvn.mono-project.com/viewvc?view=rev&amp;revision=133291">http://anonsvn.mono-project.com/viewvc?view=rev&amp;revision=133291</A>

1. TraceImpl.InitOnce is called from TraceImpl.IndentLevel.
2. TraceSourceInfo instance is created when DiagnosticsConfiguration.Settings
is referenced.
3. TraceSourceInfo creates an instance of TraceListenerCollection.
4. TraceListenerCollection constructor calls Add(), then InitializeListener()
in turn.
5. InitializeListener references TraceImpl.IndentLevel.
6. goto 1 (infinite loop)



Reproducible: Always

Steps to Reproduce:
repro:

[trace.cs]
  using System;
  using System.Diagnostics;

  class MainClass {
    public static void Main(string[] args)
    {
      TraceSource traceSource = new TraceSource(&quot;source1&quot;);

      //traceSource.TraceEvent(TraceEventType.Error, 1, &quot;error event&quot;);
    }
  }

[trace.exe.config]
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
  &lt;configuration&gt;
    &lt;system.diagnostics&gt;
      &lt;trace autoflush=&quot;true&quot;/&gt;
      &lt;sources&gt;
        &lt;source name=&quot;source1&quot; switchName=&quot;switch&quot;
switchType=&quot;System.Diagnostics.SourceSwitch&quot;&gt;
          &lt;!--
          &lt;listeners&gt;
            &lt;add name=&quot;console&quot;
type=&quot;System.Diagnostics.ConsoleTraceListener&quot;/&gt;
          &lt;/listeners&gt;
          --&gt;
        &lt;/source&gt;
      &lt;/sources&gt;
    &lt;/system.diagnostics&gt;
  &lt;/configuration&gt;


Actual Results:  
$ mono trace.exe
Stack overflow in unmanaged: IP: 0x58cac7, fault addr: 0x7fff71af7a58
Stack overflow in unmanaged: IP: 0x58cac7, fault addr: 0x7fff71af7f18

Unhandled Exception: System.StackOverflowException: The requested operation
caused a stack overflow.
  at (wrapper managed-to-native) object:__icall_wrapper_mono_object_new_fast
(intptr)
  at Mono.Xml2.XmlTextReader.IncrementAttributeToken () [0x00000] 
  at Mono.Xml2.XmlTextReader.ReadAttributes (Boolean isXmlDecl) [0x00000] 
  at Mono.Xml2.XmlTextReader.ReadStartTag () [0x00000] 
  at Mono.Xml2.XmlTextReader.ReadContent () [0x00000] 
  at Mono.Xml2.XmlTextReader.Read () [0x00000] 
  at System.Xml.XmlTextReader.Read () [0x00000] 
  at System.Xml.XmlReader.MoveToContent () [0x00000] 
  at System.Configuration.ConfigurationElement.DeserializeElement
(System.Xml.XmlReader reader, Boolean serializeCollectionKey) [0x00000] 
  at System.Configuration.ConfigurationSection.DoDeserializeSection
(System.Xml.XmlReader reader) [0x00000] 
  at System.Configuration.ConfigurationSection.GetRuntimeObject () [0x00000] 
  at System.Configuration.ConfigurationSection.GetRuntimeObject () [0x00000] 
  at System.Configuration.ConfigurationSection.GetRuntimeObject () [0x00000] 
  at System.Configuration.ConfigurationSection.GetRuntimeObject () [0x00000] 
  at
System.Configuration.ClientConfigurationSystem.System.Configuration.Internal.IInternalConfigSystem.GetSection
(System.String configKey) [0x00000] 
  at System.Configuration.ConfigurationManager.GetSection (System.String
sectionName) [0x00000] 
  at System.Configuration.ConfigurationSettings.GetConfig (System.String
sectionName) [0x00000] 
  at System.Diagnostics.DiagnosticsConfiguration.get_Settings () [0x00000] 
  at System.Diagnostics.TraceImpl.InitOnce () [0x00000] 
  at System.Diagnostics.TraceImpl.get_IndentLevel () [0x00000] 
  at System.Diagnostics.TraceListenerCollection.InitializeListener
(System.Diagnostics.TraceListener listener) [0x00000] 
  at System.Diagnostics.TraceListenerCollection.Add
(System.Diagnostics.TraceListener listener) [0x00000] 
  at System.Diagnostics.TraceListenerCollection..ctor (Boolean addDefault)
[0x00000] 
  at System.Diagnostics.TraceListenerCollection..ctor () [0x00000] 
  at System.Diagnostics.TraceSourceInfo..ctor (System.String name, SourceLevels
levels) [0x00000] 
  at System.Diagnostics.DiagnosticsConfigurationHandler.AddTraceSource
(IDictionary d, System.Collections.Hashtable sources, System.Xml.XmlNode node)
[0x00000] 
  at System.Diagnostics.DiagnosticsConfigurationHandler.AddSourcesNode
(IDictionary d, System.Xml.XmlNode node) [0x00000] 
  at System.Diagnostics.DiagnosticsConfigurationHandler.Create (System.Object
parent, System.Object configContext, System.Xml.XmlNode section) [0x00000] 
  at System.Configuration.ConfigurationSection.GetRuntimeObject () [0x00000] 
  at
System.Configuration.ClientConfigurationSystem.System.Configuration.Internal.IInternalConfigSystem.GetSection
(System.String configKey) [0x00000] 
  at System.Configuration.ConfigurationManager.GetSection (System.String
sectionName) [0x00000] 
  at System.Configuration.ConfigurationSettings.GetConfig (System.String
sectionName) [0x00000] 
  at System.Diagnostics.DiagnosticsConfiguration.get_Settings () [0x00000] 
  at System.Diagnostics.TraceImpl.InitOnce () [0x00000] 
  at System.Diagnostics.TraceImpl.get_IndentLevel () [0x00000] 
  at System.Diagnostics.TraceListenerCollection.InitializeListener
(System.Diagnostics.TraceListener listener) [0x00000] 
      :
    (snip)
      :
  at System.Diagnostics.TraceImpl.get_IndentLevel () [0x00000]
  at System.Diagnostics.TraceListenerCollection.InitializeListener
(System.Diagnostics.TraceListener listener) [0x00000]
  at System.Diagnostics.TraceListenerCollection.Add
(System.Diagnostics.TraceListener listener) [0x00000]
  at System.Diagnostics.TraceListenerCollection..ctor (Boolean addDefault)
[0x00000]
  at System.Diagnostics.TraceListenerCollection..ctor () [0x00000]
  at System.Diagnostics.TraceSourceInfo..ctor (System.String name, SourceLevels
levels) [0x00000]
  at System.Diagnostics.DiagnosticsConfigurationHandler.AddTraceSource
(IDictionary d, System.Collections.Hashtable sources, System.Xml.XmlNode node)
[0x00000]
  at System.Diagnostics.DiagnosticsConfigurationHandler.AddSourcesNode
(IDictionary d, System.Xml.XmlNode node) [0x00000]
  at System.Diagnostics.DiagnosticsConfigurationHandler.Create (System.Object
parent, System.Object configContext, System.Xml.XmlNode section) [0x00000]
  at System.Configuration.ConfigurationSection.GetRuntimeObject () [0x00000]
  at
System.Configuration.ClientConfigurationSystem.System.Configuration.Internal.IInternalConfigSystem.GetSection
(System.String configKey) [0x00000]
  at System.Configuration.ConfigurationManager.GetSection (System.String
sectionName) [0x00000]
  at System.Configuration.ConfigurationSettings.GetConfig (System.String
sectionName) [0x00000]
  at System.Diagnostics.DiagnosticsConfiguration.get_Settings () [0x00000]
  at System.Diagnostics.TraceImpl.InitOnce () [0x00000]
  at System.Diagnostics.TraceImpl.get_IndentLevel () [0x00000]
  at System.Diagnostics.TraceListenerCollection.InitializeListener
(System.Diagnostics.TraceListener listener) [0x00000]
  at System.Diagnostics.TraceListenerCollection.Add
(System.Diagnostics.TraceListener listener) [0x00000]
  at System.Diagnostics.TraceListenerCollection..ctor (Boolean addDefault)
[0x00000]
  at System.Diagnostics.TraceListenerCollection..ctor () [0x00000]
  at System.Diagnostics.TraceSourceInfo..ctor (System.String name, SourceLevels
levels) [0x00000]
  at System.Diagnostics.DiagnosticsConfigurationHandler.AddTraceSource
(IDictionary d, System.Collections.Hashtable sources, System.Xml.XmlNode node)
[0x00000]
  at System.Diagnostics.DiagnosticsConfigurationHandler.AddSourcesNode
(IDictionary d, System.Xml.XmlNode node) [0x00000]
  at System.Diagnostics.DiagnosticsConfigurationHandler.Create (System.Object
parent, System.Object configContext, System.Xml.XmlNode section) [0x00000]
  at System.Configuration.ConfigurationSection.GetRuntimeObject () [0x00000]
  at
System.Configuration.ClientConfigurationSystem.System.Configuration.Internal.IInternalConfigSystem.GetSection
(System.String configKey) [0x00000]
  at System.Configuration.ConfigurationManager.GetSection (System.String
sectionName) [0x00000]
  at System.Configuration.ConfigurationSettings.GetConfig (System.String
sectionName) [0x00000]
  at System.Diagnostics.DiagnosticsConfiguration.get_Settings () [0x00000]
  at System.Diagnostics.TraceImpl.InitOnce () [0x00000]
  at System.Diagnostics.TraceImpl.get_IndentLevel () [0x00000]
  at System.Diagnostics.TraceListenerCollection.InitializeListener
(System.Diagnostics.TraceListener listener) [0x00000]
  at System.Diagnostics.TraceListenerCollection.Add
(System.Diagnostics.TraceListener listener) [0x00000]
  at System.Diagnostics.TraceListenerCollection..ctor (Boolean addDefault)
[0x00000]
  at System.Diagnostics.TraceListenerCollection..ctor () [0x00000]

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>







































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="088784.html">[Mono-bugs] [Bug 446172] the main() generated by mkbundle2 should be Unicode aware
</A></li>
	<LI>Next message: <A HREF="088789.html">[Mono-bugs] [Bug 502944] StackOverflowException caused by	TraceSource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88787">[ date ]</a>
              <a href="thread.html#88787">[ thread ]</a>
              <a href="subject.html#88787">[ subject ]</a>
              <a href="author.html#88787">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
