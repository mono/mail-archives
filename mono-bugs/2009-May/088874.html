<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20500987%5D%20SqlCommand%20with%20DateTime%20parameter%20throws%0A%20exception%20%22Error%20converting%20data%20type%20varchar%20to%20datetime%22%20%28impacts%0A%20NHibernate%20and%20Castle%20ActiveRecord%29&In-Reply-To=bug-500987-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="088866.html">
   <LINK REL="Next"  HREF="088879.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20500987%5D%20SqlCommand%20with%20DateTime%20parameter%20throws%0A%20exception%20%22Error%20converting%20data%20type%20varchar%20to%20datetime%22%20%28impacts%0A%20NHibernate%20and%20Castle%20ActiveRecord%29&In-Reply-To=bug-500987-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri May 15 04:08:04 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="088866.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
        <LI>Next message: <A HREF="088879.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88874">[ date ]</a>
              <a href="thread.html#88874">[ thread ]</a>
              <a href="subject.html#88874">[ subject ]</a>
              <a href="author.html#88874">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=500987">http://bugzilla.novell.com/show_bug.cgi?id=500987</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">loic.nageleisen at gmail.com</A> added comment
<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=500987#c9">http://bugzilla.novell.com/show_bug.cgi?id=500987#c9</A>





--- Comment #9 from Loic Nageleisen &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">loic.nageleisen at gmail.com</A>&gt;  2009-05-15 02:08:03 MDT ---
I noticed that in a certain context, some dates were inserting correctly, while
some failed. My hopes were that those were the all-time great classics with
days &gt;12 but of course, no such luck. Here is how my reasoning went, and the
progress so far:

First take note that @p2 is SqlDbType.DateTime

Then, have the cultureinfo match the database language settings:

Thread.CurrentThread.CurrentCulture = new Culture(&quot;en-US&quot;)
new SqlCommand(&quot;SET LANGUAGE us_english&quot;, connection)

Then, have a loop which insert each day in a range of dates (for example a
whole year).

With the above locale settings (US implies a mdy date format), every single
insertion fail.
With 'en-GB' and 'British English' (implies a dmy date format), every single
insertion fail.
With 'fr-FR' and 'Fran&#231;ais', (implies a dmy date format), regardless of year
(starting at year 1753, as per MSSQL requirement), days whose month is 3, 5, 6
or 8 do insert, and the *correct value* is stored in the database, while all
others fail. Years prior to 1753 fail for any month.

In fact, as long as LANGUAGE is set to 'Fran&#231;ais', and regardless of the
CultureInfo, the third case behavior occurs.

Failures all come from the database with the aforementioned exception stack and
message 'Error converting data type varchar to datetime' (text dependent of SET
LANGUAGE value).

Again take note that @p2 is SqlDbType.DateTime. Relating that to the error
message, I wonder why does the database want to parse a *varchar* to a datetime
when the object is supposed to be passed on to the database as a DateTime?

If I then modify @p2 to be a SqlDbType.VarChar (all else being equal), all
insertions are successful regardless of the language, as long as CultureInfo
and LANGUAGE match. Being a VarChar, this behavior is correct and makes sense,
as they have to communicate data in the same language to be able to generate
and parse the string.

This last point is of course the whole point of using SqlDbType.DateTime
instead of SqlDbType.VarChar, as the result should then be independent of
client and server locale settings. Trouble is:
1. it doesn't work.
2. behavior varies with database LANGUAGE setting.

This is weird, and veers towards borderline insane knowing you can't replicate
it, as I can't see what's different in our setups apart from the fact that I
run the MSSQL servers on French Windows variants, but can't begin to think why
that should be relevant.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="088866.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
	<LI>Next message: <A HREF="088879.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88874">[ date ]</a>
              <a href="thread.html#88874">[ thread ]</a>
              <a href="subject.html#88874">[ subject ]</a>
              <a href="author.html#88874">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
