<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20500987%5D%20SqlCommand%20with%20DateTime%20parameter%20throws%0A%20exception%20%22Error%20converting%20data%20type%20varchar%20to%20datetime%22%20%28impacts%0A%20NHibernate%20and%20Castle%20ActiveRecord%29&In-Reply-To=bug-500987-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="088874.html">
   <LINK REL="Next"  HREF="088881.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20500987%5D%20SqlCommand%20with%20DateTime%20parameter%20throws%0A%20exception%20%22Error%20converting%20data%20type%20varchar%20to%20datetime%22%20%28impacts%0A%20NHibernate%20and%20Castle%20ActiveRecord%29&In-Reply-To=bug-500987-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri May 15 05:56:19 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="088874.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
        <LI>Next message: <A HREF="088881.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88879">[ date ]</a>
              <a href="thread.html#88879">[ thread ]</a>
              <a href="subject.html#88879">[ subject ]</a>
              <a href="author.html#88879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=500987">http://bugzilla.novell.com/show_bug.cgi?id=500987</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">loic.nageleisen at gmail.com</A> added comment
<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=500987#c10">http://bugzilla.novell.com/show_bug.cgi?id=500987#c10</A>





--- Comment #10 from Loic Nageleisen &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">loic.nageleisen at gmail.com</A>&gt;  2009-05-15 03:56:17 MDT ---
I think I found the cause by tooking a peek to Mono 2.4 source code via anonsvn
viewvc.

In Tds70.cs, you can find:

--snip
private string FormatParameter (TdsMetaParameter parameter)
--snip--
            case &quot;smalldatetime&quot;:
            case &quot;datetime&quot;:
                DateTime d = Convert.ToDateTime (parameter.Value);
                value = String.Format (base.Locale,
                    &quot;'{0:MMM dd yyyy hh:mm:ss.fff tt}'&quot;, d);
                break;
--snip

I then made a loop which rendered dates in en-US and fr-FR, and ran it locally.

Short month names in english:
Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec

Short month names in french:
janv. f&#233;vr. mars avr. mai juin juil. ao&#251;t sept. oct. nov. d&#233;c.

Failing months have a dot in their name, successful months don't.

My first bet is MSSQL uses the OS to format and parse dates. As I am on a
French Windows which has zero support for localization, its API always returns
french names, thus there is zero chance MSSQL would parse US month names
correctly, because names all differ in some way or another.

My second bet is one of two:
- even french month names don't all match between Mono and Windows French,
either because there's no short version at all, or they're shortened
differently.
- the dot itself causes a parse error inside MSSQL.

This is coherent as for why it works for you and not for me, regardless of the
fact we use the exact same version (both number and locale) of MSSQL and Mono,
the sole difference being the OS.

In any case, I understand how the textual month representation has been used in
Mono to make date/month order unambiguous, but this has a number of
implications like this one... A first step may be to use the full month name
instead of the shortened version, but this is only a shaky fix, as it requires
the client to have is thread run in then same locale as the OS the MSSQL server
runs on.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="088874.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
	<LI>Next message: <A HREF="088881.html">[Mono-bugs] [Bug 500987] SqlCommand with DateTime parameter throws exception &quot;Error converting data type varchar to datetime&quot; (impacts NHibernate and Castle ActiveRecord)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88879">[ date ]</a>
              <a href="thread.html#88879">[ thread ]</a>
              <a href="subject.html#88879">[ subject ]</a>
              <a href="author.html#88879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
