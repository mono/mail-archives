<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 49499][Cri] Changed - mono:: segfaults under Fedora Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="008125.html">
   <LINK REL="Next"  HREF="008127.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 49499][Cri] Changed - mono:: segfaults under Fedora Linux
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 49499][Cri] Changed - mono:: segfaults under Fedora Linux">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Mon, 20 Oct 2003 12:20:10 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="008125.html">[Mono-bugs] [Bug 49871][Cri] New - xml validating reader bug for parsing TOKEN type
</A></li>
        <LI> Next message: <A HREF="008127.html">[Mono-bugs] [Bug 48012][Nor] Changed - XmlTextReader fails to parse valid XML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8126">[ date ]</a>
              <a href="thread.html#8126">[ thread ]</a>
              <a href="subject.html#8126">[ subject ]</a>
              <a href="author.html#8126">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:tds00mahi@thn.htu.se.">tds00mahi@thn.htu.se.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=49499">http://bugzilla.ximian.com/show_bug.cgi?id=49499</A>

--- shadow/49499	2003-10-20 09:36:02.000000000 -0400
+++ shadow/49499.tmp.27980	2003-10-20 12:20:10.000000000 -0400
@@ -314,6 +314,27 @@
 is enough? Doing another syscall is expensive, and it should really be
 no different. Still, this is weird, since we don't execute code from
 the PE binaries: there must be some other bug (maybe in RH's kernel).
 Do you get the same backtrace for the segfaults as Raphael? Can you
 print in gdb the variables accessed on the segfault line (method-&gt;name
 and klass)?
+
+------- Additional Comments From <A HREF="mailto:tds00mahi@thn.htu.se">tds00mahi@thn.htu.se</A>  2003-10-20 12:20 -------
+I had myself confused here for a while why the patch actually worked,
+I think I might have a better solution than mprotect - mostly because
+the mprotect one is downright confusing.
+
+Adding the PROT_EXEC to the mmap call did not work, honestly I don't
+know why but from what I understand of exec-shield it moves mappings
+around and only allows execution rights within certain memory areas
+(or, I'm way off, in which case you may now start to point and laugh :-).
+
+Eventually I came across the exec-shield notes here:
+<A HREF="http://distro.ibiblio.org/pub/Linux/distributions/redhat/rawhide/i386/RELEASE-NOTES">http://distro.ibiblio.org/pub/Linux/distributions/redhat/rawhide/i386/RELEASE-NOTES</A>
+. And by doing an 'export LDFLAGS=-Wl,-z,execstack' to mark the
+binaries as having executable stacks (I reckon exec-shield also
+prevents exec rights on mmap()ed areas and malloc()ed heap, but I'm
+not sure if this flag revokes those rights as well?) I get successful
+results. So I guess this is the preferred way to do it? I don't know
+if this should be passed all the time or if we only should do it if it
+is compiled with a toolchain that specifies the .note.GNU-stack and
+PT_GNU_STACK.

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="008125.html">[Mono-bugs] [Bug 49871][Cri] New - xml validating reader bug for parsing TOKEN type
</A></li>
	<LI> Next message: <A HREF="008127.html">[Mono-bugs] [Bug 48012][Nor] Changed - XmlTextReader fails to parse valid XML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8126">[ date ]</a>
              <a href="thread.html#8126">[ thread ]</a>
              <a href="subject.html#8126">[ subject ]</a>
              <a href="author.html#8126">[ author ]</a>
         </LI>
       </UL>
</body></html>
