<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 49555][Nor] Changed - private extern Assembly LoadAssembly (AssemblyName assemblyRef, Evidence securityEvidence) does not expose strongname publickey
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="007834.html">
   <LINK REL="Next"  HREF="007836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 49555][Nor] Changed - private extern Assembly LoadAssembly (AssemblyName assemblyRef, Evidence securityEvidence) does not expose strongname publickey
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 49555][Nor] Changed - private extern Assembly LoadAssembly (AssemblyName assemblyRef, Evidence securityEvidence) does not expose strongname publickey">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Sat, 11 Oct 2003 13:07:28 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="007834.html">[Mono-bugs] [Bug 49557][Min] New - AssemblyBuilder.cs doesn't process AssemblyKeyNameAttribute
</A></li>
        <LI> Next message: <A HREF="007836.html">[Mono-bugs] [Bug 49558][Nor] New - ConfigurationSettings.AppSettings[&quot;keyname&quot;] where &lt;appSettings&gt; element is missing from the .config file (or the tagname was mistyped)  hangs the application.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7835">[ date ]</a>
              <a href="thread.html#7835">[ thread ]</a>
              <a href="subject.html#7835">[ subject ]</a>
              <a href="author.html#7835">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:spouliot@videotron.ca.">spouliot@videotron.ca.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=49555">http://bugzilla.ximian.com/show_bug.cgi?id=49555</A>

--- shadow/49555	2003-10-11 12:39:26.000000000 -0400
+++ shadow/49555.tmp.20421	2003-10-11 13:07:28.000000000 -0400
@@ -100,6 +100,46 @@
 
 Note: We'll (eventually) need to check the signature (using this 
 public key) and throw an exception if the signature can't be 
 validated. Most of the code for doing so is in the class library. 
 Where should the validation/exception be thrown ? the managed class 
 library or the unmanaged runtime ?
+
+------- Additional Comments From <A HREF="mailto:spouliot@videotron.ca">spouliot@videotron.ca</A>  2003-10-11 13:07 -------
+this is from in /mono/mono/metadata/reflection.c
+line 2697 (at least today)
+
+values [MONO_ASSEMBLY_PUBLIC_KEY] = load_public_key (assemblyb-
+&gt;keyfile, assembly);
+
+Ah, it happens that the hello.snk file is 596 bytes - just the size 
+of the public key inserted into the assembly (instead of 160 bytes). 
+This is because there are 2 formats for SNK (well maybe more than 2).
+
+When you generate a SNK file (sn -k) you get a SNK file with BOTH a 
+public and private key. However you ONLY embed the public key inside 
+the assembly. It's worth mentioning that many people use the SNK 
+extension for both the keypair (public/private) or the public key. 
+So this can be misleading.
+
+So doing:
+sn -p hello.snk hello.pub
+extracts the public key from the SNK file - giving us a 160 bytes 
+file. This is the file to embed into the assembly.
+
+There is some managed code for converting CAPI structures(both 
+private/public and public 
+formats) /mcs/class/Mono.Security/Mono.Security.Cryptography/CryptoCo
+nvert.cs
+
+An unmanaged version of something like this:
+
+byte[] snkeypair = ...
+// read data from private/public SNK file into snkbuf
+RSA rsa = CryptoConvert.FromCapiPrivateKeyBlob (snkbuf);
+byte[] snpubkey = CryptoConvert.ToCapiPublicKeyBlob (rsa);
+// save data into assembly
+
+should do the trick.
+
+
+

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="007834.html">[Mono-bugs] [Bug 49557][Min] New - AssemblyBuilder.cs doesn't process AssemblyKeyNameAttribute
</A></li>
	<LI> Next message: <A HREF="007836.html">[Mono-bugs] [Bug 49558][Nor] New - ConfigurationSettings.AppSettings[&quot;keyname&quot;] where &lt;appSettings&gt; element is missing from the .config file (or the tagname was mistyped)  hangs the application.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7835">[ date ]</a>
              <a href="thread.html#7835">[ thread ]</a>
              <a href="subject.html#7835">[ subject ]</a>
              <a href="author.html#7835">[ author ]</a>
         </LI>
       </UL>
</body></html>
