<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 399175] New: InvalidProgramException for unreachable code in iterator with CodeDomProvider
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20399175%5D%20New%3A%20InvalidProgramException%20for%0A%20unreachable%20code%20in%20iterator%20with%20CodeDomProvider&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="075530.html">
   <LINK REL="Next"  HREF="075264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 399175] New: InvalidProgramException for unreachable code in iterator with CodeDomProvider</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20399175%5D%20New%3A%20InvalidProgramException%20for%0A%20unreachable%20code%20in%20iterator%20with%20CodeDomProvider&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 399175] New: InvalidProgramException for unreachable code in iterator with CodeDomProvider">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Jun 11 03:50:53 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="075530.html">[Mono-bugs] [Bug 399138] NullReferenceException when compiling mono-tools/gendarme
</A></li>
        <LI>Next message: <A HREF="075264.html">[Mono-bugs] [Bug 399175] InvalidProgramException for unreachable code in iterator with CodeDomProvider
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75263">[ date ]</a>
              <a href="thread.html#75263">[ thread ]</a>
              <a href="subject.html#75263">[ subject ]</a>
              <a href="author.html#75263">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=399175">https://bugzilla.novell.com/show_bug.cgi?id=399175</A>


           Summary: InvalidProgramException for unreachable code in iterator
                    with CodeDomProvider
           Product: Mono: Compilers
           Version: 1.9.0
          Platform: i386
        OS/Version: Windows Vista
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: C#
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jeff at thefirst.org</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


When normally compiled, an iterator gives a compiler warning for unreachable
code, but otherwise executes correctly. However, when the same code is compiled
in a CodeDomProvider, it throws an InvalidProgramException when executed. But I
would expect it to execute the same way.

To reproduce, compile and run the following code (also attached).
Using the iterator directly with Temporary.Temporary.func() works correctly,
but using the same iterator compiled with CodeDomProvider throws an
InvalidProgramException.
Even though the &quot;yield break&quot; makes the code following it unreachable, I expect
the code compiled with CodeDomProvider to behave the same as normally-compiled
code called directly with Temporary.Temporary.func().
Even though the code after &quot;yield break&quot; is not reached, the bug still requires
it to be there as a foreach loop with its own &quot;yield return&quot;. The bug is not
produced if the code after &quot;yield break&quot; is removed, or if it is changed to
some kind of code other than a foreach loop with its own &quot;yield return&quot;.

using System;
using System.Collections.Generic;
using System.CodeDom.Compiler;

class TestDomProvider
{
    static void Main(string[] args)
    {
        string source = @&quot;
using System;
using System.Collections.Generic;

namespace Temporary
{
    public class Temporary
    {
        public static IEnumerable&lt;char&gt; func()
        {
            yield return '0';
            yield break;
            foreach (char c in &quot;&quot;1&quot;&quot;)
            {
                yield return c;
            }
        }
    }
}
&quot;;
        var parameters = new CompilerParameters();
        // This gets the location of the System assembly.
       
parameters.ReferencedAssemblies.Add(typeof(System.Int32).Assembly.Location);
        parameters.GenerateInMemory = true;
        var results =
CodeDomProvider.CreateProvider(&quot;CSharp&quot;).CompileAssemblyFromSource(parameters,
source);
        var compiledType =
results.CompiledAssembly.GetType(&quot;Temporary.Temporary&quot;);

        // This works:
        foreach (char c in Temporary.Temporary.func()) { }
        // This should do the same thing but gives InvalidProgramException:
        foreach (char c in
(IEnumerable&lt;char&gt;)compiledType.GetMethod(&quot;func&quot;).Invoke(null, new object[0]))
{ }
    }
}

namespace Temporary
{
    public class Temporary
    {
        public static IEnumerable&lt;char&gt; func()
        {
            yield return '0';
            yield break;
            foreach (char c in &quot;1&quot;)
            {
                yield return c;
            }
        }
    }
}


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>

































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="075530.html">[Mono-bugs] [Bug 399138] NullReferenceException when compiling mono-tools/gendarme
</A></li>
	<LI>Next message: <A HREF="075264.html">[Mono-bugs] [Bug 399175] InvalidProgramException for unreachable code in iterator with CodeDomProvider
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75263">[ date ]</a>
              <a href="thread.html#75263">[ thread ]</a>
              <a href="subject.html#75263">[ subject ]</a>
              <a href="author.html#75263">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
