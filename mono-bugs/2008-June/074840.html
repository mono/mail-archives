<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 325386] GC crashes on daily basis
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20325386%5D%20GC%20crashes%20on%20daily%20basis&In-Reply-To=bug-325386-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="074847.html">
   <LINK REL="Next"  HREF="074841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 325386] GC crashes on daily basis</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20325386%5D%20GC%20crashes%20on%20daily%20basis&In-Reply-To=bug-325386-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 325386] GC crashes on daily basis">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Jun  9 01:19:39 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="074847.html">[Mono-bugs] [Bug 398374] XmlSerializer.Deserialize() fails to parse valid? XML ( Works in Microsoft.NET)
</A></li>
        <LI>Next message: <A HREF="074841.html">[Mono-bugs] [Bug 325386] GC crashes on daily basis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74840">[ date ]</a>
              <a href="thread.html#74840">[ thread ]</a>
              <a href="subject.html#74840">[ subject ]</a>
              <a href="author.html#74840">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=325386">https://bugzilla.novell.com/show_bug.cgi?id=325386</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">dmiles at users.sourceforge.net</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=325386#c6">https://bugzilla.novell.com/show_bug.cgi?id=325386#c6</A>


Douglas Miles &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">dmiles at users.sourceforge.net</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
         AssignedTo|<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>                                |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">dmiles at users.sourceforge.net</A>
             Status|REOPENED                                        |ASSIGNED




--- Comment #6 from Douglas Miles &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">dmiles at users.sourceforge.net</A>&gt;  2008-06-08 23:19:38 MDT ---
TRIED SOME THINGS OUT


I recompiled mono: --enable-large-heap --with-gc=none

Mono JIT compiler version 1.9 (/trunk/ r105275)
Copyright (C) 2002-2008 Novell, Inc and Contributors. www.mono-project.com
        TLS:           __thread
        GC:            none
        SIGSEGV:       altstack
        Notifications: epoll
        Architecture:  amd64
        Disabled:      none


And the application preformed quickly (like a rocket!) and used 14GB ram
most of the time with only 7.1GB swapped in.
Of course as to be expected did not have this bug w/ GC turned off.


Then again --enable-large-heap --with-gc=boehm

[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">root at titan</A> mono]# mono --version
Mono JIT compiler version 1.9 (/trunk/ r105275)
Copyright (C) 2002-2008 Novell, Inc and Contributors. www.mono-project.com
        TLS:           __thread
        GC:            System Boehm (with typed GC)
        SIGSEGV:       altstack
        Notifications: epoll
        Architecture:  amd64
        Disabled:      none


And the application preformed a bit slower (30 minutes to run turned into 120
minutes)

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 1235 root      20   0 3667m 3.4g  68m S 98.6 43.6  83:00.05 mono


And then crashed with:



Initializing minor paraphrase CycL structures... DONE (16:14)

Loading pph-phrase shells
 [ 30% 40% 50% 60% 70% 80% 90% 100% DONE (0:16) ]

Loading pph-phrase definitions
 [. (0:05 of ~8:20)
  .... 10%.... 20%.... 30%.... 40%.... 50%.... 60%Too many heap sections:
Increase MAXHINCR or MAX_HEAP_SECTS
Stacktrace:

  at (wrapper managed-to-native)
System.Object.__icall_wrapper_mono_object_new_fast (intptr) &lt;0x00048&gt;
  at (wrapper managed-to-native)
System.Object.__icall_wrapper_mono_object_new_fast (intptr) &lt;0xffffffff&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObjectFactory.makeCons
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x00033&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.subLisp.ConsesLow.cons
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x00017&gt;
  at com.cyc.cycjava.cycl.pph_utilities.new_pph_agr_constraint
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x00017&gt;
  at com.cyc.cycjava.cycl.pph_data_structures.cfasl_input_pph_phrase_agr
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x0011f&gt;
  at $cfasl_input_pph_phrase_agr$UnaryFunction.processItem
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x00013&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.subLisp.Functions.funcall
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x0003b&gt;
  at com.cyc.cycjava.cycl.cfasl.cfasl_input_internal
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x000ef&gt;
  at com.cyc.cycjava.cycl.cfasl.cfasl_input
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x00423&gt;
  at com.cyc.cycjava.cycl.pph_data_structures.load_pph_phrase_content
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x00147&gt;
  at com.cyc.cycjava.cycl.dumper.load_pph_phrase_def
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject)
&lt;0x0002f&gt;
  at com.cyc.cycjava.cycl.dumper.load_pph_phrase_defs
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x0069b&gt;
  at com.cyc.cycjava.cycl.dumper.load_paraphrase_cycl_caches
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x0049b&gt;
  at com.cyc.cycjava.cycl.dumper.load_computable_remaining_hl
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x00243&gt;
  at com.cyc.cycjava.cycl.dumper.load_computable_content
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x00017&gt;
  at com.cyc.cycjava.cycl.dumper.kb_load_from_directory
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x0031f&gt;
  at com.cyc.cycjava.cycl.dumper.load_kb
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x000f3&gt;
  at (wrapper runtime-invoke)
com.cyc.cycjava.cycl.event_model.runtime_invoke_SubLObject_SubLObject
(object,intptr,intptr,intptr) &lt;0xffffffff&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0x00050&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0xffffffff&gt;
  at System.Reflection.MonoMethod.Invoke
(object,System.Reflection.BindingFlags,System.Reflection.Binder,object[],System.Globalization.CultureInfo)
&lt;0x000c7&gt;
  at System.Reflection.MethodBase.Invoke (object,object[]) &lt;0x0002d&gt;
  at IKVM.Internal.MethodWrapper.InvokeImpl
(System.Reflection.MethodBase,object,object[],bool) &lt;0x00757&gt;
  at IKVM.Internal.MethodWrapper.Invoke (object,object[],bool) &lt;0x0003f&gt;
  at MethodAccessorImpl.invoke (object,object[]) &lt;0x00130&gt;
  at java.lang.reflect.Method.invoke (object,object[]) &lt;0x00185&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.type.operator.SubLCompiledFunction.apply
(object[]) &lt;0x0009b&gt;
  at
com.cyc.tool.subl.jrtl.nativeCode.type.operator.AbstractSubLFunction.evalViaApply
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLCons,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLEnvironment)
&lt;0x0059a&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.type.core.AbstractSubLList.eval
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLEnvironment) &lt;0x000f8&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.subLisp.Eval.eval
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x00026&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.subLisp.Eval.load
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x002d3&gt;
  at (wrapper runtime-invoke)
com.cyc.tool.subl.jrtl.nativeCode.subLisp.Symbols.runtime_invoke_SubLObject_SubLObject
(object,intptr,intptr,intptr) &lt;0xffffffff&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0x00050&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0xffffffff&gt;
  at System.Reflection.MonoMethod.Invoke
(object,System.Reflection.BindingFlags,System.Reflection.Binder,object[],System.Globalization.CultureInfo)
&lt;0x000c7&gt;
  at System.Reflection.MethodBase.Invoke (object,object[]) &lt;0x0002d&gt;
  at IKVM.Internal.MethodWrapper.InvokeImpl
(System.Reflection.MethodBase,object,object[],bool) &lt;0x00757&gt;
  at IKVM.Internal.MethodWrapper.Invoke (object,object[],bool) &lt;0x0003f&gt;
  at MethodAccessorImpl.invoke (object,object[]) &lt;0x00130&gt;
  at java.lang.reflect.Method.invoke (object,object[]) &lt;0x00185&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.type.operator.SubLCompiledFunction.apply
(object[]) &lt;0x0009b&gt;
  at
com.cyc.tool.subl.jrtl.nativeCode.type.operator.AbstractSubLFunction.evalViaApply
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLCons,com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLEnvironment)
&lt;0x0059a&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.type.core.AbstractSubLList.eval
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLEnvironment) &lt;0x000f8&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.subLisp.Eval.eval
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x00026&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.subLisp.Eval.load
(com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLObject) &lt;0x002d3&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.subLisp.SubLMain$1.safeRun () &lt;0x0033f&gt;
  at com.cyc.tool.subl.jrtl.nativeCode.type.core.SubLProcess.run () &lt;0x00854&gt;
  at java.util.concurrent.ThreadPoolExecutor.runWorker
(java.util.concurrent.ThreadPoolExecutor/Worker) &lt;0x0027d&gt;
  at Worker.run () &lt;0x0001f&gt;
  at java.lang.Thread.run () &lt;0x00026&gt;
  at VMThread.ThreadProc () &lt;0x000af&gt;
  at (wrapper runtime-invoke) System.Object.runtime_invoke_void
(object,intptr,intptr,intptr) &lt;0xffffffff&gt;

Native stacktrace:

        mono [0x553fd1]
        /lib64/libpthread.so.0 [0x3d54e0f110]
        /lib64/libc.so.6(gsignal+0x35) [0x3d54232fb5]
        /lib64/libc.so.6(abort+0x183) [0x3d54234b23]
        /usr/lib64/libgc.so.1 [0x1279b5]
        /usr/lib64/libgc.so.1(GC_add_to_heap+0x8c) [0x11d4fc]
        /usr/lib64/libgc.so.1(GC_expand_hp_inner+0xe8) [0x11d698]
        /usr/lib64/libgc.so.1(GC_collect_or_expand+0x8d) [0x11e2cd]
        /usr/lib64/libgc.so.1(GC_allocobj+0xf6) [0x11e906]
        /usr/lib64/libgc.so.1(GC_generic_malloc_inner+0xf3) [0x1235b3]
        /usr/lib64/libgc.so.1(GC_generic_malloc_many+0x326) [0x124396]
        /usr/lib64/libgc.so.1(GC_gcj_malloc+0xe9) [0x12cb29]
        [0x37a4b8]

Debug info from gdb:

[Thread debugging using libthread_db enabled]
[New Thread 0x7f275c6b67b0 (LWP 1235)]
[New Thread 0x4164c950 (LWP 1239)]
[New Thread 0x40453950 (LWP 1237)]
[New Thread 0x41164950 (LWP 1236)]
0x0000003d54e0b57d in pthread_cond_timedwait@@GLIBC_2.3.2 () from
/lib64/libpthread.so.0
  4 Thread 0x41164950 (LWP 1236)  0x0000003d54e0e871 in nanosleep () from
/lib64/libpthread.so.0
  3 Thread 0x40453950 (LWP 1237)  0x0000003d54e0b2f9 in
pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0
  2 Thread 0x4164c950 (LWP 1239)  0x0000003d54e0df6b in read () from
/lib64/libpthread.so.0
* 1 Thread 0x7f275c6b67b0 (LWP 1235)  0x0000003d54e0b57d in
pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0



QUESTION:   --enable-large-heap  I know is unsupported.. but with
--with-gc=boehm,  Is libgc still thinking in small heap?








An idea i had about this bug (i am not a IKVM/Mono developer so this is just my
guess):

1) I am creating a server socket thats expected to throw a socket timeout
exception inside IKVM code every 30 seconds.

2) I am using a large amount of memory and this makes garbage collection happen
at a higher % of the time due to the fact I could have been bumping my head on
some available free memory trigger.

3) IKVM when it receives the timeout exception it has to create the user
exception details to get ready to throw itself outside of the ikvm libraries.
So this process has to create some new objects. Also it has some objects it's
going to dispose of that were part of the socket service (such as a timer) .

4) GC is in the middle of a fishing expedition for more ram and IKVM has
offered up a poisened sacrafice (like the above mentioned fictional timer) to
it in exchange for ram to create the exception.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>


























































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="074847.html">[Mono-bugs] [Bug 398374] XmlSerializer.Deserialize() fails to parse valid? XML ( Works in Microsoft.NET)
</A></li>
	<LI>Next message: <A HREF="074841.html">[Mono-bugs] [Bug 325386] GC crashes on daily basis
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74840">[ date ]</a>
              <a href="thread.html#74840">[ thread ]</a>
              <a href="subject.html#74840">[ subject ]</a>
              <a href="author.html#74840">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
