<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 399959] BinaryReader : ReadChars problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20399959%5D%20BinaryReader%20%3A%20ReadChars%20problem&In-Reply-To=bug-399959-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="075448.html">
   <LINK REL="Next"  HREF="075522.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 399959] BinaryReader : ReadChars problem</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20399959%5D%20BinaryReader%20%3A%20ReadChars%20problem&In-Reply-To=bug-399959-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 399959] BinaryReader : ReadChars problem">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Jun 13 17:27:45 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="075448.html">[Mono-bugs] [Bug 399959] BinaryReader : ReadChars problem
</A></li>
        <LI>Next message: <A HREF="075522.html">[Mono-bugs] [Bug 399959] BinaryReader skips invalid characters by default, MSFT 2. 0 SP1 doesn't
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75483">[ date ]</a>
              <a href="thread.html#75483">[ thread ]</a>
              <a href="subject.html#75483">[ subject ]</a>
              <a href="author.html#75483">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=399959">https://bugzilla.novell.com/show_bug.cgi?id=399959</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=399959#c2">https://bugzilla.novell.com/show_bug.cgi?id=399959#c2</A>


Andy Hume &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
                 CC|                                                |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>




--- Comment #2 from Andy Hume &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>&gt;  2008-06-13 15:27:44 MDT ---
The text in the file contains eight invalid characters so MSFT's UTF8Encoding,
as used by default by BinaryReader, converts them to U+FFFD, i.e. REPLACEMENT
CHARACTER, so gets 64 chars from 64 bytes.  Mono (etc) just skips them, so
needs to read onward to get eight more.  Hence the difference.  The U+FFFD
behaviour is new in .NET 2.0 SP1 [1], so if you run your app on MSFT FX 1.1, or
on the original FX2, you'll see the same problem.  I've tested the first at
least!

The text in the file appears to contain fifteen bytes of (ASCII/Latin) null
terminated text, with the remaining 48 bytes being uninitialised data -- thus
the invalid bytes.  If the specification says 64 _bytes_ of text then the best
solution would be to just use ReadBytes(64) and then encoding.GetString;
that'll work in all situations.  Initializing BinaryReader with Encoding.ASCII
(or a Latin one) is another possibility.

If you're also writing the file then remember to null those buffers!


[1] See 
<A HREF="http://support.microsoft.com/kb/940521/">http://support.microsoft.com/kb/940521/</A>
<A HREF="http://blogs.msdn.com/michkap/archive/2007/09/17/4950277.aspx">http://blogs.msdn.com/michkap/archive/2007/09/17/4950277.aspx</A>
<A HREF="http://blogs.msdn.com/shawnste/archive/2007/07/23/utf-16-utf-8-utf-32-update-to-conform-with-unicode-5-0-s-security-concerns.aspx">http://blogs.msdn.com/shawnste/archive/2007/07/23/utf-16-utf-8-utf-32-update-to-conform-with-unicode-5-0-s-security-concerns.aspx</A>
etc


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="075448.html">[Mono-bugs] [Bug 399959] BinaryReader : ReadChars problem
</A></li>
	<LI>Next message: <A HREF="075522.html">[Mono-bugs] [Bug 399959] BinaryReader skips invalid characters by default, MSFT 2. 0 SP1 doesn't
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75483">[ date ]</a>
              <a href="thread.html#75483">[ thread ]</a>
              <a href="subject.html#75483">[ subject ]</a>
              <a href="author.html#75483">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
