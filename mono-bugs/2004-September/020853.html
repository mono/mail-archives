<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 66111][Nor] New - DataRow.GetParentRows() Incompatible with .NET 1.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="020855.html">
   <LINK REL="Next"  HREF="020854.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 66111][Nor] New - DataRow.GetParentRows() Incompatible with .NET 1.1
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 66111][Nor] New - DataRow.GetParentRows() Incompatible with .NET 1.1">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Thu, 16 Sep 2004 13:24:22 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="020855.html">[Mono-bugs] [Bug 66060][Min] Changed - AppDomain.AssemblyResolve event not emitted
</A></li>
        <LI> Next message: <A HREF="020854.html">[Mono-bugs] [Bug 66111][Nor] Changed - DataRow.GetParentRows() Incompatible with .NET 1.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20853">[ date ]</a>
              <a href="thread.html#20853">[ thread ]</a>
              <a href="subject.html#20853">[ subject ]</a>
              <a href="author.html#20853">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:rscaletta@augustmack.com.">rscaletta@augustmack.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=66111">http://bugzilla.ximian.com/show_bug.cgi?id=66111</A>

--- shadow/66111	2004-09-16 13:24:22.000000000 -0400
+++ shadow/66111.tmp.7874	2004-09-16 13:24:22.000000000 -0400
@@ -0,0 +1,108 @@
+Bug#: 66111
+Product: Mono: Class Libraries
+Version: unspecified
+OS: GNU/Linux [Other]
+OS Details: Fedora Core 2
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Normal
+Component: Sys.Data
+AssignedTo: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>                            
+ReportedBy: <A HREF="mailto:rscaletta@augustmack.com">rscaletta@augustmack.com</A>               
+QAContact: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: DataRow.GetParentRows() Incompatible with .NET 1.1
+
+Description of Problem: 
+Given a DataRelation between two tables in a DataSet, set
+DataSet.EnforceConstraints = false.  Now create two valid rows in the
+database that relate.  DataRow.GetParentRow(DataRelation) returns null
+instead of the parent row.  On Microsoft's .NET framework 1.1, the parent
+row is returned.
+
+Our company's website depends on this behavior in the .NET framework.  As a
+result it doesn't work on a mono system without (lots and lots of) tweaking.
+
+
+Steps to reproduce the problem:
+Compile this program: 
+// snip
+using System;
+using System.Data;
+
+class TestGetParentRow {
+    const int id = 0;
+    public static int Main(string[] args) 
+    {
+        // Setup stuff
+        DataSet ds = new DataSet();
+        DataTable parent = ds.Tables.Add(&quot;parent&quot;);
+        parent.Columns.Add(&quot;id&quot;, typeof(int));
+        DataTable child = ds.Tables.Add(&quot;child&quot;);
+        child.Columns.Add(&quot;idref&quot;, typeof(int));
+        Constraint uniqueId = null;
+        parent.Constraints.Add(uniqueId = new UniqueConstraint(&quot;uniqueId&quot;,
+                                                    new DataColumn[] {
+                                                        parent.Columns[&quot;id&quot;]
+                                                    },
+                                                    true));
+        ForeignKeyConstraint fkc = new
+ForeignKeyConstraint(&quot;ParentChildConstraint&quot;, 
+                                                            new
+DataColumn[] { parent.Columns[&quot;id&quot;] },
+                                                            new
+DataColumn[] { child.Columns[&quot;idref&quot;]});
+        
+        child.Constraints.Add(fkc);
+        
+        DataRelation relateParentChild = new DataRelation(&quot;relateParentChild&quot;,
+                                             new DataColumn[] {
+parent.Columns[&quot;id&quot;] },
+                                             new DataColumn[] {
+child.Columns[&quot;idref&quot;] },
+                                             false);
+        ds.Relations.Add(relateParentChild);
+        
+        // The actual test only takes 3 lines.
+        ds.EnforceConstraints = false;
+        DataRow parentRow = parent.Rows.Add(new object[] { id });
+        DataRow childRow = child.Rows.Add(new object[] { id });
+
+        if (parentRow == childRow.GetParentRow(relateParentChild)) {
+            Console.WriteLine(&quot;OK&quot;);
+            return 0;
+        } else {
+            Console.WriteLine(&quot;FAIL&quot;);
+            return 1;
+        }
+        
+    }
+}
+// done 
+Actual Results:
+prints &quot;FAIL&quot;
+
+Expected Results:
+prints &quot;OK&quot;
+
+How often does this happen? 
+Every time.
+
+Additional Information:
+To fix this, you can change a line in DataRow.cs.  Somewhere around line #
+1043, change
+
+if (indx != null) { // get the child rows from the index
+
+to
+
+if (indx != null &amp;&amp; 
+    (Table == null || Table.DataSet == null || 
+     Table.DataSet.EnforceConstraints)) { // get the child rows from the index
+
+That will force the datarow to search for the parent row manually instead
+of letting the Index do the work.  Apparantly Index will not work if
+constraints are disabled.

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="020855.html">[Mono-bugs] [Bug 66060][Min] Changed - AppDomain.AssemblyResolve event not emitted
</A></li>
	<LI> Next message: <A HREF="020854.html">[Mono-bugs] [Bug 66111][Nor] Changed - DataRow.GetParentRows() Incompatible with .NET 1.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20853">[ date ]</a>
              <a href="thread.html#20853">[ thread ]</a>
              <a href="subject.html#20853">[ subject ]</a>
              <a href="author.html#20853">[ author ]</a>
         </LI>
       </UL>
</body></html>
