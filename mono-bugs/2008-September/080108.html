<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 430583] New: BinaryFormatter: IObjectReferences are not serialized correctly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20430583%5D%20New%3A%20BinaryFormatter%3A%20IObjectReferences%0A%20are%20not%20serialized%20correctly&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="080107.html">
   <LINK REL="Next"  HREF="080109.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 430583] New: BinaryFormatter: IObjectReferences are not serialized correctly</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20430583%5D%20New%3A%20BinaryFormatter%3A%20IObjectReferences%0A%20are%20not%20serialized%20correctly&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 430583] New: BinaryFormatter: IObjectReferences are not serialized correctly">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Sep 29 06:53:24 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="080107.html">[Mono-bugs] [Bug 430577] New: DrawImage does not draw correctly when the start position is not (0, 0)
</A></li>
        <LI>Next message: <A HREF="080109.html">[Mono-bugs] [Bug 430583] BinaryFormatter: IObjectReferences are not serialized correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80108">[ date ]</a>
              <a href="thread.html#80108">[ thread ]</a>
              <a href="subject.html#80108">[ subject ]</a>
              <a href="author.html#80108">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=430583">https://bugzilla.novell.com/show_bug.cgi?id=430583</A>


           Summary: BinaryFormatter: IObjectReferences are not serialized
                    correctly
           Product: Mono: Class Libraries
           Version: SVN
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lluis at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">robertj at gmx.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


When a class is containing a field of a class which in turn is serialized using
a IObjectReference surrogate, the type of the field must be changed to reflect
the new type as it was set by the surrogate.

Run the attach test case and inspect the generated file:

The type of the field &quot;Aggregator.TheSubject&quot; is &quot;Subject&quot; instead of
&quot;SubjectHolder&quot;.


MS.NET's binary formatter is (1) always emitting the changed type but it's
still able to consume mono's output (2) because it seems to ignore the type of
the field. I've tested this by poisoning the mono-generated dump file with an
unknown type for TheSubject.


Given how mono's ObjectWriter is implemented, patching the field type a
posteriori is not an option because mono is heavily caching the metadata and
it's even emitting optimized and static IL in some cases.

Lluis, any idea how to proceed? I'd vote for (2) which means to change
ObjectReader to ignore the type of the field, like MS.NET does.

I believe (1) would require to rewrite large parts of ObjectWriter.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>













































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="080107.html">[Mono-bugs] [Bug 430577] New: DrawImage does not draw correctly when the start position is not (0, 0)
</A></li>
	<LI>Next message: <A HREF="080109.html">[Mono-bugs] [Bug 430583] BinaryFormatter: IObjectReferences are not serialized correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80108">[ date ]</a>
              <a href="thread.html#80108">[ thread ]</a>
              <a href="subject.html#80108">[ subject ]</a>
              <a href="author.html#80108">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
