<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 323528] OracleDataAdapter.Fill fails for	StoreProcedures
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20323528%5D%20OracleDataAdapter.Fill%20fails%20for%0A%09StoreProcedures&In-Reply-To=bug-323528-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="079350.html">
   <LINK REL="Next"  HREF="079142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 323528] OracleDataAdapter.Fill fails for	StoreProcedures</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20323528%5D%20OracleDataAdapter.Fill%20fails%20for%0A%09StoreProcedures&In-Reply-To=bug-323528-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 323528] OracleDataAdapter.Fill fails for	StoreProcedures">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Sep  9 15:23:27 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="079350.html">[Mono-bugs] [Bug 424917] DataGrid shouldn't show new row when DataView.AllowNew = false
</A></li>
        <LI>Next message: <A HREF="079142.html">[Mono-bugs] [Bug 373603] Adding TreeNode-Objekte with Methode Add() to an empty TreeNodeCollection returns wrong index
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79141">[ date ]</a>
              <a href="thread.html#79141">[ thread ]</a>
              <a href="subject.html#79141">[ subject ]</a>
              <a href="author.html#79141">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=323528">https://bugzilla.novell.com/show_bug.cgi?id=323528</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">webservices at landmarkdigital.com</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=323528#c1">https://bugzilla.novell.com/show_bug.cgi?id=323528#c1</A>


WebServices Group &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">webservices at landmarkdigital.com</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
                 CC|                                                |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">webservices at landmarkdigital.com</A>
           Severity|Enhancement                                     |Critical




--- Comment #1 from WebServices Group &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">webservices at landmarkdigital.com</A>&gt;  2008-09-09 13:23:27 MDT ---
Update - still fails in 2.0, throws exception

When an OracleDataAdapter is employed to fill the contents of a DataTable from
the return value of an OUT cursor, the Fill() method crashes in a subsidiary
reference to the database connection (See first inline code example).  We work
around this by not using the OracleDataAdapter, and instead directly loading
the DataTable from the OracleDataReader created from the OUT cursor parameter.

-----------------------------------------------------------
With the following pl/sql stored procedure:
-----------------------------------------------------------

  ----------------------------------------------------------------------
  -- ListAuditSamples
  --   Returns a list of the exact timestamps of all the audit samples
  --   archived for the speciied station between the specified dates
  ----------------------------------------------------------------------
  PROCEDURE  ListAuditSamples
    (
      stationID        IN AUDIO_SAMPLE.BRDCST_STN_HIST_ID%type,
      dateRangeStart   IN AUDIO_SAMPLE.AUDIO_SAMPLE_TS%type,
      dateRangeEnd     IN AUDIO_SAMPLE.AUDIO_SAMPLE_TS%type,
      resultCursor    OUT SYS_REFCURSOR
    )
  AS
  BEGIN

      OPEN resultCursor FOR
    SELECT AUDIO_SAMPLE_TS, AUDIO_SAMPLE_ID
      FROM AUDIO_SAMPLE
     WHERE AUDIO_SAMPLE.BRDCST_STN_HIST_ID = stationID
       AND AUDIO_SAMPLE.AUDIO_SAMPLE_TS &gt;= dateRangeStart
       AND AUDIO_SAMPLE.AUDIO_SAMPLE_TS &lt;= dateRangeEnd
    ORDER BY AUDIO_SAMPLE.AUDIO_SAMPLE_TS;

  END; -- PROCEDURE  ListAuditSamples

-----------------------------------------------------------
using the following code:
-----------------------------------------------------------

System.Data.OracleClient.OracleCommand cmd = new OracleCommand(PKG_NAME +
&quot;.ListAuditSamples&quot;, this.connection);
cmd.CommandType = CommandType.StoredProcedure;
cmd.Parameters.Add( CreateNumberParam(&quot;stationID&quot;, stationID) );

cmd.Parameters.Add( CreateDateParam(&quot;dateRangeStart&quot;, dateRangeStart) );

cmd.Parameters.Add( CreateDateParam(&quot;dateRangeEnd&quot;, dateRangeEnd) );

cmd.Parameters.Add( CreateCursorParam(&quot;resultCursor&quot;) );

System.Data.OracleClient.OracleDataAdapter oda = new OracleDataAdapter(cmd);
System.Data.DataSet dataSet = new DataSet();
oda.Fill(dataSet);


-----------------------------------------------------------
yields the following error:
-----------------------------------------------------------


System.ArgumentNullException: null key
Parameter name: key
  at System.Collections.Hashtable.get_Item (System.Object key) [0x00000]
  at System.Data.OracleClient.OracleConnectionPoolManager.GetConnectionPool
(OracleConnectionInfo info, Int32 minPoolSize, Int32 maxPoolSize) [0x00000]
  at System.Data.OracleClient.OracleConnection.Open () [0x00000]
  at System.Data.Common.DbDataAdapter.Fill (System.Data.DataSet dataSet, Int32
startRecord, Int32 maxRecords, System.String srcTable, IDbCommand command,
CommandBehavior behavior) [0x00000]
  at System.Data.Common.DbDataAdapter.Fill (System.Data.DataSet dataSet)
[0x00000]
  at Landmark.Services.MetaData.MetaDataDAL.ListAuditSamples (Decimal
stationID, DateTime dateRangeStart, DateTime dateRangeEnd) [0x00000]
  at Landmark.Services.MetaData.MetaDataWrangler.ListAuditSamples (Decimal
stationID, DateTime dateRangeStart, DateTime dateRangeEnd) [0x00000]
  at Landmark.WebServices.MetaData.MetaDataService.ListAuditSamplesByDateRange
(Decimal stationID, DateTime dateRangeStart, DateTime dateRangeEnd) [0x00000]


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>
















































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="079350.html">[Mono-bugs] [Bug 424917] DataGrid shouldn't show new row when DataView.AllowNew = false
</A></li>
	<LI>Next message: <A HREF="079142.html">[Mono-bugs] [Bug 373603] Adding TreeNode-Objekte with Methode Add() to an empty TreeNodeCollection returns wrong index
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79141">[ date ]</a>
              <a href="thread.html#79141">[ thread ]</a>
              <a href="subject.html#79141">[ subject ]</a>
              <a href="author.html#79141">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
