<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 422491] New: Remoting: Passing ObjRef from Windows to Mono throws &quot; Object type System.Int64 cannot be converted to target type: System.Int32&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20422491%5D%20New%3A%20Remoting%3A%20Passing%20ObjRef%20from%20Windows%0A%20to%20Mono%20throws%20%22%20Object%20type%20System.Int64%20cannot%20be%20converted%20to%20target%0A%20type%3A%20System.Int32%22&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="078729.html">
   <LINK REL="Next"  HREF="078789.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 422491] New: Remoting: Passing ObjRef from Windows to Mono throws &quot; Object type System.Int64 cannot be converted to target type: System.Int32&quot;</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20422491%5D%20New%3A%20Remoting%3A%20Passing%20ObjRef%20from%20Windows%0A%20to%20Mono%20throws%20%22%20Object%20type%20System.Int64%20cannot%20be%20converted%20to%20target%0A%20type%3A%20System.Int32%22&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 422491] New: Remoting: Passing ObjRef from Windows to Mono throws &quot; Object type System.Int64 cannot be converted to target type: System.Int32&quot;">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Sep  3 06:50:58 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="078729.html">[Mono-bugs] [Bug 420312] ToolStripCollectionEditor implementation
</A></li>
        <LI>Next message: <A HREF="078789.html">[Mono-bugs] [Bug 422491] Remoting: Passing ObjRef from Windows to Mono throws &quot; Object type System.Int64 cannot be converted to target type: System.Int32&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#78730">[ date ]</a>
              <a href="thread.html#78730">[ thread ]</a>
              <a href="subject.html#78730">[ subject ]</a>
              <a href="author.html#78730">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=422491">https://bugzilla.novell.com/show_bug.cgi?id=422491</A>


           Summary: Remoting:  Passing ObjRef from Windows to Mono throws
                    &quot;Object type System.Int64 cannot be converted to target
                    type: System.Int32&quot;
           Product: Mono: Runtime
           Version: SVN
          Platform: 64bit
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: remoting
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lluis at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">steffen.enni at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=237057)
 --&gt; (<A HREF="https://bugzilla.novell.com/attachment.cgi?id=237057">https://bugzilla.novell.com/attachment.cgi?id=237057</A>)
Example reproducing the behavior.

I have a server and a client, both implementing the below IHello interface. 
When the client calls HelloWithCallback() the server performs a callback on
remoteRef.Hello() to the client.

Client                             Server
 --------HelloWithCallback()--------&gt;
 &lt;--------------Hello()--------------
 ---(return from Hello)-------------&gt;
 &lt;--(return from HelloWithCallback)--


    public interface IHello
    {
        void HelloWithCallback(string sender, IHello remoteRef);
        void Hello(string sender);
    }



When both Client and Server runs on Mono (or both on Windows) this works.
Likewise the Client on mono and server on windows it also works.

But when the Server is on Mono and the Client is on windows the invocation of
HelloWithCallback() fails with the below exception:

I suspect this is similar to case 381555.

I've attached a case reproducing the behavior. It can be compiled on Mono using
MonoDevelop and on Windows using Visual Studio 2008.


Unhandled Exception: System.ArgumentException: Object type System.Int64 cannot
be converted to target type: System.Int32
Parameter name: val

Server stack trace:
  at System.Reflection.MonoField.SetValue (System.Object obj, System.Object
val, BindingFlags invokeAttr, System.Reflection.Binder binder, Syste
m.Globalization.CultureInfo culture) [0x00000]
  at System.Reflection.FieldInfo.SetValue (System.Object obj, System.Object
value) [0x00000]
  at System.Runtime.Serialization.FormatterServices.PopulateObjectMembers
(System.Object obj, System.Reflection.MemberInfo[] members, System.Obj
ect[] data) [0x00000]
  at
System.Runtime.Serialization.Formatters.Soap.SoapReader.DeserializeSimpleObject
(System.Object obj, Int64 id, System.Boolean&amp; hasFixup) [0x
00000]
  at System.Runtime.Serialization.Formatters.Soap.SoapReader.DeserializeObject
(System.Type type, Int64 id, Int64 parentId, System.Reflection.Me
mberInfo parentMemberInfo, System.Int32[] indices) [0x00000]
  at System.Runtime.Serialization.Formatters.Soap.SoapReader.Deserialize ()
[0x00000]
  at System.Runtime.Serialization.Formatters.Soap.SoapReader.Deserialize
(System.IO.Stream inStream, ISoapMessage soapMessage) [0x00000]
  at System.Runtime.Serialization.Formatters.Soap.SoapFormatter.Deserialize
(System.IO.Stream serializationStream, System.Runtime.Remoting.Messa
ging.HeaderHandler handler) [0x00000]
  at System.Runtime.Serialization.Formatters.Soap.SoapFormatter.Deserialize
(System.IO.Stream serializationStream) [0x00000]
  at System.Runtime.Remoting.Channels.SoapServerFormatterSink.ProcessMessage
(IServerChannelSinkStack sinkStack, IMessage requestMsg, ITransport
Headers requestHeaders, System.IO.Stream requestStream, IMessage&amp; responseMsg,
ITransportHeaders&amp; responseHeaders, System.IO.Stream&amp; responseStr
eam) [0x00000]

Exception rethrown at [0]:
   at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage
reqMsg, IMessage retMsg)
   at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp;
msgData, Int32 type)
   at Interface.IHello.HelloWithCallback(String sender, IHello remoteRef)
   at Client.Program.Main(String[] args) in
D:\Projects\Constellation\mono\PassingObjRef\Client\Program.cs:line 46


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="078729.html">[Mono-bugs] [Bug 420312] ToolStripCollectionEditor implementation
</A></li>
	<LI>Next message: <A HREF="078789.html">[Mono-bugs] [Bug 422491] Remoting: Passing ObjRef from Windows to Mono throws &quot; Object type System.Int64 cannot be converted to target type: System.Int32&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#78730">[ date ]</a>
              <a href="thread.html#78730">[ thread ]</a>
              <a href="subject.html#78730">[ subject ]</a>
              <a href="author.html#78730">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
