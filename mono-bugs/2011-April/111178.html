<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 688353] New: HttpListener returns HTTP 400 when wildcard is used for host name and path exists
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20688353%5D%20New%3A%20HttpListener%20returns%20HTTP%20400%20when%0A%20wildcard%20is%20used%20for%20host%20name%20and%20path%20exists&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="111175.html">
   <LINK REL="Next"  HREF="111179.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 688353] New: HttpListener returns HTTP 400 when wildcard is used for host name and path exists</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20688353%5D%20New%3A%20HttpListener%20returns%20HTTP%20400%20when%0A%20wildcard%20is%20used%20for%20host%20name%20and%20path%20exists&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 688353] New: HttpListener returns HTTP 400 when wildcard is used for host name and path exists">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Apr 19 02:32:54 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="111175.html">[Mono-bugs] [Bug 632600] Mono 2.6.1 , ASP.NET Version: 2.0.50727.1433 - Server error CS0006: cannot find metadata file '/tmp/apache-temp....'
</A></li>
        <LI>Next message: <A HREF="111179.html">[Mono-bugs] [Bug 688353] HttpListener returns HTTP 400 when wildcard is used for host name and path exists
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111178">[ date ]</a>
              <a href="thread.html#111178">[ thread ]</a>
              <a href="subject.html#111178">[ subject ]</a>
              <a href="author.html#111178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=688353">https://bugzilla.novell.com/show_bug.cgi?id=688353</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=688353#c0">https://bugzilla.novell.com/show_bug.cgi?id=688353#c0</A>


           Summary: HttpListener returns HTTP 400 when wildcard is used
                    for host name and path exists
    Classification: Mono
           Product: Mono: Class Libraries
           Version: unspecified
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">aenomoto at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
            Blocks: 687580
          Found By: ---
           Blocker: ---


The following HttpListener use case demonstrates that an HttpListener that is
given as a prefix that is a wildcard host name, suffixed with a subpath
(<A HREF="http://*:8080/foo">http://*:8080/foo</A>). HTTP request to the server results in 400 (Bad Request).

Wildcard prefix with path does not result in failure, but this example is
reproducible.

---- server ----
using System;
using System.IO;
using System.Net;
using System.Threading;
using System.Xml;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Description;

public class Test
{
    public static void Main ()
    {
        for (int i = 0; i &lt; 2; i++) {
            var l = new HttpListener ();
            l.Prefixes.Add (&quot;<A HREF="http://*:8080/&quot;">http://*:8080/&quot;</A> + (i == 0 ? &quot;foo/&quot; : &quot;bar/&quot;));
            l.Start ();
            var ctx = l.GetContext ();
            using (var sr = new StreamReader (ctx.Request.InputStream))
                Console.WriteLine (sr.ReadToEnd ());
            ctx.Response.Headers [&quot;SOAPAction&quot;] = &quot;urn:foo&quot;;
            ctx.Response.KeepAlive = false;
            ctx.Response.ContentType = &quot;text/xml; charset=utf-8&quot;;
            ctx.Response.ContentLength64 = 86;
            using (var tw = new StreamWriter (ctx.Response.OutputStream))
                tw.Write (&quot;&lt;s:Envelope
xmlns:s='<A HREF="http://schemas.xmlsoap.org/soap/envelope/'">http://schemas.xmlsoap.org/soap/envelope/'</A>&gt;&lt;s:Body/&gt;&lt;/s:Envelope&gt;&quot;);
            ctx.Response.Close ();
            l.Close ();
            Thread.Sleep (1000); // This sleep is required (even on .NET) to
give some delay for something.
        }
    }
}

---- client ----
using System;
using System.IO;
using System.Net;
using System.ServiceModel;
using System.ServiceModel.Channels;

public class Test
{
    public static void Main ()
    {
        for (int i = 0; i &lt; 2; i++) {
            var hr = (HttpWebRequest) WebRequest.Create (new Uri
(&quot;<A HREF="http://localhost:8080/&quot;">http://localhost:8080/&quot;</A> + (i == 0 ? &quot;foo&quot; : &quot;bar&quot;)));
            hr.Method = &quot;POST&quot;;
            hr.KeepAlive = false;
            hr.ContentType = &quot;text/xml; charset=utf-8&quot;;
            hr.Headers [&quot;SOAPAction&quot;] = &quot;\&quot;urn:foo\&quot;&quot;;
            var rs = new StreamWriter (hr.GetRequestStream ());
            rs.WriteLine (@&quot;&lt;s:Envelope
xmlns:s='<A HREF="http://schemas.xmlsoap.org/soap/envelope/'">http://schemas.xmlsoap.org/soap/envelope/'</A>&gt;
  &lt;s:Header&gt;
  &lt;/s:Header&gt;
  &lt;s:Body /&gt;
&lt;/s:Envelope&gt;&quot;);
            rs.Close ();
            var rr = new StreamReader (hr.GetResponse ().GetResponseStream ());
            Console.WriteLine (rr.ReadToEnd ());
            rr.Close ();
        }
    }
}

On .NET, two requests and replies are processed as expected. On Mono, first
request fails.

Some notes:
- I (again) tried it on Windows, so it may work fine on other platforms.
- The repro kind of replicates WCF BasicHttpBinding; there's couple of
extraneous code I know.
- Actually the loop (i&lt;2) doesn't matter. It fails at the first request.
- I set a blocker for bug #687580. That bug could be fixed by switching #if
false to #if true in System.ServiceModel.Channels.Http/HttpListenerManager.cs
line 113.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="111175.html">[Mono-bugs] [Bug 632600] Mono 2.6.1 , ASP.NET Version: 2.0.50727.1433 - Server error CS0006: cannot find metadata file '/tmp/apache-temp....'
</A></li>
	<LI>Next message: <A HREF="111179.html">[Mono-bugs] [Bug 688353] HttpListener returns HTTP 400 when wildcard is used for host name and path exists
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111178">[ date ]</a>
              <a href="thread.html#111178">[ thread ]</a>
              <a href="subject.html#111178">[ subject ]</a>
              <a href="author.html#111178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
