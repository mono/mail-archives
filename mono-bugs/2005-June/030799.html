<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 74917][Maj] Changed - OdbcParameters not working
	in Mono 1.1.7
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2074917%5D%5BMaj%5D%20Changed%20-%20OdbcParameters%20not%20working%0A%09in%20Mono%201.1.7&In-Reply-To=bug-74917%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030798.html">
   <LINK REL="Next"  HREF="030800.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 74917][Maj] Changed - OdbcParameters not working
	in Mono 1.1.7</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2074917%5D%5BMaj%5D%20Changed%20-%20OdbcParameters%20not%20working%0A%09in%20Mono%201.1.7&In-Reply-To=bug-74917%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 74917][Maj] Changed - OdbcParameters not working
	in Mono 1.1.7">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Wed Jun 22 09:59:14 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="030798.html">[Mono-bugs] [Bug 75351][Maj] New - UDP Socket does not receive
	broadcast UDP packets
</A></li>
        <LI>Next message: <A HREF="030800.html">[Mono-bugs] [Bug 75323][Nor] Changed - Failure in MS.NET compiled
	assembly when trying to load a type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30799">[ date ]</a>
              <a href="thread.html#30799">[ thread ]</a>
              <a href="subject.html#30799">[ subject ]</a>
              <a href="author.html#30799">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">dfreund at runlevel-5.org.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=74917">http://bugzilla.ximian.com/show_bug.cgi?id=74917</A>

--- shadow/74917	2005-06-20 09:40:05.000000000 -0400
+++ shadow/74917.tmp.17304	2005-06-22 09:59:14.000000000 -0400
@@ -307,6 +307,115 @@
 I can do some more tests or try to fix it myself?
 Are queries with parameters using ODBC supposed to work at all?
 
 Any help would be appreciated,
 
 /daniel
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">dfreund at runlevel-5.org</A>  2005-06-22 09:59 -------
+Did some more tests (Mono 1.1.8/SLES9) and added an integer-column to
+my table, which now looks like this (Firebird isql output):
+SQL&gt; show table t_odbc_test;
+ID                              SMALLINT Not Null
+LAST_NAME                       VARCHAR(20) Nullable
+FIRST_NAME                      CHAR(20) Nullable
+TESTINT                         INTEGER Nullable
+CONSTRAINT PK_T_ODBC_TEST:
+  Primary key (ID)
+SQL&gt; select * from t_odbc_test;
+
+     ID LAST_NAME            FIRST_NAME                TESTINT
+======= ==================== ==================== ============
+
+      1 Dent                 Arthur                         10
+      2 Prefect              Ford                           20
+
+My test programm looks like:
+
+class MainClass
+{
+   public static void Main(string[] args)
+   {
+      string dsn = args[0]; // the ODBC DSN
+      string typ = args[1]; // varchar|char|int
+
+      string DB_CONN = &quot;DSN=&quot; + dsn;
+
+      Console.WriteLine(&quot;act. DSN:      &quot; + DB_CONN);
+      Console.WriteLine(&quot;act. OdbcType: &quot; + typ);
+
+      using (OdbcConnection conn = new OdbcConnection(DB_CONN)) {
+         conn.Open();
+         OdbcCommand cmdFail = conn.CreateCommand();
+         cmdFail.CommandType = CommandType.Text;
+
+         switch (typ) {
+            case &quot;varchar&quot;: // last_name is of type VarChar
+               cmdFail.CommandText =
+                  &quot;SELECT * FROM t_odbc_test WHERE last_name=?&quot;;
+                  cmdFail.Parameters.Add(&quot;@p1&quot;,
+OdbcType.VarChar,20).Value = &quot;Perfect&quot;;
+               break;
+            case &quot;char&quot;: // first_name is of type Char
+               cmdFail.CommandText =
+                  &quot;SELECT * FROM t_odbc_test WHERE first_name like (?)&quot;;
+                  cmdFail.Parameters.Add(&quot;@p1&quot;,
+OdbcType.Char,20).Value = &quot;Ford%&quot;;
+               break;
+            case &quot;int&quot;: // testint is of type Integer
+            default:
+               cmdFail.CommandText =
+                  &quot;SELECT * FROM t_odbc_test WHERE testint=?&quot;;
+               cmdFail.Parameters.Add(&quot;@p1&quot;, OdbcType.Int).Value = 20;
+
+               break;
+         }
+
+         OdbcDataReader readerFail = cmdFail.ExecuteReader();
+
+         while (readerFail.Read())
+            Console.WriteLine(&quot;--&gt; &quot; + readerFail[&quot;LAST_NAME&quot;]);
+
+         readerFail.Close();
+         Console.WriteLine(&quot;------------------------------------------&quot;);
+      }
+   }
+}
+
+Results:
+When using OdbcType.Int, I get the expected result (GREAT!)
+When using OdbcType.Char, I get an empty result (NOT VERY GOOD)
+When using OdbcType.VarChar, I get an exception (BAD!)
+
+The type of the exception varies between Firebird and Informix.
+Firebird complains the following way:
+
+Unhandled Exception: System.Data.Odbc.OdbcException: [unixODBC]Driver
+not capable
+in &lt;0x001ba&gt; System.Data.Odbc.OdbcParameter:Bind (IntPtr hstmt, Int32
+ParamNum)
+in (wrapper remoting-invoke-with-check)
+System.Data.Odbc.OdbcParameter:Bind (intptr,int)
+[SNIP]
+
+In the sources of OdbcParameter.Bind() there is distinguished between
+int parameters and &quot;the rest&quot;:
+
+// Bind parameter based on type
+int ind = -3;
+if (odbcType == OdbcType.Int)
+   ret = libodbc.SQLBindParameter(hstmt, (ushort)ParamNum,
+(short)paramdir,
+                                  ctype, sqltype, Convert.ToUInt32(Size),
+                                  0, ref intbuf, 0, ref ind);
+else
+   ret = libodbc.SQLBindParameter(hstmt, (ushort)ParamNum,
+(short)paramdir,
+                                  ctype, sqltype, Convert.ToUInt32(Size),
+                                  0, buffer, buffer.Length, ref ind);
+
+So I suppose the error is in the way SQLBindparameter is called for
+non int parameters
+
+hope it helps (as long as somebody works on it anyway)
+
+/d
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030798.html">[Mono-bugs] [Bug 75351][Maj] New - UDP Socket does not receive
	broadcast UDP packets
</A></li>
	<LI>Next message: <A HREF="030800.html">[Mono-bugs] [Bug 75323][Nor] Changed - Failure in MS.NET compiled
	assembly when trying to load a type
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30799">[ date ]</a>
              <a href="thread.html#30799">[ thread ]</a>
              <a href="subject.html#30799">[ subject ]</a>
              <a href="author.html#30799">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
