<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 421491] &quot;Could not allocate new OCI Handle of type Statement&quot; message when accessing Oracle
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20421491%5D%20%22Could%20not%20allocate%20new%20OCI%20Handle%20of%20type%0A%20Statement%22%20message%20when%20accessing%20Oracle&In-Reply-To=bug-421491-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="112880.html">
   <LINK REL="Next"  HREF="112882.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 421491] &quot;Could not allocate new OCI Handle of type Statement&quot; message when accessing Oracle</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20421491%5D%20%22Could%20not%20allocate%20new%20OCI%20Handle%20of%20type%0A%20Statement%22%20message%20when%20accessing%20Oracle&In-Reply-To=bug-421491-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 421491] &quot;Could not allocate new OCI Handle of type Statement&quot; message when accessing Oracle">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Aug  8 11:02:19 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="112880.html">[Mono-bugs] [Bug 686788] MKMapView with a MKAnnotation crashes when pin is dragged then dropped (MonoTouch 4)
</A></li>
        <LI>Next message: <A HREF="112882.html">[Mono-bugs] [Bug 690944] TPL cannot use main UI thread TaskScheduler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#112881">[ date ]</a>
              <a href="thread.html#112881">[ thread ]</a>
              <a href="subject.html#112881">[ subject ]</a>
              <a href="author.html#112881">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=421491">https://bugzilla.novell.com/show_bug.cgi?id=421491</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=421491#c10">https://bugzilla.novell.com/show_bug.cgi?id=421491#c10</A>


--- Comment #10 from Dan McFadyen &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">danm at cryptocard.com</A>&gt; 2011-08-08 15:02:16 UTC ---
Thanks for the information Jean-Philippe. I have just been informed that the
amount of time I have to keeping looking into this now has a hard deadline so I
might be making use of it. But in the mean time I hope to help as much as I
can.

I have reduced the test case to something that reproduces it for me with no
proprietary code. I have been in contact with Chris Brown from the posts above
and sadly the same test does not reproduce it on his system. There is hope
though. My environment is the currently available Mono openSUSE VM.

Note: The code that I use to reproduce this bug explicitly leaks connections.
Yes, I am aware that this shouldn't be done, but this isn't the only way to
reproduce the bug as from my conversations with Chris we have confirmed a case
where it happens without leaking connections, and I can leak connections
without hitting the problem. In this case it's just the first easy way I found
to reproduce the bug.

Details:
 - OS: openSUSE VM with mono 2.10.2
 - Mono exact: 2.10.2 (Mon Apr 18 15:10:34 UTC 2011) x86
 - Oracle Instant Client: 11.2-basiclite

For reference, testing against Oracle 11G 11.1.7.0 on another server.


-----------Contents of aspx file start----------------

&lt;%@ Import namespace=&quot;System.Data.OracleClient&quot; %&gt;
&lt;%
try
{               
     OracleConnection conn = new OracleConnection(&quot;Data Source=O11G;User
ID=;Password= &quot;);
     conn.Open();
     {
           using (OracleCommand cmd = conn.CreateCommand())
           {
                cmd.CommandText = &quot;SELECT 1 FROM dual&quot;;
                cmd.ExecuteScalar();
                cmd.CommandText = &quot;SELECT 2 FROM dual&quot;;
                cmd.ExecuteScalar();
           }
     }
     //conn.Close();
}
catch (Exception ex)
{
     %&gt;&lt;%=ex.Message + Environment.NewLine + ex.StackTrace%&gt;&lt;%
}
%&gt;

-------------Contents End-------------------

And in the Web.config under
 &lt;System.Web&gt;&lt;compilation&gt;&lt;assemblies&gt;
Add
&lt;add assembly=&quot;System.Data.OracleClient, Version=2.0.0.0&quot;/&gt;

It will take 5 refreshes to that page to get the error reproduced, but it's
been a consistent 5 times for me.

After talking with Chris Brown a few more times he pointed me to the trace
messages in System.Data.OracleClient.Oci.OciCalls.cs. I took advantage of this
and modified the OCIHandleAlloc call so that it printed out information about
all the parameters provided. The error is caused because the IntPtr parenth is
null.

If more information is required or the test case I have provided doesn't work
on a system you have available, I can remove all of our code from the VM and
package it up so that you can have the exact environment I was using to
reproduce it.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="112880.html">[Mono-bugs] [Bug 686788] MKMapView with a MKAnnotation crashes when pin is dragged then dropped (MonoTouch 4)
</A></li>
	<LI>Next message: <A HREF="112882.html">[Mono-bugs] [Bug 690944] TPL cannot use main UI thread TaskScheduler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#112881">[ date ]</a>
              <a href="thread.html#112881">[ thread ]</a>
              <a href="subject.html#112881">[ subject ]</a>
              <a href="author.html#112881">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
