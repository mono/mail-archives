<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 653928] From thread-pool thread, QueueUserWorkItem schedules onto the same thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20653928%5D%20From%20thread-pool%20thread%2C%0A%20QueueUserWorkItem%20schedules%20onto%20the%20same%20thread&In-Reply-To=bug-653928-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="106254.html">
   <LINK REL="Next"  HREF="106291.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 653928] From thread-pool thread, QueueUserWorkItem schedules onto the same thread</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20653928%5D%20From%20thread-pool%20thread%2C%0A%20QueueUserWorkItem%20schedules%20onto%20the%20same%20thread&In-Reply-To=bug-653928-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 653928] From thread-pool thread, QueueUserWorkItem schedules onto the same thread">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Nov 16 22:11:30 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="106254.html">[Mono-bugs] [Bug 653928] From thread-pool thread, QueueUserWorkItem schedules onto the same thread
</A></li>
        <LI>Next message: <A HREF="106291.html">[Mono-bugs] [Bug 653928] From thread-pool thread, QueueUserWorkItem schedules onto the same thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106286">[ date ]</a>
              <a href="thread.html#106286">[ thread ]</a>
              <a href="subject.html#106286">[ subject ]</a>
              <a href="author.html#106286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=653928">https://bugzilla.novell.com/show_bug.cgi?id=653928</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=653928#c4">https://bugzilla.novell.com/show_bug.cgi?id=653928#c4</A>


Gonzalo Paniagua Javier &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gonzalo at novell.com</A>&gt; changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                 CC|                            |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gonzalo at novell.com</A>
         AssignedTo|<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>  |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gonzalo at novell.com</A>

--- Comment #4 from Gonzalo Paniagua Javier &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gonzalo at novell.com</A>&gt; 2010-11-17 03:11:29 UTC ---
Our threadpool in 2.8 and above behaves more like the .NET 4.0 threadpool. Each
thread has a local queue (work-stealing queue) from which other threadpool
threads might steal work items when they are idle.

This also means that the order of execution is not (quasi-)guaranteed as it was
before and that it is possible that everything you queue from a threadpool
thread is executed from the same thread (only under special circumstances: the
work items don't take too long, other threadpool threads are busy).

Now, given that you see this problem with Mono on windows, I'd like to test
that and see if it's a windows-only problem. How many CPU cores does your
machine have?





In my machine with Mono on linux, in the first try:
 [TID: 1]
--------------------
* SimpleTestOuterQuwiInnerQuwi
114342410: Calling QueueUserWorkItem(outer)
114342419: Outer: calling QueueUserWorkItem(inner)  [TID: 2]
114342419: Outer: pausing...
114342519:     Inner: Was I called only **after** Outer exited??????  [TID: 3]
114344419: Outer: exiting...
--------------------
* SimpleTest
114346420: Calling outer.BeginInvoke
114346421: Outer: calling inner.BeginInvoke  [TID: 3]
114346421: Outer: pausing...
114346421:     Inner: Was I called only **after** Outer exited??????  [TID: 2]
114348421: Outer: exiting...
--------------------
* SimpleTestOuterQuwi
114350422: Calling QueueUserWorkItem(outer)
114350422: Outer: calling inner.BeginInvoke  [TID: 3]
114350422: Outer: pausing...
114350422:     Inner: Was I called only **after** Outer exited??????  [TID: 2]
114352422: Outer: exiting...

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="106254.html">[Mono-bugs] [Bug 653928] From thread-pool thread, QueueUserWorkItem schedules onto the same thread
</A></li>
	<LI>Next message: <A HREF="106291.html">[Mono-bugs] [Bug 653928] From thread-pool thread, QueueUserWorkItem schedules onto the same thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106286">[ date ]</a>
              <a href="thread.html#106286">[ thread ]</a>
              <a href="subject.html#106286">[ subject ]</a>
              <a href="author.html#106286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
