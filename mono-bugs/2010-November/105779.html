<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 650956] New: Application crash on Webservice	request.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20650956%5D%20New%3A%20Application%20crash%20on%20Webservice%0A%09request.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="105778.html">
   <LINK REL="Next"  HREF="105780.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 650956] New: Application crash on Webservice	request.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20650956%5D%20New%3A%20Application%20crash%20on%20Webservice%0A%09request.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 650956] New: Application crash on Webservice	request.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Nov  3 08:58:53 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="105778.html">[Mono-bugs] [Bug 646771] Cannot add service reference to a WSDL with .aspx extension
</A></li>
        <LI>Next message: <A HREF="105780.html">[Mono-bugs] [Bug 650956] Application crash on Webservice request.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105779">[ date ]</a>
              <a href="thread.html#105779">[ thread ]</a>
              <a href="subject.html#105779">[ subject ]</a>
              <a href="author.html#105779">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=650956">https://bugzilla.novell.com/show_bug.cgi?id=650956</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=650956#c0">https://bugzilla.novell.com/show_bug.cgi?id=650956#c0</A>


           Summary: Application crash on Webservice request.
    Classification: Mono
           Product: MonoDroid
           Version: SVN
          Platform: PC
        OS/Version: Windows 7
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: Runtime
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mkestner at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">willemm at infosupport.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64;
Trident/5.0)

I'm trying to invoke a basic SOAP http service using a legacy .NET 2.0 web
service reference generated proxy.

I can invoke the service, but when the response comes back in the async
callback, the application crashes. The following log entries are generated
during the crash.

D/dalvikvm( 1104): GREF has increased to 201
D/dalvikvm(  119): GC_EXPLICIT freed 994 objects / 50768 bytes in 97ms
D/dalvikvm(  301): GC_EXPLICIT freed 27 objects / 1360 bytes in 85ms
V/WaarIsIe( 1104): Service URI for domain service:
<A HREF="http://10.0.2.2:1082/Services/MobileBackofficeApplication-Web-AuthenticationDomainService.svc/Soap">http://10.0.2.2:1082/Services/MobileBackofficeApplication-Web-AuthenticationDomainService.svc/Soap</A>
V/WhereIsItActivity( 1104): Invoking authentication service
W/ActivityManager(   60): Launch timeout has expired, giving up wake lock!
W/ActivityManager(   60): Activity idle timeout for HistoryRecord{43f81718
WaarIsIe.WaarIsIe/waarIsIe.WhereIsItActivity}
E/mono    ( 1104): [0x6963c0:] EXCEPTION handling:
System.Net.Sockets.SocketException: An address incompatible with the requested
protocol was used
F/Mono.Android( 1104): Unable to get JNI Environment pointer!
D/Zygote  (   33): Process 1104 exited cleanly (255)
I/ActivityManager(   60): Process WaarIsIe.WaarIsIe (pid 1104) has died.
I/WindowManager(   60): WIN DEATH: Window{43ffd5b8
WaarIsIe.WaarIsIe/waarIsIe.WhereIsItActivity paused=false}
I/UsageStats(   60): Unexpected resume of com.android.launcher while already
resumed in WaarIsIe.WaarIsIe
W/InputManagerService(   60): Got RemoteException sending setActive(false)
notification to pid 1104 uid 10033

Reproducible: Always

Steps to Reproduce:
1. Add a webservice reference
2. Use an async call to invoke the webservice
3. Invoke the End... method on the proxy inside the callback method specified
in the initial call to the webservice.
Actual Results:  
Application crash

Expected Results:  
Got a response from the webservice.

The following code is causing the issues:

/// &lt;summary&gt;
/// Loads the assets from the webserver
/// &lt;/summary&gt;
private void LoadAssets()
{
    if (!_settings.IsValid())
    {
        Log.V(typeof(WhereIsItActivity).Name, &quot;Settings are invalid. Skipping
service call&quot;);
        return;
    }

    // Get the authentication service proxy and link a new cookie container to
it.
    // This cookie container will contain the authentication cookie gotten from
the logon call.
    var authenticationService =
ServiceFactory.GetAuthenticationDomainService(this.BaseContext); //
Instantiates the service proxy with a valid URI.
    authenticationService.CookieContainer = new CookieContainer();

    try
    {
        Log.V(typeof(WhereIsItActivity).Name, &quot;Invoking authentication
service&quot;);

        // Perform the logon call
        authenticationService.BeginLogin(_settings.UserName,
_settings.Password, false, false,
            null, OnAuthenticationCompleted, authenticationService);
    }
    catch (Java.Lang.Exception ex)
    {
        //TODO:
    }
}   

private void OnAuthenticationCompleted(IAsyncResult ar)
{
    try
    {
        ServiceAgents.Authentication.AuthenticationDomainService
authenticationService = 
           
(ServiceAgents.Authentication.AuthenticationDomainService)ar.AsyncState;

        var result = authenticationService.EndLogin(ar);

        Log.V(typeof(WhereIsItActivity).Name, &quot;Got response from the
authentication service&quot;);

        // Check if the user was succesfully logged on.
        if ((result.RootResults != null &amp;&amp; result.RootResults.Length == 0) ||
result.RootResults == null)
        {
            DisplayAuthenticationError();
        }

        // Construct the domain service proxy and keep the cookie container
with
        // the authentication cookie gotten from the logon call.
        var domainService =
ServiceFactory.GetWaarIsIeDomainService(this.BaseContext);
        domainService.CookieContainer = authenticationService.CookieContainer;

        Log.V(typeof(WhereIsItActivity).Name, &quot;Invoking WaarIsI domain
service&quot;);

        domainService.BeginGetAssets(OnGetAssetsCompleted, domainService);
    }
    catch (Java.Lang.Exception ex)
    {
        //TODO:
    }
}

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="105778.html">[Mono-bugs] [Bug 646771] Cannot add service reference to a WSDL with .aspx extension
</A></li>
	<LI>Next message: <A HREF="105780.html">[Mono-bugs] [Bug 650956] Application crash on Webservice request.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105779">[ date ]</a>
              <a href="thread.html#105779">[ thread ]</a>
              <a href="subject.html#105779">[ subject ]</a>
              <a href="author.html#105779">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
