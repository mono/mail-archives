<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 654482] New: Binding and using UIViewController OC library causes XmlSerializer constructor to fail
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20654482%5D%20New%3A%20Binding%20and%20using%20UIViewController%20OC%0A%20library%20causes%20XmlSerializer%20constructor%20to%20fail&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="106387.html">
   <LINK REL="Next"  HREF="106324.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 654482] New: Binding and using UIViewController OC library causes XmlSerializer constructor to fail</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20654482%5D%20New%3A%20Binding%20and%20using%20UIViewController%20OC%0A%20library%20causes%20XmlSerializer%20constructor%20to%20fail&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 654482] New: Binding and using UIViewController OC library causes XmlSerializer constructor to fail">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Nov 17 17:57:41 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="106387.html">[Mono-bugs] [Bug 654476] HttpRuntime::Validate incorrectly thinks ', ' is an invalid char
</A></li>
        <LI>Next message: <A HREF="106324.html">[Mono-bugs] [Bug 654482] Binding and using UIViewController OC library causes XmlSerializer constructor to fail
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106322">[ date ]</a>
              <a href="thread.html#106322">[ thread ]</a>
              <a href="subject.html#106322">[ subject ]</a>
              <a href="author.html#106322">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=654482">https://bugzilla.novell.com/show_bug.cgi?id=654482</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=654482#c0">https://bugzilla.novell.com/show_bug.cgi?id=654482#c0</A>


           Summary: Binding and using UIViewController OC library causes
                    XmlSerializer constructor to fail
    Classification: Mono
           Product: MonoTouch
           Version: unspecified
          Platform: Macintosh
        OS/Version: Mac OS X 10.6
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: Runtime
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gnorton at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">rcollins at boardbooks.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=400944)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=400944">http://bugzilla.novell.com/attachment.cgi?id=400944</A>)
Test Projects to demonstrate problem.

User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US)
AppleWebKit/534.7 (KHTML, like Gecko) Chrome/7.0.517.44 Safari/534.7

It appears that the AOT is somehow processing my UIViewController Objective-C
class, imported into my MonoTouch project using the btouch tool. If, and only
if, I use my imported class, then the XmlSerializer constructor fails.
Presumably it is iterating through the classes which were identified as part of
a AOT compiler process, and does not like my bound class. As if you comment out
the lines where my bound class is created/used, the error goes away. See Steps
to Reproduce for details.

Reproducible: Always

Steps to Reproduce:
Target platform: iPad. My test projects (attached) to illustrate my problem
consist of the following:

1. An XCode/Objective-C iOS library project consisting of a TestViewController
class, declared as:

@interface TestViewController : UIViewController {}

with loadview and viewDidLoad implementations of:

- (void)loadView {
      UIView* view = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 768,
1024)];
      view.backgroundColor = [UIColor blueColor];
      self.view = view;
      [view release]; }

- (void)viewDidLoad {
      [super viewDidLoad];
      UILabel* label = [[UILabel alloc] initWithFrame:CGRectMake(200, 188, 150,
21)];
      label.text = @&quot;Objective-C View&quot;;
      [self.view addSubview:label];  }

TestViewController just creates and displays a blue UIView and displays the
text &quot;Objective-C View&quot;.

2. A MonoTouch iPad Window-based project with the following:

a) A TestLib.cs file with the following contents:

using MonoTouch.Foundation; using MonoTouch.UIKit; using System;

namespace InteropTest {
            [BaseType (typeof (UIViewController))]
            interface TestViewController {}
}

This TestLib.cs file is not compiled by the project, but is fed into the btouch
tool, which produces a TestLib.dll as output, which is then added as a
reference to the project.

b) The output of the XCode project (libTestLib.a) is copied to the MonoTouch
project and is linked in with the following command in the MonoTouch project
options, iPhone Build, Extra Arguments:

-v -gcc_flags &quot;-L${ProjectDir} -lTestLib -framework CoreGraphics -ObjC&quot;

c) The contents of the main.cs file is as follows:

namespace InteropTest
{
    public class Application
    {
        static void Main (string[] args)
        {
            UIApplication.Main (args);
        }
    }

    public class MyTest
    {                       
       public int a { get; set; }
    }

    // The name AppDelegate is referenced in the MainWindow.xib file.
    public partial class AppDelegate : UIApplicationDelegate
    {
        // This method is invoked when the application has loaded its UI and
its ready to run
        public override bool FinishedLaunching (UIApplication app, NSDictionary
options)
        {                                   
              // Test 3: Comment out these 2 lines - XmlSerializer ctr should
now succeed.
              InteropTest.TestViewController controller = new
InteropTest.TestViewController();
              window.AddSubview (controller.View);

              // If you have defined a view, add it here:
              window.MakeKeyAndVisible ();

              // Test 2: Uncomment this line - exception thrown from this call.
              //System.Xml.Serialization.XmlSerializer xmlSerializer = new
System.Xml.Serialization.XmlSerializer (typeof(MyTest));


              return true;
         }
     }
}

3. The testing. Build the XCode project. Copy the libTestLib.a output into the
MonoTouch project folder, then build and run the MonoTouch project.

a) Test 1: You should see a blue screen with the &quot;Objective-C View&quot; text.
b) Test 2: Comment back in the line below the &quot;Test 2: Uncomment this line&quot;
comment. Build and run. You should get a crash on the line you commented back
in: NullReferenceException at
System.Xml.Serialization.XmlReflectionImporter.ImportIncludedTypes(System.Type
type, System.String defaultNamespace.
c) Test 3: Comment out the 2 lines of code immediately below the &quot;Test 3:
Comment out these 2 lines&quot; comment. Build and run. You should see the Main
application window (labelled Main Window) and critically, the line which
crashed in Test 2, should now succeed.

All we can determine is that the AOT compiler is somehow processing the
TestViewController class when it is used in the application. In this case it
crashing the XmlSerializer constructor.

Cheers.

Rohinton Collins
Diligent Boardbooks Member Services Ltd.


Actual Results:  
Test 2: You should get a crash on the line you commented back in:
NullReferenceException at
System.Xml.Serialization.XmlReflectionImporter.ImportIncludedTypes(System.Type
type, System.String defaultNamespace.

Expected Results:  
Should not crash.

I have reported this to the MonoTouch Forums and have emailed you directly at
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">monotouch at novell.com.</A> This is a critical problem which is holding up the
integration of our project which is on an extremely tight schedule. Thanks!

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="106387.html">[Mono-bugs] [Bug 654476] HttpRuntime::Validate incorrectly thinks ', ' is an invalid char
</A></li>
	<LI>Next message: <A HREF="106324.html">[Mono-bugs] [Bug 654482] Binding and using UIViewController OC library causes XmlSerializer constructor to fail
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106322">[ date ]</a>
              <a href="thread.html#106322">[ thread ]</a>
              <a href="subject.html#106322">[ subject ]</a>
              <a href="author.html#106322">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
