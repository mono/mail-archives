<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 655674] New: Got exception and program crashes when LayoutKind.Auto is used during P/Invoke
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20655674%5D%20New%3A%20Got%20exception%20and%20program%20crashes%0A%20when%20LayoutKind.Auto%20is%20used%20during%20P/Invoke&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="106632.html">
   <LINK REL="Next"  HREF="106625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 655674] New: Got exception and program crashes when LayoutKind.Auto is used during P/Invoke</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20655674%5D%20New%3A%20Got%20exception%20and%20program%20crashes%0A%20when%20LayoutKind.Auto%20is%20used%20during%20P/Invoke&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 655674] New: Got exception and program crashes when LayoutKind.Auto is used during P/Invoke">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Nov 24 02:52:40 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="106632.html">[Mono-bugs] [Bug 655669] Weak GCHandle does not work and crashes in multi-AppDomain scenario
</A></li>
        <LI>Next message: <A HREF="106625.html">[Mono-bugs] [Bug 655674] Got exception and program crashes when LayoutKind.Auto is used during P/Invoke
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106556">[ date ]</a>
              <a href="thread.html#106556">[ thread ]</a>
              <a href="subject.html#106556">[ subject ]</a>
              <a href="author.html#106556">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=655674">https://bugzilla.novell.com/show_bug.cgi?id=655674</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=655674#c0">https://bugzilla.novell.com/show_bug.cgi?id=655674#c0</A>


           Summary: Got exception and program crashes when LayoutKind.Auto
                    is used during P/Invoke
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.8.x
          Platform: x86
        OS/Version: RHEL 5
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: interop
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">liewang at cisco.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1;
Trident/4.0; InfoPath.2; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR
3.5.21022; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)

If I creat a class and mark it as [StructLayout(LayoutKind.Auto)], and pass its
instance from managed code to native code using P/Invoke, runtime will report
an exception saying classes being passed to native side must be marked with
StructLayout attribute.

LayoutKind.Auto works on Microsoft .NET platform. Is it by design MONO does not
support it?

Reproducible: Always

Steps to Reproduce:
1. Create a class A and mark it as [StructLayout(LayoutKind.Auto)]
2. Create a P/Invoke managed method like: static extern void Test(A a) in
managed code. 
3. Create a corresponding native function like void Test(void *a)
4. In managed code, call the method created in step 2
Actual Results:  
Exception is thrown out saying classes being passed to native side must be
marked with StructLayout attribute.

Expected Results:  
No exception.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="106632.html">[Mono-bugs] [Bug 655669] Weak GCHandle does not work and crashes in multi-AppDomain scenario
</A></li>
	<LI>Next message: <A HREF="106625.html">[Mono-bugs] [Bug 655674] Got exception and program crashes when LayoutKind.Auto is used during P/Invoke
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106556">[ date ]</a>
              <a href="thread.html#106556">[ thread ]</a>
              <a href="subject.html#106556">[ subject ]</a>
              <a href="author.html#106556">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
