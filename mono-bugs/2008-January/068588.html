<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 357649] New: GC Error: The object was used after	being disposed.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20357649%5D%20New%3A%20GC%20Error%3A%20The%20object%20was%20used%20after%0A%09being%20disposed.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="068587.html">
   <LINK REL="Next"  HREF="068589.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 357649] New: GC Error: The object was used after	being disposed.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20357649%5D%20New%3A%20GC%20Error%3A%20The%20object%20was%20used%20after%0A%09being%20disposed.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 357649] New: GC Error: The object was used after	being disposed.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jan 31 11:31:04 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="068587.html">[Mono-bugs] [Bug 357642] New: X11 Clipboard: DataObject.GetData(...) fails for custom data formats
</A></li>
        <LI>Next message: <A HREF="068589.html">[Mono-bugs] [Bug 357649] GC Error: The object was used after being	disposed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68588">[ date ]</a>
              <a href="thread.html#68588">[ thread ]</a>
              <a href="subject.html#68588">[ subject ]</a>
              <a href="author.html#68588">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=357649">https://bugzilla.novell.com/show_bug.cgi?id=357649</A>


           Summary: GC Error: The object was used after being disposed.
           Product: Mono: Runtime
           Version: 1.2.6
          Platform: x86-64
        OS/Version: Linux
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: GC
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">yhdezalvarez at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
                CC: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">yhdezalvarez at gmail.com</A>
          Found By: Other


Unhandled Exception: System.ObjectDisposedException: The object was used after
being disposed.
  at System.IO.StreamWriter.Write (System.String value) [0x00000] 
  at System.IO.TextWriter.WriteLine (System.String value) [0x00000] 
  at mdu.Mailer.SendMail (System.String users, System.String TextMessage,
System.String HTMLMessage) [0x00000] 
  at mdu.Reporter.SendReport (mdu.UserDictionary Users, System.String
EMailList) [0x00000] 
  at mdu.Program.ProcessDirectory (System.IO.DirectoryInfo Dir, System.String
DefaultUser) [0x00000] 
  at mdu.Program.ProcessDirectory (System.IO.DirectoryInfo Dir, System.String
DefaultUser) [0x00000] 
  at mdu.Program.Main (System.String[] args) [0x00000]

code in question:
----------------------
static public void SendMail(string users, string TextMessage, string
HTMLMessage)

{

    StreamWriter sw;

    if (string.IsNullOrEmpty(Configuration.MailDir))

    {

        Process myProcess = new Process();

        myProcess.StartInfo.FileName = &quot;/usr/sbin/sendmail&quot;;

        myProcess.StartInfo.Arguments = string.Format(&quot;-f {0} -- {1}&quot;,

            Configuration.SanitizeEmails(Configuration.Sender, &quot;&quot;),

            Configuration.SanitizeEmails(users, &quot; &quot;));

        myProcess.StartInfo.UseShellExecute = false;

        myProcess.StartInfo.RedirectStandardInput = true;

        myProcess.Start();

        sw = myProcess.StandardInput;

    }

    else

        sw = new StreamWriter(Path.Combine(Configuration.MailDir,

                                           string.Format(&quot;{0}{1}.eml&quot;,
C++.ToString(&quot;000&quot;), users)));

    string line;

    using (StreamReader sr = new StreamReader(Configuration.EMailTemplate))

        while ((line = sr.ReadLine()) != null)

            sw.WriteLine(line.Replace(&quot;%%TEXT%%&quot;, TextMessage)

                             .Replace(&quot;%%HTML%%&quot;, HTMLMessage)

                             .Replace(&quot;%%USERS%%&quot;,
Configuration.SanitizeEmails(users, &quot;, &quot;))

                             .Replace(&quot;%%SENDER%%&quot;,
Configuration.SanitizeEmails(Configuration.Sender, &quot;&quot;)));

    sw.Close();

    sw.Dispose();

}


----------------------

I think this happens because:
* the variable myProcess goes out of scope
* GC collection occurs before sw.WriteLine is called.

But the GC should keep the stream myProcess.StandardInput because it's
referenced by sw. Isn't it?

In the meantime I'm gonna move the declaration of myProcess out to the parent
block to workaround this.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="068587.html">[Mono-bugs] [Bug 357642] New: X11 Clipboard: DataObject.GetData(...) fails for custom data formats
</A></li>
	<LI>Next message: <A HREF="068589.html">[Mono-bugs] [Bug 357649] GC Error: The object was used after being	disposed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68588">[ date ]</a>
              <a href="thread.html#68588">[ thread ]</a>
              <a href="subject.html#68588">[ subject ]</a>
              <a href="author.html#68588">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
