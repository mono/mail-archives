<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 497293] New: XmlSerializer &amp; xsd generated classes do not handle derived classes inside an xs:choice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20497293%5D%20New%3A%20XmlSerializer%20%26%20xsd%20generated%20classes%0A%20do%20not%20handle%20derived%20classes%20inside%20an%20xs%3Achoice&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="088096.html">
   <LINK REL="Next"  HREF="088099.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 497293] New: XmlSerializer &amp; xsd generated classes do not handle derived classes inside an xs:choice</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20497293%5D%20New%3A%20XmlSerializer%20%26%20xsd%20generated%20classes%0A%20do%20not%20handle%20derived%20classes%20inside%20an%20xs%3Achoice&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 497293] New: XmlSerializer &amp; xsd generated classes do not handle derived classes inside an xs:choice">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Apr 22 10:26:54 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="088096.html">[Mono-bugs] [Bug 489019] mono throwing exception while closing file	descriptor 0
</A></li>
        <LI>Next message: <A HREF="088099.html">[Mono-bugs] [Bug 487130] ABORT in os_dep.c:GC_unmap()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88098">[ date ]</a>
              <a href="thread.html#88098">[ thread ]</a>
              <a href="subject.html#88098">[ subject ]</a>
              <a href="author.html#88098">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=497293">http://bugzilla.novell.com/show_bug.cgi?id=497293</A>


           Summary: XmlSerializer &amp; xsd generated classes do not handle
                    derived classes inside an xs:choice
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.4.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.XML
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jkovach at arl.army.mil</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Community User


Created an attachment (id=287477)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=287477">http://bugzilla.novell.com/attachment.cgi?id=287477</A>)
test program &amp; schema

Description of Problem:
If you have an XML schema containing multiple base and derived types (where a
&quot;derived type&quot; is a xs:complexType that uses xs:extension to extend another
xs:complexType) and an element containing an xs:choice , and then use the xsd
tool to generate classes from this XML schema, the resulting generated classes
do not serialize in certain cases when the derived types are used (difficult to
explain clearly so please see the attached test case.)

The attached test case works correctly in Microsoft's .NET (3.5) but throws an
exception with mono.

Steps to reproduce the problem:
1. extract attached zip
2. xsd testxsd.xsd /classes /n:XsdInheritanceTest
3. gmcs test.cs testxsd.cs
4. mono test.exe

Actual Results:
[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">arl at vm5</A> XsdInheritanceTest]$ xsd testxsd.xsd /classes /n:XsdInheritanceTest
Written file ./testxsd.cs
[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">arl at vm5</A> XsdInheritanceTest]$ gmcs test.cs testxsd.cs
[<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">arl at vm5</A> XsdInheritanceTest]$ mono test.exe

Unhandled Exception: System.InvalidOperationException: There was an error
generating the XML document. ---&gt; System.InvalidOperationException: The type
XsdInheritanceTest.DerivedType1A may not be used in this context.
  at
System.Xml.Serialization.XmlSerializationWriterInterpreter.WriteListContent
(System.Object container, System.Xml.Serialization.TypeData listType,
System.Xml.Serialization.ListMap map, System.Object ob,
System.Text.StringBuilder targetString) [0x00000] 
  at
System.Xml.Serialization.XmlSerializationWriterInterpreter.WriteElementMembers
(System.Xml.Serialization.ClassMap map, System.Object ob, Boolean isValueList)
[0x00000] 
  at
System.Xml.Serialization.XmlSerializationWriterInterpreter.WriteObjectElementElements
(System.Xml.Serialization.XmlTypeMapping typeMap, System.Object ob) [0x00000] 
  at
System.Xml.Serialization.XmlSerializationWriterInterpreter.WriteObjectElement
(System.Xml.Serialization.XmlTypeMapping typeMap, System.Object ob,
System.String element, System.String namesp) [0x00000] 
  at System.Xml.Serialization.XmlSerializationWriterInterpreter.WriteObject
(System.Xml.Serialization.XmlTypeMapping typeMap, System.Object ob,
System.String element, System.String namesp, Boolean isNullable, Boolean
needType, Boolean writeWrappingElem) [0x00000] 
  at System.Xml.Serialization.XmlSerializationWriterInterpreter.WriteRoot
(System.Object ob) [0x00000] 
  at System.Xml.Serialization.XmlSerializer.Serialize (System.Object o,
System.Xml.Serialization.XmlSerializationWriter writer) [0x00000] 
  at System.Xml.Serialization.XmlSerializer.Serialize (System.Xml.XmlWriter
writer, System.Object o, System.Xml.Serialization.XmlSerializerNamespaces
namespaces) [0x00000] 
  --- End of inner exception stack trace ---
  at System.Xml.Serialization.XmlSerializer.Serialize (System.Xml.XmlWriter
writer, System.Object o, System.Xml.Serialization.XmlSerializerNamespaces
namespaces) [0x00000] 
  at System.Xml.Serialization.XmlSerializer.Serialize (System.IO.Stream stream,
System.Object o) [0x00000] 
  at XsdInheritanceTest.Program.Main (System.String[] args) [0x00000] 


Expected Results: (this is what Microsoft .NET does)
C:\Experimental\XsdInheritanceTest&gt;xsd testxsd.xsd /classes
/n:XsdInheritanceTest
Microsoft (R) Xml Schemas/DataTypes support utility
[Microsoft (R) .NET Framework, Version 2.0.50727.3038]
Copyright (C) Microsoft Corporation. All rights reserved.
Writing file 'C:\Experimental\XsdInheritanceTest\testxsd.cs'.

C:\Experimental\XsdInheritanceTest&gt;csc test.cs testxsd.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.


C:\Experimental\XsdInheritanceTest&gt;test.exe
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;Message xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</A>
xmlns:xsd=&quot;http:/
/www.w3.org/2001/XMLSchema&quot; xmlns=&quot;test:testxsd.xsd&quot;&gt;
  &lt;Data1 xsi:type=&quot;DerivedType1A&quot;&gt;
    &lt;Stuff&gt;foo&lt;/Stuff&gt;
    &lt;MoreStuff&gt;bar&lt;/MoreStuff&gt;
  &lt;/Data1&gt;
  &lt;Data2&gt;
    &lt;OtherStuff&gt;baz&lt;/OtherStuff&gt;
  &lt;/Data2&gt;
&lt;/Message&gt;


How often does this happen? Consistently

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="088096.html">[Mono-bugs] [Bug 489019] mono throwing exception while closing file	descriptor 0
</A></li>
	<LI>Next message: <A HREF="088099.html">[Mono-bugs] [Bug 487130] ABORT in os_dep.c:GC_unmap()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88098">[ date ]</a>
              <a href="thread.html#88098">[ thread ]</a>
              <a href="subject.html#88098">[ subject ]</a>
              <a href="author.html#88098">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
