<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 647948] New: null stream.BaseStream Close/Dispose not throwing exception (unlike MS .Net)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20647948%5D%20New%3A%20null%20stream.BaseStream%20Close/Dispose%0A%20not%20throwing%20exception%20%28unlike%20MS%20.Net%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="105148.html">
   <LINK REL="Next"  HREF="105169.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 647948] New: null stream.BaseStream Close/Dispose not throwing exception (unlike MS .Net)</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20647948%5D%20New%3A%20null%20stream.BaseStream%20Close/Dispose%0A%20not%20throwing%20exception%20%28unlike%20MS%20.Net%29&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 647948] New: null stream.BaseStream Close/Dispose not throwing exception (unlike MS .Net)">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Oct 20 02:37:14 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="105148.html">[Mono-bugs] [Bug 647924] New: mono --llvm --aot fails with the	default packages
</A></li>
        <LI>Next message: <A HREF="105169.html">[Mono-bugs] [Bug 647948] null stream.BaseStream Close/Dispose not throwing exception (unlike MS .Net)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105154">[ date ]</a>
              <a href="thread.html#105154">[ thread ]</a>
              <a href="subject.html#105154">[ subject ]</a>
              <a href="author.html#105154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=647948">https://bugzilla.novell.com/show_bug.cgi?id=647948</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=647948#c0">https://bugzilla.novell.com/show_bug.cgi?id=647948#c0</A>


           Summary: null stream.BaseStream Close/Dispose not throwing
                    exception (unlike MS .Net)
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.8.x
          Platform: x86-64
        OS/Version: All
            Status: NEW
          Severity: Minor
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">htl10 at users.sourceforge.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (X11; U; Linux; en-GB) AppleWebKit/532.4 (KHTML,
like Gecko) konqueror/4.4.5 Safari/532.4

While trying to track down some buffering problem, I wrote the following
*brain-damaged* *incorrect* code (the 4 basestream lines are wrong and
problematic and should not be there):
-------------------------------------------------------------------------------------------------
sw = new BinaryWriter(new GZipStream(new FileStream(Path.Combine(outDir,
&quot;Carrot.&quot; + chr), FileMode.Create, 
FileAccess.Write, FileShare.None), CompressionMode.Compress, true));
..
..
sw.Write(...);
sw.Write(...);
..
sw.Flush();
((GZipStream) sw.BaseStream).Flush();
((FileStream) ((GZipStream) sw.BaseStream).BaseStream).Flush();
sw.Close();
((GZipStream) sw.BaseStream).Close();
((FileStream) ((GZipStream) sw.BaseStream).BaseStream).Close();
--------------------------------------------------------------------------------------------------
Mono runtime doesn't complain; MS.Net throws exceptions about &quot;cannot close
streams which is already closed&quot;, or &quot;object not an instance of class&quot;. 


Reproducible: Always

Actual Results:  
Mono lets program run to completion.

Expected Results:  
Mono should throw exception about incorrect code - trying to close the
basestream of an already closed stream is wrong. (not too sure about whether
&quot;object not an instance of class&quot; is the same problem - but it seems to be
about the extra casting in any case)

Mono never throw exception on this code whereas MS .NET does it almost every
time.

I know this is nitpicking, when Mono is more tolerant of bad code... this
behavior probably also depends on garbage collection and timing, but OTOH, the
fact that Mono happily runs clearly wrong code on hindsight (which MS .NET does
not run) makes it incompatible and inconvenient for cross-platform .NET
development.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


















































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="105148.html">[Mono-bugs] [Bug 647924] New: mono --llvm --aot fails with the	default packages
</A></li>
	<LI>Next message: <A HREF="105169.html">[Mono-bugs] [Bug 647948] null stream.BaseStream Close/Dispose not throwing exception (unlike MS .Net)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105154">[ date ]</a>
              <a href="thread.html#105154">[ thread ]</a>
              <a href="subject.html#105154">[ subject ]</a>
              <a href="author.html#105154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
