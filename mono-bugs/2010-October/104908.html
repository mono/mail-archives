<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 646491] New: Constructor X509Certificate2(byte[]) throws an exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20646491%5D%20New%3A%20Constructor%20X509Certificate2%28byte%5B%5D%29%0A%20throws%20an%20exception&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="104907.html">
   <LINK REL="Next"  HREF="104921.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 646491] New: Constructor X509Certificate2(byte[]) throws an exception</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20646491%5D%20New%3A%20Constructor%20X509Certificate2%28byte%5B%5D%29%0A%20throws%20an%20exception&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 646491] New: Constructor X509Certificate2(byte[]) throws an exception">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Oct 14 06:45:47 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="104907.html">[Mono-bugs] [Bug 641005] monodis does not compile with option --with-moonlight=yes using mono-2.8
</A></li>
        <LI>Next message: <A HREF="104921.html">[Mono-bugs] [Bug 646491] Constructor X509Certificate2(byte[]) throws an exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#104908">[ date ]</a>
              <a href="thread.html#104908">[ thread ]</a>
              <a href="subject.html#104908">[ subject ]</a>
              <a href="author.html#104908">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=646491">https://bugzilla.novell.com/show_bug.cgi?id=646491</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=646491#c0">https://bugzilla.novell.com/show_bug.cgi?id=646491#c0</A>


           Summary: Constructor X509Certificate2(byte[]) throws an
                    exception
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.8.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: interop
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">djechelon at fastwebnet.it</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; it; rv:1.9.2.10)
Gecko/20100914 Firefox/3.6.10

When I try to load an X509Certificate that is stored as a .p12 file as an
embedded resource assembly, I get its payload as a byte[] and pass it to
X509Certificate2 constructor. Then I get a SecurityException from Mono.Security

Reproducible: Always

Steps to Reproduce:
Try running attached demo project
Actual Results:  
Reading file but passing as byte[]
System.Security.Cryptography.CryptographicException: Unable to decode
certificat
e. ---&gt; System.Security.Cryptography.CryptographicException: Input data cannot
b
e coded as a valid certificate. ---&gt;
System.Security.Cryptography.CryptographicE
xception: Input data cannot be coded as a valid certificate.
  at Mono.Security.X509.X509Certificate.Parse (System.Byte[] data) [0x00041] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.8\mcs\class\corlib\Mono.Security.X509
\X509Certificate.cs:113
  --- End of inner exception stack trace ---
  at Mono.Security.X509.X509Certificate.Parse (System.Byte[] data) [0x00352] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.8\mcs\class\corlib\Mono.Security.X509
\X509Certificate.cs:207
  at Mono.Security.X509.X509Certificate..ctor (System.Byte[] data) [0x00043] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.8\mcs\class\corlib\Mono.Security.X509
\X509Certificate.cs:225
  at System.Security.Cryptography.X509Certificates.X509Certificate.Import
(Syste
m.Byte[] rawData, System.String password, X509KeyStorageFlags keyStorageFlags)
[
0x0000c] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.8\mcs\class\corlib\System
Security.Cryptography.X509Certificates\X509Certificate20.cs:225
  --- End of inner exception stack trace ---
  at System.Security.Cryptography.X509Certificates.X509Certificate.Import
(Syste
m.Byte[] rawData, System.String password, X509KeyStorageFlags keyStorageFlags)
[
0x00065] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.8\mcs\class\corlib\System
Security.Cryptography.X509Certificates\X509Certificate20.cs:238
  at System.Security.Cryptography.X509Certificates.X509Certificate2.Import
(Syst
em.Byte[] rawData, System.String password, X509KeyStorageFlags keyStorageFlags)
[0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.8\mcs\class\System\Syste
m.Security.Cryptography.X509Certificates\X509Certificate2.cs:441
  at System.Security.Cryptography.X509Certificates.X509Certificate2..ctor
(Syste
m.Byte[] rawData) [0x00011] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-2.8\mcs\
class\System\System.Security.Cryptography.X509Certificates\X509Certificate2.cs:7
2
  at Certificate.Program.Main (System.String[] args) [0x00000] in &lt;filename
unkn
own&gt;:0

Expected Results:  
I expect the program to output certificate information

Problem occurred in both Mono 2.6.7 and Mono 2.8. Current test done under
Windows but found the same to occur in Linux too.

Workaround: (as soon as you are sure payload is PKCS#12) write the byte[] in a
temporary file and load it with string constructor

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="104907.html">[Mono-bugs] [Bug 641005] monodis does not compile with option --with-moonlight=yes using mono-2.8
</A></li>
	<LI>Next message: <A HREF="104921.html">[Mono-bugs] [Bug 646491] Constructor X509Certificate2(byte[]) throws an exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#104908">[ date ]</a>
              <a href="thread.html#104908">[ thread ]</a>
              <a href="subject.html#104908">[ subject ]</a>
              <a href="author.html#104908">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
