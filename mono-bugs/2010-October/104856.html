<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 464128] char* should be in ANSI encoding when passed to C runtime rather than Unicode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20464128%5D%20char%2A%20should%20be%20in%20ANSI%20encoding%20when%0A%20passed%20to%20C%20runtime%20rather%20than%20Unicode&In-Reply-To=bug-464128-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="105122.html">
   <LINK REL="Next"  HREF="104857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 464128] char* should be in ANSI encoding when passed to C runtime rather than Unicode</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20464128%5D%20char%2A%20should%20be%20in%20ANSI%20encoding%20when%0A%20passed%20to%20C%20runtime%20rather%20than%20Unicode&In-Reply-To=bug-464128-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 464128] char* should be in ANSI encoding when passed to C runtime rather than Unicode">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Oct 13 13:08:49 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="105122.html">[Mono-bugs] [Bug 646224] TabLayout demo doesn't work.
</A></li>
        <LI>Next message: <A HREF="104857.html">[Mono-bugs] [Bug 550512] &quot;Nothing provides mono-addon-libgdiplus0&quot; when creating a SLED 11 x86_64 appliance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#104856">[ date ]</a>
              <a href="thread.html#104856">[ thread ]</a>
              <a href="subject.html#104856">[ subject ]</a>
              <a href="author.html#104856">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=464128">https://bugzilla.novell.com/show_bug.cgi?id=464128</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=464128#c4">https://bugzilla.novell.com/show_bug.cgi?id=464128#c4</A>


Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jpryor at novell.com</A>&gt; changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                 CC|                            |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jpryor at novell.com</A>

--- Comment #4 from Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jpryor at novell.com</A>&gt; 2010-10-13 17:08:47 UTC ---
I'm guessing, but I think the issue is this:

Consider Mono.Unix.Native.Stdlib.fopen():

    [DllImport (LIBC, CallingConvention=CallingConvention.Cdecl, 
            SetLastError=true)]
    public static extern IntPtr fopen (
        [MarshalAs (UnmanagedType.CustomMarshaler, 
                    MarshalTypeRef=typeof(FileNameMarshaler))]
        string path, string mode);

Note: LIBC will be MSVCRT.DLL on Windows.

There are two ways to consider the above.  First, if we ignore the
CustomMarshaler use on the 'path' value, .NET and Mono will do two different
things when marshaling the 'path' string.  .NET will convert 'path' into the
ANSI encoding, while Mono will convert to UTF-8.

Thus, if you did Stdlib.fopen(&quot;filename-containing-unicode-characters&quot;), two
different strings would be passed to MSVCRT.DLL!fopen, resulting in...confusion
at best, and some form of error at worst.

Though I'd love to know what EXACTLY could go wrong here.  I imagine it could
result in fopen() returning NULL for filenames containing invalid characters
for the current ANSI locale (meaning users won't be able to read files they'd
otherwise be able to read), but perhaps there's an actual security
vulnerability here?  I don't know.

If we consider the use of the CustomMarshaler, things get worse: with the
custom marshaler use, the default string marshaling is IGNORED, and thus UTF-8
strings will be generated even when running on .NET.

Oops.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>
























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="105122.html">[Mono-bugs] [Bug 646224] TabLayout demo doesn't work.
</A></li>
	<LI>Next message: <A HREF="104857.html">[Mono-bugs] [Bug 550512] &quot;Nothing provides mono-addon-libgdiplus0&quot; when creating a SLED 11 x86_64 appliance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#104856">[ date ]</a>
              <a href="thread.html#104856">[ thread ]</a>
              <a href="subject.html#104856">[ subject ]</a>
              <a href="author.html#104856">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
