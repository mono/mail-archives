<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 648130] New: Calling Timer.Change(Infinite, Infinite) leaks timer objects on the scheduler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20648130%5D%20New%3A%20Calling%20Timer.Change%28Infinite%2C%0A%20Infinite%29%20leaks%20timer%20objects%20on%20the%20scheduler&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="105190.html">
   <LINK REL="Next"  HREF="105211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 648130] New: Calling Timer.Change(Infinite, Infinite) leaks timer objects on the scheduler</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20648130%5D%20New%3A%20Calling%20Timer.Change%28Infinite%2C%0A%20Infinite%29%20leaks%20timer%20objects%20on%20the%20scheduler&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 648130] New: Calling Timer.Change(Infinite, Infinite) leaks timer objects on the scheduler">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Oct 20 16:33:54 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="105190.html">[Mono-bugs] [Bug 597103] UsingWebBrowser Crashes when right clicking in middle of website
</A></li>
        <LI>Next message: <A HREF="105211.html">[Mono-bugs] [Bug 648130] Calling Timer.Change(Infinite, Infinite) leaks timer objects on the scheduler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105191">[ date ]</a>
              <a href="thread.html#105191">[ thread ]</a>
              <a href="subject.html#105191">[ subject ]</a>
              <a href="author.html#105191">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=648130">https://bugzilla.novell.com/show_bug.cgi?id=648130</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=648130#c0">https://bugzilla.novell.com/show_bug.cgi?id=648130#c0</A>


           Summary: Calling Timer.Change(Infinite, Infinite) leaks timer
                    objects on the scheduler
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bassam at symform.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.10)
Gecko/20100914 Firefox/3.6.10 ( .NET CLR 3.5.30729; .NET4.0E)

We are seeing an issue where timers stop firing. We have a consistent repro for
this, but we've been struggling with getting an isolated repro. We've narrowed
it down to the change made to the TimerComparer (as a result of the fix for
605092) where reference equality is used as a tie breaker when next_run values
are equal.

Here is what we see:

1) Two timers objects (A and B) are created with exactly the same due time
(happens quite frequently in our system)
2) A is added to the list maintained by the Scheduler.
3) When B is added the code in Scheduler.Add checks if there is already a entry
with the same next_run value (list.IndexOfKey). The TimerComparer finds such an
entry and uses reference equality between A and B, and since they are not equal
returns -1. This causes IndexOfKey fail to find the object. As a result, the
code to handle collisions in Scheduler.Add is never invoked and now have A and
B on the scheduler list with the same next_run value.
4) ChangeTime(-1,-1) is called on B, which sets next_run to ulong.MaxValue but
does NOT remove it from the list, again because the TimerComparer finds A.
5) From this point onwards the sorted list is corrupt (i.e. not sorted). All
comparison are pretty random at this point.

At this state we see lots of timer objects in the sorted list with next_run =
ulong.MaxValue, and our valid timer objects do not fire.

If this description is not enough to help you fix this issue, we can continue
working on an isolated fix. Alternatively we can give you access to debug one
of our machines if you'd like.




Reproducible: Sometimes

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>





















































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="105190.html">[Mono-bugs] [Bug 597103] UsingWebBrowser Crashes when right clicking in middle of website
</A></li>
	<LI>Next message: <A HREF="105211.html">[Mono-bugs] [Bug 648130] Calling Timer.Change(Infinite, Infinite) leaks timer objects on the scheduler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105191">[ date ]</a>
              <a href="thread.html#105191">[ thread ]</a>
              <a href="subject.html#105191">[ subject ]</a>
              <a href="author.html#105191">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
