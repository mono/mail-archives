<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 650407] New: AOT compile asserts when dependent assemblies are not available
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20650407%5D%20New%3A%20AOT%20compile%20asserts%20when%20dependent%0A%20assemblies%20are%20not%20available&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="105684.html">
   <LINK REL="Next"  HREF="105694.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 650407] New: AOT compile asserts when dependent assemblies are not available</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20650407%5D%20New%3A%20AOT%20compile%20asserts%20when%20dependent%0A%20assemblies%20are%20not%20available&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 650407] New: AOT compile asserts when dependent assemblies are not available">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun Oct 31 16:44:24 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="105684.html">[Mono-bugs] [Bug 650406] New: UIImagePickerController.ReferenceUrl is an empty string
</A></li>
        <LI>Next message: <A HREF="105694.html">[Mono-bugs] [Bug 650407] AOT compile asserts when dependent assemblies are not available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105686">[ date ]</a>
              <a href="thread.html#105686">[ thread ]</a>
              <a href="subject.html#105686">[ subject ]</a>
              <a href="author.html#105686">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=650407">https://bugzilla.novell.com/show_bug.cgi?id=650407</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=650407#c0">https://bugzilla.novell.com/show_bug.cgi?id=650407#c0</A>


           Summary: AOT compile asserts when dependent assemblies are not
                    available
    Classification: Mono
           Product: Mono: Runtime
           Version: SVN
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Minor
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">brian at sooloos.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.5 Safari/534.10

This is just an error reporting problem, and appears not to be platform
specific (reproduced on x86 mac + linux).

I was trying to AOT-compile FSharp.Compiler.dll from F# 2.0 (available here:
<A HREF="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=f8c623ae-aef6-4a06-a185-05f59be47d67&amp;displaylang=en">http://www.microsoft.com/downloads/en/details.aspx?FamilyID=f8c623ae-aef6-4a06-a185-05f59be47d67&amp;displaylang=en</A>)

If I do mono --aot FSharp.Compiler.dll, I get a crash like this:

Mono Ahead of Time compiler - compiling assembly
/Users/brian/bin/fsharp/FSharp.Compiler.dll
* Assertion at method-to-ir.c:8066, condition `costs &gt; 0' not met

Stacktrace:


Native stacktrace:

    0   mono                                0x000ca6a3
mono_handle_native_sigsegv + 376
    1   mono                                0x001255c2 sigabrt_signal_handler +
116
    2   libSystem.B.dylib                   0x97dd71fb _sigtramp + 43
    3   ???                                 0xffffffff 0x0 + 4294967295
    4   libSystem.B.dylib                   0x97e6462d raise + 26
    5   libSystem.B.dylib                   0x97e7a6e4 abort + 93
    6   mono                                0x0026f14e monoeg_g_logv + 197
    7   mono                                0x0026f1b0 monoeg_assertion_message
+ 46
    8   mono                                0x000522ca mono_method_to_ir +
103328
    9   mono                                0x0000b5df mini_method_compile +
3291
    10  mono                                0x000ac799 compile_method + 497
    11  mono                                0x000b19da compile_methods + 546
    12  mono                                0x000b26a8 mono_compile_assembly +
1267
    13  mono                                0x0009e4bb main_thread_handler +
320
    14  mono                                0x000a066c mono_main + 6979
    15  mono                                0x00001eea mono_main_with_options +
536
    16  mono                                0x00001f49 main + 49
    17  mono                                0x00001c95 start + 53

Debug info from gdb:

/tmp/mono-gdb-commands.0Gf48P:1: Error in sourced command file:
unable to debug self

=================================================================
Got a SIGABRT while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries 
used by your application.
=================================================================

I traced the crash through the mono code, and the issue is that ISymWrapper.dll
couldn't be loaded during AOT compilation. If I copy an ISymWrapper.dll 
from microsoft.net 2.0 into the cwd, then the AOT compile completes
successfully.

This should be reported to the user as an assembly load failure instead of as
an assert.


Reproducible: Always

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="105684.html">[Mono-bugs] [Bug 650406] New: UIImagePickerController.ReferenceUrl is an empty string
</A></li>
	<LI>Next message: <A HREF="105694.html">[Mono-bugs] [Bug 650407] AOT compile asserts when dependent assemblies are not available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#105686">[ date ]</a>
              <a href="thread.html#105686">[ thread ]</a>
              <a href="subject.html#105686">[ subject ]</a>
              <a href="author.html#105686">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
