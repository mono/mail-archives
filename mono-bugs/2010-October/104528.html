<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 643910] New: DriveInfo.GetDrives returns incorrect	values
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20643910%5D%20New%3A%20DriveInfo.GetDrives%20returns%20incorrect%0A%09values&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="104527.html">
   <LINK REL="Next"  HREF="104551.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 643910] New: DriveInfo.GetDrives returns incorrect	values</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20643910%5D%20New%3A%20DriveInfo.GetDrives%20returns%20incorrect%0A%09values&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 643910] New: DriveInfo.GetDrives returns incorrect	values">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Oct  5 14:55:26 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="104527.html">[Mono-bugs] [Bug 640657] Crash when using RunOnUiThread with a button - Build 7947
</A></li>
        <LI>Next message: <A HREF="104551.html">[Mono-bugs] [Bug 643910] DriveInfo.GetDrives returns incorrect	values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#104528">[ date ]</a>
              <a href="thread.html#104528">[ thread ]</a>
              <a href="subject.html#104528">[ subject ]</a>
              <a href="author.html#104528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=643910">https://bugzilla.novell.com/show_bug.cgi?id=643910</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=643910#c0">https://bugzilla.novell.com/show_bug.cgi?id=643910#c0</A>


           Summary: DriveInfo.GetDrives returns incorrect values
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: Macintosh
        OS/Version: Mac OS X 10.6
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.Core
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jbevain at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">johnl at johnlabovitz.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=393154)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=393154">http://bugzilla.novell.com/attachment.cgi?id=393154</A>)
Test code (example code from MS's site), and patch to fix the problem.

User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; en-us)
AppleWebKit/534.10+ (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5

When calling DriveInfo.GetDrives(), the returned DriveInfo object contains
values that are vastly different than the actual values from the system.

I've attached both a test file and a patch (originally done on a nightly
tarball, but applied to 2.6.7).

Reproducible: Always

Steps to Reproduce:
1. Call DriveInfo.GetDrives()
2. Enumerate through each drive as a DriveInfo object.
3. Examine AvailableFreeSpace, TotalFreeSpace, TotalSize members.
4. Compare against actual system values.



The problem seems to be an assumption that statvfs() and statfs() are
compatible, and that the structs they return are interchangeable. This is not
correct. On Mac OS X 10.6 at least, statvfs() returns the block size in the
f_frsize member, where statfs() returns it in the f_bsize member.

I fixed it in the patch by defining a new variable to save the effective block
size. I ran into problems getting the values expressed correctly in
64-integers, so I also added a cast to solve that.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>













































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="104527.html">[Mono-bugs] [Bug 640657] Crash when using RunOnUiThread with a button - Build 7947
</A></li>
	<LI>Next message: <A HREF="104551.html">[Mono-bugs] [Bug 643910] DriveInfo.GetDrives returns incorrect	values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#104528">[ date ]</a>
              <a href="thread.html#104528">[ thread ]</a>
              <a href="subject.html#104528">[ subject ]</a>
              <a href="author.html#104528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
