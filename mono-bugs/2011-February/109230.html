<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 672879] New: ReleaseInterfaces is called by GC	thread.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20672879%5D%20New%3A%20ReleaseInterfaces%20is%20called%20by%20GC%0A%09thread.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="109208.html">
   <LINK REL="Next"  HREF="109260.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 672879] New: ReleaseInterfaces is called by GC	thread.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20672879%5D%20New%3A%20ReleaseInterfaces%20is%20called%20by%20GC%0A%09thread.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 672879] New: ReleaseInterfaces is called by GC	thread.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Feb 17 00:25:50 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="109208.html">[Mono-bugs] [Bug 672845] New: Activity implementing ILocationListener and Camera.IPreviewCallback causes NullReferenceException
</A></li>
        <LI>Next message: <A HREF="109260.html">[Mono-bugs] [Bug 672879] ReleaseInterfaces is called by GC thread.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#109230">[ date ]</a>
              <a href="thread.html#109230">[ thread ]</a>
              <a href="subject.html#109230">[ subject ]</a>
              <a href="author.html#109230">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=672879">https://bugzilla.novell.com/show_bug.cgi?id=672879</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=672879#c0">https://bugzilla.novell.com/show_bug.cgi?id=672879#c0</A>


           Summary: ReleaseInterfaces is called by GC thread.
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: x86-64
        OS/Version: Ubuntu
            Status: NEW
          Severity: Enhancement
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">tom_hindle at sil.org</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=414597)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=414597">http://bugzilla.novell.com/attachment.cgi?id=414597</A>)
Allow ComObjects to now be released by GC patch.

User-Agent:       Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.13
(KHTML, like Gecko) Chrome/9.0.597.98 Safari/534.13

~__ComObject() calls ReleaseInterfaces which can cause underlying ComObject to
be release by GC thread.

This is an issue for COM applications which aren't thread safe. (which is guess
is most of them) for example xulrunner.

Attached is patch that demonstrates one possible solution to this issue.
(allowing the supplying of alternative release mechanism)


WinForms itself could supply a IComObjectReleaser implementation, for example:

// This is only an example.
class IdleComObjectRelease : System.IComObjectReleaser
    {
        public void Add(IntPtr pUnk)
        {
            if (pUnk == IntPtr.Zero)
                return;            
            EventHandler idleHandler = (sender, eventArgs) =&gt; {
Marshal.Release(pUnk); Application.Idle -= idleHandler; };            
            Application.Idle += idleHandler;
        }        
    }


and then call:
System.__ComObjectReleaser.Register(new IdleComObjectRelease()); 

Reproducible: Always

Steps to Reproduce:
1.
2.
3.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="109208.html">[Mono-bugs] [Bug 672845] New: Activity implementing ILocationListener and Camera.IPreviewCallback causes NullReferenceException
</A></li>
	<LI>Next message: <A HREF="109260.html">[Mono-bugs] [Bug 672879] ReleaseInterfaces is called by GC thread.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#109230">[ date ]</a>
              <a href="thread.html#109230">[ thread ]</a>
              <a href="subject.html#109230">[ subject ]</a>
              <a href="author.html#109230">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
