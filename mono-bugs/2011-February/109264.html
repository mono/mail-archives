<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 661461] Assembly.Load(AssemblyName) doesn't work with partial names
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20661461%5D%20Assembly.Load%28AssemblyName%29%20doesn%27t%20work%0A%20with%20partial%20names&In-Reply-To=bug-661461-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="109262.html">
   <LINK REL="Next"  HREF="109266.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 661461] Assembly.Load(AssemblyName) doesn't work with partial names</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20661461%5D%20Assembly.Load%28AssemblyName%29%20doesn%27t%20work%0A%20with%20partial%20names&In-Reply-To=bug-661461-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 661461] Assembly.Load(AssemblyName) doesn't work with partial names">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Feb 18 07:20:40 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="109262.html">[Mono-bugs] [Bug 661461] Assembly.Load(AssemblyName) doesn't work with partial names
</A></li>
        <LI>Next message: <A HREF="109266.html">[Mono-bugs] [Bug 661461] Assembly.Load(AssemblyName) doesn't work with partial names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#109264">[ date ]</a>
              <a href="thread.html#109264">[ thread ]</a>
              <a href="subject.html#109264">[ subject ]</a>
              <a href="author.html#109264">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=661461">https://bugzilla.novell.com/show_bug.cgi?id=661461</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=661461#c3">https://bugzilla.novell.com/show_bug.cgi?id=661461#c3</A>


--- Comment #3 from David Schmitt &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">david at dasz.at</A>&gt; 2011-02-18 12:20:39 UTC ---
Created an attachment (id=414983)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=414983">http://bugzilla.novell.com/attachment.cgi?id=414983</A>)
Demo app demonstrating the problem

Actually my last comment and my original analysis were wrong. The actual
problem I was experiencing comes from Type.GetType and AssemblyName.ctor using
different methods of parsing assembly names. While the latter correctly works
with unspecified versions, the former fails to do so and creates an
AssemblyName with Version=0.0.0.0 instead of an undefined version.

The important part of the attached demo app looks like this:

            // When the following two lines are removed this still works
against Microsoft, but fails under mono
            var assembly = Assembly.Load(assemblyName);
            Debug.WriteLine(String.Format(&quot;Loaded assembly [{0}]&quot;,
assembly.FullName));

            var type = Type.GetType(String.Format(&quot;{0},{1}&quot;, typeName,
assemblyName));
            Debug.WriteLine(String.Format(&quot;Loaded type     [{0}]&quot;,
type.AssemblyQualifiedName));

Call it with typeName == &quot;Demo2.Class&quot; assemblyName=&quot;Demo2&quot; (also within the
attachement, only an empty assembly). 

Assembly.Load will lead to calling mono_assembly_name_parse_full from
mono/metadata/assembly.c, which correctly sets is_version_defined depending on
whether or not the passed assemblyName contains a Version=.

If the assembly is not yet loaded, Type.GetType will lead to calling
assembly_name_to_aname from mono/metadata/reflection.c which just sets the
version part to 0.0.0.0 without checking whether or not the assembly name
actually has a version set.

In the end, Assembly.Load() fails, because Version=0.0.0.0 != the Version on
the actual assembly.

This happens in 2.8, 2.10 and in master.

I can currently workaround by manually pre-loading the assemblies.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>



































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="109262.html">[Mono-bugs] [Bug 661461] Assembly.Load(AssemblyName) doesn't work with partial names
</A></li>
	<LI>Next message: <A HREF="109266.html">[Mono-bugs] [Bug 661461] Assembly.Load(AssemblyName) doesn't work with partial names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#109264">[ date ]</a>
              <a href="thread.html#109264">[ thread ]</a>
              <a href="subject.html#109264">[ subject ]</a>
              <a href="author.html#109264">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
