<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 670560] New: WCF fails to unify Arrays and Lists in KnownTypeCollection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20670560%5D%20New%3A%20WCF%20fails%20to%20unify%20Arrays%20and%20Lists%0A%20in%20KnownTypeCollection&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="109232.html">
   <LINK REL="Next"  HREF="109178.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 670560] New: WCF fails to unify Arrays and Lists in KnownTypeCollection</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20670560%5D%20New%3A%20WCF%20fails%20to%20unify%20Arrays%20and%20Lists%0A%20in%20KnownTypeCollection&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 670560] New: WCF fails to unify Arrays and Lists in KnownTypeCollection">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Feb  9 06:03:03 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="109232.html">[Mono-bugs] [Bug 670539] WCF fails with generic types in contract
</A></li>
        <LI>Next message: <A HREF="109178.html">[Mono-bugs] [Bug 670560] WCF fails to unify Arrays and Lists in KnownTypeCollection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108876">[ date ]</a>
              <a href="thread.html#108876">[ thread ]</a>
              <a href="subject.html#108876">[ subject ]</a>
              <a href="author.html#108876">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=670560">https://bugzilla.novell.com/show_bug.cgi?id=670560</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=670560#c0">https://bugzilla.novell.com/show_bug.cgi?id=670560#c0</A>


           Summary: WCF fails to unify Arrays and Lists in
                    KnownTypeCollection
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.8.x
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: WCF
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">david at dasz.at</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.84 Safari/534.13

When building the KnownTypeCollection for the following datacontract:

    [DataContract]
    public class Data
    {
        [DataMember]
        public Data[] DataArray { get; set; }

        [DataMember]
        public List&lt;Data&gt; DataList { get; set; }
    }

it fails with the following exception:

    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
    &lt;Fault xmlns=&quot;<A HREF="http://schemas.microsoft.com/ws/2005/05/envelope/none&quot;">http://schemas.microsoft.com/ws/2005/05/envelope/none&quot;</A>&gt;
    &lt;Code&gt;
    &lt;Value
xmlns:a=&quot;<A HREF="http://schemas.microsoft.com/ws/2005/05/addressing/none&quot;">http://schemas.microsoft.com/ws/2005/05/addressing/none&quot;</A>&gt;a:InternalServiceFault&lt;/Value&gt;&lt;/Code&gt;
    &lt;Reason&gt;
    &lt;Text xml:lang=&quot;en-GB&quot;&gt;Failed to add type
System.Collections.Generic.List`1[DataMemberTest.Data] to known type
collection. There already is a registered type for XML name
<A HREF="http://schemas.datacontract.org/2004/07/DataMemberTest:ArrayOfData:">http://schemas.datacontract.org/2004/07/DataMemberTest:ArrayOfData:</A>
DataMemberTest.Data[]&lt;/Text&gt;&lt;/Reason&gt;
    &lt;Detail&gt;
    &lt;ExceptionDetail xmlns:i=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</A>
xmlns=&quot;<A HREF="http://schemas.datacontract.org/2004/07/System.ServiceModel&quot;">http://schemas.datacontract.org/2004/07/System.ServiceModel&quot;</A>&gt;
    &lt;HelpLink i:nil=&quot;true&quot; /&gt;
    &lt;InnerException i:nil=&quot;true&quot; /&gt;
    &lt;Message&gt;Failed to add type
System.Collections.Generic.List`1[DataMemberTest.Data] to known type
collection. There already is a registered type for XML name
<A HREF="http://schemas.datacontract.org/2004/07/DataMemberTest:ArrayOfData:">http://schemas.datacontract.org/2004/07/DataMemberTest:ArrayOfData:</A>
DataMemberTest.Data[]&lt;/Message&gt;
    &lt;StackTrace&gt;  at
System.Runtime.Serialization.KnownTypeCollection.RegisterCollection
(System.Type type) [0x0009c] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/KnownTypeCollection.cs:717 
      at System.Runtime.Serialization.KnownTypeCollection.TryRegister
(System.Type type) [0x00061] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/KnownTypeCollection.cs:638 
      at System.Runtime.Serialization.SharedContractMap.GetMembers (System.Type
type, System.Xml.XmlQualifiedName qname, Boolean declared_only) [0x0003d] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/SerializationMap.cs:551 
      at System.Runtime.Serialization.SharedContractMap.Initialize () [0x00053]
in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/SerializationMap.cs:530 
      at System.Runtime.Serialization.KnownTypeCollection.RegisterContract
(System.Type type) [0x0004e] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/KnownTypeCollection.cs:801 
      at System.Runtime.Serialization.KnownTypeCollection.TryRegister
(System.Type type) [0x00045] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/KnownTypeCollection.cs:632 
      at System.Runtime.Serialization.XsdDataContractExporter.ExportCore
(System.Type type, Boolean rejectNonContract) [0x00091] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/XsdDataContractExporter-new.cs:222 
      at System.Runtime.Serialization.XsdDataContractExporter.Export
(System.Type type) [0x00000] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.Runtime.Serialization/System.Runtime.Serialization/XsdDataContractExporter-new.cs:199 
      at System.ServiceModel.Description.WsdlExporter.GetSchemaElementForPart
(System.ServiceModel.Description.MessagePartDescription part,
System.Xml.Schema.XmlSchema schema) [0x00012] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/WsdlExporter.cs:529 
      at System.ServiceModel.Description.WsdlExporter.ExportParameters
(System.ServiceModel.Description.MessageBodyDescription msgbody, System.String
name, System.String ns) [0x000da] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/WsdlExporter.cs:469 
      at
System.ServiceModel.Description.WsdlExporter.ExportMessageBodyDescription
(System.ServiceModel.Description.MessageBodyDescription msgbody, System.String
name, System.String ns) [0x00037] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/WsdlExporter.cs:415 
      at System.ServiceModel.Description.WsdlExporter.ExportContractInternal
(System.ServiceModel.Description.ContractDescription contract, Boolean
rejectDuplicate) [0x00185] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/WsdlExporter.cs:130 
      at System.ServiceModel.Description.WsdlExporter.ExportEndpoint
(System.ServiceModel.Description.ServiceEndpoint endpoint, Boolean
rejectDuplicate) [0x00000] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/WsdlExporter.cs:188 
      at System.ServiceModel.Description.WsdlExporter.ExportEndpoints
(IEnumerable`1 endpoints, System.Xml.XmlQualifiedName name) [0x0005a] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/WsdlExporter.cs:364 
      at System.ServiceModel.Description.ServiceMetadataExtension.get_Metadata
() [0x00011] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/ServiceMetadataExtension.cs:74 
      at System.ServiceModel.Description.HttpGetWsdl.GetMetadata () [0x00012]
in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/ServiceMetadataExtension.cs:305 
      at System.ServiceModel.Description.HttpGetWsdl.EnsureMetadata ()
[0x0000b] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/ServiceMetadataExtension.cs:181 
      at System.ServiceModel.Description.HttpGetWsdl.Get
(System.ServiceModel.Channels.Message req) [0x00000] in
/srv/CCNet/mono/src/mono.git/mcs/class/System.ServiceModel/System.ServiceModel.Description/ServiceMetadataExtension.cs:188 
      at (wrapper managed-to-native)
System.Reflection.MonoMethod:InternalInvoke
(System.Reflection.MonoMethod*,object,object[],System.Exception&amp;amp;)
      at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags
invokeAttr, System.Reflection.Binder binder, System.Object[] parameters,
System.Globalization.CultureInfo culture) [0x000d5] in
/srv/CCNet/mono/src/mono.git/mcs/class/corlib/System.Reflection/MonoMethod.cs:223
&lt;/StackTrace&gt;
     
&lt;Type&gt;System.InvalidOperationException&lt;/Type&gt;&lt;/ExceptionDetail&gt;&lt;/Detail&gt;&lt;/Fault&gt;

(i've added the colliding type to the error message in my local mono fork).

As can be seen, the Array gets registered first and the try to register the
List fails due to both being mapped to ArrayOfData.

Please use the attached test solution to demonstrate the problem by trying to
access the service's WSDL.

Reproducible: Always

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="109232.html">[Mono-bugs] [Bug 670539] WCF fails with generic types in contract
</A></li>
	<LI>Next message: <A HREF="109178.html">[Mono-bugs] [Bug 670560] WCF fails to unify Arrays and Lists in KnownTypeCollection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108876">[ date ]</a>
              <a href="thread.html#108876">[ thread ]</a>
              <a href="subject.html#108876">[ subject ]</a>
              <a href="author.html#108876">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
