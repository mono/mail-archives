<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 462016] make check for pinvoke2.exe fails for	PowerPC
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20462016%5D%20make%20check%20for%20pinvoke2.exe%20fails%20for%0A%09PowerPC&In-Reply-To=bug-462016-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="084041.html">
   <LINK REL="Next"  HREF="084017.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 462016] make check for pinvoke2.exe fails for	PowerPC</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20462016%5D%20make%20check%20for%20pinvoke2.exe%20fails%20for%0A%09PowerPC&In-Reply-To=bug-462016-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 462016] make check for pinvoke2.exe fails for	PowerPC">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Jan  2 11:35:14 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="084041.html">[Mono-bugs] [Bug 463285] Probable JIT bug
</A></li>
        <LI>Next message: <A HREF="084017.html">[Mono-bugs] [Bug 463294] New: Verifier reports false positives for MS/ vbc compiled assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#84014">[ date ]</a>
              <a href="thread.html#84014">[ thread ]</a>
              <a href="subject.html#84014">[ subject ]</a>
              <a href="author.html#84014">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=462016">https://bugzilla.novell.com/show_bug.cgi?id=462016</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">munroesj at us.ibm.com</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=462016#c11">https://bugzilla.novell.com/show_bug.cgi?id=462016#c11</A>





--- Comment #11 from Steven Munroe &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">munroesj at us.ibm.com</A>&gt;  2009-01-02 09:35:12 MST ---
updated svn revision 122306 from 2008-12-31 12:45:17 without any patches and
gode simular but slightly different results:

mono/tests&gt; gdb ../mini/mono
GNU gdb 6.6.50.20070726-cvs
Copyright (C) 2007 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type &quot;show copying&quot; to see the conditions.
There is absolutely no warranty for GDB.  Type &quot;show warranty&quot; for details.
This GDB was configured as &quot;ppc-suse-linux&quot;...
Using host libthread_db library &quot;/lib/libthread_db.so.1&quot;.
(gdb) handle SIGXCPU SIG33 SIG35 SIGPWR nostop noprint
Signal        Stop      Print   Pass to program Description
SIGXCPU       No        No      Yes             CPU time limit exceeded
SIGPWR        No        No      Yes             Power fail/restart
SIG33         No        No      Yes             Real-time event 33
SIG35         No        No      Yes             Real-time event 35
(gdb) set environment MONO_PATH ../../../mcs/class/lib/net_2_0
(gdb) set environment MONO_SHARED_DIR
/home/sjmunroe/src/mono-ppc/mono-svn/mono/runtime
(gdb) set environment MONO_CFG_DIR
/home/sjmunroe/src/mono-ppc/mono-svn/mono/runtime/etc
(gdb) run pinvoke2.exe
Starting program: /home/sjmunroe/src/mono-ppc/mono-svn/mono/mono/mini/mono
pinvoke2.exe
[Thread debugging using libthread_db enabled]
[New Thread 0xf7fb6210 (LWP 11723)]
[New Thread 0xf77a34a0 (LWP 11726)]
[New Thread 0xf77434a0 (LWP 11727)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0xf7fb6210 (LWP 11723)]
0x100aeabc in mono_class_native_size (klass=0x103329e8, align=0xff9eb1e8)
    at marshal.c:11596
11596           return klass-&gt;marshal_info-&gt;native_size;
(gdb) backtrace
#0  0x100aeabc in mono_class_native_size (klass=0x103329e8, align=0xff9eb1e8)
    at marshal.c:11596
#1  0x10019bb8 in mono_allocate_stack_slots_full (cfg=0x10325200, backward=0,
    stack_size=0xff9eb26c, stack_align=0xff9eb270) at mini.c:1630
#2  0x100a5d74 in mono_arch_allocate_vars (m=0x10325200) at mini-ppc.c:1252
#3  0x1001bd34 in mini_method_compile (method=0x103418b8, opts=271733152,
    domain=0xf7e6bee0, run_cctors=270287412, compile_aot=1, parts=0)
    at mini.c:3432
#4  0x1001c9d0 in mono_jit_compile_method (method=0x103418b8) at mini.c:3822
#5  0x10112660 in mono_compile_method (method=0x103329e8) at object.c:529
#6  0x1001c7f4 in mono_jit_compile_method (method=0x102efc40) at mini.c:3778
#7  0x10112660 in mono_compile_method (method=0x103329e8) at object.c:529
#8  0x10093b20 in mono_magic_trampoline (regs=0xff9eb45c,
    code=0xf75d7300 &quot;\200a&quot;, m=0x102efc40, tramp=&lt;value optimized out&gt;)
    at mini-trampolines.c:292
#9  0xf7fc4114 in ?? ()
#10 0xf75d7300 in ?? ()
#11 0xf75f548c in ?? ()
#12 0x1001d20c in mono_jit_runtime_invoke (method=0xff9eb660, obj=0x0,
    params=0x0, exc=0x0) at mini.c:4166
#13 0x10113a60 in mono_runtime_invoke (method=0x102efc60, obj=0x0, params=0x0,
    exc=0x0) at object.c:2399
#14 0x10117078 in mono_runtime_invoke_array (method=0x102efc60, obj=0x0,
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
    params=0x0, exc=0x0) at object.c:3490
#15 0x101363b8 in ves_icall_InternalInvoke (method=&lt;value optimized out&gt;,
    this=0x0, params=0x0, exc=0xff9eb8fc) at icall.c:3056
#16 0xf75f53b0 in ?? ()
#17 0xf75f4e38 in ?? ()
#18 0xf75f4d14 in ?? ()
#19 0xf7ba5990 in ?? ()
#20 0xf7ba54d4 in ?? ()
#21 0xf7ba53a4 in ?? ()
#22 0x1001d20c in mono_jit_runtime_invoke (method=0xff9eb8d0, obj=0xf7631450,
    params=0xf7630fc8, exc=0x0) at mini.c:4166
#23 0x10113a60 in mono_runtime_invoke (method=0x102a20a8, obj=0x0,
    params=0xff9ebad8, exc=0x0) at object.c:2399
#24 0x1011a4fc in mono_runtime_exec_main (method=0x102a20a8,
    args=&lt;value optimized out&gt;, exc=0x0) at object.c:3296
#25 0x1011bd24 in mono_runtime_run_main (method=0xf7633aa0, argc=1, argv=0x6,
    exc=0x0) at object.c:3084
#26 0x10071b34 in mono_jit_exec (domain=&lt;value optimized out&gt;,
    assembly=&lt;value optimized out&gt;, argc=1, argv=0xff9ebef8) at driver.c:921
#27 0x10073000 in mono_main (argc=2, argv=&lt;value optimized out&gt;)
    at driver.c:969
#28 0x10013648 in main (argc=271788520, argv=0xff9eb1e8) at main.c:34
(gdb) print klass
$1 = (MonoClass *) 0x103329e8
(gdb) print klass-&gt;marshal_info
$2 = (MonoMarshalType *) 0x205de3f
(gdb) print klass-&gt;marshal_info-&gt;native_size
Cannot access memory at address 0x205de3f
(gdb) print *klass
$3 = {element_class = 0x10341480, cast_class = 0x102abac8, supertypes = 0x0,
  idepth = 0, rank = 0 '\0', instance_size = 271731984, inited = 0,
  init_pending = 0, size_inited = 0, valuetype = 0, enumtype = 0,
  blittable = 0, unicode = 0, wastypebuilder = 0, min_align = 0 '\0',
  packing_size = 0, ghcimpl = 0, has_finalize = 0, marshalbyref = 0,
  contextbound = 1, delegate = 0, gc_descr_inited = 0, has_cctor = 0,
  has_references = 0, has_static_refs = 0, no_special_static_fields = 0,
  is_com_object = 0, nested_classes_inited = 1, simd_type = 0,
  exception_type = 46 '.', parent = 0xf75fad28, nested_in = 0x0,
  nested_classes = 0x205ddff, image = 0x1033d538, name = 0x1033790c
&quot;\0203&#65533;8&quot;,
  name_space = 0x0, enum_basetype = 0x2067aa7, declsec_flags = 271655408,
  type_token = 4150252988, vtable_size = 0, interface_count = 518,
  interface_id = 9278, max_interface_id = 4142,
  interface_offsets_count = 60784, interfaces_packed = 0x10338cf0,
  interface_offsets_packed = 0x0,
  interface_bitmap = 0x205ddae &lt;Address 0x205ddae out of bounds&gt;,
  interfaces = 0x102eef18, sizes = {class_size = 271818960,
    element_size = 271818960, generic_param_token = 271818960}, flags = 0,
  field = {first = 33938915, count = 271656400}, method = {first = 4150254356,
    count = 0}, property = {first = 33957050, count = 271512056}, event = {
    first = 4150253000, count = 0}, marshal_info = 0x205de3f,
  fields = 0x10311f70, properties = 0xf75fad34, events = 0x0,
  methods = 0x20623ee, this_arg = {data = {klass = 0xf75fad34,
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
      type = 0xf75fad34, array = 0xf75fad34, method = 0xf75fad34,
      generic_param = 0xf75fad34, generic_class = 0xf75fad34}, attrs = 4139,
    type = 124, num_mods = 14, byref = 0, pinned = 0, modifiers = 0x10332a88},
  byval_arg = {data = {klass = 0x0, type = 0x0, array = 0x0, method = 0x0,
      generic_param = 0x0, generic_class = 0x0}, attrs = 63327, type = 173,
    num_mods = 13, byref = 0, pinned = 0, modifiers = 0x10332a90},
  generic_class = 0xf75fad40, generic_container = 0x102b80c8,
  reflection_info = 0x0, gc_descr = 0xf75fad40, runtime_info = 0x10312028,
  next_class_cache = 0xf75fad40, vtable = 0x0, field_def_values = 0x2062405}
(gdb)  disassemble
Dump of assembler code for function mono_class_native_size:
0x100aea70 &lt;mono_class_native_size+0&gt;:  mflr    r0
0x100aea74 &lt;mono_class_native_size+4&gt;:  stwu    r1,-32(r1)
0x100aea78 &lt;mono_class_native_size+8&gt;:  stw     r30,24(r1)
0x100aea7c &lt;mono_class_native_size+12&gt;: stw     r31,28(r1)
0x100aea80 &lt;mono_class_native_size+16&gt;: mr      r30,r4
0x100aea84 &lt;mono_class_native_size+20&gt;: mr      r31,r3
0x100aea88 &lt;mono_class_native_size+24&gt;: stw     r29,20(r1)
0x100aea8c &lt;mono_class_native_size+28&gt;: stw     r0,36(r1)
0x100aea90 &lt;mono_class_native_size+32&gt;: nop
0x100aea94 &lt;mono_class_native_size+36&gt;: nop
0x100aea98 &lt;mono_class_native_size+40&gt;: nop
0x100aea9c &lt;mono_class_native_size+44&gt;: lwz     r29,132(r3)
0x100aeaa0 &lt;mono_class_native_size+48&gt;: cmpwi   cr7,r29,0
0x100aeaa4 &lt;mono_class_native_size+52&gt;: beq-    cr7,0x100aeadc
&lt;mono_class_native_size+108&gt;
0x100aeaa8 &lt;mono_class_native_size+56&gt;: cmpwi   cr7,r30,0
0x100aeaac &lt;mono_class_native_size+60&gt;: beq-    cr7,0x100aeab8
&lt;mono_class_native_size+72&gt;
0x100aeab0 &lt;mono_class_native_size+64&gt;: lbz     r0,21(r31)
0x100aeab4 &lt;mono_class_native_size+68&gt;: stw     r0,0(r30)
0x100aeab8 &lt;mono_class_native_size+72&gt;: lwz     r9,132(r31)
0x100aeabc &lt;mono_class_native_size+76&gt;: lwz     r3,0(r9)
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
0x100aeac0 &lt;mono_class_native_size+80&gt;: lwz     r0,36(r1)
0x100aeac4 &lt;mono_class_native_size+84&gt;: lwz     r29,20(r1)
0x100aeac8 &lt;mono_class_native_size+88&gt;: lwz     r30,24(r1)
0x100aeacc &lt;mono_class_native_size+92&gt;: lwz     r31,28(r1)
0x100aead0 &lt;mono_class_native_size+96&gt;: addi    r1,r1,32
0x100aead4 &lt;mono_class_native_size+100&gt;:        mtlr    r0
0x100aead8 &lt;mono_class_native_size+104&gt;:        blr
0x100aeadc &lt;mono_class_native_size+108&gt;:        bl      0x100ae480
&lt;mono_marshal_is_loading_type_info&gt;
0x100aeae0 &lt;mono_class_native_size+112&gt;:        cmpwi   cr7,r3,0
0x100aeae4 &lt;mono_class_native_size+116&gt;:        beq-    cr7,0x100aeafc
&lt;mono_class_native_size+140&gt;
0x100aeae8 &lt;mono_class_native_size+120&gt;:        cmpwi   cr7,r30,0
0x100aeaec &lt;mono_class_native_size+124&gt;:        li      r3,0
0x100aeaf0 &lt;mono_class_native_size+128&gt;:        beq+    cr7,0x100aeac0
&lt;mono_class_native_size+80&gt;
0x100aeaf4 &lt;mono_class_native_size+132&gt;:        stw     r29,0(r30)
0x100aeaf8 &lt;mono_class_native_size+136&gt;:        b       0x100aeac0
&lt;mono_class_native_size+80&gt;
0x100aeafc &lt;mono_class_native_size+140&gt;:        mr      r3,r31
0x100aeb00 &lt;mono_class_native_size+144&gt;:        bl      0x100ae550
&lt;mono_marshal_load_type_info&gt;
0x100aeb04 &lt;mono_class_native_size+148&gt;:        b       0x100aeaa8
&lt;mono_class_n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---q
Quit
(gdb) info reg r31
r31            0x103329e8       271788520
(gdb) info reg r9
r9             0x205de3f        33939007
(gdb)  

In this case klass-&gt;marshal_info contained a bad value which caused a sigsegv
on the reference to klass-&gt;marshal_info-&gt;native_size.

This is consistent to cases where mono_class_native_size() is trying to access
fields of struct MonoClass but in actuality was passed an instance of
MonoGenericClass.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="084041.html">[Mono-bugs] [Bug 463285] Probable JIT bug
</A></li>
	<LI>Next message: <A HREF="084017.html">[Mono-bugs] [Bug 463294] New: Verifier reports false positives for MS/ vbc compiled assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#84014">[ date ]</a>
              <a href="thread.html#84014">[ thread ]</a>
              <a href="subject.html#84014">[ subject ]</a>
              <a href="author.html#84014">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
