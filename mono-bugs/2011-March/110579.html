<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 683277] New: Mono finalizer has trouble exiting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20683277%5D%20New%3A%20Mono%20finalizer%20has%20trouble%20exiting&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="110577.html">
   <LINK REL="Next"  HREF="110583.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 683277] New: Mono finalizer has trouble exiting</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20683277%5D%20New%3A%20Mono%20finalizer%20has%20trouble%20exiting&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 683277] New: Mono finalizer has trouble exiting">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Mar 28 22:44:01 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="110577.html">[Mono-bugs] [Bug 683269] New: Unable to instantiate KeyContainerPermission class.
</A></li>
        <LI>Next message: <A HREF="110583.html">[Mono-bugs] [Bug 683277] Mono finalizer has trouble exiting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#110579">[ date ]</a>
              <a href="thread.html#110579">[ thread ]</a>
              <a href="subject.html#110579">[ subject ]</a>
              <a href="author.html#110579">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=683277">https://bugzilla.novell.com/show_bug.cgi?id=683277</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=683277#c0">https://bugzilla.novell.com/show_bug.cgi?id=683277#c0</A>


           Summary: Mono finalizer has trouble exiting
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.8.x
          Platform: x86
        OS/Version: Windows 7
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: GC
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">xocotl at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows NT 6.1; rv:2.0) Gecko/20100101
Firefox/4.0

I am running into the 'finalizer shutdown timed out' message after two seconds
of collecting. This wouldn't be a big deal on exit, except I encountered a PC
during testing which actually appears to be unable to terminate. Needless to
say, for that person, having to end task the program to exit is not pretty. So,
I'd like to fix this lockup for them... I am thinking of just killing the
process when they click exit as a workaround.

In any case, the stack trace from MSVC (I compiled with VC2008 to get the
trace, but this problem occurs with the ordinary runtime as well often -- 28
as well as 2.10...) is as follows:

[note, as far as Visual C++ is concerned, it's frozen at mono_get_lmf_addr..
however, I'm unclear as to how that got in between what's around it...]

--- Finalizer thread below ---
     ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">_KiFastSystemCallRet at 0</A>()     
     user32.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">_NtUserMoveWindow at 24</A>()  + 0xc bytes    
&gt;<i>	mono.dll!mono_get_lmf_addr()  Line 2382 + 0xe bytes	C
</I>     0426094f()    
     usp10.dll!UspFreeAnalysisMem()  + 0x40 bytes    
     usp10.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">_ScriptStringFree at 4</A>()  + 0x4f bytes    
     msvcr90d.dll!_free_dbg(void * pUserData=0x104ecffa, int
nBlockUse=35257924)  Line 1260 + 0xc bytes    C++
     mono.dll!monoeg_g_free(void * ptr=0x0423b330)  Line 36 + 0xc bytes    C
     mono.dll!mono_gc_run_finalize(void * obj=0x0423b330, void *
data=0x00000000)  Line 220 + 0x11 bytes    C
     mono.dll!finalize_domain_objects(DomainFinalizationReq * req=0x03f73ed8) 
Line 1012 + 0xb bytes    C
     mono.dll!finalizer_thread(void * unused=0x00000000)  Line 1069 + 0x9 bytes
   C
     mono.dll!start_wrapper(void * data=0x0135ce98)  Line 782 + 0x9 bytes    C
     mono.dll!thread_start(void * arg=0x0066cff8)  Line 531 + 0x10 bytes    C
     kernel32.dll!@<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">BaseThreadInitThunk at 12</A>()  + 0x12 bytes    
     ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">___RtlUserThreadStart at 8</A>()  + 0x27 bytes    
     ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">__RtlUserThreadStart at 8</A>()  + 0x1b bytes    

This seemed a bit of a strange stack trace to me, but maybe you will have more
knowledge about how it can skip about... as an aside,

?mono_pmip((void*)0x04220947)
0x02467998 &quot; System.Windows.Forms.XplatUIWin32:SetWindowPos
(intptr,int,int,int,int) + 0x1f (04220928 04220949) [00324E60 -
sabertooth.main.exe]&quot;

--- Shutdown thread below ---
&gt;<i>	mono.dll!mono_gc_cleanup()  Line 1135 + 0x18 bytes	C
</I>     mono.dll!mono_runtime_cleanup(_MonoDomain * domain=0x00444e60)  Line 355  
 C
     mono.dll!mini_cleanup(_MonoDomain * domain=0x00444e60)  Line 6387 + 0x9
bytes    C
     mono.dll!mono_main(int argc=4, char * * argv=0x014c3068)  Line 1868 + 0x9
bytes    C
     mono.exe!mono_main_with_options(int argc=4, char * * argv=0x014c3068) 
Line 66 + 0xd bytes    C
     mono.exe!main()  Line 87 + 0xd bytes    C
     mono.exe!__tmainCRTStartup()  Line 586 + 0x19 bytes    C
     mono.exe!mainCRTStartup()  Line 403    C
     kernel32.dll!@<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">BaseThreadInitThunk at 12</A>()  + 0x12 bytes    
     ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">___RtlUserThreadStart at 8</A>()  + 0x27 bytes    
     ntdll.dll!<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">__RtlUserThreadStart at 8</A>()  + 0x1b bytes    

mono_gc_cleanup here is where you'd expect it to be. A few lines up because I
had to add a while(1) { } to be able to pause it to get you the stack of the
other thread... if I assert a bit later I get interesting errors and am unable
to break.

Please let me know if there's any other information I can provide. I'm
uncertain whether this is a Windows Forms issue, a GC issue, somewhere in
between..?

Reproducible: Always

Steps to Reproduce:
1.
2.
3.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="110577.html">[Mono-bugs] [Bug 683269] New: Unable to instantiate KeyContainerPermission class.
</A></li>
	<LI>Next message: <A HREF="110583.html">[Mono-bugs] [Bug 683277] Mono finalizer has trouble exiting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#110579">[ date ]</a>
              <a href="thread.html#110579">[ thread ]</a>
              <a href="subject.html#110579">[ subject ]</a>
              <a href="author.html#110579">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
