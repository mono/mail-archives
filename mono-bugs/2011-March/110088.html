<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 679598] New: Apache+mod_mono, xsp or MonoFastCGI does not obey the &lt;httpHandlers/&gt;&lt;add path=&quot;anypathhereisbuggy&quot; /&gt;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20679598%5D%20New%3A%20Apache%2Bmod_mono%2C%0A%20xsp%20or%20MonoFastCGI%20does%20not%20obey%20the%20%3ChttpHandlers/%3E%3Cadd%0A%20path%3D%22anypathhereisbuggy%22%20/%3E&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="110087.html">
   <LINK REL="Next"  HREF="110135.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 679598] New: Apache+mod_mono, xsp or MonoFastCGI does not obey the &lt;httpHandlers/&gt;&lt;add path=&quot;anypathhereisbuggy&quot; /&gt;</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20679598%5D%20New%3A%20Apache%2Bmod_mono%2C%0A%20xsp%20or%20MonoFastCGI%20does%20not%20obey%20the%20%3ChttpHandlers/%3E%3Cadd%0A%20path%3D%22anypathhereisbuggy%22%20/%3E&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 679598] New: Apache+mod_mono, xsp or MonoFastCGI does not obey the &lt;httpHandlers/&gt;&lt;add path=&quot;anypathhereisbuggy&quot; /&gt;">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Mar 14 22:33:49 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="110087.html">[Mono-bugs] [Bug 664813] System.Web.Mvc.JsonResult.ExecuteResult no longer works, exception is thrown at System.Web.Script.Serialization.JavaScriptSerializer..ctor when application is compiled with dmcs (but still works with gmcs)
</A></li>
        <LI>Next message: <A HREF="110135.html">[Mono-bugs] [Bug 679598] Apache+mod_mono, xsp or MonoFastCGI does not obey the &lt;httpHandlers/&gt;&lt;add path=&quot;anypathhereisbuggy&quot; /&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#110088">[ date ]</a>
              <a href="thread.html#110088">[ thread ]</a>
              <a href="subject.html#110088">[ subject ]</a>
              <a href="author.html#110088">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=679598">https://bugzilla.novell.com/show_bug.cgi?id=679598</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=679598#c0">https://bugzilla.novell.com/show_bug.cgi?id=679598#c0</A>


           Summary: Apache+mod_mono, xsp or MonoFastCGI does not obey the
                    &lt;httpHandlers/&gt;&lt;add path=&quot;anypathhereisbuggy&quot; /&gt;
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.8.x
          Platform: Other
        OS/Version: RHEL 5
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: Sys.Web
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">demis.bellot at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.127 Safari/534.16

Basically after numerous integration tests the only path that works reliably is
the wildcard path &lt;add path=&quot;*&quot; /&gt;. Where all requests are passed to the target
handler.

I've found any other path to have some issues and does not behave as it does in
ASP.NET hosts on windows.

I've assembled a number of 'lightweight starter projects' with different
configurations that are subject to a series of integration tests.

The full source code for the 'starter projects' that are being tested are
available at:
<A HREF="https://github.com/ServiceStack/ServiceStack.Examples/tree/master/src/StarterTemplates">https://github.com/ServiceStack/ServiceStack.Examples/tree/master/src/StarterTemplates</A>

The full source code for the integration tests that generated the reports below
is available at:
<A HREF="https://github.com/ServiceStack/ServiceStack/blob/master/tests/MasterHost/ReportTests.cs">https://github.com/ServiceStack/ServiceStack/blob/master/tests/MasterHost/ReportTests.cs</A>

Here is the integration test report results for CentOS running on
Nginx/FastGGI, Apache+mod_mono, xsp2/xsp4 and ConsoleAppHost:
<A HREF="http://www.servicestack.net/testreports/2011-03-17_RunReports-Linux.htm">http://www.servicestack.net/testreports/2011-03-17_RunReports-Linux.htm</A>

for comparison here are the equivalent windows benchmarks:
<A HREF="http://www.servicestack.net/testreports/2011-03-09_RunReports-Windows.htm">http://www.servicestack.net/testreports/2011-03-09_RunReports-Windows.htm</A>

Summary:
The Web.Config's used in the started project is the result of the most
consistent experience I could find across Windows/.NET and Linux/MONO platforms
running as-is without any code or binary changes (my goal).

Problems:
1) The major bug that occurs in all MONO ASP.NET hosts using a custom handler
(e.g. /api) is that if the virtual host / application path (i.e.
/CustomPath/api ) does not start with the same name as registered &lt;httpHandler
/&gt;&lt;add path=&quot;api*&quot;/&gt; then for some strange reason (i.e. as these 2
configurations shouldn't be related), it fails to pass nested paths more than 1
level deep, e.g: 

<A HREF="http://servicestack.net/CustomPath40/api/hello">http://servicestack.net/CustomPath40/api/hello</A> - works
<A HREF="http://servicestack.net/CustomPath40/api/hello/world">http://servicestack.net/CustomPath40/api/hello/world</A> - does not work
<A HREF="http://servicestack.net/CustomPath40/api/hello/world/1/2/3">http://servicestack.net/CustomPath40/api/hello/world/1/2/3</A> - neither does any
nested part from here on in

By contrast if the virtual path started with the same name e.g. /ApiPath35 and
a &lt;httpHandler/&gt; of 'api*' then all requests below work as expected:
<A HREF="http://www.servicestack.net/ApiPath35/api/hello">http://www.servicestack.net/ApiPath35/api/hello</A>
<A HREF="http://www.servicestack.net/ApiPath35/api/hello/world">http://www.servicestack.net/ApiPath35/api/hello/world</A>
<A HREF="http://www.servicestack.net/ApiPath35/api/hello/world/1/2/3">http://www.servicestack.net/ApiPath35/api/hello/world/1/2/3</A>


2) It is hard to configure a default document for '/' without it being
automatically added to the request url and have it still be passed to the
registered handler. Ideally I would like /default.htm to be handled by Nginx or
Apache if it exists otherwise '/' gets passed to the &lt;httpHandler /&gt;


Reproducible: Always

Steps to Reproduce:
1. Eh, run the integration tests or call the urls:

<A HREF="http://servicestack.net/ApiPath35/api/">http://servicestack.net/ApiPath35/api/</A> - is running Nginx/FastCGI
<A HREF="http://api.servicestack.net/ApiPath35/api/">http://api.servicestack.net/ApiPath35/api/</A> - anything in the api.* sub domain
is running Apache+mod_mono

My Apache conf looks like this:

LoadModule mono_module /usr/lib/httpd/modules/mod_mono.so

&lt;VirtualHost *:80&gt;
        ServerName api.servicestack.net
        HostnameLookups Off
        UseCanonicalName On
        MonoPath default /opt/mono
        MonoServerPath default /opt/mono/bin/mod-mono-server2

    AddMonoApplications default
&quot;/ApiPath35:/home/mythz/src/ServiceStack.Examples/src/StarterTemplates/ApiPath35&quot;
    &lt;Location /ApiPath35&gt;
        MonoSetServerAlias default
                SetHandler mono
    &lt;/Location&gt;
..



Actual Results:  
404s mostly as a result of the request not being passed to the registered
&lt;httpHandler /&gt;

Expected Results:  
200 OK, which happens if the request makes it through to the &lt;httpHandler /&gt;

There are many differences in how Windows ASP.NET and MONO ASP.NET handles the
&lt;httpHandler /&gt;&lt;add path=&quot;*&quot;/&gt; that are inconsistent across win/linux
platforms. i.e. ASP.NET doesn't need a wild card e.g. path=&quot;api&quot; will allow all
/api/requests/from/here to get passed through to the httpHandler. At best MONO
requires path=&quot;api*&quot; and a strict matching of virtual path / app name with the
registered handler.

Feel free to email me on <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">demis.bellot at gmail.com</A> for any clarifications of this
bug.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>

























































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="110087.html">[Mono-bugs] [Bug 664813] System.Web.Mvc.JsonResult.ExecuteResult no longer works, exception is thrown at System.Web.Script.Serialization.JavaScriptSerializer..ctor when application is compiled with dmcs (but still works with gmcs)
</A></li>
	<LI>Next message: <A HREF="110135.html">[Mono-bugs] [Bug 679598] Apache+mod_mono, xsp or MonoFastCGI does not obey the &lt;httpHandlers/&gt;&lt;add path=&quot;anypathhereisbuggy&quot; /&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#110088">[ date ]</a>
              <a href="thread.html#110088">[ thread ]</a>
              <a href="subject.html#110088">[ subject ]</a>
              <a href="author.html#110088">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
