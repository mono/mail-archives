<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 680542] New: F# generic type example exposes problem in mono runtime
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20680542%5D%20New%3A%20F%23%20generic%20type%20example%20exposes%0A%20problem%20in%20mono%20runtime&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="110241.html">
   <LINK REL="Next"  HREF="110250.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 680542] New: F# generic type example exposes problem in mono runtime</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20680542%5D%20New%3A%20F%23%20generic%20type%20example%20exposes%0A%20problem%20in%20mono%20runtime&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 680542] New: F# generic type example exposes problem in mono runtime">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Mar 17 12:07:02 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="110241.html">[Mono-bugs] [Bug 655474] JavaScriptSerializer cannot serialize a	relative Uri
</A></li>
        <LI>Next message: <A HREF="110250.html">[Mono-bugs] [Bug 680542] F# generic type example exposes problem in	mono runtime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#110244">[ date ]</a>
              <a href="thread.html#110244">[ thread ]</a>
              <a href="subject.html#110244">[ subject ]</a>
              <a href="author.html#110244">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=680542">https://bugzilla.novell.com/show_bug.cgi?id=680542</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=680542#c0">https://bugzilla.novell.com/show_bug.cgi?id=680542#c0</A>


           Summary: F# generic type example exposes problem in mono
                    runtime
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.6.x
          Platform: x86-64
        OS/Version: Ubuntu
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: generics
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">wlrutledge at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Community User
           Blocker: ---


Description of Problem:
I was translating code from the book The Little MLer to F# in order to learn
F#.  I am using the Microsoft F# 2.0.0.0 November release on Ubuntu.  The
sample code was compiled by the fsi.exe interpreter, but trying a simple
example causes the mono runtime to die.

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">warren at xenophon</A>:~$ mono --version
Mono JIT compiler version 2.6.7 (Debian 2.6.7-3ubuntu1)
Copyright (C) 2002-2010 Novell, Inc and Contributors. www.mono-project.com
    TLS:           __thread
    GC:            Included Boehm (with typed GC and Parallel Mark)
    SIGSEGV:       altstack
    Notifications: epoll
    Architecture:  amd64
    Disabled:      none


Steps to reproduce the problem:
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">warren at xenophon</A>:~$ fsi.exe

Microsoft (R) F# 2.0 Interactive build 2.0.0.0
Copyright (c) Microsoft Corporation. All Rights Reserved.

For help type #help;;

&gt;<i> #light
</I>- 
- 
- 
- type shish_kebab =
- 
-     Skewer
- 
-     | Onion of shish_kebab
- 
-     | Lamb of shish_kebab
- 
-     | Tomato of shish_kebab
- 
- 
- 
- let rec only_onions =
- 
-     function
- 
-         Skewer -&gt; true
- 
-         | Onion(x) -&gt; only_onions(x)
- 
-         | Lamb(x) -&gt; false
- 
-         | Tomato(x) -&gt; false
- 
- 
- 
- let rec is_vegetarian =
- 
-     function
- 
-         Skewer -&gt; true
- 
-         | Onion(x) -&gt; is_vegetarian(x)
- 
-         | Lamb(x) -&gt; false
- 
-         | Tomato(x) -&gt; is_vegetarian(x)
- 
- 
- 
- type 'a shish =
- 
-     Bottom of 'a
- 
-     | Onion of 'a shish
- 
-     | Lamb of 'a shish
- 
-     | Tomato of 'a shish
- 
- 
- 
- type rod =
- 
-     Dagger
- 
-     | Fork
- 
-     | Sword
- 
- 
- 
- type plate =
- 
-     Gold_plate
- 
-     | Sliver_plate
- 
-     | Brass_plate
- 
- 
- 
- let rec is_veggie =
- 
-     function
- 
-         Bottom(x) -&gt; true
- 
-         | Onion(x) -&gt; is_veggie(x)
- 
-         | Lamb(x) -&gt; false
- 
-         | Tomato(x) -&gt; is_veggie(x)
- 
- 
- 
- let rec what_bottom =
- 
-     function
- 
-         Bottom(x) -&gt; x
- 
-         | Onion(x) -&gt; what_bottom(x)
- 
-         | Lamb(x) -&gt; what_bottom(x)
- 
-         | Tomato(x) -&gt; what_bottom(x)
- 
- ;;

type shish_kebab =
  | Skewer
  | Onion of shish_kebab
  | Lamb of shish_kebab
  | Tomato of shish_kebab
val only_onions : shish_kebab -&gt; bool
val is_vegetarian : shish_kebab -&gt; bool
type 'a shish =
  | Bottom of 'a
  | Onion of 'a shish
  | Lamb of 'a shish
  | Tomato of 'a shish
type rod =
  | Dagger
  | Fork
  | Sword
type plate =
  | Gold_plate
  | Sliver_plate
  | Brass_plate
val is_veggie : 'a shish -&gt; bool
val what_bottom : 'a shish -&gt; 'a

&gt;<i> (Onion(Bottom(Dagger))) |&gt; what_bottom;;
</I>**
ERROR:mini-trampolines.c:444:mono_magic_trampoline: assertion failed:
(this_argument-&gt;vtable-&gt;klass-&gt;inited)
Stacktrace:

  at FSI_0002.what_bottom&lt;object&gt; (FSI_0002/shish`1&lt;object&gt;) &lt;0xffffffff&gt;
  at FSI_0002.what_bottom&lt;object&gt; (FSI_0002/shish`1&lt;object&gt;) &lt;0x00030&gt;
  at &lt;StartupCode$FSI_0003&gt;.$FSI_0003.main@ () &lt;0x00047&gt;
  at (wrapper runtime-invoke) object.runtime_invoke_void
(object,intptr,intptr,intptr) &lt;0x00049&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0x00068&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0x00068&gt;
  at System.Reflection.MonoMethod.Invoke
(object,System.Reflection.BindingFlags,System.Reflection.Binder,object[],System.Globalization.CultureInfo)
&lt;0x00187&gt;
  at System.MonoType.InvokeMember
(string,System.Reflection.BindingFlags,System.Reflection.Binder,object,object[],System.Reflection.ParameterModifier[],System.Globalization.CultureInfo,string[])
&lt;0x0064b&gt;
  at System.Reflection.Emit.TypeBuilder.InvokeMember
(string,System.Reflection.BindingFlags,System.Reflection.Binder,object,object[],System.Reflection.ParameterModifier[],System.Globalization.CultureInfo,string[])
&lt;0x0006c&gt;
  at System.Type.InvokeMember
(string,System.Reflection.BindingFlags,System.Reflection.Binder,object,object[],System.Globalization.CultureInfo)
&lt;0x0005d&gt;
  at
Microsoft.FSharp.Compiler.AbstractIL.RuntimeWriter/<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">execEntryPtFun at 1730-1.Invoke</A>
(Microsoft.FSharp.Core.Unit) &lt;0x0009b&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell/<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">clo at 918-32.Invoke</A>
(Microsoft.FSharp.Core.FSharpFunc`2&lt;Microsoft.FSharp.Core.Unit,
Microsoft.FSharp.Core.FSharpOption`1&lt;System.Exception&gt;&gt;) &lt;0x00025&gt;
  at Microsoft.FSharp.Primitives.Basics.List.iter&lt;object&gt;
(Microsoft.FSharp.Core.FSharpFunc`2&lt;object,
Microsoft.FSharp.Core.Unit&gt;,Microsoft.FSharp.Collections.FSharpList`1&lt;object&gt;)
&lt;0x0004c&gt;
  at Microsoft.FSharp.Collections.ListModule.Iterate&lt;object&gt;
(Microsoft.FSharp.Core.FSharpFunc`2&lt;object,
Microsoft.FSharp.Core.Unit&gt;,Microsoft.FSharp.Collections.FSharpList`1&lt;object&gt;)
&lt;0x0002f&gt;
  at <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Microsoft.FSharp.Compiler.Interactive.Shell.arg10 at 917</A>
(Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompiler,Microsoft.FSharp.Collections.FSharpList`1&lt;Microsoft.FSharp.Core.FSharpFunc`2&lt;Microsoft.FSharp.Core.Unit,
Microsoft.FSharp.Core.FSharpOption`1&lt;System.Exception&gt;&gt;&gt;,Microsoft.FSharp.Core.Unit)
&lt;0x00033&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompiler.ProcessInputs&lt;int&gt;
(int,Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState,Microsoft.FSharp.Collections.FSharpList`1&lt;Microsoft.FSharp.Compiler.Ast/Input&gt;,bool,bool,bool,Microsoft.FSharp.Collections.FSharpList`1&lt;Microsoft.FSharp.Compiler.Ast/ident&gt;)
&lt;0x00a9b&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompiler.EvalDefns
(Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState,bool,bool,Microsoft.FSharp.Collections.FSharpList`1&lt;Microsoft.FSharp.Compiler.Ast/SynModuleImplDecl&gt;)
&lt;0x001cb&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompiler.EvalExpr
(Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState,Microsoft.FSharp.Compiler.Ast/SynExpr)
&lt;0x002b7&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell/<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">clo at 1571-39.Invoke</A>
(Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState) &lt;0x011f7&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/FsiInteractionProcessor.InteractiveCatch&lt;object&gt;
(Microsoft.FSharp.Core.FSharpFunc`2&lt;object, System.Tuple`2&lt;object,
Microsoft.FSharp.Compiler.Interactive.Shell/FsiInteractionStepStatus&gt;&gt;,object)
&lt;0x0004a&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/FsiInteractionProcessor.ExecInteraction
(bool,Microsoft.FSharp.Compiler.Build/TcConfig,Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState,Microsoft.FSharp.Compiler.Ast/Interaction)
&lt;0x00067&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/FsiInteractionProcessor.ExecInteractions
(bool,Microsoft.FSharp.Compiler.Build/TcConfig,Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState,Microsoft.FSharp.Core.FSharpOption`1&lt;Microsoft.FSharp.Compiler.Ast/Interaction&gt;)
&lt;0x0062b&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/FsiInteractionProcessor.MainThreadProcessParsedInteraction
(bool,Microsoft.FSharp.Core.FSharpOption`1&lt;Microsoft.FSharp.Compiler.Ast/Interaction&gt;,Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState)
&lt;0x000e7&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell/<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">res at 1735.Invoke</A>
(Microsoft.FSharp.Compiler.Interactive.Shell/FsiDynamicCompilerState) &lt;0x00027&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">runCodeOnMainThread at 1937-2</A>&lt;object&gt;.Invoke
(Microsoft.FSharp.Core.Unit) &lt;0x0003f&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Microsoft-FSharp-Compiler-Interactive-IEventLoop-Invoke at 1840</A>&lt;object&gt;.Invoke
() &lt;0x00045&gt;
  at (wrapper runtime-invoke) object.runtime_invoke_void__this__
(object,intptr,intptr,intptr) &lt;0x00051&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0x00068&gt;
  at (wrapper managed-to-native) System.Reflection.MonoMethod.InternalInvoke
(object,object[],System.Exception&amp;) &lt;0x00068&gt;
  at System.Reflection.MonoMethod.Invoke
(object,System.Reflection.BindingFlags,System.Reflection.Binder,object[],System.Globalization.CultureInfo)
&lt;0x00187&gt;
  at System.Reflection.MethodBase.Invoke (object,object[]) &lt;0x0002d&gt;
  at System.Delegate.DynamicInvokeImpl (object[]) &lt;0x0018b&gt;
  at System.MulticastDelegate.DynamicInvokeImpl (object[]) &lt;0x0003b&gt;
  at System.Delegate.DynamicInvoke (object[]) &lt;0x0001b&gt;
  at System.Windows.Forms.XplatUIDriverSupport.ExecutionCallback (object)
&lt;0x0006b&gt;
  at System.Security.SecurityContext.Run
(System.Security.SecurityContext,System.Threading.ContextCallback,object)
&lt;0x0010e&gt;
  at System.Threading.ExecutionContext.Run
(System.Threading.ExecutionContext,System.Threading.ContextCallback,object)
&lt;0x0003f&gt;
  at System.Windows.Forms.XplatUIDriverSupport.ExecuteClientMessage
(System.Runtime.InteropServices.GCHandle) &lt;0x0009b&gt;
  at System.Windows.Forms.XplatUIX11.GetMessage
(object,System.Windows.Forms.MSG&amp;,intptr,int,int) &lt;0x030ef&gt;
  at System.Windows.Forms.XplatUI.GetMessage
(object,System.Windows.Forms.MSG&amp;,intptr,int,int) &lt;0x0004f&gt;
  at System.Windows.Forms.Application.RunLoop
(bool,System.Windows.Forms.ApplicationContext) &lt;0x00e4b&gt;
  at System.Windows.Forms.Application.Run
(System.Windows.Forms.ApplicationContext) &lt;0x0005b&gt;
  at System.Windows.Forms.Application.Run () &lt;0x0002b&gt;
  at
Microsoft.FSharp.Compiler.Interactive.Shell/WinFormsEventLoop.Microsoft-FSharp-Compiler-Interactive-IEventLoop-Run
() &lt;0x0005b&gt;
  at <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Microsoft.FSharp.Compiler.Interactive.Shell.runLoop at 1983</A>
(Microsoft.FSharp.Compiler.Interactive.Shell/FsiConsoleOutput,Microsoft.FSharp.Core.Unit)
&lt;0x001db&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell.DriveFsiEventLoop
(Microsoft.FSharp.Compiler.Interactive.Shell/FsiConsoleOutput) &lt;0x0000f&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell.main () &lt;0x01b2f&gt;
  at Microsoft.FSharp.Compiler.Interactive.Shell.MainMain (string[]) &lt;0x0000b&gt;
  at (wrapper runtime-invoke) &lt;Module&gt;.runtime_invoke_int_object
(object,intptr,intptr,intptr) &lt;0x00054&gt;

Native stacktrace:

    /usr/bin/cli() [0x48563b]
    /lib/libpthread.so.0(+0xfb40) [0x7f792995eb40]
    /lib/libc.so.6(gsignal+0x35) [0x7f792937cba5]
    /lib/libc.so.6(abort+0x180) [0x7f79293806b0]
    /lib/libglib-2.0.so.0(g_assertion_message+0x144) [0x7f7929fde804]
    /lib/libglib-2.0.so.0(+0x66da0) [0x7f7929fdeda0]
    /usr/bin/cli() [0x489d26]
    [0x40abf168]

Debug info from gdb:

Could not attach to process.  If your uid matches the uid of the target
process, check the setting of /proc/sys/kernel/yama/ptrace_scope, or try
again as the root user.  For more details, see /etc/sysctl.d/10-ptrace.conf
ptrace: Operation not permitted.

=================================================================
Got a SIGABRT while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries 
used by your application.
=================================================================

Aborted
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">warren at xenophon</A>:~$ 



Actual Results:


Expected Results:
This is what you get on Windows 7 running the same code in Visual Studio 2010.

val it : rod = Dagger

How often does this happen? 
Every time

Additional Information:

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="110241.html">[Mono-bugs] [Bug 655474] JavaScriptSerializer cannot serialize a	relative Uri
</A></li>
	<LI>Next message: <A HREF="110250.html">[Mono-bugs] [Bug 680542] F# generic type example exposes problem in	mono runtime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#110244">[ date ]</a>
              <a href="thread.html#110244">[ thread ]</a>
              <a href="subject.html#110244">[ subject ]</a>
              <a href="author.html#110244">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
