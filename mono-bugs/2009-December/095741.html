<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 560191] abort in mono_method_get_header while JITting a verified method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20560191%5D%20abort%20in%20mono_method_get_header%20while%0A%20JITting%20a%20verified%20method&In-Reply-To=bug-560191-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="095568.html">
   <LINK REL="Next"  HREF="095742.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 560191] abort in mono_method_get_header while JITting a verified method</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20560191%5D%20abort%20in%20mono_method_get_header%20while%0A%20JITting%20a%20verified%20method&In-Reply-To=bug-560191-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 560191] abort in mono_method_get_header while JITting a verified method">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Dec 14 13:41:39 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="095568.html">[Mono-bugs] [Bug 560191] abort in mono_method_get_header while JITting a verified method
</A></li>
        <LI>Next message: <A HREF="095742.html">[Mono-bugs] [Bug 560191] abort in mono_method_get_header while JITting a verified method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#95741">[ date ]</a>
              <a href="thread.html#95741">[ thread ]</a>
              <a href="subject.html#95741">[ subject ]</a>
              <a href="author.html#95741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=560191">http://bugzilla.novell.com/show_bug.cgi?id=560191</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=560191#c1">http://bugzilla.novell.com/show_bug.cgi?id=560191#c1</A>


--- Comment #1 from Sebastien Pouliot &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">spouliot at novell.com</A>&gt; 2009-12-14 18:41:38 UTC ---
Moving the assert after the verifier check (make sense since 'loc' is not used
to call the verifier) fix this test case. 

However it would make sense to return NULL instead of the assert (just like
it's done if the verifier fails). Actually the above assert (for the table)
could be changed to return NULL too.

This is one of the most common abort when --compile-all is used, so I'll try
this patch on my next run (tonight) to see if it solve &quot;all&quot; the cases.

Index: metadata/loader.c
===================================================================
--- metadata/loader.c    (revision 148393)
+++ metadata/loader.c    (working copy)
@@ -2249,13 +2249,13 @@
     idx = mono_metadata_token_index (method-&gt;token);
     img = method-&gt;klass-&gt;image;
     rva = mono_metadata_decode_row_col (&amp;img-&gt;tables [MONO_TABLE_METHOD], idx
- 1, MONO_METHOD_RVA);
-    loc = mono_image_rva_map (img, rva);

-    g_assert (loc);
-
     if (!mono_verifier_verify_method_header (img, rva, NULL))
         return NULL;

+    loc = mono_image_rva_map (img, rva);
+    g_assert (loc);
+
     header = mono_metadata_parse_mh_full (img,
mono_method_get_generic_container (method), loc);

     mono_loader_lock ();

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="095568.html">[Mono-bugs] [Bug 560191] abort in mono_method_get_header while JITting a verified method
</A></li>
	<LI>Next message: <A HREF="095742.html">[Mono-bugs] [Bug 560191] abort in mono_method_get_header while JITting a verified method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#95741">[ date ]</a>
              <a href="thread.html#95741">[ thread ]</a>
              <a href="subject.html#95741">[ subject ]</a>
              <a href="author.html#95741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
