<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 559987] New: Can't use XDocument as a node-set	source in XSLT
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20559987%5D%20New%3A%20Can%27t%20use%20XDocument%20as%20a%20node-set%0A%09source%20in%20XSLT&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="095402.html">
   <LINK REL="Next"  HREF="095405.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 559987] New: Can't use XDocument as a node-set	source in XSLT</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20559987%5D%20New%3A%20Can%27t%20use%20XDocument%20as%20a%20node-set%0A%09source%20in%20XSLT&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 559987] New: Can't use XDocument as a node-set	source in XSLT">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Dec  2 12:26:21 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="095402.html">[Mono-bugs] [Bug 555016] Problem compiling mono 2.4.2.3
</A></li>
        <LI>Next message: <A HREF="095405.html">[Mono-bugs] [Bug 559990] New: Microsoft.Build.BuildEngine.Engine.UnloadAllProjects() throws an exception when invoked with 1 or more projects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#95404">[ date ]</a>
              <a href="thread.html#95404">[ thread ]</a>
              <a href="subject.html#95404">[ subject ]</a>
              <a href="author.html#95404">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=559987">http://bugzilla.novell.com/show_bug.cgi?id=559987</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=559987#c0">http://bugzilla.novell.com/show_bug.cgi?id=559987#c0</A>


           Summary: Can't use XDocument as a node-set source in XSLT
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: x86-64
        OS/Version: openSUSE 11.2
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.XML
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jpryor at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


(This is related to <A HREF="https://bugzilla.novell.com/show_bug.cgi?id=559957,">https://bugzilla.novell.com/show_bug.cgi?id=559957,</A> but
with an XDocument instead of an XmlDocument.)

If you use an XPathNavigator backed by an XDocument (instead of an
XmlDocument), the XSLT doesn't work.

Consider:

  using System;
  using System.IO;
  using System.Xml;
  using System.Xml.Linq;
  using System.Xml.XPath;
  using System.Xml.Xsl;

  class Test {
    public static void Main ()
    {
      string xsl =
  @&quot;&lt;xsl:stylesheet version='1.0' 
      exclude-result-prefixes='msxsl'
      xmlns:xsl='<A HREF="http://www.w3.org/1999/XSL/Transform'">http://www.w3.org/1999/XSL/Transform'</A>
      xmlns:msxsl='urn:schemas-microsoft-com:xslt'
      &gt;
    &lt;xsl:param name='Index' /&gt;
    &lt;xsl:template match='/'&gt;
      &lt;root&gt;
      &lt;xsl:variable name='t'&gt;
        &lt;xsl:call-template name='get-bar'&gt;
          &lt;xsl:with-param name='type' select=&quot;&quot;'Mono.DocTest.Color'&quot;&quot; /&gt;
        &lt;/xsl:call-template&gt;
      &lt;/xsl:variable&gt;
      &lt;xsl:value-of select='msxsl:node-set($t)/Type/@Name' /&gt;
      &lt;/root&gt;
    &lt;/xsl:template&gt;
    &lt;xsl:template name='get-bar'&gt;
      &lt;xsl:param name='type' /&gt;
      &lt;xsl:for-each select='$Index/Types/Namespace/Type'&gt;
        &lt;xsl:variable name='nsp'&gt;
          &lt;xsl:choose&gt;
            &lt;xsl:when test='string-length (parent::Namespace/@Name) = 0' /&gt;
            &lt;xsl:otherwise&gt;
              &lt;xsl:value-of select='parent::Namespace/@Name' /&gt;
              &lt;xsl:text&gt;.&lt;/xsl:text&gt;
            &lt;/xsl:otherwise&gt;
          &lt;/xsl:choose&gt;
        &lt;/xsl:variable&gt;
        &lt;xsl:if test=&quot;&quot;concat($nsp, translate(@Name, '+', '.')) = $type&quot;&quot;&gt;
          &lt;Type Name='{@Name}' Namespace='{parent::Namespace/@Name}' /&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:for-each&gt;
    &lt;/xsl:template&gt;
  &lt;/xsl:stylesheet&gt;&quot;;
      var overview = new XDocument (
          new XElement (&quot;Overview&quot;,
            new XElement (&quot;Types&quot;,
              new XElement (&quot;Namespace&quot;, new XAttribute (&quot;Name&quot;,
&quot;Mono.DocTest&quot;),
                new XElement (&quot;Type&quot;, new XAttribute (&quot;Name&quot;, &quot;Color&quot;), new
XAttribute (&quot;Kind&quot;, &quot;Enumeration&quot;))))));
      var args = new XsltArgumentList ();
      args.AddParam (&quot;Index&quot;, &quot;&quot;, overview.CreateNavigator ());
      var t = new XslCompiledTransform ();
      t.Load (new XPathDocument (new StringReader (xsl)));
      t.Transform (
          new XPathDocument (
            new XmlTextReader (
              new StringReader (
                &quot;&lt;root&gt;&lt;foo attr='A'/&gt;&lt;foo attr='B'/&gt;&lt;foo
attr='C'/&gt;&lt;/root&gt;&quot;))),
          args,
          Console.Out);
      Console.WriteLine();
    }
  }

The above source differs from
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=559957">https://bugzilla.novell.com/show_bug.cgi?id=559957</A> in two ways:

1. The XPath expression is $Index/Types/Namespace/Type (i.e. the buggy Mono
behavior which should be replaced with $Index/Overview/Types/Namespace/Type for
NET use)

2. We're using an XDocument instead of an XmlDocument to provide the
XPathNavigator.

The problem is the output:

  &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;root&gt;&lt;/root&gt;

It should be '&lt;root&gt;Color&lt;/root&gt;'; if we fix the XPath expression on line 30
(in accordance with #559957), .NET generates:

   &lt;?xml version=&quot;1.0&quot; encoding=&quot;IBM437&quot;?&gt;&lt;root&gt;Color&lt;/root&gt;

In fact, I can't find any way to get an XDocument-backed XPathNavigator to
actually generate correct output with this app.

Worst of all is if I use the workaround listed in #559957 (change line 30 to
select='$Index//Type'), it crashes with a NullReferenceException:

$ gmcs eno.cs -r:System.Xml.Linq &amp;&amp; mono eno.exe
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;root
Unhandled Exception: System.NullReferenceException: Object reference not set to
an instance of an object
  at System.Xml.Linq.XNodeNavigator.get_NodeType () [0x00000] in &lt;filename
unknown&gt;:0 
  at System.Xml.XPath.NodeNameTest.Match (IXmlNamespaceResolver nsm,
System.Xml.XPath.XPathNavigator nav) [0x00000] in &lt;filename unknown&gt;:0 
  at System.Xml.XPath.AxisIterator.MoveNextCore () [0x00000] in &lt;filename
unknown&gt;:0 
  at System.Xml.XPath.BaseIterator.MoveNext () [0x00000] in &lt;filename
unknown&gt;:0 
  at System.Xml.XPath.SlashIterator.MoveNextCore () [0x00000] in &lt;filename
unknown&gt;:0 
  at System.Xml.XPath.BaseIterator.MoveNext () [0x00000] in &lt;filename
unknown&gt;:0 
  at System.Xml.XPath.SortedIterator..ctor (System.Xml.XPath.BaseIterator iter)
[0x00000] in &lt;filename unknown&gt;:0 
  at System.Xml.XPath.ExprSLASH.Evaluate (System.Xml.XPath.BaseIterator iter)
[0x00000] in &lt;filename unknown&gt;:0 
  at System.Xml.XPath.Expression.EvaluateNodeSet (System.Xml.XPath.BaseIterator
iter) [0x00000] in &lt;filename unknown&gt;:0 
  at System.Xml.XPath.CompiledExpression.EvaluateNodeSet
(System.Xml.XPath.BaseIterator iter) [0x00000] in &lt;filename unknown&gt;:0 
  at System.Xml.XPath.XPathNavigator.Select (System.Xml.XPath.XPathExpression
expr, IXmlNamespaceResolver ctx) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTransformProcessor.Select
(System.Xml.XPath.XPathExpression expr) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslForEach.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTemplate.EvaluateCore (Mono.Xml.Xsl.XslTransformProcessor
p, System.Collections.Hashtable withParams) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTemplate.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p,
System.Collections.Hashtable withParams) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTransformProcessor.CallTemplate
(System.Xml.XmlQualifiedName name, System.Collections.ArrayList withParams)
[0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslCallTemplate.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslVariableInformation.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslLocalVariable.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslLiteralElement.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
(Mono.Xml.Xsl.XslTransformProcessor p) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTemplate.EvaluateCore (Mono.Xml.Xsl.XslTransformProcessor
p, System.Collections.Hashtable withParams) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTemplate.Evaluate (Mono.Xml.Xsl.XslTransformProcessor p,
System.Collections.Hashtable withParams) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTransformProcessor.ApplyTemplates
(System.Xml.XPath.XPathNodeIterator nodes, System.Xml.XmlQualifiedName mode,
System.Collections.ArrayList withParams) [0x00000] in &lt;filename unknown&gt;:0 
  at Mono.Xml.Xsl.XslTransformProcessor.Process
(System.Xml.XPath.XPathNavigator root, Mono.Xml.Xsl.Outputter outputtter,
System.Xml.Xsl.XsltArgumentList args, System.Xml.XmlResolver resolver)
[0x00000] in &lt;filename unknown&gt;:0 
  at System.Xml.Xsl.XslCompiledTransform.Transform
(System.Xml.XPath.XPathNavigator input, System.Xml.Xsl.XsltArgumentList args,
System.IO.TextWriter output) [0x00000] in &lt;filename unknown&gt;:0 
  at System.Xml.Xsl.XslCompiledTransform.Transform (IXPathNavigable input,
System.Xml.Xsl.XsltArgumentList args, System.IO.TextWriter output) [0x00000] in
&lt;filename unknown&gt;:0 
  at Test.Main () [0x00000] in &lt;filename unknown&gt;:0 

Apparently XLinq + XSLT == FAIL at the moment.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="095402.html">[Mono-bugs] [Bug 555016] Problem compiling mono 2.4.2.3
</A></li>
	<LI>Next message: <A HREF="095405.html">[Mono-bugs] [Bug 559990] New: Microsoft.Build.BuildEngine.Engine.UnloadAllProjects() throws an exception when invoked with 1 or more projects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#95404">[ date ]</a>
              <a href="thread.html#95404">[ thread ]</a>
              <a href="subject.html#95404">[ subject ]</a>
              <a href="author.html#95404">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
