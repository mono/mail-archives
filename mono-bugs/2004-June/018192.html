<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 59948][Nor] Changed - SqlDataAdapter.FillSchema on SQLServer 2000
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="018191.html">
   <LINK REL="Next"  HREF="018193.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 59948][Nor] Changed - SqlDataAdapter.FillSchema on SQLServer 2000
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 59948][Nor] Changed - SqlDataAdapter.FillSchema on SQLServer 2000">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Wed, 30 Jun 2004 01:16:44 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="018191.html">[Mono-bugs] [Bug 59946][Maj] Changed - Unexpected Exception in SqlDataAdapter.Update(DataTable)
</A></li>
        <LI> Next message: <A HREF="018193.html">[Mono-bugs] [Bug 60915][Wis] New - File.Move is inconsistent with the ms.net version
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18192">[ date ]</a>
              <a href="thread.html#18192">[ thread ]</a>
              <a href="subject.html#18192">[ subject ]</a>
              <a href="author.html#18192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:sumadevi@novell.com.">sumadevi@novell.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=59948">http://bugzilla.ximian.com/show_bug.cgi?id=59948</A>

--- shadow/59948	2004-06-23 21:57:59.000000000 -0400
+++ shadow/59948.tmp.10817	2004-06-30 01:16:44.000000000 -0400
@@ -1,13 +1,13 @@
 Bug#: 59948
 Product: Mono: Class Libraries
 Version: unspecified
 OS: All
 OS Details: 
-Status: NEW   
-Resolution: 
+Status: RESOLVED   
+Resolution: FIXED
 Severity: 120 Three weeks
 Priority: Normal
 Component: Sys.Data.SqlClient
 AssignedTo: <A HREF="mailto:sumadevi@novell.com">sumadevi@novell.com</A>                            
 ReportedBy: <A HREF="mailto:uballestrazzi@igconsulting.it">uballestrazzi@igconsulting.it</A>               
 QAContact: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>
@@ -23,6 +23,86 @@
 Reading the source code it seems that SqlCommand.ExecuteReader
 (CommandBehaviour) ignores CommandBehaviour parameter (it reads the 
 property not the parameter passed to the function).
 
 Fixing this Mono.Data.Tds retrieves the table name but it's not used 
 (it's just put in the TableNames array)
+
+------- Additional Comments From <A HREF="mailto:sumadevi@novell.com">sumadevi@novell.com</A>  2004-06-30 01:16 -------
+There were 2 problems.
+1. The commandBehavior parameter passed to the SqlCommand.Execute was
+not taken into consideration
+2. The Tds packet handling was not handling TdsPacketSubType.TableName
+
+Test Program used to check is below.
+using System;
+
+using System.Data;
+
+using System.Data.SqlClient;
+
+
+
+namespace MonoTests.System.Data
+
+{
+
+	class SqlDataReaderTest
+
+	{
+
+                public static void Main(string[] args)
+
+                {
+
+					String connectionString = null;
+
+					SqlConnection con;
+
+					SqlCommand cmd;
+
+					SqlDataReader reader;
+
+
+
+					//Fill the conenction string for SQL Server
+
+					    connectionString = &quot;Server=164.99.168.131;&quot; +
+
+                                                &quot;Database=Northwind;&quot; +
+
+                                                &quot;User ID=sa;&quot; +
+						&quot;Password=novell&quot;;
+					con = new SqlConnection(connectionString);
+
+					Console.WriteLine (&quot;Opening Connection...&quot;);
+					con.Open();
+		new SqlDataReaderTest().test59946(con);
+					con.Close();
+				
+
+                }
+
+
+		private void test59948(SqlConnection con)
+		{
+			string sql = &quot;select * from Region;&quot;;
+			SqlCommand c = con.CreateCommand();
+			c.CommandText = sql;
+			SqlDataReader dr =
+c.ExecuteReader(CommandBehavior.KeyInfo|CommandBehavior.SchemaOnly);
+			DataTable schema = dr.GetSchemaTable();
+			
+			foreach (DataColumn col in schema.Columns)
+				Console.Write(col.ColumnName+' ');
+			Console.WriteLine();
+			foreach (DataRow r in schema.Rows)
+			{
+				foreach (DataColumn col in schema.Columns)
+					Console.Write(r[col].ToString()+' ');
+				Console.WriteLine();
+			}	
+		
+		}
+
+
+Fix checked into CVS

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="018191.html">[Mono-bugs] [Bug 59946][Maj] Changed - Unexpected Exception in SqlDataAdapter.Update(DataTable)
</A></li>
	<LI> Next message: <A HREF="018193.html">[Mono-bugs] [Bug 60915][Wis] New - File.Move is inconsistent with the ms.net version
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18192">[ date ]</a>
              <a href="thread.html#18192">[ thread ]</a>
              <a href="subject.html#18192">[ subject ]</a>
              <a href="author.html#18192">[ author ]</a>
         </LI>
       </UL>
</body></html>
