<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 60811][Cri] New - Asynchronous Socket Callbacks dont work.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="018112.html">
   <LINK REL="Next"  HREF="018114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 60811][Cri] New - Asynchronous Socket Callbacks dont work.
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 60811][Cri] New - Asynchronous Socket Callbacks dont work.">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Sun, 27 Jun 2004 20:45:05 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="018112.html">[Mono-bugs] [Bug 60742][Min] Changed - DataSet Xml Schema Inference bug on MONO
</A></li>
        <LI> Next message: <A HREF="018114.html">[Mono-bugs] [Bug 60812][Cos] New - &quot;neutral&quot; culture info causes exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18113">[ date ]</a>
              <a href="thread.html#18113">[ thread ]</a>
              <a href="subject.html#18113">[ subject ]</a>
              <a href="author.html#18113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:draek@shaw.ca.">draek@shaw.ca.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=60811">http://bugzilla.ximian.com/show_bug.cgi?id=60811</A>

--- shadow/60811	2004-06-27 20:45:05.000000000 -0400
+++ shadow/60811.tmp.5414	2004-06-27 20:45:05.000000000 -0400
@@ -0,0 +1,146 @@
+Bug#: 60811
+Product: Mono: Class Libraries
+Version: unspecified
+OS: 
+OS Details: Fedora Core 2
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Critical
+Component: System
+AssignedTo: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>                            
+ReportedBy: <A HREF="mailto:draek@shaw.ca">draek@shaw.ca</A>               
+QAContact: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: Asynchronous Socket Callbacks dont work.
+
+Description of Problem:
+
+Since upgrading to RC1 of Mono, I am no longer receiving Asynchronous
+callbacks from Socket objects. Either the sockets are no longer connecting
+to where they should, or the callbacks arent being called.
+
+Unfortunately I'm still new to the system, and I used a new GTK# example to
+show you what happens, this is my window class, you just need to create it
+in a new application main class to run it. the constructor will create the
+socket.
+
+Code Example that reproduces the problem:
+
+using System;
+using System.Net;
+using System.Net.Sockets;
+using Gtk;
+
+public class MyWindow : Window {
+	private AsyncCallback m_pCallbackConnectMethod;
+	private AsyncCallback pCallbackConnectMethod { get { return
+m_pCallbackConnectMethod; } set { m_pCallbackConnectMethod = value; } }
+	
+	private System.Net.Sockets.Socket m_objClientSocket;
+
+	public System.Net.Sockets.Socket objClientSocket { get { return
+m_objClientSocket; } set { m_objClientSocket = value; } }
+	
+	private IPEndPoint m_objEndPoint;
+	public IPEndPoint objEndPoint { get { return m_objEndPoint; } set {
+m_objEndPoint = value; } }
+	
+	public MyWindow () : base (&quot;MyWindow&quot;)
+	{
+		this.pCallbackConnectMethod = new AsyncCallback(ConnectComplete);
+		this.SetDefaultSize (400, 300);
+		this.DeleteEvent += new DeleteEventHandler (OnMyWindowDelete);
+		this.ShowAll ();
+		this.Connect();
+	}
+	
+	public void Connect() {	
+		Console.WriteLine(&quot;Connecting to MSN service...&quot;);
+		
+
+		if(this.objClientSocket == null) {
+			// Create the socket object.
+			this.objClientSocket = new
+System.Net.Sockets.Socket(AddressFamily.InterNetwork, SocketType.Stream,
+ProtocolType.Tcp);
+		
+			// Set some socket options.
+		
+this.objClientSocket.SetSocketOption(System.Net.Sockets.SocketOptionLevel.Socket,
+System.Net.Sockets.SocketOptionName.ReceiveBuffer, 1048576);
+
+		
+this.objClientSocket.SetSocketOption(System.Net.Sockets.SocketOptionLevel.Socket,
+System.Net.Sockets.SocketOptionName.SendBuffer, 1048576);
+
+		
+this.objClientSocket.SetSocketOption(System.Net.Sockets.SocketOptionLevel.Tcp,
+   System.Net.Sockets.SocketOptionName.NoDelay, 1);
+			
+			this.objEndPoint = new
+IPEndPoint(Dns.Resolve(&quot;messenger.hotmail.com&quot;).AddressList[0], 1863);
+		}
+		try {
+			this.objClientSocket.Blocking = false;
+
+			// Attempt to establish a connection
+			Console.WriteLine(&quot;Connect&gt; Host:
+&quot;+this.objEndPoint.Address.ToString()+&quot;, Port:
+&quot;+this.objEndPoint.Port.ToString()+&quot;.&quot;);
+			this.objClientSocket.BeginConnect(this.objEndPoint, new
+AsyncCallback(ConnectComplete), this.objClientSocket);
+
+		} catch (System.Net.Sockets.SocketException e) {
+			Console.WriteLine(&quot;!Socket Exception!: &quot;+e.Message);
+
+		} catch (System.Exception e) {
+			Console.WriteLine(&quot;!Exception!: &quot;+e.Message);
+		}
+
+	}
+	
+	private void ConnectComplete(IAsyncResult ar) {
+		System.Net.Sockets.Socket objSocket =
+(System.Net.Sockets.Socket)ar.AsyncState;
+		
+	 	try {
+	 		objSocket.EndConnect(ar);
+			if(objSocket.Connected == false) {
+       			Console.WriteLine( &quot;Connect&gt; Connection Failed! Host:
+&quot;+objSocket.RemoteEndPoint.ToString());
+       			return;
+     			} else Console.WriteLine(&quot;Connect&gt; Connection Successfull!&quot;);
+	 	} catch(SocketException e) {
+	 		return;
+	 	}		
+	}
+	
+	void OnMyWindowDelete (object o, DeleteEventArgs args)
+	{
+		Application.Quit ();
+	}
+}
+
+Actual Results:
+Opens up the socket, and goes into the program loop. The callback never
+comes back (however we both know the MSN server is there and listening,
+since my MSN account can be logged in easily.
+
+This exact concept worked in Beta3.
+
+Expected Results:
+Socket connection to be made, and a callback to be called. Either
+connection, disconnection, error, etc (no errors or timeouts occur).
+
+How often does this happen? 
+
+Everytime.
+
+Additional Information:
+
+We have a GNOME MSN client we are building, and it used to work in Beta 3
+(we are just in the process of going backwards to beta 3) and stopped
+working in RC1.

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="018112.html">[Mono-bugs] [Bug 60742][Min] Changed - DataSet Xml Schema Inference bug on MONO
</A></li>
	<LI> Next message: <A HREF="018114.html">[Mono-bugs] [Bug 60812][Cos] New - &quot;neutral&quot; culture info causes exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18113">[ date ]</a>
              <a href="thread.html#18113">[ thread ]</a>
              <a href="subject.html#18113">[ subject ]</a>
              <a href="author.html#18113">[ author ]</a>
         </LI>
       </UL>
</body></html>
