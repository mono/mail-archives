<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 59624][Cri] Changed - Remoting over HTTP creates new thread for each request.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="016953.html">
   <LINK REL="Next"  HREF="016955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 59624][Cri] Changed - Remoting over HTTP creates new thread for each request.
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 59624][Cri] Changed - Remoting over HTTP creates new thread for each request.">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Mon,  7 Jun 2004 11:57:37 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="016953.html">[Mono-bugs] [Bug 59624][Cri] Changed - Remoting over HTTP creates new thread for each request.
</A></li>
        <LI> Next message: <A HREF="016955.html">[Mono-bugs] [Bug 59683][Min] Changed - Setting Context.User does not update Thread.CurrentPrincipal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16954">[ date ]</a>
              <a href="thread.html#16954">[ thread ]</a>
              <a href="subject.html#16954">[ subject ]</a>
              <a href="author.html#16954">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:lluis@ximian.com.">lluis@ximian.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=59624">http://bugzilla.ximian.com/show_bug.cgi?id=59624</A>

--- shadow/59624	2004-06-07 11:35:50.000000000 -0400
+++ shadow/59624.tmp.17211	2004-06-07 11:57:37.000000000 -0400
@@ -430,6 +430,32 @@
 
 ------- Additional Comments From <A HREF="mailto:ryoung@novell.com">ryoung@novell.com</A>  2004-06-07 11:35 -------
 Besides the memory leak.  It doesn't seem like the thread pool is 
 working over HTTP.  When over TCP it looks like the request are 
 being handled by the thread pool, but over HTTP every request causes 
 a new thread to be created, then exited.
+
+------- Additional Comments From <A HREF="mailto:lluis@ximian.com">lluis@ximian.com</A>  2004-06-07 11:57 -------
+Besides the thread issue :-). Notice that the test case is causing a
+memory leak itself. Since Server.InitializeLifetimeService() returns
+null, it means that the object will never expire and will never be
+collected by the GC. Every GetServer() creates a new Server instance
+that is never disposed. The following implementation should be ok for
+the test:
+
+public override Object InitializeLifetimeService()
+{
+	ILease lease = (ILease)base.InitializeLifetimeService();
+	if (lease.CurrentState == LeaseState.Initial)
+	{
+		lease.InitialLeaseTime = TimeSpan.FromSeconds(5);
+		lease.SponsorshipTimeout = TimeSpan.FromSeconds(10);
+		lease.RenewOnCallTime = TimeSpan.FromSeconds(2);
+	}
+	return lease;
+}
+
+However, even with this fixed I still get some memory leakage. Can you
+run the fixed test and tell me if you get the leak?. It would be also
+interesting to know if you get memory leaks when running the test case
+in bug 59597.
+

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="016953.html">[Mono-bugs] [Bug 59624][Cri] Changed - Remoting over HTTP creates new thread for each request.
</A></li>
	<LI> Next message: <A HREF="016955.html">[Mono-bugs] [Bug 59683][Min] Changed - Setting Context.User does not update Thread.CurrentPrincipal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16954">[ date ]</a>
              <a href="thread.html#16954">[ thread ]</a>
              <a href="subject.html#16954">[ subject ]</a>
              <a href="author.html#16954">[ author ]</a>
         </LI>
       </UL>
</body></html>
