<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 509457] Web.config error should not prevent AppDomain creation and/or serving responses
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20509457%5D%20Web.config%20error%20should%20not%20prevent%0A%20AppDomain%20creation%20and/or%20serving%20responses&In-Reply-To=bug-509457-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="090034.html">
   <LINK REL="Next"  HREF="089548.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 509457] Web.config error should not prevent AppDomain creation and/or serving responses</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20509457%5D%20Web.config%20error%20should%20not%20prevent%0A%20AppDomain%20creation%20and/or%20serving%20responses&In-Reply-To=bug-509457-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 509457] Web.config error should not prevent AppDomain creation and/or serving responses">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jun  4 14:49:09 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="090034.html">[Mono-bugs] [Bug 510031] stepping into a native code which links against libs without .bss or .text sections causes error and prevents debugging.
</A></li>
        <LI>Next message: <A HREF="089548.html">[Mono-bugs] [Bug 504611] authentication mode=&quot;Windows&quot; in web.config file causes exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#89546">[ date ]</a>
              <a href="thread.html#89546">[ thread ]</a>
              <a href="subject.html#89546">[ subject ]</a>
              <a href="author.html#89546">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=509457">http://bugzilla.novell.com/show_bug.cgi?id=509457</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A> added comment
<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=509457#c4">http://bugzilla.novell.com/show_bug.cgi?id=509457#c4</A>


Marek Habersack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>&gt; changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
          Component|Sys.Web                     |Sys.XML
         AssignedTo|<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>       |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>




--- Comment #4 from Marek Habersack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>&gt;  2009-06-04 12:49:06 MDT ---
(In reply to comment #3)
Note that I'm testing this with trunk.

&gt;<i> This is actually either a System.Web or a runtime bug.
</I>Well, sort of. System.Web part got fixed in r135471 (trunk) and r135472 (2.4
branch) but it's just moving the code which triggers the error out of a static
constructor, so that no exception occurs early in the process, but it is not a
full fix. I suspect the real fix would be to System.Configuration to handle
such errors more gracefully.
XSP will also not run with such broken config file as it will die when trying
to create a socket, because socket code tries to access configuration and
catches the same XML parsing error as your sample. So, once again, the real fix
belongs in System.Configuration IMO.

&gt;<i> 
</I>&gt;<i> Compile WebConfigErrorTest.cs and put WebConfigErrorTest.exe and the invalid
</I>&gt;<i> Web.config into a directory then create a copy of WebConfigErrorTest.exe in the
</I>&gt;<i> bin directory as well to make Mono able to load it in the new domain.
</I>&gt;<i> 
</I>&gt;<i> Executing WebConfigErrorTest.exe results in an exception. This should succeed.
</I>&gt;<i> When executed with MS.NET properly outputs an error page to the console.
</I>This executable won't run on .NET without creating
WebConfigErrorTest.exe.config file with the following contents:

------ cut -------
&lt;configuration&gt;
&lt;runtime&gt;
&lt;assemblyBinding xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot;&gt;
&lt;probing privatePath=&quot;SubApplication/bin&quot; /&gt;
&lt;/assemblyBinding&gt;
&lt;/runtime&gt;
&lt;configuration&gt;
------ cut -------

Even after this is done, the executable will not output anything to the
console, it will just exit. On Mono the sample doesn't quit but loops somewhere
in XML parser's guts (allocating memory till OOM):

[0x7fe5941e8730: 39.40736 18] LEAVE: string:InternalSetChar (int,char)
[0x7fe5941e8730: 39.40737 17] LEAVE: System.Text.StringBuilder:Append
(char)[System.Text.StringBuilder:0x7fe5917ccf30]
[0x7fe5941e8730: 39.40738 17] ENTER: Mono.Xml.SmallXmlParser:Peek
()(this:0x7fe5917c1620[Mono.Xml.SmallXmlParser WebConfigErrorTest.exe], )
[0x7fe5941e8730: 39.40739 18] ENTER: System.IO.StreamReader:Peek
()(this:0x7fe5917c1850[System.IO.StreamReader WebConfigErrorTest.exe], )
[0x7fe5941e8730: 39.40741 18] LEAVE: System.IO.StreamReader:Peek ()result=101
[0x7fe5941e8730: 39.40742 17] LEAVE: Mono.Xml.SmallXmlParser:Peek ()result=101
[0x7fe5941e8730: 39.40742 17] ENTER: Mono.Xml.SmallXmlParser:Read
()(this:0x7fe5917c1620[Mono.Xml.SmallXmlParser WebConfigErrorTest.exe], )
[0x7fe5941e8730: 39.40744 18] ENTER: System.IO.StreamReader:Read
()(this:0x7fe5917c1850[System.IO.StreamReader WebConfigErrorTest.exe], )
[0x7fe5941e8730: 39.40745 18] LEAVE: System.IO.StreamReader:Read ()result=101
[0x7fe5941e8730: 39.40746 17] LEAVE: Mono.Xml.SmallXmlParser:Read ()result=101
[0x7fe5941e8730: 39.40747 17] ENTER: System.Text.StringBuilder:Append
(char)(this:0x7fe5917ccf30[System.Text.StringBuilder WebConfigErrorTest.exe],
101, )
[0x7fe5941e8730: 39.40748 18] ENTER: string:InternalSetChar
(int,char)(this:[STRING:0x7fe591546000:SystegNamesiguration.IgnoreSection,
System.Configuration, Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b03f5f7f11d50a3a], 4, 101, )

For that reason, I'm going to reassign this bug to Sys.XML for now

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="090034.html">[Mono-bugs] [Bug 510031] stepping into a native code which links against libs without .bss or .text sections causes error and prevents debugging.
</A></li>
	<LI>Next message: <A HREF="089548.html">[Mono-bugs] [Bug 504611] authentication mode=&quot;Windows&quot; in web.config file causes exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#89546">[ date ]</a>
              <a href="thread.html#89546">[ thread ]</a>
              <a href="subject.html#89546">[ subject ]</a>
              <a href="author.html#89546">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
