<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 590967] application freeze during AppDomain.Unload
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20590967%5D%20application%20freeze%20during%20AppDomain.Unload&In-Reply-To=bug-590967-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="099107.html">
   <LINK REL="Next"  HREF="099110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 590967] application freeze during AppDomain.Unload</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20590967%5D%20application%20freeze%20during%20AppDomain.Unload&In-Reply-To=bug-590967-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 590967] application freeze during AppDomain.Unload">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Apr  9 09:47:15 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="099107.html">[Mono-bugs] [Bug 479030] File system watcher doesn't work
</A></li>
        <LI>Next message: <A HREF="099110.html">[Mono-bugs] [Bug 528048] The VMware image boots to text mode	sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#99109">[ date ]</a>
              <a href="thread.html#99109">[ thread ]</a>
              <a href="subject.html#99109">[ subject ]</a>
              <a href="author.html#99109">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=590967">http://bugzilla.novell.com/show_bug.cgi?id=590967</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=590967#c16">http://bugzilla.novell.com/show_bug.cgi?id=590967#c16</A>


Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jpryor at novell.com</A>&gt; changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                 CC|                            |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jpryor at novell.com</A>

--- Comment #16 from Jonathan Pryor &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jpryor at novell.com</A>&gt; 2010-04-09 13:47:15 UTC ---
I'll freely admit to not understanding half these comments...

But with respect to the patch in Comment #13, the patch is wrong, for two
reasons:

1. syslog(3) documents that &quot;the  two  character  sequence  %m will be replaced
by the error message string strerror(errno).&quot;  With the above patch, syslog(3)
will never see the %m, and thus users won't be able to use this documented
behavior.

2. The Mono.Unix.Native.Syscall.syslog(...,string) overloads go to great
efforts to ensure that only valid data is passed to syslog(3).  For example:

    public static int syslog (SyslogLevel level, string message)
    {
        int _level = NativeConvert.FromSyslogLevel (level);
        return sys_syslog (_level, GetSyslogMessage (message));
    }

    private static string GetSyslogMessage (string message)
    {
        return UnixMarshal.EscapeFormatString (message, new char[]{'m'});
    }

UnixMarshal.EscapeFormatString(), in turn, will only allow &quot;%m&quot; through
unchanged.  Anything else (like &quot;%s&quot;) will be escape the '%' (e.g. with &quot;%%s&quot;).

The exception to this are the syslog(..., params object[]) overloads, e.g.:

    [Obsolete (&quot;Not necessarily portable due to cdecl restrictions.\n&quot; +
            &quot;Use syslog(SyslogLevel, string) instead.&quot;)]
    public static int syslog (SyslogLevel level, string format, 
            params object[] parameters)
    {
        int _level = NativeConvert.FromSyslogLevel (level);

        object[] _parameters = new object[checked(parameters.Length+2)];
        _parameters [0] = _level;
        _parameters [1] = format;
        Array.Copy (parameters, 0, _parameters, 2, parameters.Length);
        return (int) XPrintfFunctions.syslog (_parameters);
    }

This invokes Mono_Posix_Syscall_syslog2(), which is a varargs wrapper for
vsyslog(3) (and thus is expected to get additional arguments on the stack).  If
the developer screws this up, it's their problem.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="099107.html">[Mono-bugs] [Bug 479030] File system watcher doesn't work
</A></li>
	<LI>Next message: <A HREF="099110.html">[Mono-bugs] [Bug 528048] The VMware image boots to text mode	sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#99109">[ date ]</a>
              <a href="thread.html#99109">[ thread ]</a>
              <a href="subject.html#99109">[ subject ]</a>
              <a href="author.html#99109">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
