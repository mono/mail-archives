<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 706329] New: System.ComponentModel.TypeDescriptor.GetAttributes() does not respect calls to AddAttributes()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20706329%5D%20New%3A%0A%20System.ComponentModel.TypeDescriptor.GetAttributes%28%29%20does%20not%20respect%20calls%0A%20to%20AddAttributes%28%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="112286.html">
   <LINK REL="Next"  HREF="112288.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 706329] New: System.ComponentModel.TypeDescriptor.GetAttributes() does not respect calls to AddAttributes()</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20706329%5D%20New%3A%0A%20System.ComponentModel.TypeDescriptor.GetAttributes%28%29%20does%20not%20respect%20calls%0A%20to%20AddAttributes%28%29&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 706329] New: System.ComponentModel.TypeDescriptor.GetAttributes() does not respect calls to AddAttributes()">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun Jul 17 23:22:59 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="112286.html">[Mono-bugs] [Bug 682757] Exception: Attempting to JIT compile method System.Linq.Enumerable/PredicateOf
</A></li>
        <LI>Next message: <A HREF="112288.html">[Mono-bugs] [Bug 689533] Nemerle Compiler self compiling crashes	the runtime.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#112287">[ date ]</a>
              <a href="thread.html#112287">[ thread ]</a>
              <a href="subject.html#112287">[ subject ]</a>
              <a href="author.html#112287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=706329">https://bugzilla.novell.com/show_bug.cgi?id=706329</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=706329#c0">https://bugzilla.novell.com/show_bug.cgi?id=706329#c0</A>


           Summary: System.ComponentModel.TypeDescriptor.GetAttributes()
                    does not respect calls to AddAttributes()
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">nullsquared at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=440501)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=440501">http://bugzilla.novell.com/attachment.cgi?id=440501</A>)
test class to demonstrate the issue

Description of Problem:
System.ComponentModel.TypeDescriptor.GetAttributes() does not respect calls to
TypeDescriptor.AddAttributes()

Steps to reproduce the problem:
1. Add any attribute to a class type with TypeDescriptor.AddAttributes()
2. Get a list of attributes of a class type with TypeDescriptor.GetAttributes()
- the added attributes won't be there

Actual Results:
Attributes before adding TestAttributeB:
TestTypeConverter.TestAttributeA

Adding TestAttributeB to TestClass

Attributes after adding TestAttributeB:
TestTypeConverter.TestAttributeA

Expected Results:
Attributes before adding TestAttributeB:
TestTypeConverter.TestAttributeA

Adding TestAttributeB to TestClass

Attributes after adding TestAttributeB:
TestTypeConverter.TestAttributeA
TestTypeConverter.TestAttributeB

How often does this happen? 
Every time

Additional Information:
Mono's implementation of TypeDescriptor.GetAttributes() gets the attributes of
a class type by using the Type class itself; the Type class will not contain
attributes registered at run-time via TypeDescriptor.AddAttributes(), so this
is wrong.

Microsoft's implementation of TypeDescriptor.GetAttributes() simply calls
GetDescriptor().GetAttributes(), which not only return's the Type's attributes,
but it also returns any attributes registered with the TypeDescriptor.

As such, a fix in a client's code could look like this:
//attribs = TypeDescriptor.GetAttributes(typeof(TestClass));
attribs =
TypeDescriptor.GetProvider(typeof(TestClass)).GetTypeDescriptor(typeof(TestClass)).GetAttributes();

The issue is not that simple, though. TypeDescriptor uses its own
GetAttributes() internally when, for example, you call GetConverter() - this
means that you cannot use a custom type converter.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="112286.html">[Mono-bugs] [Bug 682757] Exception: Attempting to JIT compile method System.Linq.Enumerable/PredicateOf
</A></li>
	<LI>Next message: <A HREF="112288.html">[Mono-bugs] [Bug 689533] Nemerle Compiler self compiling crashes	the runtime.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#112287">[ date ]</a>
              <a href="thread.html#112287">[ thread ]</a>
              <a href="subject.html#112287">[ subject ]</a>
              <a href="author.html#112287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
