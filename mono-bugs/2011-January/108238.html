<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 665956] New: HttpWebRequest exhaust threads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20665956%5D%20New%3A%20HttpWebRequest%20exhaust%20threads&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="108237.html">
   <LINK REL="Next"  HREF="108314.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 665956] New: HttpWebRequest exhaust threads</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20665956%5D%20New%3A%20HttpWebRequest%20exhaust%20threads&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 665956] New: HttpWebRequest exhaust threads">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jan 20 14:10:47 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="108237.html">[Mono-bugs] [Bug 665953] [Regression 2.10 RC1] Several crashes when trying to start WinForm applications
</A></li>
        <LI>Next message: <A HREF="108314.html">[Mono-bugs] [Bug 665956] HttpWebRequest exhaust threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108238">[ date ]</a>
              <a href="thread.html#108238">[ thread ]</a>
              <a href="subject.html#108238">[ subject ]</a>
              <a href="author.html#108238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=665956">https://bugzilla.novell.com/show_bug.cgi?id=665956</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=665956#c0">https://bugzilla.novell.com/show_bug.cgi?id=665956#c0</A>


           Summary: HttpWebRequest exhaust threads
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.8.x
          Platform: x86-64
        OS/Version: Windows 7
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: io-layer
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mauhumor at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b9) Gecko/20100101
Firefox/4.0b9

Consecutive calls HttpWebRequest GetResponse results in mono crashing with a
messagebox with the title &quot;Fatal error in gc&quot; and the text &quot;too many threads&quot;.

The error could be isolated using a minimal program that does only loops like
10 times a second, instantiate an HttpWebRequest and call either GetResponse or
BeginGetResponse result in the error after 50-250 http calls.

Was detected on several machines, with different hardware, all using windows 7.
Tested on Windows 2008 Server and everything run fine on that OS (although all
hardware where virtualized).
Tested also using Mono 1.2.5 without errors on any plataform.




Reproducible: Always

Steps to Reproduce:
1. On windows 7 make a loop that   
2.   instantiate an object of HttpWebRequest
3.   call GetResponse or BeginGetResponse


Actual Results:  
Mono crash after 50-250 calls

Expected Results:  
Keep running forever

// sample program, crashes every time on Windows 7

using System;
using System.IO;
using System.Net;
using System.Threading;

public class Test
{
    public void Main(string[] args)
    {
        int count = 0;
        while (true)
        {
            string url = &quot;<A HREF="http://www.google.com.br/&quot;;">http://www.google.com.br/&quot;;</A>
            var request = (HttpWebRequest)WebRequest.Create(url);
            request.Timeout = 10000;
            HttpWebResponse response = null;
            try
            {
                response = (HttpWebResponse)request.GetResponse();
            }
            catch (WebException e)
            {
                Console.WriteLine(&quot;exception: &quot; + e.ToString());
                continue;
            }

            var reader = new StreamReader(response.GetResponseStream());
            string data = reader.ReadToEnd();
            reader.Dispose(); // also tried &quot;close&quot;

            Console.WriteLine(&quot;call count so far: &quot; + count++);
            Thread.Sleep(50);
        }
    }
}

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="108237.html">[Mono-bugs] [Bug 665953] [Regression 2.10 RC1] Several crashes when trying to start WinForm applications
</A></li>
	<LI>Next message: <A HREF="108314.html">[Mono-bugs] [Bug 665956] HttpWebRequest exhaust threads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108238">[ date ]</a>
              <a href="thread.html#108238">[ thread ]</a>
              <a href="subject.html#108238">[ subject ]</a>
              <a href="author.html#108238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
