<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 665345] New: Services: Some suggestions to improve the API and .netify it
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20665345%5D%20New%3A%20Services%3A%20Some%20suggestions%20to%20improve%0A%20the%20API%20and%20.netify%20it&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="108224.html">
   <LINK REL="Next"  HREF="108221.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 665345] New: Services: Some suggestions to improve the API and .netify it</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20665345%5D%20New%3A%20Services%3A%20Some%20suggestions%20to%20improve%0A%20the%20API%20and%20.netify%20it&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 665345] New: Services: Some suggestions to improve the API and .netify it">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Jan 18 19:57:09 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="108224.html">[Mono-bugs] [Bug 665341] Notification.Vibrate is read only...
</A></li>
        <LI>Next message: <A HREF="108221.html">[Mono-bugs] [Bug 665345] Services: Some suggestions to improve the API and .netify it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108155">[ date ]</a>
              <a href="thread.html#108155">[ thread ]</a>
              <a href="subject.html#108155">[ subject ]</a>
              <a href="author.html#108155">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=665345">https://bugzilla.novell.com/show_bug.cgi?id=665345</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=665345#c0">https://bugzilla.novell.com/show_bug.cgi?id=665345#c0</A>


           Summary: Services: Some suggestions to improve the API and
                    .netify it
    Classification: Mono
           Product: MonoDroid
           Version: SVN
          Platform: Macintosh
        OS/Version: Mac OS X 10.6
            Status: NEW
          Severity: Enhancement
          Priority: P5 - None
         Component: Class Libraries
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mkestner at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jondick at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-US)
AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.237 Safari/534.10

So, for services there's the concept of binding a service to an activity on
android, to get a reference to the service that you can use directly from the
activity. 

It all works right now as is, but I've created a couple of simple classes that
would really make it a lot easier and less verbose to work with.


using System;
using Android.OS;
using Android.Service;
using Android.App;
using Android.Content;
using Android.Runtime;

namespace Chapter13Threading
{
    public class ServiceConnection&lt;TService, TBinder&gt; : Java.Lang.Object,
IServiceConnection where TService : Service where TBinder :
ServiceBinder&lt;TService&gt;
    {            
        public event Action&lt;TService&gt; Connected;

        public event Action Disconnected;

        public void OnServiceConnected(ComponentName className, IBinder
serviceBinder)
        {
            if (this.Connected != null)
                this.Connected((serviceBinder as
ServiceBinder&lt;TService&gt;).GetService());
        }

        public void OnServiceDisconnected(ComponentName className)
        {
            if (this.Disconnected != null)
                this.Disconnected();
        }
    }

    public class ServiceBinder&lt;TService&gt; : Binder where TService : Service
    {
        TService _service;

        public ServiceBinder(TService service)
        {
            this._service = service;
        }

        public TService GetService()
        {
            return _service;
        }
    }
}



So, in your service you'd create a new ServiceBinder&lt;MyService&gt;(); instance and
return that in your OnBind overload for your Service.  Simple.

In your Activity you'd create a new ServiceConnection&lt;MyService,
ServiceBinder&lt;MyService&gt;&gt;(); instance, and subscribe to its Connected and
Disconnected events:

myServiceConnection.Connected += delegate(MyService serviceInstance) {
    this.ServiceInstance = serviceInstance;
    this.button.Click += delegate {
        this.ServiceInstance.SomeServiceMethod();
    };
};

myServiceConnection.Disconnected += delegate { 
    this.ServiceInstance = null;
};


The idea here is you get an event for when your reference to the server is
valid (after your connection is connected) at which point you can use your
reference to the service.  This is way less verbose than the way you have to do
it now, which is basically to create a class implementing IServiceConnection in
your activity, as well as a subclassing Binder in your service.  These are just
helper classes that would be optional to use, but make things a bit quicker for
us.

Like? Dislike?

Reproducible: Always

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="108224.html">[Mono-bugs] [Bug 665341] Notification.Vibrate is read only...
</A></li>
	<LI>Next message: <A HREF="108221.html">[Mono-bugs] [Bug 665345] Services: Some suggestions to improve the API and .netify it
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108155">[ date ]</a>
              <a href="thread.html#108155">[ thread ]</a>
              <a href="subject.html#108155">[ subject ]</a>
              <a href="author.html#108155">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
