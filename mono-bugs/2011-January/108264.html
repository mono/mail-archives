<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 666155] New: RSA encryption of SHA512 hash not	supported
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20666155%5D%20New%3A%20RSA%20encryption%20of%20SHA512%20hash%20not%0A%09supported&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="108592.html">
   <LINK REL="Next"  HREF="108265.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 666155] New: RSA encryption of SHA512 hash not	supported</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20666155%5D%20New%3A%20RSA%20encryption%20of%20SHA512%20hash%20not%0A%09supported&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 666155] New: RSA encryption of SHA512 hash not	supported">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Jan 21 08:14:48 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="108592.html">[Mono-bugs] [Bug 666152] [XDEBUG] Does not work with gdb 7.2
</A></li>
        <LI>Next message: <A HREF="108265.html">[Mono-bugs] [Bug 666155] RSA encryption of SHA512 hash not supported
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108264">[ date ]</a>
              <a href="thread.html#108264">[ thread ]</a>
              <a href="subject.html#108264">[ subject ]</a>
              <a href="author.html#108264">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=666155">https://bugzilla.novell.com/show_bug.cgi?id=666155</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=666155#c0">https://bugzilla.novell.com/show_bug.cgi?id=666155#c0</A>


           Summary: RSA encryption of SHA512 hash not supported
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: x86-64
        OS/Version: Ubuntu
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System.Security
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">spouliot at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jeremy.poulter at oregan.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=409532)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=409532">http://bugzilla.novell.com/attachment.cgi?id=409532</A>)
Test case showing issue

User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.237 Safari/534.10

When using the attached test case and exception is reported about unsupported
hash algorithm for RSA signing.

This is also likely to be the case with other SHA-2 (eg SHA 256) hashes, but I
have not explicitly tested.

Reproducible: Always

Steps to Reproduce:
1.mono ConsoleApplication1.exe

Actual Results:  
Unhandled Exception: System.NotSupportedException: 2.16.840.1.101.3.4.2.3 is an
unsupported hash algorithm for RSA signing
  at System.Security.Cryptography.RSACryptoServiceProvider.GetHashNameFromOID
(System.String oid) [0x00000] in &lt;filename unknown&gt;:0 
  at System.Security.Cryptography.RSACryptoServiceProvider.SignHash
(System.Byte[] rgbHash, System.String str) [0x00000] in &lt;filename unknown&gt;:0 
  at ConsoleApplication1.Program.Main (System.String[] args) [0x00000] in
&lt;filename unknown&gt;:0 


Expected Results:  
Generated 128 bytes for signature

Mail from Sebastien Pouliot on the <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Mono-list at lists.ximian.com</A> mailing list;


Hello again,

&gt;<i>From source code:
</I>
        // LAMESPEC: str is not the hash name but an OID
        // NOTE: this method is LIMITED to SHA1 and MD5 like the MS framework
1.0 
        // and 1.1 because there's no method to get a hash algorithm from an
OID. 
        // However there's no such limit when using the [De]Formatter class.
        public byte[] SignHash (byte[] rgbHash, string str) 

So this is something that has changed after 1.x (likely 2.0 or 3.5).
I'll fix this soon in GIT (maybe in time for 2.10). In the mean time the
workaround will work on all Mono / .NET releases.

Sebastien

On Mon, 2011-01-10 at 07:53 -0500, Sebastien Pouliot wrote:
&gt;<i> &gt; Hello Jeremy,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This was not supported in earlier version of Windows. Most of MS .NET
</I>&gt;<i> &gt; cryptography is not managed and redirected to CryptoAPI, which features
</I>&gt;<i> &gt; varies by Windows versions (which means your code won't work on all
</I>&gt;<i> &gt; Windows versions out there).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In any case Mono can support this (all managed and no dependency on the
</I>&gt;<i> &gt; OS). Please fill a bug report on bugzilla.novell.com with a
</I>&gt;<i> &gt; self-contained test case and I'll look at it asap.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt; Sebastien
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Mon, 2011-01-10 at 01:50 -0800, jeremy.poulter wrote:
</I>&gt;&gt;<i> &gt; &gt; I have been developing an application that uses an SHA512 hash signed with a
</I>&gt;&gt;<i> &gt; &gt; RSA private key for a digital signature.
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; This is working fine on Windows under .Net but when I try this on Linux
</I>&gt;&gt;<i> &gt; &gt; under Mono I get the following exception;
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; System.NotSupportedException: 2.16.840.1.101.3.4.2.3 is an unsupported hash
</I>&gt;&gt;<i> &gt; &gt; algorithm for RSA signing
</I>&gt;&gt;<i> &gt; &gt;   at
</I>&gt;&gt;<i> &gt; &gt; System.Security.Cryptography.RSACryptoServiceProvider.GetHashNameFromOID
</I>&gt;&gt;<i> &gt; &gt; (System.String oid) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Security.Cryptography.RSACryptoServiceProvider.SignHash
</I>&gt;&gt;<i> &gt; &gt; (System.Byte[] rgbHash, System.String str) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at Oregan.Utilities.DigitalSignature.DigitalSignature.Sign (HashType
</I>&gt;&gt;<i> &gt; &gt; hashType, System.IO.Stream stream) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at Oregan.FilePackBuilder.FilePack.Save (System.String sPath,
</I>&gt;&gt;<i> &gt; &gt; Oregan.Utilities.DigitalSignature.DigitalSignature digitalSignature, Boolean
</I>&gt;&gt;<i> &gt; &gt; bPreserveName) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at Oregan.FilePackBuilder.FilePackViewer.filepackToolStripMenuItem1_Click
</I>&gt;&gt;<i> &gt; &gt; (System.Object sender, System.EventArgs e) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripItem.OnClick (System.EventArgs e)
</I>&gt;&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripMenuItem.OnClick (System.EventArgs e)
</I>&gt;&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripMenuItem.HandleClick (System.EventArgs e)
</I>&gt;&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripItem.FireEvent (System.EventArgs e,
</I>&gt;&gt;<i> &gt; &gt; ToolStripItemEventType met) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at (wrapper remoting-invoke-with-check)
</I>&gt;&gt;<i> &gt; &gt; System.Windows.Forms.ToolStripItem:FireEvent
</I>&gt;&gt;<i> &gt; &gt; (System.EventArgs,System.Windows.Forms.ToolStripItemEventType)
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStrip.OnMouseUp
</I>&gt;&gt;<i> &gt; &gt; (System.Windows.Forms.MouseEventArgs mea) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripDropDown.OnMouseUp
</I>&gt;&gt;<i> &gt; &gt; (System.Windows.Forms.MouseEventArgs mea) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.Control.WmLButtonUp (System.Windows.Forms.Message&amp;
</I>&gt;&gt;<i> &gt; &gt; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.Control.WndProc (System.Windows.Forms.Message&amp; m)
</I>&gt;&gt;<i> &gt; &gt; [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ScrollableControl.WndProc
</I>&gt;&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStrip.WndProc (System.Windows.Forms.Message&amp;
</I>&gt;&gt;<i> &gt; &gt; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.ToolStripDropDown.WndProc
</I>&gt;&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.Control+ControlWindowTarget.OnMessage
</I>&gt;&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.Control+ControlNativeWindow.WndProc
</I>&gt;&gt;<i> &gt; &gt; (System.Windows.Forms.Message&amp; m) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt;   at System.Windows.Forms.NativeWindow.WndProc (IntPtr hWnd, Msg msg, IntPtr
</I>&gt;&gt;<i> &gt; &gt; wParam, IntPtr lParam) [0x00000] in &lt;filename unknown&gt;:0 
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; FYI the code I used is;
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt;     public byte[] Sign(HashType hashType, Stream stream)
</I>&gt;&gt;<i> &gt; &gt;     {
</I>&gt;&gt;<i> &gt; &gt;       switch (hashType)
</I>&gt;&gt;<i> &gt; &gt;       {
</I>&gt;&gt;<i> &gt; &gt;         case HashType.MD5:
</I>&gt;&gt;<i> &gt; &gt;         {
</I>&gt;&gt;<i> &gt; &gt;           MD5 md5 = new MD5CryptoServiceProvider();
</I>&gt;&gt;<i> &gt; &gt;           byte[] hash = md5.ComputeHash(stream);
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt;           return key.SignHash(hash, CryptoConfig.MapNameToOID(&quot;MD5&quot;));
</I>&gt;&gt;<i> &gt; &gt;         }
</I>&gt;&gt;<i> &gt; &gt;         case HashType.SHA512:
</I>&gt;&gt;<i> &gt; &gt;         {
</I>&gt;&gt;<i> &gt; &gt;           SHA512 shaM = new SHA512Managed();
</I>&gt;&gt;<i> &gt; &gt;           byte[] hash = shaM.ComputeHash(stream);
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt;           return key.SignHash(hash, CryptoConfig.MapNameToOID(&quot;SHA512&quot;));
</I>&gt;&gt;<i> &gt; &gt;         }
</I>&gt;&gt;<i> &gt; &gt;       }
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt;       return null;
</I>&gt;&gt;<i> &gt; &gt;     }
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; Any feedback is appreciated.
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; Cheers,
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;&gt;<i> &gt; &gt; Jeremy
</I>&gt;&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mono-list maillist  -  <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Mono-list at lists.ximian.com</A>
</I>&gt;<i> &gt; <A HREF="http://lists.ximian.com/mailman/listinfo/mono-list">http://lists.ximian.com/mailman/listinfo/mono-list</A>
</I>
-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="108592.html">[Mono-bugs] [Bug 666152] [XDEBUG] Does not work with gdb 7.2
</A></li>
	<LI>Next message: <A HREF="108265.html">[Mono-bugs] [Bug 666155] RSA encryption of SHA512 hash not supported
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108264">[ date ]</a>
              <a href="thread.html#108264">[ thread ]</a>
              <a href="subject.html#108264">[ subject ]</a>
              <a href="author.html#108264">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
