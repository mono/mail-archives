<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 665179] New: AvoidVisibleFieldsRule should not fire on a public (or public static) EventHandler&lt;T&gt; with default implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20665179%5D%20New%3A%20AvoidVisibleFieldsRule%20should%20not%0A%20fire%20on%20a%20public%20%28or%20public%20static%29%20EventHandler%3CT%3E%20with%20default%0A%20implementation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="108193.html">
   <LINK REL="Next"  HREF="108142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 665179] New: AvoidVisibleFieldsRule should not fire on a public (or public static) EventHandler&lt;T&gt; with default implementation</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20665179%5D%20New%3A%20AvoidVisibleFieldsRule%20should%20not%0A%20fire%20on%20a%20public%20%28or%20public%20static%29%20EventHandler%3CT%3E%20with%20default%0A%20implementation&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 665179] New: AvoidVisibleFieldsRule should not fire on a public (or public static) EventHandler&lt;T&gt; with default implementation">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Jan 18 11:26:45 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="108193.html">[Mono-bugs] [Bug 665171] AvoidVisibleFieldsRule only looks at [SuppressMessage] metadata at get / set or add / remove
</A></li>
        <LI>Next message: <A HREF="108142.html">[Mono-bugs] [Bug 665179] AvoidVisibleFieldsRule should not fire on a public (or public static) EventHandler&lt;T&gt; with default implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108135">[ date ]</a>
              <a href="thread.html#108135">[ thread ]</a>
              <a href="subject.html#108135">[ subject ]</a>
              <a href="author.html#108135">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=665179">https://bugzilla.novell.com/show_bug.cgi?id=665179</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=665179#c0">https://bugzilla.novell.com/show_bug.cgi?id=665179#c0</A>


           Summary: AvoidVisibleFieldsRule should not fire on a public (or
                    public static) EventHandler&lt;T&gt; with default
                    implementation
    Classification: Mono
           Product: Mono: Tools
           Version: 2.10.x
          Platform: 64bit
        OS/Version: Windows 7
            Status: NEW
          Severity: Enhancement
          Priority: P5 - None
         Component: Gendarme
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">ethan_j_brown at hotmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.634.0 Safari/534.16

Default EventHandler&lt;T&gt; add/remove generated by the compiler is thread-safe.

&gt;<i>From the spec
</I>When compiling a field-like event, the compiler automatically creates storage
to hold the delegate, and creates accessors for the event that add or remove
event handlers to the delegate field. In order to be thread-safe, the addition
or removal operations are done while holding the lock (&#167;8.12) on the containing
object for an instance event, or the type object (&#167;7.6.10.6) for a static
event.

More info
<A HREF="http://stackoverflow.com/questions/3522361/add-delegate-to-event-thread-safety">http://stackoverflow.com/questions/3522361/add-delegate-to-event-thread-safety</A>


There are a number of places in the BCL where EventHandler&lt;T&gt; is exposed
publicly -- for instance there is a static EventHandler&lt;T&gt; in 
System.Threading.Tasks.TaskScheduler.UnobservedTaskException.

<A HREF="http://msdn.microsoft.com/en-us/library/system.threading.tasks.taskscheduler.unobservedtaskexception.aspx">http://msdn.microsoft.com/en-us/library/system.threading.tasks.taskscheduler.unobservedtaskexception.aspx</A>

In most cases, a private EventHandler&lt;T&gt; is used, but I don't believe that
adding a private member of the same type and implementing the add/remove is
actually a breaking change should there be a need in the future to change the
default add/remove behavior generated by the compiler.

Reproducible: Always

Steps to Reproduce:
1.<A HREF="https://github.com/Iristyle/mono-tools/commit/83d31d70a805a11d5ad00543b1a8ae184f7bef33">https://github.com/Iristyle/mono-tools/commit/83d31d70a805a11d5ad00543b1a8ae184f7bef33</A>
2.
3.
Actual Results:  
AvoidVisibleFieldsRule defect is generated

Expected Results:  
No defect for this use case.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>








































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="108193.html">[Mono-bugs] [Bug 665171] AvoidVisibleFieldsRule only looks at [SuppressMessage] metadata at get / set or add / remove
</A></li>
	<LI>Next message: <A HREF="108142.html">[Mono-bugs] [Bug 665179] AvoidVisibleFieldsRule should not fire on a public (or public static) EventHandler&lt;T&gt; with default implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#108135">[ date ]</a>
              <a href="thread.html#108135">[ thread ]</a>
              <a href="subject.html#108135">[ subject ]</a>
              <a href="author.html#108135">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
