<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 662381] C# lock () fails on latest Mono runtimes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20662381%5D%20C%23%20lock%20%28%29%20fails%20on%20latest%20Mono%20runtimes&In-Reply-To=bug-662381-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="107765.html">
   <LINK REL="Next"  HREF="107791.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 662381] C# lock () fails on latest Mono runtimes</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20662381%5D%20C%23%20lock%20%28%29%20fails%20on%20latest%20Mono%20runtimes&In-Reply-To=bug-662381-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 662381] C# lock () fails on latest Mono runtimes">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jan  6 08:20:12 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="107765.html">[Mono-bugs] [Bug 662381] C# lock () fails on latest Mono runtimes
</A></li>
        <LI>Next message: <A HREF="107791.html">[Mono-bugs] [Bug 662381] C# lock () fails on latest Mono runtimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#107774">[ date ]</a>
              <a href="thread.html#107774">[ thread ]</a>
              <a href="subject.html#107774">[ subject ]</a>
              <a href="author.html#107774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=662381">https://bugzilla.novell.com/show_bug.cgi?id=662381</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=662381#c13">https://bugzilla.novell.com/show_bug.cgi?id=662381#c13</A>


J&#233;r&#233;mie LAVAL &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jeremie.laval at gmail.com</A>&gt; changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
             Status|REOPENED                    |RESOLVED
         Resolution|                            |FIXED

--- Comment #13 from J&#233;r&#233;mie LAVAL &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jeremie.laval at gmail.com</A>&gt; 2011-01-06 13:20:09 UTC ---
Again, this is not a problem with the lock itself, merely the fact that it uses
Monitor which is re-entrant (see Remarks section on MSDN).

In our context, it means that a thread t1 executing a task can also execute
another task while still being in the first (when you use a Wait operation,
Parallel.For implicitly calls a Wait).

Taking you last example, what happens is that a thread t1 executing Foo and
taking the lock can during the empty Parallel.For execute one of the Task of
the first Parallel.For (the one calling Foo in the first place). Thus you have
a recursion (even though the code doesn't exhibit any at first) and when you
hit lock for the second time since the thread (and not the task) had taken it
already you just go through.

I added experimental restrictions to the code to make it less greedy which fix
both test cases but I'm waiting to see if it regresses anything else before
putting it in a stable release so 2.8.2 won't have it. Meantime my workarounds
I described earlier are still applicable.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="107765.html">[Mono-bugs] [Bug 662381] C# lock () fails on latest Mono runtimes
</A></li>
	<LI>Next message: <A HREF="107791.html">[Mono-bugs] [Bug 662381] C# lock () fails on latest Mono runtimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#107774">[ date ]</a>
              <a href="thread.html#107774">[ thread ]</a>
              <a href="subject.html#107774">[ subject ]</a>
              <a href="author.html#107774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
