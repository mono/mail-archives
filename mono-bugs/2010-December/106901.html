<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 657593] New: Socket.AcceptAsync causes ObjectDisposedException at the time the socket closes.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20657593%5D%20New%3A%20Socket.AcceptAsync%20causes%0A%20ObjectDisposedException%20at%20the%20time%20the%20socket%20closes.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="106993.html">
   <LINK REL="Next"  HREF="106916.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 657593] New: Socket.AcceptAsync causes ObjectDisposedException at the time the socket closes.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20657593%5D%20New%3A%20Socket.AcceptAsync%20causes%0A%20ObjectDisposedException%20at%20the%20time%20the%20socket%20closes.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 657593] New: Socket.AcceptAsync causes ObjectDisposedException at the time the socket closes.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat Dec  4 04:59:55 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="106993.html">[Mono-bugs] [Bug 657588] mono 2.x looks for mscorlib.dll in a nonexistent 1.x directory
</A></li>
        <LI>Next message: <A HREF="106916.html">[Mono-bugs] [Bug 657593] Socket.AcceptAsync causes ObjectDisposedException at the time the socket closes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106901">[ date ]</a>
              <a href="thread.html#106901">[ thread ]</a>
              <a href="subject.html#106901">[ subject ]</a>
              <a href="author.html#106901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=657593">https://bugzilla.novell.com/show_bug.cgi?id=657593</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=657593#c0">https://bugzilla.novell.com/show_bug.cgi?id=657593#c0</A>


           Summary: Socket.AcceptAsync causes ObjectDisposedException at
                    the time the socket closes.
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: x86
        OS/Version: Linux
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">pavlos256 at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=403458)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=403458">http://bugzilla.novell.com/attachment.cgi?id=403458</A>)
Testcase

User-Agent:       Mozilla/5.0 (X11; Linux i686; rv:2.0b8pre) Gecko/20101126
Firefox/4.0b8pre

Closing a listening socket that has had the AcceptAsync method called and is
waiting for a connection causes ObjectDisposedException that can't be caught by
user code (thrown in the ThreadPool?).

The attached testcase demonstrates the problem. It has been tested on .NET and
has no problem there.

More information:
The attached program tries to run the test twice, one time with the
e.AcceptSocket member set to null (before the call to AcceptAsync) and one time
with the e.AcceptSocket member set to a pre-initialized socket. The
ObjectDisposedException is thrown on both cases but when the e.AcceptSocket is
not null, a related but slightly different bug also appears: The Completed
event is raised with the e.AcceptSocket member set to null.

Reproducible: Always

Steps to Reproduce:
1. Run the attached testcase
2.
3.
Actual Results:  
Test with non-null e.AcceptSocket...

Unhandled Exception: System.ObjectDisposedException: The object was used after
being disposed.
  at System.Net.Sockets.Socket.EndAccept (System.Byte[]&amp; buffer, System.Int32&amp;
bytesTransferred, IAsyncResult asyncResult) [0x00000] in &lt;filename unknown&gt;:0 
  at System.Net.Sockets.Socket.EndAccept (IAsyncResult result) [0x00000] in
&lt;filename unknown&gt;:0 
  at System.Net.Sockets.SocketAsyncEventArgs.AcceptCallback (IAsyncResult ares)
[0x00000] in &lt;filename unknown&gt;:0 


Test with null e.AcceptSocket...
Error: Completed called with AcceptSocket = null.

Unhandled Exception: System.ObjectDisposedException: The object was used after
being disposed.
  at System.Net.Sockets.Socket.EndAccept (System.Byte[]&amp; buffer, System.Int32&amp;
bytesTransferred, IAsyncResult asyncResult) [0x00000] in &lt;filename unknown&gt;:0 
  at System.Net.Sockets.Socket.EndAccept (IAsyncResult result) [0x00000] in
&lt;filename unknown&gt;:0 
  at System.Net.Sockets.SocketAsyncEventArgs.AcceptCallback (IAsyncResult ares)
[0x00000] in &lt;filename unknown&gt;:0 


Expected Results:  
Test with non-null e.AcceptSocket...
OK.

Test with null e.AcceptSocket...
OK.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="106993.html">[Mono-bugs] [Bug 657588] mono 2.x looks for mscorlib.dll in a nonexistent 1.x directory
</A></li>
	<LI>Next message: <A HREF="106916.html">[Mono-bugs] [Bug 657593] Socket.AcceptAsync causes ObjectDisposedException at the time the socket closes.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#106901">[ date ]</a>
              <a href="thread.html#106901">[ thread ]</a>
              <a href="subject.html#106901">[ subject ]</a>
              <a href="author.html#106901">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
