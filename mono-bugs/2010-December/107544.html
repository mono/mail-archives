<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 661904] New: RichTextBox.Rtf misinterprets concluding &quot;\par&quot; when .Multiline = False and displays !! exclamation marks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20661904%5D%20New%3A%20RichTextBox.Rtf%20misinterprets%0A%20concluding%20%22%5Cpar%22%20when%20.Multiline%20%3D%20False%20and%20displays%20%21%21%20exclamation%20marks&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="107564.html">
   <LINK REL="Next"  HREF="107545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 661904] New: RichTextBox.Rtf misinterprets concluding &quot;\par&quot; when .Multiline = False and displays !! exclamation marks</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20661904%5D%20New%3A%20RichTextBox.Rtf%20misinterprets%0A%20concluding%20%22%5Cpar%22%20when%20.Multiline%20%3D%20False%20and%20displays%20%21%21%20exclamation%20marks&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 661904] New: RichTextBox.Rtf misinterprets concluding &quot;\par&quot; when .Multiline = False and displays !! exclamation marks">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Dec 30 14:53:30 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="107564.html">[Mono-bugs] [Bug 661893] TabControl draws previously focused ComboBox on wrong TabPage
</A></li>
        <LI>Next message: <A HREF="107545.html">[Mono-bugs] [Bug 661904] RichTextBox.Rtf misinterprets concluding &quot;\par&quot; when .Multiline = False and displays !! exclamation marks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#107544">[ date ]</a>
              <a href="thread.html#107544">[ thread ]</a>
              <a href="subject.html#107544">[ subject ]</a>
              <a href="author.html#107544">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=661904">https://bugzilla.novell.com/show_bug.cgi?id=661904</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=661904#c0">https://bugzilla.novell.com/show_bug.cgi?id=661904#c0</A>


           Summary: RichTextBox.Rtf misinterprets concluding &quot;\par&quot; when
                    .Multiline = False and displays !! exclamation marks
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.8.x
          Platform: x86-64
        OS/Version: Windows 7
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Windows.Forms
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">c8 at vokabeln.de</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=406617)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=406617">http://bugzilla.novell.com/attachment.cgi?id=406617</A>)
complete VB.NET project. Test by running bin\Release\Test003RichTextBox.exe
with Mono.

User-Agent:       Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64;
Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729;
Media Center PC 6.0; MDDC; .NET4.0C)

The RichTextBox.Rtf code usually concludes with a &quot;\par&quot;, even if it is used in
a single-line RichTextBox. For example, an empty single-line RichTextBox has
the following .Rtf code: 

{\rtf1\ansi\ansicpg1252\deff0\deflang1031{\fonttbl{\f0\fnil\fcharset0 Microsoft
Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17\par
}

However, when I *set* RichTextBox.Rtf to exactly this string, and then read
what is in RichTextBox.Rtf, under Mono I get

{\rtf1\ansi\ansicpg1252\deff0\deflang1033
{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
{\*\generator Mono RichTextBox;}\pard\f0\fs16 
\par
\par
}

Thus, Mono has added a &quot;\par&quot; tag at the end of the .Rtf code. The two &quot;\par&quot;
tags are displayed in Mono as two odd-looking exclamation marks. Setting this
latter string to RichTextBox.Rtf again, will add yet another &quot;\par&quot; at the end
(and more exclamation marks in the display). 

Reproducible: Always

Steps to Reproduce:
1. Create a Windows Form1 with 

* One RichTextBox control, setting RichTextBox1.Multiline = False 
* One large TextBox control, setting TextBox1.Multline = True (make the control
at least 10-15 lines high!) 
* One Button

Here's the VB.NET designer code: 

&lt;Global.Microsoft.VisualBasic.CompilerServices.DesignerGenerated()&gt; _
Partial Class Form1
    Inherits System.Windows.Forms.Form

    &lt;System.Diagnostics.DebuggerNonUserCode()&gt; _
    Protected Overrides Sub Dispose(ByVal disposing As Boolean)
        Try
            If disposing AndAlso components IsNot Nothing Then
                components.Dispose()
            End If
        Finally
            MyBase.Dispose(disposing)
        End Try
    End Sub

    Private components As System.ComponentModel.IContainer

    &lt;System.Diagnostics.DebuggerStepThrough()&gt; _
    Private Sub InitializeComponent()
    Me.RichTextBox1 = New System.Windows.Forms.RichTextBox
    Me.TextBox1 = New System.Windows.Forms.TextBox
    Me.Button1 = New System.Windows.Forms.Button
    Me.SuspendLayout()
    '
    'RichTextBox1
    '
    Me.RichTextBox1.Location = New System.Drawing.Point(21, 21)
    Me.RichTextBox1.Multiline = False
    Me.RichTextBox1.Name = &quot;RichTextBox1&quot;
    Me.RichTextBox1.Size = New System.Drawing.Size(479, 26)
    Me.RichTextBox1.TabIndex = 0
    Me.RichTextBox1.Text = &quot;&quot;
    '
    'TextBox1
    '
    Me.TextBox1.Location = New System.Drawing.Point(22, 61)
    Me.TextBox1.Multiline = True
    Me.TextBox1.Name = &quot;TextBox1&quot;
    Me.TextBox1.Size = New System.Drawing.Size(477, 187)
    Me.TextBox1.TabIndex = 1
    '
    'Button1
    '
    Me.Button1.Location = New System.Drawing.Point(514, 21)
    Me.Button1.Name = &quot;Button1&quot;
    Me.Button1.Size = New System.Drawing.Size(75, 23)
    Me.Button1.TabIndex = 2
    Me.Button1.Text = &quot;Button1&quot;
    Me.Button1.UseVisualStyleBackColor = True
    '
    'Form1
    '
    Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
    Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
    Me.ClientSize = New System.Drawing.Size(611, 262)
    Me.Controls.Add(Me.Button1)
    Me.Controls.Add(Me.TextBox1)
    Me.Controls.Add(Me.RichTextBox1)
    Me.Name = &quot;Form1&quot;
    Me.Text = &quot;Form1&quot;
    Me.ResumeLayout(False)
    Me.PerformLayout()

  End Sub
  Friend WithEvents RichTextBox1 As System.Windows.Forms.RichTextBox
  Friend WithEvents TextBox1 As System.Windows.Forms.TextBox
  Friend WithEvents Button1 As System.Windows.Forms.Button

End Class




2. Add the following VB.NET code to Form1: 

  Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As
System.EventArgs) Handles MyBase.Load
    TextBox1.Text = RichTextBox1.Rtf
  End Sub

  Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As
System.EventArgs) Handles Button1.Click
    RichTextBox1.Rtf = RichTextBox1.Rtf
    TextBox1.Text = RichTextBox1.Rtf
  End Sub

3. Start the programme and click the button several times. 


Actual Results:  
The textbox displays the RichTextBox.Rtf code. If run under Mono, another
&quot;/par&quot; is added at the end of the code with every button click. In the
RichTextBox line, with every button click more exclamation marks appear
(although we never entered any text to the RichTextBox!)

Expected Results:  
The RichTextBox should remain empty (instead of showing exclamation marks), and
the TextBox should always show the same .Rtf code with always exactly one
&quot;/par&quot; at the end (which is what happens if the .exe is run using .NET without
Mono). 

The reported bug appears on Windows and Mac (sorry, I could not test Linux) 

As a workaround, things work if you remove every &quot;\par&quot; tag (and every Cr/Lf
character) that precedes the concluding &quot;}&quot; in the .Rtf code before setting
RichTextBox.Rtf.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="107564.html">[Mono-bugs] [Bug 661893] TabControl draws previously focused ComboBox on wrong TabPage
</A></li>
	<LI>Next message: <A HREF="107545.html">[Mono-bugs] [Bug 661904] RichTextBox.Rtf misinterprets concluding &quot;\par&quot; when .Multiline = False and displays !! exclamation marks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#107544">[ date ]</a>
              <a href="thread.html#107544">[ thread ]</a>
              <a href="subject.html#107544">[ subject ]</a>
              <a href="author.html#107544">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
