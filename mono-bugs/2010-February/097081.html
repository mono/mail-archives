<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 575841] New: Mono.Data.Sqlite Positional parameter used twice in multi-statement command
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20575841%5D%20New%3A%20Mono.Data.Sqlite%20Positional%20parameter%0A%20used%20twice%20in%20multi-statement%20command&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="097080.html">
   <LINK REL="Next"  HREF="097082.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 575841] New: Mono.Data.Sqlite Positional parameter used twice in multi-statement command</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20575841%5D%20New%3A%20Mono.Data.Sqlite%20Positional%20parameter%0A%20used%20twice%20in%20multi-statement%20command&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 575841] New: Mono.Data.Sqlite Positional parameter used twice in multi-statement command">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Feb  1 13:39:50 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="097080.html">[Mono-bugs] [Bug 575438] &quot;Create Package&quot; Process Crashes VS
</A></li>
        <LI>Next message: <A HREF="097082.html">[Mono-bugs] [Bug 575867] New: RPM Referencing Microsoft.VisualBasic Cannot Find It
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97081">[ date ]</a>
              <a href="thread.html#97081">[ thread ]</a>
              <a href="subject.html#97081">[ subject ]</a>
              <a href="author.html#97081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=575841">http://bugzilla.novell.com/show_bug.cgi?id=575841</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=575841#c0">http://bugzilla.novell.com/show_bug.cgi?id=575841#c0</A>


           Summary: Mono.Data.Sqlite Positional parameter used twice in
                    multi-statement command
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: Macintosh
        OS/Version: Mac OS X 10.5
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Mono.Data.Sqlite
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">cfbradford at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


I have a multi-statement SQL command that contains 6 wildcard parameters
(positional, not named or numbered) but only 5 of the 6 values I add to the
Parameters collection are actually used. It seems that one of them is being
used twice.

Here is the SQL:
----------------

ExecuteNonQuery(
&quot;BEGIN; &quot;+

&quot;INSERT OR REPLACE INTO sectors (name) VALUES (?); &quot;+

&quot;INSERT OR REPLACE INTO industries (sector_id, name) &quot;+
    &quot;VALUES ((SELECT sector_id FROM sectors WHERE name = ?), ?); &quot;+

&quot;INSERT OR REPLACE INTO stocks (industry_id, ticker, name) &quot; + 
    &quot;VALUES ((SELECT industry_id FROM industries WHERE name = ?), ?, ?); &quot;+

&quot;COMMIT&quot;,

stock.SectorName, 

stock.SectorName, stock.IndustryName, // &lt;- this parameter is used twice

// The previous param is used twice! (6 wildcards, but only 5 params are used)
/*stock.IndustryName,*/ stock.Ticker, stock.Name);

(All parameters are strings)

ExecuteNonQuery is implemented as:
----------------------------------

private int ExecuteNonQuery (string commandText, params object[] parameters)
{
    Debug.Assert(commandText != null);
    Debug.Assert(parameters != null);

    using (SqliteConnection conn = new SqliteConnection(_connString))
    {
        conn.Open();

        using (SqliteCommand cmd = new SqliteCommand(commandText, conn))
        {
            foreach (object p in parameters)
            {
                cmd.Parameters.AddWithValue(null, p);
            }

            return cmd.ExecuteNonQuery();
        }
    }
}

(_connString is &quot;Data Source=/Users/chip/stocks.db&quot;)

Database Schema:
----------------

CREATE TABLE sectors (
    sector_id    INTEGER PRIMARY KEY,
    name        TEXT UNIQUE
);

CREATE TABLE industries (
    industry_id    INTEGER PRIMARY KEY,
    sector_id    INTEGER,    -- FK
    name        TEXT UNIQUE
);

CREATE TABLE stocks (
    stock_id    INTEGER PRIMARY KEY,
    industry_id    INTEGER,    -- FK
    ticker        TEXT UNIQUE,
    name        TEXT
);

(The database is initially empty when I tested this)


Expected Results:
-----------------

I would expect all 6 parameters to be required.

Actual Result:
--------------

The statement works as desired if the 4th parameter is commented out (as shown
above). Removing additional parameters causes an error (not enough parameters).

This happens to work for this particular statement since the parameter is
repeated anyway, but its certainly not a general solution.

I haven't tried using named parameters, but I would guess that would be a
work-around as well.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="097080.html">[Mono-bugs] [Bug 575438] &quot;Create Package&quot; Process Crashes VS
</A></li>
	<LI>Next message: <A HREF="097082.html">[Mono-bugs] [Bug 575867] New: RPM Referencing Microsoft.VisualBasic Cannot Find It
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97081">[ date ]</a>
              <a href="thread.html#97081">[ thread ]</a>
              <a href="subject.html#97081">[ subject ]</a>
              <a href="author.html#97081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
