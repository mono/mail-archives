<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 577139] 500 response from memorabilia.hardrock.com (under moonlight) due to message format
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20577139%5D%20500%20response%20from%20memorabilia.hardrock.com%0A%20%28under%20moonlight%29%20due%20to%20message%20format&In-Reply-To=bug-577139-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="097257.html">
   <LINK REL="Next"  HREF="097389.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 577139] 500 response from memorabilia.hardrock.com (under moonlight) due to message format</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20577139%5D%20500%20response%20from%20memorabilia.hardrock.com%0A%20%28under%20moonlight%29%20due%20to%20message%20format&In-Reply-To=bug-577139-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 577139] 500 response from memorabilia.hardrock.com (under moonlight) due to message format">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Feb  9 21:45:21 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="097257.html">[Mono-bugs] [Bug 577139] 500 response from memorabilia.hardrock.com (under moonlight) due to message format
</A></li>
        <LI>Next message: <A HREF="097389.html">[Mono-bugs] [Bug 577139] 500 response from memorabilia.hardrock.com (under moonlight) due to message format
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97335">[ date ]</a>
              <a href="thread.html#97335">[ thread ]</a>
              <a href="subject.html#97335">[ subject ]</a>
              <a href="author.html#97335">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=577139">http://bugzilla.novell.com/show_bug.cgi?id=577139</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=577139#c2">http://bugzilla.novell.com/show_bug.cgi?id=577139#c2</A>


--- Comment #2 from Atsushi Enomoto &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">aenomoto at novell.com</A>&gt; 2010-02-10 02:45:19 UTC ---
Created an attachment (id=341658)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=341658">http://bugzilla.novell.com/attachment.cgi?id=341658</A>)
verifier

After r151087, our svcutil tool can generate working client proxy from
<A HREF="http://memorabilia.hardrock.com/MemoService.svc?wsdl">http://memorabilia.hardrock.com/MemoService.svc?wsdl</A> which is easy to debug.
With &quot;driver.cs&quot; below, .NET successfully processes GetCollectionData()
requests i.e. the proxy code is valid.

The *attached* code contains a sample binary output from request to memorabilia
in .NET WCF (The binary buffer can be retrieved by simple http listener below).
The attached code reads that .NET buffer as binary XML, and stores it into
XmlDocument, then outputs as binary XML. It does *not* roundtrip, but the
/output is now completely identical between Mono and .NET.

The only difference between mono and .NET I can see there is, .NET writes the
request in some &quot;shorter but semantically identical&quot; binary format (as .NET
outputs the binary what mono also does from the same binary input). So it's not
very intuitive issue.

// listener.cs ----
using System;
using System.IO;
using System.Net;
using System.ServiceModel;
using System.ServiceModel.Channels;

public class Test
{
        public static void Main ()
        {
                var l = new HttpListener ();
                l.Prefixes.Add (&quot;<A HREF="http://localhost:8080/&quot;">http://localhost:8080/&quot;</A>);
                l.Start ();
                var ctx = l.GetContext ();
                var enc = new BinaryMessageEncodingBindingElement
().CreateMessageEncoderFactory ().Encoder;
                var stream = ctx.Request.InputStream;
                //var msg = enc.ReadMessage (stream, 0x1000,
&quot;application/soap+msbin1&quot;);
                //Console.WriteLine (msg);
                byte [] buf = new byte [10000];
                int size = stream.Read (buf, 0, 10000);
                for (int i = 0; i &lt; size; i++)
                        Console.Write (&quot;{0:X02}{1}&quot;, buf [i], i % 16 == 15 ?
&quot;\n&quot; : &quot; &quot;);
        }
}


// driver.cs ----
using System;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Description;
using System.ServiceModel.Dispatcher;

public class Test
{
    public static void Main ()
    {
        var binding = new CustomBinding (
            new BinaryMessageEncodingBindingElement (),
            new HttpTransportBindingElement () {
                MaxReceivedMessageSize = 0x100000});
        Console.WriteLine
(binding.CanBuildChannelFactory&lt;IRequestSessionChannel&gt; ());
        //var address = new EndpointAddress
(&quot;<A HREF="http://memorabilia.hardrock.com/MemoService.svc&quot;">http://memorabilia.hardrock.com/MemoService.svc&quot;</A>);
        var address = new EndpointAddress (&quot;<A HREF="http://localhost:8080&quot;">http://localhost:8080&quot;</A>);
        var cli = new MemoServiceClient (binding, address);
        cli.Endpoint.Behaviors.Add (new Behavior ());
        cli.GetCollectionData ();
    }
}

public class Inspector : IClientMessageInspector
{
    public void AfterReceiveReply (ref Message reply, object correlationState)
    {
    }

    public object BeforeSendRequest (ref Message request, IClientChannel
channel)
    {
Console.WriteLine (channel.OutputSession);
        var mb = request.CreateBufferedCopy (0x10000);
        request = mb.CreateMessage ();
        Console.WriteLine (mb.CreateMessage ());
        return new object ();
    }
}

public class Behavior : IEndpointBehavior
{
    public void AddBindingParameters (ServiceEndpoint endpoint,
BindingParameterCollection bindingParameters) {}
    public void ApplyClientBehavior (ServiceEndpoint endpoint, ClientRuntime
clientRuntime)
    {
        clientRuntime.MessageInspectors.Add (new Inspector ());
    }
    public void ApplyDispatchBehavior (ServiceEndpoint endpoint,
EndpointDispatcher endpointDispatcher) {}
    public void Validate (ServiceEndpoint endpoint) {}
}

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="097257.html">[Mono-bugs] [Bug 577139] 500 response from memorabilia.hardrock.com (under moonlight) due to message format
</A></li>
	<LI>Next message: <A HREF="097389.html">[Mono-bugs] [Bug 577139] 500 response from memorabilia.hardrock.com (under moonlight) due to message format
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97335">[ date ]</a>
              <a href="thread.html#97335">[ thread ]</a>
              <a href="subject.html#97335">[ subject ]</a>
              <a href="author.html#97335">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
