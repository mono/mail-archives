<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 582838] New: DataAdapter sends null values to database in the Update method.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20582838%5D%20New%3A%20DataAdapter%20sends%20null%20values%20to%0A%20database%20in%20the%20Update%20method.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="097775.html">
   <LINK REL="Next"  HREF="097778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 582838] New: DataAdapter sends null values to database in the Update method.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20582838%5D%20New%3A%20DataAdapter%20sends%20null%20values%20to%0A%20database%20in%20the%20Update%20method.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 582838] New: DataAdapter sends null values to database in the Update method.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Feb 24 13:25:47 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="097775.html">[Mono-bugs] [Bug 582823] New: ArgumentOutOfRange in DelegatesPassedToNativeCodeMustIncludeExceptionHandlingRule
</A></li>
        <LI>Next message: <A HREF="097778.html">[Mono-bugs] [Bug 582838] DataAdapter sends null values to database in the Update method.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97777">[ date ]</a>
              <a href="thread.html#97777">[ thread ]</a>
              <a href="subject.html#97777">[ subject ]</a>
              <a href="author.html#97777">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=582838">http://bugzilla.novell.com/show_bug.cgi?id=582838</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=582838#c0">http://bugzilla.novell.com/show_bug.cgi?id=582838#c0</A>


           Summary: DataAdapter sends null values to database in the
                    Update method.
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: Sys.Data
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">kuritsu at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=344554)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=344554">http://bugzilla.novell.com/attachment.cgi?id=344554</A>)
This a MonoDevelop project with the test case.

User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; es-MX; rv:1.9.1.5)
Gecko/20091109 Ubuntu/9.10 (karmic) Firefox/3.5.5

I have an SqliteDataAdapter instance (and also tried with OracleDataAdapter)
with a connection and select command. I also have a Sqlite database with a
table with several rows not null. When I use the adapter.Fill method it fills a
DataSet correctly. But, after I insert a new row in the dataset with non null
columns, and then call the adapter.Update method, all the column values are
lost and the table has a new row with all columns null (except the one that is
autonumeric).

Reproducible: Always

Steps to Reproduce:
1. Create a C# console project in MonoDevelop.
2. Add references to Mono.Data.Sqlite and System.Data.
3. Add usings to Mono.Data.Sqlite and System.Data.
4. Put the following code in the Main method of the main class:

SqliteConnection connection = new SqliteConnection(&quot;Data
Source=MySqliteSample.db&quot;);
SqliteDataAdapter adapter = new SqliteDataAdapter(&quot;SELECT ID, Name FROM
sampletable&quot;, 
                                                  connection);
DataSet dataSet = new DataSet();
adapter.Fill(dataSet);
Console.WriteLine (&quot;Original dataset: &quot;);
dataSet.Tables[0].WriteXml(Console.Out);
dataSet.Tables[0].LoadDataRow(new object[]{3, &quot;Jeff&quot;}, false);
adapter.InsertCommand = new SqliteCommand(&quot;INSERT INTO sampletable (ID, Name)
VALUES (@ID, @Name)&quot;, connection);
adapter.InsertCommand.Parameters.Add(&quot;@ID&quot;, DbType.Int32);
adapter.InsertCommand.Parameters[0].SourceColumn = &quot;ID&quot;;
adapter.InsertCommand.Parameters.Add(&quot;@Name&quot;, DbType.String);
adapter.InsertCommand.Parameters[1].SourceColumn = &quot;Name&quot;;
adapter.Update(dataSet);
dataSet = new DataSet();
adapter.Fill(dataSet);
Console.WriteLine (Environment.NewLine + Environment.NewLine + &quot;New dataset:
&quot;);
dataSet.Tables[0].WriteXml(Console.Out);

5. Create a new Sqlite database with name MySqliteSample.db using this script:

BEGIN TRANSACTION;
CREATE TABLE &quot;SampleTable&quot; (
    &quot;ID&quot; INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
    &quot;Name&quot; TEXT
);
INSERT INTO &quot;SampleTable&quot; VALUES(1,'Dave');
INSERT INTO &quot;SampleTable&quot; VALUES(2,'Alice');
DELETE FROM sqlite_sequence;
INSERT INTO &quot;sqlite_sequence&quot; VALUES('SampleTable',2);
COMMIT;

6. Compile the project and put the database in the output folder (bin/Debug).

7. Run the project and check the output.
Actual Results:  
This is the console output:

Original dataset: 
&lt;NewDataSet&gt;
  &lt;Table&gt;
    &lt;ID&gt;1&lt;/ID&gt;
    &lt;Name&gt;Dave&lt;/Name&gt;
  &lt;/Table&gt;
  &lt;Table&gt;
    &lt;ID&gt;2&lt;/ID&gt;
    &lt;Name&gt;Alice&lt;/Name&gt;
  &lt;/Table&gt;
&lt;/NewDataSet&gt;

New dataset after insert: 
&lt;NewDataSet&gt;
  &lt;Table&gt;
    &lt;ID&gt;1&lt;/ID&gt;
    &lt;Name&gt;Dave&lt;/Name&gt;
  &lt;/Table&gt;
  &lt;Table&gt;
    &lt;ID&gt;2&lt;/ID&gt;
    &lt;Name&gt;Alice&lt;/Name&gt;
  &lt;/Table&gt;
  &lt;Table&gt;
    &lt;ID&gt;3&lt;/ID&gt;
  &lt;/Table&gt;
&lt;/NewDataSet&gt;

As you can see, the 3rd row has no Name column, so it's null.

Expected Results:  
This is what the console should output:

Original dataset: 
&lt;NewDataSet&gt;
  &lt;Table&gt;
    &lt;ID&gt;1&lt;/ID&gt;
    &lt;Name&gt;Dave&lt;/Name&gt;
  &lt;/Table&gt;
  &lt;Table&gt;
    &lt;ID&gt;2&lt;/ID&gt;
    &lt;Name&gt;Alice&lt;/Name&gt;
  &lt;/Table&gt;
&lt;/NewDataSet&gt;

New dataset after insert: 
&lt;NewDataSet&gt;
  &lt;Table&gt;
    &lt;ID&gt;1&lt;/ID&gt;
    &lt;Name&gt;Dave&lt;/Name&gt;
  &lt;/Table&gt;
  &lt;Table&gt;
    &lt;ID&gt;2&lt;/ID&gt;
    &lt;Name&gt;Alice&lt;/Name&gt;
  &lt;/Table&gt;
  &lt;Table&gt;
    &lt;ID&gt;3&lt;/ID&gt;
    &lt;Name&gt;Jeff&lt;/Name&gt;
  &lt;/Table&gt;
&lt;/NewDataSet&gt;

Notice the 3rd row is complete, including Jeff in the Name column.

Remember to install Sqlite to run the test project.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="097775.html">[Mono-bugs] [Bug 582823] New: ArgumentOutOfRange in DelegatesPassedToNativeCodeMustIncludeExceptionHandlingRule
</A></li>
	<LI>Next message: <A HREF="097778.html">[Mono-bugs] [Bug 582838] DataAdapter sends null values to database in the Update method.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97777">[ date ]</a>
              <a href="thread.html#97777">[ thread ]</a>
              <a href="subject.html#97777">[ subject ]</a>
              <a href="author.html#97777">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
