<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 575813] New: FileStream doesn't handle errors on Close (disk full, generic error, etc.)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20575813%5D%20New%3A%20FileStream%20doesn%27t%20handle%20errors%20on%0A%20Close%20%28disk%20full%2C%20generic%20error%2C%20etc.%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="097076.html">
   <LINK REL="Next"  HREF="097222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 575813] New: FileStream doesn't handle errors on Close (disk full, generic error, etc.)</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20575813%5D%20New%3A%20FileStream%20doesn%27t%20handle%20errors%20on%0A%20Close%20%28disk%20full%2C%20generic%20error%2C%20etc.%29&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 575813] New: FileStream doesn't handle errors on Close (disk full, generic error, etc.)">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Feb  1 12:27:22 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="097076.html">[Mono-bugs] [Bug 567428] Soap Headers dont appear to be passing to	webservice
</A></li>
        <LI>Next message: <A HREF="097222.html">[Mono-bugs] [Bug 575813] FileStream doesn't handle errors on Close (disk full, generic error, etc.)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97078">[ date ]</a>
              <a href="thread.html#97078">[ thread ]</a>
              <a href="subject.html#97078">[ subject ]</a>
              <a href="author.html#97078">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=575813">http://bugzilla.novell.com/show_bug.cgi?id=575813</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=575813#c0">http://bugzilla.novell.com/show_bug.cgi?id=575813#c0</A>


           Summary: FileStream doesn't handle errors on Close (disk full,
                    generic error, etc.)
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.4.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">alexander.shulgin at yessoftware.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/532.5
(KHTML, like Gecko) Chrome/4.0.249.43 Safari/532.5

When writing to a FileStream or using File.WriteAll* methods, or otherwise
writing data to a file, if a error condition occurs at the point close(2)
system call it is silently ignored.  The trailing data in the file is lost.

The error can happen on conditions like &quot;disk is full&quot;, exceeding user's quota,
etc.


Reproducible: Always

Steps to Reproduce:
One way to expose this (on Linux):

$ dd if=/dev/zero of=vdisk bs=1024 count=1000
$ mkfs.vfat ./vdisk
$ mkdir mnt
$ sudo -s

# mount -o loop,defaults ./vdisk ./mnt
# csharp

csharp&gt; var bytes = new byte[1024*1024];
csharp&gt; bytes.Length;
1048576
csharp&gt; System.IO.File.WriteAllBytes(&quot;test&quot;, bytes);
^D

# ls -l
total 980
-rwxr-xr-x 1 root root 1003520 2010-02-01 16:30 test

So not all the data is written to disk and no error message is given.  I'd
expect some diagnostics from Mono (in form of exception) in this case.

The root cause for this seems to be that close(2) return value is ignored in
void file_close() in mono/io-layer/io.c.

The problem must also happen with SVN trunk, as this function is unchanged from
2.4.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="097076.html">[Mono-bugs] [Bug 567428] Soap Headers dont appear to be passing to	webservice
</A></li>
	<LI>Next message: <A HREF="097222.html">[Mono-bugs] [Bug 575813] FileStream doesn't handle errors on Close (disk full, generic error, etc.)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97078">[ date ]</a>
              <a href="thread.html#97078">[ thread ]</a>
              <a href="subject.html#97078">[ subject ]</a>
              <a href="author.html#97078">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
