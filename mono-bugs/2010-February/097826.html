<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 583501] New: generic sharing causes crash on some dynamically generated method(?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20583501%5D%20New%3A%20generic%20sharing%20causes%20crash%20on%20some%0A%20dynamically%20generated%20method%28%3F%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="097825.html">
   <LINK REL="Next"  HREF="097827.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 583501] New: generic sharing causes crash on some dynamically generated method(?)</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20583501%5D%20New%3A%20generic%20sharing%20causes%20crash%20on%20some%0A%20dynamically%20generated%20method%28%3F%29&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 583501] New: generic sharing causes crash on some dynamically generated method(?)">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Feb 25 21:18:36 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="097825.html">[Mono-bugs] [Bug 580420] MonoDevelop crashes during launch on Mac OS 10.4.11 PPC (no feedback/ error dialog)
</A></li>
        <LI>Next message: <A HREF="097827.html">[Mono-bugs] [Bug 583501] generic sharing causes crash on some dynamically generated method(?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97826">[ date ]</a>
              <a href="thread.html#97826">[ thread ]</a>
              <a href="subject.html#97826">[ subject ]</a>
              <a href="author.html#97826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=583501">http://bugzilla.novell.com/show_bug.cgi?id=583501</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=583501#c0">http://bugzilla.novell.com/show_bug.cgi?id=583501#c0</A>


           Summary: generic sharing causes crash on some dynamically
                    generated method(?)
    Classification: Mono
           Product: Mono: Runtime
           Version: SVN
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Minor
          Priority: P5 - None
         Component: generics
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">aenomoto at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Generic sharing seems to report some mysterious error as compared to when GS is
disabled.

The problematic type in use is dynamically generated by SRE and has
insufficient interface implementation. When GS is disabled, it exactly reports
what's missing. With GS enabled, the runtime just crashes reporting assertion
failure.

The example repro requires r152519 of mcs/class/System.ServiceModel (this may
be fixed by having &quot;correct&quot; implementation of the problematic type).

Repro:

The example repro uses WCF client proxy, and happens only when you build
System.ServiceModel.dll with -/d:USE_OD_REFERENCE_IN_PROXY option. So, add the
compiler option to LIB_MCS_FLAGS in the Makefile and build it first.

Then compile and run below (it is taken from our
CallbackBehaviorAttributeTest):

// ---- repro ----
using System;
using System.Threading;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Description;

class Test
{
    public static bool CallbackSent, CallbackReceived;

    public static void Main ()
    {
            ServiceHost eventServiceHost = new ServiceHost (typeof
(GreetingsService));
            NetTcpBinding tcpBindingpublish = new NetTcpBinding ();
            tcpBindingpublish.Security.Mode = SecurityMode.None;
            eventServiceHost.AddServiceEndpoint (typeof (IGreetings),
tcpBindingpublish, &quot;net.<A HREF="tcp://localhost:8000/GreetingsService&quot;">tcp://localhost:8000/GreetingsService&quot;</A>);
            eventServiceHost.Open ();

            //Create client proxy
            NetTcpBinding clientBinding = new NetTcpBinding ();
            clientBinding.Security.Mode = SecurityMode.None;
            EndpointAddress ep = new EndpointAddress
(&quot;net.<A HREF="tcp://localhost:8000/GreetingsService&quot;">tcp://localhost:8000/GreetingsService&quot;</A>);
            ClientCallback cb = new ClientCallback ();
            IGreetings proxy = DuplexChannelFactory&lt;IGreetings&gt;.CreateChannel
(new InstanceContext (cb), clientBinding, ep);

            //Call service
            proxy.SendMessage ();

            //Wait for callback - sort of hack, but better than using wait
handle to possibly block tests.
            Thread.Sleep (1000);

            //Cleanup
            eventServiceHost.Close ();

    }
}

Actual result:

ERROR:generic-sharing.c:712:class_get_rgctx_template_oti: assertion failed:
(oti)

Expected result:
show an error dialog saying I'm missing some interface implementations on the
dynamically generated code.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="097825.html">[Mono-bugs] [Bug 580420] MonoDevelop crashes during launch on Mac OS 10.4.11 PPC (no feedback/ error dialog)
</A></li>
	<LI>Next message: <A HREF="097827.html">[Mono-bugs] [Bug 583501] generic sharing causes crash on some dynamically generated method(?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97826">[ date ]</a>
              <a href="thread.html#97826">[ thread ]</a>
              <a href="subject.html#97826">[ subject ]</a>
              <a href="author.html#97826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
