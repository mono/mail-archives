<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 582428] New: ResXResourceWriter does not recreate resource file, instead writes in file and leaves inconsistent XML. Also forgets to write resource comments.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20582428%5D%20New%3A%20ResXResourceWriter%20does%20not%20recreate%0A%20resource%20file%2C%0A%20instead%20writes%20in%20file%20and%20leaves%20inconsistent%20XML.%20Also%20forgets%20to%20write%0A%20resource%20comments.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="097773.html">
   <LINK REL="Next"  HREF="097739.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 582428] New: ResXResourceWriter does not recreate resource file, instead writes in file and leaves inconsistent XML. Also forgets to write resource comments.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20582428%5D%20New%3A%20ResXResourceWriter%20does%20not%20recreate%0A%20resource%20file%2C%0A%20instead%20writes%20in%20file%20and%20leaves%20inconsistent%20XML.%20Also%20forgets%20to%20write%0A%20resource%20comments.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 582428] New: ResXResourceWriter does not recreate resource file, instead writes in file and leaves inconsistent XML. Also forgets to write resource comments.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Feb 23 16:07:33 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="097773.html">[Mono-bugs] [Bug 582369] Passing Action&lt;T&gt; delegate parameter causes compile error
</A></li>
        <LI>Next message: <A HREF="097739.html">[Mono-bugs] [Bug 582428] ResXResourceWriter does not recreate resource file, instead writes in file and leaves inconsistent XML. Also forgets to write resource comments.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97738">[ date ]</a>
              <a href="thread.html#97738">[ thread ]</a>
              <a href="subject.html#97738">[ subject ]</a>
              <a href="author.html#97738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=582428">http://bugzilla.novell.com/show_bug.cgi?id=582428</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=582428#c0">http://bugzilla.novell.com/show_bug.cgi?id=582428#c0</A>


           Summary: ResXResourceWriter does not recreate resource file,
                    instead writes in file and leaves inconsistent XML.
                    Also forgets to write resource comments.
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: Windows.Forms
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">kuritsu at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=344229)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=344229">http://bugzilla.novell.com/attachment.cgi?id=344229</A>)
Test Case which shows the bug.

User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; es-MX; rv:1.9.1.5)
Gecko/20091109 Ubuntu/9.10 (karmic) Firefox/3.5.5

The class ResXResourceWriter does not recreate a resx file when using the
ResXResourceWriter(string fileName) constructor overload. Instead, it opens for
writing a file (creates it if the file doesn't exist), writes the resources
without comments and leaves the resx in an inconsistent state of XML schema.

Reproducible: Always

Steps to Reproduce:
1. Create a C# console application using MonoDevelop.
2. Add System.Windows.Forms as reference.
3. Add System.Resources and System.IO in the usings section.
4. In the Main method of the main class of the project, copy and paste the
following code:

    ResXResourceWriter writer = new ResXResourceWriter(&quot;Resources.resx&quot;);
    ResXDataNode node = new ResXDataNode(&quot;key1&quot;, &quot;value1&quot;);
    node.Comment = &quot;comment1&quot;;
    writer.AddResource(node);
    node = new ResXDataNode(&quot;key2&quot;, &quot;value2&quot;);
    node.Comment = &quot;comment2&quot;;
    writer.AddResource(node);
    writer.Close();
    File.Copy(&quot;Resources.resx&quot;, &quot;Resources2.resx&quot;);
    writer = new ResXResourceWriter(&quot;Resources2.resx&quot;);
    node = new ResXDataNode(&quot;k1&quot;, &quot;v1&quot;);
    node.Comment = &quot;c1&quot;;
    writer.AddResource(node);
    node = new ResXDataNode(&quot;k2&quot;, &quot;v2&quot;);
    node.Comment = &quot;c2&quot;;
    writer.AddResource(node);
    writer.Close();
5. Check the two resulting files, Resources.resx and Resources2.resx.
Actual Results:  
The Resources2.resx file is the following:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;root&gt;
  &lt;xsd:schema id=&quot;root&quot; xmlns=&quot;&quot; xmlns:xsd=&quot;<A HREF="http://www.w3.org/2001/XMLSchema&quot;">http://www.w3.org/2001/XMLSchema&quot;</A>
xmlns:msdata=&quot;urn:schemas-microsoft-com:xml-msdata&quot;&gt;
    &lt;xsd:element name=&quot;root&quot; msdata:IsDataSet=&quot;true&quot;&gt;
      &lt;xsd:complexType&gt;
        &lt;xsd:choice maxOccurs=&quot;unbounded&quot;&gt;
          &lt;xsd:element name=&quot;data&quot;&gt;
            &lt;xsd:complexType&gt;
              &lt;xsd:sequence&gt;
                &lt;xsd:element name=&quot;value&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
msdata:Ordinal=&quot;1&quot; /&gt;
                &lt;xsd:element name=&quot;comment&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
msdata:Ordinal=&quot;2&quot; /&gt;
              &lt;/xsd:sequence&gt;
              &lt;xsd:attribute name=&quot;name&quot; type=&quot;xsd:string&quot; msdata:Ordinal=&quot;1&quot;
/&gt;
              &lt;xsd:attribute name=&quot;type&quot; type=&quot;xsd:string&quot; msdata:Ordinal=&quot;3&quot;
/&gt;
              &lt;xsd:attribute name=&quot;mimetype&quot; type=&quot;xsd:string&quot;
msdata:Ordinal=&quot;4&quot; /&gt;
            &lt;/xsd:complexType&gt;
          &lt;/xsd:element&gt;
          &lt;xsd:element name=&quot;resheader&quot;&gt;
            &lt;xsd:complexType&gt;
              &lt;xsd:sequence&gt;
                &lt;xsd:element name=&quot;value&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
msdata:Ordinal=&quot;1&quot; /&gt;
              &lt;/xsd:sequence&gt;
              &lt;xsd:attribute name=&quot;name&quot; type=&quot;xsd:string&quot; use=&quot;required&quot; /&gt;
            &lt;/xsd:complexType&gt;
          &lt;/xsd:element&gt;
        &lt;/xsd:choice&gt;
      &lt;/xsd:complexType&gt;
    &lt;/xsd:element&gt;
  &lt;/xsd:schema&gt;
&lt;resheader
name=&quot;resmimetype&quot;&gt;&lt;value&gt;text/microsoft-resx&lt;/value&gt;&lt;/resheader&gt;&lt;resheader
name=&quot;version&quot;&gt;&lt;value&gt;1.3&lt;/value&gt;&lt;/resheader&gt;&lt;resheader
name=&quot;reader&quot;&gt;&lt;value&gt;System.Resources.ResXResourceReader, System.Windows.Forms,
Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b77a5c561934e089&lt;/value&gt;&lt;/resheader&gt;&lt;resheader
name=&quot;writer&quot;&gt;&lt;value&gt;System.Resources.ResXResourceWriter, System.Windows.Forms,
Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b77a5c561934e089&lt;/value&gt;&lt;/resheader&gt;&lt;data
name=&quot;k1&quot;&gt;&lt;value&gt;v1&lt;/value&gt;&lt;/data&gt;
  &lt;data name=&quot;k2&quot;&gt;&lt;value&gt;v2&lt;/value&gt;&lt;/data&gt;
  &lt;/root&gt;a&gt;
  &lt;/root&gt;me=&quot;key3&quot;&gt;&lt;value&gt;value3&lt;/value&gt;&lt;/data&gt;
  &lt;/root&gt;

Check how the root document element ends and then the file continues with the
original characters from Resources.resx, leaving an inconsistent XML. Note
there's no comment tags also.

Expected Results:  
The resulting Resources2.resx should have being like this:
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;root&gt;
  &lt;xsd:schema id=&quot;root&quot; xmlns=&quot;&quot; xmlns:xsd=&quot;<A HREF="http://www.w3.org/2001/XMLSchema&quot;">http://www.w3.org/2001/XMLSchema&quot;</A>
xmlns:msdata=&quot;urn:schemas-microsoft-com:xml-msdata&quot;&gt;
    &lt;xsd:element name=&quot;root&quot; msdata:IsDataSet=&quot;true&quot;&gt;
      &lt;xsd:complexType&gt;
        &lt;xsd:choice maxOccurs=&quot;unbounded&quot;&gt;
          &lt;xsd:element name=&quot;data&quot;&gt;
            &lt;xsd:complexType&gt;
              &lt;xsd:sequence&gt;
                &lt;xsd:element name=&quot;value&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
msdata:Ordinal=&quot;1&quot; /&gt;
                &lt;xsd:element name=&quot;comment&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
msdata:Ordinal=&quot;2&quot; /&gt;
              &lt;/xsd:sequence&gt;
              &lt;xsd:attribute name=&quot;name&quot; type=&quot;xsd:string&quot; msdata:Ordinal=&quot;1&quot;
/&gt;
              &lt;xsd:attribute name=&quot;type&quot; type=&quot;xsd:string&quot; msdata:Ordinal=&quot;3&quot;
/&gt;
              &lt;xsd:attribute name=&quot;mimetype&quot; type=&quot;xsd:string&quot;
msdata:Ordinal=&quot;4&quot; /&gt;
            &lt;/xsd:complexType&gt;
          &lt;/xsd:element&gt;
          &lt;xsd:element name=&quot;resheader&quot;&gt;
            &lt;xsd:complexType&gt;
              &lt;xsd:sequence&gt;
                &lt;xsd:element name=&quot;value&quot; type=&quot;xsd:string&quot; minOccurs=&quot;0&quot;
msdata:Ordinal=&quot;1&quot; /&gt;
              &lt;/xsd:sequence&gt;
              &lt;xsd:attribute name=&quot;name&quot; type=&quot;xsd:string&quot; use=&quot;required&quot; /&gt;
            &lt;/xsd:complexType&gt;
          &lt;/xsd:element&gt;
        &lt;/xsd:choice&gt;
      &lt;/xsd:complexType&gt;
    &lt;/xsd:element&gt;
  &lt;/xsd:schema&gt;
&lt;resheader
name=&quot;resmimetype&quot;&gt;&lt;value&gt;text/microsoft-resx&lt;/value&gt;&lt;/resheader&gt;&lt;resheader
name=&quot;version&quot;&gt;&lt;value&gt;1.3&lt;/value&gt;&lt;/resheader&gt;
&lt;resheader name=&quot;reader&quot;&gt;&lt;value&gt;System.Resources.ResXResourceReader,
System.Windows.Forms, Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b77a5c561934e089&lt;/value&gt;&lt;/resheader&gt;&lt;resheader
name=&quot;writer&quot;&gt;&lt;value&gt;System.Resources.ResXResourceWriter, System.Windows.Forms,
Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b77a5c561934e089&lt;/value&gt;&lt;/resheader&gt;
&lt;data name=&quot;k1&quot;&gt;&lt;value&gt;v1&lt;/value&gt;&lt;comment&gt;c1&lt;/comment&gt;&lt;/data&gt;
  &lt;data name=&quot;k2&quot;&gt;&lt;value&gt;v2&lt;/value&gt;&lt;comment&gt;c2&lt;/comment&gt;&lt;/data&gt;
  &lt;/root&gt;

Check that the document ends normally and the comment tags are included.

This bug causes also to fail ResXResourceReader from reading the inconsistent
file.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="097773.html">[Mono-bugs] [Bug 582369] Passing Action&lt;T&gt; delegate parameter causes compile error
</A></li>
	<LI>Next message: <A HREF="097739.html">[Mono-bugs] [Bug 582428] ResXResourceWriter does not recreate resource file, instead writes in file and leaves inconsistent XML. Also forgets to write resource comments.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97738">[ date ]</a>
              <a href="thread.html#97738">[ thread ]</a>
              <a href="subject.html#97738">[ subject ]</a>
              <a href="author.html#97738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
