<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 580185] New: assembly version redirection fails to work properly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20580185%5D%20New%3A%20assembly%20version%20redirection%20fails%20to%0A%20work%20properly&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="097453.html">
   <LINK REL="Next"  HREF="097468.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 580185] New: assembly version redirection fails to work properly</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20580185%5D%20New%3A%20assembly%20version%20redirection%20fails%20to%0A%20work%20properly&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 580185] New: assembly version redirection fails to work properly">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Feb 16 08:29:04 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="097453.html">[Mono-bugs] [Bug 468658] System.Configuration: Application Scope settings are saved in user.config
</A></li>
        <LI>Next message: <A HREF="097468.html">[Mono-bugs] [Bug 580185] assembly version redirection fails to work	properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97454">[ date ]</a>
              <a href="thread.html#97454">[ thread ]</a>
              <a href="subject.html#97454">[ subject ]</a>
              <a href="author.html#97454">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=580185">http://bugzilla.novell.com/show_bug.cgi?id=580185</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=580185#c0">http://bugzilla.novell.com/show_bug.cgi?id=580185#c0</A>


           Summary: assembly version redirection fails to work properly
    Classification: Mono
           Product: Mono: Runtime
           Version: unspecified
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Community User
           Blocker: ---


Created an attachment (id=342647)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=342647">http://bugzilla.novell.com/attachment.cgi?id=342647</A>)
extatica.zip

The attached test application results in the following error when run:

-----------------
System.InvalidCastException: Cannot cast from source type to destination type.
  at System.Web.UI.ScriptManager.GetCurrent (System.Web.UI.Page page) [0x00011]
in
/home/src/build/mono/mcs/class/System.Web.Extensions/System.Web.UI/ScriptManager.cs:398 
  at (wrapper managed-to-native) System.Reflection.MonoMethod:InternalInvoke
(System.Reflection.MonoMethod*,object,object[],System.Exception&amp;)
  at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags
invokeAttr, System.Reflection.Binder binder, System.Object[] parameters,
System.Globalization.CultureInfo culture) [0x000d0] in
/home/src/build/mono/mcs/class/corlib/System.Reflection/MonoMethod.cs:217 
------------------

The attached application redirects System.Web.Extensions 1.0.61025.0 to
3.5.0.0:

-----------------
&lt;runtime&gt;
  &lt;assemblyBinding xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot;&gt;
     &lt;dependentAssembly&gt;
        &lt;assemblyIdentity name=&quot;System.Web.Extensions&quot;
publicKeyToken=&quot;31bf3856ad364e35&quot;/&gt;
        &lt;bindingRedirect oldVersion=&quot;1.0.0.0-1.1.0.0&quot; newVersion=&quot;3.5.0.0&quot;/&gt;
     &lt;/dependentAssembly&gt;
  &lt;/assemblyBinding&gt;
&lt;/runtime&gt;
-----------------

The problem is this code from
System.Web.Extensions/System.Web.UI/ScriptManager.cs:

-----------------
    public static ScriptManager GetCurrent (Page page) {
        if (page == null)
            throw new ArgumentNullException (&quot;page&quot;);
        return (ScriptManager) page.Items [ScriptManagerKey];
    }
-----------------

Bin/ExtExtenders.dll references System.Web.Extensions 1.0.61025.0, while the
rest of the application is linked with System.Web.Extensions 3.5.0.0. The
method shown above, though, is loaded from the 1.0.61025.0 assembly and when
it's running, the following is true:

typeof (ScriptManager).AssemblyQualifiedName == System.Web.UI.ScriptManager,
System.Web.Extensions, Version=1.0.61025.0, Culture=neutral,
PublicKeyToken=31bf3856ad364e35

while the ScriptManager instance stored in page.Items comes from the 3.5.0.0
assembly:

page.Items [System.Web.UI.IScriptManager] == System.Web.UI.ScriptManager,
System.Web.Extensions, Version=3.5.0.0, Culture=neutral,
PublicKeyToken=31bf3856ad364e35

And therefore the cast fails. Runtime should never load any types from the
1.0.61025.0 version of the System.Web.Extensions assembly - they should be
redirected to their 3.5.0.0 counterparts. The workaround is to recompile the
Bin/ExtExtenders.dll assembly with System.Web.Extensions 3.5.0.0

The application works fine on .NET

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="097453.html">[Mono-bugs] [Bug 468658] System.Configuration: Application Scope settings are saved in user.config
</A></li>
	<LI>Next message: <A HREF="097468.html">[Mono-bugs] [Bug 580185] assembly version redirection fails to work	properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#97454">[ date ]</a>
              <a href="thread.html#97454">[ thread ]</a>
              <a href="subject.html#97454">[ subject ]</a>
              <a href="author.html#97454">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
