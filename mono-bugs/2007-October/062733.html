<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 332246] New: Strange problem in Mono's XML and/or	XSLT code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20332246%5D%20New%3A%20Strange%20problem%20in%20Mono%27s%20XML%20and/or%0A%09XSLT%20code&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="063174.html">
   <LINK REL="Next"  HREF="062759.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 332246] New: Strange problem in Mono's XML and/or	XSLT code</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20332246%5D%20New%3A%20Strange%20problem%20in%20Mono%27s%20XML%20and/or%0A%09XSLT%20code&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 332246] New: Strange problem in Mono's XML and/or	XSLT code">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Oct  9 11:34:45 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="063174.html">[Mono-bugs] [Bug 332206] System.Threading.Timer stop on excecption in callback method
</A></li>
        <LI>Next message: <A HREF="062759.html">[Mono-bugs] [Bug 332246] Strange problem in Mono's XML and/or XSLT	code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62733">[ date ]</a>
              <a href="thread.html#62733">[ thread ]</a>
              <a href="subject.html#62733">[ subject ]</a>
              <a href="author.html#62733">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=332246">https://bugzilla.novell.com/show_bug.cgi?id=332246</A>

           Summary: Strange problem in Mono's XML and/or XSLT code
           Product: Mono: Class Libraries
           Version: unspecified
          Platform: x86
        OS/Version: SLED 10
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.XML
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">tlillqvist at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: ---


We are having some odd problems when we build odf-converter with
Mono. The problems show up the same way both on Windows and Linux. I
have verified them today with a fresh Mono built from SVN. 

(Running odf-converter with .NET works fine.)

(odf-converter is the XSLT-based tool that converts between
OpenDocument formats and Microsoft's OfficeOpen XML formats. We ship
odf-converter as an extension to the Novell Edition of OpenOffice.org,
until the native built-in OOXML filters we are working on are complete
enough.)

I am reporting two related (?) things here:

Adding a single non-significant (as far as I know) space in one of the
xml files that a .ods file contains makes the program behave
differently. Without the space odf-converter stops with an exception:

This XmlWriter does not accept EndElement at this state Error.(  at
System.Xml.XmlTextWriter.WriteEndElementCore (Boolean full)
 at System.Xml.XmlTextWriter.WriteEndElement ()
 at System.Xml.XmlTextWriter.Close ()

(rest of stack is the odf-converter code)

Another issue is then that if I insert that one space and the
odf-converter then runs to a normal finish, some of the .xml files
included in the .xlsx file it produces are actually illegal XML.

To reproduce the problems on Linux, proceed as follows:

- Download
<A HREF="http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.6.tar.gz">http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.6.tar.gz</A>
 Unpack it into some folder. 

- Download
<A HREF="http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.3-broken-move.diff">http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.3-broken-move.diff</A>
,
<A HREF="http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.3-zlibwapi-link-path.diff">http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.3-zlibwapi-link-path.diff</A>
,
<A HREF="http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.6-RemoveAttribute.diff">http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.6-RemoveAttribute.diff</A>
and
<A HREF="http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.6-value-of.diff">http://download.go-oo.org/tstnvl/odf-converter/odf-converter-1.0.6/odf-converter-1.0.6-value-of.diff</A>
 Apply these diffs to the odf-converter-1.0.6 sources.

With a recent Mono in PATH and PKG_CONFIG_PATH, run &quot;make&quot; in the top
level. It should produce in source/Shell/OdfConverterTest an
executable called OdfConverter, which is a mkbundle2-produced
executable.

(I am sorry, but making this work with normal assemblies and not
mkbundle2-ified executables requires some changes to the zlib
interface code in source/Common/OdfZipUtils. I haven't looked that
closely into that yet. If you need to run a non-bundled assembly I
could try to see what is required. There are different issues on
Windows and Linux related to this. It's rather a mess. I don't
understand why the upstream odf-converter people insist on interfacing
to an external zlib shared library, why can't they use some managed
reimplementation of zlib, aren't there any such suitably (for them)
licensed?  (MIT or X11 style))

cd to source/Shell/OdfConverterTest, and download
<A HREF="http://download.go-oo.org/tstnvl/tml/t00001.ods">http://download.go-oo.org/tstnvl/tml/t00001.ods</A> there. Run:

/OdfConverter /ODS2XLSX /I t00001.ods /O t00001.xlsx /LEVEL 1

You should see:

[INFO][t00001.ods] Converting file: t00001.ods into t00001.xlsx
progress:table:table-cell[ERROR][t00001.ods] Conversion failed - Error during
conversion
[DEBUG][t00001.ods] This XmlWriter does not accept EndElement at this state
Error.(  at System.Xml.XmlTextWriter.WriteEndElementCore (Boolean full)
[0x00000]
  at System.Xml.XmlTextWriter.WriteEndElement () [0x00000]
  at System.Xml.XmlTextWriter.Close () [0x00000]
  at CleverAge.OdfConverter.OdfZipUtils.ZipArchiveWriter.Close () [0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractPostProcessor.Close ()
[0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractPostProcessor.Close ()
[0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractPostProcessor.Close ()
[0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractPostProcessor.Close ()
[0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractPostProcessor.Close ()
[0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractPostProcessor.Close ()
[0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractPostProcessor.Close ()
[0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractConverter._Transform
(System.String inputFile, System.String outputFile) [0x00000]
  at CleverAge.OdfConverter.OdfConverterLib.AbstractConverter.Transform
(System.String inputFile, System.String outputFile) [0x00000]
  at CleverAge.OdfConverter.CommandLineTool.OdfConverter.ConvertFile
(System.String input, System.String output, Direction transformDirection)
[0x00000] )
Done.

Now unzip t00001.ods (OpenDocument files are actually .zip archives)
into some temporary new empty folder, and edit the content.xml
file. Find the place close to the end where it has:

..&lt;table:table-row table:style-name=&quot;ro1&quot;&gt;&lt;table:table-cell
office:value-type=&quot;string&quot;&gt;...

Insert a single space so it becomes:

..&lt;table:table-row table:style-name=&quot;ro1&quot;&gt; &lt;table:table-cell
office:value-type=&quot;string&quot;&gt;...

Make sure you don't use a &quot;too clever&quot; editor that would make other
formatting changes to the file... 

Replace the content.xml in t00001.ods with the edited version and
retun OdfConverter. This time it proceeds to the end, producing a
xlsx file.

The second issue is that if you unzip the .xlsx file produced by
OdfConverter into some empty temp folder, and look at the
xl/sharedStrings.xml file, you will notice that it is not valid
XML. The &lt;si&gt; element is ended by a &lt;/t&gt; end tag.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>












































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="063174.html">[Mono-bugs] [Bug 332206] System.Threading.Timer stop on excecption in callback method
</A></li>
	<LI>Next message: <A HREF="062759.html">[Mono-bugs] [Bug 332246] Strange problem in Mono's XML and/or XSLT	code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62733">[ date ]</a>
              <a href="thread.html#62733">[ thread ]</a>
              <a href="subject.html#62733">[ subject ]</a>
              <a href="author.html#62733">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
