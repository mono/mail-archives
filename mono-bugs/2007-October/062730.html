<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 332206] New: System.Threading. Timer stop on excecption in callback method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20332206%5D%20New%3A%20System.Threading.%20Timer%20stop%20on%0A%20excecption%20in%20callback%20method&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="062731.html">
   <LINK REL="Next"  HREF="062732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 332206] New: System.Threading. Timer stop on excecption in callback method</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20332206%5D%20New%3A%20System.Threading.%20Timer%20stop%20on%0A%20excecption%20in%20callback%20method&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 332206] New: System.Threading. Timer stop on excecption in callback method">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Oct  9 10:21:27 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="062731.html">[Mono-bugs] [Bug 332204] Cecil duplicates generics memberref
</A></li>
        <LI>Next message: <A HREF="062732.html">[Mono-bugs] [Bug 332206] System.Threading.Timer stop on excecption in callback method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62730">[ date ]</a>
              <a href="thread.html#62730">[ thread ]</a>
              <a href="subject.html#62730">[ subject ]</a>
              <a href="author.html#62730">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=332206">https://bugzilla.novell.com/show_bug.cgi?id=332206</A>

           Summary: System.Threading.Timer stop on excecption in callback
                    method
           Product: Mono: Class Libraries
           Version: 1.2
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">informatique.internet at fiducial.fr</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: ---


On mono, if you use the System.Threading.Timer and the callback method raise an
exception, the timer is stopped... and no more event is generated 
On MS.NET, it continues, the timer is still alive...

Test case :

// project created on 04/10/2007 at 09:42
using System;
using System.Threading;

namespace TestEscape
{
        class MainClass
        {
                public static void Main(string[] args)
                {
                                        System.Threading.Timer
tmrThreadingTimer = new 
                        System.Threading.Timer(new 
                       TimerCallback(tmrThreadingTimer_TimerCallback),
                       null, System.Threading.Timeout.Infinite, 1000);
                        tmrThreadingTimer.Change(0, 1000);
                        Console.ReadLine();                                     


                }

                private static void tmrThreadingTimer_TimerCallback(object
state) {
                                Console.WriteLine(&quot;Hello&quot;);
                        throw new Exception(&quot;Booom&quot;);
                        }



        }
}

Actual result
Hello

Unhandled Exception: System.Exception: Booom
  at TestEscape.MainClass.tmrThreadingTimer_TimerCallback (System.Object state)
[0x0000a] in /home/hubert/Projects/TestEscape/TestEscape/Main.cs:25 
  at System.Threading.Timer+Runner.WaitForDueTime () [0x00070] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:85 
  at System.Threading.Timer+Runner.Start () [0x00029] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:117 
  at (wrapper delegate-invoke) System.MulticastDelegate:invoke_void ()

Excepted result :
Hello

Unhandled Exception: System.Exception: Booom
  at TestEscape.MainClass.tmrThreadingTimer_TimerCallback (System.Object state)
[0x0000a] in /home/hubert/Projects/TestEscape/TestEscape/Main.cs:25 
  at System.Threading.Timer+Runner.WaitForDueTime () [0x00070] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:85 
  at System.Threading.Timer+Runner.Start () [0x00029] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:117 
  at (wrapper delegate-invoke) System.MulticastDelegate:invoke_void ()

Hello

Unhandled Exception: System.Exception: Booom
  at TestEscape.MainClass.tmrThreadingTimer_TimerCallback (System.Object state)
[0x0000a] in /home/hubert/Projects/TestEscape/TestEscape/Main.cs:25 
  at System.Threading.Timer+Runner.WaitForDueTime () [0x00070] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:85 
  at System.Threading.Timer+Runner.Start () [0x00029] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:117 
  at (wrapper delegate-invoke) System.MulticastDelegate:invoke_void ()

Hello

Unhandled Exception: System.Exception: Booom
  at TestEscape.MainClass.tmrThreadingTimer_TimerCallback (System.Object state)
[0x0000a] in /home/hubert/Projects/TestEscape/TestEscape/Main.cs:25 
  at System.Threading.Timer+Runner.WaitForDueTime () [0x00070] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:85 
  at System.Threading.Timer+Runner.Start () [0x00029] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:117 
  at (wrapper delegate-invoke) System.MulticastDelegate:invoke_void ()

Hello

Unhandled Exception: System.Exception: Booom
  at TestEscape.MainClass.tmrThreadingTimer_TimerCallback (System.Object state)
[0x0000a] in /home/hubert/Projects/TestEscape/TestEscape/Main.cs:25 
  at System.Threading.Timer+Runner.WaitForDueTime () [0x00070] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:85 
  at System.Threading.Timer+Runner.Start () [0x00029] in
/home/hubert/mono/mcs/class/corlib/System.Threading/Timer.cs:117 
  at (wrapper delegate-invoke) System.MulticastDelegate:invoke_void ()

..

I think you should call the callback method in his own thread... instead of
inside the main timer thread...


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="062731.html">[Mono-bugs] [Bug 332204] Cecil duplicates generics memberref
</A></li>
	<LI>Next message: <A HREF="062732.html">[Mono-bugs] [Bug 332206] System.Threading.Timer stop on excecption in callback method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#62730">[ date ]</a>
              <a href="thread.html#62730">[ thread ]</a>
              <a href="subject.html#62730">[ subject ]</a>
              <a href="author.html#62730">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
