<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 335026] New: System.Data.Common.DbTransaction.Dispose() attempts to rollback even though the transaction has already completed successfully
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20335026%5D%20New%3A%0A%20System.Data.Common.DbTransaction.Dispose%28%29%20attempts%20to%20rollback%20even%20though%0A%20the%20transaction%20has%20already%20completed%20successfully&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="063338.html">
   <LINK REL="Next"  HREF="063340.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 335026] New: System.Data.Common.DbTransaction.Dispose() attempts to rollback even though the transaction has already completed successfully</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20335026%5D%20New%3A%0A%20System.Data.Common.DbTransaction.Dispose%28%29%20attempts%20to%20rollback%20even%20though%0A%20the%20transaction%20has%20already%20completed%20successfully&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 335026] New: System.Data.Common.DbTransaction.Dispose() attempts to rollback even though the transaction has already completed successfully">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Oct 18 17:08:10 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="063338.html">[Mono-bugs] [Bug 335018] New: Silverlight-Pad: loadingRect has no	properties
</A></li>
        <LI>Next message: <A HREF="063340.html">[Mono-bugs] [Bug 335026] System.Data.Common.DbTransaction.Dispose() attempts to rollback even though the transaction has already completed successfully
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63339">[ date ]</a>
              <a href="thread.html#63339">[ thread ]</a>
              <a href="subject.html#63339">[ subject ]</a>
              <a href="author.html#63339">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=335026">https://bugzilla.novell.com/show_bug.cgi?id=335026</A>

           Summary: System.Data.Common.DbTransaction.Dispose() attempts to
                    rollback even though the transaction has already
                    completed successfully
           Product: Mono: Class Libraries
           Version: 1.2
          Platform: x86
        OS/Version: Linux
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: Sys.Data
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">anagappan at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">emarkp at hotmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: ---


Description of Problem:

If Dispose() is called on a System.Data.Common.DbTransaction object after a
transaction has been completed successfully, it tries to rollback.


Steps to reproduce the problem:
1. call Dispose() after Commit() on a DbTransaction object (I have only tested
this with the one from Mysql which inherits it's Dispose() method from
DbTransaction
2. You can also use the sample program I have attatched.  If so, make sure to
create the database table first with this command being ran in the sql client
console:

create database NHTest; 
use NHTest; 
CREATE TABLE users ( 
  LogonID nvarchar(20) NOT NULL default '0', 
  Name nvarchar(40) default NULL, 
  Password nvarchar(20) default NULL, 
  EmailAddress nvarchar(40) default NULL, 
  LastLogon datetime default NULL, 
  PRIMARY KEY (LogonID) 
) ENGINE=InnoDB; 
grant all on NHTest.* to 'nhtestuser'@'%' identified by 'nhtestpass'; 

You will also need to change the connection string in the program to point to
the host of your mysql database.  Also, you will need to point the reference to
MySql.Data to your copy of the .dll.


Actual Results:
System.InvalidOperationException: Transaction has already been rolled back or
is not pending
  at MySql.Data.MySqlClient.MySqlTransaction.Rollback () [0x00000]
  at System.Data.Common.DbTransaction.Dispose (Boolean disposing) [0x00000]
  at System.Data.Common.DbTransaction.Dispose () [0x00000]
  at (wrapper remoting-invoke-with-check)
System.Data.Common.DbTransaction:Dispose ()
  at ConsoleApplication1.Program.Main (System.String[] args) [0x00000]
Transaction has already been rolled back or is not pending
  at MySql.Data.MySqlClient.MySqlTransaction.Rollback () [0x00000]
  at System.Data.Common.DbTransaction.Dispose (Boolean disposing) [0x00000]
  at System.Data.Common.DbTransaction.Dispose () [0x00000]
  at (wrapper remoting-invoke-with-check)
System.Data.Common.DbTransaction:Dispose ()
  at ConsoleApplication1.Program.Main (System.String[] args) [0x00000]


Expected Results:
This code should throw no exceptions

How often does this happen? 
Every time

Additional Information: I originally posted this bug as
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=333746">https://bugzilla.novell.com/show_bug.cgi?id=333746</A> but was not as sure what was
happening.  Also, this program I've attatched that reproduces the problem
doesn't incorporate any of NHibernate's code.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>






















































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="063338.html">[Mono-bugs] [Bug 335018] New: Silverlight-Pad: loadingRect has no	properties
</A></li>
	<LI>Next message: <A HREF="063340.html">[Mono-bugs] [Bug 335026] System.Data.Common.DbTransaction.Dispose() attempts to rollback even though the transaction has already completed successfully
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#63339">[ date ]</a>
              <a href="thread.html#63339">[ thread ]</a>
              <a href="subject.html#63339">[ subject ]</a>
              <a href="author.html#63339">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
