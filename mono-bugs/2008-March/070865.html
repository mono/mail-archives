<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 372483] New: Conversion instruction called twice for compound operator /assignment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20372483%5D%20New%3A%20Conversion%20instruction%20called%20twice%0A%20for%20compound%20operator%20/assignment&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="071065.html">
   <LINK REL="Next"  HREF="070869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 372483] New: Conversion instruction called twice for compound operator /assignment</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20372483%5D%20New%3A%20Conversion%20instruction%20called%20twice%0A%20for%20compound%20operator%20/assignment&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 372483] New: Conversion instruction called twice for compound operator /assignment">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Mar 19 14:01:28 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="071065.html">[Mono-bugs] [Bug 372412] gmcs don't emit readonly prefix for generic array access.
</A></li>
        <LI>Next message: <A HREF="070869.html">[Mono-bugs] [Bug 372483] Conversion instruction called twice for compound operator/ assignment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70865">[ date ]</a>
              <a href="thread.html#70865">[ thread ]</a>
              <a href="subject.html#70865">[ subject ]</a>
              <a href="author.html#70865">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=372483">https://bugzilla.novell.com/show_bug.cgi?id=372483</A>


           Summary: Conversion instruction called twice for compound
                    operator/assignment
           Product: Mono: Compilers
           Version: 1.9.0
          Platform: i686
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: C#
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sleibman at interactivesupercomputing.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Customer


In mono 1.9 [using gmcs on Linux (kernel 2.6.22-14-generic, i686)], if I write
code that includes an implicit cast in conjunction with a compound operator
(e.g. *=, +=, etc.), it compiles successfully, but at runtime the virtual
machine dies with a SIGABRT. This is not a problem with previous mono releases. 

It appears to be due to an incorrectly generated CIL instruction. 

Code to reproduce this behavior (along with additional explanations in the
comments) is shown below.

Please feel free to contact me if you need additional information.

Thanks,
Steve Leibman
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sleibman at interactivesupercomputing.com</A>



using System;
using SizeType = System.UInt64;

public class broken_cast
{
    public static void Main()
    {
      SizeType m = 1;
      SizeType i = 1;
      SizeType[] n = new SizeType[2] {7, 8};

      // In mono 1.9 (but not 1.2.6), the following line will cause
      // the program to abort with following error at runtime:
      //  ** ERROR **: unknown operator: conv.ovf.i.un
      // If I use monodis to look at the CIL code, it appears that
      // this problem is due to the fact that the conversion operator
      // to cast i from uint64 to int gets called twice.
      m *= n[i];

      // Interestingly, the following line works fine (in both 1.9 and
      // 1.2.6), and in the CIL code, I see that conv.ovf.i.un is only
      // called once: 
      m = m * n[i];

      // The following also works fine in both versions (and technically,
      // I suppose, is the way a C# programmer is supposed to do it,
      // since the indexing operator is defined to only accept
      // variables of type int):
      m *= n[(int)i];
    }
}


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>





























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="071065.html">[Mono-bugs] [Bug 372412] gmcs don't emit readonly prefix for generic array access.
</A></li>
	<LI>Next message: <A HREF="070869.html">[Mono-bugs] [Bug 372483] Conversion instruction called twice for compound operator/ assignment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70865">[ date ]</a>
              <a href="thread.html#70865">[ thread ]</a>
              <a href="subject.html#70865">[ subject ]</a>
              <a href="author.html#70865">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
