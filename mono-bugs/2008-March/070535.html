<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 368447] New: vbnc: miscompile when ByRef ValueType	parameter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20368447%5D%20New%3A%20vbnc%3A%20miscompile%20when%20ByRef%20ValueType%0A%09parameter&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="070749.html">
   <LINK REL="Next"  HREF="070619.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 368447] New: vbnc: miscompile when ByRef ValueType	parameter</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20368447%5D%20New%3A%20vbnc%3A%20miscompile%20when%20ByRef%20ValueType%0A%09parameter&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 368447] New: vbnc: miscompile when ByRef ValueType	parameter">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat Mar  8 08:39:00 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="070749.html">[Mono-bugs] [Bug 368439] Fails to compile gtk-sharp with NullReferenceException on arm/ eabi
</A></li>
        <LI>Next message: <A HREF="070619.html">[Mono-bugs] [Bug 368447] vbnc: miscompile when ByRef ValueType	parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70535">[ date ]</a>
              <a href="thread.html#70535">[ thread ]</a>
              <a href="subject.html#70535">[ subject ]</a>
              <a href="author.html#70535">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=368447">https://bugzilla.novell.com/show_bug.cgi?id=368447</A>


           Summary: vbnc: miscompile when ByRef ValueType parameter
           Product: Mono: Compilers
           Version: 1.2.6
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Basic
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">rkvinge at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Present in 1.2.6, 1.9 etc.

A null reference occurs at the second line in the called method:
[[
Structure SomeStruct 
  Private x As Integer
End Structure

Class ByRefValueType
  Public Shared Sub Main()
     Dim ss As SomeStruct
     ss.x = 55
     MethodByRefSomeStruct(ss)
  End Sub

  Shared Sub MethodByRefSomeStruct(ByRef ss As SomeStruct)
     Console.WriteLine(ss.x)
     Console.WriteLine(ss)
  Sub
End Class
]]

Depending on the presence of the member field, whether it contains zero, and
which method(s) are called in the callee method different errors occur at
runtime e.g. CLR crash, NullReferenceException, hang 100% cpu.  The first for
two are seen on the MSFT CLR too. 


This next fails with:
[[
Unhandled Exception: System.InvalidProgramException: Invalid IL code in
ByRefValueType:MethodSomeStructByRef (SomeStruct&amp;): IL_0002: stloc.0
]]

[[
Public Structure SomeStruct
    Private x As Integer
    Private y As Integer
End Structure

Public Class ByRefValueType
    Shared Sub Main()
        Dim ss As SomeStruct
        MethodSomeStructByRef(ss)
    End Sub

    Shared Sub MethodSomeStructByRef(ByRef ss As SomeStruct)
        Dim ssLocal As SomeStruct = ss
        Console.WriteLine(&quot;success&quot;)
    End Sub
End Class
]]


Just for fun, guess what the output of this program, on both CLRs:
[[
Public Structure SomeStruct
   Private x As Integer
    Private y As Integer
End Structure

Public Class ByRefValueType
   Shared Sub Main()
       Dim ss As SomeStruct
       MethodSomeStructByRef(ss)
   End Sub

    Shared Sub MethodSomeStructByRef(ByRef ss As SomeStruct)
       Console.WriteLine(FooIsNull(ss))
   End Sub

    Shared Function FooIsNull(ByVal o As Object) As Boolean
        Return o Is Nothing
    End Function

End Class
]]

Yup, &quot;True&quot;.  Null value types!!


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>


























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="070749.html">[Mono-bugs] [Bug 368439] Fails to compile gtk-sharp with NullReferenceException on arm/ eabi
</A></li>
	<LI>Next message: <A HREF="070619.html">[Mono-bugs] [Bug 368447] vbnc: miscompile when ByRef ValueType	parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70535">[ date ]</a>
              <a href="thread.html#70535">[ thread ]</a>
              <a href="subject.html#70535">[ subject ]</a>
              <a href="author.html#70535">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
