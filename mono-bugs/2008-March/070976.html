<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 373153] New: Incorrect behavior of BackgroundWorker.CancelAsync()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20373153%5D%20New%3A%20Incorrect%20behavior%20of%0A%20BackgroundWorker.CancelAsync%28%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="070975.html">
   <LINK REL="Next"  HREF="070977.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 373153] New: Incorrect behavior of BackgroundWorker.CancelAsync()</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20373153%5D%20New%3A%20Incorrect%20behavior%20of%0A%20BackgroundWorker.CancelAsync%28%29&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 373153] New: Incorrect behavior of BackgroundWorker.CancelAsync()">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun Mar 23 02:34:59 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="070975.html">[Mono-bugs] [Bug 373134] Control.InvokeRequired does not always return the right value
</A></li>
        <LI>Next message: <A HREF="070977.html">[Mono-bugs] [Bug 373153] Incorrect behavior of	BackgroundWorker.CancelAsync()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70976">[ date ]</a>
              <a href="thread.html#70976">[ thread ]</a>
              <a href="subject.html#70976">[ subject ]</a>
              <a href="author.html#70976">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=373153">https://bugzilla.novell.com/show_bug.cgi?id=373153</A>


           Summary: Incorrect behavior of BackgroundWorker.CancelAsync()
           Product: Mono: Class Libraries
           Version: SVN
          Platform: i386
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Windows.Forms
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">MonkeeSage at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=203495)
 --&gt; (<A HREF="https://bugzilla.novell.com/attachment.cgi?id=203495">https://bugzilla.novell.com/attachment.cgi?id=203495</A>)
test case

According to MSDN, System.ComponentModel.BackgroundWorker.CancelAsync() is
supposed to set the CancellationPending property to true, to be accessed from
the worker thread--nothing more.

From
<A HREF="http://msdn2.microsoft.com/en-us/library/system.componentmodel.backgroundworker.cancelasync.aspx">http://msdn2.microsoft.com/en-us/library/system.componentmodel.backgroundworker.cancelasync.aspx</A>
  CancelAsync submits a request to terminate the pending background operation
and
  sets the CancellationPending property to true.

  When you call CancelAsync, your worker method has an opportunity to stop its
  execution and exit. The worker code should periodically check the
  CancellationPending property to see if it has been set to true.

From
<A HREF="http://msdn2.microsoft.com/en-us/library/system.componentmodel.backgroundworker.cancellationpending.aspx">http://msdn2.microsoft.com/en-us/library/system.componentmodel.backgroundworker.cancellationpending.aspx</A>
  If CancellationPending is true, then the CancelAsync method has been called
on
  the BackgroundWorker.

  This property is meant for use by the worker thread, which should
periodically
  check CancellationPending and abort the background operation when it is set
to
  true.

See also the sample code at
<A HREF="http://msdn2.microsoft.com/en-us/library/hybbz6ke.aspx">http://msdn2.microsoft.com/en-us/library/hybbz6ke.aspx</A>

However, in current SVN (and in mono 1.2.6, and presumably all versions in
between and before, though I haven't looked), CancelAsync() sets cancel_pending
to true, then calls AsyncOperation.PostOperationCompleted(), with a delegate
that is Post()'ed to the SynchronizationContext and eventually calls the
RunWorkerCompleted event handler from OnRunWorkerCompleted; after this,
cancel_pending is set to false and CancelAsync() returns.

This means that CancellationPending is only true in the RunWorkerCompleted
callback, and further, the RunWorkerCompleted callback is executed while the
worker thread is still working(!)...this seems very wrong.

On MSFT, the test case works as expected; when BackgroundWorker.CancelAsync()
is called, it sets CancellationPending to true and when the OnDoWork handler
sees this, it exits. However, on Mono, OnDoWork never sees the property as
true, and the OnWorkDone handler runs even though OnDoWork is still executing.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="070975.html">[Mono-bugs] [Bug 373134] Control.InvokeRequired does not always return the right value
</A></li>
	<LI>Next message: <A HREF="070977.html">[Mono-bugs] [Bug 373153] Incorrect behavior of	BackgroundWorker.CancelAsync()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70976">[ date ]</a>
              <a href="thread.html#70976">[ thread ]</a>
              <a href="subject.html#70976">[ subject ]</a>
              <a href="author.html#70976">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
