<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 70452][Maj] Changed - off-by-one in Mono.Posix.Signals
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="023605.html">
   <LINK REL="Next"  HREF="023607.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 70452][Maj] Changed - off-by-one in Mono.Posix.Signals
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 70452][Maj] Changed - off-by-one in Mono.Posix.Signals">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Wed, 29 Dec 2004 09:28:13 -0500 (EST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="023605.html">[Mono-bugs] [Bug 62232][Wis] Changed - We don't report cs0208
</A></li>
        <LI> Next message: <A HREF="023607.html">[Mono-bugs] [Bug 70866][Wis] New - Cannot generate docs with monodoc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23606">[ date ]</a>
              <a href="thread.html#23606">[ thread ]</a>
              <a href="subject.html#23606">[ subject ]</a>
              <a href="author.html#23606">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:jonpryor@vt.edu.">jonpryor@vt.edu.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=70452">http://bugzilla.ximian.com/show_bug.cgi?id=70452</A>

--- shadow/70452	2004-12-10 19:38:43.000000000 -0500
+++ shadow/70452.tmp.17389	2004-12-29 09:28:13.000000000 -0500
@@ -1,14 +1,14 @@
 Bug#: 70452
 Product: Mono: Class Libraries
 Version: 1.1
-OS: 
+OS: unknown
 OS Details: 
-Status: NEW   
-Resolution: 
-Severity: 
+Status: RESOLVED   
+Resolution: NOTABUG
+Severity: Unknown
 Priority: Major
 Component: Mono.POSIX
 AssignedTo: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>                            
 ReportedBy: <A HREF="mailto:james@ximian.com">james@ximian.com</A>               
 QAContact: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>
 TargetMilestone: ---
@@ -16,6 +16,58 @@
 Cc: 
 Summary: off-by-one in Mono.Posix.Signals
 
 The 'Signals' enum in Mono.Posix has the wrong values for the signal
 numbers.  It should start from 1, not zero.  Mono.Unix.Signum, however, is
 correct.
+
+------- Additional Comments From <A HREF="mailto:jonpryor@vt.edu">jonpryor@vt.edu</A>  2004-12-29 09:28 -------
+This isn't a bug.  It's a feature! :-)
+
+Joking aside, this isn't a bug.  Symbolic constants such as signal
+names (SIGHUP, SIGKILL, etc.) and Error values (EPERM, EINTR) are not
+guaranteed to be portable, *at all*.  They can (and do) differ between
+Unixes (e.g. Sparc/Solaris vs x86/Linux vs x86/SCO vs...).
+
+For example, ENETDOWN on Linux is 100 while it's 50 on *BSD (*BSD
+value seen here: <A HREF="http://fxr.watson.org/fxr/source/sys/errno.h?v=RELENG52">http://fxr.watson.org/fxr/source/sys/errno.h?v=RELENG52</A>).
+
+Signals aren't portable either: SIGBUS is 7 on Linux and 10 on *BSD.
+
+Consequently, you CANNOT use managed enumeration values portably
+across the various Unixes anyway, *unless* you know that they share
+the same value.  (And since, as you noted, the managed values are
+off-by-1 from Linux, they won't be valid on *any* platform.) 
+
+The solution?  A mapping mechanism.  Make-map.cs generates C functions
+which will convert the managed value to the appropriate,
+platform-specific, unmanaged value.  These functions are in
+libMonoPosixHelper.so.
+
+The only &quot;bug&quot; is that Mono.Posix doesn't expose any way to convert
+the Signals values to their unmanaged values, which is somewhat
+excusable since Signals isn't actually *used* anywhere in Mono.Posix
+(by name; kill(2) and others should use it, and this is the real issue
+-- not all functions which accept signal values take Signals as a
+parameter, they take an int, which is unsafe and non-portable).
+
+A solution would be to overload kill(2) (and others) to take Signals
+as a parameter, which would convert the managed value to the unmanaged
+value.  However, this won't fix the problem (as the unsafe &quot;int&quot;
+equivalent is still available, and we can't remove it without breaking
+existing code).  *Furthermore*, since the original symbolic value
+mapping code only provided managed -&gt; unmanaged conversions (and not
+unmanaged -&gt; managed), functions which return a Signal value from
+unmanaged code, such as WTERMSIG, will *always* return the unmanaged
+value, and there's no way to convert that to the managed equivalent
+(which would be necessary for any type of comparison in managed code).
+
+In short, the original Mono.Posix approach is broken, and fixing it
+wouldn't fix any existing code (for compatibility reasons).  If we
+didn't care about compatibility, Mono.Unix wouldn't exist (it would
+*be* Mono.Posix, fixing all these issues), but we tried that approach
+and it broke too much existing code.
+
+So, it's NOTABUG (that's what the C conversion functions are for), and
+even if it were, it would be WONTFIX (since we can't properly fix this
+on 1.0.5 because of WTERMSIG).  Just use Mono.Unix which fixes all
+these issues.  Please.

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="023605.html">[Mono-bugs] [Bug 62232][Wis] Changed - We don't report cs0208
</A></li>
	<LI> Next message: <A HREF="023607.html">[Mono-bugs] [Bug 70866][Wis] New - Cannot generate docs with monodoc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23606">[ date ]</a>
              <a href="thread.html#23606">[ thread ]</a>
              <a href="subject.html#23606">[ subject ]</a>
              <a href="author.html#23606">[ author ]</a>
         </LI>
       </UL>
</body></html>
