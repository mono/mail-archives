<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 79729][Cri] New - Integer Overflow/Underflow in	GDI, 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2079729%5D%5BCri%5D%20New%20-%20Integer%20Overflow/Underflow%20in%0A%09GDI%2C%20&In-Reply-To=bug-79729%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="048993.html">
   <LINK REL="Next"  HREF="048995.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 79729][Cri] New - Integer Overflow/Underflow in	GDI, </H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2079729%5D%5BCri%5D%20New%20-%20Integer%20Overflow/Underflow%20in%0A%09GDI%2C%20&In-Reply-To=bug-79729%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 79729][Cri] New - Integer Overflow/Underflow in	GDI, ">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Mon Oct 23 18:55:00 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="048993.html">[Mono-bugs] [Bug 79716][Wis] Changed - TabControl not shown in form
</A></li>
        <LI>Next message: <A HREF="048995.html">[Mono-bugs] [Bug 79730][Min] New - Runtime alters sink stack when	creating channel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48994">[ date ]</a>
              <a href="thread.html#48994">[ thread ]</a>
              <a href="subject.html#48994">[ subject ]</a>
              <a href="author.html#48994">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">david_garcia at logitech.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=79729">http://bugzilla.ximian.com/show_bug.cgi?id=79729</A>

--- shadow/79729	2006-10-23 18:55:00.000000000 -0400
+++ shadow/79729.tmp.6698	2006-10-23 18:55:00.000000000 -0400
@@ -0,0 +1,171 @@
+Bug#: 79729
+Product: Mono: Runtime
+Version: 1.1
+OS: GNU/Linux [Other]
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: Unknown
+Priority: Critical
+Component: io-layer
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">dick at ximian.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">david_garcia at logitech.com</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: Integer Overflow/Underflow in GDI, 
+
+Environment:
+OS: 
+
+Ubuntu 2.6.15-26-server #1 SMP Fri Sep 8 21:00:37 UTC 2006 i686 GNU/Linux
+Bug occurs on other linux and unix systems (Solaris)
+Mono: 1.1.18
+
+Bug Description: 
+When an offset greater than x=16384, 2^14
+the clipping window starts to move, numbers before that,
+the window does not move
+
+Expected Results:
+Only the world would translate. Clipping window would not move.
+Items draw will be the only thing moving in clipping window.
+
+Actual Results:
+numbers used to draw before X is translated &gt; 2^ 14 are translated properly
+without the clipping window moving.
+Numbers after X result in clipping window moving.
+
+//////////////////////////////////////Sample code below
+///////running on xsp2
+&lt;%@ Page Language=&quot;C#&quot; %&gt;
+&lt;%@ Import Namespace = &quot;System.Drawing&quot; %&gt;
+&lt;%@ Import Namespace = &quot;System.Drawing.Drawing2D&quot; %&gt;
+&lt;%@ Import Namespace = &quot;System.IO&quot; %&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 
+Transitional//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-">http://www.w3.org/TR/xhtml1/DTD/xhtml1-</A>
+transitional.dtd&quot;&gt;
+
+&lt;script runat=&quot;server&quot;&gt;
+//internal object used to handle a bug in the GDI for linux/unix
+//because the VisibleClipBounds does not maintain its data correctly
+//on linux pertaining to the boundary of the clipping region/window
+    public enum Rotation : int
+    {
+        /// &lt;summary&gt;
+        /// a rotation level
+        /// &lt;/summary&gt;
+        Degree0 = 0,
+        /// &lt;summary&gt;
+        ///  rotation 90 deg
+        /// &lt;/summary&gt;
+        Degree90 = 90,
+        /// &lt;summary&gt;
+        ///  rotation 180 deg
+        /// &lt;/summary&gt;
+        Degree180 = 180,
+        /// &lt;summary&gt;
+        ///  rotation 270 deg
+        /// &lt;/summary&gt;
+
+        Degree270 = 270
+    }
+
+    protected void Page_Load(object sender, EventArgs e)
+    {
+
+
+        /*
+         * debug values from my custom lib
+         * anchor is offset in this example code below
+//############UNIX BUG FIX MODE True#####################
+Graph::Paint Anchor {X=100, Y=100}
+Graph::Paint RelativeCenter {X=-32318.08, Y=900}
+Graph::Paint Center {X=-32218.08, Y=1000}
+Graph::Paint Size {Width=900, Height=900}
+Graph::Paint Rotation Degree0
+//below calculated from Size Demensions - center + offset
+Graph::Paint Left 32318.08
+Graph::Paint Right 33218.08
+Graph::Paint Top -900
+Graph::Paint Bottom 0
+
+//############UNIX BUG FIX MODE False#####################
+Graph::Paint Anchor {X=100, Y=100}
+Graph::Paint RelativeCenter {X=0, Y=0}
+Graph::Paint Center {X=100, Y=100}
+Graph::Paint Size {Width=900, Height=900}
+Graph::Paint Rotation Degree0
+//below retrieved from GDI.VisibleClipBounds, 
+//these should be the same as above
+//regardless of the unix mode (OSVersion), on windows they are the same,
+//on unix/linux they are never the same
+//bug reported, never fixed
+Graph::Paint Left 0 
+Graph::Paint Right 1000
+Graph::Paint Top 0
+Graph::Paint Bottom 1000
+*/
+        //Step 1 :Create a GDI object from a Bitmap
+        Bitmap bmp=new Bitmap(1000,1000);
+        Graphics g=Graphics.FromImage(bmp);
+        //step 2: define the variables
+        //offset is also called anchor
+        PointF offset = new PointF(100, 100);
+        float center_x;
+
+        if (Request.QueryString[&quot;x&quot;] != null)
+            center_x = Convert.ToSingle(Request.QueryString[&quot;x&quot;]);
+        else
+            center_x = 10f;
+        
+        PointF center = new PointF(center_x, 500f);
+        Rotation angle = Rotation.Degree0;
+        SizeF size =new SizeF(900,900);
+       // Step 3: Apply a transofmration
+       
+        g.ResetTransform();
+        g.TranslateTransform(offset.X, offset.Y);
+        g.Clip = new Region(new RectangleF(
+                        0, 0,
+                        size.Width, size.Height));
+        g.RotateTransform((float)angle);//angle is type Rotation
+        g.TranslateTransform(center.X, center.Y, MatrixOrder.Append);
+        g.Clear(Color.Red);
+//step 4: draw 
+        g.DrawLine(Pens.Black, -500, -500, 500, 500);
+        g.DrawLine(Pens.Black, -500, 500, 500, -500);
+   
+          
+        Response.Clear();
+        Response.ContentType = &quot;image/bmp&quot;;
+    
+        using (MemoryStream ms = new MemoryStream())
+        {
+            bmp.Save(ms, System.Drawing.Imaging.ImageFormat.Bmp);
+            Response.OutputStream.Write(ms.GetBuffer(), 0, (int)ms.Length);
+        }
+        /*Expected Results:
+        Only the world would translate. Clipping window would not move.
+        Items draw will be the only thing moving in clipping window.
+
+        Actual Results:
+        numbers before X are translated properly
+        without the clipping window moving.
+        Numbers after X result in clipping window moving.*/
+    }
+&lt;/script&gt;
+
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> &gt;
+&lt;head runat=&quot;server&quot;&gt;
+    &lt;title&gt;Untitled Page&lt;/title&gt;
+&lt;/head&gt;
+&lt;body&gt;
+    &lt;form id=&quot;form1&quot; runat=&quot;server&quot;&gt;
+    &lt;div&gt;
+    
+    &lt;/div&gt;
+    &lt;/form&gt;
+&lt;/body&gt;
+&lt;/html&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="048993.html">[Mono-bugs] [Bug 79716][Wis] Changed - TabControl not shown in form
</A></li>
	<LI>Next message: <A HREF="048995.html">[Mono-bugs] [Bug 79730][Min] New - Runtime alters sink stack when	creating channel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#48994">[ date ]</a>
              <a href="thread.html#48994">[ thread ]</a>
              <a href="subject.html#48994">[ subject ]</a>
              <a href="author.html#48994">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
