<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 547251] New: Decimal parameter of SqlCommand causes exception when executing Command in non-english localizations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20547251%5D%20New%3A%20Decimal%20parameter%20of%20SqlCommand%0A%20causes%20exception%20when%20executing%20Command%20in%20non-english%20localizations&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="093682.html">
   <LINK REL="Next"  HREF="093685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 547251] New: Decimal parameter of SqlCommand causes exception when executing Command in non-english localizations</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20547251%5D%20New%3A%20Decimal%20parameter%20of%20SqlCommand%0A%20causes%20exception%20when%20executing%20Command%20in%20non-english%20localizations&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 547251] New: Decimal parameter of SqlCommand causes exception when executing Command in non-english localizations">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Oct 15 10:04:43 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="093682.html">[Mono-bugs] [Bug 503889] International characters displayed incorrectly in window title
</A></li>
        <LI>Next message: <A HREF="093685.html">[Mono-bugs] [Bug 547251] Decimal parameter of SqlCommand causes exception when executing Command in non-english localizations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#93683">[ date ]</a>
              <a href="thread.html#93683">[ thread ]</a>
              <a href="subject.html#93683">[ subject ]</a>
              <a href="author.html#93683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=547251">http://bugzilla.novell.com/show_bug.cgi?id=547251</A>


           Summary: Decimal parameter of SqlCommand causes exception when
                    executing Command in non-english localizations
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.4.x
          Platform: x86-64
        OS/Version: RHEL 5
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: Sys.Data.SqlClient
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">stefano.sapienti at apsystems.it</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.14)
Gecko/2009082707 Firefox/3.0.14 (.NET CLR 3.5.30729)

I decided to create a new bug report based on
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=319320">https://bugzilla.novell.com/show_bug.cgi?id=319320</A> cause it was closed many
years ago in the wrong way.
The problem is still there and it was hidden cause you are using english
localization. It happens in localizations that use &quot;,&quot; as decimal separator
instead of &quot;.&quot; 

Reproducible: Always

Steps to Reproduce:
1.Create a test table into an SQL Server database with a field of type float.
2. Run this piece of code:

System.Threading.Thread.CurrentThread.CurrentCulture = new
System.Globalization.CultureInfo(&quot;it-IT&quot;);
SqlConnection conn = new
SqlConnection(&quot;server=servername;database=databasename;User
ID=username;Pwd=password;&quot;);
SqlCommand cmd = new SqlCommand();
cmd.Connection = conn;
cmd.CommandText = &quot;insert into table (numeric_field) VALUES (@P1)&quot;;
SqlParameter p = new SqlParameter(&quot;@P1&quot;, 12.54);
cmd.Parameters.Add(p);
try {
  conn.Open();
  cmd.ExecuteNonQuery();
  Console.WriteLine(&quot;Done.&quot;);
} catch (Exception ex) {
  Console.WriteLine(ex.ToString());
} finally {
  conn.Close();
}
Actual Results:  
You receive the error:
System.Data.SqlClient.SqlException: Must pass parameter number 4 and subsequent
parameters as '@name = value'. After the form '@name = value' has been used,
all subsequent parameters must be passed in the form '@name = value'.
  at System.Data.SqlClient.SqlConnection.ErrorHandler (System.Object sender,
Mono.Data.Tds.Protocol.TdsInternalErrorMessageEventArgs e) [0x00032] in
/root/download/mono/mono-2.4.2.3/mcs/class/System.Data/System.Data.SqlClient/SqlConnection.cs:314 
  at Mono.Data.Tds.Protocol.Tds.OnTdsErrorMessage
(Mono.Data.Tds.Protocol.TdsInternalErrorMessageEventArgs e) [0x0000b] in
/root/download/mono/mono-2.4.2.3/mcs/class/Mono.Data.Tds/Mono.Data.Tds.Protocol/Tds.cs:1593 
  at Mono.Data.Tds.Protocol.Tds.ProcessMessage (TdsPacketSubType subType)
[0x000ef] in
/root/download/mono/mono-2.4.2.3/mcs/class/Mono.Data.Tds/Mono.Data.Tds.Protocol/Tds.cs:1633 
  at Mono.Data.Tds.Protocol.Tds.ProcessSubPacket () [0x00130] in
/root/download/mono/mono-2.4.2.3/mcs/class/Mono.Data.Tds/Mono.Data.Tds.Protocol/Tds.cs:1680 
  at Mono.Data.Tds.Protocol.Tds.NextResult () [0x0004a] in
/root/download/mono/mono-2.4.2.3/mcs/class/Mono.Data.Tds/Mono.Data.Tds.Protocol/Tds.cs:612 
  at Mono.Data.Tds.Protocol.Tds.SkipToEnd () [0x00005] in
/root/download/mono/mono-2.4.2.3/mcs/class/Mono.Data.Tds/Mono.Data.Tds.Protocol/Tds.cs:685 
  at Mono.Data.Tds.Protocol.Tds.ExecuteQuery (System.String sql, Int32 timeout,
Boolean wantResults) [0x00036] in
/root/download/mono/mono-2.4.2.3/mcs/class/Mono.Data.Tds/Mono.Data.Tds.Protocol/Tds.cs:560 
  at Mono.Data.Tds.Protocol.Tds70.Execute (System.String commandText,
Mono.Data.Tds.TdsMetaParameterCollection parameters, Int32 timeout, Boolean
wantResults) [0x00034] in
/root/download/mono/mono-2.4.2.3/mcs/class/Mono.Data.Tds/Mono.Data.Tds.Protocol/Tds70.cs:540 
  at System.Data.SqlClient.SqlCommand.Execute (Boolean wantResults) [0x0020f]
in
/root/download/mono/mono-2.4.2.3/mcs/class/System.Data/System.Data.SqlClient/SqlCommand.cs:532 
  at System.Data.SqlClient.SqlCommand.ExecuteNonQuery ()

Expected Results:  
It should inser the new record. If you change
System.Threading.Thread.CurrentThread.CurrentCulture = new
System.Globalization.CultureInfo(&quot;it-IT&quot;);

with

System.Threading.Thread.CurrentThread.CurrentCulture = new
System.Globalization.CultureInfo(&quot;en-GB&quot;);

it works.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>






































































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="093682.html">[Mono-bugs] [Bug 503889] International characters displayed incorrectly in window title
</A></li>
	<LI>Next message: <A HREF="093685.html">[Mono-bugs] [Bug 547251] Decimal parameter of SqlCommand causes exception when executing Command in non-english localizations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#93683">[ date ]</a>
              <a href="thread.html#93683">[ thread ]</a>
              <a href="subject.html#93683">[ subject ]</a>
              <a href="author.html#93683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
