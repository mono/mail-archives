<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 545276] New: ASP.NET shadow copy checks also	st_mode field
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20545276%5D%20New%3A%20ASP.NET%20shadow%20copy%20checks%20also%0A%09st_mode%20field&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="093814.html">
   <LINK REL="Next"  HREF="093458.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 545276] New: ASP.NET shadow copy checks also	st_mode field</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20545276%5D%20New%3A%20ASP.NET%20shadow%20copy%20checks%20also%0A%09st_mode%20field&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 545276] New: ASP.NET shadow copy checks also	st_mode field">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Oct  8 05:21:24 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="093814.html">[Mono-bugs] [Bug 545260] shadowCopyBinAssemblies config param not	supported
</A></li>
        <LI>Next message: <A HREF="093458.html">[Mono-bugs] [Bug 545276] ASP.NET shadow copy checks also st_mode	field
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#93446">[ date ]</a>
              <a href="thread.html#93446">[ thread ]</a>
              <a href="subject.html#93446">[ subject ]</a>
              <a href="author.html#93446">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=545276">http://bugzilla.novell.com/show_bug.cgi?id=545276</A>


           Summary: ASP.NET shadow copy checks also st_mode field
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.4.x
          Platform: x86-64
        OS/Version: RHEL 5
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: JIT
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">stefano.sapienti at apsystems.it</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.14)
Gecko/2009082707 Firefox/3.0.14 (.NET CLR 3.5.30729)

During website compilation the check on an assembly of the \bin directory to
decide if it has to be copied or not to temporary dir checks also st_mode
field.
If the source file has not the same access mode of shadow copied ones it copies
the assembly one time for every webpage parsed, causing very long loading time
for big websites.
The check is done inside mono\metadata\appdomain.c on the
private_file_needs_copying function.

Reproducible: Always

Steps to Reproduce:
1. Install a web app with multiple pages and multiple dll inside bin directory
2. run chmod -R 777 on bin directory (everything different from 700 should
work)
3. start mono in debug mode
4. start the application
Actual Results:  
If you have many assemblies in bin directory you'll notice heavy disk load, if
not you can check on mono logs and you'll found a couple of lines like

Mono-INFO: Assembly Loader probing location:
'/var/www/test/bin/testlibrary.dll'.
Mono-INFO: Assembly Loader shadow-copied assembly to:
'/tmp/apache-temp-aspnet-0/ddd13fb8/assembly/shadow/dcbea906/bc9b83ee_60252ae8_00000001/testlibrary.dll'.

for every webpage.
The log is not granular but the files are really copied every time.

Expected Results:  
Same logs as above but the files should be copied only one time.
If you run chmod -R 700 on bin directory and restarts xsp or mod-mono-server
you'll notice a faster loading due to same st_mode on both files.


I think that mode is not a parameter that helps to understand if a file is
newer or not, size and date should be enough.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>





































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="093814.html">[Mono-bugs] [Bug 545260] shadowCopyBinAssemblies config param not	supported
</A></li>
	<LI>Next message: <A HREF="093458.html">[Mono-bugs] [Bug 545276] ASP.NET shadow copy checks also st_mode	field
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#93446">[ date ]</a>
              <a href="thread.html#93446">[ thread ]</a>
              <a href="subject.html#93446">[ subject ]</a>
              <a href="author.html#93446">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
