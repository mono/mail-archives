<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 78611][Nor] New - Exception at
	SoapHttpClientProtocol constructor (in MS.NET it works)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2078611%5D%5BNor%5D%20New%20-%20Exception%20at%0A%09SoapHttpClientProtocol%20constructor%20%28in%20MS.NET%20it%20works%29&In-Reply-To=bug-78611%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043642.html">
   <LINK REL="Next"  HREF="043645.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 78611][Nor] New - Exception at
	SoapHttpClientProtocol constructor (in MS.NET it works)</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2078611%5D%5BNor%5D%20New%20-%20Exception%20at%0A%09SoapHttpClientProtocol%20constructor%20%28in%20MS.NET%20it%20works%29&In-Reply-To=bug-78611%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 78611][Nor] New - Exception at
	SoapHttpClientProtocol constructor (in MS.NET it works)">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Wed Jun 14 08:21:20 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="043642.html">[Mono-bugs] [Bug 78643][Nor] Changed - MS.NET needs alternating
	quotes in server controls, mono does not
</A></li>
        <LI>Next message: <A HREF="043645.html">[Mono-bugs] [Bug 78490][Cos] Changed - Graying out of some Controls
	does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43644">[ date ]</a>
              <a href="thread.html#43644">[ thread ]</a>
              <a href="subject.html#43644">[ subject ]</a>
              <a href="author.html#43644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lluis at ximian.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=78611">http://bugzilla.ximian.com/show_bug.cgi?id=78611</A>

--- shadow/78611	2006-06-14 08:21:20.000000000 -0400
+++ shadow/78611.tmp.5350	2006-06-14 08:21:20.000000000 -0400
@@ -0,0 +1,278 @@
+Bug#: 78611
+Product: Mono: Class Libraries
+Version: unspecified
+OS: unknown
+OS Details: Windows XP SP2
+Status: NEW   
+Resolution: 
+Severity: Unknown
+Priority: Normal
+Component: Sys.XML
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lluis at ximian.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">knocte at gmail.com</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: Exception at SoapHttpClientProtocol constructor (in MS.NET it works)
+
+I have a very simple C# project created with VS2005 that only contains a
+web reference to a web service that I am developing.
+
+If I make a very simple testcase using a console application that only
+creates an instance of the main class of this project, .NET runs it without
+problems but Mono throws the following exception:
+
+C:\Apl\IRM4\src\Client\Tests\Debug
+Tests\TestConsoleLauncher\bin\Debug&gt;&quot;C:\Archivos de
+programa\Mono-1.1.15\bin\mono.exe&quot; TestConsoleLauncher.exe
+
+Unhandled Exception: System.InvalidOperationException: IsNullable may not
+be 'true' for value type System.Nullable`1[[System.Int32, mscorlib,
+Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]] in
+member 'updateId' in &lt;0x00621&gt; 
+System.Xml.Serialization.XmlReflectionImporter:ImportElementInfo
+(System.Type cls, System.String defaultName, System.String
+defaultNamespace, System.Type defaultType,
+System.Xml.Serialization.XmlTypeMapMemberElement member, Sys
+tem.Xml.Serialization.XmlAttributes atts)
+in &lt;0x00a95&gt; System.Xml.Serialization.XmlReflectionImporter:CreateMapMember
+(System.Type declaringType, System.Xml.Serialization.XmlReflectionMember
+rmember, System.String defaultNamespace)
+in &lt;0x00069&gt;
+System.Xml.Serialization.XmlReflectionImporter:ImportMembersMapping
+ (System.String elementName, System.String ns,
+System.Xml.Serialization.XmlRefle
+ctionMember[] members, Boolean hasWrapperElement)
+in &lt;0x0063b&gt; System.Web.Services.Protocols.SoapMethodStubInfo:.ctor
+(System.Web.Services.Protocols.TypeStubInfo typeStub,
+System.Web.Services.Protocols.LogicalMethodInfo source, System.Object kind,
+System.Xml.Serialization.XmlReflectionImporter xmlImporter,
+System.Xml.Serialization.SoapReflectionImporter soapImporter)
+in &lt;0x000c0&gt;
+System.Web.Services.Protocols.SoapTypeStubInfo:CreateMethodStubInfo
+ (System.Web.Services.Protocols.TypeStubInfo parent,
+System.Web.Services.Protocols.LogicalMethodInfo lmi, Boolean isClientProxy)
+in &lt;0x000f7&gt; System.Web.Services.Protocols.TypeStubInfo:BuildTypeMethods ()
+in &lt;0x00012&gt; System.Web.Services.Protocols.TypeStubInfo:Initialize ()
+in &lt;0x00065&gt;
+System.Web.Services.Protocols.LogicalTypeInfo:CreateTypeStubInfo
+(System.Type type)
+in &lt;0x00056&gt; System.Web.Services.Protocols.LogicalTypeInfo:GetTypeStub
+(System.String protocolName)
+in &lt;0x0001b&gt; System.Web.Services.Protocols.TypeStubManager:GetTypeStub
+(System.Type t, System.String protocolName)
+in &lt;0x00023&gt; System.Web.Services.Protocols.SoapHttpClientProtocol:.ctor ()
+in &lt;0x00013&gt; WebServiceReferences.IRM_WebServer.IRM_WS:.ctor ()
+in (wrapper remoting-invoke-with-check)
+WebServiceReferences.IRM_WebServer.IRM_WS:.ctor ()
+in &lt;0x00022&gt; TestConsoleLauncher.Program:Main (System.String[] args)
+
+
+The small testcase console project only contains the following code:
+
+using System;
+using System.Collections.Generic;
+using System.Text;
+
+using System.IO;
+
+namespace TestConsoleLauncher
+{
+    class Program
+    {
+        static void Main(string[] args)
+        {
+            WebServiceReferences.IRM_WebServer.IRM_WS oWebServer =
+              new WebServiceReferences.IRM_WebServer.IRM_WS();
+        }
+    }
+}
+
+The references of the project are:
+System
+System.Data
+System.Web.Services
+WebServiceReferences (this is the assembly that I have mentioned that only
+contains a web reference to a webservice).
+
+If you need the DLL of the WebServiceReferences assembly, I will see if I
+can post it here.
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">knocte at gmail.com</A>  2006-06-08 08:06 -------
+Changing priority to Normal.
+
+It seems a bug in System.Xml so reassigning Component.
+
+The exception is telling something about a field called updateId, so
+here is a code snippet from the References.cs file that contains all
+the references to this parameter:
+
+
+
+//------------------------------------------------------------------------------
+// &lt;auto-generated&gt;
+//     This code was generated by a tool.
+//     Runtime Version:2.0.50727.42
+//
+//     Changes to this file may cause incorrect behavior and will be
+lost if
+//     the code is regenerated.
+// &lt;/auto-generated&gt;
+//------------------------------------------------------------------------------
+
+// 
+// This source code was auto-generated by Microsoft.VSDesigner,
+Version 2.0.50727.42.
+// 
+#pragma warning disable 1591
+
+namespace WebServiceReferences.IRM_WebServer {
+    using System.Diagnostics;
+    using System.Web.Services;
+    using System.ComponentModel;
+    using System.Web.Services.Protocols;
+    using System;
+    using System.Xml.Serialization;
+    
+    
+    /// &lt;remarks/&gt;
+   
+[System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;System.Web.Services&quot;,
+&quot;2.0.50727.42&quot;)]
+    [System.Diagnostics.DebuggerStepThroughAttribute()]
+    [System.ComponentModel.DesignerCategoryAttribute(&quot;code&quot;)]
+    [System.Web.Services.WebServiceBindingAttribute(Name=&quot;IRM_WSSoap&quot;,
+Namespace=&quot;<A HREF="http://tempuri.org/&quot;">http://tempuri.org/&quot;</A>)]
+    public partial class IRM_WS :
+System.Web.Services.Protocols.SoapHttpClientProtocol {
+        
+        private System.Threading.SendOrPostCallback
+ExistsClientOperationCompleted;
+        
+        private System.Threading.SendOrPostCallback
+GetTerminalOperationCompleted;
+
+
+
+(...)
+
+
+
+       
+[System.Web.Services.Protocols.SoapDocumentMethodAttribute(&quot;<A HREF="http://tempuri.org/InsertUpdateEvent&quot;,">http://tempuri.org/InsertUpdateEvent&quot;,</A>
+RequestNamespace=&quot;<A HREF="http://tempuri.org/&quot;,">http://tempuri.org/&quot;,</A>
+ResponseNamespace=&quot;<A HREF="http://tempuri.org/&quot;,">http://tempuri.org/&quot;,</A>
+Use=System.Web.Services.Description.SoapBindingUse.Literal,
+ParameterStyle=System.Web.Services.Protocols.SoapParameterStyle.Wrapped)]
+        public int InsertUpdateEvent(int idSeverity, EventUpdateCode
+idEvent, string applicationName, string messageDescription,
+[System.Xml.Serialization.XmlElementAttribute(IsNullable=true)]
+System.Nullable&lt;int&gt; updateId, System.DateTime originatedDate, string
+guid) {
+            object[] results = this.Invoke(&quot;InsertUpdateEvent&quot;, new
+object[] {
+                        idSeverity,
+                        idEvent,
+                        applicationName,
+                        messageDescription,
+                        updateId,
+                        originatedDate,
+                        guid});
+            return ((int)(results[0]));
+        }
+        
+        /// &lt;remarks/&gt;
+        public void InsertUpdateEventAsync(int idSeverity,
+EventUpdateCode idEvent, string applicationName, string
+messageDescription, System.Nullable&lt;int&gt; updateId, System.DateTime
+originatedDate, string guid) {
+            this.InsertUpdateEventAsync(idSeverity, idEvent,
+applicationName, messageDescription, updateId, originatedDate, guid,
+null);
+        }
+        
+        /// &lt;remarks/&gt;
+        public void InsertUpdateEventAsync(int idSeverity,
+EventUpdateCode idEvent, string applicationName, string
+messageDescription, System.Nullable&lt;int&gt; updateId, System.DateTime
+originatedDate, string guid, object userState) {
+            if ((this.InsertUpdateEventOperationCompleted == null)) {
+                this.InsertUpdateEventOperationCompleted = new
+System.Threading.SendOrPostCallback(this.OnInsertUpdateEventOperationCompleted);
+            }
+            this.InvokeAsync(&quot;InsertUpdateEvent&quot;, new object[] {
+                        idSeverity,
+                        idEvent,
+                        applicationName,
+                        messageDescription,
+                        updateId,
+                        originatedDate,
+                        guid},
+this.InsertUpdateEventOperationCompleted, userState);
+        }
+
+
+
+(...)
+
+
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">knocte at gmail.com</A>  2006-06-09 04:55 -------
+The problem is here:
+
+<A HREF="http://svn.myrealbox.com/viewcvs/trunk/mcs/class/System.XML/System.Xml.Serialization/XmlReflectionImporter.cs?view=markup">http://svn.myrealbox.com/viewcvs/trunk/mcs/class/System.XML/System.Xml.Serialization/XmlReflectionImporter.cs?view=markup</A>
+
+if (elem.IsNullable &amp;&amp; elem.TypeData.IsValueType)
+    throw new InvalidOperationException (&quot;IsNullable may not be 'true'
+for value type &quot; + elem.TypeData.FullTypeName + &quot; in member '&quot; +
+defaultName + &quot;'&quot;);
+
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">knocte at gmail.com</A>  2006-06-09 05:41 -------
+Original condition:
+
+if (elem.IsNullable &amp;&amp; elem.TypeData.IsValueType)
+
+New one:
+
+if (elem.IsNullable &amp;&amp;
+    (!elem.TypeData.FullTypeName.ToString().Contains(&quot;System.Nullable&quot;))
+    &amp;&amp; elem.TypeData.IsValueType)
+
+Would it be acceptable this change?
+
+If I am on the right direction, perhaps this patch is a little
+&quot;hacky&quot;, I wonder if it can be done this way:
+
+(!elem.TypeData.Type is System.Nullable)
+
+Thanks in advance.
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">knocte at gmail.com</A>  2006-06-09 06:54 -------
+Just wondering again... (have not tested it yet):
+
+if (elem.IsNullable &amp;&amp; elem.TypeData.IsValueType){
+    boolean nullable = false;
+    foreach(Type interface in elem.TypeData.Type.GetInterfaces()){
+        if (interface is INullableValue){
+            nullable = true;
+            break;
+        }
+    }
+    if (!nullable){
+        throw new InvalidOperationException (&quot;Type &quot; +
+elem.TypeData.FullTypeName + &quot; in member '&quot; +
+defaultName + &quot;' does not implement INullableValue&quot;);
+    }
+}
+
+
+And something like this??
+
+
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lluis at ximian.com</A>  2006-06-14 08:21 -------
+It's not just a matter of finding a workaround for the crash. If
+serialization of such type is allowed as nullable, it may need other
+changes in the serializer.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043642.html">[Mono-bugs] [Bug 78643][Nor] Changed - MS.NET needs alternating
	quotes in server controls, mono does not
</A></li>
	<LI>Next message: <A HREF="043645.html">[Mono-bugs] [Bug 78490][Cos] Changed - Graying out of some Controls
	does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43644">[ date ]</a>
              <a href="thread.html#43644">[ thread ]</a>
              <a href="subject.html#43644">[ subject ]</a>
              <a href="author.html#43644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
