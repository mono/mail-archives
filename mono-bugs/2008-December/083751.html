<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 324335] [Vista] Win32 Interop Issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20324335%5D%20%5BVista%5D%20Win32%20Interop%20Issue&In-Reply-To=bug-324335-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="083750.html">
   <LINK REL="Next"  HREF="083756.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 324335] [Vista] Win32 Interop Issue</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20324335%5D%20%5BVista%5D%20Win32%20Interop%20Issue&In-Reply-To=bug-324335-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 324335] [Vista] Win32 Interop Issue">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Dec 23 09:01:58 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="083750.html">[Mono-bugs] [Bug 447807] Exception caught by the compiler while	compiling
</A></li>
        <LI>Next message: <A HREF="083756.html">[Mono-bugs] [Bug 430932] IsolatedStorageFile.GetStore throws	exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83751">[ date ]</a>
              <a href="thread.html#83751">[ thread ]</a>
              <a href="subject.html#83751">[ subject ]</a>
              <a href="author.html#83751">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=324335">https://bugzilla.novell.com/show_bug.cgi?id=324335</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=324335#c3">https://bugzilla.novell.com/show_bug.cgi?id=324335#c3</A>


Andy Hume &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
                 CC|                                                |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>




--- Comment #3 from Andy Hume &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>&gt;  2008-12-23 07:01:57 MST ---
Does anyone know whether the original fault as seen in MWF itself is still
present?  Was it that the setting clipboard data failed on Vista?  As this
seems to be the same issue as fixed by bug 414446.  The SetClipboardData
argument is a memory __handle__ and not a pointer.  The sample shows the wrong
usage (AllocHGlobal returns a pointer!), which is as was fixed in MWF.



IIUC the sample output shows that the different behaviours is a fluke(?) of the
memory allocation in StringToHGlobalUni!  Windows no longer has a memory handle
table, so the handle/pointer value actually encodes which type it is [1].  In
the test results above showing the pointers in hex is illuminating, see the
last nibble.

Fails:
&quot;hmem: 19459576&quot; = 0x0128EDF8

Works:
&quot;hmem:  2142512&quot; = 0x0020B130

So in the first case Windows tries to dereference a handle, but in the second
just uses it directly as a pointer.

[1] See the blogs posts around the following.  The commenter here describes the
internals:
&lt;<A HREF="http://blogs.msdn.com/oldnewthing/archive/2004/11/09/254441.aspx#254644">http://blogs.msdn.com/oldnewthing/archive/2004/11/09/254441.aspx#254644</A>&gt;


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="083750.html">[Mono-bugs] [Bug 447807] Exception caught by the compiler while	compiling
</A></li>
	<LI>Next message: <A HREF="083756.html">[Mono-bugs] [Bug 430932] IsolatedStorageFile.GetStore throws	exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83751">[ date ]</a>
              <a href="thread.html#83751">[ thread ]</a>
              <a href="subject.html#83751">[ subject ]</a>
              <a href="author.html#83751">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
