<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 349688] SocketFlags.Partial is not implemented correctly in Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20349688%5D%20SocketFlags.Partial%20is%20not%20implemented%0A%20correctly%20in%20Linux&In-Reply-To=bug-349688-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="083950.html">
   <LINK REL="Next"  HREF="083359.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 349688] SocketFlags.Partial is not implemented correctly in Linux</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20349688%5D%20SocketFlags.Partial%20is%20not%20implemented%0A%20correctly%20in%20Linux&In-Reply-To=bug-349688-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 349688] SocketFlags.Partial is not implemented correctly in Linux">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat Dec 13 16:35:46 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="083950.html">[Mono-bugs] [Bug 458928] ToolStrip is too small
</A></li>
        <LI>Next message: <A HREF="083359.html">[Mono-bugs] [Bug 458930] New: Webbrowser Printing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83358">[ date ]</a>
              <a href="thread.html#83358">[ thread ]</a>
              <a href="subject.html#83358">[ subject ]</a>
              <a href="author.html#83358">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=349688">https://bugzilla.novell.com/show_bug.cgi?id=349688</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">brian at sooloos.com</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=349688#c3">https://bugzilla.novell.com/show_bug.cgi?id=349688#c3</A>


Brian Luczkiewicz &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">brian at sooloos.com</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
             Status|RESOLVED                                        |REOPENED
         Resolution|FIXED                                           |




--- Comment #3 from Brian Luczkiewicz &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">brian at sooloos.com</A>&gt;  2008-12-13 14:35:36 MST ---
It appears that the work done under this ticket has introduced a regression:

===============================================================
/* Convert MonoSocketFlags */
static gint32 convert_socketflags (gint32 sflags)
{
        gint32 flags = 0;

        if (!sflags)
                /* SocketFlags.None */
                return 0;

        if (sflags &amp; ~(SocketFlags_OutOfBand | SocketFlags_MaxIOVectorLength |
SocketFlags_Peek |
                        SocketFlags_DontRoute | SocketFlags_Partial))
                /* Contains invalid flag values */
                return -1;

        if (sflags &amp; SocketFlags_OutOfBand)
                flags |= MSG_OOB;
        if (sflags &amp; SocketFlags_Peek)
                flags |= MSG_PEEK;
        if (sflags &amp; SocketFlags_DontRoute)
                flags |= MSG_DONTROUTE;
#if 0
        /* Ignore Partial - see bug 349688.  Don't return -1, because
         * according to the comment in that bug ms runtime doesn't for
         * UDP sockets (this means we will silently ignore it for TCP
         * too)
         */
        if (sflags &amp; SocketFlags_Partial)
#ifdef MSG_MORE
                flags |= MSG_MORE;
#else
                return -1;      
#endif
#endif
        if (sflags &amp; SocketFlags_MaxIOVectorLength)
                /* FIXME: Don't know what to do for MaxIOVectorLength query */
                return -1;

        return (flags ? flags : -1);
}
===============================================================

If you pass in SocketFlags_Partial to this routine (with no other flags OR'd
in), the method executes until the final return, but since it never sets any
native flags to the 'flags' variable, it ends up returning -1 and causing a
SocketException/Operation Not Supported. This doesn't seem to be consistent
with &quot;ignoring&quot; the flag.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>










































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="083950.html">[Mono-bugs] [Bug 458928] ToolStrip is too small
</A></li>
	<LI>Next message: <A HREF="083359.html">[Mono-bugs] [Bug 458930] New: Webbrowser Printing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83358">[ date ]</a>
              <a href="thread.html#83358">[ thread ]</a>
              <a href="subject.html#83358">[ subject ]</a>
              <a href="author.html#83358">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
