<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 458916] New: Implemetation errors on Copy.cs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20458916%5D%20New%3A%20Implemetation%20errors%20on%20Copy.cs&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="083347.html">
   <LINK REL="Next"  HREF="083354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 458916] New: Implemetation errors on Copy.cs</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20458916%5D%20New%3A%20Implemetation%20errors%20on%20Copy.cs&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 458916] New: Implemetation errors on Copy.cs">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat Dec 13 06:49:49 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="083347.html">[Mono-bugs] [Bug 438529] UIA Support for ListView Control
</A></li>
        <LI>Next message: <A HREF="083354.html">[Mono-bugs] [Bug 458928] New: ToolStrip is too small
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83353">[ date ]</a>
              <a href="thread.html#83353">[ thread ]</a>
              <a href="subject.html#83353">[ subject ]</a>
              <a href="author.html#83353">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=458916">https://bugzilla.novell.com/show_bug.cgi?id=458916</A>


           Summary: Implemetation errors on Copy.cs
           Product: Mono: Class Libraries
           Version: unspecified
          Platform: i686
        OS/Version: Windows Server 2008
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Ms.Build
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">marek.sieradzki at gmail.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">themann at indyfantasysports.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=259919)
 --&gt; (<A HREF="https://bugzilla.novell.com/attachment.cgi?id=259919">https://bugzilla.novell.com/attachment.cgi?id=259919</A>)
a patch that addresses the bugs/enhancements I've mentioned

I needed to use Mono's Copy.cs to get around an issue I'm having with
Microsoft's Copy task, in which I've noticed a few issues.  I have provided a
patch file which addresses most of these issues. I created the patch from
inside the mcs directory, as I had only checked out that directory.

First is a critical issue.  The implmentation had checked if the sourceFiles
lenght was equal to the destinationFiles length, before it deturmined whether
it was using DestinationFiles or DestinationFolder. Result is that it fails
with an exception if DestinationFolder is used.  I simply moved the code that
checks this to a more appropriate location (at a point where it's deturmined
that DestinationFiles is being used).

Another critical issue, if using DestinationFiles, the implementation does not
check first if the directory for the destinationFile exists, thus causing an
exception when attempting to copy the file to a nonexistant directory. To fix
this issue, I refactored the code in the DestinationFolder section so that the
directory creation code could be used by both.  As well, I check to ensure the
directory path contains a path before attempting to create the directory.

Another major issue is that the SourceFiles were being added to CopiedFiles. 
This is not the desired result, as CopiedFiles is expected to containt the
locations the files were copied to, not the location the files were copied
from.  I have modified this so that the destination location is added to the
CopiedFiles, as well as ensuring the original custom metadata of the
SourceFiles are copied over as well.

A couple of minor issues, I had replaced the double enumerator with an array
index lookup (the code is more apparent to it's intended goal this way), as
well I had replaced the single enumerator with a foreach.  I had also replaced
the well known metadata lookups with a lookup of the ItemSpec property.  That's
what the examples on MSDN used when obtaining a reference to a file/directory,
so I assume Microsoft's implementation probably uses it as well.  Since
ItemSpec is a relative path, I added a check to ensure the directory path isn't
empty before creating it.

A major minor issue, Microsoft's implementation only checks that the last
modification time on the files are equal; if the destination file was modified
more recently than the source file, Microsoft's implementation will still copy
the file if &quot;SkipUnchangedFiles&quot; is set to true. I thus have chaned the &quot;Less
than or equal&quot; to simply &quot;equal.&quot;

As an enhancement, I've also added some logging to the task, so that files
being copied can be seen as they are copied.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>







































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="083347.html">[Mono-bugs] [Bug 438529] UIA Support for ListView Control
</A></li>
	<LI>Next message: <A HREF="083354.html">[Mono-bugs] [Bug 458928] New: ToolStrip is too small
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#83353">[ date ]</a>
              <a href="thread.html#83353">[ thread ]</a>
              <a href="subject.html#83353">[ subject ]</a>
              <a href="author.html#83353">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
