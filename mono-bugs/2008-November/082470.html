<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 446341] New: System. ArgumentException raised eventually on control with double buffering
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20446341%5D%20New%3A%20System.%20ArgumentException%20raised%0A%20eventually%20on%20control%20with%20double%20buffering&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="082469.html">
   <LINK REL="Next"  HREF="082502.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 446341] New: System. ArgumentException raised eventually on control with double buffering</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20446341%5D%20New%3A%20System.%20ArgumentException%20raised%0A%20eventually%20on%20control%20with%20double%20buffering&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 446341] New: System. ArgumentException raised eventually on control with double buffering">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Nov 18 19:48:49 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="082469.html">[Mono-bugs] [Bug 315608] [PATCH] dont create temporaries for other	temporaries
</A></li>
        <LI>Next message: <A HREF="082502.html">[Mono-bugs] [Bug 446341] System. ArgumentException raised eventually on control with double buffering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#82470">[ date ]</a>
              <a href="thread.html#82470">[ thread ]</a>
              <a href="subject.html#82470">[ subject ]</a>
              <a href="author.html#82470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=446341">https://bugzilla.novell.com/show_bug.cgi?id=446341</A>


           Summary: System.ArgumentException raised eventually on control
                    with double buffering
           Product: Mono: Class Libraries
           Version: 2.0.x
          Platform: Macintosh
        OS/Version: Mac OS X 10.5
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: Sys.Drawing.
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bsd at cs.ubc.ca</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


I'm using MacOS X 10.5 running Mono 2.0.1 as from the binary package on
go-mono.com.

I have a chess game written as a .NET application.  This game has a control to
represent a chess board, called VisualChessBoard, which is implemented as a
subclass of UserControl.  This control uses double buffering -- it looks
terrible under Windows otherwise.

I've found that the game will eventually barf with the following error:

Unhandled Exception: System.ArgumentException: A null reference or invalid
value was found [GDI+ status: InvalidParameter]
  at System.Drawing.GDIPlus.CheckStatus (Status status) [0x00000] 
  at System.Drawing.Region.Exclude (Rectangle rect) [0x00000] 
  at (wrapper remoting-invoke-with-check) System.Drawing.Region:Exclude
(System.Drawing.Rectangle)
  at System.Windows.Forms.Control+DoubleBuffer.End
(System.Windows.Forms.PaintEventArgs pe) [0x00000] 
  at System.Windows.Forms.Control.WmPaint (System.Windows.Forms.Message&amp; m)
[0x00000] 
  at System.Windows.Forms.Control.WndProc (System.Windows.Forms.Message&amp; m)
[0x00000] 
  at System.Windows.Forms.ScrollableControl.WndProc
(System.Windows.Forms.Message&amp; m) [0x00000] 
  at System.Windows.Forms.ContainerControl.WndProc
(System.Windows.Forms.Message&amp; m) [0x00000] 
  at System.Windows.Forms.UserControl.WndProc (System.Windows.Forms.Message&amp; m)
[0x00000] 
  at System.Windows.Forms.Control+ControlWindowTarget.OnMessage
(System.Windows.Forms.Message&amp; m) [0x00000] 
  at System.Windows.Forms.Control+ControlNativeWindow.WndProc
(System.Windows.Forms.Message&amp; m) [0x00000] 
  at System.Windows.Forms.NativeWindow.WndProc (IntPtr hWnd, Msg msg, IntPtr
wParam, IntPtr lParam) [0x00000] 
  at System.Windows.Forms.XplatUICarbon.DispatchMessage
(System.Windows.Forms.MSG&amp; msg) [0x00000] 
  at System.Windows.Forms.XplatUI.DispatchMessage (System.Windows.Forms.MSG&amp;
msg) [0x00000] 
  at System.Windows.Forms.Application.RunLoop (Boolean Modal,
System.Windows.Forms.ApplicationContext context) [0x00000] 
  at System.Windows.Forms.Application.Run
(System.Windows.Forms.ApplicationContext context) [0x00000] 
  at System.Windows.Forms.Application.Run (System.Windows.Forms.Form mainForm)
[0x00000] 
  at RTChess.Server.ServerProgram.Main () [0x0000b] in
/Users/bsd/NECTAR/RTChess/svn-rtchess-gt2/RTChessServer/ServerProgram.cs:17 

This exception usually happens within 4 minutes, but can happen anytime from 20
seconds to 4 minutes.  We have never seen this problem under Windows.  I have
tried recompiling the source using Mono to no avail.

The double buffering is enabled both by setting the DoubleBuffered property to
true (performed by the VisualStudio designer) as well as invoking the following
code in the constructor:

           SetStyle(ControlStyles.AllPaintingInWmPaint |
                ControlStyles.UserPaint | ControlStyles.DoubleBuffer, true); 
            UpdateStyles();

If I disable the double-buffering by commenting out these lines, the app runs
for hours with no issues.

To help debug this, I modified mono 2.0.1's
mcs/class/System.Drawing/System.Drawing/Region.cs to spit out some debugging
information in Region.Exclude(Rectangle).  Interestingly the nativeRegion is a
null pointer.

   Region.Exclude(Rectangle) status=Ok: region=System.Drawing.Region,
nativeRegion=265536160, rectangle={X=0,Y=0,Width=528,Height=528}
   Region.Exclude(Rectangle) status=Ok: region=System.Drawing.Region,
nativeRegion=265536160, rectangle={X=0,Y=0,Width=528,Height=528}
   Region.Exclude(Rectangle) status=Ok: region=System.Drawing.Region,
nativeRegion=265536160, rectangle={X=0,Y=0,Width=528,Height=528}
   Region.Exclude(Rectangle) status=Ok: region=System.Drawing.Region,
nativeRegion=265536160, rectangle={X=0,Y=0,Width=528,Height=528}
   Region.Exclude(Rectangle) status=InvalidParameter:
region=System.Drawing.Region, nativeRegion=0,
rectangle={X=0,Y=0,Width=528,Height=528}

I have no MONO* vars (except for MONO_PATH to find my hacked System.Drawing.dll
for the above messages).


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>









































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="082469.html">[Mono-bugs] [Bug 315608] [PATCH] dont create temporaries for other	temporaries
</A></li>
	<LI>Next message: <A HREF="082502.html">[Mono-bugs] [Bug 446341] System. ArgumentException raised eventually on control with double buffering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#82470">[ date ]</a>
              <a href="thread.html#82470">[ thread ]</a>
              <a href="subject.html#82470">[ subject ]</a>
              <a href="author.html#82470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
