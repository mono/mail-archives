<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 442257] New: System.Array.Sort produces wrong	results
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20442257%5D%20New%3A%20System.Array.Sort%20produces%20wrong%0A%09results&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="081953.html">
   <LINK REL="Next"  HREF="081955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 442257] New: System.Array.Sort produces wrong	results</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20442257%5D%20New%3A%20System.Array.Sort%20produces%20wrong%0A%09results&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 442257] New: System.Array.Sort produces wrong	results">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Nov  6 07:43:12 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="081953.html">[Mono-bugs] [Bug 432423] [PATCH] mcs does not set assembly Flags to PublicKey by default, like csc does
</A></li>
        <LI>Next message: <A HREF="081955.html">[Mono-bugs] [Bug 442257] System.Array.Sort produces wrong results
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81954">[ date ]</a>
              <a href="thread.html#81954">[ thread ]</a>
              <a href="subject.html#81954">[ subject ]</a>
              <a href="author.html#81954">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=442257">https://bugzilla.novell.com/show_bug.cgi?id=442257</A>


           Summary: System.Array.Sort produces wrong results
           Product: Mono: Class Libraries
           Version: 2.0
          Platform: x86
        OS/Version: Mac OS X 10.5
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">fredrik.kling at swissqual.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


It seems like the Sort(Array, IComparer), in System.Array.Sort, function does
not swap when '0' is returned. However I think MS implementation does...
When comparing int's the following statement produces a wrongly sorted order,
compared to MS implementation (should be greatest first)

See further down for complete implementation, the various return statements
here are from the Compare function in the IComparer.

Ex1:
return ((ix &gt; iy ? 1 : 0));
Output differs, MS is expected mono is NOT sorted (leafs are unswapped).

Ex2:
&quot;return ((ix &gt; iy ? -1 : 1));&quot;
Returns expected order, and same result using both MS and Mono.

Ex3:
&quot;return ((ix &gt; iy ? 1 : -1));&quot;
MS throws exception, Mono does not...

Unhandled Exception: System.ArgumentException: IComparer (or the IComparable
methods it relies upon) did not return zero when Ar
ray.Sort called x. CompareTo(x). x: '1'  x's type: 'Int32' The IComparer:
'SortTest.MyComp'.
   at System.Array.SorterGenericArray.QuickSort(Int32 left, Int32 right)
   at System.Array.SorterGenericArray.QuickSort(Int32 left, Int32 right)
   at System.Array.Sort(Array keys, Array items, Int32 index, Int32 length,
IComparer comparer)
   at System.Array.Sort(Array array, IComparer comparer)


Tested on: 
- Mac OsX 10.5.4, Mono 2.0.1
- Win XP, Mono 1.9.1

Referenced against MS .Net 2.0

Examples:
C:\&gt;SortTest.exe
10
8
7
5
1

[this produces the same result on the Mac]
c:\&gt;mono\mono.exe SortTest.exe
8
10
7
1
5
-----
Test program:

using System;
using System.Collections.Generic;
using System.Collections;
using System.Text;

namespace SortTest
{
    public class MyComp : IComparer
    {
        #region IComparer Members

        public int Compare(object x, object y)
        {
            int ix, iy;
            ix = (int)x;
            iy = (int)y;
            // This should throw an exception!
            // return ((ix &gt; iy ? 1 : -1));
            // This should provide reversed order (Greatest first)
            return ((ix &gt; iy ? 1 : 0));
        }

        #endregion
    }
    class Program
    {
        static void Main(string[] args)
        {
            int[] num = new int[] { 1, 5, 7, 8, 10 };
            System.Array.Sort(num,new MyComp());
            for (int i = 0; i &lt; num.Length; i++)
            {
                System.Console.WriteLine(&quot;{0}&quot;, num[i]);

            }

        }
    }
}


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="081953.html">[Mono-bugs] [Bug 432423] [PATCH] mcs does not set assembly Flags to PublicKey by default, like csc does
</A></li>
	<LI>Next message: <A HREF="081955.html">[Mono-bugs] [Bug 442257] System.Array.Sort produces wrong results
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81954">[ date ]</a>
              <a href="thread.html#81954">[ thread ]</a>
              <a href="subject.html#81954">[ subject ]</a>
              <a href="author.html#81954">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
