<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 347189] New: Cannot compile Berkeley DB for .NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20347189%5D%20New%3A%20Cannot%20compile%20Berkeley%20DB%20for%20.NET&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="066199.html">
   <LINK REL="Next"  HREF="067275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 347189] New: Cannot compile Berkeley DB for .NET</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20347189%5D%20New%3A%20Cannot%20compile%20Berkeley%20DB%20for%20.NET&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 347189] New: Cannot compile Berkeley DB for .NET">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun Dec  9 14:15:33 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="066199.html">[Mono-bugs] [Bug 347188] CS1607 is not reported when referencing satellite assembly
</A></li>
        <LI>Next message: <A HREF="067275.html">[Mono-bugs] [Bug 347189] Cannot compile Berkeley DB for .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66200">[ date ]</a>
              <a href="thread.html#66200">[ thread ]</a>
              <a href="subject.html#66200">[ subject ]</a>
              <a href="author.html#66200">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=347189">https://bugzilla.novell.com/show_bug.cgi?id=347189</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">karl at waclawek.net</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=347189#c347187">https://bugzilla.novell.com/show_bug.cgi?id=347189#c347187</A>

           Summary: Cannot compile Berkeley DB for .NET
           Product: Mono: Compilers
           Version: 1.2.6
          Platform: x86
        OS/Version: Ubuntu
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: C#
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">karl at waclawek.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: ---


This was seen on Ubuntu 7.10 with Mono 1.2.6 preview 3.

Depending on the order of the source files passed to gmcs, the compiler crashes
with different kinds of exceptions. To reproduce:

1) Get source code from CVS: 
   cvs
-d:pserver:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">anonymous at libdb-dotnet.cvs.sourceforge.net</A>:/cvsroot/libdb-dotnet
login

  hit Enter (empty password).

  cvs -z3
-d:pserver:<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">anonymous at libdb-dotnet.cvs.sourceforge.net</A>:/cvsroot/libdb-dotnet co
-P libdb-dotnet

2) cd to src directory

3) open a terminal and run xbuild libdb_dotNET45.csproj
This will report success, but there is no assembly generated (bug in xbuild, I
guess). Then copy the gmcs commandline generated by xbuild (and written to the
console) back into the terminal and apply the fix for xbuild bug #347187
(define symbols), the command line should look like this (quotes around the
defines symbols):

gmcs /noconfig /debug:full /debug+ /optimize- /out:bin/Debug/libdb_dotNET45.dll
Properties/AssemblyInfo45.cs DB_LOCK.cs DB_LOCK_WRAP.cs DB_LOG.cs
DB_LOG_WRAP.cs DB_MPOOL.cs DB.cs DB_ENV.cs DB_ENV_Wrap.cs DB_MPOOL_WRAP.cs
DB_SEQUENCE.cs DB_SEQUENCE_Wrap.cs DB_TXN.cs DB_TXN_Wrap.cs DB_Wrap.cs DBC.cs
DBC_Wrap.cs Common.cs DBT.cs LibDb.cs Util.cs XA.cs /target:library /unsafe+
/define:&quot;TRACE;DEBUG;BDB_PACK8;BDB_4_5_20;_USE_32BIT_TIME_T&quot;
/reference:/opt/mono-1.2.6/lib/mono/gac/System/2.1.0.0__b77a5c561934e089/System.dll
/warn:4

Running this will result in gmcs crashing with an unhandled exception:

Unhandled Exception: Mono.CSharp.InternalErrorException: DB_MPOOL.cs(111,16):
BerkeleyDb.DB_MPOOLFILE.fileid ---&gt; System.NullReferenceException: Object
reference not set to an instance of an object
  at Mono.CSharp.Const.Define () [0x00000] 
  at Mono.CSharp.TypeContainer.FindMembers (MemberTypes mt, BindingFlags bf,
System.Reflection.MemberFilter filter, System.Object criteria) [0x00000] 
  at Mono.CSharp.TypeManager.MemberLookup_FindMembers (System.Type t,
MemberTypes mt, BindingFlags bf, System.String name, System.Boolean&amp;
used_cache) [0x00000] 
  at Mono.CSharp.TypeManager.RealMemberLookup (System.Type invocation_type,
System.Type qualifier_type, System.Type queried_type, MemberTypes mt,
BindingFlags original_bf, System.String name, IList almost_match) [0x00000] 
  at Mono.CSharp.TypeManager.MemberLookup (System.Type invocation_type,
System.Type qualifier_type, System.Type queried_type, MemberTypes mt,
BindingFlags original_bf, System.String name, IList almost_match) [0x00000] 
  at Mono.CSharp.Expression.MemberLookup (System.Type container_type,
System.Type qualifier_type, System.Type queried_type, System.String name,
MemberTypes mt, BindingFlags bf, Location loc) [0x00000] 
  at Mono.CSharp.Expression.MemberLookup (System.Type container_type,
System.Type qualifier_type, System.Type queried_type, System.String name,
Location loc) [0x00000] 
  at Mono.CSharp.MemberAccess.DoResolve (Mono.CSharp.EmitContext ec,
Mono.CSharp.Expression right_side) [0x00000] 
  at Mono.CSharp.MemberAccess.DoResolve (Mono.CSharp.EmitContext ec) [0x00000] 
  at Mono.CSharp.Expression.Resolve (Mono.CSharp.EmitContext ec, ResolveFlags
flags) [0x00000] 
  at Mono.CSharp.Expression.Resolve (Mono.CSharp.EmitContext ec) [0x00000] 
  at Mono.CSharp.Expression.ResolveAsConstant (Mono.CSharp.EmitContext ec,
Mono.CSharp.MemberCore mc) [0x00000] 
  at Mono.CSharp.FixedField.Define () [0x00000] 
  at Mono.CSharp.TypeContainer+MemberCoreArrayList.DefineContainerMembers ()
[0x00000] --- End of inner exception stack trace ---

  at Mono.CSharp.TypeContainer+MemberCoreArrayList.DefineContainerMembers ()
[0x00000] 
  at Mono.CSharp.TypeContainer.DefineContainerMembers
(Mono.CSharp.MemberCoreArrayList mcal) [0x00000] 
  at Mono.CSharp.TypeContainer.DoDefineMembers () [0x00000] 
  at Mono.CSharp.TypeContainer.DefineMembers () [0x00000] 
  at Mono.CSharp.RootContext.PopulateTypes () [0x00000] 
  at Mono.CSharp.Driver.MainDriver (System.String[] args) [0x00000] 
  at Mono.CSharp.Driver.Main (System.String[] args) [0x00000] 


Now, move the file Common.cs to another (earlier) position in the command line,
like this:

gmcs /noconfig /debug:full /debug+ /optimize- /out:bin/Debug/libdb_dotNET45.dll
Properties/AssemblyInfo45.cs Common.cs DB_LOCK.cs DB_LOCK_WRAP.cs DB_LOG.cs
DB_LOG_WRAP.cs DB_MPOOL.cs DB.cs DB_ENV.cs DB_ENV_Wrap.cs DB_MPOOL_WRAP.cs
DB_SEQUENCE.cs DB_SEQUENCE_Wrap.cs DB_TXN.cs DB_TXN_Wrap.cs DB_Wrap.cs DBC.cs
DBC_Wrap.cs DBT.cs LibDb.cs Util.cs XA.cs /target:library /unsafe+
/define:&quot;TRACE;DEBUG;BDB_PACK8;BDB_4_5_20;_USE_32BIT_TIME_T&quot;
/reference:/opt/mono-1.2.6/lib/mono/gac/System/2.1.0.0__b77a5c561934e089/System.dll
/warn:4

Recompile, gmcs crashes with another unhandled exception:

Unhandled Exception: Mono.CSharp.InternalErrorException: DB_Wrap.cs(2222,7):
BerkeleyDb.DbFile&lt;D,C&gt;.OpenCursor(BerkeleyDb.DB_TXN*,
DbFileCursor&lt;C,D&gt;.CreateFlags) ---&gt; System.InvalidOperationException: Operation
is not valid due to the current state of the object
  at System.Type.GetGenericTypeDefinition () [0x00000] 
  at System.Reflection.Emit.TypeBuilder.GetGenericTypeDefinition () [0x00000] 
  at Mono.CSharp.ConstructedType..ctor (System.Type t,
Mono.CSharp.TypeArguments args, Location l) [0x00000] 
  at Mono.CSharp.MemberAccess.ResolveNamespaceOrType (IResolveContext rc,
Boolean silent) [0x00000] 
  at Mono.CSharp.MemberAccess.ResolveAsTypeStep (IResolveContext ec, Boolean
silent) [0x00000] 
  at Mono.CSharp.Expression.ResolveAsBaseTerminal (IResolveContext ec, Boolean
silent) [0x00000] 
  at Mono.CSharp.Expression.ResolveAsTypeTerminal (IResolveContext ec, Boolean
silent) [0x00000] 
  at Mono.CSharp.Parameter.Resolve (IResolveContext ec) [0x00000] 
  at Mono.CSharp.Parameters.Resolve (IResolveContext ec) [0x00000] 
  at Mono.CSharp.InterfaceMemberBase.DefineParameters (Mono.CSharp.Parameters
parameters) [0x00000] 
  at Mono.CSharp.MethodCore.CheckBase () [0x00000] 
  at Mono.CSharp.MethodOrOperator.CheckBase () [0x00000] 
  at Mono.CSharp.MethodOrOperator.Define () [0x00000] 
  at Mono.CSharp.Method.Define () [0x00000] 
  at Mono.CSharp.TypeContainer+MemberCoreArrayList.DefineContainerMembers ()
[0x00000] --- End of inner exception stack trace ---

  at Mono.CSharp.TypeContainer+MemberCoreArrayList.DefineContainerMembers ()
[0x00000] 
  at Mono.CSharp.TypeContainer.DefineContainerMembers
(Mono.CSharp.MemberCoreArrayList mcal) [0x00000] 
  at Mono.CSharp.Class.DefineContainerMembers (Mono.CSharp.MemberCoreArrayList
list) [0x00000] 
  at Mono.CSharp.TypeContainer.DoDefineMembers () [0x00000] 
  at Mono.CSharp.Class.DoDefineMembers () [0x00000] 
  at Mono.CSharp.TypeContainer.DefineMembers () [0x00000] 
  at Mono.CSharp.RootContext.PopulateTypes () [0x00000] 
  at Mono.CSharp.Driver.MainDriver (System.String[] args) [0x00000] 
  at Mono.CSharp.Driver.Main (System.String[] args) [0x00000]


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>













































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="066199.html">[Mono-bugs] [Bug 347188] CS1607 is not reported when referencing satellite assembly
</A></li>
	<LI>Next message: <A HREF="067275.html">[Mono-bugs] [Bug 347189] Cannot compile Berkeley DB for .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#66200">[ date ]</a>
              <a href="thread.html#66200">[ thread ]</a>
              <a href="subject.html#66200">[ subject ]</a>
              <a href="author.html#66200">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
