<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 345510] New: CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20345510%5D%20New%3A%20CryptoStream%20ignores%20the%0A%20ICryptoTransform.%20CanTransformMultipleBlocks%20property%20when%20reading&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="066955.html">
   <LINK REL="Next"  HREF="065886.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 345510] New: CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20345510%5D%20New%3A%20CryptoStream%20ignores%20the%0A%20ICryptoTransform.%20CanTransformMultipleBlocks%20property%20when%20reading&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 345510] New: CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Dec  3 07:47:44 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="066955.html">[Mono-bugs] [Bug 345484] DateTimePicker: first day of week not	recognized
</A></li>
        <LI>Next message: <A HREF="065886.html">[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65882">[ date ]</a>
              <a href="thread.html#65882">[ thread ]</a>
              <a href="subject.html#65882">[ subject ]</a>
              <a href="author.html#65882">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=345510">https://bugzilla.novell.com/show_bug.cgi?id=345510</A>

           Summary: CryptoStream ignores the
                    ICryptoTransform.CanTransformMultipleBlocks property
                    when reading
           Product: Mono: Class Libraries
           Version: SVN
          Platform: All
        OS/Version: All
            Status: NEW
          Keywords: security
          Severity: Major
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lordhabbit at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: Third Party Developer/Partner


As the summary specifies, the CryptoStream.Read method ignores the
CanTransformMultipleBlocks property of its associated ICryptoTransform, which
makes it always transform blocks one by one, that is, ICT.InputBlockSize bytes
at a time.
This behaviour, though not optimal, is usually OK for encryption algorithms,
whose block sizes are usually around 16-64 bytes. However, hash algorithms can
also be used in a CryptoStream (they don't affect the data passing through
them, just hash it and make the result available in their Hash property), but
their InputBlockSize is fixed at 1 byte regardless of the true implementation
block size because they buffer data.
This brings about the doomsday scenario where trying to hash a 3MB file (which
takes less than .1 secs with sha1sum, IO time included) results in _at least_
three million calls* to ICryptoTransform.TransformBlock and a similar amount to
Buffer.BlockCopy. In other words: both CryptoStream and the hash algorithm are
buffering the data, having fun creating, copying and moving around millions of
1-byte arrays. In fact, 63 out of 64 calls to SHA1Managed.TransformBlock did
nothing else than buffer one more byte and return. The speed penalty is
massive, as hashing the file took nearly 2 seconds. This makes the CS+HAlg
combination _unusable_ for its usual purposes, i.e. checking large streams of
data.

THUS: given than HashAlgorithm.InputBlockSize is fixed at 1 for MS
compatibility, CryptoStream.Read needs to take full advantage of transforms
that can much multiple &quot;blocks&quot; in a single call to TransformBlock (as are hash
algorithms). This is not as easy as it seems, as one always needs to know
whether the underlying stream has reached its end in order to call
TransformFinalBlock, but it is performance-critical. Both the full MS
implementation and the Mono CS.Write method do it fine.


* All figures about calls were obtained using mono --profile. Elapsed times
were measured _without_ the --profile option.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>









































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="066955.html">[Mono-bugs] [Bug 345484] DateTimePicker: first day of week not	recognized
</A></li>
	<LI>Next message: <A HREF="065886.html">[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65882">[ date ]</a>
              <a href="thread.html#65882">[ thread ]</a>
              <a href="subject.html#65882">[ subject ]</a>
              <a href="author.html#65882">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
