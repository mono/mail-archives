<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20345510%5D%20CryptoStream%20ignores%20the%20ICryptoTransform.%0A%20CanTransformMultipleBlocks%20property%20when%20reading&In-Reply-To=bug-345510-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="065886.html">
   <LINK REL="Next"  HREF="065896.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20345510%5D%20CryptoStream%20ignores%20the%20ICryptoTransform.%0A%20CanTransformMultipleBlocks%20property%20when%20reading&In-Reply-To=bug-345510-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Dec  3 11:26:06 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="065886.html">[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
</A></li>
        <LI>Next message: <A HREF="065896.html">[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65890">[ date ]</a>
              <a href="thread.html#65890">[ thread ]</a>
              <a href="subject.html#65890">[ subject ]</a>
              <a href="author.html#65890">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=345510#c2">https://bugzilla.novell.com/show_bug.cgi?id=345510#c2</A>


Sebastien Pouliot &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">spouliot at novell.com</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
           Severity|Normal                                          |Enhancement
             Status|ASSIGNED                                        |NEEDINFO
      Info Provider|                                                |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lordhabbit at gmail.com</A>




--- Comment #2 from Sebastien Pouliot &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">spouliot at novell.com</A>&gt;  2007-12-03 09:26:06 MST ---
Here are my results for a 90mb file using sha1sum, HashAlgorithm.ComputeHash
and CryptoStream

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">poupou at pollux</A>:~/src/bugzilla&gt; l
~/Desktop/RX-34_2007SE_4.2007.26-8_PR_COMBINED_MR0_ARM.bin
-rw-r--r-- 1 poupou users 90298052 2007-09-07 17:43
/home/poupou/Desktop/RX-34_2007SE_4.2007.26-8_PR_COMBINED_MR0_ARM.bin

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">poupou at pollux</A>:~/src/bugzilla&gt; time sha1sum
~/Desktop/RX-34_2007SE_4.2007.26-8_PR_COMBINED_MR0_ARM.bin
8f932c938a677f9e5a67070aa3dee0c170a32f69 
/home/poupou/Desktop/RX-34_2007SE_4.2007.26-8_PR_COMBINED_MR0_ARM.bin

real    0m2.314s
user    0m1.440s
sys     0m0.104s

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">poupou at pollux</A>:~/src/bugzilla&gt; time mono 345510.exe SHA1 hash
~/Desktop/RX-34_2007SE_4.2007.26-8_PR_COMBINED_MR0_ARM.bin
8F-93-2C-93-8A-67-7F-9E-5A-67-07-0A-A3-DE-E0-C1-70-A3-2F-69

real    0m3.556s
user    0m3.416s
sys     0m0.072s

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">poupou at pollux</A>:~/src/bugzilla&gt; time mono 345510.exe SHA1 cryptostream
~/Desktop/RX-34_2007SE_4.2007.26-8_PR_COMBINED_MR0_ARM.bin
8F-93-2C-93-8A-67-7F-9E-5A-67-07-0A-A3-DE-E0-C1-70-A3-2F-69

real    0m3.550s
user    0m3.444s
sys     0m0.048s

I'm actually impressed that the later is as fast as ComputeHash since it
involves extra steps. This also means that my CryptoStream code is different
than yours ;-)

Here's mine:

using System;
using System.IO;
using System.Security.Cryptography;

class Digest {

        private const int Size = 4096;

        static byte[] hash (HashAlgorithm algo, Stream s)
        {
                return algo.ComputeHash (s);
        }

        static byte[] cryptostream (HashAlgorithm algo, Stream s)
        {
                // note: it could make sense to use a BufferedStream
                byte[] data = new byte[Size];
                using (CryptoStream cs = new CryptoStream (Stream.Null, algo,
CryptoStreamMode.Write)) {
                        int size = s.Read (data, 0, Size);
                        while (size &gt; 0) {
                                cs.Write (data, 0, size);
                                size = s.Read (data, 0, Size);
                        }
                }
                return algo.Hash;
        }

        // args: algorithm method filename
        static void Main (string [] args)
        {
                using (FileStream fs = File.OpenRead (args [2])) {
                        using (HashAlgorithm algo = HashAlgorithm.Create (args
[0])) {
                                byte[] digest = null;

                                switch (args [1].ToLower ()) {
                                case &quot;hash&quot;:
                                        digest = hash (algo, fs);
                                        break;
                                case &quot;cryptostream&quot;:
                                        digest = cryptostream (algo, fs);
                                        break;
                                default:
                                        throw new NotSupportedException (args
[1]);
                                }
                                Console.WriteLine (BitConverter.ToString
(digest));
                        }
                }
        }
}

Downgrading priority to Enhancement since the original test case _probably_
occurs only when reading byte-by-byte (which is bad for performance, crypto or
not). 

Please attach your own test case so I can see where the bottleneck lies in this
particular case.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="065886.html">[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
</A></li>
	<LI>Next message: <A HREF="065896.html">[Mono-bugs] [Bug 345510] CryptoStream ignores the ICryptoTransform. CanTransformMultipleBlocks property when reading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65890">[ date ]</a>
              <a href="thread.html#65890">[ thread ]</a>
              <a href="subject.html#65890">[ subject ]</a>
              <a href="author.html#65890">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
