<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 349655] New: ListControl etc: AOOREx on first add to bound IBindingList
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20349655%5D%20New%3A%20ListControl%20etc%3A%20AOOREx%20on%20first%20add%0A%20to%20bound%20IBindingList&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="067183.html">
   <LINK REL="Next"  HREF="067370.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 349655] New: ListControl etc: AOOREx on first add to bound IBindingList</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20349655%5D%20New%3A%20ListControl%20etc%3A%20AOOREx%20on%20first%20add%0A%20to%20bound%20IBindingList&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 349655] New: ListControl etc: AOOREx on first add to bound IBindingList">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Dec 18 17:30:35 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="067183.html">[Mono-bugs] [Bug 349621] Mono dies while trying to access	DateTimeOffset.MaxValue
</A></li>
        <LI>Next message: <A HREF="067370.html">[Mono-bugs] [Bug 349655] ListControl etc: AOOREx on first add to bound IBindingList
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67089">[ date ]</a>
              <a href="thread.html#67089">[ thread ]</a>
              <a href="subject.html#67089">[ subject ]</a>
              <a href="author.html#67089">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=349655">https://bugzilla.novell.com/show_bug.cgi?id=349655</A>


           Summary: ListControl etc: AOOREx on first add to bound
                    IBindingList
           Product: Mono: Class Libraries
           Version: unspecified
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Windows.Forms
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: ---


With code of the following form ComboxBox/ListControl throw
ArgumentOutOfRangeException when first adding to the list
[[
   IBindindList ibl = new BindingList&lt;int32&gt;();
   ComboBox cb = new ComboBox()
   cb.DataSource = ibl;
   // ...
   // list is empty and bound, first add -&gt; exception
   ibl.Add(99); //**
]]

Note that except for this particular case the data binding seems to work well
for my purposes.  Adding items updates any bound controls, navigating the list
in one control causes navigation in the others, etc.  So fixing this corner
case would allow one to use this functionality.

The sample app can be configured to start with an non-empty list (give it any
dummy command-line option) and you'll see the working behaviour.  Run without
any command-line options hit &lt;Do Fill&gt; and see the exception.


The exception in full is
[[
Unhandled Exception: System.ArgumentOutOfRangeException: Argument is out of
range.
Parameter name: SelectedIndex0
at System.Windows.Forms.ComboBox.set_SelectedIndex (int) [0x000c8] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\ComboBox.cs:651
at System.Windows.Forms.ListControl.OnPositionChanged (object,System.EventArgs)
[0x0000b] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\ListControl.cs:504
at (wrapper delegate-invoke)
System.MulticastDelegate.invoke_void_object_EventArgs (object,System.EventArgs)
&lt;0x00040&gt;
at (wrapper delegate-invoke)
System.MulticastDelegate.invoke_void_object_EventArgs (object,System.EventArgs)
&lt;0x00067&gt;
at System.Windows.Forms.CurrencyManager.OnPositionChanged (System.EventArgs)
[0x0000b] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\CurrencyManager.cs:283
at System.Windows.Forms.CurrencyManager.ChangeRecordState
(int,bool,bool,bool,bool) [0x00068] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\CurrencyManager.cs:334
at System.Windows.Forms.CurrencyManager.ListChangedHandler
(object,System.ComponentModel.ListChangedEventArgs) [0x000e0] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\CurrencyManager.cs:409
at System.ComponentModel.BindingList`1.OnListChanged
(System.ComponentModel.ListChangedEventArgs) [0x0000b] in
D:\cygwin\usr\src\mono\mcs\class\System\System.ComponentModel\BindingList.cs:256
at System.ComponentModel.BindingList`1.InsertItem (int,System.Version)
[0x0001f] in
D:\cygwin\usr\src\mono\mcs\class\System\System.ComponentModel\BindingList.cs:244
at System.Collections.ObjectModel.Collection`1.System.Collections.IList.Add
(object) [0x0000c] in
D:\cygwin\usr\src\mono\mcs\class\corlib\System.Collections.ObjectModel\Collection.cs:209
at ListControlIBindingList.buttonDoFill_Click (object,System.EventArgs)
&lt;0x00034&gt;
at System.Windows.Forms.Control.OnClick (System.EventArgs) [0x0001c] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:5651
at System.Windows.Forms.Button.OnClick (System.EventArgs) [0x00024] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Button.cs:104
at System.Windows.Forms.ButtonBase.OnMouseUp
(System.Windows.Forms.MouseEventArgs) [0x00076] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\ButtonBase.cs:616
at System.Windows.Forms.Button.OnMouseUp (System.Windows.Forms.MouseEventArgs)
[0x00000] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Button.cs:126
at System.Windows.Forms.Control.WmLButtonUp (System.Windows.Forms.Message&amp;)
[0x0005c] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:5247
at System.Windows.Forms.Control.WndProc (System.Windows.Forms.Message&amp;)
[0x0017c] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:5000
at System.Windows.Forms.ButtonBase.WndProc (System.Windows.Forms.Message&amp;)
[0x00055] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\ButtonBase.cs:674
at System.Windows.Forms.Button.WndProc (System.Windows.Forms.Message&amp;)
[0x00000] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Button.cs:148
at ControlWindowTarget.OnMessage (System.Windows.Forms.Message&amp;) [0x00000] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:225
at ControlNativeWindow.WndProc (System.Windows.Forms.Message&amp;) [0x00000] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:206
at System.Windows.Forms.NativeWindow.WndProc
(intptr,System.Windows.Forms.Msg,intptr,intptr) [0x0006a] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\NativeWindow.cs:188
at System.Windows.Forms.XplatUIWin32.InternalWndProc
(intptr,System.Windows.Forms.Msg,intptr,intptr) [0x0002c] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\XplatUIWin32.cs:1886
at (wrapper native-to-managed)
System.Windows.Forms.XplatUIWin32.InternalWndProc
(intptr,System.Windows.Forms.Msg,intptr,intptr) &lt;0x00065&gt;
at (wrapper managed-to-native)
System.Windows.Forms.XplatUIWin32.Win32DispatchMessage
(System.Windows.Forms.MSG&amp;) &lt;0x00004&gt;
at System.Windows.Forms.XplatUIWin32.DispatchMessage
(System.Windows.Forms.MSG&amp;) [0x00000] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\XplatUIWin32.cs:2081
at System.Windows.Forms.XplatUI.DispatchMessage (System.Windows.Forms.MSG&amp;)
[0x00000] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\XplatUI.cs:551
at System.Windows.Forms.Application.RunLoop
(bool,System.Windows.Forms.ApplicationContext) [0x0033e] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Application.cs:842
at System.Windows.Forms.Application.Run
(System.Windows.Forms.ApplicationContext) [0x00014] in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Application.cs:630
at System.Windows.Forms.Application.Run (System.Windows.Forms.Form) [0x00000]
in
D:\cygwin\usr\src\mono\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Application.cs:618
at ListControlIBindingList.Foo (bool) &lt;0x001ec&gt;
at ListControlIBindingList.Main (string[]) &lt;0x00045&gt;
]]

The same occurs if using a ListBox too.

Repro is
[[
using System;
using System.Collections.Generic;
using System.Text;
using System.Windows.Forms;
using System.ComponentModel;

class ListControlIBindingList
{
        static void Main(string[] args)
        {
                bool nonEmptyWhenBound = false;
                //
                if (args.Length &gt; 0)
                        nonEmptyWhenBound = true;
                //
                Foo(nonEmptyWhenBound);
        }

        static IBindingList m_ibl;

        static void buttonDoFill_Click(object sender, EventArgs e)
        {
                // The bug occurs here, the list is empty and bound, 
                // now add an item to it.  Crash.  Occurs when empty list -&gt;
item added.
                m_ibl.Add(new Version(3, 1));
                m_ibl.Add(new Version(3, 2));
                m_ibl.Add(new Version(3, 3));
        }

        private static void Foo(bool nonEmptyWhenBound)
        {
                Form f = new Form();
                f.Text = &quot;ListControlIBindingList&quot;;
                FlowLayoutPanel flp = new FlowLayoutPanel();
                f.Controls.Add(flp);
                //
                m_ibl = new BindingList&lt;Version&gt;();
                bool skipBug = false || nonEmptyWhenBound;
                if (skipBug) {
                        m_ibl.Add(new Version(0, 99));// NON-EMPTY at bound Add
                }
                //
                ListControl cb = new ComboBox();
                cb.DataSource = m_ibl;
                flp.Controls.Add(cb);
                //
                Button b = new Button();
                b.Text = &quot;Do Fill&quot;;
                b.Click += buttonDoFill_Click;
                flp.Controls.Add(b);
                //
                //cb = new ComboBox();
                cb = new ListBox();
                cb.DataSource = m_ibl;
                flp.Controls.Add(cb);
                //
                Application.Run(f);
        }

}//class
]]


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>























































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="067183.html">[Mono-bugs] [Bug 349621] Mono dies while trying to access	DateTimeOffset.MaxValue
</A></li>
	<LI>Next message: <A HREF="067370.html">[Mono-bugs] [Bug 349655] ListControl etc: AOOREx on first add to bound IBindingList
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67089">[ date ]</a>
              <a href="thread.html#67089">[ thread ]</a>
              <a href="subject.html#67089">[ subject ]</a>
              <a href="author.html#67089">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
