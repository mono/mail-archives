<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 82627][Wis] New -	[Mono-1.2.4]-gmcs-EnumTypeAndUsingStatementBug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2082627%5D%5BWis%5D%20New%20-%0A%09%5BMono-1.2.4%5D-gmcs-EnumTypeAndUsingStatementBug&In-Reply-To=bug-82627%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="060872.html">
   <LINK REL="Next"  HREF="060874.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 82627][Wis] New -	[Mono-1.2.4]-gmcs-EnumTypeAndUsingStatementBug</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2082627%5D%5BWis%5D%20New%20-%0A%09%5BMono-1.2.4%5D-gmcs-EnumTypeAndUsingStatementBug&In-Reply-To=bug-82627%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 82627][Wis] New -	[Mono-1.2.4]-gmcs-EnumTypeAndUsingStatementBug">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Wed Aug 29 11:00:06 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="060872.html">[Mono-bugs] [Bug 81924][Blo] Changed - On big endian ARM IXP425	system: System.ArgumentException: Size is too big
</A></li>
        <LI>Next message: <A HREF="060874.html">[Mono-bugs] [Bug 82627][Wis] Changed -	[Mono-1.2.4]-gmcs-EnumTypeAndUsingStatementBug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60873">[ date ]</a>
              <a href="thread.html#60873">[ thread ]</a>
              <a href="subject.html#60873">[ subject ]</a>
              <a href="author.html#60873">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lei.min at gmx.de.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=82627">http://bugzilla.ximian.com/show_bug.cgi?id=82627</A>

--- shadow/82627	2007-08-29 11:00:06.000000000 -0400
+++ shadow/82627.tmp.1114	2007-08-29 11:00:06.000000000 -0400
@@ -0,0 +1,107 @@
+Bug#: 82627
+Product: Mono: Compilers
+Version: 1.2
+OS: 
+OS Details: Windows with .net framework 2.0
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Wishlist
+Component: C#
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">rharinath at novell.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lei.min at gmx.de</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: [Mono-1.2.4]-gmcs-EnumTypeAndUsingStatementBug
+
+Description of Problem:
+i have by myself build the gmcs.exe under Visual C# 2005 Express Edition.
+the gmcs.exe hat three known bugs in the source. the bugs are:
+gmcs.exe can not compile C# source which includes enum type define,which
+has a usingstatement with var_declaration
+(for example: using(ClassA a=new ClassA());)
+i am trying myself to debug these. and found some changes, it can resolve
+these bugs. but i am not sure ,if those changes are correct.
+
+&gt; mcs\typemanager.cs
+&gt; //public static void AddUserType(DeclSpace ds)
+&gt; //{
+&gt; //+ if (ds is Enum)
+&gt; //+ {
+&gt; //+ ds.TypeBuilder = ds.DefineType();
+&gt; //+ }
+&gt; // builder_to_declspace.Add(ds.TypeBuilder, ds);
+&gt; //} line 401,410 typemanager.cs patch for the Enum to remove:
+&gt; // InvalidOperationException (&quot;enum basetype is not defined&quot;);
+&gt; //
+&gt; mcs\ecore.cs
+&gt; //public override object GetTypedValue ()
+&gt; //{
+&gt; // // FIXME: runtime is not ready to work with just emited enums
+&gt; // if (!RootContext.StdLib) {
+&gt; // return Child.GetValue ();
+&gt; // }
+&gt; //
+&gt; //+ return Child.GetValue();
+&gt; //- return System.Enum.ToObject (type, Child.GetValue ());
+&gt; //} line 1538,1547 ecore.cs patch for the Enum to remove:
+&gt; // ArgumentException (&quot;enumType must be a runtime type&quot;);
+
+&gt; mcs\statement.cs
+&gt; //- if (emit_finally)
+&gt; //-    ig.BeginFinallyBlock();
+&gt; 
+&gt; // line 4512,4516 statement.cs remove the ArgumentException in using
+statement, because
+&gt; // ig.BeginFinallyBlock() has been called in the method
+DoEmitFinally(EmitContext) in the Class ExceptionStatement
+
+&gt; //				if (emit_finally)
+&gt; //					ig.BeginExceptionBlock ();
+&gt; //				assign [i].Emit (ec);
+&gt; //orignal is: 
+&gt; //              assign [i].Emit (ec);
+&gt; //
+&gt; //				if (emit_finally)
+&gt; //					ig.BeginExceptionBlock ();
+&gt; //
+&gt; // line 4490,4495  statement.cs assign[i].Emit should be after the
+BeginExceptionBlock,because assign has referenced the local variable
+&gt; //  and it will call Dispose(); in the finallyblock, or we can in finally
+block generate a local copy for the variable.
+
+
+&gt; //		protected override void CloneTo (CloneContext clonectx, Statement t)
+&gt; //		{
+&gt; //			Using target = (Using) t;
+&gt; //
+&gt; //			if (expression_or_block is Expression)
+&gt; //				target.expression_or_block = ((Expression)
+expression_or_block).Clone (clonectx);
+&gt; //			else
+&gt; //-				target.expression_or_block = ((DictionaryEntry)
+expression_or_block).Clone (clonectx);
+&gt; //+             target.expression_or_block = expression_or_block;
+&gt; //			
+&gt; //			target.Statement = Statement.Clone (clonectx);
+&gt; //		}
+&gt; // line 4670,4685 statement.cs
+
+
+
+here is another bug in the statement.cs ,but i can not change.
+&gt; mcs\statement.cs
+&gt; in Class Using:
+&gt; // protected override void CloneTo (CloneContext clonectx, Statement t)
+&gt; // {
+&gt; // Using target = (Using) t;
+&gt; // if (expression_or_block is Expression)
+&gt; // target.expression_or_block =
+&gt; ((Expression)expression_or_block).Clone(clonectx);
+&gt; // else
+&gt; // error---&gt;&gt; target.expression_or_block = ((Statement)
+&gt; expression_or_block).Clone (clonectx);
+&gt; // } line 4670,4685 expression_or_block is either a Expression or a
+&gt; DictionaryEntry, not a Statement.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="060872.html">[Mono-bugs] [Bug 81924][Blo] Changed - On big endian ARM IXP425	system: System.ArgumentException: Size is too big
</A></li>
	<LI>Next message: <A HREF="060874.html">[Mono-bugs] [Bug 82627][Wis] Changed -	[Mono-1.2.4]-gmcs-EnumTypeAndUsingStatementBug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60873">[ date ]</a>
              <a href="thread.html#60873">[ thread ]</a>
              <a href="subject.html#60873">[ subject ]</a>
              <a href="author.html#60873">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
