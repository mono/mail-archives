<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 573988] New: Soft debugger is broken on systems not supporting MMAP_32BIT flag (Solaris, probably *BSD)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20573988%5D%20New%3A%20Soft%20debugger%20is%20broken%20on%20systems%0A%20not%20supporting%20MMAP_32BIT%20flag%20%28Solaris%2C%20probably%20%2ABSD%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="096888.html">
   <LINK REL="Next"  HREF="096911.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 573988] New: Soft debugger is broken on systems not supporting MMAP_32BIT flag (Solaris, probably *BSD)</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20573988%5D%20New%3A%20Soft%20debugger%20is%20broken%20on%20systems%0A%20not%20supporting%20MMAP_32BIT%20flag%20%28Solaris%2C%20probably%20%2ABSD%29&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 573988] New: Soft debugger is broken on systems not supporting MMAP_32BIT flag (Solaris, probably *BSD)">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Jan 26 12:24:43 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="096888.html">[Mono-bugs] [Bug 573976] IOMAP doesn't like backslashes in	directory names
</A></li>
        <LI>Next message: <A HREF="096911.html">[Mono-bugs] [Bug 573988] Soft debugger is broken on systems not supporting MMAP_32BIT flag (Solaris, probably *BSD)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96889">[ date ]</a>
              <a href="thread.html#96889">[ thread ]</a>
              <a href="subject.html#96889">[ subject ]</a>
              <a href="author.html#96889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=573988">http://bugzilla.novell.com/show_bug.cgi?id=573988</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=573988#c0">http://bugzilla.novell.com/show_bug.cgi?id=573988#c0</A>


           Summary: Soft debugger is broken on systems not supporting
                    MMAP_32BIT flag (Solaris, probably *BSD)
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.6.x
          Platform: x86-64
        OS/Version: Solaris 10
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: debug
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">martin at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">burkhard.linke at CeBiTec.Uni-Bielefeld.DE</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=338902)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=338902">http://bugzilla.novell.com/attachment.cgi?id=338902</A>)
Patch (diff -Nur -p1) for enabling soft debugger on Solaris

User-Agent:       Mozilla/5.0 (X11; U; SunOS sun4u; en-US; rv:1.9.1.7)
Gecko/20091223 Firefox/3.5.2

The soft debugger built into the mono runtime requires the pages for triggering
single step and breakpoint events to be accessible with a 32 bit pointer.

Some operation systems do not support mmap flags to restrict the returned page
to the first 4 GB of address space.

As a result the assertion in mono_arch_output_basic_block (mini_amd64.c) about
the location of the single step trigger page fails, resulting in a termination
of the mono process.

ERROR:mini-amd64.c:3509:mono_arch_output_basic_block: assertion failed:
(((guint64)ss_trigger_page &gt;&gt; 32) == 0)
Stacktrace:

(no stack trace printed...)

Reproducible: Always

Steps to Reproduce:
1. Compile mono on Solaris or *BSD (according to some code comments,
Free/NetBSD
   do not support MMAP_32BIT, too)
2. Start monodevelop, configure a project to use a terminal window of its own
   for its output
3. Start debugging the project
Actual Results:  
A message about a failed assertion appears and the mono process terminates.


Attached is a patch that adds support for debugging on amd64 on systems without
MMAP_32BIT. The conditional parts of the patch depend on the
MONO_ARCH_NOMAP32BIT define, which should be set by configure for the systems
in question.

The patch works for me[tm], using Solaris 10 on amd64. YMMV.

Details:
The patch replaces the instruction to access the single step trigger page (or
break point trigger page) with an instruction to write the content of the EAX
register to that location. The resulting opcode &quot;mov EAX, [addr]&quot; is one of the
very few opcode that allow adressing a 64 location directly, without using a
register. The content of EAX does not matter at the moment, since the access
itself trigger the single step or breakpoint event. No register allocation is
needed.

Unfortunatly the opcode sequence uses 9 bytes (compared to 8 bytes in the
former sequence), so I also had to fix some other file except
mono/mini/mini-amd64.c and mono/arch/amd64-codegen.h. This patch should also be
checked on other platforms, too.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="096888.html">[Mono-bugs] [Bug 573976] IOMAP doesn't like backslashes in	directory names
</A></li>
	<LI>Next message: <A HREF="096911.html">[Mono-bugs] [Bug 573988] Soft debugger is broken on systems not supporting MMAP_32BIT flag (Solaris, probably *BSD)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96889">[ date ]</a>
              <a href="thread.html#96889">[ thread ]</a>
              <a href="subject.html#96889">[ subject ]</a>
              <a href="author.html#96889">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
