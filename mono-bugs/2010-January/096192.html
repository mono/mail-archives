<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 568366] New: NET_2_0 profile : BuildManagerDirectoryBuilder AddVirtualDir infinite loop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20568366%5D%20New%3A%20NET_2_0%20profile%20%3A%0A%20BuildManagerDirectoryBuilder%20AddVirtualDir%20infinite%20loop&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="096191.html">
   <LINK REL="Next"  HREF="096206.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 568366] New: NET_2_0 profile : BuildManagerDirectoryBuilder AddVirtualDir infinite loop</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20568366%5D%20New%3A%20NET_2_0%20profile%20%3A%0A%20BuildManagerDirectoryBuilder%20AddVirtualDir%20infinite%20loop&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 568366] New: NET_2_0 profile : BuildManagerDirectoryBuilder AddVirtualDir infinite loop">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Jan  5 11:51:59 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="096191.html">[Mono-bugs] [Bug 468842] New Rule: Avoid mixing string and	characters
</A></li>
        <LI>Next message: <A HREF="096206.html">[Mono-bugs] [Bug 568366] NET_2_0 profile : BuildManagerDirectoryBuilder AddVirtualDir infinite loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96192">[ date ]</a>
              <a href="thread.html#96192">[ thread ]</a>
              <a href="subject.html#96192">[ subject ]</a>
              <a href="author.html#96192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=568366">http://bugzilla.novell.com/show_bug.cgi?id=568366</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=568366#c0">http://bugzilla.novell.com/show_bug.cgi?id=568366#c0</A>


           Summary: NET_2_0 profile : BuildManagerDirectoryBuilder
                    AddVirtualDir infinite loop
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: Sys.Web
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">informatique.internet at fiducial.fr</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (X11; U; Linux i686; fr; rv:1.9.1.6)
Gecko/20091215 Ubuntu/9.10 (karmic) Firefox/3.5

We have a complex web application with many ascx files with dependencies...
if i launch xsp2... the compilation never ends...
I've sent a SIGQUIT to xsp2 and i've seen that mono was cycling in
AddVirtualDir...

After further investigation, we've seen the you never add the VirtualDir to the
cache variable... this can lead to infinites loops

Reproducible: Always




Patch to fix this issue

Index: System.Web.Compilation/BuildManagerDirectoryBuilder.cs
===================================================================
--- System.Web.Compilation/BuildManagerDirectoryBuilder.cs    (r&#233;vision 149000)
+++ System.Web.Compilation/BuildManagerDirectoryBuilder.cs    (copie de
travail)
@@ -158,6 +158,7 @@
         {
             if (vdir == null)
                 return;

             BuildProvider bp;
             IDictionary &lt;string, bool&gt; deps;
@@ -186,7 +187,9 @@
                     depDir = VirtualPathUtility.GetDirectory (s); //
dependencies are assumed to contain absolute paths
                     if (cache.ContainsKey (depDir))
                         continue;
+                    cache.Add(depDir,true);
                     AddVirtualDir (GetVirtualDirectory (s), bpcoll, cache);
+                    
                 }
             }
         }

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="096191.html">[Mono-bugs] [Bug 468842] New Rule: Avoid mixing string and	characters
</A></li>
	<LI>Next message: <A HREF="096206.html">[Mono-bugs] [Bug 568366] NET_2_0 profile : BuildManagerDirectoryBuilder AddVirtualDir infinite loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96192">[ date ]</a>
              <a href="thread.html#96192">[ thread ]</a>
              <a href="subject.html#96192">[ subject ]</a>
              <a href="author.html#96192">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
