<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 572783] New: Socket async io thread not cleaned up properly when mono_jit_cleanup() is called
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20572783%5D%20New%3A%20Socket%20async%20io%20thread%20not%20cleaned%20up%0A%20properly%20when%20mono_jit_cleanup%28%29%20is%20called&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="096764.html">
   <LINK REL="Next"  HREF="096765.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 572783] New: Socket async io thread not cleaned up properly when mono_jit_cleanup() is called</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20572783%5D%20New%3A%20Socket%20async%20io%20thread%20not%20cleaned%20up%0A%20properly%20when%20mono_jit_cleanup%28%29%20is%20called&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 572783] New: Socket async io thread not cleaned up properly when mono_jit_cleanup() is called">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jan 21 15:23:36 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="096764.html">[Mono-bugs] [Bug 572781] OnInit event of SqlDataSource does not	fire.
</A></li>
        <LI>Next message: <A HREF="096765.html">[Mono-bugs] [Bug 572783] Socket async io thread not cleaned up properly when mono_jit_cleanup() is called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96761">[ date ]</a>
              <a href="thread.html#96761">[ thread ]</a>
              <a href="subject.html#96761">[ subject ]</a>
              <a href="author.html#96761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=572783">http://bugzilla.novell.com/show_bug.cgi?id=572783</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=572783#c0">http://bugzilla.novell.com/show_bug.cgi?id=572783#c0</A>


           Summary: Socket async io thread not cleaned up properly when
                    mono_jit_cleanup() is called
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.6.x
          Platform: x86
        OS/Version: Windows Vista
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: io-layer
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">amir at unity3d.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Customer
           Blocker: No


Created an attachment (id=338108)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=338108">http://bugzilla.novell.com/attachment.cgi?id=338108</A>)
Patch that includes a repro case and potential bug fix

Description of Problem:
Initially, this bug came in as a browser crash with the Unity player. The
developer was using async socket requests from managed code. When the window
with the Unity content was closed, Unity shut down and cleaned up mono in the
process, however, the async io request thread was still running even after mono
had shut down.

I was able to recreate the problem in a standard application using the &quot;teste&quot;
sample. I also have proposed a patch that seems to fix the problem, however,
probably needs a seasoned mono dev to review the changes and make the fix more
robust.


Steps to reproduce the problem:
1. Apply the patch to the 2.6.1 packaged source distribution.
2. Comment out changes to mini.c and gc.c.
3. Compile the test.cs with mcs.
4. Build the &quot;teste&quot; sample and run with the assembly from #3.
5. Watch it go boom. It's a timing issue, so if it doesn't happen the first
time, then after a few repeated attempts it should.
6. Comment back in the changes in mini.c and gc.c and re-run test.


Actual Results:
Crash in async_io thread.

Expected Results:
Mono shuts down and all threads properly.

How often does this happen? 
Frequently

Additional Information:
My observations as a &quot;newb&quot; to Mono code:
* the domain was not signaled as being unloaded during a mini_cleanup()
* async_invoke_io_thread may need additional synchronization for cleanup if
mono_thread_pool_remove_domain_jobs() is not sufficient

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="096764.html">[Mono-bugs] [Bug 572781] OnInit event of SqlDataSource does not	fire.
</A></li>
	<LI>Next message: <A HREF="096765.html">[Mono-bugs] [Bug 572783] Socket async io thread not cleaned up properly when mono_jit_cleanup() is called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96761">[ date ]</a>
              <a href="thread.html#96761">[ thread ]</a>
              <a href="subject.html#96761">[ subject ]</a>
              <a href="author.html#96761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
