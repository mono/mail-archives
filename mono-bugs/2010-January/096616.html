<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 567109] segmentation violation while compiling a C# module that worked in 2.4.2.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20567109%5D%20segmentation%20violation%20while%20compiling%20a%0A%20C%23%20module%20that%20worked%20in%202.4.2.3&In-Reply-To=bug-567109-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="096613.html">
   <LINK REL="Next"  HREF="096617.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 567109] segmentation violation while compiling a C# module that worked in 2.4.2.3</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20567109%5D%20segmentation%20violation%20while%20compiling%20a%0A%20C%23%20module%20that%20worked%20in%202.4.2.3&In-Reply-To=bug-567109-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 567109] segmentation violation while compiling a C# module that worked in 2.4.2.3">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Jan 18 13:17:15 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="096613.html">[Mono-bugs] [Bug 564682] Callback function not raised for web service method called through javascript proxy class
</A></li>
        <LI>Next message: <A HREF="096617.html">[Mono-bugs] [Bug 502623] Migrate from libglade to GtkBuilder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96616">[ date ]</a>
              <a href="thread.html#96616">[ thread ]</a>
              <a href="subject.html#96616">[ subject ]</a>
              <a href="author.html#96616">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=567109">http://bugzilla.novell.com/show_bug.cgi?id=567109</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=567109#c1">http://bugzilla.novell.com/show_bug.cgi?id=567109#c1</A>


scott fluto &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">srfcanada at hotmail.com</A>&gt; changed:

           What    |Removed                     |Added
----------------------------------------------------------------------------
                 CC|                            |<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">srfcanada at hotmail.com</A>

--- Comment #1 from scott fluto &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">srfcanada at hotmail.com</A>&gt; 2010-01-18 18:17:11 UTC ---
I actually get this same crash trying to compile one of our projects and as
with you it only happens on mono 2.6.1 and tried to  apply your patch and still
get the same segment fault. Do you think it could manifest itself in other
places.

thanks

scott
(In reply to comment #0)
&gt;<i> Description of Problem: We are using Mono for a large hardware/software
</I>&gt;<i> project.  After upgrading to mono 2.6.1 we found a crashing bug when gmcs was
</I>&gt;<i> trying to compile one of our modules.  
</I>&gt;<i> I'm attaching a fix for the null reference that occurs while compiling an
</I>&gt;<i> Indexer contained within a Class.  Unfortunately, I haven't yet extracted a
</I>&gt;<i> test case out of the (large/interdependent) class that shows the problem.
</I>&gt;<i> I hope that the developer for mono/metadata/reflection.c can look at this patch
</I>&gt;<i> and I suspect they will already know that in some cases method-&gt;klass can be
</I>&gt;<i> NULL.
</I>&gt;<i> n:
</I>&gt;<i> Here is the fix:
</I>&gt;<i> --- mono-2.6.1.orig/mono/metadata/reflection.c    2009-12-17 01:48:22.000000000
</I>&gt;<i> -0800
</I>&gt;<i> +++ mono-2.6.1/mono/metadata/reflection.c    2009-12-23 12:13:54.000000000
</I>&gt;<i> -0800
</I>&gt;<i> @@ -8430,6 +8430,12 @@
</I>&gt;<i>      if (method-&gt;is_inflated)
</I>&gt;<i>          method = ((MonoMethodInflated *) method)-&gt;declaring;
</I>&gt;<i> +    // kevinh - my test case is complex, but it used to compile fine with
</I>&gt;<i> 2.4.2.3
</I>&gt;<i> +    // I had to add the following two lines to get my failing code to not
</I>&gt;<i> +    // bomb out in the compiler
</I>&gt;<i> +    if(!method-&gt;klass)
</I>&gt;<i> +        return NULL;
</I>&gt;<i> +
</I>&gt;<i>      if (method-&gt;klass-&gt;image-&gt;dynamic) {
</I>&gt;<i>          MonoCustomAttrInfo *res, *ainfo;
</I>&gt;<i>          int size;
</I>&gt;<i> Here is the stack trace from the crash:
</I>&gt;<i> Stacktrace:
</I>&gt;<i>   at (wrapper managed-to-native) System.MonoCustomAttrs.IsDefinedInternal
</I>&gt;<i> (System.Reflection.ICustomAttributeProvider,System.Type) &lt;0x0004b&gt;
</I>&gt;<i>   at (wrapper managed-to-native) System.MonoCustomAttrs.IsDefinedInternal
</I>&gt;<i> (System.Reflection.ICustomAttributeProvider,System.Type) &lt;0x0004b&gt;
</I>&gt;<i>   at System.MonoCustomAttrs.IsDefined
</I>&gt;<i> (System.Reflection.ICustomAttributeProvider,System.Type,bool) &lt;0x00067&gt;
</I>&gt;<i>   at System.Reflection.ParameterInfo.IsDefined (System.Type,bool) &lt;0x00023&gt;
</I>&gt;<i>   at Mono.CSharp.ParametersImported.Create
</I>&gt;<i> (System.Reflection.ParameterInfo[],System.Reflection.MethodBase) &lt;0x00308&gt;
</I>&gt;<i>   at Mono.CSharp.TypeManager.GetParameterData (System.Reflection.PropertyInfo)
</I>&gt;<i> &lt;0x000d7&gt;
</I>&gt;<i>   at Mono.CSharp.MemberCache.FindMemberToOverride
</I>&gt;<i> (System.Type,string,Mono.CSharp.AParametersCollection,Mono.CSharp.GenericMethod,bool)
</I>&gt;<i> &lt;0x00273&gt;
</I>&gt;<i>   at Mono.CSharp.Indexer.ResolveBaseProperty () &lt;0x00067&gt;
</I>&gt;<i>   at Mono.CSharp.PropertyBase.FindOutBaseMethod (System.Type&amp;) &lt;0x0002f&gt;
</I>&gt;<i>   at Mono.CSharp.InterfaceMemberBase.CheckBase () &lt;0x0010f&gt;
</I>&gt;<i>   at Mono.CSharp.Indexer.Define () &lt;0x00269&gt;
</I>&gt;<i>   at Mono.CSharp.TypeContainer/MemberCoreArrayList.DefineContainerMembers ()
</I>&gt;<i> &lt;0x000af&gt;
</I>&gt;<i>   at Mono.CSharp.TypeContainer.DefineContainerMembers
</I>&gt;<i> (Mono.CSharp.TypeContainer/MemberCoreArrayList) &lt;0x0001e&gt;
</I>&gt;<i>   at Mono.CSharp.Class.DefineContainerMembers
</I>&gt;<i> (Mono.CSharp.TypeContainer/MemberCoreArrayList) &lt;0x00073&gt;
</I>&gt;<i>   at Mono.CSharp.TypeContainer.DoDefineMembers () &lt;0x00fd3&gt;
</I>&gt;<i>   at Mono.CSharp.Class.DoDefineMembers () &lt;0x0004f&gt;
</I>&gt;<i>   at Mono.CSharp.TypeContainer.Define () &lt;0x0002f&gt;
</I>&gt;<i>   at Mono.CSharp.ClassOrStruct.Define () &lt;0x00017&gt;
</I>&gt;<i>   at Mono.CSharp.Class.Define () &lt;0x0013f&gt;
</I>&gt;<i>   at Mono.CSharp.RootContext.PopulateTypes () &lt;0x00358&gt;
</I>&gt;<i>   at Mono.CSharp.Driver.Compile () &lt;0x007ab&gt;
</I>&gt;<i>   at Mono.CSharp.Driver.Main (string[]) &lt;0x000ab&gt;
</I>&gt;<i>   at (wrapper runtime-invoke) &lt;Module&gt;.runtime_invoke_int_object
</I>&gt;<i> (object,intptr,intptr,intptr) &lt;0x00054&gt;
</I>&gt;<i> Thread 1 (Thread 0x7fb25d61e720 (LWP 22948)):
</I>&gt;<i> #0  0x00007fb25c9405cb in read () from /lib/libpthread.so.0
</I>&gt;<i> #1  0x000000000048b638 in mono_handle_native_sigsegv (signal=&lt;value optimized
</I>&gt;<i> out&gt;, ctx=&lt;value optimized out&gt;) at mini-exceptions.c:1809
</I>&gt;<i> #2  0x00000000004d440d in mono_arch_handle_altstack_exception
</I>&gt;<i> (sigctx=0x7fb25d628c40, fault_addr=&lt;value optimized out&gt;, stack_ovf=0)
</I>&gt;<i>     at exceptions-amd64.c:879
</I>&gt;<i> #3  &lt;signal handler called&gt;
</I>&gt;<i> #4  0x000000000056d6b6 in mono_custom_attrs_from_param (method=0x7fb255bf9a50,
</I>&gt;<i> param=1) at reflection.c:8434
</I>&gt;<i> #5  0x00000000005247a6 in custom_attrs_defined_internal (obj=0x7fb255bf9a50,
</I>&gt;<i> attr_type=0x1) at icall.c:7227
</I>&gt;<i> #6  0x0000000040a7429b in ?? ()
</I>&gt;<i> #7  0x000000000092e3f0 in ?? ()
</I>&gt;<i> #8  0x0000000000000000 in ?? ()
</I>
-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="096613.html">[Mono-bugs] [Bug 564682] Callback function not raised for web service method called through javascript proxy class
</A></li>
	<LI>Next message: <A HREF="096617.html">[Mono-bugs] [Bug 502623] Migrate from libglade to GtkBuilder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96616">[ date ]</a>
              <a href="thread.html#96616">[ thread ]</a>
              <a href="subject.html#96616">[ subject ]</a>
              <a href="author.html#96616">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
