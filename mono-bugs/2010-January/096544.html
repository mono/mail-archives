<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 571131] Build fails only on 64bit xen instance with illegal operation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20571131%5D%20Build%20fails%20only%20on%2064bit%20xen%20instance%0A%20with%20illegal%20operation&In-Reply-To=bug-571131-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="096538.html">
   <LINK REL="Next"  HREF="096546.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 571131] Build fails only on 64bit xen instance with illegal operation</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20571131%5D%20Build%20fails%20only%20on%2064bit%20xen%20instance%0A%20with%20illegal%20operation&In-Reply-To=bug-571131-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 571131] Build fails only on 64bit xen instance with illegal operation">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Jan 15 19:25:04 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="096538.html">[Mono-bugs] [Bug 571131] Build fails only on 64bit xen instance with illegal operation
</A></li>
        <LI>Next message: <A HREF="096546.html">[Mono-bugs] [Bug 571131] Build fails only on 64bit xen instance with illegal operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96544">[ date ]</a>
              <a href="thread.html#96544">[ thread ]</a>
              <a href="subject.html#96544">[ subject ]</a>
              <a href="author.html#96544">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=571131">http://bugzilla.novell.com/show_bug.cgi?id=571131</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=571131#c4">http://bugzilla.novell.com/show_bug.cgi?id=571131#c4</A>


--- Comment #4 from Miguel de Icaza &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">miguel at novell.com</A>&gt; 2010-01-16 00:25:02 UTC ---
converting method System.StackOverflowException:.ctor ()
creating vars
created temp 0 (R16) of type System.StackOverflowException&amp;
        this:  arg R16 &lt;-
creating locals
locals done
method to IR System.StackOverflowException:.ctor ()
converting (in B2: stack: 0) IL_0000: ldarg.0   
converting (in B2: stack: 1) IL_0001: ldstr     &quot;The requested operation caused
a stack overflow.&quot;
converting (in B2: stack: 2) IL_0006: call      0x060006df
INLINE START 0xa08758 System.StackOverflowException:.ctor () -&gt; Locale:GetText
(string)
created temp 1 (R19) of type System.String
method to IR Locale:GetText (string)
created temp 2 (R20) of type System.String
converting (in B7: stack: 0) IL_0000: ldarg.0   
converting (in B7: stack: 1) IL_0001: ret       
INLINE END System.StackOverflowException:.ctor () -&gt; Locale:GetText (string)
converting (in B2: stack: 2) IL_000b: call      0x060013aa
INLINE START 0xa4d030 System.StackOverflowException:.ctor () -&gt;
System.SystemException:.ctor (string)
method to IR System.SystemException:.ctor (string)
created temp 3 (R23) of type System.Object
created temp 4 (R24) of type System.String
converting (in B12: stack: 0) IL_0000: ldarg.0   
converting (in B12: stack: 1) IL_0001: ldarg.1   
converting (in B12: stack: 2) IL_0002: call      0x06000619
INLINE ABORTED System.SystemException:.ctor (string)
converting (in B2: stack: 0) IL_0010: ret       
REGION BB0 IL_0000 ID_FFFFFFFF
REGION BB3 IL_0000 ID_FFFFFFFF
REGION BB2 IL_0010 ID_FFFFFFFF
REGION BB1 IL_0000 ID_FFFFFFFF

AFTER METHOD-TO-IR 0: [IN: , OUT:  BB3(0) ]

AFTER METHOD-TO-IR 3: [IN:  BB0(0), OUT:  BB2(0) ]

AFTER METHOD-TO-IR 2: [IN:  BB3(0), OUT:  BB1(0) ]
 move R17 &lt;- R16
 aot_const R18 &lt;-
 nop
 move R20 &lt;- R18
 move R21 &lt;- R20
 move R19 &lt;- R21
 nop
 move R22 &lt;- R19
 move R27 &lt;- R17
 move R28 &lt;- R22
 voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi &lt;- R28]
clobbers: c
 br [B1]

AFTER METHOD-TO-IR 1: [IN:  BB2(0), OUT:  ]
CCOPY/2: R17 -&gt; R16
remove_block_if_useless, removed BB3
br removal triggered 2 -&gt; 1

HANDLE-GLOBAL-VREGS BLOCK 0:

HANDLE-GLOBAL-VREGS BLOCK 2:
 move R17 &lt;- R16
 aot_const R18 &lt;-
 move R20 &lt;- R18
 move R21 &lt;- R20
 move R19 &lt;- R21
 move R22 &lt;- R19
 move R27 &lt;- R16
 move R28 &lt;- R22
 voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi &lt;- R28]
clobbers: c
 nop

HANDLE-GLOBAL-VREGS BLOCK 1:
CONVERTED R19(1) TO VREG.
CONVERTED R20(2) TO VREG.
CONVERTED R23(3) TO VREG.
CONVERTED R24(4) TO VREG.
        Reverse copyprop in BB2 on  move R22 &lt;- R19
        Reverse copyprop in BB2 on  move R22 &lt;- R21
        Reverse copyprop in BB2 on  move R22 &lt;- R20
        Reverse copyprop in BB2 on  move R22 &lt;- R18

BEFORE LOWER-VTYPE-OPTS  0: [IN: , OUT:  BB2(1) ]

AFTER LOWER-VTYPE-OPTS  0: [IN: , OUT:  BB2(1) ]

BEFORE LOWER-VTYPE-OPTS  2: [IN:  BB0(0), OUT:  BB1(2) ]
 aot_const R22 &lt;-
 move R27 &lt;- R16
 move R28 &lt;- R22
 voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi &lt;- R28]
clobbers: c

AFTER LOWER-VTYPE-OPTS  2: [IN:  BB0(0), OUT:  BB1(2) ]
 aot_const R22 &lt;-
 move R27 &lt;- R16
 move R28 &lt;- R22
 voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi &lt;- R28]
clobbers: c

BEFORE LOWER-VTYPE-OPTS  1: [IN:  BB2(1), OUT:  ]

AFTER LOWER-VTYPE-OPTS  1: [IN:  BB2(1), OUT:  ]
COSTLY: System.StackOverflowException:.ctor () R16 G0 C1 %r15

SPILL BLOCK 0:

SPILL BLOCK 2:
 aot_const R22 &lt;-
         i   22 -1 -1 -1
        1  aot_const R22 &lt;-
 move R27 &lt;- R16
         ii  27 16 -1 -1
        1  nop
 move R28 &lt;- R22
         ii  28 22 -1 -1
        1  move R28 &lt;- R22
 voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi &lt;- R28]
clobbers: c
             -1 -1 -1 -1
        1  voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi
&lt;- R28] clobbers: c

SPILL BLOCK 1:
DUMP BLOCK 0:
DUMP BLOCK 2:
 aot_const R22 &lt;-
 load_membase R27 &lt;- [%rsp + 0x0]
 liverange_end R16
 move R28 &lt;- R22
 voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi &lt;- R28]
clobbers: c
DUMP BLOCK 1:

LOCAL REGALLOC: BASIC BLOCK 2:
        1  aot_const R22 &lt;-
        2  load_membase R27 &lt;- [%rsp + 0x0]
        3  liverange_end R16
        4  move R28 &lt;- R22
        5  voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi
&lt;- R28] clobbers: c
liveness: R22 [1 - 1]
liveness: R27 [2 - 2]
liveness: R28 [4 - 4]
processing:     5  voidcall [System.SystemException:.ctor (string)] [%rdi &lt;-
R27] [%rsi &lt;- R28] clobbers: c
        assigned arg reg %rdi to R27
        assigned arg reg %rsi to R28
        5  voidcall [System.SystemException:.ctor (string)] [%rdi &lt;- R27] [%rsi
&lt;- R28] clobbers: c
processing:     4  move R28 &lt;- R22
        assigned dreg %rsi to dest R28
        freeable %rsi (R28) (born in 4)
        assigned sreg1 %rsi to R22
        4  move %rsi &lt;- %rsi
processing:     3  liverange_end R16
        3  liverange_end R16
processing:     2  load_membase R27 &lt;- [%rsp + 0x0]
        assigned dreg %rdi to dest R27
        freeable %rdi (R27) (born in 2)
        2  load_membase %rdi &lt;- [%rsp + 0x0]
processing:     1  aot_const R22 &lt;-
        assigned dreg %rsi to dest R22
        freeable %rsi (R22) (born in 1)
        1  aot_const %rsi &lt;-
Basic block 0 starting at offset 0x8
Basic block 2 starting at offset 0x8
R16 END=0x13
Basic block 1 starting at offset 0x20
Method System.StackOverflowException:.ctor () emitted at 0x414f2e90 to
0x414f2eb5 (code length 37) [mscorlib.dll]

/tmp/.3VRY6U:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &lt;tem_StackOverflowException__ctor&gt;:
&lt;BB&gt;:2
   0:   48 83 ec 08             sub    $0x8,%rsp
   4:   48 89 3c 24             mov    %rdi,(%rsp)
   8:   49 8b 35 00 00 00 00    mov    0x0(%rip),%rsi        # f
&lt;tem_StackOverflowException__ctor+0xf&gt;
   f:   48 8b 3c 24             mov    (%rsp),%rdi
  13:   49 bb 00 00 00 00 00    mov    $0x0,%r11
  1a:   00 00 00 
  1d:   41 ff d3                callq  *%r11
&lt;BB&gt;:1
  20:   48 83 c4 08             add    $0x8,%rsp
  24:   c3                      retq   

Oddly, this does not seem to be what ends up in the file, this seems to be what
ends up in the file:
00000000000dbb70 &lt;System_StackOverflowException__ctor&gt;:
   dbb70:       48 83 ec 08             sub    $0x8,%rsp
   dbb74:       48 89 3c 24             mov    %rdi,(%rsp)
   dbb78:       49 8b 35 d9 93 29 00    mov    0x2993d9(%rip),%rsi        #
374f58 &lt;__bss_start+0x2d58&gt;
   dbb7f:       48 8b 3c 24             mov    (%rsp),%rdi
   dbb83:       e8 98 0a 00 00          callq  dc620
&lt;System_SystemException__ctor_string&gt;
   dbb88:       00 00                   add    %al,(%rax)
   dbb8a:       00 00                   add    %al,(%rax)
   dbb8c:       00 41 ff                add    %al,-0x1(%rcx)
   dbb8f:       d3 48 83                rorl   %cl,-0x7d(%rax)
   dbb92:       c4 08 c3 00             (bad)(bad) 

When running with GDB:
Program received signal SIGILL, Illegal instruction.
0x00007ffff4de5bc1 in System.StackOverflowException:.ctor (this=...,
message=0x7ffff7e55f80) from
/tmp/mono-2.7/mcs/class/lib/net_2_0/mscorlib.dll.so
(gdb) x/20i 0x00007ffff4de5bc1-33
0x7ffff4de5ba0 &lt;System.StackOverflowException:.ctor&gt;:    sub    $0x18,%rsp
0x7ffff4de5ba4 &lt;System.StackOverflowException:.ctor+4&gt;:    mov    %rdi,(%rsp)
0x7ffff4de5ba8 &lt;System.StackOverflowException:.ctor+8&gt;:    mov   
%rsi,0x8(%rsp)
0x7ffff4de5bad &lt;System.StackOverflowException:.ctor+13&gt;:    mov   
0x8(%rsp),%rsi
0x7ffff4de5bb2 &lt;System.StackOverflowException:.ctor+18&gt;:    callq 
0x7ffff4de6620 &lt;System.SystemException:.ctor&gt;
0x7ffff4de5bb7 &lt;System.StackOverflowException:.ctor+23&gt;:    add    %al,(%rax)
0x7ffff4de5bb9 &lt;System.StackOverflowException:.ctor+25&gt;:    add    %al,(%rax)
0x7ffff4de5bbb &lt;System.StackOverflowException:.ctor+27&gt;:    add   
%al,-0x1(%rcx)
0x7ffff4de5bbe &lt;System.StackOverflowException:.ctor+30&gt;:    rorl  
%cl,-0x7d(%rax)
0x7ffff4de5bc1 &lt;System.StackOverflowException:.ctor+33&gt;:    (bad)(bad) 

The dump after the callq instruction looks like this:
0x7ffff4de5bb7 &lt;System.StackOverflowException:.ctor+23&gt;:    0x00    0x00   
0x00    0x00    0x00    0x41    0xff    0xd3
0x7ffff4de5bbf &lt;System.StackOverflowException:.ctor+31&gt;:    0x48    0x83   
0xc4    0x18    0xc3    0x00    0x00    0x00

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="096538.html">[Mono-bugs] [Bug 571131] Build fails only on 64bit xen instance with illegal operation
</A></li>
	<LI>Next message: <A HREF="096546.html">[Mono-bugs] [Bug 571131] Build fails only on 64bit xen instance with illegal operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96544">[ date ]</a>
              <a href="thread.html#96544">[ thread ]</a>
              <a href="subject.html#96544">[ subject ]</a>
              <a href="author.html#96544">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
