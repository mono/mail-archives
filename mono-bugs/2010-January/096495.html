<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 570648] New: System.IO.Packaging ZipPackage does not work due to Uri issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20570648%5D%20New%3A%20System.IO.Packaging%20ZipPackage%20does%0A%20not%20work%20due%20to%20Uri%20issue&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="096492.html">
   <LINK REL="Next"  HREF="096496.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 570648] New: System.IO.Packaging ZipPackage does not work due to Uri issue</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20570648%5D%20New%3A%20System.IO.Packaging%20ZipPackage%20does%0A%20not%20work%20due%20to%20Uri%20issue&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 570648] New: System.IO.Packaging ZipPackage does not work due to Uri issue">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jan 14 08:35:57 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="096492.html">[Mono-bugs] [Bug 570647] New: abort in mono_method_to_ir (costs &gt; 0) while JITting a verified method
</A></li>
        <LI>Next message: <A HREF="096496.html">[Mono-bugs] [Bug 570648] System.IO.Packaging ZipPackage does not work due to Uri issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96495">[ date ]</a>
              <a href="thread.html#96495">[ thread ]</a>
              <a href="subject.html#96495">[ subject ]</a>
              <a href="author.html#96495">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=570648">http://bugzilla.novell.com/show_bug.cgi?id=570648</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=570648#c0">http://bugzilla.novell.com/show_bug.cgi?id=570648#c0</A>


           Summary: System.IO.Packaging ZipPackage does not work due to
                    Uri issue
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: WPF
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">toshok at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">amcgovern at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


There's an api in PackUriHelper to allow to relative Uris to be resolved into
one. See the remarks section at [0]. The issue is that the current
implementation of ResolvePartUri relies on a bug in mono which was fixed in
r132239. I'm unsure how to go about reimplementing this method, but until this
is fixed the Packaging API is completely unusable as this method is required
for the core funcionality to work.

Thinking about it, I think one possible approach would be to use an absolute
Uri as the base and contatenate that absolute uri with the sourcePartUri and
then concatenate the result of that with the targetUri and then trim out the
original absolute Uri. i.e.

public static Uri ResolvePartUri(Uri sourcePartUri, Uri targetUri)
{
    Uri uri = new Uri (&quot;<A HREF="http://fake.com&quot;">http://fake.com&quot;</A>);
    uri = new Uri (uri, sourcePartUri);
    uri = new Uri (uri, targetUri);

    // Trim out '<A HREF="http://fake.com'">http://fake.com'</A>
    return new Uri (uri.OriginalString.SubString (15), UriKind.Relative); 
}

However there must be a better way than this.

[0]
<A HREF="http://msdn.microsoft.com/en-us/library/system.io.packaging.packurihelper.resolveparturi.aspx">http://msdn.microsoft.com/en-us/library/system.io.packaging.packurihelper.resolveparturi.aspx</A>

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="096492.html">[Mono-bugs] [Bug 570647] New: abort in mono_method_to_ir (costs &gt; 0) while JITting a verified method
</A></li>
	<LI>Next message: <A HREF="096496.html">[Mono-bugs] [Bug 570648] System.IO.Packaging ZipPackage does not work due to Uri issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96495">[ date ]</a>
              <a href="thread.html#96495">[ thread ]</a>
              <a href="subject.html#96495">[ subject ]</a>
              <a href="author.html#96495">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
