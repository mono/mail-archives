<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 573188] OracleDataAdapter fills only the first table of the resulting dataSet when invoking a stored procedure with more than one cursor ref out parameters.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20573188%5D%20OracleDataAdapter%20fills%20only%20the%20first%0A%20table%20of%20the%20resulting%20dataSet%20when%20invoking%20a%20stored%20procedure%20with%20more%0A%20than%20one%20cursor%20ref%20out%20parameters.&In-Reply-To=bug-573188-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="096805.html">
   <LINK REL="Next"  HREF="096808.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 573188] OracleDataAdapter fills only the first table of the resulting dataSet when invoking a stored procedure with more than one cursor ref out parameters.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20573188%5D%20OracleDataAdapter%20fills%20only%20the%20first%0A%20table%20of%20the%20resulting%20dataSet%20when%20invoking%20a%20stored%20procedure%20with%20more%0A%20than%20one%20cursor%20ref%20out%20parameters.&In-Reply-To=bug-573188-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 573188] OracleDataAdapter fills only the first table of the resulting dataSet when invoking a stored procedure with more than one cursor ref out parameters.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Jan 25 14:15:04 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="096805.html">[Mono-bugs] [Bug 573188] OracleDataAdapter fills only the first table of the resulting dataSet when invoking a stored procedure with more than one cursor ref out parameters.
</A></li>
        <LI>Next message: <A HREF="096808.html">[Mono-bugs] [Bug 573241] New: HttpWebRequest disallows writing to the request stream for certain http methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96860">[ date ]</a>
              <a href="thread.html#96860">[ thread ]</a>
              <a href="subject.html#96860">[ subject ]</a>
              <a href="author.html#96860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=573188">http://bugzilla.novell.com/show_bug.cgi?id=573188</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=573188#c1">http://bugzilla.novell.com/show_bug.cgi?id=573188#c1</A>


--- Comment #1 from Jeffrey Alvarez &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">kuritsu at gmail.com</A>&gt; 2010-01-25 19:15:03 UTC ---
I think I found the error sources:

1st: The Read method in System.Data.OracleClient.OracleDataReader has the
following code:

        public override bool Read ()
        {
            ValidateState ();

            if (hasRows) {
                bool retval = statement.Fetch ();
                hasRows = retval;
                return retval;
            }
            return false;
        }

and NextResult is as follows:

                public override bool NextResult ()
        {
            ValidateState ();

            if (statement == null)
                return false;

            statement.Dispose ();
            statement = null;

            statement = command.GetNextResult ();

            if (statement == null)
                return false;

            return true; 
        }

As you can see, the hasRows field is not set to true in NextResult, in a way
that when Read is invoked, the Fetch is performed and hasRows updated.

There was also an issue related to the GetSchemaTable method. This method has
the following statement:

if (schemaTable.Rows != null &amp;&amp; schemaTable.Rows.Count &gt; 0)
   return schemaTable;

so, if the schema table was created for the first table the first time, then
after you invoke NextResult, the schema table isn't populated again, so you
should include some coding for reseting the schema table. This is the result of
the changed NextResult method:

                public override    bool NextResult ()
        {
            ValidateState ();

            if (statement == null)
                return false;

            statement.Dispose ();
            statement = null;

            hasRows = true; // !New

            schemaTable.Rows.Clear(); // !New

            statement = command.GetNextResult ();

            if (statement == null)
                return false;

            return true; 
        }

Please anyone notice this so you can update the Mono code repository.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="096805.html">[Mono-bugs] [Bug 573188] OracleDataAdapter fills only the first table of the resulting dataSet when invoking a stored procedure with more than one cursor ref out parameters.
</A></li>
	<LI>Next message: <A HREF="096808.html">[Mono-bugs] [Bug 573241] New: HttpWebRequest disallows writing to the request stream for certain http methods
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#96860">[ date ]</a>
              <a href="thread.html#96860">[ thread ]</a>
              <a href="subject.html#96860">[ subject ]</a>
              <a href="author.html#96860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
