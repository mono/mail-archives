<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 81850][Wis] New - gmcs/CSC and	System.Reflection(.Emit) differences between Mono, .NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2081850%5D%5BWis%5D%20New%20-%20gmcs/CSC%20and%0A%09System.Reflection%28.Emit%29%20differences%20between%20Mono%2C%20.NET&In-Reply-To=bug-81850%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="058026.html">
   <LINK REL="Next"  HREF="058028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 81850][Wis] New - gmcs/CSC and	System.Reflection(.Emit) differences between Mono, .NET</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2081850%5D%5BWis%5D%20New%20-%20gmcs/CSC%20and%0A%09System.Reflection%28.Emit%29%20differences%20between%20Mono%2C%20.NET&In-Reply-To=bug-81850%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 81850][Wis] New - gmcs/CSC and	System.Reflection(.Emit) differences between Mono, .NET">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Sun Jun 10 15:40:21 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="058026.html">[Mono-bugs] [Bug 81848][Wis] Changed - checked fails to detect	integer overflow
</A></li>
        <LI>Next message: <A HREF="058028.html">[Mono-bugs] [Bug 81850][Wis] Changed - gmcs/CSC and	System.Reflection(.Emit) differences between Mono, .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58027">[ date ]</a>
              <a href="thread.html#58027">[ thread ]</a>
              <a href="subject.html#58027">[ subject ]</a>
              <a href="author.html#58027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jonpryor at vt.edu.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=81850">http://bugzilla.ximian.com/show_bug.cgi?id=81850</A>

--- shadow/81850	2007-06-10 15:40:21.000000000 -0400
+++ shadow/81850.tmp.26455	2007-06-10 15:40:21.000000000 -0400
@@ -0,0 +1,142 @@
+Bug#: 81850
+Product: Mono: Compilers
+Version: unspecified
+OS: 
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Wishlist
+Component: C#
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">rharinath at novell.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jonpryor at vt.edu</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: gmcs/CSC and System.Reflection(.Emit) differences between Mono, .NET
+
+Please fill in this template when reporting a bug, unless you know what you
+are doing.
+Description of Problem:
+
+There are two sets of differences in the names generated for
+explicitly-implemented methods and properties between gmcs 1.2.x and CSC.EXE:
+
+1. Property names generated by gmcs are missing a namespace.
+
+2. Generic method names use [[FullyQualifedTypeName]] instead of
+&lt;TypeName&gt;.  (For added humor, property names use &lt;TypeName&gt;, as CSC does,
+but property names still lack the namespace name, as specified in (1)).
+
+The second issue is a fairly recent development, having started in Mono
+1.2.x.  Mono 1.1.18.1 (included with openSUSE 10.2) follows CSC behavior.
+
+Steps to reproduce the problem:
+1. Compile the attached `demo.cs' in gmcs, CSC.EXE 2.0.
+2. Compare the names generated for generic explicitly-implemented interface
+methods and properties.  For your convenience, the gmcs-generated IL is
+attached as demo-gmcs.il, and the CSC-generated IL is attached as demo-csc.il.
+3. Profit!
+
+Actual Results:
+
+For a property name, gmcs 1.2.4 (/trunk/ r78869) generates:
+
+  .property object IEnumerator.Current()
+  {
+    .get instance object Foo::System.Collections.IEnumerator.get_Current()
+  } // end of property Foo::IEnumerator.Current
+  .property class Foo 'IEnumerator&lt;Foo&gt;.Current'()
+  {
+    .get instance class Foo
+Foo::'System.Collections.Generic.IEnumerator`1[[Foo, test, Version=0.0.0.0,
+Culture=neutral, PublicKeyToken=null]].get_Current'()
+  } // end of property Foo::'IEnumerator&lt;Foo&gt;.Current'
+
+Note that the names lacks a namespace; compare with CSC, in which the
+namespace is present:
+
+  .property instance object System.Collections.IEnumerator.Current()
+  {
+    .get instance object Foo::System.Collections.IEnumerator.get_Current()
+  } // end of property Foo::System.Collections.IEnumerator.Current
+  .property instance class Foo
+'System.Collections.Generic.IEnumerator&lt;Foo&gt;.Current'()
+  {
+    .get instance class Foo
+Foo::'System.Collections.Generic.IEnumerator&lt;Foo&gt;.get_Current'()
+  } // end of property
+Foo::'System.Collections.Generic.IEnumerator&lt;Foo&gt;.Current'
+
+Further, note that the above generic properties use &lt;TypeName&gt;.  Compare to
+the following explicitly-implemented interface *methods*; gmcs:
+
+  .method private hidebysig newslot virtual final
+          instance class
+[mscorlib]System.Collections.Generic.IEnumerator`1&lt;class Foo&gt;
+          'System.Collections.Generic.IEnumerable`1[[Foo, test,
+Version=0.0.0.0, Culture=neutral, PublicKeyToken=null]].GetEnumerator'()
+cil managed
+  {
+    .override  method instance class
+[mscorlib]System.Collections.Generic.IEnumerator`1&lt;!0&gt; class
+[mscorlib]System.Collections.Generic.IEnumerable`1&lt;class Foo&gt;::GetEnumerator()
+    // Code size       2 (0x2)
+    .maxstack  8
+    IL_0000:  ldnull
+    IL_0001:  ret
+  } // end of method Foo::'System.Collections.Generic.IEnumerable`1[[Foo,
+test, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null]].GetEnumerator'
+
+CSC:
+
+  .method private hidebysig newslot virtual final
+          instance class
+[mscorlib]System.Collections.Generic.IEnumerator`1&lt;class Foo&gt;
+          'System.Collections.Generic.IEnumerable&lt;Foo&gt;.GetEnumerator'() cil
+managed
+  {
+    .override  method instance class
+[mscorlib]System.Collections.Generic.IEnumerator`1&lt;!0&gt; class
+[mscorlib]System.Collections.Generic.IEnumerable`1&lt;class Foo&gt;::GetEnumerator()
+    // Code size       7 (0x7)
+    .maxstack  1
+    .locals init (class
+[mscorlib]System.Collections.Generic.IEnumerator`1&lt;class Foo&gt; V_0)
+    IL_0000:  nop
+    IL_0001:  ldnull
+    IL_0002:  stloc.0
+    IL_0003:  br.s       IL_0005
+
+    IL_0005:  ldloc.0
+    IL_0006:  ret
+  } // end of method
+Foo::'System.Collections.Generic.IEnumerable&lt;Foo&gt;.GetEnumerator'
+
+Expected Results:
+
+Ideally, CSC behavior would be followed for both properties and methods.
+
+At minimum, one would think that property names and method names would be
+_consistent_ with each other (at present they aren't).
+
+How often does this happen? 
+
+Always.
+
+Additional Information:
+
+I stumbled across this while trying to add explicit-interface
+implementation support to monodocer.  With monodocer, we lookup a member
+name from the XML and use this name with
+System.Type.GetMember(string,BindingFlags).  Furthermore, I'm trying to use
+the CSC names within the XML files, because (1) I'd like to import from the
+ECMA documentation, which uses CSC-style names, and (2) they're sane (shorter).
+
+Unfortunately, with the current gmcs &quot;name-mangling&quot; scheme for
+explicitly-implemented interfaces, I can't go from XML-string -&gt; MemberInfo
+directly; instead, I'll need to iterate over all members on the type, do a
+MemberInfo -&gt; XML-string conversion, and then compare.  Yay overhead! 
+(Fortunately this *only* needs to be done for explicitly-implemented
+interface members, which are fairly rare.)
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="058026.html">[Mono-bugs] [Bug 81848][Wis] Changed - checked fails to detect	integer overflow
</A></li>
	<LI>Next message: <A HREF="058028.html">[Mono-bugs] [Bug 81850][Wis] Changed - gmcs/CSC and	System.Reflection(.Emit) differences between Mono, .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58027">[ date ]</a>
              <a href="thread.html#58027">[ thread ]</a>
              <a href="subject.html#58027">[ subject ]</a>
              <a href="author.html#58027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
