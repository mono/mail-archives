<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 81945][Maj] New - Fix r80368 breaks consistency	between WebControl's Load/SaveViewState.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2081945%5D%5BMaj%5D%20New%20-%20Fix%20r80368%20breaks%20consistency%0A%09between%20WebControl%27s%20Load/SaveViewState.&In-Reply-To=bug-81945%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="058302.html">
   <LINK REL="Next"  HREF="058304.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 81945][Maj] New - Fix r80368 breaks consistency	between WebControl's Load/SaveViewState.</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2081945%5D%5BMaj%5D%20New%20-%20Fix%20r80368%20breaks%20consistency%0A%09between%20WebControl%27s%20Load/SaveViewState.&In-Reply-To=bug-81945%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 81945][Maj] New - Fix r80368 breaks consistency	between WebControl's Load/SaveViewState.">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Mon Jun 25 08:10:03 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="058302.html">[Mono-bugs] [Bug 81944][Cos] Changed - Issues with TextBox (tested	under mono 1.2.4 for Windows)
</A></li>
        <LI>Next message: <A HREF="058304.html">[Mono-bugs] [Bug 81924][Blo] Changed - On big endian ARM IXP425	system: System.ArgumentException: Size is too big
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58303">[ date ]</a>
              <a href="thread.html#58303">[ thread ]</a>
              <a href="subject.html#58303">[ subject ]</a>
              <a href="author.html#58303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">kostat at mainsoft.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=81945">http://bugzilla.ximian.com/show_bug.cgi?id=81945</A>

--- shadow/81945	2007-06-25 08:10:03.000000000 -0400
+++ shadow/81945.tmp.14816	2007-06-25 08:10:03.000000000 -0400
@@ -0,0 +1,77 @@
+Bug#: 81945
+Product: Mono: Class Libraries
+Version: 1.2
+OS: 
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Major
+Component: Sys.Web
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">kostat at mainsoft.com</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Summary: Fix r80368 breaks consistency between WebControl's Load/SaveViewState.
+
+Fix r80368 breaks consistency between WebControl's Load/SaveViewState.
+
+See the mail thread for more details:
+
+&gt; The problem here is that we're not consistent in how we save the view
+&gt; state
+&gt; throughout various controls.
+That's not correct! As Igor said below: &quot;The control tree into which
+viewstate is being loaded must match the control tree that was used to save
+viewstate during the previous request&quot;. Only this matters for consistency
+(as with any serialization/deserialization logic), if you find such an
+issue, please point on it.
+
+This consistency is the reason for the exception thrown in our code. The
+very same behavior is seen in MS .net (see #78533), but, in case of an
+empty DropDownList, they probably have 'null' ViewState, while we have
+something else. This is what should be fixed.
+
+Kosta
+
+On Sun, 24 Jun 2007 05:05:36 -0700, &quot;Igor Zelmanovich&quot; &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">igorz at mainsoft.com</A>&gt;
+scribbled:
+
+
+&gt; Hi, Marek.
+Hello guys,
+
+&gt; #78533 is not a bug.
+&gt; 
+&gt; MS behaves the same if you add some code which causes the 
+&gt; usercontrol's saved viewstate to be not null.
+&gt; In this case the Page cannot load viewstate properly and the Exception 
+&gt; is thrown:
+&gt; 
+&gt; &quot;Failed to load viewstate.  The control tree into which viewstate is 
+&gt; being loaded must match the control tree that was used to save 
+&gt; viewstate during the previous request.  For example, when adding 
+&gt; controls dynamically, the controls added during a post-back must match 
+&gt; the type and position of the controls added during the initial request. &quot;
+&gt; 
+&gt; the sample works in .Net but not in MONO case implementation specific.
+&gt; 
+&gt; WebControl saves its ViewState into Pair instatnce always, and there 
+&gt; is no valid scenario where LoadViewState will be called with 
+&gt; <A HREF="dhttp://idea.opensuse.org/ifferent">dhttp://idea.opensuse.org/ifferent</A> typeargument.
+&gt; 
+&gt; I sagest to revert the changes from r80368.
+The problem here is that we're not consistent in how we save the view state
+throughout various controls. Sometimes, internally, we use a Triplet and
+sometimes a Pair. So I thought that it would be best to handle the
+situation where the state is loaded. Note that the sample was failing when
+there was no control with saved data in the state yet, which is what works
+on MS.NET.
+If you feel there's a need to change the way we store/restore view state
+now, please file a bug - we're in the hack week now
+(<A HREF="http://idea.opensuse.org/">http://idea.opensuse.org/</A>), so I'll take a look at the issue next week :)
+
+best regards,
+
+marek
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="058302.html">[Mono-bugs] [Bug 81944][Cos] Changed - Issues with TextBox (tested	under mono 1.2.4 for Windows)
</A></li>
	<LI>Next message: <A HREF="058304.html">[Mono-bugs] [Bug 81924][Blo] Changed - On big endian ARM IXP425	system: System.ArgumentException: Size is too big
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58303">[ date ]</a>
              <a href="thread.html#58303">[ thread ]</a>
              <a href="subject.html#58303">[ subject ]</a>
              <a href="author.html#58303">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
