<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 538854] New: Anonymous Delegate { Anonymous Delegate } ERROR: metadata.c:3201: mono_metadata_token_from_dor: code should not be reached
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20538854%5D%20New%3A%20Anonymous%20Delegate%20%7B%20Anonymous%0A%20Delegate%20%7D%20ERROR%3A%20metadata.c%3A3201%3A%20mono_metadata_token_from_dor%3A%20code%0A%20should%20not%20be%20reached&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="092559.html">
   <LINK REL="Next"  HREF="092552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 538854] New: Anonymous Delegate { Anonymous Delegate } ERROR: metadata.c:3201: mono_metadata_token_from_dor: code should not be reached</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20538854%5D%20New%3A%20Anonymous%20Delegate%20%7B%20Anonymous%0A%20Delegate%20%7D%20ERROR%3A%20metadata.c%3A3201%3A%20mono_metadata_token_from_dor%3A%20code%0A%20should%20not%20be%20reached&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 538854] New: Anonymous Delegate { Anonymous Delegate } ERROR: metadata.c:3201: mono_metadata_token_from_dor: code should not be reached">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun Sep 13 21:09:11 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="092559.html">[Mono-bugs] [Bug 538801] Object initializer for generic type generates invalid IL
</A></li>
        <LI>Next message: <A HREF="092552.html">[Mono-bugs] [Bug 538929] New: DesignSurface.Flush() thows exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92549">[ date ]</a>
              <a href="thread.html#92549">[ thread ]</a>
              <a href="subject.html#92549">[ subject ]</a>
              <a href="author.html#92549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=538854">http://bugzilla.novell.com/show_bug.cgi?id=538854</A>


           Summary: Anonymous Delegate { Anonymous Delegate } ERROR:
                    metadata.c:3201: mono_metadata_token_from_dor: code
                    should not be reached
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.4.x
          Platform: x86-64
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">teravus at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=318025)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=318025">http://bugzilla.novell.com/attachment.cgi?id=318025</A>)
Log-Stack Trace and abridged source files for review

User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1)
Gecko/20090624 Firefox/3.5

It looks like in some cases when an Anonymous Delegate contains another
anonymous delegate and the first one is fired with void delegate (void) using
the BeginInvoke in a static method and you're using Mono.Addins to load
modules, the mono_metadata_token_from_dor asserts on Linux.   On windows, it
just freezes.  (memory corruption?)

Reproducible: Always

Steps to Reproduce:
I've included the stack trace and abridged source of the areas.
The code that seems to trigger the bug is in SceneCommunicationService.cs.   It
happens regardless of whether the source is compiled in Visual Studio and run
on Mono, or if it was compiled with Mono and run on Mono.

The elements to this are as follows, 
A static method to call a BeginInvoke on a threadstart (Util.FireAndForget)
An anonymous delegate that references variables in the method that calls it.
(SceneCommunicationService.InformClientToInitateTeleportToLocation)

An anonymous delegate inside that anonymous delegate that takes bool.

Mono.Addins, in this case, I think just points it out..   it probably would
have happened anyway later.
Actual Results:  
Asserts on Linux.
Freezes on Windows.
while loading Mono.Addins modules.

Expected Results:  
The Anonymous delegates fire as expected.

If I take the Util.FireAndForget out of it, use a named delegate with proper
paramaters and do the BeginInvoke/EndInvoke the bug is not triggered.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>
































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="092559.html">[Mono-bugs] [Bug 538801] Object initializer for generic type generates invalid IL
</A></li>
	<LI>Next message: <A HREF="092552.html">[Mono-bugs] [Bug 538929] New: DesignSurface.Flush() thows exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92549">[ date ]</a>
              <a href="thread.html#92549">[ thread ]</a>
              <a href="subject.html#92549">[ subject ]</a>
              <a href="author.html#92549">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
