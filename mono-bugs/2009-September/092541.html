<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 528830] appdomain-unload.exe unit test fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20528830%5D%20appdomain-unload.exe%20unit%20test%20fails&In-Reply-To=bug-528830-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="092540.html">
   <LINK REL="Next"  HREF="092542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 528830] appdomain-unload.exe unit test fails</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20528830%5D%20appdomain-unload.exe%20unit%20test%20fails&In-Reply-To=bug-528830-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 528830] appdomain-unload.exe unit test fails">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Sep 11 21:17:03 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="092540.html">[Mono-bugs] [Bug 538720] MonoDevelop fails to start, console messages complain about _wapi_shm_file_open
</A></li>
        <LI>Next message: <A HREF="092542.html">[Mono-bugs] [Bug 528830] appdomain-unload.exe unit test fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92541">[ date ]</a>
              <a href="thread.html#92541">[ thread ]</a>
              <a href="subject.html#92541">[ subject ]</a>
              <a href="author.html#92541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=528830">http://bugzilla.novell.com/show_bug.cgi?id=528830</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">romain at blogreen.org</A> added comment
<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=528830#c8">http://bugzilla.novell.com/show_bug.cgi?id=528830#c8</A>





--- Comment #8 from Romain Tarti&#232;re &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">romain at blogreen.org</A>&gt;  2009-09-11 19:17:01 MDT ---
Created an attachment (id=317967)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=317967">http://bugzilla.novell.com/attachment.cgi?id=317967</A>)
Fix missing curly braces.

After a few more hours trying to fix this, I saw that the code indentation was
weird, svn blame says:

-----8&lt;---------------
 36953     zoltan     /* Wait for the thread */    
 36953     zoltan     while ((res = WaitForSingleObjectEx (thread_handle,
INFINITE, TRUE) == WAIT_IO_COMPLETION)) {
 36953     zoltan         if (mono_thread_has_appdomain_ref
(mono_thread_current (), domain) &amp;&amp; (mono_thread_interruption_requested ()))
 36953     zoltan             /* The unload thread tries to abort us */
 36953     zoltan             /* The icall wrapper will execute the abort */
 63434     zoltan             CloseHandle (thread_handle);
 36953     zoltan             return;
 36953     zoltan     }
-----8&lt;---------------

So basically the code has written at revision 36953 and a fix has been
committed as revision 63434:

------------------------------------------------------------------------
r63434 | zoltan | 2006-08-07 17:43:43 +0200 (Lun 07 ao&#251; 2006) | 5 lignes

2006-08-07  Zoltan Varga  &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">vargaz at gmail.com</A>&gt;

    * appdomain.c (mono_domain_unload): Close the thread handle of the unload
thread.
    Hopefully fixes #78949.

------------------------------------------------------------------------


This patch add curly braces so that the change 63434 does not make the core
return each time the while loop is entered, so reverse the behaviour as of
revision 36953.


With this patch, I still have random deadlocks (new investigation needed) but
the code stop crashing!

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="092540.html">[Mono-bugs] [Bug 538720] MonoDevelop fails to start, console messages complain about _wapi_shm_file_open
</A></li>
	<LI>Next message: <A HREF="092542.html">[Mono-bugs] [Bug 528830] appdomain-unload.exe unit test fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92541">[ date ]</a>
              <a href="thread.html#92541">[ thread ]</a>
              <a href="subject.html#92541">[ subject ]</a>
              <a href="author.html#92541">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
