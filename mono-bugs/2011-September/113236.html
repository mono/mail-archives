<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 672879] ReleaseInterfaces is called by GC thread.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20672879%5D%20ReleaseInterfaces%20is%20called%20by%20GC%20thread.&In-Reply-To=bug-672879-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="113235.html">
   <LINK REL="Next"  HREF="113237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 672879] ReleaseInterfaces is called by GC thread.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20672879%5D%20ReleaseInterfaces%20is%20called%20by%20GC%20thread.&In-Reply-To=bug-672879-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 672879] ReleaseInterfaces is called by GC thread.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat Sep  3 07:26:16 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="113235.html">[Mono-bugs] [Bug 348522] SIGABRT when a custom Binder doesn't convert parameters correctly
</A></li>
        <LI>Next message: <A HREF="113237.html">[Mono-bugs] [Bug 672879] ReleaseInterfaces is called by GC thread.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#113236">[ date ]</a>
              <a href="thread.html#113236">[ thread ]</a>
              <a href="subject.html#113236">[ subject ]</a>
              <a href="author.html#113236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=672879">https://bugzilla.novell.com/show_bug.cgi?id=672879</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=672879#c16">https://bugzilla.novell.com/show_bug.cgi?id=672879#c16</A>


--- Comment #16 from Robert Jordan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">robertj at gmx.net</A>&gt; 2011-09-03 11:26:13 UTC ---
Tom, another small optimization:

private void InitializeApartmentDetails ()
{
single_thread_apartment = Thread.CurrentThread.GetApartmentState() ==
ApartmentState.STA;
synchronization_context = SynchronizationContext.Current;
// Check whether the current context is a plain SynchronizationContext object
// and handle this as if no context was set at all.
if (synchronization_context != null &amp;&amp;
    synchronization_context.GetType () == typeof(SynchronizationContext))
    synchronization_context = null;
}

The idea behind is: the default SynchronizationContext is per spec a free
threaded one, but its Post() implementation is using the ThreadPool to invoke
the delegate so it doesn't block. We don't need this behavior.

This is only for the case that some consumer has set
SynchronizationContext.Current = new SynchronizationContext(). It seems that
Mono's WinForms is doing this during shutdown.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="113235.html">[Mono-bugs] [Bug 348522] SIGABRT when a custom Binder doesn't convert parameters correctly
</A></li>
	<LI>Next message: <A HREF="113237.html">[Mono-bugs] [Bug 672879] ReleaseInterfaces is called by GC thread.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#113236">[ date ]</a>
              <a href="thread.html#113236">[ thread ]</a>
              <a href="subject.html#113236">[ subject ]</a>
              <a href="author.html#113236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
