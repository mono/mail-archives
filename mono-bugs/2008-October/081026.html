<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 436407] New: C# compiler outputs invalid code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20436407%5D%20New%3A%20C%23%20compiler%20outputs%20invalid%20code&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="081024.html">
   <LINK REL="Next"  HREF="081028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 436407] New: C# compiler outputs invalid code</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20436407%5D%20New%3A%20C%23%20compiler%20outputs%20invalid%20code&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 436407] New: C# compiler outputs invalid code">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Oct 17 05:57:46 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="081024.html">[Mono-bugs] [Bug 423518] WARNING: Got event 137f for unknown pid	xxxx
</A></li>
        <LI>Next message: <A HREF="081028.html">[Mono-bugs] [Bug 436407] C# compiler outputs invalid code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81026">[ date ]</a>
              <a href="thread.html#81026">[ thread ]</a>
              <a href="subject.html#81026">[ subject ]</a>
              <a href="author.html#81026">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=436407">https://bugzilla.novell.com/show_bug.cgi?id=436407</A>


           Summary: C# compiler outputs invalid code
           Product: Mono: Compilers
           Version: 2.0
          Platform: Macintosh
        OS/Version: Mac OS X 10.5
            Status: NEW
          Severity: Blocker
          Priority: P5 - None
         Component: C#
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">oliver at sturmnet.org</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Description of Problem:

Curried format function call is compiled into IL that renders a
MissingFieldException when running.

Steps to reproduce the problem:
1. Compile this code:

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace AutomaticCurrying {
        class Program {
                static void Main(string[] args) {
                        Func&lt;int, int, int&gt; add = (x, y) =&gt; x + y;

                        var addCurriedAuto = Curry(add);
                        var add10 = addCurriedAuto(10);
                        Console.WriteLine(add10(32));

                        Func&lt;int, string, int&gt; weirdCalc =
                                (val, text) =&gt; val * text.Length;
                        var weirdCalcCurried = Curry(weirdCalc);
                        var weirdCalc3 = weirdCalcCurried(3);
                        Console.WriteLine(weirdCalc3(&quot;Hi&quot;));

                        Func&lt;int, int, int, int&gt; multiplyAndAdd =
                                (a, b, c) =&gt; a * b + c;

                        var curriedMultiplyAndAdd = Curry(multiplyAndAdd);

                        Console.WriteLine(multiplyAndAdd(10, 3, 5));
                        Console.WriteLine(curriedMultiplyAndAdd(10)(3)(5)); //
same result

                        var multiplyBy3AndAdd = curriedMultiplyAndAdd(3);
                        Console.WriteLine(multiplyBy3AndAdd(10)(5)); // same
result again
                }

                static Func&lt;T1, Func&lt;T2, T3&gt;&gt; Curry&lt;T1, T2, T3&gt;(Func&lt;T1, T2,
T3&gt; func) {
                        return par1 =&gt; par2 =&gt; func(par1, par2);
                }

                static Func&lt;T1, Func&lt;T2, Func&lt;T3, T4&gt;&gt;&gt; Curry&lt;T1, T2, T3,
T4&gt;(Func&lt;T1, T2, T3, T4&gt; func) {
                        return par1 =&gt; par2 =&gt; par3 =&gt; func(par1, par2, par3);
                }

                static Func&lt;T1, Func&lt;T2, Func&lt;T3, Func&lt;T4, T5&gt;&gt;&gt;&gt; Curry&lt;T1, T2,
T3, T4, T5&gt;(Func&lt;T1, T2, T3, T4, T5&gt; func) {
                        return par1 =&gt; par2 =&gt; par3 =&gt; par4 =&gt; func(par1, par2,
par3, par4);
                }
        }
}

2. Run the compiled assembly


Actual Results:

42
6
35

Unhandled Exception: System.MissingFieldException: Field
'.&lt;Curry&gt;c__AnonStorey4`4.&lt;&gt;f__ref$3' not found.
  at AutomaticCurrying.Program.Main (System.String[] args) [0x00000] 

Expected Results:

42
6
35
35
35


How often does this happen? 

Every time

Additional Information:

I tried running the compiled assembly on Windows (MS .NET) and it gave the same
error result. The other way round, the assembly compiled by MS .NET 3.5
compiler runs on mono just fine.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


























































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="081024.html">[Mono-bugs] [Bug 423518] WARNING: Got event 137f for unknown pid	xxxx
</A></li>
	<LI>Next message: <A HREF="081028.html">[Mono-bugs] [Bug 436407] C# compiler outputs invalid code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#81026">[ date ]</a>
              <a href="thread.html#81026">[ thread ]</a>
              <a href="subject.html#81026">[ subject ]</a>
              <a href="author.html#81026">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
