<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 436189] New: Failed to create shadow copy	(CopyFile) exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20436189%5D%20New%3A%20Failed%20to%20create%20shadow%20copy%0A%09%28CopyFile%29%20exception&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="080994.html">
   <LINK REL="Next"  HREF="080996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 436189] New: Failed to create shadow copy	(CopyFile) exception</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20436189%5D%20New%3A%20Failed%20to%20create%20shadow%20copy%0A%09%28CopyFile%29%20exception&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 436189] New: Failed to create shadow copy	(CopyFile) exception">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Oct 16 12:09:59 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="080994.html">[Mono-bugs] [Bug 423518] WARNING: Got event 137f for unknown pid	xxxx
</A></li>
        <LI>Next message: <A HREF="080996.html">[Mono-bugs] [Bug 436189] Failed to create shadow copy (CopyFile)	exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80995">[ date ]</a>
              <a href="thread.html#80995">[ thread ]</a>
              <a href="subject.html#80995">[ subject ]</a>
              <a href="author.html#80995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=436189">https://bugzilla.novell.com/show_bug.cgi?id=436189</A>


           Summary: Failed to create shadow copy (CopyFile) exception
           Product: Mono: Runtime
           Version: 2.0
          Platform: i686
        OS/Version: Windows XP
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">francis at aspl.es</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
                CC: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">francis at aspl.es</A>
          Found By: Community User


Created an attachment (id=246039)
 --&gt; (<A HREF="https://bugzilla.novell.com/attachment.cgi?id=246039">https://bugzilla.novell.com/attachment.cgi?id=246039</A>)
Changes applied to mono/metadata/appdomain.c

Hi,

We are working on a project that loads a set of assemblies from
different directories starting from a base directory. It is fully
functional on Linux (not tested yet on Mac) but on Windows we receive a
&quot;Failed to create shadow copy (CopyFile)&quot; exception just after starting
the app.

Let me describe a bit the application startup. It is a single executable
that loads assemblies found on directories starting from the base path:

c:\application\app.exe
c:\application\Common\skelwindow\skelwindow.dll
c:\application\Common\plugins\plugins.dll
..(and so on)

That is, once app.exe starts, he looks inside Common directory to load
assemblies matching the pattern NAME\NAME.dll

Tracking the problem down to mono/metadata/appdomain.c file, it seems
the function that is failing is get_shadow_assembly_location.

This is because the following call:

        dyn_base = mono_string_to_utf8 (domain-&gt;setup-&gt;dynamic_base);

.which returns NULL because domain-&gt;setup-&gt;dynamic_base is also NULL.
This causes the following g_build_filename to also return NULL, making
the caller to fail on CopyFile function (because he tries to copy our
assembly to a NULL location).

We've tried to check which value should have domain-&gt;setup-&gt;dynamic_base
and why it is NULL, but this goes beyond our knowledge about mono
internals...

At this point we're not sure if this &quot;shadow copy&quot; should happen (since
we don't reload or update those dll on-the-fly). 

PD: All tests are done with mono 2.0 sources, under windows XP
professional with all updates included. I'm also attaching differences
applied to appdomain.c and output produced by them to track the issue.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




















































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="080994.html">[Mono-bugs] [Bug 423518] WARNING: Got event 137f for unknown pid	xxxx
</A></li>
	<LI>Next message: <A HREF="080996.html">[Mono-bugs] [Bug 436189] Failed to create shadow copy (CopyFile)	exception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#80995">[ date ]</a>
              <a href="thread.html#80995">[ thread ]</a>
              <a href="subject.html#80995">[ subject ]</a>
              <a href="author.html#80995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
