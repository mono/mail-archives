<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 746721] New: AuthenticateAsServer does not send full chain of certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=Re%3A%20%5BMono-bugs%5D%20%5BBug%20746721%5D%20New%3A%20AuthenticateAsServer%20does%20not%20send%0A%20full%20chain%20of%20certificates&In-Reply-To=%3Cbug-746721-28286%40http.bugzilla.novell.com/%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="113507.html">
   <LINK REL="Next"  HREF="113506.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 746721] New: AuthenticateAsServer does not send full chain of certificates</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=Re%3A%20%5BMono-bugs%5D%20%5BBug%20746721%5D%20New%3A%20AuthenticateAsServer%20does%20not%20send%0A%20full%20chain%20of%20certificates&In-Reply-To=%3Cbug-746721-28286%40http.bugzilla.novell.com/%3E"
       TITLE="[Mono-bugs] [Bug 746721] New: AuthenticateAsServer does not send full chain of certificates">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Feb 13 14:30:45 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="113507.html">[Mono-bugs] [Bug 746449] Cannot compile templates
</A></li>
        <LI>Next message: <A HREF="113506.html">[Mono-bugs] [Bug 746721] AuthenticateAsServer does not send full chain of certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#113505">[ date ]</a>
              <a href="thread.html#113505">[ thread ]</a>
              <a href="subject.html#113505">[ subject ]</a>
              <a href="author.html#113505">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=746721">https://bugzilla.novell.com/show_bug.cgi?id=746721</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=746721#c0">https://bugzilla.novell.com/show_bug.cgi?id=746721#c0</A>


           Summary: AuthenticateAsServer does not send full chain of
                    certificates
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.10.x
          Platform: All
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System.Security
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">frego at suse.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">p.grudzien12 at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=475850)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=475850">http://bugzilla.novell.com/attachment.cgi?id=475850</A>)
Simple server with ssl authentication. Requires a valid certificate.

User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:9.0.1) Gecko/20100101
Firefox/9.0.1

When using SSLStream.AutheinticateAsServer on mono 2.10.2 and below mono sends
only certificate of server and no issuers certificates. On .net on the other
hand sends all certificates included in pcks12 file.

Reproducible: Always

Steps to Reproduce:
1. Get signed certificate
2. run attached program.cs (creates TcpListener with ssl auth)
3. run openssl s_client -showcerts -connect foo.com:3000
Actual Results:  
openssl client cannot verify certificate. Sample output of openssl s_client on
mono 2.10.2 (linux):


CONNECTED(00000003)
depth=0 /OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 /OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
verify error:num=27:certificate not trusted
verify return:1
depth=0 /OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
verify error:num=21:unable to verify the first certificate
verify return:1
---
Certificate chain
 0 s:/OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
   i:/C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA Limited/CN=PositiveSSL
CA
-----BEGIN CERTIFICATE-----
cert0
-----END CERTIFICATE-----
---
Server certificate
subject=/OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
issuer=/C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA Limited/CN=PositiveSSL
CA
---
No client certificate CA names sent
---
SSL handshake has read 1506 bytes and written 444 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA
Server public key is 2048 bit
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : AES256-SHA
    Session-ID:
    Session-ID-ctx:
    Master-Key: masterkey....
    Key-Arg   : None
    Krb5 Principal: None
    Start Time: 1329139041
    Timeout   : 300 (sec)
    Verify return code: 21 (unable to verify the first certificate)
---

Expected Results:  
Sample output on .net (windows). As one can see there is a full chain of
certificates:

CONNECTED(00000003)
depth=3 /C=SE/O=AddTrust AB/OU=AddTrust External TTP Network/CN=AddTrust
External CA Root
verify return:1
depth=2 /C=US/ST=UT/L=Salt Lake City/O=The USERTRUST
Network/OU=<A HREF="http://www.usertrust.com/CN=UTN-USERFirst-Hardware">http://www.usertrust.com/CN=UTN-USERFirst-Hardware</A>
verify return:1
depth=1 /C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA
Limited/CN=PositiveSSL CA
verify return:1
depth=0 /OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
verify return:1
---
Certificate chain
 0 s:/OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
   i:/C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA Limited/CN=PositiveSSL
CA
-----BEGIN CERTIFICATE-----
cert0
-----END CERTIFICATE-----
 1 s:/C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA Limited/CN=PositiveSSL
CA
   i:/C=US/ST=UT/L=Salt Lake City/O=The USERTRUST
Network/OU=<A HREF="http://www.usertrust.com/CN=UTN-USERFirst-Hardware">http://www.usertrust.com/CN=UTN-USERFirst-Hardware</A>
-----BEGIN CERTIFICATE-----
cert1
-----END CERTIFICATE-----
 2 s:/C=US/ST=UT/L=Salt Lake City/O=The USERTRUST
Network/OU=<A HREF="http://www.usertrust.com/CN=UTN-USERFirst-Hardware">http://www.usertrust.com/CN=UTN-USERFirst-Hardware</A>
   i:/C=SE/O=AddTrust AB/OU=AddTrust External TTP Network/CN=AddTrust External
CA Root
-----BEGIN CERTIFICATE-----
cert2
-----END CERTIFICATE-----
---
Server certificate
subject=/OU=Domain Control Validated/OU=Hosted by XYZ/OU=PositiveSSL/CN=foo.com
issuer=/C=GB/ST=Greater Manchester/L=Salford/O=Comodo CA Limited/CN=PositiveSSL
CA
---
No client certificate CA names sent
---
SSL handshake has read 3967 bytes and written 455 bytes
---
New, TLSv1/SSLv3, Cipher is RC4-MD5
Server public key is 2048 bit
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : RC4-MD5
    Session-ID: sessionID
    Session-ID-ctx:
    Master-Key: masterkey...
    Key-Arg   : None
    Krb5 Principal: None
    Start Time: 1329160144
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="113507.html">[Mono-bugs] [Bug 746449] Cannot compile templates
</A></li>
	<LI>Next message: <A HREF="113506.html">[Mono-bugs] [Bug 746721] AuthenticateAsServer does not send full chain of certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#113505">[ date ]</a>
              <a href="thread.html#113505">[ thread ]</a>
              <a href="subject.html#113505">[ subject ]</a>
              <a href="author.html#113505">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
