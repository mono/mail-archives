<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 694112] New: System.Type.GetConstructor(Type.EmptyTypes) returns variadic constructors whose only parameter is a params-argument
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20694112%5D%20New%3A%0A%20System.Type.GetConstructor%28Type.EmptyTypes%29%20returns%20variadic%20constructors%0A%20whose%20only%20parameter%20is%20a%20params-argument&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="111894.html">
   <LINK REL="Next"  HREF="111896.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 694112] New: System.Type.GetConstructor(Type.EmptyTypes) returns variadic constructors whose only parameter is a params-argument</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20694112%5D%20New%3A%0A%20System.Type.GetConstructor%28Type.EmptyTypes%29%20returns%20variadic%20constructors%0A%20whose%20only%20parameter%20is%20a%20params-argument&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 694112] New: System.Type.GetConstructor(Type.EmptyTypes) returns variadic constructors whose only parameter is a params-argument">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon May 16 15:02:09 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="111894.html">[Mono-bugs] [Bug 694096] New: ArgumentNullException when FireEvents	is true
</A></li>
        <LI>Next message: <A HREF="111896.html">[Mono-bugs] [Bug 694112] System.Type.GetConstructor(Type.EmptyTypes) returns variadic constructors whose only parameter is a params-argument
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111895">[ date ]</a>
              <a href="thread.html#111895">[ thread ]</a>
              <a href="subject.html#111895">[ subject ]</a>
              <a href="author.html#111895">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=694112">https://bugzilla.novell.com/show_bug.cgi?id=694112</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=694112#c0">https://bugzilla.novell.com/show_bug.cgi?id=694112#c0</A>


           Summary: System.Type.GetConstructor(Type.EmptyTypes) returns
                    variadic constructors whose only parameter is a
                    params-argument
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.10.x
          Platform: 64bit
        OS/Version: Windows 7
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">florianhaag at freenet.de</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.10)
Gecko/20100914 Firefox/3.6.10 ( .NET CLR 3.5.30729; .NET4.0E)

System.Type.GetConstructor(System.Type[]) can be used to retrieve a constructor
with the specified signature.

When passing an empty array as the argument, the result should be a
parameterless constructor, or null, if the considered type doesn't offer one.
This is what the .NET implementation behaves like.

The Mono implementation, however, sometimes returns constructors with
parameters: If the only parameter of the constructor is a params-argument, i.e.
if the constructor may be passed zero or more arguments, Mono's GetConstructor
implementation will return that constructor.

The problem: When you call GetConstructor for a specified number of parameters
(here: 0, possibly w.l.o.g.), you expect the returned ConstructorInfo instance
to have exactly that number of parameters, so you can call
ConstructorInfo.Invoke(Type[]) with an array of the same size. If there was
however a params-argument, Invoke(Type[]) will crash because you have supplied
one argument less than required.

Reproducible: Always

Steps to Reproduce:
Compile the attached file and invoke the resulting executable using Mono (=&gt;
&quot;Actual Results&quot;).

Invoke it using .NET to compare the results (=&gt; &quot;Expected Results&quot;).
Actual Results:  
Mono output:

Type: MainClass+TestClass1
Total number of constructors: 1
Type.EmptyTypes: 0 parameter(s)
ctor(null) =&gt; Object created. ToString() returns First Test Class.
ctor(new object[0]) =&gt; Object created. ToString() returns First Test Class.
ctor(new int[0]) =&gt; Object not created.
new Type[] { typeof(int[]) }: null
Type: MainClass+TestClass2
Total number of constructors: 1
Type.EmptyTypes: 1 parameter(s)
ctor(null) =&gt; Object not created.
ctor(new object[0]) =&gt; Object not created.
ctor(new int[0]) =&gt; Object created. ToString() returns Second Test Class.
new Type[] { typeof(int[]) }: 1 parameter(s)
ctor(null) =&gt; Object not created.
ctor(new object[0]) =&gt; Object not created.
ctor(new int[0]) =&gt; Object created. ToString() returns Second Test Class.

The 10th line illustrates the problem: I requested a parameterless constructor,
but the returned constructor actually expects one parameter. Likewise, invoking
the constructor without any parameters in line 11 and 12 fails, while passing
an (empty) array in line 13 works.

Expected Results:  
NET output:

Type: MainClass+TestClass1
Total number of constructors: 1
Type.EmptyTypes: 0 parameter(s)
ctor(null) =&gt; Object created. ToString() returns First Test Class.
ctor(new object[0]) =&gt; Object created. ToString() returns First Test Class.
ctor(new int[0]) =&gt; Object not created.
new Type[] { typeof(int[]) }: null
Type: MainClass+TestClass2
Total number of constructors: 1
Type.EmptyTypes: null
new Type[] { typeof(int[]) }: 1 parameter(s)
ctor(null) =&gt; Object not created.
ctor(new object[0]) =&gt; Object not created.
ctor(new int[0]) =&gt; Object created. ToString() returns Second Test Class.

This works as expected: Asking for a parameterless constructor only returns a
truly parameterless constructor (line 3; null is returned in line 10 because
TestClass2 doesn't have a parameterless constructor).

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="111894.html">[Mono-bugs] [Bug 694096] New: ArgumentNullException when FireEvents	is true
</A></li>
	<LI>Next message: <A HREF="111896.html">[Mono-bugs] [Bug 694112] System.Type.GetConstructor(Type.EmptyTypes) returns variadic constructors whose only parameter is a params-argument
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111895">[ date ]</a>
              <a href="thread.html#111895">[ thread ]</a>
              <a href="subject.html#111895">[ subject ]</a>
              <a href="author.html#111895">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
