<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 693810] New: Concurrent requests to ASP.NET MVC 3 web application effectively serialized
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20693810%5D%20New%3A%20Concurrent%20requests%20to%20ASP.NET%20MVC%203%0A%20web%20application%20effectively%20serialized&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="111883.html">
   <LINK REL="Next"  HREF="111851.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 693810] New: Concurrent requests to ASP.NET MVC 3 web application effectively serialized</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20693810%5D%20New%3A%20Concurrent%20requests%20to%20ASP.NET%20MVC%203%0A%20web%20application%20effectively%20serialized&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 693810] New: Concurrent requests to ASP.NET MVC 3 web application effectively serialized">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri May 13 17:44:37 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="111883.html">[Mono-bugs] [Bug 693779] Attached properties values are not set by XamlObjectWriter
</A></li>
        <LI>Next message: <A HREF="111851.html">[Mono-bugs] [Bug 693894] New: SIGSEGV in GetRawConstantValue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111850">[ date ]</a>
              <a href="thread.html#111850">[ thread ]</a>
              <a href="subject.html#111850">[ subject ]</a>
              <a href="author.html#111850">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=693810">https://bugzilla.novell.com/show_bug.cgi?id=693810</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=693810#c0">https://bugzilla.novell.com/show_bug.cgi?id=693810#c0</A>


           Summary: Concurrent requests to ASP.NET MVC 3 web application
                    effectively serialized
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.10.x
          Platform: x86-64
        OS/Version: Ubuntu
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: Sys.Web
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">phillip.sitbon+novell at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.24
(KHTML, like Gecko) Chrome/11.0.696.65 Safari/534.24

Running a request controller blocks the handling of all other controllers. This
was discovered when using JSON to report long-running job progress in a
single-process Lighttpd FastCGI configuration with one backend process. 

Updating &quot;max-procs&quot; to 2 in Lighty allowed for only one additional thread of
concurrency. I tried manually setting the following environment parameters:

                       &quot;MONO_FCGI_MAXCONNS&quot; =&gt; &quot;2048&quot;,
                        &quot;MONO_FCGI_MAXREQS&quot; =&gt; &quot;2048&quot;,
                        &quot;MONO_FCGI_MULTIPLEX&quot; =&gt; &quot;True&quot;

As well as the following in Web.config:

    &lt;connectionManagement&gt;
      &lt;add address=&quot;*&quot; maxconnection=&quot;256&quot;/&gt;
    &lt;/connectionManagement&gt;

To no avail.

Reducing the scenario down to a simple web app running in XSP produces the same
behavior.

Server info:
 2.6.38-9-server #43-Ubuntu SMP Thu Apr 28 15:40:34 UTC 2011 x86_64 x86_64
x86_64 GNU/Linux

Running Mono 2.10.2

Reproducible: Always

Steps to Reproduce:
1. Create a new ASP.NET MVC 3 (Razor) Web App in VS2010.

2. Make two controllers, with any attached view. In one, put

Thread.Sleep(20000)

And in the other just have it render the view immediately.

3. Before publishing the project for export to Linux, set &quot;Copy Local&quot; on the
following references (not sure if all are needed/used, but it allows it to
load):
  EntityFramework
  System.Data.Entity
  System.Web.Helpers
  System.Web.Mvc
  System.Web.Razor
  System.Web.WebPages
  System.Web.WebPages.Deployment
  System.Web.WebPages.Razor

4. Publish to a folder and then copy to a Linux machine. Run xsp4 --root
/path/to/App

5. Navigate to <A HREF="http://server:port/ViewThatSleeps">http://server:port/ViewThatSleeps</A>

6. Immediately try to load up <A HREF="http://server:port/ViewThatDoesNotSleep">http://server:port/ViewThatDoesNotSleep</A> while the
other controller is still executing Thread.Sleep.



3.
Actual Results:  
<A HREF="http://server:port/ViewThatDoesNotSleep">http://server:port/ViewThatDoesNotSleep</A> will not load until
<A HREF="http://server:port/ViewThatSleeps">http://server:port/ViewThatSleeps</A> has completed and loaded.

Expected Results:  
<A HREF="http://server:port/ViewThatDoesNotSleep">http://server:port/ViewThatDoesNotSleep</A> loads while
<A HREF="http://server:port/ViewThatSleep">http://server:port/ViewThatSleep</A> is still loading and executing Thread.Sleep.

Reproduced in Windows 7, VS2010 SP1, ASP.NET Dev Server for multiple web app
scenarios.

Most of the Web.config, besides the changes I mentioned above, are defaults
generated by VS2010.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="111883.html">[Mono-bugs] [Bug 693779] Attached properties values are not set by XamlObjectWriter
</A></li>
	<LI>Next message: <A HREF="111851.html">[Mono-bugs] [Bug 693894] New: SIGSEGV in GetRawConstantValue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111850">[ date ]</a>
              <a href="thread.html#111850">[ thread ]</a>
              <a href="subject.html#111850">[ subject ]</a>
              <a href="author.html#111850">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
