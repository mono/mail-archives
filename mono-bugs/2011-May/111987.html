<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 696817] New: Reflection Emit does not pin RVA data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20696817%5D%20New%3A%20Reflection%20Emit%20does%20not%20pin%20RVA%20data&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="111986.html">
   <LINK REL="Next"  HREF="111995.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 696817] New: Reflection Emit does not pin RVA data</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20696817%5D%20New%3A%20Reflection%20Emit%20does%20not%20pin%20RVA%20data&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 696817] New: Reflection Emit does not pin RVA data">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun May 29 03:38:12 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="111986.html">[Mono-bugs] [Bug 696815] New: mscorlib.dll System.NullReferenceException: Object reference not set to an instance of an object
</A></li>
        <LI>Next message: <A HREF="111995.html">[Mono-bugs] [Bug 696817] Reflection Emit does not pin RVA data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111987">[ date ]</a>
              <a href="thread.html#111987">[ thread ]</a>
              <a href="subject.html#111987">[ subject ]</a>
              <a href="author.html#111987">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=696817">https://bugzilla.novell.com/show_bug.cgi?id=696817</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=696817#c0">https://bugzilla.novell.com/show_bug.cgi?id=696817#c0</A>


           Summary: Reflection Emit does not pin RVA data
    Classification: Mono
           Product: Mono: Runtime
           Version: SVN
          Platform: x86
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">stefanor at cox.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=432002)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=432002">http://bugzilla.novell.com/attachment.cgi?id=432002</A>)
Code to demonstrate the problem

Description of Problem:

When a dynamic assembly is created, any fields defined using
DefineInitializedData have their data stored as a byte[] object.  Additionally,
once CreateType is called, typebuilder_setup_fields saves a pointer to the data
as a const char * in a MonoFieldDefaultValue struct.  However, the garbage
collector does not know about this reference, and when SGen is used the pointer
can become stale if the garbage collector decides to move the byte[].

(Note that the pointer can also be copied into JITted code, when
InitializeArray is optimized to memcpy.)

Steps to reproduce the problem:

See attached code.

Actual Results:

0

Expected Results:

42

How often does this happen? 

Depends on GC run timing, and whether the GC decides to move the array.

Additional Information:

Observed on 16fc336.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="111986.html">[Mono-bugs] [Bug 696815] New: mscorlib.dll System.NullReferenceException: Object reference not set to an instance of an object
</A></li>
	<LI>Next message: <A HREF="111995.html">[Mono-bugs] [Bug 696817] Reflection Emit does not pin RVA data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111987">[ date ]</a>
              <a href="thread.html#111987">[ thread ]</a>
              <a href="subject.html#111987">[ subject ]</a>
              <a href="author.html#111987">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
