<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 691807] New: HttpResponse closes Filter stream after first 64K of output when using custom VirtualPathProvider
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20691807%5D%20New%3A%20HttpResponse%20closes%20Filter%20stream%0A%20after%20first%2064K%20of%20output%20when%20using%20custom%20VirtualPathProvider&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="111708.html">
   <LINK REL="Next"  HREF="111712.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 691807] New: HttpResponse closes Filter stream after first 64K of output when using custom VirtualPathProvider</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20691807%5D%20New%3A%20HttpResponse%20closes%20Filter%20stream%0A%20after%20first%2064K%20of%20output%20when%20using%20custom%20VirtualPathProvider&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 691807] New: HttpResponse closes Filter stream after first 64K of output when using custom VirtualPathProvider">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed May  4 17:25:47 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="111708.html">[Mono-bugs] [Bug 656833] OdbcParameter.Bind() can pass a NULL pointer to SQLBindParameter
</A></li>
        <LI>Next message: <A HREF="111712.html">[Mono-bugs] [Bug 691807] HttpResponse closes Filter stream after first 64K of output when using custom VirtualPathProvider
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111711">[ date ]</a>
              <a href="thread.html#111711">[ thread ]</a>
              <a href="subject.html#111711">[ subject ]</a>
              <a href="author.html#111711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=691807">https://bugzilla.novell.com/show_bug.cgi?id=691807</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=691807#c0">https://bugzilla.novell.com/show_bug.cgi?id=691807#c0</A>


           Summary: HttpResponse closes Filter stream after first 64K of
                    output when using custom VirtualPathProvider
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.10.x
          Platform: x86-64
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.Web
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Kalyanov.Dmitry at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=428038)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=428038">http://bugzilla.novell.com/attachment.cgi?id=428038</A>)
Project that demonstrates the issue

User-Agent:       Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.24 (KHTML,
like Gecko) Chrome/11.0.696.50 Safari/534.24

I've been trying to implement proper HTTP caching and compression for a project
that uses VirtualPathProvider to provide content. In Application_BeginRequest I
install Filter to HttpResponse (this filter is used to calculate ETags and
compress data), but this filter is getting only first 64Kb of data (the rest of
data comes straight into output past my filter).

I've made a small project that reproduces this problem and a patch that fixes
this issue for me (though I'm not sure whether it's OK in all cases).

Reproducible: Always

Steps to Reproduce:

1. Open the attached project in monodevelop
2. Run the project
3. Run in terminal:
curl <A HREF="http://localhost:8080/asd.txt">http://localhost:8080/asd.txt</A> 2&gt;/dev/null | gunzip | wc -c
Actual Results:  
The following is printed to stdio:

gzip: stdin: decompression OK, trailing garbage ignored
65535

Expected Results:  
The following is printed to stdio:

26749685

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="111708.html">[Mono-bugs] [Bug 656833] OdbcParameter.Bind() can pass a NULL pointer to SQLBindParameter
</A></li>
	<LI>Next message: <A HREF="111712.html">[Mono-bugs] [Bug 691807] HttpResponse closes Filter stream after first 64K of output when using custom VirtualPathProvider
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111711">[ date ]</a>
              <a href="thread.html#111711">[ thread ]</a>
              <a href="subject.html#111711">[ subject ]</a>
              <a href="author.html#111711">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
