<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 552891] Mono can't deserialize Nullable objects created by .NET (BinaryFormatter)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20552891%5D%20Mono%20can%27t%20deserialize%20Nullable%20objects%0A%20created%20by%20.NET%20%28BinaryFormatter%29&In-Reply-To=bug-552891-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="094757.html">
   <LINK REL="Next"  HREF="094824.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 552891] Mono can't deserialize Nullable objects created by .NET (BinaryFormatter)</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20552891%5D%20Mono%20can%27t%20deserialize%20Nullable%20objects%0A%20created%20by%20.NET%20%28BinaryFormatter%29&In-Reply-To=bug-552891-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 552891] Mono can't deserialize Nullable objects created by .NET (BinaryFormatter)">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Nov  9 18:07:36 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="094757.html">[Mono-bugs] [Bug 552891] Mono can't deserialize Nullable objects created by .NET (BinaryFormatter)
</A></li>
        <LI>Next message: <A HREF="094824.html">[Mono-bugs] [Bug 552891] Mono can't deserialize Nullable objects created by .NET (BinaryFormatter)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#94821">[ date ]</a>
              <a href="thread.html#94821">[ thread ]</a>
              <a href="subject.html#94821">[ subject ]</a>
              <a href="author.html#94821">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=552891">http://bugzilla.novell.com/show_bug.cgi?id=552891</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jorge.matias at fractaliasoftware.com</A> added comment
<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=552891#c3">http://bugzilla.novell.com/show_bug.cgi?id=552891#c3</A>





--- Comment #3 from Jorge Matias &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jorge.matias at fractaliasoftware.com</A>&gt;  2009-11-09 16:07:35 MST ---
Created an attachment (id=326371)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=326371">http://bugzilla.novell.com/attachment.cgi?id=326371</A>)
Quick &amp; dirty fix that deserializes MS .NET Nullable objects

The following patch is able to deserialize Nullable objects created by MS .NET,
but should be considered a _hack_ since I'm far of being an expert on the
matter.

It seems MS .NET runtime does some tricky things (sort of optimization?) with
Nullable objects when they are not null, which doesn't allow Mono to
deserialize them.

For example, if a Nullable&lt;int&gt; is set to null, the serialized binary contains
the following string:

System.Nullable`1[[System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral,
PublicKeyToken=b77a5c561934e089]]

But if it's not null, the serialized binary contains just the System.Int32,
with the only difference that is detected by the Mono BinaryFormatter as a
RuntimeType instead a PrimitiveType. This _may_ be related with autoboxing;
after the change ReadValue detects the element as a BoxedPrimitiveTypeValue and
procedes to deserialize the object correctly.

HTH.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="094757.html">[Mono-bugs] [Bug 552891] Mono can't deserialize Nullable objects created by .NET (BinaryFormatter)
</A></li>
	<LI>Next message: <A HREF="094824.html">[Mono-bugs] [Bug 552891] Mono can't deserialize Nullable objects created by .NET (BinaryFormatter)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#94821">[ date ]</a>
              <a href="thread.html#94821">[ thread ]</a>
              <a href="subject.html#94821">[ subject ]</a>
              <a href="author.html#94821">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
