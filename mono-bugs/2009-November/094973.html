<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 555464] New: reflection.c:2609:get_field_on_inst_generic_type: assertion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20555464%5D%20New%3A%0A%20reflection.c%3A2609%3Aget_field_on_inst_generic_type%3A%20assertion&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="094972.html">
   <LINK REL="Next"  HREF="094974.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 555464] New: reflection.c:2609:get_field_on_inst_generic_type: assertion</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20555464%5D%20New%3A%0A%20reflection.c%3A2609%3Aget_field_on_inst_generic_type%3A%20assertion&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 555464] New: reflection.c:2609:get_field_on_inst_generic_type: assertion">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Nov 13 16:13:34 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="094972.html">[Mono-bugs] [Bug 555459] Option to build source RPM
</A></li>
        <LI>Next message: <A HREF="094974.html">[Mono-bugs] [Bug 555464] reflection.c:2609:get_field_on_inst_generic_type: assertion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#94973">[ date ]</a>
              <a href="thread.html#94973">[ thread ]</a>
              <a href="subject.html#94973">[ subject ]</a>
              <a href="author.html#94973">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=555464">http://bugzilla.novell.com/show_bug.cgi?id=555464</A>


           Summary: reflection.c:2609:get_field_on_inst_generic_type:
                    assertion
    Classification: Mono
           Product: Mono: Runtime
           Version: SVN
          Platform: x86-64
        OS/Version: Linux
            Status: NEW
          Keywords: blocking
          Severity: Major
          Priority: P5 - None
         Component: generics
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">basile at starynkevitch.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Community User


Description of Problem:
ERROR:reflection.c:2609:get_field_on_inst_generic_type: assertion
failed: (field_index &gt;= 0 &amp;&amp; field_index &lt; dgclass-&gt;count_fields)

0. System is Debian/Sid/AMD64. gcc compiler is 
Using built-in specs.
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Debian 4.3.4-6'
--with-bugurl=<A HREF="file:///usr/share/doc/gcc-4.3/README.Bugs">file:///usr/share/doc/gcc-4.3/README.Bugs</A>
--enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --enable-shared
--enable-multiarch --enable-linker-build-id --with-system-zlib
--libexecdir=/usr/lib --without-included-gettext --enable-threads=posix
--enable-nls --with-gxx-include-dir=/usr/include/c++/4.3 --program-suffix=-4.3
--enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc --enable-mpfr
--with-tune=generic --enable-checking=release --build=x86_64-linux-gnu
--host=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 4.3.4 (Debian 4.3.4-6) 



Steps to reproduce the problem:
1. Retrieve MONO trunk from svn rev 146160 
svn info * gives

  Path: libgdiplus
URL: <A HREF="http://anonsvn.mono-project.com/source/trunk/libgdiplus">http://anonsvn.mono-project.com/source/trunk/libgdiplus</A>
Repository Root: <A HREF="http://anonsvn.mono-project.com/source">http://anonsvn.mono-project.com/source</A>
Repository UUID: e3ebcda4-bce8-0310-ba0a-eca2169e7518
Revision: 146117
Node Kind: directory
Schedule: normal
Last Changed Author: fejj
Last Changed Rev: 140293
Last Changed Date: 2009-08-19 23:37:28 +0200 (Wed, 19 Aug 2009)

Path: mcs
URL: <A HREF="http://anonsvn.mono-project.com/source/trunk/mcs">http://anonsvn.mono-project.com/source/trunk/mcs</A>
Repository Root: <A HREF="http://anonsvn.mono-project.com/source">http://anonsvn.mono-project.com/source</A>
Repository UUID: e3ebcda4-bce8-0310-ba0a-eca2169e7518
Revision: 146160
Node Kind: directory
Schedule: normal
Last Changed Author: marek
Last Changed Rev: 146159
Last Changed Date: 2009-11-13 17:24:06 +0100 (Fri, 13 Nov 2009)

Path: mono
URL: <A HREF="http://anonsvn.mono-project.com/source/trunk/mono">http://anonsvn.mono-project.com/source/trunk/mono</A>
Repository Root: <A HREF="http://anonsvn.mono-project.com/source">http://anonsvn.mono-project.com/source</A>
Repository UUID: e3ebcda4-bce8-0310-ba0a-eca2169e7518
Revision: 146160
Node Kind: directory
Schedule: normal
Last Changed Author: zoltan
Last Changed Rev: 146109
Last Changed Date: 2009-11-13 07:36:08 +0100 (Fri, 13 Nov 2009)


### the build of mono goes well, giving
% /usr/local/bin/mono -V
Mono JIT compiler version 2.7 (/trunk/mono r146116 Fri Nov 13 12:02:21 MET
2009)
Copyright (C) 2002-2009 Novell, Inc and Contributors. www.mono-project.com
    TLS:           __thread
    GC:            Included Boehm (with typed GC and Parallel Mark)
    SIGSEGV:       altstack
    Notifications: epoll
    Architecture:  amd64
    Disabled:      none

Retrieve nemerle trunk svn revision 8434
svn info nemerle gives
% svn info nemerle/ 
Path: nemerle
URL: <A HREF="http://nemerle.googlecode.com/svn/nemerle/trunk">http://nemerle.googlecode.com/svn/nemerle/trunk</A>
Repository Root: <A HREF="http://nemerle.googlecode.com/svn">http://nemerle.googlecode.com/svn</A>
Repository UUID: c8a6711f-211a-0410-a8d5-2f220496d6d1
Revision: 8434
Node Kind: directory
Schedule: normal
Last Changed Author: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">vc at rsdn.ru</A>
Last Changed Rev: 8434
Last Changed Date: 2009-11-11 21:09:20 +0100 (Wed, 11 Nov 2009)


Configure nemerle with

bash ./configure --mono-from=/usr/local/bin/  --enable-time 

Then build nemerle with
  make

2
Actual Results:

The build fails with

ERROR:reflection.c:2609:get_field_on_inst_generic_type: assertion
failed: (field_index &gt;= 0 &amp;&amp; field_index &lt; dgclass-&gt;count_fields)
Stacktrace:

  at (wrapper managed-to-native) System.MonoType.GetField
(System.MonoType*,string,System.Reflection.BindingFlags) &lt;0x00051&gt;
  at (wrapper managed-to-native) System.MonoType.GetField
(System.MonoType*,string,System.Reflection.BindingFlags) &lt;0x00051&gt;
  at System.MonoType.GetField (System.Reflection.FieldInfo) &lt;0x00088&gt;
  at System.Reflection.Emit.TypeBuilder.GetField
(System.Type,System.Reflection.FieldInfo) &lt;0x0001b&gt;
  at Nemerle.Compiler.ILEmitter.FrameworkGetField
(System.Type,System.Reflection.FieldInfo) &lt;0x000e7&gt;
  at Nemerle.Compiler.ILEmitter.GetFieldInfo
(System.Type,Nemerle.Compiler.IField) &lt;0x00047&gt;
  at Nemerle.Compiler.ILEmitter.emit
(Nemerle.Compiler.Typedtree.TExpr) &lt;0x05b7b&gt;
  at Nemerle.Compiler.ILEmitter.emit
(Nemerle.Compiler.Typedtree.TExpr) &lt;0x044d7&gt;
  at Nemerle.Compiler.ILEmitter.emit
(Nemerle.Compiler.Typedtree.TExpr) &lt;0x01c27&gt;
  at Nemerle.Compiler.ILEmitter.emit
(Nemerle.Compiler.Typedtree.TExpr) &lt;0x01e2b&gt;
  at Nemerle.Compiler.ILEmitter.emit
(Nemerle.Compiler.Typedtree.TExpr) &lt;0x01e2b&gt;
  at Nemerle.Compiler.ILEmitter.emit
(Nemerle.Compiler.Typedtree.TExpr) &lt;0x03a47&gt;
  at Nemerle.Compiler.ILEmitter.Run () &lt;0x00127&gt;
  at Nemerle.Compiler.MethodBuilder/
_N__N_lambda__59337__59458.apply_void () &lt;0x000c7&gt;
  at Nemerle.Compiler.TypeBuilder.FinalizeType () &lt;0x000cd&gt;
  at Nemerle.Compiler.TypeBuilder.EmitImplementation () &lt;0x001f3&gt;
  at Nemerle.Compiler.TypesManager/_N_emit_impl__52700.apply_void
(Nemerle.Compiler.TypeBuilder) &lt;0x0005b&gt;
  at Nemerle.Compiler.TypesManager/_N_maybe_f__53272.apply_void
(Nemerle.Compiler.TypeBuilder) &lt;0x00196&gt;
  at Nemerle.Collections.NList.Iter&lt;object&gt;
(Nemerle.Core.list`1&lt;object&gt;,Nemerle.Builtins.FunctionVoid`1&lt;object&gt;)
&lt;0x000bf&gt;
  at Nemerle.Core.list`1&lt;object&gt;.Iter
(Nemerle.Builtins.FunctionVoid`1&lt;object&gt;) &lt;0x00033&gt;
  at Nemerle.Compiler.TypesManager.Iter
(Nemerle.Core.list`1&lt;Nemerle.Compiler.TypeBuilder&gt;,Nemerle.Builtins.FunctionVoid`1&lt;Nemerle.Compiler.TypeBuilder&gt;)
&lt;0x0008f&gt;
  at Nemerle.Compiler.TypesManager.Iter
(Nemerle.Builtins.FunctionVoid`1&lt;Nemerle.Compiler.TypeBuilder&gt;)
&lt;0x0002f&gt;
  at Nemerle.Compiler.TypesManager.compile_all_tyinfos (bool)
&lt;0x0018f&gt;
  at Nemerle.Compiler.TypesManager/
_N__N_lambda__52140__52243.apply_void () &lt;0x00034&gt;
  at Nemerle.Compiler.Solver.Enqueue (Nemerle.Builtins.FunctionVoid)
&lt;0x0004c&gt;
  at Nemerle.Compiler.TypesManager.EmitDecls () &lt;0x0005b&gt;
  at Nemerle.Compiler.ManagerClass.Run () &lt;0x0056f&gt;
  at Nemerle.CommandlineCompiler.MainClass.main_with_catching ()
&lt;0x00153&gt;
  at Nemerle.CommandlineCompiler.MainClass.Main () &lt;0x001ef&gt;
  at (wrapper runtime-invoke) object.runtime_invoke_void
(object,intptr,intptr,intptr) &lt;0x00049&gt;

Native stacktrace:

        /usr/local/bin///mono [0x4883c6]
        /lib/libpthread.so.0 [0x2b9de1a9b990]
        /lib/libc.so.6(gsignal+0x35) [0x2b9de1f5df25]
        /lib/libc.so.6(abort+0x180) [0x2b9de1f60d60]
        /lib/libglib-2.0.so.0(g_assertion_message+0x100) [0x2b9de141bad0]
        /lib/libglib-2.0.so.0 [0x2b9de141c052]
        /usr/local/bin///mono [0x56dbac]
        /usr/local/bin///mono(mono_field_get_object+0x165) [0x57ba05]
        /usr/local/bin///mono [0x4e3f74]
        [0x41f295b1]

Debug info from gdb:

Mono support loaded.
[Thread debugging using libthread_db enabled]
[New Thread 0x2aaaac222910 (LWP 11356)]
[New Thread 0x2aaaabfc1910 (LWP 11355)]
[New Thread 0x2aaaab0ae910 (LWP 11354)]
[New Thread 0x2aaaaaead910 (LWP 11353)]
[New Thread 0x2aaaaacac910 (LWP 11352)]
0x00002b9de1a9a90b in read () from /lib/libpthread.so.0
  6 Thread 0x2aaaaacac910 (LWP 11352)  0x00002b9de1a97f89 in
pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0
  5 Thread 0x2aaaaaead910 (LWP 11353)  0x00002b9de1a97f89 in
pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0
  4 Thread 0x2aaaab0ae910 (LWP 11354)  0x00002b9de1a97f89 in
pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0
  3 Thread 0x2aaaabfc1910 (LWP 11355)  0x00002b9de1a9b131 in nanosleep
()
   from /lib/libpthread.so.0
  2 Thread 0x2aaaac222910 (LWP 11356)  0x00002b9de1a99c61 in sem_wait
()
   from /lib/libpthread.so.0
* 1 Thread 0x2b9de24af0b0 (LWP 11351)  0x00002b9de1a9a90b in read ()
   from /lib/libpthread.so.0

Thread 6 (Thread 0x2aaaaacac910 (LWP 11352)):
#0  0x00002b9de1a97f89 in pthread_cond_wait@@GLIBC_2.3.2 ()
   from /lib/libpthread.so.0
#1  0x00000000005b4203 in GC_wait_marker () at pthread_support.c:1785
#2  0x00000000005b5f84 in GC_help_marker (my_mark_no=57) at mark.c:
1116
#3  0x00000000005b2f50 in GC_mark_thread (id=0x0) at pthread_support.c:
548
#4  0x00002b9de1a9373a in start_thread () from /lib/libpthread.so.0
#5  0x00002b9de1ff72fd in clone () from /lib/libc.so.6
#6  0x0000000000000000 in ?? ()

Thread 5 (Thread 0x2aaaaaead910 (LWP 11353)):
#0  0x00002b9de1a97f89 in pthread_cond_wait@@GLIBC_2.3.2 ()
   from /lib/libpthread.so.0
#1  0x00000000005b4203 in GC_wait_marker () at pthread_support.c:1785
#2  0x00000000005b5f84 in GC_help_marker (my_mark_no=57) at mark.c:
1116
#3  0x00000000005b2f50 in GC_mark_thread (id=0x1) at pthread_support.c:
548
#4  0x00002b9de1a9373a in start_thread () from /lib/libpthread.so.0
#5  0x00002b9de1ff72fd in clone () from /lib/libc.so.6
#6  0x0000000000000000 in ?? ()

Thread 4 (Thread 0x2aaaab0ae910 (LWP 11354)):
#0  0x00002b9de1a97f89 in pthread_cond_wait@@GLIBC_2.3.2 ()
   from /lib/libpthread.so.0
#1  0x00000000005b4203 in GC_wait_marker () at pthread_support.c:1785
#2  0x00000000005b5f84 in GC_help_marker (my_mark_no=57) at mark.c:
1116
#3  0x00000000005b2f50 in GC_mark_thread (id=0x2) at pthread_support.c:
548
#4  0x00002b9de1a9373a in start_thread () from /lib/libpthread.so.0
#5  0x00002b9de1ff72fd in clone () from /lib/libc.so.6
#6  0x0000000000000000 in ?? ()

Thread 3 (Thread 0x2aaaabfc1910 (LWP 11355)):
#0  0x00002b9de1a9b131 in nanosleep () from /lib/libpthread.so.0
#1  0x00000000005a6b02 in collection_thread (unused=&lt;value optimized
out&gt;)
    at collection.c:34
#2  0x00002b9de1a9373a in start_thread () from /lib/libpthread.so.0
#3  0x00002b9de1ff72fd in clone () from /lib/libc.so.6
#4  0x0000000000000000 in ?? ()

Thread 2 (Thread 0x2aaaac222910 (LWP 11356)):
#0  0x00002b9de1a99c61 in sem_wait () from /lib/libpthread.so.0
#1  0x000000000056cb00 in finalizer_thread (unused=&lt;value optimized
out&gt;)
    at gc.c:1022
#2  0x00000000004ee095 in start_wrapper (data=&lt;value optimized out&gt;)
    at threads.c:721
#3  0x00000000005a1093 in thread_start_routine (args=0x255f970)
    at wthreads.c:286
#4  0x00000000005b3e96 in GC_start_routine (arg=0x2aaaab0d4e70)
    at pthread_support.c:1390
#5  0x00002b9de1a9373a in start_thread () from /lib/libpthread.so.0
#6  0x00002b9de1ff72fd in clone () from /lib/libc.so.6
#7  0x0000000000000000 in ?? ()

Thread 1 (Thread 0x2b9de24af0b0 (LWP 11351)):
#0  0x00002b9de1a9a90b in read () from /lib/libpthread.so.0
#1  0x000000000048852b in mono_handle_native_sigsegv (
    signal=&lt;value optimized out&gt;, ctx=&lt;value optimized out&gt;)
    at mini-exceptions.c:1808
#2  &lt;signal handler called&gt;
#3  0x00002b9de1f5df25 in raise () from /lib/libc.so.6
#4  0x00002b9de1f60d60 in abort () from /lib/libc.so.6
#5  0x00002b9de141bad0 in IA__g_assertion_message
(domain=0x2b9de145951e &quot;&quot;,
    file=0x5d79f8 &quot;reflection.c&quot;, line=&lt;value optimized out&gt;, func=
    0x676470 &quot;get_field_on_inst_generic_type&quot;, message=&lt;value
optimized out&gt;)
    at /tmp/buildd/glib2.0-2.22.2/glib/gtestutils.c:1302
#6  0x00002b9de141c052 in IA__g_assertion_message_expr (domain=0x0,
file=
    0x5d79f8 &quot;reflection.c&quot;, line=2609, func=
    0x676470 &quot;get_field_on_inst_generic_type&quot;, expr=&lt;value optimized
out&gt;)
    at /tmp/buildd/glib2.0-2.22.2/glib/gtestutils.c:1313
#7  0x000000000056dbac in get_field_on_inst_generic_type (
    field=&lt;value optimized out&gt;) at reflection.c:2609
#8  0x000000000057ba05 in mono_field_get_object
(domain=0x2aaaab0d3db0, klass=
    &quot;Nil&quot;, field=0x3452928) at reflection.c:6444
#9  0x00000000004e3f74 in ves_icall_Type_GetField (type=&lt;value
optimized out&gt;,
    name=0x2aaaad6f1380, bflags=24) at icall.c:3303
#10 0x0000000041f295b1 in ?? ()
#11 0x0000000002521e60 in ?? ()
#12 0x00002aaaae7ad220 in ?? ()
#13 0x00007fffa67586d0 in ?? ()
#14 0x0000000000000000 in ?? ()

=================================================================
Got a SIGABRT while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries
used by your application.
=================================================================

Command terminated by signal 6
80.45user 0.86system 1:00.68elapsed 133%CPU (0avgtext+0avgdata
0maxresident)k
0inputs+0outputs (0major+30556minor)pagefaults 0swaps
make[3]: *** [out.stage1/Nemerle.stage1.dll] Error 134 



Expected Results:
The build of something using MONO should not crash MONO's runtime

How often does this happen? 
Systematic &amp; repeatable failure


Additional Information:


See <A HREF="http://groups.google.com/group/nemerle-en/msg/0578a379273127ac">http://groups.google.com/group/nemerle-en/msg/0578a379273127ac</A> for all
details and motivations


Regards

-- 
Basile STARYNKEVITCH         <A HREF="http://starynkevitch.net/Basile/">http://starynkevitch.net/Basile/</A>
email: basile&lt;at&gt;starynkevitch&lt;dot&gt;net mobile: +33 6 8501 2359
8, rue de la Faiencerie, 92340 Bourg La Reine, France
*** opinions {are only mines, sont seulement les miennes} ***

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="094972.html">[Mono-bugs] [Bug 555459] Option to build source RPM
</A></li>
	<LI>Next message: <A HREF="094974.html">[Mono-bugs] [Bug 555464] reflection.c:2609:get_field_on_inst_generic_type: assertion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#94973">[ date ]</a>
              <a href="thread.html#94973">[ thread ]</a>
              <a href="subject.html#94973">[ subject ]</a>
              <a href="author.html#94973">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
