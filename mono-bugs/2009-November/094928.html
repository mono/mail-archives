<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 555004] New: Crash after AppDomain loads dll with missing dependency
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20555004%5D%20New%3A%20Crash%20after%20AppDomain%20loads%20dll%20with%0A%20missing%20dependency&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="094927.html">
   <LINK REL="Next"  HREF="094930.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 555004] New: Crash after AppDomain loads dll with missing dependency</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20555004%5D%20New%3A%20Crash%20after%20AppDomain%20loads%20dll%20with%0A%20missing%20dependency&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 555004] New: Crash after AppDomain loads dll with missing dependency">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Nov 12 13:50:49 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="094927.html">[Mono-bugs] [Bug 554985] ClientCredentials missing from System.ServiceModel.Description
</A></li>
        <LI>Next message: <A HREF="094930.html">[Mono-bugs] [Bug 555004] Crash after AppDomain loads dll with	missing dependency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#94928">[ date ]</a>
              <a href="thread.html#94928">[ thread ]</a>
              <a href="subject.html#94928">[ subject ]</a>
              <a href="author.html#94928">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=555004">http://bugzilla.novell.com/show_bug.cgi?id=555004</A>


           Summary: Crash after AppDomain loads dll with missing
                    dependency
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.4.x
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">tedu at fogcreek.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=327215)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=327215">http://bugzilla.novell.com/attachment.cgi?id=327215</A>)
test case

User-Agent:       Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1.12)
Gecko/20080207 Ubuntu/7.10 (gutsy) Firefox/2.0.0.12

We have a web app that loads some assemblies into AppDomains.  If the loaded
dll is missing a dependency, we catch the exception, but afterwards mono
appears &quot;broken.&quot;  We have observed two behaviors, one is an infinite
loop/hang, the other is a segfault.  The interesting thing is that the running
response finishes correctly, and it's not until it's done that mono is broken.

I have attached a zip that contains some files to repro the problem.  Run
build.sh to build the files.

Work.exe is the main program.  It's both an ASP.NET app and standalone exe.  It
loads Worker.dll to do some work (calculate 5).  Worker.dll depends on both
Work.exe (for the IWork interface) and FiveMaker.dll (to get 5).

[I have set the AppDomain path to /tmp in the source, this may not be the best,
but is orthogonal to the issue.  After building, copy the files to /tmp. 
web.config also provided.]

When all the pieces are in place, you get a very basic web page that says &quot;2 +
2 = 5&quot;.  The problem occurs when FiveMaker.dll is deleted.  The web page runs
once and prints out the expected unable to load error.  After that, mono is
broken.  The next request doesn't work.

Doesn't happen when running the exe from the command line, just the web page.  

For our real app, instead of a crash, we observe an infinite loop after the
request finishes.  We've run mod-mono-server2 with tracing on and can see it
finish the request, then nothing.  mono spins on CPU.

Reproducible: Always

Steps to Reproduce:
1.  Build attached files.  Copy to /tmp/.  Visit website.
2.  Delete /tmp/FiveMaker.dll
3.  Observe mono stop working.
Actual Results:  
Got a SIGSEGV while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries 
used by your application.


Expected Results:  
Just print out the exception like all the other exceptions.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="094927.html">[Mono-bugs] [Bug 554985] ClientCredentials missing from System.ServiceModel.Description
</A></li>
	<LI>Next message: <A HREF="094930.html">[Mono-bugs] [Bug 555004] Crash after AppDomain loads dll with	missing dependency
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#94928">[ date ]</a>
              <a href="thread.html#94928">[ thread ]</a>
              <a href="subject.html#94928">[ subject ]</a>
              <a href="author.html#94928">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
