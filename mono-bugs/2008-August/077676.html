<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 414963] New: [REGRESSION] ListBox: SelectedIndexChanged event are duplicated
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20414963%5D%20New%3A%20%5BREGRESSION%5D%20ListBox%3A%0A%20SelectedIndexChanged%20event%20are%20duplicated&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="077680.html">
   <LINK REL="Next"  HREF="077677.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 414963] New: [REGRESSION] ListBox: SelectedIndexChanged event are duplicated</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20414963%5D%20New%3A%20%5BREGRESSION%5D%20ListBox%3A%0A%20SelectedIndexChanged%20event%20are%20duplicated&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 414963] New: [REGRESSION] ListBox: SelectedIndexChanged event are duplicated">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Aug  6 04:59:02 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="077680.html">[Mono-bugs] [Bug 414961] missing linq Expression ctors [blocks	IronPython]
</A></li>
        <LI>Next message: <A HREF="077677.html">[Mono-bugs] [Bug 414963] [REGRESSION] ListBox: SelectedIndexChanged event are duplicated
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77676">[ date ]</a>
              <a href="thread.html#77676">[ thread ]</a>
              <a href="subject.html#77676">[ subject ]</a>
              <a href="author.html#77676">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=414963">https://bugzilla.novell.com/show_bug.cgi?id=414963</A>


           Summary: [REGRESSION] ListBox: SelectedIndexChanged event are
                    duplicated
           Product: Mono: Class Libraries
           Version: SVN
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Windows.Forms
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">andyhume32 at yahoo.co.uk</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


As first noticed in bug 398341, events from ListBox on selected item change are
duplicated.  Looking back at 1.9 I don't see this fault, so 'regression'.

Repro, app ListBoxHarness.cs attached -- includes new buttons to do
programmatic access to the SelectedIndices collection.


* 'One' selection mode.
1. Select 'One' selection mode (MultiColumn mode on and off seems unimportant).
2. Click on ListBox items a, b, and c in turn each should be selected in turn.
Expect events:
   changed lb.SelectedIndex: 0, indices: '0'
   changed lb.SelectedIndex: 1, indices: '1'
   changed lb.SelectedIndex: 2, indices: '2'
But was!:
   changed lb.SelectedIndex: 0, indices: '0' , (lb.FocusedItem: 0)
   changed lb.SelectedIndex: 0, indices: '0' , (lb.FocusedItem: 0)
   changed lb.SelectedIndex: 1, indices: '1' , (lb.FocusedItem: 1)
   changed lb.SelectedIndex: 1, indices: '1' , (lb.FocusedItem: 1)
   changed lb.SelectedIndex: 2, indices: '2' , (lb.FocusedItem: 2)
   changed lb.SelectedIndex: 2, indices: '2' , (lb.FocusedItem: 2)
Each event is doubled!


* 'MultiSimple' Selection mode:
1. Select MultiSimple selection mode (MultiColumn mode on and off seems
unimportant).
2. Click on ListBox items a, b, and c in turn (all three should be selected). 
Then click item 'a' again to unselect it.
Expect events:
   changed lb.SelectedIndex: 0, indices: '0'
   changed lb.SelectedIndex: 0, indices: '0, 1'
   changed lb.SelectedIndex: 0, indices: '0, 1, 2'
   changed lb.SelectedIndex: 1, indices: '1, 2'
But see!
   changed lb.SelectedIndex: 0, indices: '0' , (lb.FocusedItem: 0)
   changed lb.SelectedIndex: 0, indices: '0' , (lb.FocusedItem: 0)
   changed lb.SelectedIndex: 0, indices: '0, 1' , (lb.FocusedItem: 1)
   changed lb.SelectedIndex: 0, indices: '0, 1' , (lb.FocusedItem: 1)
   changed lb.SelectedIndex: 0, indices: '0, 1, 2' , (lb.FocusedItem: 2)
   changed lb.SelectedIndex: 0, indices: '0, 1, 2' , (lb.FocusedItem: 2)
   changed lb.SelectedIndex: 1, indices: '1, 2' , (lb.FocusedItem: 2)
   changed lb.SelectedIndex: 1, indices: '1, 2' , (lb.FocusedItem: 0)
Each event is doubled!


* 'MultiExtended' Selection mode:
Is still broken due to bug 398341.  So not worth documenting the Mono behaviour
here -- see some example events logging in that bug.
Perhaps that mode needs fixed before this, as its selection events are the most
complex.


* 'None' Selection mode
Is ok:
   changed lb.SelectedIndex: -1, indices: '' , (lb.FocusedItem: 0)
   changed lb.SelectedIndex: -1, indices: '' , (lb.FocusedItem: 1)
   changed lb.SelectedIndex: -1, indices: '' , (lb.FocusedItem: 2)



The cause becomes apparent when &quot;show event stack traces&quot; mode is enabled. 
Some of the events come directly from the Control events and some via the
SelectedIndexCollection (and from the mouse up and down events respectively). 
See the full stack traces of the events below.  Note that the first instance
is:
   OnMouseDownLB -&gt; set_SelectedIndex -&gt; SelectedIndexCollection.Add -&gt;
ListBox.OnSelectedIndexChanged
And the second is:
   OnMouseUpLB -&gt; OnItemClick -&gt; OnSelectedIndexChanged

Note that in MSFT selection changes are reported on Mouse *Up* (hold down the
mouse down on click, see no event; release, do see the event).


Full event stack traces:
[[
changed lb.SelectedIndex: 0, indices: '0' , (lb.FocusedItem: 0)
   at ListBoxHarness.GetState(System.Windows.Forms.ListBox lb)
   at ListBoxHarness+&lt;ShowForm&gt;c__AnonStorey0.&lt;&gt;m__0(System.Object ,
System.EventArgs )
   at System.Windows.Forms.ListBox.OnSelectedIndexChanged(System.EventArgs e)
   at System.Windows.Forms.ListBox+(Int32 index)
   at System.Windows.Forms.ListBox.set_SelectedIndex(Int32 value)
   at System.Windows.Forms.ListBox.OnMouseDownLB(System.Object sender,
System.Windows.Forms.MouseEventArgs e)
   at
System.Windows.Forms.Control.OnMouseDown(System.Windows.Forms.MouseEventArgs e)
   at System.Windows.Forms.Control.WmLButtonDown(Message ByRef m)
   at System.Windows.Forms.Control.WndProc(Message ByRef m)
   at System.Windows.Forms.ListBox.WndProc(Message ByRef m)
   at System.Windows.Forms.Control+ControlWindowTarget.OnMessage(Message ByRef
m)
   at System.Windows.Forms.Control+ControlNativeWindow.WndProc(Message ByRef m)
   at System.Windows.Forms.NativeWindow.WndProc(IntPtr hWnd, Msg msg, IntPtr
wParam, IntPtr lParam)
   at System.Windows.Forms.XplatUIWin32.InternalWndProc(IntPtr hWnd, Msg msg,
IntPtr wParam, IntPtr lParam)
   at System.Windows.Forms.XplatUIWin32.Win32DispatchMessage(MSG ByRef )
   at System.Windows.Forms.XplatUIWin32.DispatchMessage(MSG ByRef msg)
   at System.Windows.Forms.XplatUI.DispatchMessage(MSG ByRef msg)
   at System.Windows.Forms.Application.RunLoop(Boolean Modal,
System.Windows.Forms.ApplicationContext context)
   at
System.Windows.Forms.Application.Run(System.Windows.Forms.ApplicationContext
context)
   at System.Windows.Forms.Application.Run(System.Windows.Forms.Form mainForm)
   at ListBoxHarness.ShowForm(Boolean multiColumnMode, SelectionMode
selectionMode)
   at ListBoxHarness.Main(System.String[] args)

changed lb.SelectedIndex: 0, indices: '0' , (lb.FocusedItem: 0)
   at ListBoxHarness.GetState(System.Windows.Forms.ListBox lb)
   at ListBoxHarness+&lt;ShowForm&gt;c__AnonStorey0.&lt;&gt;m__0(System.Object ,
System.EventArgs )
   at System.Windows.Forms.ListBox.OnSelectedIndexChanged(System.EventArgs e)
   at System.Windows.Forms.ListBox.OnItemClick(Int32 index)
   at System.Windows.Forms.ListBox.OnMouseUpLB(System.Object sender,
System.Windows.Forms.MouseEventArgs e)
   at
System.Windows.Forms.Control.OnMouseUp(System.Windows.Forms.MouseEventArgs e)
   at System.Windows.Forms.Control.WmLButtonUp(Message ByRef m)
   at System.Windows.Forms.Control.WndProc(Message ByRef m)
   at System.Windows.Forms.ListBox.WndProc(Message ByRef m)
   at System.Windows.Forms.Control+ControlWindowTarget.OnMessage(Message ByRef
m)
   at System.Windows.Forms.Control+ControlNativeWindow.WndProc(Message ByRef m)
   at System.Windows.Forms.NativeWindow.WndProc(IntPtr hWnd, Msg msg, IntPtr
wParam, IntPtr lParam)
   at System.Windows.Forms.XplatUIWin32.InternalWndProc(IntPtr hWnd, Msg msg,
IntPtr wParam, IntPtr lParam)
   at System.Windows.Forms.XplatUIWin32.Win32DispatchMessage(MSG ByRef )
   at System.Windows.Forms.XplatUIWin32.DispatchMessage(MSG ByRef msg)
   at System.Windows.Forms.XplatUI.DispatchMessage(MSG ByRef msg)
   at System.Windows.Forms.Application.RunLoop(Boolean Modal,
System.Windows.Forms.ApplicationContext context)
   at
System.Windows.Forms.Application.Run(System.Windows.Forms.ApplicationContext
context)
   at System.Windows.Forms.Application.Run(System.Windows.Forms.Form mainForm)
   at ListBoxHarness.ShowForm(Boolean multiColumnMode, SelectionMode
selectionMode)
   at ListBoxHarness.Main(System.String[] args)
]]


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="077680.html">[Mono-bugs] [Bug 414961] missing linq Expression ctors [blocks	IronPython]
</A></li>
	<LI>Next message: <A HREF="077677.html">[Mono-bugs] [Bug 414963] [REGRESSION] ListBox: SelectedIndexChanged event are duplicated
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#77676">[ date ]</a>
              <a href="thread.html#77676">[ thread ]</a>
              <a href="subject.html#77676">[ subject ]</a>
              <a href="author.html#77676">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
