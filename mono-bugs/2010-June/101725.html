<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 617714] New: [.NET 4] Assembly loader fails to load type from remapped assembly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20617714%5D%20New%3A%20%5B.NET%204%5D%20Assembly%20loader%20fails%20to%0A%20load%20type%20from%20remapped%20assembly&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="101724.html">
   <LINK REL="Next"  HREF="101788.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 617714] New: [.NET 4] Assembly loader fails to load type from remapped assembly</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20617714%5D%20New%3A%20%5B.NET%204%5D%20Assembly%20loader%20fails%20to%0A%20load%20type%20from%20remapped%20assembly&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 617714] New: [.NET 4] Assembly loader fails to load type from remapped assembly">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun Jun 27 05:08:57 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="101724.html">[Mono-bugs] [Bug 617671] UITableView Header/Footer text truncated on iPad after scrolling
</A></li>
        <LI>Next message: <A HREF="101788.html">[Mono-bugs] [Bug 617714] [.NET 4] Assembly loader fails to load type from remapped assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101725">[ date ]</a>
              <a href="thread.html#101725">[ thread ]</a>
              <a href="subject.html#101725">[ subject ]</a>
              <a href="author.html#101725">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=617714">http://bugzilla.novell.com/show_bug.cgi?id=617714</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=617714#c0">http://bugzilla.novell.com/show_bug.cgi?id=617714#c0</A>


           Summary: [.NET 4] Assembly loader fails to load type from
                    remapped assembly
    Classification: Mono
           Product: Mono: Runtime
           Version: SVN
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=371955)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=371955">http://bugzilla.novell.com/attachment.cgi?id=371955</A>)
mono_4.0_assembly_loader_bug.tar.bz2

When a 4.0 application references a 2.0/3.5 assembly which, in turn, references
types that live in a remapped assembly (e.g. System.Core's Action types), the
runtime will fail to load any type in the referenced assembly that relies upon
types in the remapped assembly. 

Initially I thought it had to do with the fact that System.Core was not in the
framework_assemblies array in assembly.c, but even after putting it there (diff
for assembly.c is found in the attached tarball) it doesn't work. The assembly
gets remapped properly but the type load is still attempted from the version of
assembly from before the mapping.

This breaks, e.g., ASP.NET MVC2 applications (a sample app is found in the
tarball as well) which are ran under Mono .NET 4 runtime. To run the sample MVC
app, start xsp4 in the MvcApplication2/MvcApplication2/ directory and browse to
<A HREF="http://localhost:8080/">http://localhost:8080/</A>
A MissingMethodException will be thrown stating that the
System.Web.Mvc.RouteCollectionExtensions.IgnoreRoute method (from
System.Web.Mvc.dll - compiled for the 2.0/3.5 runtime) is not found.

The tarball contains also a simpler example of how the remapping fails (in the
test/ directory). The sample consists of an assembly which uses System.Core's
Action type (in 4.0 this type got moved to corlib) and a small app which
references the assembly. The sample build script, compile.sh, when invoked
without any parameters will fail to compile the application (in this mode it
compiles ab assembly using gmcs and the test application with dmcs - in effect
dmcs fails to load the Test.MyClass type from the sample assembly). If invoked
with any parameter, it will succeed to compile the assembly and the application
(in this mode the assembly is compiled twice - first with dmcs to make it
possible to compile test.exe, second with gmcs after test.exe is built) but the
application will fail to work as Test.MyClass fails to load.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="101724.html">[Mono-bugs] [Bug 617671] UITableView Header/Footer text truncated on iPad after scrolling
</A></li>
	<LI>Next message: <A HREF="101788.html">[Mono-bugs] [Bug 617714] [.NET 4] Assembly loader fails to load type from remapped assembly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101725">[ date ]</a>
              <a href="thread.html#101725">[ thread ]</a>
              <a href="subject.html#101725">[ subject ]</a>
              <a href="author.html#101725">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
