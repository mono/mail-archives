<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 618043] New: fastcgi-mono-server2 stops accepting requests, after heavy load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20618043%5D%20New%3A%20fastcgi-mono-server2%20stops%20accepting%0A%20requests%2C%20after%20heavy%20load&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="101768.html">
   <LINK REL="Next"  HREF="101771.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 618043] New: fastcgi-mono-server2 stops accepting requests, after heavy load</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20618043%5D%20New%3A%20fastcgi-mono-server2%20stops%20accepting%0A%20requests%2C%20after%20heavy%20load&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 618043] New: fastcgi-mono-server2 stops accepting requests, after heavy load">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Jun 28 15:57:10 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="101768.html">[Mono-bugs] [Bug 617970] New: compiles doesn't check for presence of all abstract methods required
</A></li>
        <LI>Next message: <A HREF="101771.html">[Mono-bugs] [Bug 618043] fastcgi-mono-server2 stops accepting requests, after heavy load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101770">[ date ]</a>
              <a href="thread.html#101770">[ thread ]</a>
              <a href="subject.html#101770">[ subject ]</a>
              <a href="author.html#101770">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=618043">http://bugzilla.novell.com/show_bug.cgi?id=618043</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=618043#c0">http://bugzilla.novell.com/show_bug.cgi?id=618043#c0</A>


           Summary: fastcgi-mono-server2 stops accepting requests, after
                    heavy load
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.6.x
          Platform: 32bit
        OS/Version: Linux
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">novell at pasichnyk.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.70 Safari/533.4

I have a fairly simple web app, hosted in lighttpd via fastcgi (single
process).  The app serves up entirely dynamic content (single .ashx), no static
content is delivered.  Incoming requests are very small (just url parameters
for payload), and no real content is delivered (just a Response.Redirect()
after processing completes).

Under low or medium load, the system performs fine, however after running 1 or
more load test using siege or ab, the system stops accepting new connections. 
When it does this there are several errors that show up in the sites error log,
all coming from the fastcgi process...  
- Failed to process connection. Reason: Object reference not set to an instance
of an object
- Failed to process connection. Reason: Collection was modified; enumeration
operation may not execute.
- Failed to process connection. Reason: The descriptor is not a socket

Once i start seeing these errors in the log, either many incoming requests will
fail/timeout, or the will all timeout.  Usually all will timeout.

Requests for static content are still served fine, so lighttpd is functioning
as expected.

I know for sure that the fastcgi process is still running fine when it stops
taking connections, becuase i have a separate thread spawned off to do
maintenance work (Save some queued data to a database if there is work to do)
and it keeps running, writing out trace messages.

This is occurring on Gentoo x86, running on mono-2.6.4 and xsp-2.6.

Switching to spawn-fcgi didn't change anything.


Reproducible: Always

Steps to Reproduce:
1. Create a site with an .ashx handler that does a Response.Redirect()
2. load it up with over 500 requests/sec using &quot;siege&quot; or &quot;ab&quot;
3. tail the error log for the site
Actual Results:  
Website stops acceptiong connections, and reports the following errors in the
error_log.

- Failed to process connection. Reason: Object reference not set to an instance
of an object
- Failed to process connection. Reason: Collection was modified; enumeration
operation may not execute.
- Failed to process connection. Reason: The descriptor is not a socket

Restarting the process (if using spawn-fcgi) or restarting lighttpd (if using
lighttpd controlled fastcgi processes) resolves the issue, until more load
comes to the server at which time it will stop functioning again.

Expected Results:  
website doesn't stop accepting connections

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="101768.html">[Mono-bugs] [Bug 617970] New: compiles doesn't check for presence of all abstract methods required
</A></li>
	<LI>Next message: <A HREF="101771.html">[Mono-bugs] [Bug 618043] fastcgi-mono-server2 stops accepting requests, after heavy load
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101770">[ date ]</a>
              <a href="thread.html#101770">[ thread ]</a>
              <a href="subject.html#101770">[ subject ]</a>
              <a href="author.html#101770">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
