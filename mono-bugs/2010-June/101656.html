<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 617100] New: Certificate error sending certified	email
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20617100%5D%20New%3A%20Certificate%20error%20sending%20certified%0A%09email&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="101655.html">
   <LINK REL="Next"  HREF="101661.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 617100] New: Certificate error sending certified	email</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20617100%5D%20New%3A%20Certificate%20error%20sending%20certified%0A%09email&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 617100] New: Certificate error sending certified	email">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jun 24 09:22:26 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="101655.html">[Mono-bugs] [Bug 431453] internal GetEnumerator() methods should not be considered within a foreach()
</A></li>
        <LI>Next message: <A HREF="101661.html">[Mono-bugs] [Bug 617129] New: Crash when creating process
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101656">[ date ]</a>
              <a href="thread.html#101656">[ thread ]</a>
              <a href="subject.html#101656">[ subject ]</a>
              <a href="author.html#101656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=617100">http://bugzilla.novell.com/show_bug.cgi?id=617100</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=617100#c0">http://bugzilla.novell.com/show_bug.cgi?id=617100#c0</A>


           Summary: Certificate error sending certified email
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: x86-64
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System.Security
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">spouliot at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">stefano.sapienti at apsystems.it</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=371500)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=371500">http://bugzilla.novell.com/attachment.cgi?id=371500</A>)
Certificates

User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US)
AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.70 Safari/533.4

Sending certified mail works or not depending on the mail provider. Using the
same code (provided inside attachment) I'm able to send certified emails with
google and another local provider but not with a third local provider
(specified in attachment).



Reproducible: Always

Steps to Reproduce:
More detailed infos inside attachment

1. mozroots --import --machine --ask-remove
2. certmgr -ssl -m <A HREF="smtps://smtpserver:465">smtps://smtpserver:465</A> (this port is for ssl, for tls port
25 is used but cetmgr fails)

For Google this is enough, for this provider I need to manually add
certificates (attached) to stores:
3. certmgr --add -c -m CA /tmp/certca.crt
4. certmgr --add -c -m Trust /tmp/certroot.cer
5. reboot
6. Send Mail with the provided sample

Actual Results:  
System.Net.Mail.SmtpException: Message could not be sent. ---&gt;
System.IO.IOException: The authentication or decryption has failed. ---&gt;
System.InvalidOperationException: SSL authentication error:
RemoteCertificateNotAvailable, RemoteCertificateChainErrors
  at System.Net.Mail.SmtpClient.&lt;callback&gt;m__3 (System.Object sender,
System.Security.Cryptography.X509Certificates.X509Certificate certificate,
System.Security.Cryptography.X509Certificates.X509Chain chain, SslPolicyErrors
sslPolicyErrors) [0x00000] in &lt;filename unknown&gt;:0


Expected Results:  
Mail Sent. If I add the Ca certificate also to Trust store:
7. certmgr --add -c -m Trust /tmp/certca.crt
8. reboot
9. Send Mail

the RemoteCertificateChainErrors disappear

System.Net.Mail.SmtpException: Message could not be sent. ---&gt; 
System.IO.IOException: The authentication or decryption has failed. 
---&gt; System.InvalidOperationException: SSL authentication error: 
RemoteCertificateNotAvailable at System.Net.Mail.SmtpClient.m__3 
(System.Object sender, 
System.Security.Cryptography.X509Certificates.X509Certificate 
certificate, System.Security.Cryptography.X509Certificates.X509Chain 
chain, SslPolicyErrors sslPolicyErrors) [0x00000] in :0 

I have to use this code in an ASP.Net application but it fails also if used in
a console application. In MS.Net it's enough to add certca.crt to the trusted
CA store of sending machine.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="101655.html">[Mono-bugs] [Bug 431453] internal GetEnumerator() methods should not be considered within a foreach()
</A></li>
	<LI>Next message: <A HREF="101661.html">[Mono-bugs] [Bug 617129] New: Crash when creating process
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101656">[ date ]</a>
              <a href="thread.html#101656">[ thread ]</a>
              <a href="subject.html#101656">[ subject ]</a>
              <a href="author.html#101656">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
