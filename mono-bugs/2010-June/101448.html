<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 615553] New: Marshalling a union results in a crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20615553%5D%20New%3A%20Marshalling%20a%20union%20results%20in%20a%20crash&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="101445.html">
   <LINK REL="Next"  HREF="101467.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 615553] New: Marshalling a union results in a crash</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20615553%5D%20New%3A%20Marshalling%20a%20union%20results%20in%20a%20crash&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 615553] New: Marshalling a union results in a crash">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Jun 18 14:41:36 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="101445.html">[Mono-bugs] [Bug 615514] New: Namespace My.MyProject and class ThreadSafeObjectProvider are not generated.
</A></li>
        <LI>Next message: <A HREF="101467.html">[Mono-bugs] [Bug 615553] Marshalling a union results in a crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101448">[ date ]</a>
              <a href="thread.html#101448">[ thread ]</a>
              <a href="subject.html#101448">[ subject ]</a>
              <a href="author.html#101448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=615553">http://bugzilla.novell.com/show_bug.cgi?id=615553</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=615553#c0">http://bugzilla.novell.com/show_bug.cgi?id=615553#c0</A>


           Summary: Marshalling a union results in a crash
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.4.x
          Platform: x86-64
        OS/Version: Ubuntu
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: interop
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jefdriesen at hotmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Community User
           Blocker: ---


Created an attachment (id=370184)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=370184">http://bugzilla.novell.com/attachment.cgi?id=370184</A>)
Simple test case showing the problem

When trying to marshall a C union with an embedded struct, mono crashes.

typedef union foobar_t {
    unsigned int foo;
    struct {
        unsigned int a;
        double b;
    } bar;
} foobar_t;

The error message is:

&quot;Got a SIGABRT while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries
used by your application.&quot;

I'm pretty sure there is no bug in the native code, because it works fine from
a native applications. When I remove the struct from the union it works fine,
so I suspect the error must be there somewhere. The actual definition of the
struct does not seem to be important, but as soon as some struct is present, it
crashes.

Note that in my case, the struct needs to be marshalled from native code 
to managed code, because it's used in a callback function.

I don't have a MS .NET environment to test at the moment. But as far as I can
remember when I tried my original code with MS .NET, it worked fine.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="101445.html">[Mono-bugs] [Bug 615514] New: Namespace My.MyProject and class ThreadSafeObjectProvider are not generated.
</A></li>
	<LI>Next message: <A HREF="101467.html">[Mono-bugs] [Bug 615553] Marshalling a union results in a crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#101448">[ date ]</a>
              <a href="thread.html#101448">[ thread ]</a>
              <a href="subject.html#101448">[ subject ]</a>
              <a href="author.html#101448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
