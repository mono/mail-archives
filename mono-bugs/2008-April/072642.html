<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 382635] New: submitting too long data for (n) varchar SqlParameter crashes mono
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20382635%5D%20New%3A%20submitting%20too%20long%20data%20for%20%28n%29%0A%20varchar%20SqlParameter%20crashes%20mono&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="072638.html">
   <LINK REL="Next"  HREF="072644.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 382635] New: submitting too long data for (n) varchar SqlParameter crashes mono</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20382635%5D%20New%3A%20submitting%20too%20long%20data%20for%20%28n%29%0A%20varchar%20SqlParameter%20crashes%20mono&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 382635] New: submitting too long data for (n) varchar SqlParameter crashes mono">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Apr 23 03:10:14 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="072638.html">[Mono-bugs] [Bug 382589] New: Passing either Decimal.Max or Decimal. Min to a SQL Server 2005 stored procedure that takes a decimal(29, 0) results in a SqlException
</A></li>
        <LI>Next message: <A HREF="072644.html">[Mono-bugs] [Bug 382635] submitting too long data for (n) varchar SqlParameter crashes mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#72642">[ date ]</a>
              <a href="thread.html#72642">[ thread ]</a>
              <a href="subject.html#72642">[ subject ]</a>
              <a href="author.html#72642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=382635">https://bugzilla.novell.com/show_bug.cgi?id=382635</A>


           Summary: submitting too long data for (n)varchar SqlParameter
                    crashes mono
           Product: Mono: Class Libraries
           Version: 1.9.0
          Platform: i686
        OS/Version: Linux
            Status: NEW
          Severity: Major
          Priority: P5 - None
         Component: Sys.Data
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bnc-blr-team-mono at forge.provo.novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">josef.semmler at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Description of Problem:

If you have stored procedure with e.g. an nvarchar(50) parameter - and you want
to call this procedure with paramters you would do something like this:
..
param = new SqlParameter(&quot;@Name&quot;, SqlDbType.NVarChar, 50);
param.Value = myName;         //.Substring(0,50);
..
and then launch the stored procedure with this paramter.

If the length of &quot;myName&quot; is bigger than 50 you will end up with an exception
like this:

Unhandled Exception: Mono.Data.Tds.Protocol.TdsInternalException: Server closed
the connection. ---&gt; System.IO.IOException: Write failure ---&gt;
System.Net.Sockets.SocketException: The socket has been shut down
  at System.Net.Sockets.Socket.Send (System.Byte[] buf, Int32 offset, Int32
size, SocketFlags flags) [0x00000]
  at System.Net.Sockets.NetworkStream.Write (System.Byte[] buffer, Int32
offset, Int32 size) [0x00000] --- End of inner exception stack trace ---
  at System.Net.Sockets.NetworkStream.Write (System.Byte[] buffer, Int32
offset, Int32 size) [0x00000]
  at Mono.Data.Tds.Protocol.TdsComm.SendPhysicalPacket (Boolean isLastSegment)
[0x00000]
  at Mono.Data.Tds.Protocol.TdsComm.SendPacket () [0x00000]
  at Mono.Data.Tds.Protocol.Tds.ExecuteQuery (System.String sql, Int32 timeout,
Boolean wantResults) [0x00000] --- End of inner exception stack trace ---
  at Mono.Data.Tds.Protocol.Tds.ExecuteQuery (System.String sql, Int32 timeout,
Boolean wantResults) [0x00000]
  at Mono.Data.Tds.Protocol.Tds70.Execute (System.String commandText,
Mono.Data.Tds.TdsMetaParameterCollection parameters, Int32 timeout, Boolean
wantResults) [0x00000]
  at Mono.Data.Tds.Protocol.Tds.Execute (System.String sql) [0x00000]


Steps to reproduce the problem:
You need a database (i use mssql). Create a stored procedure with a varchar(50)
paramter. The content of the SP does not matter. Write code to launch the SP -
pass the paramter with code like shown above.
An alternative way should be to try to insert data in a table with a
varchar(50) attribute.


Actual Results:
You get an exception (see above), the database connection is dropped,
application crashes. If you check the sqlserver logs, you will see a message
like &quot;invalid buffer received - client unexpectedly closed connection&quot;.


Expected Results:
either a reasonable error message, which indicates the miss match in size - or
(preferred) the behaviour of microsoft .net ... .net seems to silently truncate
the parameter to the given size (in my case 50 chars)(which would result in
truncated data, without any notifications)

How often does this happen? 
!always!

Additional Information:
Defect was seen while trying to pass a parameter to a stored procedure.
What the correct behaviour would be, i'm not - but i would expect that mono
behaves as microsoft .net - as only this allows to run a .net application with
mono (in my case the application can not run with mono now).
The defect was seen with Mono 1.4, 1.6 and 1.9 - under linux (CentOs 4 and 5).
(Mono under windows was not tested)


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>

































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="072638.html">[Mono-bugs] [Bug 382589] New: Passing either Decimal.Max or Decimal. Min to a SQL Server 2005 stored procedure that takes a decimal(29, 0) results in a SqlException
</A></li>
	<LI>Next message: <A HREF="072644.html">[Mono-bugs] [Bug 382635] submitting too long data for (n) varchar SqlParameter crashes mono
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#72642">[ date ]</a>
              <a href="thread.html#72642">[ thread ]</a>
              <a href="subject.html#72642">[ subject ]</a>
              <a href="author.html#72642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
