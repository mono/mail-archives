<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 375987] Segmentation fault with testcase project that uses Atk# and System.Windows .Forms
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20375987%5D%20Segmentation%20fault%20with%20testcase%20project%0A%20that%20uses%20Atk%23%20and%20System.Windows%20.Forms&In-Reply-To=bug-375987-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="071459.html">
   <LINK REL="Next"  HREF="071461.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 375987] Segmentation fault with testcase project that uses Atk# and System.Windows .Forms</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20375987%5D%20Segmentation%20fault%20with%20testcase%20project%0A%20that%20uses%20Atk%23%20and%20System.Windows%20.Forms&In-Reply-To=bug-375987-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 375987] Segmentation fault with testcase project that uses Atk# and System.Windows .Forms">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Apr  1 19:51:31 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="071459.html">[Mono-bugs] [Bug 375987] Segmentation fault with testcase project that uses Atk# and System.Windows .Forms
</A></li>
        <LI>Next message: <A HREF="071461.html">[Mono-bugs] [Bug 375987] Segmentation fault with testcase project that uses Atk# and System.Windows .Forms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#71460">[ date ]</a>
              <a href="thread.html#71460">[ thread ]</a>
              <a href="subject.html#71460">[ subject ]</a>
              <a href="author.html#71460">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=375987">https://bugzilla.novell.com/show_bug.cgi?id=375987</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sanfordarmstrong at gmail.com</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=375987#c5">https://bugzilla.novell.com/show_bug.cgi?id=375987#c5</A>


Sanford Armstrong &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sanfordarmstrong at gmail.com</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
             Status|NEEDINFO                                        |NEW
      Info Provider|<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">aaragoneses at novell.com</A>                          |




--- Comment #5 from Sanford Armstrong &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sanfordarmstrong at gmail.com</A>&gt;  2008-04-01 17:51:31 MST ---
Looks like the problem is related to how System.Windows.Forms inits GTK+ in
order to figure out theme colors.  This causes ATK to initialize with the
GAIL/GTK/whatver-it-is bridge when we will want to be initializing it with our
own UIA bridge.  Trimmed IRC conversation discussing possible solutions
follows:

&lt;knocte&gt; this is the line:      retval = klass-&gt;get_root ();
 and that line goes to the managed world
&lt;knocte&gt; why can it be that a SWF Form conflicts with that?
&lt;kangaroo&gt; knocte: You try dropping the gtk init in swf?
&lt;knocte&gt; mmm, wait, does SWF use GTK?
&lt;kangaroo&gt; X11DesktopColors.cs
&lt;sandy&gt; kangaroo: same problem... it's GLib.GType.Init(); by the way
&lt;kangaroo&gt; in the static ctor
 try commenting the entire Desktop.Gtk block
 or patch it in FindDesktopEnv
&lt;knocte&gt; but I don't understand why SWF uses Gtk
&lt;kangaroo&gt; knocte: To find some default colors
 to look a little better
&lt;kangaroo&gt; try removing that block and see if it fixes it
 kangaroo: if this is indeed the problem, what do you suggest to fix it? I
guess we cannot drop the dependency of SWF on GTK?
&lt;sandy&gt; knocte, kangaroo: totally worked with that commented out
&lt;knocte&gt; glad you found the problem :) but now concerned about the solution :(
&lt;kangaroo&gt; that should be easy
 figure out why they cannot interop
&lt;kangaroo&gt; and what api calls need to happen in what order for them to interop
 and patch appropriately :)
&lt;knocte&gt; gtk needs gtk_init to work
&lt;kangaroo&gt; I think we call gtk_init_check
 or something
&lt;knocte&gt; and gtk_init launches atkbridge, which then results in having the same
module called twice
&lt;knocte&gt; we cannot call gtk_init
&lt;kangaroo&gt; knocte: gtk should have some &quot;gtk_is_inited_yet()&quot; type call
&lt;knocte&gt; but kangaroo, gtk is not inited yet
&lt;kangaroo&gt; why can gtk not be init'd?
&lt;knocte&gt; what is inited is a gtk module: atkbridge
 because we need to use our own atk root object
 not the one that GTK stablishes
 we are a different toolkit than GTK, and then we need to manage accessibility
infrastructure ourselves
&lt;kangaroo&gt; eww
 well you'll need to either:
&lt;knocte&gt; maybe the way to go is to patch gtk_init in order to check if
atkbridge is inited yet or not
&lt;kangaroo&gt; a) figure out a way around that on your side
 b) figure out another way to get the colors we need from gtk+
 c) convince jpobst we dont need to probe gtk+
 but the problem is in our theming layer
 if someone makes a native gtk+ theme
&lt;kangaroo&gt; your code will break
 knocte: he's the person to convince to not do that in mwf; but thats not a
long term solution anyways
&lt;knocte&gt; yeah, that's why I think maybe the right way is fix this from the
root, modifying gtk_init
* spouliot suggest to copy-paste that to the bug report and reassign it
elsewhere :)
&lt;knocte&gt; yep, to gnome xD
 no, I want to fix it, it will be cool
&lt;jpobst&gt; i would love to not probe gtk+ in mwf, that's what causes the bugbuddy
issues for us
&lt;jpobst&gt; the only thing it is used for (i think) is to get theme colors, if
there's another way to do that, that'd be awesome


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="071459.html">[Mono-bugs] [Bug 375987] Segmentation fault with testcase project that uses Atk# and System.Windows .Forms
</A></li>
	<LI>Next message: <A HREF="071461.html">[Mono-bugs] [Bug 375987] Segmentation fault with testcase project that uses Atk# and System.Windows .Forms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#71460">[ date ]</a>
              <a href="thread.html#71460">[ thread ]</a>
              <a href="subject.html#71460">[ subject ]</a>
              <a href="author.html#71460">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
