<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 476138] New: Win32 Socket behaviour changed.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20476138%5D%20New%3A%20Win32%20Socket%20behaviour%20changed.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="086103.html">
   <LINK REL="Next"  HREF="086110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 476138] New: Win32 Socket behaviour changed.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20476138%5D%20New%3A%20Win32%20Socket%20behaviour%20changed.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 476138] New: Win32 Socket behaviour changed.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Feb 16 07:42:48 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="086103.html">[Mono-bugs] [Bug 324993] Compilation fails on unsafe delegate	initializer.
</A></li>
        <LI>Next message: <A HREF="086110.html">[Mono-bugs] [Bug 476138] Win32 Socket behaviour changed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86104">[ date ]</a>
              <a href="thread.html#86104">[ thread ]</a>
              <a href="subject.html#86104">[ subject ]</a>
              <a href="author.html#86104">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=476138">https://bugzilla.novell.com/show_bug.cgi?id=476138</A>


           Summary: Win32 Socket behaviour changed.
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: i686
        OS/Version: Windows XP
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lucas.meijer at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US;
rv:1.9.0.6) Gecko/2009011912 Firefox/3.0.6


While upgrading our mono to get all the latest bugfixes, I'm running into the
following, which looks like a win32 socket regression.

here is the program, see the other fields for expected results/actual results.
make sure to actually have something listening on port 1234.



using System;
using System.Collections.Generic;
using System.Net.Sockets;
using System.Net;

class Program
{
    static void Main(string[] args)
    {
        var s = new Socket(AddressFamily.InterNetwork, SocketType.Stream,
ProtocolType.Tcp);

        var ep = new IPEndPoint(IPAddress.Parse(&quot;127.0.0.1&quot;), 5655);
        s.Blocking = false;
        s.Bind(ep);
        s.Listen(5);

        var s2 = new Socket(AddressFamily.InterNetwork, SocketType.Stream,
ProtocolType.Tcp);
        s2.Bind(new IPEndPoint(IPAddress.Any, 0));
        s2.Blocking = false;

        try
        {
            //You actally need to be running something on port 1234. 
            s2.Connect(IPAddress.Parse(&quot;127.0.0.1&quot;), 1234); 
        }
        catch (SocketException se)
        {
            // ignore blocking connect exception. shouldn't there be some other
way to do this...
            if (se.ErrorCode != 10035)
                throw se;
        }

        var errorList = new List&lt;Socket&gt;();
        var readList = new List&lt;Socket&gt;();
        var writeList = new List&lt;Socket&gt;();

        readList.Add(s);
        readList.Add(s2);
        errorList.Add(s);
        errorList.Add(s2);
        Socket.Select(readList, null, errorList, 100);

        if (errorList.Contains(s))
            Console.WriteLine(&quot;error on socket s&quot;);
        if (errorList.Contains(s2))
            Console.WriteLine(&quot;error on socket s2&quot;);
        if (readList.Contains(s))
            Console.WriteLine(&quot;available data on socket s&quot;);
        if (readList.Contains(s2))
            Console.WriteLine(&quot;available data on socket s2&quot;);
    }
}

Reproducible: Always

Steps to Reproduce:
1) compile the program
2) run it on mono-trunk (we used r126917)
3) run it on an older mono (we don't know the exact revision of our older
runtime, but it's about svn from november 28, 2008. Try 2.0)

4) compare reults.
Actual Results:  
On Mono-2ish, output is:

available data on socket s2

On Mono-SVN-Trunk-r126917, output is:


error on socket s
error on socket s2
available data on socket s
available data on socket s2



Expected Results:  
Identical results. The results from the 2.0 execution look like they are what
should be happening.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>



























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="086103.html">[Mono-bugs] [Bug 324993] Compilation fails on unsafe delegate	initializer.
</A></li>
	<LI>Next message: <A HREF="086110.html">[Mono-bugs] [Bug 476138] Win32 Socket behaviour changed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86104">[ date ]</a>
              <a href="thread.html#86104">[ thread ]</a>
              <a href="subject.html#86104">[ subject ]</a>
              <a href="author.html#86104">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
