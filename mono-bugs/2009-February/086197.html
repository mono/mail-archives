<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 477049] New: Using XmlNode.SelectSingleNode with multiple threads almost always fails and throws an Exception.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20477049%5D%20New%3A%20Using%20XmlNode.SelectSingleNode%20with%0A%20multiple%20threads%20almost%20always%20fails%20and%20throws%20an%20Exception.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="086196.html">
   <LINK REL="Next"  HREF="086198.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 477049] New: Using XmlNode.SelectSingleNode with multiple threads almost always fails and throws an Exception.</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20477049%5D%20New%3A%20Using%20XmlNode.SelectSingleNode%20with%0A%20multiple%20threads%20almost%20always%20fails%20and%20throws%20an%20Exception.&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 477049] New: Using XmlNode.SelectSingleNode with multiple threads almost always fails and throws an Exception.">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Feb 18 11:57:42 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="086196.html">[Mono-bugs] [Bug 477037] Verifier crashes with SIGSEGV
</A></li>
        <LI>Next message: <A HREF="086198.html">[Mono-bugs] [Bug 477049] Using XmlNode.SelectSingleNode with multiple threads almost always fails and throws an Exception.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86197">[ date ]</a>
              <a href="thread.html#86197">[ thread ]</a>
              <a href="subject.html#86197">[ subject ]</a>
              <a href="author.html#86197">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=477049">https://bugzilla.novell.com/show_bug.cgi?id=477049</A>


           Summary: Using XmlNode.SelectSingleNode with multiple threads
                    almost always fails and throws an Exception.
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.4.x
          Platform: All
        OS/Version: Windows XP
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.XML
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Vernish13 at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=273657)
 --&gt; (<A HREF="https://bugzilla.novell.com/attachment.cgi?id=273657">https://bugzilla.novell.com/attachment.cgi?id=273657</A>)
Includes Test.cs and TestFile.xml

User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.0.6)
Gecko/2009011913 Firefox/3.0.6

Start multiple threads and each creates its own XmlDocument from the same file.
Then each of those threads starts multiple threads to read their XmlDocument. 
While reading each thread uses XmlNode.SelectSingleNode().  SelectSingleNode
will very frequently return null when it should have returned an XmlNode. 
Sometimes an Assertion Exception will be thrown also.


Reproducible: Always

Steps to Reproduce:
1. Extract the attached zip file.  It should contain Test.cs and TestFile.xml
2. Compile Test.cs.  Using gmcs or csc.  Ex.  csc Test.cs
3. Run at the console  (  &gt;mono Test.exe  ).  If it completes successfully, run
it again.
Actual Results:  
Actual Results Vary.  I have seen it complete successfully, but normally one of
the errors below occurs.

Most Common Is : 

Unhandled Exception: System.NullReferenceException: Object reference not set to
an instance of an object
  at System.Xml.XPath.CompiledExpression.EvaluateNodeSet
(System.Xml.XPath.BaseI
terator iter) [0x00000]
  at System.Xml.XPath.XPathNavigator.Select (System.Xml.XPath.XPathExpression
ex
pr, IXmlNamespaceResolver ctx) [0x00000]
  at System.Xml.XPath.XPathNavigator.Select (System.Xml.XPath.XPathExpression
ex
pr) [0x00000]
  at System.Xml.XmlNode.SelectSingleNode (System.String xpath,
System.Xml.XmlNam
espaceManager nsmgr) [0x00000]
  at System.Xml.XmlNode.SelectSingleNode (System.String xpath) [0x00000]
  at SelectNodeTests.Program.RepeatedMetadataNodeLookUp
(SelectNodeTests.ThreadR
eadData data) [0x00000]
  at SelectNodeTests.Program.ReadDocument (System.Object arg) [0x00000]

This has happened a couple times : 

System.Xml.XPath.NullIterator doesn't implement interface
System.IFormatProvider

* Assertion: should not be reached at ..\mono\mini\mini-trampolines.c:67

This application has requested the Runtime to terminate it in an unusual way.
Please contact the application's support team for more information.

Expected Results:  
&quot;Done&quot; Displayed on the console.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>













































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="086196.html">[Mono-bugs] [Bug 477037] Verifier crashes with SIGSEGV
</A></li>
	<LI>Next message: <A HREF="086198.html">[Mono-bugs] [Bug 477049] Using XmlNode.SelectSingleNode with multiple threads almost always fails and throws an Exception.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#86197">[ date ]</a>
              <a href="thread.html#86197">[ thread ]</a>
              <a href="subject.html#86197">[ subject ]</a>
              <a href="author.html#86197">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
