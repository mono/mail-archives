<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 472732] mod-mono spawns many process and fails to respond when using AutoRestartMode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20472732%5D%20mod-mono%20spawns%20many%20process%20and%20fails%20to%0A%20respond%20when%20using%20AutoRestartMode&In-Reply-To=bug-472732-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="085888.html">
   <LINK REL="Next"  HREF="085929.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 472732] mod-mono spawns many process and fails to respond when using AutoRestartMode</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20472732%5D%20mod-mono%20spawns%20many%20process%20and%20fails%20to%0A%20respond%20when%20using%20AutoRestartMode&In-Reply-To=bug-472732-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 472732] mod-mono spawns many process and fails to respond when using AutoRestartMode">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Feb 11 14:07:48 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="085888.html">[Mono-bugs] [Bug 472732] mod-mono spawns many process and fails to respond when using AutoRestartMode
</A></li>
        <LI>Next message: <A HREF="085929.html">[Mono-bugs] [Bug 472732] mod-mono spawns many process and fails to respond when using AutoRestartMode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85898">[ date ]</a>
              <a href="thread.html#85898">[ thread ]</a>
              <a href="subject.html#85898">[ subject ]</a>
              <a href="author.html#85898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=472732">https://bugzilla.novell.com/show_bug.cgi?id=472732</A>

User <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A> added comment
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=472732#c16">https://bugzilla.novell.com/show_bug.cgi?id=472732#c16</A>





--- Comment #16 from Marek Habersack &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>&gt;  2009-02-11 12:07:47 MST ---
(In reply to comment #15)
&gt;<i> Marek, thanks for the explanation. I'm happy for this to be a configuration
</I>There's undoubtedly room for improvement in mod_mono, but this particular issue
is a configuration one, indeed :)

&gt;<i> issue on my part, and I would happily offer to document it on the mod-mono wiki
</I>&gt;<i> once its setteled :-)
</I>&gt;<i> 
</I>&gt;<i> A couple of clarifications:
</I>&gt;<i> * We are using MPM worker
</I>&gt;<i> * I've set the hard and soft per proccess FD limits to 32768. When I check the
</I>&gt;<i> limits of the backend process using /proc/BACKENDPID/limits it shows 32768 on
</I>&gt;<i> both soft and hard limits. I'm not clear about your comment of this limit being
</I>&gt;<i> set on a group of processes.
</I>I wasn't clear enough when writing that, sorry. What I mean is that all of the
child processes of apache inherit that. While for the child process it's enough
room for opening files it needs (hopefully), for the parent process the space
might be tight. Each instance of a backend consumes at least 3 file descriptors
(that's just mod_mono communications) per request, plus apache descriptors
opened per request, plus logging etc. etc. - with many concurrent requests,
several queued ones the 32k of available slots might not be enough and is the
cause of the error. If your apache has other virtual hosts, then the number of
available descriptors might decrease even quicker.

&gt;<i> * I've set the autorestart request limit to 100 only for the repro. It was set
</I>&gt;<i> to 10,000 on our servers.
</I>Ah, that's good :) I was under impression it was your production value.

&gt;<i> * The repro is most basic ASP.NET app with a single default.aspx page. Shutdown
</I>&gt;<i> of this application should be pretty fast.
</I>&gt;<i> 
</I>&gt;<i> If I understand your explanation, you are proposing that I size up the request
</I>&gt;<i> limits, etc. to *avoid* this issue. It seems that there is a window here where
</I>&gt;<i> apache/mod-mono could start a large number of processes and consume a large
</I>&gt;<i> number of FD. This window happens when backend are shutdown and restarted and
</I>&gt;<i> is a result of the synchornous operations that are performed. Is this correct?
</I>Yes, as explained above it may create a situation when the parent (apache)
process runs out of available file descriptors.

&gt;<i> My issues is that I'm unomfortable running without any limits (time or request)
</I>&gt;<i> based, and I've yet been able to find the right configuration to avoid this
</I>&gt;<i> issue when a limits is reached. I've observed that by setting the request limit
</I>&gt;<i> to 10,000 (and having the FD descriptor limit set to a high number) this
</I>&gt;<i> prolongs the lock-up issue but it still happens.
</I>I think it's just a matter of finding the safe margin of available file
descriptors value for apache.

&gt;<i> The cronjob approach might be the most robust approach at this point.
</I>yes, it will clean all the backend processes. Frankly, there's not much
mod_mono can do if its apache host runs out of file descriptors :)

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="085888.html">[Mono-bugs] [Bug 472732] mod-mono spawns many process and fails to respond when using AutoRestartMode
</A></li>
	<LI>Next message: <A HREF="085929.html">[Mono-bugs] [Bug 472732] mod-mono spawns many process and fails to respond when using AutoRestartMode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85898">[ date ]</a>
              <a href="thread.html#85898">[ thread ]</a>
              <a href="subject.html#85898">[ subject ]</a>
              <a href="author.html#85898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
