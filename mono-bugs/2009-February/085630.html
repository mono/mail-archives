<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 473131] New: System.Diagnostic.ProcModule.FileName truncates the file name if it is too long
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20473131%5D%20New%3A%20System.Diagnostic.ProcModule.FileName%0A%20truncates%20the%20file%20name%20if%20it%20is%20too%20long&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="085629.html">
   <LINK REL="Next"  HREF="085631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 473131] New: System.Diagnostic.ProcModule.FileName truncates the file name if it is too long</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20473131%5D%20New%3A%20System.Diagnostic.ProcModule.FileName%0A%20truncates%20the%20file%20name%20if%20it%20is%20too%20long&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 473131] New: System.Diagnostic.ProcModule.FileName truncates the file name if it is too long">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Feb  5 19:39:56 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="085629.html">[Mono-bugs] [Bug 471292] Random.Next(Int32.MinValue, Int32.MaxValue) does not generate all numbers
</A></li>
        <LI>Next message: <A HREF="085631.html">[Mono-bugs] [Bug 473131] System.Diagnostic.ProcModule.FileName truncates the file name if it is too long
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85630">[ date ]</a>
              <a href="thread.html#85630">[ thread ]</a>
              <a href="subject.html#85630">[ subject ]</a>
              <a href="author.html#85630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=473131">https://bugzilla.novell.com/show_bug.cgi?id=473131</A>


           Summary: System.Diagnostic.ProcModule.FileName truncates the
                    file name if it is too long
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.0.x
          Platform: x86
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">ice1n36 at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=270649)
 --&gt; (<A HREF="https://bugzilla.novell.com/attachment.cgi?id=270649">https://bugzilla.novell.com/attachment.cgi?id=270649</A>)
Repro case

Description of Problem:
When using System.Diagnostic.ProcModule.FileName to get the absolute path of
the modules, if the path is more than 131 characters long, it will truncate it.

Steps to reproduce the problem:
1. Unzip MonoBug.7z
2. Follow ReadMe.txt inside unzipped folder


Actual Results:
Running on OpenSUSE 11.0:

<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">linux at linux</A>:~/testprograms/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName&gt;
mono MonoProcModuleFileNameBug.exe 

+-------------------------------------------------------------------------------------+

File Name from ProcModule:
/home/linux/testprograms/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoP&#37676;&#2095;&#27135;&#465;

File Name from Assembly:  
/home/linux/testprograms/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoProcModuleFileNameBugexe

+-------------------------------------------------------------------------------------+

.. (More unnecessary output)

Running on MVL (Monta Vista Linux) 5.0:

tngo@(none):~/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName$
mono MonoProcModuleFileNameBug.exe 
+-------------------------------------------------------------------------------------+
File Name from ProcModule:
/home/tngo/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoProcModuleFileN??
File Name from Assembly:  
/home/tngo/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoProcModuleFileNameBug.exe
+-------------------------------------------------------------------------------------+

.. (More unnecessary output)

Expected Results:

Expected for OpenSUSE 11.0:


<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">linux at linux</A>:~/testprograms/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName&gt;
mono MonoProcModuleFileNameBug.exe 

+-------------------------------------------------------------------------------------+

File Name from ProcModule:
/home/linux/testprograms/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoProcModuleFileNameBugexe

File Name from Assembly:  
/home/linux/testprograms/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoProcModuleFileNameBugexe

+-------------------------------------------------------------------------------------+

Expected for MVL (Monta Vista Linux) 5.0:

tngo@(none):~/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName$
mono MonoProcModuleFileNameBug.exe 
+-------------------------------------------------------------------------------------+
File Name from ProcModule:
/home/tngo/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoProcModuleFileNameBug.exe
File Name from Assembly:  
/home/tngo/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName/MonoProcModuleFileNameBug.exe
+-------------------------------------------------------------------------------------+

On .NET Windows, it works totally fine, running on top of Mono or Microsoft
NET CLR.


How often does this happen? 

Happens all the time.  It looks like some sort of buffer overflow, because
sometimes it crashes like this:

tngo@(none):~/MonoSystemDiagnosticBug/ReallyReallyReallyReallyReallyReallyReallyReallyReallyLongLongDirectoryName$
mono MonoProcModuleFileNameBug.exe 

** ERROR **: file strenc.c: line 182 (mono_unicode_to_external): assertion
failed: (utf8!=NULL)
aborting...
Stacktrace:

  at (wrapper managed-to-native) System.Diagnostics.Process.GetModules_internal
(intptr) &lt;0x00004&gt;
  at (wrapper managed-to-native) System.Diagnostics.Process.GetModules_internal
(intptr) &lt;0xffffffff&gt;
  at System.Diagnostics.Process.get_Modules () &lt;0x00020&gt;
  at (wrapper remoting-invoke-with-check)
System.Diagnostics.Process.get_Modules () &lt;0xffffffff&gt;
  at MonoProcModuleFileNameBug.Program.Main (string[]) &lt;0x0002f&gt;
  at (wrapper runtime-invoke)
MonoProcModuleFileNameBug.Program.runtime_invoke_void_string[]
(object,intptr,intptr,intptr) &lt;0xffffffff&gt;

Native stacktrace:

        mono [0x806b2e3]
        [0xb7eee440]
        /lib/libc.so.6(abort+0x107) [0xb7d297c7]
        /usr/lib/libglib-2.0.so.0 [0xb7e93fab]
        /usr/lib/libglib-2.0.so.0(g_log+0x1e) [0xb7e93fce]
        /usr/lib/libglib-2.0.so.0(g_assert_warning+0x53) [0xb7e94033]
        mono [0x814d24b]
        mono [0x81b4cfe]
        mono [0x81b4eeb]
        mono [0x81ac86a]
        mono [0x81acf26]
        [0xb7a5d95a]
        [0xb7a5d8b9]
        [0xb7a5d85f]
        [0xb7a5d248]
        [0xb7a5d1b3]
        mono(mono_runtime_exec_main+0xc9) [0x80fd4a9]
        mono(mono_runtime_run_main+0x170) [0x80fe780]
        mono(mono_main+0x1290) [0x805a9b0]
        mono [0x80591bd]
        /lib/libc.so.6(__libc_start_main+0xd0) [0xb7d15f80]
        mono [0x8059111]
Failed to read a valid object file image from memory.

Debug info from gdb:

Using host libthread_db library &quot;/lib/libthread_db.so.1&quot;.
0xb7db2f02 in syscall () from /lib/libc.so.6

=================================================================
Got a SIGABRT while executing native code. This usually indicates
a fatal error in the mono runtime or one of the native libraries 
used by your application.
=================================================================


Additional Information:

Attached below will be the entire output of the executed programs on:

1. Mono on OpenSUSE 11.0
2. Mono on MVL 5.0
3. Mono on Windows XP 32
4. Microsoft .NET CLR on Windows XP 32

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>










































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="085629.html">[Mono-bugs] [Bug 471292] Random.Next(Int32.MinValue, Int32.MaxValue) does not generate all numbers
</A></li>
	<LI>Next message: <A HREF="085631.html">[Mono-bugs] [Bug 473131] System.Diagnostic.ProcModule.FileName truncates the file name if it is too long
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85630">[ date ]</a>
              <a href="thread.html#85630">[ thread ]</a>
              <a href="subject.html#85630">[ subject ]</a>
              <a href="author.html#85630">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
