<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 82815][Nor] New - Duplicate key in XslTransform
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2082815%5D%5BNor%5D%20New%20-%20Duplicate%20key%20in%20XslTransform&In-Reply-To=bug-82815%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="061473.html">
   <LINK REL="Next"  HREF="061475.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 82815][Nor] New - Duplicate key in XslTransform</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2082815%5D%5BNor%5D%20New%20-%20Duplicate%20key%20in%20XslTransform&In-Reply-To=bug-82815%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 82815][Nor] New - Duplicate key in XslTransform">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Wed Sep 12 05:02:12 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="061473.html">[Mono-bugs] [Bug 82814][Blo] New - Cannot distinguish	CustomAttribute values that are Types from Strings
</A></li>
        <LI>Next message: <A HREF="061475.html">[Mono-bugs] [Bug 82244][Nor] Changed - Message Box popup preventing	continuation of execution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61474">[ date ]</a>
              <a href="thread.html#61474">[ thread ]</a>
              <a href="subject.html#61474">[ subject ]</a>
              <a href="author.html#61474">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">informatique.internet at fiducial.fr.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=82815">http://bugzilla.ximian.com/show_bug.cgi?id=82815</A>

--- shadow/82815	2007-09-12 05:02:12.000000000 -0400
+++ shadow/82815.tmp.16464	2007-09-12 05:02:12.000000000 -0400
@@ -0,0 +1,351 @@
+Bug#: 82815
+Product: Mono: Class Libraries
+Version: 1.2
+OS: 
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Normal
+Component: Sys.XML
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">informatique.internet at fiducial.fr</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: Duplicate key in XslTransform
+
+Description of Problem:
+We are trying to transform an xml file to an xml office file using an xslt
+written by microsoft. It works well with MS.NET 1.1 and also with libxslt
+(xsltproc) but it fails on mono
+
+Steps to reproduce the problem:
+1. 
+Try this program
+// project created on 12/09/2007 at 09:52
+using System;
+using System.IO;
+using System.Data;
+using System.Xml;
+
+using System.Xml.Xsl;
+
+using System.Xml.XPath;
+
+namespace TestXSL
+{
+	class MainClass
+	{
+		public static void Main(string[] args)
+		{
+			DataSet ds = new DataSet();
+			FileStream fs=new FileStream(&quot;./output.xml&quot;,FileMode.Create);
+
+			ds.ReadXml(&quot;../../Users_new.xml&quot;);
+			ds.EnforceConstraints=false;
+
+			XmlDataDocument xdd = new XmlDataDocument(ds);
+
+			XslTransform xt = new XslTransform();
+
+			xt.Load(&quot;../../Excel.xsl&quot;);
+
+			xt.Transform(xdd, null, fs);
+		}
+	}
+}
+2. With Users_new.xml
+&amp;#65279;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;stats&gt;
+&lt;Utilisateurs  type=&quot;NeverConnected&quot; date=&quot;11/09/2007 10:43:17&quot;&gt;
+	&lt;line num=&quot;1&quot;&gt;
+		&lt;user_id&gt;5e10f344-1470-4978-b440-7b8fe678cae1&lt;/user_id&gt;
+		&lt;number&gt;000575&lt;/number&gt;
+		&lt;gender&gt;M.&lt;/gender&gt;
+		&lt;name&gt;Bidon&lt;/name&gt;
+		&lt;first_name&gt;Gerard&lt;/first_name&gt;
+		&lt;budget_code&gt;64900&lt;/budget_code&gt;
+		&lt;budget_label&gt;D.R./PAU&lt;/budget_label&gt;
+		&lt;date_creation&gt;16/04/2007 10:09:34&lt;/date_creation&gt;
+	&lt;/line&gt;
+	&lt;/Utilisateurs&gt;
+&lt;/stats&gt;
+3. 
+&lt;?xml version=&quot;1.0&quot;?&gt;
+
+
+
+&lt;xsl:stylesheet version=&quot;1.0&quot;
+
+    xmlns=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;
+
+    xmlns:xsl=&quot;<A HREF="http://www.w3.org/1999/XSL/Transform&quot;">http://www.w3.org/1999/XSL/Transform&quot;</A> 
+
+ xmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot;
+
+ xmlns:user=&quot;urn:my-scripts&quot;
+
+ xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;
+
+ xmlns:x=&quot;urn:schemas-microsoft-com:office:excel&quot;
+
+ xmlns:ss=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot; &gt; 
+
+ 
+
+&lt;xsl:template match=&quot;/&quot;&gt;
+
+  &lt;Workbook xmlns=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;
+
+    xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;
+
+    xmlns:x=&quot;urn:schemas-microsoft-com:office:excel&quot;
+
+    xmlns:ss=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;
+
+    xmlns:html=&quot;<A HREF="http://www.w3.org/TR/REC-html40&quot;">http://www.w3.org/TR/REC-html40&quot;</A>&gt;
+
+    &lt;xsl:apply-templates/&gt;
+
+
+
+ &lt;Styles&gt;
+
+  &lt;Style ss:ID=&quot;Default&quot; ss:Name=&quot;Normal&quot;&gt;
+
+   &lt;Alignment ss:Vertical=&quot;Bottom&quot;/&gt;
+
+   &lt;Borders/&gt;
+
+   &lt;Font/&gt;
+
+   &lt;Interior/&gt;
+
+   &lt;NumberFormat/&gt;
+
+   &lt;Protection/&gt;
+
+  &lt;/Style&gt;
+
+  &lt;Style ss:ID=&quot;s21&quot;&gt;
+
+   &lt;Font ss:Bold=&quot;1&quot;/&gt;
+
+   &lt;Alignment ss:Horizontal=&quot;Center&quot; ss:Vertical=&quot;Bottom&quot;/&gt;
+
+  &lt;/Style&gt;
+
+  &lt;Style ss:ID=&quot;s22&quot;&gt;
+
+   &lt;Alignment ss:Horizontal=&quot;Center&quot; ss:Vertical=&quot;Bottom&quot;/&gt;
+
+   &lt;Font ss:Bold=&quot;1&quot;/&gt;
+
+   &lt;Interior ss:Color=&quot;#99CCFF&quot; ss:Pattern=&quot;Solid&quot;/&gt;
+
+  &lt;/Style&gt;
+
+ &lt;/Styles&gt;
+
+  &lt;/Workbook&gt;
+
+&lt;/xsl:template&gt;
+
+
+
+&lt;xsl:template match=&quot;/*/*&quot;&gt;
+
+  &lt;Worksheet&gt;
+
+  &lt;xsl:attribute name=&quot;ss:Name&quot;&gt;
+
+  &lt;xsl:value-of select=&quot;local-name(/*/*)&quot;/&gt;
+
+  &lt;/xsl:attribute&gt;
+
+    &lt;Table x:FullColumns=&quot;1&quot; x:FullRows=&quot;1&quot;&gt;
+
+     &lt;Row&gt;
+
+        &lt;xsl:for-each select=&quot;*[position() = 1]/*&quot;&gt;
+
+          &lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data ss:Type=&quot;String&quot;&gt;
+
+          &lt;xsl:value-of select=&quot;local-name()&quot;/&gt;
+
+          &lt;/Data&gt;&lt;/Cell&gt;
+
+        &lt;/xsl:for-each&gt;
+
+      &lt;/Row&gt;
+
+      &lt;xsl:apply-templates/&gt;
+
+    &lt;/Table&gt;
+
+  &lt;/Worksheet&gt;
+
+&lt;/xsl:template&gt;
+
+
+
+
+
+&lt;xsl:template match=&quot;/*/*/*&quot;&gt;
+
+  &lt;Row&gt;
+
+    &lt;xsl:apply-templates/&gt;
+
+  &lt;/Row&gt;
+
+&lt;/xsl:template&gt;
+
+
+
+
+
+&lt;xsl:template match=&quot;/*/*/*/*&quot;&gt;
+
+  &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;
+
+    &lt;xsl:value-of select=&quot;.&quot;/&gt;
+
+  &lt;/Data&gt;&lt;/Cell&gt;
+
+&lt;/xsl:template&gt;
+
+
+
+
+
+&lt;/xsl:stylesheet&gt;
+Actual Results:
+Unhandled Exception: System.ArgumentException: key
+Parameter name: Duplicate key in add.
+  at System.Collections.Specialized.ListDictionary.Add (System.Object key,
+System.Object value) [0x00029] in
+/home/hubert/mono/mcs/class/System/System.Collections.Specialized/ListDictionary.cs:191
+
+  at Mono.Xml.Xsl.GenericOutputter.CheckState () [0x001b6] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl/GenericOutputter.cs:203 
+  at Mono.Xml.Xsl.GenericOutputter.WriteStartElement (System.String prefix,
+System.String localName, System.String nsURI) [0x0009f] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl/GenericOutputter.cs:246 
+  at Mono.Xml.Xsl.Operations.XslLiteralElement.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x0003e] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslLiteralElement.cs:127
+
+  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x00047] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslTemplateContent.cs:199
+
+  at Mono.Xml.Xsl.Operations.XslLiteralElement.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x000f6] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslLiteralElement.cs:141
+
+  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x00047] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslTemplateContent.cs:199
+
+  at Mono.Xml.Xsl.Operations.XslLiteralElement.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x000f6] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslLiteralElement.cs:141
+
+  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x00047] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslTemplateContent.cs:199
+
+  at Mono.Xml.Xsl.Operations.XslLiteralElement.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x000f6] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslLiteralElement.cs:141
+
+  at Mono.Xml.Xsl.Operations.XslTemplateContent.Evaluate
+(Mono.Xml.Xsl.XslTransformProcessor p) [0x00047] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl.Operations/XslTemplateContent.cs:199
+
+  at Mono.Xml.Xsl.XslTemplate.EvaluateCore
+(Mono.Xml.Xsl.XslTransformProcessor p, System.Collections.Hashtable
+withParams) [0x000e1] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl/XslTemplate.cs:415 
+  at Mono.Xml.Xsl.XslTemplate.Evaluate (Mono.Xml.Xsl.XslTransformProcessor
+p, System.Collections.Hashtable withParams) [0x0004c] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl/XslTemplate.cs:384 
+  at Mono.Xml.Xsl.XslTransformProcessor.ApplyTemplates
+(System.Xml.XPath.XPathNodeIterator nodes, System.Xml.XmlQualifiedName
+mode, System.Collections.ArrayList withParams) [0x0002e] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl/XslTransformProcessor.cs:252
+
+  at Mono.Xml.Xsl.XslTransformProcessor.Process
+(System.Xml.XPath.XPathNavigator root, Mono.Xml.Xsl.Outputter outputtter,
+System.Xml.Xsl.XsltArgumentList args, System.Xml.XmlResolver resolver)
+[0x00164] in
+/home/hubert/mono/mcs/class/System.XML/Mono.Xml.Xsl/XslTransformProcessor.cs:112
+
+  at System.Xml.Xsl.XslTransform.Transform (System.Xml.XPath.XPathNavigator
+input, System.Xml.Xsl.XsltArgumentList args, System.IO.TextWriter output,
+System.Xml.XmlResolver resolver) [0x0002f] in
+/home/hubert/mono/mcs/class/System.XML/System.Xml.Xsl/XslTransform.cs:237 
+  at System.Xml.Xsl.XslTransform.Transform (System.Xml.XPath.XPathNavigator
+input, System.Xml.Xsl.XsltArgumentList args, System.IO.Stream output,
+System.Xml.XmlResolver resolver) [0x0001b] in
+/home/hubert/mono/mcs/class/System.XML/System.Xml.Xsl/XslTransform.cs:216 
+  at System.Xml.Xsl.XslTransform.Transform (IXPathNavigable input,
+System.Xml.Xsl.XsltArgumentList args, System.IO.Stream output) [0x00000] in
+/home/hubert/mono/mcs/class/System.XML/System.Xml.Xsl/XslTransform.cs:151 
+  at TestXSL.MainClass.Main (System.String[] args) [0x0003d] in
+/home/hubert/Projects/TestXSL/TestXSL/Main.cs:22 
+
+
+
+Expected Results:
+output.xml :
+
+&lt;?xml version=&quot;1.0&quot;?&gt;
+&lt;Workbook xmlns=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;
+xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;
+xmlns:x=&quot;urn:schemas-microsoft-com:office:excel&quot;
+xmlns:ss=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;
+xmlns:html=&quot;<A HREF="http://www.w3.org/TR/REC-html40&quot;">http://www.w3.org/TR/REC-html40&quot;</A>
+xmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot; xmlns:user=&quot;urn:my-scripts&quot;&gt;
+&lt;Worksheet ss:Name=&quot;Utilisateurs&quot;&gt;&lt;Table x:FullColumns=&quot;1&quot;
+x:FullRows=&quot;1&quot;&gt;&lt;Row&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;user_id&lt;/Data&gt;&lt;/Cell&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;number&lt;/Data&gt;&lt;/Cell&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;gender&lt;/Data&gt;&lt;/Cell&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;name&lt;/Data&gt;&lt;/Cell&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;first_name&lt;/Data&gt;&lt;/Cell&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;budget_code&lt;/Data&gt;&lt;/Cell&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;budget_label&lt;/Data&gt;&lt;/Cell&gt;&lt;Cell ss:StyleID=&quot;s22&quot;&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;date_creation&lt;/Data&gt;&lt;/Cell&gt;&lt;/Row&gt;
+        &lt;Row&gt;
+                &lt;Cell&gt;&lt;Data
+ss:Type=&quot;String&quot;&gt;5e10f344-1470-4978-b440-7b8fe678cae1&lt;/Data&gt;&lt;/Cell&gt;
+                &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;000575&lt;/Data&gt;&lt;/Cell&gt;
+                &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;M.&lt;/Data&gt;&lt;/Cell&gt;
+                &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;Tripoli&lt;/Data&gt;&lt;/Cell&gt;
+                &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;Gerard&lt;/Data&gt;&lt;/Cell&gt;
+                &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;64900&lt;/Data&gt;&lt;/Cell&gt;
+                &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;D.R./PAU&lt;/Data&gt;&lt;/Cell&gt;
+                &lt;Cell&gt;&lt;Data ss:Type=&quot;String&quot;&gt;16/04/2007 10:09:34&lt;/Data&gt;&lt;/Cell&gt;
+        &lt;/Row&gt;
+        &lt;/Table&gt;&lt;/Worksheet&gt;
+&lt;Styles&gt;&lt;Style ss:ID=&quot;Default&quot; ss:Name=&quot;Normal&quot;&gt;&lt;Alignment
+ss:Vertical=&quot;Bottom&quot;/&gt;&lt;Borders/&gt;&lt;Font/&gt;&lt;Interior/&gt;&lt;NumberFormat/&gt;&lt;Protection/&gt;&lt;/Style&gt;&lt;Style
+ss:ID=&quot;s21&quot;&gt;&lt;Font ss:Bold=&quot;1&quot;/&gt;&lt;Alignment ss:Horizontal=&quot;Center&quot;
+ss:Vertical=&quot;Bottom&quot;/&gt;&lt;/Style&gt;&lt;Style ss:ID=&quot;s22&quot;&gt;&lt;Alignment
+ss:Horizontal=&quot;Center&quot; ss:Vertical=&quot;Bottom&quot;/&gt;&lt;Font ss:Bold=&quot;1&quot;/&gt;&lt;Interior
+ss:Color=&quot;#99CCFF&quot; ss:Pattern=&quot;Solid&quot;/&gt;&lt;/Style&gt;&lt;/Styles&gt;&lt;/Workbook&gt;
+
+How often does this happen? 
+always
+
+Additional Information:
+Please note that it seems that the bug comes from duplicate namespace name
+:  xmlns=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;
+and xmlns:ss=&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;
+anyway the xslt style sheet seems to be well formated...
+
+Thanks
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="061473.html">[Mono-bugs] [Bug 82814][Blo] New - Cannot distinguish	CustomAttribute values that are Types from Strings
</A></li>
	<LI>Next message: <A HREF="061475.html">[Mono-bugs] [Bug 82244][Nor] Changed - Message Box popup preventing	continuation of execution
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61474">[ date ]</a>
              <a href="thread.html#61474">[ thread ]</a>
              <a href="subject.html#61474">[ subject ]</a>
              <a href="author.html#61474">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
