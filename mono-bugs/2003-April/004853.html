<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 41974][Cos] New - Illegal ArgumentNullException throw for the dynamic creation of object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40rocky.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="004852.html">
   <LINK REL="Next"  HREF="004854.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 41974][Cos] New - Illegal ArgumentNullException throw for the dynamic creation of object
   </H1>
    <B>bugzilla-daemon@rocky.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40rocky.ximian.com"
       TITLE="[Mono-bugs] [Bug 41974][Cos] New - Illegal ArgumentNullException throw for the dynamic creation of object">bugzilla-daemon@rocky.ximian.com
       </A><BR>
    <I>Sat, 26 Apr 2003 15:05:43 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="004852.html">[Mono-bugs] [Bug 41973][Cri] Changed - mini aborts a program that mono can run
</A></li>
        <LI> Next message: <A HREF="004854.html">[Mono-bugs] [Bug 41457][Blo] Changed - mcs compilation fail when we use overloaded function with out param from another assembly - sample inside the description
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4853">[ date ]</a>
              <a href="thread.html#4853">[ thread ]</a>
              <a href="subject.html#4853">[ subject ]</a>
              <a href="author.html#4853">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:gfr@skynet.be.">gfr@skynet.be.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=41974">http://bugzilla.ximian.com/show_bug.cgi?id=41974</A>

--- shadow/41974	Sat Apr 26 15:05:43 2003
+++ shadow/41974.tmp.26156	Sat Apr 26 15:05:43 2003
@@ -0,0 +1,75 @@
+Bug#: 41974
+Product: Mono/Class Libraries
+Version: unspecified
+OS: Red Hat 8.0
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: 001 One hour
+Priority: Cosmetic
+Component: CORLIB
+AssignedTo: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>                            
+ReportedBy: <A HREF="mailto:gfr@skynet.be">gfr@skynet.be</A>               
+QAContact: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>
+TargetMilestone: ---
+URL: 
+Summary: Illegal ArgumentNullException throw for the dynamic creation of object 
+
+When invoking the creation of one object by a reflection way. I Call
+
+  System.Type type = typeof (MyClass);
+  type.InvokeMember (null,
+     System.Reflection.BindingFlags.Default | 
+System.Reflection.BindingFlags.CreateInstance,
+     null,
+     null,
+     constructorArguments);
+
+This call is propagate until the class mcs/class/corlib/System/MonoType.cs
+as we could see inside the exception stack trace :
+
+  Unhandled Exception: System.ArgumentNullException: Argument cannot be 
+null
+  Parameter name: name
+  in &lt;0x001c2&gt; 00 System.MonoType:InvokeMember 
+(string,System.Reflection.BindingFlags,System.Reflection.Binder,object,obj
+ect[],System.Reflection.ParameterModifier
+[],System.Globalization.CultureInfo,string[])
+  in &lt;0x0002f&gt; 00 System.Type:InvokeMember 
+(string,System.Reflection.BindingFlags,System.Reflection.Binder,object,obj
+ect[])
+
+The method InvokeMember does not allow a null value for the method call
+at the parameter called 'name' but when we use the Binding flags for the 
+creation, this method must not throw a ArgumentNullException. 
+
+The argument check value must be place below after the following block of 
+code and not at the start of the method in order to be compliant with the 
+Microsoft Corlib.
+
+  if ((invokeAttr &amp; BindingFlags.CreateInstance) != 0) {
+    /* the name is ignored */
+    invokeAttr |= BindingFlags.DeclaredOnly;
+    ConstructorInfo[] ctors = GetConstructors (invokeAttr);
+    object state = null;
+    MethodBase ctor = binder.BindToMethod (invokeAttr, ctors, ref args, 
+modifiers, culture, namedParameters, out state);
+    if (ctor == null)
+      throw new MissingMethodException ();
+    object result = ctor.Invoke (target, invokeAttr, binder, args, 
+culture);
+    binder.ReorderArgumentArray (ref args, state);
+    return result;
+  }
+
+We could remark that the name could have a null value. Moreover, when we 
+enter inside the 'Then' sequence we always return from the InvokeMember 
+etheir by an exception or by a return instruction.
+
+Now, i've call the Type.InvokeMember (...) with a System.String.Empty 
+value for the name argument to work around this problem. But it could be 
+annoying for some program porting to find this problem except if 
+a 'porting how-to' exist.
+
+Best regards,
+Gilles

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="004852.html">[Mono-bugs] [Bug 41973][Cri] Changed - mini aborts a program that mono can run
</A></li>
	<LI> Next message: <A HREF="004854.html">[Mono-bugs] [Bug 41457][Blo] Changed - mcs compilation fail when we use overloaded function with out param from another assembly - sample inside the description
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4853">[ date ]</a>
              <a href="thread.html#4853">[ thread ]</a>
              <a href="subject.html#4853">[ subject ]</a>
              <a href="author.html#4853">[ author ]</a>
         </LI>
       </UL>
</body></html>
