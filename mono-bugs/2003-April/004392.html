<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 40646][Maj] New - mcs doesn't parse correctly array initializers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40rocky.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="004387.html">
   <LINK REL="Next"  HREF="004393.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 40646][Maj] New - mcs doesn't parse correctly array initializers
   </H1>
    <B>bugzilla-daemon@rocky.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40rocky.ximian.com"
       TITLE="[Mono-bugs] [Bug 40646][Maj] New - mcs doesn't parse correctly array initializers">bugzilla-daemon@rocky.ximian.com
       </A><BR>
    <I>Tue,  1 Apr 2003 19:18:59 -0500 (EST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="004387.html">[Mono-bugs] [Bug 40645][Nor] New - Passing class as an out parameter to pinvoke doesn't work
</A></li>
        <LI> Next message: <A HREF="004393.html">[Mono-bugs] [Bug 40646][Maj] Changed - mcs doesn't parse correctly array initializers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4392">[ date ]</a>
              <a href="thread.html#4392">[ thread ]</a>
              <a href="subject.html#4392">[ subject ]</a>
              <a href="author.html#4392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:eureko@grmexico.com.mx.">eureko@grmexico.com.mx.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=40646">http://bugzilla.ximian.com/show_bug.cgi?id=40646</A>

--- shadow/40646	Tue Apr  1 19:18:59 2003
+++ shadow/40646.tmp.32754	Tue Apr  1 19:18:59 2003
@@ -0,0 +1,142 @@
+Bug#: 40646
+Product: Mono/MCS
+Version: unspecified
+OS: Mandrake 9.0
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Major
+Component: Misc
+AssignedTo: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>                            
+ReportedBy: <A HREF="mailto:eureko@grmexico.com.mx">eureko@grmexico.com.mx</A>               
+QAContact: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: mcs doesn't parse correctly array initializers
+
+/*
+BUG REPORT
+
+Summary:
+--------
+mcs doesn't parse correctly array initializers
+
+Bug description:
+----------------
+mono drops at runtime: CRITICAL **: file metadata.c: line 785
+(mono_metadata_blob_heap): assertion index &lt; meta-&gt;heap_blob.size' failed
+The same program compiled with csc runs ok (linux and windows), but
+compiled with mcs it breaks with this error.
+
+The bug can be reproduced with the source code provided.
+
+Actual Results:
+-----------------------------
+Bidimensional array of Friend
+
+
+** (bugfound-mcs-linux.exe:1680): CRITICAL **: file metadata.c: line 785
+(mono_metadata_blob_heap): assertion index &lt; meta-&gt;heap_blob.size' failed
+
+** ERROR **: type 0x3d not handled in mono_metadata_parse_type
+aborting...
+Aborted
+
+
+Expected Results:
+-----------------------------
+Bidimensional array of Friend
+
+i = 0; j = 0; Pa (66 years old)
+i = 0; j = 1; Miguel (26 years old)
+i = 1; j = 0; Pepe (28 years old)
+i = 1; j = 1; unknown (-1 years old)
+i = 2; j = 0; Oscar (27 years old)
+i = 2; j = 1; unknown (-1 years old)
+i = 3; j = 0; unknown (-1 years old)
+i = 3; j = 1; unknown (-1 years old)
+
+
+How often does this happen? 
+---------------------------
+Always running this program
+
+
+Additional Information:
+-----------------------
+I think mcs doesn't parse ok the array initializers like this one:
+	friends = new Friend[4, 2] {
+		{ new Friend(&quot;Pa&quot;, 66), new Friend(&quot;Miguel&quot;, 26) },
+		{ new Friend(&quot;Pepe&quot;, 28), new Friend() },
+		{ new Friend(&quot;Oscar&quot;, 27), new Friend() },
+		{ new Friend(), new Friend() }
+	};
+Running the mcs generated image with the .net runtime,
+it says that the index is out of bounds, but the same code runs ok
+if it is compiled with csc.
+Unfortunately, I can only use mcs on linux, since my win is 98, and
+no updated version of mono runs over that.
+
+*/
+
+using System;
+
+namespace Eureko.Samples {
+	class ArraysApp {
+		public static void Main() {
+			Bidimensional bidimArray = new Bidimensional();
+			
+			Console.WriteLine(&quot;\n-----------------------------&quot;);
+			Console.WriteLine(&quot;Bidimensional array of Friend\n&quot;);
+			bidimArray.DisplayResults();
+		}
+	}
+	
+	class Friend {
+		public Friend(string friendname, int friendage) {
+			name = friendname;
+			age = friendage;
+		}
+		
+		public Friend() {
+			name = &quot;unknown&quot;;
+			age = -1;
+		}
+		
+		protected string name;
+		public string Name {
+			get { return name; }
+			set { name = value; }
+		}
+		
+		protected int age;
+		public int Age {
+			get { return age; }
+			set { age = value; }
+		}
+	}
+	
+	class Bidimensional {
+		protected Friend[,] friends;
+		
+		public void DisplayResults() {
+			for(int i = 0; i&lt;friends.GetLength(0); i++)
+				for(int j = 0; j&lt;friends.GetLength(1); j++) {
+					Console.Write(&quot;i = {0}; j = {1}; &quot;, i, j);
+					Console.WriteLine(((Friend) friends[i, j]).Name + &quot; ({0} years old)&quot;,
+((Friend) friends[i, j]).Age);
+				}
+		}
+		
+		public Bidimensional() {
+			friends = new Friend[4, 2] {
+				{ new Friend(&quot;Pa&quot;, 66), new Friend(&quot;Miguel&quot;, 26) },
+				{ new Friend(&quot;Pepe&quot;, 28), new Friend() },
+				{ new Friend(&quot;Oscar&quot;, 27), new Friend() },
+				{ new Friend(), new Friend() }
+			};
+		}
+	}
+}

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="004387.html">[Mono-bugs] [Bug 40645][Nor] New - Passing class as an out parameter to pinvoke doesn't work
</A></li>
	<LI> Next message: <A HREF="004393.html">[Mono-bugs] [Bug 40646][Maj] Changed - mcs doesn't parse correctly array initializers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4392">[ date ]</a>
              <a href="thread.html#4392">[ thread ]</a>
              <a href="subject.html#4392">[ subject ]</a>
              <a href="author.html#4392">[ author ]</a>
         </LI>
       </UL>
</body></html>
