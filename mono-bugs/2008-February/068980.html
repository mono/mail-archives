<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 359561] New: Gtk does a lot of boxing because it uses .NET 1.1 code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20359561%5D%20New%3A%20Gtk%20does%20a%20lot%20of%20boxing%20because%20it%0A%20uses%20.NET%201.1%20code&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="068978.html">
   <LINK REL="Next"  HREF="068981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 359561] New: Gtk does a lot of boxing because it uses .NET 1.1 code</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20359561%5D%20New%3A%20Gtk%20does%20a%20lot%20of%20boxing%20because%20it%0A%20uses%20.NET%201.1%20code&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 359561] New: Gtk does a lot of boxing because it uses .NET 1.1 code">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Feb  7 08:53:36 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="068978.html">[Mono-bugs] [Bug 345931] GradientBrush.ColorInterpolationMode is	ignored
</A></li>
        <LI>Next message: <A HREF="068981.html">[Mono-bugs] [Bug 359561] Gtk does a lot of boxing because it uses	.NET 1.1 code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68980">[ date ]</a>
              <a href="thread.html#68980">[ thread ]</a>
              <a href="subject.html#68980">[ subject ]</a>
              <a href="author.html#68980">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=359561">https://bugzilla.novell.com/show_bug.cgi?id=359561</A>


           Summary: Gtk does a lot of boxing because it uses .NET 1.1 code
           Product: gtk#
           Version: unspecified
          Platform: i686
        OS/Version: Ubuntu
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: gtk-sharp
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">anders at iola.dk</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


While profiling Nemo, which uses Gtk, I saw the following:

Allocation profiler
Total mem Method
########################
   49536 KB GLib.SourceProxy::Remove()
       49433 KB  4218320 System.UInt32                                   
          57 KB     2944 System.Collections.ArrayList                    
  Callers (with count) that contribute at least for 1%:
        2944  100 % .TimeoutProxy::Handler()
########################

The top memory user is the GLib bindings, the snapshot is taken right after
starting up. Looking into the issue it appears that the
GLib.SourceProxy::Remove() function uses ArrayList for storing temporary values
and thus does boxing of the 4 million uints.

So I made trivial changes (attached) to Remove(), recompiled, and tada, 50mb
less allocated memory. 

########################
      59 KB GLib.SourceProxy::Remove()
          59 KB     3069 System.Collections.Generic.List`1               
  Callers (with count) that contribute at least for 1%:
        3069  100 % .TimeoutProxy::Handler()

I'm not familiar with how the GTK bindings work in detail, I guess a lot of the
code is generated by some tool? The change is only to one place in the code and
I'm sure there are lot of other places that could use the same treatment if the
bindings was converted to .NET 2.0 (gmcs).

So is there any reason why the GTK bindings still uses mcs?


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>

















































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="068978.html">[Mono-bugs] [Bug 345931] GradientBrush.ColorInterpolationMode is	ignored
</A></li>
	<LI>Next message: <A HREF="068981.html">[Mono-bugs] [Bug 359561] Gtk does a lot of boxing because it uses	.NET 1.1 code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68980">[ date ]</a>
              <a href="thread.html#68980">[ thread ]</a>
              <a href="subject.html#68980">[ subject ]</a>
              <a href="author.html#68980">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
