<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 71274][Nor] Changed - finalizer-... tests randomly
	crash on x86 (Environment.Exit race)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2071274%5D%5BNor%5D%20Changed%20-%20finalizer-...%20tests%20randomly%0A%09crash%20on%20x86%20%28Environment.Exit%20race%29&In-Reply-To=bug-71274%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031296.html">
   <LINK REL="Next"  HREF="031298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 71274][Nor] Changed - finalizer-... tests randomly
	crash on x86 (Environment.Exit race)</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2071274%5D%5BNor%5D%20Changed%20-%20finalizer-...%20tests%20randomly%0A%09crash%20on%20x86%20%28Environment.Exit%20race%29&In-Reply-To=bug-71274%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 71274][Nor] Changed - finalizer-... tests randomly
	crash on x86 (Environment.Exit race)">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Fri Jul  1 14:49:55 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="031296.html">[Mono-bugs] [Bug 75429][Blo] Changed - [GMCS] &quot;Missing method&quot; for
	where-constraints
</A></li>
        <LI>Next message: <A HREF="031298.html">[Mono-bugs] [Bug 75432][Nor] Changed - GetPixel fails on 8bppIndex
	image, but works on MS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31297">[ date ]</a>
              <a href="thread.html#31297">[ thread ]</a>
              <a href="subject.html#31297">[ subject ]</a>
              <a href="author.html#31297">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bmaurer at users.sf.net.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=71274">http://bugzilla.ximian.com/show_bug.cgi?id=71274</A>

--- shadow/71274	2005-04-20 11:10:56.000000000 -0400
+++ shadow/71274.tmp.21091	2005-07-01 14:49:55.000000000 -0400
@@ -169,6 +169,265 @@
 Windows (which is what I would have expected).
 
 ------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">sebastien at ximian.com</A>  2005-04-20 11:10 -------
 Created an attachment (id=14982)
 timer2.cs
 
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bmaurer at users.sf.net</A>  2005-07-01 14:49 -------
+Running the test case from miguel, i got an assert in the critical
+section code. Got the following backtrace:
+
+** ERROR **: file critical-sections.c: line 89
+(DeleteCriticalSection): assertion failed: (ret == 0)
+aborting...
+
+Program received signal SIGABRT, Aborted.
+
+
+Thread 1 (Thread 1075853088 (LWP 13105)):
+#0  0xffffe410 in ?? ()
+#1  0xbfffd1ec in ?? ()
+#2  0x00000006 in ?? ()
+#3  0x00003331 in ?? ()
+#4  0x40116501 in raise () from /lib/tls/libc.so.6
+#5  0x40117cd9 in abort () from /lib/tls/libc.so.6
+#6  0x4005f2a8 in g_logv () from /opt/gnome/lib/libglib-2.0.so.0
+#7  0x4005f2e2 in g_log () from /opt/gnome/lib/libglib-2.0.so.0
+#8  0x080ef307 in DeleteCriticalSection (section=0x21f04) at
+critical-sections.c:90
+#9  0x0808b685 in mono_domain_free (domain=0x21f00, force=1) at
+domain.c:895
+#10 0x0810bb68 in mini_cleanup (domain=0x21f00) at mini.c:10186
+#11 0x080ab438 in mono_runtime_quit () at appdomain.c:206
+#12 0x080d027f in ves_icall_System_Environment_Exit (result=0) at
+icall.c:5358
+#13 0x409da12d in ?? ()
+#14 0x00000000 in ?? ()
+#15 0x081b4908 in ?? ()
+#16 0x081b48f0 in ?? ()
+#17 0x081f50b8 in ?? ()
+#18 0x00047fc8 in ?? ()
+#19 0x00021cc0 in ?? ()
+#20 0x00021cc0 in ?? ()
+#21 0xbfffd864 in ?? ()
+#22 0x409da10c in ?? ()
+#23 0xbfffd87c in ?? ()
+#24 0x409d4a9c in ?? ()
+#25 0x00000000 in ?? ()
+#26 0x081f2ad0 in ?? ()
+#27 0x00000000 in ?? ()
+#28 0x409d4788 in ?? ()
+#29 0xbfffd8a8 in ?? ()
+#30 0x409d47b5 in ?? ()
+#31 0x0002ae10 in ?? ()
+#32 0x081ba838 in ?? ()
+#33 0x081f37a8 in ?? ()
+#34 0x081f3458 in ?? ()
+#35 0x00000000 in ?? ()
+#36 0x00000000 in ?? ()
+#37 0x409d4788 in ?? ()
+#38 0x081f2ad0 in ?? ()
+#39 0x00000000 in ?? ()
+#40 0xbfffd8d8 in ?? ()
+#41 0x08114f5a in mono_jit_runtime_invoke (method=0x21cc0,
+obj=0x21cc0, params=0x0, exc=0x0) at mini.c:9568
+(gdb) t a 2 bt
+
+Thread 2 (Thread 1084042160 (LWP 13106)):
+#0  0xffffe410 in ?? ()
+#1  0x409d2a98 in ?? ()
+#2  0x081a2008 in __JCR_LIST__ ()
+#3  0x00000000 in ?? ()
+#4  0x400bf716 in __nanosleep_nocancel () from /lib/tls/libpthread.so.0
+#5  0x080eb7fc in collection_thread (unused=0x0) at collection.c:36
+#6  0x400ba9ed in start_thread () from /lib/tls/libpthread.so.0
+#7  0x401a69ca in clone () from /lib/tls/libc.so.6
+#0  0xffffe410 in ?? ()
+(gdb) t a 242 bt
+
+Thread 242 (Thread 1088424880 (LWP 13346)):
+#0  0xffffe410 in ?? ()
+#1  0x40e007bc in ?? ()
+#2  0x00000000 in ?? ()
+#3  0x00000000 in ?? ()
+#4  0x400bc91c in pthread_cond_timedwait@@GLIBC_2.3.2 () from
+/lib/tls/libpthread.so.0
+#5  0x080f3404 in timedwait_signal_poll_cond (cond=0x404cc16c,
+mutex=0x404cc154, timeout=0x0) at handles.c:1251
+#6  0x080f3509 in _wapi_handle_timedwait_signal_handle
+(handle=0xfffffffc, timeout=0x0) at handles.c:1338
+#7  0x080f359b in _wapi_handle_wait_signal_handle (handle=0xfffffffc)
+at handles.c:1298
+#8  0x080f5ce2 in WaitForSingleObjectEx (handle=0x5f0,
+timeout=4294967295, alertable=0) at wait.c:179
+#9  0x080f6362 in WaitForSingleObject (handle=0xfffffffc,
+timeout=4294967292) at wait.c:235
+#10 0x080aa3dc in mono_thread_execute_interruption (thread=0x78d80) at
+threads.c:2518
+#11 0x080aa452 in mono_thread_interruption_checkpoint_request
+(bypass_abort_protection=0) at threads.c:2606
+#12 0x409d42e2 in ?? ()
+#13 0x40e00954 in ?? ()
+#14 0x081b7ad0 in ?? ()
+#15 0x081f2738 in ?? ()
+#16 0x000472a8 in ?? ()
+#17 0x00078cc0 in ?? ()
+#18 0x000005ea in ?? ()
+#19 0x40e0094c in ?? ()
+#20 0x409d42c4 in ?? ()
+#21 0x40e00974 in ?? ()
+#22 0x409d5583 in ?? ()
+#23 0x082045c0 in ?? ()
+#24 0x081b7ad0 in ?? ()
+#25 0x081fae30 in ?? ()
+#26 0x000472a8 in ?? ()
+#27 0x00078cc0 in ?? ()
+#28 0x00078cc0 in ?? ()
+#29 0x40e00974 in ?? ()
+#30 0x409d553c in ?? ()
+#31 0x40e0098c in ?? ()
+#32 0x409d502c in ?? ()
+#33 0x00078cc0 in ?? ()
+#34 0x000472a8 in ?? ()
+#35 0x00078cc0 in ?? ()
+#36 0x000472a8 in ?? ()
+#37 0x40e009b8 in ?? ()
+#38 0x409d56bc in ?? ()
+#39 0x00078cc0 in ?? ()
+#40 0x00000000 in ?? ()
+#41 0x00000000 in ?? ()
+#42 0x00000400 in ?? ()
+#43 0x00000000 in ?? ()
+#44 0x40e009c8 in ?? ()
+#45 0x00000000 in ?? ()
+#46 0x000472d0 in ?? ()
+#47 0x40e00a08 in ?? ()
+#48 0x40e009c8 in ?? ()
+---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
+#49 0x409d55c4 in ?? ()
+#50 0x00078d80 in ?? ()
+#51 0x08209670 in ?? ()
+#52 0x40e00a18 in ?? ()
+#53 0x080aa1cb in start_wrapper (data=0x78cc0) at threads.c:295
+Previous frame inner to this frame (corrupt stack?)
+#0  0xffffe410 in ?? ()
+(gdb) t a 243 bt
+
+Thread 243 (Thread 1091582896 (LWP 13347)):
+#0  0xffffe410 in ?? ()
+#1  0x411037bc in ?? ()
+#2  0x00000000 in ?? ()
+#3  0x00000000 in ?? ()
+#4  0x400bc91c in pthread_cond_timedwait@@GLIBC_2.3.2 () from
+/lib/tls/libpthread.so.0
+#5  0x080f3404 in timedwait_signal_poll_cond (cond=0x404cc1d8,
+mutex=0x404cc1c0, timeout=0x0) at handles.c:1251
+#6  0x080f3509 in _wapi_handle_timedwait_signal_handle
+(handle=0xfffffffc, timeout=0x0) at handles.c:1338
+#7  0x080f359b in _wapi_handle_wait_signal_handle (handle=0xfffffffc)
+at handles.c:1298
+#8  0x080f5ce2 in WaitForSingleObjectEx (handle=0x5f1,
+timeout=4294967295, alertable=0) at wait.c:179
+#9  0x080f6362 in WaitForSingleObject (handle=0xfffffffc,
+timeout=4294967292) at wait.c:235
+#10 0x080aa3dc in mono_thread_execute_interruption (thread=0x78cc0) at
+threads.c:2518
+#11 0x080aa452 in mono_thread_interruption_checkpoint_request
+(bypass_abort_protection=0) at threads.c:2606
+#12 0x409d42e2 in ?? ()
+#13 0x41103954 in ?? ()
+#14 0x081f52c0 in ?? ()
+#15 0x081f2738 in ?? ()
+#16 0x00047280 in ?? ()
+#17 0x00078c00 in ?? ()
+#18 0x000005ee in ?? ()
+#19 0x4110394c in ?? ()
+#20 0x409d42c4 in ?? ()
+#21 0x41103974 in ?? ()
+#22 0x409d5583 in ?? ()
+#23 0x08204360 in ?? ()
+#24 0x081f52c0 in ?? ()
+#25 0x081fae30 in ?? ()
+#26 0x00047280 in ?? ()
+#27 0x00078c00 in ?? ()
+#28 0x00078c00 in ?? ()
+#29 0x41103974 in ?? ()
+#30 0x409d553c in ?? ()
+#31 0x4110398c in ?? ()
+#32 0x409d502c in ?? ()
+#33 0x00078c00 in ?? ()
+#34 0x00047280 in ?? ()
+#35 0x00078c00 in ?? ()
+#36 0x00047280 in ?? ()
+#37 0x411039b8 in ?? ()
+#38 0x409d56bc in ?? ()
+#39 0x00078c00 in ?? ()
+#40 0x00000000 in ?? ()
+#41 0x00000000 in ?? ()
+#42 0x081f2738 in ?? ()
+#43 0x41103a08 in ?? ()
+#44 0x000472a8 in ?? ()
+#45 0x00000000 in ?? ()
+#46 0x000472a8 in ?? ()
+#47 0x41103a08 in ?? ()
+#48 0x411039c8 in ?? ()
+---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
+#49 0x409d55c4 in ?? ()
+#50 0x00078cc0 in ?? ()
+#51 0x08209670 in ?? ()
+#52 0x41103a18 in ?? ()
+#53 0x080aa1cb in start_wrapper (data=0x78c00) at threads.c:295
+Previous frame inner to this frame (corrupt stack?)
+#0  0xffffe410 in ?? ()
+(gdb) t a 246 bt
+
+Thread 246 (Thread 1086213040 (LWP 13350)):
+#0  0x40012a9a in strcmp () from /lib/ld-linux.so.2
+#1  0x40007e32 in do_lookup_x () from /lib/ld-linux.so.2
+#2  0x400080cc in _dl_lookup_symbol_x () from /lib/ld-linux.so.2
+#3  0x4000ce46 in fixup () from /lib/ld-linux.so.2
+#4  0x4000cc10 in _dl_runtime_resolve () from /lib/ld-linux.so.2
+#5  0x4004c2f0 in g_hash_table_lookup () from
+/opt/gnome/lib/libglib-2.0.so.0
+#6  0x08114a86 in mono_jit_compile_method_with_opt (method=0x81f7220,
+opt=65675) at mini.c:9432
+#7  0x080c7862 in mono_compile_method (method=0x805376d) at object.c:384
+#8  0x080a9f9f in ves_icall_System_Threading_Thread_Thread_internal
+(this=0x21a80, start=0x47f50) at threads.c:504
+#9  0x409d5561 in ?? ()
+#10 0x00021a80 in ?? ()
+#11 0x00047f50 in ?? ()
+#12 0x082073c0 in ?? ()
+#13 0x081fcfd0 in ?? ()
+#14 0x081fae30 in ?? ()
+#15 0x00047f50 in ?? ()
+#16 0x00021a80 in ?? ()
+#17 0x00021a80 in ?? ()
+#18 0x40be4974 in ?? ()
+#19 0x409d553c in ?? ()
+#20 0x40be498c in ?? ()
+#21 0x409d502c in ?? ()
+#22 0x00021a80 in ?? ()
+#23 0x00047f50 in ?? ()
+#24 0x00021a80 in ?? ()
+#25 0x00047f50 in ?? ()
+#26 0x40be49b8 in ?? ()
+#27 0x409d56bc in ?? ()
+#28 0x00021a80 in ?? ()
+#29 0x00000000 in ?? ()
+#30 0x00000000 in ?? ()
+#31 0x00000400 in ?? ()
+#32 0x00000000 in ?? ()
+#33 0x40be49c8 in ?? ()
+#34 0x00000000 in ?? ()
+#35 0x00047f78 in ?? ()
+#36 0x40be4a08 in ?? ()
+#37 0x40be49c8 in ?? ()
+#38 0x409d55c4 in ?? ()
+#39 0x00021b40 in ?? ()
+#40 0x08209670 in ?? ()
+#41 0x40be4a18 in ?? ()
+#42 0x080aa1cb in start_wrapper (data=0x21a80) at threads.c:295
+Previous frame inner to this frame (corrupt stack?)
+#0  0xffffe410 in ?? ()
+
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031296.html">[Mono-bugs] [Bug 75429][Blo] Changed - [GMCS] &quot;Missing method&quot; for
	where-constraints
</A></li>
	<LI>Next message: <A HREF="031298.html">[Mono-bugs] [Bug 75432][Nor] Changed - GetPixel fails on 8bppIndex
	image, but works on MS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31297">[ date ]</a>
              <a href="thread.html#31297">[ thread ]</a>
              <a href="subject.html#31297">[ subject ]</a>
              <a href="author.html#31297">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
