<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 621899] New: GC / memory leak in conjunction with F#, GC appears to lock-up in infinite loop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20621899%5D%20New%3A%20GC%20/%20memory%20leak%20in%20conjunction%20with%0A%20F%23%2C%20GC%20appears%20to%20lock-up%20in%20infinite%20loop&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="102131.html">
   <LINK REL="Next"  HREF="102133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 621899] New: GC / memory leak in conjunction with F#, GC appears to lock-up in infinite loop</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20621899%5D%20New%3A%20GC%20/%20memory%20leak%20in%20conjunction%20with%0A%20F%23%2C%20GC%20appears%20to%20lock-up%20in%20infinite%20loop&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 621899] New: GC / memory leak in conjunction with F#, GC appears to lock-up in infinite loop">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Jul 13 10:07:33 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="102131.html">[Mono-bugs] [Bug 609109] [Regression] Incoming tablular data stream (TDS) remote procedure call (RPC) protocal stream is incorrect.
</A></li>
        <LI>Next message: <A HREF="102133.html">[Mono-bugs] [Bug 621899] GC / memory leak in conjunction with F#, GC appears to lock-up in infinite loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102132">[ date ]</a>
              <a href="thread.html#102132">[ thread ]</a>
              <a href="subject.html#102132">[ subject ]</a>
              <a href="author.html#102132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=621899">http://bugzilla.novell.com/show_bug.cgi?id=621899</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=621899#c0">http://bugzilla.novell.com/show_bug.cgi?id=621899#c0</A>


           Summary: GC / memory leak in conjunction with F#, GC appears to
                    lock-up in infinite loop
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.6.x
          Platform: All
        OS/Version: Mac OS X 10.6
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: GC
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">jonathan.shore at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=375587)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=375587">http://bugzilla.novell.com/attachment.cgi?id=375587</A>)
Source and exe for test

User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; en-US)
AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.99 Safari/533.4

GC fails to clean up dereferenced dictionaries on each loop of a simple f#
based test.   Result is heap going to max, followed by sub-system (possibly GC)
going to 100% cpu indefinitely.   

Test is a loop that creates a dictionary 10 times and loads 1e6 elements on
each iteration.   Expectation is that the unused dictionary will be GC'ed post
iteration.

GC appears not to recognize the dictionary as garbage and/or may be a more
subtle problem with the interaction of GC and f# on mono.    This simple
program works as expected on MS.NET.

Program source and exe enclosed. 

Reproducible: Always

Steps to Reproduce:
1. Run attached program
2. heap size goes to 2 GB
3. depending on available memory, either throws out of memory exception or
sub-system loops infinitely at 100% cpu
Actual Results:  
- First 5 cycles of test run as expected (but with no GC on created and
discarded dictionary)
- On 6th cycle looks as if GC or subsystem goes to 100% cpu and nothing
progresses

- Jon Harrop reports that this program causes an out of memory exception on
Mono 2.4.   On 2.6 on my box it simply goes to 100 cpu indefinitely.

Expected Results:  
- the test should run to completion after 10 iterations
- on each iteration, GC should clean up the unreferenced dictionary (more or
less)
- heap size should not grow to max before GC kicks in

- suspect somehow the GC does not see the dictionaries as being garbage

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>









































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="102131.html">[Mono-bugs] [Bug 609109] [Regression] Incoming tablular data stream (TDS) remote procedure call (RPC) protocal stream is incorrect.
</A></li>
	<LI>Next message: <A HREF="102133.html">[Mono-bugs] [Bug 621899] GC / memory leak in conjunction with F#, GC appears to lock-up in infinite loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102132">[ date ]</a>
              <a href="thread.html#102132">[ thread ]</a>
              <a href="subject.html#102132">[ subject ]</a>
              <a href="author.html#102132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
