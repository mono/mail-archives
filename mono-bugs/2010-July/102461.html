<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 624914] New: InvalidCastException in get_AppSettings under xsp4 where it works under xsp2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20624914%5D%20New%3A%20InvalidCastException%20in%0A%20get_AppSettings%20under%20xsp4%20where%20it%20works%20under%20xsp2&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="102580.html">
   <LINK REL="Next"  HREF="102462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 624914] New: InvalidCastException in get_AppSettings under xsp4 where it works under xsp2</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20624914%5D%20New%3A%20InvalidCastException%20in%0A%20get_AppSettings%20under%20xsp4%20where%20it%20works%20under%20xsp2&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 624914] New: InvalidCastException in get_AppSettings under xsp4 where it works under xsp2">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Jul 22 19:56:19 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="102580.html">[Mono-bugs] [Bug 624903] EKEvent Title is readonly
</A></li>
        <LI>Next message: <A HREF="102462.html">[Mono-bugs] [Bug 624915] New: calling ExpandAll() on a TreeView contain in a small panel can throw ArgumentOutOfRangeException.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102461">[ date ]</a>
              <a href="thread.html#102461">[ thread ]</a>
              <a href="subject.html#102461">[ subject ]</a>
              <a href="author.html#102461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=624914">http://bugzilla.novell.com/show_bug.cgi?id=624914</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=624914#c0">http://bugzilla.novell.com/show_bug.cgi?id=624914#c0</A>


           Summary: InvalidCastException in get_AppSettings under xsp4
                    where it works under xsp2
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: x86
        OS/Version: Ubuntu
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.Web
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">michael at michael.ie</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/533.4 (KHTML, like Gecko) Chrome/5.0.375.99 Safari/533.4

BlogEngine.net 1.6.1 works with xsp2 but throws an exception under xsp4
An example file is included so that when it's placed into the application
directory

The BlogEngine.Net app seems to set up an environment where under xsp4, the
call to ConfigurationManager.AppSettings.Get(&quot;BlogEngine.MobileDevices&quot;) gives:
System.InvalidCastException: Unable to cast object of type
'System.Configuration.DefaultSection' to type
'System.Collections.Specialized.NameValueCollection'.

It does not repro standalone with the same Web.Config, I haven't been able to
track down what BlogEngine actually changes.

Reproducible: Always

Steps to Reproduce:
1. Recent compile of mono trunk and xsp (I am using r160696)
2. Download BlogEngine.net 1.6.1 from
<A HREF="http://blogengine.codeplex.com/releases/view/39387">http://blogengine.codeplex.com/releases/view/39387</A>
3. unzip and add liberal permissions to App_Data/* (chmod +R 777 App_Data/* or
other)
4. There seems to be a hardcoded search for /bin and /Bin, so cp -r Bin bin
5. I enabled  &lt;compilation debug=&quot;true&quot;&gt; in Web.Config
6. start xsp4 with your own host
MONO_OPTIONS=--debug=casts  xsp4 --applications
ec2-79-125-58-30.eu-west-1.compute.amazonaws.com:/:/var/www/asp/blog

7. Visit the site in a browser and hit the exception
8. Visit repro.aspx (supplied in bug) and see the same exception
try again using xsp2 and the basic website loads
Actual Results:  
System.InvalidCastException: Unable to cast object of type
'System.Configuration.DefaultSection' to type
'System.Collections.Specialized.NameValueCollection'.
  at System.Configuration.ConfigurationManager.get_AppSettings () [0x00000] in
/opt/source/mcs/class/System.Configuration/System.Configuration/ConfigurationManager.cs:176 
  at BlogEngine.Core.Utils..cctor () [0x00000] in &lt;filename unknown&gt;:0 
Version information: Mono Runtime Version: 2.7 (/trunk/mono r160696 Wed Jul 21
20:14:41 UTC 2010); ASP.NET Version: 4.0.30319.1

[System.Reflection.TargetInvocationException]: Exception has been thrown by the
target of an invocation.
  at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags
invokeAttr, System.Reflection.Binder binder, System.Object[] parameters,
System.Globalization.CultureInfo culture) [0x000f0] in
/opt/source/mcs/class/corlib/System.Reflection/MonoMethod.cs:231 
  at System.Reflection.MethodBase.Invoke (System.Object obj, System.Object[]
parameters) [0x00000] in
/opt/source/mcs/class/corlib/System.Reflection/MethodBase.cs:96 
  at System.Web.HttpApplicationFactory.FireEvent (System.String method_name,
System.Object target, System.Object[] args) [0x00038] in
/opt/source/mcs/class/System.Web/System.Web/HttpApplicationFactory.cs:205 
  at System.Web.HttpApplicationFactory.FireOnAppStart (System.Web.HttpContext
context) [0x0003a] in
/opt/source/mcs/class/System.Web/System.Web/HttpApplicationFactory.cs:217 
  at System.Web.HttpApplicationFactory.GetApplication (System.Web.HttpContext
context) [0x000ca] in
/opt/source/mcs/class/System.Web/System.Web/HttpApplicationFactory.cs:530 
  at System.Web.HttpRuntime.Process (System.Web.HttpWorkerRequest req)
[0x0005e] in /opt/source/mcs/class/System.Web/System.Web/HttpRuntime.cs:479 
[System.TypeInitializationException]: An exception was thrown by the type
initializer for BlogEngine.Core.Utils
  at ASP.global_asax.Application_Start (System.Object sender, System.EventArgs
e) [0x00000] in /var/www/asp/blog/Global.asax:87 
  at (wrapper managed-to-native) System.Reflection.MonoMethod:InternalInvoke
(System.Reflection.MonoMethod*,object,object[],System.Exception&amp;)
  at System.Reflection.MonoMethod.Invoke (System.Object obj, BindingFlags
invokeAttr, System.Reflection.Binder binder, System.Object[] parameters,
System.Globalization.CultureInfo culture) [0x000d5] in
/opt/source/mcs/class/corlib/System.Reflection/MonoMethod.cs:223 
[System.InvalidCastException]: Unable to cast object of type
&amp;#39;System.Configuration.DefaultSection&amp;#39; to type
&amp;#39;System.Collections.Specialized.NameValueCollection&amp;#39;.
  at System.Configuration.ConfigurationManager.get_AppSettings () [0x00000] in
/opt/source/mcs/class/System.Configuration/System.Configuration/ConfigurationManager.cs:176 
  at BlogEngine.Core.Utils..cctor () [0x00000] in &lt;filename unknown&gt;:0 

Expected Results:  
Visit to / should return a website
Visit to /repro.aspx should return a configuration string

repro.aspx:

&lt;%@ Page Language=&quot;C#&quot; %&gt;
&lt;html&gt;
&lt;body&gt;
&lt;%= ConfigurationManager.AppSettings.Get(&quot;BlogEngine.MobileDevices&quot;) %&gt;
&lt;/body&gt;
&lt;/html&gt;

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>












































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="102580.html">[Mono-bugs] [Bug 624903] EKEvent Title is readonly
</A></li>
	<LI>Next message: <A HREF="102462.html">[Mono-bugs] [Bug 624915] New: calling ExpandAll() on a TreeView contain in a small panel can throw ArgumentOutOfRangeException.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102461">[ date ]</a>
              <a href="thread.html#102461">[ thread ]</a>
              <a href="subject.html#102461">[ subject ]</a>
              <a href="author.html#102461">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
