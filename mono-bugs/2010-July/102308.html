<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 603794] HttpWebRequest ReadWriteTimeout ignored
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20603794%5D%20HttpWebRequest%20ReadWriteTimeout%20ignored&In-Reply-To=bug-603794-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="102306.html">
   <LINK REL="Next"  HREF="102310.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 603794] HttpWebRequest ReadWriteTimeout ignored</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20603794%5D%20HttpWebRequest%20ReadWriteTimeout%20ignored&In-Reply-To=bug-603794-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 603794] HttpWebRequest ReadWriteTimeout ignored">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Jul 19 02:55:24 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="102306.html">[Mono-bugs] [Bug 617671] UITableView Header/Footer text truncated on iPad after scrolling
</A></li>
        <LI>Next message: <A HREF="102310.html">[Mono-bugs] [Bug 623390] New: Cannot compile an assembly with a method marked Obsolete(string, true)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102308">[ date ]</a>
              <a href="thread.html#102308">[ thread ]</a>
              <a href="subject.html#102308">[ subject ]</a>
              <a href="author.html#102308">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=603794">http://bugzilla.novell.com/show_bug.cgi?id=603794</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=603794#c2">http://bugzilla.novell.com/show_bug.cgi?id=603794#c2</A>


--- Comment #2 from Fabio Colledani &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">fcolle at tiscalinet.it</A>&gt; 2010-07-19 06:55:22 UTC ---
(In reply to comment #1)
&gt;<i> We need a small test case for this. I'm sure that whatever test I come up with
</I>&gt;<i> based on your description is going to be different from yours.
</I>
Just OPEN the source file! The timeout is just saved in the class but NEVER
used!
Anyways, you can use the following method to upload data to a web server (you
have to setup the server too). During the upload phase, disconnect the network
wires. You will see that the timeout never expires.

[CODE]
 public static bool updateCgi(byte[] updatePackageFile,string ipaddress,int
port , string uri, string password, int requestTimeout, int readWriteTimeout,
out string responseStr)
        {
            ILog logger = LogManager.GetLogger(typeof(CgiAdapter));
            try
            {
                SetAllowUnsafeHeaderParsing20();

                string boundary = &quot;SOLBoundary--&quot;;
                byte[] boudaryBytes = Encoding.ASCII.GetBytes(&quot;\r\n--&quot; +
boundary + &quot;\r\n&quot;);

                HttpWebRequest req =
(HttpWebRequest)WebRequest.Create(&quot;<A HREF="http://&quot;+ipaddress+&quot;:&quot;+port.ToString(">http://&quot;+ipaddress+&quot;:&quot;+port.ToString(</A>)+&quot;/&quot;+uri);
                req.KeepAlive = true;
                req.ProtocolVersion = HttpVersion.Version11;
                req.Method = &quot;POST&quot;;

                req.ContentType = &quot;multipart/form-data; boundary=&quot; + boundary;

        //Setting up the cookies if needed
                req.CookieContainer = new CookieContainer(2);
                Cookie authCookie = new Cookie(&quot;lpassword&quot;, &quot;mypassword&quot;,
&quot;/cgi-bin/&quot;, ipaddress);
                Cookie langCookie = new Cookie(&quot;language&quot;, &quot;English&quot;,
&quot;/cgi-bin/&quot;, ipaddress);
                req.CookieContainer.Add(authCookie);
                req.CookieContainer.Add(langCookie);
                req.Timeout = requestTimeout * 1000;
                req.ReadWriteTimeout = readWriteTimeout * 1000;

                //Template per il descrittore del contenitore per i valori dei
parametri (input del form)
                string formatDataTemplate = &quot;\r\n--&quot; + boundary +
&quot;\r\nContent-Disposition: form-data; name=\&quot;{0}\&quot;;\r\n\r\n{1}&quot;;

                //Template per i file
                string fileFormatDataTemplate = &quot;\r\n--&quot; + boundary +
&quot;\r\nContent-Disposition: form-data; name=\&quot;{0}\&quot;;filename=\&quot;{1}\&quot;\r\n&quot;;

                MemoryStream ms = new MemoryStream();

                //prima parte: xmlout=true
                string xmlOutItem = string.Format(formatDataTemplate, &quot;xmlout&quot;,
&quot;true&quot;);
                byte[] xmlOutBytes = Encoding.UTF8.GetBytes(xmlOutItem);
                ms.Write(xmlOutBytes, 0, xmlOutBytes.Length);


                //application/x-compressed
                string fileHeader = string.Format(fileFormatDataTemplate,
&quot;tarfile&quot;, &quot;update.tgz&quot;);
                fileHeader += &quot;Content-Type: application/x-compressed\r\n\r\n&quot;;

                byte[] fileHeaderBytes = Encoding.UTF8.GetBytes(fileHeader);
                ms.Write(fileHeaderBytes, 0, fileHeaderBytes.Length);

                ms.Write(updatePackageFile, 0, updatePackageFile.Length);

                //chiudo con l'ultimo bondary + due trattini
                ms.Write(boudaryBytes, 0, boudaryBytes.Length);


                byte[] dashesBytes = Encoding.UTF8.GetBytes(&quot;--&quot;);
                ms.Write(dashesBytes, 0, dashesBytes.Length);

                ms.Position = 0;

                //Invio di tutto il buffer con la chiamata POST                
                byte[] postBuffer = new byte[ms.Length];
                ms.Read(postBuffer, 0, postBuffer.Length);
                ms.Close();

                req.ContentLength = postBuffer.Length;


                string postReqStr = Encoding.ASCII.GetString(postBuffer);

                Stream requestStream = req.GetRequestStream();
                requestStream.Write(postBuffer, 0, postBuffer.Length);
                requestStream.Close();

                if (logger.IsDebugEnabled)
                    logger.Debug(&quot;Sent &quot; + postBuffer.Length + &quot; bytes to &quot; +
ipaddress);


                //Ricezione della risposta                
                HttpWebResponse resp = (HttpWebResponse)req.GetResponse();

                if (resp.StatusCode != HttpStatusCode.OK)
                {
                    responseStr = &quot;HTTP ERROR : [&quot; + resp.StatusCode.ToString()
+ &quot;]&quot;;
                    return false;
                }
                else
                {

                    Stream responseStream = resp.GetResponseStream();
                    StreamReader respReader = new StreamReader(responseStream);
                    responseStr = respReader.ReadToEnd();

                    logger.Debug(&quot;HTTP Response: &quot; + responseStr);

                    resp.Close();
                    req = null;
                    resp = null;
                    //throw new NotImplementedException();
                    return true;
                }


            }
            catch (Exception excp)
            {
                logger.Error(excp.Message, excp);
                responseStr = excp.Message;
                return false;
            }


        }
[/CODE]

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="102306.html">[Mono-bugs] [Bug 617671] UITableView Header/Footer text truncated on iPad after scrolling
</A></li>
	<LI>Next message: <A HREF="102310.html">[Mono-bugs] [Bug 623390] New: Cannot compile an assembly with a method marked Obsolete(string, true)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102308">[ date ]</a>
              <a href="thread.html#102308">[ thread ]</a>
              <a href="subject.html#102308">[ subject ]</a>
              <a href="author.html#102308">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
