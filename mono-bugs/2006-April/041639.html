<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 78125][Nor] Changed - runtime segfault in program
	using C5.HashDictionary
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2078125%5D%5BNor%5D%20Changed%20-%20runtime%20segfault%20in%20program%0A%09using%20C5.HashDictionary&In-Reply-To=bug-78125%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="041638.html">
   <LINK REL="Next"  HREF="041640.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 78125][Nor] Changed - runtime segfault in program
	using C5.HashDictionary</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2078125%5D%5BNor%5D%20Changed%20-%20runtime%20segfault%20in%20program%0A%09using%20C5.HashDictionary&In-Reply-To=bug-78125%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 78125][Nor] Changed - runtime segfault in program
	using C5.HashDictionary">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Sun Apr 23 21:01:37 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="041638.html">[Mono-bugs] [Bug 78164][Wis] Changed - [PATCH]
	RemotingServices.IsObjectOutOfAppDomain throws InvalidCastException
</A></li>
        <LI>Next message: <A HREF="041640.html">[Mono-bugs] [Bug 78170][Wis] New - IronPython-beta6 compile
	eror(with mono-svn- 56794)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41639">[ date ]</a>
              <a href="thread.html#41639">[ thread ]</a>
              <a href="subject.html#41639">[ subject ]</a>
              <a href="author.html#41639">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bcs26 at cornell.edu.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=78125">http://bugzilla.ximian.com/show_bug.cgi?id=78125</A>

--- shadow/78125	2006-04-21 18:59:54.000000000 -0400
+++ shadow/78125.tmp.21502	2006-04-23 21:01:37.000000000 -0400
@@ -1,13 +1,13 @@
 Bug#: 78125
 Product: Mono: Runtime
 Version: 1.1
 OS: unknown
 OS Details: 
-Status: RESOLVED   
-Resolution: FIXED
+Status: REOPENED   
+Resolution: 
 Severity: Unknown
 Priority: Normal
 Component: misc
 AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>                            
 ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bcs26 at cornell.edu</A>               
 QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
@@ -111,6 +111,86 @@
 ------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bcs26 at cornell.edu</A>  2006-04-21 18:59 -------
 Can't reproduce the crash in mono-1.1.15. Since it was always
 nondeterministic, the bug may be merely hidden; but the original
 application now runs successfully using C5.HashDictionary, so I'm
 closing the bug.
 
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bcs26 at cornell.edu</A>  2006-04-23 21:01 -------
+Ok, I think I was prematurely optimistic in closing this bug.
+
+If I run the test program above (HashCrash.cs) normally (using just
+&quot;mono&quot;), with mono-1.1.15, it terminates successfully. If I run it
+under &quot;mono --debug --trace&quot;, however,  it terminates with the
+following exception:
+
+&quot;
+Unhandled Exception: System.NullReferenceException: Object reference
+not set to an instance of an object
+in &lt;0x00046&gt;
+C5.KeyValuePairEqualityComparer`2[System.Object,System.Object]:GetHashCode
+(KeyValuePair`2 )
+in &lt;0x00063&gt;
+C5.HashSet`1[C5.KeyValuePair`2[System.Object,System.Object]]:gethashcode
+(KeyValuePair`2 )
+in &lt;0x000d9&gt;
+C5.HashSet`1[C5.KeyValuePair`2[System.Object,System.Object]]:searchoradd
+(C5.KeyValuePair`2 , Boolean , Boolean , Boolean )
+in &lt;0x0005b&gt;
+C5.HashSet`1[C5.KeyValuePair`2[System.Object,System.Object]]:UpdateOrAdd
+(KeyValuePair`2 )
+in &lt;0x0008a&gt; C5.DictionaryBase`2[System.Object,System.Object]:set_Item
+(System.Object , System.Object )
+in &lt;0x0008a&gt; Foo:.ctor ()
+in &lt;0x0004e&gt; HashCrash:Main (System.String[] args)
+&quot;
+
+A different test case, virtually identical but using SCG.Dictionary
+instead of C5.HashDictionary, shows the same behavior. If that test
+case is executed under gdb, it terminates with a segfault:
+
+&quot;
+. . . LEAVE: System.Collections.Generic.Dictionary`2:.ctor ()
+. . . ENTER: (wrapper managed-to-native)
+System.Object:__icall_wrapper_mono_object_new_ptrfree_box
+(intptr)(0x730bc0, )
+. . . LEAVE: (wrapper managed-to-native)
+System.Object:__icall_wrapper_mono_object_new_ptrfree_box
+(intptr)[INT32:0x2aaaaab4cfc0:0]
+. . . ENTER: (wrapper managed-to-native)
+System.Object:__icall_wrapper_mono_object_new_ptrfree (intptr)(0x6c25e8, )
+. . . LEAVE: (wrapper managed-to-native)
+System.Object:__icall_wrapper_mono_object_new_ptrfree
+(intptr)[System.Object:0x2aaaaab2cfc0]
+. . . ENTER: System.Object:.ctor ()(this:0x2aaaaab2cfc0[System.Object
+MonoCrash.exe], )
+. . . LEAVE: System.Object:.ctor ()
+. . . ENTER: System.Collections.Generic.Dictionary`2:set_Item
+(object,object)(this:0x2aaaaab4efc0[System.Collections.Generic.Dictionary`2
+MonoCrash.exe], [INT32:0x2aaaaab4cfc0:0],
+[System.Object:0x2aaaaab2cfc0], )
+. . . . ENTER: System.Collections.Generic.Dictionary`2:GetPrev
+(object,int&amp;)(this:0x2aaaaab4efc0[System.Collections.Generic.Dictionary`2
+MonoCrash.exe], [INT32:0x2aaaaab4cfc0:0], [BYREF:0x7fffffb97b44], )
+. . . . . ENTER: System.Collections.Generic.Dictionary`2:DoHash
+(object)(this:0x2aaaaab4efc0[System.Collections.Generic.Dictionary`2
+MonoCrash.exe], [INT32:0x2aaaaab4cfc0:0], )
+
+Program received signal SIGSEGV, Segmentation fault.
+[Switching to Thread 46912509287200 (LWP 28340)]
+0x000000004001b728 in ?? ()
+(gdb)
+&quot;
+
+The test case attached (HashCrash.cs) also generates a SIGSEGV when
+run under gdb.
+
+Furthermore, the larger application that originally uncovered this bug
+is once again crashing with a segfault, even when _not_ run under
+--trace, which suggests a real runtime issue rather than a bug in
+--trace. I haven't yet been able to distill that application into a
+small test case that crashes without --trace.
+
+My guess is that 1.1.15 changed the way in which the bug from 1.1.13.2
+was being exhibited, but that the underlying bug hasn't been fixed.
+Bug #77888 looks potentially related.
+
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="041638.html">[Mono-bugs] [Bug 78164][Wis] Changed - [PATCH]
	RemotingServices.IsObjectOutOfAppDomain throws InvalidCastException
</A></li>
	<LI>Next message: <A HREF="041640.html">[Mono-bugs] [Bug 78170][Wis] New - IronPython-beta6 compile
	eror(with mono-svn- 56794)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#41639">[ date ]</a>
              <a href="thread.html#41639">[ thread ]</a>
              <a href="subject.html#41639">[ subject ]</a>
              <a href="author.html#41639">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
