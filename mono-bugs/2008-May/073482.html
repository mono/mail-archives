<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 387962] New: Exception when working with Timers	heavily
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20387962%5D%20New%3A%20Exception%20when%20working%20with%20Timers%0A%09heavily&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073480.html">
   <LINK REL="Next"  HREF="073491.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 387962] New: Exception when working with Timers	heavily</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20387962%5D%20New%3A%20Exception%20when%20working%20with%20Timers%0A%09heavily&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 387962] New: Exception when working with Timers	heavily">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed May  7 16:07:08 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="073480.html">[Mono-bugs] [Bug 377726] not correctly measuring non-default fonts?
</A></li>
        <LI>Next message: <A HREF="073491.html">[Mono-bugs] [Bug 387962] Exception when working with Timers heavily
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73482">[ date ]</a>
              <a href="thread.html#73482">[ thread ]</a>
              <a href="subject.html#73482">[ subject ]</a>
              <a href="author.html#73482">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=387962">https://bugzilla.novell.com/show_bug.cgi?id=387962</A>


           Summary: Exception when working with Timers heavily
           Product: Mono: Class Libraries
           Version: 1.9.0
          Platform: x86
        OS/Version: openSUSE 10.3
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">davecferguson at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Integration Test


Created an attachment (id=213297)
 --&gt; (<A HREF="https://bugzilla.novell.com/attachment.cgi?id=213297">https://bugzilla.novell.com/attachment.cgi?id=213297</A>)
Sample application to reproduce exception

Description of Problem:

We are building an application that starts and stops timers quite often. 
Occasionally, we will see marked delays and then an unhandled exception thrown
for no reason.  It seems to be a timing issue and is happening within the
runtime itself.  At this point, our test app is only able to replicate the
issue with the System.Timers.Timer.  We wrote a facade around the
System.Threading.Timer and are testing that at the moment. 


Steps to reproduce the problem:
1. Create many System.Timers.Timer objects with a fairly quick interval
2. Start and stop them from several different threads (randomly).
3. In the Elapsed event, stop and start the timer that raised the event.


Actual Results:

Here's an excerpt of the output of our test app:

Expired at: 5/7/2008 1:22:50 PM -810730304
Expired at: 5/7/2008 1:22:50 PM 226709824
Starter Expired at: 5/7/2008 1:22:50 PM
Starter Expired at: 5/7/2008 1:22:50 PM
Starter Expired at: 5/7/2008 1:22:50 PM
Expired at: 5/7/2008 1:22:50 PM 273009792
Starter Expired at: 5/7/2008 1:22:52 PM
Starter Expired at: 5/7/2008 1:22:52 PM
Starter Expired at: 5/7/2008 1:22:53 PM
Terminating: True
System.NullReferenceException: Object reference not set to an instance of an
object
  at System.Timers.Timer.StartTimer () [0x00000] 
prof counts: total/unmanaged: 1704/1703
   1536 90.19 % 
     32  1.88 % /lib/libc.so.6(semop
     17  1.00 % mono(_wapi_handle_timedwait_signal_handle
     13  0.76 % mono(WaitForSingleObjectEx
     11  0.65 % /lib/libc.so.6(clone
     10  0.59 % mono(_wapi_handle_ops_prewait
      8  0.47 % mono(own_if_signalled

The output above was for 30 timers firing every 100 milliseconds (stopping and
restarting themselves...Autoreset was not set).  In addition, a thread would
stop and start all timers every 1 second.

A similar event happens with only 2 timers firing every 100 milliseconds (no
Autoreset, but restarting in the Elapsed event).  See TimerTimerTest.cs in the
attached sample application.

You can see that even before the second thread stopped and started timers,
there were issues with the timers firing their events appropriately.


Expected Results:

A steady stream of output from the timers expiring on time and with no
exceptions.

How often does this happen? 

Able to reproduce almost 95% of the time with attached test application.


Additional Information:

Use the following command line parameters with the test application:

interval=100 count=2 resetinterval=1000 oneshot=true type=timer


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073480.html">[Mono-bugs] [Bug 377726] not correctly measuring non-default fonts?
</A></li>
	<LI>Next message: <A HREF="073491.html">[Mono-bugs] [Bug 387962] Exception when working with Timers heavily
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73482">[ date ]</a>
              <a href="thread.html#73482">[ thread ]</a>
              <a href="subject.html#73482">[ subject ]</a>
              <a href="author.html#73482">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
