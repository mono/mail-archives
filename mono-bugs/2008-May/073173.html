<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 386450] New: new Font() is not a new object ...	sometimes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20386450%5D%20New%3A%20new%20Font%28%29%20is%20not%20a%20new%20object%20...%0A%09sometimes&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073172.html">
   <LINK REL="Next"  HREF="073257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 386450] New: new Font() is not a new object ...	sometimes</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20386450%5D%20New%3A%20new%20Font%28%29%20is%20not%20a%20new%20object%20...%0A%09sometimes&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 386450] New: new Font() is not a new object ...	sometimes">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat May  3 17:44:36 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="073172.html">[Mono-bugs] [Bug 383878] Region.Complement makes error with some	data
</A></li>
        <LI>Next message: <A HREF="073257.html">[Mono-bugs] [Bug 386450] TextBox: LineTags need their Font changed if TextBox's changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73173">[ date ]</a>
              <a href="thread.html#73173">[ thread ]</a>
              <a href="subject.html#73173">[ subject ]</a>
              <a href="author.html#73173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=386450">https://bugzilla.novell.com/show_bug.cgi?id=386450</A>


           Summary: new Font() is not a new object ... sometimes
           Product: Mono: Class Libraries
           Version: 1.9.0
          Platform: Other
               URL: <A HREF="http://limada.sourceforge.net/Limaki/">http://limada.sourceforge.net/Limaki/</A>
        OS/Version: Windows XP
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Windows.Forms
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lytico at users.sourceforge.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Creating a Font-Object with new Font(...) and 
disposing this font-object 
disposes other &quot;instances&quot; of a font-object with same font-family, size and
style.

Example (tested on .Net 2.0: works; mono 1.9.0 on winXP: error; NOT tested
under linux):
    public class FontProblem:Form {
        TextBox editor = null;

        public void testFont(){
            // make a new Font:
            Font fontA = new Font(
                    SystemFonts.DefaultFont.Name,
                    SystemFonts.DefaultFont.Size,
                    SystemFonts.DefaultFont.Style);

            // make another new font with same name, size, style
            using (Font fontB = 
                       new Font(
                    fontA.Name,
                    fontA.Size,
                    fontA.Style)) {

                        // do something with the font:
                        editor.Font = fontB;

                        editor.Text = &quot;testing&quot;;

                        editor.Visible = true;
                        editor.Focus();

                        Application.DoEvents();

                        editor.Visible = false;

                        // fontB is no longer in use!
                        editor.Font = fontA;
                } // fontB is disposed

            // you get the Exception here:
            editor.Visible = true;
            editor.Focus();
        }

        // stuff to have a test environment:
        Button button = null;
        public FontProblem() {
                this.SuspendLayout();
                button = new Button();
                button.Name = &quot;button&quot;;
                button.Text = &quot;Test Font&quot;;
                button.Click += 
                        delegate(object sender, EventArgs e) { testFont(); };
                this.Controls.Add(button);
            editor = new TextBox();
            editor.Name = &quot;TextBox&quot;;
            editor.Location = button.Location+
                new Size(button.Width+5,editor.Location.Y);
            this.Controls.Add(editor);
                        this.ResumeLayout();
        }

        static void Main() {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new FontProblem());
        }
    }

running this program you'll get an error like this:


Unhandled Exception: System.ArgumentException: A null reference or invalid
value
 was found [GDI+ status: InvalidParameter]
at System.Drawing.GDIPlus.CheckStatus (System.Drawing.Status) [0x0009d] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\System.Drawing\System.Drawing\gdipFunctions.cs:219
at System.Drawing.Font.GetHeight (single) [0x0000f] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\System.Drawing\System.Drawing\Font.cs:678
at System.Drawing.Font.GetHeight () [0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\System.Drawing\System.Drawing\Font.cs:562
at System.Drawing.Font.get_Height () [0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\System.Drawing\System.Drawing\Font.cs:428
at (wrapper remoting-invoke-with-check) System.Drawing.Font.get_Height ()
&lt;0x00036&gt;
at System.Windows.Forms.LineTag.MaxHeight () [0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\LineTag.cs:560
at System.Windows.Forms.Line.RecalculateLine
(System.Drawing.Graphics,System.Windows.Forms.Document) [0x0024c] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Line.cs:534
at System.Windows.Forms.Document.RecalculateDocument
(System.Drawing.Graphics,int,int,bool) [0x000ad] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\TextControl.cs:3514
at System.Windows.Forms.Document.RecalculateDocument (System.Drawing.Graphics)
[0x00000] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\TextControl.cs:3462
at System.Windows.Forms.Document.owner_VisibleChanged
(object,System.EventArgs)[0x00010] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\TextControl.cs:3597
at System.Windows.Forms.Control.OnVisibleChanged (System.EventArgs) [0x0002d]
in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:6447
at System.Windows.Forms.Control.SetVisibleCore (bool) [0x000f0] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:4944
at System.Windows.Forms.Control.set_Visible (bool) [0x0000c] in
C:\cygwin\tmp\monobuild\build\BUILD\mono-1.9\mcs\class\Managed.Windows.Forms\System.Windows.Forms\Control.cs:3372
at (wrapper remoting-invoke-with-check)
System.Windows.Forms.Control.set_Visible (bool) &lt;0x0004b&gt;
at MonoWinformTests.FontProblem.testFont () &lt;0x0018e&gt;
..


I guess there is a font-cache somethere, the new Font() gives an object out of
this cache, so I don't get a new instance (despite of new), but a new reference
on an existing object.

cheers,
lytico 
on trying to get limada.sourceforge.net/Limaki to run on mono


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>










































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073172.html">[Mono-bugs] [Bug 383878] Region.Complement makes error with some	data
</A></li>
	<LI>Next message: <A HREF="073257.html">[Mono-bugs] [Bug 386450] TextBox: LineTags need their Font changed if TextBox's changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73173">[ date ]</a>
              <a href="thread.html#73173">[ thread ]</a>
              <a href="subject.html#73173">[ subject ]</a>
              <a href="author.html#73173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
