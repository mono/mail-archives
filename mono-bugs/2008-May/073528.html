<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 388376] New: Mono is unable to properly release	memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20388376%5D%20New%3A%20Mono%20is%20unable%20to%20properly%20release%0A%09memory&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073527.html">
   <LINK REL="Next"  HREF="073544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 388376] New: Mono is unable to properly release	memory</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20388376%5D%20New%3A%20Mono%20is%20unable%20to%20properly%20release%0A%09memory&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 388376] New: Mono is unable to properly release	memory">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu May  8 13:31:49 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="073527.html">[Mono-bugs] [Bug 320831] [FEATURE] WebParts namespace is not fully implemented yet
</A></li>
        <LI>Next message: <A HREF="073544.html">[Mono-bugs] [Bug 388376] Mono is unable to properly release memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73528">[ date ]</a>
              <a href="thread.html#73528">[ thread ]</a>
              <a href="subject.html#73528">[ subject ]</a>
              <a href="author.html#73528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=388376">https://bugzilla.novell.com/show_bug.cgi?id=388376</A>


           Summary: Mono is unable to properly release memory
           Product: Mono: Runtime
           Version: 1.9.0
          Platform: 32bit
        OS/Version: RHEL 4
            Status: NEW
          Severity: Blocker
          Priority: P5 - None
         Component: GC
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">lupus at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">antonello.moro at elsagdatamat.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Other


Mono does not release memory, even after calling GC.Collect and
GC.WaitForPendingFinalizers.
This means that if an object (whose size is equals to 10MB, for example) is set
to null, the total size of memory used by mono will not decrement after having
called GC.Collect.
Mono seems no to be able to release memory even when it is required, so, when
large objects are created and destroyed, sooner or later mono crashes due to
OutOfMemoryException.

The problem is present both in windows and linux OS.

In order to reproduce the bug, please run the following code

[CODE]
using System;
using System.Collections.Generic;
using System.Text;
using System.Diagnostics;

namespace ConsoleApplication1
{
    class Program
    {

        static void Main(string[] args)
        {
            int numByte = 600000000;
            Console.WriteLine(&quot;Proc Id: &quot; + Process.GetCurrentProcess().Id);
            Console.WriteLine(&quot;Creating array&quot;);
            byte[] p = new byte[numByte];

            Console.WriteLine(&quot;Array created&quot;);
            for (int i = 0; i &lt; numByte; i++)
            {
                p[i] = 20;
            }


            p = null;
            Console.WriteLine(&quot;Collecting&quot;);
            GC.Collect();
            System.GC.WaitForPendingFinalizers();
            Console.WriteLine(&quot;Execution terminated, press any key&quot;);
            Console.ReadLine();


        }
    }
}
[/CODE]

Using taksmanager (or top in linux) you can see that the memory allocated by
mono is the same before and after the GC.Collect has been invoked.


The following code causes mono to crash during the third execution, due to a
OutOfMemoryException, while the same code never crashes when running under
MS.NET

[CODE]
using System;
using System.Collections.Generic;
using System.Text;
using System.Diagnostics;

namespace ConsoleApplication1
{
    class Program
    {
        //private static int convMb = 1048576;

        static void Main(string[] args)
        {
            int numByte = 600000000;
            Console.WriteLine(&quot;Proc Id: &quot; + Process.GetCurrentProcess().Id);
            while (true)
            {
                Console.WriteLine(&quot;Creating array&quot;);
                byte[] p = new byte[numByte];

                Console.WriteLine(&quot;Array created&quot;);
                for (int i = 0; i &lt; numByte; i++)
                {
                    p[i] = 20;
                }


                p = null;
                Console.WriteLine(&quot;Collecting&quot;);
                GC.Collect();
                System.GC.WaitForPendingFinalizers();
            }


        }
    }
}
[/CODE]


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073527.html">[Mono-bugs] [Bug 320831] [FEATURE] WebParts namespace is not fully implemented yet
</A></li>
	<LI>Next message: <A HREF="073544.html">[Mono-bugs] [Bug 388376] Mono is unable to properly release memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73528">[ date ]</a>
              <a href="thread.html#73528">[ thread ]</a>
              <a href="subject.html#73528">[ subject ]</a>
              <a href="author.html#73528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
