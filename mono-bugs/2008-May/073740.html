<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 389653] New: Lambda method &quot;disappears&quot; when put into a collection by the indexer setter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20389653%5D%20New%3A%20Lambda%20method%20%22disappears%22%20when%20put%0A%20into%20a%20collection%20by%20the%20indexer%20setter&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073818.html">
   <LINK REL="Next"  HREF="073743.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 389653] New: Lambda method &quot;disappears&quot; when put into a collection by the indexer setter</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20389653%5D%20New%3A%20Lambda%20method%20%22disappears%22%20when%20put%0A%20into%20a%20collection%20by%20the%20indexer%20setter&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 389653] New: Lambda method &quot;disappears&quot; when put into a collection by the indexer setter">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue May 13 02:40:49 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="073818.html">[Mono-bugs] [Bug 389627] Index out of range exception in Unit.cs
</A></li>
        <LI>Next message: <A HREF="073743.html">[Mono-bugs] [Bug 325033] Threading: Timer ticks on wrong thread, when multiple threads running message-loops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73740">[ date ]</a>
              <a href="thread.html#73740">[ thread ]</a>
              <a href="subject.html#73740">[ subject ]</a>
              <a href="author.html#73740">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=389653">https://bugzilla.novell.com/show_bug.cgi?id=389653</A>


           Summary: Lambda method &quot;disappears&quot; when put into a collection by
                    the indexer setter
           Product: Mono: Compilers
           Version: 1.9.0
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: C#
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">merlin9x9 at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Customer


Compile the following code with gmcs 1.9.0 or later:

        using System;
        using System.Collections.Generic;

        static class Test
        {
                static void Main()
                {
                        var funcs = new Dictionary&lt;int, Func&lt;int&gt;&gt;();
                        funcs[0] = () =&gt; A();
                        funcs[1] = () =&gt; B();
                        funcs[2] = () =&gt; C();

                        foreach(var pair in funcs)
                        {
                                int result = pair.Value();
                                Console.WriteLine(&quot; returned {0}.&quot;, result);
                        }
                }

                static int A()
                {
                        Console.Write(&quot;A&quot;);
                        return 1;
                }

                static int B()
                {
                        Console.Write(&quot;B&quot;);
                        return 2;
                }

                static int C()
                {
                        Console.Write(&quot;C&quot;);
                        return 3;
                }
        } // Test

This code causes gmcs erroneously to generate warnings about unreachable code
on the three lines where the lambda methods are being assigned to keys in the
dictionary. Worse, the output of this program is the following:

         returned 0.
         returned 0.
         returned 0.

The output _should_ be:

        A returned 1.
        B returned 2.
        C returned 3.

Indeed, if those offending three lines are replaced with the following, the
expected output is observed and the warnings are not generated:

        funcs.Add(0, () =&gt; A());
        funcs.Add(1, () =&gt; B());
        funcs.Add(2, () =&gt; C());

The sample as originally written and with the modification both work
identically when built with Microsoft's C# compiler, neither are any warnings
emitted.

It appears as though the lambda methods are somehow not being generated
properly, and instead get replaced with the default value of the return type
for the Func&lt;T&gt; objects. Interestingly, if I assign those lambda methods to
temporary variables and use those variables in the dictionary assignments,
everything works as it should.

I'm certain that the problem is more general than what I described in the
summary, but this happens to be the case in which I found it. Even if it is
limited to collections, I see the same behavior using, say, List&lt;T&gt; and [...]=
versus Add(...).


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>

































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073818.html">[Mono-bugs] [Bug 389627] Index out of range exception in Unit.cs
</A></li>
	<LI>Next message: <A HREF="073743.html">[Mono-bugs] [Bug 325033] Threading: Timer ticks on wrong thread, when multiple threads running message-loops
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73740">[ date ]</a>
              <a href="thread.html#73740">[ thread ]</a>
              <a href="subject.html#73740">[ subject ]</a>
              <a href="author.html#73740">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
