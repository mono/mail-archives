<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 633945] New: [Windows] some async HttpWebRequest or its underlying layer fails to invoke callback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20633945%5D%20New%3A%20%5BWindows%5D%20some%20async%20HttpWebRequest%0A%20or%20its%20underlying%20layer%20fails%20to%20invoke%20callback&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="103194.html">
   <LINK REL="Next"  HREF="103184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 633945] New: [Windows] some async HttpWebRequest or its underlying layer fails to invoke callback</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20633945%5D%20New%3A%20%5BWindows%5D%20some%20async%20HttpWebRequest%0A%20or%20its%20underlying%20layer%20fails%20to%20invoke%20callback&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 633945] New: [Windows] some async HttpWebRequest or its underlying layer fails to invoke callback">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Aug 24 04:33:15 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="103194.html">[Mono-bugs] [Bug 633940] Include casts in the default debug options
</A></li>
        <LI>Next message: <A HREF="103184.html">[Mono-bugs] [Bug 633962] New: xdebug no longer works with gdb 7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103183">[ date ]</a>
              <a href="thread.html#103183">[ thread ]</a>
              <a href="subject.html#103183">[ subject ]</a>
              <a href="author.html#103183">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=633945">https://bugzilla.novell.com/show_bug.cgi?id=633945</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=633945#c0">https://bugzilla.novell.com/show_bug.cgi?id=633945#c0</A>


           Summary: [Windows] some async HttpWebRequest or its underlying
                    layer fails to invoke callback
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">aenomoto at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
                CC: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gonzalo at novell.com</A>
          Found By: ---
           Blocker: ---


I noticed that on Windows some HttpWebRequest, async delegate or something else
does not work as it does on Linux. HttpWebRequest fails to invoke AsyncCallback
before timeout, probably BeginGetStream() callback is not invoked.

What is interesting is that it sends the actual request *after* the timeout
happens.

Repro server and client (client matters):

// ---- server ----
using System;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.Threading;

public class Test
{
    public static void Main ()
    {
        var b = new BasicHttpBinding ();
        var cl = b.BuildChannelListener&lt;IReplyChannel&gt; (new Uri
(&quot;<A HREF="http://localhost:8989&quot;">http://localhost:8989&quot;</A>));
        cl.Open ();
        var ch = cl.AcceptChannel ();
        ch.Open ();
        var rc = ch.ReceiveRequest ();
        Console.WriteLine (&quot;Request received&quot;);
        Console.WriteLine (rc.RequestMessage);
        var msg = Message.CreateMessage (MessageVersion.Soap11,
&quot;<A HREF="http://tempuri.org/EchoResponse&quot;,">http://tempuri.org/EchoResponse&quot;,</A> &quot;echo&quot;);
        rc.Reply (msg);
        Thread.Sleep (3000);
    }
}

// ---- client ----
using System;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Description;

public class Test
{
    public static void Main ()
    {
        var cf = new ChannelFactory&lt;ITestService&gt; (
            new BasicHttpBinding (),
            new EndpointAddress (&quot;<A HREF="http://localhost:8989&quot;">http://localhost:8989&quot;</A>));
        var ch = cf.CreateChannel ();
        //ch.Echo (&quot;test&quot;); // works. (error)
        ch.EndEcho (ch.BeginEcho (&quot;test&quot;, null, null));
    }
}

[ServiceContract]
public interface ITestService
{
    [OperationContract] // sync
    string Echo (string input);

    [OperationContract (AsyncPattern = true)]
    IAsyncResult BeginEcho (string input, AsyncCallback cb, object state);
    string EndEcho (IAsyncResult result);
}

--------

Another couple of working cases are:

- Sync operation. By using &quot;Echo&quot; instead of &quot;BeginEcho&quot; / &quot;EndEcho&quot;, it works
fine.
- A simpler client example that does not involve client &quot;proxy&quot; just works (in
async operation), so it's not simply HttpWebRequest issue as a standalone.
Example below:

// ---- working client ----
using System;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.Threading;

public class Test
{
    public static void Main ()
    {
        var b = new BasicHttpBinding ();
        var cf = b.BuildChannelFactory&lt;IRequestChannel&gt; ();
        cf.Open ();
        var ch = cf.CreateChannel (new EndpointAddress
(&quot;<A HREF="http://localhost:8989&quot;">http://localhost:8989&quot;</A>));
        ch.Open ();
        var msg = Message.CreateMessage (MessageVersion.Soap11, &quot;urn:foo&quot;,
&quot;echo&quot;);
        ch.EndRequest (ch.BeginRequest (msg, null, null));
    }
}

--------

It's looking like some threading issue regarding async delegate invocation, but
I could only identify the issue to this extent so far.

CCing Gonzalo as he might have some inputs.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>
















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="103194.html">[Mono-bugs] [Bug 633940] Include casts in the default debug options
</A></li>
	<LI>Next message: <A HREF="103184.html">[Mono-bugs] [Bug 633962] New: xdebug no longer works with gdb 7.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103183">[ date ]</a>
              <a href="thread.html#103183">[ thread ]</a>
              <a href="subject.html#103183">[ subject ]</a>
              <a href="author.html#103183">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
