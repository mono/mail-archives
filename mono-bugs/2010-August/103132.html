<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 633474] New: fastcgi-mono-server2 sometimes completely hangs under a load test
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20633474%5D%20New%3A%20fastcgi-mono-server2%20sometimes%0A%20completely%20hangs%20under%20a%20load%20test&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="103131.html">
   <LINK REL="Next"  HREF="103133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 633474] New: fastcgi-mono-server2 sometimes completely hangs under a load test</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20633474%5D%20New%3A%20fastcgi-mono-server2%20sometimes%0A%20completely%20hangs%20under%20a%20load%20test&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 633474] New: fastcgi-mono-server2 sometimes completely hangs under a load test">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat Aug 21 22:44:19 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="103131.html">[Mono-bugs] [Bug 633473] Type.GetType() can't load assemblies	containing spaces
</A></li>
        <LI>Next message: <A HREF="103133.html">[Mono-bugs] [Bug 633474] fastcgi-mono-server2 sometimes completely hangs under a load test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103132">[ date ]</a>
              <a href="thread.html#103132">[ thread ]</a>
              <a href="subject.html#103132">[ subject ]</a>
              <a href="author.html#103132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=633474">https://bugzilla.novell.com/show_bug.cgi?id=633474</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=633474#c0">https://bugzilla.novell.com/show_bug.cgi?id=633474#c0</A>


           Summary: fastcgi-mono-server2 sometimes completely hangs under
                    a load test
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.6.x
          Platform: i686
        OS/Version: Ubuntu
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: misc
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">michael at michael.ie</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=384636)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=384636">http://bugzilla.novell.com/attachment.cgi?id=384636</A>)
default site nginx config to enable fastcgi

User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US)
AppleWebKit/534.3 (KHTML, like Gecko) Chrome/6.0.472.41 Safari/534.3

Sometimes fastcgi-mono-server2 completely stops serving pages to my nginx
gateway after I run an apachebench loadtest. The fastcgi server never recovers
and any other attempts to fetch pages result in nginx throwing a gateway
timeout eventually.

System spec:
- Amazon EC2 Ubuntu 10.04 LTS Lucid with kernel Ubuntu SMP Thu Apr 15 04:14:01
UTC 2010 i686 GNU/Linux
- nginx/0.7.65 from packages
- Mono 2.6.7 (Debian 2.6.7-1ubuntu1~dhx1) and fastcgi-mono-server2.exe 2.6.5.0
from Badgerports


Reproducible: Sometimes

Steps to Reproduce:
1. Spin up one EC2 instance of Ubuntu Lucid (I used ami-cf4d67bb in the
EU-West)
2. Install nginx from packages and mono-runtime, xsp2 and fastcgi-mono-server2
from badgerports
3. Get quickly setup with nginx by replacing /etc/nginx/sites-available/default
with the attached basic default config file and sudo service nginx restart
4. Drop in the simple webforms test aspx file into
/var/www/nginx-default/hi2.aspx
5. Start the server with fastcgi-mono-server2 
/applications=MYDNSADDRESS:/:/var/www/nginx-default /socket=tcp:127.0.0.1:9000
6. Visit in a browser to verify it works and to compile.

7. Spin up another box on the network and install apachebench (package
apache2-utils).
8. ab -n 10000 -c 20 <A HREF="http://DNSADDRESS/hi2.aspx">http://DNSADDRESS/hi2.aspx</A>

Repeat step 8 for a few times until the server crashes
Actual Results:  
fastcgi-mono-server2 stopped responding and nginx throws a gateway timeout
error

Expected Results:  
I expected apachebench to return with complete success with all pages served
without any fails.

Also attached is lshw output to help diagnose, and after attaching gdb to the
process and trying to get thread state

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="103131.html">[Mono-bugs] [Bug 633473] Type.GetType() can't load assemblies	containing spaces
</A></li>
	<LI>Next message: <A HREF="103133.html">[Mono-bugs] [Bug 633474] fastcgi-mono-server2 sometimes completely hangs under a load test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103132">[ date ]</a>
              <a href="thread.html#103132">[ thread ]</a>
              <a href="subject.html#103132">[ subject ]</a>
              <a href="author.html#103132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
