<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 79396][Nor] New - Type not found when	IConfigurationSectionHandler in bin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2079396%5D%5BNor%5D%20New%20-%20Type%20not%20found%20when%0A%09IConfigurationSectionHandler%20in%20bin&In-Reply-To=bug-79396%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="047248.html">
   <LINK REL="Next"  HREF="047250.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 79396][Nor] New - Type not found when	IConfigurationSectionHandler in bin</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2079396%5D%5BNor%5D%20New%20-%20Type%20not%20found%20when%0A%09IConfigurationSectionHandler%20in%20bin&In-Reply-To=bug-79396%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 79396][Nor] New - Type not found when	IConfigurationSectionHandler in bin">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Thu Sep 14 13:14:38 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="047248.html">[Mono-bugs] [Bug 79381][Blo] Changed - forcing the	cfg-&gt;method-&gt;dynamic branch on ppc machines,	generates SIGILL exceptions
</A></li>
        <LI>Next message: <A HREF="047250.html">[Mono-bugs] [Bug 79397][Blo] New - runtime crash when socket handle	greater than 1215
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47249">[ date ]</a>
              <a href="thread.html#47249">[ thread ]</a>
              <a href="subject.html#47249">[ subject ]</a>
              <a href="author.html#47249">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">rmt512 at gmail.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=79396">http://bugzilla.ximian.com/show_bug.cgi?id=79396</A>

--- shadow/79396	2006-09-14 13:14:38.000000000 -0400
+++ shadow/79396.tmp.21059	2006-09-14 13:14:38.000000000 -0400
@@ -0,0 +1,156 @@
+Bug#: 79396
+Product: Mono: Class Libraries
+Version: 1.0
+OS: 
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Normal
+Component: Sys.Web
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gonzalo at ximian.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">rmt512 at gmail.com</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: Type not found when IConfigurationSectionHandler in bin
+
+Description of Problem:
+
+I want to create a custom configuration section in web.config, by adding
+new section groups
+
+e.g., like mono.data
+
+&lt;sectionGroup name=&quot;mono.data&quot;&gt;
+			&lt;section name=&quot;providers&quot;
+type=&quot;Mono.Data.ProviderSectionHandler,Mono.Data&quot; /&gt;
+		&lt;/sectionGroup&gt;
+
+now, if an imlpementor of IConfigurationSectionHandler is defined in an
+assembly in bin, it is not found, and fails with this error
+
+System.Reflection.TargetInvocationException: Exception has been thrown by
+the target of an invocation. ---&gt; System.TypeInitializationException: An
+exception was thrown by the type initializer for
+Accounts.Core.AddIns.AddInFactory ---&gt;
+System.Configuration.ConfigurationErrorsException: Type not found:
+'Accounts.Core.AddIns.AddInHandler' () ()
+  at System.Web.Configuration.WebConfigurationHost.GetConfigType
+(System.String typeName, Boolean throwOnError) [0x00000] 
+  at System.Configuration.ConfigInfo.CreateInstance () [0x00000] 
+  at System.Configuration.SectionInfo.CreateInstance () [0x00000] 
+  at System.Configuration.Configuration.GetSectionInstance
+(System.Configuration.SectionInfo config, Boolean createDefaultInstance)
+[0x00000] 
+  at System.Configuration.ConfigurationSectionCollection.get_Item
+(System.String name) [0x00000] 
+  at System.Configuration.Configuration.GetSection (System.String path)
+[0x00000] 
+  at
+System.Web.Configuration.WebConfigurationManager.GetWebApplicationSection
+(System.String sectionName) [0x00000] 
+  at System.Web.Configuration.Web20DefaultConfig.GetConfig (System.String
+sectionName) [0x00000] 
+  at System.Configuration.ConfigurationSettings.GetConfig (System.String
+sectionName) [0x00000] 
+  at Accounts.Core.AddIns.AddInFactory..cctor () [0x00000] --- End of inner
+exception stack trace ---
+
+
+This reminded me of bug 
+
+<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=78321,">http://bugzilla.ximian.com/show_bug.cgi?id=78321,</A>  	
+[2.0] ObjectDataSource fails to find the specified type
+
+I applied the patch from Marek Habersack to
+
+mcs/class/System.Web/System.Web.Configuration_2.0/WebConfigurationHost.cs
+
+to get the attached diff, which makes it work to my satisfaction.
+
+Index: class/System.Web/System.Web.Configuration_2.0/WebConfigurationHost.cs
+===================================================================
+--- class/System.Web/System.Web.Configuration_2.0/WebConfigurationHost.cs 
+    (revision 65334)
++++ class/System.Web/System.Web.Configuration_2.0/WebConfigurationHost.cs 
+    (working copy)
+@@ -34,7 +34,9 @@
+ using System.Configuration;
+ using System.Configuration.Internal;
+ using System.Web.Util;
++using System.Reflection;
+
++
+ /*
+  * this class needs to be rewritten to support usage of the
+  * IRemoteWebConfigurationHostServer interface.  Once that's done, we
+@@ -87,10 +89,56 @@
+                        return configPath + &quot;/&quot; + locatinSubPath;
+                }
+
++               private static string privateBinPath;
++
++               private static string PrivateBinPath
++               {
++                       get {
++                               if (privateBinPath != null)
++                                       return privateBinPath;
++
++                               AppDomainSetup setup =
+AppDomain.CurrentDomain.SetupInformation;
++                               privateBinPath =
+Path.Combine(setup.ApplicationBase, setup.PrivateBinPath);
++
++                               return privateBinPath;
++                           }
++               }
++
++               private Type LoadType(string typeName)
++               {
++                       Type type = null;
++                       Assembly [] assemblies =
+AppDomain.CurrentDomain.GetAssemblies ();
++System.Console.WriteLine(&quot;doing my patch with &quot;+typeName);
++
++                       foreach (Assembly ass in assemblies) {
++                               type = ass.GetType (typeName);
++                               if (type == null)
++                                       continue;
++
++                               return type;
++                       }
++
++                       if (!Directory.Exists (PrivateBinPath))
++                               return null;
++
++                       string[] binDlls =
+Directory.GetFiles(PrivateBinPath, &quot;*.dll&quot;);
++                       foreach (string s in binDlls) {
++                               Assembly binA = Assembly.LoadFrom (s);
++                               type = binA.GetType (typeName);
++                               if (type == null)
++                                       continue;
++
++                               return type;
++                       }
++
++                       return null;
++               }
++
+                [MonoTODO (&quot;this should consult with the build provider
+machinery&quot;)]
+                public virtual Type GetConfigType (string typeName, bool
+throwOnError)
+                {
+-                       Type type = Type.GetType (typeName);
++                       //Type type = Type.GetType (typeName);
++                       Type type = LoadType(typeName);
+                        if (type == null &amp;&amp; throwOnError)
+                                throw new ConfigurationErrorsException
+(&quot;Type not found: '&quot; + typeName + &quot;'&quot;);
+                        return type;
+
+
+Thanks.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="047248.html">[Mono-bugs] [Bug 79381][Blo] Changed - forcing the	cfg-&gt;method-&gt;dynamic branch on ppc machines,	generates SIGILL exceptions
</A></li>
	<LI>Next message: <A HREF="047250.html">[Mono-bugs] [Bug 79397][Blo] New - runtime crash when socket handle	greater than 1215
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#47249">[ date ]</a>
              <a href="thread.html#47249">[ thread ]</a>
              <a href="subject.html#47249">[ subject ]</a>
              <a href="author.html#47249">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
