<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 535552] New: Decimal.TryParse(string, out decimal) crashes device, ok in simulator
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20535552%5D%20New%3A%20Decimal.TryParse%28string%2C%0A%20out%20decimal%29%20crashes%20device%2C%20ok%20in%20simulator&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="092089.html">
   <LINK REL="Next"  HREF="092115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 535552] New: Decimal.TryParse(string, out decimal) crashes device, ok in simulator</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20535552%5D%20New%3A%20Decimal.TryParse%28string%2C%0A%20out%20decimal%29%20crashes%20device%2C%20ok%20in%20simulator&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 535552] New: Decimal.TryParse(string, out decimal) crashes device, ok in simulator">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Aug 31 05:51:09 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="092089.html">[Mono-bugs] [Bug 502205] Bug Buddy gets run when stopping the VS	debugger
</A></li>
        <LI>Next message: <A HREF="092115.html">[Mono-bugs] [Bug 535552] Decimal.TryParse(string, out decimal) crashes device, ok in simulator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92095">[ date ]</a>
              <a href="thread.html#92095">[ thread ]</a>
              <a href="subject.html#92095">[ subject ]</a>
              <a href="author.html#92095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=535552">http://bugzilla.novell.com/show_bug.cgi?id=535552</A>


           Summary: Decimal.TryParse(string, out decimal) crashes device,
                    ok in simulator
    Classification: Mono
           Product: MonoTouch
           Version: unspecified
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Class Libraries
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gnorton at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">craig.dunn at conceptdevelopment.net</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Beta-Customer


Decimal.TryParse() seems to work fine in the Simulator but causes application
to crash on iPhone 3GS 3.0.1

&gt;<i>From stacktrace (complete trace below):
</I>&quot;Assertion: should not be reached at ../../../../mono/mini/mini-darwin.c:232&quot;

Environment:
iPhone 3GS 3.0.1 32Gb 
MonoTouch b7 (28-Aug-09?)
MonoDevelop IDE 2.1.0 (late-august)
MacOS X Leopard

Code is here <A HREF="http://conceptdevelopment.net/iPhone/BillSplitter01/Main.cs.htm">http://conceptdevelopment.net/iPhone/BillSplitter01/Main.cs.htm</A>
and <A HREF="http://conceptdevelopment.net/iPhone/BillSplitter01/BillSplitterSoln.zip.">http://conceptdevelopment.net/iPhone/BillSplitter01/BillSplitterSoln.zip.</A>
Tested many many different values in the simulator with NO problems. Tested 5
different values on device and crashed every time.

Method follows - the inputs during device testing are set to 'valid' decimal
values (eg. textfieldTotal.Text = &quot;55&quot;, textfieldWine.Text=&quot;&quot;). If I change
variables &quot;total&quot;, &quot;wine&quot; and &quot;foodeach&quot; to int and use int.TryParse() it all
works fine (NO other modifications between the working and crashing versions) 

        private void Calculate()
        {
            decimal total = 0.0m;
            decimal wine = 0.0m;
            int pax = drinkers + nondrinkers;
            labelSplit.Text = &quot;-&quot;;
            labelSplit2.Text = &quot;-&quot;;
            if (pax &gt; 0)
            {
                string totalText =
textfieldTotal.Text==&quot;&quot;?&quot;0&quot;:textfieldTotal.Text; 
                string wineText =
textfieldWine.Text==&quot;&quot;?&quot;0&quot;:textfieldWine.Text;

                if (decimal.TryParse(totalText, out total))  // ### FAILS HERE
I think, but works if i change all the types to int and int.TryParse
                {                    
                    if (decimal.TryParse(wineText, out wine))
                    {
                        decimal foodeach = (total - wine) / pax;
                        if (foodeach &gt; 0)
                        {
                            labelTotal.Text = &quot;$ &quot; + total.ToString(&quot;#.00&quot;);
                            if (drinkers &gt; 0)
                            {
                                labelSplit.Text = (foodeach +
wine/drinkers).ToString(&quot;#.00&quot;);
                            }
                            else
                            {  // if no drinkers, add the wine back into the
bill
                                foodeach = (total) / pax;
                            }
                            if (nondrinkers &gt; 0)
                            {
                                labelSplit2.Text = (foodeach).ToString(&quot;#.00&quot;);
                            }
                        }
                        else Console.WriteLine(&quot;cannot be negative &quot; +
foodeach);
                    }
                }    
            }
        }



Stacktrace:

Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:
picker changed2 in 1
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:
Unregistered icall 'System.Decimal:string2decimal
(System.Decimal&amp;,string,uint,int)'
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:
Stacktrace:
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at (wrapper managed-to-native) System.Decimal.string2decimal
(System.Decimal&amp;,string,uint,int) &lt;0x00058&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at (wrapper managed-to-native) System.Decimal.string2decimal
(System.Decimal&amp;,string,uint,int) &lt;0xffffffff&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at System.Decimal.PerformParse
(string,System.Globalization.NumberStyles,System.IFormatProvider,System.Decimal&amp;,bool)
&lt;0x0052b&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at System.Decimal.TryParse (string,System.Decimal&amp;) &lt;0x000b7&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at BillSplitter.AppDelegate.Calculate () &lt;0x00283&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at BillSplitter.AppDelegate.set_NonDrinkers (int) &lt;0x000bb&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at BillSplitter.AppDelegate/PeopleModel.Selected
(MonoTouch.UIKit.UIPickerView,int,int) &lt;0x00133&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at (wrapper runtime-invoke) &lt;Module&gt;.runtime_invoke_void__this___object_int_int
(object,intptr,intptr,intptr) &lt;0xffffffff&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at (wrapper managed-to-native) MonoTouch.UIKit.UIApplication.UIApplicationMain
(int,string[],intptr,intptr) &lt;0xffffffff&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at MonoTouch.UIKit.UIApplication.Main (string[],string,string) &lt;0x000e0&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at MonoTouch.UIKit.UIApplication.Main (string[]) &lt;0x00023&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at BillSplitter.Application.Main (string[]) &lt;0x0001b&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:  
at (wrapper runtime-invoke) &lt;Module&gt;.runtime_invoke_void_object
(object,intptr,intptr,intptr) &lt;0xffffffff&gt;
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:
Native stacktrace:
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
0   NewWorld                            0x00039768 mono_handle_native_sigsegv +
396
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
1   NewWorld                            0x00056158 sigabrt_signal_handler + 124
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
2   libSystem.B.dylib                   0x31dc260b _sigtramp + 42
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
3   libSystem.B.dylib                   0x31dc4763 kill + 10
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
4   libSystem.B.dylib                   0x31dc4755 raise + 16
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
5   libSystem.B.dylib                   0x31dd94a1 abort + 40
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
6   NewWorld                            0x00190dfc g_logv + 248
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
7   NewWorld                            0x00190e54 g_log + 52
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
8   NewWorld                            0x00007a74 mono_resolve_patch_target +
2312
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
9   NewWorld                            0x00029758 mono_aot_plt_resolve + 392
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
10  NewWorld                            0x0003bbe8 mono_aot_plt_trampoline + 64
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;:    
11  NewWorld                            0x0037de04 generic_trampoline_6 + 116
Mon Aug 31 19:16:01 unknown
UIKitApplication:net.conceptdevelopment.billsplitter[0xda28][580] &lt;Notice&gt;: *
Assertion: should not be reached at ../../../../mono/mini/mini-darwin.c:232

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="092089.html">[Mono-bugs] [Bug 502205] Bug Buddy gets run when stopping the VS	debugger
</A></li>
	<LI>Next message: <A HREF="092115.html">[Mono-bugs] [Bug 535552] Decimal.TryParse(string, out decimal) crashes device, ok in simulator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#92095">[ date ]</a>
              <a href="thread.html#92095">[ thread ]</a>
              <a href="subject.html#92095">[ subject ]</a>
              <a href="author.html#92095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
