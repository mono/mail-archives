<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 603378] New: sharing the SafeFileHandle from FileStream does not behave like Microsoft's .NET FileStream
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20603378%5D%20New%3A%20sharing%20the%20SafeFileHandle%20from%0A%20FileStream%20does%20not%20behave%20like%20Microsoft%27s%20.NET%20FileStream&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="100266.html">
   <LINK REL="Next"  HREF="100787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 603378] New: sharing the SafeFileHandle from FileStream does not behave like Microsoft's .NET FileStream</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20603378%5D%20New%3A%20sharing%20the%20SafeFileHandle%20from%0A%20FileStream%20does%20not%20behave%20like%20Microsoft%27s%20.NET%20FileStream&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 603378] New: sharing the SafeFileHandle from FileStream does not behave like Microsoft's .NET FileStream">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu May  6 11:30:50 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="100266.html">[Mono-bugs] [Bug 593475] We show all inherited fields and properties instead of using the &quot;base&quot; item line.
</A></li>
        <LI>Next message: <A HREF="100787.html">[Mono-bugs] [Bug 603378] sharing the SafeFileHandle from FileStream does not behave like Microsoft's .NET FileStream
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100267">[ date ]</a>
              <a href="thread.html#100267">[ thread ]</a>
              <a href="subject.html#100267">[ subject ]</a>
              <a href="author.html#100267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=603378">http://bugzilla.novell.com/show_bug.cgi?id=603378</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=603378#c0">http://bugzilla.novell.com/show_bug.cgi?id=603378#c0</A>


           Summary: sharing the SafeFileHandle from FileStream does not
                    behave like Microsoft's .NET FileStream
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: CORLIB
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">adam.amitai at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=360152)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=360152">http://bugzilla.novell.com/attachment.cgi?id=360152</A>)
repro and solution proposal

User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.3)
Gecko/20100401 Firefox/3.6.3

In case of two instances of FileStream, that share the same SafeFileHandle, or
a user using the FileStream's SafeFileHandle with some native API - the
Position property and Seek method, as well as the Write() orders do not behave
not correctly, or like Microsoft's FileStream for that matter, because of the
internal buffering implementation.

Another side effect is that when getting a SafeFileHandle in case that the
FileStream is the handle owner (by calling the SafeFileHandle getter) - the new
SafeFileHandle returned by the getter marked owner, which in turn causes the
mono runtime to report a warning about trying to unref an unused handle at
Disposal.

For that bug i have consulted jonp on the IRC chat.



Reproducible: Always

Steps to Reproduce:
I have attached a two files:
exposed-handle-repro.cs  - The repro for the bug
exposed-handle-patch.diff - a (proposed) patch to solve the issues

gmcs exposed-handle-repro.cs
/exposed-handle-repro.exe

Actual Results:  
The output is AAA.(the print of the stream).
further more you can see the error returned by the second problem (the owner
problem). 

Expected Results:  
The output should be: AAABBB(the print of the stream).
And should quit gracefully.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="100266.html">[Mono-bugs] [Bug 593475] We show all inherited fields and properties instead of using the &quot;base&quot; item line.
</A></li>
	<LI>Next message: <A HREF="100787.html">[Mono-bugs] [Bug 603378] sharing the SafeFileHandle from FileStream does not behave like Microsoft's .NET FileStream
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100267">[ date ]</a>
              <a href="thread.html#100267">[ thread ]</a>
              <a href="subject.html#100267">[ subject ]</a>
              <a href="author.html#100267">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
