<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 602659] New: SslStream.AuthenticateAsServer incompatibility with .NET
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20602659%5D%20New%3A%20SslStream.AuthenticateAsServer%0A%20incompatibility%20with%20.NET&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="100184.html">
   <LINK REL="Next"  HREF="100187.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 602659] New: SslStream.AuthenticateAsServer incompatibility with .NET</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20602659%5D%20New%3A%20SslStream.AuthenticateAsServer%0A%20incompatibility%20with%20.NET&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 602659] New: SslStream.AuthenticateAsServer incompatibility with .NET">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed May  5 02:52:43 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="100184.html">[Mono-bugs] [Bug 542485] Fix for KeventWatcher
</A></li>
        <LI>Next message: <A HREF="100187.html">[Mono-bugs] [Bug 602659] SslStream.AuthenticateAsServer incompatibility with .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100186">[ date ]</a>
              <a href="thread.html#100186">[ thread ]</a>
              <a href="subject.html#100186">[ subject ]</a>
              <a href="author.html#100186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=602659">http://bugzilla.novell.com/show_bug.cgi?id=602659</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=602659#c0">http://bugzilla.novell.com/show_bug.cgi?id=602659#c0</A>


           Summary: SslStream.AuthenticateAsServer incompatibility with
                    .NET
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.4.x AddOn CD
          Platform: x86-64
        OS/Version: SLES 11
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">maciej.paszta at secpl.cs.put.poznan.pl</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.3)
Gecko/20100401 Firefox/3.6.3

When calling AuthenticateAsServer on SslStream, call hangs and no callback is
made on the client side to validate server's certificate. 

Reproducible: Always

Steps to Reproduce:
1. Setup server side of SslStream
2. Setup client's cert validation callback to alway return true
3. Call AuthenticateAsServer
4. Setup client side of SslStream and connect to previously prepared server
5. Setup callback to provide server with client certificate and callback for
server's cert validation.
6. Call AuthenticateAsClient... wait for the server's cert validation to be
called on the client side and wait for the exit from AuthenticateAsServer
method on the server side.
Actual Results:  
Server hangs and the code never exits from AuthenticateAsServer

Expected Results:  
Server's certificate validation callback should be called on the client side,
and server's code should exit from call to AuthenticateAsServer().

The code works as expected on .NET Framework. The code was tested on both Mono
2.4 (Mono Extensions) and on Mono 2.6 from openSuse's Build Service. After
examining the code in:

System.Net.Security/SslStream.cs

It appears that after the call to BeginAuthenticateAsServer server start
reading from the socket and, ineed, when I call:

m_sslClient.Write(new byte[] { 0 });

on the client side, authentication process finishes at both the client and the
server side, this works differently to the SslStream implementiation in .NET.
When change is made to SslStream.cs to start writing in
BeginAuthenticateAsServer() that is 

return BeginRead (new byte [0], 0, 0, callback, asyncState);

is changed to

return BeginWrite (new byte [0], 0, 0, callback, asyncState);

The code starts working as expected.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="100184.html">[Mono-bugs] [Bug 542485] Fix for KeventWatcher
</A></li>
	<LI>Next message: <A HREF="100187.html">[Mono-bugs] [Bug 602659] SslStream.AuthenticateAsServer incompatibility with .NET
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100186">[ date ]</a>
              <a href="thread.html#100186">[ thread ]</a>
              <a href="subject.html#100186">[ subject ]</a>
              <a href="author.html#100186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
