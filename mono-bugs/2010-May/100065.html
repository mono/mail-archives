<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 601727] New: Cannot use Web Forms MD5	authentications
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20601727%5D%20New%3A%20Cannot%20use%20Web%20Forms%20MD5%0A%09authentications&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="100064.html">
   <LINK REL="Next"  HREF="100066.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 601727] New: Cannot use Web Forms MD5	authentications</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20601727%5D%20New%3A%20Cannot%20use%20Web%20Forms%20MD5%0A%09authentications&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 601727] New: Cannot use Web Forms MD5	authentications">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat May  1 16:29:34 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="100064.html">[Mono-bugs] [Bug 600214] Error running simple ASP.NET application with references (amd64 build)
</A></li>
        <LI>Next message: <A HREF="100066.html">[Mono-bugs] [Bug 601727] Cannot use Web Forms MD5 authentications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100065">[ date ]</a>
              <a href="thread.html#100065">[ thread ]</a>
              <a href="subject.html#100065">[ subject ]</a>
              <a href="author.html#100065">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=601727">http://bugzilla.novell.com/show_bug.cgi?id=601727</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=601727#c0">http://bugzilla.novell.com/show_bug.cgi?id=601727#c0</A>


           Summary: Cannot use Web Forms MD5 authentications
    Classification: Mono
           Product: Mono: Class Libraries
           Version: unspecified
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.Web
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">djechelon at fastwebnet.it</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: Customer
           Blocker: No


Description of Problem:
I currently use Web Forms authentication in my ASP.NET app. Web.config like the
following

    &lt;authentication mode=&quot;Forms&quot; &gt;
      &lt;forms loginUrl=&quot;Login.aspx&quot; protection=&quot;All&quot; slidingExpiration=&quot;true&quot;
timeout=&quot;10&quot;&gt;
        &lt;credentials passwordFormat=&quot;MD5&quot;&gt;
          &lt;user name=&quot;admin&quot; password=&quot;[md5 hash]&quot; /&gt;
        &lt;/credentials&gt;
      &lt;/forms&gt;
    &lt;/authentication&gt;

Under Windows it works fine and I get authenticated.
When using Mono, my login gets refused.

Could't test the same MD5 credentials with other authentication techniques


Steps to reproduce the problem:
1. Configure Web.config like above
2. Create Login.aspx page with at least the following control:

&lt;asp:Login ID=&quot;loginControl&quot; runat=&quot;server&quot; LoginButtonType=&quot;Button&quot;
Orientation=&quot;Vertical&quot; CssClass=&quot;fieldlabel&quot;
            RememberMeSet=&quot;false&quot; TitleText=&quot;Login&quot;
OnAuthenticate=&quot;loginControl_Authenticate&quot;&gt;

and correspondant code-behind method:

        protected void loginControl_Authenticate(object sender,
AuthenticateEventArgs e)
        {
            e.Authenticated =
FormsAuthentication.Authenticate(loginControl.UserName, loginControl.Password);
        }

3. Test with proper credentials

Actual Results:
Your password is always refused

Expected Results:
Your password, matching MD5 hash, should be accepted

How often does this happen? 
Always

Additional Information:
The problem is in the FormsAuthentication.Authenticate(string,string) static
method, that should return true but returns false.
I looked into Mono code, its implementation seems correct (input password is
MD5-hashed if configuration requires hashing, then compared to stored password)
but... &quot;return (password == stored);&quot; statement might be the problem.
It COULD be a casing problem. If the password is stored as lowercase hex but
GetHexString returns uppercase hex or vice versa it could be causing the
problem.

I looked at GetHexString, and, as I remember, its return value is uppercase
judging by ASCII codes involved. My MD5 string in my example is lowercase.

Suggested solutions:
1. When comparing passwords, use case insensitive comparison when password is
hashed, else use case sensitive (passwords are plaintext)
2. Explicitly uppercase the stored password before comparison with hash

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="100064.html">[Mono-bugs] [Bug 600214] Error running simple ASP.NET application with references (amd64 build)
</A></li>
	<LI>Next message: <A HREF="100066.html">[Mono-bugs] [Bug 601727] Cannot use Web Forms MD5 authentications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100065">[ date ]</a>
              <a href="thread.html#100065">[ thread ]</a>
              <a href="subject.html#100065">[ subject ]</a>
              <a href="author.html#100065">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
