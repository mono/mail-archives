<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 342584] Cast from IntPtr to Enum fails with CS0030
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20342584%5D%20Cast%20from%20IntPtr%20to%20Enum%20fails%20with%20CS0030&In-Reply-To=bug-342584-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="065453.html">
   <LINK REL="Next"  HREF="065507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 342584] Cast from IntPtr to Enum fails with CS0030</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20342584%5D%20Cast%20from%20IntPtr%20to%20Enum%20fails%20with%20CS0030&In-Reply-To=bug-342584-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 342584] Cast from IntPtr to Enum fails with CS0030">bugzilla_noreply at novell.com
       </A><BR>
    <I>Mon Nov 19 08:05:45 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="065453.html">[Mono-bugs] [Bug 342584] Cast from IntPtr to Enum fails with CS0030
</A></li>
        <LI>Next message: <A HREF="065507.html">[Mono-bugs] [Bug 342584] [Regression] Cast from IntPtr to Enum	fails with CS0030
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65456">[ date ]</a>
              <a href="thread.html#65456">[ thread ]</a>
              <a href="subject.html#65456">[ subject ]</a>
              <a href="author.html#65456">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=342584#c2">https://bugzilla.novell.com/show_bug.cgi?id=342584#c2</A>





--- Comment #2 from Marek Safar &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">msafar at novell.com</A>&gt;  2007-11-19 06:05:45 MST ---
csc produces this

  IL_0001:  ldloca.s   V_0
  IL_0003:  ldc.i4.1
  IL_0004:  call       instance void [mscorlib]System.IntPtr::.ctor(int32)
  IL_0009:  nop
  IL_000a:  ldloc.0
  IL_000b:  call       int32 [mscorlib]System.IntPtr::op_Explicit(native int)
  IL_0010:  stloc.1
  IL_0011:  ret

so there is an explicit operator call. However following code is exactly same
except it uses custom type instead of IntPtr and it gets rejected by csc.
This looks like another csc weirdness.

Secondly changing enum base type to ulong has no effect and csc still uses
explicit int32 (IntPtr) conversion and then conv.i8


enum Key
{
        V
}

struct S
{
        public static explicit operator int (S val)
        {
                return 1;
        }
}

class C
{
        E Foo ()
        {
                S s = new S ();
                return (Key) s;
        }
}


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>














































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="065453.html">[Mono-bugs] [Bug 342584] Cast from IntPtr to Enum fails with CS0030
</A></li>
	<LI>Next message: <A HREF="065507.html">[Mono-bugs] [Bug 342584] [Regression] Cast from IntPtr to Enum	fails with CS0030
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65456">[ date ]</a>
              <a href="thread.html#65456">[ thread ]</a>
              <a href="subject.html#65456">[ subject ]</a>
              <a href="author.html#65456">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
