<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 323524] Mono 1.2.3 Solaris build has problems with Socket.BeginConnect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20323524%5D%20Mono%201.2.3%20Solaris%20build%20has%20problems%20with%0A%20Socket.BeginConnect&In-Reply-To=bug-323524-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="065660.html">
   <LINK REL="Next"  HREF="065661.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 323524] Mono 1.2.3 Solaris build has problems with Socket.BeginConnect</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20323524%5D%20Mono%201.2.3%20Solaris%20build%20has%20problems%20with%0A%20Socket.BeginConnect&In-Reply-To=bug-323524-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 323524] Mono 1.2.3 Solaris build has problems with Socket.BeginConnect">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Nov 21 14:00:24 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="065660.html">[Mono-bugs] [Bug 343465] [g]mcs do not encode inner types exactly like MS csc does
</A></li>
        <LI>Next message: <A HREF="065661.html">[Mono-bugs] [Bug 343470] New: gmcs reports CS0657 as an error instead of a warning
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65655">[ date ]</a>
              <a href="thread.html#65655">[ thread ]</a>
              <a href="subject.html#65655">[ subject ]</a>
              <a href="author.html#65655">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=323524#c4">https://bugzilla.novell.com/show_bug.cgi?id=323524#c4</A>


Burkhard Linke &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">burkhard.linke at CeBiTec.Uni-Bielefeld.DE</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
             Status|NEEDINFO                                        |ASSIGNED
      Info Provider|<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">psingh at fnfr.com</A>                                 |




--- Comment #4 from Burkhard Linke &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">burkhard.linke at CeBiTec.Uni-Bielefeld.DE</A>&gt;  2007-11-21 12:00:24 MST ---
I've traced the mono runtime using dtrace and a little script that lists the
syscalls and scheduling action of the solaris kernel for the most recent thread
(the mono io thread, thread id 4 in the output):

started syscall pollsys in thread 4, initiated by

              libc.so.1`__pollsys+0x7
              libc.so.1`poll+0x52
              mono`mono_poll+0x21
              mono`socket_io_poll_main+0x8c
              mono`start_wrapper+0xcf
              mono`thread_start_routine+0xae
              libgc.so.1.0.3`GC_inner_start_routine+0xd0
              libgc.so.1.0.3`GC_call_with_stack_base+0x1c
              libgc.so.1.0.3`GC_start_routine+0x28
              libc.so.1`_thr_setup+0x4e
              libc.so.1`_lwp_start
started syscall read in thread 4, initiated by

              libc.so.1`_read+0x7
              mono`socket_io_poll_main+0x18e
              mono`start_wrapper+0xcf
              mono`thread_start_routine+0xae
              libgc.so.1.0.3`GC_inner_start_routine+0xd0
              libgc.so.1.0.3`GC_call_with_stack_base+0x1c
              libgc.so.1.0.3`GC_start_routine+0x28
              libc.so.1`_thr_setup+0x4e
              libc.so.1`_lwp_start
started syscall gtime in thread 4, initiated by

              libc.so.1`__time+0x7
              mono`_wapi_handle_ref+0x1f
              mono`sem_release+0x255
              mono`ReleaseSemaphore+0x3a
              mono`socket_io_poll_main+0x1c3
              mono`start_wrapper+0xcf
              mono`thread_start_routine+0xae
              libgc.so.1.0.3`GC_inner_start_routine+0xd0
              libgc.so.1.0.3`GC_call_with_stack_base+0x1c
              libgc.so.1.0.3`GC_start_routine+0x28
              libc.so.1`_thr_setup+0x4e
              libc.so.1`_lwp_start
started syscall pollsys in thread 4, initiated by

              libc.so.1`__pollsys+0x7
              libc.so.1`poll+0x52
              mono`mono_poll+0x21
              mono`socket_io_poll_main+0x8c
              mono`start_wrapper+0xcf
              mono`thread_start_routine+0xae
              libgc.so.1.0.3`GC_inner_start_routine+0xd0
              libgc.so.1.0.3`GC_call_with_stack_base+0x1c
              libgc.so.1.0.3`GC_start_routine+0x28
              libc.so.1`_thr_setup+0x4e
              libc.so.1`_lwp_start
got sched probe sleep for tid 4
got sched probe dequeue for tid 4
got sched probe off-cpu for tid 4

(The build uses a local installation of libgc, since the version inside the
mono source tree is updated with respect to solaris/x86.)

The next traces of thread 4:

got sched probe on-cpu for tid 4
started syscall lwp_mutex_timedlock in thread 4, initiated by

              ld.so.1`___lwp_mutex_timedlock+0x7
              ld.so.1`rt_mutex_lock+0x1b
              ld.so.1`enter+0x30
              ld.so.1`elf_bndr+0x25
              ld.so.1`elf_rtbndr+0x14
              ld.so.1`0xbfffd8f8
              mono`thread_cleanup+0x1c
              mono`start_wrapper+0xd9
              mono`thread_start_routine+0xae
              libgc.so.1.0.3`GC_inner_start_routine+0xd0
              libgc.so.1.0.3`GC_call_with_stack_base+0x1c
              libgc.so.1.0.3`GC_start_routine+0x28
              libc.so.1`_thr_setup+0x4e
              libc.so.1`_lwp_start

This happens after the connect timeout and the thread is about to terminate.
The problem seems to be located in the socket_io_poll_main() routine in
mono/metadata/threadpool.c. Solaris does not support epoll, so
socket_io_epoll_main cannot be used on this platform. I haven't figured out the
complete code in threadpool.c yet, but the problem should be located there.


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>



















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="065660.html">[Mono-bugs] [Bug 343465] [g]mcs do not encode inner types exactly like MS csc does
</A></li>
	<LI>Next message: <A HREF="065661.html">[Mono-bugs] [Bug 343470] New: gmcs reports CS0657 as an error instead of a warning
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65655">[ date ]</a>
              <a href="thread.html#65655">[ thread ]</a>
              <a href="subject.html#65655">[ subject ]</a>
              <a href="author.html#65655">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
