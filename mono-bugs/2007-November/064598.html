<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 322904] UserControl.OnEnter, OnLeave are not called when the user clicks on controls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20322904%5D%20UserControl.OnEnter%2C%0A%20OnLeave%20are%20not%20called%20when%20the%20user%20clicks%20on%20controls&In-Reply-To=bug-322904-28286%40https.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="064597.html">
   <LINK REL="Next"  HREF="064599.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 322904] UserControl.OnEnter, OnLeave are not called when the user clicks on controls</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20322904%5D%20UserControl.OnEnter%2C%0A%20OnLeave%20are%20not%20called%20when%20the%20user%20clicks%20on%20controls&In-Reply-To=bug-322904-28286%40https.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 322904] UserControl.OnEnter, OnLeave are not called when the user clicks on controls">bugzilla_noreply at novell.com
       </A><BR>
    <I>Tue Nov  6 11:15:39 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="064597.html">[Mono-bugs] [Bug 322056] Regex.Replace bug
</A></li>
        <LI>Next message: <A HREF="064599.html">[Mono-bugs] [Bug 322904] UserControl.OnEnter, OnLeave are not called when the user clicks on controls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64598">[ date ]</a>
              <a href="thread.html#64598">[ thread ]</a>
              <a href="subject.html#64598">[ subject ]</a>
              <a href="author.html#64598">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=322904#c1">https://bugzilla.novell.com/show_bug.cgi?id=322904#c1</A>


George Giolfan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">georgegiolfan at yahoo.com</A>&gt; changed:

           What    |Removed                                         |Added
----------------------------------------------------------------------------
             Status|CLOSED                                          |REOPENED
         Resolution|FIXED                                           |




--- Comment #1 from George Giolfan &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">georgegiolfan at yahoo.com</A>&gt;  2007-11-06 09:15:38 MST ---
The patch for bug 325809 causes a regression. Sorry.
The attached patch simply reintroduces the code that was removed from Control.
This is not enough however, because the following test fails. The same thing
happens for ListView (stack trace reveals that it calls Control.FocusInternal
when it gets a WM_LBUTTONDOWN).

using System;
using System.Diagnostics;
using System.Drawing;
using System.Windows.Forms;

static class Test
{
        static void Main ()
        {
                new TestForm ().Show ();
        }
}

class TestForm : Form
{
        FocusTestControl c1 = new FocusTestControl ();
        FocusTestControl c2 = new FocusTestControl ();

        public TestForm ()
        {
                c1.Text = &quot;1&quot;;
                c2.Text = &quot;2&quot;;
                c2.Dock = DockStyle.Fill;
                Controls.AddRange (new Control [] { c1, c2 });
        }

        protected override void OnLoad (EventArgs e)
        {
                base.OnLoad (e);
                Debug.Assert (!c1.Focused, &quot;1&quot;);
                Debug.Assert (!c2.Focused, &quot;2&quot;);
                Debug.Assert (ActiveControl == null, &quot;3&quot;);
                Debug.Assert (c1.SelectCalls == 0, &quot;4&quot;);
                Debug.Assert (c2.SelectCalls == 0, &quot;5&quot;);
                Debug.Assert (c2.OnMouseDownCalls == 0, &quot;6&quot;);
                Debug.Assert (c2.OnEnterCalls == 0, &quot;7&quot;);
                c2.SimulateClick ();
                Debug.Assert (!c1.Focused, &quot;1 1&quot;);
                Debug.Assert (!c2.Focused, &quot;2 1&quot;);
                Debug.Assert (ActiveControl == null, &quot;3 1&quot;);
                Debug.Assert (c1.SelectCalls == 0, &quot;4 1&quot;);
                Debug.Assert (c2.SelectCalls == 0, &quot;5 1&quot;);
                Debug.Assert (c2.OnMouseDownCalls == 1, &quot;6 1&quot;);
                Debug.Assert (c2.OnEnterCalls == 0, &quot;7 1&quot;);
        }
}

class FocusTestControl : UserControl
{
        public int SelectCalls;
        public int OnMouseDownCalls;
        public int OnEnterCalls;

        public void SimulateClick ()
        {
                const int WM_LBUTTONDOWN = 0x0201;
                const int MK_LBUTTON = 0x0001;
                Message m = new Message ();
                m.Msg = WM_LBUTTONDOWN;
                m.WParam = (IntPtr)MK_LBUTTON;
                Debug.Assert (CanSelect);
                WndProc (ref m);
        }

        protected override void Select (bool directed, bool forward)
        {
                base.Select (directed, forward);
                SelectCalls++;
        }

        protected override void OnMouseDown (MouseEventArgs e)
        {
                base.OnMouseDown (e);
                OnMouseDownCalls++;
        }

        protected override void OnEnter (EventArgs e)
        {
                base.OnEnter (e);
                OnEnterCalls++;
        }
}


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="064597.html">[Mono-bugs] [Bug 322056] Regex.Replace bug
</A></li>
	<LI>Next message: <A HREF="064599.html">[Mono-bugs] [Bug 322904] UserControl.OnEnter, OnLeave are not called when the user clicks on controls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64598">[ date ]</a>
              <a href="thread.html#64598">[ thread ]</a>
              <a href="subject.html#64598">[ subject ]</a>
              <a href="author.html#64598">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
