<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 341743] New: Odbc: SIGSEGV in	OdbcCommand.FreeStatement
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20341743%5D%20New%3A%20Odbc%3A%20SIGSEGV%20in%0A%09OdbcCommand.FreeStatement&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="065135.html">
   <LINK REL="Next"  HREF="065138.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 341743] New: Odbc: SIGSEGV in	OdbcCommand.FreeStatement</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20341743%5D%20New%3A%20Odbc%3A%20SIGSEGV%20in%0A%09OdbcCommand.FreeStatement&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 341743] New: Odbc: SIGSEGV in	OdbcCommand.FreeStatement">bugzilla_noreply at novell.com
       </A><BR>
    <I>Wed Nov 14 16:00:38 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="065135.html">[Mono-bugs] [Bug 341726] Odbc: Wrong number of affected record returned for batches
</A></li>
        <LI>Next message: <A HREF="065138.html">[Mono-bugs] [Bug 341743] Odbc: SIGSEGV in OdbcCommand.FreeStatement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65137">[ date ]</a>
              <a href="thread.html#65137">[ thread ]</a>
              <a href="subject.html#65137">[ subject ]</a>
              <a href="author.html#65137">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=341743">https://bugzilla.novell.com/show_bug.cgi?id=341743</A>

           Summary: Odbc: SIGSEGV in OdbcCommand.FreeStatement
           Product: Mono: Class Libraries
           Version: 1.2.6
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.Data
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">vvaradhan at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gert.driesen at pandora.be</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: ---


When an OdbcConnection is finalized before a given OdbcCommand that is
associated with that OdbcConnection, then a SIGSEGV is reported because the
handle of the SQL statement should've been released before the connection
handle is released.

There are (at least) two cases where the SQL statement handle is not
immediately closed:

1) When the OdbcCommand is prepared.
2) When the SQL statement cannot be successfully executed in
OdbcCommand.ExecuteNonQuery.

The second case actually seems like a bug to me. We should probably free the
statement handle in a finally there (when freeHandle is true and prepared is
false).

The first case is not something that can be fixed in OdbcCommand itself. The
only way to ensure that the statement handles are released before the
connection handle is released, is by disposing all OdbcCommand instances
associated with the OdbcConnection.

To reproduce:

1. modify the values in the CreateOdbcConnectionString method of the attached
source code to match your local setup.
2. compile and run it.

Actual result:

Stacktrace:

  at (wrapper managed-to-native) System.Data.Odbc.libodbc.SQLFreeStmt
(intptr,Sy
stem.Data.Odbc.libodbc/SQLFreeStmtOptions) &lt;0x00004&gt;
  at (wrapper managed-to-native) System.Data.Odbc.libodbc.SQLFreeStmt
(intptr,Sy
stem.Data.Odbc.libodbc/SQLFreeStmtOptions) &lt;0xffffffff&gt;
  at System.Data.Odbc.OdbcCommand.FreeStatement () &lt;0x0001f&gt;
  at System.Data.Odbc.OdbcCommand.Dispose (bool) &lt;0x00014&gt;
  at System.ComponentModel.Component.Dispose () &lt;0x0000d&gt;
  at (wrapper remoting-invoke-with-check)
System.ComponentModel.Component.Dispos
e () &lt;0xffffffff&gt;
  at Program.Main () &lt;0x0031a&gt;
  at (wrapper runtime-invoke) Program.runtime_invoke_int
(object,intptr,intptr,i
ntptr) &lt;0xffffffff&gt;

This application has requested the Runtime to terminate it in an unusual way.
Please contact the application's support team for more information.

Expected result:

Successful execution (exit code 0)


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="065135.html">[Mono-bugs] [Bug 341726] Odbc: Wrong number of affected record returned for batches
</A></li>
	<LI>Next message: <A HREF="065138.html">[Mono-bugs] [Bug 341743] Odbc: SIGSEGV in OdbcCommand.FreeStatement
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65137">[ date ]</a>
              <a href="thread.html#65137">[ thread ]</a>
              <a href="subject.html#65137">[ subject ]</a>
              <a href="author.html#65137">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
