<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 341986] New: Thread safety problem with regexp on	1.2.6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20341986%5D%20New%3A%20Thread%20safety%20problem%20with%20regexp%20on%0A%091.2.6&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="065220.html">
   <LINK REL="Next"  HREF="065191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 341986] New: Thread safety problem with regexp on	1.2.6</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20341986%5D%20New%3A%20Thread%20safety%20problem%20with%20regexp%20on%0A%091.2.6&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 341986] New: Thread safety problem with regexp on	1.2.6">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Nov 15 11:49:17 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="065220.html">[Mono-bugs] [Bug 341938] Linker issue ?
</A></li>
        <LI>Next message: <A HREF="065191.html">[Mono-bugs] [Bug 341986] [Regression] Thread safety problem with	regexp on 1.2.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65188">[ date ]</a>
              <a href="thread.html#65188">[ thread ]</a>
              <a href="subject.html#65188">[ subject ]</a>
              <a href="author.html#65188">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="https://bugzilla.novell.com/show_bug.cgi?id=341986">https://bugzilla.novell.com/show_bug.cgi?id=341986</A>

           Summary: Thread safety problem with regexp on 1.2.6
           Product: Mono: Class Libraries
           Version: 1.2.6
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">informatique.internet at fiducial.fr</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
          Found By: ---


The Regexp object is supposed to be thread safe : cf
<A HREF="http://msdn2.microsoft.com/en-us/library/system.text.regularexpressions.regex(vs.71">http://msdn2.microsoft.com/en-us/library/system.text.regularexpressions.regex(vs.71</A>).aspx

Try this program with mono 1.2.6 (branch) or svn 
using System;
using System.Text.RegularExpressions;
using System.Text;
using System.Threading;

class MainClass
{

        public static void Main(string[] args)
        {
                Console.WriteLine(&quot;Hello World!&quot;);
                //string
resultat=ReplaceParameterValue(query,&quot;:pTRA_LIBELLE_LONG&quot;,&quot;$1::text&quot;);
                regexpthreadtest();

        }

        private static Regex parameterReplace = new Regex(@&quot;([:@][\w\.]*)&quot;,
RegexOptions.Singleline);

        private static void regexpthreadtest()
        {
                MainClass main=new MainClass();
                ThreadStart job = new ThreadStart(main.regexp_test);
                Thread thread = new Thread(job);
                thread.Start();
                Thread thread1 = new Thread(job);
                thread1.Start();

        }

        private void regexp_test()
        {
                string command=&quot;SELECT READ_WRITE FROM PERMISSIONS WHERE
USERID=:puserid AND CALENDARID=:pcalendarid&quot;;
                string[] parames=parameterReplace.Split(command);
                foreach (string param in parames)
                        Console.WriteLine(param);
        }
}

this fails with mono 1.2.6 or svn with :
Unhandled Exception: System.NullReferenceException: Object reference not set to 
an instance of an object
  at System.Text.RegularExpressions.Interpreter.Eval (Mode mode, System.Int32&amp;
r
ef_ptr, Int32 pc) [0x0101d] in
/home/hubert/mono/mcs/class/System/System.Text.Re
gularExpressions/interpreter.cs:700 
  at System.Text.RegularExpressions.Interpreter.Eval (Mode mode, System.Int32&amp;
r
ef_ptr, Int32 pc) [0x00ecc] in
/home/hubert/mono/mcs/class/System/System.Text.Re
gularExpressions/interpreter.cs:653 
  at System.Text.RegularExpressions.Interpreter.TryMatch (System.Int32&amp;
ref_ptr,
 Int32 pc) [0x00022] in
/home/hubert/mono/mcs/class/System/System.Text.RegularEx
pressions/interpreter.cs:829 
  at System.Text.RegularExpressions.Interpreter.Eval (Mode mode, System.Int32&amp;
r
ef_ptr, Int32 pc) [0x003e1] in
/home/hubert/mono/mcs/class/System/System.Text.Re
gularExpressions/interpreter.cs:211 
  at System.Text.RegularExpressions.Interpreter.Scan
(System.Text.RegularExpress
ions.Regex regex, System.String text, Int32 start, Int32 end) [0x00016] in
/home
/hubert/mono/mcs/class/System/System.Text.RegularExpressions/interpreter.cs:69 
  at System.Text.RegularExpressions.Regex.Match (System.String input, Int32
star
tat) [0x00000] in
/home/hubert/mono/mcs/class/System/System.Text.RegularExpressi
ons/Regex.cs:339 
  at System.Text.RegularExpressions.BaseMachine.Split
(System.Text.RegularExpres
sions.Regex regex, System.String input, Int32 count, Int32 startat) [0x0002f]
in

/home/hubert/mono/mcs/class/System/System.Text.RegularExpressions/BaseMachine.c
s:62 
  at System.Text.RegularExpressions.Regex.Split (System.String input, Int32
coun
t, Int32 startat) [0x00000] in
/home/hubert/mono/mcs/class/System/System.Text.Re
gularExpressions/Regex.cs:419 
  at System.Text.RegularExpressions.Regex.Split (System.String input) [0x00010] 
in
/home/hubert/mono/mcs/class/System/System.Text.RegularExpressions/Regex.cs:40
9 
  at MainClass.regexp_test () [0x00006] in
/home/hubert/Projects/regexp/Main.cs:
37 
  at (wrapper delegate-invoke) System.MulticastDelegate:invoke_void ()


This works for mono 1.2.5, 1.2.4, 1.1.17 (tested)

I hope this could be fixed for 1.2.6 release... because this breaks all our
programs...

Thanks


-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="065220.html">[Mono-bugs] [Bug 341938] Linker issue ?
</A></li>
	<LI>Next message: <A HREF="065191.html">[Mono-bugs] [Bug 341986] [Regression] Thread safety problem with	regexp on 1.2.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#65188">[ date ]</a>
              <a href="thread.html#65188">[ thread ]</a>
              <a href="subject.html#65188">[ subject ]</a>
              <a href="author.html#65188">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
