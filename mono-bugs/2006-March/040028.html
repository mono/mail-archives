<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 77382][Min] Changed - System.Uri ctor could be
	faster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077382%5D%5BMin%5D%20Changed%20-%20System.Uri%20ctor%20could%20be%0A%09faster&In-Reply-To=bug-77382%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040027.html">
   <LINK REL="Next"  HREF="040029.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 77382][Min] Changed - System.Uri ctor could be
	faster</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077382%5D%5BMin%5D%20Changed%20-%20System.Uri%20ctor%20could%20be%0A%09faster&In-Reply-To=bug-77382%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 77382][Min] Changed - System.Uri ctor could be
	faster">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Mon Mar 13 04:49:46 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="040027.html">[Mono-bugs] [Bug 77770][Wis] Changed - [GMCS] Regression in IL
	verification of generic code from mscorlib
</A></li>
        <LI>Next message: <A HREF="040029.html">[Mono-bugs] [Bug 77770][Wis] Changed - [GMCS] Regression in IL
	verification of generic code from mscorlib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40028">[ date ]</a>
              <a href="thread.html#40028">[ thread ]</a>
              <a href="subject.html#40028">[ subject ]</a>
              <a href="author.html#40028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">pawel.sakowski at mind-breeze.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=77382">http://bugzilla.ximian.com/show_bug.cgi?id=77382</A>

--- shadow/77382	2006-03-10 03:46:14.000000000 -0500
+++ shadow/77382.tmp.8394	2006-03-13 04:49:45.000000000 -0500
@@ -49,6 +49,36 @@
 It would be nicer if we can reduce extra allocation.
 
 One concern is that cultude dependent code should be avoided. So
 please replace String.StartsWith() with CompareInfo.IsPrefix(). Can
 you also please provide some performance comparison results with
 reproducible code?
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">pawel.sakowski at mind-breeze.com</A>  2006-03-13 04:49 -------
+- &quot;reduce extra allocation&quot;: the attached patch does just that.
+
+- &quot;culture dependent code should be avoided&quot;: also done by the patch
+
+- &quot;CompareInfo.IsPrefix&quot;: actually, since only 1- or 2-character
+prefixes are checked in Uri, I did explicit char-by-char comparison
+
+- &quot;performance comparison&quot;: as stated above, 19 vs 25 allocations in
+the trivial case. A practical test of the execution time impact would
+involve a non-trivial amount of code to produce enough load on the CPU
+and GC to make the difference matter (this happened on a production
+system, but a small self-contained test case can hardly be extracted
+from it). Also, as stated above, the 19-25 allocation difference
+doesn't take into account the allocations made due to
+Mono.Globalization use, simply because they didn't occur after
+isolating a test case anymore. The reason for that is irrelevant to
+this bug report.
+
+I didn't preserve the test case I used, but it was basically just about:
+
+static void Main() {
+for(int i=0; i&lt;10000; i++) {
+new Uri(&quot;<A HREF="http://something/&quot;">http://something/&quot;</A>);
+}
+}
+
+Hope this helps.
+
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040027.html">[Mono-bugs] [Bug 77770][Wis] Changed - [GMCS] Regression in IL
	verification of generic code from mscorlib
</A></li>
	<LI>Next message: <A HREF="040029.html">[Mono-bugs] [Bug 77770][Wis] Changed - [GMCS] Regression in IL
	verification of generic code from mscorlib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40028">[ date ]</a>
              <a href="thread.html#40028">[ thread ]</a>
              <a href="subject.html#40028">[ subject ]</a>
              <a href="author.html#40028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
