<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 77856][Cri] Changed - Mono Runtime Is Leaking
	Semaphores
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077856%5D%5BCri%5D%20Changed%20-%20Mono%20Runtime%20Is%20Leaking%0A%09Semaphores&In-Reply-To=bug-77856%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040414.html">
   <LINK REL="Next"  HREF="040416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 77856][Cri] Changed - Mono Runtime Is Leaking
	Semaphores</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077856%5D%5BCri%5D%20Changed%20-%20Mono%20Runtime%20Is%20Leaking%0A%09Semaphores&In-Reply-To=bug-77856%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 77856][Cri] Changed - Mono Runtime Is Leaking
	Semaphores">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Mon Mar 20 11:59:42 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="040414.html">[Mono-bugs] [Bug 77857][Nor] Changed - Uri.ToString() Problem
</A></li>
        <LI>Next message: <A HREF="040416.html">[Mono-bugs] [Bug 77820][Nor] Changed - Cecil 0.3 throws an
	incorrect exception when trying to load an assembly.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40415">[ date ]</a>
              <a href="thread.html#40415">[ thread ]</a>
              <a href="subject.html#40415">[ subject ]</a>
              <a href="author.html#40415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">drichard at largo.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=77856">http://bugzilla.ximian.com/show_bug.cgi?id=77856</A>

--- shadow/77856	2006-03-20 10:00:51.000000000 -0500
+++ shadow/77856.tmp.17532	2006-03-20 11:59:42.000000000 -0500
@@ -46,6 +46,67 @@
 
 Whenever (either concurrently or consecutively) any other mono
 application is run by the same user, the same semaphore will be
 reused.  The ID to this semaphore is stored in a file in ~/.wapi which
 holds shared state.  This semaphore is used for cross-process
 synchronisation in the windows api emulation layer.
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">drichard at largo.com</A>  2006-03-20 11:59 -------
+Additional information from irc conversation:
+
+&lt;dave_largo&gt; Dick:  Morning....so I see your note in that bug report.
+&lt;dave_largo&gt; Dick:  So the server has 750 unique people logging in and
+out all day.
+&lt;Dick&gt; dave_largo: am i correct in thinking that you're using a large
+terminal server, and that when many users have each started a mono app
+your server has then run out of semaphores?
+&lt;Dick&gt; snap
+&lt;-- cody has quit (Ex-Chat)
+&lt;dave_largo&gt; Dick: No space left on device.  Try deleting some
+semaphores with ipcs and
+&lt;dave_largo&gt; ipcrm
+&lt;dave_largo&gt; Dick:  We didn't even close to simulating our concurrent
+capacity and the server was having problems.
+&lt;Dick&gt; as a preliminary stopgap, i think you can increase the number
+of semaphores available to the kernel
+&lt;-- barbosa has quit (Leaving)
+&lt;Dick&gt; logging in and out shouldn't affect this particular problem
+unless you are deleting the files in ~/.wapi
+&lt;dave_largo&gt; Dick:  It seems sloppy to me to have anything allocated
+after a user logs out.  Am I not seeing the big picture?
+&lt;Dick&gt; i see what you're saying
+&lt;dave_largo&gt; Nothing in Unix ever works that way, with any user space
+still being allocated after they log out.
+&lt;-- Lukas has quit (Read error: 104 (Connection reset by peer))
+&lt;Dick&gt; the job the semaphores are doing used to be handled by a
+separate mono helper process, which gave us a different set of issues
+&lt;dave_largo&gt; Dick:  When things work this way it causes problems in a
+shop such as ours, we we try and put something into a script to
+release them upon logout, that doesn't always work either because
+sometimes people just turn off equipment without logging out.
+&lt;Dick&gt; ok, i was just about to suggest running a cleanup tool at logout :(
+&lt;dave_largo&gt; Dick: yeah people turn off their thin clients at the end
+of the day without logging out and the scripts never complete.
+&lt;dave_largo&gt; Dick: Things need to be designed for poor technique :)
+&lt;Dick&gt; the problem is that we're trying to emulate a set of semantics
+that doesn't map well to unix
+&lt;Dick&gt; so its not a case of process A forks process B and waits, and
+cleans up
+&lt;dave_largo&gt; Dick:  I'm not sure how Evolution is using mono, but it's
+linked into 2.6 for some reason.
+&lt;dmoonfire&gt; Anyone play with DOAP?
+&lt;Dick&gt; im not sure what evolution is using it for either
+&lt;ankit&gt; *maybe* for evolution-sharp? i could be wildly off-track though.. 
+&lt;dave_largo&gt; Dick:  So it seems to us that it's not even close to
+being able to run the capacity that we need it to.  We go like 20% of
+capacity logged in and the server was having problems.
+&lt;Dick&gt; i need to figure out a way for a mono process to know reliably
+that it is the last one running (per user), and then i can delete the
+semaphore
+&lt;dave_largo&gt; Dick:  We would have to tune semaphores up to a massively
+large number.
+&lt;Dick&gt; ankit: evolution-sharp is for talking to evolution-data-server,
+so other tools might be using it for that
+&lt;dave_largo&gt; and I thought semaphores were dynamic in 2.6 kernel, and
+were allocated as it needed them.
+&lt;dave_largo&gt; or is an issue of bumping up that /dev/shm file system?
+&lt;Dick&gt; dave_largo: i'll need to have a think about how to proceed
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040414.html">[Mono-bugs] [Bug 77857][Nor] Changed - Uri.ToString() Problem
</A></li>
	<LI>Next message: <A HREF="040416.html">[Mono-bugs] [Bug 77820][Nor] Changed - Cecil 0.3 throws an
	incorrect exception when trying to load an assembly.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40415">[ date ]</a>
              <a href="thread.html#40415">[ thread ]</a>
              <a href="subject.html#40415">[ subject ]</a>
              <a href="author.html#40415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
