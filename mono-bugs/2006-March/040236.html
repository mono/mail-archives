<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 77382][Min] Changed - System.Uri ctor could be
	faster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077382%5D%5BMin%5D%20Changed%20-%20System.Uri%20ctor%20could%20be%0A%09faster&In-Reply-To=bug-77382%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040235.html">
   <LINK REL="Next"  HREF="040237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 77382][Min] Changed - System.Uri ctor could be
	faster</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077382%5D%5BMin%5D%20Changed%20-%20System.Uri%20ctor%20could%20be%0A%09faster&In-Reply-To=bug-77382%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 77382][Min] Changed - System.Uri ctor could be
	faster">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Thu Mar 16 03:32:19 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="040235.html">[Mono-bugs] [Bug 77790][Wis] Changed - OS X/i386: Problem with GC
	on non-main thread
</A></li>
        <LI>Next message: <A HREF="040237.html">[Mono-bugs] [Bug 77799][Wis] New - error while start debugging
	(symbol mono_debugger_io_layer)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40236">[ date ]</a>
              <a href="thread.html#40236">[ thread ]</a>
              <a href="subject.html#40236">[ subject ]</a>
              <a href="author.html#40236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=77382">http://bugzilla.ximian.com/show_bug.cgi?id=77382</A>

--- shadow/77382	2006-03-13 04:49:45.000000000 -0500
+++ shadow/77382.tmp.31579	2006-03-16 03:32:18.000000000 -0500
@@ -79,6 +79,182 @@
 new Uri(&quot;<A HREF="http://something/&quot;">http://something/&quot;</A>);
 }
 }
 
 Hope this helps.
 
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>  2006-03-16 03:32 -------
+Oops, am sorry I misread that patch that there are still StartsWith()
+uses. Actually your patch removes them, so it's very nice.
+
+Sadly it seems to cause several regressions on Windows. I'm pasting
+the details here:
+
+18) MonoTests.System.UriTest.Constructor_DualHostPort : AbsolutePath 
+	String lengths differ.  Expected length=26, but was length=30.
+	Strings differ at index 0.
+	
+	expected:&lt;&quot;8080/bar/Hello%20World.htm&quot;&gt;
+	 but was:&lt;&quot;foo:8080/bar/Hello%20World.htm&quot;&gt;
+	-----------^
+	
+in [0x00023] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest.cs:184)
+MonoTests.System.UriTest:Constructor_DualHostPort ()
+in &lt;0x00000&gt; &lt;unknown method&gt;
+in (wrapper managed-to-native)
+System.Reflection.MonoMethod:InternalInvoke (object,object[])
+in [0x00044] (at
+C:\cygwin\home\atsushi\svn\mcs\class\corlib\System.Reflection\MonoMethod.cs:131)
+System.Reflection.MonoMethod:Invoke (System.Object obj, BindingFlags
+invokeAttr, System.Reflection.Binder binder, System.Object[]
+parameters, System.Globalization.CultureInfo culture)
+
+19) MonoTests.System.UriTest.LeadingSlashes : #7a 
+	String lengths differ.  Expected length=3, but was length=1.
+	Strings differ at index 0.
+	
+	expected:&lt;&quot;foo&quot;&gt;
+	 but was:&lt;&quot;o&quot;&gt;
+	-----------^
+	
+in [0x00081] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest.cs:428)
+MonoTests.System.UriTest:LeadingSlashes ()
+in &lt;0x00000&gt; &lt;unknown method&gt;
+in (wrapper managed-to-native)
+System.Reflection.MonoMethod:InternalInvoke (object,object[])
+in [0x00044] (at
+C:\cygwin\home\atsushi\svn\mcs\class\corlib\System.Reflection\MonoMethod.cs:131)
+System.Reflection.MonoMethod:Invoke (System.Object obj, BindingFlags
+invokeAttr, System.Reflection.Binder binder, System.Object[]
+parameters, System.Globalization.CultureInfo culture)
+
+20) MonoTests.System.UriTest.LocalPath : #3a 
+	String lengths differ.  Expected length=27, but was length=25.
+	Strings differ at index 7.
+	
+	expected:&lt;&quot;<A HREF="file://cygwin/tmp/hello.txt&quot;">file://cygwin/tmp/hello.txt&quot;</A>&gt;
+	 but was:&lt;&quot;<A HREF="file://gwin/tmp/hello.txt&quot;">file://gwin/tmp/hello.txt&quot;</A>&gt;
+	------------------^
+	
+in [0x0008a] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest.cs:586)
+MonoTests.System.UriTest:LocalPath ()
+in &lt;0x00000&gt; &lt;unknown method&gt;
+in (wrapper managed-to-native)
+System.Reflection.MonoMethod:InternalInvoke (object,object[])
+in [0x00044] (at
+C:\cygwin\home\atsushi\svn\mcs\class\corlib\System.Reflection\MonoMethod.cs:131)
+System.Reflection.MonoMethod:Invoke (System.Object obj, BindingFlags
+invokeAttr, System.Reflection.Binder binder, System.Object[]
+parameters, System.Globalization.CultureInfo culture)
+
+23) MonoTests.System.UriTest.Segments4 : #02 
+	String lengths differ.  Expected length=2, but was length=1.
+	Strings differ at index 0.
+	
+	expected:&lt;&quot;c:&quot;&gt;
+	 but was:&lt;&quot;/&quot;&gt;
+	-----------^
+	
+in [0x00019] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest.cs:1356)
+MonoTests.System.UriTest:Segments4 ()
+in &lt;0x00000&gt; &lt;unknown method&gt;
+in (wrapper managed-to-native)
+System.Reflection.MonoMethod:InternalInvoke (object,object[])
+in [0x00044] (at
+C:\cygwin\home\atsushi\svn\mcs\class\corlib\System.Reflection\MonoMethod.cs:131)
+System.Reflection.MonoMethod:Invoke (System.Object obj, BindingFlags
+invokeAttr, System.Reflection.Binder binder, System.Object[]
+parameters, System.Globalization.CultureInfo culture)
+
+24) MonoTests.System.UriTest.UnixLocalPath : <A HREF="file:///c:/tmp/foo/bar">file:///c:/tmp/foo/bar</A> 
+	String lengths differ.  Expected length=14, but was length=15.
+	Strings differ at index 0.
+	
+	expected:&lt;&quot;c:/tmp/foo/bar&quot;&gt;
+	 but was:&lt;&quot;/c:/tmp/foo/bar&quot;&gt;
+	-----------^
+	
+in [0x00032] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest.cs:1466)
+MonoTests.System.UriTest:UnixLocalPath ()
+in &lt;0x00000&gt; &lt;unknown method&gt;
+in (wrapper managed-to-native)
+System.Reflection.MonoMethod:InternalInvoke (object,object[])
+in [0x00044] (at
+C:\cygwin\home\atsushi\svn\mcs\class\corlib\System.Reflection\MonoMethod.cs:131)
+System.Reflection.MonoMethod:Invoke (System.Object obj, BindingFlags
+invokeAttr, System.Reflection.Binder binder, System.Object[]
+parameters, System.Globalization.CultureInfo culture)
+
+25) MonoTests.System.UriTest2.AbsoluteUriFromFile :
+<A HREF="file:///c:/name%20with%20space.txt">file:///c:/name%20with%20space.txt</A> AbsolutePath 
+	String lengths differ.  Expected length=26, but was length=27.
+	Strings differ at index 0.
+	
+	expected:&lt;&quot;c:/name%20with%20space.txt&quot;&gt;
+	 but was:&lt;&quot;/c:/name%20with%20space.txt&quot;&gt;
+	-----------^
+	
+in [0x001ac] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest2.cs:53)
+MonoTests.System.UriTest2:AssertUri (System.String relsrc, System.Uri
+uri, System.String toString, System.String absoluteUri, System.String
+scheme, System.String host, System.String localPath, System.String
+query, Int32 port, Boolean isFile, Boolean isUnc, Boolean isLoopback,
+Boolean userEscaped, UriHostNameType hostNameType, System.String
+absolutePath, System.String pathAndQuery, System.String authority,
+System.String fragment, System.String userInfo)
+in [0x000f7] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest2.cs:141)
+MonoTests.System.UriTest2:FromResource (System.String res, System.Uri
+baseUri)
+in [0x00007] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest2.cs:64)
+MonoTests.System.UriTest2:AbsoluteUriFromFile ()
+in &lt;0x00000&gt; &lt;unknown method&gt;
+in (wrapper managed-to-native)
+System.Reflection.MonoMethod:InternalInvoke (object,object[])
+in [0x00044] (at
+C:\cygwin\home\atsushi\svn\mcs\class\corlib\System.Reflection\MonoMethod.cs:131)
+System.Reflection.MonoMethod:Invoke (System.Object obj, BindingFlags
+invokeAttr, System.Reflection.Binder binder, System.Object[]
+parameters, System.Globalization.CultureInfo culture)
+
+26) MonoTests.System.UriTest2.RelativeUriFromFile : urn:mono-uri-test
+AbsoluteUri 
+	String lengths differ.  Expected length=17, but was length=21.
+	Strings differ at index 4.
+	
+	expected:&lt;&quot;urn:mono-uri-test&quot;&gt;
+	 but was:&lt;&quot;urn:urn:mono-uri-test&quot;&gt;
+	---------------^
+	
+in [0x0000e] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest2.cs:37)
+MonoTests.System.UriTest2:AssertUri (System.String relsrc, System.Uri
+uri, System.String toString, System.String absoluteUri, System.String
+scheme, System.String host, System.String localPath, System.String
+query, Int32 port, Boolean isFile, Boolean isUnc, Boolean isLoopback,
+Boolean userEscaped, UriHostNameType hostNameType, System.String
+absolutePath, System.String pathAndQuery, System.String authority,
+System.String fragment, System.String userInfo)
+in [0x000f7] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest2.cs:141)
+MonoTests.System.UriTest2:FromResource (System.String res, System.Uri
+baseUri)
+in [0x00010] (at
+C:\cygwin\home\atsushi\svn\mcs\class\System\Test\System\UriTest2.cs:83)
+MonoTests.System.UriTest2:RelativeUriFromFile ()
+in &lt;0x00000&gt; &lt;unknown method&gt;
+in (wrapper managed-to-native)
+System.Reflection.MonoMethod:InternalInvoke (object,object[])
+in [0x00044] (at
+C:\cygwin\home\atsushi\svn\mcs\class\corlib\System.Reflection\MonoMethod.cs:131)
+System.Reflection.MonoMethod:Invoke (System.Object obj, BindingFlags
+invokeAttr, System.Reflection.Binder binder, System.Object[]
+parameters, System.Globalization.CultureInfo culture)
+
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040235.html">[Mono-bugs] [Bug 77790][Wis] Changed - OS X/i386: Problem with GC
	on non-main thread
</A></li>
	<LI>Next message: <A HREF="040237.html">[Mono-bugs] [Bug 77799][Wis] New - error while start debugging
	(symbol mono_debugger_io_layer)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40236">[ date ]</a>
              <a href="thread.html#40236">[ thread ]</a>
              <a href="subject.html#40236">[ subject ]</a>
              <a href="author.html#40236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
