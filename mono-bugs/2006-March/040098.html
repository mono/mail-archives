<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 77781][Nor] New - Possible Xpath sort problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077781%5D%5BNor%5D%20New%20-%20Possible%20Xpath%20sort%20problem&In-Reply-To=bug-77781%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="040097.html">
   <LINK REL="Next"  HREF="040099.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 77781][Nor] New - Possible Xpath sort problem</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077781%5D%5BNor%5D%20New%20-%20Possible%20Xpath%20sort%20problem&In-Reply-To=bug-77781%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 77781][Nor] New - Possible Xpath sort problem">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Mon Mar 13 19:10:12 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="040097.html">[Mono-bugs] [Bug 77780][Blo] Changed - Changing position in a
	dataset
</A></li>
        <LI>Next message: <A HREF="040099.html">[Mono-bugs] [Bug 77773][Nor] Changed - Background threads keep
	process alive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40098">[ date ]</a>
              <a href="thread.html#40098">[ thread ]</a>
              <a href="subject.html#40098">[ subject ]</a>
              <a href="author.html#40098">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">hugobendelin at hotmail.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=77781">http://bugzilla.ximian.com/show_bug.cgi?id=77781</A>

--- shadow/77781	2006-03-13 19:10:12.000000000 -0500
+++ shadow/77781.tmp.5845	2006-03-13 19:10:12.000000000 -0500
@@ -0,0 +1,190 @@
+Bug#: 77781
+Product: Mono: Class Libraries
+Version: 1.1
+OS: Debian Woody
+OS Details: Debian Woody
+Status: NEW   
+Resolution: 
+Severity: Unknown
+Priority: Normal
+Component: Sys.XML
+AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>                            
+ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">hugobendelin at hotmail.com</A>               
+QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
+TargetMilestone: ---
+URL: 
+Cc: 
+Summary: Possible Xpath sort problem
+
+Please fill in this template when reporting a bug, unless you know what you
+are doing.
+Description of Problem:
+
+I Have been trying to write a xsl file to sort and style a xml-document on
+my debian-mono(1.1.13.4)-apache(2.0.54) server. I try to use the xsl:sort
+in a xsl:for-each with a select=&quot;count()&quot;. Everything works except for the
+sort. Ive tryed the same thing on a computer with the microsoft
+.net-platform and got the correct result.
+
+Steps to reproduce the problem:
+1. xml-file
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;matches team=&quot;Norabs&quot;&gt;
+	&lt;players&gt;
+		&lt;player nr=&quot;2&quot; wikiName=&quot;CarlWistedt&quot; shortName=&quot;carl&quot;&gt;Carl Wistedt&lt;/player &gt;
+		&lt;player nr=&quot;8&quot; wikiName=&quot;PeterLindblad&quot; shortName=&quot;pete&quot;&gt;Peter
+Lindblad&lt;/player &gt;
+		&lt;player nr=&quot;7&quot; wikiName=&quot;JimmyHolmqvist&quot; shortName=&quot;jim&quot;&gt;Jimmy
+Holmqvist&lt;/player &gt;
+		&lt;player nr=&quot;5&quot; wikiName=&quot;HenrikNorabs&quot; shortName=&quot;henk&quot;&gt;Henrik
+Norabs&lt;/player &gt;
+		&lt;player nr=&quot;48&quot; wikiName=&quot;NorabsFallman&quot; shortName=&quot;fallm&quot;&gt;Norabs
+Fallman&lt;/player &gt;
+		&lt;player nr=&quot;3&quot; wikiName=&quot;LasseNorabs&quot;  shortName=&quot;lars&quot;&gt;Lasse
+Norabs&lt;/player &gt;
+		&lt;player nr=&quot;1&quot; wikiName=&quot;LelleNorabs&quot;  shortName=&quot;lelle&quot;&gt;Lelle
+Norabs&lt;/player &gt;
+	&lt;/players&gt;
+	&lt;match vs=&quot;IK&quot; made=&quot;11&quot; against=&quot;8&quot;&gt;
+		&lt;lineup&gt;
+			&lt;player nr=&quot;2&quot; /&gt;
+			&lt;player nr=&quot;7&quot; /&gt;
+			&lt;player nr=&quot;8&quot; /&gt;
+			&lt;player nr=&quot;5&quot; /&gt;
+			&lt;player nr=&quot;3&quot; /&gt;
+		&lt;/lineup&gt;
+		&lt;score ass=&quot;3&quot; goal=&quot;2&quot; /&gt;
+		&lt;score goal=&quot;5&quot; /&gt;
+		&lt;score ass=&quot;7&quot; goal=&quot;2&quot; /&gt;
+		&lt;score ass=&quot;3&quot; goal=&quot;2&quot; /&gt;
+		&lt;score goal=&quot;2&quot; /&gt;
+		&lt;score goal=&quot;2&quot; /&gt;
+		&lt;score ass=&quot;8&quot; goal=&quot;2&quot; /&gt;
+		&lt;score goal=&quot;8&quot; /&gt;
+		&lt;score ass=&quot;2&quot; goal=&quot;8&quot; /&gt;
+		&lt;score ass=&quot;5&quot; goal=&quot;2&quot; /&gt;
+		&lt;score ass=&quot;3&quot; goal=&quot;2&quot; /&gt;
+	&lt;/match&gt;
+	&lt;match vs=&quot;Oops&quot; made=&quot;7&quot; against=&quot;6&quot;&gt;
+		&lt;lineup&gt;
+			&lt;player nr=&quot;2&quot; /&gt;
+			&lt;player nr=&quot;7&quot; /&gt;
+			&lt;player nr=&quot;8&quot; /&gt;
+			&lt;player nr=&quot;5&quot; /&gt;
+			&lt;player nr=&quot;3&quot; /&gt;
+		&lt;/lineup&gt;
+		&lt;score ass=&quot;7&quot; goal=&quot;2&quot; /&gt;
+		&lt;score ass=&quot;2&quot; goal=&quot;7&quot; /&gt;
+		&lt;score goal=&quot;2&quot; /&gt;
+		&lt;score goal=&quot;3&quot; /&gt;
+		&lt;score ass=&quot;7&quot; goal=&quot;2&quot; /&gt;
+		&lt;score ass=&quot;2&quot; goal=&quot;8&quot; /&gt;
+		&lt;score ass=&quot;2&quot; goal=&quot;5&quot; /&gt;
+	&lt;/match&gt;
+&lt;/matches&gt;
+2. xsl-file, i try sorting players in the xml-file on points, goals and
+assists:
+&lt;xsl:stylesheet xmlns:xsl=&quot;<A HREF="http://www.w3.org/1999/XSL/Transform&quot;">http://www.w3.org/1999/XSL/Transform&quot;</A> version=&quot;1.0&quot;&gt;
+ &lt;xsl:template match=&quot;/&quot;&gt;
+  &lt;xsl:for-each select=&quot;matches/players/player&quot;&gt;
+   &lt;xsl:sort select=&quot;count(/matches/match/score[@goal=current()/@nr]) +
+count(/matches/match/score[@ass=current()/@nr])&quot; data-type=&quot;number&quot;
+order=&quot;descending&quot; /&gt;
+   &lt;xsl:sort select=&quot;count(/matches/match/score[@goal=current()/@nr])&quot;
+data-type=&quot;number&quot; order=&quot;descending&quot; /&gt;
+   &lt;xsl:sort select=&quot;count(/matches/match/score[@ass=current()/@nr])&quot;
+data-type=&quot;number&quot; order=&quot;descending&quot; /&gt;
+   ...   
+  &lt;/xsl:for-each&gt;
+ &lt;/xsl:template&gt;
+&lt;/xsl:stylesheet&gt;
+
+3.
+The C#-Code:
+public string XmlTransform(string xmlURL, string xslURL)
+{
+	string result= null;
+	XmlDocument xmlDoc = new XmlDocument();
+	XslTransform xslTransform = new XslTransform();
+	
+	try
+	{
+		// Load the XML file
+		xmlDoc.Load(xmlURL);
+	}
+	catch(Exception ex)
+	{
+		result = &quot;Failed to load XML parameter (&quot; + xmlURL + &quot;): &quot; + ex.Message;
+	}
+	if (result==null)
+	{
+		try
+		{
+			// Load the XSL File
+			xslTransform.Load(xslURL);
+		}
+		catch(Exception ex)
+		{
+			result = &quot;Failed to load XSL parameter (&quot; + xslURL + &quot;): &quot; + ex.Message;
+		}
+	}
+	if (result==null)
+	{
+		try
+		{
+			StringWriter sW = new StringWriter();
+			XmlTextWriter XmlW = new XmlTextWriter(sW);
+			xslTransform.Transform(xmlDoc,new XsltArgumentList(),XmlW,null);
+			result = sW.ToString();
+			XmlW.Close();
+		}
+		catch(Exception ex)
+		{
+			result = &quot;Failed to Transform &quot; + ex.Message;
+		}
+	}
+	return result;
+}
+
+4.
+
+Actual Results:
+link - <A HREF="http://bandyboll.mine.nu/default.aspx/AMAWiki/NorabsPlayerStatsVT06.html">http://bandyboll.mine.nu/default.aspx/AMAWiki/NorabsPlayerStatsVT06.html</A>
+Nr 	Name 	Matcher 	M&#229;l 	(snitt) 	Assist 	(snitt) 	Po&#228;ng 	Record 	Fabrikation
+2 	Carl Wistedt(carl) 	10 	30 	(3) 	25 	(2.5) 	55 	7-1-2 
+(8,1)(3,3)(3,1)(3,0)(3,1)(0,2)(2,4)(2,5)(3,5)(3,3)
+8 	Peter Lindblad(pete) 	7 	15 	(2.1) 	4 	(0.5) 	19 	5-1-1 
+(2,1)(1,0)(X,X)(0,0)(3,1)(1,1)(3,0)(5,1)(X,X)(X,X)
+7 	Jimmy Holmqvist(jim) 	8 	13 	(1.6) 	8 	(1) 	21 	7-0-1 
+(0,1)(1,2)(X,X)(X,X)(2,1)(2,0)(0,0)(3,2)(4,1)(1,1)
+5 	Henrik Norabs(henk) 	10 	26 	(2.6) 	5 	(0.5) 	31 	7-1-2 
+(1,1)(1,0)(4,1)(2,0)(1,0)(3,0)(4,0)(1,2)(5,1)(4,0)
+48 	Norabs Fallman(fallm) 	8 	3 	(0.3) 	3 	(0.3) 	6 	5-1-2 
+(X,X)(X,X)(0,1)(0,0)(1,0)(0,0)(0,1)(1,1)(0,0)(1,0)
+3 	Lasse Norabs(lars) 	8 	2 	(0.2) 	6 	(0.7) 	8 	5-1-2 
+(0,3)(1,0)(0,1)(0,0)(0,0)(0,0)(X,X)(X,X)(0,0)(1,2)
+1 	Lelle Norabs(lelle) 	0 	0 	(NaN) 	0 	(NaN) 	0 	0-0-0 
+(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)
+
+
+Expected Results:
+link - <A HREF="http://www.flexwiki.com/default.aspx/FlexWiki/CarlWistedt.html">http://www.flexwiki.com/default.aspx/FlexWiki/CarlWistedt.html</A>
+2 	Carl Wistedt(carl) 	10 	30 	(3) 	25 	(2.5) 	55 	7-1-2 
+(8,1)(3,3)(3,1)(3,0)(3,1)(0,2)(2,4)(2,5)(3,5)(3,3)
+5 	Henrik Norabs(henk) 	10 	26 	(2.6) 	5 	(0.5) 	31 	7-1-2 
+(1,1)(1,0)(4,1)(2,0)(1,0)(3,0)(4,0)(1,2)(5,1)(4,0)
+7 	Jimmy Holmqvist(jim) 	8 	13 	(1.6) 	8 	(1) 	21 	7-0-1 
+(0,1)(1,2)(X,X)(X,X)(2,1)(2,0)(0,0)(3,2)(4,1)(1,1)
+8 	Peter Lindblad(pete) 	7 	15 	(2.1) 	4 	(0.5) 	19 	5-1-1 
+(2,1)(1,0)(X,X)(0,0)(3,1)(1,1)(3,0)(5,1)(X,X)(X,X)
+3 	Lasse Norabs(lars) 	8 	2 	(0.2) 	6 	(0.7) 	8 	5-1-2 
+(0,3)(1,0)(0,1)(0,0)(0,0)(0,0)(X,X)(X,X)(0,0)(1,2)
+48 	Norabs Fallman(fallm) 	8 	3 	(0.3) 	3 	(0.3) 	6 	5-1-2 
+(X,X)(X,X)(0,1)(0,0)(1,0)(0,0)(0,1)(1,1)(0,0)(1,0)
+1 	Lelle Norabs(lelle) 	0 	0 	(NaN) 	0 	(NaN) 	0 	0-0-0 
+(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)(X,X)
+
+How often does this happen? 
+Always
+
+Additional Information:
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="040097.html">[Mono-bugs] [Bug 77780][Blo] Changed - Changing position in a
	dataset
</A></li>
	<LI>Next message: <A HREF="040099.html">[Mono-bugs] [Bug 77773][Nor] Changed - Background threads keep
	process alive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40098">[ date ]</a>
              <a href="thread.html#40098">[ thread ]</a>
              <a href="subject.html#40098">[ subject ]</a>
              <a href="author.html#40098">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
