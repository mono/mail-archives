<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 591443] New: Cloning a DataColumn with Expression result in a DataColumn in an invalid state
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591443%5D%20New%3A%20Cloning%20a%20DataColumn%20with%20Expression%0A%20result%20in%20a%20DataColumn%20in%20an%20invalid%20state&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="098538.html">
   <LINK REL="Next"  HREF="098541.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 591443] New: Cloning a DataColumn with Expression result in a DataColumn in an invalid state</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591443%5D%20New%3A%20Cloning%20a%20DataColumn%20with%20Expression%0A%20result%20in%20a%20DataColumn%20in%20an%20invalid%20state&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 591443] New: Cloning a DataColumn with Expression result in a DataColumn in an invalid state">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Mar 26 10:14:48 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="098538.html">[Mono-bugs] [Bug 564833] DataAdapter's fill method throws exception in connection with DbProviderFactories
</A></li>
        <LI>Next message: <A HREF="098541.html">[Mono-bugs] [Bug 591474] New: Mono 2.6.3 fails to compile on RedHat 7.3 with exception in Mono.Security.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98539">[ date ]</a>
              <a href="thread.html#98539">[ thread ]</a>
              <a href="subject.html#98539">[ subject ]</a>
              <a href="author.html#98539">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591443">http://bugzilla.novell.com/show_bug.cgi?id=591443</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591443#c0">http://bugzilla.novell.com/show_bug.cgi?id=591443#c0</A>


           Summary: Cloning a DataColumn with Expression result in a
                    DataColumn in an invalid state
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Critical
          Priority: P5 - None
         Component: Sys.Data
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Dominique.Normand at cegedim.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-us)
AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7

Cloning a DataColumn that has an Expression will result in a DataColumn that
has an Expression set but for which the CompiledExpression is null. This causes
an exception when trying to read a row value for that column

Reproducible: Always

Steps to Reproduce:
1. Create a DataTable + DataColumn with an expression 
2. Clone the DataTable
3. Add a row to the cloned DataTable
4. Try to read the column value of that row
Actual Results:  
A null exception is thrown

Expected Results:  
We should get back the result of the expression for that row/column

The problem comes from the clone copying the _expression field but not the
_compiledExpression. 
I think the Expression should be parsed and compiled on demand in the
CompiledExpression property instead of in the Expression property. This would
fix the problem and also allow column #1 expression to depend on column #2.
Today, you cannot add an expression that depends on a column that doesn't
exists yet. This is a problem with the Deserialization.
The downside would be that invalid expression wouldn't be detected until the
row value is accessed, but if the row value is never accessed, then the
expression will never be parsed &amp; compiled which might be good.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="098538.html">[Mono-bugs] [Bug 564833] DataAdapter's fill method throws exception in connection with DbProviderFactories
</A></li>
	<LI>Next message: <A HREF="098541.html">[Mono-bugs] [Bug 591474] New: Mono 2.6.3 fails to compile on RedHat 7.3 with exception in Mono.Security.dll
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98539">[ date ]</a>
              <a href="thread.html#98539">[ thread ]</a>
              <a href="subject.html#98539">[ subject ]</a>
              <a href="author.html#98539">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
