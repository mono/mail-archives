<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 591397] System.Data.DataTableExtensions.CopyToDataTable(Of T) returns 0 Rows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591397%5D%0A%20System.Data.DataTableExtensions.CopyToDataTable%28Of%20T%29%20returns%200%20Rows&In-Reply-To=bug-591397-28286%40http.bugzilla.novell.com/">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="098554.html">
   <LINK REL="Next"  HREF="098559.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 591397] System.Data.DataTableExtensions.CopyToDataTable(Of T) returns 0 Rows</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591397%5D%0A%20System.Data.DataTableExtensions.CopyToDataTable%28Of%20T%29%20returns%200%20Rows&In-Reply-To=bug-591397-28286%40http.bugzilla.novell.com/"
       TITLE="[Mono-bugs] [Bug 591397] System.Data.DataTableExtensions.CopyToDataTable(Of T) returns 0 Rows">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Mar 26 20:27:59 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="098554.html">[Mono-bugs] [Bug 591397] System.Data.DataTableExtensions.CopyToDataTable(Of T) returns 0 Rows
</A></li>
        <LI>Next message: <A HREF="098559.html">[Mono-bugs] [Bug 591397] System.Data.DataTableExtensions.CopyToDataTable(Of T) returns 0 Rows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98558">[ date ]</a>
              <a href="thread.html#98558">[ thread ]</a>
              <a href="subject.html#98558">[ subject ]</a>
              <a href="author.html#98558">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591397">http://bugzilla.novell.com/show_bug.cgi?id=591397</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591397#c5">http://bugzilla.novell.com/show_bug.cgi?id=591397#c5</A>


--- Comment #5 from Tony Fish &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">tonyvfish at googlemail.com</A>&gt; 2010-03-27 00:27:58 UTC ---
Miguel
Just to be completely clear about what I'm doing.  The only part of MONO I'm
using is the DataExtensions.  Everything else is .NET 2  .I'm doing this
because .Net 2.0 does not include LINQ which I need, but can not use .Net 3.x. 
So I use an open source implementation to allow me to do LINQ over objects
called LinqBridge.  However LinqBridge (LINQ over objects) does not include the
extension methods needed for working with datatables dat rows etc.  This is why
I use MONO DataExtensions to  provide this functionality

When the code calls the extension method o.CopyToDataTable()

DatatableExtensions.cs eventually invokes 

public static void CopyToDataTable&lt;T&gt; (this IEnumerable&lt;T&gt; source, DataTable
table, LoadOption options, FillErrorEventHandler errorHandler)
            where T : DataRow
        {
            var reader = new RowEnumerableDataReader (source, 0);
            table.Load (reader, options, errorHandler);
        }

Now keep in mind the code line   table.Load (reader, options, errorHandler);
When the table is a .NET version 2, the first call made by the table on the
reader is the sub  
public void Close ()
        {
            e = null;
        }
of RowEnumerableDataReader.cs

This is why I added this line to the contructor
//tf Added cos isClosed is called fist by MS
            _e = ((IEnumerable)this._source).GetEnumerator();

If e does not get set in the constructot , the .NET table thinks the reader is
closed and returns an un populated table.

So I've taken a look at your patched constructor now on CVS and added 1 line
back. ( please see attachment ). RowEnumerableDataReader.cs will now be more
compatible with .NET as well as MONO

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="098554.html">[Mono-bugs] [Bug 591397] System.Data.DataTableExtensions.CopyToDataTable(Of T) returns 0 Rows
</A></li>
	<LI>Next message: <A HREF="098559.html">[Mono-bugs] [Bug 591397] System.Data.DataTableExtensions.CopyToDataTable(Of T) returns 0 Rows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98558">[ date ]</a>
              <a href="thread.html#98558">[ thread ]</a>
              <a href="subject.html#98558">[ subject ]</a>
              <a href="author.html#98558">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
