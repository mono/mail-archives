<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 591291] New: XmlInputStream.Read may block with unprocessed bytes in buffer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591291%5D%20New%3A%20XmlInputStream.Read%20may%20block%20with%0A%20unprocessed%20bytes%20in%20buffer&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="098537.html">
   <LINK REL="Next"  HREF="098525.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 591291] New: XmlInputStream.Read may block with unprocessed bytes in buffer</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591291%5D%20New%3A%20XmlInputStream.Read%20may%20block%20with%0A%20unprocessed%20bytes%20in%20buffer&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 591291] New: XmlInputStream.Read may block with unprocessed bytes in buffer">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Mar 25 19:10:15 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="098537.html">[Mono-bugs] [Bug 591272] VBNC99997 - Compilation error when performing ToString() on element of a multidimensional array of Integers
</A></li>
        <LI>Next message: <A HREF="098525.html">[Mono-bugs] [Bug 591291] XmlInputStream.Read may block with unprocessed bytes in buffer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98522">[ date ]</a>
              <a href="thread.html#98522">[ thread ]</a>
              <a href="subject.html#98522">[ subject ]</a>
              <a href="author.html#98522">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591291">http://bugzilla.novell.com/show_bug.cgi?id=591291</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591291#c0">http://bugzilla.novell.com/show_bug.cgi?id=591291#c0</A>


           Summary: XmlInputStream.Read may block with unprocessed bytes
                    in buffer
    Classification: Mono
           Product: Mono: Class Libraries
           Version: 2.6.x
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.XML
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">atsushi at ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mapperso at cisco.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.8)
Gecko/20100204 SUSE/3.5.8-0.1.1 Firefox/3.5.8

I'm using an XmlReader with the source stream being the output stream of a
WebResponse.  When the internal XmlInputStream is initialized with the source
stream, it reads available data up to the size of it's internal buffer.  In my
case, a very small amount of data is initially available.  When the XmlReader
begins parsing it first calls XmlInputStream which does a blocking read on the
source stream because the amount of data in it's internal buffer was smaller
than requested.

This is inconsistent with Microsoft's XmlReader buffering which parses all
available stream data before blocking.

I was able to resolve my issue and get correct behavior with the following
change...

diff XmlInputStream.cs
/usr/src/packages/BUILD/mono-2.6.3/mcs/class/System.XML/System.Xml/XmlInputStream.cs
576c576,577
&lt;                               ret = (0 == bufRest) ? stream.Read (buffer,
offset + bufRest, count - bufRest) : bufRest;
---
&gt;<i>                               ret = bufRest +
</I>&gt;<i>                                       stream.Read (buffer, offset + bufRest, count - bufRest);
</I>
Reproducible: Always

Steps to Reproduce:
1.Create a Stream and push a small amount of data into it (&lt;1024 bytes)
2.Create an XmlReader over the Stream
3.Read from the XmlReader

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>












































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="098537.html">[Mono-bugs] [Bug 591272] VBNC99997 - Compilation error when performing ToString() on element of a multidimensional array of Integers
</A></li>
	<LI>Next message: <A HREF="098525.html">[Mono-bugs] [Bug 591291] XmlInputStream.Read may block with unprocessed bytes in buffer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98522">[ date ]</a>
              <a href="thread.html#98522">[ thread ]</a>
              <a href="subject.html#98522">[ subject ]</a>
              <a href="author.html#98522">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
