<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 586062] New: SqliteConnection.Close() should raise exception when underlying sqlite3_close() fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20586062%5D%20New%3A%20SqliteConnection.Close%28%29%20should%20raise%0A%20exception%20when%20underlying%20sqlite3_close%28%29%20fails&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="098060.html">
   <LINK REL="Next"  HREF="098062.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 586062] New: SqliteConnection.Close() should raise exception when underlying sqlite3_close() fails</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20586062%5D%20New%3A%20SqliteConnection.Close%28%29%20should%20raise%0A%20exception%20when%20underlying%20sqlite3_close%28%29%20fails&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 586062] New: SqliteConnection.Close() should raise exception when underlying sqlite3_close() fails">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sat Mar  6 07:24:26 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="098060.html">[Mono-bugs] [Bug 567428] Soap Headers dont appear to be passing to	webservice
</A></li>
        <LI>Next message: <A HREF="098062.html">[Mono-bugs] [Bug 566421] Connections stay open after they are	closed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98061">[ date ]</a>
              <a href="thread.html#98061">[ thread ]</a>
              <a href="subject.html#98061">[ subject ]</a>
              <a href="author.html#98061">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=586062">http://bugzilla.novell.com/show_bug.cgi?id=586062</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=586062#c0">http://bugzilla.novell.com/show_bug.cgi?id=586062#c0</A>


           Summary: SqliteConnection.Close() should raise exception when
                    underlying sqlite3_close() fails
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Mono.Data.Sqlite
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mhabersack at novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">philippe at activa.be</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=346956)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=346956">http://bugzilla.novell.com/attachment.cgi?id=346956</A>)
Patch (DIFF) for Mono.Data.Sqlite_2.0

User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US;
rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8

When calling SqliteConnection.Close(), and the underlying call to
sqlite3_close() returns an error code, there is no error reported.

The code in SqliteConnectionHandle.ReleaseHandle() &quot;eats&quot; the exception raised
by Sqite3.CloseConnection(). This is not correct, and results in a resource
leak (file handle left open).

I've created a patch where the empty catch is removed from ReleaseHandle().
This empty catch has been moved to the SqliteConnection.Dispose() when calling
SqliteConnection.Close(). Reason for this is that it's not good practice to
raise exceptions from Dispose(), but for Close() it's fine (and recommended)


Reproducible: Always

Steps to Reproduce:
1. Open an SqliteConnection
2. Create a SqliteCommand and execute a statement
3. Close the connection (no exception is thrown, but the underlying call to
sqlite3_close() returns SQLITE_BUSY
4. Do this 1,000 times and you'll get &quot;too many open files&quot;

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="098060.html">[Mono-bugs] [Bug 567428] Soap Headers dont appear to be passing to	webservice
</A></li>
	<LI>Next message: <A HREF="098062.html">[Mono-bugs] [Bug 566421] Connections stay open after they are	closed.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98061">[ date ]</a>
              <a href="thread.html#98061">[ thread ]</a>
              <a href="subject.html#98061">[ subject ]</a>
              <a href="author.html#98061">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
