<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 591225] New: Problem when using Reflection.Emit to create a class derived from an abstract class containing a Generic property
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591225%5D%20New%3A%20Problem%20when%20using%20Reflection.Emit%20to%0A%20create%20a%20class%20derived%20from%20an%20abstract%20class%20containing%20a%20Generic%20property&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="098671.html">
   <LINK REL="Next"  HREF="098518.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 591225] New: Problem when using Reflection.Emit to create a class derived from an abstract class containing a Generic property</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20591225%5D%20New%3A%20Problem%20when%20using%20Reflection.Emit%20to%0A%20create%20a%20class%20derived%20from%20an%20abstract%20class%20containing%20a%20Generic%20property&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 591225] New: Problem when using Reflection.Emit to create a class derived from an abstract class containing a Generic property">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Mar 25 15:15:13 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="098671.html">[Mono-bugs] [Bug 591149] Is this a real compilation error? Visual Studio says OK, Mono returns error
</A></li>
        <LI>Next message: <A HREF="098518.html">[Mono-bugs] [Bug 591226] New: Using Reflection.Emit to generate a generic method may lead to invalid codegen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98517">[ date ]</a>
              <a href="thread.html#98517">[ thread ]</a>
              <a href="subject.html#98517">[ subject ]</a>
              <a href="author.html#98517">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591225">http://bugzilla.novell.com/show_bug.cgi?id=591225</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=591225#c0">http://bugzilla.novell.com/show_bug.cgi?id=591225#c0</A>


           Summary: Problem when using Reflection.Emit to create a class
                    derived from an abstract class containing a Generic
                    property
    Classification: Mono
           Product: Mono: Runtime
           Version: 2.6.x
          Platform: x86
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: generics
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">joe at noteven.org</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


User-Agent:       Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64;
Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729;
Media Center PC 6.0; MS-RTC LM 8; InfoPath.2; .NET4.0C; .NET4.0E)

It seems that when using the Reflection.Emit APIs to create a child class of an
abstract generic class, the parent class isn't specialized when it comes time
for the TypeBuilder to create the type.  This seems to only be the case for
abstract classes - generic interfaces work properly.

Reproducible: Always

Steps to Reproduce:
1.Download the latest F# CTP
<A HREF="http://www.microsoft.com/downloads/details.aspx?FamilyID=b55f0532-ac3c-4106-918c-5586a953a7da&amp;displaylang=en">http://www.microsoft.com/downloads/details.aspx?FamilyID=b55f0532-ac3c-4106-918c-5586a953a7da&amp;displaylang=en</A>

2. Run FSI.exe through Mono

3. Enter the following code fragment into fsi.exe:

[&lt;AbstractClass&gt;]
type B&lt;'a&gt; =
  abstract A : 'a with get,set

type C = 
    inherit B&lt;int&gt;

    override x.A
        with get() = 3
        and set(v : int) = ();;

Actual Results:  
Result:
error FS0193: Operation is not supported.


Expected Results:  
Expected:
No error.


Here&#8217;s a partial stack trace captured from the NotSupportedException:

error FS0192: internal error: CreateType: Exception type
System.NotSupportedException: Operation is
not supported.
  at System.Reflection.MonoGenericClass.GetConstructorImpl (BindingFlags
bindingAttr, System.Reflect
ion.Binder binder, CallingConventions callConvention, System.Type[] types,
System.Reflection.Paramet
erModifier[] modifiers) [0x00000] in &lt;filename unknown&gt;:0
  at System.Type.GetConstructor (BindingFlags bindingAttr,
System.Reflection.Binder binder, CallingC
onventions callConvention, System.Type[] types,
System.Reflection.ParameterModifier[] modifiers) [0x
00000] in &lt;filename unknown&gt;:0
  at System.Type.GetConstructor (BindingFlags bindingAttr,
System.Reflection.Binder binder, System.T
ype[] types, System.Reflection.ParameterModifier[] modifiers) [0x00000] in
&lt;filename unknown&gt;:0
  at System.Reflection.Emit.TypeBuilder.DefineDefaultConstructor
(MethodAttributes attributes) [0x00
000] in &lt;filename unknown&gt;:0
  at System.Reflection.Emit.TypeBuilder.CreateType () [0x00000] in &lt;filename
unknown&gt;:0
  at
Microsoft.FSharp.Compiler.AbstractIL.RuntimeWriter.TypeBuilder.CreateTypeAndLog
(System.Reflect
ion.Emit.TypeBuilder ) [0x00000] in &lt;filename unknown&gt;:0
  at
<A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">Microsoft.FSharp.Compiler.AbstractIL.RuntimeWriter+traverseTypeRef at 1816.Invoke</A>
(Int32 priority,


As far as I can tell, when setting the parent of type C to type B&lt;int&gt;,
MakeGenericType is called on the System.Type object for B, but the type object
returned is a MonoGenericClass, not a System.Type, as it should be.  (I guess
MonoGenericClass is equivalent to
System.Reflection.Emit.TypeBuilderInstantiation on the Microsoft CLR?)  It
looks like the abstract parent class isn&#8217;t being properly specialized.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>










































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="098671.html">[Mono-bugs] [Bug 591149] Is this a real compilation error? Visual Studio says OK, Mono returns error
</A></li>
	<LI>Next message: <A HREF="098518.html">[Mono-bugs] [Bug 591226] New: Using Reflection.Emit to generate a generic method may lead to invalid codegen
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98517">[ date ]</a>
              <a href="thread.html#98517">[ thread ]</a>
              <a href="subject.html#98517">[ subject ]</a>
              <a href="author.html#98517">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
