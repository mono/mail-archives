<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 585455] New: HttpListener does not handle authentication completely
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20585455%5D%20New%3A%20HttpListener%20does%20not%20handle%0A%20authentication%20completely&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="098000.html">
   <LINK REL="Next"  HREF="098002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 585455] New: HttpListener does not handle authentication completely</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20585455%5D%20New%3A%20HttpListener%20does%20not%20handle%0A%20authentication%20completely&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 585455] New: HttpListener does not handle authentication completely">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Mar  4 08:41:06 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="098000.html">[Mono-bugs] [Bug 585415] ERROR:method-to-ir.c:10906:mono_spill_global_vars: assertion failed: (load_opcode != OP_LOADV_MEMBASE)
</A></li>
        <LI>Next message: <A HREF="098002.html">[Mono-bugs] [Bug 585455] HttpListener does not handle	authentication completely
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98001">[ date ]</a>
              <a href="thread.html#98001">[ thread ]</a>
              <a href="subject.html#98001">[ subject ]</a>
              <a href="author.html#98001">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=585455">http://bugzilla.novell.com/show_bug.cgi?id=585455</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=585455#c0">http://bugzilla.novell.com/show_bug.cgi?id=585455#c0</A>


           Summary: HttpListener does not handle authentication completely
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: System
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">aenomoto at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=346551)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=346551">http://bugzilla.novell.com/attachment.cgi?id=346551</A>)
fix candidate patch

I have been investigating on why HttpListener Basic authentication does not
work (as well as others) well, and noticed that it has some misbehavior on
Begin/EndGetContext() handling.


// ---- repro listener code ----
using System;
using System.Net;
using System.IO;

public class Test
{
        public static void Main ()
        {
                var l = new HttpListener ();
                l.AuthenticationSchemes = AuthenticationSchemes.Basic;
                l.Prefixes.Add (&quot;<A HREF="http://localhost:8080/&quot;">http://localhost:8080/&quot;</A>);
                l.Start ();
                var ir = l.BeginGetContext (null, null);
                Console.WriteLine (&quot;Type [CR] to continue...&quot;);
                Console.ReadLine ();
                var ctx = l.EndGetContext (ir);
                Console.WriteLine (ctx.User.Identity);
                var ident = ctx.User.Identity as HttpListenerBasicIdentity;
                Console.WriteLine (ident.Name);
                ctx.Response.Close ();
        }
}


To test the repro, first compile and start the listener. It will wait for enter
key.

  gmcs listener.cs
  mono listener.exe

And then run wget:

  wget --http-user=user --http-password=right <A HREF="http://localhost:8080/index.html">http://localhost:8080/index.html</A>

Enter [CR] on the listener console and it will continue to EndGetContext().

When successfully done, it prints &quot;user&quot;.

I have a patch (attached) that makes it work to some extent. Basically it is
wrong to signal the WaitHandle as if it were finished request processing while
it indeed isn't (it's still processing negotiation connection).

It successfully passes basic authentication, but on windows it somehow results
in weird runtime crash (probably invalid access to thread or network
resources).

  Stacktrace:

  This application has requested the Runtime to terminate it in an unusual way.
  Please contact the application's support team for more information.

Even after applying my patch it still fails on WCF authentication samples
(olive/samples/wcf/authentication), but it is likely another issue in
HttpListener.

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="098000.html">[Mono-bugs] [Bug 585415] ERROR:method-to-ir.c:10906:mono_spill_global_vars: assertion failed: (load_opcode != OP_LOADV_MEMBASE)
</A></li>
	<LI>Next message: <A HREF="098002.html">[Mono-bugs] [Bug 585455] HttpListener does not handle	authentication completely
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98001">[ date ]</a>
              <a href="thread.html#98001">[ thread ]</a>
              <a href="subject.html#98001">[ subject ]</a>
              <a href="author.html#98001">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
