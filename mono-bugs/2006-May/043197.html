<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 77824][Nor] Changed - im: crash when calling
	PaintEventArgs.Graphics.Transform in OnPaint()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077824%5D%5BNor%5D%20Changed%20-%20im%3A%20crash%20when%20calling%0A%09PaintEventArgs.Graphics.Transform%20in%20OnPaint%28%29&In-Reply-To=bug-77824%40chernobyl.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="043196.html">
   <LINK REL="Next"  HREF="043198.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 77824][Nor] Changed - im: crash when calling
	PaintEventArgs.Graphics.Transform in OnPaint()</H1>
    <B>bugzilla-daemon at bugzilla.ximian.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%2077824%5D%5BNor%5D%20Changed%20-%20im%3A%20crash%20when%20calling%0A%09PaintEventArgs.Graphics.Transform%20in%20OnPaint%28%29&In-Reply-To=bug-77824%40chernobyl.ximian.com"
       TITLE="[Mono-bugs] [Bug 77824][Nor] Changed - im: crash when calling
	PaintEventArgs.Graphics.Transform in OnPaint()">bugzilla-daemon at bugzilla.ximian.com
       </A><BR>
    <I>Mon May 22 18:03:35 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="043196.html">[Mono-bugs] [Bug 78227][Nor] Changed - x86/64 regression: erroneous
	error with Monitor.Pulse, 1.1.7 branch
</A></li>
        <LI>Next message: <A HREF="043198.html">[Mono-bugs] [Bug 77824][Nor] Changed - im: crash when calling
	PaintEventArgs.Graphics.Transform in OnPaint()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43197">[ date ]</a>
              <a href="thread.html#43197">[ thread ]</a>
              <a href="subject.html#43197">[ subject ]</a>
              <a href="author.html#43197">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">peter at novonyx.com.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=77824">http://bugzilla.ximian.com/show_bug.cgi?id=77824</A>

--- shadow/77824	2006-05-21 16:29:18.000000000 -0400
+++ shadow/77824.tmp.32042	2006-05-22 18:03:35.000000000 -0400
@@ -1,13 +1,13 @@
 Bug#: 77824
 Product: Mono: Class Libraries
 Version: 1.1
 OS: unknown
 OS Details: 
-Status: REOPENED   
-Resolution: 
+Status: RESOLVED   
+Resolution: NOTABUG
 Severity: Unknown
 Priority: Normal
 Component: Windows.Forms
 AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">peter at novonyx.com</A>                            
 ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">matt at use.net</A>               
 QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at ximian.com</A>
@@ -235,6 +235,25 @@
 
 Personally I dislike the g_return_val_if_fail calls - in part because
 they mess up the unit tests display, coverity has a hard time dealing
 with them (and reporting false alarms) and, in some case, introduced
 problem when dealing with errors (e.g. missing free). But removing
 them won't fix your problem (only the display ;-)
+
+------- Additional Comments From <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">peter at novonyx.com</A>  2006-05-22 18:03 -------
+After lots of analyzing here's what I found:
+
+Inside it's OnPaint(paint_event) handler the application does:
+new PaintEventArgs(paint_event.Graphics, rectangle)
+
+That causes the graphics object to be copied into a new 
+PaintEventArgs object, and when the GC cleans up that object, the 
+graphics object will be disposed. In some cases, this object, 
+however, is represending the double buffer context and may not be 
+disposed. If it is anyways, we get a later crash since it's native 
+object is now 0.
+
+The problem is that just creating new PaintEventArgs is not really 
+legal, even on MS. If the GC on MS were to kick in at the right time, 
+the graphics object would be disposed there, too, and the app would 
+crash. Since we reuse our graphics object it just is more obvious on 
+Mono.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="043196.html">[Mono-bugs] [Bug 78227][Nor] Changed - x86/64 regression: erroneous
	error with Monitor.Pulse, 1.1.7 branch
</A></li>
	<LI>Next message: <A HREF="043198.html">[Mono-bugs] [Bug 77824][Nor] Changed - im: crash when calling
	PaintEventArgs.Graphics.Transform in OnPaint()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#43197">[ date ]</a>
              <a href="thread.html#43197">[ thread ]</a>
              <a href="subject.html#43197">[ subject ]</a>
              <a href="author.html#43197">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
