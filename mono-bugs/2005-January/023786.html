<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 70981][Cri] New - dll import errors in a real multi processor environement
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="023785.html">
   <LINK REL="Next"  HREF="023787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 70981][Cri] New - dll import errors in a real multi processor environement
   </H1>
    <B>bugzilla-daemon@bugzilla.ximian.com
    </B> 
    <A HREF="mailto:bugzilla-daemon%40bugzilla.ximian.com"
       TITLE="[Mono-bugs] [Bug 70981][Cri] New - dll import errors in a real multi processor environement">bugzilla-daemon@bugzilla.ximian.com
       </A><BR>
    <I>Tue,  4 Jan 2005 09:48:33 -0500 (EST)</I>
    <P><UL>
        <LI> Previous message: <A HREF="023785.html">[Mono-bugs] [Bug 70787][Cri] Changed - Crash in handles.c line 716 - Mono 1.0.5
</A></li>
        <LI> Next message: <A HREF="023787.html">[Mono-bugs] [Bug 70850][Wis] Changed - Fail to set Socket Timeout property
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23786">[ date ]</a>
              <a href="thread.html#23786">[ thread ]</a>
              <a href="subject.html#23786">[ subject ]</a>
              <a href="author.html#23786">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please do not reply to this email- if you want to comment on the bug, go to the
URL shown below and enter your comments there.

Changed by <A HREF="mailto:michael.kaempf@fakt-software.de.">michael.kaempf@fakt-software.de.</A>

<A HREF="http://bugzilla.ximian.com/show_bug.cgi?id=70981">http://bugzilla.ximian.com/show_bug.cgi?id=70981</A>

--- shadow/70981	2005-01-04 09:48:33.000000000 -0500
+++ shadow/70981.tmp.22660	2005-01-04 09:48:33.000000000 -0500
@@ -0,0 +1,174 @@
+Bug#: 70981
+Product: Mono: Runtime
+Version: 1.1
+OS: Red Hat 7.3
+OS Details: 
+Status: NEW   
+Resolution: 
+Severity: 
+Priority: Critical
+Component: JIT
+AssignedTo: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>                            
+ReportedBy: <A HREF="mailto:michael.kaempf@fakt-software.de">michael.kaempf@fakt-software.de</A>               
+QAContact: <A HREF="mailto:mono-bugs@ximian.com">mono-bugs@ximian.com</A>
+TargetMilestone: ---
+URL: 
+Summary: dll import errors in a real multi processor environement
+
+Please fill in this template when reporting a bug, unless you know what 
+you are doing.
+Description of Problem:
+
+
+Steps to reproduce the problem:
+1. create source files
+
+--- testlib.c ---
+
+#include &lt;stdio.h&gt;
+#include &lt;string.h&gt;
+
+#include &lt;mpi.h&gt;
+
+int init (char** arg)
+{
+	int argc = 0;
+	char **argv = arg;
+
+	while (argv[0]) {
+		argv++;
+		argc++;
+	}
+
+	return MPI_Init (&amp;argc, &amp;arg);
+}
+
+int rank (void)
+{
+	int t;
+	MPI_Comm_rank (MPI_COMM_WORLD, &amp;t);
+	return t;
+}
+
+int size (void)
+{
+	int t;
+	MPI_Comm_size (MPI_COMM_WORLD, &amp;t);
+	return t;
+}
+
+void send (int value, int dest, int tag)
+{
+	MPI_Send (&amp;value, 1, MPI_INT, dest, tag, MPI_COMM_WORLD);
+}
+
+int recv (int source, int tag)
+{
+	int data;
+	MPI_Status status;
+	MPI_Recv (&amp;data, 1, MPI_INT, source, tag, MPI_COMM_WORLD, &amp;status);
+	return data;
+}
+
+void finalize (void)
+{
+	MPI_Finalize ();
+}
+
+--- test.cs ---
+
+using System;
+using System.Runtime.InteropServices;
+
+class Test
+{
+	[DllImport(&quot;testlib.so&quot;,EntryPoint=&quot;init&quot;)]
+		private static extern int MPI_Init(string[] arg);
+	
+	[DllImport(&quot;testlib.so&quot;,EntryPoint=&quot;rank&quot;)]
+		private static extern int MPI_Comm_rank();
+	
+	[DllImport(&quot;testlib.so&quot;,EntryPoint=&quot;size&quot;)]
+		private static extern int MPI_Comm_size();
+	
+	[DllImport(&quot;testlib.so&quot;,EntryPoint=&quot;send&quot;)]
+		private static extern void MPI_Send(int value, int dest, 
+int tag);
+	
+	[DllImport(&quot;testlib.so&quot;,EntryPoint=&quot;recv&quot;)]
+		private static extern int MPI_Recv(int source, int tag);
+
+	[DllImport(&quot;testlib.so&quot;,EntryPoint=&quot;finalize&quot;)]
+		private static extern void MPI_Finalize();
+
+	public static void Main(string[] args)
+	{
+		MPI_Init (args);
+		
+		int rank = MPI_Comm_rank ();
+		int size = MPI_Comm_size ();
+
+		Console.WriteLine(&quot;alive on {0}/{1}&quot;, rank, size);
+
+		if (rank == 0) {
+			for (int i=1; i&lt;size; i++) {
+				int t = MPI_Recv (i, 0);
+				Console.WriteLine(&quot;hello from {0}&quot;, t);
+			}
+		} else {
+			MPI_Send (rank, 0, 0);
+		}
+
+		MPI_Finalize ();
+	}
+}
+
+
+
+2. compile it
+
+--- makefile ---
+
+all: test.exe testlib.so
+
+test.exe: test.cs
+	mcs test.cs
+
+testlib.so: testlib.c
+	mpicc -o testlib.so testlib.c -shared
+
+clean:
+	rm -f test.exe testlib.so
+
+
+3. run the result files in a real multi processor environement
+
+lamboot -b -v hosts
+mpirun -np 4 /usr/bin/mono test.exe
+wipe -v
+
+Actual Results:
+
+Unhandled Exception: System.DllNotFoundException: testlib.so
+in &lt;0x00053&gt; (wrapper managed-to-native) Test:MPI_Init (string[])
+in &lt;0x0002b&gt; Test:Main (string[])
+
+or:
+
+The assembly mscorlib.dll was not found or could not be loaded.
+It should have been installed in the `/afs/tu-
+chemnitz.de/project/CAOS/usr/mono-1.0.4/lib' directory.
+
+Expected Results:
+
+Output and no errors.
+
+How often does this happen? 
+
+Every time.
+
+Additional Information:
+
+I'm using a real multi processor environement with MPI and LAM. Till mono 
+version 0.40 their were no such problems. But since mono version 1.0 they 
+occure.

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="023785.html">[Mono-bugs] [Bug 70787][Cri] Changed - Crash in handles.c line 716 - Mono 1.0.5
</A></li>
	<LI> Next message: <A HREF="023787.html">[Mono-bugs] [Bug 70850][Wis] Changed - Fail to set Socket Timeout property
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23786">[ date ]</a>
              <a href="thread.html#23786">[ thread ]</a>
              <a href="subject.html#23786">[ subject ]</a>
              <a href="author.html#23786">[ author ]</a>
         </LI>
       </UL>
</body></html>
