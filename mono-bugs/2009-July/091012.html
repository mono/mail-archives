<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 525306] New: RPC name invalid when connection pooling is disabled
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20525306%5D%20New%3A%20RPC%20name%20invalid%20when%20connection%0A%20pooling%20is%20disabled&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="091008.html">
   <LINK REL="Next"  HREF="091013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 525306] New: RPC name invalid when connection pooling is disabled</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20525306%5D%20New%3A%20RPC%20name%20invalid%20when%20connection%0A%20pooling%20is%20disabled&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 525306] New: RPC name invalid when connection pooling is disabled">bugzilla_noreply at novell.com
       </A><BR>
    <I>Sun Jul 26 08:58:46 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="091008.html">[Mono-bugs] [Bug 421336] DbCommandBuilder throws exceptions on	command creation
</A></li>
        <LI>Next message: <A HREF="091013.html">[Mono-bugs] [Bug 525306] RPC name invalid when connection pooling	is disabled
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#91012">[ date ]</a>
              <a href="thread.html#91012">[ thread ]</a>
              <a href="subject.html#91012">[ subject ]</a>
              <a href="author.html#91012">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=525306">http://bugzilla.novell.com/show_bug.cgi?id=525306</A>


           Summary: RPC name invalid when connection pooling is disabled
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: All
        OS/Version: Windows XP
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.Data.SqlClient
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">gert.driesen at pandora.be</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


User-Agent:       Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1;
Trident/4.0; .NET CLR 2.0.50727; .NET CLR 1.1.4322; .NET CLR 1.0.3705; .NET CLR
3.0.04506.30; .NET CLR 3.0.04506.590; .NET CLR 3.0.04506.648; .NET CLR
3.5.21022; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)

When connection pooling is disabled, a SqlException detailing mentioning an
invalid RPC name is thrown.


Reproducible: Always

Steps to Reproduce:
To reproduce, compile and run the following code (after modifying user id/pwd):

using System;
using System.Data;
using System.Data.SqlClient;

class Program
{
  [STAThread]
  static int Main ()
  {
    SqlConnection conn = new SqlConnection ();
    conn.ConnectionString = &quot;server=.;database=monotest;user
id=sa;pwd=x;pooling=false&quot;;
    conn.Open ();

    SqlCommand cmd = conn.CreateCommand ();
    cmd.CommandText = &quot;select count(*) from master.dbo.sysprocesses where
db_name(dbid) = @dbname&quot;;
    cmd.Parameters.Add (new SqlParameter (&quot;@dbname&quot;, conn.Database));
    int connection_count = (int) cmd.ExecuteScalar ();
    cmd.Dispose ();

    Console.WriteLine (&quot;Connections=&quot; + connection_count);

    return 0;
  }
}

Actual Results:  
Unhandled Exception: System.Data.SqlClient.SqlException: The incoming tabular
da
ta stream (TDS) remote procedure call (RPC) protocol stream is incorrect. The
RP
C name is invalid.
  at System.Data.SqlClient.SqlConnection.ErrorHandler (System.Object sender,
Mon
o.Data.Tds.Protocol.TdsInternalErrorMessageEventArgs e) [0x00032] in
d:\developm
ent\projects\mono\mcs\class\System.Data\System.Data.SqlClient\SqlConnection.cs:3
14
  at Mono.Data.Tds.Protocol.Tds.OnTdsErrorMessage
(Mono.Data.Tds.Protocol.TdsInt
ernalErrorMessageEventArgs e) [0x0000b] in
d:\development\projects\mono\mcs\clas
s\Mono.Data.Tds\Mono.Data.Tds.Protocol\Tds.cs:1715
  at Mono.Data.Tds.Protocol.Tds.ProcessMessage (TdsPacketSubType subType)
[0x000
ef] in
d:\development\projects\mono\mcs\class\Mono.Data.Tds\Mono.Data.Tds.Protoc
ol\Tds.cs:1755
  at Mono.Data.Tds.Protocol.Tds.ProcessSubPacket () [0x00130] in
d:\development\
projects\mono\mcs\class\Mono.Data.Tds\Mono.Data.Tds.Protocol\Tds.cs:1807
  at Mono.Data.Tds.Protocol.Tds.NextResult () [0x0004a] in
d:\development\projec
ts\mono\mcs\class\Mono.Data.Tds\Mono.Data.Tds.Protocol\Tds.cs:642
  at System.Data.SqlClient.SqlCommand.ExecuteScalar () [0x0001c] in
d:\developme
nt\projects\mono\mcs\class\System.Data\System.Data.SqlClient\SqlCommand.cs:619
  at (wrapper remoting-invoke-with-check)
System.Data.SqlClient.SqlCommand:Execu
teScalar ()



Expected Results:  
The following output is written to the stdout:

Connections=&lt;number&gt;

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>






































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="091008.html">[Mono-bugs] [Bug 421336] DbCommandBuilder throws exceptions on	command creation
</A></li>
	<LI>Next message: <A HREF="091013.html">[Mono-bugs] [Bug 525306] RPC name invalid when connection pooling	is disabled
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#91012">[ date ]</a>
              <a href="thread.html#91012">[ thread ]</a>
              <a href="subject.html#91012">[ subject ]</a>
              <a href="author.html#91012">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
