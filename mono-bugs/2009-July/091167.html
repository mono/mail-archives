<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Mono-bugs] [Bug 527277] New: DataView is returning a wrong Count value with a AddNew()/DataRowView.EndEdit () cycle
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20527277%5D%20New%3A%20DataView%20is%20returning%20a%20wrong%20Count%0A%20value%20with%20a%20AddNew%28%29/DataRowView.EndEdit%20%28%29%20cycle&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="091165.html">
   <LINK REL="Next"  HREF="091168.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mono-bugs] [Bug 527277] New: DataView is returning a wrong Count value with a AddNew()/DataRowView.EndEdit () cycle</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:mono-bugs%40lists.ximian.com?Subject=%5BMono-bugs%5D%20%5BBug%20527277%5D%20New%3A%20DataView%20is%20returning%20a%20wrong%20Count%0A%20value%20with%20a%20AddNew%28%29/DataRowView.EndEdit%20%28%29%20cycle&In-Reply-To="
       TITLE="[Mono-bugs] [Bug 527277] New: DataView is returning a wrong Count value with a AddNew()/DataRowView.EndEdit () cycle">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Jul 31 16:51:38 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="091165.html">[Mono-bugs] [Bug 467509] [PATCH] Marshalling arrays of COM interfaces doesn't work
</A></li>
        <LI>Next message: <A HREF="091168.html">[Mono-bugs] [Bug 527277] DataView is returning a wrong Count value with a AddNew()/DataRowView.EndEdit () cycle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#91167">[ date ]</a>
              <a href="thread.html#91167">[ thread ]</a>
              <a href="subject.html#91167">[ subject ]</a>
              <a href="author.html#91167">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=527277">http://bugzilla.novell.com/show_bug.cgi?id=527277</A>


           Summary: DataView is returning a wrong Count value with a
                    AddNew()/DataRowView.EndEdit () cycle
    Classification: Mono
           Product: Mono: Class Libraries
           Version: SVN
          Platform: Other
        OS/Version: Other
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: Sys.Data
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">bnc-blr-team-mono at forge.provo.novell.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">calberto.cortez at gmail.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/mono-bugs">mono-bugs at lists.ximian.com</A>
          Found By: ---


Created an attachment (id=309757)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=309757">http://bugzilla.novell.com/attachment.cgi?id=309757</A>)
Test case

User-Agent:       Mozilla/5.0 (X11; U; Linux i686; es-ES; rv:1.9.0.10)
Gecko/2009042700 SUSE/3.0.10-1.1.1 Firefox/3.0.10

It's possible to add a row to a view, and then discard it or accept that row,
using DataView.AddNew () and then DataRowView.EndEdit () on the new added row. 

When DataView.AddNew () is called, the data view is firing a ListChanged event,
and calling DataRowView.EndInit () is firing the same event with the same
members (ListChangedTypew to ItemAdded, NewIndex to the position of the new
row), which is fine.

But in the second time the event is fired (when DataRowView.EndInit is called),
the DataView.Count value reported is wrong - specifically Count+1. But this
invalid value is happening only during the time of the event, since posterior
checks return the right value.

The attached sample prints in .net: (the same Count)

ListChanged = ItemAdded, New Index = 1, Old = -1, Count = 2
ListChanged = ItemAdded, New Index = 1, Old = -1, Count = 2

In Mono we get: (the value in the second time is wrong)

ListChanged = ItemAdded, New Index = 1, Old = -1, Count = 2
ListChanged = ItemAdded, New Index = 1, Old = -1, Count = 3



Reproducible: Always

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="091165.html">[Mono-bugs] [Bug 467509] [PATCH] Marshalling arrays of COM interfaces doesn't work
</A></li>
	<LI>Next message: <A HREF="091168.html">[Mono-bugs] [Bug 527277] DataView is returning a wrong Count value with a AddNew()/DataRowView.EndEdit () cycle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#91167">[ date ]</a>
              <a href="thread.html#91167">[ thread ]</a>
              <a href="subject.html#91167">[ subject ]</a>
              <a href="author.html#91167">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/mono-bugs">More information about the mono-bugs
mailing list</a><br>
</body></html>
