<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-devel] Improving refactoring after 2.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Improving%20refactoring%20after%202.0&In-Reply-To=1225987760.7463.24.camel%40164-99-120-118.boston.ximian.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000069.html">
   <LINK REL="Next"  HREF="000071.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-devel] Improving refactoring after 2.0</H1>
    <B>Mike Kr&#252;ger</B> 
    <A HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Improving%20refactoring%20after%202.0&In-Reply-To=1225987760.7463.24.camel%40164-99-120-118.boston.ximian.com"
       TITLE="[Monodevelop-devel] Improving refactoring after 2.0">mkrueger at novell.com
       </A><BR>
    <I>Fri Nov  7 03:31:07 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000069.html">[Monodevelop-devel] Improving refactoring after 2.0
</A></li>
        <LI>Next message: <A HREF="000071.html">[Monodevelop-devel] Improving refactoring after 2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70">[ date ]</a>
              <a href="thread.html#70">[ thread ]</a>
              <a href="subject.html#70">[ subject ]</a>
              <a href="author.html#70">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&#65279;Hi

&gt;<i> Notice that change previewing for the rename operation can be done
</I>with
&gt;<i> the current infrastructure. It's a matter of finding the references,
</I>&gt;<i> displaying them and do the replace when the user clicks on OK. The API
</I>&gt;<i> supports that, although we haven't implemented the GUI.
</I>&gt;<i> 
</I>
No not really. It's a hack. There is an operation called:

IMember RenameMember (RefactorerContext ctx, 
                      IType cls, 
                      IMember member, 
                      string newName);

And that's it. Ok you've:

MemberReferenceCollection FindMemberReferences (RefactorerContext ctx,
string fileName,
IType cls,
IMember member);
MemberReferenceCollection FindVariableReferences (RefactorerContext ctx,
string fileName, LocalVariable var);
MemberReferenceCollection FindParameterReferences (RefactorerContext
ctx, string fileName, IParameter param);

And with these three methods you can hack something together for this
one refactoring case - but that's it. Thisis not really what I've in
mind to do.

&gt;<i> &gt; 
</I>&gt;<i> &gt; &#65279;I'll need to extend/change the current refactoring infrastructure
</I>for
&gt;<i> &gt; this. And one of the goals for the new one is: unit test support.
</I>The
&gt;<i> &gt; new code completion infrastructure is tested with unit tests and I
</I>think
&gt;<i> &gt; that this has improved the code completion correctness greatly.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Any thoughts/inputs here ?
</I>&gt;<i> 
</I>&gt;<i> I'd like to see a high level design of the API to get an idea of how
</I>you
&gt;<i> plan to improve the refactoring infrastructure.
</I>&gt;<i> 
</I>
Currently:

Anything seems to be called &quot;refactorer&quot; (Even classes that don't
implement IRefactorer) to make it more stangely we've a refactorer
called CodeGenerator (inheriting from BaseRefactorer). It looks like
thats currently anything is hacked together.
It starts with clicking on something in the editor window there is a
class that builds the context menu and this class controls which
operations are valid.

I want:

Split up refactoring a bit to make it clear what each class does.

I intend to split up the &quot;refactoring&quot; feature. Each refactoring
operation should be an own class that knows it's responsibilities (based
on the resolve result) it knows when it's valid to display in the
refactoring context menu.

Then we would've classes like:

&#65279;Rename
&#65279;Implicit&#65279;ImplementInterface
ExplicitImplementInterface
ExtractMethod

etc.

These refactorings should be placed in the addin tree.

We've a RefactorerContext - that's good these context should be
containing the find functions and some helper functions that are
currently splitted up between IRefactorer and CodeRefactorer).

Then we need a CodeGenerator - this is a class that actually builds
code. Not by changing it, it should produce &quot;diffs&quot;.

Then we need something like a result of the refactoring operations.
That'll give us a list of files with diffs as well as a list of the
class tree with changes. I intend to have a dialog that looks like:

-----------------

 Positions


-----------------


Diffs


-----------------

That's what I intend to:

class &#65279;RefactoringResult {
	List&lt;Change&gt; Changes;
}

class Change {
	string fileName; 
	IMember memberLocation;

        DomLocation position;

        string old;
	string new;
}


Something like this an 'positions' should be switchable between class
view and file view (like the pads).

The Refactoring should something look like:

&#65279;IRefactoring {
	bool IsSupported (&#65279;ResolveResult result);
	string GetDisplaySting (&#65279;&#65279;ResolveResult result);
	
	void Run ();
}

IResultRefactoring : IRefactoring {
	&#65279;&#65279;RefactoringResult DoOperation (RefactorerContext, ResolveResult
result);
}

I want to support maybe more than one type of refactoring, therefore
just the &quot;run&quot; method. And there are more types than just the diff
refactoring - implement/override members for example therefore not all
refactorings require the position/diff dialogs. 
Another example could be renaming a local variable or parameter which
could be displayed inline in the text editor instead of having pop up
dialogs. (Ok I admit I've worked a bit with eclipse this week :) )

To decide: On which infrastructure we'll build. Currently it's a bit
mixed up between CodeDOM and NRefactory. I would've chosen NRefactory
because we're already building on this and an own AST gives more control
than a pre defined one.

Regards
Mike

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000069.html">[Monodevelop-devel] Improving refactoring after 2.0
</A></li>
	<LI>Next message: <A HREF="000071.html">[Monodevelop-devel] Improving refactoring after 2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#70">[ date ]</a>
              <a href="thread.html#70">[ thread ]</a>
              <a href="subject.html#70">[ subject ]</a>
              <a href="author.html#70">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">More information about the Monodevelop-devel-list
mailing list</a><br>
</body></html>
