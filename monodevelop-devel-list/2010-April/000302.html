<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-devel] Adding tracking spans in the MD text editor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Adding%20tracking%20spans%20in%20the%20MD%20text%20editor&In-Reply-To=1270621200.2488.42.camel%40mkrueger-desktop">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000301.html">
   <LINK REL="Next"  HREF="000303.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-devel] Adding tracking spans in the MD text editor</H1>
    <B>nikhil sarda</B> 
    <A HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Adding%20tracking%20spans%20in%20the%20MD%20text%20editor&In-Reply-To=1270621200.2488.42.camel%40mkrueger-desktop"
       TITLE="[Monodevelop-devel] Adding tracking spans in the MD text editor">diff.operator at gmail.com
       </A><BR>
    <I>Wed Apr  7 08:58:25 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000301.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
        <LI>Next message: <A HREF="000303.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#302">[ date ]</a>
              <a href="thread.html#302">[ thread ]</a>
              <a href="subject.html#302">[ subject ]</a>
              <a href="author.html#302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Apr 6, 2010 at 11:20 PM, Mike Kr&#252;ger &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">mkrueger at novell.com</A>&gt; wrote:
&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i> *I want to move the discussion to the developer mailing list*
</I>&gt;<i>
</I>&gt;&gt;<i> I had a talk with Michael Hutchinson on IRC regarding the new VS 2010
</I>&gt;&gt;<i> text editor features, such as the text markers, tracking spans and the
</I>&gt;&gt;<i> ITagger interface. I guess currently book keeping in the text editor,
</I>&gt;&gt;<i> like region folding, bookmarks and breakpoints are done using markers.
</I>&gt;&gt;<i> In VS 2010, changes in the text are exposed to tracking spans.
</I>&gt;&gt;<i> Basically you create a span over some text, and after the text has
</I>&gt;&gt;<i> changed, you can query the span for its status. They key difference is
</I>&gt;&gt;<i> that, unlike markers that are checked at each text change event, spans
</I>&gt;&gt;<i> are checked only when you require their status, ie lazy evaluation.
</I>&gt;<i>
</I>&gt;<i> Don't believe all of the ms marketing :)
</I>
I generally assume they know what they are talking about, but I'll be
careful next time :)

&gt;<i> Monodevelop doesn't update all 'markers' on on text change events ...
</I>&gt;<i> Currently the stuff is stored in the line segments and the line segments
</I>&gt;<i> are stored in a red-black tree. And on text change only a small part of
</I>&gt;<i> the tree changes. The monodevelop text editor is the same in this regard
</I>
I did know about the line segment data structure, its used to
calculate the LOC in the code metrics.
I just had a vague recollection of it being stored in the RB tree.
Thing is I don't know how to keep a track
of changes in the line segment. Maybe theres a onLineSegmentChange
event, I don't know. The problem is
how do I narrow down to that *part* of the line segment that changed,
ie a word or phrase.

&gt;<i> (I don't know why you think it's not).
</I>
Ignorance? I'm still new to Mono, and I never claimed to know the text
editor internals :)

&gt;<i> And for any kind of markers a red-black tree could be used as well. I
</I>&gt;<i> don't know what's so difficult in 'not updatating all markers' ... this
</I>&gt;<i> is more or less 3rd semester computer science stuff what they're
</I>&gt;<i> describing. 'Use a tree instead of an array.' I wonder if they stored
</I>&gt;<i> their lines as an 'array' as well :).
</I>
&gt;<i> (Before you kill me - the region folding isn't stored in a red-black
</I>&gt;<i> tree this one is currently stored as a 'folding tree' ... has to do with
</I>&gt;<i> the way I get the data from the parser. This is something like a hybrid
</I>&gt;<i> tree ... it contains links in the line segment red-black tree -
</I>&gt;<i> therefore updating it is faster as the domino update effect the MS
</I>&gt;<i> developers are fearing).
</I>
So would you suggest I create my own hybrid tree to keep track of text in the
text editor? For example, I wanted to keep track of text that violate
certain rules
so that I could add little squiggly lines under them. I could probably
create a tree
that stores the links to the line segments that I know violate the
rules. Thing is,
is there a way to highlight only that part of the line segment which
has the error?
AFAIK, whenever theres a parse error, the entire line gets highlighted
by a red squiggly.

&gt;&gt;<i> This is being done by using snapshots of the text editor, which allow
</I>&gt;&gt;<i> you to go get the status of the span at each write. The way its being
</I>&gt;&gt;<i> done suggests that the underlying data structure is persistent.
</I>&gt;&gt;<i> Also of interest is the ITagger interface, which provides metadata for
</I>&gt;&gt;<i> text in a buffer. The tagger interface will make writing of spell
</I>&gt;&gt;<i> checkers and the quick-fixes part of my proposal very easy. Also as
</I>&gt;&gt;<i> the spans are immutable, you could probably use PLINQ on them to do
</I>&gt;&gt;<i> some awesome stuff. I would like to point your attention to two
</I>&gt;&gt;<i> articles
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://blogs.msdn.com/noahric/archive/2010/01/28/new-extension-spell-checker.aspx">http://blogs.msdn.com/noahric/archive/2010/01/28/new-extension-spell-checker.aspx</A>
</I>&gt;&gt;<i> <A HREF="http://blogs.msdn.com/noahric/archive/2009/06/06/editor-perf-markers-vs-tracking-spans.aspx">http://blogs.msdn.com/noahric/archive/2009/06/06/editor-perf-markers-vs-tracking-spans.aspx</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do let me know of your plans with the text editor.
</I>&gt;<i>
</I>&gt;<i> This one is *much* more interresting - I do want to do it as well :).
</I>&gt;<i> Snapshots are the way to go (I've too many 'background' thread problems
</I>&gt;<i> and I too think that this is the best solution).
</I>&gt;<i>
</I>&gt;<i> The snapshot stuff I call 'piece table'. I've started to implement it to
</I>&gt;<i> replace the buffer. The idea is that the current buffer state is always
</I>&gt;<i> valid - even if the buffer changes. (But for multi threading you need a
</I>&gt;<i> copy of the 'snapshot' in the other thread - but it's always valid). I
</I>&gt;<i> want the snapshot system for the whole document.
</I>&gt;<i> (this will make the undo/redo more easier to implement as well ... but
</I>&gt;<i> it's only a side effect).
</I>&gt;<i>
</I>&gt;<i> It's something like:
</I>&gt;<i> [DATA] &lt;- [TABLE]
</I>&gt;<i> And [DATA] only grows and [TABLE] contains the information how the
</I>&gt;<i> [DATA] is puzzled together as text. [DATA] contains something like 2
</I>&gt;<i> char arrays: one of the original file and one growing change buffer.
</I>&gt;<i> Background threads now can use the current valid [TABLE] in their thread
</I>&gt;<i> and it's always valid against the [DATA] - even if it changes.
</I>&gt;<i>
</I>&gt;<i> (Before anybody throws in 'memory hole' I want to throw in 'unlimited
</I>&gt;<i> undo')
</I>&gt;<i>
</I>&gt;<i> Markers/Highlighting:
</I>&gt;<i>
</I>&gt;<i> And I want to do an own red-black tree for segments (aka. 'markers') for
</I>&gt;<i> the highlighting. Currently the highlighting spans are a bit hacky.
</I>&gt;<i> Doing this as an own tree would be much easier. And a tree for semantic
</I>&gt;<i> highlighting tags as well. I think here something like the ITagger
</I>&gt;<i> interface would work. Currently the highlighting is state less more or
</I>&gt;<i> less ... the line segments contain the begin span stack. But I want to
</I>&gt;<i> get rid of this hack and have an own span red-black tree instead.
</I>
I guess this answers my questions above?
Btw does this mean an RB Tree within an RB Tree?

&gt;<i> Overall I want to use more red-black trees in the text editor. Maybe
</I>&gt;<i> even put all markers into an own one (but for many markers the line
</I>&gt;<i> tagging works well and the line segments also aren't updated on each
</I>&gt;<i> text change). Currently the piece table has some bugs (but it uses the
</I>&gt;<i> same red-black tree than the current line segments, I haven't had the
</I>&gt;<i> time/patience to track this yet).
</I>&gt;<i>
</I>&gt;<i> It's interresting that the vs.net developers and we are doing almost the
</I>&gt;<i> same evolution - it's always good to know what the competitors are up
</I>&gt;<i> to :)
</I>&gt;<i>
</I>&gt;<i> If anyone wants to help with the text editor data structures (or maybe
</I>&gt;<i> have more proposals on doing things) - all input/help is welcome.
</I>
Um, make the text editor extensible through scripting? *ducks shoes*

&gt;<i> Regards
</I>&gt;<i> Mike
</I>&gt;<i>
</I>&gt;<i>
</I>Cheers
Nikhil Sarda
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000301.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
	<LI>Next message: <A HREF="000303.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#302">[ date ]</a>
              <a href="thread.html#302">[ thread ]</a>
              <a href="subject.html#302">[ subject ]</a>
              <a href="author.html#302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">More information about the Monodevelop-devel-list
mailing list</a><br>
</body></html>
