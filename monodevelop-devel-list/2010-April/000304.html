<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-devel] Adding tracking spans in the MD text editor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Adding%20tracking%20spans%20in%20the%20MD%20text%20editor&In-Reply-To=r2xf9958e1e1004070558n9c20885dv5d2a9a6516c8080b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000303.html">
   <LINK REL="Next"  HREF="000305.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-devel] Adding tracking spans in the MD text editor</H1>
    <B>Mike Kr&#252;ger</B> 
    <A HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Adding%20tracking%20spans%20in%20the%20MD%20text%20editor&In-Reply-To=r2xf9958e1e1004070558n9c20885dv5d2a9a6516c8080b%40mail.gmail.com"
       TITLE="[Monodevelop-devel] Adding tracking spans in the MD text editor">mkrueger at novell.com
       </A><BR>
    <I>Thu Apr  8 05:06:44 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000303.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
        <LI>Next message: <A HREF="000305.html">[Monodevelop-devel] MonoDevelop UI feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#304">[ date ]</a>
              <a href="thread.html#304">[ thread ]</a>
              <a href="subject.html#304">[ subject ]</a>
              <a href="author.html#304">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

&gt;<i> &gt; *I want to move the discussion to the developer mailing list*
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; I had a talk with Michael Hutchinson on IRC regarding the new VS 2010
</I>&gt;<i> &gt;&gt; text editor features, such as the text markers, tracking spans and the
</I>&gt;<i> &gt;&gt; ITagger interface. I guess currently book keeping in the text editor,
</I>&gt;<i> &gt;&gt; like region folding, bookmarks and breakpoints are done using markers.
</I>&gt;<i> &gt;&gt; In VS 2010, changes in the text are exposed to tracking spans.
</I>&gt;<i> &gt;&gt; Basically you create a span over some text, and after the text has
</I>&gt;<i> &gt;&gt; changed, you can query the span for its status. They key difference is
</I>&gt;<i> &gt;&gt; that, unlike markers that are checked at each text change event, spans
</I>&gt;<i> &gt;&gt; are checked only when you require their status, ie lazy evaluation.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Don't believe all of the ms marketing :)
</I>&gt;<i> 
</I>&gt;<i> I generally assume they know what they are talking about, but I'll be
</I>&gt;<i> careful next time :)
</I>&gt;<i> 
</I>
They know what they're talking about ... using an array for the markers
is a bad idea ... but I for myself are not very surprised about that :)
(I found that out about 10 years ago with my 1st text editor storing the
lines in an ArrayList :))

&gt;<i> &gt; Monodevelop doesn't update all 'markers' on on text change events ...
</I>&gt;<i> &gt; Currently the stuff is stored in the line segments and the line segments
</I>&gt;<i> &gt; are stored in a red-black tree. And on text change only a small part of
</I>&gt;<i> &gt; the tree changes. The monodevelop text editor is the same in this regard
</I>&gt;<i> 
</I>&gt;<i> I did know about the line segment data structure, its used to
</I>&gt;<i> calculate the LOC in the code metrics.
</I>&gt;<i> I just had a vague recollection of it being stored in the RB tree.
</I>&gt;<i> Thing is I don't know how to keep a track
</I>&gt;<i> of changes in the line segment. Maybe theres a onLineSegmentChange
</I>&gt;<i> event, I don't know. The problem is
</I>&gt;<i> how do I narrow down to that *part* of the line segment that changed,
</I>&gt;<i> ie a word or phrase.
</I>&gt;<i> 
</I>
That's more difficult - I recommend storing the segments in a RB tree
and track the change there separately. 

&gt;<i> So would you suggest I create my own hybrid tree to keep track of text in the
</I>&gt;<i> text editor? For example, I wanted to keep track of text that violate
</I>&gt;<i> certain rules
</I>&gt;<i> so that I could add little squiggly lines under them. I could probably
</I>&gt;<i> create a tree
</I>&gt;<i> that stores the links to the line segments that I know violate the
</I>&gt;<i> rules. Thing is,
</I>&gt;<i> is there a way to highlight only that part of the line segment which
</I>&gt;<i> has the error?
</I>
Yes that's the current approach. The part of the line segment is more
difficult. The text marker gets the whole line. With this info you can
get the line layout and inside the pango line layout you have to get the
position of the line part with IndexToXY

&gt;<i> AFAIK, whenever theres a parse error, the entire line gets highlighted
</I>&gt;<i> by a red squiggly.
</I>&gt;<i> 
</I>
I'll improve the red squiggly lines when I get good parser errors. The
current ones are just 'proof of concept' :). NRefactory was never
designed for finding errors.

&gt;<i> &gt; And I want to do an own red-black tree for segments (aka. 'markers') for
</I>&gt;<i> &gt; the highlighting. Currently the highlighting spans are a bit hacky.
</I>&gt;<i> &gt; Doing this as an own tree would be much easier. And a tree for semantic
</I>&gt;<i> &gt; highlighting tags as well. I think here something like the ITagger
</I>&gt;<i> &gt; interface would work. Currently the highlighting is state less more or
</I>&gt;<i> &gt; less ... the line segments contain the begin span stack. But I want to
</I>&gt;<i> &gt; get rid of this hack and have an own span red-black tree instead.
</I>&gt;<i> 
</I>&gt;<i> I guess this answers my questions above?
</I>&gt;<i> Btw does this mean an RB Tree within an RB Tree?
</I>&gt;<i> 
</I>
No it means just that each RB tree node (==line segment) has a tag with
the current span stack at this position. 

&gt;<i> &gt; Overall I want to use more red-black trees in the text editor. Maybe
</I>&gt;<i> &gt; even put all markers into an own one (but for many markers the line
</I>&gt;<i> &gt; tagging works well and the line segments also aren't updated on each
</I>&gt;<i> &gt; text change). Currently the piece table has some bugs (but it uses the
</I>&gt;<i> &gt; same red-black tree than the current line segments, I haven't had the
</I>&gt;<i> &gt; time/patience to track this yet).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's interresting that the vs.net developers and we are doing almost the
</I>&gt;<i> &gt; same evolution - it's always good to know what the competitors are up
</I>&gt;<i> &gt; to :)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If anyone wants to help with the text editor data structures (or maybe
</I>&gt;<i> &gt; have more proposals on doing things) - all input/help is welcome.
</I>&gt;<i> 
</I>&gt;<i> Um, make the text editor extensible through scripting? *ducks shoes*
</I>&gt;<i>
</I>
Scripting for what ? (btw. we choose to be extendable with .NET using
the addin-tree :))

Regards
Mike

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000303.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
	<LI>Next message: <A HREF="000305.html">[Monodevelop-devel] MonoDevelop UI feedback
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#304">[ date ]</a>
              <a href="thread.html#304">[ thread ]</a>
              <a href="subject.html#304">[ subject ]</a>
              <a href="author.html#304">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">More information about the Monodevelop-devel-list
mailing list</a><br>
</body></html>
