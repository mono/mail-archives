<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-devel] Adding tracking spans in the MD text editor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Adding%20tracking%20spans%20in%20the%20MD%20text%20editor&In-Reply-To=y2uf9958e1e1004062222rcc4e8b2exeea875b27f6ad1e9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000300.html">
   <LINK REL="Next"  HREF="000302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-devel] Adding tracking spans in the MD text editor</H1>
    <B>Mike Kr&#252;ger</B> 
    <A HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Adding%20tracking%20spans%20in%20the%20MD%20text%20editor&In-Reply-To=y2uf9958e1e1004062222rcc4e8b2exeea875b27f6ad1e9%40mail.gmail.com"
       TITLE="[Monodevelop-devel] Adding tracking spans in the MD text editor">mkrueger at novell.com
       </A><BR>
    <I>Wed Apr  7 02:20:00 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000300.html">[Monodevelop-devel] How to translate Monodevelop
</A></li>
        <LI>Next message: <A HREF="000302.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#301">[ date ]</a>
              <a href="thread.html#301">[ thread ]</a>
              <a href="subject.html#301">[ subject ]</a>
              <a href="author.html#301">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

*I want to move the discussion to the developer mailing list*

&gt;<i> I had a talk with Michael Hutchinson on IRC regarding the new VS 2010
</I>&gt;<i> text editor features, such as the text markers, tracking spans and the
</I>&gt;<i> ITagger interface. I guess currently book keeping in the text editor,
</I>&gt;<i> like region folding, bookmarks and breakpoints are done using markers.
</I>&gt;<i> In VS 2010, changes in the text are exposed to tracking spans.
</I>&gt;<i> Basically you create a span over some text, and after the text has
</I>&gt;<i> changed, you can query the span for its status. They key difference is
</I>&gt;<i> that, unlike markers that are checked at each text change event, spans
</I>&gt;<i> are checked only when you require their status, ie lazy evaluation.
</I>
Don't believe all of the ms marketing :)

Monodevelop doesn't update all 'markers' on on text change events ... 
Currently the stuff is stored in the line segments and the line segments
are stored in a red-black tree. And on text change only a small part of
the tree changes. The monodevelop text editor is the same in this regard
(I don't know why you think it's not).

And for any kind of markers a red-black tree could be used as well. I
don't know what's so difficult in 'not updatating all markers' ... this
is more or less 3rd semester computer science stuff what they're
describing. 'Use a tree instead of an array.' I wonder if they stored
their lines as an 'array' as well :).

(Before you kill me - the region folding isn't stored in a red-black
tree this one is currently stored as a 'folding tree' ... has to do with
the way I get the data from the parser. This is something like a hybrid
tree ... it contains links in the line segment red-black tree -
therefore updating it is faster as the domino update effect the MS
developers are fearing).

&gt;<i> This is being done by using snapshots of the text editor, which allow
</I>&gt;<i> you to go get the status of the span at each write. The way its being
</I>&gt;<i> done suggests that the underlying data structure is persistent.
</I>&gt;<i> Also of interest is the ITagger interface, which provides metadata for
</I>&gt;<i> text in a buffer. The tagger interface will make writing of spell
</I>&gt;<i> checkers and the quick-fixes part of my proposal very easy. Also as
</I>&gt;<i> the spans are immutable, you could probably use PLINQ on them to do
</I>&gt;<i> some awesome stuff. I would like to point your attention to two
</I>&gt;<i> articles
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://blogs.msdn.com/noahric/archive/2010/01/28/new-extension-spell-checker.aspx">http://blogs.msdn.com/noahric/archive/2010/01/28/new-extension-spell-checker.aspx</A>
</I>&gt;<i> <A HREF="http://blogs.msdn.com/noahric/archive/2009/06/06/editor-perf-markers-vs-tracking-spans.aspx">http://blogs.msdn.com/noahric/archive/2009/06/06/editor-perf-markers-vs-tracking-spans.aspx</A>
</I>&gt;<i> 
</I>&gt;<i> Do let me know of your plans with the text editor.
</I>
This one is *much* more interresting - I do want to do it as well :). 
Snapshots are the way to go (I've too many 'background' thread problems
and I too think that this is the best solution).

The snapshot stuff I call 'piece table'. I've started to implement it to
replace the buffer. The idea is that the current buffer state is always
valid - even if the buffer changes. (But for multi threading you need a
copy of the 'snapshot' in the other thread - but it's always valid). I
want the snapshot system for the whole document. 
(this will make the undo/redo more easier to implement as well ... but
it's only a side effect).

It's something like:
[DATA] &lt;- [TABLE]
And [DATA] only grows and [TABLE] contains the information how the
[DATA] is puzzled together as text. [DATA] contains something like 2
char arrays: one of the original file and one growing change buffer.
Background threads now can use the current valid [TABLE] in their thread
and it's always valid against the [DATA] - even if it changes.

(Before anybody throws in 'memory hole' I want to throw in 'unlimited
undo')

Markers/Highlighting:

And I want to do an own red-black tree for segments (aka. 'markers') for
the highlighting. Currently the highlighting spans are a bit hacky.
Doing this as an own tree would be much easier. And a tree for semantic
highlighting tags as well. I think here something like the ITagger
interface would work. Currently the highlighting is state less more or
less ... the line segments contain the begin span stack. But I want to
get rid of this hack and have an own span red-black tree instead.

Overall I want to use more red-black trees in the text editor. Maybe
even put all markers into an own one (but for many markers the line
tagging works well and the line segments also aren't updated on each
text change). Currently the piece table has some bugs (but it uses the
same red-black tree than the current line segments, I haven't had the
time/patience to track this yet).

It's interresting that the vs.net developers and we are doing almost the
same evolution - it's always good to know what the competitors are up
to :) 

If anyone wants to help with the text editor data structures (or maybe
have more proposals on doing things) - all input/help is welcome. 

Regards
Mike

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000300.html">[Monodevelop-devel] How to translate Monodevelop
</A></li>
	<LI>Next message: <A HREF="000302.html">[Monodevelop-devel] Adding tracking spans in the MD text editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#301">[ date ]</a>
              <a href="thread.html#301">[ thread ]</a>
              <a href="subject.html#301">[ subject ]</a>
              <a href="author.html#301">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">More information about the Monodevelop-devel-list
mailing list</a><br>
</body></html>
