<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-devel] Working on the monodevelop dom after 2.2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Working%20on%20the%20monodevelop%20dom%20after%202.2&In-Reply-To=1254138451.29894.282.camel%40linux-nesp.site">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000222.html">
   <LINK REL="Next"  HREF="000224.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-devel] Working on the monodevelop dom after 2.2</H1>
    <B>Christian Hergert</B> 
    <A HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Working%20on%20the%20monodevelop%20dom%20after%202.2&In-Reply-To=1254138451.29894.282.camel%40linux-nesp.site"
       TITLE="[Monodevelop-devel] Working on the monodevelop dom after 2.2">christian.hergert at gmail.com
       </A><BR>
    <I>Mon Sep 28 09:34:58 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000222.html">[Monodevelop-devel] Working on the monodevelop dom after 2.2
</A></li>
        <LI>Next message: <A HREF="000224.html">[Monodevelop-devel] Working on the monodevelop dom after 2.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#223">[ date ]</a>
              <a href="thread.html#223">[ thread ]</a>
              <a href="subject.html#223">[ subject ]</a>
              <a href="author.html#223">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Having done a SQLite database for PyBinding, my primary concern is migration
of schemas and upgrading on the fly.  It's largely a PITA (however perhaps
the ParserDatabase is as well).

-- Christian

On Mon, Sep 28, 2009 at 4:47 AM, Lluis Sanchez Gual &lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">lluis at novell.com</A>&gt;wrote:

&gt;<i> See comments inline.
</I>&gt;<i>
</I>&gt;<i> El ds 26 de 09 de 2009 a les 14:57 +0200, en/na Mike Kr&#252;ger va escriure:
</I>&gt;<i> &gt; Hi
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; The current situation is that if a non .NET language wants to provide
</I>&gt;<i> &gt; &gt; support for 1), we are forcing the use of the MD DOM, even when it
</I>&gt;<i> &gt; &gt; really doesn't fit. And there isn't much gain with that, because that
</I>&gt;<i> &gt; &gt; language won't be really able to leverage 2) and 3). The type
</I>&gt;<i> &gt; &gt; resolution
</I>&gt;<i> &gt; &gt; rules of the MD DOM strictly follow the .NET semantics, so it won't be
</I>&gt;<i> &gt; &gt; of much use for non .NET languages. Also, as a general purpose DOM for
</I>&gt;<i> &gt; &gt; the language it won't be really useful because it won't allow
</I>&gt;<i> &gt; &gt; expressing
</I>&gt;<i> &gt; &gt; the particularities of the language.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Type resolution isn't done in the MD DOM most resolving is done by the
</I>&gt;<i> &gt; backends.
</I>&gt;<i>
</I>&gt;<i> I know most of the work is done by the backends, but still the parser
</I>&gt;<i> service does .NET specific resolution work which is useless to other
</I>&gt;<i> languages. See ProjectDom.SearchType for example.
</I>&gt;<i>
</I>&gt;<i> &gt; Our DOM it can be a bit better at genericity than the current one. But
</I>&gt;<i> &gt; we won't never get a 'general purpose' dom. It should just describe the
</I>&gt;<i> &gt; most basic language structures we likely encounter.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; My ideas for improving the situation are the following:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;       * Create a new DOM, which would be very high level, with just
</I>&gt;<i> &gt; &gt; the
</I>&gt;<i> &gt; &gt;         information required to support 1). It would be a simple DOM,
</I>&gt;<i> &gt; &gt;         intended only for displaying information to the user, not for
</I>&gt;<i> &gt; &gt;         type resolution or other operations.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I don't think a new DOM is required the current one represents the .NET
</I>&gt;<i> &gt; reflection API and that's a good sharing point across all .NET
</I>&gt;<i> &gt; languages.
</I>&gt;<i>
</I>&gt;<i> That's OK for .NET languages, but we are talking about improving support
</I>&gt;<i> for non-.NET languages.
</I>&gt;<i>
</I>&gt;<i> &gt; I would change the current one a bit so that it's more mighty
</I>&gt;<i> &gt; than the reflection API. Some languages that are a bit different can be
</I>&gt;<i> &gt; wrapped to .NET classes by their compiler and it would be nice if we can
</I>&gt;<i> &gt; support those languages.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &#65279;Type resolution is done in the language backends. It does have some
</I>&gt;<i> &gt; operations but these are common accross all languages that use .NET
</I>&gt;<i> &gt; (like give all types in a namespace). When building a non .NET binding
</I>&gt;<i> &gt; there is no need to use these .NET specific features.
</I>&gt;<i>
</I>&gt;<i> Also, there is no need to be unnecessarily constrained by them. For
</I>&gt;<i> example, to show the current method in the members combo box, the
</I>&gt;<i> following interface would be enough:
</I>&gt;<i>
</I>&gt;<i> interface INewMethod
</I>&gt;<i> {
</I>&gt;<i>        string GetDescription (SomeContext ctx);
</I>&gt;<i>        string Icon { get; }
</I>&gt;<i>        Region BodyRegion { get; }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> That would be very easy to implement by a non .net language, and it is
</I>&gt;<i> not constraining the implementation in any way. The current IMethod
</I>&gt;<i> interface constraints the implementation to use a specific set of
</I>&gt;<i> modifiers, implement stuff like TypeParameters which won't be used, and
</I>&gt;<i> force the use of a parameters collection which also have .net specific
</I>&gt;<i> modifiers. And all this for just being able to build a string describing
</I>&gt;<i> a method.
</I>&gt;<i>
</I>&gt;<i> My idea of new DOM is to create a set of interfaces which can be
</I>&gt;<i> implemented by non-.net language DOMs. Those interfaces would provide
</I>&gt;<i> just the enough information that usually has to be shown to the user.
</I>&gt;<i> They would be very generic, and could have a tree-like structure like
</I>&gt;<i> the one you are proposing. But the main idea is that those interfaces
</I>&gt;<i> are not meant to be used as part of any resolution process, or
</I>&gt;<i> refactoring, or any other operation that requires rich information about
</I>&gt;<i> the types. We already have language-specific DOMs to do that. Instead,
</I>&gt;<i> these would be used only for displaying information to the user.
</I>&gt;<i>
</I>&gt;<i> The current DOM would also implement those interfaces, so .NET languages
</I>&gt;<i> (for which the current DOM works great) wouldn't need to implement them.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My suggestion for making the DOM more general:
</I>&gt;<i> &gt; Doing anything with a tree node as base and have some types of tree
</I>&gt;<i> &gt; nodes (file/namespace/class/method etc). All tree nodes have:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * Link to their parent
</I>&gt;<i> &gt; * Know their childrin
</I>&gt;<i> &gt; * Have connections to their siblings
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Accessing the children/parents is the same for all these DOM nodes. Some
</I>&gt;<i> &gt; operations on the current DOM have become a bit too difficult and they
</I>&gt;<i> &gt; would be easier with a general tree as underlying data structure.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It has limits to build a general DOM - I would draw the line
</I>&gt;<i> &gt; between .NET/non .NET language. The output done by the ambiences limits
</I>&gt;<i> &gt; a bit the flexibility of the DOM. But I think that ambiences are a good
</I>&gt;<i> &gt; idea.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Some examples .NET specific things that we use but will clash with
</I>&gt;<i> &gt; non .NET languages and there isn't anything we can do about:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * Method paramater modifiers out/ref/params - no 'per name' modifier
</I>&gt;<i> &gt; * General modifiers (public/protected etc.) - no c++ 'inline' modifier
</I>&gt;<i> &gt; or others
</I>&gt;<i> &gt; * Just file -&gt; namespace -&gt; type -&gt; member model - no 'pascal units' or
</I>&gt;<i> &gt; declaration/implementation models (#include) or any other form of
</I>&gt;<i> &gt; representation
</I>&gt;<i> &gt; * Just the .NET constructs (no 'typedef' for example).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ... and maybe more
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Things we currently support but .NET doesn't:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * Multiple inheritance
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Things we can support with some DOM refactorings but currently we don't:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * file -&gt; member models (would useful for the c# language too)
</I>&gt;<i> &gt; * method -&gt; method will be allowed (local methods are supported by some
</I>&gt;<i> &gt; languages)
</I>&gt;<i> &gt; * Other constructs ('typedef') which can be supported in a language
</I>&gt;<i> &gt; specific ambience. This is a strong point theoretical it would be
</I>&gt;<i> &gt; possible that a language brings their own tree.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----
</I>&gt;<i> &gt; Other operations:
</I>&gt;<i> &gt; If we want to have central support for code completion through a code
</I>&gt;<i> &gt; completion database the DOM needs support for some operations.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The problem with these operations is now to determine if an operation
</I>&gt;<i> &gt; is:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; * Language specific
</I>&gt;<i> &gt; * .NET centric
</I>&gt;<i> &gt; * General.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I don't think that .NET centric operations like IsMemberAcessible or the
</I>&gt;<i> &gt; ResolveResults shouldn't be inside the central dom, because it can be re
</I>&gt;<i> &gt; used accross some .NET language bindings and if we can make the life
</I>&gt;<i> &gt; easier for .NET language bindings - why not. Other languages (if they
</I>&gt;<i> &gt; fit in our DOM model) don't need to call/use these features.
</I>&gt;<i>
</I>&gt;<i> If we can generalize a bit the DOM, so some non-.NET languages can reuse
</I>&gt;<i> it, that's OK to me. But reusing the full DOM (with all its features and
</I>&gt;<i> constraints) should be optional.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; &gt;       * Each .NET language would implement its own DOM to support code
</I>&gt;<i> &gt; &gt;         completion.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's already required, otherwise resolving won't work - there is no way
</I>&gt;<i> &gt; around it. But retieving the .NET code completion information should
</I>&gt;<i> &gt; work with our general DOM - otherwise it won't give any access to our
</I>&gt;<i> &gt; code completion database. (But language bindings can bring their own
</I>&gt;<i> &gt; code completion infrastructure if they want)
</I>&gt;<i>
</I>&gt;<i> All that is OK to me.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt;       * Generalize a bit the parser service, so we can share some of
</I>&gt;<i> &gt; &gt; its
</I>&gt;<i> &gt; &gt;         logic. We can keep the parser database as it is right now, but
</I>&gt;<i> &gt; &gt;         it would be used only for .NET languages. Non .NET languages
</I>&gt;<i> &gt; &gt;         would use its own DOM storage model. Maybe we wouldn't be able
</I>&gt;<i> &gt; &gt;         to share much, but at least we could share the thread that
</I>&gt;<i> &gt; &gt;         checks for changes and triggers parse operations or something
</I>&gt;<i> &gt; &gt;         like that.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I wouldn't give access for custom (binary)database plugins, because the
</I>&gt;<i> &gt; database exposes a model and other languages that don't fit into the
</I>&gt;<i> &gt; model won't share the same logic/models. Our database uses a custom
</I>&gt;<i> &gt; binary format and some tables to speed up some operations.
</I>&gt;<i>
</I>&gt;<i> That's not what I'm proposing.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I would just add support for binary serialization of custom DOM nodes.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Bringing other models into our 'database' (which isn't a real database)
</I>&gt;<i> &gt; would require that they write their own data storage and logic/models
</I>&gt;<i> &gt; and not interfere with the current binary format (depending on what the
</I>&gt;<i> &gt; plugins want to do). I think if they don't support our DOM model they
</I>&gt;<i> &gt; should bring their own 'database' implementation.
</I>&gt;<i>
</I>&gt;<i> And that's just what I'm proposing. Notice that I talked about
</I>&gt;<i> generalizing the parser *service*, not the parser *database*. The parser
</I>&gt;<i> service is in charge of driving the parse operations of project files
</I>&gt;<i> and referenced assemblies. It can be generalized a bit to allow plugging
</I>&gt;<i> other parsing systems on it, with their own database systems.
</I>&gt;<i>
</I>&gt;<i> &gt; Another point is that
</I>&gt;<i> &gt; the database is accessible only through DOM models - that'll make it
</I>&gt;<i> &gt; even more unlikely that a language can put some plugin into it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Therefore I don't see a good reason for this (But this will depend on
</I>&gt;<i> &gt; the user requests - I think some work can be done by the language
</I>&gt;<i> &gt; implementors).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; btw. how about switching to SQLite for the parser database ?
</I>&gt;<i>
</I>&gt;<i> If a SQLite based database provides equal or faster access times, with a
</I>&gt;<i> reasonable memory use, we can consider it.
</I>&gt;<i>
</I>&gt;<i> Lluis.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Monodevelop-devel-list mailing list
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">Monodevelop-devel-list at lists.ximian.com</A>
</I>&gt;<i> <A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.ximian.com/pipermail/monodevelop-devel-list/attachments/20090928/a2eee449/attachment-0001.html">http://lists.ximian.com/pipermail/monodevelop-devel-list/attachments/20090928/a2eee449/attachment-0001.html</A> 
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000222.html">[Monodevelop-devel] Working on the monodevelop dom after 2.2
</A></li>
	<LI>Next message: <A HREF="000224.html">[Monodevelop-devel] Working on the monodevelop dom after 2.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#223">[ date ]</a>
              <a href="thread.html#223">[ thread ]</a>
              <a href="subject.html#223">[ subject ]</a>
              <a href="author.html#223">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">More information about the Monodevelop-devel-list
mailing list</a><br>
</body></html>
