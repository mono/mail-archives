<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Monodevelop-devel] Atomic file write API
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Atomic%20file%20write%20API&In-Reply-To=1a3a3e310903160552h2a6aa5caue14feab82e99382b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000128.html">
   <LINK REL="Next"  HREF="000131.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Monodevelop-devel] Atomic file write API</H1>
    <B>Michael Hutchinson</B> 
    <A HREF="mailto:monodevelop-devel-list%40lists.ximian.com?Subject=%5BMonodevelop-devel%5D%20Atomic%20file%20write%20API&In-Reply-To=1a3a3e310903160552h2a6aa5caue14feab82e99382b%40mail.gmail.com"
       TITLE="[Monodevelop-devel] Atomic file write API">m.j.hutchinson at gmail.com
       </A><BR>
    <I>Mon Mar 16 13:33:59 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000128.html">[Monodevelop-devel] Atomic file write API
</A></li>
        <LI>Next message: <A HREF="000131.html">[Monodevelop-devel] Atomic file write API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#130">[ date ]</a>
              <a href="thread.html#130">[ thread ]</a>
              <a href="subject.html#130">[ subject ]</a>
              <a href="author.html#130">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Mar 16, 2009 at 8:52 AM, Levi Bard
&lt;<A HREF="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">taktaktaktaktaktaktaktaktaktak at gmail.com</A>&gt; wrote:
&gt;&gt;<i> An issue that has recently gained prominence is reliability of file
</I>&gt;&gt;<i> writes on Ext4:
</I>&gt;&gt;<i> <A HREF="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/317781/comments/54">https://bugs.launchpad.net/ubuntu/+source/linux/+bug/317781/comments/54</A>
</I>&gt;&gt;<i> <A HREF="http://mjg59.livejournal.com/108257.html?view=1320929">http://mjg59.livejournal.com/108257.html?view=1320929</A>
</I>&gt;&gt;<i> After writing a changed file to disk and the system crashes before the
</I>&gt;&gt;<i> changes are flushed from the OS or disk buffers, files can be left in
</I>&gt;&gt;<i> a corrupted state.
</I>&gt;<i>
</I>&gt;<i> I largely agree with Matthew Garrett's POV on these matters.
</I>
Me too, but that doesn't change the fact that these problems are
permitted by POSIX, so even if heuristics are added for fixed for ex4
and btrfs, which should still do the right thing in case other
filesystems are used.

[...]
&gt;&gt;<i> I think we should add an FileStream-based API to MonoDevelop.Core for
</I>&gt;&gt;<i> handling this, with several other features:
</I>&gt;&gt;<i> * Levels of reliability: fsync, renaming, unsafe
</I>&gt;&gt;<i> * Option to create backup files, with automatic fallbacks to backups
</I>&gt;&gt;<i> when loading damaged settings files
</I>&gt;&gt;<i> * Autosave to temp files, and prompting the user for recovery of
</I>&gt;&gt;<i> autosaved or damaged files after a crash
</I>&gt;<i>
</I>&gt;<i> Would anyone ever explicitly choose less than the most-reliable option?
</I>
Because it has a cost. An fsync can be very expensive. Presumably the
heuristics employed by ext4 have some associated cost too.

&gt;<i> The backup from temp files is nice.
</I>&gt;<i>
</I>&gt;&gt;<i> Another advantage of having this code in a centralised location is
</I>&gt;&gt;<i> that it would be easy to use alternatives as they become available,
</I>&gt;&gt;<i> e.g. transactional NTFS on Windows Vista
</I>&gt;&gt;<i> (<A HREF="http://code.msdn.microsoft.com/txfmanaged">http://code.msdn.microsoft.com/txfmanaged</A>).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thoughts?
</I>&gt;<i>
</I>&gt;<i> Shouldn't some of this be pushed down into the mono framework?
</I>&gt;<i> Obviously, stuff like restoring from backups is out-of-spec and must
</I>&gt;<i> be external, but shouldn't POSIX minutiae be handled by the System.IO
</I>&gt;<i> implementation?
</I>
How could it be fixed? AFAIK the truncate-on-overwrite exists on
Windows (though not the need for fsync), which is one reason why
Transactional NTFS was added.

-- 
Michael Hutchinson
<A HREF="http://mjhutchinson.com">http://mjhutchinson.com</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000128.html">[Monodevelop-devel] Atomic file write API
</A></li>
	<LI>Next message: <A HREF="000131.html">[Monodevelop-devel] Atomic file write API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#130">[ date ]</a>
              <a href="thread.html#130">[ thread ]</a>
              <a href="subject.html#130">[ subject ]</a>
              <a href="author.html#130">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/monodevelop-devel-list">More information about the Monodevelop-devel-list
mailing list</a><br>
</body></html>
