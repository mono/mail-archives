<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-bugs] [Bug 556797] New: Moonlight does not send unhandled exceptions to JS evaluation properly due to an VS bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-bugs%40lists.ximian.com?Subject=%5BMoonlight-bugs%5D%20%5BBug%20556797%5D%20New%3A%20Moonlight%20does%20not%20send%0A%20unhandled%20exceptions%20to%20JS%20evaluation%20properly%20due%20to%20an%20VS%20bug&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001725.html">
   <LINK REL="Next"  HREF="001722.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-bugs] [Bug 556797] New: Moonlight does not send unhandled exceptions to JS evaluation properly due to an VS bug</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:moonlight-bugs%40lists.ximian.com?Subject=%5BMoonlight-bugs%5D%20%5BBug%20556797%5D%20New%3A%20Moonlight%20does%20not%20send%0A%20unhandled%20exceptions%20to%20JS%20evaluation%20properly%20due%20to%20an%20VS%20bug&In-Reply-To="
       TITLE="[Moonlight-bugs] [Bug 556797] New: Moonlight does not send unhandled exceptions to JS evaluation properly due to an VS bug">bugzilla_noreply at novell.com
       </A><BR>
    <I>Thu Nov 19 00:47:26 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001725.html">[Moonlight-bugs] [Bug 556784] http://silverlight.net/showcase/	fails to load
</A></li>
        <LI>Next message: <A HREF="001722.html">[Moonlight-bugs] [Bug 556797] Moonlight does not send unhandled exceptions to JS evaluation properly due to an VS bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1721">[ date ]</a>
              <a href="thread.html#1721">[ thread ]</a>
              <a href="subject.html#1721">[ subject ]</a>
              <a href="author.html#1721">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://bugzilla.novell.com/show_bug.cgi?id=556797">http://bugzilla.novell.com/show_bug.cgi?id=556797</A>

<A HREF="http://bugzilla.novell.com/show_bug.cgi?id=556797#c0">http://bugzilla.novell.com/show_bug.cgi?id=556797#c0</A>


           Summary: Moonlight does not send unhandled exceptions to JS
                    evaluation properly due to an VS bug
    Classification: Mono
           Product: Moonlight
           Version: SVN
          Platform: All
        OS/Version: Linux
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: engine
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">moonlight-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">aaragoneses at novell.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">moonlight-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


If I associate this function to a button click handler:

        private void Button_Click (object sender, RoutedEventArgs e)
        {
            string exc = &quot;begin.this is\nan exception.end&quot;;
            System.Windows.Browser.HtmlPage.Window.Eval (&quot;window.alert(\&quot;test &quot;
+ exc + &quot;\&quot;);&quot;);
        }

The eval method cannot evaluate the expression because the &quot;\n&quot; is extraneous.
This is both correct (not a bug) in SL and ML. (For example, test this in
Firefox and you will see an error about an unterminated string when evaluation
JS in the Error Console.)

The solution to this is:

        private void Button_Click (object sender, RoutedEventArgs e)
        {
            string exc = &quot;begin.this is\nan exception.end&quot;;
            exc = exc.Replace (&quot;\n&quot;, @&quot;\n&quot;);
            System.Windows.Browser.HtmlPage.Window.Eval (&quot;window.alert(\&quot;test &quot;
+ exc + &quot;\&quot;);&quot;);
        }

The MS guys know this very well, so this is some boilerplate code you can find
for any Silverlight default test project you create in Visual Studio (in
App.xml.cs):

        private void ReportErrorToDOM (ApplicationUnhandledExceptionEventArgs
e)
        {
            try {
                string errorMsg = e.ExceptionObject.Message +
e.ExceptionObject.StackTrace;
                errorMsg = errorMsg.Replace ('&quot;', '\'').Replace (&quot;\r\n&quot;,
@&quot;\n&quot;);

                System.Windows.Browser.HtmlPage.Window.Eval (&quot;throw new
Error(\&quot;Unhandled Error in Silverlight 2 Application &quot; + errorMsg + &quot;\&quot;);&quot;);
            } catch (Exception) {
            }
        }


Now, what's the problem here? In Moonlight, e.ExceptionObject.StackTrace *does
not contain* any &quot;\r\n&quot; because in Linux the EOL character is &quot;\n&quot;, so then the
replacement doesn't happen and the evaluation of this fails when the stacktrace
has more than one line.

What should we do? Well, it's a bug in Visual Studio because it should generate
Environment.NewLine instead of &quot;\r\n&quot;. However, all the projects created before
this hypothetical bug is squashed by Microsoft (if ever) will expose this bug
in Moonlight!

So I am proposing the following patch as a workaround to the bug (I know it's a
hack but modifying all exception objects even outside Moonlight doesn't sound
like a correct fix).

-- 
Configure bugmail: <A HREF="http://bugzilla.novell.com/userprefs.cgi?tab=email">http://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001725.html">[Moonlight-bugs] [Bug 556784] http://silverlight.net/showcase/	fails to load
</A></li>
	<LI>Next message: <A HREF="001722.html">[Moonlight-bugs] [Bug 556797] Moonlight does not send unhandled exceptions to JS evaluation properly due to an VS bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1721">[ date ]</a>
              <a href="thread.html#1721">[ thread ]</a>
              <a href="subject.html#1721">[ subject ]</a>
              <a href="author.html#1721">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">More information about the Moonlight-bugs
mailing list</a><br>
</body></html>
