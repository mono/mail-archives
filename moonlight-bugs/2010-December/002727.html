<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Moonlight-bugs] [Bug 660333] New: ClientHttp stack fails to handshake SSL (https) with a BadRecordMAC exception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:moonlight-bugs%40lists.ximian.com?Subject=%5BMoonlight-bugs%5D%20%5BBug%20660333%5D%20New%3A%20ClientHttp%20stack%20fails%20to%0A%20handshake%20SSL%20%28https%29%20with%20a%20BadRecordMAC%20exception&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002726.html">
   <LINK REL="Next"  HREF="002728.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Moonlight-bugs] [Bug 660333] New: ClientHttp stack fails to handshake SSL (https) with a BadRecordMAC exception</H1>
    <B>bugzilla_noreply at novell.com</B> 
    <A HREF="mailto:moonlight-bugs%40lists.ximian.com?Subject=%5BMoonlight-bugs%5D%20%5BBug%20660333%5D%20New%3A%20ClientHttp%20stack%20fails%20to%0A%20handshake%20SSL%20%28https%29%20with%20a%20BadRecordMAC%20exception&In-Reply-To="
       TITLE="[Moonlight-bugs] [Bug 660333] New: ClientHttp stack fails to handshake SSL (https) with a BadRecordMAC exception">bugzilla_noreply at novell.com
       </A><BR>
    <I>Fri Dec 17 16:40:32 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002726.html">[Moonlight-bugs] [Bug 660293] Converter for List&lt;&gt; property doesn't	like new list
</A></li>
        <LI>Next message: <A HREF="002728.html">[Moonlight-bugs] Your Bugzilla bug list needs attention.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2727">[ date ]</a>
              <a href="thread.html#2727">[ thread ]</a>
              <a href="subject.html#2727">[ subject ]</a>
              <a href="author.html#2727">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=660333">https://bugzilla.novell.com/show_bug.cgi?id=660333</A>

<A HREF="https://bugzilla.novell.com/show_bug.cgi?id=660333#c0">https://bugzilla.novell.com/show_bug.cgi?id=660333#c0</A>


           Summary: ClientHttp stack fails to handshake SSL (https) with a
                    BadRecordMAC exception
    Classification: Mono
           Product: Moonlight
           Version: 1.0.1
          Platform: All
        OS/Version: All
            Status: NEW
          Severity: Normal
          Priority: P5 - None
         Component: engine
        AssignedTo: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">moonlight-bugs at lists.ximian.com</A>
        ReportedBy: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">keenan.forbes at ni.com</A>
         QAContact: <A HREF="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">moonlight-bugs at lists.ximian.com</A>
          Found By: ---
           Blocker: ---


Created an attachment (id=405455)
 --&gt; (<A HREF="http://bugzilla.novell.com/attachment.cgi?id=405455">http://bugzilla.novell.com/attachment.cgi?id=405455</A>)
access a https uri via ClientHttp

User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US;
rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13

If you use a ClientHttp connection (rather than the default BrowserHttp), you
can't connect to (some?) https. For example:
<A HREF="https://newton-dev.niwsc.com/webuibuilder/api/uibuilder-eap.xml">https://newton-dev.niwsc.com/webuibuilder/api/uibuilder-eap.xml</A>

This generates a WebException: Error getting response stream (Write: The
authentication or decryption has failed.): SendFailure ---&gt;
System.IO.IOException: The authentication or decryption has failed. ---&gt;
Mono.Security.Protocol.Tls.TlsException: Record with an incorrect MAC.

(note that's the output with DEBUG enabled in
mono/mcs/class/Mono.Security/Mono.Security.Protocol.Tls/Alert.cs)


Reproducible: Always

Steps to Reproduce:
Run the attached code in a Moonlight application. It will fail with the
WebException. If you switch to using the BrowserHttp stack (commented out) or
to non SSL (also commented out) it will work just fine.
Actual Results:  
WebException

Expected Results:  
dump of the .xml file

If you need me to provide a full xap, just let me know (this file can also be
dropped into the project for bug 659791). I've spent a little time trying to
further track this down, but I'm not much of an expert in SSL so the going's
been pretty slow.

-- 
Configure bugmail: <A HREF="https://bugzilla.novell.com/userprefs.cgi?tab=email">https://bugzilla.novell.com/userprefs.cgi?tab=email</A>
------- You are receiving this mail because: -------
You are the QA contact for the bug.
You are the assignee for the bug.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002726.html">[Moonlight-bugs] [Bug 660293] Converter for List&lt;&gt; property doesn't	like new list
</A></li>
	<LI>Next message: <A HREF="002728.html">[Moonlight-bugs] Your Bugzilla bug list needs attention.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2727">[ date ]</a>
              <a href="thread.html#2727">[ thread ]</a>
              <a href="subject.html#2727">[ subject ]</a>
              <a href="author.html#2727">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ximian.com/mailman/listinfo/moonlight-bugs">More information about the Moonlight-bugs
mailing list</a><br>
</body></html>
